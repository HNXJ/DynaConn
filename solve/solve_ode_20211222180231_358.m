function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+5.366309196079804e-02   -3.089825502865069e-01   +7.553333689799681e-01   -4.768274071600834e-02   +3.872342134727170e-01   +4.633107434265776e-01   -2.714718655331171e-01   +2.358597497804451e-01   +7.128256655421126e-01   -6.738650832189280e-03   +3.110556253990219e-01   -5.708822661868380e-01   -4.115068013591317e-01   -3.912436343301442e-01   +5.308578796064581e-01   -2.805956318565902e-01; +5.588692577801789e-01   +2.073086160683851e-01   -2.171253192707188e-01   -5.424991768722247e-01   -1.831088163233247e-01   -4.235153638862776e-01   +5.443086941914359e-01   -3.032451346872039e-01   +3.045977709155034e-01   -1.797826762147497e-01   +2.335044257841813e-01   -1.942691320161071e-01   -2.733200245347220e-01   +2.215630405940074e-01   +2.851571733570490e-01   +5.612151715368149e-01; +3.242353456888994e-01   -3.143508065027448e-01   -2.793233832491832e-01   +9.512809657763006e-02   +7.525395109611049e-01   +2.398235263978991e-01   +4.630083726488134e-01   -5.442824826531740e-01   +8.621184981632971e-02   +4.992439030917989e-01   -3.526869700045929e-01   -1.175281574837325e-01   +4.598285278748174e-01   +1.512022681119199e-01   -2.820129554545913e-01   +4.767110717243110e-01; +2.507209451893810e-01   -4.152374755420189e-01   +2.564884810459904e-01   +2.819482156830251e-01   +6.853818165229444e-02   +5.329483714409524e-01   +1.000000000000000e+00   -2.933176541066430e-01   -1.711407367371641e-01   -2.475387680093976e-01   +6.395500378228246e-01   +7.141303977064939e-02   -3.188200299301457e-01   +3.331648269257517e-01   +2.000259834340439e-01   +8.545760307415330e-01; -2.837888942890887e-01   +1.403553235126565e-01   -4.409562799290694e-01   -7.116493418173522e-02   +1.315979455242208e-01   -3.052852880343351e-01   +7.129996791735749e-01   +5.749398973827360e-01   +9.955038806357511e-02   +6.535667678594846e-01   +3.034441976177136e-01   -8.186343197312100e-02   +1.201323652224251e-01   -3.986487975318170e-01   +2.161691575304021e-01   -4.428993390544424e-01; -4.158578084539222e-01   -1.977012857872890e-01   -1.597829044397762e-01   +6.095647805167703e-01   -3.926473398457671e-01   -1.772428955327172e-01   -3.982162462567306e-01   +7.699424591418781e-01   -4.033589015813558e-01   -1.616726693550288e-01   +2.280200747417463e-01   +5.108442523020771e-01   -2.939790516302026e-02   -4.142544376042213e-01   -3.699333489571552e-01   -6.160170608997489e-02; +3.172675586563148e-01   -2.483385577523994e-01   +8.287715799642589e-02   +1.101023077041376e-01   +4.876599537431228e-01   -3.183030640996999e-01   +6.095541455682933e-01   +3.652105563181091e-01   -3.233135184017150e-01   -8.274148127031235e-02   -8.777176406440064e-02   +2.999669587102073e-01   -4.193400788306265e-01   -3.354675938695362e-01   -2.881844110803098e-01   -3.180071870476517e-01; -8.566522377613234e-03   -7.010311681887521e-01   +4.184595850797429e-01   +5.447576743107291e-02   +5.047120526211622e-02   +4.270791898147217e-01   -2.099882101576360e-01   +6.748729095753528e-01   +1.861322402376311e-02   +6.733172757823566e-01   -1.855325583647970e-01   -2.223262798259908e-01   -3.009418086003898e-01   -1.195052509146709e-01   -2.070418063032062e-01   -6.774989301794362e-01; +3.125767592949155e-01   +1.585155096368097e-01   -4.820720388074466e-01   -3.812743207294904e-02   +5.669869308442129e-02   +6.860917801041618e-01   +4.833837997552355e-01   +2.797241006225508e-01   +3.986550266425238e-01   +4.115663386111104e-01   -5.848321935944367e-01   +3.663620358028222e-01   +2.032140955247410e-01   -4.265402706998228e-01   +2.939906056108880e-01   +4.816636942463206e-01; -3.410922156655123e-01   +5.249207011230331e-02   +4.745878928438106e-01   +1.262066444224605e-01   -1.816166890301561e-01   +8.065168012514309e-01   -4.760430679633397e-01   -1.576642345210700e-01   -4.203357858346088e-01   -3.774548503016938e-01   +2.959353328871830e-01   +6.997502082308185e-02   +3.401131415641525e-01   -4.895693554300803e-01   -1.277069052044833e-01   +1.212688382664350e-03; +4.903421837165889e-01   +2.611637353218638e-01   +7.707436923344347e-01   -1.355525297292515e-01   +4.677646968478928e-01   -5.562166890270993e-01   -4.390095065997841e-01   +7.478805620984350e-03   -1.197898486210979e-01   +4.982881487742682e-02   +4.353186411271336e-01   -3.051341191145592e-01   +5.534474076909089e-01   +6.930961738732452e-01   -2.170113478941388e-01   -7.629778847165726e-01; +3.841268947363952e-02   +4.777651757339154e-01   +6.194053631792831e-01   +4.946695717828478e-01   +4.365589416096325e-01   -2.127027839120326e-01   -6.969264147554362e-02   +2.956554773897723e-01   +8.112324776917416e-01   +6.634550457186028e-01   +3.033435469471092e-01   +5.386730844943722e-01   +2.334879169955945e-01   +1.712726463966780e-01   -4.384354883913239e-01   +1.116366561286755e-01; +5.984658641016541e-01   +5.016009992770661e-01   -1.940992006459502e-01   -1.320087873665509e-01   -9.998747165025580e-02   -4.465211611666891e-01   -2.855180440748083e-01   +1.839503691077025e-01   +1.624616936912969e-01   +2.373432518959312e-01   -4.288377511647251e-01   +1.324758673824820e-01   +3.478846359843513e-01   +3.383238864715261e-02   +7.891935287736456e-01   -1.392725350389601e-02; +1.174148307820355e-01   +7.788951078528011e-02   -3.131049198143996e-01   +6.368776402170088e-01   -4.156844737520728e-01   +5.982527693669758e-01   +3.585364263750380e-01   +1.388753906128388e-01   -3.011304915805922e-01   +2.765232647506700e-01   +3.654986943384215e-01   +2.756976246787266e-01   +7.319743535574867e-01   +5.826171399025130e-03   -5.328885748815861e-01   -1.679748319994121e-01; +7.548617658452071e-02   +4.390248964958530e-01   +9.370589836847883e-01   +1.253615207193781e-01   +2.006770509341587e-01   -2.203561004381573e-02   -5.720627691685219e-01   -2.104528905226144e-01   +5.718244108230736e-01   -9.924292405600017e-02   -6.537448310629423e-01   -6.379879995274159e-01   -1.568821658014609e-01   +1.025264783570874e-01   -1.790876016525234e-01   -1.957422814717391e-01; -2.141273036378074e-01   -3.718307418696457e-01   -6.285821231467408e-01   -6.774897937549054e-01   +2.128943478098224e-01   -3.316079877234873e-01   +3.350595967130213e-01   -3.409785868726390e-01   +5.144692121967063e-01   +8.063830227543192e-01   -5.240675309454674e-01   -4.158931947588828e-01   +8.711496569592851e-02   -3.295950212063657e-01   -4.695539393318362e-03   +4.635812215772314e-02];
L1E_L1I_iGABA_netcon = [+3.173445741769904e-01   +1.306860893250199e-02   -3.451355686612995e-01   +1.934449647914414e-01   -3.932967520022087e-01   -5.480116539633519e-01   -1.237441387154420e-01   +5.249728027776415e-01   +5.349170914610929e-01   -2.967505014398744e-01   -6.322365410510671e-01   +1.172273653422024e-01   +3.529380312994925e-01   +4.066958270474048e-01   -3.073918035298936e-01   +7.668339813800799e-01; -2.945066146978714e-01   +6.189216471445108e-01   -4.488348180010600e-01   -4.072541673696735e-01   +4.865302943401414e-01   +2.566641341889370e-01   -3.835382620098886e-01   -2.716953034023806e-01   -3.033962092786243e-01   +6.639832321075102e-01   +4.397993968571209e-01   -2.765018429614424e-02   +4.648795050658779e-01   +6.269219545465000e-01   +6.224949693222619e-01   +4.861699274595037e-01; +7.128887425880401e-01   -5.711237931658550e-01   -3.377791592322663e-01   -4.982307475935596e-01   -5.104648443785010e-01   +4.305189498602598e-01   +1.250463270908553e-01   -3.874359485572768e-01   -3.162503729259022e-02   +1.972848318885499e-01   +2.627498361951899e-01   -3.371031350469053e-01   -5.264879404065267e-02   +4.963014121012532e-01   +1.187179272971298e-01   -2.047191738831987e-01; +3.367674152652308e-02   -7.415981804479102e-02   +4.979527039326134e-01   +4.430156372125019e-01   -3.346016624765260e-02   -2.173798593853762e-01   -3.661176752392296e-01   -2.976879716066370e-01   +7.310653250387207e-01   +2.570948279329848e-01   +3.700632588303079e-02   -1.961389355275045e-01   +3.282677277389395e-01   -1.640074857336688e-01   -6.086161312910522e-01   +1.080685420377359e-01; -7.199511216061845e-01   -6.910080664737024e-01   +8.480286393833805e-02   +6.519648446299926e-01   +6.791504915964851e-01   +6.886735905081460e-01   +4.640285587884386e-01   -2.485051372548176e-01   -2.349771933458565e-02   +1.804866754860781e-01   -2.675598271251375e-02   -1.580403128260183e-01   -4.649800271530382e-01   +7.641387176823423e-02   +6.008539379194419e-01   -1.691351371358648e-01; +1.087083475259429e-03   -2.119462726276979e-01   -2.172241503785024e-01   -1.871689372600402e-01   +7.797713845661549e-01   -2.264207381594693e-01   +3.751275927267150e-01   +2.307669096526332e-01   +8.921384720702650e-01   +2.475520288481632e-01   +4.264884266908153e-01   +6.460063269200603e-01   +3.697127883524938e-01   +7.641804765262586e-01   +4.454844246139310e-01   +1.671457731743466e-01; -5.774207462497626e-01   +3.843088589742911e-01   +4.092614520603434e-01   +6.723554914362372e-01   -2.538462955076814e-03   +2.937547488762345e-01   -4.747735028866296e-01   +5.171981623496232e-01   +3.157133538006819e-01   -1.672901632491442e-01   +2.611143048576764e-01   +9.433237585537828e-01   -1.251081266729183e-01   +2.051329411411654e-01   +2.697193041559873e-01   +6.026528973962480e-03; +1.727703200625378e-01   +1.580211814670462e-01   -8.896486223150725e-02   -1.807988509878058e-01   +4.536656355040483e-01   +1.501537556529816e-01   +4.917081455408663e-01   -2.682276342162325e-01   +1.428969168594378e-01   -3.688716949594188e-01   -4.793511208554960e-01   +3.172116888907074e-01   +2.483269428829779e-01   -5.192130268151481e-01   -7.157257331725540e-02   +3.851920647991891e-01; +1.661781912284172e-01   -1.585269002882229e-01   +3.706004630188410e-01   +2.291285914381620e-01   -2.107158535221284e-02   +1.701040810139761e-01   +3.436625053995777e-01   -1.407789256922655e-01   -2.362259640808131e-01   +6.437947466271768e-01   +5.688809629253523e-01   -4.641862721100510e-01   +4.369264075218105e-02   -1.035090455946542e-02   -5.364686852549290e-03   -6.999338944059332e-01; -6.562186034992364e-01   +2.912685405390768e-01   +2.561684854822105e-01   +3.596727326119078e-01   +3.635897896414026e-01   -7.514821100634471e-01   +2.756792069552036e-01   +5.310176992652973e-01   +5.930218629855638e-01   +2.098912222349496e-01   -5.311598221453681e-02   -1.354747252817632e-01   +3.658962935354876e-01   +8.046283618986790e-02   -2.900406498165450e-01   +2.840463507423259e-02; -4.254759496924463e-01   -6.566226976261429e-01   -4.514567688160274e-01   +7.538082702461916e-01   +3.416950089610191e-01   +1.000000000000000e+00   +7.508225521639807e-01   +8.432463364441686e-01   +6.941171900222826e-01   +7.815240068850925e-01   -3.485430880953136e-02   -1.061765234651039e-01   +7.757641965597074e-02   +7.849484001843368e-01   +2.338848913038784e-01   +3.630186303140349e-01; +6.881674736226401e-01   -4.702867821766631e-01   +1.548722175767167e-01   +2.505649927381048e-01   +5.420142857274735e-01   -6.576300324913698e-02   +9.856419264919215e-02   +7.555034740610983e-02   +7.699615077161621e-01   -6.718660124161083e-02   -2.595385892293771e-01   +1.458450680695596e-01   +4.556276176530502e-01   -4.746504958180831e-02   -3.710418404804356e-01   +2.978582741381203e-01; -1.068683434994713e-01   +1.241997251816038e-01   +2.785793885111102e-01   +5.895251576841707e-01   -1.078794385083680e-01   +2.531237066672344e-01   +2.710869666947110e-01   +3.288260353167591e-01   +3.611459344022618e-01   +3.137290242976433e-01   -1.186460092014547e-01   +3.557117367961549e-01   +2.194413897740257e-01   +1.733771418107742e-01   -3.596323908973583e-01   +3.636994591301090e-02; +4.051513422954006e-01   -2.702363873349226e-01   +1.355164892318008e-01   -5.419678921611412e-01   -4.331235020847070e-01   -5.464424098035793e-01   -5.069665665146609e-01   +8.003758885489276e-01   +4.366280683469471e-01   +7.448885062707519e-01   +6.462196028903334e-01   -3.605907050200963e-01   -4.878291745051179e-01   -1.925041964290355e-01   -5.130957234339908e-02   -4.199488307649494e-01; +4.362916710291278e-01   -1.863747387170815e-01   -2.839821282636500e-01   -2.328566364840918e-01   +4.424051158993492e-01   -1.054457602173282e-01   +5.058089821788722e-01   -1.309149752663160e-01   +7.573440840031354e-01   -2.085009368141105e-01   -1.085577543785367e-01   -1.459994497526816e-01   +1.832535010589343e-01   +7.322496926061796e-02   -2.085248412901840e-01   +5.107983414461588e-01; +2.458573714901999e-01   +6.775211603576052e-01   +5.993312406438620e-02   -4.121804585221029e-01   +2.770171376598148e-01   -4.531841403989663e-01   +3.433601289833139e-02   +2.722495952976218e-01   -6.895720139789380e-01   +3.619472290052614e-01   -4.468595021457072e-01   +1.738963376076014e-01   -8.004123647906268e-01   -9.928524149881170e-02   +5.096435847552896e-01   +3.454521768967992e-01];
L2I_L1I_iGABA_netcon = [-2.010059144611253e-01   +1.971252475177349e-01   +1.700506429760549e-02   -3.420727938266023e-01   -3.996050016591020e-01   -2.892455353482364e-02   +2.916574256039096e-01   -5.769773627173616e-02; -2.830199869136635e-01   -1.835537973621995e-01   -2.697856568220354e-01   +4.797130331008300e-01   +3.641440777401140e-01   -5.386497715581294e-01   -4.918194201523779e-02   +5.928726290223703e-01; -1.241690246897229e-01   -1.366795103691502e-01   +5.766342315336546e-01   -7.427085437271265e-01   +3.216351869394219e-01   -5.536212494486441e-01   +7.784258427817020e-02   +7.789834989360757e-01; +2.543421433935158e-01   +9.297421045548865e-02   -7.766502981000932e-01   +3.009056136302437e-01   +3.456226921595336e-01   -5.962487142389269e-01   +5.395921815662390e-01   +4.610756628554776e-01; -1.162342736442449e-01   +6.311379013912636e-01   +5.332193767169265e-02   -8.632276483893284e-01   +1.552267761934923e-01   -3.090702978646647e-01   +5.202344094011140e-02   +8.837804395403446e-01; -5.765290749127396e-01   +6.134337453868108e-01   +6.693977599633003e-01   -8.221142628824458e-01   -7.603954831903337e-01   +8.528986374435561e-01   +9.887682476126757e-01   +1.402496482555999e-01; -5.220037886003345e-03   +8.328515735329977e-01   +4.669380452651461e-02   +5.226909217343381e-01   +4.473492739924679e-01   +3.469835677873129e-01   -3.640090487665265e-01   -1.160791728563104e-01; +4.496481189995191e-01   +6.215199119791424e-01   +1.090978244490639e-01   +1.403883916859786e-01   +4.383802458373681e-01   +1.000000000000000e+00   -3.807440314180570e-01   -1.693229500436426e-01; -1.019903237172093e-01   -3.266877224361224e-01   -3.737924597062519e-01   +8.535874142840221e-01   +2.671637956578518e-01   +2.510607386042604e-01   +4.555782604654280e-01   -3.323928629080473e-01; -6.377629441896557e-01   +4.725952531694359e-01   +5.351036363522396e-01   -3.756998186402802e-01   +3.932010255151301e-01   +5.345831983466912e-01   -8.609949369663147e-01   +3.284644063309975e-01; -4.607281465885007e-03   +7.777268187627787e-01   +1.467374610164267e-01   -4.549988340932343e-01   -4.456936056584361e-01   -5.122887881753984e-01   -2.481584892347868e-01   -2.557279137488153e-01; +2.933139187153798e-01   -8.709490247504557e-01   +6.020323058397212e-01   +4.525788129718413e-01   +3.005894977076010e-01   -4.230217851955545e-01   -2.171938369614291e-01   -2.822372882153836e-01; +6.850429655666666e-02   +4.077659573383127e-01   +3.840923826434860e-01   +1.581702799036057e-01   +8.922857946615695e-01   -5.376032001933068e-01   -1.906401116973738e-01   +2.929267707856565e-01; +6.822830476431836e-01   +3.628853548178493e-01   -2.787785307471873e-01   -2.962357682297957e-01   +7.187375644395351e-01   +4.605581980890127e-01   -3.277568959767728e-01   -1.250651700435879e-01; +5.543112817307710e-01   +8.272282682559235e-01   +5.510063482568497e-01   +7.358078399098690e-02   -2.375537736275371e-01   -5.568548818478100e-01   +7.172738370744323e-01   +5.796311092211298e-01; -1.419788241070620e-01   +6.628682494084555e-01   +6.774772127753581e-01   -2.453096512001262e-01   -5.028400289490282e-01   -4.933718719429661e-01   -8.257369088050025e-01   +8.369364412831629e-01];
L1I_L2I_iGABA_netcon = [+4.072259381152932e-01   -9.679367550674949e-02   -7.090226757450439e-02   +7.642306111725518e-02   -7.914601705713957e-01   +3.746764840438591e-01   -2.577821175427685e-01   +1.701876364976367e-01   -5.097396105686106e-02   +1.831579287909581e-01   +2.027656841589771e-01   -4.966678450447127e-01   -2.102501845088981e-02   -3.863020676705046e-01   +4.027286401491490e-01   -3.200417919618486e-01; +4.476843987841077e-03   +4.035751884735660e-01   +3.997885604258839e-01   +1.139624093692611e-01   +3.666747519392469e-01   +2.808290727973005e-01   -4.280013066196568e-01   -3.167986273313388e-01   -5.662529992115494e-01   -4.760725610568661e-02   -7.235031538755480e-01   -7.013645418734556e-02   +2.911099426132656e-01   -4.328070858477315e-01   +3.349047289518644e-01   -4.956324971967328e-01; +3.648067257833024e-01   +5.677719576194181e-01   -5.940267707420729e-01   +1.000000000000000e+00   +2.949320659612737e-01   +7.758582014726458e-01   +5.672154693905190e-01   +3.593070088811184e-01   -2.826630132926741e-01   +3.401958613009899e-01   +2.416764959907901e-01   -2.114965928544420e-01   -2.309642413964003e-01   -1.810731304435443e-01   +2.063018598276125e-01   +6.918728611592413e-01; +4.452829614074013e-01   -3.885008793158886e-01   -5.731419708426378e-01   +3.075027649478906e-01   +6.977625610767512e-01   +1.331613289336484e-01   +1.173335866851433e-01   +4.899049142146794e-01   +3.819005442369062e-01   -3.609200495103138e-01   -6.097667253097563e-01   -1.091895117674159e-01   +5.091050232952576e-01   -6.961160829653238e-01   +7.938815281083159e-01   +4.224916439725914e-02; -7.413684568108455e-01   +1.439486619179323e-01   -1.342084539838029e-01   -1.584646560833174e-01   +2.049052339806204e-01   -2.954397811443030e-01   -4.766871879067426e-01   -2.188359589752705e-01   -2.246277552869974e-01   -7.617215768281119e-01   +9.307575623984167e-01   +6.515835801563262e-02   +2.351845325705918e-01   +4.755370024011264e-02   +4.016955390815073e-01   -1.793852943578749e-01; +3.877573197614776e-01   -3.370507174770456e-01   -4.928308912964385e-01   -1.955519453495359e-01   +4.855830616282458e-01   +5.195435290335036e-02   -3.872729139993302e-01   +2.078607633880847e-01   -4.248218418645963e-01   +3.617543843376033e-01   -2.188386712874253e-01   +1.326363896129998e-01   +3.160485733129232e-01   -2.121587946180709e-01   -2.133973229157081e-01   +2.444262514525410e-01; +2.249554439497748e-03   -9.454366499394319e-02   +5.085061674505987e-01   +6.636127978720820e-01   +6.751026246331368e-02   +2.449357714826005e-01   -2.928810623885913e-02   -2.902144970518639e-01   +7.052506357688173e-01   +9.243504151484370e-02   -7.631455374194557e-02   +7.484883462845122e-02   +1.067476334235952e-01   +2.040982201051830e-01   -2.298472479277212e-01   +2.651215780586343e-02; +5.192136552788894e-01   +9.571429293848911e-02   -4.424347082657920e-01   +5.106109752235944e-01   -1.096524602853825e-01   +4.643048665929354e-01   +3.725069586270297e-01   +2.010781496370893e-01   -6.554770568147751e-02   +3.634072440086487e-01   -1.207597776737493e-01   +5.732673616439860e-01   +3.919740918232495e-01   +5.433891703399050e-01   -3.961890214251101e-02   -4.625886270289866e-02];
L2E_L1E_iAMPA_netcon = [-3.612436550042149e-01   +7.309560011360299e-01   -7.885321679401722e-02   -7.625781257417460e-01   +4.749130305205664e-01   -4.594276004886497e-01   +9.560085535778455e-01   +5.424586892212012e-01; +6.509898951394751e-02   -5.569628578348682e-01   +3.641303612221566e-01   +5.580469245805943e-02   -2.618530448340448e-05   -1.766553884279004e-01   +9.627932961553069e-02   -2.927811999712425e-02; +3.614236615534522e-01   -4.549537234927538e-02   -2.520123805341759e-01   -4.091816320174295e-01   +1.726088069242730e-01   +4.977671979069683e-01   +1.631052337549311e-01   +6.013949991524881e-01; -5.548810415558787e-01   -3.283399630119438e-01   +2.408600909914232e-01   +2.505271584323162e-02   +2.407138859814245e-01   -5.004491558362927e-01   +4.674827903412173e-01   +8.131364747508908e-01; +2.047686975016234e-02   +9.470537443002258e-01   +5.516013205066750e-01   +7.072240115176874e-01   -3.633026597845833e-01   +5.511004343358673e-01   +7.603019947920336e-01   -3.633619452419833e-01; -3.874028065958376e-03   +6.853307963303116e-01   -3.111369440674221e-01   +8.032581866616191e-02   +5.133682006026248e-01   +4.860804042541314e-01   -3.282389220878497e-02   +6.557401563360126e-01; -2.872796054202554e-01   -4.491239155148146e-01   -9.075374420787002e-01   +2.614574591232295e-01   +4.571440004288622e-01   -3.437443896573289e-02   +5.174806059723434e-01   +6.102423892382505e-01; +1.000000000000000e+00   +5.082341794828932e-01   -5.356080519458506e-01   +7.884114020382773e-01   +4.404920183092674e-01   -6.742914422952833e-03   -7.196580628056493e-01   +9.743771455016076e-01; -4.505355201193967e-01   -6.049014609371389e-02   +2.420679665371054e-01   +2.273347163639616e-01   +9.213339450748682e-01   -7.468837752145304e-01   +3.390692784251918e-01   +3.987983214456264e-03; +6.802876499447679e-01   +3.134141889417464e-01   -5.527494465674757e-02   -4.475514847594434e-01   -2.018783490931104e-01   -7.131122798454579e-01   +3.772273031637364e-01   -5.676076597224620e-01; +2.362351466950627e-01   +2.425129541953564e-01   -3.233534361568185e-01   -3.176640349190415e-01   -2.692670266902569e-01   -4.879499254795999e-01   +6.049998520594621e-01   +8.574348041909565e-01; +2.587356873332385e-02   -3.244532724836646e-01   -5.341601981544061e-01   -4.231895730445177e-01   +4.502757418426965e-01   +5.896011582378747e-01   -3.437135235787573e-01   -6.216199545765013e-02; -1.947927925819858e-03   -7.576684882946604e-01   +9.167432410408970e-01   -3.573096440341378e-01   -1.967072987594603e-01   +2.603291002115871e-01   +6.331094329337619e-01   -1.745179461233888e-01; +4.401907094967417e-01   +2.406204125859505e-01   -2.955512080405636e-01   +7.297604566352306e-02   -1.599703204833237e-01   +2.437483410715856e-01   -2.187171323515550e-02   +8.866529427667094e-02; -1.984051068667303e-01   +2.167087855748903e-01   +4.864436681300682e-01   -7.921989419326793e-01   +4.788635146120714e-01   -7.714866615580876e-01   -7.324314745773050e-01   +7.555647424350336e-01; +4.839678734029823e-01   +3.716792375149823e-01   +2.924086193412274e-01   -3.477087722602891e-01   +1.345166043640283e-01   +7.819044358665177e-01   -4.585765335198201e-01   -1.833131100927320e-01];
L1E_L2E_iAMPA_netcon = [-1.779535554228971e-01   +8.554582087753195e-01   -9.519587006942139e-03   +9.125200009863776e-02   +3.529616003160795e-01   +6.891776581586576e-01   +5.480022654808273e-01   +1.231331927873827e-01   +4.229144799863483e-01   +4.131742680708039e-01   -2.332636235998493e-01   +1.866826733514966e-01   -6.272657747471412e-01   -4.778339835397686e-01   +4.685152602293874e-01   +2.932515015661350e-01; +6.753839559173973e-01   -2.638290573438060e-01   -5.481102424520811e-01   +1.675394915642925e-01   +7.759402290259988e-01   +2.297499081718893e-01   -5.812587146478505e-01   +1.952038415465730e-01   +2.882083104396626e-01   +1.356090015722370e-01   +2.297096169890396e-02   -1.367183838879259e-01   +2.685041479560245e-01   +4.822547750607667e-01   +5.612544417639327e-01   -3.062441474203511e-01; -3.009161937755536e-01   +2.033596902894240e-02   +3.243553176268709e-01   +3.576089615248593e-01   +7.446570371677609e-01   +4.287831135389932e-01   -4.650078287026962e-01   +5.989356346018909e-01   +5.620563242347155e-01   -1.141090312248230e-01   +7.697368681364095e-02   -2.581306294558759e-02   +6.989716949601255e-01   +5.035450356957348e-01   +6.324061274681245e-01   +2.306217067175524e-01; -9.389297230920432e-02   -3.225539365221329e-01   +1.956325227000066e-01   +6.847744555085533e-01   -1.395795021943026e-01   +3.852186274455399e-01   -3.561726984088823e-01   -5.098208688940923e-02   -7.810258774192592e-01   -1.858630349156229e-01   -3.071613940510179e-01   +4.953969423336158e-01   -6.223394012174860e-02   +7.312184041635389e-01   +4.402103794540520e-01   -4.946969827827420e-01; +3.988785540172161e-01   +6.242713325144758e-01   -1.886595599209731e-01   -8.818768076972472e-01   -4.764402765873122e-01   +4.108375802332686e-01   +4.276577782779951e-01   -5.359928441413431e-01   -5.655374735403604e-02   -2.849393937427521e-01   +1.911922186869612e-01   -6.521358641382562e-02   +3.711124747316022e-01   +4.472209978122074e-01   +2.922757251831491e-01   -5.480909617776837e-01; -6.461292517284456e-02   +3.303078333597101e-01   +1.000000000000000e+00   -3.021694950054011e-01   +5.811755813486353e-02   -2.872389892914748e-01   +2.374881432176549e-01   -4.463993448161390e-01   +1.106541654456200e-01   -5.088051437938778e-01   -2.346594462752640e-01   -2.519348182668140e-01   -2.218892448388002e-01   -3.614244108426167e-01   -6.827085583770094e-01   +2.045935010816967e-01; -3.438548082146821e-01   -2.064543729666962e-02   +3.262057303336402e-01   +2.821343390321925e-01   -1.212728919310102e-01   +5.855381340772434e-01   -8.585400771948604e-02   -2.483173329227699e-01   +2.124983992667302e-01   +9.046938984164524e-02   +2.223565750450477e-01   -2.922976010589224e-01   +1.924745593589844e-01   -8.886859263919847e-02   -4.670120811403799e-01   -3.284679187832897e-01; +4.323709145062135e-01   +3.983129055063793e-01   -6.344094000726079e-01   +7.175763252497113e-01   +4.637676762946085e-01   +9.956935370754570e-02   -5.544948509302450e-02   -5.601885636031993e-02   +4.625090293102675e-01   +5.947145501963469e-01   +4.951770771617344e-01   -4.568461521136880e-01   +1.617408993482013e-01   +2.144588004361318e-01   +6.276152554232491e-01   -1.100879854594892e-01];
L2I_L2E_iAMPA_netcon = [+6.153571001796534e-01   +5.867536839811703e-01   -1.196134071237201e-01   -1.798764260232739e-01   +6.761574996079468e-01   +7.829079089558661e-01   +3.206252658182556e-01   -2.834176167597960e-01; +9.886749078855019e-01   +1.558996756007247e-01   +7.242511374594209e-02   -4.221613908853373e-01   +8.164855856580967e-01   -4.518016144825464e-01   -6.126460410997987e-01   -4.770598005141810e-01; -5.009712928685396e-01   -3.510787129844937e-01   -3.133506599418045e-01   +6.067554495378529e-01   -2.607705321101660e-01   -5.213920907203370e-02   +4.042714990221259e-01   +8.443701373538219e-01; +7.202067931708027e-02   -4.663603839496824e-01   +6.364622356559854e-01   +8.778088911960776e-02   +6.896549971994147e-01   +1.766293350539271e-01   -5.030979805106578e-01   +5.176061609085456e-01; -5.956202654563246e-01   +3.188021780686998e-01   -1.016962531889739e-01   -4.341180673200745e-01   -4.834161581242638e-01   -2.727448330111942e-01   +1.000000000000000e+00   +2.288870820393036e-01; +6.765662673240999e-02   -4.165158866748385e-01   +2.087108151600058e-01   -4.763598410427871e-01   -5.379549857202874e-01   +4.623723612448095e-01   +2.510848266332977e-01   -1.466726886706951e-01; -2.158641935810531e-01   +9.278494325770236e-01   +3.814347545722502e-01   -4.048685017877575e-01   +2.538162626904176e-01   +7.407455696040716e-01   +6.319550894680210e-01   -4.197623417118360e-01; +4.096147216962717e-01   -4.067348043433973e-01   -4.824777768024713e-01   +2.312213862198614e-01   -6.336182501517543e-01   -4.869049129852207e-01   -1.149472797915895e-01   -4.518946723427628e-01];
L2E_L2I_iGABA_netcon = [+7.647814617269515e-02   +6.790137998784722e-02   +8.692611560450664e-01   -1.104891063856339e-01   +3.733584325494776e-02   +3.075314236163447e-01   +4.122071255202075e-01   -7.682172483951283e-01; -4.755015715253251e-01   +8.350547796831439e-01   +4.971339476292225e-01   -1.757298295507760e-01   +3.644324572423990e-01   +6.700803856988458e-01   -5.466988454771233e-01   +7.277872947491870e-02; -4.469446024263342e-01   -2.899559316499146e-01   -7.577111345117818e-01   +6.984981667518345e-01   +7.123681315473233e-01   -1.295183709611982e-01   -4.162332581331069e-01   +5.703339503316046e-01; +2.724845625438753e-01   +5.792751236701246e-01   +2.353021297047134e-01   +8.377378676639283e-01   +4.821516915674343e-01   +7.220976424210472e-01   -3.289461907258509e-01   -4.133937269401716e-01; -3.460177423758924e-01   -9.946991760138708e-01   +3.966312619662073e-01   +2.645102677666964e-01   -6.774611248360470e-01   -3.638243561868012e-01   +1.762543929052386e-01   +9.282252619317578e-01; +5.423954753766194e-01   +7.731138473598528e-01   -5.856742580267037e-01   +3.760035113122395e-01   +1.096158928094923e-01   +6.846012229358585e-01   -4.042730619447682e-01   +1.000000000000000e+00; +7.709610294417627e-01   +8.258794851613264e-02   -8.498694008594739e-01   -4.847812217397138e-01   +3.024772868445659e-01   +7.617881772641394e-01   -3.533942885126021e-01   +6.257207679769904e-01; -3.726871980468398e-01   +6.049044501864268e-01   -3.349629508742963e-01   -6.669531435445114e-01   +6.120005966110005e-01   -2.003177039408255e-01   +6.414829151848770e-01   +2.951145271989525e-01];
L3E_L2E_iAMPA_netcon = [+4.101392385984346e-02   +5.710251681942322e-01   +4.018421166594867e-01   +6.901923464881703e-02   -5.705765746101326e-01   -3.006298577709959e-01   -5.938405395729811e-01   +6.430155153423562e-01   +4.215806933526369e-01   -4.073657215188107e-01   -5.848855589025782e-01   -4.566372432239969e-02; +4.989717139960375e-01   +8.903030387326571e-02   -2.469041286582624e-01   +5.038194889185288e-01   +5.211507023874754e-01   +7.682211673056861e-01   +7.956281032357097e-02   +3.044271168489863e-01   -7.134715034354486e-01   -2.356140109099064e-02   +6.664357542742696e-01   -2.073718898035828e-01; +1.284352222018115e-01   -2.974311531444535e-01   +7.701141940071179e-02   +2.061840760559677e-01   +4.985726148722279e-01   +4.619211290718210e-01   +7.390420725610130e-01   +6.096580954454089e-01   +7.199353998889101e-02   -5.495279654849607e-01   +5.273265003209622e-01   -4.639585202178456e-01; +1.193069146432798e-01   +4.321548734216858e-01   +1.000000000000000e+00   +5.894779210065176e-01   -2.056070158433912e-01   -8.478160048963941e-02   -9.119618066203587e-02   -1.446250221897374e-01   +7.818150731869367e-01   -2.730132983945491e-01   +3.782406501735385e-01   -2.473512345114005e-01; +6.065390268137091e-01   +1.949974151039812e-01   -6.825883724552517e-01   +2.097528094243268e-01   -7.409166143486557e-01   -1.008199283847513e-01   +5.056140531210709e-01   -2.681216826465259e-01   -3.089604122222747e-01   -5.274711889342848e-01   +4.722692287501171e-01   +7.710786249071623e-01; +8.028327790147882e-01   +2.359710798784436e-02   +5.495709085065330e-01   +6.342814595434471e-01   +6.475210043161841e-01   -2.228455414138979e-01   +5.078940868979863e-01   +5.087481721388809e-01   +1.840274730399977e-01   +6.789134580342624e-01   +1.459266077776667e-01   +3.463222392758804e-01; +5.441868681415374e-01   +6.258306929275110e-01   -1.439990152383455e-01   -3.417882946602524e-01   +7.190510610505710e-01   -5.887063520152491e-01   +2.701147861974308e-01   +7.743876991988327e-02   -5.876064578791010e-01   +4.859129859884266e-01   -1.516193611664328e-01   +5.151910248503338e-02; +9.879762929730497e-01   -7.451516877613901e-01   +6.327256733501675e-01   +1.081773709006729e-01   -5.755835561589100e-01   -2.095798189177540e-01   -5.841367254173539e-02   -1.309592147197999e-01   +2.110790095723082e-01   +1.759047613527659e-03   -2.196444762242750e-01   -1.012743269912052e-01];
L3I_L2I_iGABA_netcon = [+2.234035871172159e-01   +8.944437349237281e-01   -6.527213788669652e-01   -1.514634874435856e-01   +3.757108487406448e-01   +5.033655683747594e-01   -6.141092360830021e-01   -5.427107590470455e-01   +6.309123807297363e-01   +3.293013850970029e-01   -6.614505789171631e-01   +2.503013973715538e-01; +4.192741673341296e-01   -2.642297217886582e-01   +6.530935493471003e-01   -2.262381360168480e-01   +4.761944583980722e-01   +6.014958510347097e-01   +4.230400119058095e-01   -7.460343464506731e-01   +3.374847276298670e-01   +7.336291653432941e-01   -2.939198579232479e-01   +4.530308336025181e-01; +1.450601489697040e-01   +8.118712149266704e-01   +1.531928036997050e-02   +4.416441601790624e-01   -2.954582722736885e-01   -4.690619362787766e-01   -9.541122601708935e-02   +6.917209270497894e-01   +1.752745544779199e-01   -3.899884408045241e-01   -1.417009751248758e-01   -1.381672070322850e-01; +2.297647814321755e-01   +8.156633142412424e-01   +6.443518965066072e-01   -1.054138802551045e-01   -4.412323077489756e-01   +6.530992937126074e-01   -4.449898219968475e-02   +2.466638448220630e-01   +3.866105651058594e-01   +1.382941024424377e-01   +5.388322731972210e-01   -6.255009199925456e-01; +5.455061244694573e-01   +1.742039820435551e-01   +5.995379021792376e-01   -3.441194342661812e-01   -5.540456439412443e-01   +6.413631968792411e-01   -1.934762987684412e-01   +6.106105580466387e-01   +1.000000000000000e+00   +2.094542932899910e-01   -1.393182219576352e-01   +2.559534975374387e-01; +1.955632054543361e-01   +4.025926708237284e-01   -1.701176789456690e-01   -6.040871646010861e-01   -4.551839113285684e-01   +7.664011163286845e-01   +2.003498838798619e-01   +4.789101312350073e-01   +4.044268269358381e-01   +3.484258657366062e-01   +3.839588643251221e-01   +9.046522368209180e-01; +1.140941970351017e-01   -1.519544484201896e-01   -7.002176940750750e-02   +6.713003348272856e-01   +6.284071437106470e-01   +6.237890964177073e-01   +8.672952206725989e-01   +9.937803010579617e-01   +1.478512381020137e-01   +3.504795632462162e-01   -7.552630654797722e-01   +5.402638828392792e-01; +9.707577305959838e-03   -2.351777419780955e-01   +1.568458958099425e-01   -4.485277650170525e-01   -2.405971010623550e-01   +7.667947515527382e-01   -5.340011408628149e-01   -1.509331096405619e-01   -4.887294298711475e-02   -8.385383378977689e-01   +8.109344955330057e-01   +4.423550038613856e-02];
L2E_L3E_iAMPA_netcon = [-1.527367270282873e-01   -4.560131914550788e-01   +2.900624671757868e-01   -1.833079327705792e-01   +2.289897006017085e-01   -9.048445230880708e-02   +5.592663870506809e-01   +4.950325421222175e-01; +5.495355718250257e-01   +5.802251650645197e-01   -3.646618737118454e-01   -4.651709512958069e-01   +3.463192458662037e-01   +2.046938584611822e-01   -7.570817900352842e-01   +6.637531970394287e-01; +6.080132360399654e-01   -3.150152944204342e-01   -5.817104091806625e-01   +1.000000000000000e+00   -3.197282790708961e-01   +5.019367234831004e-01   +3.412655747895786e-01   +4.111384665409570e-01; +1.449234966161420e-01   -2.335992781476154e-01   -4.866909376921581e-01   -2.829731871279368e-01   +4.654865489465881e-01   -2.137808280209923e-01   +7.598985545020938e-02   -1.186608203379099e-01; -1.603594841149514e-01   +3.770960804861906e-01   -5.499902877026600e-01   +6.601893026094445e-01   +3.269506289777582e-01   +2.045114134778184e-01   +2.189671172776375e-01   +8.052138849862241e-01; +5.815821230382977e-02   +1.664914939967223e-01   -4.238359841482116e-01   -1.002283240215836e-02   +9.410243021385076e-02   -4.012473720091451e-01   +9.669882254558193e-02   +1.210998920709093e-02; -3.547116865473617e-02   -2.861414480229010e-01   -4.317132517562093e-01   -1.729435633792337e-01   -5.308522623857453e-02   -7.086416232318916e-01   +1.579570544589891e-01   -3.968181863471510e-01; -4.517119252237920e-01   -3.894400462716775e-01   +8.558447584515130e-01   -1.768974071400444e-01   +1.848941008203433e-01   +2.071016537457909e-01   -2.184168319489547e-01   +6.328820642893774e-01; +4.858986363194981e-01   +4.993886035873810e-01   +4.616995859789456e-01   -3.592035718045085e-01   +4.698629831315162e-01   -4.000131109532099e-01   +6.855992217020931e-01   +3.915406435555073e-01; +4.096701988709228e-01   +1.747267188675090e-01   +1.413897766511075e-01   -2.477415848431277e-01   -7.037930528188139e-01   -2.729871487317502e-01   +8.998742351049788e-02   -5.926552842618387e-01; +1.168842880476171e-01   -5.068607416839418e-01   -1.495548636527887e-01   +5.802641992079988e-01   -4.279341622362196e-02   +1.807896387187685e-01   -6.335642873457027e-01   +5.843548342610647e-02; -2.276991812616195e-01   +9.142025400181771e-01   +1.346509142518295e-01   +1.320173132190605e-01   -1.963989717830429e-01   +4.596252327440030e-01   +2.261991802415396e-01   -4.488479201028965e-01];
L2I_L3I_iGABA_netcon = [-1.870032920224442e-01   -7.154054957950264e-02   -5.176766891909418e-01   +7.358094278251549e-01   +1.944017542472006e-01   +1.402204564935656e-01   -3.266440258831237e-01   +3.240613668542576e-01; +7.416924760929190e-02   -8.279347786539509e-01   +8.375317440642819e-01   -2.144167709171695e-01   -4.057678432245895e-01   +1.762396522654626e-01   +1.481817478764203e-01   +2.271387187835413e-01; -1.967653327512550e-01   -1.370688887570680e-01   +5.158945055750611e-02   +7.515270211521421e-01   -8.040121065115131e-02   -5.211099620756124e-01   -5.667026998293740e-01   -8.002057595791751e-02; -3.248391879884620e-01   -2.874452037486988e-01   -3.177253094933946e-01   +5.839084363252396e-01   +5.793468864328443e-01   +4.476980987003026e-01   +6.397430393348947e-01   -3.079226848478688e-02; +1.248003127330858e-01   +4.636695157659165e-01   -4.230108193786076e-01   +9.221470312197783e-02   +1.280489040869333e-01   -4.472445596510961e-02   -4.942954500752028e-01   +2.583858718704750e-01; -6.019430036867807e-01   +8.536131725941860e-01   -3.690405927007627e-01   +3.992040026172591e-02   +1.000000000000000e+00   +3.518517497969311e-01   +8.763493363996122e-01   +3.444929381399791e-01; +4.342072820302205e-01   +1.320965240852018e-01   +2.832023068858310e-01   -3.843225477182701e-01   +7.534403148251478e-01   -7.887280292868674e-02   +3.230339325344088e-02   +1.787524103556485e-01; -2.999711833327884e-01   -3.603780921284272e-01   -4.435910205522308e-01   +7.513688587995758e-01   +9.171003602392472e-02   +8.825347312730204e-01   -4.503223961901208e-01   +1.075647856920699e-01; -2.952823509627339e-01   +7.630530702750064e-01   +4.083980494348014e-01   +6.222458515542728e-01   -7.133319866756036e-01   +8.767384250548381e-01   +8.884730547070756e-01   +3.264347900285662e-01; +6.298041980508571e-01   -8.603196285758423e-01   -2.168089370031746e-01   -2.443963191856637e-01   +4.185649829200331e-01   +2.439709514126820e-02   +5.275989750327298e-01   +1.947458423024782e-01; -2.728927515670783e-02   -3.554138192609597e-02   +5.081487100561516e-01   +5.102609655878382e-01   -7.269254946780813e-02   +7.016897027430985e-02   -2.744996127785879e-01   +9.735529801865785e-02; -5.020627436200645e-02   +4.600096230951921e-01   +5.699084898033390e-01   -1.476462473806794e-01   -4.748622943097362e-01   +2.547062216006051e-01   -7.782610494270929e-02   -1.411204345382665e-01];
L3I_L3E_iAMPA_netcon = [-2.336888063413011e-01   +4.864391537698509e-01   -4.770357184195649e-01   -5.955435814076968e-02   -7.810114159497478e-02   -2.410373838223713e-01   +3.399803975760445e-01   -1.225719992240122e-01   +7.381173680641759e-01   -5.119685487412603e-01   +1.526903190779536e-01   +2.129600432508654e-01; +5.355906330591618e-01   +1.000000000000000e+00   +5.430282625109982e-01   -6.846611178757063e-01   +3.671891859390991e-01   +8.168499304989359e-01   +4.554215474207856e-01   +3.784168157020962e-01   +2.209613308789693e-01   -5.018618091067737e-01   -6.721236199775892e-01   +4.906880725069396e-01; -6.374871729579448e-01   -2.709432591371123e-02   +1.466078472717772e-01   -2.880067543919044e-01   +8.782933406253058e-01   +6.921307921589828e-01   +6.474640921009452e-02   -2.795473538378604e-01   +8.884732754022638e-02   -4.021987733092242e-01   -3.572971589650918e-01   -1.303563324140038e-01; -1.738121391282121e-01   +3.142480085919015e-01   +9.339869199453898e-02   -7.964904011088024e-01   -6.958176354872135e-02   -5.972023358367999e-01   +6.364324826298301e-01   +1.405528598435475e-01   +9.611522655808101e-01   -3.800054674515837e-01   -2.941452462009650e-01   -5.610822944622250e-01; +5.981730141095963e-01   -6.978732282282109e-01   -5.585026701439734e-01   +4.833154502693394e-01   +6.082865999437318e-01   -2.517722906107489e-01   -6.587253167641602e-01   -2.018287029468323e-01   +1.204869702404298e-01   -4.338441081883733e-01   -4.479626740072663e-01   +2.665688206146054e-01; +5.573527801884917e-01   -7.320136576036809e-02   +6.506823864138981e-01   +5.080424303550588e-01   -4.621571742633257e-01   +7.612495032649855e-01   +3.659418422436838e-01   -1.659452208889134e-01   -9.262115272443425e-02   -4.489880885532540e-01   +3.960925041881925e-01   -1.391098958104840e-02; +5.554659038733494e-01   +2.729779991999599e-01   +2.451152989884697e-01   +4.706371955328379e-01   -5.170450354616500e-01   +3.487539104481171e-03   +4.873655280542717e-01   +8.110206656736557e-01   -2.350644486890541e-01   -4.441469543717047e-01   +2.314156249655466e-01   +6.058316520253776e-01; +2.674047486875832e-01   -4.413733256759219e-01   +4.323493419402143e-01   +8.142621824242309e-01   +8.779944146623948e-01   +4.734412297194652e-01   -3.191878680902026e-01   +3.222387372022661e-02   +2.648731087800273e-01   -4.913517648133181e-01   +7.765666889352923e-01   -5.382439229096757e-01; -3.219599289333556e-01   +9.150176837009713e-03   +4.969871636997762e-01   +6.698707090071092e-01   -3.205208061776330e-01   +5.530965583428100e-01   +7.008093408589906e-01   -3.367133705411325e-01   -3.652366799840616e-01   +7.621431718889954e-01   +5.106307927070816e-01   -2.114208902074400e-01; -5.987952254109756e-02   +7.040717624533801e-01   -3.338116196574608e-01   +3.190047433772118e-02   -7.968737887318921e-01   +5.190035301261291e-01   -8.042767376900761e-01   -1.004553951313898e-01   -1.890545142362692e-01   +5.759303844874850e-01   -3.833779690384287e-01   +4.291077891226640e-01; -2.186325739811404e-01   +4.365837753742091e-01   +4.774173626880332e-01   -2.745214718091906e-01   -1.997003260305895e-01   +3.392977903643745e-01   -3.432962731661905e-01   +5.798189018497306e-01   +3.893682249820542e-01   -1.569157602026783e-01   -6.215261380854635e-01   +9.393131939317302e-01; +1.219925257980016e-01   +6.400097827694519e-01   +4.344345589208852e-01   -5.461863264183994e-01   +5.542908771269932e-01   +6.271684141762568e-01   -3.188671460128214e-01   -3.739350028736864e-01   -4.567155311394942e-02   -6.733380259219147e-02   +6.597154717498305e-01   +3.310021712298565e-01];
L3E_L3I_iGABA_netcon = [+2.279879977171984e-01   -3.230732213687433e-01   -3.616135611255536e-01   +7.458435643691271e-01   -3.127311374315269e-01   -2.085936899001350e-01   +6.882048120632324e-01   +1.000000000000000e+00   -3.415763409551983e-01   -2.902028919053208e-01   +2.071155045703888e-02   -4.956887863452136e-01; -3.844476311659165e-02   -2.841023943932400e-01   -5.825310318271492e-01   +3.208365342142626e-01   -5.477812054782022e-01   +9.172807602211254e-01   +2.648246879337880e-01   -5.319452482373264e-01   +6.571953084023235e-02   +6.359419601359427e-01   +1.251938975099783e-01   -4.373306161242687e-02; -1.391426367124290e-01   -3.412075231689493e-01   +2.864454964606369e-01   +5.646179965041493e-01   +1.176343287544904e-01   +2.584736647614896e-01   -6.144091573670122e-01   +6.730072892599573e-02   +4.897732954612689e-01   -1.972468896241209e-01   -1.187672300589442e-01   -4.983743350921970e-01; +2.432585449448782e-01   +5.698509644815527e-01   -5.269232299149496e-01   -4.788421947139656e-01   -1.313810830401138e-01   +6.729257010459426e-01   -5.449407704553239e-01   -7.178998834660589e-01   +5.357437176670901e-03   -5.884881829285475e-01   +3.746166124280085e-02   -3.138100777950565e-01; -1.641436924972782e-01   -2.378186760407490e-01   -6.170145123564420e-01   +6.292103291237191e-01   -1.376718409768878e-01   -4.988122970634215e-01   -5.264067680380543e-01   -6.688996217477927e-01   -1.895609017063465e-01   -3.224603331295476e-01   -1.107874505440394e-01   -5.312348094711977e-01; -3.386849002179260e-01   -1.514089557409619e-01   +9.298612667306565e-01   -1.082305639673383e-01   +5.974153822847063e-01   +5.906424240949600e-01   +2.256400234785034e-01   +4.144690329859745e-02   -5.737565851559184e-01   -4.754848147838371e-01   -5.061611018760725e-01   +1.311298193714402e-01; -3.830801963142502e-01   +8.089681995280811e-01   +3.926005891722200e-01   +2.531186728306931e-01   +4.918984204178152e-01   +2.532478814794653e-01   +3.513393320369648e-01   +1.329778618719970e-01   -6.016187262094530e-01   +3.736124499255722e-01   -2.025249961227815e-01   -6.199892865315859e-01; -1.616694908973177e-01   -4.381871735969984e-01   +9.122635813704237e-01   -1.429623777389951e-01   +3.902988773684364e-01   +7.227252524853429e-01   -5.829980453625402e-01   +4.080145421583445e-01   +1.908798867526663e-01   +2.087147178027246e-01   -9.579295519193083e-01   -2.739763395051284e-02; +2.147781233977589e-01   -2.020096315477748e-01   -5.467165187982195e-01   +4.463508458092209e-01   +2.558968754299226e-01   -3.371358622866105e-01   +4.651632846080103e-01   +3.483999570428246e-01   -4.378960683008372e-01   -3.474334885060749e-01   +3.898193028794038e-02   -4.596729825337456e-01; -2.407304999475136e-01   -5.779021891154936e-02   -2.216072620698251e-01   -5.093249966740925e-01   -1.425171470789745e-01   +6.261839740590057e-02   +4.290218990332222e-02   +4.370237268030421e-01   +1.037709921077321e-01   +5.946957999498212e-01   -2.745056784714846e-01   -2.115893175576633e-01; -1.591115199824079e-01   -2.410469487070541e-02   +4.508708230960967e-03   +4.512408971887379e-01   -2.225172052944725e-01   -6.074818403682559e-01   -1.008197431258762e-01   -4.736715831787129e-01   +1.886270675002676e-01   -2.118131662994986e-01   +4.065709597499048e-02   +4.099707012456246e-01; +5.542065514838306e-01   -2.244418843779960e-01   +4.207569109243541e-01   +5.144918440557200e-01   -2.954881789915887e-01   -2.923934926803765e-01   -2.631948403781006e-01   -4.276756793908792e-01   -4.067161454750930e-01   +2.655947979271455e-01   +5.934357264820168e-01   +1.846648209546886e-01];
L2E_Input1_iAMPA_netcon = [-6.724177182821767e-01   +3.149621689301612e-01   +1.036825640443306e-01   -2.081612534711224e-01   +8.402930533504058e-01   -1.000000000000000e+00   -2.576353845847909e-01   -6.442297710606364e-01];
L2I_Input2_iAMPA_netcon = [+2.698629556823759e-01   -6.607202940615069e-01   +6.387872637172443e-04   -2.151073473861392e-01   +3.047657509927705e-01   -5.958568500586353e-01   -4.042893747327883e-01   -4.541254625823892e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.4*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 1.0*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 1.0*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.4*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 1.0*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 1.0*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
