function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+3.252904243667592e-01   +2.281979224928909e-01   +1.189194770412268e-01   +4.393879282669614e-01   +6.429170885339158e-01   +4.482267140757399e-01   +4.457723330949092e-01   -1.056547075848982e-01   +3.187152111051266e-01   +2.294364686882387e-02   +7.999564794173251e-01   +1.234170063672154e-01   +2.402571428060981e-01   +2.138234893967332e-01   -3.966688668705292e-01   -1.325841191689933e-01; +8.743715302338670e-01   +2.733469182461943e-01   -1.182278563645035e-01   +6.112248590029787e-01   +3.277654089689738e-01   -6.193949646336711e-02   +1.680036488283052e-01   -5.233958964662216e-01   -5.414127855577456e-01   -5.828333647202298e-02   -1.574055542587378e-01   -1.501475002901599e-01   -2.050457713322471e-01   +2.760641481383633e-01   +1.042207943723489e-01   +2.014239538498980e-01; -2.739371903910169e-02   -3.521568830458583e-01   +2.496033682175038e-02   -1.294759825628336e-01   +3.292135257045173e-01   +2.079185323086258e-01   +4.147279370814880e-01   +2.175044728342368e-01   -4.194091365051177e-01   -3.176412204289827e-01   -2.014227078918820e-01   -4.056709269656280e-01   -4.508270256284787e-02   +1.317270003435040e-02   +6.818115766901889e-01   -2.212797231698682e-01; +2.073346478957603e-01   -3.038141422372343e-02   +3.106287330374526e-01   +4.968513616788306e-01   +1.778489134060029e-01   -1.498627162249430e-01   +7.470835152044866e-01   -3.516958228658331e-01   +7.681518714352544e-01   +2.585809767225633e-01   +2.257379891980681e-01   -1.806719679252430e-01   +4.567426515703780e-01   -4.127063623348272e-01   -1.543842343502840e-01   +3.896639188966817e-01; +4.222472302052231e-01   +9.574173495596747e-02   +8.280552136381560e-02   +7.816722146094343e-01   +5.638004049363576e-01   +1.471375814857534e-02   -1.855080326713408e-01   +2.830830245004014e-01   +3.604344308590205e-01   +3.485699279678937e-01   +7.361403566933765e-02   -1.746379995983919e-01   +7.191023292841350e-01   +6.352707790574174e-01   +3.825018726127936e-01   +1.681176866007359e-01; +4.119419173764756e-01   +2.283738045253577e-01   +5.430010800103228e-02   -4.378898201471086e-02   -1.213365726544846e-01   -1.247708191199110e-01   -1.678460645358612e-02   -2.154404491620865e-02   +4.373458296787959e-01   +5.360651551198208e-01   +5.202982047758231e-01   -1.568975890139576e-01   +1.021690723453409e-01   -1.035815080834413e-01   +2.868794169267149e-01   -3.923273686500016e-01; +1.850481107356010e-01   +4.337115808136122e-01   -1.569713739993780e-01   -3.545312132509911e-01   -4.255017383549009e-02   +1.887837698318423e-01   -1.762514620031689e-01   +7.218735951973386e-01   -2.435879072138217e-01   -1.272920735238111e-01   +2.376604287294655e-01   -2.007005994851171e-02   +7.708436857980200e-02   +7.650666010161282e-01   +7.394718488888123e-01   +2.135569028116162e-01; +4.656412818835089e-02   +2.965237661917853e-01   +1.420658353411030e-01   +2.205897379570731e-01   +3.840340921983921e-02   +1.015359610015910e-02   +6.321148440105084e-01   -3.089637536815086e-01   +7.613348852971596e-02   +2.685250121217034e-02   +5.119258460172791e-01   -3.625650430212849e-01   -3.572376376077153e-01   +5.842684367136838e-01   +4.902595598778693e-01   +7.714379156311866e-03; -1.853112053668652e-01   -4.277035836698998e-01   -3.615371046274360e-02   +2.353165554247101e-01   +1.197830005029323e-01   +3.421409083353383e-01   +2.831333905371726e-01   -8.312774347649249e-02   +1.018391795512858e-02   +2.625491644814548e-01   -4.047140167423571e-01   -1.367313959999325e-01   +6.977942874437899e-01   +3.197747774070609e-01   -1.099039633961074e-01   +3.042605444795256e-01; +3.917735995575501e-01   +3.322848326567269e-01   +5.976561389420213e-02   +6.657583298065641e-01   -2.784102599471246e-01   +5.714400648157694e-01   -2.590952326874492e-01   +2.566331785988768e-02   +5.182358581976213e-02   -3.033901245614489e-02   -4.167459197878230e-02   +6.084721391200434e-02   +4.034097515997655e-01   +6.460344022190376e-01   +2.569561921906648e-01   +7.093608486727951e-01; +5.486886404211379e-01   -6.048196305366699e-01   +2.271414100584385e-01   +2.301012679808380e-01   +3.477461476518079e-01   -2.520231685151391e-01   -6.461045331331647e-02   +2.148649598301869e-01   +4.610420163011786e-02   +1.000000000000000e+00   +4.732229696757065e-01   +7.046005975006130e-01   +3.934429498719490e-01   -5.884920639667441e-01   -5.973312341572866e-02   -2.204897788983008e-01; +3.929090236341352e-01   +5.074740112480493e-01   +5.887716189085555e-02   +4.551450607417800e-01   -1.723721764163621e-01   +8.310897659788971e-02   -1.625406998466302e-01   -1.445124934325861e-01   +3.647183043632792e-01   +2.879740628371715e-01   +5.413420294350083e-01   +3.134658445159402e-01   +6.989812018627491e-01   -2.985431224074331e-01   +4.201914797888333e-01   +1.986583068873158e-01; +4.289818649270781e-01   +1.953436526211131e-01   +6.706318332614977e-01   -6.008598768445109e-02   +2.173199535297207e-02   +3.421656091015818e-01   +4.156732881417649e-01   +3.947662448962777e-01   +5.964546273243757e-01   -3.899427534501778e-01   +4.215867660645071e-01   +5.946533697439826e-01   +4.987359363656258e-01   -7.567035849209963e-02   +1.837362820121854e-01   +3.935013941784295e-02; +5.702421447762503e-01   -2.918488145350387e-01   +2.341989927772422e-01   +3.024217299148576e-01   -1.136551682306099e-01   +3.856029884981054e-01   +5.189279947982991e-01   +4.263567847226678e-01   -7.487758447368618e-01   +3.520944028032317e-01   +5.613140036936554e-01   -4.039905515041106e-02   +5.775292916431788e-02   +1.410370012775803e-01   +1.385700124162872e-01   -8.785388963290901e-02; +4.315312696407645e-01   -1.737639701558379e-01   +5.062277300740351e-02   +3.759986354254335e-01   -7.150172596592269e-02   +1.199980072301117e-01   -4.668363246981788e-01   -1.314678251354131e-01   -8.607056618414460e-02   -3.322740485704141e-01   +3.066297946839017e-02   +3.910275691811836e-01   -3.459506772590526e-03   +5.446321525407858e-01   +5.119917173280732e-02   -5.620622576124034e-01; +4.525345653876935e-02   +3.151837095888426e-01   -1.276720012217320e-01   +4.606084598865162e-01   +6.886412779922586e-01   +5.297604925431277e-01   +1.894591700216566e-01   +1.647811310968131e-01   +9.764648160709112e-02   +4.232008318511058e-01   +3.227626299086372e-01   +5.359335104235937e-01   -1.990201637714889e-02   +4.719943823478415e-01   +5.544368288638029e-01   +3.054065735126169e-01];
L1E_L1I_iGABA_netcon = [+8.437202511109902e-01   +4.323254175874257e-01   -1.189124804947569e-01   +2.739461072776513e-01   -9.338056642607179e-02   +7.365971601871587e-01   +4.098206070911100e-01   +3.667359901529750e-01   +2.156482282012913e-01   -4.659545401009211e-01   +3.515805436616061e-01   -2.341622676551485e-01   +1.348283034198949e-01   +5.758796557118480e-01   +3.131778485796801e-02   +5.760767649094199e-01; +2.768822220850233e-01   +3.327251998891114e-01   +4.816296999820515e-02   -2.216709805187747e-01   +3.783452535661839e-01   +3.282555177399340e-01   +1.818049839639140e-01   -1.495711300356028e-01   -3.272249495261211e-02   -3.420132298657534e-01   -1.481507184328480e-01   +3.974035928187539e-01   +7.407105707640584e-02   -2.872289651605427e-01   -4.767720524038965e-01   -1.346677388254179e-01; +3.728438608550405e-01   +5.642136442852631e-01   +2.333409698340300e-01   +5.134519782794134e-01   -8.639905370066592e-02   +4.339158391227525e-01   -1.680001490557864e-01   +4.778888353385262e-01   +1.592951619255077e-01   +4.303379075834546e-01   +1.670554533440562e-01   +2.696888863429726e-02   +6.079068957284328e-01   +6.334707626530626e-01   -1.568883991979450e-01   +4.445377769701274e-01; +8.421647561977590e-02   +1.000000000000000e+00   +6.968603173173918e-01   +2.862776487748833e-01   +8.737982402225463e-01   -4.521825595742072e-02   -1.047751049789414e-02   +6.118414573915114e-01   -5.838618215402478e-02   -1.086761460368505e-01   -2.510368195292045e-01   +2.009586061277630e-01   -3.695946690081061e-01   +1.701519376354533e-01   -1.127019556349031e-01   +3.257361896317025e-01; +1.582530646453439e-01   -1.693089238096465e-01   -5.396707809479271e-01   +7.573860516793191e-02   +2.067317692416549e-01   -1.142110906658614e-01   +3.715606618361779e-01   -3.174401895026319e-01   +9.756940059224857e-02   -6.315160185551590e-02   +1.401936508122635e-01   +4.046591996094571e-02   -5.259174895531863e-01   +4.061679640978008e-02   +3.256394174605175e-01   -7.622671389355770e-01; +5.645501454103764e-02   +1.800608623140066e-01   +2.088912576747523e-01   +4.927441673438306e-01   +2.428982855712601e-01   -3.241458843780539e-01   +7.896332425917447e-01   -2.332792405712955e-02   +4.139041904778508e-01   +1.503517089175425e-02   -1.741286166099734e-01   +4.927147485586593e-01   +3.602013970754107e-01   -6.224239864305394e-02   -6.521567036829555e-02   -3.771451506756594e-01; -3.068168118744783e-01   +2.307040006161830e-01   +2.513687332741989e-01   +8.729500419175873e-01   +4.959353689250023e-01   -3.557055817115637e-03   +2.690196091021256e-01   +2.161578201112675e-03   -4.177629899758303e-01   +1.105540523349336e-01   +2.662404435742776e-01   +4.453071143915280e-01   -1.962549404431951e-01   +7.109635714585095e-01   +2.028068210558185e-01   +2.019495712198633e-01; -1.101093440633870e-02   +5.414512451688044e-01   -1.781337050819933e-02   -3.748833428388012e-01   +2.370424710830589e-01   +3.270068365967718e-01   -4.187623131863102e-01   -8.027959224724705e-02   +3.177936604592844e-02   +5.094362357234199e-01   +3.968566644977302e-01   +1.397499998372279e-01   -1.412734641453086e-01   +1.650201547969280e-01   +5.152459958166282e-01   -4.386165729342320e-01; +1.815022534089265e-01   -1.425286125485786e-01   +8.036718615757711e-01   -2.129470734647947e-01   -2.213141082394465e-01   +1.510226170335892e-01   +7.993915319568161e-01   +3.036953565211839e-01   -6.268029173714733e-02   -6.410884367124078e-02   -5.069231401052878e-01   +1.954073360619433e-01   +5.869211789649729e-01   -2.445610581487406e-01   +6.405402152748327e-01   +6.581132498529604e-01; +2.546482488909485e-01   +6.631834354394353e-01   +6.726208475215868e-02   +2.202674988346932e-01   -1.077849083575153e-01   +6.195197618278786e-01   +3.887965419733774e-02   -1.530409180386166e-01   +1.313868890966168e-01   -1.948953528147023e-02   +6.857380216899280e-02   +7.334310854729448e-01   +1.009658387184432e-01   +2.234763850771829e-01   +3.755005410178926e-02   +1.732304085345097e-01; -4.664434778193904e-01   +2.781811725136960e-01   +5.307431849286867e-01   -5.020640426051735e-01   +3.740919497661124e-01   -1.115319183077080e-01   -3.519286026718734e-01   +1.208865626282847e-01   -3.590203258332209e-01   -1.740452538905852e-01   -3.828125969580757e-02   -7.475284646436749e-02   +5.029015681583823e-01   +4.818142080984530e-02   +4.303516836570442e-01   +3.274111012276588e-01; -5.759855391159983e-01   -3.709446308894728e-01   -1.204413537974733e-01   +1.996964465791581e-01   +1.890955180498093e-01   -1.182125165256370e-01   -1.021593106842703e-01   +1.628052277342623e-01   -5.664382122238800e-01   +2.267985158319325e-01   -6.039295462172255e-01   +2.340147930869114e-01   +4.268222080252589e-01   -1.856186307467828e-01   -4.406648317640487e-01   -4.269994426942694e-01; -4.272268242041096e-01   +3.031134414914604e-01   -7.107355854268210e-02   +1.737434700753609e-01   +1.101856206302947e-01   +7.220225091668908e-01   +8.695544411930917e-02   +8.334575699288725e-01   +1.259636859540826e-01   -3.317404813874425e-01   -1.052496427975921e-01   +2.205930563072920e-01   +4.823916882231555e-01   +3.712386757345275e-01   -5.250951590798701e-01   +1.742056405757716e-01; +4.214181361344558e-01   +1.447665189737468e-01   -5.164082881889507e-01   -1.109024820863413e-01   +7.747469707053263e-01   +4.785557058404656e-01   +8.263168111101620e-01   -2.991019652867568e-02   +5.382654546577954e-01   -1.649736724079528e-01   +2.366467744215898e-01   +2.237280567578156e-01   +2.249904455868716e-01   -3.142464123409180e-01   +7.303658854056093e-01   +2.967733697072465e-02; +4.131529676972232e-01   +5.498097629986369e-01   +3.249785060909855e-01   +3.890304209001989e-01   +8.229172166589983e-01   +3.214064421271025e-01   -5.692481404093627e-01   +1.096062802625610e-01   +9.335237180988091e-01   -2.983082398400901e-02   +7.379353246581875e-01   -2.599716047284438e-01   +4.713556424367832e-01   -2.410681877267890e-02   +2.409316132541678e-01   +1.267859065429917e-02; +3.101688962812246e-01   +4.528099857850986e-02   -1.254348450169303e-01   +2.655351970859590e-01   -5.977354442085075e-02   -1.049784835515442e-01   +2.453972970744276e-01   -1.527499059573509e-01   +1.819483291066223e-02   +8.325318657833344e-01   -4.029341886129721e-01   +9.618190768018366e-01   +6.128754882537202e-01   -1.448914402396756e-01   -4.618976434162759e-01   +5.436769246852399e-01];
L2I_L1I_iGABA_netcon = [+5.366398621987819e-01   +1.937303339158774e-01   +4.134848403493502e-01   +1.955770714993867e-01   +2.851027109571179e-01   -4.520764277334998e-01   +7.085155075567882e-01   +4.835098428912124e-01; +2.219747004428768e-01   +4.536918341399052e-03   +4.289311669552164e-01   +2.636778409564018e-01   +3.663330262767978e-03   +7.072123992890984e-02   -2.500611929387151e-01   +5.366522888558181e-02; +7.137991783644082e-01   -3.083538001384781e-02   -3.690973488554404e-01   -4.240942793740665e-02   -4.930431122916556e-01   +4.754934294196680e-02   -1.462792562211991e-01   +4.903065523235162e-01; +5.118191958797619e-01   +6.570580641863503e-01   +2.540366540244287e-01   +2.693590319676764e-01   +1.313924646324467e-01   +2.858262854761791e-01   +6.073244791692780e-01   +6.757252615930960e-01; -3.289756853999452e-01   +3.611853516074065e-01   +1.371693001807343e-01   -5.738925701141631e-01   +5.611586212431221e-01   -3.599362015758105e-01   +4.793774043090540e-03   +1.867951680339131e-01; -3.838195073023159e-01   +2.474878125393288e-01   +3.567649804894207e-01   -3.841115897621507e-01   +8.023633705205580e-01   +1.000000000000000e+00   -1.953426258810678e-01   +8.325977880572906e-01; -4.659839096208367e-02   -1.983047315222283e-01   +1.718161029142088e-01   +3.077909952987840e-01   +1.297088604032664e-01   +7.419442963373839e-02   +2.395158715811536e-01   -2.002797769829789e-01; +1.296594384520921e-01   +2.121760251622506e-01   +1.767090933867662e-01   +6.577510218661052e-01   +5.268810410439188e-01   -2.575428905252738e-01   +4.096157020583355e-01   -4.171724402331779e-01; -1.661682605710268e-01   +2.684449453339224e-01   +4.600980422071027e-01   -4.316274640887223e-02   +3.063502986947313e-02   -5.578721231594457e-01   +5.889592607684496e-02   -4.086936081296302e-01; +7.562233114836073e-03   -8.363563563203175e-02   +3.902213270710695e-01   +3.820721850812201e-01   -8.575937197245764e-02   +6.031587265195869e-01   +1.171189066120780e-01   +6.970078585284192e-01; +2.307264319064372e-01   -1.722498444498142e-01   +3.263715844663292e-01   +5.807142141870337e-01   -1.858497641933547e-01   +3.839460833600431e-01   -3.248396313736891e-01   -2.002847861751952e-02; +2.585011711570498e-01   +1.731872553677001e-01   +2.523291559125487e-02   -2.173543165684065e-01   -4.503772337079177e-01   +1.303817727398736e-01   -2.768090346983186e-01   -1.316761497878523e-01; +3.375394094401509e-01   -5.888535177926261e-02   -2.393182555928016e-01   +1.488425908388825e-01   +7.060674402838077e-01   -1.220330797893076e-01   -1.566982277186687e-01   -3.547344393277457e-01; -1.804421184609542e-01   +2.057970251853212e-01   -2.244493010660079e-02   +2.126592238026954e-01   +3.914842187609450e-01   +3.142909260360899e-01   +3.322747971000918e-01   +3.442735351518861e-01; +7.422340954894532e-01   +1.090675766248225e-01   +2.746399275517244e-01   +3.786817473799203e-01   -3.693393228002245e-02   +8.311494009765037e-01   +3.101227591908271e-01   +6.031697869880968e-01; +4.266254796126880e-01   -1.590742673978151e-01   +1.355312379544771e-01   +2.480662200446404e-01   +5.226487432487958e-01   +1.806337646994357e-01   -5.551178640804835e-01   -1.353540507485954e-01];
L1I_L2I_iGABA_netcon = [+5.698405844142496e-01   -2.004381016969720e-01   +6.671635547653755e-02   +6.699294525904298e-01   +1.720057329035170e-01   +4.966721991524151e-01   +5.319740653701849e-01   -4.262993333056820e-01   -6.338310249059786e-02   -3.904063058700296e-02   +5.490830566767229e-01   +4.386006474063783e-01   +1.658057787756644e-01   +7.553187024590631e-01   +5.425705362912054e-01   -5.576795930382731e-01; -4.223698580648199e-01   -3.754790385450910e-02   +8.901699829373548e-01   +9.185234388318868e-01   +2.672095989985361e-01   +5.101939704626061e-01   +9.269491258046862e-01   +3.102833125285239e-01   +3.826085385356479e-01   +7.526686546341544e-01   +3.800801222152957e-01   +5.484210874854405e-02   +3.007072665321012e-01   +3.321699028510862e-04   +2.109849711979736e-01   -2.681791468355496e-01; +2.049553307613619e-01   +7.822629554981900e-01   +9.227561404663501e-01   -5.508902223958456e-02   +3.847464391460294e-01   +4.672972519323438e-01   +1.663196704975627e-01   +4.544811020855423e-01   +7.980459478110337e-01   +4.213283225468335e-01   -3.585477077615855e-01   +6.184512095889433e-01   -2.690104440165963e-01   +1.381913953859737e-01   +5.495079027149440e-01   +2.817220798251795e-01; +3.820106331966877e-03   -2.369694246594207e-02   -3.189896664958089e-01   -4.227039570684563e-01   -2.898483285667479e-01   +8.398933721644415e-02   -1.128464918601392e-01   -4.305343753593668e-02   +3.220173595884904e-01   +7.986900832055039e-01   +2.621476100112375e-01   +3.668086600585289e-01   +9.625402307076245e-01   -1.614483157137271e-01   +1.078517658847400e-02   +6.324867668369617e-02; +6.961758907924885e-02   +3.886159234021431e-01   +3.340535645041739e-01   +3.857287263660472e-01   +1.816548760756422e-01   +7.661034518078323e-01   -2.971937376676013e-01   +2.132956902954713e-01   +3.345054015423139e-01   +2.151653551968253e-01   -6.482888484362600e-01   +1.652685249383129e-01   +3.547962039268413e-01   -2.475062938666064e-02   +3.158352798446587e-01   -5.232583317200935e-01; -1.851929608889594e-01   +1.692487223792871e-01   +4.533795377327571e-01   +2.635765076785134e-01   +9.513406244261076e-02   -5.300153731760127e-01   +8.167800735190860e-01   +4.754679974544360e-01   -2.899708319337546e-01   -3.900095321383533e-01   +1.881502714160069e-01   -1.434549966805750e-01   +5.914082757413262e-02   -2.512874032906168e-01   +2.373188873443278e-03   +7.161754093302169e-01; +3.725622312835500e-01   +3.973787469366841e-01   -3.840043812366851e-01   -1.848319703441820e-01   +1.178086859145132e-02   +3.635366334823922e-01   -6.013670676653698e-01   +3.503186205363877e-01   +6.033929864354314e-01   +2.739277697218978e-01   +5.305766367832105e-01   +5.443090657207832e-01   +4.482481562111395e-01   -2.881524376573063e-01   +6.137282972371608e-01   -1.520207229314991e-01; -5.176583613850435e-01   +4.912341593525645e-02   +1.350704598542725e-01   -2.736914939927023e-01   +1.338701739369028e-01   -2.977235826534655e-01   +6.700396545840399e-02   +7.647751060509648e-01   -1.224388943890234e-01   +2.890812721399035e-01   +1.000000000000000e+00   +4.231124230224115e-01   +1.245809047294016e-01   +9.941082284029420e-01   +2.848934164865212e-01   +3.083166640013371e-01];
L2E_L1E_iAMPA_netcon = [+5.136008147528038e-01   +1.076334510233719e-01   +3.497955358042347e-01   +4.777227900178158e-01   -5.274081203575580e-03   -2.828637542598736e-01   -1.452220899700556e-01   +8.974147840567406e-02; -2.930775806316525e-01   +3.111218524006198e-01   -2.666309592200656e-01   -7.659223650267064e-03   +5.028362044680327e-01   +3.245173553771481e-01   +3.200892668589128e-01   +2.592036255436849e-01; +4.292004996061313e-02   -1.131993849994801e-01   +6.259211115727960e-02   +5.342968694775653e-01   +8.543754846309172e-02   +3.564436632761462e-01   -2.049803540982479e-01   +2.221548602641468e-01; +6.967029945249504e-01   +1.943008227731323e-01   -1.889688204373250e-01   -7.497568636265299e-02   +8.751654448006070e-01   +7.125660097584101e-02   -1.279059867099563e-01   +3.701902521921314e-01; +6.176799757330205e-01   +2.945105411266232e-01   +3.115898140724580e-01   +3.716981296655431e-01   +3.080303237429530e-01   +8.230159651682194e-01   +6.744328123895695e-01   -3.887562797203837e-01; +5.068711305783761e-01   +1.104646827386452e-01   -1.668290275769351e-01   +4.772245098651350e-01   -1.700261656563792e-01   -6.756262733820652e-02   -3.352331105126340e-02   +4.293722559503057e-01; +3.612125869142349e-01   -2.722981493684530e-01   -4.030296253115426e-01   -1.647266123718278e-02   +5.987306061107705e-02   +2.168067277090859e-01   +1.841393541018436e-01   +1.115524773183038e-01; +6.048131454266612e-01   +2.023855727902695e-01   -9.260457614406833e-02   +6.762072321253590e-02   +1.223052910466262e-01   -3.633325044567537e-01   +5.670737218226878e-02   -1.304796102123895e-01; -5.840888042104518e-02   +4.446166536897564e-01   -3.078882284960331e-01   -3.734079535823084e-02   +4.787559155202354e-01   +2.005175262952841e-01   -1.361673547014328e-01   +8.737088754970661e-01; +6.049154065483261e-01   +1.749472310353346e-01   +5.130044672406577e-01   +2.038656831465669e-01   +7.840825255757395e-01   +6.278347430745687e-01   +5.467478034993369e-01   +4.136735280352093e-01; -2.244500979431303e-01   -1.486745766107826e-01   -9.426366360998525e-02   +2.720651926547919e-01   -9.983172924201695e-04   +1.536354536430215e-01   +2.346538097194634e-01   +7.223043762962071e-02; +3.790003601699714e-02   +1.816684752394697e-01   +8.328305819641695e-01   +6.811364760098785e-01   +3.198124722813838e-01   -9.906810706602692e-02   +1.343783139335359e-01   +4.611025510770098e-01; -2.302542484252716e-01   +3.202623797490251e-01   -4.034921131374773e-01   -7.739901484390332e-02   +3.465916897748368e-01   -1.196099280359487e-01   +1.000000000000000e+00   -8.465731720513422e-03; -5.140693722179383e-02   -3.677284310331013e-01   -7.685884943304318e-02   -3.799571001761248e-01   +5.736017641535580e-02   +4.259579964495174e-01   +3.663739920226667e-01   -6.531427978098688e-01; -1.430151359897311e-01   +5.002397144247476e-01   +5.424835938482744e-02   +4.839754239600572e-01   -2.169529076164800e-01   +5.486138775719649e-01   +2.229545447254951e-01   +4.119602974617769e-01; -1.412573962980779e-02   +1.848210762868833e-01   +1.286417495767057e-01   +2.863436980483752e-01   +1.821870334611022e-01   -3.206522184757497e-01   -4.826177176085314e-01   +8.836917163364535e-02];
L1E_L2E_iAMPA_netcon = [+5.527459982211035e-02   +3.977304282041746e-02   +6.978423859208520e-01   +2.809127216069243e-01   +2.660880778129361e-01   -1.826086909751273e-02   +2.846009462015248e-01   +2.299287345795308e-01   -1.173636043850424e-01   +1.249730180288534e-01   -5.737455159267987e-01   -5.701770084312636e-01   -3.162387178525121e-02   +4.472428147577138e-01   +6.692266205187252e-01   +7.875541035137873e-01; +4.376124024509706e-01   -4.902523424933020e-01   +2.821245938956477e-02   -6.956562043289694e-01   +9.166422961427115e-02   -6.807072714139261e-01   +9.220606357426049e-02   -1.538977083400477e-01   +4.735575271619973e-01   +4.182088559031587e-01   +3.694416781478084e-01   -3.308617360693167e-01   +1.948611103025394e-02   +2.993049684693878e-01   +2.330899836974211e-01   +7.668270499197206e-01; -3.416671302597602e-01   +7.762901510023719e-01   +5.330181086365332e-01   +2.747760922519501e-01   +9.514781956191884e-01   -1.643496932019376e-01   +7.444082188859860e-01   +5.301983341841402e-01   +8.600199451862807e-02   -1.128398190767487e-01   +2.446575194579432e-01   +4.428287566163795e-01   +7.746238281913658e-01   +1.204941728729828e-01   +5.778787988180515e-01   +3.488878496426908e-01; +7.087552873295380e-01   +8.123111312870060e-01   +1.397874105078784e-01   +1.000000000000000e+00   -1.192075637187298e-01   +8.504240404879797e-01   +4.422819140466547e-01   -6.132138790508013e-01   -9.743830596521737e-02   -1.941948962334139e-01   -3.434390435360295e-01   +1.481123733722530e-01   +2.570927478892622e-02   -2.289682315964919e-01   +1.113373947768854e-01   +8.368732794562443e-02; -1.775387998577151e-02   +4.201797896173521e-01   +3.094734626907256e-01   +5.772721204697949e-01   -5.134609290262956e-01   +3.219825430963479e-01   +8.421158196780514e-02   +2.814654100983935e-01   -6.234431232443309e-02   +1.436713286918553e-01   +1.795388791045809e-01   +2.631414920318350e-01   -2.970512503711710e-01   +3.823237655291863e-01   +3.412399263773790e-02   -2.758781090520615e-01; +3.023591790650400e-01   -5.226252277124176e-01   +5.059989871173411e-01   -1.792834004129427e-01   -1.825659551179359e-01   -6.591302418137672e-02   -4.162117870556634e-01   +5.314515133962646e-01   -1.064983605621973e-01   +1.770009870197435e-01   +1.576821405779476e-01   +6.430361673500270e-01   +7.282387225296255e-01   +1.611097122310013e-01   -1.300954803768931e-01   -4.471162540804595e-01; +3.501317557714196e-01   +3.930235280834828e-02   +1.476866310269191e-01   -4.018777017320951e-02   -4.356930239475783e-01   +3.836650217289982e-01   -4.178602730812341e-02   -3.297572753766759e-01   -4.051318317836517e-02   +1.969097080283060e-01   +3.358950960935297e-01   +6.331807712621221e-01   +9.095463147948268e-02   -7.788233640592547e-02   +7.026003120287477e-01   +1.695783787660503e-01; +4.048428572160380e-01   +7.567145910586414e-01   +6.445907255627192e-01   +3.587664888167432e-01   +4.515947652869153e-02   +3.638796491446226e-01   +1.704250721577482e-02   +9.291819386593320e-02   +4.282297774346285e-01   +7.204311932189496e-02   +5.156230684094723e-01   -4.490402713833851e-01   -2.078697723395908e-01   +3.694041914296708e-01   +5.529866101585228e-01   +4.583385571357203e-01];
L2I_L2E_iAMPA_netcon = [+2.805428273700458e-02   +6.170761676635516e-01   -2.161314540589059e-01   -7.149365830925416e-01   -4.349163702020272e-01   +5.016589362419903e-01   -5.898552361024419e-02   +1.501917217143330e-01; +8.411306499126040e-01   +3.613606238729626e-01   +7.204657809979809e-02   +3.218296673038716e-01   +7.873396692153288e-01   +7.238216724699429e-01   +8.533999167419507e-01   +9.981761026415842e-02; +1.000000000000000e+00   +5.771946917803517e-01   +2.679724900331867e-01   +3.419419494838430e-01   +6.623300423331250e-01   +2.106622763466210e-03   +1.956762317166363e-01   -1.667428290193755e-01; +8.117122970797355e-02   +6.250111532129757e-01   -1.064060725453820e-01   -2.270752655242477e-01   -1.635138024019950e-01   +5.650440881757262e-01   +5.216470520909935e-01   -5.662917098636879e-01; +6.424623766314704e-01   +8.461344515277815e-02   -3.609990672254487e-01   +7.802635356096134e-01   +5.175661350642698e-01   +2.410893266817185e-01   +9.346019346040142e-02   +8.562607716152826e-01; -2.446592084456118e-01   +8.164466842024480e-02   +4.102208773605119e-01   +1.983654559964667e-01   -4.583375172705821e-01   -3.428599305209399e-02   +9.319829993261646e-01   -2.905487579052572e-01; +1.377808830491951e-01   -1.593615954785274e-01   +5.449801025911644e-01   +2.697167075054064e-01   +6.867778573357337e-01   +7.962925808601454e-01   -3.799205155836163e-01   +6.015984868282744e-02; -1.387478595486001e-01   +4.220490515487237e-01   +1.590539278294712e-01   -2.252103221817622e-01   +4.423467758021805e-02   +1.268541608420466e-01   +1.156015490873937e-01   -2.546185914641019e-01];
L2E_L2I_iGABA_netcon = [+4.628275739528078e-01   +1.280738303938301e-01   +2.973598621621087e-01   -1.645495748614629e-01   +2.684452380302520e-01   -4.696785931228822e-01   +8.259231529167705e-01   +6.411721498210093e-01; +1.802069131440388e-01   -1.424739148776495e-01   +1.393420205400563e-01   +2.170958036176541e-02   -2.028281746697399e-01   +1.195620872939721e-01   +3.024479796609912e-01   +2.724212069132957e-01; +6.392818101770854e-01   +5.553329596827864e-01   +9.376632353653100e-02   +3.715612340365985e-01   +2.439989564513304e-01   -3.941121942225138e-01   +3.995841118579200e-01   +5.586759168990910e-02; +1.057932921381870e-01   -2.016186171805555e-01   -1.463141161558960e-01   +2.155067857273728e-02   +5.713285777527585e-01   +2.475015308080630e-01   +3.912249091186100e-01   +4.819693126532520e-02; +4.028091844916154e-01   +2.036957563439361e-01   -5.286278717416584e-01   +5.647046360192788e-02   +4.330650847279068e-01   -1.773357507384593e-01   -1.374656201643495e-02   +6.772933929688890e-01; +6.187580046022043e-01   +2.963387663058580e-02   +2.197070028198094e-01   -6.548806659370908e-02   -3.481805426667802e-01   -6.071020190936918e-01   -1.173665081810412e-01   +5.574347309598720e-02; +3.796534766857793e-01   +1.100990423677995e-01   -1.158478376316869e-01   -1.468077655986935e-01   +2.693035925858065e-01   +1.966700914049773e-01   -4.376342384794735e-01   -2.000328176822428e-01; -1.999588937777932e-01   +4.428654258697725e-01   +4.911847690630627e-01   +6.182668931135109e-02   +1.000000000000000e+00   +7.074179682456926e-01   +2.791114293553538e-01   +8.930905691803401e-01];
L3E_L2E_iAMPA_netcon = [-5.544647200027458e-01   +2.366550221496035e-01   +7.499796729822290e-01   -2.107659685231018e-01   -3.580681097077217e-02   +4.835619142318852e-01   -6.928161073867110e-01   +2.762654235457565e-02   -1.868784788563512e-01   -3.728907310686642e-01   +8.032971467257732e-02   +2.655589341736433e-01; -2.466632654881729e-01   +3.018445487364247e-02   -7.629388244170122e-02   +8.633376288283716e-02   +2.722441711344766e-01   +7.605382432910148e-01   +4.287813266709627e-01   +3.985767672079487e-01   +1.868760619104213e-01   +1.948843541501919e-01   -2.750008011262378e-01   -3.121216085821903e-01; +3.603821649442111e-01   +1.303581941537631e-01   +6.890164485789869e-01   +3.962282689932900e-01   +4.497475908108928e-01   -2.322130856594240e-02   -1.046841267283898e-01   +9.944053959775766e-01   +7.665609003636937e-01   -3.395477163863526e-01   +7.338170599702056e-01   -1.589871258853189e-02; +9.890501933203474e-01   +4.474849167396077e-01   +6.763685930745520e-01   +3.011115097726683e-01   -6.457324892809869e-04   +2.672373255415004e-02   +8.506855867197054e-01   +4.604176385556164e-01   +3.793639136648695e-01   +5.732814993573205e-01   +6.554667176464242e-01   +3.485736872931900e-01; +1.365917586790834e-01   +5.191304546432053e-01   -2.293333375012645e-01   +4.984585284439165e-01   +5.151794981362544e-01   -3.200459000899326e-01   +5.038212459695703e-01   +1.114834211917826e-01   +1.307921663254696e-01   -5.100423476779250e-01   -5.778755447165301e-01   +7.330229774885482e-01; -3.603041317648001e-01   +4.058690207125958e-01   -1.517911055904534e-01   -6.138335264417574e-02   +9.587011742378396e-02   +4.872691890558268e-01   +7.387310030729565e-01   -1.918446328117035e-01   +6.681438148122513e-01   -4.161162822775431e-01   -4.918838895548080e-01   +4.183477322507450e-01; +6.603203425849609e-02   +7.428206460356760e-01   +6.469169850318093e-01   +3.373343583830976e-01   -1.740619411609013e-01   +5.601339917639121e-01   +6.299064452263640e-01   +7.436211495241026e-01   +6.408371086509713e-01   +2.301767096238241e-01   +7.411475700788982e-01   +4.319182942265140e-01; +1.962123384068850e-01   +4.899068275652667e-01   +4.305303566706171e-01   +7.420246086360160e-02   +1.000000000000000e+00   +9.946116470017226e-01   +4.860627861968014e-01   +4.013905454549845e-01   +5.175470738612975e-01   -1.640516586699021e-02   +2.801553528644359e-01   -3.554753944893763e-01];
L3I_L2I_iGABA_netcon = [+1.109306682934255e-01   -2.249692006701382e-01   +2.243545514439871e-01   +2.187993948281198e-01   +1.952338105051352e-01   -1.550117059911791e-01   -3.997013335867102e-01   +6.374887611428529e-01   -2.340418368953299e-01   +7.065435388459701e-01   +7.447448163165231e-02   +2.468226620740088e-01; +1.732072724166553e-01   +9.691387686268403e-01   +2.815095024449220e-01   -1.212384465814041e-01   +8.673545890897355e-01   +7.424569599353404e-01   +6.013205089528928e-01   -7.100498352119960e-02   -5.166676258442899e-01   +2.967834299733038e-01   -9.417430586932359e-02   +1.540473977293644e-01; +1.029509860531484e-01   +1.000000000000000e+00   -1.882819839538914e-01   -1.407127680611832e-01   +5.596539839618243e-01   +1.810029297555632e-01   +9.855053381433903e-01   -3.986429651647869e-01   -2.264719635977400e-02   +3.692187370739776e-01   +4.354091681733568e-01   -4.431071419988034e-02; +4.038288727405325e-01   +1.653102009339336e-01   -1.545674403907929e-01   +5.843241472251777e-01   +3.502486349598958e-01   +1.453897136183572e-01   +9.819296540004099e-01   +7.424669617119802e-02   -1.284038463643362e-01   +4.738809753411697e-01   +8.675810122274362e-01   -2.839854749613917e-01; +1.389055489828597e-01   -5.427349779302137e-02   +5.375665215522402e-01   -4.502395545077770e-02   -2.252760465361039e-01   -5.758059657609493e-02   -1.299032318525207e-01   +4.438910865138974e-01   +1.539007867013665e-01   +2.453777955294144e-01   +1.394642991410446e-01   +4.725316054732916e-01; +8.296111912678427e-01   -6.412130977871486e-01   -4.788832763554444e-01   +4.613324332651805e-02   +5.898264150685213e-01   +4.234683427543793e-01   +7.501045202216781e-02   +3.306258302181776e-02   +5.952845205276023e-01   +1.318188212938165e-01   -1.304963220411371e-01   -2.804911757735615e-01; +1.671199942684342e-01   -3.991644404987775e-01   +5.562845335194403e-01   -5.279511958887121e-01   +5.075460183353044e-01   +3.291301498775062e-01   +6.473720468266090e-01   +6.643826080568476e-01   +1.709972551223050e-01   +2.177871325555653e-01   +1.197735329869318e-01   -1.426092507125406e-01; +2.312074234506154e-01   -8.383322254384366e-02   -1.544785951479793e-01   +1.863634832875547e-01   -6.291961716678747e-02   +5.347123573284345e-01   +4.625839155311443e-01   +3.881561878434415e-01   -2.138830555310047e-01   +4.837327027745595e-01   -6.745809230620833e-03   +2.470480030725143e-01];
L2E_L3E_iAMPA_netcon = [+3.164629589007147e-01   +5.500603531317547e-01   -3.105084650277559e-01   +5.139496193238491e-01   +4.439816730975145e-01   +1.799342094442067e-01   -1.151040363963022e-02   +7.669283602816275e-01; +1.034401899918783e-02   +2.608826667975322e-01   +6.247914200848981e-01   -8.219112045943672e-02   -4.007084240180983e-01   +2.785851538840201e-01   -5.105279014368933e-01   +4.046160878014501e-02; +4.061027513972187e-01   +3.776348035069585e-01   +7.686398749797526e-01   +2.280836777004165e-01   -1.229676825058326e-01   +5.293139948643266e-01   -5.102580936975076e-03   +6.678377893506577e-01; +2.863056138147053e-02   +4.754204739938988e-01   +6.909063780866138e-01   +6.297169947059793e-02   -1.003866663045104e-01   +6.126597258865313e-01   +4.371677439899515e-01   +1.733710297489455e-02; -7.070540372279408e-01   +5.117683626819333e-01   +2.804144308494079e-01   -1.321680972820670e-02   -1.176838495165935e-01   -3.685729037827343e-01   -1.306079445914797e-01   +7.296633430033063e-01; -3.087145312381699e-01   -3.390213377508400e-02   +3.920246035886905e-02   +3.991007392349350e-03   +5.850094157360614e-01   +1.170243853977960e-01   +4.959518558382953e-02   +4.650418193317833e-01; +6.074697442392629e-01   -1.728324719406255e-02   +1.791258003727824e-01   +5.898470249561352e-01   -3.888607276022878e-01   +7.929757531952383e-02   +2.989293126843117e-01   +1.000000000000000e+00; +1.110346279340042e-01   +7.741039073980446e-01   +3.174959756608038e-01   +1.717888262048400e-01   +4.395126113285363e-01   +4.648444594796356e-02   -2.335695175172804e-01   +4.678379635704668e-01; -2.155676794464081e-01   -4.869329651375370e-02   +5.645555022042906e-01   -4.502177615584875e-02   -1.627618441104665e-02   +6.554002561267360e-01   -1.240458915662366e-01   -2.756766908082331e-01; +7.137379989652136e-02   +4.866318019080381e-01   +1.228564932664801e-01   -4.725358537236402e-01   +7.579049225572884e-02   +4.026024029247436e-01   +8.610774974567167e-01   -2.806864954226866e-01; -4.706354629628913e-01   -1.254128328382679e-01   +1.569231392358096e-01   +5.326115856174755e-01   -7.105146120008660e-02   +6.903442635840989e-02   -1.123232822993885e-01   -8.646793421435310e-02; +4.552739007760880e-02   -3.515249267560575e-01   -2.849202413612147e-01   +5.310572679406713e-01   -1.070297574530613e-01   -9.326796679122819e-03   +3.929163518539848e-02   -1.831978456353124e-01];
L2I_L3I_iGABA_netcon = [+2.096246213943220e-01   -9.311720800041642e-02   +4.046411336782378e-01   -5.616725953059573e-02   +1.761786791962332e-01   -5.257604137767703e-02   +1.460938440207870e-01   +8.962715317771656e-01; -4.865175825751943e-02   -4.410107011677077e-01   -1.441683764730921e-01   +3.922536934636836e-01   -2.465359486734253e-01   +1.517067591150868e-01   -4.385099463140674e-02   +1.761617788439834e-01; +4.064781014897732e-01   +4.570022135328179e-01   -1.296621143640958e-02   +8.873884758908865e-01   +5.874813935538495e-01   +4.569769428325910e-02   +2.869312240257057e-01   +6.570163440097793e-02; +6.630184160315243e-01   +1.185487413688679e-01   +4.645943654344049e-01   +1.761537192524765e-01   +6.289613667833992e-01   -9.747081779666501e-02   +5.487727043771897e-01   -1.001134466431100e-03; +7.789187547621248e-01   +2.908914925444704e-01   +8.346016219087442e-01   +3.771179492596118e-01   +9.906922983772976e-01   +5.882326814136220e-02   +2.441490528617409e-01   +6.817365098422026e-01; +5.493604132146924e-01   +2.563295915517182e-01   -2.250197356050598e-01   +7.805518170704969e-01   -2.971291388587860e-02   +2.702057677926757e-01   +3.766118110015444e-01   -1.478039361069591e-01; +7.398327708637298e-01   +3.771355643556143e-01   +3.942632746807054e-01   +8.359727534932326e-02   +1.123733305365938e-01   +3.473240324035870e-01   -6.374892878494655e-01   +1.095586520501854e-01; -2.137754008948671e-01   +4.375631678704778e-01   +2.798415477769288e-01   +2.614528874984647e-01   +1.967148411543646e-01   +7.811466393127288e-01   -6.929243070009333e-02   -1.834722400571347e-01; -1.911821346728772e-01   +5.037875503864097e-01   +3.549783382578600e-01   -4.125966023595500e-01   -2.166490038422983e-01   +2.589724338691359e-01   +6.658285139719154e-01   +8.622049491628600e-02; +8.720878012301830e-02   +3.803370698608368e-01   +7.145060307137511e-01   -3.647661472211872e-01   -2.390066204064416e-01   -5.389178146732321e-02   +3.716408157422515e-01   -1.959551318226025e-01; +1.943833882702508e-01   +4.159444979361968e-02   +1.000000000000000e+00   +6.079167648487070e-01   +2.444928681568353e-01   +5.677932383765073e-01   +7.042252331841334e-01   +4.270853790627014e-01; -3.435911581691948e-01   -4.179975135225851e-01   +3.006244254557778e-01   -2.625704560267951e-01   -9.862906367360971e-02   -2.262621391435940e-01   -1.589190638410281e-01   +7.591506623979179e-02];
L3I_L3E_iAMPA_netcon = [-3.558121865848037e-01   +3.147722671863341e-01   +6.260224939603640e-01   +2.556311500252273e-01   +5.284253804294785e-01   -2.361550746500685e-01   -1.834726009207738e-01   -6.786193540600489e-02   -1.977513235777471e-01   -3.986675090313521e-01   +8.289799141809782e-02   +4.223240865708978e-02; +4.964851415474577e-01   +5.552889714717708e-02   +6.087384663844411e-01   -2.728293871820061e-01   +6.019001388627604e-01   +2.185601487279729e-02   +7.542702754049915e-02   -6.283828763956610e-02   +5.992439678798605e-01   +8.525800223476987e-01   +1.338004237831041e-01   -1.447497294331020e-01; +5.785064268877376e-01   +3.844380622661592e-01   +9.812835314751024e-02   +1.479544954265778e-01   +5.990051965929076e-01   +2.750318314287628e-01   -3.364651433529554e-02   +1.026174196644544e-01   +3.234266173621164e-01   +4.747744497838627e-01   +1.174806369458538e-01   +6.049699332994912e-02; -3.553230327998219e-02   +4.739031288428605e-01   -2.116376360691280e-01   +6.257449167890002e-02   -1.218469430448206e-01   -3.779020996467591e-02   +4.117906227641773e-01   +5.801802356083358e-01   -6.815949697787499e-03   +1.473056720832298e-01   -2.529524180503355e-01   +9.565643750678819e-01; +1.947847525143581e-01   -2.868612651205671e-01   +1.935205657985676e-01   +5.280699405612131e-01   +2.399004052345573e-01   +1.013653920647380e-01   +5.082707514015363e-02   +7.161411655502136e-01   +2.678051759960844e-01   +4.495539449047888e-01   +2.931401907305405e-01   +2.757860644100550e-01; -4.713199642554667e-01   +9.454848530307691e-02   +2.531955590774105e-01   +5.244440649128475e-01   -4.266088785921143e-01   -3.018605983650212e-01   -6.070224803921733e-02   -2.403946572372260e-01   +3.921388598957650e-01   +2.760988937374949e-01   +3.716763451907310e-01   +2.212098284586782e-02; +8.387322516595973e-01   +5.419067894919214e-01   -2.881196802503655e-01   -9.455102237935943e-02   +5.874563995243250e-01   -1.110688986143665e-01   +6.161203899621743e-01   +9.640301020240537e-01   +3.794692563008353e-01   +2.919422218782955e-01   +3.502594288124786e-01   +5.575140577999578e-03; +4.136818901142070e-01   -3.107566681650556e-01   -1.486190180352109e-01   +1.825330190589838e-01   +5.181871077193739e-01   +2.926265167963740e-01   +4.399809891779305e-01   -2.240316183667691e-01   -7.220414642650830e-01   -2.180090333076264e-01   +4.011015425048622e-01   -3.109052522502023e-01; -1.095547750188757e-01   -3.878627207329990e-01   +4.370934165840899e-02   +1.421659580362004e-01   +3.722198625568023e-01   +7.911721199516427e-01   -7.138673124296709e-02   -3.828262078614378e-01   +7.319044076419595e-01   +1.000000000000000e+00   -5.589871892357411e-02   -1.989783380815733e-01; +1.640411639122908e-01   +4.849431965644225e-01   +6.102153453719666e-01   -6.152718993995434e-01   +6.144068278944598e-01   +1.038391180075073e-01   +1.648476151349677e-01   +3.235237537511596e-01   +7.301364485986070e-01   -9.754900496824419e-02   -2.712668684827177e-01   +2.438738511938071e-01; -4.348421841413009e-02   +3.904432402550659e-01   -2.115558221204694e-01   +6.734470134762484e-02   -1.688412845494965e-01   -4.435000956199678e-01   +9.275163015681306e-01   +1.127782249685201e-01   +1.511361143926799e-01   +3.230372142384273e-01   +3.433685935591650e-02   -4.696188520126104e-01; -4.601021762117878e-01   -1.647473497845694e-02   +3.743797078152982e-01   +6.203966232838759e-01   +6.422977003711683e-01   +6.841407417341512e-01   +3.972247077554437e-01   -3.701906890974924e-02   +6.377196466369909e-01   +4.879409404437307e-01   -9.497949472375562e-02   -7.455149557699049e-02];
L3E_L3I_iGABA_netcon = [+5.211153029510663e-01   -3.539044495004152e-01   +3.726580048926417e-02   +2.920927248447601e-01   +2.966639511821607e-01   +9.037952720709042e-01   -3.407342975836642e-01   -3.915943594728296e-02   -1.705618191178461e-01   -1.725029358036421e-01   +3.176027520295659e-01   -5.098107345847797e-01; +3.061436915568187e-01   +4.495911191814280e-01   +2.413615043920488e-01   -3.335247382811700e-01   -7.547718762132909e-02   +6.100965618904425e-01   +1.724382270806947e-01   +5.155887510246120e-01   -6.338222296804827e-02   -2.341709909223300e-01   +4.914693309519292e-01   -1.666188236086118e-01; +3.888162067348929e-01   +3.257375169918891e-01   +3.371419789067095e-01   +2.848747197135547e-01   +1.216832086176680e-01   +5.522547602543790e-02   -3.122150040497111e-01   -2.926112669374789e-01   +2.743594421510913e-01   +6.225108108480283e-02   +5.410821531554204e-01   +3.276853051758677e-01; -9.800403260218889e-02   +4.264627023925383e-01   -5.586643268251601e-01   +3.245031141729501e-01   +2.139652733764538e-01   -1.105743967344927e-01   -4.380427180317193e-01   +9.588968990606332e-01   +6.904236243635706e-01   +6.207136682593944e-01   +5.532310841345999e-01   +9.949477629873055e-01; -1.946935030927936e-01   +1.621111641651328e-01   +6.526197154065662e-01   -3.700030714428514e-01   +2.746133794794511e-01   +7.532899447139076e-01   +8.031149621619296e-01   -2.289338736975908e-01   +4.269848548585913e-01   -2.116772087938251e-01   +5.715766646591085e-01   +7.736871499323753e-01; +1.418101874585406e-01   -5.889147488184745e-01   +3.461397151306250e-01   +4.054978162477720e-01   -2.877557067438860e-01   +1.752922683203364e-01   +2.921021667966229e-02   +1.292756736888024e-01   -2.448420121160418e-01   +7.991448022036893e-02   +4.617246261261061e-01   -4.432941359150888e-01; -3.803065541827592e-01   +1.891594164613099e-02   +4.938241138646569e-01   +2.774425536733210e-01   -1.514875170955559e-01   +6.173737151450145e-02   -1.593595045072280e-01   +1.000000000000000e+00   +1.830180353053530e-01   +7.699459184381878e-01   +8.043389291400389e-01   +6.408532772402705e-01; -9.982355534001371e-02   -1.155606569588827e-01   +5.390354165564821e-01   +5.426752791019984e-01   +1.987692588453727e-01   +5.149545288715290e-01   -1.106700669062210e-01   +3.895509503769072e-01   +3.385264703170190e-01   +7.288019404257214e-01   +1.556678762863039e-01   +6.044951981689352e-01; +3.116074693772073e-01   +3.374531203876586e-01   +3.198169120220701e-02   +5.377169643141992e-01   +5.939881271194946e-01   -3.144698341290914e-01   -7.123610766348915e-01   +1.863880046414028e-01   -5.384583186890793e-01   +3.531800684225708e-01   +6.509987375877948e-01   -1.005459305297064e-01; +1.397549755613836e-01   +5.947158012523581e-01   +8.446981412223592e-01   +5.915233216854634e-01   -5.104025880743301e-01   -4.041100578039521e-01   +1.187922259491330e-01   +2.837483017274548e-01   +4.622186613886058e-02   +1.511984475874628e-01   -2.221858378526990e-01   +1.309606281692390e-01; +8.101578366404986e-01   -5.224093285980327e-02   +1.528892816502455e-01   +2.095251754849297e-01   +8.680033767189039e-01   +3.002300015404675e-01   +1.744157134029754e-01   +2.466032192825377e-01   -3.264518321650176e-01   +9.765902154937239e-01   -5.982039996676843e-02   -1.010249972015806e-01; +4.015789639832189e-01   -9.116908250988909e-02   +3.878470856393826e-01   -3.460633445819086e-01   +2.221038248540189e-01   +7.593712414431242e-01   +8.209529070724663e-01   -1.076509399112745e-03   -2.686158747310608e-03   +3.004394466394232e-02   -1.323134586820179e-01   +1.698805257721648e-01];
L2E_Input1_iAMPA_netcon = [+7.549132660352287e-03   +3.208262607356631e-01   -4.887078220460302e-01   +4.421940217529817e-01   -7.158792926484935e-02   +9.837614579347479e-01   +5.515909323990638e-01   +4.199365741393217e-01];
L2I_Input2_iAMPA_netcon = [+9.958349968748979e-02   +1.356841025090866e-01   -7.787953195955691e-02   -9.904468426993260e-02   +1.000000000000000e+00   +3.324415966411906e-01   +2.927930749587789e-01   +3.041733348517864e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.04*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.4*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.1*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.4*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.1*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.4*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.04*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.4*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.1*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.4*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.1*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.4*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
