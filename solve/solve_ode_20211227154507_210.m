function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+4.237945879990587e-02   +9.182736150859175e-02   +7.492571316575682e-02   -2.817397086118106e-02   +8.426692823633301e-02   +1.400287644517961e-02   +1.825439535513991e-02   +5.873676525292266e-02   +3.958460657141101e-02   +6.872128277236196e-02   +1.169407498789785e-01   +1.252301477392028e-01   +2.515998860749507e-02   +9.726160209856287e-02   +1.574326463106665e-01   +5.085137057043638e-03; -3.206326130794696e-02   -5.006548605075284e-02   +7.060146492069048e-02   +1.786714897296796e-01   +9.348930810125017e-02   +1.305140704142394e-01   +6.700229504051690e-03   +1.219450069928811e-02   +7.306083498972002e-02   +4.902460181070505e-02   +5.198180781615604e-02   +1.757358040082078e-02   +1.561243752677874e-01   +8.554095250774855e-02   +5.888855330518709e-02   +1.319361373689470e-01; +1.333988437927180e-01   +7.303102487072741e-02   +3.770314294532045e-02   -1.059127184859687e-02   -1.804343961672599e-02   -8.872112466376068e-03   +3.623671294884694e-02   +9.690499927415318e-03   +3.372840015801468e-02   +1.544340550797900e-01   -2.674366291766108e-02   +7.953312477007381e-02   -5.014227856687786e-03   +7.387459718486621e-02   +5.180601450886826e-02   +6.856873814995111e-02; +3.664803687626274e-02   +1.405938987969912e-01   +1.320873379486628e-01   +9.917824946635252e-02   +9.513891862916320e-02   +2.770690738454136e-03   +3.261452228399908e-02   +8.388604234418487e-02   +5.432179708784715e-02   +9.523122240551998e-02   -9.571353211175256e-03   -4.385336608404126e-03   +9.874338256989261e-02   -6.312712952483623e-02   +1.190403092463934e-01   +6.364387714045083e-02; +7.830235542626346e-02   +6.768132962339291e-02   +1.707266502440130e-01   +9.806465950588932e-02   -1.846111214563746e-02   +5.140261683425022e-02   +9.908327652302269e-02   +1.113954682587979e-01   +2.399721442173022e-02   -1.867674068116815e-02   -2.339127127729320e-03   +4.859838423699908e-02   +6.825589102637221e-02   +2.243719449125634e-02   +9.078487006899275e-02   +1.393099105604226e-01; +9.993242670492491e-02   +4.140661603327862e-02   -1.337771529590476e-02   +1.050788131768248e-01   +5.040445379539393e-02   -1.377025177219635e-02   +7.298349225512733e-02   +2.166609123864762e-02   +7.963120058533993e-02   +3.144813996251392e-02   +1.360065476959037e-01   +1.409537675146152e-01   -4.134741526752039e-02   +1.228954397388367e-02   +3.727201694702993e-02   +4.890580973229542e-02; -1.561105530977877e-02   +3.025015846045045e-02   +2.566553307404451e-02   +1.514886786585513e-01   +3.397017265748785e-02   -2.133920331392221e-02   +8.123335840338756e-02   -1.862574346952341e-02   +1.484186414924707e-01   +8.775561837577336e-02   +4.003219478197206e-03   +8.131256008311351e-02   +4.151041888251551e-02   +7.577430513085232e-02   +4.572799797281407e-02   +7.267440939264767e-02; +6.641886262822630e-02   +2.771570802415804e-02   +7.499452667856857e-03   +4.324316032723806e-02   -5.316055310681757e-03   +1.661192069873546e-01   +6.621068584112652e-02   +1.113619774384276e-02   -3.744372053057633e-02   +3.363263144076600e-02   +1.297536282945735e-01   +7.361532311174456e-03   -7.934462887278127e-04   +5.097684327075207e-02   -1.704183617478174e-02   -1.077217151693427e-02; +9.710294303361737e-02   -5.154148893524913e-03   +9.643003656586423e-02   +9.990237653327143e-02   +9.995829454856708e-02   +1.520125722490768e-02   +3.025994494336551e-03   +3.862874222677746e-02   +3.683996346431707e-02   -1.126028115627861e-02   +1.662934335058957e-01   -8.712850216532057e-03   +7.307163819736504e-02   -9.627290747482281e-03   +5.940969517776225e-02   +7.358849068519629e-02; +4.172822169928497e-02   +2.848029858483719e-02   +3.533606052792672e-02   +8.916713960149207e-02   +1.172671217170341e-01   +1.535689504870008e-01   +1.298647537543189e-02   -2.014547047114943e-03   -7.475134851921111e-03   +1.240272323222036e-01   +7.822258793729792e-02   +3.355640557898167e-02   +1.742280977093713e-01   +1.383585290210811e-01   +9.817418211503863e-02   +2.630682080124298e-02; +3.433514705174721e-02   +2.787638879284977e-02   +5.991937097857382e-02   +1.384534818819825e-02   +1.331543686638944e-02   +1.857580029997453e-01   +1.194076150733850e-02   +2.387033392122085e-02   +3.833728470591373e-02   +5.658519106716937e-02   -5.351382268708921e-02   +7.452972027140156e-02   +7.463084889160301e-02   +4.791869347302233e-02   +7.152834213400308e-02   +9.741712364956043e-02; +6.247566532556905e-02   +7.141819238054896e-02   +7.561248281948226e-03   +1.138685871335205e-01   +3.935548013811466e-02   -1.551511170124083e-02   +8.734799210905198e-02   +9.563677034296542e-02   +1.050285773011569e-01   +4.437749804236613e-02   +1.071697749807710e-01   +6.681512850146126e-02   +6.624035892775515e-02   +7.052615728633641e-02   +1.039743859001860e-01   +1.109138363237949e-01; +1.714572319633263e-01   +9.022055599833936e-02   +8.324729993914091e-02   -2.048741046832945e-02   +5.041871208029595e-02   +4.877558130307592e-02   +4.471005255606682e-02   -4.657902859550884e-03   +8.455230381849065e-02   +1.179101161427174e-01   +1.432524091029276e-01   +1.727830320791635e-02   +4.208464648539834e-02   +2.484026068528217e-02   +8.101011342847715e-02   +1.769442251542321e-02; +1.440979399266191e-01   +2.295040540182867e-02   +7.858064045299656e-02   +1.427257170344213e-01   +1.521272535385383e-01   +2.682499033735262e-02   +9.119923676949029e-02   +3.949850051419488e-02   +7.859132666119951e-02   +1.037095268187352e-01   +1.150973165375509e-01   +1.664084177904340e-01   +1.423976563601543e-01   +1.429836216082999e-01   +1.487343138304824e-01   +1.006759711775898e-01; +5.383907225909053e-02   +4.428926523173771e-02   +1.297342342941933e-01   +1.183919710980932e-01   +1.028705968600218e-01   -4.331880867148100e-02   +9.994207713526258e-02   +6.055295922885841e-02   +1.373445536222117e-01   +1.059723221204377e-01   +9.376354153764503e-02   -4.558711919247679e-02   +9.777144512508495e-02   +3.398322253558787e-02   +3.608840326284295e-02   +1.324163193886346e-01; +1.410979030362489e-01   +5.222571641583093e-02   +9.707849360499142e-02   +1.684212493369455e-02   +1.262053072332965e-01   +1.273387321260011e-01   +8.534462526121828e-02   +4.916322658430426e-02   +6.346464554713231e-02   +4.769488231291651e-02   +7.649527627855802e-02   +3.495693183295685e-02   +9.437416531943384e-02   +2.492539335762795e-02   +7.947003330494989e-02   +1.104234488526328e-01];
L1E_L1I_iGABA_netcon = [+1.137607894619876e-02   +1.730615146815731e-01   +1.181380590513856e-01   +1.322140398769084e-01   +6.615453575568127e-02   +9.882735705400758e-02   +5.714787513598900e-02   +4.227260566657816e-02   +1.104441248875699e-01   -1.748059660766238e-02   +7.408087550627111e-02   +2.759531378462846e-02   -9.657539555320036e-03   +9.573600912933355e-02   +5.799010364544421e-02   +1.125625787743517e-01; +9.089364768251441e-02   -3.210570200186698e-03   +4.738631433038969e-02   +6.696073354446606e-02   -1.620664659321628e-02   +1.003882479186719e-01   +5.722542115650858e-02   +5.327767882474203e-02   -1.334145368621159e-02   -6.167057027236766e-02   +9.563927472942828e-02   +3.651263434578378e-02   +6.816476783802107e-02   +8.739078153550543e-02   -1.236677690470559e-02   +8.370676440117458e-02; +1.481317438199225e-03   +1.269523461541356e-01   -2.388964584704129e-03   -1.512703269950970e-02   -1.115831509755227e-02   +6.157003358758270e-03   +1.087607544332166e-01   +7.823303461283526e-02   +2.229449053772720e-02   +4.132276224138772e-03   +7.264564920689814e-02   +9.189473826831697e-02   +3.545615539199214e-02   +2.288071399030720e-02   +2.510142260883573e-02   +4.954529734508017e-02; +5.368156814142726e-02   +8.048468503694635e-02   +8.258296706537581e-02   +4.065677773462561e-02   +9.058198291107353e-02   +1.762106625792289e-01   +2.978946307452822e-02   +4.455140070461756e-02   +2.704392674317971e-02   +1.306606297805994e-01   +1.313306716499480e-01   +1.326913226052850e-01   +7.632329023756396e-02   +5.753606377406457e-02   +1.046003486401650e-02   +7.344696388314058e-02; +8.535046216853945e-02   +1.238726871349826e-01   +1.135077631904739e-01   +1.202607536971769e-01   +6.433150509818004e-02   +5.426166597765240e-02   +6.542385189059230e-02   +7.459929627943895e-02   +1.433894580250069e-01   +8.373198297188691e-02   +1.187119892801764e-01   +4.308961908973093e-02   +3.289051375822395e-02   -2.053955378782740e-02   +5.046199469191102e-02   +1.048499357740764e-01; +9.971450935485253e-02   +7.144845084251429e-02   +2.174487982413062e-02   +1.105608163118528e-01   +6.483349011715486e-02   +2.566138969355392e-02   +4.613107651354551e-03   +2.423074308417400e-02   +1.650035573314080e-01   +4.542118058635062e-02   +5.473518821602302e-02   -4.538733674811916e-02   +1.125416344759156e-01   -1.404882867864596e-02   +8.497498172322548e-02   +7.626783888394950e-02; +2.181960057968600e-02   +1.051505502622453e-01   +1.413572174442121e-01   +5.550466547904596e-02   +3.890361970123266e-02   -3.092951238244278e-02   +1.108996447048592e-01   +6.074059785076685e-02   +3.709733186714958e-03   +9.871564864738322e-02   -1.723328302224383e-03   +1.010736427236935e-01   +7.752021167421533e-02   +1.610408876371425e-02   +6.350104708977991e-02   +3.917481008021211e-02; +1.742944560911349e-02   +7.072243401753006e-02   +3.314715493105123e-02   +5.498514253805561e-02   +9.591440726931005e-02   -2.049913631415896e-02   +2.131009319539093e-02   -6.884419681933993e-02   +1.156845460194301e-01   +7.685793540680726e-02   +5.271229005911683e-03   +3.454176167869254e-02   +2.324082790157529e-02   +5.444825737341612e-02   +1.495158028919881e-02   +1.542653000890462e-01; +4.280299564013280e-02   +1.420477293525214e-01   +1.073349815889191e-01   +1.093203500246342e-02   +3.083314068027677e-03   +1.163863704449868e-02   +1.361174486144750e-02   +2.672483959465797e-03   +9.802509913143526e-02   -2.029883293447232e-03   +4.193563292569091e-02   +7.872663933311787e-02   +3.842029871274139e-02   +1.076050156061447e-01   +1.432391566483307e-01   +7.556750181838782e-02; +7.576605193961482e-02   +1.060407992140753e-01   -4.289842497337396e-02   +6.024034231526636e-02   +2.639892395937276e-02   +5.390250381971894e-02   +1.084043806698541e-01   +3.202594817259820e-02   +1.413681521673563e-01   +5.942391582306056e-03   +9.759068386380058e-02   +2.792421783487501e-02   +6.931688979084029e-02   +1.165123596074591e-01   +1.415689794317086e-01   +1.148017413782502e-01; +9.718037910985292e-02   +8.833193944241383e-02   +2.958942853705566e-02   +8.580239734926388e-02   +1.260683901696038e-01   +1.248274342759684e-01   +6.297858237841400e-02   +5.634608498110304e-02   +4.272584722248634e-02   +7.573403565002509e-02   +6.274031512667458e-02   +1.174132781624468e-01   +2.178502817353793e-02   +1.095377801054064e-02   +8.965774323201649e-03   +8.769370052162299e-02; +1.148798189500251e-01   +1.068795707025809e-02   +4.162359584470295e-02   +4.439854024291997e-02   +4.953568165484084e-02   +4.967041706512812e-02   +8.498934530972846e-02   +1.740400681582525e-02   -2.489151156553516e-02   +5.562063665704779e-02   +7.797467168778198e-02   -6.336618159756289e-03   -1.246088829983126e-03   +8.313715565110956e-02   +1.207711530144508e-01   +1.221798001209182e-01; +3.992637597107999e-02   +4.682470878604311e-02   +1.073956331291902e-01   +7.758371527215333e-02   +7.133200828010791e-02   +1.203048540928900e-02   +5.342707002575451e-02   +9.373215095824816e-02   +9.563452657068988e-02   +1.149355731718259e-01   +2.454991203847423e-02   +4.935229785698866e-02   +7.135895899418795e-02   +1.049393515367656e-01   +8.147631844383889e-02   +3.367403336770386e-02; +3.377522429732814e-02   +5.289804529443189e-02   +4.926241892578281e-02   +5.268833679469376e-02   +8.683625681987495e-02   +2.211106246487433e-02   +1.241120850542117e-01   +1.277121063337539e-02   +7.931613535752950e-02   +6.417589647732233e-02   +7.030570009641605e-03   +5.111391925341376e-02   +1.006197102111537e-01   +1.263725708162963e-01   -1.214883395125503e-03   +2.776971061026822e-02; +5.461876755135262e-02   +9.467853080823121e-03   +5.794308486910934e-03   +6.645512259682690e-02   +1.149934253760519e-02   +3.071880432972979e-02   +3.541488377092828e-02   +5.638493546554069e-02   +7.334425882151553e-02   +9.747517620207097e-02   +7.024991745814575e-02   +9.125763505653664e-02   -3.002508060334690e-02   -9.560666681216240e-03   +7.827507471485426e-02   +1.380154221631911e-01; +5.601563962025552e-02   +2.554617262526893e-02   +6.839804218548616e-03   +8.108027311914588e-03   +9.681597297264732e-02   +1.905427893227959e-01   -8.228588832403400e-02   +7.676069393716332e-02   +1.104492944372441e-01   +9.284148205062775e-02   +9.673838868743181e-02   +3.226851892901256e-02   +2.243480787255291e-02   +1.634894843687686e-01   +1.012124936373415e-02   +4.889101541007535e-02];
L2I_L1I_iGABA_netcon = [+1.645841092090298e-02   +8.351790436104543e-02   +3.413798300241833e-02   +4.699794193319563e-02   +3.341630200217385e-02   +2.071353514372022e-02   +4.140869126171711e-02   +8.563507613167530e-02; +4.312829113783993e-02   +1.220775674286975e-01   +7.314454941406731e-02   +8.639572916279904e-02   -1.550353762820385e-02   +6.952614664270787e-02   +1.102845591875284e-01   +2.312217367468802e-02; +3.420544038684761e-02   +3.433115344217631e-02   +1.369230056122767e-01   +1.078992443975213e-02   +9.162964784242061e-02   +3.731025784695796e-02   +1.132365315785023e-01   +8.586507851975331e-02; +8.193839468267328e-02   +5.966694272184019e-02   +5.578096423636682e-02   +9.018044553490877e-02   +8.526683770326794e-02   +6.829812451888877e-02   +6.529383756267561e-02   +1.093780151193387e-01; +1.275332932983519e-01   +6.115819159606045e-02   +2.546784745530496e-02   -6.066595526076410e-03   +8.983554053531972e-02   +8.056254553328870e-02   +3.377730704285386e-02   +6.534240774376926e-02; +1.711946027117019e-02   +8.156709899062665e-02   +1.171527880145896e-01   +5.908325023666552e-02   +1.246603795829694e-01   +4.858322789939357e-02   +4.627641875248015e-02   +3.367835633785347e-02; +8.615776675093585e-02   +4.766165397009010e-02   -4.646420629281070e-02   +4.847766351942401e-02   +5.782369734548923e-02   -1.294513462003176e-04   +2.620564151182493e-02   +1.036058418628877e-01; +4.368510902612505e-02   +5.510274738990642e-02   +3.673788640162125e-02   +2.024213651234185e-01   +1.954513580164138e-02   +4.215398612405336e-02   +5.567700490882452e-02   +3.393518319641761e-02; +3.582386115259545e-02   +7.248927166023102e-02   +5.674415331911090e-02   +1.356729893668293e-01   +5.621180573570455e-02   +1.314696284324363e-01   +1.591761306048445e-01   +6.307924276893551e-03; +4.732594088272243e-02   +8.071319198558588e-02   +7.464217492505813e-03   +1.244926390183479e-01   +1.528014934835625e-01   -2.687628019968038e-02   +1.078904040502210e-03   +9.950958051596098e-03; +7.652990995761358e-02   +9.581066413070434e-02   +1.652423248980493e-01   +1.003072530130626e-01   +5.581463899179147e-02   +9.339183134243548e-04   +1.156766982080549e-01   -2.526107022455305e-02; +6.470213915362175e-02   +7.600893442592609e-02   +1.178520155120331e-02   +7.000360384906487e-02   +1.276271430050696e-01   +9.479935679274908e-02   +5.294694248958929e-02   +2.181450202480895e-02; +5.967007787689212e-02   +4.589005180141791e-03   -2.720134831910771e-02   +1.003743262009507e-01   +5.560733040261805e-02   +9.457289117043892e-02   +5.338304849373377e-02   +3.222654464223222e-02; -5.301136785236000e-02   +9.307062836623531e-02   +2.429344931590439e-02   -2.918188446402650e-02   +6.994764867197786e-02   +6.714236867212686e-02   +9.132110001942967e-02   +9.538224889097954e-02; +2.670928805638463e-02   +1.734178623852250e-02   +9.333776791496191e-02   +1.208123367715497e-01   +4.637661435275743e-02   +1.062794771002115e-01   +1.164373615246272e-01   +7.770852352631075e-02; -4.688817636055817e-03   +1.428387134819510e-01   +4.653665924965819e-02   +9.846502495420646e-02   +4.291152927887031e-02   +1.483045257163888e-02   +4.277301114283547e-02   +3.179324619573669e-02];
L1I_L2I_iGABA_netcon = [-1.266421303329108e-02   +8.177244849100042e-02   +2.184569056037349e-04   -3.512525136403327e-02   +1.066812997730448e-01   +6.005420364497480e-02   +9.971112552786646e-02   +1.132795072728854e-01   +6.474262942866289e-02   +4.148596417418052e-02   +6.026244604672118e-02   +6.869867536766022e-02   +2.936451229413709e-02   +9.670727655406802e-02   -2.561031764108836e-03   +2.637305113607689e-02; +7.904370881804107e-02   +2.727245908791594e-02   +8.819271515019046e-02   +7.453852005538539e-02   +8.465260734338763e-02   +5.875585357536843e-02   +1.603366477673934e-01   +8.185090431954682e-02   +7.401555798757711e-02   +9.020472691729341e-02   +3.389973506654802e-02   -1.616209884301173e-02   +1.365851391468677e-01   +1.564201550325085e-03   +9.277609230757329e-03   +8.524991756882211e-02; +4.371651122458853e-02   +1.334263261185923e-01   +1.071383502934216e-01   -4.474812126976103e-02   +1.327484325208078e-01   +2.305900280232937e-02   +4.460623971880794e-02   +6.059424307940146e-03   -2.581363136184303e-03   +1.512197648136393e-01   +8.746191774814177e-02   +6.200891578662261e-02   +1.461760238800137e-01   +2.776370439562376e-02   +1.190864074747906e-02   +1.191713944922719e-02; +6.579973918588872e-02   +1.077073753429469e-01   +1.156743525500457e-01   -1.616094658745469e-02   +5.851391532381886e-03   +6.732689020899658e-02   +9.098980977344366e-02   +3.413869310975312e-02   +7.852143301087598e-02   +7.651130927359677e-02   +1.027050453322509e-01   +1.628431743056485e-02   +1.094965483551105e-01   +1.350765344623117e-02   +2.652446593576064e-02   +1.525362016479261e-01; +4.506511387351728e-02   +7.271286806359351e-02   +1.244027025971471e-01   +5.544153763113223e-02   +1.332667103049320e-01   +1.384622737204686e-01   +1.569698935235909e-02   +4.398223856698772e-02   +5.203953112450293e-02   +3.748880645922729e-02   +3.446691520825225e-02   +6.612732560425576e-02   +7.788551173660638e-02   +3.696411808211329e-02   +1.051638732338520e-01   +1.347309869456574e-01; +3.412345509271666e-02   +7.334676355887401e-02   +8.902653130250605e-03   +1.228583270380232e-01   +1.082782776542051e-01   +3.973131599722524e-02   +2.298156025316402e-02   +5.604792217168515e-02   +3.996360332037767e-02   +6.689753494105068e-02   +9.068416681923194e-02   +1.228672311152492e-02   +4.749719606130777e-03   +6.733132682298469e-02   +4.390565128356341e-02   +1.212461503385827e-01; +3.054442316195362e-02   +2.761916930111175e-02   +1.528553703456788e-01   +3.369505337354622e-02   -2.820052089064220e-03   +8.295135362943201e-02   +6.341335637953549e-02   +4.167790275994541e-02   +4.183207562826480e-02   +1.279061166656956e-01   +6.017606116146473e-02   +9.993954363727676e-02   +1.165816096658262e-01   +1.026338771953670e-02   +5.140351762637280e-02   +2.447986188444323e-02; +6.926894893849195e-02   +2.607344839279412e-02   +8.128410962433313e-02   +4.246490095040201e-02   +2.743703986589419e-02   +1.018723205935620e-01   +8.008945793847541e-02   -2.902135439150684e-02   +1.607375343386755e-01   +4.724137687498116e-02   +1.448882563265234e-01   +5.738751525587323e-02   +4.013944305099600e-02   +5.457854875312453e-02   +8.555650059590750e-02   -3.328708465091675e-02];
L2E_L1E_iAMPA_netcon = [+7.004392213049553e-02   +1.118707982138496e-01   +1.751739103649420e-01   +1.001277998186033e-01   +3.210798306396519e-02   +3.318223827174846e-02   +2.700801839064480e-02   +3.319820483549445e-02; +3.121500175242385e-02   +7.253529129149670e-03   +8.205457357059125e-02   +1.582825745036888e-02   +6.196748637485686e-02   -6.678498154349946e-02   +6.236550638290864e-02   -6.612166285521102e-03; -3.430493415076087e-02   +6.532427833185313e-02   +3.267050851443253e-02   +1.143271979260116e-01   +1.128794153504084e-01   +1.215011380073968e-01   +1.521499114963366e-01   -1.558393538464617e-02; +9.302565737987570e-02   +3.967619800473242e-02   +1.442194745240359e-02   +3.692428240686922e-02   +6.411430447931729e-02   +9.743358055364658e-02   +7.570898183153121e-02   -2.526745900409794e-03; +1.207745225280998e-01   +1.227036558898839e-01   +1.121996667109997e-01   +5.843319987017858e-02   +5.427520761946398e-02   +1.035557915891206e-01   -2.716195183006665e-03   -1.908847887517912e-02; +1.540968507935379e-01   +9.444214755341240e-02   -2.136012623710816e-02   +1.370981321230215e-01   -2.449456043662614e-03   +1.225410315938746e-01   +5.234099067856043e-02   +7.129304660948699e-02; -5.304073278566367e-03   +1.264279425262390e-01   +4.893686180428019e-02   +3.300826623392480e-02   +5.573021066831829e-02   +1.642008620451385e-01   +1.441478189254259e-02   +1.028008792571204e-01; +8.052756812199750e-02   +1.886814490588594e-01   +1.535590815809877e-01   +1.004374408860726e-01   +1.272417721058737e-01   +5.518801988854789e-02   +1.005064696590185e-01   +8.233365936669498e-02; +7.944250871300620e-02   +1.630046812016576e-02   +5.240831020089197e-02   +1.413499949912777e-01   +1.738649771918900e-01   +9.424862862343869e-02   +4.482796418732272e-02   +8.622398697902267e-02; -9.337140571834778e-03   +1.364887293790762e-01   +1.184075192823012e-01   +8.772821817735063e-02   +1.229423615911831e-01   +5.769019302407546e-02   +1.243347070365837e-02   +3.444115408241862e-03; +3.547169495069553e-02   +9.618572285542744e-02   -5.140371834154868e-02   +1.851802818813487e-02   +3.202648854089512e-02   +1.055897325025128e-01   +1.008633393337893e-01   -6.811281953670600e-02; +1.275793522067474e-01   +8.900580847249448e-02   +2.307436061299736e-02   +6.282962684634233e-02   +1.187301615201801e-01   +1.662942881978222e-01   +6.313164763292850e-02   +8.286903469683962e-02; +7.633115201409565e-02   +1.227786856492134e-01   +1.998772117886341e-01   +2.780607168969187e-02   +1.091817990667456e-01   -3.725002509824640e-02   +1.265732515646602e-01   +1.403039883594282e-01; +1.022113681101702e-01   +6.295387621521199e-02   +5.573042244582106e-02   +4.036353034070404e-02   +2.866307122056893e-02   +1.046674540849328e-01   +8.747110128145366e-02   +9.938349816072398e-02; +5.879430192935583e-02   +7.939735226257469e-02   -1.446051453955336e-02   -1.754316010894905e-03   +6.584498551966506e-02   +5.395752068191581e-02   +6.751307095327914e-02   +7.076807876762782e-02; +7.829150713785497e-02   +8.354249421330667e-02   +1.227550685101128e-01   +9.113271090701253e-03   +1.138085922633786e-01   -1.623353057062234e-03   +1.190984961195986e-01   +7.319363298956719e-02];
L1E_L2E_iAMPA_netcon = [+2.288108135538058e-02   +1.002789006728545e-01   +1.287466169738079e-01   +9.277943820204768e-02   +5.703321618504129e-02   +4.800304285957335e-02   +7.457875042206329e-02   +1.160602932655270e-01   +1.090182467635944e-01   +5.768807983300495e-02   +1.390910484144863e-01   -4.239194194335025e-02   +2.158509357493288e-02   +6.995586345919176e-02   +7.403455716827176e-02   +1.208990088147655e-01; +8.930830969561675e-02   +9.673069183385699e-02   +1.041036759190783e-01   +2.253891380798205e-02   -1.380142557059290e-02   +9.322697014445848e-02   +4.584543241853221e-02   -2.147059332563556e-02   +1.355128645771730e-02   -4.348667608903872e-02   -9.793329987520413e-03   +3.149176022167974e-02   +5.274207304861989e-02   -7.034242523780954e-02   +1.171988496222351e-02   +3.692652986916213e-02; +1.914100421017646e-02   +6.801141036839292e-02   +1.460228273529220e-01   +5.578580461481492e-02   +4.198802060240092e-03   +6.128749158448422e-02   -5.095114809512970e-02   +9.247479677485820e-02   +4.146656559938235e-02   +2.896466131801310e-03   -1.668674853452500e-02   +9.840668184838970e-02   -3.110016014821460e-02   +1.479781657996195e-03   +5.171206013578765e-02   +7.584954861367769e-02; +6.617581437552120e-02   +7.470619306837774e-02   +2.917445101665664e-02   +1.494771983039124e-01   +1.928620873949371e-02   +6.990785475505874e-03   +5.791775091199516e-03   +1.168371938726245e-01   +1.070610472851531e-01   +1.277970551302980e-01   +3.928245176753517e-02   +1.545682390297963e-02   +2.325086661225743e-02   +3.639487179174196e-02   +5.312427443765692e-02   +1.388751887529312e-01; +7.975522630209195e-02   +5.924138111978186e-03   -1.615504241433035e-02   +1.446791464958685e-03   +1.500162904403025e-01   +1.631122463743768e-01   +1.719064922969364e-01   +7.199474624515356e-02   +3.873020527406834e-02   +5.180356547495414e-03   +1.994869678767836e-01   +2.014781753880114e-02   +7.626619272698021e-02   +1.108436568454099e-01   +5.305699155574008e-02   +2.776827467622801e-02; +2.351577203111165e-02   +5.123333845029843e-02   +2.804009029051448e-02   -1.707681971926982e-02   +5.893317267319514e-02   -9.260801787348514e-03   +8.412464526444606e-02   +1.037406888482311e-01   +9.940914041444984e-02   +6.260913752463367e-02   +3.758251024716176e-02   +1.294213988778163e-02   +1.163691628203395e-01   +1.109808749385117e-01   +1.342812514324681e-03   +1.042006791041529e-01; +3.319496295121066e-02   -6.993054038031618e-05   +2.639812051480642e-02   +6.833907773339470e-02   +1.218763566708006e-01   -3.855955748193889e-02   +3.326338241121311e-02   +3.896186833676562e-02   +2.183437444494545e-02   +8.567039170390950e-02   +2.693827035830371e-02   +6.270004105264314e-02   +9.957029747917634e-02   +1.138391502565532e-01   +1.698324553210389e-01   +7.757599151631474e-02; +1.621038204988403e-02   +1.278869037605746e-02   +1.464617081729024e-01   +7.321366498089772e-02   +8.994296660200955e-02   +3.246531932100703e-02   +7.846102828099662e-02   +1.503933856498972e-02   +3.870967415359208e-02   +1.301600758844535e-01   +1.019724084195549e-01   -1.494033194291297e-02   +1.114659948213352e-01   +3.627771540501189e-02   +1.144256158175512e-01   +3.849242144574463e-02];
L2I_L2E_iAMPA_netcon = [+4.139103195441072e-02   +1.781123824865245e-02   +1.413292992117351e-02   +4.045331605052205e-04   +9.052571564176998e-02   +7.018932592244718e-02   -4.421997972029579e-03   +3.948148456225559e-02; -1.256737297057787e-02   +9.940080728101897e-02   +1.834842565933511e-01   -1.032374093625889e-02   +5.032252629955858e-02   +3.311111775506383e-02   +5.469379317976423e-03   +6.422511665399303e-02; +2.682100926662181e-02   +1.207010927449407e-01   -4.289567597651973e-02   +6.167140908727089e-02   +7.905319211005894e-02   +1.426453783234478e-01   +9.152703280525692e-02   +1.677787700744000e-02; +5.716405811667644e-02   +1.040231443220060e-01   +1.116991410304620e-01   +2.857551296725089e-02   +8.398658763131059e-02   +9.625188547107602e-02   +2.753530888543445e-02   +6.432298866187212e-02; +7.636881323422046e-02   +1.077435996756965e-01   +6.349455361248518e-02   -2.963892243843200e-02   +1.724170358479473e-02   +1.282200264080071e-01   +6.273466504183173e-02   +1.041514158898286e-01; +6.426012639867133e-02   +4.348975559931557e-02   +1.719611759794345e-01   -3.864703497600750e-03   +6.544267098545950e-02   +3.677922600761678e-03   +1.350712571971635e-02   +4.103423997958013e-02; +3.205210810135257e-02   +8.628312672972699e-02   +1.544772172617613e-01   +4.285181944171804e-02   -2.059921415301554e-02   +6.388455184858766e-02   -1.878458276479467e-02   +1.284047447621584e-01; +4.292988121618100e-03   +7.740477755860885e-02   +1.150158789824120e-01   +9.624849401993085e-02   +1.640729640459302e-01   +1.103960774401913e-01   +1.039993528400848e-01   +1.821604181428588e-02];
L2E_L2I_iGABA_netcon = [+6.062804789996348e-02   +7.989879235933639e-02   +6.606250540926328e-02   -3.528962460567844e-02   +1.847955834169790e-02   +1.278365866336429e-01   +6.134872568012519e-02   +4.625404050167458e-02; +1.518508711778109e-01   +2.192429401446162e-02   +3.268557625653987e-02   +1.318519141034602e-01   +1.980998708537077e-02   +2.171004329425311e-02   -3.520221099066918e-02   +8.697237312291495e-02; +7.547009904881774e-02   +6.804756820736789e-02   +1.046575759012327e-01   +7.030579441330753e-02   +5.748841639261852e-02   +1.200829753944002e-01   -1.589470761031837e-02   +7.650874919941491e-03; +8.241958524110281e-02   +4.935186420033900e-02   +3.241042663587815e-02   +3.267575566447110e-02   +5.219484103727636e-02   +1.727124631020234e-01   +6.072179682838152e-02   +6.889357271392793e-02; +9.847392690439812e-02   +5.839167643598950e-02   +1.035995202711681e-01   +3.745352726723322e-02   -4.619198760968252e-04   +4.696824870103097e-02   +1.019682950806989e-01   +2.318579789271473e-02; +7.534703082500453e-02   +3.215233815573497e-02   +5.445504797064767e-02   +5.403892154159160e-02   +8.998403362894773e-02   +1.096297099161594e-01   +9.828219004223025e-02   -3.009578923876604e-02; +1.425475174189756e-01   +4.854542251536569e-02   +8.682469977088157e-02   +2.814834378405207e-02   +1.051685036510031e-01   -1.316742923256020e-02   +6.181884088972759e-02   +1.206688648253222e-02; -2.048133789807426e-02   +4.822706970962196e-02   +4.533393680374892e-02   +2.618208536226854e-02   +1.349884964844886e-02   +7.095450352338689e-02   +2.635579813065970e-02   +2.523528665564984e-03];
L3E_L2E_iAMPA_netcon = [-2.322592364775090e-02   +4.243882182525536e-02   +3.602770352300615e-02   +5.139519916594999e-02   +8.038542892659618e-02   +8.489735702749227e-02   +1.405878416817152e-01   +5.787331566411330e-02   +9.855857087627035e-02   +8.814881718958179e-02   +4.080288995146963e-02   +1.083828266578347e-01; +3.726526136977049e-02   +1.321247349097336e-01   +1.022864409957986e-01   -1.197123289863267e-02   +7.473216621885059e-02   +1.091686049435206e-01   +4.087154239837396e-02   +8.794667839240867e-03   +1.018949315576266e-01   -3.027026680337138e-03   +1.260130636580055e-01   +1.005482785416465e-01; +1.090702311672152e-01   +9.114361430294973e-02   +1.023029561893681e-01   +9.388632137597583e-02   +3.542563994485801e-02   +7.486282502594580e-02   +1.112137568457743e-01   +8.578753521922652e-03   +1.881582888931258e-02   +1.290641424578114e-01   +6.267397815371957e-02   +2.706143213317298e-02; +9.139148935102577e-03   +7.852624577722730e-02   +4.911551835488888e-02   +8.263739132968092e-03   +1.217771351091589e-01   +6.447769917744803e-02   -1.511107211848885e-02   +8.377591267959057e-02   -3.886047492436671e-02   +1.020004228153733e-01   +9.411389726522679e-02   +1.035584210336635e-02; +6.394891888363469e-02   +1.155942412470104e-01   +1.065090792531020e-01   +1.288608528143796e-01   +8.265269310443360e-02   +1.447265292574618e-01   +5.544205460157271e-02   +5.658118974338942e-02   -4.985802884193834e-02   -1.695738343472178e-03   +1.193789191610508e-01   +4.012093050988374e-02; +5.111127834076127e-02   +4.120867256495831e-02   +7.659058568651960e-03   +7.833675531695114e-02   +1.093761502601510e-01   +1.732748119360383e-02   +1.361349266881888e-01   +1.161417878405314e-01   +1.051673287501338e-01   +8.263423141100182e-02   +5.016260120715135e-02   -8.020444310314619e-03; +8.118099011987584e-02   +4.369053135759898e-02   +8.478215532801187e-02   -1.184713119967056e-02   +8.141354316318246e-03   +2.385081246593758e-02   +1.612965324120313e-02   +2.814562695346027e-02   +5.002357352752426e-02   -8.512041723363853e-03   +1.405481543840764e-01   +1.298366317170845e-01; +7.384659295273185e-02   +1.097204017304920e-01   +9.197503653247710e-02   +6.166960342710779e-02   +8.477639961115277e-02   +6.810960346834374e-02   -9.148861999055560e-02   +2.900017590951973e-02   +9.208672191734926e-03   -2.219401897084892e-02   +4.610132009448282e-03   +5.193526028540141e-02];
L3I_L2I_iGABA_netcon = [+1.242459361885890e-01   +1.214364835021931e-01   -2.255773018718759e-02   +1.003636430806826e-01   +9.790659479768753e-04   +1.045613145918393e-01   +1.055428714732399e-01   +3.520534407562451e-02   +2.716971164285206e-02   +5.030346372877666e-02   +7.309590738336535e-02   -3.888489181206198e-03; +3.700003393147801e-02   +9.755693048555601e-02   +3.890396129579243e-02   +3.085549986342034e-02   +3.887773015312813e-02   +3.987314852952484e-02   +1.249835701385611e-01   -1.993183656466576e-02   -5.148495417937962e-02   +1.115246721644134e-01   +9.124094679230015e-02   -1.859442085078532e-02; +6.028172266320531e-02   +1.237843771053831e-01   +9.111600675722124e-02   +6.228310045121809e-02   +1.061845834051170e-01   +6.464113773824930e-02   +3.928429017152815e-02   +2.883982022856271e-02   +1.193723245805027e-01   -2.550674974036911e-02   +1.286753260394020e-01   +6.130908597518571e-02; +7.810983813976653e-02   +1.496903621833955e-01   +1.086277804436591e-01   +4.043274863439764e-02   +1.404926889102853e-01   +2.586401176155256e-02   -2.705601026468610e-02   +2.487969493559565e-02   +1.216374710088023e-01   +8.801363570521648e-02   +1.435445362186345e-02   +9.199214437043002e-02; +7.625617794150281e-02   +7.505343189226184e-02   +1.066412342087034e-01   +7.492247589920284e-02   +1.319859299035271e-01   +1.081723500744052e-02   -1.407013554989221e-02   +1.109630236314177e-01   -3.951540004922809e-03   -5.791693129550031e-04   -3.103758280975685e-02   +7.776571927226218e-02; +6.377017950849756e-02   +1.102969274460646e-01   +1.431048345268211e-01   +7.949840430171035e-02   +4.851680190218364e-02   +9.234732393471574e-02   +6.601432621465804e-02   +8.078351023648267e-02   -1.814596515147824e-02   +4.993306507485405e-02   +9.322211626344769e-02   +6.598589741290961e-02; +4.132975613480207e-02   +3.982021494389036e-02   +1.267716372370606e-01   +1.246097714909751e-01   +5.792270368132105e-02   +8.076358894639978e-02   +2.627548869185246e-02   +5.669441136502238e-02   +2.246042209630957e-02   +7.500589786824942e-02   +9.999341897912481e-02   +8.618979816245627e-02; +1.947303072550023e-02   +7.383890779870206e-03   +1.004749820714429e-01   -2.137746949852481e-02   +1.101548284776826e-01   +1.167689533191320e-01   +1.102967755217313e-01   +9.361320733973220e-02   +8.112815255248185e-02   +8.943422603203675e-02   +1.471879749604476e-03   +8.369949814819713e-02];
L2E_L3E_iAMPA_netcon = [+1.808181514730649e-01   +5.454115041907428e-02   +1.358757905562936e-01   +6.950938966427767e-02   +1.765333265334466e-02   +8.589692961111682e-02   +5.027472224558259e-02   -4.324648631652751e-02; +9.298813976448743e-02   +1.330667450594045e-01   +8.891451832303790e-02   +6.638958872608480e-02   +1.479780470851637e-01   +3.247355309109904e-02   +6.826511324980579e-02   +1.291771286082131e-01; -1.832745664997441e-03   +4.597392930542078e-02   +2.527105470735011e-02   +6.481650841671462e-02   +7.384831488644029e-02   +1.043230079738495e-01   +9.861922493172823e-02   +3.181075297062042e-02; +2.084235689833178e-02   -1.282974461425480e-02   +7.012477700141045e-02   +1.195541093843519e-01   +7.402183478016602e-02   +1.484795722411539e-01   +9.532149566776993e-02   +6.566788982148485e-02; +9.685744819997881e-02   +1.420449516111890e-01   +1.321562720333245e-01   +3.117409941091864e-03   +1.464626831998772e-01   +1.303031985353173e-02   +4.513276687931853e-02   -4.082897038000974e-02; +9.083635195419076e-03   +1.389803311330430e-01   +6.961764490238438e-02   +1.818773429201552e-02   +1.796717317712308e-01   +1.781047152049403e-02   +5.068445333450566e-02   +6.899758960221990e-02; +8.923306930650407e-02   +2.549550998264483e-02   +4.025464899416215e-03   +1.714737225143417e-02   +3.661288514355664e-02   +3.992487518245984e-03   +4.280279744848652e-02   +7.003994384563889e-02; +7.593681071299196e-02   -2.889635119127824e-02   +7.739158443695899e-04   -1.069883812890764e-02   +1.297967954662701e-01   -2.827179356412268e-02   -2.717480934259660e-02   +7.638829046803579e-02; +1.487162214849087e-01   +1.435962756334673e-01   +1.066708172254564e-02   +6.025060126976862e-02   -4.725153802363793e-03   +4.812365063974322e-02   +1.340081038620768e-01   +8.435193672729072e-02; +4.176475863182689e-02   +4.710434094178110e-02   +6.601733072234033e-02   +1.071425039786850e-02   +1.558158048660251e-02   +2.257437935371136e-02   +7.500356365658373e-02   +7.410008804000923e-02; +4.214870218327058e-02   -7.842310228455242e-03   +6.838081847552031e-02   +5.863250327296424e-02   +2.224229078492877e-02   -8.848413817609462e-03   +4.745605954984446e-03   +1.030588265912182e-01; +7.564209918910171e-02   -5.756330689645472e-03   +1.494606679530558e-01   +8.447659002416384e-02   +4.663398377021521e-02   -9.441329050110657e-03   +6.292398440237355e-02   +6.810047881335278e-02];
L2I_L3I_iGABA_netcon = [+6.706874678121261e-02   +4.064831166296962e-02   +5.377544234633298e-02   +6.369718749492943e-02   +4.793470635721778e-02   +7.141966823570849e-02   +7.107226857529552e-03   +7.093700617736234e-02; +3.558545273122402e-02   +1.335480316843571e-01   +6.757763057508498e-03   +1.194055000366761e-01   -3.562717232780949e-02   +9.900978809379198e-02   +2.673077279593734e-02   +5.650420920795757e-02; +5.283044358561161e-02   +1.387874870096540e-01   +9.427309342198779e-02   +8.682074016777527e-02   +3.351401255787505e-02   +4.363308271302540e-02   +8.556904556630242e-02   +1.390541800857165e-01; +7.556295950245714e-02   +1.539779072521648e-02   +7.024036484320927e-02   +6.560790120178249e-02   +2.263743356170958e-02   +4.497014963458430e-02   +6.470587102439990e-02   +4.939594186112239e-02; +5.751918078857618e-02   +1.429521459084928e-01   +1.167722086203117e-01   +1.348798703576858e-01   -1.189959017845645e-02   +8.249215595113775e-02   +9.396909544548543e-02   +1.826240796449184e-02; +1.116965163847841e-01   +9.940971842195495e-02   +7.066869616019768e-02   +1.507476893912832e-01   -6.200746302603533e-03   -5.922116449826769e-03   +1.015960043261185e-01   +7.024181320793686e-02; +3.304288056875244e-02   +1.043364776799968e-01   +2.238681820637055e-03   +1.155803529361316e-01   +1.046548197454499e-02   -2.146018214688305e-04   +3.588898427738956e-02   +5.425639443883630e-02; +2.097358570495700e-02   -2.044485795352546e-03   +8.924609402033928e-02   +7.954048407884010e-02   +1.249388236035812e-01   +2.227258312028166e-02   -1.354897111176752e-02   +2.046820976173877e-02; +4.286702254007967e-02   -1.987963963850219e-02   +9.623977879090370e-02   +1.808275061172577e-01   +9.062547378110532e-02   +3.477919817863467e-02   +2.499274581360446e-02   +1.315698681637026e-01; -1.139300523799667e-02   +1.403020755696509e-02   +3.142774166381777e-02   +1.035873052492646e-01   +1.074721432452705e-01   +4.127862908847649e-02   +1.071882778964776e-01   +5.449233672079165e-02; -2.637291215139685e-02   +1.690477523531141e-01   +1.511414892133797e-02   +9.161300632590084e-02   -6.972197743683010e-02   +7.529349539486838e-02   +1.850587544280743e-03   +1.137034106948588e-02; -5.694531951304949e-02   +1.527463250093932e-02   +8.293956627088803e-02   -3.118435918847282e-02   +8.674919904086774e-02   +9.428831055666598e-02   +4.184182086492076e-02   +2.145805483510969e-02];
L3I_L3E_iAMPA_netcon = [+4.871197116094741e-02   +3.847479203888172e-02   +7.680587473333497e-02   +1.103137873180070e-01   -6.751675121088709e-03   +1.133066399136860e-01   +7.315812566381891e-02   -9.675573053034717e-03   -1.825651632474638e-02   -2.771164777209500e-02   +1.225582258152139e-01   +2.387954541987176e-02; +5.382144923786666e-02   -5.517075373297846e-03   +3.053044490925982e-02   +1.539212055389350e-01   +6.109480227978793e-02   +6.182905647020933e-02   +7.855830190979828e-02   +8.722289208300958e-02   +4.939135469219710e-02   +3.224725224437931e-03   +5.928479531089085e-02   +9.937465624738923e-02; +1.364096145507673e-02   +1.080173808520808e-01   -2.668132271072143e-02   +2.924372156765950e-02   +1.101865992117591e-01   +1.168790706904721e-01   +3.952049745552709e-02   +3.981932365673465e-02   -4.200390732680156e-02   +1.087229581241542e-01   +4.168625144881528e-02   +9.739849094274219e-02; +1.053694792573441e-01   -1.813217868704927e-02   +1.619242207296090e-02   +9.527974618465607e-02   +2.512605385963510e-02   +1.137904181172119e-03   +7.411691332943691e-02   +7.600463255162898e-02   +1.087794479123913e-01   +9.930282513487194e-02   +8.759195525174505e-02   +6.732043376842603e-02; +2.769293680636994e-02   +1.062981070433477e-01   +2.222502420254566e-02   -3.342407437238949e-02   +8.000248489522891e-03   +2.150933297180951e-02   -5.497315048006558e-02   +8.703229860927339e-02   +5.697844182839104e-02   +4.228444726966781e-02   +9.826348491906428e-02   +1.180981887141727e-01; +5.662852130406781e-02   +8.174062396565644e-02   +8.851126651886933e-02   +1.251614398664170e-01   +9.701823376580069e-03   +6.149298901788269e-02   +3.538940106638928e-02   +4.947249014633109e-02   +4.661518939747740e-02   +8.480103821883042e-02   +9.647218212286252e-02   +7.906950759876329e-02; +5.056317500151063e-02   +6.253461891986918e-02   +1.156944562618540e-01   +6.384779915180025e-02   +6.334512043878696e-02   +4.079292214762867e-02   +1.006981504951843e-01   +1.561480250843104e-01   +4.885195006397951e-02   +1.412263860740200e-02   -2.413786455501814e-02   -1.033976188401652e-02; +1.404945770996191e-01   +8.529561970478515e-02   +6.743834622860417e-03   +1.032301793899762e-01   +3.216744319672703e-02   +1.167799530404214e-02   +7.242529133625704e-02   +1.638220379577011e-01   +2.055083645180601e-02   +1.513505815526284e-02   +2.137513023992901e-02   +1.114138036713640e-02; -3.636792077565017e-02   +5.964536309434904e-02   +1.094545582416313e-02   -1.146025314537752e-04   +7.447505449290970e-02   +1.523913863731159e-02   +6.320133176148560e-02   +1.481459706389009e-02   +6.375323423028816e-02   +8.488662050009302e-02   +6.882805004982584e-02   +1.076322815239319e-01; +1.167405928048602e-01   +2.380955176104786e-02   +7.206754822791318e-02   +6.868363479847557e-02   +3.820915975215033e-02   -1.168152522284093e-03   +3.302578646011354e-02   +1.188439933695971e-01   +6.817377785245579e-02   +2.904463518226087e-03   +3.944950197609676e-03   +4.480015448952819e-02; +9.500080869908152e-02   +4.752434853050065e-02   +6.430122637355842e-02   +2.813228426748883e-02   +2.217864440266256e-02   +8.664858852285319e-02   +9.090131917720903e-02   +1.111876869543700e-01   -2.171197193506431e-02   +1.340432425240487e-02   +2.185743420136824e-02   +4.787325858677767e-02; +1.062709507730397e-01   +4.925151809089100e-03   +6.757425804887152e-02   +1.576037994760366e-01   -4.346286666752207e-02   -4.357789700114091e-03   +1.327695354571765e-01   +3.147853296273730e-02   -3.056508526897043e-02   +8.287599918512443e-03   +1.872247706787394e-02   +1.590209687351852e-01];
L3E_L3I_iGABA_netcon = [-2.069924067119877e-02   +1.009956979875827e-01   +2.771655762349820e-03   +1.507777011578822e-01   +1.395191012494084e-01   +1.035865335259239e-01   -3.228107983715042e-02   +1.909126467385404e-02   +1.502258784364215e-01   +1.075214314589569e-01   +1.190279280401400e-01   +7.004223620904093e-02; +1.864762151473764e-02   -4.082448896949589e-02   +1.491020180863966e-01   +1.004574078586539e-01   +7.598538323099202e-02   +6.130792032324456e-02   +1.039257303440403e-01   +5.567328992026641e-02   -1.659450747791622e-02   +1.350216947275933e-01   +6.867036863805712e-02   +6.392692856934869e-02; +2.725285753905995e-02   +1.075463712811733e-01   +8.864755457380444e-02   +1.276842785529336e-01   +5.239915533857541e-02   +9.878966157672522e-02   +2.136158465931588e-02   +6.203137368485533e-02   -4.822462446420237e-02   +8.841268667347577e-02   +5.228058017344590e-02   -3.683118679317163e-02; +6.850369268849535e-02   +8.860744028328209e-02   -4.343682647714647e-02   +1.105403974342454e-02   +3.444361535266885e-02   +1.538982045467050e-01   +7.171855491090531e-02   +6.477925730470156e-02   +1.271744663768963e-02   -1.184245593944032e-02   +9.340947448677964e-02   -9.410643600431534e-04; +1.161445297896057e-01   +1.099032238206355e-01   +1.542021044234303e-01   -7.599849280759279e-03   +6.056402003160356e-02   +2.145973565596382e-02   +1.228659568749249e-01   +1.733898253698829e-02   +2.718961851068917e-02   +1.590359595453594e-01   +4.751613261029733e-02   +8.250589665668565e-02; +5.236218736223283e-02   +4.183951104404251e-02   +4.444870094544284e-02   +5.097202611046955e-02   -6.397731904969130e-03   +1.554501699356031e-01   +2.337085634015791e-02   +4.975243956644558e-02   +3.239175893434702e-02   +9.918200006601137e-02   +5.255685244611178e-02   -3.480774892495482e-02; +6.518559946948113e-02   +7.465482067160924e-02   -1.275728842080404e-02   -9.856996734905893e-03   +2.895936196685521e-02   +1.435768783871486e-01   +9.476845581291216e-02   +1.164470320604051e-01   +6.163250225246169e-02   +8.141434547401735e-02   +9.763945803570256e-02   +5.106035952062175e-02; +8.265139680093030e-02   +1.066134740743125e-01   +9.720847143108087e-02   +1.603172255697870e-01   +1.070143129609873e-01   +2.715544247152919e-02   +1.938425892727551e-02   +6.832527073746290e-02   +2.940030177423626e-02   +4.676065628352168e-02   +8.693660479550439e-02   +6.335068598416485e-02; +9.378318321677888e-02   +4.998465203101121e-02   +5.633982409048563e-02   +3.249307893000859e-02   +1.366883535450905e-01   +6.871060019930975e-02   +3.698562737698169e-02   +5.794110647234101e-02   +5.880858813161818e-02   +1.332492583301300e-01   +9.273101741253179e-02   +8.000244837913467e-02; +5.281451249310200e-02   +2.255223176103669e-02   +6.430179093769488e-02   +4.699435325004850e-02   +2.751341815801620e-02   +5.988862033038729e-02   +3.629815982649989e-02   +2.695551992653787e-02   +1.652157466883226e-02   +1.281368895782635e-01   +2.667443336503202e-02   +8.876365495779363e-02; +9.885129398085105e-02   +5.283020776151082e-02   +1.412218465860261e-02   +1.444534494445935e-01   +3.327556251503534e-02   -1.589398025524029e-02   -1.790510031508306e-02   +7.507886719797131e-02   +1.729588291858496e-02   -5.715954498499291e-02   +1.580014109242764e-01   +1.337212203313278e-01; +8.144810036249628e-02   +9.625970061416815e-02   -2.208964411996178e-03   +7.637131999264335e-02   +1.151176357016890e-01   +2.898890776348659e-02   +1.049128356883130e-01   +7.389897090151676e-02   -8.707520616307292e-03   +3.438667776231565e-02   -4.277997752762146e-03   +4.192212449996571e-02];
L2E_Input1_iAMPA_netcon = [+7.878821472218127e-02   +5.509204590156742e-02   +6.601045337639629e-02   +6.208854826606974e-02   +7.294423028391492e-02   +2.198411874012490e-02   +8.296291756129402e-02   +1.092981390355105e-01];
L2I_Input2_iAMPA_netcon = [+6.955933698872861e-02   +4.251203501801812e-02   +1.699836742540992e-01   +4.474007910037467e-02   +9.372245676194782e-02   +1.149200183968281e-02   +1.034378948689093e-01   +1.213242689929594e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.04*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.5*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.1*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.5*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.1*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.5*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.04*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.5*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.1*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.5*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.1*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.5*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
