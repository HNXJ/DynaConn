function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+3.545956274682898e-01   -1.731683060919242e-01   +1.455240165389907e-01   -1.761576641233740e-01   -4.552962824122747e-01   +1.212025970317564e-01   +7.419335685708554e-01   -3.884689750418135e-01   +3.599995193064459e-01   -8.583285142792940e-03   +2.156412271407641e-01   -8.775290892217696e-02   +1.957708644084506e-02   +2.528699380347375e-01   +1.439938006817524e-01   -4.886730430278507e-01; +1.187258913009599e-01   +8.006015727116685e-03   -4.009423489531649e-02   +9.424712474635184e-01   -4.237548620537577e-01   -1.414431935816132e-01   +6.973349462064228e-01   +5.817165138113847e-01   -6.002031657351135e-01   -1.931310072887385e-01   +2.483781622428041e-01   +5.430138096328513e-02   -6.498486535898991e-01   +7.949163228411984e-01   +7.198487608811240e-01   +6.341519243696585e-01; -7.651502416556411e-01   +7.761302499942745e-02   +4.807046560294503e-01   -2.523185285276212e-01   -1.022320042460919e-01   +1.296203152025510e-01   -3.686979850924444e-01   -8.896928333999062e-02   +7.984424611916047e-02   +3.942858627866030e-03   +3.347816075008411e-01   +4.105034346506412e-02   +5.164900860979931e-01   -9.233773093901404e-02   -4.181947249210751e-01   -3.173364487226281e-01; -8.693128115261775e-01   -1.534231358810924e-01   -1.920536947151891e-01   +3.006145743217278e-01   +8.463187365361255e-01   -1.629433821771053e-01   +7.217583683644602e-01   +5.321978580345538e-01   +2.015061952575132e-01   -4.251935184414957e-01   -4.441534891823247e-01   -2.360520622726386e-01   +4.938344922743057e-02   -3.039407639649132e-01   -1.339694112685274e-01   +8.398947597962925e-02; -3.048892425438369e-01   +1.686867644282197e-01   +3.746828325629212e-01   -8.566930254200122e-02   +2.571561067888135e-01   -9.046364595310963e-02   +2.867580922386686e-01   +2.473127066196906e-01   +4.533129181955516e-01   -9.996059769644791e-01   +6.667208388935164e-01   +2.288177726440813e-01   -4.805488471382260e-01   -5.293915157278911e-01   +1.725901874308137e-01   +2.281261642113772e-01; +4.971953584041428e-01   +4.256583549109887e-01   +3.202966512333301e-01   +3.400631151102452e-01   -1.833969952064758e-01   +1.144402381328780e-02   -5.628553088921417e-01   -5.724993868613490e-01   -2.778846891060228e-01   +6.855544321174791e-01   +5.605982807014174e-01   -4.789878484510220e-01   +4.510005827065477e-01   +8.216663338815692e-01   -5.749625222160846e-01   +1.546799176450596e-01; +1.507921288481019e-01   -4.291177228293287e-01   +8.892445326551929e-02   +2.185744310410545e-01   -1.178653697007625e-01   +3.599726767970474e-02   -5.802921720324566e-01   -2.733830417718340e-01   +1.244084993378647e-01   -1.171182379022302e-01   -6.219726488989550e-01   -4.018230774822830e-01   +5.104134472670206e-01   +1.541179763437993e-01   +1.266501764208215e-01   -2.341279355016657e-01; -4.673913460988444e-03   +3.418332651860967e-02   +3.310071650427521e-02   -2.973753820804381e-02   -6.465500254533140e-01   -7.874764819420099e-01   -2.683426967032197e-01   -1.289491991955025e-01   -3.237476533842732e-01   +4.247153523846869e-01   -5.087636089263222e-01   -9.402945137784311e-01   +3.784739314537803e-01   -2.441092640769250e-01   +1.796527267323080e-01   -1.787373498437717e-01; -2.237458555600774e-01   +2.184624196113867e-01   +3.475511269450614e-01   -5.158120429492422e-01   +2.864505254429240e-01   +7.974854486849883e-02   -3.598612295506676e-01   +2.244224086027104e-01   -5.530840578213465e-01   +1.381724372811046e-01   -5.736759217162547e-01   -1.742596573668356e-01   -3.893041904069834e-01   +1.552709461681434e-01   +3.864810252783759e-01   +3.137170620783779e-01; +3.566558463721161e-01   -5.990287738547222e-02   +3.214322590615747e-01   +2.101502961331346e-01   +5.578658610354883e-01   +5.006123547061431e-01   -1.676036686041856e-01   -8.317924296838155e-01   -1.383105234930581e-01   +9.840604888651733e-02   +2.579214019268210e-01   -4.111213251264563e-01   +2.555740206564955e-01   +2.812845128187134e-01   +4.151870997326496e-02   +2.432463629630097e-01; -1.845481027422075e-02   -4.144544665241637e-01   -6.670045838983150e-01   +2.960910701493441e-01   -3.431943257258543e-01   -3.814440679580332e-01   +2.450420837662892e-01   +2.337711992660748e-01   +7.822236296846063e-01   +2.251929738331260e-02   +4.976711651163512e-01   -9.329075240116138e-01   -2.716527133236571e-01   +9.023677454398540e-01   +4.566332517671704e-01   -7.700281459526613e-01; -1.957134322714891e-01   +2.060347071486458e-01   +1.742240440356725e-01   +1.768997149790550e-01   -7.952796924870162e-02   +6.309792975352743e-01   -5.985773476355594e-01   +7.631401429546156e-01   -2.655901730358241e-01   -2.911065732487220e-02   +5.117429739761430e-01   -5.644212071013277e-01   +1.833646429405936e-01   +2.129253873540216e-01   -3.173321407854203e-01   -1.535420690320633e-01; +3.106137301247299e-01   -1.708688642085039e-01   -5.652612272549538e-01   -6.071957274770233e-01   +4.429521137659593e-01   +7.502814335025819e-02   +3.969195563812215e-01   +3.600932360416412e-01   +6.314276560980977e-01   -3.345255869852715e-02   -1.449755380270968e-01   -4.074697431676827e-01   -1.288634053807248e-01   -3.755285396384749e-01   -3.674949628318125e-01   -8.338092582700305e-01; -6.778447320871748e-01   -5.115007829754689e-01   +6.355407202407520e-01   +1.748974352152965e-01   +8.755390561071836e-01   +5.936701708150367e-01   +6.277636120956187e-02   +2.314910497647611e-01   -5.771492713430638e-01   +5.609425523522920e-01   -9.921980571135736e-02   +2.659122420802724e-01   -6.391684636909530e-02   -3.722007114398074e-01   -4.877148981918165e-01   +1.913826296848789e-01; -2.502765047281410e-01   +9.928331622493767e-01   -1.768519524116357e-01   -4.537808881925692e-02   +7.458317218239634e-01   -1.571330620219353e-01   -8.738363299997952e-01   -9.423983948877526e-02   +4.217074966040451e-01   -1.717602439429507e-02   +7.481612720999147e-01   +8.068590692889086e-01   -6.370344027903436e-01   -4.051296574943477e-01   +1.852945048481952e-02   +3.032886530020811e-01; +1.056640472251600e-01   -3.737679705831226e-01   +4.437579524571069e-01   -4.533040479989828e-01   -4.748708351561005e-01   +8.222582189557969e-01   +4.753047766360734e-01   +6.662269478718058e-01   -2.271656159690391e-01   -1.779308733318635e-02   +2.413126405122212e-01   -7.945189286999268e-01   -2.628448092537493e-02   -3.744494608626286e-01   -2.761724414036388e-01   -2.737772278759253e-01];
L1E_L1I_iGABA_netcon = [+6.458625783719560e-01   +1.619464416320851e-01   +6.447297055066888e-01   -1.246839131433081e-01   -4.855653701034274e-01   +1.455254411154261e-01   -3.660259317250745e-01   +2.372271294380557e-01   +2.080552921464467e-01   -4.226182025350906e-01   +6.371880532382536e-02   -2.189179094461952e-01   -1.039463325238745e-01   +3.438327175315465e-01   -1.418092522386726e-02   +5.013834150068467e-01; +5.870371842976596e-01   -1.606592084437626e-01   -4.100438222926132e-01   +3.759632491519229e-01   -1.993788508951994e-01   -5.280018942603200e-01   -8.049090073936109e-01   -7.005993769634273e-01   +4.019141432934290e-01   +4.524170149441791e-01   +3.520185075492609e-02   -4.947968081657793e-02   -7.695425774625387e-01   -1.921523932779401e-01   +6.005683003320669e-01   -1.116149581514272e-01; +2.881437778227800e-01   -2.585728305214581e-01   +4.783766346503140e-01   +2.529360047035877e-01   +6.370537270229620e-01   -7.537810441749034e-01   -4.319762605821496e-02   +4.500316757732580e-01   -4.427284265996364e-01   +3.019582538584546e-01   +4.390273974330387e-01   -2.537120933684571e-01   -2.131569738866395e-01   +5.464664670383102e-03   +1.689748097835987e-01   +9.036030340440394e-02; +6.384771425230857e-01   -7.487422562172824e-01   -6.462260470916978e-02   -7.500101365445639e-01   +3.018748751832881e-01   +8.907674913025182e-02   -7.571642075378003e-02   -4.616676301772995e-01   +2.361372540870152e-01   +6.512632942546355e-01   +4.337581003737661e-01   +2.338885207840660e-01   +4.466449878135331e-01   +6.545351310529834e-01   +3.134128118235580e-01   +2.101676762509839e-01; -4.075973934023223e-01   +6.869046789729444e-03   +5.572084796622535e-02   +3.987004799058423e-01   +5.996673684997113e-01   -2.372843448091534e-01   -1.431396260542763e-01   +9.756494691453635e-02   +1.129987643142315e-01   +2.608876635605150e-02   +2.688867434846615e-01   +2.160642459070772e-01   -2.685856772680862e-01   +1.198199703546778e-01   -4.894194371052468e-02   +2.768246413253551e-02; -1.209248993664894e-01   +6.586427244709946e-02   +6.647725728470638e-03   +2.125710446078536e-01   -3.892439396248097e-02   +9.050412615181486e-02   -5.252554758881962e-01   +4.795964403476118e-01   -4.208163114063617e-01   -1.654611610350603e-01   +4.135120066802845e-01   +2.420726427522217e-01   +7.030023054589590e-02   +7.929925072561576e-02   -1.915525763111147e-01   -2.758214074434398e-01; +4.851682526676509e-01   -5.561001337564453e-01   -5.676594894600372e-01   +1.569652728809161e-01   -3.264815407927859e-02   +9.639195377889423e-02   +5.248709934953926e-01   +2.165636020709912e-02   +2.514273210783615e-01   +1.046437764167388e-01   -2.941211624951683e-01   +2.955421362478581e-01   -2.842249466677978e-01   +4.236975545382087e-01   +2.540020929084023e-01   -3.746446100429897e-01; +4.191567963773825e-01   -2.988063546294981e-01   -4.758288653231661e-01   +2.466409344653258e-01   -8.651494080847834e-01   +2.185499045300475e-01   +5.473694004775179e-01   +3.125157244894971e-01   -4.171936103803152e-01   -6.623017134692205e-01   -6.272753423622737e-01   -2.991434820534641e-01   -6.416388033399920e-01   -4.621009701706767e-01   -1.786767833743810e-01   +7.533052859604552e-01; +2.968014143271973e-02   +2.768403776844069e-01   +8.342581467012010e-01   +1.765683078810818e-01   +4.396345522491912e-01   -1.836511720827182e-01   +4.360291082816565e-01   +7.511330168267872e-01   +6.821003554175391e-01   +2.439063298158243e-01   -3.850277340669963e-01   +1.900049700991319e-01   +5.695986225084981e-01   +2.048533575362709e-01   +4.948505411706007e-01   -3.481055591964577e-01; -2.314205193119024e-01   -6.787927897798509e-01   -1.466007336096997e-01   -4.649344471349838e-01   +4.167465848109280e-01   +4.467655384367890e-02   +1.852976622592288e-01   +5.421387810784752e-01   +1.896755242727461e-01   -6.470085392398238e-01   +3.777717527766796e-01   +3.483974936273140e-01   -1.288910865198726e-02   +2.560244929980192e-01   +7.554501913333781e-01   +1.346850333519836e-01; -3.769647164792030e-02   +6.426801280399821e-01   -4.265637673169139e-01   -1.874428513634397e-01   -2.508655671329658e-01   -3.066374981372529e-01   -1.958828278761188e-02   -4.446604056970889e-01   +3.560883846637922e-01   -4.864938777265136e-01   +7.621799881098047e-01   +1.338625859332996e-02   -9.522829565580265e-03   +2.781519455272193e-01   +1.980446547322310e-01   -1.674496535223099e-01; -8.045458061927891e-01   +4.382863639373585e-01   -3.764900356061122e-01   -2.213698535907108e-01   +8.989039390203432e-02   +5.180518804151850e-01   +1.405427454936804e-01   -1.559093472106977e-01   +9.804721915761198e-02   +2.979296157258743e-01   +1.692661398303543e-01   -2.600149319789157e-01   +2.597700705003881e-01   -2.351666490997615e-01   -4.653045563217497e-01   -9.693005518095775e-01; -1.010941971225409e-01   +2.093135700493496e-01   +1.140006518099796e-01   -1.549353197984796e-01   -4.476536852113099e-01   -7.152806458384119e-01   +3.618171764713253e-01   -3.524066726405458e-02   +4.894639837768712e-01   +7.226845180910623e-01   -3.646825927060689e-02   -1.000000000000000e+00   +5.137108713413769e-01   -6.143911293894411e-01   -1.506223258991094e-01   -2.334998641118321e-01; +4.170637280987078e-01   +1.088116793096681e-02   +1.849617326147326e-01   -6.930266530734176e-01   -2.768418354610480e-01   -1.816378040533227e-01   +3.306713213032274e-01   -1.153460412479443e-01   -1.080515574726916e-01   -1.753077375415432e-01   +1.032993644341683e-01   -3.159469253506749e-01   +1.331533506131181e-01   +5.943301919373223e-01   +4.440039778684965e-01   +5.783441403429468e-01; -2.722635075919310e-01   -1.947608669909557e-01   -2.150758976766684e-01   +4.781080915448870e-01   +2.913195666196482e-02   -1.875965721090115e-01   +3.713367351018854e-02   +1.842427536668290e-01   +3.524031262768400e-01   -4.823742823127848e-01   -5.382399409041835e-01   -9.040426126184223e-02   +6.135702833773762e-01   -2.632878411914659e-01   -2.139892065350951e-01   -3.418252810713100e-02; +1.001225431735664e-01   +2.624111512090871e-01   +8.751885084138564e-01   +4.211678034292869e-01   -2.170391076421854e-01   +1.303253928412773e-01   -4.537580541666720e-01   -6.690410296698213e-01   -3.946514138421124e-01   +3.688115677787973e-01   -6.149698896184962e-01   +2.941621608453016e-01   -1.241570332286804e-01   -1.663788035227968e-01   +2.745334058986283e-01   -2.430830324796603e-01];
L2I_L1I_iGABA_netcon = [-1.682852630407335e-01   +2.865472138016434e-01   +7.417240280373520e-02   +1.340347154916702e-01   -4.317357993004181e-01   -6.148669568159798e-01   -4.269011391078187e-01   +1.217732686243208e-01; -8.982577065163075e-01   -6.896943468317174e-01   -7.391170703090141e-02   -1.463728526394296e-01   +5.708541262201881e-01   +5.798619993893110e-01   -2.989311202278049e-01   +2.385967854104726e-02; -6.026170976593770e-01   +3.642949476780841e-01   -2.661813288604335e-01   -4.795504241623015e-01   +2.153906398092353e-01   -3.321064826947820e-01   +3.221070838447227e-01   +4.535402509049030e-01; -4.182279057492026e-02   +1.268446051596837e-01   -3.551312532138479e-01   -4.053578309469817e-01   +8.396910370030736e-02   +7.432842304757425e-01   -6.780814029466615e-03   -1.273564941219526e-01; +4.472840527201631e-01   -4.581219004235552e-01   +1.000000000000000e+00   +1.283019436403303e-01   -1.082828722495107e-01   +7.130875137475902e-01   -3.049681546381386e-01   -5.830066242108044e-01; -1.553648944524016e-01   +5.356633776171879e-01   -5.965606128483157e-01   +9.644025737816443e-02   +1.321624804544284e-02   -4.554567314740605e-01   +1.588267711127924e-01   -3.244701400495317e-01; -2.210532707569203e-01   -3.909496882420207e-01   +3.814437935855936e-01   -1.635222482609239e-02   +1.318519350166701e-02   +1.493658771156889e-01   -9.971638953247795e-02   +8.028921999621299e-01; -5.342312533642335e-02   -2.841235039036174e-01   -7.280698936054942e-01   +4.721738602377472e-01   -1.272437347412414e-01   +7.749116322177473e-02   +1.603845982323686e-01   +2.138588274677159e-01; +1.887258598946698e-01   -2.633238042294929e-01   +6.373740339138978e-01   -1.902951141543155e-01   -4.257963138568323e-02   -1.200909972536958e-01   -3.815771939913959e-01   +7.952399234305164e-02; +3.455651491232823e-01   -1.209961956178146e-01   -2.763872559564185e-01   +6.303410651755663e-01   +5.814229857416797e-02   +1.558808779028989e-01   +5.601208320714509e-01   -2.247314413692846e-03; +2.115058581165625e-02   +5.095767425616378e-01   +4.029963089933720e-01   +7.569056527298790e-01   -5.594884989347207e-01   +6.319865938837050e-01   -4.455352767762609e-01   -5.545337575505869e-01; -1.811851851381932e-01   +9.761116383079971e-02   +2.970136020175849e-01   -1.345683877996676e-01   +4.588034071360101e-01   -1.770776451016188e-01   -4.512296015442895e-01   -8.421805820435223e-02; +5.674541510413370e-02   -4.380224154127304e-01   -9.174606495098635e-02   -3.800658844361595e-01   -3.517290403382133e-01   +1.578499785084225e-01   +1.374261504207727e-01   +2.925161205775051e-01; -6.905888688150360e-01   +8.536373243512339e-01   -2.518927587863344e-01   +1.508770818317434e-01   -2.357203783771541e-01   +1.399970250106262e-01   +1.851785788887180e-01   +4.727589892752951e-01; +2.960376515278548e-01   +2.438720950228680e-01   -1.761711328323021e-01   +7.585510407159407e-02   +3.371694265199285e-01   +4.932021910309916e-01   +5.862195269812141e-02   +3.287366408662877e-01; +2.381443296347469e-01   +1.743809376159760e-03   +4.078862464918830e-01   +8.562651870190972e-02   +1.568911133363826e-01   -4.051088433395699e-01   +2.602552306540490e-01   +6.866168167319520e-01];
L1I_L2I_iGABA_netcon = [-1.914266322262885e-01   -8.144536869474898e-02   -2.657020024686473e-01   -9.628640911182986e-01   -8.508518642086718e-01   +6.074815312027106e-01   -7.237217338665695e-03   +3.276941392711876e-02   -3.965631887362732e-01   +8.611513082686636e-01   -3.159746647527057e-01   +1.648205259749794e-02   +2.706258938555203e-01   -1.600158288004502e-02   -1.322675476901016e-01   -3.630875522161282e-01; +7.344963718074132e-01   -2.102905199130457e-01   -3.022813123224065e-01   +2.627697872366002e-01   +4.737272698931936e-01   -1.682528817352227e-01   -1.383625455260551e-01   +2.144064389984514e-01   +2.828419168606469e-01   -2.380963790583406e-01   -8.317322547306656e-01   -5.811983464198245e-01   -6.808796344736914e-01   -4.575430949649472e-01   -2.677452026248278e-01   -3.667216583149815e-01; -5.261239024135291e-01   +3.793083778373971e-01   -1.031738509038278e-01   -3.576583691724811e-01   -4.238786821606667e-01   +9.595175025817741e-02   -1.042293736765155e-01   -6.956591956274898e-01   -9.285117080886868e-02   +7.362841912225021e-01   -4.850662512874926e-01   -7.706170940374590e-02   -9.148332116537759e-02   -1.335072501059428e-01   +8.053801306536834e-01   -4.749128501787993e-01; +4.128925180599147e-01   +2.713297815792053e-01   -9.043420558661706e-02   +4.243367380772468e-01   -6.122856972821965e-01   -4.455637614506764e-01   +3.739144598145818e-01   +1.945251949419088e-01   +3.693790649680027e-01   +7.114611645122381e-01   -4.614454500510660e-01   +4.272920226567802e-01   -7.133980517854971e-02   +7.976228676727924e-01   +2.461251047089757e-01   -2.145142888263846e-01; -4.924806389066862e-02   +8.763440256042150e-03   +1.433540902997484e-01   +6.157279994656570e-01   -6.803143943977046e-02   +5.785461680481205e-01   -4.508355641600360e-01   +5.628790488793951e-01   +5.421791490590949e-01   +1.125730802338646e-01   +2.277665153646580e-02   +2.008007155337856e-01   -1.939152019821531e-01   -4.143191655611924e-01   +5.636149275563045e-01   +1.000000000000000e+00; -4.263981485054968e-01   -6.297618358616835e-01   -2.990595529132833e-01   -3.206893488206766e-01   -3.112840682287811e-01   +6.297600922060876e-01   +3.922319633921884e-02   -4.087748465265130e-01   -9.234281459452715e-02   -4.775152888960191e-01   +3.816769774076230e-01   -3.917202209861866e-02   -1.211082204601332e-01   -2.827530467558754e-02   -2.729528539951976e-01   +7.156434053972804e-01; -2.119510250486412e-01   -4.616674449742519e-01   -2.131467929011164e-01   -5.607513005558216e-01   +2.223291034808387e-01   -1.200815293734938e-01   +1.196821833722679e-01   -4.619386116151390e-01   -1.251227535210005e-02   -8.047935933951964e-01   -9.746867529174069e-01   +5.431792144382529e-01   +3.841941793149231e-01   -2.681432787023131e-01   -6.185827719301901e-01   +7.009803618463135e-02; +3.503713519450921e-01   -6.148284309116639e-01   -4.500466002563919e-01   -2.613563967544622e-01   -2.071619392711761e-02   -3.984040524540200e-01   +2.443405556143728e-01   -2.384626801745343e-01   -4.031205298468897e-01   +7.569452122575827e-02   -1.925160587736373e-01   -3.747854740918236e-01   +4.244631916721667e-02   +2.186912577954042e-01   -3.215287051318327e-01   -6.759399667154764e-01];
L2E_L1E_iAMPA_netcon = [+1.685914762244334e-02   -2.854287594780430e-01   -8.449828099244443e-01   +8.095427627827945e-03   +1.271640670273144e-01   +2.470944875654361e-01   +4.287131610583637e-01   +4.780305140884861e-01; +4.375360968503661e-03   +1.447718399592272e-01   -6.077382648178642e-01   +3.024828147414156e-01   +1.534395348791658e-01   +7.411258937851549e-01   +8.009760246099165e-01   +5.923732208732095e-01; +6.663668339975874e-01   -1.529727962096287e-01   +1.721186131511752e-01   +8.788991692767019e-01   +8.549890090807827e-02   -4.991468700260856e-01   -7.228973046548015e-02   -7.302075556080667e-01; +4.830518675492134e-01   +1.042978605663824e-01   -2.932636920278012e-01   +4.251834060970757e-01   -1.059634118028591e-01   +6.662537208978297e-02   -2.888580619926706e-01   -4.894603849894466e-01; +9.943311498270280e-02   +4.423884294123935e-01   +3.157138025390017e-01   +3.959058095819556e-02   -1.901601534674915e-01   +4.737371421890023e-01   -5.268875463215319e-01   -8.378551781107538e-01; +6.675852464836687e-01   -1.738125515034142e-01   -6.131019278799095e-01   +3.916778660041526e-02   -5.189634143446542e-01   -3.493022534274632e-01   -2.583461788414374e-01   +3.932797443074676e-01; +5.041942177255511e-01   +2.794909840634027e-01   +3.277337555296239e-01   -4.251757157727782e-01   +8.333365607054963e-01   -1.447317991338364e-01   -3.509282389085739e-01   +4.054483232381622e-01; -2.023150258363641e-01   -2.602188457323881e-01   -5.080673247984622e-01   -2.850902171243899e-01   +4.975000717649567e-01   +4.956336709150196e-01   -6.424782256655033e-01   +4.304062723864262e-02; -4.121496336590484e-01   -3.758336402439324e-01   +5.744985793619877e-01   +2.812012545183322e-02   -5.861543028252780e-02   -6.857191268849792e-01   +5.638144220461489e-02   -1.656726705555209e-01; +3.965170578999377e-01   +1.405024997259710e-01   -3.356310273447889e-01   -1.582479319565025e-01   -4.886605721531883e-01   -6.059107690475990e-01   +4.847542955612138e-01   +3.648550387513644e-01; +1.705806361687252e-01   -6.056783663279705e-01   +5.813806946099237e-02   -6.694245619691908e-02   +2.912917040160037e-01   +3.036226412526863e-01   -6.548001973939814e-01   -6.409797136073232e-02; -7.231130859509782e-01   +1.766679077556104e-01   +9.549868802742836e-01   -6.704803099995402e-01   -1.944003061420225e-01   -2.626274810669496e-01   +2.636072558188587e-01   +8.163017815743741e-01; +8.259188054792129e-01   +3.234330356375593e-01   +3.118202680174835e-01   +7.410434236632932e-01   +5.762345862998277e-01   -2.031256165110115e-01   -6.217421329451833e-01   -7.127600795649878e-01; -1.277365511913311e-01   -2.148130192881129e-01   +5.827773440102785e-02   +6.208397458039829e-01   +1.508438041207063e-02   +1.088659496179448e-01   -1.258203869222576e-01   -1.944770244575675e-01; +5.448707074677444e-01   +4.576521765984862e-02   +2.843445569146699e-01   +5.749472898856135e-01   +6.683995227390764e-01   -2.823847530325614e-01   -7.613911605819889e-01   -1.110205929794189e-02; +2.550660821355948e-01   +5.121407290744884e-02   -2.690658519193646e-01   +1.765434335657118e-01   +1.014477520087168e-01   -2.440949466010969e-01   -1.756000446275666e-01   +1.093883194261767e-01];
L1E_L2E_iAMPA_netcon = [+3.763120766091604e-01   +7.589992667407142e-01   +3.058415762777004e-01   -2.881633730990518e-01   +4.919690206466087e-02   +2.986416022663120e-02   -1.234723888306977e-01   +8.796920487466200e-02   +4.965876818392445e-01   +2.108355654472217e-01   +2.056598902754216e-01   -6.771870133050821e-03   +1.298330396166741e-02   +5.728807876716161e-01   +1.114230669552789e-01   -6.382060332275529e-01; +4.792724142016693e-01   -1.781984214371607e-01   -5.139808690808643e-01   +9.335385203621636e-02   +1.177483257629829e-01   -2.532512643924115e-01   +1.294096219743536e-01   +1.247255094674589e-01   +7.705762843459166e-01   +3.812253173175067e-01   -6.448218742262778e-01   +3.267455488710713e-01   -3.431700278164135e-01   +4.531355314619255e-01   +6.042363557943617e-01   -7.432546241025498e-01; -4.270102479679614e-01   -2.519078079058589e-02   -1.954165882140267e-01   +3.367884787060758e-01   -4.943637129976137e-01   -2.567399679122163e-01   +1.689467556195761e-01   -4.759964246278922e-01   +4.908878557842393e-01   -4.293206371447545e-01   -8.904052976102517e-01   -6.312799105474172e-01   -4.007802270149569e-01   +3.594428092703343e-01   -5.143041257847971e-01   -3.561132657135413e-01; +6.284539508402465e-01   -2.509330814606522e-01   -3.945492637520133e-01   -1.945231648750143e-01   -8.191207497420174e-01   -2.649119785607320e-01   +4.328479274917340e-01   +2.356972731642409e-01   -8.516415444839283e-02   +6.003335671024373e-01   -3.711541364980918e-01   +3.273524845776493e-01   -1.863939543267600e-01   -4.817771759356524e-01   -3.692691024406293e-01   -2.943081057059678e-01; -2.910849395348405e-01   -1.270740404428744e-01   -3.119568784836180e-01   -9.013938876516787e-02   +5.995079526357532e-01   -6.704376076288561e-01   -9.833571049671430e-01   -4.876750281455657e-01   -9.212552016776497e-02   +1.000000000000000e+00   -1.194310662917699e-01   -4.252566198998552e-01   +2.446346340989018e-02   -1.324592677183457e-02   -4.941017607588943e-01   -8.029911171471432e-01; +4.364238459281320e-01   +7.683991417499518e-01   -4.469379022696424e-01   +7.401337643949617e-01   +7.577778325265613e-01   +5.282125869217838e-02   -3.940273698566196e-01   +4.018739478918786e-02   -2.181644501256324e-02   +3.089856968334190e-01   +7.583938049513012e-01   -4.201164271514592e-01   -1.717383880453808e-01   -6.099018991638259e-01   -1.143392953335585e-01   +3.029007959537998e-01; +5.820802077129998e-01   +3.292957355968006e-03   +1.194382246092546e-01   +3.958959117057549e-01   -2.910750377325860e-01   +1.073636255616031e-01   +4.264366165092073e-01   -9.951386298112860e-02   -2.855382067967135e-03   -4.862366940733434e-01   -4.752622241964994e-01   +3.052004416995750e-01   -3.418604371932809e-01   +4.507832414546339e-01   -9.373637619474438e-02   +5.214815437305507e-02; +1.811036011818538e-01   +2.382871655158488e-01   +3.371902629592208e-01   -2.772851757265946e-01   -2.220157343940909e-01   -5.422880507757324e-01   -4.417402938110702e-01   -2.151488582173906e-01   -4.582562169669643e-01   +9.757525636718377e-02   -3.484641958714382e-01   -4.996995836491561e-01   -1.558063124165310e-01   +4.487920599428526e-01   -3.214877984718988e-01   -1.161620465083849e-01];
L2I_L2E_iAMPA_netcon = [-1.121312787352660e-01   -5.416202200421810e-01   -7.123240203174737e-01   +4.895119603418314e-01   +2.074022409998354e-01   -3.083809448152891e-01   +2.054508957524362e-01   +6.567366343019518e-01; +2.537771695382589e-01   -6.524517379153504e-02   +2.286151329709838e-01   +5.356218382195400e-01   +5.422721399114596e-01   +7.397509899904378e-01   -5.271592650473830e-01   -5.079987080171167e-01; -8.227335694026172e-01   +1.404334369171912e-01   +1.482443423173607e-01   -5.760295217826453e-01   +1.030337773495174e-01   +4.555484067357671e-01   +5.485931934675993e-01   +1.000000000000000e+00; -1.991404884975604e-01   -1.891805380883324e-01   -6.292185478941787e-01   -4.035917117509399e-01   +1.763241257406845e-01   +2.462473658396265e-01   -4.939721287195276e-02   -5.571945232460980e-01; +2.104381986273036e-01   +9.731425280228088e-02   +5.506833555415483e-01   -3.000493646359856e-01   -5.468571929958015e-01   -1.295620806664604e-01   +8.284985610669271e-01   +4.821541956505013e-01; +2.857897888154590e-01   +7.871363694866494e-02   +2.984947452636446e-02   -3.540657917272947e-01   +2.470278043868226e-01   +3.483604779484232e-01   -8.323605391546435e-02   +3.121490999955078e-01; +6.316110136944393e-02   -4.369813056929370e-01   +2.413000832329082e-01   +4.232338341410914e-01   +2.736119220260982e-01   -4.694178144807740e-01   +5.381745623906203e-02   -1.570634972114802e-01; +5.970028528676884e-01   +5.875743941740361e-01   +1.769808246317880e-01   +1.830017254430276e-01   +8.823268034130047e-01   -8.065612759874533e-02   +1.216905271859328e-01   +6.403330662698813e-01];
L2E_L2I_iGABA_netcon = [-1.846403837035132e-03   -5.874054941101394e-01   +2.024664640574335e-01   -2.648238253317281e-03   -6.879086111322134e-02   +3.771691243863128e-01   -1.253071392181151e-01   +1.939936056291010e-01; +4.035420190421209e-01   -3.067319824315034e-01   +3.635597529241014e-01   -6.386680289045606e-03   -3.435163608658868e-01   -4.957392580562032e-01   -2.096578812113055e-01   -7.217569815276195e-01; -1.836959256034840e-01   -2.747081889614422e-02   -2.903345915595065e-02   -2.283914631217886e-01   +4.545892949237712e-03   -4.139847892172422e-01   +6.233665451644071e-02   -2.821620150441716e-01; +2.270427594016162e-02   -4.193811168098107e-01   -8.253723367000573e-02   +1.372546309817217e-01   -7.195096951632962e-01   +9.181753502452587e-03   -4.651097298895861e-01   +4.561066582272728e-01; +1.035723452326389e-01   -2.670675608499865e-01   +3.284318948301146e-02   -3.951779072563270e-01   -3.582807497658053e-01   -7.412704255279572e-01   -1.078500179495148e-01   +6.458241985759161e-01; -3.178719206813722e-01   +5.170044488676090e-01   +6.600615941517404e-02   -7.467501380379996e-02   +3.050235612457000e-01   -4.424965017840447e-01   -5.774521083218137e-01   -2.495756207889571e-01; -6.478925240032795e-01   -2.589251545345409e-01   -3.714762371766834e-01   -1.013946588441066e-01   +4.598711458077115e-01   -2.203363370637152e-01   +1.747670909936653e-01   -7.280582951342975e-01; +1.581630119073423e-01   +1.177826307452738e-01   -5.049882131923117e-01   -7.317514942371961e-01   +1.206797111881451e-01   -8.729989085302339e-01   +1.114803653794338e-01   +4.765527009367687e-01];
L3E_L2E_iAMPA_netcon = [+2.435484023193141e-01   +1.371830985283904e-01   +9.090662019551081e-02   +5.241300961775174e-01   -2.764978737877503e-01   -1.937763982120665e-01   +8.688539677564247e-02   -7.346516764905132e-01   -3.183266682444664e-01   +4.652908536097008e-02   -7.691692766664862e-02   -1.571076568264770e-01; +1.585742097915304e-01   +3.600483163707137e-01   -4.378566964922975e-01   -5.075214730576068e-01   +7.685870053168052e-01   -1.270457123975836e-01   +1.099721792879391e-01   -2.154192789575531e-01   +4.055366066014064e-01   +4.995097980564077e-01   -2.351501887086612e-03   -1.602415453620812e-01; +4.305335388169610e-01   -2.942587344388222e-01   +4.931616919433538e-01   -5.525602138798558e-01   -5.524904300586592e-01   -4.067003523509991e-01   +5.690844772093626e-02   -6.629162962550688e-01   -3.691695973802170e-01   -3.290465861089634e-01   -2.676296567629766e-01   -1.234356142390300e-01; -3.335352614661018e-01   -2.308141458361343e-01   -8.116783600732529e-01   +4.105764643551945e-01   -3.625910663100040e-01   +4.309111143991236e-01   -3.133448250117556e-01   -2.144562416689861e-01   +5.693003821658614e-01   +1.209399491691247e-01   +3.797475608353238e-01   +5.173111634766273e-01; -5.372587324526089e-01   -2.462488996270031e-01   -4.064215183862936e-01   -1.000000000000000e+00   +5.432406120538980e-01   +1.657833849827894e-02   +1.127000474819892e-01   +4.437602391088845e-01   +4.299106019810964e-01   -5.767990816392287e-01   -7.564377192823543e-01   -3.605231464045924e-01; -5.887749402819583e-01   -1.433669465968510e-03   -2.248407575745332e-01   -4.458033896096905e-01   -6.047796201300087e-01   +4.885699995390682e-01   +2.302107604719289e-01   +3.039789343948952e-01   -3.752066791235941e-03   +2.710630372261645e-01   -1.680021896302570e-02   +4.180611914064268e-01; -2.480820139328464e-01   -2.937540909516578e-02   +5.470448506163657e-01   +6.938757786158276e-02   -5.244433285849981e-01   -4.301812627956914e-01   +4.310256329459190e-01   -4.506035485055435e-02   +6.119527428313790e-01   +1.312289854642395e-01   +1.591582724260152e-01   +2.987143695575460e-01; -9.667609139519365e-03   +6.845402418507456e-01   +6.929883265650948e-01   +6.216778866638829e-02   +5.911376115965262e-01   +5.098433981138326e-01   +4.149845714001164e-01   +2.908529205809065e-02   +7.269614039409373e-01   +3.890391124174234e-01   -4.342091180186038e-01   +3.638467638328850e-01];
L3I_L2I_iGABA_netcon = [-6.883922422097256e-01   +7.864312628972995e-01   -4.368069654737677e-01   -1.367044359090370e-01   +3.414359693268459e-01   +2.989730410975823e-01   +4.146399061014454e-01   +3.369656731158736e-01   -1.048516630175584e-01   -5.581049244929631e-01   +8.915444793068535e-02   +7.219826816697844e-01; +6.544573391395098e-02   -1.810819602935172e-01   -1.847787456184417e-01   +6.305615468543793e-01   +7.693009129683572e-01   +6.736356109243197e-02   +1.900072726058741e-01   +9.374536734249173e-02   -6.888392004590568e-02   +5.126634486088504e-01   -2.311338025703984e-01   -5.225256718124445e-01; -3.749609488114353e-01   +2.734413650886931e-01   -1.814448324367867e-01   +2.710054281779077e-01   -1.228875633700508e-01   +4.390559770946017e-01   +1.146733513658992e-01   -6.078619053612511e-02   +2.851090166124449e-01   -1.392771294424414e-01   +4.366749358244345e-01   +2.659346215372215e-01; +5.626603184357941e-01   -2.587935998917833e-01   -6.601563658585732e-01   +2.817597676408575e-01   -5.104262077269808e-01   +6.712307279450713e-02   +1.547888190953709e-01   +5.548399154919386e-01   +1.169715185592853e-01   +1.327078427593701e-01   +2.617487344191923e-01   +7.415655794770850e-01; -6.304345552607732e-01   +1.336304891563471e-02   +3.793173965424975e-01   +9.257293726711657e-02   +2.617381078328289e-01   +1.701616257245152e-01   +4.271112363489871e-01   +3.704085020257704e-01   +1.352180912179240e-01   -6.666991400351684e-01   -1.561845593314552e-01   -4.141992333606374e-01; +2.163637391027793e-01   -1.734685866822606e-01   -7.920999705991907e-01   +1.176241985634794e-01   -2.710333928670109e-01   +2.958667947367198e-01   -2.520801598770712e-01   +6.640066199694926e-01   -2.470336443222138e-01   -2.737835369436049e-01   +2.259643695850278e-01   +3.295924276246118e-01; +1.477147048689992e-01   +3.639088422751427e-02   -5.024534272953846e-02   -1.643193821043706e-01   -6.266726132611183e-01   -8.327337612160696e-02   +1.125718278917546e-01   -2.149958397494187e-01   +1.307742022234890e-01   +3.722666294447253e-01   +6.897404601402474e-01   +1.743334652375183e-01; -1.182497975628309e-01   -3.446709158534943e-01   -3.406539167747664e-01   -1.940389077946540e-01   +5.100201424014020e-02   +2.710171988119059e-01   -6.538116596184501e-02   -7.638834135542714e-01   +4.229758314173235e-01   -1.158308496324584e-01   +3.242367788183604e-01   +1.750884338377157e-01];
L2E_L3E_iAMPA_netcon = [+3.993610668445052e-01   +3.000114357864352e-01   +4.480077415622602e-01   +9.200440959553163e-02   -2.356650035332575e-01   +1.449697896083784e-01   +6.281730378490018e-01   -5.402566545455814e-01; -3.524743990291768e-01   +2.290536573146880e-01   +1.468719244551103e-01   +5.385064334254958e-01   +5.168553606826690e-02   -4.442283009484288e-01   -9.337328119105230e-01   +6.220182591709879e-01; -2.328074196629167e-01   -7.731586771601581e-01   +1.416061092743375e-01   -5.955774196732049e-01   +4.360757467778534e-01   +1.170802083945119e-01   +5.456785732166860e-01   +1.589557970307534e-01; +7.352188009898816e-01   +9.567580767489597e-02   +3.126958321759742e-01   -5.444950736618218e-02   -5.131233142591307e-01   +6.898118531635050e-02   -6.635709397640182e-01   +4.100739282421393e-01; +4.615945638504365e-01   +8.977339237078609e-01   -4.874273609706872e-01   +4.489727987089393e-01   -5.128941018173223e-01   -7.912429127793594e-01   +2.412573517865582e-01   +2.854037506717668e-01; +5.599432087844021e-01   +4.312337520403155e-01   -4.102627211208376e-01   -2.536772773337667e-01   +2.236431374266019e-01   +9.434766234093814e-01   -2.786375866731747e-01   -2.387965769062614e-01; +9.045396436595122e-01   -5.478072306307975e-01   +1.867111741032380e-01   -3.081153106989614e-01   +5.152231800106155e-01   -2.218018536111476e-01   +2.509010035931152e-01   -1.480550573043399e-01; +6.314683270335686e-02   -2.030802853187944e-01   +3.703496305149220e-01   -6.554760441563079e-02   +4.607636897009448e-01   +1.137932432644141e-01   -8.078034056286338e-01   -4.364164271988342e-01; +2.205934871909029e-01   +7.362857473601651e-02   +1.881885533874540e-01   +4.748524501017952e-01   -1.769274245530967e-01   -5.443109855537217e-02   -2.622376911953121e-01   -3.612292243791377e-01; +3.126202704406001e-01   +1.256349410476438e-01   -3.334125382877745e-01   +3.398802565789071e-01   +4.812628222597972e-01   -3.861246371096980e-01   -5.607188573948297e-01   +1.443913585300272e-02; +9.014728443821246e-02   -3.001432796424208e-01   +8.995930947708624e-01   -8.426381359808072e-02   -6.972635341505252e-01   +5.248385692696719e-02   -4.952126916469023e-01   -5.916311779612544e-01; +7.979327860632102e-02   +4.614754872354665e-01   +1.247202217388128e-01   +5.332311639309385e-01   -8.675798642299581e-02   +5.453879206064370e-03   -6.620502516967741e-02   -1.322803149340011e-01];
L2I_L3I_iGABA_netcon = [+3.702520069003900e-01   +2.032125710868534e-01   -2.442350580533221e-01   -2.914966374746985e-01   +9.495866410562030e-02   -5.476057077250870e-01   -1.009215946870082e-01   +4.158149033708120e-01; +1.793179035226436e-01   -3.131092469503640e-01   +4.957066340647096e-01   +3.479350844926880e-01   -5.196161657304300e-01   -6.995487756341696e-02   -2.115958809406011e-01   +5.439717871477984e-03; +3.547360002659068e-02   +5.820179399417222e-01   +3.020350885915841e-02   +7.138396760159356e-03   +4.059429352200726e-01   +5.920291938380743e-01   -5.619095533969096e-01   +8.657393199625098e-02; +5.970016103662251e-01   +3.689246561625308e-01   -1.377211650945808e-01   -2.726381977796191e-01   +7.874814118559298e-02   -8.078260806664341e-01   +3.089403829445819e-01   +5.453015935474472e-01; -8.543858350158341e-01   +4.155430040524687e-01   +6.315040117055710e-01   -2.319862177948578e-01   +1.168096403047679e-01   +7.115808809908402e-01   -7.792575978540617e-02   +4.259116278720930e-01; -9.229213135824272e-01   -1.264676626628173e-01   +8.281270927871728e-01   +1.294315139593277e-01   +1.371891744511683e-01   +1.391706621202103e-01   +5.704211195047874e-01   +3.870905405044522e-01; +4.974542512254594e-01   -8.899099409078784e-02   +2.440979535591773e-01   +2.648031439646314e-01   -1.354551113323312e-01   -2.622987660776561e-01   -3.247942633906605e-01   -5.516010940884810e-01; +2.307316370231216e-01   -1.211787847762018e-02   -4.287180851362795e-01   -4.142617921744867e-01   -2.975794492921605e-01   +7.774958459918717e-01   +7.805433805238987e-02   -4.906551571257285e-01; +8.548876771057759e-02   +2.745692783425724e-01   +9.449907653730183e-02   -2.312985076289111e-01   +1.608865022376009e-01   -2.952919181041829e-01   +2.696371400447327e-01   +4.176986752242210e-01; -3.767567236937633e-01   -1.346665463315967e-01   +3.078565027953067e-01   +2.730475543767010e-01   +3.887681350469594e-01   +2.201193165658827e-01   -1.000000000000000e+00   -5.474053962855395e-01; -3.543379635481756e-01   -7.748727033279081e-01   +1.680511329747557e-02   +2.872543534598189e-01   +2.301012101246758e-01   +2.404590703053861e-01   +3.060504176724784e-01   +2.209222855978286e-01; -1.207054709251941e-01   -2.308453596315183e-02   +3.316275088395558e-01   -3.592436524940600e-01   +2.727764632660566e-01   -2.927826819494866e-02   +6.968196132264460e-01   -1.738654140361571e-01];
L3I_L3E_iAMPA_netcon = [+2.154872596409662e-01   -4.689319514232200e-01   +5.331296273583402e-02   -7.829641478192434e-02   -1.579913351105870e-01   -3.052515768641360e-02   -2.837465911785177e-01   -3.832538506889326e-02   +4.756182239874734e-01   +2.695845590452435e-01   +2.124803050891251e-01   -2.340252079206535e-02; +7.155134690937394e-02   +3.698992111137985e-02   +1.342016760974127e-02   +2.770610323083801e-01   +1.268417714002157e-01   +4.160753783051572e-01   -8.335526304376509e-02   +4.185036564000422e-01   +7.120522987209097e-01   -5.111389890014866e-01   +1.591225547671984e-01   +4.937865975578649e-01; -2.945483109816149e-01   +7.018773523870273e-02   +5.014283071825782e-01   -3.882884221266213e-01   -5.486539940982140e-01   -1.852654537661062e-01   -1.531942527926612e-01   +2.080346552946837e-01   -4.137456353187410e-02   +3.100296849794280e-01   -4.539789716513397e-01   +3.397311190859618e-01; +4.598704730372975e-01   +6.340870889279067e-02   +4.369210628521674e-01   +1.143431943688939e-01   +4.116907840901633e-01   +1.631155695323784e-01   +4.778413904793493e-02   +4.047538876232071e-02   +3.010296015007790e-01   +2.906536533074855e-01   +8.072645557918412e-02   -4.310902973696815e-01; -1.629118639571521e-01   +5.377561564020980e-01   -2.529268346888451e-01   -5.033410457039786e-01   -7.519828240110317e-02   -5.090866307175306e-01   -3.370664017961035e-01   -5.182712846097420e-02   +2.826857963282553e-01   -2.987307265964840e-02   -4.358650475306435e-01   +2.166690078482160e-01; -1.879993613024180e-01   -5.579026230098930e-01   -4.603232930372920e-01   -3.324081093695307e-02   +1.000000000000000e+00   -3.295390758780350e-01   -4.185314875403002e-01   +1.007173327475460e-01   -4.010425279180818e-01   +3.208204627123025e-01   +5.262484300932113e-01   -7.739005299111763e-02; -6.627942642994075e-02   -4.329149120421011e-01   -6.409992235037704e-01   +1.234311710787022e-01   -7.937380866383198e-02   +1.361301613611658e-01   +6.774042940230107e-01   +5.866749329228736e-01   -8.082922461862763e-02   -4.693426602590809e-01   -2.840446108842972e-01   -1.760346482895351e-02; +1.531240869229205e-02   +1.124288628048024e-01   +6.936086726312189e-01   +2.343693607106288e-01   +4.537321815332315e-01   -3.364730501733336e-01   -2.754094178363568e-01   -6.046863096715334e-01   -7.446426737040991e-01   +5.914772114806394e-01   -7.044358098595956e-02   +3.038662129302094e-01; -2.454054241763643e-01   +3.070136073076442e-01   +1.750735577489822e-01   -1.734729969541019e-01   -3.707259858884011e-01   -2.189202935100050e-01   -4.939599650334823e-01   +2.429066148073208e-01   +2.653866364021570e-01   +1.961238744834723e-01   -1.058479768912627e-02   -1.359699161289376e-01; -6.866433746895094e-02   -8.392906621935929e-02   -4.691042391509533e-01   -1.972736376890289e-01   -1.263751509020229e-01   +3.466802042009799e-01   +6.021818345866833e-01   +2.013868535045398e-02   +4.820386521501034e-01   -1.272530813244839e-01   +7.247441822434151e-01   -5.871222305472881e-02; +3.332829573434173e-01   -5.077069940820871e-01   +5.322875548550308e-01   +3.893766656099160e-01   -1.536931242749694e-01   +3.044598167025253e-01   +5.480182272128357e-01   -4.185777836449728e-02   -1.757779844978191e-01   -6.030911859893364e-01   +4.527418410328053e-01   -2.845433673901743e-02; -4.899504709945274e-01   +9.937734857992468e-02   +9.211985510248316e-02   +2.923865063507094e-01   -4.392563503353708e-01   +1.027194836411918e-01   -1.396287027314655e-01   +9.755746057801233e-02   -4.312169760276876e-01   +2.423618449589355e-01   +4.114225742390730e-01   -3.052223948383965e-01];
L3E_L3I_iGABA_netcon = [+9.844938547442883e-02   -2.001093414380055e-01   +2.071100381154722e-01   +1.914295612225108e-01   -3.458780989232419e-01   +1.185200161376795e-01   +3.261013075546445e-01   -3.205549498714516e-01   +7.680459561885745e-01   -2.679994718728751e-01   -4.932875363941098e-01   -1.503378076898347e-01; +7.838506738886079e-01   +6.377368448877365e-01   +3.128632952183985e-01   -4.506491922298918e-01   +5.452195405328744e-02   -4.911409287930020e-01   -6.757174282107513e-01   -3.236097378790703e-01   +8.443536967246917e-02   -3.062078052537937e-01   +7.150416891580760e-02   +3.250712630452882e-01; -1.768869347616866e-01   -1.663887492929280e-01   +5.032175010263683e-01   +4.171376610717633e-01   -1.220955765718398e-01   +6.057574089176738e-01   +4.191920211590504e-01   -2.747989938320882e-01   -6.341717161361887e-01   +5.367450897847675e-01   -1.204779454617549e-03   +5.322718574497776e-01; +1.075892243286200e-01   -1.149320827581578e-01   +4.628847571874922e-01   -1.460138276445785e-01   -3.970240602476906e-01   +1.284280989617974e-01   -3.028529301604159e-01   +5.785591384143828e-01   +1.689283861809047e-01   +3.995724511365958e-01   +1.507004130025873e-01   +1.511412810187151e-01; +7.862971915199296e-02   +2.954407212098732e-01   +1.885193638925088e-01   +3.305746289182223e-01   -6.709417519043832e-01   +1.631176684748536e-01   +2.644019179313569e-01   -1.060059627120642e-01   +3.893129985688027e-01   -3.681396473453996e-01   -1.378366337830285e-01   -3.782277497144557e-01; -1.744874360654062e-01   -2.688954850582884e-01   +4.748291176329247e-02   +8.235933615365952e-01   +1.697148727363859e-01   +1.665175239881419e-01   -3.649129148534819e-01   -1.336745509553361e-01   -2.272128759292874e-01   -2.371806158106590e-01   -1.257820949424184e-01   +1.472633524771264e-01; +5.827472841793409e-02   -1.000000000000000e+00   +1.250761908162679e-01   +2.448302262948210e-01   +1.770402664246786e-01   -3.850081481797984e-01   -1.797148603966013e-01   -2.548300307812028e-01   +6.727097107591370e-01   +5.091728398651656e-01   -5.641543674633944e-01   +3.799147396781266e-01; +6.782146617361049e-01   -2.546298971000871e-01   +2.262435505310542e-01   -1.785075953981787e-01   +2.148688155259690e-01   +6.743367736864879e-02   +4.286235737037636e-01   +5.788524574023631e-01   -3.812419085509966e-01   +1.103184102567715e-01   -2.463590377862681e-02   +2.748095519651941e-01; -6.601152691494803e-01   +4.949151126775331e-01   -1.993378450399352e-01   -4.971616211351357e-01   -6.083685529982088e-01   +7.031216060884642e-02   +5.292482282906176e-02   +4.104209080491761e-01   +1.908448788715020e-01   +6.108204027494459e-02   +2.733194458242165e-01   -4.065132444411673e-01; +4.642717453669719e-01   +3.443841658541487e-02   +3.767516593167619e-01   +6.100548797841653e-02   -1.144440965087125e-02   -6.491568348893542e-01   -1.433326692870056e-01   +2.204321566959830e-01   +1.894702430072093e-01   -2.630267711030458e-01   +4.072879578775014e-01   -1.856149768410091e-01; -1.037244455195543e-02   -4.946894367597308e-01   +4.436440017638677e-01   -2.243527301168988e-01   -3.602263562411105e-01   -2.937994023730391e-01   +3.617012876109746e-01   +2.560266555633379e-01   +5.291059844661190e-01   +4.844274065361088e-01   -5.937614523106112e-01   +7.112191312249965e-01; +2.367445794286385e-01   -2.080051116627252e-02   -4.224752315639452e-01   -2.562776849725249e-01   +7.109147122334868e-01   +5.057040962508542e-01   +1.323760488263167e-01   +4.451554505290040e-02   +2.368349526349248e-01   -7.346691518933175e-02   +6.029399245654816e-01   +5.718934505740795e-01];
L2E_Input1_iAMPA_netcon = [+2.390717917928775e-01   +3.894729078020759e-02   +2.428681392518604e-01   +9.609008412575124e-01   -2.170113281021859e-01   -3.387822583828389e-01   +5.247501651213510e-01   +6.085147792640415e-01];
L2I_Input2_iAMPA_netcon = [+2.406768343621023e-01   +6.203547357485170e-01   +7.566648459030390e-01   +2.750761825156882e-01   -1.807641884183981e-01   -6.181449085597023e-01   +7.981739696246453e-01   -1.720925081709132e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.4*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 1.0*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 1.0*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.4*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 1.0*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 1.0*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 100*(sin(2*t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 100*(sin(2*t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
