function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+6.252087062119958e-02   -6.315216433765512e-02   +9.708350325841771e-03   +4.869744693602548e-02   +9.986558849308755e-02   +4.702833698461145e-02   +7.724805482827857e-02   -3.871820548219971e-02   -5.554684141849781e-02   -3.353817114983907e-02   +4.122651159832307e-02   -2.868940040619002e-03   +1.324287013209162e-02   +6.090478576828350e-02   -7.893197275402636e-03   +2.548262894294558e-02; +5.081580448036476e-02   +3.599826445932744e-02   -1.777653567897129e-02   +1.254178954212213e-03   +1.924321847902333e-02   -2.521132210166082e-02   +5.538680482921825e-02   +3.348722511189226e-02   +2.107416669633935e-02   -7.166401824413145e-03   +8.872567104879189e-02   +8.765106465415128e-03   -4.151989296887741e-02   +7.980309203365632e-02   +4.986041026865288e-02   +4.654648366670545e-02; +5.777464137694301e-02   +8.564065730387474e-02   +5.379772609194888e-02   -6.023824667527591e-02   +8.715658601360100e-02   +4.745570774828337e-02   +4.672346094266138e-02   -5.670401273525574e-02   -7.632928157760707e-02   +5.151173356607661e-02   -7.497294355956752e-04   +4.138859256405469e-02   +6.941822193555058e-04   +1.941216840807163e-03   +2.491632709795771e-02   -3.024874710258743e-02; +1.783917201219057e-02   +2.055445525475681e-02   +4.474826822835998e-02   +2.168677078839047e-02   +1.893803313896168e-02   +8.218972467932413e-02   +2.604560189261348e-02   -3.404280024078349e-02   +1.493106512634471e-02   +7.550248930181855e-02   +2.115344973106633e-02   +1.691236980858127e-02   +1.037239485745226e-02   +8.200541374517543e-02   -6.668732781075999e-02   +4.441431396390425e-02; +9.810035895109055e-03   +1.406919284121184e-01   -1.654241044026394e-03   -4.166365255080888e-02   -2.482808437804305e-02   -5.078399906262598e-02   +1.879079755251504e-02   -5.814019786034577e-02   +2.952311248807364e-02   -3.490216733326086e-02   +3.286091782784555e-02   +2.153950625064343e-02   +1.007587774546799e-03   +8.698570577548637e-03   -4.268894973614396e-02   -5.662511438672628e-03; +5.770618575676355e-02   -5.876047607584676e-02   +6.829754443643479e-02   +2.762473329190202e-02   +8.962266089698778e-02   +6.070066737930219e-02   -2.052506619139646e-02   +5.795572252841057e-02   -2.944398298029248e-02   -3.922950055089813e-02   +3.295390805408712e-02   -1.100565363315606e-02   +1.181710901130133e-02   +1.056223550813078e-02   -3.460416588874904e-02   +7.729802451524691e-02; +1.135430730170625e-01   +2.897342980975760e-02   +3.185467006051851e-02   -2.725122168471202e-02   +4.131682513139971e-02   +4.514740749888721e-02   +1.106688739590502e-01   -6.591152916570624e-02   +2.469363855024980e-02   +5.705501217423056e-02   +3.614798619819619e-02   +2.759372385227240e-02   +3.349724658712997e-02   +4.514479946226273e-03   +4.769917348562033e-02   +2.316830629575380e-03; +6.916432778820704e-02   +2.310281077036827e-02   +4.470859902192863e-02   +3.544881435239636e-02   +3.511739978721095e-02   +4.616184401526442e-02   -2.449373004583614e-02   +9.923691927681119e-02   +4.012893512465945e-02   +7.804702996388080e-02   -8.710722594427427e-02   +2.369680334725192e-02   -3.823978623542000e-02   +6.734066362104341e-02   -1.387237245119815e-02   +4.040173316713649e-02; +3.978495016862354e-02   +9.927463067557411e-02   +5.514718614038428e-02   +1.027010446520179e-01   -1.847007088955472e-02   -3.257886561375969e-02   +5.406177090567882e-02   -1.884555549816076e-02   +2.954031691699196e-02   +3.816264090711575e-02   +9.753441109644204e-02   +5.069512661971798e-02   -4.530298525437277e-02   +7.042117539600708e-02   -5.920761248213666e-02   +1.486592230759791e-02; -1.684592309218945e-02   +1.749604652450051e-02   +1.258947314168513e-01   -6.921374890273743e-02   +1.690847627512815e-02   -1.267441285188468e-02   -5.256320567984189e-02   +2.429372973621169e-02   -3.093212831246536e-02   +3.953867733528770e-02   +1.081183109092833e-01   +8.413725684232876e-02   -6.852427155600123e-02   -3.438472041878408e-02   +8.405642767294744e-02   +9.327512793661338e-03; +9.243139919388876e-02   +8.944894927741535e-02   -3.631689865111930e-02   -1.291499061503228e-02   +4.822680829848145e-02   -8.915273968991347e-03   +1.083794270191950e-01   +1.178291183482778e-01   +5.750163531963403e-02   -8.899403383649321e-03   +2.992880794888772e-02   +1.067436563706395e-01   +6.617659806838427e-02   +1.099446258946882e-02   +5.886975419351177e-02   -1.052942876131416e-02; +6.806818511393914e-02   +3.988223703336764e-02   +7.378402890646719e-03   +7.152084176608557e-03   +1.724537588010015e-02   +3.904810028768528e-02   +6.036990829263011e-02   -4.539207601908214e-02   -4.861034321255592e-02   -1.937283813667216e-02   -6.455990219239541e-03   +3.149091266889475e-03   -3.174932584866166e-02   -3.399995074817911e-02   +3.139737412982726e-02   +9.529509247415571e-02; +1.278828869621283e-01   +3.720578263752924e-02   +3.782810893784946e-03   -3.368592915728302e-03   +5.607208758584383e-03   -3.615102613257710e-02   +1.258364881980420e-01   -1.746209987891426e-02   +8.594407934755158e-02   +5.335318383379883e-02   -7.861920925245815e-03   -3.521568182720050e-05   +2.409567621463503e-02   -2.962402255530805e-02   +7.309206926634040e-02   +3.848868434425518e-02; +1.613075190033518e-02   +2.836134762110787e-02   -7.359384917943829e-02   -8.517852088723139e-03   +6.367936311444780e-02   +3.312215178295360e-02   +4.939280343030383e-02   +1.065792774843190e-01   -1.007170680338990e-01   +1.160681097346009e-02   +4.203888736308077e-02   -4.761900459118915e-02   -7.469501319178649e-02   -1.263285315318289e-02   +6.669511603348532e-02   +1.139240856039691e-01; -2.569277963195615e-03   +9.103375990885711e-02   -1.867634850207484e-03   +9.360424509425178e-02   +6.082463679538497e-02   -4.740543503531346e-02   +5.466234449739641e-02   +5.120661279040343e-02   -5.280200978147841e-02   +4.719441893347794e-02   +4.527296907176265e-03   +5.692134402887580e-02   -6.437382846636545e-02   +4.596846892682585e-02   +4.996504849333463e-02   +2.420132623287514e-02; -1.687580720471892e-03   +2.298756161541833e-02   +2.652533658774058e-02   +1.106633803014571e-01   +4.329219813892798e-02   +1.712154256557957e-02   +4.908231024798233e-02   -3.313513447893846e-02   -1.487493104049316e-02   -1.204490763825624e-01   -2.683682829928285e-02   +1.572449154162973e-02   +2.282881057053555e-02   +7.387556498769390e-03   -4.381605599456227e-02   +2.975386216964051e-02];
L1E_L1I_iGABA_netcon = [-5.522425570396707e-02   +1.306848004904978e-02   +6.746291508948954e-03   +2.355119804918135e-02   +2.904964305878978e-02   +1.251276733367150e-01   +2.882632673153148e-02   +6.261091840827596e-02   -7.624799539930002e-02   +4.599503205882339e-02   -3.976533175216467e-02   -5.014672296753071e-03   +1.334661285929937e-01   +5.721216836087637e-02   -1.835848817343340e-02   +7.427337204958559e-02; +6.583708233630123e-02   -8.995020797630976e-02   -1.538299289914336e-02   +2.230571276906803e-02   +2.441119506521739e-02   -2.610972266411572e-02   +8.465551608417235e-02   +8.089594135913733e-02   +3.644199869913632e-02   +1.598570756025544e-02   -8.962990180859644e-03   -3.815164835030098e-02   +5.321929918940430e-02   +6.952684496459062e-03   +8.333260936258888e-02   +3.848309449210134e-02; +4.923998329083199e-02   +1.977885237532867e-03   +7.607849650237558e-02   +7.116156565659361e-02   -7.310989932376985e-03   +1.168922067056934e-01   -4.754237175430366e-02   +3.412688422691725e-02   +5.405492081804603e-02   -1.414154277685747e-02   +5.904968677364332e-02   +1.384920735598359e-01   +8.472460666334888e-02   +1.087505562789861e-02   +2.360784826902232e-02   +4.639076863221520e-02; +7.197242877146864e-02   +2.993162763939223e-02   +2.901156055699471e-02   -2.143011118993572e-03   +6.228803966066225e-02   +6.652021006603193e-03   -1.903425519111755e-02   +4.547254591437530e-02   +2.558189505251905e-03   +4.771865681932039e-02   -7.447144352325828e-03   -6.601136186470394e-02   -4.864781285749352e-02   +6.704544594609815e-02   +7.931407699341064e-02   +3.284770213794160e-02; +4.032342715669625e-02   +3.655381106243170e-02   -4.496897808481225e-02   -4.228548028987050e-02   +9.808134010682719e-02   +1.790663954459689e-02   +4.995395954516119e-03   -1.956223184347744e-02   +5.068650114129045e-02   -2.505094820562205e-02   +6.213009584688206e-03   +1.320672873358271e-02   +1.191374116371131e-01   +2.324626255202876e-03   -2.302777254367334e-02   -6.421439981423188e-02; -3.141350514005159e-04   -2.321229580354300e-05   +3.787129355455932e-02   -8.969245552910497e-02   +3.497777577293119e-02   +4.803387691364332e-02   +5.476681418364435e-02   +5.597348437257038e-02   +2.023904138729461e-02   -1.493918695976222e-02   +3.439195979750984e-02   -7.408194990120829e-03   +7.111639171715721e-03   +7.017255175600845e-02   -2.359759561268373e-02   +8.416148459089520e-02; +1.861705314403126e-02   +5.931904639407529e-02   -8.558481857784607e-03   +3.796425373452708e-02   +9.182738721980535e-02   -6.250268133373524e-03   +5.979662600252919e-02   -2.476940588297099e-03   -5.436057494471944e-04   +4.125459637132849e-02   -4.073342783570665e-02   -6.130788703568311e-02   +6.226210478736006e-02   +1.673350410551751e-02   +4.022327380553377e-02   +3.269351315255307e-02; +1.753513093150722e-02   +7.267114869129701e-02   -1.703761554809626e-02   +5.274684258390842e-02   -7.088162757427760e-02   -8.534650745749155e-03   +1.565185435586637e-01   +3.873857837251093e-02   +2.319328324079714e-02   +3.489653415410778e-02   -4.388716674484408e-02   +4.748612458186918e-02   +4.174184236359479e-02   -3.066294651920786e-02   +1.826078633807673e-02   +2.928765978544620e-03; +2.389937928445825e-02   -3.158559900299228e-02   -4.169284160757653e-02   +8.670882995703100e-02   +1.027263914840078e-02   +1.126868138778148e-02   +3.287880286725248e-02   -3.367654721598970e-02   +1.129549571263196e-01   +4.100767585882160e-02   -1.572417351914274e-02   -3.068166939709129e-02   +1.097419464716481e-01   +5.129094328242764e-02   +4.528115548091478e-02   +6.794401894448078e-02; -4.972190787499126e-02   -7.180158174403849e-02   +3.654984636633353e-02   +2.787427030103464e-02   +2.512745952783869e-02   +4.210794062287632e-02   -1.600185923888560e-02   +1.118680207198234e-01   -6.639632975293244e-02   +6.212155487740329e-02   +3.086384290048007e-02   +2.613291062030332e-02   -5.022937797680302e-03   -4.475086495122774e-02   -1.322975312373898e-02   +2.082338993897367e-02; +4.532157220768572e-03   -2.272688606846968e-02   -5.563768754202506e-03   -9.916262029431208e-03   +3.727916238838182e-02   +1.597278422049783e-02   +3.594179053091302e-02   +6.044654752996646e-02   +1.093961151107655e-01   -1.348560733095859e-02   +6.815653513000300e-02   +1.122189348662528e-01   +9.035851212783680e-02   -5.201936930789529e-02   +1.082569895816965e-01   -3.894232690589439e-02; -2.914397207664664e-02   +4.815933731371741e-03   +3.889138075297514e-02   +1.662796840964795e-02   -5.164975853885079e-02   +1.115503492559820e-01   +2.561251132675155e-02   +3.288028264769538e-02   -1.755936633325370e-02   +3.003285607270820e-03   +2.764258155275527e-02   +4.884853261194747e-02   +3.328687262302360e-02   +8.451952540824410e-02   +2.578532513660942e-02   -2.934804436790550e-02; +2.941560204411075e-02   +3.686092500915439e-02   +6.818453450003084e-03   -9.740820980071010e-02   +4.505723640120986e-02   +6.404917104045435e-03   +3.785690386887264e-02   +1.125198520154100e-01   +8.803909074621369e-02   -3.068401678388529e-02   -6.188050556570185e-02   +4.520777203956618e-02   +4.873579943156847e-02   +4.726427850933768e-02   +3.073442579048041e-03   -2.089560383519989e-02; +1.071409435668515e-01   +1.629755822687222e-02   +5.106640726975198e-02   +1.723589637035174e-02   +1.352123198786861e-02   -8.899840836664626e-04   +1.253069240868684e-01   -2.533590755839610e-02   +2.054589085568504e-02   +1.338632887154124e-02   -2.689599609101377e-02   +1.599660722530116e-02   +1.368193240390234e-02   -3.999421698723006e-02   +2.823407111160722e-03   +1.546906452315810e-02; -8.419809937443845e-03   -4.868095182754854e-02   +4.853257932630825e-02   -6.897618516681575e-02   +4.482414664078568e-02   +4.766742270544153e-02   +1.731313791736418e-02   +6.884627616982734e-02   -2.493281393978185e-02   +1.026670039337393e-01   +2.793196217059882e-03   +4.554924420773956e-02   +4.754022163109881e-02   +4.990839139500398e-02   +1.819384890287907e-02   +7.239023857687825e-02; -1.755749138622617e-02   +6.533777492390005e-02   +1.420076288644598e-02   -2.573208293162553e-02   +1.166970987547358e-02   +1.033411627336552e-01   +5.750627152832644e-05   +1.328212270716350e-02   -4.834016027657892e-02   +9.831669886368799e-02   +3.236656636671156e-02   +2.861942557783417e-02   +1.749479225170083e-02   +1.969463470059156e-02   +7.545978545420129e-02   -5.465825505499841e-02];
L2I_L1I_iGABA_netcon = [+7.672036924346401e-02   +9.096382355496001e-03   +7.364346462267750e-02   +7.968540326863782e-02   -3.861686019006175e-02   -4.039744357909697e-02   -1.198255901228373e-02   +6.702643838413078e-02; +8.402673988895198e-02   +5.679468194494143e-03   +5.477724318907661e-02   -7.809845662574827e-02   +6.706063783532271e-02   +9.574856216934441e-02   -1.896711242666764e-03   +7.027541188988567e-02; -1.387375808793139e-02   -2.967669288850828e-03   +1.038501920119859e-02   -1.250224279081346e-02   +7.971028788165357e-02   +4.463063108319076e-02   +2.357246445174932e-03   +1.253964075076775e-02; +4.841063760791992e-03   -2.483200896320533e-02   -6.431109886120466e-03   -7.920703363280313e-03   +1.760266884978252e-02   +2.799709828120065e-02   +7.737024205260186e-02   +9.486457313317018e-02; +1.989515271408542e-03   +6.118616388097982e-02   +3.122523006317915e-02   -2.893578515040175e-02   -5.382482696841825e-02   +8.269049056785360e-02   +1.350361289841956e-02   +6.124990906000519e-02; -2.554097059867611e-02   +4.759820144880642e-02   +1.118431103135354e-01   +2.189706884959299e-02   +4.590178939574464e-02   +5.623037648318741e-02   -2.808799341088610e-03   +5.319430133688517e-02; +1.454907084909289e-01   +5.204469847803429e-02   +7.579376529909587e-02   -2.783512663708813e-02   +7.798168517184124e-02   +9.705722522993357e-02   -1.625616113357069e-02   +1.401720557635706e-02; +1.055600562080868e-01   +4.218374415936775e-03   +2.128055644232613e-02   +9.041745611829301e-02   +5.765581882201178e-02   +5.319136344725840e-02   +5.229134243133622e-02   +7.021707587876649e-02; -5.104484256908778e-03   +6.420337077367760e-02   +5.126388243986364e-02   -1.615016101128402e-02   +4.287698430913701e-02   +1.372495187024203e-02   +6.541481104827869e-03   +6.611741458220428e-02; +3.504300441927839e-02   +5.756320057612279e-02   +2.161300558187167e-02   +6.674027046453157e-02   +8.614325725506353e-02   +2.712591615723240e-02   +1.394756217118087e-02   +6.128239560125451e-02; +1.897868297248900e-02   -4.492899662423873e-02   +8.795194563638954e-03   +4.685408595677987e-02   +2.304046121827535e-02   +9.161188483618344e-04   +7.295592657366137e-02   +5.605415811054627e-02; +4.911351262612650e-02   +8.940583191324439e-02   -2.664500831244917e-02   +3.217573179614969e-02   -1.688007002132901e-02   +4.052692855981058e-02   +6.125471972989067e-02   +4.074732920575090e-02; -6.221156665915402e-02   -5.199873461615920e-02   +5.440695364918574e-02   +6.997152400395261e-02   -2.237625109401271e-02   +2.456189310186102e-02   +2.306026635565240e-02   -8.509837257205585e-02; -1.049411652867689e-02   +1.043879147533691e-01   -4.809124337917745e-02   -3.138932049944516e-02   +8.081497357544867e-02   +4.603209619556570e-02   +2.304208705821070e-03   +9.915333134877288e-03; -6.489197533548363e-02   +1.531310185197697e-02   +6.983940421352275e-02   -1.401925719779162e-02   +1.345553259093007e-02   +8.696763067013669e-03   -3.149737631798624e-02   +7.046057693330005e-02; +1.398970195648194e-01   +1.869390556727647e-02   +3.732419921495073e-02   +6.825351049021822e-03   +1.191125715603626e-01   +5.808730896763798e-02   +7.452003320196993e-02   +9.307405534790787e-02];
L1I_L2I_iGABA_netcon = [+2.886369058936299e-02   +8.980873297913669e-02   -1.083640071398024e-01   +2.666071209590174e-02   -2.504217706253381e-02   -5.981751113107400e-02   +2.314011496741664e-03   +1.492370541525413e-02   -4.265226879259959e-02   +6.636945546641257e-02   +4.833102230801078e-02   +4.728618567109218e-02   -2.689188818146125e-02   +9.263749699133471e-02   -3.564101522337879e-02   +1.321150122418292e-02; +3.485158898909144e-02   +6.527968426104161e-02   +4.580152278539185e-02   +1.094877738579645e-01   +1.659177797308956e-02   +4.800839117792975e-02   -4.682243805351696e-02   +1.163606301891091e-01   +7.430861395231346e-02   +1.299986651050947e-01   +2.609883303417472e-02   -9.819613374462365e-03   +6.810421884153910e-02   +5.592641156820968e-03   +3.269896131147044e-02   +3.822538917756624e-02; +4.030673720601410e-03   +8.603729339673055e-02   +3.755561946744967e-02   +1.553305453965648e-02   +8.979334210811274e-02   +2.274473534303009e-02   +2.339343885403053e-02   +5.417295634372315e-02   -8.627306279246297e-04   +5.191661639479316e-02   +1.711994936363682e-02   +1.719697207993126e-02   -1.638279139491412e-02   -1.861355804984195e-02   +1.833144158428467e-02   +1.394225975874264e-02; -4.480949636081904e-03   +1.926564245465798e-02   -1.673066390447862e-03   +5.247834570572172e-02   +1.522800944240277e-02   +1.200195103975040e-01   +1.148288719566008e-02   +2.242835895891804e-02   +1.852874142481262e-02   +2.923447249503120e-02   +7.684840646161975e-02   -5.445913816681386e-03   -4.124401224711303e-02   +4.298293803384968e-02   +1.280857534681656e-02   -6.776515769348013e-03; +4.262495402055537e-02   -4.776033204341272e-02   +2.066680325028039e-02   -2.203330546055074e-02   -5.733905548434026e-02   +5.446482856794204e-02   -1.701778216237805e-02   -4.111459935123313e-04   +8.048092175297204e-02   +2.632614504524661e-02   +6.120256704539720e-02   +1.696989888392196e-02   +4.676963214980619e-02   +5.073039432205939e-02   +6.783762152157605e-02   +1.076927818850409e-02; -4.724547274994959e-02   +2.270523804543026e-03   +8.862640090641642e-03   +2.931677931918984e-02   +2.097181592910220e-02   -2.306067474442342e-02   +2.126139217938202e-02   +8.965813837259995e-02   +2.696615124893043e-02   -2.122190822984790e-02   -9.787074417220243e-02   +1.550362005436254e-02   +1.066206322022101e-01   +6.313319028954822e-02   +1.783754713834371e-02   +5.404446224151466e-02; +6.776849282804799e-02   -1.226248680035407e-02   +7.345309490003302e-02   -3.228556466516472e-02   +8.629389386378659e-03   -4.822376032300468e-02   -4.050992706012257e-02   +2.960755404934081e-02   +4.040789696052739e-03   -3.612272982034925e-02   +9.916600362535953e-02   -8.300852485724514e-03   +6.669321132344787e-02   +1.749209004920685e-02   +3.843052442046999e-02   -1.923868018344596e-02; -2.035806774841145e-02   +8.309336427642482e-02   -1.867393911122919e-02   +7.175213211809681e-02   +7.914029466241783e-02   -3.214295244465476e-02   +4.499060618859305e-02   +8.241002386155391e-02   +1.002141942048157e-01   -5.069632062655614e-03   +3.676496093551356e-02   +1.047605020861280e-02   +5.429904267551712e-02   -1.650682219291598e-02   +5.161334209138117e-02   +7.888946733332531e-03];
L2E_L1E_iAMPA_netcon = [-4.679631635878614e-02   +9.382359658791614e-02   +6.668635439264015e-02   +1.764923335369480e-02   +1.823593111500812e-02   +1.515237286462712e-02   +1.707589310449521e-02   -5.073415886010714e-02; +3.627570573206458e-02   +7.131883081638835e-02   -5.396603265786115e-02   +7.279471188573937e-03   +1.026374740282581e-01   +1.089751706945505e-02   +4.591979766418430e-02   +5.985404516359809e-02; +4.633483995712774e-02   -2.311511173559509e-02   +1.107902134457200e-01   +4.264658074487739e-02   +3.887157847158070e-02   +8.791404997405766e-02   +2.975351919718356e-02   -1.934300975874206e-02; +5.062869136717037e-02   +5.745680637469627e-02   +1.222925583768473e-01   +8.292838760558688e-02   +7.787885279122775e-02   -4.095058385486995e-02   +1.078289185526966e-01   -4.645305135809392e-03; +1.674427307982047e-01   +7.275619458619595e-02   +6.044321054522330e-02   +3.319684812949181e-02   -4.133511609326983e-02   +5.219077885509774e-03   -4.119205984448294e-03   +2.765113045826988e-02; +2.125931662778988e-02   +1.012598397610107e-01   +4.068274158593800e-02   +4.157438787746369e-02   +2.114101822901145e-02   +6.999995609978764e-02   +8.268001797750249e-02   +1.278685291966538e-02; +1.260607514404413e-01   +4.731362991115578e-03   -6.523477064792872e-02   +5.917346357639854e-02   +2.369417421232340e-02   +9.550418358770855e-02   +1.623389064708950e-01   +8.733111339211805e-02; +2.614159588358559e-02   +9.824268653592674e-03   -5.169172845111770e-02   -1.970857828037909e-03   +3.432614355113459e-02   +8.156547957324400e-02   +1.004070669791355e-02   -5.739723253830641e-02; +8.908933206796760e-02   -5.632420911922496e-02   +1.242859873313967e-01   -2.246314130627344e-02   -8.620595464157969e-02   -1.965909468587106e-02   -1.958784124893855e-02   +1.370252126345098e-01; +9.396056161829361e-02   -1.088391367021463e-03   +1.935425324494122e-02   +3.875120236134382e-02   +9.559996526818397e-02   -2.113324699214313e-02   -2.506402979339254e-02   -4.809181028475842e-03; +5.925309382755640e-03   +1.229518556047855e-01   +1.436053806246778e-02   +4.794233921504567e-02   +1.494181981222694e-01   +1.080986695483489e-02   -6.486127040408975e-02   +2.385121277808933e-02; -1.263910111906596e-02   +1.770893150139112e-02   +3.324366786828725e-02   +1.501737195380170e-01   -9.493304509825171e-03   -1.643558326162720e-02   +4.806211508590225e-02   +3.407006490540035e-02; +7.890839227340135e-02   +9.151327266725580e-04   -1.913686677196949e-02   -1.228902891851372e-02   +5.095973372427520e-02   -5.127317280364396e-02   +1.640819962406472e-02   +1.636772027953100e-02; +4.611213668536476e-02   +4.726159991609394e-02   -2.469611617867407e-03   -6.652691058291216e-02   +7.472930746060666e-02   +3.436432371298579e-02   +5.512458059731544e-02   +1.473644828500906e-02; -7.674092759290545e-02   +8.506856852205202e-02   +7.563317272594654e-02   +1.316328396015016e-02   +3.861215750591831e-03   +2.579516905758163e-02   -4.056680706307358e-02   -4.012712959774470e-03; -4.002279320454778e-02   +6.593340992031196e-02   -8.562484923491476e-03   -1.515136176673118e-02   +2.510448190140321e-02   +6.759410038636157e-02   +1.049836816734225e-01   +2.115146339668431e-02];
L1E_L2E_iAMPA_netcon = [+1.730242688128799e-02   -4.010840412415598e-02   +5.673961439191492e-02   -2.783906438899399e-02   +3.215019488992783e-02   +2.649716379665323e-02   +9.177685339260269e-02   +7.143433526770224e-02   +5.505606050732341e-02   +4.127082626498052e-03   +2.597519752738595e-02   -6.234616960309516e-02   +6.787545433155193e-02   -9.047627018105794e-03   +1.308340323188991e-01   -2.280161235051274e-02; +5.274574880373009e-02   +3.370020636874778e-02   -9.144172361095472e-03   +6.071075410489995e-02   -2.198059377633266e-02   +8.705718516828963e-03   +3.811424552626722e-02   +3.915557213053497e-02   +1.222154527691063e-02   +2.482035171365637e-03   +5.353327589387169e-04   +1.064472185548566e-01   -3.758488772807078e-02   +2.397233115238727e-02   +4.163585281111850e-02   +8.002713193272476e-02; -1.814119953742447e-03   +1.220429215708679e-01   -3.919160177703784e-03   +4.091832607002684e-02   -5.593133054437502e-02   +3.010955277323877e-02   -7.727942234867463e-02   +8.793526910450825e-02   +1.002639735802713e-02   +4.842618784591177e-04   +6.249258300183665e-02   -6.738771968822205e-02   +5.333965521074389e-02   +1.071722675712490e-03   +2.556165414400879e-02   +6.499393777666977e-02; +5.214220263330695e-02   +1.865504020856501e-02   +1.364603670240568e-02   -2.526511766159435e-02   +4.940600394757360e-02   -5.771138783399624e-02   +3.539632523273777e-02   +5.086436117862549e-02   +2.359809046608796e-02   +5.517265742678644e-02   +7.091405581875776e-02   -1.202219907806858e-02   +1.082921223255958e-01   -3.150145643693102e-02   -3.922636264382779e-02   -9.204803671373381e-03; -2.860352868548838e-02   +1.222688694815062e-02   +5.536672979918221e-02   +1.050139554307789e-01   +5.694035991006708e-02   +2.355547492972654e-02   +1.448850046845283e-02   +2.407331542210191e-02   -1.515605838915343e-04   +2.195777410941212e-02   +5.238182227149929e-02   +6.119630691191556e-02   +5.196831743046912e-02   +2.069529902091230e-02   +9.580630500906899e-03   +7.074154299344310e-02; +3.947283105436405e-02   +1.281422227727280e-02   +4.493254159133839e-02   +7.625737208512934e-02   +3.552575762124949e-02   +3.821014417288118e-02   +2.099649401388938e-03   -7.556822401948837e-03   +6.049666016964035e-02   +5.236997015602554e-03   +2.493293071181188e-02   +1.065886704491907e-02   -1.735735544674401e-02   +1.116348022231045e-01   +4.988941035937889e-02   +4.695238765697123e-02; +1.346414957113634e-01   +1.081386344107596e-02   -3.206737722064815e-02   -4.479571335983021e-02   +2.555974721872555e-02   +1.102071316640387e-01   +2.815400404181480e-02   -6.627093475012268e-02   -1.479016863037115e-02   +6.154353659087356e-02   +2.609847641139522e-03   +6.341580019228080e-02   +4.442550792440124e-03   -6.972594762922223e-02   +3.551348949869844e-03   +2.333096479938929e-02; +4.501816232058248e-02   +2.968436949607092e-02   +8.358909479429949e-02   +1.033936544259450e-02   -6.534258082457368e-03   +2.289105682341257e-02   +3.720009545750256e-02   -1.195056245164618e-03   -8.733216986421773e-03   -1.252393816745972e-03   +1.187049090990563e-01   +6.961906113693832e-03   +5.415050085392333e-02   +5.516483221121587e-02   +5.612849719748941e-02   +1.228707029850438e-01];
L2I_L2E_iAMPA_netcon = [+9.498581062001618e-02   -4.516472400546893e-02   +7.939908526030336e-02   +5.096032645080031e-02   +1.480617687278338e-02   +3.652683550551174e-04   +7.325199680987891e-02   +6.391542270190398e-02; +8.813631348307045e-02   +1.160709004015812e-01   -3.604013033739616e-02   -7.652953636247795e-03   +5.183902395273916e-02   -5.503746063954155e-02   +3.963326421258381e-02   +5.198772089106499e-02; -1.461975163201165e-03   +3.622116032794398e-02   +1.549937766829885e-02   +4.254259970222198e-02   +3.651332276608708e-02   +1.474423581445791e-02   +9.981449272137805e-02   +4.386791038320455e-02; -1.797590053997312e-03   +2.452580311197167e-02   -3.954550165285690e-02   +1.950926114660865e-02   +6.822165611886045e-02   +2.946229943108956e-02   +6.157462739923938e-03   +1.955312565052353e-02; +1.265356166349548e-01   +7.019039628195715e-02   +7.244086049615259e-02   -3.031602406960867e-03   +2.631557283183423e-02   +7.342336194598366e-02   +1.825183259790710e-02   +8.716761432915182e-02; +6.486887629447363e-02   +6.224114793228094e-02   +4.406616555417686e-02   +1.037445961088102e-01   +8.425130601884620e-02   +6.264101358823726e-02   -1.198791368074541e-02   -3.016735685453939e-02; +9.235578580904100e-02   +7.301951969061163e-02   +9.705168713974266e-02   +6.151517940449522e-02   -3.476383589439293e-02   +7.774836583960834e-02   +1.118816096335407e-01   +2.586685981084845e-02; +1.357378614157223e-01   +1.319725294163660e-01   +6.495866790709484e-02   -3.057947227394543e-02   -1.671020992393564e-02   -4.364927323423839e-02   +3.450925593825144e-02   +1.106848481647542e-01];
L2E_L2I_iGABA_netcon = [+1.018551715546322e-01   -3.833967047240318e-02   +1.690018901338910e-02   +1.801758293086603e-02   -7.652582212367393e-02   +5.922209468133832e-02   +2.753705784164507e-02   +5.927154952452700e-03; +3.386488676461506e-02   +7.646196092476579e-02   +1.253756049939189e-02   +3.853487973651691e-02   +1.145274585880104e-01   +2.197237255698615e-02   +5.370212915802260e-02   -6.487146721156237e-02; -2.758298047468854e-02   +6.863876712129484e-02   -2.615173046703220e-02   +9.221352886495426e-02   +1.079345584299765e-01   -3.274889659853632e-02   +1.704486859138750e-02   -2.777244919550134e-02; -2.835660751528718e-02   +3.886513195600298e-02   +1.962352227951736e-02   -1.560885897565926e-02   -1.369778435557705e-02   +4.846096239893276e-02   +8.758433805940732e-02   +7.896871133895428e-02; +1.726489069966412e-02   +4.757334787997602e-02   +1.073244127225871e-01   +2.314042758230118e-02   +1.080529140805734e-01   +8.551770996488949e-02   +1.876354163937621e-02   +7.537639745046155e-03; -2.342126932402943e-02   -3.759100070138410e-04   +6.232898972681722e-02   +7.755047803415988e-02   -3.154882153353049e-02   +5.755731072261389e-02   +7.398145425899225e-02   +8.223199639713427e-02; +5.742937855292807e-02   -7.956858408064381e-02   -3.721149692605737e-02   +3.571231146004747e-02   +1.052938420184942e-03   -6.904509086850827e-02   +6.357184072706951e-02   +2.662230732687266e-02; +5.342372508751369e-03   -2.978433241883498e-02   +3.239116278165858e-02   +6.092545507695420e-02   +1.900628633600173e-02   +7.267588055746568e-02   -2.547229667089999e-03   +2.294614475744898e-02];
L3E_L2E_iAMPA_netcon = [+4.065032612622769e-02   +1.095177047245614e-01   +2.910560113084584e-02   -3.804775110232542e-02   +8.312382391273973e-02   +1.054567859327631e-01   +7.879310871166857e-02   +4.987906129425325e-02   -3.054841786298385e-02   +7.175548170780963e-03   -1.796393570410369e-02   +4.296300019884652e-03; -2.364155315022182e-02   +6.146429439817490e-03   -3.701494966111290e-02   +1.478866280925725e-02   +4.871910492815371e-02   -2.507488825695201e-02   +6.238157870332704e-02   +2.717509009861485e-02   -1.400407277711038e-02   +6.137204349508764e-02   +7.670808982260516e-02   -5.164691606243967e-02; +2.128286417962148e-02   +3.027380224130836e-02   +5.947503186663728e-03   +2.318912374389046e-02   -2.521571202088186e-02   +4.776623043861975e-02   +5.249207206482904e-02   +1.741471855591378e-02   +2.633420035593388e-02   +6.527721562870470e-02   +6.356066841040892e-02   +6.549437203920407e-03; +4.062903700438786e-02   +5.173410305972682e-02   -5.804347933328534e-03   +8.236947437284622e-02   +1.159870506049583e-01   +2.343580710523199e-03   +6.001295967933173e-02   +1.390991392600736e-02   +8.304553310036493e-02   +1.238259282854236e-02   +1.275228906652465e-03   +2.721396261888471e-02; +3.807689742861615e-03   -3.629322018107572e-02   +2.919227260121095e-02   +1.049766699561027e-01   +1.213631211879819e-02   +8.336780785518783e-02   +2.186172007174969e-02   -6.890765276993928e-02   +8.309840876893961e-02   -3.442203419101000e-02   +3.937419427178689e-02   +5.827981824843013e-03; -1.121566911117937e-02   +8.796857747365926e-02   +4.406634583084776e-03   +8.665815598356180e-02   +9.764654894759112e-02   +6.326057506699433e-02   +5.151760922818133e-02   +1.151113758827281e-02   +2.408292543407843e-02   +7.814656020622524e-02   +7.390366265503294e-02   -4.950020727696808e-02; +4.655439182524077e-02   +6.778408444174111e-02   -2.783277747496227e-02   -2.127299042274208e-02   -2.531608134501748e-02   -2.581429688811035e-02   -3.050074634403569e-03   +7.002289732643185e-02   +5.139189819461432e-02   -3.932422523342131e-03   +3.378522726942186e-02   +2.418727429105948e-02; +4.306714104527930e-02   -1.630735268069963e-03   +6.373802978620413e-02   +1.968037217315715e-02   -2.875956622167886e-02   +3.832092498254232e-02   +8.361600629307095e-02   +7.862387546923710e-02   +4.955799998906903e-02   +6.998391317574661e-02   +4.966141625678702e-02   +3.124200010697265e-02];
L3I_L2I_iGABA_netcon = [+1.828859198874266e-02   +5.774494958094213e-03   -2.780582034229766e-02   +8.484267267135426e-02   +6.180997261060155e-02   +5.977113872821245e-02   -2.403452406489133e-02   -2.320204855588534e-03   +3.366152415926116e-02   +1.037832562630519e-01   +4.541953588678039e-02   +6.093204391637457e-02; +9.530564957128768e-02   -2.446153171560923e-02   +6.917969175325933e-02   +1.201421625558816e-02   +7.673554531309376e-02   -1.938207110939731e-02   +1.496307582714376e-02   -1.313520977191753e-02   -4.354323472616890e-02   -1.221877169220688e-02   +5.571907554461658e-03   +4.124440727535404e-02; -6.052656959442021e-02   +2.497541563409237e-02   +3.884799826390299e-02   +3.780222880629492e-02   +5.497619870179173e-02   +5.103495714101070e-06   +5.056232122163767e-02   +2.799443741697474e-02   -3.573500228738687e-02   +9.727593988373064e-02   +9.648623621873198e-02   +1.412801160865944e-01; +7.635076121881512e-02   +4.690919281709475e-02   -1.250728228767104e-02   +2.316559863217304e-02   -1.696841922272683e-02   +7.039810793282152e-02   +8.765423570218856e-03   -1.600726218034261e-03   +3.411692270546939e-02   +5.455880939114224e-02   -1.594324716124479e-02   +1.579688767817734e-02; -1.698160908601926e-02   +4.385569605872146e-03   +1.828587046812265e-02   +6.715956017545083e-02   -7.184026963506543e-02   -2.313079843763701e-02   +1.470603209996749e-02   +6.303700163329221e-03   +1.112853348871046e-01   -1.637337527402251e-02   +1.925444103163342e-02   +1.291392817247234e-03; -1.698192358037447e-02   +3.207875645279974e-02   +1.351687117378602e-02   +5.652290964790850e-02   +3.790944839651915e-03   -8.547739158363196e-03   +1.435027722376966e-02   -1.614192223955028e-02   +1.659069323710928e-02   -1.135471615288363e-02   +8.334678124658250e-02   -3.879878694885517e-03; +2.916863504706307e-02   -9.932564441537207e-02   +1.111667845735862e-02   +6.587570738614193e-02   -2.517388391754634e-02   -4.336345099541615e-02   +9.949052863840289e-02   -6.279212906345911e-03   +3.528958512281674e-02   +4.867220409658279e-02   +1.267259546626842e-01   +6.016860835454156e-03; +1.769549122948919e-02   +7.085002407233804e-02   -2.276881708779380e-02   +2.441624709758377e-03   -2.058518515239452e-02   +4.799262407228496e-02   -1.342427161229183e-03   +2.047646522738116e-02   -2.477270726395225e-03   -8.122217895102429e-02   +1.704742808436904e-02   +6.527999659336670e-02];
L2E_L3E_iAMPA_netcon = [+2.767745127820765e-02   +5.328643313463228e-02   +8.405367424734680e-02   -7.586208857630922e-02   -4.601953246729371e-02   +9.777754604814767e-02   -9.104414888061810e-04   -6.946510670778075e-02; -1.082092236031144e-02   +1.055001818268961e-01   +4.743644023707257e-02   -2.043162253176280e-02   +8.138331999738554e-02   +7.564769357896720e-03   -1.186079106091058e-02   +8.027101891294956e-02; +5.355974993025431e-02   +4.541861462096103e-02   -1.525512272821763e-02   +6.478192243779188e-03   -5.936554670103452e-02   +4.787913254076169e-02   -4.079944708175556e-02   +8.362456126917875e-02; +6.904752690111986e-02   +3.960426042250700e-02   +6.888230041712842e-02   +9.658767391261085e-03   -2.937523243916637e-02   -3.211626591435153e-02   +2.535725743053300e-02   +5.421537973105099e-02; -1.952815010092467e-02   +8.228867908244020e-02   -3.455360690416213e-02   -5.266864556040880e-03   +2.963540264201215e-02   +1.752717142308353e-03   +8.383617291079054e-02   +2.108740512783043e-03; +3.808163099402274e-02   +4.749615306112129e-02   +2.426106969409280e-02   -2.581988248256315e-03   -1.691351818796225e-02   -6.999006520649045e-02   +4.947002081663474e-02   -2.943784974633951e-02; +3.136473329837222e-02   +5.912872393150724e-03   +4.980872307504664e-02   +1.982217780519835e-02   -4.537069841049193e-02   +3.965669711183707e-04   -3.646792377896381e-02   +1.052308344655668e-01; +8.728473700862945e-03   +4.837851425414368e-02   -6.507105624567402e-02   +2.425242989646671e-02   -2.127501620003306e-02   +4.745265485845730e-02   +2.417998289449230e-02   +3.686252925257350e-02; +9.843945120321200e-02   +2.796091276555814e-03   +1.499013968908136e-02   +1.921747646821662e-02   +4.857967320036884e-03   +1.811375242313895e-03   +9.053525461914688e-02   -1.509973312255726e-02; +3.238449301793014e-02   +1.556243029406747e-02   -2.692820317948145e-02   +2.520426877003162e-02   +2.765563018038622e-02   -5.402763749151742e-03   +8.151283502791551e-02   +1.080440947712818e-01; +3.851422491427031e-02   +7.355539691344605e-02   +7.271846757184898e-02   -4.079564001853233e-02   -4.349660844229212e-02   +5.002091610856149e-02   +4.577627692180639e-02   +7.645060915847544e-02; +6.165427455370612e-02   +4.513954784071866e-02   -6.832977469467860e-02   +1.960702284136339e-02   -4.010041760455040e-02   +1.022888254912156e-01   -2.646768129206109e-02   -6.986609798619314e-02];
L2I_L3I_iGABA_netcon = [+4.607491017054217e-02   -3.352244948577067e-02   -1.157711759502524e-02   +9.722986204207684e-02   -1.590893068532225e-03   -1.520889864550161e-02   -4.634338230641613e-02   -1.991660692392024e-02; +5.013967529897943e-02   +6.918090052747949e-02   +1.083952836905538e-02   +8.064950209590516e-02   +6.504337239603540e-02   +1.128004555156606e-02   -7.092094379216839e-03   +6.949742454352856e-02; -2.005324989909476e-02   +7.699321382091120e-02   -7.084300843906327e-02   -3.549255923776759e-02   +2.015863582528681e-02   +8.404442627633095e-02   +2.003725158479117e-02   +3.369220731413011e-02; -2.480933218857096e-02   -2.041306558762588e-03   +8.827437210813180e-02   +3.760307236615449e-02   +4.644953821131802e-03   +2.766635636821875e-02   +1.230848852550817e-02   +4.724609364319388e-02; -5.447558911929492e-02   +6.478136552169736e-02   +2.975120220822849e-02   +4.789050565907275e-02   +3.174787146192379e-02   -2.608344108496625e-02   +1.562772168807227e-02   -1.545352215767174e-02; -3.271152707628280e-03   +5.815913211498577e-02   +9.018710330032791e-02   +3.996469207111529e-02   -4.018225692775289e-02   -7.333500831145603e-03   +1.606921535338801e-02   +3.487389910190820e-02; -1.453886818564937e-02   +2.142494858789415e-02   +2.331143096078468e-02   +7.140777422474166e-02   +1.396118842794893e-02   +9.515403170975095e-02   -5.656252484872434e-02   -7.876253694693500e-03; +6.421815279039063e-02   +6.605851922088190e-03   +2.182976895694072e-03   +6.245268365823262e-02   +5.810830821361458e-02   +1.479242137598172e-02   +2.106435671387410e-03   +6.950623757198901e-02; +5.196797602019877e-02   -2.964963119009238e-02   +9.298877910723222e-02   -3.948333959351574e-02   +7.871608190783534e-02   +6.739435782111093e-03   -9.512417795659105e-02   +9.929142998264469e-02; +2.405092351027207e-02   -4.130328329795070e-02   +6.722342868103451e-02   +1.970349246305490e-02   -2.154954280933652e-03   +1.158293008104935e-01   +4.686713371800319e-02   +1.419766992758979e-02; -5.294727136500754e-03   -5.469871984368921e-02   +5.748838469631737e-02   +1.021437987555093e-01   +3.579206858164592e-02   -4.204203410730446e-02   -5.806616753057776e-02   -3.149216713394241e-02; +4.064287554703676e-02   -9.823383874971486e-03   +5.520821566584300e-02   +2.336791641289386e-02   +1.983511280449946e-02   -2.114265979000994e-02   +8.276976480450321e-02   +3.336175083460512e-02];
L3I_L3E_iAMPA_netcon = [+1.943300420941525e-02   -3.624430590012141e-03   -1.883977208875566e-02   +6.355678311616278e-03   +5.750125867160648e-02   +8.980374398478000e-03   +1.075128470429724e-01   +1.194696309923335e-01   +1.078274315969185e-03   -1.340409680584301e-02   -1.617171737096550e-02   -6.506900329442092e-02; +1.693703056761627e-02   -1.192016805811379e-02   -7.621987579195397e-03   -4.429209678222759e-03   +9.279409039842389e-02   +1.139072501118297e-02   -2.343509571049684e-02   +9.454942653759150e-02   +8.402604742266610e-02   -1.687831114247014e-02   +5.692562627085618e-02   -2.902322926843637e-03; +1.168820145994280e-02   +1.177107164879949e-01   +7.282953339145480e-02   +1.425835153405297e-02   +2.531473883231383e-02   +2.212215939463991e-02   +2.726096694673432e-02   +8.406632208803899e-02   +4.852280862964053e-02   -3.917772049657427e-02   +4.952492404711900e-02   +1.900111672840722e-03; +1.536170044964326e-02   -3.864845818538985e-03   +3.315349008367934e-02   +2.166012183297607e-02   -5.136199082214633e-02   +2.846782338576728e-03   +9.366237435096017e-02   -1.624606778865917e-03   +1.363835655806494e-02   +3.968506338610422e-02   +1.140728023785694e-02   -5.155399017392206e-02; +7.068392989383332e-02   -3.068553278415797e-02   -1.320558898879015e-02   +4.765691093881702e-02   -3.599585518814209e-02   +2.800111352428906e-03   +8.214872393020028e-02   +1.378090351311534e-02   +1.591413830060059e-02   -3.013261248687694e-02   +3.541594395110703e-02   -1.219031629108989e-03; +8.219694268076025e-02   +4.617643734077917e-02   +1.090357596667988e-01   +4.868613842601538e-02   +1.295636898311224e-01   -8.081484462393093e-02   +3.531725045612315e-02   +1.436542512101970e-02   +6.661680729171768e-02   +6.378859773611507e-02   -5.763906554482008e-03   +2.014999167094014e-02; +3.005094829194599e-02   -1.104216453944366e-02   -3.140940087517439e-02   +9.604831933841989e-04   +2.105665759500274e-02   +2.367247586987690e-03   +3.440628703718898e-02   +5.113366851242475e-02   -5.658769087493402e-03   +5.231411631795527e-02   +4.812385574852439e-03   -2.802524192822186e-02; +5.143847316351272e-04   -2.029249146529130e-02   +6.030471870266851e-02   +1.154536336322957e-02   -1.278837837907215e-02   +9.576844350104440e-02   +8.240128322367146e-03   -9.460625429682634e-02   +4.362523425152805e-02   -6.458569885026452e-03   -1.388960577399588e-02   -7.269326346580725e-03; +7.344202954518798e-02   -5.108090880807954e-02   -2.855503922159959e-02   +6.044803236181215e-02   +3.803652884112301e-02   -1.025847002320187e-02   +4.412379853392913e-03   +7.205804318743092e-02   -2.927596638353921e-03   +3.866651586177743e-02   -9.625941028797408e-03   +4.246924240582928e-02; +3.696162857782525e-02   -7.231613203524992e-02   +1.159974698635245e-02   -5.227227573560270e-03   -3.947580980379381e-02   -2.782341988254861e-04   +3.421285876366193e-02   +1.566899593501413e-02   -5.622621024638656e-02   +7.148454997949031e-03   -2.335911252137929e-02   -4.273700680993801e-02; +1.090076290950514e-01   +9.252383371582731e-02   -7.171123870377862e-03   +8.562605000650375e-02   +3.673883729882334e-02   +6.896955212076275e-02   +2.090885178546453e-02   +9.244129018052449e-02   +2.446309307468133e-02   +3.300155759535768e-02   -4.134878068297457e-02   -6.454479926887531e-03; -1.055874105300978e-01   -8.519602369107176e-03   +4.688165144073022e-03   +5.440559013082950e-02   -3.382321331467197e-02   +4.348407091304714e-02   +3.611396314533886e-02   -2.727749097009345e-02   +9.511373935957940e-02   +8.816837588380455e-02   +1.781668507750046e-02   +4.826637284200377e-02];
L3E_L3I_iGABA_netcon = [-2.543381076166980e-03   +9.534145090240373e-03   +5.419516568224629e-02   -3.907846580616123e-02   +1.437569168551232e-02   +5.336772012930420e-02   -1.464341686664656e-02   +3.398227177324848e-02   +8.351004847587287e-02   +8.430479609590778e-02   +3.303257649349647e-02   +8.795657766770359e-02; +1.489928209210695e-02   +3.388394630770566e-02   -1.234524779296713e-02   +5.836069183484202e-02   -1.374068401857421e-02   +5.845178372274124e-02   +9.735704276916358e-02   +3.118747488897498e-02   +5.376402483116396e-02   +6.929506586450702e-02   -2.535390400939266e-03   +1.063800885090747e-01; +3.269902655122872e-02   +1.176544566514601e-01   +6.154854359269831e-02   +3.490419452463971e-02   +7.886319254515482e-02   -4.706080761257220e-02   -4.739509916783599e-02   +1.108459809372080e-01   +1.325456070546532e-01   +2.938894009106301e-02   -7.867073828845135e-03   +6.982284065557620e-02; +9.296514778222978e-02   +3.284787601335298e-02   +5.358266939045839e-02   -3.606334391852879e-02   +7.563130616283806e-02   +6.505625192543439e-02   +1.069223492231032e-01   +2.708990980692205e-02   -3.994938056622960e-02   +3.629829978250784e-03   +4.922077323708760e-02   +6.773528094717249e-02; +2.948084833111491e-02   +2.920438575203143e-02   +6.833023144401817e-02   -1.865027639563313e-02   +3.708657229721855e-02   +6.285876182376639e-02   -5.143910762677743e-02   -5.480820803826856e-02   +7.826607692365133e-02   +4.770456376908681e-02   +9.420510876674654e-02   +1.062462581711510e-03; +4.029527884491298e-02   -2.894176178807682e-02   +6.224901911806129e-02   +4.798090414728149e-02   +7.943619548274715e-02   +9.279624282793937e-02   +2.747075653259413e-02   +1.425977970734897e-01   -2.697295313416302e-03   -3.832664927111108e-02   +9.461587058247202e-02   +4.158859934279043e-02; +9.933900814955941e-02   -4.521345246758691e-03   -3.112924737130057e-02   -1.576459665531767e-02   -4.178442032231397e-02   +7.034020871386200e-02   +1.224214906897385e-01   +6.778912425245726e-02   -5.839997174593002e-02   +1.128390398119662e-01   +6.274287392036529e-02   +6.303362834677700e-02; +1.217717074963301e-01   -5.295167691951510e-02   +2.071299053490069e-02   +9.064390432765197e-03   -1.279703962937127e-02   +9.693085076540013e-02   +8.586316126054760e-03   -2.066349668121041e-02   -3.414744882009311e-02   +3.136319894326452e-02   +4.899100598423490e-02   -3.711503435520980e-02; -7.436712200430314e-02   +2.544523866273878e-02   -4.429230985002770e-02   +7.844132463211630e-02   -4.546528892863538e-02   +4.261390847312463e-02   -5.939640364187629e-02   -3.451095197361909e-02   -5.028358818009291e-02   +9.501591106073018e-02   -1.201118955344679e-03   -2.757054625043882e-02; +1.508500082825323e-02   +7.723478019632657e-02   +9.027957173837642e-02   -9.940990235753684e-03   +5.471008611595462e-02   +2.426229711741408e-02   +4.994095817165380e-02   +6.974117151917944e-02   +2.523495246044103e-02   +7.302123596775895e-02   +4.063359998070525e-02   +7.707358539188827e-02; +7.168805309384853e-02   +9.833789474885743e-02   +9.910049173758423e-02   +5.492537328194782e-02   -6.121781664016605e-03   +3.209412502207865e-02   -2.140994874853197e-02   -4.774705685140457e-02   -4.530217092039056e-02   -8.533653836391458e-02   -2.224655154457103e-02   -6.162352262320247e-02; +2.340721226558857e-02   -1.932118876524168e-02   +5.883355637333190e-02   +6.889471473996442e-02   +4.201093033007509e-03   +9.389011929860275e-02   +1.091276225752601e-02   -1.896937159333234e-02   +3.437207800825127e-02   +7.851156411577229e-02   -2.781149048886720e-02   -2.406869361956341e-02];
L2E_Input1_iAMPA_netcon = [+3.358855076251730e-02   +3.754595232163242e-02   +1.651987943243549e-02   +1.391009360562187e-02   +4.333959812194468e-02   +5.442921601426008e-02   +5.653711498447420e-02   +5.767152227582388e-03];
L2I_Input2_iAMPA_netcon = [+6.361366984380248e-02   +3.249306715443123e-02   +7.417866437503884e-02   -7.845275203262331e-03   +8.489057280278053e-02   -2.708276645804114e-02   +2.998959585418283e-02   +3.429634614886705e-02];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.04*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.9*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.1*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.9*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.1*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.9*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.04*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.9*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.1*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.9*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.1*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.9*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
