function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-2.037517357203588e-01   +2.140337579003435e-01   -2.819821978569726e-01   +1.004562023447075e-01   +4.001956528377215e-01   -4.344325298967943e-01   +7.814049570110050e-01   -3.599545597045349e-02   -4.674199406657126e-01   -1.331779433940082e-01   +5.198143868862479e-01   -3.803394807584143e-01   +3.276632991963985e-01   +2.745999433255445e-01   -3.784648944977889e-01   -9.997745413042131e-03; -3.257233090581869e-01   -5.925839331891923e-01   -3.638996211216801e-01   -2.882607683837086e-01   -1.546128076768105e-01   +2.375387297078415e-02   -4.402332332032021e-02   +3.003328380233541e-01   -2.315562723298986e-02   +5.178345660979438e-01   +3.639122744364923e-01   -6.544130569089186e-02   +4.884851911514487e-01   -3.219345909755009e-03   +6.424938632355349e-01   -1.511708153850849e-01; +1.118768006205736e-01   +4.253730320619737e-01   -3.591723860499098e-01   +4.776699809611636e-01   -6.380983544106681e-01   -3.280652767812294e-01   -2.139625354330018e-01   +4.964359412147225e-01   +4.599673720679862e-01   +6.379425747090381e-01   -2.161312994208953e-01   -3.861315677820338e-01   +4.583980512417744e-01   -4.090781749927741e-01   +9.885789642853952e-02   -1.942588817468543e-02; -5.481117698533200e-01   +3.765372417263041e-01   -4.415448857764135e-01   +5.584400096218516e-01   +5.402390915462540e-01   -7.271590394604771e-01   -1.190997175255126e-01   -6.565168906705419e-01   -3.132941940915005e-01   +6.352410819976274e-02   +5.933736482450731e-03   +1.215580498532516e-01   -3.564724207874287e-01   +3.536436122627022e-01   +6.344523471233399e-01   -2.083208784933565e-01; +2.706388714055424e-01   +5.449497917794421e-01   +2.762359984086694e-02   -1.625408901901649e-01   +4.168852502758823e-01   -8.644028489210148e-01   -5.129201695969385e-01   +6.591754054511229e-01   +6.657934417746414e-01   -5.518538161531510e-01   +7.859165422828118e-01   +3.319867694602269e-01   -2.577086310885996e-01   +2.789231512963451e-01   +7.198463445066809e-01   -8.191865569236585e-01; -3.993597277207621e-01   +1.410687701480795e-01   +1.092825783768250e-01   +1.756852494819804e-01   -4.730364394407221e-01   +2.093981095638015e-01   +2.060628332683709e-01   +9.866945815844116e-02   -7.480928899642365e-01   -1.717465059099606e-01   -3.912458222269851e-01   -2.667812368348199e-01   +5.486073474150416e-01   -5.188398737053690e-01   +3.166936695238400e-01   +3.709572127284719e-01; +1.132188221773845e-01   -6.197672997869212e-02   -8.100750693789978e-01   +5.034441191780402e-01   +1.370276958612729e-01   -4.761792922656077e-01   -2.142239069986466e-02   +1.817743598627059e-01   +2.799925436511485e-01   -3.718392118779936e-01   -6.275029077437490e-02   +2.849955649377421e-01   +1.130166431812832e-01   -1.075670703744231e-01   -7.280359635687350e-02   -6.735503780163727e-01; +1.507101768530748e-01   +4.411113826726221e-01   -1.928270971312154e-01   -2.339489959138369e-01   -3.598366696968782e-01   -3.413846589918039e-01   +5.585016081158931e-01   +6.713921769245916e-01   -4.254798997706293e-01   -2.346634317166347e-01   +7.175439076075268e-01   +6.136706578562793e-01   -3.479737665621015e-01   -3.595223842168076e-01   -5.361612127190875e-01   +6.521399311182148e-01; +8.307731424554763e-01   -3.340984043844511e-01   -3.211053216040302e-01   +5.032776185938995e-01   +6.197444852644816e-01   -3.067593940094318e-03   +8.101125961056540e-01   -8.257443094882370e-02   -3.190846964682585e-01   +1.000000000000000e+00   +3.262782210393389e-01   +1.349226853814179e-01   -5.161480820740849e-01   -1.849820936393715e-02   -2.665875087220414e-01   -3.660166248611819e-01; -2.326986222674579e-02   +2.159954776385563e-01   +5.902966443635091e-01   +7.812075124299461e-02   +8.125097831481591e-03   +3.938250412470838e-01   +8.881322511844912e-02   +3.196104573727930e-01   -1.733472751947747e-01   +3.378981451575064e-01   -6.172409111516436e-01   -2.452765545795747e-01   +2.296972942560731e-01   -5.728096920122799e-02   -4.573875153953037e-01   -7.268287048224171e-01; -3.563918540998859e-01   +4.518910195134810e-01   +2.949375894615451e-01   +2.647063752122258e-01   -5.124254440462502e-01   -1.284957878305520e-01   +2.318458801608761e-01   -7.788858356559184e-01   +3.368349245597709e-01   -8.915916823315815e-01   +5.059275588283695e-01   -8.192281465411708e-02   -1.654319755807731e-01   +8.567408387946440e-02   +1.751654690082906e-01   +2.647632603633599e-03; +5.297501805873095e-01   -1.694160453874432e-01   +7.875777762091133e-01   +7.326898314045068e-01   -4.920510151224982e-02   +8.960404759697305e-01   -1.344599403115082e-01   -3.129434660608126e-01   -5.715275153196248e-02   -1.873939941018598e-01   -5.608742411103478e-01   -6.175141159964965e-02   -4.408251665809239e-01   +5.313999993006575e-01   +1.775224950602618e-01   +3.615955969736340e-01; -6.533563963560248e-01   -6.595344254460777e-01   +3.405654601567492e-01   +3.480479959285769e-01   +3.065002276879736e-01   -6.240565027342054e-01   +3.245099915771488e-01   -4.170713831632968e-02   +5.718448599605207e-01   +7.808067200232627e-01   +5.412195599429419e-01   +3.461770988342599e-01   -1.517132997016766e-01   -6.933913587872256e-01   -5.893679676521957e-02   +2.454029752049426e-01; -2.327421758473937e-01   +2.627670198021375e-01   +5.092105026522840e-01   -2.705375333114268e-01   +5.008522167516589e-01   -5.722642838916143e-01   +5.687575591672350e-01   +4.802494152004220e-01   -2.225786294356908e-01   +6.658566886770552e-01   -2.581932049642215e-01   +2.710699844954435e-01   +4.892937286272597e-01   -3.060547553113652e-01   -4.364165487497443e-01   -6.169092430008884e-02; -2.728082980641305e-01   +6.590615553004694e-01   +4.542687628249631e-01   -4.453415701107470e-01   -4.082256271457106e-01   +5.734161441191200e-01   -2.837361198160286e-01   -1.130829472012882e-01   -2.684136239920104e-01   +8.137838506863270e-01   -6.889029157468423e-01   +4.894592423149308e-01   +1.476529649258420e-01   +3.066146340345798e-01   +3.459636786644621e-01   +5.097632200450228e-02; -7.982645267706098e-02   +7.011747526059620e-01   +5.046609572043125e-01   -3.451286986059076e-01   +9.069429781474753e-02   +3.440296644119319e-01   -6.459553445421684e-01   -1.555261658335726e-01   +5.668567660654636e-01   -9.742609076256567e-02   -8.107243369421882e-01   -7.000377431811698e-01   +5.351228997894459e-01   +4.725029424265191e-01   +3.807178478499665e-01   -3.713006149007689e-02];
L1E_L1I_iGABA_netcon = [-1.337745965370894e-01   +1.588649866933337e-01   +2.872694206383988e-01   +5.845516891053892e-01   +5.933255012136830e-01   +2.064967939339399e-01   +3.430414102701155e-01   -3.587328553661853e-01   -1.130923019654442e-01   -2.353295863767892e-01   -1.015173798311990e-01   +1.851195843139163e-01   -3.351348070905973e-01   +1.551171261947898e-01   +7.877061519450093e-02   +4.422120740806689e-01; +5.843439103912943e-02   +3.332609437253997e-01   -8.737037797543994e-01   -5.604645701627383e-01   -6.827651980061700e-01   +2.336593747247481e-01   -1.873181745430213e-01   -3.102798845997866e-02   -2.507939265332242e-01   -5.547092590768538e-02   -4.163927012898818e-01   -3.083324134809674e-01   +4.579374892945839e-01   +1.494077175775481e-01   +1.927302286416236e-02   -3.214606965930791e-01; -3.981823500825353e-01   +1.483796028981350e-01   +2.207206907059351e-01   -2.203045977847592e-01   +5.976076535462602e-01   -9.858947658121818e-01   -3.074653520919716e-01   -7.073883607899999e-01   +1.521067026116594e-02   +2.079123306835353e-01   -2.213115059711312e-01   +2.721133648837769e-01   -6.523477914890715e-01   -4.021086715777480e-02   +4.195594029897094e-01   +8.286995507422253e-01; -5.118541445111820e-03   +4.706545646091237e-01   -2.345610187272641e-01   +4.507585571930819e-01   -4.889673545988753e-01   +3.777813691227653e-01   +1.705468910430415e-01   +6.178479747879160e-01   -4.573569449090681e-01   -7.292886318640296e-01   +7.646440641977041e-01   +6.529657169788049e-01   -1.659211056124174e-01   -3.740824378944891e-01   -4.011825132542778e-01   -2.813483732136376e-01; -2.770895779920880e-01   +6.893090714711543e-01   -6.079892162141078e-01   +7.987829237757814e-01   -1.572033582457213e-01   -5.150158416422695e-01   +2.682527087232955e-02   -4.130827182123930e-01   -1.056806141484099e-01   -1.769850721930654e-01   -5.716134474225916e-01   -3.587737573191431e-01   +1.357861954418801e-01   +2.036142852076044e-01   +5.714976304618046e-01   +4.050854310432749e-01; +1.068227692951941e-01   -3.013305561082142e-01   +9.266556952190264e-02   -1.135232093606259e-01   -5.117608547423705e-01   -4.859397843080183e-01   +3.810952668604051e-01   +7.757987257602184e-02   -2.821089137809831e-01   -2.153699710057856e-01   +5.313471171122618e-01   +7.743508618825337e-01   +3.222012917636173e-01   -5.669167700465655e-01   -2.631454315545967e-01   -3.805331321929969e-01; +1.215393373283324e-01   +4.857530416985028e-01   +4.409680369071857e-01   +5.108708457216531e-02   +2.176432278393319e-01   +5.842486065259753e-02   +3.329093218050448e-01   -4.847193328064112e-01   +2.036550112899647e-01   +3.421700125102940e-01   +2.780075823556132e-01   +6.106569027741198e-01   -5.000529496466757e-01   -6.012473016963753e-01   +1.260511016652582e-01   +8.004263648208655e-02; +3.706525932135845e-01   -1.267818515124090e-01   -7.291648877347641e-03   +8.195516052485309e-01   -4.621774554381251e-01   +8.263772533026861e-01   +6.196607776102870e-01   -6.290650756364801e-01   -4.359398551740050e-01   +4.953764767245940e-01   -5.679532714826242e-01   +3.559061621265684e-01   -4.362353799315204e-02   -1.776888212621952e-01   +9.030516769166241e-02   +5.762787061896500e-01; +6.959236080452624e-01   -4.110514272374391e-01   -2.693701917000845e-01   -3.182194852776022e-01   +2.122678086228189e-01   -3.784340023156046e-01   -8.485705692230890e-01   +1.355426807183378e-01   -7.365081608434138e-04   -6.379370731446003e-02   +2.632697083678287e-01   +1.251106536335566e-01   +5.000544696487018e-01   +3.628992080135168e-01   -2.302259016994498e-01   +2.123433586709474e-01; +6.621801823161946e-01   -4.382458451155661e-01   -6.212114290816294e-02   -6.961604853702925e-02   -2.615836181808704e-01   -3.176225393410190e-01   +4.105087967955072e-01   -5.899231189565836e-01   -5.574859642748522e-01   -3.546719926625717e-01   +5.950944861621147e-01   +7.136548878285297e-01   +6.348260500571920e-02   +4.536038541974314e-01   -4.969815023055994e-03   -5.706056309051735e-01; +3.271396778148143e-01   +5.382621996052228e-01   +3.624940559884644e-01   -4.970338496061524e-01   +2.993857787703437e-01   +2.193019049793687e-01   +2.940733753842644e-02   +6.521651426859651e-02   +7.893398445520554e-02   -4.108223812366936e-01   +4.032938081093667e-01   -4.168626983299775e-01   -2.390787900870933e-01   +2.641129409492826e-01   -1.846845174096018e-01   -2.254785605044079e-01; +7.513314501780036e-01   -2.544834301929214e-01   -4.119885248471186e-01   +1.652981588730925e-02   +3.483860844280915e-01   +8.978378988245440e-02   -1.761472856099583e-02   +3.578104087740003e-01   -3.815550638420391e-01   -2.528813785665084e-02   -7.990358132875394e-01   -1.000000000000000e+00   +8.145282818535006e-01   +4.230859815466828e-02   +1.243110766699543e-01   -5.315144304997846e-01; -3.421645690613116e-02   +7.720341856878910e-01   -5.214105291467749e-01   -1.668775079496341e-01   +4.299720200057906e-01   +5.038868104080053e-01   +4.426417651864732e-01   -2.418377795248624e-01   +1.482155488513659e-01   -6.029963420359232e-01   -5.543577470418639e-01   +1.824456746712719e-03   -9.759690303496440e-01   -3.066034374767398e-01   +5.636795124504156e-01   +4.318487214975799e-01; -4.998312878770062e-01   +1.062268743746824e-01   +6.148531529513168e-01   +4.691262055876755e-01   +5.957549655181426e-01   +3.441974804119222e-01   -3.814836144289684e-01   +2.219272743504353e-01   +9.490624034280663e-02   -2.792506400248417e-01   -6.463329812509372e-01   -8.591799606047225e-01   -3.444019455219632e-01   -2.855342667275250e-01   -5.482914223663841e-02   -5.428690700771105e-01; -3.755940060093529e-02   -6.403463858488161e-01   -6.814205535608266e-01   +6.081255931882468e-02   -5.256046791542734e-01   -2.426854644613803e-01   -4.019899610543135e-01   -2.533378876254766e-01   +1.447877330645264e-01   +8.107251693640526e-02   +1.332082157502525e-01   +1.181312063733533e-01   -4.442799741034190e-01   +2.904282248322975e-01   +3.404548824895310e-01   -7.330130778244902e-01; +5.423373127932832e-01   -4.477947234009840e-01   -1.240055563370044e-01   +2.669732603116072e-01   +1.544062207750774e-01   -9.173224122464021e-01   +2.957601031179575e-01   -6.430557299273747e-01   -5.020497711034926e-01   -5.353916922591878e-01   -5.170082771049369e-01   +1.992127873148409e-01   +4.458438889859810e-01   -2.317141451109319e-01   -4.773460580285266e-01   +6.707117538275930e-01];
L2I_L1I_iGABA_netcon = [+7.652005602499681e-01   +2.485168316251181e-01   -2.923506413601957e-01   -4.832899792900074e-01   +5.481177652830066e-01   +7.813639111191858e-02   -2.631925921581705e-01   +6.999005276168760e-01; -1.870915041941432e-01   +3.157426209603725e-01   +2.744104282309991e-01   +4.674600436162131e-02   +1.918988851893591e-01   +2.660291905387484e-01   +7.135514675639396e-02   +1.994740808193708e-01; +5.801213828043850e-01   -1.448483019960495e-01   +3.356560889506475e-01   -5.966399575084931e-01   -6.681474862146709e-01   -3.430435538242878e-01   -2.240584626569474e-01   +3.693701581825810e-01; +5.125623609310855e-02   +6.731077315444093e-01   +2.564828012387054e-01   -4.303384843009890e-01   -4.814704596214665e-02   -2.582949627392497e-01   -3.885908000295171e-01   -4.897474002094382e-01; -3.973343058854226e-01   +8.092350604633506e-01   +2.035637871461863e-01   +7.156664910839836e-02   -6.947936050629470e-01   +1.846500734861367e-01   -3.322274995902567e-01   +4.625378067122710e-01; -1.633467372798780e-01   +2.834164870470594e-01   -5.420828784471964e-01   -3.378526908504335e-01   +4.399789170306126e-01   -4.213698476226791e-01   +3.154683548893807e-01   +3.643925751976448e-01; +5.185565913529039e-01   +8.966587215501295e-01   +4.690305207088415e-01   +3.371025104737569e-01   -1.293092971175068e-01   -6.353927365464679e-01   +4.252433894724581e-03   -1.580930416769936e-01; +4.088568300268651e-01   -1.167669542074006e-02   +9.984884046393239e-02   -4.092597274744250e-01   -1.000000000000000e+00   -5.782375668959155e-01   -3.931083139121388e-01   +2.475193526517639e-01; -3.139569048304656e-01   +1.446455684911586e-01   -1.625163408534312e-01   +1.521242077626904e-01   -1.847243542122428e-01   +7.347516014442800e-02   -3.931938561197529e-01   -2.524116622489775e-01; -3.281496542697758e-01   -4.216937136303222e-01   -3.621942357202780e-01   -5.971846140817616e-01   -5.890830828156606e-01   -3.649049308276140e-02   +5.933111051960320e-01   +3.002112565518345e-02; +6.401372346936015e-01   -2.192987577207854e-01   +6.649270467052118e-02   -4.289303470031467e-01   +3.550638069151623e-01   +3.526214743571620e-01   +3.288319531851164e-01   -1.891465085206512e-01; -2.960659944707447e-01   +1.262418478369266e-01   +2.269861766458412e-01   +1.917947878821274e-02   +4.608828431866026e-01   +1.771645091201439e-01   -5.268274321513484e-02   +5.062032860060335e-01; -6.489221853196809e-01   -4.020539317729092e-01   -4.363387381103665e-01   +3.229641317168081e-01   +2.097699349752452e-01   +5.416774667886679e-02   -1.719056948752122e-01   +9.576665035489948e-02; +5.130073203429710e-01   -2.904067357953296e-01   -2.752190947520324e-01   +4.465808882342084e-01   -4.869106784998684e-01   +3.409529182417325e-02   +1.262527170316487e-01   -2.893306188316087e-01; +4.597823377232059e-01   -1.313478271618370e-01   -4.496874357958695e-01   -6.474502937221311e-01   +2.538728706874205e-01   +2.170529623548194e-01   +5.358331865148278e-02   -6.006932758102285e-01; -2.179874675077354e-01   +1.715130926397193e-01   +5.094906668781896e-01   +8.440748077107539e-02   +3.234727441029576e-01   +5.696386132466441e-01   +2.004167948806937e-01   +8.645298829331002e-01];
L1I_L2I_iGABA_netcon = [-3.899363200277934e-01   -4.256150867565792e-01   -3.440042334007263e-01   -6.256768596499037e-01   +7.436150462768480e-01   +4.561303432287985e-01   -6.876023464659291e-01   -4.556946730908522e-01   +8.012726605438056e-01   +2.033284337652588e-01   -3.728450856815591e-01   +6.145830067386301e-01   -7.183693895630739e-01   -1.618610214347224e-01   +5.070432965632755e-01   -2.169903465138849e-01; +1.886690421218139e-01   +7.948053999979650e-01   -1.685132898132838e-02   -5.652801155204499e-01   +9.117672123379626e-02   -2.026297529644026e-01   -1.493080977979477e-01   -3.913141199688651e-01   +3.912752396242856e-02   -5.207964709362469e-01   -7.229024336313628e-01   -3.209338701014748e-01   -5.070843174704576e-01   +1.994619810554309e-01   +4.869917683097288e-01   -8.401782707189143e-01; -1.747030288309974e-01   +1.226533634738599e-01   +7.835506387343456e-02   +6.594920189783369e-01   -3.901786731671268e-01   -3.041961255197549e-02   +3.460756656923170e-01   -1.609806721700074e-01   +3.463010482911164e-01   -8.936516167796409e-01   -1.262534602297291e-01   -4.415514989625112e-02   +5.332780945134109e-01   +7.105604111997819e-01   +5.713446142124181e-01   +1.130494897810422e-01; -1.499124228226587e-01   -5.506016050537967e-01   +2.282991041144299e-01   -4.133444688971051e-01   +1.082063625942925e-01   +1.984913979681417e-01   +3.877807921994932e-01   +3.866884435385498e-01   -5.149390651897465e-01   -1.569368677628268e-01   +1.662821194586757e-01   +6.736379483629773e-01   +9.338175886598697e-01   +4.258434086579525e-02   -3.801475085844403e-01   +5.719100434351717e-01; -4.162345918349809e-02   +4.555693101912696e-01   -1.374669914715949e-01   -9.810888514615509e-01   +2.247794246509083e-01   +3.837655367108411e-01   -5.471480938090015e-01   -5.972200027634247e-01   +7.383441804751389e-01   -1.000000000000000e+00   -7.967073678703873e-01   +4.915995456451220e-01   +3.250932157640911e-01   +2.868666715435859e-01   +3.317114163881749e-01   +6.423352640484929e-02; -4.986793478389444e-01   +8.873421831099351e-01   +3.642770104442605e-01   +1.713053156660870e-01   +4.399134758025902e-01   +1.624719524086246e-01   -4.738447407061644e-01   -1.575661670675494e-01   +2.238267277833219e-01   -1.402224594894696e-01   +1.581367999164120e-01   +1.400829716567331e-01   -8.598633619852187e-01   -9.166731026865109e-01   -7.619580451797370e-02   +4.619367219619070e-01; -6.289580638822081e-01   +4.967927703483045e-01   +3.459395003601274e-01   -5.571606464421863e-01   +2.826009441530160e-01   -3.159178653413944e-01   -5.930802347467052e-01   -5.761604779776289e-02   +6.749941601264440e-01   -3.720584069283224e-01   -4.172896128075027e-03   -6.942097060797665e-01   +1.520505279169267e-02   -8.414463810576278e-01   -7.250916628112984e-01   -7.162330731345644e-01; +8.251948002902630e-01   +5.733447509918629e-01   -5.645733749824116e-01   -4.707401617570998e-01   -5.734765087947449e-01   +9.600117804883977e-02   +5.390831631159133e-01   -8.338481073119506e-01   -7.137689943571660e-01   -5.107853030704428e-01   +4.802123661876416e-01   +3.680064337798959e-01   -1.688179676792107e-02   +5.717676180818926e-02   +3.847679597373503e-01   +1.646866375130882e-01];
L2E_L1E_iAMPA_netcon = [+5.555712578529130e-02   -3.159679589734130e-01   +4.734693558370491e-01   +5.496170458559271e-01   -5.495039024693741e-01   -1.375280126948258e-01   +2.684511709554506e-01   +3.203612383007680e-01; +6.663950110068779e-01   -1.964202265734153e-01   +3.383364154018115e-01   +5.666229219726483e-01   +4.970144708636444e-01   +3.296179616907739e-01   +1.563834129006725e-01   +3.562812244305956e-01; -8.146645278668190e-01   +1.271191470084853e-01   +3.798567854798142e-01   -4.333547915294179e-01   -4.404775468052621e-01   -7.098525908378344e-01   +1.477228381518816e-01   -3.821973250941241e-01; -5.694251334685698e-01   +4.405191350777971e-01   -8.592186827106462e-01   +5.348061556011751e-01   +4.485090651033209e-01   -2.210569663743108e-01   -5.067796978639091e-01   +1.786950029159186e-01; -1.544852707420053e-01   -2.639182685473299e-01   +1.297234360517494e-01   -1.600089672981204e-01   +2.966475401896122e-01   +5.381111510603499e-01   +2.497781478454035e-01   -6.189264637945838e-01; +1.600291877986824e-01   +3.749768401947708e-01   -3.562744455253279e-01   -2.251695688655911e-01   -7.062191499496749e-02   +6.417248700099456e-01   -4.150156447736181e-01   +1.033231028760875e-01; +4.436542331614505e-01   -5.362964292040471e-02   -5.299545085325048e-01   -7.808202943502248e-03   -6.598694071468407e-02   +1.873344796118427e-01   +1.953309339806459e-01   +6.284384167587855e-01; +1.354823490320370e-01   -6.018513911291740e-01   -5.279000778660318e-01   +4.357953754832648e-01   +4.592435646701750e-01   +3.349674658901585e-01   +2.867932678545379e-01   +2.483344815027102e-01; -7.702121160600373e-03   +4.109907141875498e-01   +5.039198760686441e-02   -3.221376363865915e-01   -3.877147743022140e-01   +3.045727611847356e-02   +2.695209447011948e-01   -1.260234257770084e-01; -5.994008699600791e-01   -7.109780696857038e-01   -8.807368889137819e-02   +1.403373644662584e-01   +2.255362711375928e-01   -3.691070825239092e-01   -6.407295050049154e-02   +3.223003840146625e-01; +4.657860453075879e-01   +1.957407705862507e-01   -4.463133438177178e-01   +5.872292687607753e-01   +6.677483633614728e-02   +6.907133019375614e-02   -2.151124264514513e-01   +8.959076847364084e-02; +7.744940980391253e-02   -5.781228777986506e-01   +4.704475764014971e-01   +7.305790123113947e-01   -4.098470520590728e-01   +3.259812092395754e-01   -3.961458473922888e-01   -2.039479092648168e-01; +2.862945787319319e-01   +2.310170927206662e-01   -3.331189397294196e-01   -1.000000000000000e+00   +3.585293229539854e-01   +2.702137943413852e-02   -2.278160236451508e-01   +4.988814427426048e-01; -3.184260412053184e-01   +5.484076941423290e-01   -1.168861167778529e-01   -2.694900587702204e-01   +5.162164229468967e-01   -5.939867130172916e-01   +4.815703875154283e-01   +5.219579225301152e-01; -4.183200761237355e-01   +4.902923424850944e-01   +4.272356084113571e-01   -1.511529284396776e-01   +6.884092452631864e-01   +1.599124393779111e-04   +4.820972213710051e-02   -8.044601454987669e-01; -1.089393516234852e-02   +3.111480842879513e-01   -3.709680171673116e-01   -4.968741936243972e-01   +2.819210191610278e-01   -3.643156590499090e-01   +1.529786100270504e-01   +5.216519491394203e-01];
L1E_L2E_iAMPA_netcon = [-2.408693686290327e-03   -7.044227715370838e-01   +4.293378513710521e-01   -1.733729769122936e-01   +7.729173559454466e-02   +1.288037823625618e-01   +2.532111765324587e-01   +1.178577536603389e-01   +4.496558803011362e-01   -6.418583241424221e-01   -2.994284370949574e-01   -2.472093137514882e-01   -1.593816962926378e-01   -7.882323080407356e-01   +4.284033483310864e-01   -8.375850996103319e-02; +2.683722333635695e-01   +1.064229347853476e-01   -3.216058230033117e-01   -3.428714682525555e-01   +5.227922996816869e-01   +8.672389068000471e-01   +5.042085437806582e-01   +4.486802296298690e-01   -1.516717159917296e-01   +4.178371897306540e-02   -3.130317483884006e-01   -3.021806021365908e-01   -2.636433315403032e-01   +7.862406251947032e-01   +3.346096498972678e-01   -1.923070368942131e-01; -8.845676422562443e-01   -3.889538552634098e-02   +5.220010046976093e-01   -5.968319696108069e-01   -2.871501783488704e-01   +2.712849970878520e-01   -2.442872479547427e-01   -2.982798204274708e-01   +2.933735166217428e-01   -8.311593485704321e-01   -7.759125894856609e-01   -3.183849033419960e-01   -1.375550611453353e-01   -8.222549250788441e-01   +3.842339104022434e-01   -5.629634387214921e-01; +5.283546281097006e-01   -1.509662945041076e-01   -4.166363030035199e-01   -6.515322479941443e-01   +4.744371749125909e-01   +1.425833953292064e-01   +3.954176070373983e-01   +3.396579939393012e-01   -3.598087193585031e-01   +9.753758806626985e-02   +6.393204108004689e-02   +3.580457147151528e-01   +6.107900654262745e-01   -1.096157956282800e-01   -3.037918422567405e-01   +3.029502956795276e-01; +9.864515669321893e-01   +7.071210826554887e-01   -2.287569285850370e-01   -7.180801875255792e-01   +5.544730397722714e-01   -7.467245576287482e-02   -3.374861016534576e-01   -2.412820522070338e-01   +4.501651438758329e-02   -6.102135210450093e-01   -4.385699711285229e-01   +3.458968917623977e-01   +4.328480086329911e-01   +4.521070375397089e-01   +1.093543502826586e-01   +3.183027561103893e-01; -3.213182025114004e-01   +4.720798971822030e-02   +6.324196173509348e-01   -1.369336446061598e-01   -6.581679379174979e-01   +8.803318634201142e-01   -5.204471265399842e-01   +3.058823842080256e-01   +2.766094919900275e-01   +1.861508588703467e-01   -2.160822920577471e-01   -2.938779175332592e-02   -4.615138096438373e-01   -6.718446844078885e-01   +4.413901185142746e-01   +7.237975493174284e-02; -5.434482779727353e-01   +7.935222038751334e-01   -1.000000000000000e+00   -1.521098993877766e-01   -1.849241165414008e-01   -6.984791173747568e-01   +3.955810743400586e-01   +8.294539075325574e-01   -9.142172714166617e-02   +2.704256913247740e-01   -1.245173602674238e-01   +1.593818568763152e-01   +5.673814864787707e-01   +1.770947434086009e-01   -6.739223262342914e-01   +4.425025596998464e-01; -4.456726515940300e-01   -5.517420374153494e-01   -3.213023646158915e-01   +5.931295262205997e-01   -3.671821585437536e-01   +2.619578797055403e-01   +4.515328144953262e-01   -2.187700866470928e-01   +7.521936897937834e-01   +5.727832065392092e-01   +2.446086454010379e-01   -3.827640119498966e-01   -2.680698227750763e-01   +1.572012056122664e-01   -3.540606544341482e-01   -6.347612499359158e-01];
L2I_L2E_iAMPA_netcon = [-2.551811270799548e-02   -3.882476002474597e-01   +2.918946756731973e-01   -5.587933858410825e-01   -3.802268781443978e-01   +7.983855175944415e-01   +5.694147211779488e-01   -7.243329960334276e-02; +4.022408404412085e-02   +3.241588969091218e-02   +8.267473237536217e-02   -5.436635371795275e-01   +3.654454556445865e-01   -7.208706477278261e-01   +5.215441123174708e-01   -5.412372535615372e-01; +1.000000000000000e+00   +2.156688378181736e-01   -3.155119306093049e-02   +2.606788472409410e-01   -8.491451472997421e-01   +1.552257122747840e-01   -2.085579512384719e-01   +2.089173320228692e-01; +5.474014038406873e-01   +4.292832553521920e-01   -5.768551364119814e-01   -5.545543482852522e-01   +4.660883601109028e-01   -8.261723091630248e-01   -8.153999509854326e-01   +4.663704255118864e-01; -3.307159367043443e-01   +6.175800210370869e-01   +5.603104028559602e-01   -3.097707351736353e-01   +1.092449385948117e-01   -4.870477882192963e-01   -3.220726629656028e-01   +2.263343440845161e-01; +4.280376178572600e-02   +5.080770017393289e-01   -4.653349547314510e-01   +1.571326191731373e-01   +2.756630090350268e-01   -8.272357400898199e-01   +7.490032417935965e-01   -6.150792509962223e-02; -4.160154748752429e-01   -5.744893091698480e-01   +4.258377334907578e-01   -2.789545297549810e-01   +9.723226239735848e-01   -6.266580480969395e-01   +1.976632284452062e-01   -3.652363318764978e-01; -1.172694211768553e-01   -8.149592026976273e-02   +3.735499383579649e-01   -8.195796761996110e-01   -2.386161274996133e-03   -2.733761069709477e-01   -3.916781923979444e-01   +1.755859856299851e-01];
L2E_L2I_iGABA_netcon = [-3.385137626538292e-01   -6.677078714411439e-01   -5.008306984903349e-01   -1.874535501976427e-01   -2.289590486844958e-01   -9.927438380284985e-01   -6.184831540043195e-02   -3.780960131542158e-01; +5.271512652469457e-01   +7.052766534340765e-01   -2.399912572234748e-02   +5.301279747720792e-01   -6.215975126885095e-01   -1.167495468031851e-01   -1.253258848691334e-01   -1.695012631115250e-02; +5.083507879914251e-01   -1.273690447505148e-01   -4.181974802862009e-01   +1.880887110376467e-01   -2.581147994800900e-01   -1.908714847677847e-02   -4.246977516859985e-01   +1.584076361280316e-01; -4.032323971841727e-03   -2.934479975199927e-01   +8.559978696446023e-01   -3.194786526365548e-01   +4.501869923272552e-02   +1.636903533276311e-02   +6.792137722129159e-01   +1.920548682567130e-01; +5.853229814522816e-01   +8.617474680537963e-02   +8.057477749483992e-01   +1.441988615145265e-02   -1.397287108155908e-01   -6.577779800552199e-01   +7.081014671645115e-02   +5.928839443536744e-01; +4.612318688679481e-01   -4.490140547099155e-01   +2.333320051936048e-01   -1.603346588714858e-01   +5.722223925129852e-01   +5.146772964218085e-01   -4.683008556410546e-02   -5.174862017052028e-01; +2.062731619544483e-01   +1.000000000000000e+00   -2.525747305833067e-01   -5.696600300924247e-02   -3.252540766615963e-01   +4.452392554464106e-01   +6.586898085769143e-01   -5.670179380757038e-01; -3.743148051484000e-01   +5.493280728937723e-01   -2.927729466991957e-01   -5.935216296510166e-01   -4.657711234814880e-01   +6.108950060730105e-01   -4.058409845432733e-02   -4.759900926224213e-01];
L3E_L2E_iAMPA_netcon = [-9.816148290600465e-02   -2.327145522036517e-01   -4.518059942716180e-01   -5.127700455291523e-01   +6.018580104206123e-01   -1.628030059279695e-01   -5.358296127961197e-01   +1.832400292827697e-01   -2.278989512179148e-01   +2.546455194936100e-01   -2.998252507065194e-01   +5.482120365081725e-01; +7.496154127002211e-01   -4.256776724345912e-01   +5.723432243664101e-01   -4.507793759165860e-01   +6.343423949634504e-01   -3.831800473945371e-01   -5.369671203288312e-01   -4.837786639196256e-01   +1.180226752220511e-01   -4.870258517906041e-01   -4.703969354157013e-02   -3.693007626650345e-01; -8.606536253609978e-02   -9.970871836565053e-03   +2.326189848324094e-01   -2.833393077781594e-01   +4.042850207933715e-01   +6.306592557817925e-01   +1.830203975386238e-01   +2.410258524839166e-01   -8.642760682339142e-01   +1.884935492825561e-01   -6.274027406893055e-01   +2.062058122717556e-01; +4.763102178777577e-01   +2.418014193377963e-01   -6.864913018188986e-01   +5.259323877201270e-01   +8.174166288606972e-01   -2.004688217533145e-01   +1.610002487305859e-02   -7.072044008185474e-01   -6.506651966677594e-02   -4.347635253798981e-01   -2.566233657767312e-01   -4.644695270568449e-01; -9.377110732252103e-02   +2.826029753511344e-01   +6.513194742089143e-01   -1.031090519549413e-01   -4.400544944552781e-01   -1.127836869065361e-01   -2.813699588185483e-02   -5.591207100356536e-01   -1.422185291335221e-01   -2.180787405818318e-02   +1.943164673078562e-01   +8.927187096496934e-02; +7.540808088061697e-01   +6.346702822633319e-01   +4.976853202678018e-01   +7.673430070594735e-02   +2.915762511233755e-02   -9.727298622042846e-01   +2.064426536503185e-01   -7.202714661002279e-01   -2.192294358111676e-01   +4.912215107785406e-01   -6.857257536843795e-01   -2.055655373083202e-01; +1.022599540891805e-01   -8.780981193599415e-01   +2.616897507610608e-01   -8.720975587409783e-01   -6.469835421544909e-01   -2.866838011445930e-01   -1.517346446266677e-01   -6.899074779354105e-01   +3.233857715099330e-01   +2.816161754388752e-01   -3.140307085237808e-02   -2.098416390462867e-01; +3.900719305620209e-02   -3.475976041863283e-02   +2.640895397987594e-01   +1.000000000000000e+00   +4.428341596613567e-01   -4.745269733484454e-01   +4.416307637002941e-01   -3.197401174060052e-01   -8.314670490671069e-01   +6.182531677955159e-01   +2.592028721125682e-01   -5.442250928403738e-01];
L3I_L2I_iGABA_netcon = [-2.273566473484522e-01   +3.199439952139419e-01   +1.640463344441457e-01   +3.716670331451880e-01   -2.905399111687395e-01   -4.717215918601582e-01   +7.541097015319382e-01   +6.199869124894543e-01   +1.628024475322722e-01   +6.416132129879867e-01   -1.193719397893111e-01   +6.873852312666648e-02; +1.768005173322377e-01   +2.705007611163235e-01   -9.594252132887365e-02   +9.608826610920865e-03   +4.899699028428495e-01   +1.764418300238298e-01   +3.310829712715017e-01   -7.736599652296282e-01   +1.661410849724460e-01   -1.932301360945434e-02   +5.638238151430813e-01   -5.022920848003516e-01; -3.257110845200857e-01   +7.042307113636840e-01   +4.400245386961166e-01   +2.552599005287783e-01   +1.993095468535421e-01   +1.000000000000000e+00   +6.029779271500331e-01   +3.491798084988345e-01   -2.951297464541245e-01   +2.660003351141288e-01   +2.792424224437106e-01   -2.392372167114524e-01; -2.229969452324756e-01   +8.292829272695446e-01   +2.086154333386510e-02   +3.617992353021549e-02   -1.630692479981427e-01   +7.758630419110765e-01   -5.797305727854032e-01   +4.077728104548429e-01   +2.645685104922119e-01   +2.249379882521965e-01   +3.078185253964737e-01   +1.790068010981831e-01; -4.401971540440027e-01   +4.032114552455564e-02   +2.654812581048860e-01   +4.572935891416787e-01   +4.997325818165886e-01   -1.372014599581138e-01   -1.171669100774339e-02   +4.425455394064257e-01   -6.773263938778968e-01   +7.120566122166541e-03   -2.089580162842808e-01   +6.871637407475600e-01; +4.116262770475236e-01   +3.437319118171902e-01   +6.419898350430167e-01   +8.783773929136923e-02   -9.450333148755749e-03   -3.481630601054704e-01   +3.687856164401321e-01   +7.228086024155678e-01   -2.737166236506032e-01   +2.726024270971359e-01   +6.263111340932749e-01   +3.295119886817764e-01; -3.106147466697576e-01   +3.200332320157315e-01   -5.360793077418754e-01   -4.879538754625309e-01   -8.180364361906707e-02   +1.706766140280845e-01   +2.078245779350358e-01   -4.037934962417930e-01   -1.301519398276494e-01   +3.402599113594484e-01   +4.864528297955280e-01   -1.410837735564451e-01; +2.048354702242620e-01   +2.189367462628882e-03   -2.657173116887631e-01   +7.913654475547789e-01   -5.057979862471555e-02   -4.556166805076921e-01   -1.958025627052715e-01   +2.479343645437731e-01   -8.124624793974318e-02   +8.797930049713937e-02   +8.042819685004072e-01   -4.500174821847143e-01];
L2E_L3E_iAMPA_netcon = [+2.586893909783480e-01   +7.526982484407360e-01   -6.436749977444308e-01   -1.098308062014509e-01   -5.036302807394933e-01   -6.601474823651915e-01   -5.368989442323637e-01   -6.306274242268254e-01; -3.054054519686615e-01   -1.443903110857857e-01   +4.582969227684500e-01   +6.244299456725155e-01   -1.258719594870032e-01   -2.770178802663698e-01   +4.584347698286282e-01   +7.742284897216088e-01; -5.930436827139216e-01   +6.643302213130040e-02   -2.979357736944107e-01   -4.836934132675033e-01   -2.173790393208434e-01   -8.123050493796688e-02   +7.862381579916276e-02   +5.231833351794071e-01; -3.924429193667632e-01   -2.917449251992372e-01   -5.148818441725737e-02   +6.043107928250840e-01   -2.211016906533892e-01   -6.003719262385705e-01   -6.794589060873594e-01   +3.347865220728404e-01; -8.439326584603468e-02   -8.807056402030432e-01   -1.691516012732066e-01   -1.950873451735540e-01   -5.967205445974976e-02   -3.435917783695250e-01   +1.000000000000000e+00   +3.706517152183870e-01; +1.979087976291924e-01   +4.631469816904989e-01   +9.064222539215967e-01   -6.658858141973181e-01   +2.632980553479570e-01   +3.507020644608512e-01   -7.469013467746686e-01   -1.248931498789872e-01; +5.942452595176602e-03   +4.515950305819148e-01   -5.762503132040234e-01   -2.337302554147860e-02   -4.267148033010175e-01   -4.510202124265915e-02   -5.711798591083355e-01   +4.757414538820489e-01; -3.709718277947400e-01   +5.084587485399950e-01   -4.849367598197874e-01   -1.062822536151752e-01   -1.445411879936369e-01   -4.627890820087442e-01   -4.849292458325671e-01   +2.573746549338873e-01; -2.575850991380564e-01   +1.497812765253672e-01   -1.727862606049193e-01   -5.950931602553220e-01   -1.987346344206525e-01   -9.886000459066061e-02   -3.064675619210629e-01   +6.507774889963356e-01; -4.244618857066359e-01   +9.367745314889284e-02   +2.146560760757973e-01   +2.643356359698383e-01   +1.837448296821501e-01   +2.239706637479220e-01   +4.791479092946517e-01   -4.248097349774962e-01; +4.949778011016808e-01   +2.670167533451872e-01   -3.310533755875990e-01   +2.904295758502178e-01   +8.462215319827412e-01   -2.857661169288339e-01   +3.970385440750519e-01   -3.282396416120780e-01; -3.554916711462415e-01   +1.410682386446699e-01   -2.809392092062532e-01   -1.832128194405160e-03   +1.552360189368372e-02   +4.439474814245237e-01   -5.766291769669688e-01   +1.597087752949788e-01];
L2I_L3I_iGABA_netcon = [-7.369425578330836e-01   +4.033588379395261e-01   -4.266893538627613e-01   -1.202202704275544e-01   +4.646905923020018e-01   -5.599795637104994e-01   +3.257498871966960e-01   -1.808494182504727e-01; -9.370058254707982e-01   -7.618344595768330e-02   -1.415511779777040e-01   +3.418544172411410e-01   -1.067738025188177e-01   +8.986344497983176e-01   -2.355679794523326e-01   +2.299493961361736e-01; +3.653347280077405e-01   +3.884614181057909e-01   -2.626310611808280e-01   -1.326232754355629e-01   -3.886542935256225e-01   -1.167604965182498e-01   -3.477263203754212e-01   -3.852402529491755e-01; +6.995972038029336e-01   -2.042938122125220e-01   +2.830285199251143e-01   -5.361621599995451e-01   +5.707127697951169e-01   -6.595908635359875e-02   +2.757207868675711e-01   +4.228130895233618e-01; +3.770836545361454e-01   +6.486761798893419e-01   +3.471712394121448e-01   +2.707819298642071e-01   +5.537043994410981e-01   -4.420214227550901e-01   -3.784570510924877e-01   +6.311448844435260e-01; -5.805417467585695e-01   -4.535710832484044e-01   +3.673507888029637e-01   +1.804942539001503e-01   +7.342783600838899e-02   +9.890960269082185e-01   +3.333975993034251e-01   +3.465997290108838e-01; +4.294337294479675e-01   -1.720876135376193e-01   +2.423265800528104e-01   -4.537172434046843e-02   -1.898586435347467e-01   -7.480175748106608e-01   +3.156318528165598e-01   +5.559946528215365e-01; -5.755189385792903e-01   +3.426327340852526e-02   +7.896205819358024e-01   +1.140547663114057e-01   -9.910636310007305e-01   +7.687395086798259e-01   +4.947378158263791e-01   +2.436357043241668e-01; -9.693880135495917e-04   -4.903263012647995e-01   +6.586886802433743e-01   +2.066687249782458e-02   -2.606869228006504e-01   +5.536472404289168e-01   +1.311604059150837e-01   -3.982273147518443e-01; -2.794961042869338e-01   -1.755992620115692e-01   -1.310132318890732e-01   -3.729640713560831e-01   +5.085497011613747e-01   +3.401201871059603e-01   -4.688075820394975e-02   +4.596874653286345e-01; -2.714546222255818e-01   +5.469791094852696e-01   +1.981036689577816e-01   -5.483878735905231e-01   +4.843951689957307e-01   +2.364704149366239e-01   -5.460270815219265e-01   -3.972699808012050e-01; -2.193373707385498e-01   +4.602622350618558e-02   +3.794142450760341e-02   -1.000000000000000e+00   +1.831568033078279e-01   -5.364411061282414e-01   -7.110094387270712e-01   +5.255467420959196e-01];
L3I_L3E_iAMPA_netcon = [+6.987300569164753e-01   -4.481779775983618e-01   -4.408384583903755e-01   -4.373977385750115e-01   -6.121646158796659e-01   +7.720716603495033e-01   -3.269532720792591e-01   -7.413079746533696e-02   -1.770406760348590e-01   +4.470014596464387e-01   -8.558992113596282e-02   +1.264664834474364e-01; -1.713008325985520e-01   +6.926239174306126e-01   -3.386213247055401e-01   -3.664014652219384e-01   -1.285149574057631e-01   +8.907404121404927e-03   +2.726447730404934e-01   +5.242835115769104e-01   -7.539451126263085e-01   -7.715265353253009e-01   -4.991522426614032e-01   -2.225713686396841e-01; -5.833903977871815e-02   +4.377470510547402e-01   -3.629059363433870e-01   +2.765555051868113e-01   +7.381322699202988e-01   +1.500162160973193e-01   -4.959657555119599e-01   +2.062983998114947e-01   +7.488075242556151e-02   -4.838013133870300e-01   +4.315463587737932e-01   +6.273887282673157e-01; -6.999778884407595e-01   -3.184317150630848e-01   -3.459927516443063e-01   +3.681062363156438e-01   -1.633343263747374e-01   -5.503117807237280e-01   +8.666951398003560e-01   +9.144028979135545e-02   +5.179140258983835e-01   -2.262642292477189e-01   +8.681410145931576e-01   -2.327739246503954e-01; +1.396316507957826e-02   -6.776041519171631e-01   -5.217642171816050e-01   -3.508363561205121e-01   +5.532273519957194e-01   +1.899868587210165e-01   +5.624001250422012e-01   +1.167777424429736e-01   +3.708068013642404e-01   +5.943038238143056e-01   +5.658126246792109e-01   +9.513425655824305e-01; +8.125495567321826e-02   -4.814600515278558e-01   -1.270507863746086e-01   -4.763476256565386e-01   -6.424892862227055e-01   +3.500878578065958e-01   +2.613013947496090e-01   -9.834821894367977e-01   +3.372702214332828e-01   -4.209900628285238e-01   +2.614509138898420e-01   +5.475498240977453e-02; -5.140089548710793e-01   -5.112745998510516e-02   +2.878891063248304e-01   +7.848367633685055e-01   -3.531857161175203e-01   -6.205681396101670e-01   +2.433045687960055e-01   -5.596540893981461e-01   +2.229923801941108e-01   +5.079577517755258e-01   -5.643470983718917e-01   +1.028703030496308e-01; +5.986681050925694e-01   -2.687389158262291e-01   +6.640409879125690e-02   -1.813338438466385e-02   +3.379100321337855e-01   -3.241239059774669e-01   -4.884331031726546e-01   -1.000000000000000e+00   -2.138322533670456e-01   +7.657419661370001e-01   +7.042524239796755e-02   +6.015657466771833e-01; +2.444283243556961e-01   -3.483873494594956e-01   -4.743069904617581e-01   +6.380811134378231e-01   +3.715571069998866e-01   -1.322603093966658e-01   -4.121155365389366e-01   -4.152353887837616e-01   +1.833958175216486e-01   +5.279292073829879e-02   -1.292146285226594e-01   +5.873632521756615e-01; -5.467739576540294e-01   +3.159049148507187e-01   -2.618100245995940e-01   +4.841874499036059e-01   +2.451819503588030e-01   +8.280801657249958e-01   -6.517587626524726e-01   +1.381414676565509e-01   -9.931022761301533e-01   +4.102502660321680e-01   -3.339288654425424e-02   +7.253024623383825e-01; -1.402817242962261e-01   -2.811438403164854e-01   +2.304578217549213e-01   -7.784332523488249e-01   +3.760231088967731e-01   +1.897446086734752e-01   +2.656117819266639e-01   -7.885375665326461e-01   +2.844104118506048e-01   -7.704846969216224e-01   +4.469121673806679e-01   -2.240818037055488e-01; +3.981668587247481e-02   -1.620902240612082e-01   +5.284806512877022e-01   -9.845636868102900e-02   +5.373782553504232e-01   +1.567490751729368e-01   +8.268809149356323e-01   +1.794250795014380e-01   +4.232560453759203e-01   +1.967592619744359e-01   +4.978405062922229e-01   -9.709076107079985e-02];
L3E_L3I_iGABA_netcon = [+7.163193736029564e-01   +2.978020371981862e-01   -4.633581888769856e-01   +1.340625250180010e-01   -2.700151794244458e-01   +6.348767617980824e-01   +1.119186539673726e-01   +2.211653801103863e-01   -1.538441235065872e-01   -3.073581278009404e-02   +1.557512603217542e-01   -7.300963551512187e-01; -1.329463050322175e-01   +7.220504308728130e-01   -3.018458799349655e-01   +2.614415093156441e-01   +4.283774009769262e-02   -1.000000000000000e+00   +4.368994153176220e-01   -1.551635247270537e-01   -5.112455459182877e-01   +7.339768894413476e-01   -1.765255919961816e-01   +5.104227782157261e-01; -2.392495239025824e-01   +7.625118610430126e-02   -3.315788468193673e-01   +1.708118100788909e-01   -8.742953774367550e-02   +8.648671711929296e-02   +1.737611667849842e-01   -6.605341128642358e-01   +2.175558699570884e-01   +4.181120091665285e-01   -3.507343728376703e-01   -3.371649875846967e-01; +7.020724071076159e-01   +4.251117011395086e-01   -2.356786604944021e-03   -6.449656170264009e-02   -8.556676857526316e-02   +6.348338684697722e-01   -4.793526851529898e-01   +2.082301988984364e-01   +5.173610581833500e-01   +3.255070280839716e-01   -4.170560810245625e-01   +6.479130924432611e-01; -6.354177329390442e-01   -1.881822083842963e-02   +7.859776473375732e-02   -4.325837242806203e-01   -2.208325287356435e-02   +2.305172989281624e-02   +6.321501418910241e-01   -1.935568275991819e-01   -2.733493060466352e-01   +2.199507072478153e-01   -2.295973917864046e-01   +7.624147671895183e-01; +5.767112832790012e-01   -2.736253822050753e-02   +2.705371584065430e-01   +3.291518374552148e-01   +1.645259199451200e-01   +1.796668027042132e-01   +2.616351218727116e-02   +1.439483836191490e-02   -2.472982213312403e-01   -1.609245085689021e-01   +1.613180815828455e-01   +1.657084153466338e-01; -1.685597630563214e-01   -5.720936473712317e-01   +4.991653152129200e-01   -4.009279412096975e-01   -2.860561085396646e-01   +3.633144666759192e-01   +6.467887625848002e-01   -2.942768403641445e-01   +4.046891271354666e-01   +5.502412520801404e-01   +1.716992961238465e-01   +3.665334112904632e-01; -3.997104674286563e-01   +2.837659321810070e-01   +6.352416524900755e-03   +5.420530190751791e-01   +5.364430159105307e-01   -1.767107763762725e-01   +5.320855342483933e-01   +3.932455863968216e-01   +2.612367982986795e-01   -6.967002044997594e-01   +3.287422356549426e-01   -1.225294743586622e-01; -2.730984611413967e-01   +7.688454931356753e-01   -5.045876717081562e-01   -1.971562228169464e-01   +2.112299348145044e-01   -5.113260768401241e-01   -4.023499525789936e-01   -5.561053978741067e-01   +2.934752761138654e-02   -1.036467549482459e-01   +4.489516769919589e-01   +5.108345306781376e-01; -3.419962716516517e-01   -3.821572912044277e-01   -3.688905940840435e-01   -2.350328383097794e-01   +7.403399228934116e-02   -5.186072712316715e-03   +8.362546540355023e-02   -4.754842255809873e-01   +5.969805545448876e-01   -6.416936692715597e-01   +3.802701120695490e-01   +1.498944863919830e-01; -4.720750905653612e-01   +4.485855414081286e-01   +9.953258895440472e-01   +5.978678972045737e-01   -5.077878027251256e-01   +5.088891723861244e-01   -6.457726009134875e-01   -5.382422791027780e-01   +4.339618020905119e-01   -2.818845130022967e-02   +3.575942827837726e-01   -1.260350083694594e-01; +1.053962014531565e-01   -1.540362114023187e-01   +1.662877207475219e-01   -2.257915568013433e-01   -3.580984789273437e-01   -3.728002644121247e-01   -6.740523355209281e-01   -4.819941007369587e-02   -6.152106209222293e-01   -6.136902370941373e-01   +6.160953905312657e-01   +3.493289117856411e-01];
L2E_Input1_iAMPA_netcon = [+1.326886354787573e-01   -3.246393699863254e-01   +7.393367667775519e-02   +3.706562300526216e-01   -5.120739037112414e-01   +8.228980461818014e-01   -3.694308473789468e-01   +4.048333552862306e-01];
L2I_Input2_iAMPA_netcon = [+2.684735742058825e-01   -1.947503360634273e-02   -4.061606262134916e-01   +8.850210531883834e-02   +8.790156973079412e-01   -3.651893749676949e-01   -7.292047692246235e-01   -1.409919317784833e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.04*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.9*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.1*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.9*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.1*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.9*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.04*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.9*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.1*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.9*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.1*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.9*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
