function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+1.509126923129113e-01   +1.208256358632971e-01   +1.402570326428328e-01   +4.405185414634051e-01   +3.309600420171930e-01   +1.809785824723073e-02   +5.893735651903516e-01   +5.176303504837931e-01   +2.791621093280077e-01   +4.776241344503619e-01   +2.318621150337427e-01   +1.101954456300361e-02   +8.297881473261252e-02   +3.967712424670698e-01   +2.494094051007986e-01   +3.698840530956610e-01; +7.891790709787576e-02   +2.609716133072071e-01   +5.140006509836678e-01   +4.428371128530604e-01   +4.417931235610139e-01   +5.786900242455290e-01   +2.183404572117333e-01   +2.456647042639628e-01   +4.328432330636530e-03   +1.853158525058723e-01   +6.301831312198472e-02   +1.623812270384244e-01   +1.114176242484752e-01   +4.545629638406233e-01   +1.971120102607616e-01   +2.685583975818133e-01; +1.320989029512073e-01   +3.832310715424149e-01   +1.136905079671020e-01   +1.167601510278787e-01   +6.227481663669399e-01   +8.731778399897977e-02   +3.986736325461110e-01   +5.159790709710459e-01   +4.415515980853927e-01   +4.952347348253691e-01   +4.579929262831557e-01   +2.791449060309144e-01   +3.265955664201995e-01   +5.554702735014951e-01   +4.440437219150863e-01   +8.752614681671091e-02; +2.883961897799328e-01   +2.780590090415088e-01   +3.796362431916504e-02   +3.451588518382556e-01   +2.959510473110690e-01   +2.614905853533409e-01   +3.835786907501612e-02   +4.702893304823995e-01   +3.723435706530966e-02   +5.690391778468010e-01   +3.970258653975453e-02   +2.617832811658767e-01   +4.003437019071968e-01   +2.721521008246019e-01   +4.104112882887979e-01   +5.898505704233170e-01; +6.380198070138684e-01   +3.626768002710238e-02   +7.599690838172449e-02   +5.095286958454589e-01   +7.259261383137815e-02   +4.846071154337820e-01   +4.458888091452451e-01   +9.419555719256652e-02   +2.736557619217078e-01   +3.391696558695152e-01   +5.683196772989284e-01   +8.194112379120495e-02   +4.049001630643968e-02   +3.029619033877572e-01   +5.010019627418628e-01   +5.965314872253304e-01; +3.018408373735479e-01   +1.862945214196336e-02   +5.878050540336195e-01   +4.518790931110522e-02   +1.712688746495672e-01   +4.302923567507981e-01   +6.268825410687192e-01   +7.109483509219987e-02   +4.608632224864910e-01   +5.094039411428825e-01   +4.666506978646296e-01   +3.034171255543858e-01   +4.272371861431568e-01   +4.801716330759649e-01   +2.026668917993104e-01   +5.441776969278572e-01; +1.148929459966514e-01   +3.521823896771308e-01   +4.549038655492270e-01   +4.010634937674247e-01   +6.962916028668155e-02   +1.073580045456490e-01   +2.372437016310068e-01   +6.486302952488397e-02   +5.204485609603302e-01   +3.419306446311288e-01   +1.695492326911587e-01   +1.119878553779187e-01   +6.172822288964097e-01   +5.424016851844177e-01   +1.897672495002469e-01   +8.016536384874356e-02; +4.693539686132973e-01   +5.502476285672931e-01   +2.906933690922043e-01   +1.929800632417771e-02   +6.084123692497392e-01   +2.156060846168880e-01   +2.554407265263376e-01   +3.094742457847716e-01   +5.871271563437518e-01   +4.102437097775768e-01   +4.272652204438512e-01   +4.664368980105923e-02   +2.728580751968240e-01   +1.271198385169147e-01   +2.288207779202532e-01   +6.001084495625567e-01; +8.302632986285251e-02   +2.852073812693124e-01   +5.448780482260202e-01   +9.028740671956872e-02   +6.151891840300846e-02   +1.418533789035917e-01   +1.686341766953847e-01   +4.288689557958631e-01   +4.191160272273227e-01   +3.314764378682057e-01   +1.466215479929273e-01   +5.734289630429574e-02   +4.894988431930086e-01   +2.980803227585797e-01   +1.474641197026643e-01   +3.856262897222235e-01; +2.885547390890206e-01   +6.287724517255858e-01   +4.319293385560437e-01   +4.257087370096823e-01   +4.366285299546632e-01   +2.406778139712182e-02   +4.409704095536968e-01   +1.094970015943610e-01   +4.850444020064323e-01   +1.600418713555292e-01   +2.680829501303902e-01   +6.071628260405155e-01   +2.095155197119624e-01   +4.304088815241003e-01   +1.024662706018869e-01   +2.559745482403611e-02; +1.421046723134257e-01   +2.193265581187962e-01   +1.715712476585443e-01   +3.175842748643549e-01   +9.287752736162365e-03   +3.060412384729156e-01   +5.974352255008640e-01   +1.791033908880859e-01   +4.317127922067098e-01   +8.463578394905462e-03   +2.081470920353003e-02   +7.750313777422693e-02   +5.454770242244539e-01   +4.918842532327954e-01   +3.128992658777656e-01   +6.898991539062005e-02; +6.079946103724663e-01   +2.362751141789690e-01   +3.181908592473263e-01   +4.129797823179275e-01   +2.380620446292128e-01   +2.772322949121254e-01   +2.837101585484347e-01   +5.003856637236440e-01   +4.213344333511564e-01   +9.079650352967379e-02   +1.573614784446864e-02   +1.563074888980902e-01   +7.996234013209859e-02   +5.305771475036511e-01   +9.000001987641026e-02   +3.775535729360859e-01; +1.322918800872073e-01   +6.171515153421420e-01   +5.539403831409814e-02   +1.417342400737986e-01   +5.137448642594918e-01   +5.152930543536136e-02   +3.033911380956604e-01   +3.646191740735968e-01   +3.479370130843424e-01   +3.090168516902193e-01   +5.599571782285111e-01   +5.702080636768840e-01   +5.052504945572014e-01   +4.361138147700633e-02   +2.262082909732558e-01   +1.461165297355235e-01; +3.882134185677684e-01   +5.904280398761611e-01   +3.109514196120827e-01   +6.643006274508774e-02   +5.337247359124613e-01   +2.568507683215288e-01   +2.271012791833504e-01   +4.164265424756614e-02   +4.748806372279076e-01   +2.326889009403032e-01   +2.816711311481873e-01   +3.780140079682060e-01   +3.192660422384828e-01   +4.113117832330301e-01   +1.094334669439841e-01   +1.134874610837838e-01; +6.260405783535549e-01   +4.043455977747793e-01   +5.572631786113786e-01   +4.561016343371744e-01   +3.718054874253452e-01   +3.996213786255408e-01   +4.911548333240908e-01   +1.835471262412220e-01   +2.784158936720602e-01   +5.381142111628396e-01   +1.364133071973548e-01   +1.864406845963132e-01   +3.932868844603081e-01   +3.012778666005914e-01   +2.994491791676785e-01   +4.956000007900511e-01; +4.751272857336586e-01   +4.776308372637655e-01   +2.419824443923557e-01   +3.701303327065090e-01   +5.766503096452403e-01   +7.453652573757572e-02   +3.418842225729979e-01   +5.619250667973025e-01   +5.607057873353012e-02   +1.984165862336279e-01   +5.711154900674698e-01   +4.938775816726350e-01   +2.440677602043825e-01   +4.202923920804259e-01   +3.063441096815450e-01   +4.276724752834437e-01];
L1E_L1I_iGABA_netcon = [+3.743266386641555e-01   +8.130731258647748e-02   +1.225734344527483e-01   +1.623102223154140e-01   +3.770202526221458e-01   +5.028853962050870e-01   +1.994255984282233e-02   +1.651312562239002e-01   +2.797776768430434e-01   +8.064843442300920e-02   +3.416409690825186e-01   +2.538533278037997e-01   +5.254750826069532e-01   +1.875569008748431e-01   +1.720300103412030e-01   +4.345187819960365e-01; +4.520490223135903e-01   +5.943537649250891e-01   +6.120829044150222e-01   +4.085361892453957e-01   +1.900756452319804e-01   +6.186694452739508e-01   +3.455540854527732e-01   +4.733200779579652e-01   +4.657867378786049e-01   +5.162177515134311e-01   +2.554653985580473e-01   +1.871475448860743e-02   +5.663202976865863e-01   +2.475957486966996e-01   +1.289346711442089e-01   +8.385585510995613e-02; +7.266856632097751e-02   +3.161455158945174e-01   +2.915044453878325e-01   +2.903423445092374e-01   +5.522352278306812e-01   +6.119602413665441e-01   +3.012623725700556e-01   +4.292932823960570e-01   +4.918307024421698e-01   +3.734562380826332e-01   +3.191887929829902e-01   +2.467345134403360e-02   +6.245285329968078e-01   +4.841355093750280e-01   +4.595434567612238e-01   +1.325599189550369e-01; +3.463149510652471e-01   +2.496840898158013e-01   +1.505159444886298e-01   +5.088027706143821e-01   +9.289069956945049e-02   +4.121403375401068e-01   +2.112673536529819e-01   +4.242328186668807e-01   +3.920912512255243e-01   +1.480303875940130e-01   +3.807849662498494e-02   +5.430748086165142e-01   +4.539728091447711e-01   +3.858615895713566e-01   +3.865904420492862e-01   +2.594234359136393e-01; +1.478327670431146e-01   +3.886054493676454e-01   +1.003726674124481e-01   +6.044708450770054e-01   +2.447875414170227e-02   +6.433399182161569e-01   +4.624036317814689e-01   +3.638421671082588e-01   +4.687183410003138e-01   +5.955722858908562e-01   +6.038903627355444e-01   +3.100246687514769e-01   +3.144032178876957e-01   +5.147007240076068e-01   +7.114231748425665e-02   +4.696838699765651e-01; +2.406645658516862e-01   +2.605420845064495e-01   +5.322493788533066e-01   +5.663297903841058e-01   +2.803303099355908e-01   +5.673474892118735e-01   +1.282386604099341e-02   +2.603271138407700e-01   +4.626545825065957e-01   +2.734537589806140e-01   +3.984990003839614e-01   +4.660269344895251e-01   +3.198936222820646e-01   +3.161036128569223e-01   +3.886502865022345e-01   +2.879223718747933e-01; +7.937901667642475e-02   +3.505878642105200e-01   +1.106051050559086e-01   +4.695317873191852e-01   +7.579375864117742e-02   +1.136797539294385e-01   +3.070515295970988e-01   +2.716322884705225e-02   +4.650362743266832e-01   +5.517375523373172e-01   +4.898005150281438e-01   +2.563710193591098e-01   +2.198196813136745e-01   +3.414415455919801e-01   +7.927056161237793e-02   +6.335209835862875e-01; +2.948005392128867e-01   +8.483776086494825e-02   +3.565358711373294e-01   +4.442971955775476e-01   +9.965412064880433e-02   +5.175143296103674e-01   +4.401755113504217e-01   +8.711156482387498e-02   +1.115849328027246e-01   +4.952987874122480e-02   +6.288854247630843e-01   +1.868937492887352e-03   +1.928329271744347e-01   +1.558704207794282e-01   +4.487951272339453e-02   +4.383644834533726e-01; +3.755550831233897e-01   +2.630595783139777e-01   +2.346015012240609e-01   +5.171287833879474e-01   +1.785409654304740e-02   +4.096742531349564e-01   +1.502300439424880e-01   +2.160663689952350e-01   +1.611625793067473e-01   +3.752697687708081e-01   +7.063769644827683e-02   +4.703532089396154e-02   +3.780147354191279e-01   +7.228132921532068e-02   +4.336662150701018e-01   +2.880195072236526e-01; +5.040736612679207e-01   +5.540194479756929e-01   +5.760011630951235e-01   +1.608430127447805e-01   +5.526094702796738e-01   +5.119549780729346e-01   +4.223370770959038e-01   +1.609412467741025e-01   +5.320192531555996e-01   +5.286267465402709e-01   +2.080074842000112e-01   +4.022722903361669e-01   +4.696072185688114e-01   +3.367233361994231e-01   +1.313399632282220e-01   +3.625559041361881e-01; +2.594764470958101e-02   +3.466328218013844e-01   +5.379891714971712e-01   +4.818323002545251e-01   +3.044030321757860e-01   +6.028718778629526e-01   +8.475867874833783e-03   +1.581920489477351e-01   +2.613737594677811e-01   +2.127827227221004e-01   +5.410313860288765e-01   +1.105249011651556e-01   +4.642959653642556e-01   +4.460660975397090e-01   +5.340575426110943e-02   +4.176853680268875e-01; +5.517817638415360e-01   +1.579053094526685e-01   +3.232636297863978e-01   +3.921532237880585e-01   +6.274884583440147e-01   +2.327996565133656e-01   +3.074011157916000e-01   +6.334190312195317e-01   +1.645259320504026e-01   +4.188480549595191e-01   +2.355060790163724e-01   +5.119584574904962e-01   +4.056982926820409e-01   +1.418017251702542e-01   +2.893156092024455e-01   +4.220594130419266e-01; +5.294006473518104e-01   +3.364240910780484e-02   +3.935270974469269e-01   +3.653844028360075e-01   +4.189221586241130e-01   +5.434691999521769e-01   +1.038533761387848e-01   +2.346181131816621e-01   +6.055198940354419e-01   +9.998898873295693e-02   +8.002837713789537e-02   +6.021744400669800e-01   +5.671457338105200e-01   +4.332612979100599e-01   +4.414294209820138e-01   +1.487091634167791e-01; +1.013639403764636e-01   +2.070727070093166e-01   +5.596706517991251e-01   +3.163886533413931e-01   +4.703002633361263e-01   +4.832864517285668e-01   +1.430909093650755e-01   +4.869852711542043e-01   +1.992332853748298e-01   +2.920367297469095e-01   +5.886764065517357e-02   +5.530956044079376e-01   +4.959265861690758e-01   +2.207493419527781e-01   +2.792587222840064e-01   +3.079167795275528e-01; +1.795493060752237e-02   +5.225743252994762e-01   +5.587032243897382e-01   +2.252526350967699e-01   +4.751449534021097e-01   +3.291258376416182e-01   +2.407574442731726e-01   +1.569959711080125e-01   +3.462068625018724e-01   +5.555247820870378e-01   +5.341771887375688e-01   +5.593985485658886e-01   +2.035424765485226e-01   +2.464531216338219e-02   +1.768233211382851e-01   +3.926173664600103e-01; +5.300351219463249e-02   +4.342350129390337e-01   +5.464423134227101e-01   +3.892953229306570e-01   +5.820367502887970e-01   +2.691211553939358e-01   +2.038907863408789e-01   +3.806490789930395e-01   +3.478494247927253e-01   +3.616193303476296e-01   +2.029997022406986e-01   +3.804145062278833e-01   +5.176584326591547e-01   +1.901330834867111e-01   +7.479951815296379e-02   +2.338590411992537e-01];
L2I_L1I_iGABA_netcon = [+3.576933081977943e-02   +9.059041176245851e-02   +5.813996137653808e-02   +3.635345395026320e-01   +3.173426994307307e-01   +2.651898821552919e-02   +1.707528396507896e-01   +4.634644862282630e-01; +1.492387914964022e-01   +3.334190459984193e-01   +5.193307785257708e-01   +5.614880370640921e-01   +3.666534509895649e-01   +2.381759318181596e-01   +5.471269999065080e-01   +3.001553487371726e-01; +5.808556494686882e-01   +6.371721164995021e-02   +4.646632470998773e-01   -4.329008464764810e-03   +6.230623247101360e-01   +6.936315067390880e-02   +2.071073277759150e-01   +3.815522462375688e-01; +2.039102275281958e-01   +8.265855901120688e-02   +4.202700950980279e-01   +3.943693965903928e-01   +3.018568339920051e-01   +5.956011560212149e-01   +4.987291035954457e-01   +4.171724979913483e-01; +4.067616143141351e-01   +2.061485000641559e-01   +2.349387798950466e-01   +3.019352404727762e-01   +3.138568419332325e-01   +3.725073759908328e-01   +4.918299185646652e-01   +5.860391721721655e-02; +4.233067010072011e-01   +1.429695372432812e-01   +6.249012609087182e-01   +7.250132334853923e-02   +5.586689257085428e-01   +1.280082044970085e-01   +4.588866707570590e-01   +1.218383073315917e-01; +1.179611921533095e-01   +6.224144130812437e-01   +3.255105765816944e-01   +6.305507398031698e-01   +5.899188563819068e-01   +1.857447131805041e-01   +5.781959282674471e-01   +3.084994762343757e-01; +2.575697546552436e-01   +2.349891820605804e-01   +2.731980461020632e-01   +7.811660357099615e-02   +2.561373370805652e-01   +5.896931765518060e-03   +5.386673160804233e-01   +5.745151201183685e-01; +4.078700505674382e-03   +5.296635990180040e-01   +1.801446135576157e-01   +3.072426448633310e-01   +4.829187823077302e-01   +6.270675120371175e-01   +3.710123738665118e-01   +1.238162453143346e-01; +1.224939415634313e-01   +3.504386424430758e-01   +3.499693674523742e-01   +2.613843818824134e-02   +4.535580387375791e-01   +4.654821525287542e-01   +1.063359962557299e-01   +3.126526390779361e-02; +3.296341890068298e-01   +2.755640290083788e-02   +2.483175677602126e-01   +9.660292546110040e-02   +1.704324978954176e-01   +5.715192210906700e-01   +6.338669645876623e-02   +1.906751355495355e-01; +1.167875420441755e-01   +5.124966122017230e-03   +5.726367019406053e-02   +4.431582561689253e-01   +2.250100050375612e-01   +4.067665873821271e-01   +4.430596784553456e-01   +5.172788371891424e-01; +4.802116498915108e-01   +1.935879615244476e-01   +5.260942105198708e-01   +3.573656124768147e-01   +2.366721451645334e-01   +3.363094992880204e-01   +2.185897841878442e-01   +4.869839087609577e-01; +1.149040534512365e-01   +5.912424270213635e-01   +4.547813663440554e-01   +5.374302530162869e-02   +6.312276762646463e-01   +3.860615044379209e-01   +1.397791980047058e-01   +3.813486802547572e-01; +5.613798557718984e-01   +3.668172550764621e-01   +4.542421001651319e-02   +6.425461942118814e-02   +1.300502355551208e-01   +2.863489145511718e-01   +5.424065393835306e-01   +5.690812723497074e-01; +6.405123706686933e-01   +5.619340951008313e-02   +7.424774031941302e-02   +5.082764185278908e-02   +5.370071694451515e-01   +1.874095939346654e-01   +3.910951458005097e-01   +4.954695522367292e-01];
L1I_L2I_iGABA_netcon = [+1.817753218205320e-01   +6.284885496263708e-01   +4.583163389504545e-01   +8.782675981479370e-02   +6.356653266100908e-01   +5.882511924442115e-03   +3.969826177708116e-01   +7.597944585214941e-02   +2.160418144606183e-01   +5.078019737920936e-01   +3.474361260521215e-01   +5.513418437079781e-01   +5.170997011014946e-01   +4.788528817032859e-01   +3.091459765917017e-01   +6.307008558342633e-01; +3.929700348653858e-01   +2.575951611644577e-02   +2.800506099412404e-01   +3.890356990540958e-01   +1.302870853356193e-01   +2.766850743065244e-01   +1.178438836701966e-01   +5.863076932131819e-01   +3.635472103649071e-01   +4.486245474338917e-01   +5.349639009298249e-01   +6.275912483409395e-01   +1.696591292248880e-01   +1.591288725345577e-01   +3.271221651067134e-01   +2.927818163590150e-01; +4.627595754628686e-01   +1.558455372822088e-01   +5.789531952893491e-01   +2.973874942551242e-01   +1.988014399760530e-01   +3.894323250700244e-01   +5.114960741932097e-01   +1.611063038128615e-01   +5.606754904764859e-01   +1.187482259820283e-01   +2.886577948144702e-01   +1.868019682995184e-02   +3.391184092706333e-02   +2.121264691342855e-02   +2.130660481842444e-01   +2.393354383012283e-01; +3.218303337819280e-01   +4.882547546785574e-01   +7.099175979847093e-02   +4.531693703725521e-01   +6.610607204758005e-02   +5.153436698057798e-01   +4.568868762334402e-01   +1.182058413496119e-02   +5.530796441933941e-01   +6.058404022280557e-01   +1.806041043288908e-01   +4.988657286310921e-01   +3.948444898107049e-01   +4.027943158441558e-01   +1.516527850878935e-01   +5.686753008042320e-01; +1.319323054046622e-01   +4.780200419847803e-01   +1.003992987195386e-01   +2.751993732903393e-02   +6.110200396344493e-01   +2.158780009580098e-01   +3.964009939543398e-01   +1.896185455295504e-01   +1.098699949632228e-01   +4.933941600871847e-01   +5.405533417261755e-01   +5.530557051293410e-01   +1.987705284439450e-01   +2.942604804468806e-01   +5.583601529099367e-01   +6.270790602337771e-01; +5.371331604299098e-01   +3.365350066084805e-01   +4.920635980257390e-01   +4.131162946989563e-01   +4.050478183479672e-01   +5.277544364344563e-01   +2.582337193430527e-01   +4.492063234263070e-01   +1.312865351189555e-02   +2.641710476925682e-01   +1.160469480356546e-02   +4.786495330472961e-01   +8.632312838646386e-02   +6.307590085746871e-02   +6.008608420658864e-01   +2.740809246280610e-02; +4.015776257515393e-01   +2.231753142883106e-01   +2.371327296428852e-01   +6.081724261796573e-01   +4.433857863023554e-01   +3.110846206521681e-01   +5.643038010833810e-01   +8.629045868509311e-02   +8.634405828617900e-02   +4.805069655090137e-01   +1.939599894469155e-01   +2.100783234738719e-02   +2.646915322235623e-01   +7.134985155810709e-02   +4.236560846016484e-02   +3.106876677899208e-01; +5.835444162363728e-01   +3.460837612321472e-01   +1.511423690923532e-01   +4.274825994558279e-01   +2.893780381051464e-01   +3.622587561640789e-02   +1.339336077883184e-01   +5.481176336589600e-01   +3.609663960283368e-02   +3.650086789877650e-01   +3.807717949628681e-01   +1.945821825122821e-01   +2.383392233063795e-01   +4.717395947340711e-01   +5.454312115093087e-01   +1.500806921960608e-02];
L2E_L1E_iAMPA_netcon = [+5.703257457953240e-01   +2.265136617435206e-01   +5.333110152260420e-01   +8.182557879937861e-02   +6.102650906510214e-01   +4.618605425404819e-01   -3.378633622955737e-03   +3.135182220727484e-02; +4.792704780586124e-01   +8.255640157834421e-02   +3.206677507479183e-01   +2.444236469731363e-01   +2.505048363130001e-02   +3.996094379757977e-01   +2.528757034974473e-01   +2.433219593880697e-01; +1.031326439343155e-01   +2.046739343882776e-01   +8.538712629050836e-02   +2.997457037921770e-01   +5.246598870313774e-01   +5.493584873318078e-02   +3.460389818104046e-01   +4.099292287923325e-02; +2.149894917954147e-01   +3.123003716420742e-01   +1.364967270896520e-01   +3.088763217911032e-01   +2.561412366585293e-01   +1.246253138250437e-01   +4.416767862480871e-01   +4.418249060946312e-01; +2.544337657660538e-01   +3.484992983130045e-01   +1.235230090889756e-01   +5.033506554376687e-01   +5.709993256408176e-01   +1.318105302202258e-01   +4.670973479284034e-01   +9.975548731206883e-02; +3.711113585750848e-01   +1.186571268595245e-01   +4.651771755372511e-01   +5.243374647446339e-01   +1.266792019931753e-01   +2.881332701118901e-02   +1.749652429109613e-01   +3.665703495353672e-01; +2.067757280342704e-01   +5.849507386078008e-01   +4.184557379187313e-01   +4.664311168733665e-01   +2.998283477948064e-01   +4.522769197785899e-01   +2.689326931384466e-01   +1.464989169367010e-01; +1.347613855142641e-01   +4.485426950118913e-01   +2.792620043658029e-01   +4.420890904458095e-02   +2.328863723518606e-01   +5.465684284082313e-01   +6.355070304396123e-01   +5.300579325902802e-01; +8.128576063814885e-02   +4.640644763899043e-01   +3.286136415540657e-01   +3.745046403961547e-01   +3.277633101034507e-01   +5.502084794347838e-01   +2.544887961071409e-01   +6.110621490389599e-01; +5.686250639767929e-01   +5.961488744299093e-02   +1.220230923005657e-01   +1.566299480728519e-01   +4.845744237025728e-01   +5.040648517597571e-01   +7.452917003158417e-02   +3.170764953243889e-02; +3.197413824119011e-01   +5.845818504711501e-01   +5.368788068417542e-01   +2.025736502908098e-01   +2.323731064099493e-01   +4.619076059776438e-01   +1.169441778362463e-01   +1.029131348938575e-01; +4.868476861726812e-02   +5.746523460104365e-01   +5.392858115671498e-02   +2.252592977294724e-01   +2.044023458094428e-01   +3.053500085230509e-01   +6.311102605962158e-01   +4.870841670318082e-01; +1.059772819697933e-01   +5.589235199314133e-01   +4.478813660058156e-01   +3.720036263913870e-01   +3.233766917262268e-01   +3.972124679182211e-01   +1.090427221148816e-01   +4.614933361207129e-01; +6.456687070762542e-02   +2.329773675293591e-01   +7.899833766682970e-02   +4.460594398640183e-01   +5.610724343662692e-01   +4.776618525758844e-02   +3.172581533555858e-01   +4.294398686950274e-01; +5.085603463621213e-01   +3.920726132684934e-01   +1.112069667640215e-01   +4.670651149462967e-01   +4.839263968734256e-01   +2.205337661027171e-01   +7.928038321575286e-02   +5.117495967421829e-01; +6.224858541220374e-01   +1.922001182606952e-01   +1.847850462014496e-01   +2.816789169612998e-01   +3.604108059198838e-01   +4.060361755689021e-01   +1.760285954034581e-01   +4.974562683927506e-01];
L1E_L2E_iAMPA_netcon = [+5.878927249501743e-02   +5.319711556878148e-02   +2.412752766998651e-01   +4.712066445998797e-02   +5.035997079889687e-01   +2.223393517820311e-01   +1.703076199865405e-01   +4.819165376673442e-01   +4.911777286529405e-01   +5.905962815832504e-01   +6.156265551980287e-01   +3.614793829223760e-01   +5.838967132436099e-01   +9.033398670663391e-03   +2.059483222042124e-02   +4.359174913138982e-01; +1.962342765677973e-01   +5.354398251049647e-01   +6.169783739506697e-01   +2.264559902349428e-01   +1.447644635680838e-01   +6.819943144896143e-02   +4.116345815553514e-02   +1.585612506674425e-02   +2.302885511126191e-01   +5.236791092858172e-01   +2.118183693093277e-01   +2.712770131274939e-01   +4.710700313374973e-01   +6.071775341499437e-01   +1.280561319453891e-01   +3.378962496514361e-01; +3.273366455209256e-01   +5.298195719764466e-01   +5.620793218217319e-01   +3.867194725647333e-01   +4.111123843939223e-01   +5.626259488356034e-01   +4.283053428739115e-01   +1.667604980585950e-01   +1.107091182426293e-01   +3.902683331948732e-01   +1.511260370468391e-01   +6.499774805451136e-02   +4.841721694136153e-01   +1.929300637208564e-01   +4.604170258805845e-01   +2.622356404899920e-02; +3.247232558957361e-01   +1.129880106529579e-01   +3.949518858159751e-01   +3.812226753400279e-02   +1.211786341095195e-01   +3.226463321346882e-01   +4.652587430486932e-01   +2.341890070760243e-02   +6.313643131501490e-01   +4.000399759915963e-01   +1.157270820518085e-01   +9.450573086573934e-02   +2.044768041150712e-01   +3.275156353925425e-01   +3.782936586643248e-01   +4.935850193410319e-02; +5.207770827204545e-01   +2.914700790942416e-01   +3.142500925610316e-02   +5.325924372713611e-01   +5.426761143961680e-01   +2.368985322744266e-02   +3.062171128816678e-01   +3.882637036218997e-01   +2.680184541120558e-01   +6.007519988192840e-01   +2.571641269004829e-01   +5.047231987168552e-01   +1.653966388961805e-01   +1.271401199924140e-01   +1.278171666931533e-01   +3.745108729206950e-01; +1.804868798781078e-03   +3.352282431340929e-01   +1.363364478736477e-01   +3.856140184697150e-02   +1.784293243547683e-01   +1.196252411467098e-01   +2.166179045616863e-01   +5.985925428370828e-02   +2.422382966301178e-01   +3.644534298852745e-01   +3.739834073109157e-01   +6.981778296536888e-02   +3.614995939776564e-01   +2.467342011073895e-01   +5.263211845939111e-01   +6.097515188352733e-01; +3.393094640859070e-01   +5.393069123927582e-01   +4.526717815132761e-01   +5.220135846928442e-01   +2.074028357127704e-01   +2.696492587730539e-01   +3.195874093329048e-01   +1.666029040792060e-01   +5.877608638951258e-01   +5.257584029124592e-01   +4.046308357183473e-01   +6.611559157992031e-02   +1.787019163725599e-01   +2.053964580415449e-01   +2.285700118330795e-01   +2.689540446945893e-01; +5.702930397655395e-01   +1.176425419411069e-01   +3.544921367524123e-01   +9.210314403131380e-02   +4.107084143599027e-01   +5.649367932022503e-01   +1.844696963387379e-01   +5.898926085634575e-01   +5.906847725469452e-01   +5.658316563476732e-01   +1.812687580607708e-01   +5.299400657696553e-03   +3.321145208348592e-01   +5.110157844505324e-01   +5.731095530842290e-01   +3.644657609155375e-01];
L2I_L2E_iAMPA_netcon = [+2.529551303567301e-01   +3.757341487896902e-01   +3.217981996083347e-01   +6.600435376610179e-02   +1.002904879863765e-01   +1.198763511350905e-01   +6.346109571602675e-01   +5.224040035937157e-01; +7.372436805959902e-02   +2.699693566217800e-01   +2.120899630135810e-01   +3.759134061549644e-01   +3.055563685319149e-01   +5.127588332450146e-01   +5.205231669814812e-01   +2.448066640928387e-01; +1.754942453733232e-01   +5.139303503087843e-01   +1.383808980381371e-01   +1.305734978660299e-01   +1.577817874818434e-01   +3.580090531380454e-01   +6.019922159864870e-01   +4.267180971044669e-01; +5.329363592166916e-01   +1.840754343220847e-01   +3.845400865190941e-01   +3.926897183191373e-01   +2.153680281491325e-01   +4.302824332597972e-01   +3.547948287151962e-01   +4.206203872504901e-01; +3.546606048549901e-01   +3.051847091471183e-01   +3.471483619542938e-01   +4.662004036443436e-01   -2.839431651196597e-03   +4.746582768280263e-01   +3.978459476357846e-01   +1.561216286699584e-01; +5.382912116201753e-01   +4.086980869193232e-01   +4.559132838568835e-01   +6.262457804327061e-03   +1.386872850106129e-01   +5.181614030778401e-01   +5.196942817023502e-01   +6.867491977858600e-02; +4.899461677866077e-01   +1.778848563057072e-01   +3.974663272300500e-01   +3.100560735399533e-01   +2.816640486585185e-01   +3.704404542545244e-02   +8.812056608009139e-02   +1.093716948346841e-01; +1.868568789843940e-01   +2.970088891508630e-01   +4.633241708822058e-01   +4.994957631395698e-01   +5.602584128638349e-01   +2.373019425813941e-01   +4.920024478919918e-01   +3.447092633651079e-01];
L2E_L2I_iGABA_netcon = [+2.986724407649989e-01   +3.222754342964999e-01   +5.733651882196648e-01   +2.095681901659135e-01   +4.533482782039293e-01   +5.067981566597396e-03   +2.879285422420220e-01   +5.424271671613249e-01; +2.204004839558944e-01   +2.904402186755702e-02   +4.286976793891426e-01   +6.226173692426726e-01   +1.885968161410695e-01   +3.429238683539897e-01   +5.665497409372103e-01   +3.316840852962040e-01; +3.021022604560314e-01   +9.061871491350619e-02   +5.141282717346405e-01   +1.398987854210947e-01   +1.308022021919272e-01   +5.604737516535550e-01   +1.503025724403799e-01   +5.093422016402588e-01; +6.220284488280776e-01   +3.768721071992749e-01   +3.687547247956266e-01   +2.361486709087338e-01   +2.327394981238708e-01   +3.274939969422143e-01   +5.764189140637794e-01   +4.870908892447020e-01; +4.702811845351493e-01   +2.521019876513188e-01   +2.589488571434083e-02   +1.630136656685220e-01   +4.881943642621626e-02   +1.349137049240575e-01   +2.427987425595397e-01   +1.709106257355605e-01; +6.219957172322806e-02   +4.598247960276680e-01   +5.797183748141388e-01   +2.713382574794133e-02   +2.930847794670048e-01   +5.059481554294720e-01   +1.726647500616525e-01   +1.319452667917561e-01; +1.473681342280355e-01   +4.633483690797533e-01   +3.052799031651971e-01   +5.523655911820144e-01   +6.345684400996773e-01   +3.727838276105871e-01   +2.377505711186245e-01   +4.201561866284312e-01; +1.833093850099025e-01   +1.603356234689903e-01   +3.660665819469003e-01   +1.648940715821693e-01   +6.152223416269780e-01   +6.368014313791627e-01   +4.849304468000886e-01   +6.945792107311076e-02];
L3E_L2E_iAMPA_netcon = [+2.384442162670754e-01   +2.697384807066834e-01   +6.264133745609669e-01   +5.548164011830540e-01   +6.280655484967599e-01   +3.800727815767462e-01   +1.330047665328845e-01   +1.962906941825253e-01   +4.773515662453503e-01   +4.444811533572011e-01   +2.241819448509685e-01   +2.172070225085205e-01; +4.715325478732885e-01   +3.426224513921290e-01   +4.433953261854972e-02   +6.347298647506907e-01   +1.408739451759856e-01   +2.798616732509308e-01   +2.308394508490096e-01   +5.269110995821499e-01   +4.612124056293863e-01   +4.103129134318209e-01   +2.689036738790945e-01   +2.488878122945789e-01; +4.862712804172927e-01   +4.517241928982167e-01   +3.200039195801973e-01   +4.512345684648197e-01   +2.628244458731079e-01   +5.414153235571620e-01   +4.767008837337494e-01   +1.732754284202407e-01   +4.419029149940534e-01   +1.068481522425337e-01   +3.208577397005966e-01   +4.855184321432698e-02; +3.255709501647656e-01   +2.849455350652481e-01   +1.986604119990230e-01   +5.767699243314471e-01   +6.112424289882586e-01   +5.153099441344229e-01   +6.368885710015999e-01   +1.840922016092011e-01   +5.146471023169246e-01   +2.446129998875793e-01   +4.473929932984125e-02   +3.101832171575358e-01; +2.744331528257841e-01   +5.032677010016101e-01   +3.861720233237647e-01   +3.235529789452820e-01   +4.287100911534517e-01   +6.030229922819783e-01   +3.720875100969689e-01   +2.527140166421024e-01   +9.021162721576448e-02   +4.418477537191038e-01   +6.267278277907338e-01   +4.852483537157505e-01; +1.351919058806908e-01   +5.777966128135823e-01   +5.580584457930460e-02   +9.533695022429660e-02   +4.114424790663702e-01   +5.367752334226524e-01   +3.862608780195533e-01   +8.222402698955247e-02   +5.777960351762391e-01   +3.840759548473781e-01   +4.124787435139161e-01   +2.976615989644675e-01; +4.058214387004979e-01   +1.550147099983215e-02   +1.332473935760412e-01   +3.748816271259310e-01   +5.409476520129012e-01   +3.486801720124353e-01   +3.507769708218744e-01   +2.903225369345211e-01   +3.565109908044830e-01   +1.480663311638281e-01   +3.841130599265989e-01   +6.133010660291025e-01; +6.183195000816600e-01   +1.011534837220767e-01   +6.777363864274354e-02   +5.929788006948898e-01   +5.999563591295924e-01   +1.648471879218359e-01   +4.378375582548747e-01   +3.234843075584256e-01   +2.804799849983441e-01   +1.371407474763960e-01   +2.015995894864111e-01   +1.248394225956057e-01];
L3I_L2I_iGABA_netcon = [+4.471815513154412e-01   +3.468981159869354e-01   +3.365597199669824e-01   +6.091234914065638e-03   +6.080520836652464e-01   +4.333652539226559e-01   +4.975943023022540e-01   +2.563450806115933e-01   +5.100689992719589e-01   +2.142877010252650e-01   +1.260845039948502e-01   +5.123624576670844e-01; +3.795550042558917e-01   +5.368333783710725e-01   +6.280305185339422e-01   +3.316479568900099e-01   +4.958025997564934e-01   +2.233730693906212e-01   +6.322598868421981e-01   +4.237302373918095e-01   +1.298862675896690e-01   +1.050349710206891e-01   +4.527587074883637e-01   +1.756500677002334e-01; +2.217281079562060e-01   +4.307985223615849e-01   +4.436611616915302e-02   +6.301879098887403e-01   +3.567469599293931e-01   +6.332417098526159e-01   +1.598406117248040e-01   +5.693981247386514e-01   +3.805833684942987e-01   +1.922760208768336e-01   +3.024631676599860e-01   +1.708272695344362e-01; +5.344262996113597e-01   +3.715800450427976e-01   +5.807458797427857e-01   +4.000683957696931e-02   +9.291901905505211e-02   +5.264694133777910e-01   +5.255122987543935e-01   +5.223562254523493e-02   +6.247205803732314e-01   +6.184504879484216e-01   +5.900011525740219e-01   +1.202981150618518e-01; +1.062352847901561e-01   +6.282848394716484e-01   +4.994136343597784e-01   +6.124956780653837e-01   +5.803679731027201e-01   +4.075166913598849e-01   +3.819359346306339e-01   +2.032797762591154e-01   +5.748883761482345e-01   +1.231575823155201e-02   +9.075458128880629e-02   +2.142708081137314e-02; +1.116669269477371e-01   +4.095239312825978e-01   +3.117805111573628e-01   +3.424731689647004e-01   +3.899188970973952e-01   +6.273075313048879e-02   +1.722963533325114e-01   +2.094547980494360e-01   +1.141302267817507e-01   +2.706868881609079e-01   +3.298505163114763e-01   +4.764338981957901e-01; +3.946269611629296e-01   +5.174622566551750e-01   +6.971548195073587e-02   +4.447495157566734e-01   +2.572609377370877e-01   +2.322307909964306e-01   +2.260961492519870e-01   +4.682295423505927e-01   +4.438394880588732e-01   +4.462496693868204e-01   +4.276583637510670e-01   +4.768071737899401e-01; +2.098646626744910e-01   +1.534460717095088e-01   +1.800870507934086e-01   +5.146755490505937e-01   +5.499548773715139e-01   +3.157898634119921e-01   +5.120031365172414e-01   +5.644705088281375e-01   +6.099165766638948e-01   +4.751800266972746e-01   +4.926571089794886e-01   +2.610355200450351e-01];
L2E_L3E_iAMPA_netcon = [+3.136989249400157e-01   +4.955288826943283e-01   +1.470269603391513e-01   +5.880663601012871e-01   +4.834121889080439e-01   +8.642724845998297e-02   +5.489541069323831e-01   +3.564199739796476e-01; +2.323371925521353e-01   +5.853565474199018e-01   +1.285584645250027e-01   +2.236371396495642e-01   +4.810122677881782e-01   +7.608671036377591e-02   +1.579502528269843e-01   +4.169207552268415e-01; +5.808803328889167e-01   +1.939520828551225e-01   +4.735204736026327e-01   +1.227204735293006e-01   +5.769701395382848e-01   +2.397871353454746e-02   +3.506329310986332e-01   +1.424293456060475e-01; +1.943316459303696e-01   +4.525898718906280e-01   +7.386182002168498e-02   +6.318608728665069e-01   +2.568428251672262e-01   +1.038883690617598e-01   +4.274033076632645e-01   +4.785796527587547e-01; +1.669595892115162e-01   +2.367637735113270e-01   +1.820842969531379e-01   +3.739367384870720e-01   +4.203051842611308e-01   +5.127773166094177e-01   +3.012793620130921e-01   +5.769050214049896e-01; +5.204087030856643e-01   +6.174710681564346e-01   +3.706860388013768e-01   +4.321238893108882e-01   +1.663778667219892e-01   +2.360559859439972e-01   +4.418386426663621e-01   +2.666125876947514e-01; +6.471000960054705e-01   +2.982254604208615e-01   +7.665819127549998e-02   +2.119697099452627e-01   +3.559065677471343e-01   +6.123118523115960e-01   +1.082435817563567e-01   +6.126547267545779e-01; +5.306367571745589e-02   +1.621768465910928e-02   +5.732463573267551e-01   +1.912733155816961e-02   +3.607337543727084e-01   +5.279854932525937e-01   +6.319985629971427e-01   +3.185124456179796e-01; +3.341067674696401e-01   +6.113398769791670e-01   +2.093976347318776e-01   +1.743180003778378e-01   +3.995941844949606e-01   +8.307297407090490e-02   +2.102062700264472e-01   +5.662106744372024e-01; +1.505455150507761e-01   +5.607917579086541e-01   +4.127056080847614e-02   +9.235498535227303e-02   +2.729381650024787e-01   +4.325279983362737e-02   +3.831040913944779e-01   +1.865441812447376e-01; +3.310305505474172e-01   +1.369356030443154e-01   +5.554830618217586e-01   +3.623960997165510e-01   +3.699402660739674e-01   +2.497852777800267e-01   +1.588793822935417e-01   +4.783072424955327e-01; +1.957145919393755e-01   +2.194826591412390e-01   +1.757358086612770e-01   +5.667794468577929e-01   +2.740916801272648e-01   +1.740676130272634e-03   +8.584492723091379e-02   +1.499990319673506e-01];
L2I_L3I_iGABA_netcon = [+9.061076852023933e-02   +3.985643141764206e-01   +4.722082607976518e-01   +3.987284345644743e-01   +9.010320633235711e-02   +1.933740791076264e-01   +3.049638500311426e-01   +1.406080245694350e-01; +5.460438721323374e-01   +1.461899957979139e-02   +4.246651004044107e-01   +5.392198766729613e-01   +5.345948662658827e-01   +5.853697482699284e-01   +3.777771360561037e-01   +6.284320819583831e-01; +5.092399012492133e-01   +4.007255405754101e-01   +4.376980958564703e-01   +3.785843984747772e-01   +2.978567735905705e-02   +9.065093859030840e-02   +3.127999419649554e-01   +4.800204330465493e-01; +1.143786666942517e-01   +3.198969121191513e-01   +3.312389872033868e-02   +2.935350305825727e-01   +2.796941256653637e-01   +5.789126997101113e-03   +6.005146645760174e-01   +6.210809721456277e-01; +5.355262167973767e-01   +6.147823789476576e-01   +2.095977953019427e-01   +2.523823047949890e-01   +1.763646976480583e-01   +3.411379672118781e-01   +6.196491847908610e-01   +5.833832579039309e-01; +3.210982174039127e-01   +2.626919756692835e-01   +4.379885862166343e-01   +5.672686430321194e-01   +6.285887497738143e-01   +4.961443192692792e-01   +4.470407046497767e-01   +5.115675953954504e-01; +4.508790351351317e-01   +2.695734986134951e-01   +1.892188741806749e-01   +1.003789824949826e-01   +6.336027732040690e-01   +4.633705247064886e-01   +4.303387997068994e-01   +2.919425817474250e-01; +3.097341041217234e-01   +3.600643969718914e-01   +4.532288788414959e-01   +4.026180554501742e-01   +1.829618242147005e-01   +3.933351502175191e-01   +2.964163249189543e-01   +4.288746658430480e-01; +6.997262471571455e-02   +2.872897329942556e-01   +3.671722923784612e-01   +3.299564444639246e-01   +1.596341749073497e-01   +3.034623748704467e-01   +1.401305397512051e-01   +3.844517905167766e-01; +5.417231658076413e-01   +2.277595166868026e-01   +5.371995740714745e-03   +1.011459954153797e-02   +3.859021543404134e-01   +5.851933230080995e-01   +5.034178550505354e-01   +4.744561843754665e-01; +5.130590695912274e-01   +6.032281756375660e-02   +4.080819579479807e-01   +5.202618114487809e-01   +6.388029415891266e-01   +5.041336231386314e-02   +2.723923826442779e-01   +4.430261230441924e-01; +4.272246885870968e-01   +6.706336779532605e-02   +2.633465814410350e-01   +9.720289492799036e-02   +3.098181486267575e-01   +5.536532410846341e-01   +2.077477881898138e-01   +3.022416459288840e-01];
L3I_L3E_iAMPA_netcon = [+4.713218892765184e-02   +5.303525125767966e-01   +5.077183518369814e-01   +4.037745436208137e-01   +1.861497670831259e-01   +3.859876887450620e-01   +5.960223371913705e-02   +6.315191984600158e-02   +2.332253370429571e-01   +1.813161464824131e-01   +2.190433565615122e-01   +4.556310056266253e-01; +3.056601677696593e-01   +3.550663031291303e-01   +1.786067067937810e-01   +5.409204573759837e-01   +3.663272396922636e-01   +4.978153050516565e-01   +1.023458331054556e-02   +2.886749972634327e-01   +2.679484989062717e-01   +2.966781988357173e-01   +9.225491623450033e-02   +4.684050515584337e-01; +5.010823600136756e-01   +2.688236278440367e-01   +5.888954389949418e-01   +1.136225005758151e-01   +4.051860979817594e-01   +5.188368370490587e-01   +3.923526054352154e-01   +2.899987790492719e-01   +1.795723668459542e-01   +1.645006998356501e-02   +2.430404321077355e-01   +6.098434881504950e-01; +3.045108872321503e-01   +6.249461328474910e-01   +4.917646294971183e-01   +2.463898895488599e-01   +1.897705652824012e-01   +1.547568160542974e-01   +4.566177750071213e-01   +3.078578988630858e-01   +1.447451750273095e-01   +8.351522679388651e-02   +5.556208009092468e-01   +1.362909003725917e-01; +6.284760608837954e-01   +5.249540854745767e-01   +4.933426201120040e-01   +2.332886079851593e-01   +2.699013781999597e-01   +5.989098042669546e-01   +3.999896586916385e-01   +4.047629182460253e-01   +4.555437615024115e-01   +1.496967175202099e-01   +4.325418832975256e-01   +5.373989185435645e-01; +7.935886681484374e-03   +4.360939274150171e-01   +3.538393140592526e-01   +3.560827514763074e-01   +1.531819998576674e-01   +3.220098195336556e-02   +5.259734717206315e-01   +3.158845527055758e-01   +6.145525740942842e-01   +4.671128417902251e-01   +9.360541579213838e-02   +1.535766956280880e-01; +1.527256706926463e-01   +4.352086242983632e-01   +3.465008730847263e-01   +5.125410752498897e-01   +1.306034021717321e-01   +3.238629118712977e-02   +2.189624987838041e-01   +5.795414369084882e-01   +1.812655901012867e-01   +3.448695556485963e-01   +2.573875970543473e-01   +1.747911836041179e-01; +1.807890896153604e-01   +4.039240266304664e-01   +3.240202455681460e-01   +3.534526335663004e-01   +5.981847920297869e-01   +2.606395792653192e-01   +3.672118186254526e-01   +5.639218751882145e-01   +5.890571123529670e-01   +4.493362485636326e-01   +1.089878725554176e-01   +2.107092566490601e-01; +6.020247321850508e-01   +2.400673597228772e-01   +3.243543262809298e-01   +5.992660070428707e-01   +3.499787070879922e-01   +1.255891178953397e-01   +3.213692790108368e-01   +5.836896669160034e-01   +1.260026798935650e-01   +6.278818030503371e-01   +4.517338109199699e-01   +2.129310385787298e-01; +6.299508513007694e-01   +1.186128126686683e-01   +4.090745893906162e-01   +1.670568882743639e-01   +2.296919075143360e-01   +5.086643860672404e-01   +5.457428863828816e-01   +2.535275949431078e-01   +3.186343678920104e-01   +2.723666143523297e-01   +5.252301063845851e-01   +3.746573732029818e-01; +2.067658312750993e-01   +5.967310523312666e-01   +5.860538245705750e-01   +1.173187585473614e-01   +4.260625902188127e-02   +2.406563706143614e-01   +2.201362392838372e-01   +6.298404602034295e-01   +3.370641402192152e-02   +9.185182856468284e-02   +5.432958045783163e-01   +5.136918092076572e-01; +5.589134447935932e-01   +1.258658826511246e-02   +4.544380483608704e-01   +1.824942280208873e-01   +2.557532831155397e-02   +2.918758847582498e-01   +2.160360636380054e-01   +6.177462552264650e-01   +6.386152321170501e-01   +2.156664943903759e-01   +2.366135781980624e-01   +2.010865550591761e-01];
L3E_L3I_iGABA_netcon = [+8.435824007597315e-02   +5.241455203887363e-01   +6.330362834938333e-01   +4.466719131957684e-01   +3.374335513065201e-01   +9.254241521555780e-02   +2.516419014270267e-01   +5.260914011375308e-01   +5.538189139439503e-01   +1.773077178286294e-01   +1.691626043011698e-02   +2.459769305360004e-01; +5.938241253620977e-01   +3.981285498603172e-01   +6.583505923080873e-02   +5.247529470670440e-01   +9.891936970580766e-02   +9.115137390568054e-02   +3.046695956651031e-02   +2.057312943432274e-01   +6.277348872584330e-01   +9.687947020346101e-02   +1.899007357055510e-02   +2.230497604320543e-01; +1.316889096322925e-01   +2.282018472511680e-01   +4.839614801848067e-01   +4.700450457198501e-01   +2.979010363355644e-01   +2.138080924533450e-01   +2.562008377355209e-01   +1.337685717836133e-01   +2.035697687883015e-01   +4.456979941319405e-01   +3.259360628034292e-01   +5.485369091846555e-01; +3.170887771695540e-01   +4.517257015340006e-01   +2.486545075350015e-01   +9.358874978310287e-02   +3.145371653239393e-01   +5.192937624885885e-01   +1.192947813612053e-01   +1.316454524153671e-01   +5.500871290170576e-01   +1.002722842906248e-01   +8.604677929916987e-02   +3.427932389195721e-01; +4.032900618331152e-01   +3.062925096146429e-01   +4.137607288309383e-01   +4.856854351931028e-01   +4.885769876056171e-01   +5.656637232236597e-01   +3.777850687427326e-02   +2.047055082190378e-01   +3.608425433231395e-01   +2.830562485055577e-01   +4.656964131853585e-01   +5.229819448425436e-01; +5.384793693838523e-01   +4.123250040500568e-01   +4.811797879862073e-01   +2.087509097688716e-01   +1.595244584466066e-01   +1.097464760499291e-02   +2.623462511209562e-02   +1.548234573343932e-01   +8.173783779632975e-02   +2.521920492243074e-01   +2.793956003395396e-02   +2.463472664182107e-01; +1.948784421731926e-01   +4.805144633575335e-01   +1.621165311945796e-01   +2.071593075046254e-01   +9.889676162789160e-02   +1.977048250356856e-01   +6.146040848781864e-01   +1.138869441383082e-01   +4.565016103818226e-01   +6.268293547258028e-01   +9.694293345957115e-02   +3.512352944750431e-01; +4.273898324785440e-01   +2.787911121367172e-01   +6.348643383948380e-01   +1.129480977760078e-01   +3.080463326705552e-02   +6.616067641967018e-02   +3.730499869345213e-01   +1.629543447155408e-01   +1.927398299154563e-01   +4.799833756327206e-02   +2.393196491606816e-01   +5.572792028887291e-01; +6.259344686814875e-01   +1.096214947340044e-01   +4.404548561530711e-02   +5.662836901795892e-01   +1.539133882318154e-01   +5.308876840085912e-01   +1.040936219609529e-01   +3.068781469038377e-01   +3.422189258927235e-01   +2.687300170409198e-01   +5.752482193603398e-01   +3.471235043177469e-01; +5.942474617886716e-01   +4.015522783403916e-03   +3.147134132141562e-01   +1.044172246904241e-01   +2.045301268862517e-01   +4.715712967225290e-03   +9.849889893130185e-04   +1.684954285940229e-01   +1.732681886414659e-01   +2.410839348055829e-01   +2.071839316615515e-01   +3.152495306227506e-01; +3.085754325587079e-01   +2.500414573242990e-01   +1.911516400019160e-01   +1.583664771672904e-01   +5.733728103155803e-01   +3.030113032153293e-01   +2.819086165520270e-01   +6.947184093372198e-02   +3.249726657472332e-01   +3.081898820997794e-01   +1.369231457491426e-01   +4.165677341938308e-01; +4.387957583247345e-01   +2.382730882416670e-01   +3.177314908953607e-01   +4.926483182042516e-01   +5.635931669580279e-01   +3.770129574330889e-01   +4.161617687084146e-01   +6.035981261875084e-01   +6.831365733641029e-02   +2.259584026820873e-02   +3.323293487522195e-01   +1.653632724069484e-01];
L2E_Input1_iAMPA_netcon = [+5.465345983966037e-02   +3.094178858796020e-01   +3.849206768948425e-03   +4.298139905705564e-01   +6.009088102541581e-02   +5.400897549304011e-01   +1.521207632852390e-01   +3.249712256529756e-02];
L2I_Input2_iAMPA_netcon = [+2.308044918960302e-01   +5.911204592799867e-01   +2.243748572598392e-01   +5.195577510813230e-01   +2.895057009245849e-01   +2.493476369368672e-01   +2.099202329245162e-01   +1.385628788694729e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last =  5.6 * ones(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = -10*((exp(-10*((t)-( 50))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 10*((exp(-10*((t)-( 50))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
