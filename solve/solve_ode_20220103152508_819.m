function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+3.745861634400918e-01   +3.017729837454030e-01   +6.487154207049358e-01   +1.708247603923264e-01   +2.488338290928524e-01   +6.588151246307981e-01   +6.133137720367351e-01   -9.362549133849797e-02   -5.752741563847739e-02   +1.488545189999708e-01   +5.364784974600586e-01   +3.883897405859756e-01   +3.601715652660202e-01   +3.150229896707024e-01   +6.669956336563083e-01   +4.783983187448676e-01; +4.043558167537271e-01   +1.721336480764651e-01   +2.445770731271943e-01   +3.909299037446590e-01   +4.544035887515536e-01   +2.252959515133976e-01   +2.271087993963934e-01   +3.419124024158220e-01   -1.185012747473447e-01   +6.802952330965334e-01   +3.690207704642786e-01   +6.242872888346062e-01   +6.805939255796398e-01   +2.334776540763695e-01   +5.509817262397214e-01   +3.684827100846909e-01; +7.941987788264390e-02   +3.023539381745723e-01   +5.224046165102352e-01   +7.557979914253666e-01   +7.331755891366337e-01   +2.979456301672180e-01   +2.654003515945038e-01   +4.575438565419188e-01   -1.087929509921285e-03   -9.850110011454387e-03   +4.579988954000985e-01   +6.602857623163567e-01   -1.302603868314658e-01   +2.176251624711397e-01   +5.516680598677145e-01   +2.428371282145547e-01; +2.751911217379866e-01   +5.669787234882594e-01   +6.993766034933269e-01   +7.771575358215347e-01   +5.895521106312721e-02   +4.792638456190660e-01   +7.669835744677883e-01   +4.796036934348519e-01   +6.711593136992764e-01   +3.267056889105471e-01   -4.743930020486713e-02   +3.785866419345865e-01   +5.747537264614607e-01   +5.743085417242921e-01   -1.202951901987373e-01   +1.948135337313849e-01; +2.646903585876258e-01   +5.592707552926104e-01   +1.578296096839976e-01   +4.300999386548404e-01   +1.842021548489940e-01   +1.362736517322346e-01   +4.032466507769109e-01   +4.845782088830464e-01   +6.729571755616547e-01   +1.362731100648433e-01   +5.444774857880940e-01   +4.318815749915539e-01   +4.640437048952770e-02   +4.891357771375214e-01   +3.509038346524192e-01   +1.936211246899935e-01; +7.567841523282828e-01   +6.821554262140572e-01   +4.667281247609185e-01   +2.618776369705647e-01   +1.812714556857646e-01   +6.791813301687007e-01   +7.106491171713434e-01   +2.163207706691398e-01   +1.985979473217113e-01   +6.060186674121791e-01   +2.716141010620578e-01   +7.269641150196198e-01   +5.657909759613066e-01   +4.159916472127978e-01   +7.637501688619285e-01   -3.098256902057888e-02; +5.819306799183143e-01   +5.955730356742096e-01   +5.082478676023984e-01   +3.211402452683904e-01   +4.085586513860842e-01   +2.836599279937889e-01   +5.315297537233423e-01   +1.165656197898551e-01   +1.488735259241364e-01   +1.586328298403212e-01   +2.671243792882546e-01   +4.278078201251639e-01   +6.574120445371339e-01   +3.371686093945891e-01   +4.982679325078400e-01   +1.251610571454975e-02; +4.198252320469231e-01   +4.422194891888782e-01   +7.568408698337130e-02   +8.516372557539749e-02   +3.343868142827317e-01   +2.638505607670530e-01   +4.405298319718367e-01   +4.206285322198433e-01   +1.494432956314760e-01   +2.929539877399918e-01   +3.016497968156412e-01   +1.579449973833502e-01   -6.566168019811082e-02   +6.412173768904794e-01   +7.905579081401019e-02   +3.204147665911262e-02; +5.784716812817687e-01   +2.300538659100168e-01   +7.293864440570256e-01   +1.151166925041846e-01   +6.252476044806934e-01   +4.322482013446684e-01   +1.177442972699614e-01   +4.744958193162013e-02   +4.607160818188549e-01   +2.402397702535476e-01   +3.604620610201256e-01   +5.235727848805511e-01   +4.812803147478015e-01   +5.184079549941295e-01   +3.730301288273096e-01   +4.830087891215847e-01; +1.687302651346956e-01   +5.687926284053728e-01   +3.072725226800488e-01   +3.108896399626571e-01   +3.786558205213088e-01   +7.950124246878590e-01   +4.853197766620328e-01   +4.556013461864349e-01   +2.939528221155294e-01   +2.090345326988695e-02   +3.209733876217210e-01   +5.098696187588851e-01   +2.305524761307324e-01   +1.268299450399818e-03   +3.546136617961106e-01   +2.285251685209030e-01; +1.065084386424354e-01   +7.759672797577738e-02   +4.206375561739063e-01   +5.539305298780920e-01   +4.640872141271179e-01   +5.790583338287962e-01   +7.956565613073465e-01   +2.719488917212560e-01   +9.255676447041026e-01   +2.902856746795574e-01   +3.962616463138151e-01   +4.302812166612370e-01   +4.834115551938951e-02   +1.158643471341143e-01   +6.344441156030547e-01   +2.561529124593594e-01; +2.711742267894506e-01   -6.209259993785846e-02   +1.975545354597722e-01   +3.888093479875525e-01   +1.462071733372804e-01   +6.474084674652021e-01   +2.742807007845647e-01   +7.114934196999768e-01   +6.616200829032223e-01   +6.484360655225734e-01   +3.712381600235099e-01   +5.742022592711218e-01   +4.089426472926132e-01   +2.060152946363993e-01   +6.102501644710099e-01   +7.407057007560272e-01; -5.452464562234603e-02   +1.203104270616209e-01   +5.690916160241736e-01   +2.057607964116040e-01   +1.135561824325720e-02   +5.053665257575933e-01   +4.637148169391109e-01   +5.511541694682557e-01   +8.183386243919548e-01   +7.555194066458452e-01   +2.340642366248400e-01   +5.946984597410997e-01   +5.724138952917497e-01   +4.922514790434873e-01   +1.000000000000000e+00   +3.147995941739981e-01; +4.950827931240227e-02   +7.897616467376180e-01   +5.646298248523631e-01   +2.395930880402393e-01   +1.406293565043567e-01   +6.698414105332563e-01   +3.920361022481982e-01   +6.418631874319117e-01   +2.025598020847947e-01   +6.082838019191746e-01   +6.662352986424342e-01   +4.461867152024330e-01   +6.813062090697055e-01   +4.285551614973691e-01   +2.445633812540762e-02   +5.442701600338422e-01; -9.932459501192370e-03   +3.540292999883289e-01   +6.249028810236347e-01   -1.851155133086619e-02   +4.070460588710595e-02   +1.955512802085136e-01   +7.107810735675782e-01   +6.516712713403369e-01   +4.735391045299872e-02   +8.087803012039927e-01   +2.064175101529236e-01   +1.598098178860879e-01   +2.583572435374639e-01   +3.558041509013167e-02   +4.581465190955531e-01   +3.592352038794631e-01; +3.881009414173097e-01   +5.015631358862950e-01   +6.285432492417345e-01   +6.631940820879060e-01   +5.193465641175681e-01   +3.173605280459371e-01   +1.667443267935204e-01   +3.327456050764788e-01   +3.914594063117264e-01   +6.179519412689118e-01   +3.973740018502937e-02   +3.848926274127442e-01   +3.876384291728469e-01   +6.896800625026761e-01   +6.578000180432343e-01   +7.302553835123088e-01];
L1E_L1I_iGABA_netcon = [+4.130445341541564e-01   +1.893459589898036e-01   +2.423409444451349e-01   +4.025553257444052e-01   +3.456417634339874e-01   +3.765724659908184e-01   +5.812316809406819e-02   +4.489515218209309e-01   +5.451549270728216e-01   +2.779753393178055e-01   +6.299370922151116e-01   +4.670924546327186e-01   +5.740552428455215e-02   +5.850928781762026e-01   +6.337149658904088e-01   +3.256562080625012e-01; +3.340519329502271e-01   +9.653027637313026e-02   +7.114344844266582e-01   +5.874618708640097e-01   +2.951588806448127e-01   +5.783280277185740e-02   +5.355665909037803e-01   +3.204802726833767e-01   +7.837029447609074e-02   +2.668609537077341e-01   +1.914510788701196e-01   +3.898275902348594e-01   -3.604929558591016e-02   -1.011107775257933e-01   +6.408009957524892e-01   +2.698467146432390e-01; +4.726598446804030e-01   +9.939835923849993e-02   +3.969974971507607e-01   +5.987454442240647e-01   +3.749940919571206e-01   +3.906195688718466e-01   +3.882415519146010e-01   +5.165458094154096e-01   +2.892111382577538e-01   +3.239709748972627e-01   +3.196883456485160e-01   +3.623764237908862e-01   +8.905732121135973e-01   +5.957908450886251e-01   -1.689980027423842e-01   +6.007598048076148e-01; -8.916373984993231e-03   +6.831732848996206e-01   +6.672091649020008e-01   +2.312945288752711e-01   +6.080765410517219e-01   +7.010148535767651e-01   -1.150946849143454e-02   +4.510373280860666e-01   +1.812055427701415e-01   +9.541961088681697e-02   +8.478205725558169e-02   +2.557291704888522e-01   +1.869557718364309e-02   +4.160158617574392e-01   +1.818649761977862e-01   +5.031695023573204e-01; +2.093737658064357e-01   +1.377630916301547e-02   +8.175733888886753e-02   +4.148751080905252e-01   +5.199170713281256e-02   +5.200040395694832e-01   -8.635364732138615e-02   -7.146904874076210e-02   +1.592771833826256e-01   +2.023802465351886e-01   +1.884098212622571e-01   +7.945689190786093e-01   +3.202742473263618e-01   -1.164394629153018e-01   +5.651761180022311e-01   +9.749976344462291e-01; +6.301654458427406e-01   +1.578347121197852e-01   +1.395085943197711e-01   +3.351971126911845e-01   +2.212728688293205e-02   +4.147740008425539e-01   +1.313586185073867e-01   +7.678305758024295e-01   +3.800905995682611e-01   +7.901922712168138e-01   +7.147934594451311e-01   +7.381892025849670e-01   +5.991540841904448e-01   +3.505885719847643e-01   +8.442087118643944e-02   +3.552548890887420e-01; +4.515440070463365e-01   +1.904693859694584e-01   -2.826031837148904e-03   -6.889437788492311e-03   +7.254136236469171e-01   +6.065568664620650e-01   +6.842541753893708e-01   +1.409459096384362e-01   +3.805817187287925e-01   +8.332645517032329e-01   +2.103101869082577e-02   +6.199569698287694e-01   +3.403920193775126e-01   +4.614797640027519e-01   +1.936741223180576e-01   +1.416843120517467e-01; +4.861073033378956e-01   +1.240012451781481e-01   +7.316534461753489e-01   +9.807520647215920e-01   +1.520499308119017e-01   +4.567996107427988e-01   +1.876075322132404e-01   +7.479513173728259e-01   +1.375244559831247e-01   +1.750270575146895e-01   +8.657389453536030e-02   +7.462143956415596e-01   +5.170706874321562e-01   +1.024959405769881e-02   -1.665515581971592e-01   +5.724152163529206e-01; +7.451482870274147e-02   +7.157217620505565e-01   +3.876114979420494e-01   +5.487553165450881e-03   +7.046892358997815e-01   +3.835394384443091e-01   +3.810179690425323e-01   +2.138764767892030e-01   +1.855038012808068e-01   +7.452308955145523e-01   -9.608379638852349e-02   +6.770895106040887e-01   +1.380236814579191e-01   +2.957530251410970e-01   -2.031074820860966e-02   +3.090084331242711e-01; +3.598621950829751e-01   +3.053981706757912e-01   +2.534616798796535e-02   -5.368940665352966e-02   +6.972939251933659e-01   -1.939672710206192e-01   +3.888739524757824e-01   +9.160858132020492e-01   +1.766023136880041e-02   +6.201340333408267e-01   +1.106196914365078e-01   +6.081578740437826e-01   +2.382197226653383e-01   +3.175095823906757e-01   +4.138472037905001e-01   +7.064870226806492e-01; +9.258813506071092e-01   +5.273164289478398e-01   +5.351144360181235e-01   +7.258757283861976e-01   +4.781262749482101e-01   +4.022651648287018e-01   +1.399072905302667e-02   +5.648966198923602e-02   +6.198747059706812e-01   +1.142667759035106e-02   +4.678243857689052e-01   +5.175274001711594e-01   -8.601687371723635e-03   +9.503352992253498e-01   -9.302776448472976e-03   +3.405256182334611e-01; +5.543904823320641e-02   +5.043674443950841e-01   +2.560145300563672e-01   +8.768931644120015e-01   -1.065105250893974e-01   +2.809028559840745e-01   +2.708088519525477e-01   +3.127499972488729e-01   +9.194659264913518e-01   +4.316650189500977e-01   +6.151994421571142e-01   +8.025783150633948e-01   +1.896064951297808e-01   +6.254643440158330e-01   +4.868720041034679e-01   +3.316100989046653e-01; +9.153438066427576e-02   +6.679665236097622e-01   +1.803221505779194e-02   +6.158859061349727e-01   +1.107444036291936e-01   +5.521358912909402e-01   +4.465630653214357e-01   +4.557977887051717e-01   +3.753991664590664e-01   +6.970578068698494e-01   +2.476694205829772e-01   +1.990674786024347e-02   +3.541729289871537e-01   +2.834464538777197e-01   +2.444524770453528e-01   +6.865629891063278e-01; +8.157836822648584e-01   +1.959783496170228e-02   +4.465701743440101e-01   +5.092138364838723e-01   +4.649634430034580e-01   -1.992736254373416e-02   +3.822912936711975e-01   +8.926933021509452e-02   +6.935335109107343e-01   -8.720030017236850e-02   +4.782734347845843e-01   +6.761178124289330e-01   +4.038624418659271e-01   +6.233998745635395e-01   -4.983199243959760e-02   +4.413890713208154e-01; +1.062306155878938e-01   +3.872526362594795e-01   +7.160658230148612e-02   +1.857517284442154e-01   +5.356896069678692e-01   +3.545598102295676e-01   +5.929511382899646e-01   +6.619461584640952e-01   +8.130548752461991e-01   +5.516210057430573e-01   +7.061478452712812e-01   +4.417193345744193e-01   +2.434516771892664e-01   -3.193056565806691e-02   +3.095183742163425e-01   +3.262216784577256e-01; +4.059587093614017e-01   +1.803680158055760e-01   +5.812417427816917e-01   -2.667768624140743e-02   +4.113976856313452e-01   +7.123988355582154e-01   +4.210741165638335e-01   +2.792232708080492e-01   +6.248075537490299e-01   +8.038637798244510e-01   +6.430699422321793e-01   +4.154149174593873e-01   +4.941668509114485e-01   +6.811751779328595e-02   +4.727062845926666e-02   +3.460294051481824e-02];
L2I_L1I_iGABA_netcon = [+6.351975575706230e-02   +5.332701580454934e-01   +6.465170070647809e-01   +6.867783004208997e-02   +6.002443879000384e-01   +2.106181676579117e-01   +3.960882517748389e-01   +6.204078256886727e-01; +1.716094524263544e-01   +2.348573096570296e-01   +2.493932213236617e-01   +1.237408447590961e-01   +7.668941977457816e-01   +1.226746068482630e-01   +5.269292349890391e-01   +8.392732403733368e-01; +2.248816701350935e-01   +3.516958175619033e-01   +4.917430869227356e-01   +7.248324282091322e-01   +4.492591328090639e-01   +5.227714450420755e-01   +2.371198967378101e-01   +7.204721095488448e-02; +3.649208021258203e-01   +4.148497943747702e-01   +4.886835378965133e-01   +7.815059094523512e-01   +1.905413962092834e-01   -8.257669097978920e-02   +4.723303208438430e-01   +9.786740469576535e-02; +9.536709278516884e-01   +3.297335854950066e-01   +2.208202765550991e-01   -1.381901575014537e-01   +6.568643232425952e-01   +6.050339771825877e-02   +1.000000000000000e+00   +9.197761501171345e-02; +4.972072862939046e-01   +5.356459130916216e-01   +7.580123960734370e-01   +7.251302895518821e-01   +6.412714075917725e-01   +6.779871305204708e-01   +4.820933180747141e-01   +5.827260972538543e-01; +7.862691834282642e-01   +2.814450390163645e-01   +4.029391563108867e-01   +1.890644332464489e-01   +7.932256033455642e-01   +4.449725385862452e-01   -4.591141630674597e-02   +3.971151927374971e-01; +5.800929844360700e-01   +3.279745322234122e-01   +2.423783362840635e-03   +6.875868151763547e-01   +6.167014987510757e-01   +8.125980289640562e-01   +4.626682726089899e-01   +2.383891063943653e-01; -1.792494099765770e-01   +4.196026950742645e-01   +2.050186180358272e-01   +4.159482862860435e-01   +4.158522976939272e-01   +6.498781382617155e-01   +5.140015050191384e-01   +3.405921139404064e-01; +6.839918116710401e-01   +9.353533342812882e-01   +4.682997644407473e-01   +5.489651669456426e-01   +2.772038007937017e-01   +1.476928547500068e-01   +4.639924845998576e-01   +2.392569119487965e-01; +2.795856333267264e-01   +9.109074984485831e-02   +7.219221536456369e-01   +6.168470717520579e-01   -1.736567307184997e-01   +2.369924524015262e-01   +5.123290577047176e-01   +1.850938797054522e-01; +2.379457614216792e-01   +1.092570116773723e-01   +2.489668653546735e-01   +5.633967998665914e-01   +8.680614107783390e-02   +4.604518563882129e-01   +8.474390926352565e-02   +2.975963941733683e-02; +7.423277404664707e-01   +8.329824887312745e-01   +2.416220816806913e-01   +4.308329817167873e-01   +3.783219137284355e-01   +1.731049677690595e-01   +6.504107348606726e-02   +7.281679635650743e-01; +3.732169573933246e-01   +8.335014283448571e-01   +1.318995046486711e-01   +4.205143128014532e-02   +5.755529930220963e-01   +5.575154507985061e-01   +5.364243674808657e-01   +5.112594939702422e-01; +2.513049246089853e-01   +3.768896371623228e-01   +3.920380363682203e-01   +2.109545289550225e-01   +4.865655385688937e-01   +1.246001289963001e-01   -5.044276016937085e-02   +5.428555643661443e-01; -1.680819108839728e-01   +1.945886108353351e-01   +1.475896080324001e-01   +1.314902816064810e-01   +3.543863781913533e-01   +7.140674676713463e-01   +2.418841780609129e-01   +3.897346408140728e-01];
L1I_L2I_iGABA_netcon = [+9.819766244434031e-02   +6.551726039234725e-01   +3.198620870362726e-01   +1.685963833858605e-01   +7.375400344815181e-01   +8.273012992587001e-01   -1.068961312520362e-01   +8.584399539670359e-02   +1.199610570580009e-01   +5.843595208484685e-01   +4.572937348440694e-01   +3.840281382238986e-01   -1.483155836149820e-01   +4.146183696485965e-01   +1.828729019246719e-01   +6.051727959749239e-01; +6.303212810442387e-01   +5.060851545316025e-01   +3.766092717783724e-01   +1.109003807031600e-01   -7.254413595507674e-02   +2.759491339638441e-01   +4.388451381457958e-01   -1.702678892965265e-02   +2.117580529186982e-01   +1.144889881897810e-01   +2.841566215347840e-01   +2.796523485290428e-01   +6.861602741166285e-01   +4.870424231534767e-01   +1.000000000000000e+00   +7.565293514865848e-02; +3.241873642254919e-01   +3.284850985534898e-01   +8.099374849140467e-01   +2.356483607973810e-01   +1.509067595742845e-01   +7.833409150564269e-03   +6.252104821890161e-01   +4.355976713956337e-01   -4.886543848421300e-02   +8.130870493022787e-01   +2.184079235728644e-01   +3.247769629702653e-01   +5.683853468428924e-01   +4.714600521474700e-01   +1.351299774647454e-01   +1.675505290251600e-01; +6.105726369559243e-01   +4.719004321939455e-01   +3.823338902556903e-01   +3.720986280082679e-01   +6.408064030593797e-01   +3.893287021151350e-01   +3.850246915045525e-01   +9.955415626931226e-02   +4.007486398831201e-01   +2.275832674804354e-01   +2.509262872739206e-01   +2.740997736335148e-01   +3.013855849130524e-01   -1.317381990693763e-01   -6.048434844570456e-02   +4.073668604289741e-01; +6.269181538830991e-01   +5.931329301939271e-01   -1.424257190565049e-01   +6.726027075313814e-01   +4.608156556045466e-01   +2.723219839088879e-01   +3.716896663568782e-01   +7.754010150777076e-02   +8.123460439586672e-01   +5.233707778978012e-01   +7.585473233779402e-01   +7.436238206201831e-01   +5.825407745370705e-01   -4.771409609264670e-02   +4.918816749516569e-01   +6.843417971669855e-01; +3.800048131109943e-01   +2.194496062697290e-01   +7.026696263434488e-01   +1.392830831660291e-01   +9.830964719228302e-02   +4.018107547708566e-01   +5.117931093808438e-01   +6.051935057192152e-01   +5.341941531047470e-01   +4.964464360822361e-01   +7.238562712348464e-01   +5.629587851799959e-01   +5.279194715746961e-01   +1.617577817203941e-01   +3.531117052918325e-01   +6.777258781053768e-01; +3.038492549443300e-01   +1.255250360698117e-01   +2.942345351042575e-01   +5.724802426814067e-01   +4.851584659526741e-01   +4.710093498600057e-01   +1.625189607457841e-01   +1.798539871602304e-01   +1.376900376866952e-01   +1.888664556701372e-01   +2.563556311565209e-01   -8.811245160088417e-03   +3.720615129608320e-01   +3.490193168652532e-01   +6.559349946097606e-01   -2.300510817241466e-02; +4.389418038127383e-01   +7.088427140096467e-01   +4.319331710740777e-01   +2.043788743296195e-01   +5.319935578705353e-01   +2.251279446393282e-01   +1.319082584298255e-01   +4.442559410684632e-01   +4.771613626142491e-01   +2.497121613360148e-01   +1.950652855259819e-01   +7.611699133358745e-01   +5.068311148764862e-01   +6.253537454713317e-01   +2.958866683073417e-01   +4.737771195980708e-01];
L2E_L1E_iAMPA_netcon = [+2.855465762433489e-01   +4.865221402528227e-01   +5.271092754487776e-01   +3.468246379071426e-01   +3.870463479241471e-01   +6.982388597303679e-01   +5.538346030198228e-01   -1.217770806509192e-01; +3.328499575006397e-01   +2.993514391214662e-01   +3.210876390217462e-01   -4.494536707333315e-02   +3.219891574244108e-01   +2.927827022300382e-01   +5.787699470986911e-01   +1.764914164166446e-01; +1.019352666260306e-01   +7.351689106519404e-03   +7.631758466870195e-01   +4.999458562500561e-01   +3.470934275191826e-01   +5.148529212924393e-01   -7.125971329517806e-02   +5.795554063261535e-01; -4.798819987703089e-03   +3.251658059669954e-01   +9.200508608371100e-01   +2.008730291468104e-01   +3.136129954312086e-01   +5.489688781472835e-01   +1.473450632618800e-01   +1.335860353333541e-01; +6.698054355225821e-01   +2.361282249951218e-01   +4.783730606981591e-01   +6.552968118914700e-01   +1.268758711751069e-01   +6.047940658145432e-01   +6.608618795666219e-01   +7.330719933478457e-01; +8.703996457150102e-01   +1.613012775326862e-01   +5.249674139621013e-01   +5.840262837801600e-01   +3.909510124877968e-01   +8.737923778704174e-01   +6.121392956485566e-01   +8.099729742747226e-01; +6.202115529285761e-01   +6.692118883403728e-01   +8.349077270302849e-01   +2.006149974674481e-01   -1.155542475756814e-02   -2.263609372282580e-01   +5.448829048461310e-01   +7.456254866210383e-01; +5.330853387753302e-01   +8.507880585274431e-01   +6.326515400648836e-01   +4.862985636167822e-01   +3.833377044499433e-01   +7.422159545245693e-01   +7.361635895332760e-01   +5.235692570693420e-01; +9.174042055461316e-02   +3.330805819833781e-01   +5.536772631481863e-01   +4.409812847943636e-01   -5.460629086310199e-02   +3.986905581038301e-01   +5.602129815232437e-01   +7.652117971591241e-01; +1.435485364530014e-01   +4.560491540704028e-02   +3.720464279826256e-01   +3.378609858770040e-01   +5.769360921186494e-01   +4.260328219367339e-01   +3.581043638748998e-01   +5.492855721314271e-01; +4.271308869967386e-01   +8.631928497405887e-01   +3.325087894176101e-01   +5.383459683570056e-02   +4.756938501325321e-01   +6.741106424133632e-01   -2.403876026698038e-02   -4.710802210875256e-02; +2.233738964837827e-02   +4.453012643494343e-01   +7.905911580303381e-01   +1.086259916832714e-01   +1.929442605310611e-01   -1.226060680879292e-01   +4.297543842304450e-01   +3.880644593007357e-01; +1.516867987657037e-01   +4.421180982830570e-01   +9.937927165006959e-01   -1.721108493558303e-01   +4.862385551229041e-01   +1.610699611480074e-01   -1.715201835110617e-01   +6.618628373517825e-01; +9.081526669877860e-02   -8.689236189444086e-02   +2.808239130461723e-01   +5.093419060522046e-01   +5.392731545704481e-01   +8.584842834245757e-01   +1.023403769471456e-01   +9.240426063403316e-02; +5.041648659434020e-01   +6.333840626111895e-01   +3.030884224663968e-01   +5.057452250250221e-01   +4.463211483044762e-01   +2.806179303562644e-01   +3.875215420924427e-01   +5.372894392354851e-01; +4.214036302650769e-01   +4.740456381583864e-01   +1.722746087621586e-01   +4.084122705276608e-01   +3.519951411591819e-02   +5.004960726148326e-01   +2.088881255157805e-01   +4.677219882650722e-01];
L1E_L2E_iAMPA_netcon = [+4.910606208111511e-01   +3.598702866383007e-01   +8.611545544853616e-02   +6.497468173430822e-01   +7.596600554872449e-01   +7.876513009190069e-03   +3.799104859738649e-01   +6.333666970834605e-01   +1.284535274064901e-01   +3.103933487132172e-01   +4.973762081223699e-01   +9.563849995919770e-01   -2.567232735483196e-02   +1.187443486129711e-01   +8.209549578730458e-01   +2.627357963468238e-01; +8.535196024034782e-02   -8.896087758986385e-03   +6.425772584348729e-01   +3.759066194015963e-01   +3.024886757676851e-01   +3.994959463793268e-02   +2.890021310432066e-01   +1.080353902923692e-01   +4.603231456797999e-01   +8.986648264504343e-01   +5.708755493407477e-01   +2.000795809784289e-01   +8.864562262304194e-01   +8.631018077200556e-01   +3.301115372122739e-01   +5.099415948169580e-01; +2.661745046165984e-01   +7.489391242463712e-01   +3.680655924971722e-01   +1.031259105209344e-01   +5.647866497870166e-01   -4.808397947575854e-02   +7.701753083930898e-01   +6.901909101126859e-01   +5.972155315637786e-01   +3.639541930809613e-01   +6.404644631882309e-01   +2.399925173382194e-01   +5.645475363905004e-01   +4.315499181611721e-01   +8.039416425135944e-02   +4.262001551419700e-01; +8.384634206767463e-01   +2.066555028449681e-01   +3.108552609104857e-01   +1.331976005309781e-01   +2.122790823158267e-01   +3.879902067086429e-01   -7.584941053376672e-02   +3.458490857280791e-02   +8.282176637575609e-01   +4.535226441257657e-01   +3.719142711013456e-01   +1.483220690837870e-01   +4.438492178467999e-01   +7.510750242206846e-01   +6.066739179144707e-01   +4.613005062339074e-01; +4.428722034045178e-01   +2.012696002960918e-01   +2.453326810163785e-01   +3.624548302603511e-01   +3.634398394383213e-01   +5.932730437743312e-01   +2.097288977471203e-01   +3.270856468236760e-01   +4.091686866475969e-01   +4.358311696326367e-01   +1.955336713184627e-01   -9.580183896415753e-02   +6.246606658196630e-02   +5.995207115006655e-01   -2.412935175894231e-01   +7.755507127387206e-01; +9.942483508021672e-01   +1.675858731212942e-01   +3.046009864805377e-01   +6.520243202518693e-01   -1.886727077866763e-02   +1.186225868606036e-01   +5.254298301176041e-01   +1.587388148295686e-01   +4.808727902649619e-01   +1.819176711762365e-01   +3.307963558214430e-01   +7.670132670812380e-01   -2.181551037049896e-01   +7.613102458081270e-02   +3.108374003197291e-01   +5.754003312307032e-01; +2.617001019747354e-01   +8.536809463871903e-02   +3.510514227837185e-01   +3.079301156031120e-01   +8.508289821959101e-01   +4.439612324790611e-01   +4.731173955424307e-03   +7.035353663722043e-01   +3.848356948437544e-01   +8.959779775216599e-01   +5.646743453626901e-01   +2.202319871819649e-01   +1.601544853091265e-01   +2.017888249026917e-01   +5.570782502786050e-01   +1.958650569909150e-01; +3.891876098227158e-01   +2.965477533031755e-01   +8.247347873611890e-01   +2.507984068722612e-02   +7.890943963234882e-01   +2.419974577061520e-01   +2.236161881030712e-01   +9.399367632776032e-02   +1.368719179979600e-01   +8.100014927310455e-01   +3.529158774511296e-01   +4.057361647607324e-02   +8.516897449814864e-01   +6.451955153659387e-01   +3.236410149250180e-01   +2.825704455573997e-01];
L2I_L2E_iAMPA_netcon = [+4.894920067662705e-01   +8.664434898378693e-01   +2.567643579653282e-01   +5.983499051544179e-01   +8.411778862925994e-01   +8.413735043458340e-01   +6.792006907506976e-01   +2.557566986584087e-01; +1.000000000000000e+00   +5.909366688840521e-02   +3.377162765656218e-01   +1.200564343919297e-01   +6.964484937180123e-01   +2.632774044749273e-01   +2.224535502121271e-01   +7.312229574106385e-01; +9.954812732926032e-01   +2.562981353367272e-01   +7.497702540027330e-01   +5.279412778333709e-01   +2.443283727854254e-01   +5.552549317004783e-01   +1.365014681446995e-01   +8.197184507917635e-01; +4.690425793700804e-01   +6.933065138128405e-01   +2.950025111060896e-01   +1.069364811317894e-01   +4.357774529064863e-01   +9.312563163761972e-02   +1.116729122614573e-01   +3.774446954371040e-01; +5.267861414702132e-01   +3.982927645604656e-01   +6.550058350822507e-01   -1.835287323958500e-01   +6.842327345751440e-01   +9.652111798991066e-04   +1.184875089881815e-01   +4.526455434599140e-01; +1.524543967934482e-01   +1.964487048386142e-01   +5.896301939299486e-01   +9.427075157657340e-03   +3.796363731362631e-01   +5.901741985000212e-01   -1.717562518563875e-02   +2.597566531327936e-01; +4.046664973732064e-01   +1.439138556256790e-01   +4.824123895789645e-01   +6.127676562928478e-01   +3.385281368394177e-02   -7.983363816736019e-02   +3.170045660736011e-01   +5.551123369756320e-01; +4.489452623361559e-01   +4.586734803273142e-01   +4.942263557979558e-02   +7.934701476572137e-01   +6.396652748574781e-02   +8.425663396646620e-01   +2.991056409336020e-01   +6.404375487374722e-01];
L2E_L2I_iGABA_netcon = [+1.609863456412775e-01   +3.502630699479402e-01   -1.956400099200904e-01   +9.096475429714886e-01   +3.373648204631990e-01   +9.357147170709064e-01   +6.238620288285870e-01   +1.626461583740712e-01; +5.813614510578974e-01   +5.831985116353875e-01   +2.822355499288995e-01   +4.810786793353350e-01   +6.367708179515686e-01   +3.906464246656516e-01   +1.007586972536758e-01   +7.538477581066707e-01; +3.027646877415164e-01   +8.122103541601598e-02   +4.620838943898072e-01   +4.562201484467420e-01   +2.628653734125346e-01   +3.117517279297994e-01   +1.265708168661094e-01   +5.986541357871686e-01; -6.998135338217490e-03   +5.494917220490808e-01   -1.563893133541511e-02   +7.236982568709597e-01   +2.974468154777892e-01   +4.117217074788803e-01   +8.404751860454420e-01   +7.775736931207639e-01; +3.852492222386939e-01   +4.978795825147276e-01   +1.581250615682536e-01   +2.342581266689570e-01   +3.654939547583810e-02   +5.023168005084837e-01   +4.774372823644345e-02   -4.818460715012640e-02; +6.831318338409811e-01   +8.462000079668758e-01   +8.401860723810294e-01   +1.000000000000000e+00   +7.703828235277339e-01   +5.163266980162107e-01   +3.004832424443056e-01   +4.507306290447710e-01; +1.039221429893812e-01   +3.998112368365568e-01   +1.018026190691394e-01   -3.596490802298259e-02   +3.119853680359944e-01   -1.002960030042909e-01   +1.812919756638868e-01   +6.380355919239846e-01; -1.458462171663480e-02   +6.085966456771881e-01   +4.063832575987354e-01   +5.183651809325547e-02   +4.453493823412527e-01   +3.304823845391202e-01   +5.280207576967751e-01   +7.253869936019811e-01];
L3E_L2E_iAMPA_netcon = [+4.592010917381824e-01   +4.441366137573858e-01   +6.203246333244015e-01   -1.471043195390909e-02   -2.714799293303476e-02   +8.680473619967256e-01   +8.469990465119424e-01   +6.555225929192093e-01   +5.934110043808811e-01   +9.503792454402400e-03   +3.993031914990482e-01   +1.235245453773848e-01; +1.614912851442822e-02   +7.337101231915513e-01   -8.007114710638676e-03   +1.478791813035048e-01   +4.195694825034026e-01   -2.640465321654137e-01   +5.624579347545587e-01   +1.532112190887476e-01   +4.160950046315214e-01   +3.759474378470835e-01   -7.646602575780720e-02   +2.069326301896049e-01; +2.671168770854593e-01   +2.069565000228524e-01   +2.054183414310862e-01   +5.287380443584901e-01   +3.865654588701471e-01   +6.731283166974836e-01   +6.373273459472011e-01   +6.843622875758576e-01   -1.472497679968096e-01   +6.792134785005408e-01   +4.418602809815729e-01   +7.581733776963984e-01; +6.961399115519470e-01   +5.880024514517277e-01   +7.123212107747935e-01   +5.404365835540963e-01   +4.088879065724599e-01   +9.741844327162663e-01   +3.153716449058713e-01   +2.197338664530583e-01   +4.908760498737340e-01   -3.743374600451155e-01   +3.407706817912127e-01   +8.184471886724064e-01; +6.323829088643843e-01   +4.512325802116233e-01   +4.801520328671681e-01   +3.907720158148622e-01   +8.978277172788558e-02   +4.367450302393044e-01   +3.573297799789302e-01   +7.069035478165184e-01   +8.909934108822685e-01   +3.880580506344055e-01   +7.176844497096008e-01   +2.238500763797034e-01; +2.018075918204120e-01   +2.659708078876080e-01   +4.144947797343765e-01   -1.549275603876767e-01   +1.275807585300103e-01   +5.129563169491790e-01   +4.809677123245493e-01   +6.138302271049674e-01   +5.366541815238890e-01   +4.636309450343678e-01   +3.808769740758207e-01   -1.580352941538473e-01; -4.175859877642511e-02   +1.252642829395271e-01   +2.067141601664688e-01   +3.106828975718841e-01   +9.962781505134822e-01   +7.075708016344791e-01   +5.588845257417920e-01   +4.904428213815212e-01   +6.444308329255666e-01   +3.237569880334615e-01   +2.518257612948360e-01   +5.804612839743496e-01; +2.621336285624190e-01   -4.577110415935053e-03   +5.792248548176760e-01   +7.823802743566255e-01   +3.363633220023086e-01   +6.402974151698230e-01   +7.281948173808895e-01   +2.092088187774300e-01   +5.159346388787541e-01   +2.273973973342694e-01   +2.225683971026574e-02   +1.264094769210042e-01];
L3I_L2I_iGABA_netcon = [+6.569643997771318e-01   +2.712136138465659e-02   +4.025636976567326e-01   +6.054449122960487e-01   +2.230244022401758e-01   -3.340730739887519e-02   +2.714846053025128e-01   +3.117904828686315e-01   +2.314981662005320e-01   -7.850232075241842e-02   +1.211864220638936e-01   +8.949691960258722e-01; +7.223741728649410e-01   -1.486769658864064e-01   +2.750700979802264e-02   +4.613875059527683e-01   +7.455003430672237e-01   +3.599783811029170e-01   +4.016395075640293e-01   +5.559093675351114e-01   +2.144968834450305e-01   +4.296216907382002e-01   +6.451965564785735e-02   +3.785457767490160e-01; +6.297955622328758e-01   +1.148938389457776e-01   +6.939147212194937e-01   -9.866234457729739e-02   +5.838751780441003e-01   +2.806194403466163e-01   +5.006252931887628e-01   +1.492144501288840e-01   +2.583843706743545e-01   +5.293111240380259e-01   +1.998754180319630e-01   +1.000000000000000e+00; +3.336334959954372e-01   +3.024133974755215e-01   +7.217190289637588e-01   +9.341552662684639e-01   +4.082849479774193e-01   +2.911162020501299e-02   +6.160360407208205e-01   +2.171617376058179e-01   +7.785074665885106e-01   +7.632933975858681e-02   +7.868449371298630e-02   +5.888773873283227e-01; +2.943356726375866e-01   +2.383271567929682e-01   +4.458399618474281e-01   +1.435337175034349e-01   +4.653774562975211e-01   +5.575860293389290e-01   +3.980442958585609e-01   +2.440659328571377e-01   +9.527029228082219e-02   +1.645464563625277e-01   +8.560389623171075e-01   +8.737914351689761e-02; +6.750517591133507e-01   +6.277193346151512e-02   +5.592840525075745e-01   +8.019059449860003e-01   +5.576647075843641e-01   +9.424546923886196e-02   +2.794436434808110e-01   +6.952190884285910e-03   +3.455244396799285e-01   +6.470570209408230e-02   +1.977254402823357e-01   +2.628709093634498e-01; +4.700653936320195e-01   +6.534413427014156e-01   +8.279119606344929e-01   +1.983763612943316e-01   +2.478265365993311e-01   +5.710123207012431e-01   +4.956093588956630e-01   +5.605392702545489e-01   +1.285454711927833e-01   +7.535825230886256e-01   +2.739225166083698e-01   +7.321805405342847e-01; +4.045127477360046e-02   +1.758404848908704e-01   +5.197317749926121e-01   +4.555180249747176e-01   +3.562567813025965e-02   +1.159535146596325e-01   +1.034657254485293e-01   -2.036548027327815e-01   +5.144718411655447e-01   +3.586105621308945e-01   +4.204618227383438e-01   +1.485890401990109e-01];
L2E_L3E_iAMPA_netcon = [+1.759060902594194e-01   +9.545968592122207e-01   +4.382864165486773e-01   +7.553106448913768e-01   +3.219508576747975e-01   -5.493005624845344e-02   +2.304606506023053e-02   +3.743958898744774e-01; +3.510822775020456e-01   +5.634404123414219e-01   +4.790664963115215e-01   +3.082747803409411e-01   -1.123307924066874e-02   +1.174775546615575e-01   +4.985130748787296e-01   +4.840798749952253e-01; +1.196514343835928e-02   +1.225412694538066e-01   +1.000000000000000e+00   +9.371990361814777e-01   +5.496698049408755e-01   +2.671053672959229e-01   +4.074691008335712e-01   +5.758770056275695e-01; +2.830465506473072e-01   +3.115642944693348e-01   +1.538375934192692e-01   +6.352770086951448e-01   +3.655338656433857e-01   +7.170817424659780e-01   +4.933213365925352e-01   +2.341987218894909e-01; +3.611584623900529e-01   +7.134976170038518e-01   +6.033613053497836e-01   +9.566943812721175e-01   +6.576059356342621e-01   +3.816358065780657e-02   +1.788077038209163e-01   +9.312099374147502e-01; +9.143759308501519e-01   +5.972199184124037e-01   +1.845452572869185e-01   +1.315707347974180e-01   +4.159214308446822e-01   +6.053945508092338e-01   +4.607559306428861e-01   +7.114480429524933e-01; -3.436122642654149e-02   +4.153484507440829e-01   +1.418017392709587e-01   -1.547499889746995e-01   +6.329115845874768e-02   +4.323289503813913e-01   +2.158794128662079e-01   +8.927167720801170e-02; +6.369953400169105e-01   +5.391586056723900e-02   +8.752766686639316e-01   +1.759876635642936e-01   +9.445935308521727e-02   +2.430006646795313e-01   +3.467034149853007e-01   -2.028373350217405e-01; +3.755047986143402e-01   +6.332724593956083e-01   +5.493784179338416e-01   -5.043888744947902e-02   +5.133163545943611e-01   +8.613149352756594e-02   +4.416845747035159e-01   +6.914458957841948e-01; +3.898750722710055e-01   +5.045476501281057e-01   +2.986561128335005e-01   +3.975267634589896e-01   +5.256483166860259e-01   +5.156880802712359e-01   +7.653008447882901e-01   +3.567116987421606e-01; +5.787961761844647e-01   +3.902958599657815e-01   +7.180372666182829e-01   +2.055406779237793e-01   +1.417217365995014e-02   +1.918335874931937e-01   +7.164578529740294e-01   +4.133137110914244e-01; +6.582205887908592e-01   +5.385630948581809e-01   +5.759114990390301e-01   +7.171214902549771e-01   +2.992061794968423e-01   +5.757086330592086e-01   +3.849518460157925e-01   +4.151012461559773e-01];
L2I_L3I_iGABA_netcon = [+3.308994314481361e-01   +1.833094661125103e-01   +7.165389410940145e-01   +3.020288773449167e-01   +3.126893121523130e-01   +4.697498746024493e-01   -3.175135575109945e-02   +4.683154622339225e-01; +1.226803417280281e-01   -1.044231585343574e-01   +6.795089021294990e-01   +5.112586087800254e-01   +4.565770024573185e-01   +3.486841758816336e-01   +7.193345832636833e-01   +4.362433726249632e-01; +2.567135788469708e-01   +6.989582334781128e-01   +1.456490088343346e-01   +3.038343809041941e-01   -6.599152090085197e-02   +7.532008774464615e-01   +1.649932917149581e-01   +5.053663772023184e-01; +4.602792903389271e-01   +4.017973924488637e-01   -2.622778384759835e-02   +3.404834082422147e-01   +6.401744179932345e-01   +8.359741279708945e-02   +2.796807442327593e-01   +1.840282955548166e-01; +5.632870299787497e-01   +2.525884416573385e-01   +4.371789292658409e-01   +6.874715675436613e-01   +3.284021306072224e-01   +4.248169553637647e-01   -1.187688901680011e-01   +2.124917411974875e-01; -2.629149111137644e-01   +1.446104778004719e-01   +3.998572526274478e-01   +6.363586134885596e-01   +6.426247934547602e-01   +6.476224334316013e-01   +6.763717535317975e-01   -6.387447906348577e-04; +2.688245907651698e-01   +2.267957251485824e-01   +3.212426288608657e-01   +5.019218664900904e-01   +1.356415795349505e-01   +7.982893872653571e-01   +7.618661526162218e-01   +1.000000000000000e+00; +3.941753858407590e-01   +4.083231570219844e-01   +1.142747388192176e-01   +2.449024603698844e-01   -2.498963730071951e-01   +1.785926003269146e-01   +1.319440357390060e-01   +1.500105227751553e-01; +3.322090775495383e-01   +2.366762320141991e-01   -1.898557514238743e-02   -1.023628288309751e-01   +5.860339275056512e-01   +1.781562990206936e-01   +1.535860032005903e-01   +2.963268511158568e-01; +7.553231821253163e-02   -1.352351410615054e-01   +5.365589064043911e-01   +4.057009279984219e-01   +5.803769878592858e-01   +7.054832860228385e-01   +6.046757211084385e-01   +2.512089488941281e-01; +3.458560328897119e-01   +3.385408300263389e-01   +7.602607857495556e-01   +3.756765212607621e-02   +6.222149177614676e-01   +3.766386789700208e-01   +6.165461324511594e-01   +2.327414963755282e-01; +5.466732019932068e-01   +1.335508356266574e-01   +2.268584961045831e-01   +3.933491470660772e-02   +4.200368236188254e-01   +7.753056640243563e-01   +2.588559128936626e-01   +3.906917484217978e-02];
L3I_L3E_iAMPA_netcon = [+3.687282815784316e-01   +2.256013645844901e-02   +3.271544643886039e-01   +8.503604294659212e-01   +8.130095059669505e-01   +2.007065531973366e-01   +3.968238268861354e-01   +1.574131194405950e-01   -1.866609241989937e-01   +7.010705715939534e-02   +4.934961012870564e-01   -2.461914071416414e-01; +2.266734250674993e-01   +5.302652479885720e-01   +5.138798244831331e-01   +4.326019516589161e-01   +1.537353666543937e-01   +1.832379747274520e-01   +2.372007983772471e-01   +5.752484832852989e-02   +3.302869212143583e-01   +3.815824550323255e-01   +4.133847001246694e-01   +7.434707860443817e-01; +1.741063009507060e-02   +7.866827290677749e-01   +4.970743356851685e-01   +3.850104210297413e-01   +3.910610568963481e-01   +2.197469872851283e-01   +3.542194473023100e-01   +3.920396687223193e-01   +2.602276196384757e-01   -1.284646920839578e-01   +7.053731015790661e-01   +3.793150286166465e-01; +4.678280028849905e-01   +1.671286797541736e-02   +6.172236772683775e-01   +9.679378042439500e-02   +9.288876773060897e-01   +9.346866377663482e-02   +1.429360126366291e-01   +3.542804108588374e-01   +4.893634642309599e-01   +2.772223522485355e-01   +3.843630696966904e-01   +1.262811951434760e-01; -1.003023814050313e-02   +7.231516455484054e-01   +1.010113978551657e-01   +1.821124432555940e-01   +5.568117345338542e-01   +3.437983926089794e-01   +1.693732037374258e-01   +1.796897606770915e-01   +7.171783767118521e-01   +7.844909829314288e-02   +2.806669617055719e-01   -5.319070149525185e-02; +2.227737842693574e-01   +2.931927590710165e-01   +7.076292495312655e-01   +1.379813253825912e-01   +2.631899777704659e-01   +4.857150174476765e-01   +2.929883386008830e-01   +1.316298386861803e-01   +6.301742969219102e-01   -2.552414198282869e-01   +2.848943605183591e-01   +8.003672685534475e-01; -6.957477774633937e-02   +8.505549058788732e-01   -5.393925776719367e-02   +4.554472466075463e-01   +4.023305079327469e-01   +4.635828188072290e-01   +3.684400261272925e-01   +1.408954676219317e-01   +7.500531654268418e-01   +8.636040687603932e-01   +2.844468203317583e-01   +6.658026154982364e-01; +7.797764534540272e-02   +6.310999213878280e-01   +6.617867900803943e-01   +5.229149146790233e-01   +8.292563032166536e-01   -5.483400093884022e-03   +9.696151730369402e-01   +2.223605631554553e-01   +8.439521474756270e-01   +5.745126532673612e-01   +6.501427088156503e-01   +4.307931321151839e-01; +6.540037596175420e-01   -1.556839620604109e-01   -6.470009903975006e-03   +5.378750847501477e-01   +8.028965472952290e-01   -2.228636540081305e-02   +4.020959922046162e-02   +3.649238562040394e-01   +4.631884300083512e-01   +1.000000000000000e+00   +5.277890374104857e-01   +4.036590865230943e-01; +6.100240515653375e-01   +5.474092708120089e-01   +4.396949657385707e-01   +4.583117186843535e-01   +2.796225258456137e-01   +1.591404155027867e-01   +8.325928382985328e-01   +6.053478455053364e-01   +3.927430026960387e-01   +1.693702094033821e-01   +2.065212056265873e-01   +5.083148791385234e-01; +1.780081522203448e-01   +5.349744740639450e-01   +1.871942043343423e-01   +5.076038897181860e-01   +6.416542252018452e-01   +1.381133722614609e-01   +5.938266194560287e-01   +7.348769109478206e-01   +7.808493842277742e-02   +4.723155493227486e-01   +5.857363140458865e-02   +8.695860235537711e-01; +3.679935425174637e-01   -1.575146374705110e-01   +4.459315635087309e-01   +7.604039595075180e-01   +7.669796222717554e-01   +4.359932614966791e-01   +1.481492029309672e-01   +2.902648471628254e-01   +6.853251446419610e-01   +5.290681687880151e-01   +3.043889741890348e-01   +3.579449497991865e-01];
L3E_L3I_iGABA_netcon = [-8.945264576464138e-03   +4.942590926330332e-01   +3.500383431121267e-01   +5.220570197024856e-01   +6.877128019384667e-01   +4.732306511035363e-01   +6.431839432913676e-01   +7.171783300340752e-01   +7.881983705428933e-01   +2.317686056274308e-01   +1.352917418192881e-01   +4.164771841620010e-01; +6.199185730354428e-01   +6.358790735425149e-01   +6.195559419185532e-01   +6.573095849671283e-01   +3.196741604728695e-01   +1.122403558780567e-01   +6.562461136200105e-01   +6.234570331383176e-01   +6.600852535016631e-01   +6.255172050332508e-01   +2.292195727689421e-01   +4.626318231808544e-01; +3.281545210960650e-01   +9.091693313919386e-01   +1.410087932358916e-01   +7.041378048643151e-01   +1.873180438613111e-01   +4.071831521986118e-01   -9.701888268682329e-02   +3.234986848906194e-01   +1.190545028552685e-01   +1.098215247186595e-01   +1.050926509083675e-01   +1.690547328836834e-01; +2.340658880558423e-01   +6.925310925245040e-02   +7.746749173282123e-01   -4.824067637071831e-02   +1.643367954681177e-01   +5.429567303363193e-02   +7.307038400396080e-01   +3.561881692124312e-01   +4.837100647569041e-01   +3.179104814914042e-01   +1.410215988285921e-01   +1.574438529850191e-01; +7.126015990098753e-01   +6.658481861917179e-01   +7.080637726158173e-01   +2.751368539881464e-01   +4.133123210688540e-01   +5.857092773214830e-01   +5.729960244720016e-01   +9.097388019541176e-01   +1.155070965968994e-01   +7.737753166231999e-01   +4.693957416087551e-01   +3.406796481559955e-01; +7.531675897227147e-01   +6.364713839328076e-01   +3.158447676582991e-01   +5.123517446246305e-01   +3.833319751387279e-01   +7.797745085221285e-01   +3.355151648202849e-01   +8.134713580834296e-01   +3.123240735160488e-01   +4.869842712307676e-01   -5.877534624238992e-02   +1.284393184668108e-01; +6.703819665534424e-01   +6.226317536584660e-01   +2.259136056403201e-01   +1.000000000000000e+00   +3.333429652888900e-01   +3.262091901072202e-01   +4.269380081432588e-01   +2.515847597898576e-01   +1.807349635561551e-01   +2.366266920284408e-01   +8.901947240549521e-01   +4.786829420825628e-01; +6.747466968461400e-01   +2.438435592740413e-01   +4.387382456292755e-01   +4.689769026926136e-01   +7.541419252376693e-01   +2.739724028417560e-01   +2.184261081804410e-01   +4.462043843887549e-01   +3.898358935228339e-01   +7.688208862274214e-01   +3.086339054588267e-02   +3.186661421972864e-01; +3.380258363016407e-01   +3.278358068347959e-01   +5.229510562353479e-01   +4.919532849860641e-01   +6.936130148148997e-02   +4.868923257819641e-01   -6.357289374974343e-02   +5.476585886666545e-01   +2.441195977395090e-01   +1.226595006205466e-01   +8.697602314743222e-01   -1.500217275636765e-01; +2.142313571767994e-01   +5.854480714346009e-01   +3.026176747224181e-01   +2.563122723446352e-01   -2.389380018815514e-03   +4.560788853468990e-01   -1.685041657821491e-02   +6.257764206015762e-01   +1.432479184846219e-01   +2.909491501127778e-01   -1.943062192328300e-01   +1.555373056720337e-01; +7.256812187513927e-01   +1.916376172859912e-01   +8.337123798344566e-01   +1.990356523824553e-01   -5.963299730707551e-02   +2.488777725363046e-01   +5.884170549050086e-01   +1.450234505057852e-01   +1.381721416987321e-01   +1.534063184993265e-01   +3.890941016710595e-01   +4.137540087822578e-01; -1.780579132556015e-02   +2.624415583250598e-01   +6.862062293659110e-01   +3.185568026396787e-02   +2.196757785994560e-01   +4.044841157394316e-01   +7.263781410593884e-01   +6.033345161762010e-01   +1.867321213714680e-01   +1.283419561487690e-01   +8.487990375143224e-02   +3.653841377826952e-01];
L2E_Input1_iAMPA_netcon = [+9.797988404180571e-01   +6.134301893547665e-01   +7.029042776296881e-01   +8.947691819720217e-01   +9.235981419784174e-01   +8.869971016419639e-01   +8.798119167764458e-01   +7.669080631190225e-01];
L2I_Input2_iAMPA_netcon = [+8.454299807517984e-01   +8.118134429294144e-01   +8.770844487996882e-01   +6.683341310535351e-01   +8.116675693804802e-01   +6.494525142134824e-01   +7.487110606700821e-01   +9.271944679016942e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last =  11.21 * ones(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))*0.4 + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.5*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.5*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))*0.9 + 0.5*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))*0.4 + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.5*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.5*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))*0.9 + 0.5*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
