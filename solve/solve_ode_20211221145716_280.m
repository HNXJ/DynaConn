function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-8.070602417829152e-01   +1.165618950630951e-01   -4.635180667282236e-01   -3.375714213818746e-01   -5.890109990916389e-01   -1.828655001098220e-01   +3.152265171357033e-01   +5.767669322328144e-01   +8.453252160345366e-02   +8.478643182830750e-02   +1.754624454446037e-02   +2.071381745935222e-01   -1.306658733893102e-01   +3.811908639196947e-01   +2.717402452280228e-01   -3.888331302859376e-01; -2.432401122801252e-01   -2.959097753365089e-02   -7.563243429699777e-02   +3.630778618641045e-01   +5.896555938393042e-02   -7.661949312552431e-01   -6.843078392741977e-02   +1.381964215851003e-01   -2.734773459035619e-01   -1.458483047463999e-01   -3.860042905504558e-01   -2.705608044588251e-01   -2.127190570203927e-01   +7.940069647849484e-01   -5.489813695540232e-01   +2.025280981041813e-01; +7.626763268271020e-01   +1.125855282989713e-01   +4.841296877054101e-01   +4.460378234226060e-01   -3.705293546820183e-01   -2.218183179451240e-01   -2.060396912279321e-01   -1.456761486070684e-01   -2.083908047178691e-01   +2.060811946954509e-01   -3.800722782079878e-01   -9.304807177983125e-02   -3.981689107109306e-01   -3.372139595954539e-01   +4.439362399586013e-02   -7.276007813391299e-01; +3.139339049740300e-01   +9.631861661025838e-02   +2.194690741322709e-01   -1.594632802185619e-01   +1.477585146164547e-01   +1.976004175891968e-01   +1.817495100282975e-02   -4.989837726680962e-03   +2.052754512289829e-01   +6.467817522290645e-01   +8.465828754191310e-02   -3.053843772356896e-01   -3.272404687671298e-02   -3.331237209748891e-01   +7.917696968294878e-01   -4.343779817982246e-01; +4.762873128771892e-01   -3.085804630509117e-01   +1.316853780559403e-01   +3.268805377773309e-01   -5.575987196260893e-01   -1.369703123729961e-01   +4.994545529460225e-01   -1.131305791470812e-02   +6.362564121849869e-02   -1.203481798556297e-02   -4.800671999684604e-01   +4.266138455556006e-01   -4.089194671414260e-01   +2.479094333193131e-01   -1.266237586451494e-01   -2.482355982836801e-01; -3.004368791266694e-01   -9.448360987594137e-02   -5.302560551643420e-01   +2.497471581382094e-01   +2.810405588881529e-01   -1.796884981542658e-01   -6.564453376927376e-02   +2.219063683071216e-01   -6.226998029359845e-01   -2.154829939282458e-01   -3.191924097960743e-01   +2.866567452224163e-01   -5.890983009051119e-01   +6.319152026540132e-01   +1.149668478309428e-01   +2.677348468636453e-01; +2.076687461735119e-01   -4.156937734821755e-02   +3.776984327141993e-02   +7.758112353623275e-02   -1.954622433478777e-01   -2.847897427759027e-01   -5.552117403831772e-02   +1.810463226253092e-01   -6.741196348937698e-03   +2.695309566860944e-01   +2.162566398174814e-01   -1.641514151235817e-01   +2.513639350271747e-01   +5.355116752788545e-02   +3.359888853315286e-01   +5.103499364607258e-01; -1.431418348925740e-01   -2.587415718106023e-01   +6.323079621688888e-01   +3.050544054711507e-01   -5.256177831101114e-01   +1.607572608608738e-01   -7.981635746934421e-03   -9.162379675615188e-02   -4.540397961027333e-01   -1.680091421689497e-01   +3.341631640749688e-02   -3.766749373451798e-01   +3.256716691417578e-01   -3.393899702014331e-01   -2.033793932214271e-01   +2.473596921298269e-01; +1.388235483558228e-01   -4.280906883362326e-02   +1.795596319053562e-01   +1.456194307283860e-01   +1.855404459847036e-01   -3.499895517807146e-01   +2.660311682263109e-01   -7.017522895087588e-02   +3.466703098394210e-01   +3.574535820526189e-01   -4.636131225083186e-02   +1.073980870043038e-01   +3.639177301926316e-01   +4.260904781313107e-01   -3.114139467884799e-01   +5.492295663494535e-01; -3.289298256091765e-01   +8.208643419427980e-03   +4.045511744480142e-02   +3.493395097342481e-01   -2.401415919449446e-02   +7.329433329505296e-01   -3.238977978028691e-01   +3.811460715511614e-01   +3.404678025750755e-01   -2.430044513372405e-01   +1.366137342422231e-01   +3.926856252761131e-01   +2.058635431241164e-02   +1.143244473575491e-01   +2.159893281160504e-01   +2.434964454800455e-01; -4.552320997068897e-01   -3.035524689924049e-01   +2.846186520443023e-01   -6.671366332444300e-01   +2.175922460279311e-03   -3.072106220537511e-01   +5.311887424254761e-01   -5.812380661048895e-01   -1.606195343572614e-01   -3.675937135964532e-01   +6.989575856679735e-01   +1.468809795564237e-01   +1.301778299471124e-01   -3.919988884426972e-01   -3.916940133358562e-01   -5.464142750387977e-01; +3.468730586639809e-04   +1.459204938301898e-01   +6.715304083928858e-02   -1.149998772865548e-01   -4.164919624403350e-01   +9.454670044536828e-02   +3.071845049719277e-01   -5.376851142903334e-02   +9.056306306797320e-02   +6.439240817652923e-01   +1.198298532980460e-01   -6.859083268524523e-01   +2.733422371907192e-03   +1.455743482879745e-01   -2.477501031690126e-01   -2.897357660185912e-01; +4.901922246255989e-01   +3.221958032525200e-01   -2.469397322231283e-01   -4.833619833874288e-01   -4.471072255569615e-01   -4.023679900657716e-01   +4.446154712078396e-01   -2.694729234374522e-01   +6.972950076694795e-03   +2.897602434484158e-01   -2.324040038831666e-01   -2.942714853027258e-01   +7.201016987377454e-02   +1.918708310685635e-01   -9.104718242156817e-02   -7.137598551751720e-02; +2.077666092702206e-01   -5.556231240814818e-01   -1.905200637380912e-01   -4.177556907690630e-01   +1.083064045996862e-02   -5.848131256702721e-01   -3.425701591320111e-01   +1.680925456898149e-02   -4.815594622791677e-01   -2.834961926217276e-01   -6.035548051119444e-01   -2.021808419265575e-01   -8.673030548696392e-02   +5.914078714776133e-01   -2.182629548082947e-02   -4.363134499588397e-02; +4.106261083991327e-01   +1.986934267218043e-02   +4.497460164135406e-01   +5.017798082497158e-01   -5.642668351519621e-01   -2.319725284688709e-01   -1.026524922785806e-01   +1.578858790464857e-01   -3.677946856820065e-02   -7.102034903607335e-02   +5.983754158685539e-01   -2.340460136745710e-01   +1.111523451146287e-01   +2.203495421726733e-01   -3.627502956005145e-01   +1.357983944144414e-01; -3.188611720121535e-01   -8.671794573651911e-02   -4.007835819717810e-01   +3.450948539090049e-01   +2.457237129143153e-01   +2.667091319909777e-02   -6.382465939682027e-01   -1.936210322197915e-01   +7.611303052574976e-02   -2.446172429284212e-01   +1.364799928925754e-01   +2.444206929331998e-01   +4.505253263062692e-01   +3.251717257622635e-01   -1.059703573472613e-02   -3.745075096123733e-01];
L1E_L1I_iGABA_netcon = [+1.329544111057410e-01   -3.348759576676908e-01   +2.583474688610312e-01   -1.116947461635856e-01   -3.062301031916262e-01   -4.975244249615299e-02   +1.965081505482372e-01   -5.184119078450920e-02   -6.161346881578149e-01   -3.098456458174862e-01   +4.822671406094889e-01   +3.654730530758115e-01   +1.618184061460461e-01   +3.284833690848731e-01   -3.977716965632948e-01   +3.390952061147171e-01; -1.530427581154888e-01   -3.625668320152288e-01   -5.262971100622038e-01   +3.228306858434471e-01   -2.275725418006221e-01   +3.118261994724855e-03   -1.156495294006651e-01   +1.132461870856440e-01   -8.135884681408606e-02   -1.571885324431466e-01   +7.092521013596133e-01   +3.168620300443528e-01   +6.634173114401072e-01   +5.030000351440499e-02   +4.157150229586088e-01   -3.618374962218893e-01; -9.395160696979715e-02   -2.337838020124512e-01   -2.961081631225482e-01   -8.380469903262347e-02   +6.588275716406741e-02   +1.813655966334974e-01   +3.328556257116552e-02   -2.481998987537740e-01   +2.579580003898754e-01   -1.211543712808533e-01   -1.109753649748811e-01   +5.182860447972915e-01   +1.096920793927038e-01   -2.055660802358989e-01   +2.846513826551808e-01   -2.126224855587243e-01; +2.900122988432008e-01   -3.385614034844798e-01   -4.561547461413640e-01   -3.158669988810076e-01   -6.884123529258677e-01   +2.662690301261610e-01   -3.262918175022285e-01   +1.135687850404106e-02   +9.282017715469010e-02   +1.227293192448425e-02   +5.002477233752964e-01   +4.992363365889749e-02   +6.042298231205785e-01   -5.894150467664353e-01   -3.559075966387801e-02   -2.332946175382005e-01; -3.473068618310919e-02   -3.592727615757271e-01   +4.815268373962545e-01   -5.908616185387591e-02   -2.287290482181532e-01   +7.641557113516723e-02   +3.614141463509492e-01   +1.695685576916881e-01   -2.905487899639883e-01   +3.743871899083345e-02   +2.094777353586352e-01   -2.357647304511202e-01   +6.640577975127138e-01   -1.532305895461723e-01   -2.741786250996003e-01   -3.645918078887951e-02; +5.097549554236970e-02   +2.087505076494831e-01   +3.093337655890954e-01   +5.039613594494916e-02   -2.063920463270423e-01   -8.989437426901233e-02   -2.006770129487483e-01   -3.806270615082257e-01   -6.310485038843374e-01   +7.739775888694761e-02   -1.221020100368858e-01   -9.331799161203237e-02   +3.149379613192848e-01   +1.207548571584037e-01   +1.769000246067572e-01   -7.796501354279617e-02; -5.539058418245623e-01   -1.439478520733307e-02   -2.352987129138675e-01   -3.327553360502241e-01   -1.308935119219662e-02   -6.351401850629605e-01   +1.143892238604273e-01   +2.535071713417305e-01   +2.383222964852171e-01   -2.706939274764747e-01   +1.694122377778703e-01   -1.735362244536606e-01   +8.590573062020074e-01   +3.590577099275222e-01   +4.815257289733060e-02   -4.753758670292614e-01; -7.130583320189053e-03   +2.268353888146217e-01   +2.352604893850055e-01   -3.888347018572191e-01   +5.541043726027942e-02   +1.263724381254934e-01   -3.871823665694398e-01   -1.235969654618110e-01   +7.093806403967672e-01   -2.488029076515424e-01   -1.107605059390040e-01   -9.894636738998000e-02   +4.281897231598086e-02   -8.621717217517841e-02   -1.568875357248781e-01   +4.110020825444982e-01; +5.493107609704564e-01   +3.478032194628357e-01   -2.596661919460888e-01   -5.487160909334395e-01   -1.029411847272295e-02   +4.144307253275843e-02   -2.140488292680457e-01   +2.734000783753482e-01   +9.482195722549067e-02   +7.570877494959823e-02   -2.902342923130024e-01   +2.127738566590865e-01   -5.076703448816652e-02   -1.867961591058643e-01   +4.135644500544652e-02   +2.160696530560391e-01; -5.353947924524023e-02   +1.351931938162291e-01   +5.353554457205043e-01   -3.561984400923304e-01   +2.965112145887784e-01   +4.730185530742979e-01   +7.310458498020209e-02   +4.005552817846293e-01   -4.021522103185744e-01   -6.484735008456743e-02   +2.716195466343071e-01   +2.167290269411206e-01   -2.098557856582529e-01   +1.014657656727319e-01   -1.573077022586834e-02   +2.304734390753935e-01; -2.689857607712948e-02   +2.471412258277629e-01   +8.925315197649011e-03   +8.627662666503622e-02   -1.494845821525787e-01   -3.747662704164922e-01   -1.263167438560097e-01   +9.183281606068465e-02   +5.369677331862140e-01   +4.706008646285925e-02   -1.343060064786710e-01   -1.698848403635638e-01   +1.733338382954074e-01   +2.303563487424322e-01   +5.144627324661939e-01   -2.774147102008930e-01; -4.623173440411625e-02   -4.434106801869576e-01   -8.717761275449565e-01   -2.527186794976063e-01   +1.450054224537171e-01   -4.773351698127290e-02   -2.636617483136603e-01   +2.172421028032938e-01   -7.445937595507968e-01   -2.493183099317285e-01   -1.712840473600415e-01   -1.358213057264028e-02   +9.464176403238800e-02   +1.317631850098046e-01   -6.243290779478609e-02   -2.761532247655998e-01; -4.504326685450046e-01   +5.185066978203821e-01   +6.612570942518173e-02   -3.226802598897972e-01   -6.724511403838228e-02   -2.658522552860152e-01   -4.843099856600490e-01   -1.125293776810367e-01   -1.779648070778516e-01   +2.245590591306849e-01   +2.427371505083138e-01   +1.067241142613895e-01   -6.616777624992529e-02   -2.804561469419500e-04   +2.447779243029961e-02   -7.070425330106464e-02; +1.042326757398901e-02   +5.372390757774640e-02   +5.867895479567396e-02   +8.782813516805522e-02   +4.894832635781750e-01   +3.745646520590429e-01   +1.273865432255515e-01   +1.742937761396544e-01   +2.246957337455135e-01   -2.543075398163243e-01   +4.214495645257574e-01   -4.020695260825911e-02   +9.827944347130946e-02   +5.161181845664448e-01   +3.188995373680066e-01   -2.045389957808946e-02; +3.342150858401962e-01   +9.542230336179042e-02   -1.516038044484636e-01   -2.788642863333374e-01   -1.218076450207111e-01   -3.227478505628690e-01   -5.504889556394735e-01   -2.851253749837365e-01   -1.343919841119437e-01   +2.136874574549109e-01   -7.224754830071101e-01   +1.450598914577660e-01   +1.353933358008459e-01   -7.885694117905184e-02   +1.309181957821363e-01   -1.909474060803163e-01; +3.866917087049893e-01   -6.499011372170783e-01   -1.431148369203150e-02   -6.009894529578419e-01   -1.616152072202374e-01   -8.398761188652751e-03   -1.252275214462001e-02   -2.332151929856473e-01   -4.568581454968453e-01   -2.726755818312201e-01   +5.784228271966158e-01   +1.406048831076698e-01   +6.483039790305228e-01   -3.496065061998254e-01   -1.015373560613383e-01   +1.724258841377051e-01];
L2I_L1I_iGABA_netcon = [-1.111294575197258e-01   -2.922764393848482e-01   -1.632848664687997e-01   -3.068115575960846e-01   +5.494347118536014e-01   -1.243395880372889e-01   -3.474943281472688e-01   +2.711100293861597e-01; +3.327955981342819e-02   +3.541804489504971e-01   -3.665138548390234e-01   +2.066464321484792e-01   +5.012682486911904e-01   -2.167524087297343e-02   -9.656898245700314e-02   +4.519873490231237e-01; +1.768604600353734e-01   +1.434600861461267e-01   -3.751372914873035e-01   +1.095561402750767e-01   -1.284123124487646e-01   -5.186119858649492e-01   -4.455533611123806e-01   +6.149001163588208e-01; -6.772375216121719e-01   +7.108447483325520e-01   +2.030842880753976e-01   +2.233168507277228e-01   +2.436471351846966e-01   +1.011291614372761e-01   +1.680082979679548e-01   +2.192432283429385e-01; -1.926915266278412e-01   +4.898974027714229e-01   +5.529069197663006e-01   +1.902843515494658e-01   -4.502773563813336e-01   +4.710479604765839e-01   -6.643869685830840e-03   -3.525178941087407e-01; +3.381780991932550e-01   +1.463093568320197e-01   +5.905704921330286e-02   +1.261603720341406e-02   -5.463297152776390e-01   +4.802652216838721e-01   -3.947462797994133e-02   +9.533149882941103e-02; -3.119670149042955e-01   -2.043942201972359e-01   -4.483410877781818e-01   -6.801542998515580e-01   -7.184329338731078e-02   +3.570419019324738e-02   +2.878597182718777e-02   -3.990789103918784e-01; +5.659832993923554e-01   -4.549920790771911e-01   +6.847457642185965e-02   +6.380365561888267e-01   -4.553125034369856e-01   +1.814974779140482e-01   +1.916952290213810e-01   +2.511286617603837e-01; +3.042353528963190e-02   -4.401183464492109e-02   +5.413348789238867e-03   -3.819293022229739e-01   -1.026089383434697e-01   +2.890162013705580e-01   +1.902700847838418e-02   -1.624190845841823e-01; -1.643039968230224e-01   -3.665688223473826e-01   -1.670437088585580e-01   -1.427679099503210e-01   +9.882854697761186e-02   +3.034395679312131e-01   -4.897673902108443e-01   +3.225882143679502e-01; +5.434933949450479e-01   -4.067326126800601e-01   -2.987849480716113e-01   -1.205650541210489e-01   +1.756854713516441e-01   +1.907058669496710e-01   +2.448369323554715e-01   +6.177768061212661e-01; -4.563097348607848e-02   +1.250712328906992e-01   +8.227054817404811e-02   -2.025859999736980e-01   -7.016479302586566e-02   -2.578080839420677e-01   -2.816148727214179e-01   -5.285740361268902e-01; -4.855309505141810e-01   +1.698038142739499e-01   +2.595963675229008e-01   +7.929215207271703e-02   +2.685785574894984e-01   -1.693562906948276e-01   +2.773472165920166e-02   -4.606214908850101e-01; -7.123703868944689e-02   -4.028109992501764e-01   +1.536287165767622e-01   -6.037804827158486e-02   -1.701441362356135e-01   +2.059045948341235e-01   -1.303431772800079e-01   +1.375829543005338e-01; -1.396525903380509e-01   -1.830995139026080e-01   -5.087132776233155e-01   -1.944840184466173e-01   +5.003719822238905e-01   -1.048039771316135e-01   -7.293166788989118e-02   -6.437191893788143e-01; -1.621583406835343e-02   +2.379607169780142e-01   +2.176830524333148e-01   +2.243579908300255e-01   -6.675602421490692e-02   +9.950433838098945e-02   -1.882454602432753e-01   +3.269840159835524e-01];
L1I_L2I_iGABA_netcon = [-4.202625127189621e-01   -4.121299254759020e-01   -2.129137412434862e-02   -2.187959077719849e-01   +2.046377049743409e-02   -5.627681962046053e-01   -1.583037935813748e-01   +4.202182221684506e-01   -3.623570155039437e-01   -2.692741566350931e-01   +1.791484746900403e-01   +4.900085269712866e-02   +5.767663500728623e-02   -7.349378717224975e-02   +1.269566563127609e-01   -5.438764841388574e-01; -2.132388113939399e-01   -6.219663676573246e-01   +3.019470976562787e-01   -5.568064126567140e-02   +2.284541271265706e-01   +7.486613620896382e-02   +3.285628248146309e-01   -5.521335649179382e-01   +8.866628909087547e-02   +4.841255777044702e-01   -2.385371117603556e-01   +1.684307472355145e-01   +1.231409704659038e-01   -2.661676074762017e-01   -1.781225323084538e-01   +2.218128429901812e-02; -4.496196158276986e-02   -1.747664225538135e-01   -2.120924263166552e-01   -1.409251690059267e-01   -2.336853423465063e-01   +1.166849967173091e-01   -2.781150643427028e-02   -2.796892141704056e-02   -4.561504213117395e-01   +3.581788736138403e-01   +1.103969448308660e-01   -6.279335284950228e-01   -4.941215859715454e-01   +8.156562342975154e-02   -4.349256998582566e-01   -4.181405420973556e-01; +3.615086341355323e-01   -3.646245102709723e-02   +1.564082242957897e-01   -6.685786601081029e-01   -6.896809350305758e-02   -3.636291287027762e-01   -2.847997852204573e-01   +3.690352912157306e-01   -1.298623598058965e-01   +1.583013993027321e-01   +2.400475244176793e-01   +2.549273637689592e-01   -2.761961750510299e-01   -6.000813412744894e-01   -6.633046108318530e-01   -6.923839338232112e-01; +2.737419627454657e-02   +3.036252437032249e-01   -4.195921481618334e-01   +6.268263597544804e-01   +3.593608877573896e-01   +1.066650310860622e-02   +1.996879625659401e-01   -1.995539538740554e-01   -5.837875632149767e-01   -5.127255944841566e-01   -2.154817333351454e-01   +2.466867256319611e-01   -1.693426091158914e-01   -1.720150494213767e-01   -6.120253257624180e-01   +3.520772347921012e-01; -1.222597344281408e-01   -1.714609284877178e-02   +3.375934941158144e-01   -1.998769146442785e-01   +9.038632225587734e-02   -1.273223402650002e-02   +4.661991004139266e-01   +2.986778532696338e-01   +2.332233342083192e-01   +6.900422879059680e-01   -9.697432655337984e-02   -2.239395129618667e-01   -6.295168230044214e-01   +3.985471190937867e-01   +2.832453204228988e-01   +4.306857303256371e-01; -4.482895901317516e-01   +5.784044830513690e-01   -3.928125649807549e-01   +2.978545065263945e-01   -1.989414899981528e-01   -1.964535010211710e-01   -1.114839527505010e-01   +4.913084834466450e-01   -5.768385387052726e-01   +3.342984536634574e-01   +1.195748420846469e-01   -1.784942466964719e-01   +4.137952281583261e-01   +8.802740767168131e-03   +2.690451316359869e-01   -3.709382481331229e-01; -2.054409748858496e-01   +1.056713612078515e-01   +1.431158689580452e-01   -2.570923238103577e-01   +1.306985902299862e-01   +1.164170260920774e-01   +3.665694007458488e-01   +3.500186710773155e-01   +8.736818068329007e-02   +2.510257566074993e-01   +2.642732783819032e-01   -2.033320241244267e-02   -9.317099425633318e-02   +3.941912642423950e-01   -5.009340396355244e-01   +2.981926895633218e-01];
L2E_L1E_iAMPA_netcon = [-3.932983062311614e-01   -2.362218981420031e-01   +5.641902190262584e-01   -2.225038867346596e-01   +3.776467213387609e-01   -5.031788043735285e-01   +2.975002278029434e-01   +1.363056086220438e-02; -3.739382693411106e-01   +2.957432294525932e-01   +2.926674315162850e-01   -6.146197852621987e-01   +4.814771662644198e-02   -8.303599178296990e-02   -1.942915878171987e-01   +4.388973009420332e-01; +1.092240886430960e-01   +4.193961356843939e-01   -2.624749070309037e-01   +1.674294742669744e-01   +5.150313255944231e-02   +2.762197354287147e-01   +8.609107127542752e-02   +3.163244496427011e-01; -9.076484885317131e-02   +7.200726387769890e-02   -1.050157896180112e-01   +9.508234776107780e-03   -1.502814301824405e-01   -1.654824130706536e-01   +2.563688437335166e-01   +1.687863347548371e-01; -5.879827384386560e-02   +2.321566598733130e-01   +5.316342624627445e-01   +5.246790637964340e-01   -1.634366795734975e-01   +1.178632857076101e-01   -3.675227822396737e-01   -3.906554878433635e-01; +4.169811917100688e-01   -5.674915171379351e-01   -2.107861455337856e-01   +6.596897671498270e-01   +3.804017142738388e-01   -3.928667938391789e-01   +3.036820679332136e-01   -2.236493334722734e-01; -3.749855976738114e-01   +3.156887597563470e-01   -2.446435907538060e-01   -2.869504163689729e-01   -3.366238682571582e-01   +4.773104507837784e-01   +2.043096149396091e-01   +4.742436874532384e-01; +5.191623143237877e-02   +2.742918442800235e-01   +4.597120407675845e-02   +3.856163385301104e-01   +2.852717280368777e-01   +4.156240552274746e-01   +4.719586622254172e-01   +3.020581291037750e-01; -1.396904946707734e-01   -1.543574277658803e-01   +8.165321953984721e-03   -6.822810942236472e-01   -2.073899953945360e-01   -5.296174966128885e-01   +3.862212354547055e-01   -2.170726055606929e-01; -7.109758521595342e-01   -2.235808480287271e-01   -4.525447437836916e-01   +3.315468134696425e-02   +4.527552126209765e-01   +3.477574856045310e-01   +3.143163180724728e-02   +2.499929762965709e-01; -9.450353608526209e-02   +4.167476439329940e-01   -2.515025997259090e-01   +2.664595060553245e-01   +1.466214161098882e-01   +2.094496786382180e-01   +6.291660283947422e-01   +1.498974026628871e-01; +1.467772793099886e-01   -5.742128339620726e-02   -2.222698425984272e-01   +5.703692423459923e-01   +4.243315684245879e-01   +4.111972133130187e-01   -3.382358926147389e-01   -1.605907388961396e-01; -8.468750753405143e-01   +1.548220303604034e-01   +2.960025652131275e-02   -2.785730766438596e-01   -5.836262813412073e-01   +6.507320318610281e-01   +5.667063033695422e-01   +7.288113230937231e-02; -4.704763884855300e-01   +3.339257742676779e-02   -3.974285617826047e-02   -3.550173553797981e-01   -8.051456885525914e-01   -9.500016364090275e-02   +3.009458781340721e-01   +9.060614329415347e-02; -4.647810596558141e-01   +1.688980951939871e-01   +4.240236221314277e-02   -4.449094896922672e-01   -2.124168460918797e-01   +6.583305644920444e-01   +9.120244028343466e-01   -3.291895288708295e-01; -6.668461554132989e-02   -1.480602435441583e-01   +4.736480345301257e-01   -8.061537738760576e-01   -4.878915306513887e-01   -7.344424229688043e-02   -1.059023845827815e-01   -5.894462587318848e-01];
L1E_L2E_iAMPA_netcon = [-1.645831724732147e-01   +3.831360955536047e-01   +2.760807244289625e-01   -6.555156811958788e-01   -3.519518790499226e-01   +4.481573763258742e-02   +1.577343516923336e-01   +1.898574987677182e-01   -1.247469218619630e-01   -2.496072986187610e-01   -2.013601571519570e-01   -1.694856491590596e-01   -3.368501880128784e-01   +1.406626942028723e-02   +3.898178600697709e-01   -5.367180512594509e-01; +3.332128007240976e-02   +7.245916243470092e-01   +6.592107449504424e-01   -2.442753323993835e-01   +1.489929043501887e-01   +2.534380332998088e-01   -4.700978521042534e-01   +2.962754778900458e-01   +1.009912308804753e-01   +9.540312017708247e-02   +1.303197483680098e-01   +8.053287277994643e-02   -5.316702923134963e-01   -1.363540271000542e-01   -2.454533585985876e-01   +2.243195940389995e-01; -2.080784885481368e-01   +2.212679077754874e-01   -4.671689604003090e-03   -3.308923276440229e-01   +4.585370545947230e-02   -2.084885351029916e-01   +5.243228320919084e-01   -5.959745629539505e-01   +1.985677126177209e-01   -7.623007530604814e-01   +2.793551170302427e-01   +3.708883056574964e-01   +2.622103588728920e-01   -6.179441737518034e-04   +5.644272968619480e-01   +2.231379336764498e-02; -3.564743561097641e-02   +1.799234855481329e-01   +1.153512913854984e-01   +2.860812870488271e-01   +1.498388867852604e-01   +4.874078367127572e-01   -4.168587907829574e-02   +3.689497422944317e-01   -4.329987871962940e-01   +4.240352215385149e-01   +2.048503890061953e-01   -8.365461515768556e-02   +3.236570062862099e-01   +5.574229246495308e-01   +6.538135340485864e-01   -2.496985461235553e-01; +4.109839939904472e-01   -6.412483148901448e-01   +4.218643224674509e-01   +2.747024100179949e-01   -4.333618709099730e-01   +1.296332023529689e-01   -1.849619082759391e-01   +2.312710311342672e-01   +4.966361605975263e-02   +3.868142751144230e-01   +1.974854224784070e-01   -3.420315195632540e-02   -4.461916169194512e-01   -5.285956712136151e-01   -4.194646936156267e-01   -3.463382634577328e-01; -5.464772481312376e-02   +2.630039024214295e-01   -1.889247478843889e-01   -1.575895083935954e-01   -4.110626099412479e-01   +2.972853347301662e-01   +6.029854182160580e-01   -6.489469926546929e-01   -9.767974793823389e-02   -8.634566786336878e-02   -2.715918875619668e-01   -9.936492482260753e-02   -3.654641290330639e-01   +2.522000008831141e-03   +5.694266276534186e-01   +4.196284492905487e-01; -3.526715313885082e-01   +2.621335660113027e-01   -2.435593757512423e-01   -1.216418424143589e-01   +8.637672898190091e-02   -1.663143880231019e-02   -4.152175130734591e-01   +1.060223746771484e-01   -1.862744425456110e-01   +3.079917861644567e-02   -2.654372450456219e-01   +1.648961256830542e-01   +2.653195763481636e-01   -6.304607060463179e-01   +8.571417323818342e-02   -1.876180461287569e-01; -1.676827334869190e-01   +7.311948136723396e-01   +6.062296986037858e-01   -3.192507447270033e-02   -5.207274682348493e-01   +9.159132599260313e-01   +6.824393837617011e-01   -2.625119997544719e-01   -1.681740136201312e-01   +4.248737794949266e-01   +4.111131529286787e-01   -1.928249673306550e-01   -2.141529271018374e-01   -2.787648050974759e-01   +4.227831337059809e-01   +3.238313530311205e-01];
L2I_L2E_iAMPA_netcon = [+4.609442710545046e-01   -3.335024015605373e-01   -1.989501158163957e-01   -4.646478681954935e-01   +7.954888205433444e-02   -4.460941482139872e-01   -7.778623251297857e-01   +8.154850226647882e-01; +7.358234089161477e-01   -2.595317626104357e-02   -2.540544579917640e-01   +2.293581545848183e-01   +4.441791642654070e-01   -3.676729425877387e-01   -2.966147059085110e-01   -1.459659786343377e-01; +9.495670228174684e-02   +2.371569774958600e-01   -2.929777592196635e-01   -6.286913870107255e-01   +1.289059291256920e-01   -3.060862996268676e-03   +5.334304117127411e-01   -1.900839767305429e-01; -5.952697580669803e-01   +2.930050372396981e-01   -2.984716386946344e-02   -5.334783654909556e-01   +5.088446449013041e-02   -2.845768483979981e-01   -3.429925153724391e-01   +9.613686114180178e-02; +7.383943467778837e-01   +3.256908974181215e-01   +3.880085015549391e-02   +5.091770359892296e-01   +4.007632316773623e-01   +3.166335052209949e-01   +5.864120016958577e-01   +1.795808299114202e-01; +2.776390302379909e-02   +6.203209151468521e-01   +1.971695849272279e-01   +3.392737851111388e-01   +2.320779213857235e-01   +1.818702501602061e-01   +9.700456049616658e-02   -3.312771075386679e-01; +2.546116914642409e-01   +1.476190095323600e-01   -3.803006040207413e-01   -2.425027838243443e-03   +8.463929286594146e-03   +4.509587767031588e-02   -2.133546468952233e-01   +6.269407926258741e-04; -4.243512361949227e-01   -2.473914786107893e-01   -2.236832556287886e-01   -3.211836292538215e-01   +3.544310621330083e-01   +5.590609535624246e-01   -3.607137821210576e-02   -3.485579783231962e-01];
L2E_L2I_iGABA_netcon = [+2.862887990270440e-01   +2.753281663867660e-01   +6.348782474347318e-01   -3.433636450242865e-01   +2.166610905668007e-01   -1.222960250752117e-01   +2.856263972394860e-01   -3.743012647883694e-01; +1.476892014146146e-01   +4.001062679762080e-02   -2.508500298877957e-01   +3.310028510857771e-01   -3.880929969962275e-01   -3.545517120575083e-02   +7.987493711430543e-02   -2.777745147465866e-01; +3.845568239467953e-02   -3.468201503742850e-01   +8.288119344583711e-01   -5.559913246405646e-01   +1.740363398041419e-01   +2.884333163539693e-01   -3.008112889112790e-01   +5.494108141546916e-01; +2.430841863449208e-01   +5.819339439147778e-02   -7.173626074049387e-02   -2.670473083478957e-01   +3.697341622673858e-01   +6.559571298013758e-02   +2.600212805800526e-01   +3.771836559398627e-01; +5.134877278659750e-01   +1.397908502666216e-01   -1.450161165329048e-01   +3.922858128126628e-01   -1.273677415869856e-01   -3.224648809285195e-01   -3.936416440986619e-01   -4.335135979281111e-01; -5.211579922275462e-01   +2.682159978262361e-01   +2.812839551203071e-01   +6.754070929703360e-02   +2.273097151144244e-01   +8.883702673626080e-02   -4.808541147566487e-01   -6.166180433507020e-01; -2.665120910061846e-01   -3.107521675888638e-01   -4.632341231966034e-01   +2.637854071450901e-01   -1.702870714952290e-01   -2.106956985455656e-01   +4.670556712682694e-02   -4.343773219048416e-01; +2.080291695300736e-02   -3.630664450403788e-01   -7.145768421412994e-02   +1.587063911447818e-01   +3.161826167272257e-01   -1.587587372483818e-01   -5.774520148692462e-01   -4.267303798236824e-01];
L3E_L2E_iAMPA_netcon = [+4.536847416189971e-01   +2.211401436642362e-01   +3.632961478354881e-01   +3.209228655964506e-01   +3.069800560737475e-01   +1.154641756806352e-02   +1.056086274307465e-01   -2.888487859872950e-01   +1.902251990813416e-01   +9.509121016217234e-02   -1.596476164035384e-01   -3.292104597688507e-01; +1.285793222101888e-01   -4.235259301488930e-01   +2.979735149067132e-02   -1.043807437949554e-01   -2.981577055685843e-01   +2.478721685591688e-01   +1.884457504533724e-02   -6.406559753828943e-01   +7.022434299800207e-01   -5.981376217764650e-01   -4.255753458813884e-01   -1.212488616891992e-01; +3.305919911302870e-01   -1.431688711536903e-02   -6.600535800263106e-02   +3.115739313344718e-02   +4.386751491621391e-01   +5.917111297732291e-02   +1.731673564652134e-01   +4.347995131404642e-01   -2.985460851039920e-02   -2.540332027466984e-01   +1.684004705821255e-01   -1.640091675427106e-01; +4.278817259032932e-01   -6.959472160435674e-01   -2.689488469759550e-01   +4.736916315234275e-01   +3.976187432107908e-01   -1.753850862938375e-01   +2.678550527001107e-01   +4.318464215331366e-01   -7.716327910225083e-02   +6.546880749387576e-01   -2.080737125312463e-01   +4.460922794919120e-01; +3.302351670819646e-02   +2.888158253924836e-01   +3.125103408642738e-01   +3.116221057176877e-02   +1.089896600936840e-01   +2.340889355331590e-01   +5.381576619104975e-03   -1.984472517989562e-01   -2.182749666723521e-01   -3.991066429432065e-01   -2.382361432267306e-02   -1.268035529457538e-01; -1.316111832650601e-01   +4.895309173683284e-01   -1.303507958700651e-01   -1.446861010123450e-01   +3.092381312302194e-01   +1.629574808756920e-01   +4.712527025487612e-01   +1.490113906147010e-01   -7.449195295019404e-01   +2.519718267108209e-02   +3.179804260566091e-04   -6.516287217754060e-01; -8.226207056404465e-02   +1.570875221008264e-01   +3.360775671948153e-01   -1.263450773933259e-01   -6.639165185557410e-01   +2.836064320326552e-01   -3.393293407036629e-02   +2.591864609091574e-02   -3.835452323562120e-01   +4.005881921479830e-01   -8.968005832323919e-02   -1.271725677671551e-01; +5.920865124218200e-02   +6.988379178224484e-01   -2.381244078638702e-01   -4.053569694075362e-01   +1.318976649448615e-01   +1.283892489644845e-01   -6.103833763516874e-02   +6.329670489794843e-01   +9.929777993294309e-03   +6.090749712907223e-01   -2.055689339932154e-01   -3.144534006815056e-01];
L3I_L2I_iGABA_netcon = [+1.611110123944026e-01   +3.046648423564851e-01   +2.968262351561690e-01   -2.808370459784132e-01   +2.718510966507272e-01   -1.544467914457787e-01   -1.742540166660659e-01   -4.539763811307314e-01   -1.584955191607602e-01   -2.655634984641614e-01   -2.939492407387463e-01   -4.676266737962536e-01; +2.039428587457848e-01   +8.227086982848761e-02   -6.402485747585043e-01   -1.399433084033405e-01   -2.322000489590451e-02   +4.681235957879630e-01   +1.517813667246689e-01   -9.879731917211394e-02   -1.827137721238211e-01   -4.124937413557789e-01   -4.806489371464803e-01   -5.022872965782931e-01; +3.766345086555624e-02   -1.267686563597829e-01   +4.930020659960298e-01   -5.194739674021005e-01   -3.786503630550739e-01   +2.180785345959829e-02   +7.447820361296820e-02   -5.354037285772598e-01   -5.219748091577433e-02   -4.969022206358044e-02   -5.423565591826248e-01   -2.967200471343946e-01; -7.696881089244549e-02   +3.073845805112985e-01   -6.863779826650720e-01   +3.231464580844742e-01   -7.276225915357362e-02   -2.381859102945671e-02   +1.058278917884400e-02   -2.069265651534838e-01   +4.542756868746344e-01   -2.435586605279747e-01   -5.036167459302689e-01   -5.543113668602100e-01; -1.104523849873717e-01   +6.552634295025189e-02   -7.371344927361671e-02   -2.521776961411673e-01   -3.164661597581891e-01   +5.252906956658154e-01   -4.196329807000731e-01   +5.238096385386826e-01   +2.936759472778483e-01   -3.218932907863560e-01   +6.612935253150516e-01   +1.584712348198475e-01; +1.926367421584609e-01   +6.128740239876699e-01   -3.533272558480564e-01   +5.508021708253096e-01   -1.483940066840220e-01   +9.031537556144577e-02   +3.413013995816596e-01   -4.901400251025977e-02   +3.825067445902636e-02   +1.985480045800685e-01   +4.153730775029029e-01   +4.627479819603587e-02; +4.376125843319719e-01   +4.154073710350134e-01   +1.023558481029183e-01   +4.012410048974868e-01   -2.947000110873902e-01   -7.084037023104728e-02   +3.873783358221552e-01   -1.944966201718976e-01   +3.191471092510986e-02   -4.334961084305947e-01   +5.344173074302910e-01   +3.691274720521271e-01; -4.709404439516598e-01   -9.675695291635400e-02   -1.368144244524285e-01   +1.677068780566187e-01   -1.308729001724651e-01   +2.245315215270220e-01   +1.637704435448649e-01   +1.366415743277493e-01   -1.483868711894116e-01   +6.883589701940153e-01   +3.641859455606514e-02   -2.961116104310983e-01];
L2E_L3E_iAMPA_netcon = [+9.469681820567261e-02   -1.765141413886204e-01   -8.181080199933838e-01   +2.813914083974587e-01   +1.037011766524035e-01   -1.108917793916643e-01   -5.108665484602931e-01   -9.716789663911450e-02; +2.354003106878036e-01   +1.235678155781078e-01   +1.063897818038342e-01   -1.267528090478725e-01   -4.858005784411379e-01   -2.592205703340962e-01   +3.410142683579875e-01   +3.774806265330898e-01; +1.504127655124905e-02   -6.534960360720934e-01   -4.152648726766213e-01   +1.456985933689907e-01   -5.160318777231000e-02   +1.363318886783976e-01   +1.123824970535325e-01   +3.969766874998002e-01; +2.794176186859205e-01   +1.279151452688891e-01   -7.908678808008726e-02   +7.420392208301884e-01   -3.971469483304524e-01   +2.226188111631653e-02   +3.423731785097440e-01   +3.789891158263521e-01; +3.819702250006191e-01   +1.104612901445221e-01   -1.902952441730301e-01   +9.688851414830688e-02   -2.271388292716977e-01   +1.054188942913688e-01   +1.203231318549332e-01   -7.728872086080559e-01; -5.034679879332211e-01   +7.906240411452636e-02   +2.405416011303625e-01   +8.001628072371195e-02   -1.465794841497222e-01   -6.951079268274889e-02   +1.312230957637547e-01   -3.553759704251849e-01; +2.199248122382365e-01   +3.918496952905284e-01   -2.514088742591872e-01   -2.733909021567058e-01   +6.454652144573996e-01   +2.374456616793612e-01   -3.982993143394868e-01   +8.934953940622638e-02; -1.434421246746204e-01   -4.378875991842004e-01   -4.466936606780397e-01   -4.704367133524515e-01   +2.448399827042447e-01   +5.424671410810931e-02   -1.717089761515296e-01   +3.731586762719363e-01; +8.495740402813459e-02   +4.667481582506239e-01   -3.212745266747932e-02   +3.795400471118427e-01   -7.885148149257057e-02   -3.880485892525519e-01   +2.173981187731962e-01   -6.816967824625209e-03; +4.673763702293629e-01   -5.738192412392679e-01   -2.627088108473502e-01   +3.299813304203008e-01   -1.070183937020155e-01   +3.320021445609811e-01   +3.498239571922113e-02   -2.909694080024657e-01; -2.633827943790075e-01   -6.976419673016063e-02   +2.217402019096919e-01   +4.148950623033010e-01   +1.687716360599297e-01   -6.554926912764303e-02   -6.220859683887977e-02   +4.516318631258189e-01; +4.507372002639217e-01   +7.775229733330105e-01   +1.859255445267590e-01   +2.426737984231043e-01   +1.880032427126223e-02   -1.045179311735264e-01   +6.523715979690956e-02   -3.316303617449039e-01];
L2I_L3I_iGABA_netcon = [-2.240911878513760e-01   +9.239322087450094e-02   -4.883635248999958e-01   -2.844254230444898e-01   +6.370986778932190e-02   -3.272210575210165e-02   -1.334765491844838e-01   -3.834721497191447e-01; +7.619217625823174e-02   -1.167010623381097e-01   +2.620193158629809e-01   -3.097186991622791e-01   +4.820399231583915e-01   +1.217075490895365e-01   -8.196765220707061e-02   -7.500214298281102e-02; -3.341288641081347e-02   +6.067768919526602e-02   -1.175499016005010e-01   -3.650046666647631e-01   +2.401888403641579e-01   -2.399201345569396e-03   -4.681651173549377e-01   +4.957695717107847e-01; +6.305504855163221e-02   -4.807374181698747e-02   +9.207599201132675e-02   -2.515230393561607e-01   -7.800405048062751e-01   +2.489658269344995e-02   +2.031579605945643e-01   +4.027409392425854e-01; -4.123292693239515e-01   +2.191839876884097e-02   +2.483151615776886e-01   +2.344722454641856e-01   -5.964488337854386e-01   +2.811006552130815e-01   -1.489750133007319e-01   +8.974057050994175e-02; -9.405128616304835e-02   -3.927366411454500e-01   +4.937625667317997e-01   +7.947955321857356e-02   +5.141924584106931e-02   -1.021119449056344e-01   -3.298675758330779e-01   -5.055791042800444e-02; -5.215324168486563e-01   +1.406107091722357e-01   -3.294900349354968e-01   -3.900303556474670e-01   +2.567143920045073e-01   -6.018499527911246e-01   -1.163223383299762e-01   +7.065628235484162e-01; -3.600348552616568e-02   -2.507932689559824e-01   -6.727172571760176e-01   +3.165097700991008e-01   -1.530797414676805e-01   +2.562523734253265e-01   -3.231885982639974e-01   +5.646239514691653e-01; -2.794927202606821e-01   +2.949709592094398e-01   -2.456480693575819e-01   +2.805373928495480e-01   -6.427597377582263e-01   +6.110305082266925e-01   +3.388887797599272e-01   -1.991208151197597e-02; -2.910900881915711e-01   -1.618254629327692e-01   -2.318248793488759e-01   +6.942615972914709e-02   -5.239756552162502e-01   +5.086039557803453e-01   -1.497338952322641e-02   +5.149427006904407e-01; +1.228197968639209e-01   -1.314456351453483e-01   -9.038485524056511e-02   +2.321735084725637e-01   +1.939020952065644e-01   -1.264440899202227e-01   +4.149110359527130e-01   -1.830090818787967e-02; -7.238948471518585e-01   +7.390738323987345e-02   -8.974986010177287e-02   +1.230624721370506e-01   +3.302037003458183e-01   -4.024144714833489e-01   -6.443912841930682e-02   -7.210510139895107e-01];
L3I_L3E_iAMPA_netcon = [-4.826909983128419e-01   +1.504256309089511e-01   +3.359054306038112e-01   -1.138277707610188e-01   -1.621166646894533e-01   +2.443572456439697e-01   -4.427837468335373e-02   +7.074358578467718e-01   -4.551469727496071e-01   -4.719749994038119e-01   +3.823626934290376e-02   +3.482848515501138e-01; -6.737629766370596e-01   +3.763965932493445e-01   -5.068268316346114e-01   -4.193863872430563e-01   -2.214578886453489e-01   +2.812185159846877e-01   +4.057850063437482e-01   +1.140410874744601e-01   -2.281536273234562e-01   -1.516178836125274e-01   -4.069296654004241e-01   +3.238255973200310e-01; +1.528027454879695e-01   -8.523020244534935e-02   +8.292143002042119e-01   -2.321197869164411e-01   -7.539595927884220e-01   +2.544788056863159e-01   -7.785710472283169e-02   +4.782278811102977e-01   +1.448239695720631e-02   -2.334334838851636e-02   -4.364927226404602e-01   -4.540206670502392e-01; +8.406631749172797e-01   +3.161217330888925e-01   +7.282318460780254e-01   +5.810710115248575e-03   -2.757914329115967e-01   +4.274619318849295e-01   -1.894228394828263e-01   -1.344297418246045e-01   +1.939474429836565e-01   -2.508911024464953e-01   +2.845030317332474e-02   +2.016145797932888e-01; +2.939091956423982e-01   -6.933588969086125e-01   -1.105742337496786e-02   +2.572817569083161e-01   -3.494269201286650e-01   +1.971510658567301e-01   -4.652447270604060e-01   -2.727249511937739e-01   +4.299501536270825e-01   +2.671384496694393e-01   -2.146792007470495e-01   -6.193857558044176e-01; -1.236768734095032e-01   -1.785952194799237e-01   +1.196807157219212e-01   +2.056683329994290e-01   +1.487317644968001e-01   -2.634379092890984e-02   +5.389706661286980e-02   -2.004444318711533e-01   -5.574907203634131e-01   -4.977282186080870e-01   -6.366758719954801e-01   +5.281309105345597e-01; +3.669431937407971e-01   +1.161253410856607e-02   +5.340875151621844e-01   -1.337423766299557e-02   -2.010272876967993e-01   +2.194858985826620e-01   -5.277939972059884e-01   +5.864056107313518e-01   -4.185648713767969e-01   +7.272979734616757e-01   -2.447541794085899e-01   -2.510401197917263e-01; +1.786716124096105e-01   +2.158302647706665e-01   +5.394322798346980e-01   +4.464163905735316e-01   +8.498934504596878e-04   +1.647770391536116e-01   -4.014609669026708e-02   -4.313593074710854e-01   -7.945427238038053e-02   +2.482289657696582e-01   +1.710644544448038e-01   -1.060411816018809e-01; -1.094802523961905e-01   -4.445338302752412e-01   -2.651233182667443e-01   -1.674812389425587e-01   -4.795038818539371e-01   -3.291728061613740e-01   +4.627596496101589e-01   +5.987309723619305e-01   +1.319689453398414e-01   +5.443419506861245e-02   -3.744205577363060e-01   -2.807523174750949e-03; -7.050371991914195e-01   -2.268179711973025e-01   +3.534471305938823e-01   +8.957790883364566e-02   +6.379880035998778e-01   +2.135032346722042e-01   -8.144483055232218e-01   -4.621353484850004e-01   +5.334507687836954e-01   -3.619044621373138e-01   +1.036868143005849e-01   -2.829609880176746e-01; -2.242114444968452e-01   +4.847378183014818e-03   -1.048453121157346e-01   -2.247500174554737e-01   +1.788926930548708e-02   +1.165414874920582e-01   -4.173329648098589e-01   -5.600790741455584e-01   +6.906917264201980e-01   -2.699961870616943e-01   +2.715293860925616e-01   +2.824282450741660e-01; +1.686454688039456e-01   -5.120577087534797e-01   +5.291377795073945e-02   -1.682248600426214e-01   +4.336950968361352e-01   +2.484575726309682e-01   +4.013719213730029e-01   -5.979211279629231e-01   -7.529515912389395e-02   +3.660668503155605e-01   +1.660009794137402e-01   +4.176423240348094e-01];
L3E_L3I_iGABA_netcon = [-4.136952025048709e-01   -2.006596492060283e-01   -5.581581223100607e-02   +6.075705852030039e-02   +7.196231765747839e-01   -6.113318048617191e-02   +2.517295733539102e-01   -3.123558397111508e-01   +2.472838587707581e-01   -1.628256617811403e-01   -2.238288050290623e-01   -1.178646925943414e-01; +4.774170388151835e-01   -1.057007668027680e-01   -1.146942669088817e-01   -1.044086407029202e-01   -1.499709323892492e-02   -4.038726650453016e-01   +2.377139823818473e-01   -3.126783626470498e-01   -1.169029363170484e-01   +1.373873455679586e-01   -7.960526724576167e-02   +3.995817507176782e-01; +1.749615470447545e-01   +2.888867474959647e-01   +1.498192921487493e-03   +9.192624835023967e-02   -1.762866527745574e-01   +5.866453164295049e-02   +4.861161053326467e-02   -1.251660747191546e-01   +1.529135349118724e-02   +1.806713689078150e-01   -5.613810558948670e-02   -6.320971395643330e-01; -5.385240275115543e-01   -1.435938252603845e-01   -1.871149609250169e-01   +1.776232774384495e-01   +1.186637098882541e-01   -2.901171546855177e-01   -2.675940834231721e-01   +2.637018534734675e-01   +1.003602334509643e-01   -4.080296803493498e-01   +5.029600572735830e-01   -5.477285574271616e-03; +3.572723566123667e-01   -3.707282810168972e-01   -5.739010567838914e-01   +2.545139103362806e-01   +2.749460586642535e-01   -4.452464261023671e-01   +8.046058384821236e-02   -6.321648076437528e-01   -2.675252098317882e-01   +3.653590680204669e-01   -2.690793965954051e-01   -8.390946269443078e-02; +1.421966272372179e-01   -3.786952566848480e-01   +2.982221945571772e-02   -4.472836145838488e-02   -5.145554633768076e-01   +3.079136829024312e-01   -4.846356437389068e-02   -5.131382277552985e-01   +1.856184738366577e-01   +5.138635622796964e-01   +1.224678642502783e-01   -1.756910330869506e-03; +2.126255114323600e-03   +1.720049293695487e-01   +3.082337657895602e-01   +1.994189842334110e-01   +3.135918628944313e-01   +2.018162417519425e-01   -2.661344409295875e-01   +8.150429431861022e-01   -1.830262212770366e-02   -6.254329854006299e-02   -1.098773023657988e-01   -7.733786678228524e-02; +2.643431707305607e-01   -2.194079480452356e-02   +6.720496707457115e-01   -6.999236865715385e-01   -4.335188888490644e-01   -1.937701686454414e-01   +1.132670200543610e-01   +7.335297028369146e-02   -2.037356887970231e-01   -4.459290631696287e-02   +2.595105358340570e-01   -3.148328057047824e-01; -1.660958370907005e-01   +4.723019426943033e-01   +4.565065546925876e-01   +1.689955204831516e-01   +2.474877553950518e-02   +3.884420261329995e-01   +2.281871393855524e-01   +2.794348272625095e-01   +1.413550605888668e-01   -3.370083965463395e-01   +9.109019828899732e-02   -2.631717379612332e-01; +2.098459826669135e-01   +4.819825468382820e-01   +6.306895058349647e-02   +6.572182917914881e-01   +1.957624012057192e-01   +1.058585202016363e-01   -4.738193788598348e-02   -1.139145911335066e-01   +3.667949784464341e-01   +4.149512018350764e-01   -6.193496774945752e-02   -3.376860526049973e-01; +3.309144706837275e-02   -3.580799236373863e-01   -6.218139652609074e-01   +1.684926251869290e-01   +8.972226126478948e-02   -5.256882569596783e-02   +2.600441193742974e-02   +4.781846518713790e-01   -9.949349164387129e-02   -4.409145553870736e-02   -3.612455780552977e-01   +1.828587741190854e-01; -4.301125365241622e-01   -3.267839919810683e-02   -4.997664717434019e-01   -6.223027426171822e-01   +2.570032568642233e-01   +3.424687015369240e-01   -7.727590049324426e-03   -6.726860035903328e-01   +2.490208171688371e-01   -1.444979554273108e-01   -1.277273495589893e-01   +1.132863102209987e-03];
L2E_Input1_iAMPA_netcon = [+3.233148001302315e-01   +3.357449965755475e-02   +1.235514089396326e-01   +2.875926664643866e-01   -6.089732153449115e-02   +2.854411616611247e-01   +3.490583662228859e-01   -1.174523008592827e-02];
L2I_Input2_iAMPA_netcon = [+2.759143668440449e-01   +8.543052724654766e-01   +7.526449438466586e-01   +5.363985098998257e-01   -4.860134878709957e-01   +3.506956938941612e-01   -1.157252504584851e-01   -2.953631858301736e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.4*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 1.0*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 1.0*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.4*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 1.0*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 1.0*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
