function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-1.224201723025558e-01   +2.256867496172056e-01   +2.601005924849462e-01   +4.521418692950970e-01   +4.527242445598248e-01   +2.071383200648333e-01   +5.901011717970061e-01   +3.855842468904566e-01   -1.322477809248216e-01   +3.680904958015523e-01   -1.256351409790576e-01   +2.416004862048969e-01   +1.774877938189836e-01   +4.165438421139797e-02   +5.066875526498045e-01   +6.625570802641144e-01; +2.472852583970136e-01   +5.650670195246618e-01   +3.520825418758293e-01   +1.539722046727436e-01   +1.245411136546236e-01   +4.467604140393462e-01   +2.582722080410215e-01   -7.980461455912696e-02   +2.258909996806470e-01   +1.839968428491511e-01   +1.729086002168069e-01   +6.188827121274956e-01   +4.888943919234342e-01   +3.140520430014412e-01   +2.393150731448324e-01   +1.241784634690376e-01; +1.684758727733293e-01   -9.405934052891365e-02   +2.698598370581075e-01   +9.820813061116518e-02   +8.203790645080929e-02   +3.511770529115159e-01   +3.053642513385621e-02   +5.518088871352100e-02   +1.121105088723095e-01   +7.606413137911329e-01   +4.859159575432119e-02   +4.466431739996832e-01   +1.338283051830144e-01   +6.553807847658732e-01   +3.769976713831860e-01   -5.445133836984875e-02; +7.229718616317028e-01   +2.856779956075318e-01   +1.862521724979617e-01   +2.003534624965200e-01   +3.235723146778033e-01   +3.416681193777062e-01   +4.853983143044173e-01   -3.135978787974265e-01   +5.045853657067140e-01   +6.052071908020149e-01   +3.180185315346085e-01   +2.410394613503395e-01   +2.305386597244148e-01   +4.451117883693977e-01   +6.546074021014454e-01   +1.897287054379023e-01; +4.791989836767866e-01   +2.869862413653362e-01   -1.246672989194850e-01   +9.088321949607768e-02   -7.387406257034550e-02   -1.954661946871994e-01   +2.515378312919145e-01   +3.440736519732786e-01   +3.716906862320759e-01   +5.277542955646612e-02   +2.855881686460437e-01   -1.907930685686548e-01   +8.571676500149836e-02   +5.075797453443126e-01   +5.484324702544413e-01   +4.642957469559110e-01; +4.143535629671696e-01   +1.961178455369671e-01   +4.642819136298395e-01   +4.574831261268027e-02   +9.118980241943540e-02   -2.934184155143413e-01   -1.458063053213870e-01   +3.232500914907096e-01   +4.472282087035911e-01   +5.002610344349342e-01   +2.088507950399571e-01   +5.653928657692786e-01   +2.936696934105197e-01   +1.490417343384919e-01   +1.086759638568414e-02   -3.798141072034575e-02; -3.512259397027075e-01   +2.465690864937092e-01   +3.965874484842432e-01   +2.652749317327079e-01   -2.623136889472882e-02   +2.261743339677767e-01   +6.819815817437079e-02   +4.855714542509480e-01   +5.497064252373010e-01   +1.700412934934337e-01   +2.682923660916543e-02   +2.323276150197493e-01   +4.462927524119701e-01   +1.906924282766148e-01   +2.149001900548021e-01   +3.206633599945476e-02; +1.746418206973943e-01   +2.045027416671814e-01   +6.679184917297590e-01   +3.533934352362067e-01   +3.380605162560464e-01   +4.367532216442843e-01   +1.048092224662477e-01   +5.976063391850686e-02   +6.990256344283253e-01   +5.073502918315775e-01   +3.491949435843187e-01   +2.759223872909379e-01   +1.522586469546001e-01   +4.480567029786386e-01   +4.150617183937070e-01   +8.801223064111177e-02; +3.505884610196137e-01   +3.324055762473707e-01   +1.897887650740365e-01   -6.729973828315042e-03   +5.627130265178061e-01   -5.588826629223715e-02   +4.270986516206735e-01   +1.182900671550593e-01   -1.613152696310746e-01   +5.783175471609091e-01   +4.141589027509491e-01   +4.321413273848637e-01   +3.293002554628251e-01   +3.778786511955210e-01   +1.632552138728700e-01   +4.261140514151376e-01; -1.048333321568764e-01   -2.304156115383721e-02   +3.767891228786162e-01   +5.242213961631903e-01   +6.591925002217787e-01   +3.086851298747977e-01   +1.674306750909990e-01   +3.427123381908544e-01   +2.744699509464987e-01   +5.246504053965015e-02   +1.883725846231518e-01   +4.957699806278091e-01   +6.688441547556545e-02   +2.668264822958227e-01   -8.956414192544596e-02   +3.129915642216883e-01; +7.820404142821356e-01   +5.050420959395482e-01   +6.185019831697448e-01   +3.172309163381133e-01   +2.616435134878101e-01   -1.514030205900623e-01   +3.157167958003840e-01   +2.677937105544474e-02   +5.281291050479987e-02   -1.902762467651291e-01   +5.493080984217054e-01   +1.160236418840920e-01   -1.406468850025776e-02   +2.213798412252401e-01   -4.425927792983329e-02   +6.173809371743097e-02; +1.115928476283679e-01   -1.840676117225790e-02   +1.293257036890410e-01   +1.656124814262893e-02   +5.522799100707255e-01   +7.388992472297942e-02   +6.741680549196956e-02   +7.234042721560480e-02   +8.670041737366770e-02   +2.264431056145688e-01   +2.952245801658070e-01   +1.321315507668900e-01   +1.275713913699278e-02   -2.385535846112042e-01   +5.812235399470608e-03   +9.113789237698436e-02; +6.890994961143006e-03   +5.939539229227988e-01   +1.874311127390060e-01   +2.922375705730653e-01   +2.267717145157392e-01   +8.423902235024830e-02   +6.637195807515408e-01   +3.324152309078154e-01   -6.626078403890526e-04   +6.068089758564015e-01   +4.624769716934483e-01   +2.819590407425390e-01   +4.262558759808899e-01   +3.450013925461696e-01   +2.787063408376899e-01   +5.156750138875612e-01; +1.325894270500438e-01   +4.305439137181787e-01   +1.904687077700118e-02   +2.304065531518049e-01   -2.145944539132597e-02   +6.767294723396373e-01   +3.629148786229930e-02   +1.916232822330994e-01   -1.625874052658840e-01   +7.994903991366840e-02   +2.670463958830969e-01   +1.880066114028938e-01   +6.449623961304041e-01   +6.856038603537866e-02   -3.463747035491386e-01   +5.340456893187288e-01; +2.005741888762394e-02   +4.281157928803142e-01   +7.605927898726338e-01   +6.485534093315057e-02   -1.910792762978270e-01   +9.498840896779931e-02   +7.831316946297543e-01   +1.010123892059529e-02   +5.662527559184170e-01   +6.558443267597192e-05   -3.122170308094613e-02   +4.615076496443527e-01   +7.983875494732626e-01   +6.135685824834980e-01   -6.640258922068480e-02   +4.990666608281227e-01; +5.962569444506157e-01   +1.011994421714518e-02   +1.736244185542594e-02   +3.713665416218148e-04   +4.026352951008926e-01   -1.787043481808541e-01   +4.161843124048742e-02   +5.596605316549677e-01   +2.561635354527078e-01   +3.976444661676472e-01   +2.493863742858984e-01   +3.673481641988083e-01   +7.382649346493325e-02   -1.848509132845410e-02   +3.110209176581854e-01   -1.073874851225704e-01];
L1E_L1I_iGABA_netcon = [+4.990137305949546e-01   +4.587794289051664e-02   +2.149506067227270e-01   +1.405333998795464e-01   +2.087111394129048e-01   +3.858425972656192e-01   +1.607663421924449e-01   +3.582097983680943e-01   +5.313197849813664e-01   -5.243050029224629e-02   +8.950250240588908e-02   +5.568788415743334e-01   +1.190442910742657e-01   +2.050945202445576e-01   +1.577864544937904e-01   +4.427949957258280e-01; +1.812487123060112e-01   +3.040319459451173e-01   +3.030735202939656e-01   -5.730104359172969e-03   -2.434559355095399e-01   +3.737913616530442e-01   +3.019194256335599e-02   +5.687278513575272e-01   +4.316663435092336e-01   +2.266742189048175e-01   +2.972726923580440e-01   +4.836645432994618e-01   +3.388502460663310e-01   +2.373272789151562e-01   +3.322906447199071e-01   -3.550956733556482e-02; +1.731897301527215e-01   -5.809293838829210e-02   +1.943036418978944e-01   +1.424422113260807e-01   +1.987686879100075e-01   +1.696033883630453e-01   +8.344140396928428e-02   +2.232441232405080e-01   +5.071059959863752e-01   +3.712341572178695e-01   +2.326383300427087e-01   +2.841762073335274e-02   +1.201612581807693e-01   +5.495799958386836e-01   +7.751129363421819e-02   -4.024430133118818e-02; +1.839994074577560e-01   +2.642311845943182e-01   +4.719071954606165e-01   -1.832125970238578e-02   +5.164965047964707e-01   -8.469522917494340e-02   +2.618831484071210e-01   +3.787807994357251e-01   +1.133035494146619e-01   -2.534747121287710e-02   +2.085713625328336e-01   -2.491586637024906e-02   +1.574420539099273e-01   -4.160297089782360e-02   +4.506880743071368e-01   +1.784764888226837e-01; +9.655947207374990e-02   +1.897290893543274e-01   +4.868034276875574e-01   +4.216170411390782e-02   +3.293296385867663e-02   -8.276726649555113e-02   -4.514727229929272e-02   +3.243200512369423e-02   -4.773215345301281e-02   +2.248546898876362e-01   +3.658187828750867e-01   +2.866813147479612e-01   +2.418548941219728e-01   +3.289006837424797e-01   +2.619696182632554e-01   +6.622362784848900e-01; +3.895811765066889e-01   +1.031532704676181e-01   +5.384706399742039e-01   -2.191073828177990e-01   -1.736379636131159e-02   +9.269960261823859e-02   +2.148375570077333e-01   +2.759595391815604e-03   +5.546133658051842e-01   +2.572963006583946e-01   +4.287578476137998e-01   +1.313924483522047e-01   +2.496755609424444e-01   +5.212722734823618e-02   +5.903623244387671e-01   +6.038636420303339e-01; +3.607346236379522e-01   +1.770154706287778e-01   +1.470228795765745e-01   +3.458958805332234e-01   +2.028023795544972e-01   -5.775384011909135e-02   +2.942708999901730e-02   +1.136826003334540e-01   +3.426812037315017e-01   +2.103513876594252e-01   -6.533132924406343e-02   +2.582651861459369e-01   +1.076937113783800e-01   +4.015758408032622e-01   -1.197669471179016e-01   +1.419882025091238e-01; +5.550195678474226e-01   -1.403878882035430e-01   +2.462148669156595e-01   +1.936177220520210e-01   +7.566613844355412e-01   +3.043669025283116e-01   +3.745188279773748e-01   +1.127654403304447e-01   +3.711594088370180e-01   +1.134962597925125e-01   +4.187876819347483e-01   +2.924208222264406e-01   +2.192418202047230e-01   +2.832372074477291e-01   +2.564474324609394e-01   -2.779540692146129e-01; +2.097602257842390e-02   +1.551178986855289e-01   +1.382360603072961e-01   +9.286862512028579e-02   +4.355406070729229e-01   +4.968715873017955e-01   +3.314511933923850e-01   +2.648473081142955e-01   +3.556411028920011e-01   +3.473002896159858e-01   +3.349440179744203e-01   +5.040263083036206e-03   +4.127048081283855e-01   +3.535443582609208e-01   +4.201253279701384e-02   +1.803465128374897e-02; +5.035944159761957e-01   -6.155013969436112e-02   +8.101162475160248e-01   +9.201456756390415e-02   +3.477771046596923e-01   -1.232884802072005e-01   +2.477296360372708e-01   +6.265959083481237e-01   +9.765151945480410e-02   -5.470276840845016e-02   +7.467260276108105e-01   +6.960370021089219e-01   +5.750000284815568e-02   -2.735391054947307e-01   +5.404634047854582e-01   +4.364510403685081e-01; -4.232574534085412e-02   +1.706591506254769e-01   +4.628778145237883e-01   +3.185829999157805e-01   +5.327908398709477e-01   +9.378995395108643e-02   +4.212680570867742e-01   +6.879239336871318e-01   +4.097913090326875e-01   +2.935241740964399e-01   +1.727714111098200e-01   +4.344774610550642e-02   -3.303790744509253e-02   +3.994369744828969e-01   +2.112076460322940e-01   +8.957442848401856e-01; +4.150526771276309e-01   +1.564664549480645e-01   +3.477624958995441e-01   +3.888904775152736e-01   +1.732700091010944e-01   +5.005295029003652e-01   +2.684283626028313e-01   +4.795485644408635e-01   +3.757669069583283e-01   +5.461752143262827e-01   +4.251659752574106e-01   +1.822296562387104e-01   +1.532106126787431e-01   +4.706444311854759e-01   +3.332614316653113e-01   +1.757303111328582e-01; +2.642798445204499e-01   +4.198434152430490e-01   +4.322168180767484e-01   +2.808569004823710e-01   +3.765837459998607e-01   +2.988693231386085e-01   +4.424578342909080e-01   +6.424529088232258e-01   +3.493729323161842e-01   +1.909459567331801e-01   -8.452568232139414e-02   +6.015130074953072e-01   -6.469301446726627e-02   +1.151407673297732e-01   +7.578967924634769e-02   -3.651900606103790e-02; +2.700328854756184e-02   +6.712297164551979e-01   +2.103605581439822e-01   +6.088614620896765e-02   +2.731091616866130e-01   +4.634493793106086e-02   +2.454901781616634e-01   +3.580664828796609e-01   -2.909767090480026e-01   +1.426587386216615e-01   +7.149627870052028e-01   +5.601756294566959e-01   +3.480029160136427e-01   +7.162346165084327e-02   +2.221180051130656e-01   +1.716769582742836e-01; +1.866574470415164e-01   +1.125708499880890e-01   -1.101820435819835e-01   +3.780176574096680e-01   +3.614930952070795e-01   +4.478814667735950e-01   +4.136711963405744e-01   +9.858951340936646e-02   +2.806443012353242e-01   +2.214631901331431e-01   -8.600850030514902e-02   +3.468251914665824e-01   +3.877702823334679e-01   +2.707745004446430e-01   +5.527555541477527e-01   -1.238439824328512e-01; +4.540944254733431e-01   +1.118753490447075e-01   +1.783871397123324e-01   +2.996112513508113e-01   +7.294186501802878e-01   +3.575482917899976e-01   +3.248125764215751e-01   -2.035747156095662e-01   +2.794159540757991e-01   +1.734110626705109e-01   +4.143158018276942e-01   +7.122106204990657e-01   +6.085447619395092e-01   +3.628038015310676e-01   +4.265455170791301e-01   +3.005175357780686e-02];
L2I_L1I_iGABA_netcon = [+6.527709083559002e-01   +5.747111801202593e-01   +3.645681129040149e-01   -3.116731959459683e-01   -4.546564498243325e-03   +1.844628520381376e-01   +2.479561688186139e-01   +2.087976633798346e-01; +1.013103975444418e-01   +4.718111229996855e-01   +3.807048054456791e-01   +2.676620895832027e-01   -6.324020903427674e-02   +5.826887182893644e-01   -3.800784294893925e-01   +1.184465827219619e-01; -3.836112688117234e-02   +5.161668925520982e-01   -4.433330322388935e-01   +3.697066257073512e-01   +2.330860844139993e-01   +2.487215939879564e-01   +2.402538739793849e-01   +4.925569338344211e-01; +6.378799814241645e-01   -1.101267555944069e-01   +1.608380214128222e-01   +3.323942418803805e-02   +2.984516318809584e-01   +1.243943728900989e-01   +4.075181170019051e-01   +1.268789125334410e-01; -7.195604450543117e-02   +1.786515241083874e-01   +2.775279105259739e-01   +3.481028893281065e-01   +6.429945346558230e-01   -2.017332148784857e-01   +4.391138622214411e-01   +7.465830836956747e-02; +6.213213161006619e-02   +2.135602520842354e-01   +3.039347092745716e-01   +3.119272768087147e-01   +3.136189663846071e-01   +2.771574815466716e-02   +2.024333725299850e-02   +6.598741098744747e-01; -1.377863550904151e-01   +3.050710603643028e-01   +2.625747835382223e-01   +3.492818299845977e-01   +3.230096001340741e-01   +2.710437045694378e-01   +2.026526585650122e-01   +2.861273889974772e-01; +4.223896464804704e-01   +6.943850455136781e-02   +2.119164350437943e-01   +5.655116635298348e-01   +5.622250854979836e-01   +2.776154528564885e-01   +3.880497550285492e-01   +1.783794567339009e-01; +6.666212131798518e-01   +2.496572844239080e-01   +5.148978856698626e-01   +2.689847905644239e-01   +5.658559877584707e-01   +2.504894286986873e-01   -1.267633925519885e-01   +2.527200740044966e-01; +5.335323855882661e-01   +3.016979112782354e-01   +9.404548608805519e-02   +4.775079313195799e-01   -8.490491958615028e-02   +5.271506911191265e-01   +4.438148520161130e-01   +6.570536388872046e-01; +3.417559293922036e-01   +2.818883715955012e-01   +5.096201380369797e-01   +2.572147949338689e-01   +5.519929214052280e-01   +5.395124096392010e-01   -2.451337170315841e-02   +2.943586251404320e-01; +3.938061684502867e-01   +3.106075956216149e-01   +5.223869812341846e-01   +1.446435430195644e-01   +5.207254616325637e-01   +1.358193646910936e-01   +1.205531198200150e-01   +3.050917297571115e-01; +3.371254966497740e-01   +8.059886986654895e-01   +4.362551094879000e-01   +2.578894566335124e-01   +2.950437739165201e-03   +1.416083896379228e-01   +1.099140500022239e-01   +3.821489479586025e-01; -5.449485521671153e-02   +3.328383580816636e-01   +7.796544679756682e-01   +2.509393614618506e-01   +2.442759904473518e-01   +2.077256153703862e-01   +1.863433643905048e-01   +3.259037961426992e-01; +2.298394904864919e-01   +4.500485495725289e-01   -2.628975261145804e-02   +1.122349921169574e-02   +2.088130620024188e-01   +7.885225347387327e-02   -1.666435618129653e-01   +2.603561265978317e-01; +2.929491898072731e-01   -1.171867187738016e-01   -2.481092274705254e-01   +7.811779952577584e-02   -2.244060948982020e-01   +1.239267757839325e-01   +2.435381767057933e-01   -1.208983733790333e-01];
L1I_L2I_iGABA_netcon = [+3.503433087448772e-01   +2.504168147446258e-01   -4.699284537533316e-02   -6.410756190322950e-02   +6.534652868133151e-01   +2.804804681355059e-01   +3.067220326166725e-01   +3.279309899591593e-01   +1.140505960314377e-01   -9.486663908728191e-02   +2.087603937050127e-01   +3.897753995386050e-01   +5.687965908158398e-01   +2.846092686338925e-01   +4.611433270455311e-01   +3.387654552117031e-01; +6.577852025359092e-01   +5.134022861224985e-01   +3.960721933790813e-01   +2.229342104244121e-01   +4.279609129983373e-01   +2.958299773632853e-01   +2.459647636494670e-02   +6.389964345027757e-02   +2.386786145969439e-01   +6.093051004964729e-01   +6.978878641166374e-02   +4.014065352350938e-01   +3.868634015455272e-01   +3.416573762157169e-01   +6.106245665538891e-01   -1.030298280481948e-01; +7.660304906398709e-02   +1.183980049464954e-01   +3.523393041120741e-01   +4.059764461037746e-01   +3.647182785234544e-02   +1.063303520685616e-01   +2.278378268837007e-01   +5.110118734895672e-01   +3.014467846240718e-01   +1.798233303321022e-01   +2.631555769067743e-01   +5.746239378687742e-01   +8.047346887865685e-02   +3.184355454896101e-01   -1.523191496095133e-01   +2.813174679263793e-01; +5.792140368644887e-01   +4.016653235023923e-02   -2.436740414997941e-01   +1.966498338508272e-01   +1.297903956080398e-01   +5.830715179086595e-01   +2.394683276064849e-02   +1.442866381992615e-01   +1.088315348159565e-01   +3.518485738120988e-01   +3.780201868257681e-01   +4.662278422033156e-01   +1.729207326973404e-01   +3.110698968582707e-01   -2.235230388501102e-01   +4.071623462246613e-01; +6.991856340677868e-01   +4.671844077133713e-01   +3.135461720449253e-01   +5.384470623919392e-01   +1.074267181293098e-01   -4.179311499440613e-02   +4.993324707503694e-01   -5.546037388692998e-02   +4.354786824740165e-01   +4.749413480912195e-02   +5.468686679699966e-01   +2.181025965705830e-01   +3.224769334921085e-01   +5.289603940570268e-01   +2.870786894696277e-01   +2.772802445865213e-01; +5.773339813387079e-01   +2.514034909257357e-01   +7.074494915302745e-02   -1.772396535697927e-01   +7.314410680617334e-02   +2.080599041492414e-01   +1.574568723154006e-01   +4.648886483634052e-01   +5.447869471824335e-01   +2.204250862898805e-01   +1.433918491098069e-01   +4.358247760671401e-01   +4.790767621562684e-01   +5.022020201519839e-01   +2.232079104205286e-01   +3.631738498777586e-01; -2.380789354368892e-01   +2.425724972137582e-01   +1.755406116411022e-01   +2.122467551258158e-01   +1.471956338000689e-01   +2.250504768101633e-01   +2.571148240502699e-01   -2.880876338454800e-01   +4.436745793603359e-01   +5.162233009229242e-02   +4.693381558091289e-01   +6.179722854110683e-01   +1.048876873100538e-01   +1.664356062102654e-01   +6.642543257225642e-01   +3.373382181489522e-01; +3.103076409312404e-01   +3.665468043627869e-01   +2.138912750512918e-01   +3.867038920389935e-01   +6.035531217910699e-02   -1.913235237217699e-01   +4.523633370611315e-01   +3.210123978465230e-01   +4.679240892440085e-01   +2.616526426372108e-01   +3.507121779501794e-01   -1.000482125868630e-01   +1.361185165321565e-01   +1.707543550950608e-01   +1.193107257883218e-02   +8.285183629371889e-01];
L2E_L1E_iAMPA_netcon = [+5.159763929712458e-01   +4.094182389729678e-01   +2.065406540102621e-01   +5.979804655704066e-02   +3.780571317729278e-01   +5.214526340184822e-01   +2.462886631606612e-02   +2.213520468640904e-01; +2.389090434636142e-02   +5.694929607135953e-01   -2.764361831074924e-01   +9.226718534200019e-03   +4.156962771036690e-01   +3.112715486459616e-01   -3.636130450006476e-02   +3.321846249138127e-01; -4.100806816393733e-02   +6.394771865228537e-01   +5.245339850049715e-01   +3.273156890373055e-01   +1.926043285114548e-01   +7.520637657504403e-01   +2.494543452193146e-03   +2.538013734980468e-01; +2.576120121174854e-01   -1.994803668712092e-01   +2.126294729919384e-01   +7.706664265952403e-01   -1.912195778252966e-01   +2.270410460342023e-02   +1.524499480708841e-01   +3.179532732038929e-01; +2.754197590252855e-01   +3.648335879739280e-01   +2.953630434467002e-01   -1.262937080877871e-01   +3.880471836384889e-01   +4.980396119751567e-01   +2.278936604240142e-02   +1.395332327976339e-01; +4.541887783147189e-01   +9.211319456852701e-02   +2.163423863554668e-01   +4.496564525068664e-01   +2.079420249279140e-01   -1.367632589289405e-01   -3.691685898413452e-02   -9.407682278795447e-03; +1.460931991211683e-01   +4.169711483611249e-01   +1.870812812908979e-01   +5.794778477178125e-01   -9.531828854478258e-03   -1.928562589428663e-02   +2.782853611130846e-01   +9.134097195071201e-01; -3.401774450118802e-02   +2.350000815282574e-01   +2.333997328053872e-01   +2.836473694149927e-01   +1.433150862856679e-01   +6.246510110071928e-01   +6.111717562071516e-01   +2.462533656904236e-01; +1.172071621625137e-01   +2.058245033301661e-01   +1.218986838932102e-01   -7.190888902161796e-02   -4.422122270635509e-01   +4.823903063277346e-01   +3.496550686561810e-01   +3.095918715285260e-01; +4.533493009348704e-02   +1.278566689663423e-01   +3.376416737846238e-02   +4.308531217369009e-01   +2.505324631636030e-01   +4.701781840771629e-02   +3.121291431384942e-01   +5.408611314503030e-01; +1.041579622780195e-01   +3.862350883440943e-01   +6.272155638888743e-02   +7.565585723187125e-01   +2.184584972825501e-01   +5.549895136551140e-01   -3.009788912393396e-02   +2.019871826284510e-01; +1.678507931366100e-01   +1.331184270092395e-01   +2.751388404465537e-01   +3.533346908651742e-01   +1.264634781676398e-01   +2.782105060594772e-01   +4.028214266570351e-01   +2.252264198101501e-01; +7.622281677707507e-02   +6.879205155367669e-01   +3.141920748990425e-01   +3.419442891909223e-01   +4.663011066278567e-01   +3.120791610855375e-01   +1.795541049581020e-01   +4.229415566445554e-01; +4.701573213441793e-02   -2.895093740605545e-01   -3.104437875762202e-02   +1.771163961684767e-01   +3.119301666636163e-01   +1.527265346640090e-01   -1.392225252103459e-01   +3.909668156568882e-01; +5.615866616170857e-01   +5.383967564462323e-01   +2.031447683607482e-01   +1.839202429289413e-01   +4.723534936129006e-01   +5.031164061524633e-01   +5.949463425865963e-01   +2.051131170320826e-01; -1.463201337534096e-01   +2.023491382471737e-01   +2.283801462223492e-01   +2.489265590860563e-01   +1.784593633063923e-01   +3.387288139750622e-01   -3.111035133524119e-02   +4.790734774754790e-01];
L1E_L2E_iAMPA_netcon = [+2.953573797573703e-01   +1.947239754265990e-01   +2.986747362749380e-01   +3.889750667444877e-02   +2.568328087591052e-01   +8.867647521487657e-01   +3.926003990047818e-01   -1.678101791877596e-01   +2.299586799094662e-01   +1.151530225281996e-01   +3.568884581572609e-01   -4.964653575654737e-02   +4.121085047861074e-01   +1.072763950174238e-01   -4.616231815214760e-02   +3.547557657566153e-01; -2.201230028964676e-01   +3.422438469073935e-01   +3.854058513057422e-01   +6.520598169581412e-01   +4.387999539882182e-01   +3.024816254945532e-01   +8.016067285614965e-02   +2.870839563572690e-01   +2.974877627522189e-01   +7.594183725856580e-01   +1.342376396975108e-01   +3.652440751576737e-01   +2.081493755414854e-01   +3.286692534194562e-01   +1.617080244687709e-01   +1.794221789102406e-01; -3.104968249687746e-01   +3.891907858904816e-01   +4.342717758632441e-02   -2.508110874991251e-01   +3.912056873616748e-01   +4.324378197463846e-01   +1.886241659839282e-01   +6.552964006928266e-01   +1.526392793005221e-01   +1.611650566687680e-01   -2.882857052806580e-02   +4.374079761413978e-01   +2.906808726653380e-01   +1.375742405022402e-01   +4.200684410328779e-02   +4.038196658748758e-01; +1.747703287369776e-01   +4.812889290464236e-01   +4.247500622284173e-01   -5.954744731095599e-03   +2.383322826326209e-01   -7.039678509772772e-02   -2.394564615129932e-01   +5.363280688083208e-01   +2.157471039182708e-01   +8.506065119510792e-02   +4.080965387373782e-01   -3.926127896316331e-01   +9.544701915041934e-03   +6.598651715650699e-01   +5.430506995729847e-01   +2.900820996532202e-01; +2.517558549764565e-01   -1.388039326084725e-01   +2.986696142979241e-01   +5.994434160009651e-02   +2.506502117466237e-01   +2.928688837477635e-03   +8.438780000228838e-01   +1.134267395960176e-01   -1.587722390511017e-01   +4.835372883825321e-01   +2.424226411898837e-01   +3.348599754406113e-01   -1.349885963114511e-01   +1.065996684874494e-01   +2.027634148981822e-01   +4.602827305460849e-01; -1.287010279972772e-01   +6.464596265944288e-01   -1.089899720517812e-01   +3.104772868189796e-01   +6.239930858916638e-02   +2.232170179919687e-01   +4.035418678464594e-01   +2.673642999235802e-01   +2.872193035386115e-01   +2.020307937575420e-01   +2.604931494742839e-02   +1.722179896830221e-01   +2.463354176756894e-01   -2.772715694212791e-02   +3.235375873407764e-01   +5.415936108238326e-01; -2.624660168079947e-02   +1.284348380644987e-01   +6.957762987625375e-01   +1.683753532930929e-01   -3.103409475798604e-01   +6.278456358018962e-01   +1.016483902009717e-02   +5.106734454640275e-01   +7.705205374818701e-01   +3.732927785277231e-01   -2.016072645166846e-02   +2.539737043733283e-01   +3.377624657297775e-01   +3.970510392948911e-01   +2.409904938476629e-01   +2.286354623048716e-01; +6.650317651707750e-01   +4.430107965943921e-01   +1.238638183805159e-01   +1.269193315001710e-01   +6.467776727339808e-01   +1.716879131671666e-01   -2.151666661542498e-02   +1.543209167767607e-01   -1.425936179091029e-01   +2.107701503297592e-01   +2.546224019030267e-02   +3.108206207692538e-01   +2.616410743113725e-01   -4.164202006150541e-02   +4.342774716211243e-01   +4.404643172093259e-01];
L2I_L2E_iAMPA_netcon = [+3.894726351131865e-01   +1.688781814086713e-01   +3.705906304750117e-02   -5.039858067829485e-02   +1.562672753730132e-01   +2.827901007326399e-01   +3.922657289984878e-01   -4.420872877629499e-02; +2.118929665294118e-01   +3.041894222510113e-01   +4.615623614845183e-01   +3.470874111889883e-01   +3.636726353227352e-01   +3.663201230395599e-01   +4.739214554534164e-01   +1.335768144450825e-01; +2.702700269793571e-01   +4.717713938951897e-01   +2.604817891488021e-01   +1.881892048222799e-01   +3.531795769070994e-01   -1.580294192849355e-01   +4.109429425478588e-01   +3.814145574511067e-02; +1.441836970375596e-01   +4.654865582890034e-01   +2.277119988002005e-01   +1.065583999763205e-01   +4.539763033127100e-02   +1.615163016704411e-01   +3.568302063767799e-01   +2.551414624828938e-01; +1.288710544990326e-01   -7.130239559554248e-02   +2.638338502370842e-01   +1.069861085734279e-01   +6.863961199434088e-01   +1.604587973580604e-01   -2.279207176146371e-02   +3.052090291506208e-01; +5.706594146273481e-01   +2.884333670215171e-01   +4.210539972104518e-01   +2.458903511195698e-01   -1.597051856057675e-01   +4.895910035333931e-02   -8.276670792888631e-02   +7.622682091807179e-01; -6.538579425031864e-02   +2.598622331339555e-01   +6.355767358527250e-01   +4.481587414692271e-01   +5.555841018003267e-01   +5.631763025428952e-01   +5.457294795119132e-01   +1.309932666600655e-01; +5.378916419240944e-01   +1.259408684216770e-01   +4.630386823564711e-01   +7.341232342217532e-02   +6.892599641694906e-02   +9.203465567844961e-02   +5.691139996150281e-01   +4.102643986362229e-01];
L2E_L2I_iGABA_netcon = [+2.337611715111349e-01   +2.633382539277633e-01   -1.223247461550803e-01   +7.224289428256804e-02   -4.907231543726530e-02   +1.150015497585822e-01   +4.021615270409844e-02   +1.417280492161322e-01; +4.862927739786712e-01   +3.291915802911444e-02   -7.269061588963599e-02   +1.865740587359910e-01   +5.674707463847106e-01   +2.297255577546317e-01   +3.250145761808385e-01   -2.762343633697303e-03; +2.833420355525725e-02   +4.396763936927116e-01   +4.770505206886070e-01   +3.247638514271033e-01   +4.110206957299131e-01   +2.218394693075134e-01   +3.253570022349820e-01   +4.220136156916077e-01; +4.191736933751951e-01   +1.829318249256792e-01   +4.007542787821155e-02   +7.787927955658015e-02   +4.912108023799993e-01   +6.136088767938229e-01   +5.821135460722939e-01   +3.463707390155568e-01; +2.836273772034653e-01   +3.773538881818086e-02   +6.022672627498550e-02   +2.998985395362230e-01   -8.330366535243036e-02   -1.133904025936285e-01   +9.923411023277526e-03   +5.127088815772390e-01; +3.611700993058859e-01   +1.768956739866759e-01   +2.165439014613739e-01   +4.802756284602190e-01   +1.811685206487736e-02   +3.285514517087476e-01   +3.782663985644908e-01   +1.541261836317638e-01; +2.355719181180190e-01   +6.003605930220631e-02   +2.839825428151884e-01   +3.058662564622807e-01   +2.310942035104715e-01   +6.316432747306444e-01   +1.271954262370082e-01   +2.687623749772303e-03; +6.819399654499674e-02   +2.840576220646353e-01   +6.029767675785536e-01   +4.816358732704895e-02   +5.465375393028487e-01   +2.946142511487303e-01   +3.771548131284163e-01   +5.138339213776937e-01];
L3E_L2E_iAMPA_netcon = [+2.207328160266376e-01   +2.470058269936590e-01   +5.246215989694942e-01   +7.243126194062255e-04   -3.065525285580058e-01   +1.356791086168648e-01   +2.454117564659701e-01   +4.323666815785435e-01   +2.369924403140506e-01   -3.351329860115843e-01   +1.424612983129443e-01   +4.287178251767383e-01; +4.790078077955731e-01   +3.648364070478692e-01   +3.171649857205874e-01   +3.697304328696375e-01   +3.953810079260275e-01   -1.466056282980873e-01   +5.127285230802884e-02   +1.847411504473945e-01   +6.131908299661949e-01   -2.626337753090700e-02   +4.274401975495298e-01   +1.437974697342000e-02; +5.281757079303241e-01   -5.447813477319914e-02   +6.070796098762036e-02   +3.473365324178881e-01   +6.065253608004944e-02   +4.504062953299654e-01   +2.168786963869017e-01   +2.368120823859280e-01   +2.674259577307575e-01   +5.288670350328011e-01   +1.940011914183230e-01   +1.954173521979322e-01; -1.292809786135061e-01   +7.843935658898196e-02   -1.292806476795967e-01   +6.505718779800193e-01   +6.179249565450720e-01   +4.292732292092206e-01   +2.426316167238685e-01   +4.947281043211107e-01   +1.481173013625931e-01   +4.286903633220945e-01   +3.361344987056545e-01   +3.799293187797051e-04; +5.520227439670069e-01   +3.939499864502649e-01   +2.213404006255356e-01   +5.179330519035292e-01   +7.799833542835583e-02   +4.030370561514897e-01   +2.467109817104308e-01   +7.751012903670269e-02   +2.560265368614163e-01   +1.586748905961656e-01   +1.201721436566161e-01   +5.383120037768599e-01; +7.398079707001045e-01   -1.302054519226387e-01   -3.868037811836039e-02   +4.889600326405910e-01   +4.691433531038594e-01   +4.426495708592025e-01   +1.517548113797057e-01   +2.043013905468347e-02   +4.711663536497971e-01   +3.735724527353285e-01   +1.234314538673379e-01   -8.621150469989285e-02; +2.685651659905292e-02   -7.631655493741814e-02   +2.613721790128840e-01   +4.849936363001783e-01   +4.024291663687379e-01   -6.011417126378468e-03   +4.859176003048110e-01   -1.061895455394850e-01   +4.151322339485111e-01   +1.700727420417342e-01   +1.885111600388107e-01   +3.091796195853536e-01; +2.654958835920066e-01   +5.924458762709024e-01   +6.484343710011531e-01   +2.727544330860526e-01   -7.833729682665336e-02   +1.992283128123943e-01   +4.182027824383897e-01   +3.604396380135623e-01   +6.593824893974175e-01   -2.830237862601414e-01   +7.524638059010821e-01   +1.559961316647273e-01];
L3I_L2I_iGABA_netcon = [-3.568485291791278e-01   +4.101612010581753e-01   -1.279770855281569e-01   +2.779133912957593e-01   +1.222013437236132e-01   +2.015590686296482e-01   +6.647574108493742e-01   +2.209647318653805e-01   +7.498696934798044e-02   +8.233930805503262e-02   +3.037226052267209e-01   +1.468659554972783e-01; +3.987887703721537e-01   -5.239908807814636e-02   +1.819051571570476e-01   +5.921639397313763e-01   +1.766196149321875e-01   +2.222945933755986e-01   +4.398435064801239e-01   +4.264790832807668e-01   +2.413401856234557e-01   -5.270456270314718e-02   +5.672946219840911e-01   +3.709724894769841e-01; +3.001288444356333e-01   +1.609767313838990e-01   -2.022309699944060e-02   +5.191226631741792e-01   +4.882405199406057e-01   +3.302341081512058e-01   +2.434380958431959e-01   +2.743826853036976e-01   +7.578618151073324e-02   +2.097405771455677e-01   +6.184746731841104e-01   +3.057042777901804e-01; +4.420409096873362e-01   +1.175371261905940e-01   +5.707501879152279e-01   +7.392150280385326e-02   +2.778704928171393e-01   -4.158711865426026e-02   -1.238842129485691e-02   -1.777072682394844e-01   +2.904369637947851e-01   +2.812035961191170e-01   +2.800409108501172e-01   +2.114477635129941e-01; +5.437463516670009e-01   +4.717357848176590e-01   +3.986929011677738e-01   -1.841712231265839e-01   +2.440296315464754e-01   +1.584138624735554e-02   +6.514574693285843e-02   -4.844615528951714e-02   +5.835678683670358e-01   +3.677436934107716e-01   +6.017147415987715e-01   +1.094955972891320e-01; +5.212175968553417e-01   +5.229347555564917e-01   -1.111056086106455e-01   +1.998296073279637e-01   +3.061608361999583e-01   +7.328576323641116e-01   +1.484109442181969e-02   +1.465302419707552e-01   +3.033282975194558e-01   -1.052438794597465e-01   +1.891997374005980e-01   +3.625460905882220e-01; +4.824466382280511e-01   -1.083056509556770e-01   -1.712758513882187e-01   +3.602239266182087e-01   +5.023847788165878e-01   +8.790547249508726e-02   +3.363699343419891e-01   +3.029089526898053e-01   -4.613758546904272e-02   +3.514880307565645e-01   +3.644541511680670e-01   +4.174740961085017e-01; +3.135255338405393e-01   +3.544624054770033e-01   +2.415854848597831e-01   +2.093538363778902e-01   +6.108041106598010e-02   +4.181037069522459e-01   -1.346073007129729e-01   -5.139335053634267e-02   +7.649892920059677e-02   +6.153097702836134e-01   +5.542919715083681e-01   +2.621148126756195e-01];
L2E_L3E_iAMPA_netcon = [+5.837639784565952e-01   -1.246200169739832e-01   +1.170821248222943e-01   -1.545456530695598e-01   -1.138831788077381e-01   +2.551420948273375e-01   +2.926599714275134e-01   +1.631234461186214e-01; -1.382782005900353e-01   +1.928250362470257e-01   -2.439948957674055e-02   +4.539168718685553e-01   +5.227026427703985e-01   +3.260424821910252e-01   +6.358040757573789e-01   +2.255827983813804e-01; +2.147588246025899e-02   +2.299451831594930e-02   +4.727204627462592e-01   -1.387800164436041e-01   +3.876160628609447e-01   +4.211432132765868e-01   +1.213097431084218e-01   +3.856273742492244e-01; +4.371323556572009e-01   +2.451670434518239e-01   +2.598600271552993e-01   +5.129217355816162e-01   +4.391236773799221e-01   +1.851817913473586e-01   +9.389038085955009e-02   -1.261982217435502e-01; +2.494065854970882e-01   +2.551689334120791e-01   +7.370556012300097e-01   +5.526143657387408e-01   -3.540022455728276e-01   -1.572290444027284e-03   -3.198899317435569e-03   +4.642815614106314e-01; +8.527378474580843e-02   +4.407268856450605e-01   +3.440289767816554e-01   +4.765103357809484e-01   +5.289987760482384e-01   +4.380449977203591e-01   +1.880228302209346e-01   -1.576792047455199e-01; -1.678759852475580e-01   +2.272442049981842e-01   +3.968850479653196e-01   +3.994970265618853e-01   +2.442999486801967e-01   -8.066608674925527e-02   +1.788497247710144e-01   +3.707611091286711e-01; +3.517593382112312e-01   +2.975343642735416e-01   +7.941086511231763e-01   -2.103535916325477e-01   +2.478250257767181e-01   +5.656543378007012e-02   -1.419724802107953e-01   +3.494807402286291e-01; +3.026618426628264e-01   -2.651273328306373e-01   +8.711628443458484e-02   +1.671161733098769e-01   +1.829252422465164e-01   +1.430248741883672e-01   +1.117855820220417e-01   -2.820677902306416e-02; +4.065927104294847e-01   +6.463218217347702e-01   +2.897496390118062e-01   +2.350271630278424e-01   +3.844756076274968e-01   +4.116966043347616e-01   +4.880624111237740e-01   +1.677600846955141e-02; +3.460431905714071e-01   +1.302562745405322e-01   +3.919063167993991e-01   +5.182615791580623e-01   -1.197110019568458e-01   +7.116788707064745e-01   +1.449840682741410e-01   +2.928063377779897e-01; +1.129561474972326e-01   +6.376861427717176e-02   +7.067538099924743e-01   +2.035398549158933e-01   +3.890751396201024e-01   +5.473666722459292e-02   -1.996489407032017e-01   +4.737851525442389e-01];
L2I_L3I_iGABA_netcon = [+3.072269929445464e-01   +2.309615453483136e-01   +3.698035581447051e-01   +3.049176776608152e-01   +1.881561145188137e-01   -8.286783177045762e-02   +1.772496161381233e-01   +6.101192418953545e-01; +4.932694400238858e-02   -2.093721577417411e-01   -4.737186393950476e-02   +3.732745860375456e-01   +3.553677481580729e-01   +4.194468751328949e-01   -5.750209481216322e-02   +4.216034257821151e-01; +3.685745392215478e-01   -3.219715882286578e-02   +8.574806066421613e-02   +3.374652421915344e-01   +5.505073271809567e-01   +3.253622935650447e-01   +7.993041608563559e-01   +1.167392270045894e-01; +3.412107495423187e-02   +2.159561934237023e-01   +2.435421662124357e-01   +2.898914947693813e-01   +1.666198427499030e-03   +2.792113714061558e-01   +5.295343658845660e-01   -4.702389261128642e-02; +4.292204633276855e-01   +2.065236018910781e-01   +5.505011170257101e-01   +2.488207257958862e-01   +6.188031774137803e-01   +1.871253608659913e-01   +4.203859072548440e-01   +1.220148902837933e-02; +5.068493371432568e-02   -1.928501503910325e-01   +4.145882640928613e-01   -8.708555030217141e-02   +3.593833797596577e-01   +2.749537626496620e-01   +5.196667480608934e-01   +4.358013633747607e-01; +2.564179740639624e-01   +4.220016609872744e-02   +2.530984007145436e-01   +2.999315795670497e-02   +9.744192345242014e-02   +2.716518636134030e-01   -3.409792206668746e-03   +2.978789364050000e-01; +3.255940998131499e-01   +6.638438276813765e-01   -8.038223329245593e-02   +3.965300007579682e-01   +3.868826898269916e-01   +2.199540251601627e-01   +4.486019945378892e-01   +4.400822085779930e-01; +1.472609698142758e-01   -3.108844736656049e-02   +7.883725012307231e-02   +4.338982445209171e-01   +7.040653445101204e-02   +4.425827365104244e-02   +4.249615486987654e-01   +1.088837496531606e-01; +3.086163639523569e-01   +3.386061054060130e-01   +8.936572475344514e-01   +6.140660432039154e-01   +4.183192641396536e-01   +4.914467254383521e-02   +4.205622451411059e-01   +4.244433542299077e-01; +4.436399808466986e-01   +3.305957749666532e-01   +1.519230939818269e-01   +5.183525254710374e-01   +5.424980252221413e-01   +3.320549636750396e-02   +3.391768448185975e-01   +4.325487645159951e-01; +1.699073403335872e-01   -7.322960994601758e-02   +1.918614637114867e-02   +3.350878775968906e-01   +2.394001454056946e-02   +4.003920087139840e-01   +3.260048794400605e-01   +4.213376065176807e-01];
L3I_L3E_iAMPA_netcon = [+2.174649382661097e-01   +5.936939624318817e-02   +7.261948045386568e-01   +2.884727282902469e-01   +3.000137376367207e-02   +3.629119770950430e-01   +1.126952649893005e-01   +5.288251852886837e-02   +1.769692090121951e-01   +3.809838934914878e-01   +5.803350495151195e-01   +2.751165284315431e-01; +7.235372040929577e-01   -2.104974276738140e-01   +4.154859856142821e-01   +8.726951875288994e-01   +9.234455350478146e-02   +1.057105042949614e-01   +6.134616697521289e-01   +7.720423857840182e-01   +3.774473084717674e-01   +1.145382062634992e-01   +2.675726067339010e-01   -1.306112006177766e-02; +7.528962162484054e-01   +4.036927022347705e-01   -1.010963411192657e-01   +2.203340091504527e-01   +2.602776967613191e-01   +5.047028297209849e-01   +1.190865894968981e-01   +1.787851783669952e-01   +3.464128914174448e-01   -1.171398575214944e-01   +4.954914254752893e-01   +4.212740715953235e-01; +3.224926901278643e-01   +8.466703955021497e-02   +3.562394221588979e-01   +2.175670895704972e-01   +4.132975024199012e-01   +3.494691542265621e-01   +6.043027722620961e-01   +2.856236636369762e-01   +4.489147630962103e-01   -2.636330295686653e-01   +7.604055107611210e-02   +2.354376322457036e-01; +5.438000755575696e-01   +2.378998403602302e-01   +4.583835773479536e-01   +3.156515372467137e-01   +1.570878433428774e-01   +5.336529884174722e-01   +1.493969151406961e-01   +2.217493391528054e-01   +5.474477796522419e-01   +6.234413130072245e-01   +3.080985193522940e-01   +7.148598075962860e-01; +3.726129959670369e-01   +1.391911074447852e-01   +3.206316370588150e-01   +1.298902217617359e-01   +6.276694659903000e-01   -4.725120979937780e-02   +3.159837025001516e-01   +1.003089042692198e-01   +3.122692338314689e-02   +2.367344078059876e-01   +3.239659904165511e-01   +2.824777017790511e-01; +1.679104240349945e-01   -1.218739070758044e-01   -3.272137595641178e-02   +3.461364800289002e-01   -2.028154358896237e-01   +1.444252665404528e-01   +3.053069294491666e-01   +5.508886776250459e-01   +8.880025093962782e-02   +1.750797645299139e-01   +5.718905585291849e-01   +3.431284228480226e-01; +2.471522213073488e-01   +2.567955006025525e-01   +2.868652225942100e-01   -1.832356173035214e-01   +3.109386928030830e-01   +7.276572849925865e-01   +1.999256120407928e-01   +3.134672375395995e-01   +2.771460069100371e-01   -5.200472096129725e-02   +1.585965451124745e-02   +4.504563237729779e-01; +3.106531318320561e-01   +3.413494635231641e-01   +2.596517623355516e-03   +2.325851290411075e-01   -2.153087458253709e-02   +2.641881700601304e-01   +5.807422653457992e-01   -1.074072764410019e-01   -1.697622665802694e-01   +1.243648407567438e-02   +5.254850986646498e-01   +4.014077106562675e-02; +4.988687873392887e-01   +3.465106827377458e-01   +3.940324532527633e-01   +2.640340388698438e-01   -1.163453727094641e-01   +3.296433727722609e-02   +5.802191822649218e-01   -2.060108143602318e-01   +2.219731686168583e-02   +5.104831179994359e-01   +3.332231840293771e-01   -2.516396560079567e-02; +4.852762317715534e-01   +3.775094665377379e-01   -8.378997381052709e-03   +3.163193693788910e-01   +1.064309001452401e-01   +2.110511527438939e-01   +1.309274718844226e-02   +6.378217067206261e-01   +2.926207301089392e-01   +2.186142268955063e-01   +2.369247411357035e-02   +3.201022740024752e-01; +9.178499191091266e-02   +1.969639774699048e-01   -3.138570397363874e-02   +2.628937477444415e-01   +2.435007907081075e-01   +7.396153120620981e-01   +3.236162939928221e-01   +3.703045096936318e-01   -1.229301776850865e-01   +2.516163624672302e-01   -1.434890831697277e-01   +6.197183470021903e-01];
L3E_L3I_iGABA_netcon = [+1.835188194442594e-01   +3.072030809528376e-01   -1.237675986489523e-03   -2.350931202041068e-01   +2.448974570808124e-01   -4.647497028417005e-03   +7.286152131259032e-01   +1.348360197337077e-01   +2.056688554381204e-01   +2.010944151081214e-01   +5.006610181290829e-01   +2.823380851725262e-01; +2.406736608771481e-01   +4.585615471945788e-01   +3.277715325584434e-01   +5.011214248012272e-01   -1.053934781429693e-01   +4.430097714266296e-02   +5.174311259699729e-01   +1.321224678375367e-01   -9.188914281128976e-02   +2.533552685223225e-01   +1.387893432666140e-01   +1.339415379467096e-01; +7.756487054347380e-02   +2.399178107178182e-01   +5.894243173557993e-01   +2.173240176072411e-01   +4.493283296586318e-01   +1.173713424278564e-01   +7.114786486655346e-01   +4.540636254172398e-01   +8.701813439965099e-02   +1.008412539997360e-02   +3.315809694917240e-01   +1.700806914511642e-01; -5.993994375105626e-02   +1.106253844797305e-02   +5.673385942854035e-02   +2.899810108511663e-01   +2.987957171288808e-02   -5.909277267253826e-02   +5.087083419270972e-01   +4.164979481452920e-01   +5.338331799559654e-01   +1.644903894712234e-01   +2.786992128299683e-01   +1.852014610362537e-01; +6.705988496242284e-01   +5.701002861581397e-01   +6.515209436303031e-02   -1.478320921613903e-01   +6.239375486447064e-02   +2.753816980709044e-01   +6.593316038795863e-01   +1.032361223107822e-02   +1.362583601001475e-01   +1.654782036973435e-01   -1.112349670022291e-01   +1.683490421834424e-03; +4.725866409381572e-01   -3.683542954572974e-01   +1.233989643021687e-01   +1.115311335545877e-01   +2.670509281694976e-01   +6.336899571845657e-02   -2.467517892649359e-01   +2.786218145434550e-01   +2.191724861475762e-01   +6.861883416661401e-01   -2.688005949461854e-01   +5.284749010626079e-01; +5.330241939900654e-01   -3.411941535383935e-02   +5.663508933329288e-01   +2.116982401836882e-01   +5.851434970006227e-02   +1.377566931615146e-01   +2.270884724416266e-01   +5.587849082721571e-01   +5.250413124989774e-02   +6.606258996336200e-01   -1.445868045771395e-02   -1.748447826073966e-01; -3.128227237662174e-01   +1.173817027681452e-01   +4.005409068468236e-01   +4.825620100684461e-01   +4.054722589916233e-01   +2.813500292198841e-01   +6.902216978519456e-01   +9.052771658453351e-02   -1.158115335334316e-01   +5.958097350058281e-02   +8.292873085841712e-02   +5.042128260026149e-01; +6.749413933475295e-01   +7.706849513698084e-02   +4.399792427877887e-01   +4.790261337062336e-01   +1.659581390586483e-01   +2.575681346073803e-01   +1.342665873415660e-01   +5.445097866196913e-01   -1.202154993274642e-01   +2.018000838522196e-01   +1.125807273801556e-01   +3.221523417134878e-01; -2.540535326032920e-02   -6.616722977089380e-02   +4.170274883557741e-01   +4.439489686887654e-01   +1.867224837940783e-01   -1.984149174834925e-02   -6.698883243560075e-02   +5.505770489453631e-01   -8.840187776509591e-02   +2.842068491148990e-01   +1.789794247901855e-01   +3.436049992549025e-01; +5.106762275414587e-01   +3.437133464874040e-01   +2.816778031692154e-01   +4.968809240510406e-01   +3.364678793392469e-01   +2.030302188633797e-01   +3.412055461971921e-01   +2.776559085623235e-01   +3.101986246770110e-01   -1.437302512807772e-01   +3.852840640712729e-01   +6.400760775957481e-01; +5.562640188492528e-01   +4.292666010797962e-01   +5.888507092109115e-01   -2.804122656433958e-02   -9.425341421828054e-02   +3.127540623543663e-01   +2.222963429167853e-01   +2.173339691882875e-01   +1.352222960714852e-01   +5.556080998934090e-01   +5.045449733547331e-01   +1.564081156338677e-02];
L2E_Input1_iAMPA_netcon = [+1.022696249837329e-01   +1.457189945948050e-01   +4.001513257071314e-01   -1.806181160596159e-02   +6.474738487680347e-01   +1.926155780459196e-01   +8.255251209566816e-01   +2.611842238232469e-01];
L2I_Input2_iAMPA_netcon = [+2.670627617104823e-01   +5.841842404860225e-01   +6.084298766223634e-01   +2.119483168850859e-01   +5.279125276271467e-01   +6.757223417121232e-02   +6.447065177143410e-02   +2.011066345854574e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.03*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.15*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.15*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.03*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.15*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.15*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 60*((exp(-10*((t)-( 50))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 60*((exp(-10*((t)-( 50))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
