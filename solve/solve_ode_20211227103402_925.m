function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+1.787939164068487e-01   +3.855602001804000e-02   -2.829786347759448e-02   -2.599413356534073e-02   +7.314761491603247e-02   +2.659315576445930e-02   -1.406156372018321e-01   -2.379731887815522e-01   +7.850654886194797e-02   -2.037090846746027e-01   -5.316071193834560e-02   -1.214482230391057e-02   -6.400069719121930e-02   +1.102853469588253e-01   -3.457557275963085e-01   +3.077041288897144e-02; +4.753956601687942e-02   +1.250592601662695e-01   -2.596197664254160e-01   +4.510677484937770e-02   +1.172598431279611e-01   +2.078848055997352e-02   -2.728087196215702e-01   -5.963465871662348e-02   +1.006090768534211e-01   -3.008956566166048e-01   -2.105564741711559e-01   +7.275806673049454e-02   +1.055903215027125e-02   +2.630815926808349e-02   -2.855832146882944e-02   +1.484171323851025e-01; +1.055157796833781e-01   +3.306569220676099e-01   +3.738869960988342e-02   -8.310686570353670e-02   -1.405952682377474e-02   -9.892236195117567e-02   +4.325926398693996e-02   +7.100664161818032e-02   -2.727994678188009e-01   +6.104245736088106e-02   +1.733526979991191e-01   -2.136035686578436e-02   -3.322553688643475e-01   -6.385839227226894e-02   +3.369212251785245e-02   -1.536142738465597e-01; -2.411359624329256e-01   -3.263092826932516e-02   -1.081637648473814e-01   +1.686325714135754e-01   +2.593192586208413e-01   +2.583777082165730e-01   -9.745785979278626e-02   +2.909061043871092e-02   -5.038974712565041e-02   -2.959115107377062e-02   -1.726146003568340e-01   +1.283212209366557e-01   +2.775596460096455e-02   +1.369922727390073e-01   +9.257868569237318e-02   +9.753400412706024e-02; +1.027799414288156e-01   +1.213418207846535e-01   -3.659905324590083e-02   +6.903791918514750e-02   +1.454213146109109e-02   +1.504766265566104e-01   -1.017678407131166e-01   +1.816699850089872e-01   -1.353758436030650e-01   +3.371756377914750e-01   +6.628207409518125e-03   +2.720212169998841e-01   +9.994099634646952e-03   +2.094548437456368e-01   +7.271243043889378e-02   +1.692529577915426e-01; +2.125166825520064e-01   -1.597503742426299e-01   -2.509821497108951e-01   +3.602924986376188e-02   +3.312805672192143e-01   -9.409933970881318e-02   -7.225444877546042e-02   +2.361506760028239e-01   +1.239178223795698e-01   +1.147817952992791e-01   -4.017620631357209e-01   -4.286645027532525e-02   +1.334414574492204e-01   +6.466830786838249e-02   -3.056789737944932e-01   +3.303512769742434e-03; -1.308281796500609e-01   +5.620041739196317e-03   -2.909329349411846e-01   -4.694414763711854e-02   -1.486165627154392e-01   -8.016283106202848e-02   -1.753205917454909e-01   +6.968497281355855e-02   +1.512763709771693e-01   +1.848810709490442e-02   -7.629215407011235e-02   +3.006468950873780e-01   -5.275325839730970e-02   -9.718393722646855e-02   +2.429138985746959e-01   -1.100381155593895e-01; +3.106511759734972e-01   -1.087112705666876e-01   -7.294213606754645e-02   +1.031200119594464e-01   +1.258378909741459e-01   -3.747241973078384e-02   -2.292470735203804e-01   +2.494976045565583e-02   +3.550908083807693e-02   -1.482871517158188e-01   +9.396288089567366e-02   +2.052901599801985e-01   -9.416986657068625e-02   +3.312405645953516e-01   -1.058959646065789e-01   +5.149125046687489e-02; +1.072178324202893e-01   +6.272238552552040e-02   -3.521143239516709e-02   +4.777317317914055e-02   -2.924643911395097e-01   -1.463014767614721e-01   -1.501910964693753e-01   -6.164253762742510e-02   +1.357345762355564e-01   -3.826315689616968e-01   -2.911370984602125e-02   -9.551526767575932e-02   -1.237938100094723e-01   +3.287522679471572e-02   +7.520353440489763e-02   +1.325448470716438e-01; -5.300628299634609e-02   -1.509344190561056e-01   +1.049365714287357e-01   +1.656131875123741e-01   +4.519253804765248e-02   -7.588557057354596e-02   +8.792855007697645e-02   -4.130351897921733e-01   +2.954811649663502e-03   +2.278830227631943e-02   -1.710690942781322e-01   +7.961114904670377e-02   +4.001006388857406e-02   -7.132898051279069e-02   -4.804706933256152e-02   +5.152780553700285e-02; +2.651784086987190e-02   +8.118284603014150e-02   -3.954980680668018e-01   -9.889720515405168e-02   -3.784182881865900e-02   +1.601160817764417e-01   -1.415147703940105e-01   +6.064759444195411e-02   -3.172509586546007e-01   -6.996521510779695e-03   -1.435575170993737e-02   -5.684260197154237e-02   +6.652645432664617e-02   +5.394747233465583e-02   -1.535229988477829e-01   +2.035155409240409e-02; -2.152204777160048e-01   -4.742467521902122e-02   -4.327409879420881e-03   -1.471805684519629e-01   -1.568917635657240e-01   +1.410507569101197e-01   -3.864348121887570e-02   +1.067521234173985e-01   -7.989389108548960e-02   +3.098765932793673e-01   -1.340429224361274e-01   -2.148631790841299e-01   -1.172156697716126e-01   +8.980460695554249e-02   +7.057273795302213e-02   -6.976137939718988e-02; -1.293721026286327e-01   -1.518119471984267e-01   -1.439020038335625e-01   +4.888713392655289e-02   +1.872805568456764e-02   -3.885950365255224e-02   -2.546870730155855e-01   +4.600696328997712e-02   +5.961523294837383e-02   -3.017629911941549e-01   -1.201462159042545e-01   -1.959261190124121e-01   -1.872817605406745e-02   -4.019146037483443e-02   -5.941041046670120e-02   +1.654372380931645e-01; +4.203459283955434e-01   +1.773559789558846e-01   -1.881321581161846e-01   -1.715609851525561e-01   +1.184185075699745e-01   -2.749686879917139e-01   -6.940921959789204e-02   +2.764964352346736e-01   -7.778821110158965e-02   -1.858019408520557e-01   +4.538571087449752e-02   -2.416148693125149e-01   +2.198612727332367e-02   -2.017294767334894e-01   -1.470796277971764e-01   -1.404619229826372e-01; +1.183982250255101e-01   +1.060509883043791e-01   +3.382962759675995e-02   +2.771538403708571e-02   -1.939942816198316e-01   +2.218370050817938e-01   -2.282898133148471e-01   -1.500417254713370e-01   +8.298598927016919e-02   +3.272557788851572e-01   +5.498494256685300e-02   -1.470615288720312e-01   +8.685735815310312e-03   -3.224524736452251e-02   -2.012897741065708e-01   -1.444896551068275e-01; +2.013144171201243e-01   +2.337811865487392e-01   -2.318698177208951e-01   -2.359829567169801e-01   +6.024019039506761e-03   -1.341821733278620e-01   +6.318608269571205e-02   +3.410068461618224e-01   +3.047697612428254e-02   +1.255531817444944e-02   +1.055175486238230e-01   +5.899400728334444e-03   -1.074697208394641e-01   +5.802258509936297e-02   -1.507269676458277e-03   +2.076805865639603e-03];
L1E_L1I_iGABA_netcon = [-5.369186210778815e-02   -7.848641735657240e-02   +4.144819504778735e-02   -2.254742465300420e-01   -1.565628294218403e-02   -7.123940555420606e-02   -1.288020366869064e-02   -3.476442907933702e-01   -4.266153960049746e-02   +7.684433675074578e-02   +1.655886970376581e-01   -1.077846230289180e-02   -7.057057844288062e-03   +1.447935329892584e-02   +5.895186087177666e-02   +8.533776005286869e-02; +2.158658756694941e-01   +6.787520922331459e-04   +3.297220717088432e-01   +1.794197382602152e-01   -1.959300558120601e-01   -2.357259724991923e-01   +7.039741784498644e-03   +1.829254871229961e-02   +2.887790659959539e-01   -6.608195096344700e-02   -2.238938076132771e-01   -1.267508393891921e-02   -1.839607776980061e-02   -1.541397076991525e-02   +1.700117524715692e-02   +2.188077530495727e-01; -1.601781517181143e-01   +1.885601256930604e-01   -2.581755415126044e-01   -8.878948556443775e-02   -2.900393885804794e-01   -4.274526470274438e-02   +2.620044902555770e-01   -1.508163019127496e-01   +1.697836056194320e-02   -1.270088840736944e-01   -2.966878291507633e-03   -1.223643759785106e-01   -7.097149394934249e-02   -1.857262567785534e-01   -2.463833884944437e-01   +5.666338627689410e-02; -1.672108783383744e-01   +4.502871345264732e-02   +7.217543771951131e-02   +4.092651507310240e-02   +8.285021806580244e-03   +1.311988154887941e-01   +2.308303505947827e-01   -1.521923145644979e-01   -2.706354217317183e-01   -1.410509482735090e-01   -9.141391442626111e-02   -1.208657962091291e-01   +1.540435545734900e-01   -2.194599738253372e-01   +1.496578694532853e-01   -2.075425642586258e-01; -2.152854206387861e-01   +4.695005584729692e-02   +2.239472680220537e-01   -2.254097059554366e-01   -6.599676741565683e-02   +1.323710035163244e-01   -5.162825918270567e-02   -1.971227820687527e-01   -2.745125176908593e-02   +3.021937862857311e-01   +8.933612014269671e-02   -1.600693736703232e-02   +3.563495289472907e-02   +1.439975879579897e-01   -2.313652112505711e-01   -1.737739756374836e-01; +9.041626150297238e-02   +1.391916613497161e-01   -9.867362135225147e-02   -2.165544699614403e-01   -2.402999972481940e-02   +2.040307722897393e-03   +1.560281819659022e-02   -2.550472029744710e-02   -1.208735328686542e-01   +7.593920285335705e-02   +1.246782753959655e-01   +3.572933790850571e-01   +9.193951744793076e-02   -1.666691468834151e-01   -2.226400871593579e-01   -1.929776202092410e-01; +1.309350379903169e-01   -3.275798315570472e-01   +1.676719741760804e-03   +1.840741877051001e-02   -1.013384117687090e-01   +3.311355491318611e-02   +3.500793365807147e-02   -1.492617475033670e-01   +1.144727487189662e-01   +1.329830152607885e-01   +2.189446046837203e-01   -9.816280055668540e-02   -5.791221592199039e-02   -9.855512131122748e-02   -2.517634760968215e-02   +2.616461002259040e-01; +1.130137630673981e-01   -1.144648904518190e-01   -1.509000517093084e-01   +8.392429025128764e-02   +1.643454554133372e-01   -1.347043906999377e-01   +7.900842406111531e-02   -3.892691597776062e-02   +2.048537121531565e-01   +2.382394744808091e-01   -1.911807431044295e-01   -1.863368932019679e-01   -2.395084638006680e-01   +1.530887532947225e-01   +6.476211058275583e-02   -1.781353133130401e-01; -1.164951033332209e-01   +1.257674200951356e-01   +2.108270767324383e-01   +1.240925812029176e-01   -2.766539818103091e-01   -1.579562657890032e-01   +7.829320750673896e-02   +1.480103502649594e-01   -1.618162909702547e-01   -3.939765467353761e-02   -4.334525859661322e-02   +5.615153634439215e-03   -3.400720008544940e-02   +9.610442468943733e-02   -6.305765667595137e-03   -1.645504598382286e-01; -1.975646216223230e-01   -1.734255007740552e-01   -1.387913013659241e-01   -7.998886311664960e-02   +9.018229384912996e-02   +1.820062403707519e-01   +6.680397132571871e-02   -1.847805105261636e-01   -2.473762406773042e-01   +6.327947272310114e-02   -3.050180098870255e-02   +3.769704814741775e-01   +5.678633347491856e-02   +1.592636934819633e-01   -2.488824142933898e-02   -4.813022366508109e-02; +2.664637680224582e-01   +1.868486869200636e-02   -1.940359516355721e-01   +3.870603716645631e-01   -5.596988837926978e-02   +1.707915841713746e-01   -4.366887548504547e-02   -8.271798024766962e-02   -3.255218446576125e-01   -1.941007387067682e-01   +7.496305352289719e-02   -6.882475939162566e-03   +2.436874927011602e-01   -3.796139649863877e-01   -3.436925657843777e-02   -6.378510507114174e-02; -2.584274759945304e-01   +1.022881363746532e-01   +9.231998658080121e-02   -2.957527487854529e-01   -2.357589236959118e-01   +3.028795035130032e-01   -1.536113367812882e-02   +4.494398595438016e-02   +2.490254154814191e-01   +5.599754875344351e-02   +7.909306205022584e-02   -3.677216621639152e-02   +1.984489796661440e-02   -1.612283380280551e-01   -7.488294011373587e-03   -3.582393684367079e-02; +1.295093974355667e-01   +5.676433800842602e-02   -4.098791809286176e-02   -4.460714238110241e-02   -2.929137771488131e-02   -2.891658103715808e-01   -7.280138236510358e-02   -8.982292883742699e-02   +1.149424340636975e-02   +1.538956537370504e-01   -6.519819666643462e-02   -1.066162324342290e-01   -1.396434509885131e-01   +2.039242665878561e-01   -1.688092874925789e-02   -9.246875209792216e-02; +1.807533045791672e-01   +3.753123217059579e-02   +2.205888779704132e-02   -3.147285686091785e-02   -2.386884823404226e-01   -1.750206226518263e-01   -2.603226780909731e-02   +1.625412050133810e-01   +1.571787662606470e-01   +2.680512829021584e-01   -1.699611565360330e-01   +1.016219646882163e-01   +1.109798861530323e-02   -3.466179644178780e-02   -1.101366561751470e-01   -7.400511987720518e-02; +9.006946541916531e-02   +1.549828306991926e-01   -1.656227012890129e-01   +1.991683434230187e-01   -2.469691228509268e-01   -4.493983613881893e-02   +1.878811160629960e-01   -1.277886831874166e-01   -2.744257110313435e-01   +4.556265189137552e-02   +1.476696444397680e-01   -1.973543094257398e-01   -8.328332239460400e-02   +2.980771413584230e-01   +3.398126160449985e-01   +2.449014364845183e-01; -1.327246425161010e-02   -9.717079152642275e-02   -2.529746711381768e-01   +2.285111615799794e-01   +3.607195993231991e-02   -9.110759688628427e-02   +6.259119613208784e-02   -1.475795313299620e-01   -5.133349485932794e-02   +1.273105848403477e-01   +1.343041898469663e-01   -1.195528878050729e-01   -1.524990090103515e-01   -3.331300312988481e-02   -3.948378091180210e-02   -2.261795555945752e-01];
L2I_L1I_iGABA_netcon = [+1.248775852201048e-01   +2.286172105184059e-01   +8.290230770878319e-02   -7.598433656792961e-02   +1.531224697826384e-02   -2.215695453595995e-01   +2.624711803596283e-01   +1.207351833757691e-01; -6.275570501085079e-02   -8.299828032596490e-02   +1.092263812780582e-01   +2.222878890710166e-02   -1.960292757134343e-01   -2.789636629121185e-01   -9.908255616080956e-02   -1.753015267989971e-01; -1.426097047801568e-01   -1.441844016973561e-01   -1.957755927000278e-01   -1.466041231245155e-01   +4.443588436141475e-02   -1.054070813452458e-01   -7.436706001943544e-02   +2.515929711067338e-01; -1.917043212197940e-01   +7.980397375587046e-02   -1.252206946139778e-01   +8.135287889076785e-02   +1.349008386797374e-02   -7.351610181698531e-02   +1.853406224788746e-01   +5.066648309976861e-02; -1.542026504646122e-01   -1.679575728550379e-01   +1.338006072468258e-02   +9.686811823640122e-02   +1.563782868839138e-01   -1.100866441189620e-01   +4.049541196912589e-02   -4.354911875756844e-01; +6.486618375312840e-02   +1.361434240114846e-01   -1.221653823197505e-01   -3.070917133898507e-01   -6.424817278495575e-02   +4.186965984550237e-02   +7.836964482679196e-02   -2.554408400036998e-01; +1.231712571435094e-01   +1.528194633952089e-01   +4.217589086221492e-02   -2.323853234273545e-01   -1.487704255095340e-01   -1.489049474075980e-01   +8.080541040687866e-02   -1.862454403143267e-01; -1.008357564151452e-01   +2.535145577835585e-01   -1.487453932598904e-01   -1.778336763208924e-01   +2.628697164201453e-02   -2.885700123549537e-02   +1.862599443885921e-01   -3.294101995027478e-01; -2.353730139149215e-01   -1.921389916775810e-01   +4.849670555609627e-02   -1.711260014882952e-01   -2.085069423941834e-01   +1.501090266297702e-01   +4.270297985793626e-01   -1.224262126629011e-01; +1.228572290944192e-01   -2.117122781773361e-01   -2.993861548551446e-02   +2.326648176030248e-01   +1.810579386750617e-01   -7.802422789827843e-03   -5.777489398524627e-02   +1.012145679998028e-01; +3.126188370006073e-02   -1.434916961722881e-01   -1.531301052682439e-01   +3.472721126904439e-01   -3.180344733501050e-02   -2.244401897381436e-01   +2.312981116258578e-01   +4.894045466251560e-02; -1.413100701411672e-02   +1.682675928440463e-01   -2.209790925291520e-02   -3.026296415244313e-01   +1.732570489995463e-01   -8.323972633092330e-02   +8.439126894007848e-02   -1.250591870556765e-01; +2.629150630315341e-01   -6.906377976857307e-02   -1.786591156511823e-01   -6.194933239676131e-02   +1.030791408136944e-01   -2.902329138987868e-02   -1.224470021829195e-01   -1.993609881184442e-01; -3.342532430289983e-01   -1.562842570517498e-01   -1.205775537584838e-01   +6.327883059041367e-02   -1.779956221661492e-01   -1.204910998471451e-01   +2.059271249508943e-01   +1.309435415581680e-01; -1.368705663444813e-03   -1.132177381737316e-02   -1.276595358445760e-01   -1.854104074011388e-01   +2.458353292906329e-01   +1.758188940988524e-01   -2.651772292247623e-01   +1.172079099870170e-01; +2.878668331678424e-01   -8.082444913224131e-02   -9.249198089097477e-02   +7.557212006134290e-02   -1.124901703696972e-01   -1.554627610408131e-01   +2.671212390978618e-01   -2.451957047641397e-01];
L1I_L2I_iGABA_netcon = [+2.247740345507378e-01   +2.673825503925207e-01   -2.072324067685967e-01   +4.696925270533163e-03   +4.336407174004936e-01   +1.331508024540531e-01   +7.313842667195815e-02   -1.409017640706730e-02   -2.868586200062304e-01   -1.918766384474753e-03   +5.256277124649013e-02   +1.446952936601199e-01   -1.177494051813731e-01   -5.079451352249587e-02   -2.196488555444725e-01   -9.296137000227893e-02; +1.081228394932669e-01   -2.286242727698625e-02   -1.039024667203269e-01   +3.878692926728741e-01   -5.236540518190883e-02   +1.571010223359108e-01   -6.594336132393291e-02   -1.435222933910472e-01   -1.306244059303726e-01   +1.288744295586584e-02   +3.377835626141354e-01   -4.634489515153783e-02   +3.174094989125631e-01   +2.459498518986922e-02   -2.604378084537843e-01   +4.535639982465764e-03; -5.558589613777917e-02   -5.184363834271115e-02   +1.474117742951564e-02   +2.050814599816191e-01   +5.494874841909252e-02   -9.555972367188657e-02   +6.244971843033439e-02   +1.029789949063099e-02   +1.500698308620194e-01   +1.555753040095043e-01   -2.023215493623712e-01   -1.152853282099612e-01   +3.122200848632758e-01   -3.649090185236546e-02   +4.294317705074322e-02   -3.723374593676485e-01; +1.234974239251349e-02   -2.289659987366145e-02   -5.373580097737696e-02   +1.256713752655742e-01   -1.624139826262021e-01   -8.752227330751565e-02   -1.319904894163016e-01   -8.510453490889835e-02   +2.387626947899578e-01   -1.164752261101559e-01   -1.795255495409692e-01   +1.039654901527441e-02   +2.291655897995506e-01   +4.734291972860649e-02   +1.200601782270498e-02   -1.874250101228249e-01; +5.573243933289346e-02   -3.050693145424038e-02   -4.080585486619027e-02   -8.215061158738786e-02   -1.973768671769068e-01   +3.382056640283362e-02   -2.549345861291440e-01   +2.120833224904298e-01   -4.142663963260380e-02   -7.894694669981969e-02   +1.256050262238067e-01   +1.929946186236211e-01   +1.983377318394584e-01   -6.649641695976136e-03   +2.627220151992667e-01   +2.526134929042159e-01; +2.256933262896345e-01   -1.228112140954185e-01   +1.747696087324879e-01   -2.495430061116421e-02   +3.748318423294594e-03   -8.273430585395326e-02   -1.091563349582160e-01   +1.960927330504820e-01   -6.408540384243230e-02   -2.984598595558523e-02   -3.940855286357794e-02   -6.109368809878037e-03   -7.654090310719330e-02   -1.273333115414307e-01   +2.192325251334182e-02   +1.533760872563223e-01; -2.009395916048089e-01   -2.538213241117813e-02   +1.034852942837388e-01   +7.653139786591651e-02   -8.624408827872170e-02   +3.824522352192580e-02   +5.971770279652436e-02   -1.528392792114676e-01   +1.679524209011028e-01   +1.073390428971698e-01   +1.865035421321285e-01   -1.004081423109360e-01   -4.232975619314287e-03   -2.094532859769530e-02   -1.980451709238608e-01   -1.736152206874951e-01; +6.330983537473014e-02   +2.002564267111589e-01   +1.527091514130753e-01   +8.737748886342907e-02   -1.526352817329042e-01   -1.067492867905719e-01   +1.268591416159747e-01   +2.376800051902152e-01   +2.476186241196555e-01   -1.036314716364395e-01   -8.483019306731053e-02   -4.553299522763048e-02   -4.894225559773302e-02   +1.965514292765469e-01   +1.207418569289252e-01   +9.097887442472613e-02];
L2E_L1E_iAMPA_netcon = [+1.891497738320489e-01   -3.124062478984728e-01   +2.044938216047518e-01   +9.774349058361620e-02   -3.495190655378576e-01   +1.027216369984372e-01   +1.106229685571946e-01   -1.082980917451477e-02; -5.582114726708921e-02   -2.114374576506604e-01   -3.565362709075474e-01   +5.125353773337905e-02   -1.704190541499872e-01   -7.316978125221273e-02   +2.081929769393518e-01   -2.412849916477605e-01; -9.462832079684133e-02   +1.810307830627469e-01   +5.654155205088457e-02   +2.100419261976539e-02   -1.458301046148955e-01   -1.443789922211251e-01   -2.084481272091929e-01   -7.356507292643491e-03; +8.705212227509033e-03   -6.894448652718739e-02   -5.024635869469066e-02   -2.593803624551854e-01   +1.917360523398410e-01   -5.416531835114974e-02   +9.478575003851961e-02   +6.824276879700977e-02; +5.735605509817455e-02   -6.713898963831869e-02   -1.856702014752536e-02   +1.877266133512172e-01   -2.771695906661314e-01   -4.557991337740555e-02   -1.140265828669596e-03   -9.651911603141976e-02; +5.001975707696061e-02   -1.274135958783098e-01   -5.600793095147608e-02   +1.163404393724251e-01   +2.835460480783769e-01   +7.959534937055227e-02   +1.701197464917120e-02   +1.357797066479178e-01; -3.503829257726920e-02   +1.467981513084309e-01   -8.056399939939447e-02   +9.264723091255608e-02   +1.100384052829473e-01   -6.717634410535588e-04   -1.727868676302451e-01   +5.700898466760463e-02; +1.380000566729817e-01   -1.257641201545009e-01   -1.871738436156423e-01   +2.306386265566211e-01   +1.001928817267577e-01   -5.206175924278799e-02   -1.377294981164308e-01   -7.163940791379181e-02; -1.012340758572843e-01   +1.378336000895338e-01   -6.686767694480167e-02   +1.783189463123544e-01   +1.123034146556541e-01   -1.327632377161522e-01   -1.394321473025136e-01   -6.289800321277832e-02; -9.861582715944497e-02   -1.149855256500566e-01   +1.724202783405950e-02   +4.788156370643230e-02   +2.223367280681396e-01   -1.568637940557392e-02   +5.100654239312187e-02   -2.146650832811602e-01; -2.235935510817456e-01   +1.958645646588273e-01   -1.773609505156683e-01   -5.800692077560247e-02   +1.111043180100372e-01   -2.770053495640836e-02   -1.850119463568926e-01   +1.543085184225055e-02; +1.239980384922545e-01   -3.361135233534157e-01   +6.204054403418498e-02   +2.397103730589868e-01   -2.677246208805705e-01   +2.568937037988293e-01   -1.105971298888579e-01   +1.260295179142318e-01; +1.124634088104624e-01   -2.397929554711774e-01   -4.112467344182778e-02   -6.264259688030811e-02   +2.888438679030703e-02   +6.094357997172235e-02   +3.442025880839544e-01   -8.928064316377844e-02; -1.300968223805472e-01   +7.141737322403897e-02   +3.575077097880793e-02   +2.033754510095041e-01   +1.786365336751318e-01   +1.994449039840546e-02   +4.006388153412233e-02   -2.278991096046681e-01; +1.959067560880996e-01   -1.889973076753882e-01   -9.963786952034245e-02   +1.094536508931304e-01   +1.508228775811435e-02   +4.928029004600208e-02   -1.277659407580706e-01   +2.056580119476637e-01; -3.725591883253818e-02   -2.681401990898720e-01   -7.362360362827319e-02   +8.753725015985549e-02   -3.987400626650972e-02   -1.265606312768977e-01   +2.921351044844512e-01   -4.777735897428131e-02];
L1E_L2E_iAMPA_netcon = [-3.671707584982432e-01   +1.495854660289039e-01   +6.818755540043114e-02   -8.845136776388353e-02   -6.095195206243131e-02   -1.635945732132275e-02   +2.188871672811288e-01   +9.547019100098848e-02   -1.278551652618868e-01   +5.537072545667350e-02   +2.840106804404197e-02   -1.253280431027138e-01   +7.678917635005984e-02   -1.080864856693199e-01   +1.840660441348576e-01   +9.310598515297001e-02; -2.019169070639593e-01   +7.453824570651045e-02   -2.354296671650441e-01   -2.097091830483699e-02   +1.287168637198726e-01   -2.221788452346760e-01   +1.168009433463119e-01   +1.100210698078100e-01   -6.939550818726103e-02   +1.502834380942312e-01   -7.298413463308753e-02   -1.509592529940904e-01   -3.029855682639734e-01   +1.014564672012067e-01   +1.906097038442911e-01   -3.210823537909362e-01; -1.575970602235856e-01   -5.828851342324529e-02   -1.438078842725233e-01   -1.467322772807252e-01   -3.358882601198250e-01   -2.139359988031849e-01   +1.133342583073527e-01   -1.016677201192563e-01   +1.968489963957718e-01   +1.274856374948947e-01   -3.307342991066393e-03   +1.951866147677315e-01   -2.404987485073965e-01   +9.995688591847954e-02   +9.943401100522960e-02   +1.925232405990213e-01; -1.241768476313884e-01   -1.252834270046987e-01   -1.529990653273943e-02   +2.732950224719232e-01   +7.578171483559179e-02   -4.605588915086757e-02   -1.245888108921705e-01   -8.177026927152489e-02   -1.092272407944690e-01   -3.534565587567445e-01   -1.924835262401303e-02   -1.731028641787961e-01   +9.753964956217906e-02   +2.820878702313865e-02   +1.163029145019774e-01   -1.038780814816354e-02; +2.254716045320173e-01   +2.539900898310601e-02   -5.069127806943953e-02   +1.785275315348332e-02   -5.766039742708247e-02   +5.773558114985299e-02   -2.233139954555968e-01   +1.146305170383211e-01   +8.252048353604835e-02   +8.375384664172890e-02   +1.720214466400755e-01   +2.401557364521536e-01   +3.294711791306403e-01   +2.006064904566336e-01   -8.941762768708436e-02   -4.045009541870812e-02; -1.175162418799389e-01   -1.379746296997912e-01   +8.410063605417295e-02   +5.934162450959598e-02   +2.897281608787102e-01   -1.481520738434083e-01   +1.703281139831517e-01   +1.694010492774835e-01   +1.126568734578602e-01   -2.807659820879819e-01   +9.379816264621620e-02   +7.052776643541679e-02   -2.401033896734148e-01   +1.210281285108067e-01   -1.483504295841379e-01   -1.895354135981259e-01; -6.122122382177939e-02   -7.055042374524269e-02   -7.690786331354404e-02   -7.650193560497448e-02   -7.233016760383536e-02   -5.400393043917191e-02   -5.494166944430415e-02   -4.022848424392532e-02   -2.232301636214628e-02   -3.074915245049720e-02   +2.264610904557415e-01   +1.876869235385114e-01   -6.747037873656488e-03   +3.745035732209862e-02   -3.693161234178567e-01   -7.422438870448077e-02; +2.530198842325297e-01   -5.659140176701447e-02   +8.142360247209027e-02   -6.667925242463280e-02   -1.621949106094000e-01   +1.407363793105400e-01   +4.446667728289069e-02   -1.133333560880352e-01   -1.503777967052582e-01   -9.152033650652359e-03   +2.014291445586293e-01   +1.560890913850339e-01   +1.781089781722901e-01   +4.926789622021768e-02   +4.467490341863059e-02   +9.033316007611647e-02];
L2I_L2E_iAMPA_netcon = [+2.912248723232707e-01   +3.202957229565604e-01   -3.078389365246365e-02   -1.278503820994117e-01   +2.312922703531805e-01   -5.265372922108219e-02   +1.403091592339263e-01   -1.690529813903797e-01; +6.606646620186243e-03   +1.227185192673178e-01   -1.252637538676883e-01   -2.929254913046254e-01   -4.396112443128770e-03   +1.028717155912719e-01   -1.367763894788838e-01   -1.498751413787340e-01; +5.952252027654514e-02   +5.905921740846712e-02   -3.851208255244729e-02   +1.504600248310500e-01   -1.334939675942141e-01   +9.140157743426308e-02   +2.780774813036471e-01   -3.638806794121789e-02; +4.257575479657331e-03   -5.914583831265188e-02   -5.932130767679367e-02   -1.743494685356426e-01   +5.599603131280802e-02   -1.165354343905442e-01   +5.425686774260893e-02   +2.792999512357280e-02; -2.685213674584913e-01   -2.461741113102243e-01   -1.104832375609022e-02   -1.351120315673897e-01   -1.304041574774576e-01   +1.419350313060845e-01   -1.695602896160428e-01   -1.481877769205520e-01; +7.406007138513375e-02   -2.819921134919961e-02   +1.026817483172512e-01   -2.149842874708593e-01   -8.042142956565032e-02   -4.277154665789863e-02   -9.269279340802210e-02   +2.371186056823251e-01; +1.325507891716571e-01   +1.379754542877016e-01   -6.148072779788451e-02   -7.687141817946086e-02   +1.290701775428448e-01   -2.325297140480271e-02   -9.840221650025452e-02   -8.425746763674713e-02; +4.848813638681125e-02   -1.737453343179488e-02   +1.725457024000588e-01   +9.836577888810269e-02   +8.864957168707013e-02   +1.740141437635687e-01   -5.414241847486762e-02   +1.723947185523865e-02];
L2E_L2I_iGABA_netcon = [+4.075898882560876e-02   -7.051095105131456e-03   +2.588285505797292e-01   +2.876124167610211e-01   +7.816213775316608e-02   -1.174659670435210e-01   -3.777755667458029e-01   +1.220330310556254e-01; +5.322589167554240e-02   -5.006721778161523e-02   +2.658197575513401e-01   +1.974497981771714e-01   +5.090924299198303e-02   +6.392479047178018e-02   -1.666120207065006e-01   +8.234708033456296e-02; +2.348365041730105e-01   +1.074615947953934e-02   -1.069436670557954e-01   +3.509115833987419e-01   +2.570070296130550e-02   +3.994628762665624e-01   -1.143976579893080e-01   +1.846641271873191e-02; -2.347148081229176e-03   +2.083115814173127e-01   +1.277999804690321e-01   +1.039834891052816e-01   -1.242112061439978e-01   -2.491579219413409e-01   -1.347421414108178e-01   -1.854808941978290e-01; -1.080323946121215e-01   -1.793646902995226e-01   -1.772707086912202e-02   +2.221192960813429e-01   -1.791251348534991e-01   +1.117761523064993e-01   -3.106787034638841e-02   -1.980853786694740e-02; -5.890575720235655e-02   -7.973365064091334e-02   +4.922905513403099e-02   +7.127085975322731e-04   -8.523387178392437e-02   -8.268036215839669e-02   +1.730150857207291e-02   -7.661302181495855e-02; -1.820840689705502e-01   -1.203517072439001e-01   -1.516909485332361e-02   -1.347125879662522e-02   +1.302697356857405e-01   -2.997353078884117e-01   +4.159669368178637e-02   +5.370048480676355e-03; -1.199887133229280e-01   -5.634147676132204e-02   -1.794893182281911e-02   -3.207500779003260e-02   +5.377063654079268e-02   -2.886590336782662e-01   -8.230822247278058e-02   -1.391600918274073e-01];
L3E_L2E_iAMPA_netcon = [+6.953075778509224e-02   +8.294053709827770e-02   +7.280698001312633e-02   -1.406325636050026e-01   -2.410714445856673e-01   +3.500556985280002e-02   +2.012514298689824e-01   +2.385373252058260e-01   +1.517916240898512e-01   -1.655920865487897e-01   +5.428013423170465e-02   -6.670608138361955e-02; -2.330468043020038e-01   -2.684427864436607e-01   -2.375117672436902e-01   +2.778693739621676e-01   +1.629279272899289e-01   +5.392790971223917e-02   +1.450465764873203e-01   +1.940557633714841e-01   -1.811415128631219e-01   +8.105673943958183e-02   +8.415717519578284e-02   -1.551398505686999e-01; -3.226264722473426e-02   +3.499911366834502e-03   -3.311135016849455e-01   -1.766650209468225e-01   +8.984395722599964e-02   -5.939569961609562e-02   +3.166309549769575e-01   +3.241234761146348e-01   -3.293515729696210e-01   -1.921736108269781e-02   -1.304692800275035e-01   -1.242726450232248e-01; +2.885730921861343e-01   -2.008241916827447e-01   -1.643053750052633e-01   -3.260392996006890e-01   +1.341200477576411e-01   +1.346768661429010e-01   +1.318120243184814e-01   -1.558486028451799e-01   -2.050543133866523e-01   -1.513863395441715e-01   +1.335973668952822e-01   +1.984612781610357e-01; -1.100318938978432e-01   -5.225355152868756e-02   -9.055147527610113e-02   +3.414258292136792e-02   -1.102672297687944e-01   +1.515444780275622e-01   -2.109352430705094e-01   -2.146996027421971e-01   -5.987167058822160e-02   +9.949549450027416e-02   +3.404999999205506e-01   +2.018321797759290e-01; +1.653118432485071e-01   +1.936678146376703e-01   +3.543454577332856e-01   -3.966879411696216e-02   +1.408974026637547e-01   -1.648148396567492e-01   +2.441005028996139e-01   -2.304882789411960e-01   +1.179408800976949e-01   -3.864711740267024e-01   +5.331516497454906e-02   +1.115525275728291e-01; +8.380127321406597e-04   -8.573304367344488e-02   -1.577404796277496e-01   +9.834217376860563e-02   +2.344450509452538e-01   -1.237244560585020e-01   +1.407204500482668e-01   +1.915898520301319e-01   +9.834587034492606e-02   +1.644173917691553e-01   +1.998596053932911e-01   -9.253703115601769e-02; -9.352898609550955e-02   -1.593192978760594e-01   +2.962053516889329e-01   +2.121950844890335e-01   -1.141802483743170e-01   -2.867357715662163e-01   -1.637289544528207e-02   -1.497537162090994e-01   -9.925790179417085e-02   -4.090115997251803e-02   -3.266853038821979e-01   -1.493232432689260e-01];
L3I_L2I_iGABA_netcon = [-1.769831426524571e-01   +2.378540457382050e-02   -3.850666397635483e-02   +4.072500841415664e-02   +1.056559193746740e-02   -6.959071725146362e-02   +7.754153252359730e-02   +1.373578123270232e-02   +1.464010652907682e-01   +1.455100608454346e-01   -2.702707908685706e-01   +1.326595579478065e-01; +3.273618707534043e-01   -1.513476192651025e-01   -7.016587452456123e-02   +8.188238304873649e-02   -2.714006609090787e-01   +8.034415871284747e-02   -1.238772770251137e-01   -2.775630941253633e-02   +9.601804624897131e-02   -1.492276314126114e-01   -1.316879066321172e-01   +3.864899649703835e-01; -1.508440633538922e-01   +1.140309000696679e-01   -8.002732267072039e-02   -8.122670767401793e-02   +2.716781367077620e-01   -1.411994899224333e-01   +2.716593438821622e-01   +8.964757250621502e-02   -2.827554623373146e-01   +2.619457879429121e-01   -1.065973104177987e-01   -8.994475742768146e-02; -1.755516295993954e-01   +1.343104823126838e-01   -7.630076919734642e-02   +2.508361483954487e-01   -9.523354485580614e-02   +1.710944808269705e-01   -1.300353753518960e-01   -3.348048945152465e-02   -2.177415452046368e-01   +1.954713539008919e-01   +7.675654339917014e-02   -1.122687427113243e-02; -5.128084362952052e-02   +2.600063742548001e-01   -1.987298760482781e-01   +3.238833413425617e-01   -2.358005693591481e-02   -1.081961373191191e-01   -4.019906599377748e-02   +2.044914062576169e-01   +1.410898221031965e-01   +2.361984219498299e-01   -2.080165448207481e-01   +6.441033378783191e-02; -2.068036006571717e-01   -2.109258834134012e-01   +2.297472041833344e-01   -1.379751725451828e-01   +8.682294899129167e-02   -1.727596145032264e-01   +6.612936506965186e-02   +2.371033407606531e-01   +1.951520406716519e-01   +4.064687775557696e-02   -1.197800861757846e-01   -8.759681874881602e-02; +9.492661966393280e-02   +2.869318160808506e-01   +5.093735879373228e-02   +1.830114867536327e-01   -1.973326054843046e-01   -2.533899460061457e-01   +1.694344129119333e-02   -1.993331270879229e-01   -1.590972823612169e-01   -4.976746832689520e-02   +3.001817559008121e-01   +8.540598837973633e-02; +6.902964035878803e-02   -2.725444314492152e-01   +4.112841811788401e-02   -2.988491393541283e-01   +6.299364984575229e-02   +1.285448917068896e-02   +6.270383178969166e-02   +5.983521281658534e-02   +1.189642490765651e-02   +1.236661857731673e-02   +1.245105256161408e-01   -1.816934347574405e-01];
L2E_L3E_iAMPA_netcon = [+1.803937504365468e-01   +9.799896995575836e-03   +6.751371425573462e-02   -1.224709474668867e-01   -1.732256406866457e-01   +1.374329805218109e-01   +2.354742779886337e-01   -1.183182973085677e-01; +1.288278027638211e-01   +1.724540814726447e-01   +1.892679190400245e-01   -1.691264199308307e-01   +4.989606838355742e-02   -2.274974789722970e-01   -8.995467378016903e-03   +1.434307701753948e-01; +6.527269721697313e-03   -2.092794838575181e-01   -1.504349355320087e-01   +2.019937685044587e-02   +4.932866034985869e-03   -1.459190385155382e-01   +1.281581333989251e-01   -2.014165280161980e-01; +1.213546490064906e-01   -2.822961774278733e-02   -4.133949333795872e-02   +2.728384308913173e-02   -5.681397907525574e-02   +5.747740965811475e-02   -2.319266773450887e-01   +2.909940084459783e-02; -7.823716368745812e-02   +2.231437676911466e-01   +6.510392599157905e-02   +5.232045037755932e-02   +2.143637100755244e-01   +1.212539210499211e-01   -2.249762550985807e-01   -9.661900782035125e-02; +2.206887160869274e-01   -1.573505809700584e-01   -2.203353767701605e-01   +3.883871748279463e-02   -3.593348273377225e-01   +1.621197239121696e-01   -3.003406705507052e-01   +9.602831376791426e-02; -1.583177638046332e-01   -1.759747894633331e-01   -1.678656404892847e-01   +1.008914081777270e-01   +1.667745828523144e-01   +3.398460807317812e-03   +7.333416378075225e-02   -2.072107068001709e-01; -2.691953834648062e-01   +3.055857321749246e-01   -1.807674540642354e-01   +1.430416881624846e-01   +1.258029602794039e-01   +5.317582812663866e-02   -1.010327700895553e-01   -8.365770517005863e-03; +1.670411879013301e-01   -2.355113518041911e-01   +1.266281987587734e-01   +1.702821852921365e-01   +8.659032538684233e-02   +2.031761320909098e-01   -2.540630541090283e-01   -2.375428356110221e-01; -1.877023266916387e-02   +3.140956602055405e-01   +3.377254622764801e-02   -2.555359330880912e-01   -9.236255659203561e-02   +1.024510198566565e-01   +9.095768301171053e-02   -1.191152513347792e-01; +2.726738375028554e-01   +3.183204043014690e-02   -2.579319443357524e-02   -4.227979475709115e-02   -3.403608718994797e-01   -4.406403816230215e-02   -2.535122504810192e-02   +5.291111187113814e-02; +2.450155333987080e-01   -1.516141047185882e-01   -2.272040507700732e-02   -3.567375025757187e-02   +2.144905363674181e-02   -4.889409166338744e-02   -2.022166107590455e-01   -7.582405780838687e-02];
L2I_L3I_iGABA_netcon = [-2.521868643002800e-02   -3.785172624552043e-01   +6.169526403841486e-02   +1.075500577396301e-01   -1.371941341130652e-01   -1.197361205293221e-01   -2.504685843016512e-02   +1.779192711465820e-03; +2.834759153264233e-02   +1.113250274090591e-01   +6.260800130998666e-02   +6.297778189486881e-03   -1.515500332374226e-01   +1.717073511909069e-01   +1.640098401971646e-02   -2.334093704252416e-01; +1.179666671000449e-01   -1.463298764704756e-01   +1.117752618512484e-01   +3.581760742127901e-01   +1.705292497982047e-01   +1.679714031650569e-01   +4.474497021758641e-01   +1.474537245810869e-01; -7.679661859740375e-03   -2.924423029105927e-01   -1.951716824154010e-01   +3.263421069830826e-01   -2.328652454686340e-01   +1.503669930657237e-01   +8.279078413527931e-02   -3.357335216558998e-01; -2.021799832028468e-01   -1.104247167614995e-01   +9.031004575660243e-02   -2.849147903454600e-01   -3.465776253226070e-02   +3.139176919949149e-01   -2.808144688368092e-01   -2.201193460477234e-01; +9.632650776327080e-02   -3.089195243285247e-01   +1.046983821731149e-01   -2.842517614528266e-01   +1.388589035224971e-01   -1.430376678829157e-01   +1.998764198167713e-01   +1.447942237818869e-01; -4.114691496266989e-01   -1.127524828694847e-01   -3.237310596999203e-01   -4.571191748188948e-02   -1.486811248065774e-01   +3.688158665868456e-02   -2.412375985728945e-01   -1.507977732501942e-01; +2.010512250022303e-02   -7.774287282616621e-02   +1.770858051085466e-01   -7.956339941565518e-02   +2.267615436874643e-01   +2.336855925204245e-01   +1.873816983181930e-01   +5.163837902471935e-03; +9.722753523160044e-04   -1.641106481661077e-01   -1.243544309867052e-01   +3.100210782431483e-01   -2.541153986931762e-01   -8.958461246259702e-02   -6.187184640346918e-02   +1.481296328453967e-01; +2.325022063034744e-01   +1.308886410304516e-01   -1.950742076949883e-01   +2.085727065788657e-01   -5.837856679653301e-03   +3.096399046055528e-01   +1.002088869392406e-01   -2.040333880549142e-01; +6.560543438109415e-02   -1.488106607386043e-01   +3.189330210095757e-01   -1.865385081505989e-01   -6.320771519374742e-03   -3.994383945634412e-02   +2.733529081187061e-02   +1.235317716608750e-01; -1.193737372506162e-01   -3.879352312959700e-02   +4.632278046793981e-02   +5.323056605901866e-02   -1.293210839335250e-01   +3.273202088509818e-02   -7.698896652046258e-02   +1.076658929015345e-01];
L3I_L3E_iAMPA_netcon = [-4.582050398736530e-01   +4.146492775184590e-02   +1.861612463043156e-01   -8.896850825097628e-02   +1.995114720142862e-01   -2.155505508717982e-01   -1.771294213530958e-01   -1.122299259850326e-01   -7.883226661922750e-02   +8.742568276991495e-03   -1.660020386761056e-01   -3.211648875418047e-01; -6.145401083115191e-02   +4.571946438984059e-02   -2.413973297747785e-01   -1.064140366114860e-01   -1.695586586183314e-01   -1.632036411402323e-01   -1.344937121904105e-01   -1.950729359835300e-01   -2.633928888754771e-01   +1.405613452227883e-01   +3.134464576591026e-02   -6.694731644123784e-02; +1.022049519189601e-01   -2.986595224435238e-01   -1.565362018666383e-01   +4.440760668949899e-02   +3.185265402271779e-01   +1.028375329336083e-01   -4.768605022676455e-02   -1.475552793777379e-01   +3.378997756738105e-02   -3.037851253944089e-02   +5.739245646715266e-02   +9.682311037075229e-02; -1.171068531523664e-02   +1.281373156791734e-02   -1.949616495284491e-01   +1.646709780168967e-01   -1.515860358738191e-01   +4.111041780060699e-02   +2.652399789816941e-02   -1.401617704038228e-01   +7.563229552061798e-02   -7.671548796926358e-02   +1.689504308480366e-02   +6.682312784934540e-02; -2.413952994979653e-01   -1.510479898467412e-01   -8.677019441423620e-02   +9.197658191573017e-02   -2.193477500719601e-01   -1.924685280546980e-01   -1.430313208599836e-01   +8.942518590687486e-02   -1.991816884166215e-01   -2.935128379385214e-01   +1.497577015035392e-01   -2.781336649605209e-01; -2.858402788178159e-01   +6.955788039811685e-02   +2.690679226140938e-02   +7.024172821125026e-02   +5.541903231278102e-02   -2.247540896227398e-01   +7.449295462999234e-02   +1.001527883842741e-01   -8.054680003708030e-02   +1.964322553013034e-01   +5.112270673343406e-02   +6.950665708515252e-02; -4.164505550668511e-02   -7.490340014754486e-02   -1.620650979232525e-01   +1.399421479942693e-01   +6.716102904035245e-02   -7.026588073413952e-02   -1.202787377225790e-01   -2.441798763424445e-03   +4.567322439869230e-01   -1.256430461024732e-01   -1.646197762258612e-01   +2.521298490958029e-01; -1.254371448603249e-02   +1.622010902005644e-01   -2.610351355506862e-01   +1.071092475186212e-01   -1.383640319559830e-01   -5.687191664966306e-02   -2.376646887102255e-01   -7.442861155187926e-02   -1.179210017888295e-01   -3.521441646937671e-01   +1.150989290533441e-01   +1.791686322455455e-01; -2.376447157247507e-03   +9.850842218958833e-02   +1.271794123623860e-01   -2.529757354838250e-02   -6.441818951144196e-02   +1.519427774696780e-01   -1.532138371490573e-01   -2.187884522555813e-01   +1.697099803046343e-01   -3.715710746909385e-01   -2.690788855032032e-01   +2.412871847959894e-03; -6.674650863692103e-02   +1.627396296141245e-01   +1.365558727885206e-01   +2.154189587505883e-01   +2.160560716479281e-01   -5.440014397559405e-02   -7.306653694576368e-02   -2.251316561711631e-01   -2.181240181667408e-03   -1.819636752355673e-02   -2.557495311155134e-02   +2.341440954032676e-02; +4.709952173651261e-02   +1.035123813128252e-01   +2.171202228126628e-01   +2.693636494966851e-01   +1.560896780320023e-01   -1.484009775949159e-01   -6.196529217320777e-02   -1.037403793360510e-01   +1.745945575764160e-01   +1.814229788759733e-01   +9.435959040049574e-02   +1.540012196691892e-01; +3.166709448277440e-02   -1.322951966930684e-01   +2.886391019359351e-01   -1.636383676565132e-01   -1.122341424878529e-02   +2.618892003252057e-01   -3.792822288247343e-01   +1.469526582387670e-01   +1.732221592559087e-01   +2.186921181851379e-01   -1.618474264161031e-01   -4.704653557910646e-02];
L3E_L3I_iGABA_netcon = [+3.809873253902375e-01   +1.398662033301420e-01   -2.121287246786032e-01   +5.563239991665856e-02   +2.489959127973451e-02   -1.221432546429984e-01   +7.154391643971886e-04   +1.097350472915353e-02   +1.379453040457709e-01   -1.467689111757245e-01   +2.025758810829919e-01   +2.709344904525025e-01; +2.532380188077266e-02   +1.467572622210806e-01   -1.376205883548781e-01   -2.114629405827122e-02   +6.912536970575940e-02   -1.368821374545100e-01   -2.478573011413658e-01   +2.843366917309839e-01   +2.894608182633472e-01   +1.060337330941845e-01   +2.616134714347361e-01   -1.610550812068864e-01; -2.594734770627263e-01   +3.941341992486680e-01   +1.907245136688056e-02   +1.445437337632928e-01   -2.267268055387804e-01   -6.236897334811320e-02   -1.353703705386411e-01   +1.834480753865775e-01   +1.639686009063210e-01   +3.716804855599454e-01   -1.109161487585184e-02   +1.896851008401401e-01; -1.141865748860912e-02   -5.652502812711022e-02   -1.221041097874998e-01   +3.550859617137870e-01   -1.105351239349530e-01   -2.075808681208102e-01   -3.883750548015211e-02   +9.891036745400376e-02   -7.587086459595585e-02   -9.476551925314808e-02   +3.344578214475116e-02   -1.533347647798378e-01; -6.095570985921389e-02   +5.779526421406869e-02   +2.565753899870067e-01   -1.202276608557415e-03   +1.502142495241076e-01   -1.736176700155425e-01   -1.587416182567470e-02   -1.685469103548961e-01   -1.313182330057241e-01   -2.439580790432541e-01   -1.203668382901318e-01   -1.216203380831051e-02; -6.635582663969165e-02   +8.283198500175618e-02   -2.482287315351434e-01   +9.352885293940696e-02   -8.909435848278217e-02   +1.280373214896011e-01   +1.534639032902980e-01   -5.190199987835190e-02   -1.023144713112740e-01   +2.131695124463838e-01   +8.417164038634459e-02   -1.589948920652132e-01; +1.248414049249842e-01   -3.324128375456341e-02   +5.996306191610584e-02   +6.391787887349304e-02   -1.292409619635270e-01   +2.256999882253079e-01   -6.692502907131964e-02   +1.136002601795747e-02   -5.538647164608317e-02   +1.367337295358697e-02   -5.278913055580177e-02   +1.064457446934844e-01; +4.684334881240177e-02   -1.507378250661046e-01   +6.268919273091993e-02   +3.905571205885592e-01   -2.850152013083115e-02   -1.890085563962713e-01   -3.600468669565470e-01   +2.613258978448982e-01   -7.767322500256309e-03   +1.352109467949114e-01   -1.221788276846540e-01   +5.441632889134243e-02; +2.765040464848058e-01   -4.199640662162975e-02   -1.537756208560458e-02   -4.441672257951224e-02   -2.800208698011149e-01   -1.988862644691160e-01   -2.059585782751740e-01   +3.593425687986885e-01   +2.300688540133235e-01   -1.186076910380245e-01   -2.221879350800462e-02   -8.391373685622706e-02; +1.576329850138697e-02   -1.897521787015168e-01   -1.614475963534826e-01   +2.121011967988347e-01   +1.582322605090225e-01   +3.555423658840345e-01   +8.290073400043454e-02   -1.145092314175440e-01   -1.282244833730231e-01   +6.330425304137703e-02   +3.019111875452247e-01   +3.715072873057646e-02; -1.596626075765362e-01   -3.483968727993083e-01   -2.187586805922059e-01   +9.268288323962376e-02   +2.379601775343105e-01   -1.318322259624882e-01   +2.613489347522490e-01   -1.253247684506267e-01   -6.424881535422564e-02   +6.605435375651428e-02   +3.482419987711913e-01   +1.633214229163462e-01; +1.932128054652470e-01   -1.397713256440024e-02   -4.617647070480797e-02   +9.122064215450244e-02   -1.178310216488117e-01   +2.734868252558045e-01   +7.604562918864410e-02   +4.971480598122279e-02   -1.106909890336153e-01   -3.070101781270914e-01   -2.669475908717248e-02   -6.725378522514409e-02];
L2E_Input1_iAMPA_netcon = [-2.135244566628423e-01   +1.082314202306649e-01   +1.647439455119467e-01   -1.442581075031778e-03   +2.649917403380934e-01   -1.911354709602932e-01   +5.436331575575563e-02   +1.751254753152104e-01];
L2I_Input2_iAMPA_netcon = [+1.717893868111121e-01   -9.085477304594587e-02   +2.109147191272683e-01   +1.380097149917603e-01   -1.889630485446954e-01   +2.424429791462930e-01   -1.982999263355958e-01   -5.514569020081914e-02];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.03*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.15*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.15*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.03*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.15*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.15*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
