function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-2.195994381843618e-03   -2.825283446344095e-03   -1.016873343093289e-03   +5.394630622071839e-03   -2.080199160553974e-03   +6.433958054119463e-03   +5.829255157981494e-03   +4.479541929212026e-04   -1.475508006710708e-03   +6.167413942351561e-03   +3.325415959745540e-03   +3.209444288612811e-03   +6.066278898642420e-03   +1.812617918747197e-03   +1.281708323223698e-03   -1.737050823585444e-03; +8.768692095838065e-04   -4.264042329223245e-03   +5.364135393678242e-03   +8.219068850850155e-03   +5.854721070040849e-03   +5.369964044927075e-03   +7.471915691443831e-03   -4.414605333150880e-03   -1.132325650764785e-05   +9.893849171851011e-03   +5.576223809825870e-03   +1.464263031040287e-03   -2.038985312474198e-03   -5.601291895062713e-03   +1.975257547928238e-03   -4.275579298707918e-03; +5.697476401508994e-03   +4.378021750284117e-03   +4.558682383196688e-04   +4.052862864303754e-03   -3.778338251803212e-03   +2.251564292143816e-03   +4.550726752579741e-03   -2.168155493260846e-03   +2.593724096509923e-03   +6.675502522156363e-03   +2.617214163105753e-03   +7.725866280703160e-04   +7.984049713361668e-03   +2.446717283872433e-03   +2.415946873394101e-03   +4.012298832370417e-03; +9.673759392769227e-04   -2.401050522201937e-03   -2.840273715159063e-03   -1.774985375847796e-03   -1.063532055414173e-03   +8.606436563373590e-04   +3.307111510745668e-03   -2.356233313008411e-03   +4.249394529195206e-03   +6.293020685774534e-03   +6.145803072546249e-03   +4.446485326483231e-03   +7.393067846415138e-04   +6.213714694845364e-03   -3.864329237325628e-03   -2.810889175814209e-03; +3.136900543645407e-03   -4.967223571787634e-03   +2.233753681965277e-04   +4.636959135581445e-03   +8.390492774152533e-03   +8.488274969702641e-04   -2.098513747915812e-03   +3.543238028209627e-03   -2.083209315581210e-03   +4.138370204149582e-03   -2.769783265186805e-03   +5.660497652106337e-03   +1.628822083187845e-03   +2.003798845502599e-03   +9.226968044787243e-04   -1.373455943494734e-03; +9.180336901704111e-03   -7.107072857623082e-05   +1.425977952491731e-03   +5.912786754053839e-03   +5.673296851934893e-05   -6.681405841786214e-04   -2.257092506243332e-03   -6.218860544560739e-03   +7.436416366044310e-04   -2.414342570389567e-03   +3.415254337882897e-03   -3.631717602568649e-03   -2.529585242708787e-04   +2.525529440792662e-03   -8.800826450975425e-04   +2.714179578699577e-03; +9.188337778830795e-03   -2.023719651964386e-05   +1.755931181960396e-03   +1.819225121217838e-03   +3.288363737041399e-03   +4.166880955694169e-03   +1.240747344533507e-03   +1.403148933565783e-03   +6.508204641942856e-03   -3.150149000462733e-03   +3.914247668152755e-03   -2.275060341654036e-03   -1.463587112818208e-03   +2.411539322341416e-03   +3.220116201862932e-03   -3.260445191718139e-03; -4.445076305204791e-03   -1.133003558481946e-02   +3.021675538559902e-03   +1.404951794817942e-03   +1.409858220007028e-03   -2.405390132079775e-03   -1.825843715276480e-03   +1.818712590341556e-03   +4.797745020557361e-03   +1.187845097606630e-03   +4.908086780208835e-03   +7.601330509407895e-03   +5.616736208055897e-03   +4.119075057275886e-03   -1.500890156184773e-03   +5.259630045672817e-03; +1.453005335151710e-04   +5.678565462808048e-03   +4.949507630579157e-03   +7.218859787100849e-03   -6.832875176904839e-03   +5.846214880301509e-03   -5.424818619005291e-04   -4.508767556281095e-04   +4.963305375192219e-03   +1.599837527375584e-03   +1.709257024348784e-03   +8.140474371466776e-03   +1.018102565898404e-03   +7.175279448363109e-03   -2.524012881702509e-04   +2.635947523194858e-03; -3.486394518527344e-03   +6.721693518136030e-03   +7.878455683431221e-03   +2.569338672999904e-03   -5.322834010520570e-03   -1.890032491700705e-03   +3.649536234196425e-03   -2.100702427574634e-03   +7.624948199004482e-03   -2.888996564041922e-03   +1.133698106001116e-03   +3.465779263239953e-03   +2.062588717031305e-03   -4.743678643103662e-04   +7.096151466098620e-03   +1.656486385199265e-03; +8.504938061782041e-03   +2.156451101162164e-03   +4.626084143297789e-03   -2.958855380563266e-03   +4.992637245523057e-04   +6.152796003536236e-04   -8.482070964764517e-04   +7.369907086766610e-03   +2.673608120853096e-03   +2.085679195788086e-04   +9.918835391896409e-03   -9.234532698741213e-04   +7.824710943932080e-03   +4.884100708352659e-03   +5.127736811560374e-03   -1.488180057825263e-03; +6.583576603564013e-03   -2.082891721618904e-03   -5.638069651115492e-03   +3.293464631228792e-04   +7.438151537271923e-03   +5.258959303129797e-03   -1.092573608756075e-03   +1.236673294428433e-03   +6.050239340706520e-04   +1.553602124871959e-03   -1.898028412613392e-03   -1.819351420624015e-03   -3.375295174092936e-04   +7.702056067458839e-04   +2.137342565868091e-03   +6.378576231993297e-04; +5.592127521588581e-03   +1.004813962258459e-03   +3.331779582241045e-03   +4.308940226350334e-04   +3.732883766902802e-03   +2.642072745499425e-04   +4.194541197029249e-03   +3.952015811398102e-03   +7.237694008984330e-03   +5.456944629099618e-03   +4.922211239518787e-03   -2.810407521567663e-03   +2.714590585243910e-03   -3.591745297190337e-04   +5.161466600928924e-03   +1.526129961823989e-03; +8.623227400797134e-03   +8.160357007711842e-03   +7.151290071146650e-03   +5.707395457034939e-04   +3.891162083556871e-03   +5.185785491985349e-03   +2.739357279964520e-03   +8.420789866163026e-03   +1.504457933118695e-04   +1.936344776926955e-03   -1.442836223062710e-03   +5.966069979719652e-03   +3.649470579493446e-03   +3.314775026173252e-03   +8.414013765206002e-04   +2.050750989105433e-03; +1.144081361831002e-03   -9.956589732364393e-04   +3.180444881817418e-03   -4.539808354961646e-04   -2.566702184086500e-03   +1.546393177690297e-03   +4.254285436839156e-03   -1.315245205372893e-03   +3.626272151117493e-03   +7.576885061805908e-03   -1.238119283158593e-03   +6.302784161643901e-03   -3.525698740582441e-03   +2.307930719562854e-03   -5.014646520781561e-03   -5.175354434107795e-03; +3.046623913928356e-03   +1.859663956836384e-03   -3.277623707999425e-03   +7.805106115632985e-03   +8.619539129825096e-03   -1.079545385626986e-03   -1.430860929168484e-04   +3.074208436679253e-03   +3.969795608352414e-03   +3.494700541097252e-03   +7.576267771322575e-03   -5.211687958969140e-03   -8.556723095155626e-05   +1.818342116365938e-03   +8.464433882497627e-03   +7.179264695449298e-03];
L1E_L1I_iGABA_netcon = [-5.563574835613922e-04   +1.051011511653233e-02   +4.615443926088967e-05   +3.961045387006085e-03   -1.132207993987178e-03   +6.250454536140060e-03   +6.806376137712657e-03   -3.929175289090418e-03   +3.245136174815148e-03   -5.289222925426189e-03   +2.019239218895611e-03   +2.344899557297777e-03   +6.399683954406999e-03   +4.808441179483345e-03   +6.096584046954386e-04   +5.550748371644825e-03; +4.154277159148520e-03   +2.567517191790843e-03   +8.100399689914745e-03   +3.553523151565910e-03   +5.539257994674066e-04   +1.803944204828117e-03   -5.603385775014335e-03   +4.695042660621124e-03   +2.302839571189818e-03   -6.190328941060009e-03   -1.054076575342723e-03   +6.094770978609977e-04   -2.986443375597627e-03   +1.543334770424639e-03   +1.433537401789456e-03   +3.390876846950722e-03; +7.145038612744998e-03   +5.252644174718378e-03   +1.725403853566225e-03   -1.026997120589289e-03   -2.610880743801158e-03   +2.293173346989944e-03   +1.087034478937202e-03   +1.638366923660279e-03   -6.094581363104194e-04   +1.625992233755179e-03   +7.222804630610327e-03   +1.958038646733525e-03   +6.012751384149142e-04   +7.179367857880523e-03   +2.455926583795306e-03   -3.421767318420550e-03; -1.903709000905577e-03   +2.668868573676717e-03   +2.450497578832000e-03   -3.142310443424364e-03   -5.398715759056751e-03   +9.952842550078321e-03   +1.430917077000254e-03   +3.105645398899323e-03   +4.600843238681459e-03   +6.050383124301447e-07   +5.839332452601405e-03   +3.239601834377184e-03   +3.110645066930941e-04   -3.146199295946152e-03   -2.897244087061671e-03   +9.208569081653593e-03; +3.264997339716642e-03   +4.045278229752042e-04   +2.172675627690190e-03   -1.528671026670358e-03   -5.540541974258974e-03   +9.523159512526934e-03   +2.035870825571474e-03   +5.410522248356672e-03   -2.523478708710052e-03   +3.037756456441345e-03   +1.696011776875972e-03   -8.556237073811703e-04   +1.289556212342993e-04   +1.686280935704789e-04   +4.066826450038087e-03   +4.331755922416306e-03; +1.208536866946780e-03   +2.333193319333334e-03   -1.425434730191210e-03   +4.262938616525488e-03   +2.309054484948797e-03   -3.991157389098302e-03   +5.119199129957446e-03   +3.799908068507486e-03   +3.755100410069104e-03   -3.387551817309193e-03   +5.567742988000114e-03   +2.410012112783304e-03   +2.541929181018688e-03   +3.674101765634516e-05   +2.070529708281040e-03   -3.837182825764041e-03; +4.421016395369347e-03   +7.287075188690614e-04   +2.456637570273922e-03   +1.236543268967213e-03   +3.106237158321445e-03   -2.530419286103314e-04   +4.611580746811582e-03   +2.626439642818639e-03   +4.131025465818478e-03   +2.271635078294967e-03   +5.667646214878431e-03   +4.071848293313650e-03   +6.091962091931782e-03   -1.736473661407366e-03   +1.994319414678500e-03   +1.676802829295001e-03; +1.982879690465576e-03   -1.763621591723217e-04   +1.872424479311144e-03   -3.716284887017509e-03   +4.217990892914835e-03   +1.772830787842758e-03   +8.077732068167486e-03   +4.810171168469038e-03   -6.652679242180690e-03   +1.731327383601238e-03   +1.156516142277865e-03   +4.486407747190377e-03   +2.593996959056602e-03   +9.659703019862809e-04   +9.460676539323890e-04   +1.756916362480193e-03; -2.372208813667663e-04   -2.608399772898329e-05   +4.438620828923667e-03   +4.395951151872503e-03   +5.651680450276197e-03   +6.905000829922859e-03   +5.970649515986208e-03   +4.640615615307014e-03   +3.660503749032923e-03   -1.461030887120708e-03   +5.010389290219440e-03   -6.322538525611993e-04   +4.730790032342175e-03   +3.421344318050050e-05   -2.314637154606697e-03   -1.090012833651174e-04; -5.605679008963780e-03   +3.360971861207869e-03   -3.925151421454001e-03   +3.112124444792532e-04   +3.623955456875713e-03   +6.282299484961943e-03   +4.169351125155818e-03   -2.557313743510498e-04   +7.027431802984667e-03   +4.927099794926617e-03   +2.245552388487834e-03   +6.088682030727615e-03   +4.742766048286445e-03   +4.514942239214271e-03   +1.091463223086775e-03   +5.088496829551471e-03; +1.304209422442117e-03   -7.187163871533920e-03   -2.495221486731342e-03   -8.648401185460124e-04   +2.275245590835958e-03   +3.728353044193588e-03   +7.158380123098588e-03   +6.683379942052092e-03   +1.550170765387792e-03   -2.348832738735472e-03   +2.736728901200146e-03   +6.506854723035209e-03   +1.535360006096172e-03   +2.608570880795777e-03   -5.860170525992698e-04   +3.205267023458063e-03; -4.711337071240379e-03   -1.361225945431959e-03   +7.562971249208243e-03   -1.682675378315703e-03   +1.258759303409666e-03   +2.899682626755991e-03   +7.485273522063831e-04   +6.553305929236218e-03   +5.809230643991905e-04   +2.590058940504655e-03   -8.063690586298599e-04   -2.599015136021222e-03   -3.691234605141308e-03   +1.841127755466797e-03   +6.433258143704020e-03   -2.985066231424791e-03; +2.324965885890536e-03   +1.645487447786166e-03   +4.151719156546688e-03   -3.443443320852356e-03   +1.853817520996889e-03   +6.836605448010105e-03   -7.346100351963517e-04   -1.639903401452875e-03   +5.562866488437239e-03   +2.186837864306267e-04   +7.569703498207282e-04   +8.619262297714737e-04   +5.512579448598203e-03   -1.438538323046542e-03   +7.631974460711952e-03   +2.919490798086052e-03; -1.436793214466553e-03   +5.942894178112182e-03   -2.002886460213871e-03   +2.513608229785341e-03   -5.067974684192201e-04   +5.131091450265393e-03   +1.031127166364012e-02   +6.128924161045953e-03   -1.954149553002712e-04   +6.387547497446843e-03   -2.104872874800482e-04   +4.192618857579373e-03   +4.474507364267702e-03   +9.232084763468327e-04   +4.493125861365797e-03   -5.864148306811141e-03; +2.022102307797217e-03   -6.053824038662461e-03   +3.691643885480887e-03   -1.651198704213508e-03   +6.077145382994678e-03   +8.857700643175462e-03   +1.287496596849865e-04   -3.579240898907538e-03   -2.356160870788887e-03   +1.061119885818027e-03   -4.104199305690967e-03   +4.971143719175868e-03   -1.470716973051966e-04   +2.304442094655757e-03   -2.544514729131551e-03   -3.311565796175412e-04; +2.436319924991953e-03   +1.783044750295174e-03   -2.389748862348304e-03   +1.838402224080658e-03   +8.937686413255539e-03   +9.946890158191488e-03   -1.838641938979470e-03   +3.453170462677937e-03   +3.726524236762534e-03   -7.505591967938757e-04   +1.809710796496728e-03   +3.425201436704615e-03   +4.201506792584515e-03   +5.780143197649723e-03   +3.027007836384031e-03   +9.559870356302270e-03];
L2I_L1I_iGABA_netcon = [+4.574676031866546e-03   +7.098927342447355e-04   -4.780008104391409e-03   +6.767268824974453e-03   +6.303079174778058e-03   +3.369559749556840e-03   -9.650874870125101e-04   +9.321865911885603e-04; -1.717017822231192e-03   +7.028502794860891e-04   +1.516603763397629e-03   +1.187499312174056e-03   +2.119786179178005e-03   +1.036254863803249e-03   +1.169250173970224e-03   -1.682485881068389e-04; -1.097655174747568e-03   -4.469467597910140e-04   -1.824191842776023e-03   +5.005103588591980e-03   +5.941997113890287e-03   +1.141467765042498e-02   +1.843445947112767e-03   +2.296207727885892e-04; -2.435217606248596e-03   -2.638159568164336e-03   +4.271228215524382e-03   -1.601574619663858e-03   -6.044753984080302e-04   -8.158400463778191e-04   +2.705265472359585e-03   +5.912437150476823e-03; +3.347742485593037e-03   +7.580412739333832e-03   +5.504867775082821e-03   -1.515775046606208e-03   +6.019143377493668e-03   +6.736596758782447e-04   +7.695432172159448e-04   +2.805260808525249e-03; +7.746382836624957e-03   +9.769878532901401e-04   +1.587086888872733e-03   +4.717625617456742e-03   +3.277099220710606e-03   +2.085298831976884e-03   -2.852635774301573e-03   +8.480218379597539e-04; +1.191520151905498e-03   -4.436073761819545e-03   -3.683781693716629e-03   +4.269507474211971e-03   +1.831071780463604e-03   -5.590457442731775e-03   +2.498558933228490e-05   -2.254750436527581e-03; +2.528364644571296e-03   -4.458612492608077e-03   +1.239197544825785e-03   +3.866825520124135e-03   +3.132349223812813e-03   +9.556679768514511e-03   +4.274865208815570e-03   -2.074627236061300e-03; -2.827320305262950e-03   +3.467027805121186e-03   +3.801538569555928e-03   +2.641918037404769e-03   -4.283378429249401e-04   +1.866562951572790e-03   +1.118010072652400e-03   +1.090665859212430e-02; -8.655109605168892e-04   -1.052541560122325e-03   +2.982689287451260e-03   +5.299511866210150e-03   -1.323695291586753e-04   -1.866771193593898e-03   +4.486381409241376e-03   +4.165050909167657e-03; -3.372089887890199e-03   +2.189802134123450e-03   +8.599319615925249e-03   +3.131335055439023e-03   -2.405571646591944e-03   +1.922526609018700e-03   +2.540563061140720e-03   -2.462882336018615e-03; +9.602880366218380e-03   +2.707741408193676e-03   +2.793321768096419e-03   +2.608969926380638e-03   +6.671048574359200e-03   +8.798521916892697e-04   -5.493133002387053e-04   +9.494697886255733e-04; -3.043598492937054e-03   +5.620487533415779e-03   +3.757326791687231e-03   -1.531222401666929e-03   -1.360198051597568e-03   +1.111769716453025e-03   +5.051449295172077e-03   +3.494433532501266e-04; +4.223124203618024e-03   -1.156606452923902e-03   +6.861143233607371e-03   +2.186668580053679e-04   +1.108754219046534e-03   +3.007631942916112e-04   +1.060641923646151e-03   +1.633286701933272e-03; +9.779036244486139e-04   -1.993203588840377e-03   +6.143792472206337e-03   +1.988327944218273e-03   +2.866326085193688e-03   +2.376389673071096e-04   +4.159964256452311e-03   -6.081001623608722e-03; +2.749831878331690e-03   +5.399279096565309e-03   +6.005650870296570e-03   +9.495700723999068e-03   +1.585214521674609e-03   -3.236895893817146e-03   +3.010421136083723e-03   +6.147205760818890e-04];
L1I_L2I_iGABA_netcon = [+2.821192551010661e-03   +5.225741511918300e-03   +2.780026586216772e-03   +8.087094276273622e-04   -3.966214304272194e-03   +5.730663351196731e-03   +7.853003374945461e-03   -3.100442827533359e-03   +9.668995975447348e-03   +8.587334568707134e-03   -4.351203046750565e-03   -7.868090581320244e-04   +5.380018683207403e-03   +5.012207843187453e-03   -3.088345640528961e-03   +4.092887737899933e-03; +3.411728248498512e-03   +2.758366600929693e-03   +2.562120839012210e-03   +3.155038798764930e-03   +2.347133387600583e-03   +7.169567157233123e-04   +4.671133072584153e-03   +4.033326724870114e-03   +2.720969451037366e-03   +6.808396531832119e-04   +6.337570843156939e-03   +5.451920919061882e-03   +5.258386480799145e-03   -1.379411241051003e-03   -4.994589004355711e-03   -4.111437690817460e-03; +4.530348310038618e-03   -2.058527235711456e-03   -1.357829855115257e-03   -4.088935741223165e-03   -6.000834839224455e-04   +6.009379062029402e-03   +7.768718043377480e-03   +1.254344780758909e-03   -1.879968295183394e-03   +7.052119437021815e-03   +4.009940524426893e-03   -2.937342353726595e-03   -1.384840028666297e-03   +4.274730372485963e-03   +1.027161584031799e-03   +1.461783688715897e-03; -2.555654734119268e-03   +3.233135386163324e-03   +5.778883370108394e-03   +2.132204813916341e-03   -4.185653919302612e-03   -1.893290159316489e-03   +1.363965276833447e-03   +3.706516936633323e-03   +1.126270757094114e-03   +5.202411041679109e-04   +3.618678040970785e-03   +5.253444768151883e-03   -6.547616100936829e-05   -2.970678641490698e-03   +5.308430298644442e-03   +5.022701851728070e-03; -1.252582673581132e-03   +7.743489523218041e-03   +4.149692182663348e-03   +3.222772181248485e-03   +2.077780790272045e-03   +4.700462336598280e-03   +5.029191036446634e-03   +9.825929077383120e-03   +1.388660294245564e-03   +2.072172297526543e-03   +4.404106931583334e-03   -3.331102312937507e-03   +4.692254298525879e-03   +3.156535032819762e-03   -2.052275924022518e-03   -5.215445411299687e-04; +4.996307474593439e-03   +4.578843350611475e-03   -1.391938503678330e-03   +2.325544991154734e-03   +9.431856493009674e-03   +4.874565584215660e-03   +9.128559710927962e-03   +7.485659595353636e-04   -1.033782135700673e-03   -1.711309224022023e-03   -1.696427456249013e-03   +7.528365742729188e-03   +5.180033284246330e-03   +2.829308607728107e-03   +9.238142916218592e-03   +2.825073384468200e-04; +4.282319751409357e-03   +6.825075878852255e-03   +4.877438533314786e-03   +2.657742662929988e-03   +1.216926843737504e-03   +5.681625244754886e-03   +3.121056910171855e-03   +4.369695416013159e-04   +5.020994604709610e-03   +7.559287339595860e-03   +4.191904538108776e-03   +2.982781291761813e-03   +3.781809570343053e-03   -4.029905415290276e-03   +3.396594493074939e-03   +1.755965826669960e-04; +1.629618924541735e-03   +3.843376657762479e-03   -3.243567188144633e-03   +2.987891049466614e-03   -2.534672148252340e-03   +2.747454460381002e-03   -1.695669331986747e-03   +5.329878368424471e-03   +1.819935305102623e-03   +2.418055809740598e-03   +4.947622828382413e-04   -2.658278496321452e-04   -2.003310338111696e-03   +2.508405500486635e-03   -1.568062046229550e-03   -8.062939658996604e-04];
L2E_L1E_iAMPA_netcon = [+3.048935221827793e-03   +9.025310464343449e-04   +2.655886940990820e-03   +3.253637394003384e-03   -1.753323427699574e-03   -1.704410453626810e-03   +9.687994786159532e-03   +4.413674253513665e-03; +5.439740253738633e-03   +2.030166917030784e-03   +2.636475004769764e-03   +2.348841333371172e-03   +3.105829677640334e-03   +1.980184136939859e-05   +7.093080644626984e-04   -2.245570725005253e-03; -1.971171756496966e-03   +1.872237654047104e-03   +2.763889532899974e-03   +1.343117452048763e-03   -7.198741065643017e-05   +8.183322591112910e-03   -2.071909388091453e-03   -3.878089487400697e-04; +1.298812056939047e-04   +3.508625489654699e-04   -1.885554709666226e-03   +6.240272025779170e-03   +8.359917837452369e-03   -5.155160681255520e-04   +6.976718853360943e-04   +3.660040778653752e-03; +1.561866613672440e-03   +8.127765458897736e-03   -4.458411892278431e-03   +2.093943144289510e-04   +1.397744096271350e-04   +2.466680745830788e-03   +4.173090705413636e-03   -1.502765980889781e-03; +3.334320255786156e-03   +3.732498420548701e-03   +8.120265464454601e-03   +8.495703047697315e-03   +4.862630858819979e-03   -4.584684003840878e-03   +7.441811533516107e-04   -2.268658561013035e-03; +1.661258266927625e-03   +5.381534146762872e-04   -4.705319938687697e-03   +2.176598458610024e-04   -2.316158804791066e-05   +2.367147564461986e-03   -4.433147187789080e-03   +6.681016752563583e-03; -4.785811412888509e-03   -3.573408819461062e-03   -4.693477264144930e-04   +3.791526785393634e-03   +5.735435092664036e-03   +3.131030979760031e-03   +7.864673262539435e-03   -3.420795276140072e-03; +5.328331926492028e-04   -1.245959493062015e-03   -2.857864387506785e-03   -4.477107454575525e-03   -7.967370288536262e-03   +8.969986115675940e-03   +3.961802305580990e-03   +6.206940648111815e-03; +3.869170512019846e-03   -4.235931167657993e-03   -1.882526833035848e-03   +6.515730172544782e-03   +9.742098329516105e-03   +1.074873025241021e-03   -1.926612857667824e-03   -1.439343043229583e-03; +5.272594147214747e-03   +4.850396137976446e-03   +1.571278006575084e-03   -3.046948189983295e-03   +7.462925337440641e-03   +6.948555477776903e-04   -1.266928298535913e-03   +1.590060791373003e-03; -1.418856391956813e-03   +2.185766481775151e-03   -3.227205335102883e-03   +1.728304240642096e-03   +3.922686241146701e-03   -7.806058352064140e-04   +8.390910273644938e-03   +3.962015610578534e-03; +5.249583722530669e-03   +1.139700015709017e-05   +5.080174549066037e-04   +2.805916049831809e-03   +6.363744868913770e-03   +1.370523440342240e-03   +5.058785822898422e-03   +6.998099927164684e-03; -1.046137819376952e-03   +3.183604830635335e-03   +1.432056425231222e-03   -2.079930749988803e-03   -3.054738241188337e-03   -2.418874268489054e-03   +5.726979435169725e-03   +1.782795933744762e-03; -8.850789827447698e-04   +6.960612482301646e-04   -2.218249248684706e-03   +4.938364971965001e-03   +2.942553651503186e-03   -5.223175951590863e-03   +2.597522400162052e-03   +1.957044215487968e-03; +5.300753328264529e-03   +3.204098795387903e-03   -8.307410852512606e-04   -1.016723622966107e-03   -5.386387078685654e-04   -5.225208658667029e-03   +3.665920909334931e-03   +4.577913271682235e-03];
L1E_L2E_iAMPA_netcon = [-2.070884029209144e-03   +4.244955729720876e-03   +1.487522941582930e-03   +4.436129600010200e-03   +1.087770890851375e-02   +1.007741083955745e-02   +5.325940396530098e-03   +4.984163429099765e-03   -4.022759240402384e-04   +1.669403171395054e-03   +3.080552855844945e-03   -2.480459915256665e-03   +4.577118540843635e-03   +1.226812921205677e-03   +7.709661811650590e-04   +4.413006058333561e-03; +6.174274302679536e-04   +8.156952543981790e-03   +2.749405838264423e-03   -2.441059511329221e-03   +3.803719839705467e-03   +5.398109206967150e-03   -9.238239854764171e-04   +3.050018441375541e-03   -1.907875122921778e-03   -2.933406147338826e-03   -2.061806200617440e-03   +1.811315640704476e-03   -2.295858627989826e-03   +1.410928072801994e-03   +8.035978177020101e-03   +1.329079169195055e-03; +4.003429517476510e-03   -2.460723411068300e-04   +6.838005548266605e-03   +7.537599177202006e-03   +5.594139107331429e-03   -3.189960252269519e-04   -4.270803600457056e-03   +5.698773123934904e-04   -3.026564532785290e-03   -3.234501592679335e-03   -2.999331139578955e-03   -2.065514561406586e-03   -6.238063274606003e-04   -7.937942482124993e-04   +6.542803988314201e-03   +5.672777029299741e-04; -4.135107090908914e-04   +2.386061140057240e-03   -4.205861191486201e-03   -8.468004754483060e-04   +2.738672889670086e-03   +5.773241464447815e-03   +6.985315787640238e-03   -3.096345299411815e-03   +1.275210025075779e-03   +3.716325014731557e-03   +3.146863661034725e-03   -3.746958749785784e-03   +2.643485849675251e-03   -4.436938654463188e-04   +4.699834209815005e-03   +3.433368846209838e-03; -2.889902902979065e-04   +9.552861260550971e-04   +3.529528074393629e-03   +3.499136081132449e-03   -1.925246068509859e-03   +2.001422130239608e-03   +8.985683278158308e-03   +3.971550280533159e-03   -1.514255873338827e-03   -1.839166585116290e-04   -7.012083814901392e-03   +8.090260456693520e-03   +3.183111604536124e-04   -3.073223271459112e-04   +6.705876363614464e-03   -2.254630016587178e-04; +3.226441682638404e-03   +1.077952256129264e-02   -4.053136661418635e-04   -1.361111478878821e-03   +1.353919778305346e-02   -1.984244000311192e-04   +2.713354359958100e-03   +5.674823920648448e-03   -5.858998009656781e-03   -3.108129235893567e-03   +5.765385987603129e-03   +3.825127302649721e-03   +7.512103137355395e-03   -3.711240233005447e-03   +4.177108284389977e-03   +3.373063054160708e-03; +2.245238278184142e-03   +4.148593542783646e-03   -2.890886137772870e-03   -7.933880809541125e-04   -1.680505370891795e-03   -2.585369869948527e-03   +6.343290905352427e-03   +4.109735619138848e-03   -1.101766236964041e-03   +1.545937884291519e-03   -9.142020446647402e-04   -3.766658874427027e-03   -2.422073260176285e-03   +9.389571631333445e-04   -2.395353448898510e-03   +5.993496474528914e-04; -5.528182309666539e-03   +4.985632765297980e-04   -1.876537313672666e-03   +1.305864060802651e-05   -3.381238443376869e-03   -4.217063388313669e-03   +2.648253181988196e-03   +7.508031089752277e-03   +2.506217999099598e-03   +1.275270105599245e-03   -2.656135701193965e-04   +1.075423787533652e-03   +3.752582892522918e-03   +1.244572118547925e-03   +3.005208371074342e-03   +2.909915787137955e-03];
L2I_L2E_iAMPA_netcon = [+3.457762316795027e-03   +1.124839930157575e-02   +3.336777063982167e-03   +6.956269578788086e-03   +1.937197150044242e-03   +3.379914717251261e-03   +1.120160095599905e-03   +3.380522032253124e-03; -6.581237443158474e-04   +1.314512566354430e-03   +4.446115298652193e-03   +5.621140456683275e-03   +2.498786421229153e-03   +9.939517690899600e-04   +3.368644012310056e-03   +4.042833158546169e-03; +4.340684203416552e-03   +4.298652401756187e-03   +4.702480676288306e-03   -5.264152520585601e-03   +6.689297725380548e-04   +8.056047562188243e-04   +1.466191926315187e-03   -2.568814217892071e-03; +4.169827850182692e-04   +4.540002306356380e-03   +8.930552549272915e-03   -2.132547338284651e-03   +7.236340765339018e-03   +1.758706365161380e-03   +2.836364500847323e-03   +1.431884524427198e-02; +4.692180568774855e-03   +1.502218682122150e-03   +3.395488873696122e-03   -9.225146221854429e-04   +1.791864673587752e-03   +5.225381346803759e-03   +3.273841275356885e-03   +3.342176417861000e-03; +2.520003468126213e-03   +1.692253302171764e-03   +3.354619518108487e-03   +1.162267913652369e-03   +6.501402265513031e-03   +5.157617467989188e-03   -2.238783748483011e-04   +8.619269906862530e-03; +2.312673187931616e-03   +4.494374922565611e-03   -2.759122568287215e-03   -7.809320112549850e-04   -2.288050203321628e-03   +7.551506077982544e-03   -5.149599315487121e-03   +5.636937117480200e-03; +3.392244979455148e-03   -6.339884096933442e-04   -9.189309751378633e-04   -5.150860711667307e-03   +3.343758572878495e-03   +4.534678906661250e-03   +3.988033778768337e-03   -2.768859842605464e-03];
L2E_L2I_iGABA_netcon = [+6.130455878106582e-03   -2.481873308984047e-03   +3.834110695244466e-03   +3.520501563128988e-03   +7.793509379868518e-03   +5.701765722292100e-03   +2.632221704673066e-03   +3.668819919036278e-03; -6.530137284271475e-03   +5.401027088320934e-03   +6.723723858593522e-03   -3.024034856341059e-04   +7.365930715263060e-03   +5.658825894412064e-03   +7.345054936465152e-03   -2.153922098239625e-03; +7.461387869387126e-03   -3.961338376947367e-03   -3.555589926874191e-03   +2.517530929015748e-03   +3.522391431632294e-03   -1.400383486483036e-03   -5.815432972952998e-04   +3.693441067552118e-03; +4.798140219498113e-03   -3.212413044938846e-03   +1.680930666388537e-03   +4.196113041113917e-03   +1.633230535151053e-03   +2.153608465916442e-03   -1.018214442655807e-03   +2.225297441007400e-04; +1.463559419699349e-03   +3.346686353631293e-03   +4.045777738169594e-03   +8.527369604677924e-03   +6.157001221893903e-03   -1.920545559541623e-03   +5.036389479740407e-03   +9.570483222077768e-04; +5.200692142413321e-03   -6.658824548710065e-03   -5.322871563882550e-04   +1.865752592827324e-03   +2.691450332656492e-03   -1.729760799060267e-03   +5.023611468923170e-03   +2.729845841385381e-03; +6.666068379747070e-03   +3.346815868208548e-03   -2.082322038517012e-03   -1.487101565076836e-03   -2.128153384344007e-04   +1.933812014392020e-03   -2.419217448644227e-03   +1.513964510648367e-03; +4.130198551202641e-03   +3.703060314412674e-03   +3.572683699042426e-03   -6.571091184200545e-03   +3.819255096346585e-03   +1.767795248550096e-03   +3.730559512173572e-03   +2.268848903992311e-03];
L3E_L2E_iAMPA_netcon = [+6.792755121268124e-04   +9.436909656124717e-03   -1.622553140459997e-03   -3.422658809296217e-03   -4.287552330919490e-03   +2.543271670925069e-03   +2.815722314737550e-03   +5.818990688057283e-03   -3.118337103928563e-03   +1.308129645642526e-03   +2.348955631757303e-03   +5.813379018648550e-04; +4.415892440458651e-03   +8.820449218504781e-03   +5.526966040762335e-03   +2.343055146920733e-04   -2.790752618172231e-03   +2.758986125517753e-03   +2.436027655312338e-03   +4.416548078828337e-03   +5.309269717221436e-03   -3.072412677054624e-03   +3.409706936331276e-03   +2.867830689866006e-03; -1.960569823824706e-03   +2.147893332892863e-03   -2.845144558922304e-03   +3.622951131544245e-04   -4.762272881158891e-03   +2.450218821886003e-03   +8.432952950088339e-04   +8.179142851232023e-03   +6.180732349512311e-03   +5.725102623575055e-04   +3.394664213729902e-03   +2.946897044714633e-03; -7.280130322500406e-04   +2.819347111470284e-03   +2.832003976151947e-03   +7.790617731807398e-03   -9.011217693144423e-04   -7.806606042578097e-04   +6.591015774176361e-03   +3.406935692755020e-03   +5.414994811451459e-03   +7.102253009783013e-03   +6.989752669081088e-03   +5.627000241463890e-04; +3.489511675053479e-03   -3.829768040623299e-04   -2.298078765045652e-03   +1.066804450019749e-02   -2.830250390816191e-03   +2.102617102270784e-03   +3.548109416191325e-03   -1.215623863809953e-03   -3.572015687539704e-04   +1.142293476002322e-02   +4.729136172972368e-03   +4.507070751870752e-03; +2.718677520492494e-03   -5.257537399986105e-07   -3.946182587077034e-03   +1.059883612220567e-04   +2.158300984665596e-04   +5.962032405453795e-03   +5.725399869159487e-03   +7.822736106781740e-03   -5.597422288444895e-06   -2.132333807171507e-03   +6.265198386774038e-03   +4.653520044096757e-04; +8.856269582542011e-03   +5.702467280970702e-04   +3.431461463730339e-03   -9.321121046376718e-05   +5.464101777259606e-04   +5.092658108710200e-03   -1.698913903822383e-03   +9.860809280137991e-03   -1.179444230040531e-03   -1.487205457302029e-03   +4.991097970516374e-03   +1.981966633902424e-03; -2.982158303928228e-03   -3.486122689709689e-04   +6.951615536259736e-03   +4.866516516712063e-04   +6.884079500246040e-03   -6.449299211022701e-03   -3.102436487546238e-03   -1.204758865384147e-03   -1.356817678095872e-03   +6.119102819586738e-03   +4.166594512802831e-03   +1.892093186698112e-03];
L3I_L2I_iGABA_netcon = [+3.804878711895951e-03   +7.643710878591808e-03   +1.189950648942830e-03   +3.409798303612813e-03   +6.573863351918526e-03   -4.118487049900941e-03   +2.007788900335679e-03   -1.902755606175491e-03   +1.627017564844859e-03   +3.815072495146024e-03   -3.743258505224164e-03   +4.629050135171889e-03; +2.046592918274747e-03   +6.873794267275900e-04   +2.095112590802310e-03   +1.007135159579421e-04   +6.537177474762176e-03   -1.251994648390907e-03   +3.754268639777982e-03   -5.590126438688512e-03   +4.444409616175852e-03   +2.678801267102021e-04   +9.291623838011602e-04   +3.904553144157271e-04; +2.275399241239196e-03   +1.247427135281618e-03   +1.757713649555848e-04   +5.409707908607453e-04   +1.392724650290113e-03   +1.177202804735276e-03   -5.983761237861873e-04   +4.115727712681335e-04   +5.267693483376841e-03   +1.028949349486676e-03   -3.011073983487319e-03   +3.184290749594368e-03; +6.866782164082210e-03   +5.609057356939669e-03   +7.302184108614586e-04   -1.212783552538124e-03   +1.001823506373856e-04   +6.191951232615490e-03   +1.718366069116512e-05   +8.612072854002522e-05   +7.020506187008138e-03   -4.749240451686353e-03   +2.961282092629049e-03   +3.959658678503170e-03; +1.103868582344740e-03   -7.844710476223701e-05   +1.029295563184632e-03   +2.898435767686836e-03   -4.674912194629382e-03   +8.377412400572616e-03   -2.220817446166040e-04   +4.183506019564675e-03   +5.987739755854737e-03   +5.633249310751793e-03   -5.600918081845704e-03   -1.482439549856503e-03; -4.848464960851983e-03   -1.180350525938063e-03   +2.829296528983684e-03   +1.641836399781198e-03   +1.897166199079632e-03   +3.161001234676825e-04   +1.286131338079900e-03   +3.784917848794990e-03   +2.601424471575544e-03   +5.264424238506769e-03   +1.251624829381672e-04   +1.935804687861344e-03; +4.235557898827376e-03   +1.834971773058219e-03   +3.164325578594030e-03   +4.704150081437904e-03   +5.055158282761893e-04   +4.425748412523111e-03   +1.166627449701095e-03   +4.936650562179082e-03   -4.304929601251703e-03   +8.671722486467194e-03   +1.887144524882238e-03   -1.489005806085737e-03; -1.572398341345020e-03   -4.549378630181797e-03   +3.141110496041688e-03   +1.361137343472278e-04   +7.309114979595045e-03   +1.272115039026086e-03   -4.165169975959931e-03   -1.299286150274250e-03   +6.320824517810147e-03   +1.350146132857702e-03   -2.333265471106934e-03   -2.613856329709989e-04];
L2E_L3E_iAMPA_netcon = [+2.034402024690723e-03   +1.824398099521777e-03   +9.894531315056557e-04   +7.800448233106767e-03   -1.935948326122251e-04   +4.429964703656696e-04   +2.273527017240881e-03   +7.509973525683836e-03; -5.340867638443615e-04   +3.986610457691651e-03   +7.183873548520564e-03   +1.025448747157605e-02   +2.798631628241278e-03   +3.841326067186111e-04   +2.043343988877531e-03   -1.171401753695209e-03; +2.353649437483756e-03   +5.605306627673684e-03   +4.269003039075107e-03   +3.236552183173206e-04   -2.080406284548254e-04   +8.313953341480256e-03   +1.169521212286596e-03   +6.555007488429152e-03; +5.241311045268411e-03   -3.373283488146181e-03   +2.704021826327501e-03   +1.207166006904467e-03   +1.898692593907121e-03   +4.646322626488892e-03   -6.674118194727413e-03   +4.113509047595776e-03; +1.786230527009086e-03   -4.303965793023824e-03   +1.533480687661366e-03   +2.068963461245705e-03   +4.901242250939927e-03   +2.018551420001072e-03   +6.256007732304965e-03   +2.172748035565312e-03; +4.297675309963795e-03   +3.858525545688920e-03   +3.681521888895109e-03   +6.215430119513260e-04   +5.716382301956587e-03   +8.776105213123582e-03   -1.152309553625963e-03   +2.793496425692097e-03; +5.939676583177370e-03   +4.063680781412248e-04   +1.605384136131245e-03   -3.792178365962401e-03   +1.888032027628574e-03   +1.720482095302992e-03   -1.806812894786171e-03   +2.394819813701869e-03; +1.038885686017326e-02   -4.731888041238361e-03   -9.411423871316653e-04   +1.832592417787337e-03   +3.123171527275884e-03   +2.866038750831370e-03   +1.987145125133947e-03   +6.703513208213641e-03; -2.730156318216626e-03   +3.943075724597169e-03   +2.262831664172214e-03   +7.203054221367052e-03   +5.822673571716589e-03   -4.282035617158834e-03   +9.309057316842955e-04   -3.698055951106593e-03; +1.655787772088870e-03   +7.171832783836801e-04   +3.847024757956280e-03   +2.921366097775749e-03   +5.101131593727183e-03   +2.742732723323209e-03   +2.469178329904881e-03   +2.719168077853289e-03; +9.940646495583886e-04   +1.566607705528925e-03   +3.070536996977086e-03   +1.370264941345234e-04   +1.259390101948570e-02   +5.015279117422171e-04   +4.475404889603366e-04   -2.410225143477109e-03; +6.020469246913805e-03   -1.249640955878237e-03   -1.029372808109800e-04   +4.170451928566165e-03   +6.747655618149509e-03   +1.291133185775168e-03   +2.931030901507887e-03   +5.224145254608402e-03];
L2I_L3I_iGABA_netcon = [+7.164961684249673e-03   +1.494898172415016e-03   +2.146372547241255e-03   +6.317689098471022e-03   +8.956230502084349e-03   +2.649019114183847e-03   +3.138969346974139e-03   +1.671965561349228e-03; +1.715323579739260e-03   +8.302192563709361e-04   +1.307220614970733e-03   -3.000842600742320e-03   +1.056292244815083e-03   +2.875396869485454e-03   -2.963311286231522e-03   +1.456533351052098e-03; +2.002565363534489e-03   -1.720464573944058e-03   +1.232758417384668e-03   -1.607898971290911e-03   +4.348539974908871e-03   +9.486217816565176e-03   +7.129587722807403e-03   +3.541761170177393e-03; -2.901987943092602e-03   +5.576806661363935e-03   -1.708686190591168e-03   +5.874386963936663e-03   -3.475193982989194e-03   +1.312867937669820e-03   +3.019696034925694e-03   +2.714129530842956e-03; -1.518362238984164e-03   -4.944322971781354e-03   -2.880065295350522e-03   +6.216388348214117e-04   +8.031776965770138e-03   +3.948373746110641e-03   +5.551647512400766e-03   +5.315417154529461e-03; -1.138312742923107e-03   -5.320125674562556e-04   +3.456187462309647e-03   -1.223793303382565e-05   -2.885148919410579e-03   -4.389960770900828e-03   +2.879059109743214e-03   +1.057334120135479e-02; -2.177175455368626e-03   +1.357670694714408e-04   +3.229690406401651e-03   +3.558966818891536e-03   +1.625137671682348e-03   -3.277567080818429e-03   -1.235599544392597e-03   +2.003801899207860e-03; +2.438684628274426e-03   -5.526239103126043e-04   +9.038662707313067e-03   -2.561563035253215e-03   +1.879569370242304e-03   +1.054619015735428e-02   +6.690856768010293e-03   -1.333490647996054e-03; +3.263700499902692e-03   +2.359437833606011e-03   +3.741763072947922e-03   +1.554023354752043e-03   +1.550338917971497e-05   -3.267360250447132e-03   +3.256598157249284e-03   +6.541395890366447e-03; +8.322801471281721e-03   +2.417831514250694e-03   +2.762965041189387e-03   +2.004888603331300e-03   +5.445561713042312e-03   +8.935391729667111e-04   +3.712354817179600e-03   +2.128142252325465e-04; -2.034562603608803e-03   +2.786650359140824e-03   +3.880034685273722e-03   +1.363861522910110e-03   +1.157906980820702e-03   +8.469142532346926e-03   +3.327456635226413e-03   +2.679466862811038e-03; +1.678264824308819e-03   -5.895200284922987e-03   +2.156336326809953e-03   +6.685996849529158e-03   -1.807302830341599e-03   +1.659339990625702e-03   +4.113622092537501e-03   +7.152881506463179e-03];
L3I_L3E_iAMPA_netcon = [+5.675449875096454e-04   -3.027693427067800e-04   -4.181729971544554e-04   +3.204668834531596e-03   +1.053864459521128e-02   +1.052468899456206e-03   +2.772702437743715e-03   -1.291247289729247e-03   +3.858151716384271e-03   +3.444489333205351e-03   -2.745322605828513e-03   +1.184292368889251e-04; +3.346327121638245e-04   -4.157064313878681e-04   +4.356497027953858e-03   +6.569729929753599e-04   +4.296512692393611e-03   -6.937499145055309e-04   +2.355274578527863e-03   -1.662732564764611e-03   +1.811162280082256e-03   +2.717893880465078e-03   +1.709225828309673e-03   +6.631318720682530e-03; -2.986960165097576e-03   +3.003602720195036e-03   +4.629253465869025e-03   +3.550043742442230e-03   +1.955990434676915e-03   +4.543467404103104e-03   +1.151835468007975e-03   +7.759122398645618e-03   -4.343201051241701e-03   +4.696487510065334e-03   -2.330732848063029e-03   +4.739479765798071e-03; +5.397828636878590e-03   +4.961100671059329e-03   +6.180951739927741e-03   +6.245897921535015e-03   +7.137373847670684e-03   +1.500431026847384e-03   +2.173156900768103e-03   +2.135516213700295e-04   -1.153951164755911e-03   +6.906963221636025e-03   +2.075706543674105e-03   +8.670861782836433e-03; -2.731824667496001e-03   +8.570033731101054e-04   +1.848233059929480e-03   +1.993064688126298e-03   +1.805511181809996e-03   +2.658232306369887e-03   +1.188725372515111e-03   -2.694336635901603e-03   +7.123668900194961e-03   -1.679015263136521e-03   +1.427303306876002e-03   +3.305869204322410e-03; +1.241596756597297e-03   +8.313290776159173e-03   +2.205480331472467e-03   +4.599149895070486e-03   +9.887547400325620e-04   +4.217028809393294e-04   +7.774980469831449e-03   -1.708634063879453e-03   -1.609620134733259e-03   +3.097466111968618e-03   -2.263962664647817e-04   -3.497743522562362e-03; -2.613600561428285e-03   -4.014745088250855e-03   -1.100547090659662e-03   +1.753841470276480e-03   +8.253102830556471e-03   +8.191016771528382e-04   +1.231215931647795e-03   +7.666771674547982e-03   +3.725263437392710e-03   +8.488543081423548e-03   +3.608318301152238e-03   +7.214797819441292e-03; +4.787787798601920e-03   -1.935606160465456e-04   +6.835509228719727e-03   +6.981589533974970e-04   +3.962206695694755e-03   +3.688752852464045e-03   +7.147242268599775e-03   -3.246763470940190e-04   +3.578178064513071e-03   +3.249287817405365e-03   +7.179967586156218e-03   -1.289429252347059e-03; -1.480949669749089e-03   -3.217730372549411e-03   +4.129099676549411e-04   +4.622925877551883e-04   +5.188357141381277e-05   +4.319191766668734e-03   -8.737431852954293e-04   +3.726864703849705e-03   +8.959347240683761e-03   +1.349644635347266e-03   +5.542565773895388e-03   -5.173550133607534e-03; +7.814412161391872e-04   +4.140451404331350e-03   +6.103222737171180e-03   +9.127351448910464e-04   +1.367348925953599e-03   +1.382736310471166e-05   +1.136753890420472e-03   +4.592758337929771e-03   +4.378557912623502e-03   +2.003261139208371e-03   -5.258827416701249e-04   -3.476354578332408e-03; +9.716606330253651e-04   -8.310280557015828e-04   +6.596571819015773e-03   +3.632649189130466e-03   -5.083584989899153e-03   +5.498618992932757e-04   +1.585980915166757e-03   -9.077893705982872e-04   -1.348408356449206e-03   +2.167490254925786e-03   +2.566220586834290e-03   -7.517420634834120e-05; -4.147537986257595e-03   -1.716269089683922e-03   -4.530265931092181e-03   +3.888351418067470e-03   +6.608703611652622e-03   -2.134766500164898e-04   +7.641468344551839e-03   -7.702370737581358e-03   +8.775178906363123e-04   -1.587284119954427e-03   +3.406714099059027e-03   +3.196312499596093e-03];
L3E_L3I_iGABA_netcon = [+2.030027941132729e-03   +1.816633955495023e-03   -3.269228900686849e-04   +8.240585249490087e-03   -2.904794008333854e-03   +7.900879928562756e-03   +2.778845400487730e-03   +5.340859568239122e-03   +1.612137512249655e-03   -4.992004565617838e-04   +1.354330456932625e-03   -3.513893633211319e-03; +1.382267173403790e-03   +5.268218642012080e-04   +1.525633620155625e-04   -2.234388528240966e-03   +3.393899507944022e-03   +2.810641682270232e-03   +1.219766486159306e-03   +3.830065734523746e-04   +6.344247480377155e-03   +1.071125032691533e-02   +4.073693107811680e-03   +3.739778275649311e-03; +2.995140374970859e-03   +3.618958491139661e-03   +3.475739899123882e-03   +3.408923965762078e-03   +1.991237056159625e-03   +4.826375418800343e-03   +4.959679892835267e-03   +6.144043868182548e-04   +4.092243555845147e-03   -5.240591711882811e-04   +6.473024577973599e-04   -5.649765794101235e-03; -2.274113803710225e-03   +2.740565238524487e-03   -6.283521761227174e-04   +1.068775826747565e-02   +6.753707324669465e-04   +3.903006899054038e-04   +5.370098890519848e-03   +1.135488459347998e-03   +1.387269959503419e-03   +3.296902022882431e-03   -3.492557930338995e-03   +5.252568559990135e-03; -5.603717479387949e-04   +1.031685377989196e-03   +2.691963464549808e-03   +2.203045188527982e-03   +5.011076218278994e-03   +3.745872551576375e-03   +2.531110820613728e-03   +4.835829316632085e-03   +5.093933708848680e-03   -1.953930655776424e-03   +2.978865084166569e-03   +3.911408462220081e-03; +3.855730392775756e-03   +1.547713905354027e-03   +7.476247438066775e-03   -4.113229479999181e-03   +9.861169964626262e-04   +8.828128381687318e-03   +3.337933202415239e-03   -1.078871422715550e-03   +2.895563514227024e-03   +1.566446352041618e-03   +3.787954778066375e-03   -2.711274397096297e-03; +3.455581817088019e-03   +6.841804107585840e-04   +1.123422560069387e-03   +2.586093910909325e-03   +2.260704660755540e-03   +5.933552308538996e-03   +5.682610985920198e-05   +1.241847834959993e-03   -4.631658012445914e-03   -2.426956447053319e-03   +4.338292361020548e-04   +4.711538149707400e-03; -2.105919282279302e-03   -8.280403828229261e-04   +3.074851836142524e-03   +7.262964071840477e-03   -3.756951286477938e-04   +1.099826143608377e-03   +5.733824256585800e-03   +4.416093091661687e-03   +6.821509143383626e-03   +7.750944979282208e-03   -3.407354690722343e-03   +4.499389273461831e-03; +1.703580212099476e-03   +9.304966985649150e-04   +5.237046831808033e-03   +9.083076563923709e-05   +2.312217917477051e-03   +7.200987838841105e-03   -2.885805701976793e-03   +7.343667582002949e-03   +2.345666371919624e-03   +3.620079219374331e-03   +6.404476306516761e-04   +4.343302760539985e-03; +2.741876442125848e-03   -4.531841427801487e-03   -1.447574286534644e-04   -4.420027383727469e-03   -2.683952352153183e-03   +6.337247133271739e-03   +7.605094295304597e-04   +5.382816256307321e-03   +7.329725378798680e-03   +1.799482419263536e-04   +6.966878822503669e-03   -2.914227075446743e-03; +2.539030927612001e-03   -6.286531726632867e-04   +3.158323103719098e-03   -1.787619075986086e-03   +4.583011205703607e-03   -4.830666333560089e-04   +9.031671947886713e-03   +2.139109926650755e-03   +1.203585356392351e-02   +5.993323921089483e-03   +5.269243807398122e-03   +3.855800797608578e-03; +7.287862490965118e-03   +5.750723171882120e-03   +3.858325419448094e-03   +4.949777197828570e-03   -5.191827827525777e-03   -1.971469441094714e-03   +3.160507453900558e-03   -7.933036056956668e-03   +1.010739685268679e-02   +7.081708646632512e-03   -4.014109011445821e-03   +5.100012638519743e-03];
L2E_Input1_iAMPA_netcon = [-9.160204821032753e-05   +1.079281681498118e-02   +3.374440208451875e-03   +1.356507526771485e-03   +8.238040486873426e-03   +1.885673667708293e-03   +1.725409942208441e-03   -5.049853678830803e-04];
L2I_Input2_iAMPA_netcon = [+6.212412227845220e-03   +7.024947491402503e-03   +3.407026298743868e-03   +3.712841270650039e-03   +5.957915300396395e-03   +3.619134402120722e-03   +1.630712355727584e-03   +7.671369204862840e-03];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last =  11.21 * ones(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.0*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.2*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.0*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.2*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.0*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.0*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.2*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.0*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.2*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.0*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
