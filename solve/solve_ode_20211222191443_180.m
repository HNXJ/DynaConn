function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-4.629222683563494e-02   +1.637923773799339e-01   +3.266207533724922e-01   -3.890065017786057e-01   +3.748435029441892e-01   -1.292581586343722e-01   +1.803490840045024e-01   -7.337545379669246e-01   -5.070363717139390e-01   -5.916341049108226e-02   +4.327513182302567e-01   +1.341789201504140e-01   -7.295874719001937e-01   -1.424966649661440e-01   +1.748722091522186e-01   -9.328211174762630e-01; +9.050713289753711e-01   -5.946994558322928e-01   +2.903864555421093e-01   -2.600917975831893e-02   +3.864148978622600e-01   -3.762133410651791e-01   -3.722208167067972e-01   -2.892906250611457e-01   +8.193709584487369e-04   +3.621350325860084e-01   +3.033330262344839e-02   -1.057669019544605e-01   -4.411015984905180e-01   +4.806039564901926e-01   +1.436500733919693e-01   +3.012084771267021e-01; +3.599592945589036e-01   +5.253358695231813e-01   +3.225553046571529e-01   +6.468448601913434e-01   -7.044484125788207e-02   +3.415918209288594e-01   -4.161465710696348e-01   +7.196811729350835e-01   -1.503302704697084e-01   +8.899483399175334e-02   +2.091382562244900e-01   -3.962548099418811e-01   +3.338004331680314e-01   -4.057316394212301e-01   -4.585059633152335e-01   -4.544129722576895e-01; -4.828179912122366e-01   +2.051890743382387e-01   +6.438704657623019e-01   +3.018103848796351e-01   +2.098026274170388e-01   -2.071188080238469e-02   -2.367531886609075e-01   +5.178876195504094e-01   +4.230870957289496e-01   +4.086100308289107e-01   -6.728145914549495e-01   -5.285295667189732e-01   +5.746415633863710e-02   +2.533910635645319e-01   -2.738280897545275e-01   +1.958039316758108e-01; +6.913712888100775e-01   +2.683222289636315e-01   -2.383644721637065e-01   +2.953140438156428e-01   -7.026428156978349e-01   +9.680525608611230e-02   -6.498300663977806e-01   +2.424698950963955e-01   -5.907498343763636e-01   -4.990315324008079e-04   -2.620454296850510e-01   +2.315770254489737e-01   +2.023149791947692e-01   +7.031011930117692e-02   -5.985093220455296e-01   -3.537587194442888e-01; -4.383415161442044e-01   +1.807547817269164e-01   +1.352381890246599e-01   -4.416201084772020e-01   -3.798558342010415e-01   -1.506495026672655e-01   +5.636624866523954e-01   -2.456773742731398e-01   +4.381723169897462e-01   -1.781338194596443e-01   -4.748360042755321e-01   +1.650914127641365e-01   -1.188303054359621e-01   -1.837971343822601e-01   +8.793897008260698e-01   -2.352709190423735e-01; +5.094690065443207e-01   +7.363546233357023e-01   +2.351717540402952e-01   +1.626865616940827e-01   +9.086389739555015e-02   -1.822364159465550e-01   +1.020665085768796e-01   -6.377819950852828e-01   +3.428710786932498e-01   -1.110899318633866e-01   -2.974379984092355e-01   +9.094810040213272e-02   +2.675123363354915e-01   -8.092126045725316e-01   -4.863290864172610e-01   -2.107436634826294e-01; -5.831292051560685e-01   +4.438851768895459e-01   -2.227045610340779e-01   -2.898133250634483e-03   +1.401959268849574e-01   +7.802064512200189e-01   +5.424569853133918e-01   -1.315821585265398e-01   +1.512794205278603e-02   +1.357139335006330e-01   +8.238263052808700e-01   +2.407425508841321e-01   -3.668017941234704e-01   +3.324619969804826e-01   -6.656838847690896e-02   -9.229947872051308e-02; +7.031457000148428e-01   -4.461983711269298e-02   +2.372999062473265e-01   +2.950469229714388e-01   +6.103124693715986e-02   -4.069066605510450e-01   +3.091329014066564e-01   +4.015941225883465e-01   -5.725112413155206e-02   +1.629749492636161e-01   +5.012566597004986e-01   -3.756037975076579e-01   -4.316246377294687e-01   -5.171094151904742e-01   +1.565918663020098e-02   -1.130542147306096e-03; +5.194629530284489e-01   +2.304922154166218e-01   +2.139138941662475e-01   +4.160579291643684e-01   -4.167940392234607e-01   -2.258061326699791e-01   -2.651338174979406e-01   +1.701005633359892e-01   -3.211790760557379e-01   -6.056008127118895e-01   +7.271122451807276e-01   -3.818248992631199e-01   +1.515230351407808e-01   -1.465943433078183e-01   -6.002365040515802e-01   -4.780746091121647e-01; +5.603620630772860e-01   -2.276956723338412e-01   -3.002002691094884e-01   -9.809576085273301e-02   -5.515699739723595e-02   +1.860820860930152e-01   +1.253965463104683e-01   -1.487925830616935e-01   +1.738698968440489e-01   +6.469911079065557e-01   +8.307867139260924e-02   +5.604159089890010e-02   +1.918252073150606e-01   -2.458711282225725e-01   +5.068023013572653e-01   +8.023056796545040e-02; +2.394459293184869e-01   -4.098243687196243e-02   +8.948089329609662e-01   +7.381254431019157e-01   +2.494962453737259e-01   -3.752746916901849e-01   -9.649836759597863e-02   -2.845758690060655e-01   +2.185677768798343e-01   -2.629062314495956e-01   -2.011424273283318e-01   +1.134271348266881e-01   +8.946191821880474e-01   +1.964275500511095e-02   -3.955811762762279e-01   +3.195531974078725e-01; -2.144194734741805e-02   -2.013357591389067e-02   +6.670536983574282e-01   +3.508265468920742e-01   +4.352041919091895e-01   -7.636985501867274e-02   +2.078238722317596e-01   +3.069345022147522e-01   +1.583712706993951e-01   +6.515963742684148e-01   +4.978671582964155e-01   +3.393669654403287e-01   +5.257707269100114e-01   +3.711289480214874e-01   -1.181242219509984e-01   -7.851582757136102e-02; +4.301142043740815e-01   +1.093240956641062e-02   -5.176805587871143e-01   -4.403378177982070e-02   +9.678477647180911e-03   +5.687238400543714e-01   -2.425499781759235e-01   +1.415629226422532e-02   +4.792653295860416e-02   +7.112427471921419e-01   -1.437882932237011e-01   -1.167419477029866e-01   +4.880691593782972e-02   -9.939198684549373e-01   +6.683095645140846e-02   -3.939829935852288e-01; -8.227121953296499e-01   +5.597873380496441e-01   -4.749256996648727e-02   +5.500995629813633e-01   -1.721223535992537e-01   +6.017586883127379e-02   -2.195343560491597e-02   +2.308354862144211e-01   +1.233240370279419e-01   -7.542256274007190e-01   +2.204676194905507e-01   +4.796414475295587e-01   -1.151153444412888e-01   +2.320825452876377e-01   -1.071889785038238e-01   -2.300341207803029e-01; -1.140922106461792e-01   -3.684414794448777e-01   -2.748926060599189e-02   -3.122574999248500e-01   -3.452480012051972e-01   +1.463266013812173e-01   -1.162812923775762e-01   -4.150134317873326e-01   -3.024428963828032e-01   +4.050788641927865e-01   +6.675333910089115e-01   -1.743272429600984e-02   +1.918472944875128e-01   -7.479141642648870e-01   +6.374325883455416e-01   -3.142562678394253e-01];
L1E_L1I_iGABA_netcon = [+2.416210758685043e-01   +2.560811849063779e-01   +2.386890516512994e-01   -1.096170315381880e-01   +7.532961080332332e-01   +4.661142513143175e-01   +6.717004601336899e-01   -4.937043053910007e-01   +5.560156922717430e-01   -3.127640826559143e-01   -2.953985226634581e-01   +5.007750899714469e-02   -1.004223134488612e-01   +6.609312108751146e-01   +4.019658383978345e-01   +2.066040464414807e-01; -6.275510296403863e-01   -3.573728209169360e-01   -1.279263151202596e-01   +2.284773479782737e-01   +1.205049179818060e-01   -2.236379276973431e-01   -5.420426508736806e-01   -6.739979165527425e-01   +1.673963713214220e-02   +3.264390410212397e-01   +1.560582516834460e-02   -3.232731706098361e-01   +5.667601586145939e-01   +6.116992858467328e-02   -1.769628074454119e-01   +1.120102214972095e-01; -7.171424369186811e-01   +5.481102806964494e-01   -1.908082008592728e-01   -3.795429553228672e-01   -1.411526872514790e-01   -3.585286335387755e-02   +6.756493432104785e-03   +1.897345956118331e-02   +7.377572829626938e-01   -1.859861661444092e-01   +7.534499742817569e-01   -6.157009776274805e-02   -5.647213496912968e-02   +2.072777868095093e-01   +4.387449961853755e-01   +6.600934395416959e-01; -2.822991376834980e-01   -2.806064502301305e-01   +1.458757560326346e-01   -2.701947600428157e-01   -2.827453643126046e-01   -2.148402100689935e-01   +2.908884176267406e-01   +2.663150419683994e-01   +5.849202691332517e-02   -9.904906972626810e-02   +3.482121417822902e-01   -4.679781655710007e-01   -6.375565290063929e-01   +5.338548457211151e-01   -2.052891224696786e-01   +5.387917986343428e-02; +6.319749006381298e-02   -1.369290080431584e-02   -1.543405035810635e-01   +2.447033949674418e-02   +6.279487394372882e-02   -5.230998697639069e-01   +4.916494108497800e-01   +6.445623094698678e-02   +5.987666024722007e-01   -3.239436542546514e-01   -3.626611735514672e-01   +2.881463894272097e-01   -1.169576597298853e-01   +2.483076718320884e-01   +4.037905400514223e-01   +2.078717709625180e-01; +8.452721157427502e-01   -6.507339131165698e-01   +2.125359318613147e-02   +2.423485333133560e-02   +1.026001675476451e-01   -3.762251220473051e-02   +1.921111075903408e-01   +9.608616687298014e-01   +1.583910537285423e-01   +5.647053726812161e-02   +1.676375397654938e-01   +5.086039273614277e-02   +1.908706333864862e-01   -4.744207556384457e-02   +6.277685467994711e-01   +4.857714952980084e-01; +2.411813599040931e-01   -2.759655188693362e-01   +3.698361893840864e-01   +6.924978013000510e-02   +1.617024178757322e-01   -2.425639134677700e-01   -1.360679679940173e-02   +2.374175438896565e-01   -4.510080568640636e-02   -5.906347009281332e-02   -4.754993596953134e-01   +4.185405765294544e-01   +2.889494911774958e-02   +1.380139931842821e-02   +1.396583675981594e-01   -2.895945266769996e-01; +1.825374113220206e-01   +3.118274700751407e-01   -6.970545367450055e-02   +4.784036319878755e-01   -5.640594548648328e-01   -2.420800327607090e-02   +1.375011062618145e-01   +2.781985653255332e-02   +3.828820200642379e-01   -2.975146388689105e-01   +2.273535379654679e-01   +2.885024703026076e-02   -9.135425066617714e-02   -3.668011051108261e-01   -9.734197061066123e-02   +5.368770129405011e-01; +7.606685539549758e-01   -9.265039493404553e-02   -5.565568082198886e-03   +4.075705726377189e-01   +9.215413324492966e-03   -6.088143936109877e-02   -3.259416706354264e-02   +4.525797967892856e-01   +1.223397821534677e-01   -6.137104709579136e-02   +7.172201462018972e-02   -1.095315558800729e-01   +4.054700272356525e-02   +2.439258361713875e-01   +3.414654574527959e-01   -3.520339059649062e-01; +1.808177720169853e-01   -9.962820882590417e-02   -1.754034189355486e-01   +3.122948646923296e-01   +3.520939211825191e-02   -3.923723230038060e-01   -3.229377562629436e-02   -1.549482202957182e-01   +3.394472927341367e-01   -7.069259266141174e-02   +2.126029934417638e-01   +2.864182144965457e-01   -2.133787559326303e-01   -1.700222687904323e-01   +2.008808311705127e-01   +3.931016172871448e-01; -3.566320599082312e-01   +1.174381733577867e-01   +4.330435921709302e-01   -6.225667171322651e-01   -5.584964242687881e-02   +3.351266492217161e-02   -3.194641184374151e-01   -1.337898164074058e-01   +2.840738619927528e-01   -5.700655779716469e-01   -2.264177446363723e-01   +8.264415468094816e-01   +3.419519786638273e-01   -2.660530514489299e-01   -1.618233612659822e-01   +2.788579659782635e-01; -4.977480128327203e-01   -8.382696252388712e-01   +4.403885566774424e-01   +4.630535933252707e-01   +3.311924059420459e-01   -2.327767433731552e-02   -1.927356107072209e-02   -2.947579033774168e-01   -5.282695980130312e-01   +2.399075326924190e-03   +3.291363227775758e-01   +8.549469813834318e-01   -5.616494760889289e-01   -3.140401192445425e-01   +3.626418264511926e-01   -2.522875982412356e-01; -4.226130551486176e-01   +4.501697637863880e-01   +1.818896953296794e-01   -3.582027900395547e-01   -7.351771301399525e-02   +5.406436991155753e-01   -4.294982439726275e-01   -9.074276438533910e-02   -1.676163459212149e-03   +6.355328373852592e-01   -5.096623110410717e-02   +2.556840235104209e-01   +2.213451465349788e-01   +3.931557120483066e-01   +2.536385605830599e-01   +2.519973365157877e-02; +2.202421760191703e-02   -9.080714818876073e-02   -8.180524320282231e-01   +2.513646722554038e-01   +5.370620244091510e-01   -6.914779032471940e-01   -1.601752831617507e-01   +6.712440810748369e-02   +7.595149825193674e-01   +1.522740178585332e-01   -9.746393565071851e-02   +1.699038780082814e-01   +1.195693590219703e-01   +4.158489354634662e-01   -2.672100832064853e-01   -1.018963894647849e-01; +3.133633625026545e-01   -4.337428538988197e-02   +8.605099740786094e-02   -3.988685927775486e-01   +1.126181611281941e-01   +1.577418315771774e-01   +6.931455703566407e-01   -4.748507590375664e-02   -4.311070820259835e-02   +7.663487596986518e-02   -6.327866094892662e-01   -5.117101263823588e-01   +1.022197495359163e-01   -4.941405320940781e-01   +6.467897806147225e-01   +1.000668620712402e-01; +5.518736759255145e-01   +1.450205006461307e-01   -1.165706817896259e-02   +1.697852354807956e-01   +7.929187141787968e-02   -8.296114202650539e-01   -1.668424139307644e-01   -3.125084063301629e-01   -3.273135626378150e-01   +2.876222716033870e-01   +4.258660400369959e-01   +4.464583369413284e-02   -3.257299440334161e-01   +7.987770332983538e-02   -1.574426957712111e-01   -8.600074601726870e-02];
L2I_L1I_iGABA_netcon = [-1.853534134528753e-02   -2.931003682831366e-01   +1.992763356170031e-01   -2.637157800543881e-01   -6.864567621037646e-02   -5.834448444921300e-02   -9.491429728327042e-02   +7.626977993324290e-02; +1.325585755832609e-01   -1.819429271177182e-01   +3.082571335207826e-01   -1.973329308901114e-01   -1.063368830841545e-01   +3.840122314677802e-01   +2.549677483932797e-01   +5.676195955499423e-01; -2.298310414663940e-03   -5.871283349266810e-01   -2.362774115856266e-01   +4.225195893811678e-03   +2.171887077388392e-01   +2.805772475593473e-01   +5.394186377384841e-01   -8.625155504340914e-02; +2.456547162235029e-01   +4.914589609015503e-01   +2.370721967772629e-01   +1.972680232423107e-02   -1.028184597337312e-01   -6.781728279238359e-01   +9.209264036284498e-01   +5.684234377721720e-02; +1.086563977926663e-01   +2.346626904913104e-02   -3.507732989720105e-01   +9.953728839205972e-02   +2.298090789231067e-02   +4.308493685604283e-01   +6.602525151471950e-02   +1.844323275420685e-01; +3.777207122808105e-01   -3.537660885199859e-01   +8.315219063976644e-01   +5.711727435926460e-02   +1.919121204830204e-01   -6.316202037896856e-01   +7.168372119803669e-01   -3.223844646407707e-02; -6.865431985130724e-01   -1.090494199903549e-02   +6.301289631390443e-01   -5.842930509584008e-01   -3.289641384410465e-01   -3.075066269877998e-02   -5.607270433834537e-01   +3.660599132229801e-01; +2.490324512009590e-01   -3.401181278435643e-01   +2.596981373262592e-01   -4.312478475175430e-01   +3.799060359042665e-01   -2.779252580730073e-01   +7.682409702995969e-01   +4.695455923264114e-01; -4.721123897736438e-01   -2.201841123083879e-01   +6.804697625080395e-01   +1.066986415960465e-02   -1.092088345268381e-01   +7.918972148055553e-02   -5.348739150159566e-01   -1.470206391520668e-02; -2.584491401871263e-01   -3.227220406796454e-01   +9.713209623311847e-02   -9.175831352681399e-02   +1.857353015210361e-01   +2.858205541532539e-01   -2.852110895957867e-01   -2.780433762357108e-01; -1.509336631291932e-01   +4.068387190109451e-01   +4.833967650053810e-02   -9.851579194400426e-02   +6.696127979396755e-01   +6.449829821463540e-01   -2.501513838585185e-01   +2.665023367616796e-01; -3.892435963904319e-01   +4.336743606621364e-01   -7.499502950264811e-02   -1.657788841387634e-01   -3.390186587623799e-01   +3.526309881010182e-01   -1.261058388982744e-02   +8.058876495378067e-01; +1.444721811589554e-01   +9.041379607957967e-01   +1.229476472099788e-01   -6.129076104813437e-01   +4.145745427753664e-01   -3.297665104788811e-01   +2.379654792080911e-01   +5.488727207834698e-01; -3.349863052958892e-01   +4.194087370030661e-01   +1.162321635269092e-01   +8.222359821508732e-02   +7.005146008905009e-01   +2.734276909975611e-01   +2.522777050802368e-01   +6.123749884386673e-02; -2.701028530292051e-01   -4.752007938402583e-01   +6.979288387556531e-01   -7.801361196447432e-02   -6.753263554778620e-01   +2.564236975253870e-01   +4.200108513257979e-01   +4.943208069897142e-01; +6.121508315431912e-01   -3.506871927688738e-01   -3.146621292251720e-01   -5.859219067457345e-01   +1.461722627984998e-01   +2.963390394213987e-01   -2.316183444559667e-01   +1.663260092063361e-01];
L1I_L2I_iGABA_netcon = [-5.787843882839246e-01   -5.068061465405492e-01   +3.376260009016672e-01   -3.741115451763614e-01   +4.226587759212132e-01   -4.851006277253944e-01   -4.776528816444536e-01   -2.138858376862093e-01   +1.580935162599601e-01   -6.079681074982617e-01   -9.216640232267372e-02   +2.285779360616805e-01   +4.694981566329428e-01   -2.714815174036179e-01   +5.923584796118030e-01   +1.440158056617929e-01; +2.838870868507409e-01   +4.094541372115338e-01   -5.193544570240424e-02   +9.391741162746604e-01   +4.465814119943752e-01   -9.962987531970208e-02   -2.037276068989929e-01   -4.151368516517501e-01   -2.845516500673435e-01   +9.607366979000585e-02   -6.122594836646807e-01   -1.364939433173639e-01   +1.078209451654026e-01   -3.639438600908387e-01   +1.238929480456549e-01   +4.171658766833266e-01; +3.651865730144080e-01   +1.279299637344236e-02   -5.688593752902231e-01   -5.827821541021251e-01   -6.638547908732367e-02   -4.123157028250136e-01   -4.452042867341334e-01   +4.017854723305319e-01   +4.451313888038821e-02   +1.415902650330519e-01   +5.609395511217905e-01   -5.558581874510711e-01   +3.010370553618427e-01   -6.831740186977093e-01   -3.521329307609159e-01   +1.572300443687469e-01; -5.836848510857603e-01   -2.264278943657184e-01   -8.151941086207257e-02   +2.911916167090742e-02   -3.701130714845183e-01   +1.878840911656423e-01   +3.930116033952767e-02   -3.988320562870451e-01   -7.017602693602745e-02   -3.084293100959870e-02   -4.021785354905935e-01   -7.651406639918114e-02   -4.490161695983798e-01   +2.047801758838002e-01   -5.484131303417424e-02   +3.720278322208663e-01; -9.150039054541979e-02   +1.399232968759662e-01   -1.236501337695654e-01   -4.204024910699788e-02   +3.227306218497922e-02   -2.919464731700945e-01   +4.680661537323979e-01   +2.543763968085866e-01   +1.735410166803343e-01   -2.522927626473144e-01   -2.786711140005702e-01   -2.349683271252664e-01   +5.353528286936894e-02   +4.040816890004464e-02   -1.285794528408088e-01   +7.010474617749621e-02; -1.062634868854207e-01   -3.041670870362732e-01   -4.761792063878539e-02   +3.405524710742430e-04   -5.877982980296831e-02   +2.402776649555479e-01   -7.778620583933586e-01   -2.877605526442197e-01   +1.428465654457478e-01   -2.875731601721568e-03   -1.116577538482560e-01   -1.247776864864705e-02   +2.860515139843102e-02   -6.319103303865340e-01   -3.984778300271691e-03   -5.333441511140602e-01; -1.818309917379565e-01   +7.656479390821866e-02   +4.051343545659984e-01   +3.152649233834871e-01   +2.794076302673527e-01   +2.539079770830717e-01   -4.104560770249474e-01   -9.252595757155024e-01   +5.030035862821738e-01   -2.201551722857957e-01   +6.056623911936966e-01   -1.243207317388839e-01   -2.217349698458963e-01   +3.265480604331801e-01   +2.480745580807719e-01   +3.172236563141945e-01; -3.537286178307052e-01   +1.842217343173312e-01   -7.141180106644511e-01   -6.273076571880812e-01   +9.349212297148188e-02   -2.769790686640363e-01   -3.097103837361622e-01   -1.826700471919435e-02   -1.766030613839512e-01   +2.547756710915590e-01   +2.348605690932209e-02   +1.008145517190841e-01   -1.022647021097061e-01   +1.919753585374026e-01   +3.200160332756143e-01   -1.174685429054248e-02];
L2E_L1E_iAMPA_netcon = [+3.980560136992424e-01   -2.306353268288353e-02   +3.356497423159510e-01   -1.663959941884475e-01   -2.641191969900667e-01   +5.360591758135926e-01   +2.955017580620101e-01   +7.110414800402004e-01; +7.582574798566459e-01   +2.017612864691087e-01   -1.398886637830229e-01   +4.173891347928370e-01   -4.703254528952261e-01   -1.425455489524502e-01   -4.448705099445197e-01   +6.836154576607774e-01; +3.914192421379284e-02   -4.046459272525892e-01   +2.203537318107071e-02   -5.107553475620962e-01   +2.292289197551406e-01   -1.824807584803246e-01   +1.723918268134947e-01   -7.412307224508023e-02; +8.622117742618366e-01   +1.779128139240256e-02   +9.421037974397234e-02   +4.697672787580575e-01   -2.358732723884361e-01   -2.958344314063015e-01   -8.907115426299710e-01   -4.925862820322511e-01; -1.891716144165401e-02   +6.743562731639130e-02   -3.799413682261789e-01   +8.122082274631545e-02   +5.644435510953328e-02   -2.987642811935434e-01   +8.057144569836361e-01   -6.630135285235252e-02; +3.306056127203764e-01   +1.544965372138055e-01   -6.058561777037187e-01   -5.855004530576690e-01   +4.704324301084920e-02   -1.061367936389895e-02   -7.459417895337426e-01   -6.844450102633365e-02; +6.163624565291268e-01   +2.496794573055783e-02   -2.632692894618165e-01   -2.800060486437120e-01   -9.790453616430178e-02   -1.346980604070419e-02   -3.514747073405491e-01   +7.340085879638512e-01; +7.904061897248882e-01   -8.633207596124971e-02   +3.096095836287767e-01   +4.023787776678200e-01   +3.337141469958588e-01   -2.935340051478092e-01   +3.648442529870453e-01   -3.114078432160080e-01; +1.722951923073108e-01   +1.988660410120877e-01   +1.185430200833661e-01   +8.211650350656516e-01   -8.686985089943812e-01   -4.351473343895332e-01   -9.539133280301959e-02   +8.143533444545586e-02; -1.423905031995313e-01   +5.783752688088495e-02   +2.271271427580487e-01   -2.004295653710451e-01   +2.010804934409817e-01   +8.244805498766929e-02   +2.199687057405667e-02   +2.412737408008661e-01; -4.393241144781962e-01   +8.156868669695685e-05   -1.488550029616531e-02   -1.547308967564950e-02   +1.584800994655194e-01   -4.579904179264251e-01   +2.591528618523042e-01   -7.105356574097036e-01; -7.535894144533434e-01   -3.055530420595185e-01   +2.326641058789077e-01   -9.633156444990379e-02   +6.142259792140865e-01   +1.823449459056479e-01   +7.138827575878773e-02   -2.980292957032789e-01; +1.611529825290529e-01   +1.556644960227724e-01   -6.273271543277092e-02   -2.115624900386551e-01   -5.489767910261897e-01   -4.039596943894113e-01   +5.464511474273720e-01   -2.713632898212667e-01; +1.500289260948408e-02   +4.702559947330114e-01   +9.386742234993081e-02   +9.987922567411134e-02   -3.324640541762983e-01   -6.036329578015422e-01   +2.683308462827270e-01   +1.147548696950494e-01; -5.983241399087454e-01   +4.126035945324424e-01   +2.349579332530038e-01   -2.256816806729642e-01   +3.986277847430870e-01   +5.388019113873822e-01   +3.172526679205319e-01   -2.529898690799520e-01; -4.098222242268594e-02   +4.643604594303089e-01   -4.391976707595718e-01   +7.773643189064353e-01   +5.165446870306495e-01   -1.120484865013129e-01   +4.263986383395575e-02   -1.165391561667450e-02];
L1E_L2E_iAMPA_netcon = [+3.531601868193277e-01   -4.495224419277956e-01   -4.332694800921243e-01   -5.087627078460945e-01   -8.848127415305082e-02   +3.014739091348280e-01   -7.565818283528738e-01   -9.125143842010468e-02   -5.183576327929673e-02   -2.843445879711866e-01   +4.258507152133786e-01   -4.768536607192420e-01   +2.456268526345515e-02   +2.311649181867469e-01   +2.347060941771790e-01   +7.103907768776643e-01; -3.075978979628814e-01   +2.018206316720602e-01   -2.148933093916947e-01   +1.320761043017298e-01   -1.294924543323578e-01   -7.505285604916563e-01   +2.276381591224181e-01   -6.166100010103986e-01   +2.666948569346209e-01   -6.355443126623313e-02   -8.402652470815092e-02   -1.376819738546637e-01   +3.036835977203214e-01   -2.844209083324722e-01   +2.135402220459577e-01   +1.180284306694149e-01; +7.017306711912771e-02   -3.716896654179860e-02   +3.184387141110616e-01   +1.910787148865171e-02   -2.518462379166667e-01   +1.711818426315637e-01   +5.605433075150625e-01   -2.339327212091724e-01   -5.480867337810255e-01   -5.597168396374972e-01   -2.071623525640351e-01   -4.199799000862737e-01   +2.003654570992278e-01   -3.061989581164981e-01   -1.477850188727091e-01   -2.041499073884814e-01; -1.459336330443355e-01   +4.542795291523340e-02   -2.085000239626032e-01   +9.638085054908915e-02   -5.577326446114437e-01   -2.485623882557541e-01   +3.979481856378906e-01   +3.687549518896300e-01   +8.103548104656014e-02   -4.014479011085699e-01   -5.877986759863318e-01   -3.811428800238444e-01   -1.310654918382859e-01   +1.374199611235140e-01   +3.326903726623335e-01   -2.480611969570679e-01; +2.585995829440317e-02   +2.823187552909965e-01   +4.442019140294854e-01   -5.740939660334439e-01   +6.889416802742049e-02   -2.346470394050668e-02   -4.423619369243907e-01   +4.721894651460008e-02   +6.592956652532941e-01   -9.252172724709706e-01   +5.402539917920823e-02   +2.356039245132518e-01   +1.597700893308300e-01   -7.152548724309502e-02   +2.346020138839353e-01   -2.320918609111947e-01; +4.699101689093044e-01   -3.676091351793714e-01   +1.127194398555235e-01   +4.111366738963209e-01   -7.260476584546430e-01   -6.682031444072635e-01   -1.428547044759542e-01   -4.423266010044924e-01   +6.777400932081951e-01   -9.502871590102926e-02   -1.380277295312212e-01   -7.475957287575866e-02   +5.717208026200046e-02   -6.924127969376483e-01   +1.285572511700133e-01   -4.427186682417056e-01; +6.326526055764304e-01   +9.584245776052598e-01   +3.204630134978463e-01   +1.747314800350439e-01   -4.486328580295661e-01   -1.694663656535419e-01   -4.840356424141842e-01   -3.147762079957435e-02   +9.418461993442617e-01   +2.923526896075405e-01   -1.172841584700642e-01   +1.301227715693959e-01   +1.899700219802501e-01   -1.830255105232279e-01   +6.055125970703765e-02   +2.834805091259543e-01; +7.591972890357215e-01   -3.032724902926909e-01   -5.085126459027741e-01   +3.198451003723539e-01   -4.290463495314942e-02   -5.410334915796005e-01   -5.377821094539444e-01   -1.699352307071899e-01   +6.331133676811941e-01   -8.242376064278915e-02   -1.929170839465289e-01   -3.177850322633620e-01   +1.008921185733640e-01   +5.932881358222296e-01   -2.559464137698582e-02   +1.677177305468438e-01];
L2I_L2E_iAMPA_netcon = [+8.421410274886008e-02   -3.881924822213024e-01   -2.273295293911571e-01   -7.464172406331072e-01   -4.799233473875196e-01   -1.674400505502097e-01   -4.582644525996362e-01   -2.662151499221839e-01; -9.819843000044848e-04   +1.113906614260323e-01   +2.257599677121371e-01   +5.138378912779545e-03   -3.854182133335543e-01   +5.299575343854134e-01   +3.831149435319318e-01   +1.250658291781165e-01; +4.276779852938093e-01   +8.139503377842616e-01   -3.444305515227250e-01   +6.971358034474534e-02   +9.978074756607391e-02   -3.522871931004814e-01   -6.701101504547537e-02   +4.851523720341365e-01; -2.176638255544817e-01   +6.761208857861292e-02   +1.765265181921120e-01   -1.315466975768883e-01   +7.580234943299410e-02   +7.779711575226626e-02   -3.097369798137284e-01   -3.271189495705191e-01; +4.595165896275312e-01   +1.840992495522388e-01   -2.992342630679309e-01   -3.752563702266358e-01   +3.066919946533289e-01   -2.652700955044515e-01   +3.892722666954943e-01   +1.725447188894259e-01; -8.973203292864007e-02   +5.061342637918993e-02   -2.168403806444842e-01   -8.032740104118399e-02   +3.891674656800706e-02   +8.763751545108286e-02   -1.027593883892730e-01   +3.246849308175842e-01; +5.135224984607736e-02   -1.200634219031451e-01   +4.135319556078986e-01   -8.075946603392287e-01   +2.963023599590545e-01   -2.583891782458405e-01   +1.787277580010791e-01   +4.646720486190961e-01; +2.071924966578791e-01   +1.305190763060961e-01   -6.894637444791382e-02   -3.592574183413180e-01   +4.110157644533636e-01   +2.714350188875299e-01   +3.541886694771001e-01   +5.395845416413207e-01];
L2E_L2I_iGABA_netcon = [+1.590666092203973e-01   +5.546498790847901e-01   -4.239708719187947e-01   -6.636344408735870e-01   -4.733828005597822e-01   -2.750899879628026e-02   +6.450407234118118e-01   -2.244542608702196e-01; +5.264310902585246e-01   +1.854654345740573e-02   +2.160818593765570e-01   -1.847012879531751e-01   +1.547083038159909e-01   +1.047918374811232e-01   +5.473336767365292e-01   -3.121578512219427e-01; -1.367130866267106e-01   +2.285017366566387e-01   -1.824949299875326e-01   -1.359735615989348e-01   -1.301393200886020e-02   -2.521504786258999e-01   +6.233900418698409e-01   -7.261477075336488e-01; +2.507749399883354e-01   +5.587742344473555e-01   +2.963919473168457e-01   -2.365835098942807e-01   -3.555475953856096e-01   -4.819818132093016e-01   +3.207611447532975e-01   -5.811358952231971e-02; +1.857955170776839e-01   +5.142960293133593e-01   +2.488043564476766e-01   -2.833839513677745e-01   -6.067763862691772e-01   -4.311457009043291e-01   -4.750290838174535e-02   +2.290271718186542e-01; -9.888588870774087e-02   +5.746388190965626e-01   +1.376262496445163e-01   -4.194891352990754e-03   -2.457980209051436e-01   -2.158628729023538e-01   +1.782739210936840e-01   -6.678235457020432e-02; +9.570326760267917e-02   +6.382869942623648e-01   -7.791686072497994e-01   -3.873370506500970e-01   -2.106212733171871e-01   -1.907561283301248e-02   +1.108163346246273e-02   -8.572866516652064e-02; -2.547812230953120e-02   +6.783537209140968e-01   -4.462131109125967e-01   +1.350927300624202e-02   -4.693460526800877e-03   +4.306721930866595e-01   -1.724983967907389e-01   -6.106907565078330e-02];
L3E_L2E_iAMPA_netcon = [-9.820288134667002e-02   +5.035339433288888e-01   +3.658015394793358e-01   -6.972565745526930e-01   +8.791399898498307e-01   -5.765712135486090e-02   +1.359882527899352e-01   -3.548227033649722e-01   -5.301057676529569e-01   +6.305679933255016e-02   +2.183169690518190e-01   -1.738832319343962e-01; -1.300143368313503e-02   +4.940994605161485e-01   +2.518393108013880e-01   -8.098471847815253e-02   -2.091050764289147e-01   +3.940107218718600e-01   -3.158353101626543e-01   +5.852685443864067e-02   -2.765698344487357e-01   -4.411196747548639e-01   -2.436399285331056e-01   +4.569441774303062e-01; -2.905176790845133e-01   -4.987252945029395e-01   +3.688850445649582e-01   -2.548995813386744e-01   +3.459128084523414e-01   -5.880161967948222e-01   -5.809325658041328e-01   +2.373473474017038e-01   +2.821788548852150e-02   -7.590767753111183e-01   +6.721805204650652e-01   -4.639138307739786e-01; +3.454288568202737e-01   -3.568964433323114e-01   +7.846780720597535e-02   +1.696831462475872e-01   -1.846462939279351e-01   +6.613673067677475e-02   -5.059791143517428e-02   +1.471539425131307e-02   -1.523412584740773e-01   -5.211498820831066e-01   +2.305441497871561e-01   -3.842464327139171e-01; -6.341378220502920e-02   +5.693879935872445e-02   +8.917131672103168e-02   -5.253591703553401e-02   +1.628679080267020e-01   -2.069418489755009e-01   -3.510247577882512e-01   -1.326642373397020e-01   -5.831706616212056e-01   -3.688883020275352e-01   -1.603183973542717e-01   +1.393195404109440e-01; +7.104102120530359e-01   +1.641683571822095e-02   -7.412227002485700e-03   -4.097076887935791e-01   +4.491834777127975e-01   +3.084920011184722e-01   +4.457515824313496e-02   -7.735793911362393e-02   +7.859370116609504e-02   -1.252271256148911e-01   -3.519683403807551e-02   -6.446057057970448e-01; -3.168123930483993e-02   -2.950769408279968e-02   +1.586555478579903e-02   -4.668581364509000e-01   +6.054683096052380e-02   +4.975531531437616e-02   -4.988591451785968e-01   -3.403993789476650e-01   -2.952558086130201e-01   +7.499988058772854e-02   +2.410926823420460e-01   -1.744878454961704e-01; +9.457197054471719e-02   +9.590895156096134e-01   -2.683249811350556e-01   -1.910824065920331e-01   -4.058730406134766e-01   +4.713564150632062e-02   -7.921493736414265e-02   -2.370573848658300e-01   +1.655994615107950e-01   +2.655655617425284e-01   +3.415875531428331e-01   -5.660278691826515e-02];
L3I_L2I_iGABA_netcon = [+1.787539552201047e-01   +8.438012138650734e-02   -2.227215711850649e-01   -1.548945743793125e-02   +7.362240064336030e-02   +3.998505296837021e-02   -1.879070289419917e-01   -1.268917460064378e-01   +2.201837960377291e-01   +2.840585159542806e-02   -3.408814338696791e-01   +4.073704569356080e-01; -1.068942967087122e-01   +2.603661919461528e-03   -5.718485819622169e-01   -1.987314089404436e-01   +1.276913755713346e-01   -8.008185441416670e-01   +1.192237779442719e-01   +6.855442249416737e-01   -8.072153156916617e-02   +1.478137569764644e-01   -1.087386194258287e-02   -1.126830861289010e-01; +2.001018423462745e-01   -1.672074214923532e-01   -2.785487524941984e-01   +1.418822582012443e-01   -1.216730748010728e-01   -5.281661476906552e-02   -2.593889071505920e-01   +2.052251261718155e-02   +2.182786260758691e-01   +2.760775063585925e-01   -4.425945920691294e-01   -7.474489346293769e-01; -4.064022286835266e-01   -4.656689632481439e-02   -2.419345933751370e-01   +2.704552451872049e-01   -1.142617397364221e-01   -4.863415255818020e-01   +4.115376335254783e-02   -1.352794732501339e-01   -6.581458601239241e-01   +2.260201097574166e-01   +4.787898192424254e-01   -1.728891772890150e-01; -1.011829326905769e-01   +1.474573377678569e-01   +6.578889923040833e-01   +3.304320371482544e-01   -2.511506421194326e-01   -2.339868248251717e-01   -3.196272667787712e-01   +1.522553856953373e-01   +4.086755974523866e-01   -6.181041111854234e-01   +9.926265143424051e-02   +9.620345321513686e-03; -5.862126661378118e-01   -6.167772188687325e-01   +1.320604851803468e-01   +8.425037132238798e-02   -2.979897731894812e-01   +1.180627208702678e-02   -5.906748650406033e-01   +3.931126726592810e-01   +2.240384343832593e-01   -2.448704687872109e-01   +1.377926138296198e-01   +5.532625353984533e-01; +1.980517886489969e-01   -3.809433434003090e-01   +9.012987896055986e-02   +2.413026368501334e-01   +2.830216229464582e-01   +1.570821703040279e-01   +1.544638287749070e-01   +3.338656605551645e-02   +9.478087489825808e-01   -1.392439751980203e-01   +1.168694855643772e-01   -4.040685573239458e-02; +3.930747329055750e-01   +3.123126954759666e-01   +1.798899441413959e-01   -3.187930459135168e-01   +2.532296350017101e-01   +6.096215838453986e-02   -1.276450104975580e-01   +5.809714060292901e-01   +2.214577870491086e-02   +1.164354908755973e-01   -4.167595000281174e-02   -6.164359781621702e-01];
L2E_L3E_iAMPA_netcon = [+6.613756761978486e-01   +8.372652120393217e-03   -5.473960400695355e-01   +3.881520957340266e-01   +2.498028395469215e-01   +7.066248133251773e-02   +3.910762236291027e-01   +3.134809516547136e-01; -3.254367530543378e-01   +5.400616859062701e-01   -7.474274130719115e-02   +5.823174861401492e-01   +4.841968706715891e-01   +1.083498228239655e-01   -3.198763684959285e-01   +1.225814510684662e-01; -2.012346420964224e-01   +1.083421831297235e-01   -4.477894734571152e-01   -5.525855770841548e-01   -2.199320059355006e-01   -1.857115355875162e-01   -2.779769725929595e-01   +1.777569997391655e-03; -2.874982164809022e-01   -4.701900829093202e-01   -6.614086415618164e-01   -1.586936278967612e-01   +3.400502456981293e-02   +1.040279943267699e-01   +2.308742805586732e-01   -2.243314594624428e-01; +5.767666526490813e-01   +1.175046510906641e-02   -2.727740026193642e-01   -6.841014257984002e-02   +2.452017663946471e-01   -2.386661290968170e-01   +6.957294182877132e-01   +3.624152727939371e-01; -7.406251158763841e-01   +4.722451377105926e-01   +4.469046988435065e-01   -2.309603022522602e-01   -7.176564438933444e-02   -1.865307235887574e-01   +3.429678090974694e-02   +9.978453221948759e-02; +3.605944195018212e-01   +2.715657450782356e-01   +3.713619404053247e-01   -9.115797582925314e-02   -2.424225061485435e-01   -4.057441376852930e-01   +1.772268338871694e-02   -9.494576307612128e-02; -7.708289820679506e-01   -1.134982707293942e-01   -2.994768328095218e-01   +1.739726200497082e-01   -1.077055810067766e-01   +4.359293095562893e-01   -5.481786558356225e-01   +1.489699176659032e-02; -1.243653784463523e-01   -3.854461564001350e-01   +1.135757463441918e-01   -1.099592529391828e-01   +2.221735218532804e-01   -7.667636054658984e-01   -2.913520884044638e-01   +3.243616136676357e-01; +4.982371917089853e-02   -8.299582839566277e-01   +2.500511606487740e-01   -1.958792292942790e-01   +1.440064740989309e-01   -4.648513364504614e-03   -2.796892438883369e-01   +1.866334843060632e-02; -3.444472073396107e-01   -3.073841820665314e-01   -7.449740082595566e-02   +1.892095332642260e-01   -1.658838488143190e-01   +5.787349393823640e-01   +1.978569399359582e-01   +4.109405544686913e-01; -2.003560366347786e-01   +2.039388540496764e-02   -6.199294921546050e-01   -1.774860897645832e-01   +8.766565061635410e-02   +8.028127814880452e-01   -9.173386863886573e-02   +1.984200710354112e-01];
L2I_L3I_iGABA_netcon = [+6.041191019085865e-02   +6.988848639692546e-02   -2.178201235822094e-01   -1.366981040412989e-01   -3.876327374593892e-01   +2.759858992169574e-01   -3.144354727348774e-01   +2.954559829785669e-01; -4.776146308618500e-01   -1.125452599031337e-01   -2.691020994544119e-01   +3.062842881387196e-01   -1.726414096653904e-01   -3.175993595712193e-01   -5.573925128212429e-02   +2.454975478281046e-01; +1.311609510317862e-01   -7.476688258317485e-02   -4.183195256201711e-01   -1.016778671406220e-01   -2.792348659102464e-02   +8.763945557853715e-02   -6.924399801229134e-01   -4.623193713234143e-02; +2.933336810443163e-01   +3.587024814210854e-01   +4.877542173546299e-01   -4.427766745557703e-02   +1.109034047970064e-01   +6.674319252633823e-02   -2.822696145196177e-01   +5.166097015040239e-02; +4.600800249791480e-01   -1.017290089397077e-01   -6.435505583118128e-02   -2.109853829290769e-01   -1.830810613461187e-01   -1.629892153502614e-01   -4.797290690052316e-01   +6.758490789295684e-01; +6.800757563026624e-02   -1.668859978434604e-01   -7.801697407152972e-02   +4.971687424879403e-01   +6.866125963679082e-03   -1.637098698002240e-01   +2.442910191323111e-01   -1.754391738428711e-01; -2.875288241627003e-01   -9.261384685615444e-02   -1.761256780912041e-02   -4.076735220053067e-01   +4.377082810630862e-01   -4.826655277256362e-01   +6.182732907106676e-01   -2.147461441110166e-01; +1.991970729100050e-01   +2.629741917817767e-01   +3.588841497781085e-01   -4.087739363921228e-01   -3.720739370770315e-01   -2.304790652698485e-01   -3.273015136609486e-01   -7.476244087562742e-02; +2.752120754854890e-01   -7.235951814977645e-03   -2.601181614261720e-01   -6.308948080229661e-02   -5.144138502240203e-02   -4.641106696516950e-01   -1.503579179885484e-01   +1.718724518126115e-01; +1.659578206283057e-01   +2.845567248618218e-01   +4.114780601794782e-02   -1.149081771296298e-01   +1.028407810156539e-01   -7.108722686456637e-01   +5.743567874654475e-02   -1.132733374408610e-01; -2.483071885864222e-01   +1.835178069583777e-01   +3.276519099873761e-02   -8.411495684552719e-02   -5.819481455991320e-01   -4.519816812806651e-02   +1.240668338461341e-01   -4.701745679660777e-01; -2.754149064603652e-02   -5.350240455249600e-01   -6.748851480771350e-01   -2.967915774318766e-02   +1.251930494585993e-01   -1.156490971577440e-01   -9.495779327270915e-03   -1.479219124567934e-01];
L3I_L3E_iAMPA_netcon = [+2.528428868582759e-01   -1.007220464681839e-01   +3.777797342246351e-01   -7.444446029694679e-02   -2.751452882405948e-01   -6.161185586139157e-01   +2.966515883921175e-01   +3.348201065130557e-01   -2.807284508896861e-01   -3.860802644216242e-01   +3.698877850800353e-01   +6.209200681686967e-01; +1.140699468878181e-02   -4.790020426816948e-01   +2.529632616931919e-01   -1.471970430173433e-01   +5.901552019526963e-01   -2.524811222294695e-01   -3.846930868058145e-01   +3.624397753473484e-01   +6.755034037566994e-02   -9.400918696683815e-02   -1.275368070343994e-01   -1.638800309478029e-01; -5.144238359293125e-01   +3.645290162942916e-01   +5.595785059503605e-01   +7.513076644438020e-01   +9.849709850514170e-02   +4.037660976729557e-02   -5.154969185370506e-01   +2.478050805955356e-01   +2.468098751009178e-01   +4.138882085585022e-01   +4.151704144157818e-01   -5.183255482730122e-01; -5.521603924562885e-03   +1.804684706688048e-01   +6.158976834014269e-01   +2.532620052380776e-01   -7.458154982813273e-01   -4.072443804343123e-01   -1.809840525993962e-01   +3.713206017689185e-01   -1.377110640851461e-01   -5.746809792757500e-02   -7.650820335179185e-01   +6.256909929424143e-01; +1.286350551265243e-01   +4.381495635581992e-01   +3.048858275181408e-01   +2.534465053982392e-01   +3.119698814310291e-01   -2.460220697552813e-01   -9.907316269429774e-02   -4.240187309801108e-03   +4.351083782696459e-01   -1.166518320206405e-01   -4.864056728742884e-01   -4.084543753459338e-01; -4.495727177572262e-01   -6.319938543249141e-01   -6.488876762115898e-01   +7.365874660624642e-01   -3.539854083233656e-01   +1.585189052547604e-01   +2.630495394436955e-01   +8.481839415557094e-02   +2.624200334860425e-01   +1.580483572342114e-01   -7.262732688988195e-02   -3.226097212668643e-01; +1.100545862248642e-03   -4.696671040070138e-02   +5.698260891991290e-01   +4.132532677265092e-01   +3.437100513819940e-01   +2.884535717913490e-01   -5.825481289599121e-02   +1.447665162198539e-01   +1.936066663819754e-01   -1.947369426825519e-01   -6.448993437795487e-01   -3.327323845435833e-01; -5.165917417852368e-02   -1.378184527447682e-01   +2.048990782010205e-01   -4.889538043237971e-01   +3.775343693329056e-01   -8.873204585309179e-02   +7.018429768211343e-01   +4.401659802049083e-01   +1.390117646794548e-01   -3.420480668526438e-01   +2.367609346488088e-01   +2.910117179218695e-01; -4.740220885217469e-01   -4.140107171684511e-01   +5.598428328219968e-03   +4.074027223685056e-01   +5.306276548480091e-01   +1.958074669877484e-01   -9.232918139699038e-02   -2.632083919658904e-01   -6.078236482642214e-02   +6.744814946837229e-01   +4.110226434106522e-01   +7.723093500822711e-02; -6.112439997096877e-02   +2.242026017066098e-01   -3.330956816435045e-01   +6.838031077558816e-01   -5.719795015671559e-01   +3.705538556621264e-02   +3.509791794894993e-01   +6.443526482844228e-01   +4.718169654331911e-01   +4.005034071765415e-01   -3.488835145171303e-01   -3.003713947104480e-02; -1.193674765675341e-01   -1.110124856685893e-01   -8.685804143007846e-01   -6.245901628901224e-01   -1.579738414642742e-01   +6.525478144954043e-01   +1.877830240954046e-01   +1.151626020175943e-01   -2.476291118389148e-01   +1.950423601554288e-01   +5.960687795212253e-01   -3.098240534990416e-01; +3.140044535045653e-01   -2.692187047527685e-01   -1.306513752822576e-01   +6.928239120686682e-01   -5.155564102906971e-01   +3.857291610744802e-01   +1.660732569552664e-01   -3.839088996794509e-01   -8.192507836680796e-02   -4.445544757242420e-01   -7.254570244307443e-01   +9.283890982639403e-03];
L3E_L3I_iGABA_netcon = [+3.156255190596242e-01   +3.926700759588342e-01   +1.683527461162004e-01   -3.031101964222656e-01   -8.724259153563479e-03   -4.370563654963820e-02   +3.722949451910110e-01   -5.378996953435761e-02   +4.481234089883680e-01   +5.691064476397402e-02   +5.759656153822479e-01   +2.291714293130388e-01; +3.344405211879530e-01   +2.258238535894713e-01   -2.560369319485962e-01   -2.577715807080518e-01   +2.784163434272998e-01   +2.760396898229495e-01   +1.461520033236315e-01   -1.880611215090257e-01   +3.278754121168111e-01   +1.888655053736275e-01   +2.245457192101985e-02   -5.985437324179274e-02; +1.968375434951372e-01   +3.361364341823436e-03   -4.991956817714930e-01   -4.685646608956175e-01   -1.453569829201000e-01   +8.513552566059411e-01   +2.544811710347489e-01   +6.988849541061043e-02   +4.257694272780152e-03   -2.518442760393876e-01   -8.196824547087102e-02   +2.816914575777317e-02; -1.980662613250149e-01   -2.429463610908399e-01   +2.579563105055483e-01   -2.046756548461207e-01   +3.782402247408612e-02   -1.953700197395972e-01   -2.842485876635550e-01   +1.699187134464329e-02   +9.959373848439447e-02   +4.906647895324414e-01   -1.469876610263360e-01   +7.692375124135294e-01; -7.527002874820590e-02   +1.935292702676611e-01   +6.676197487362698e-02   -4.812212031383364e-02   -3.127831997453061e-01   +3.075592296560679e-01   +4.349445161285297e-01   -3.903554895104006e-01   -3.950851900463788e-01   +4.691079974393088e-01   +4.292773310179908e-02   +2.700157881498430e-01; +1.894728060986037e-01   -1.409244262233225e-01   +2.882268156581856e-01   -1.721468703332027e-01   +9.646749492174542e-02   -2.135072836297681e-01   -6.388202331302063e-02   -1.905834231508320e-01   -4.455068664784904e-01   +1.384027970216374e-01   -9.158538917986761e-02   -1.505890142534010e-01; -3.593837392785035e-01   -2.179190348348828e-01   +3.583810988039502e-01   -4.153075586641778e-01   +7.727868160865952e-01   +2.475078247997684e-01   -9.699845366008034e-02   -3.399744080610467e-01   -5.364030642632722e-01   +4.498740376913469e-01   +2.375112140709053e-01   +2.897085744631017e-01; -4.285889955126320e-01   +7.783753897749070e-02   +1.448287122226274e-01   +5.581913801469011e-01   -5.316625257993066e-01   +1.570012893814287e-01   -4.341086142735324e-01   -1.701641790067283e-01   +3.187401808308133e-01   -2.156864127051318e-01   -1.971310836856933e-01   -5.556310059033932e-01; +4.254299667768568e-01   +4.649514614347035e-01   +3.463028310039867e-01   +2.474084163448522e-01   +7.933315766113441e-02   -4.497090176922035e-01   +3.268574527107775e-01   -3.969473894278736e-02   -5.827863521768034e-01   -2.143509713813906e-01   +4.709498036625889e-01   -3.814743650021238e-01; -1.015464840429650e-01   +5.334502669535915e-01   -2.399991436783511e-01   -2.803952111655072e-01   +3.190773595447943e-02   +2.592781270118639e-01   -4.322967190755453e-01   +3.567661278601505e-01   +1.006939123383461e-01   +5.807268242551173e-01   -6.964347712320238e-01   +1.468579886728416e-01; +2.941104559966418e-02   -3.704765475431884e-01   -8.556585773160616e-02   -1.953128007592896e-01   -3.516559175522109e-01   -2.280534577959532e-01   -1.702224922492968e-01   +2.095364660212986e-01   -4.151264301845886e-01   -2.509650950094027e-01   +1.240039961922125e-01   +1.201720649869879e-01; -6.796195877882881e-02   +1.189161879359775e-01   +2.674191918379129e-01   +8.122177058940107e-02   +1.419162070756251e-01   +1.704216338762843e-01   -4.386622143102015e-02   +5.606508615858458e-01   +4.718196087833688e-01   +1.187126761808675e-01   -1.783215190619732e-01   +9.647702924280509e-02];
L2E_Input1_iAMPA_netcon = [-3.695619636006655e-01   +4.174647314327401e-03   -2.525868484529420e-01   +5.030620158080186e-01   -9.224971109463072e-01   +5.654025010173781e-01   +5.560676359178760e-01   -1.119043350786142e-02];
L2I_Input2_iAMPA_netcon = [-3.755170271195489e-01   -4.979354181452877e-01   +5.942511853203258e-01   -7.544825438985253e-02   -4.894936328746379e-01   +3.706898311751695e-01   -8.681826966143058e-02   +4.359604175591194e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.04*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.4*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.1*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.4*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.1*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.4*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.04*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.4*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.1*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.4*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.1*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.4*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
