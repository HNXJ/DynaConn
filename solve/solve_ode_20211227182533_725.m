function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-1.540432670878386e-01   +7.429982048062990e-02   -6.037738983975986e-02   +1.725674299007702e-01   +3.704759092375030e-01   -1.369633616239907e-01   +3.114478010266014e-03   +1.673925458129501e-02   +1.587297750461331e-01   +2.422791332145577e-02   +1.115825254078370e-01   +2.213418088521080e-01   -1.029932935221418e-01   +7.989201191628356e-02   -1.520488256340376e-01   +2.148314015093343e-01; +2.118474197836406e-01   +1.575181738615323e-01   +2.056428295723370e-01   +1.543013876156558e-01   +9.478854641148912e-02   +4.666851012418857e-03   -4.998326594257237e-02   +1.170540364129374e-01   +1.266495091746944e-01   -3.492995616064866e-02   +3.020493183104053e-02   +1.634581207722782e-01   -1.358298848539800e-02   +1.596334679065914e-01   -7.520322565425078e-02   +2.419935044003441e-01; -1.151782583771807e-01   +1.668390799437650e-01   +3.575116936105470e-02   +1.168315570297132e-01   +1.821730033621552e-02   +1.508013851984426e-01   -3.096498405163690e-02   -7.850642996443881e-02   +1.182699458084197e-01   +2.124519347373499e-01   -3.209321448716188e-02   +2.104238432508678e-01   +8.773626994669635e-02   +2.538820586956589e-02   +2.143201629080749e-02   -4.978852448562096e-03; +7.673371109648228e-02   +2.172050986551428e-01   +3.242323806591231e-02   +8.091133372772615e-02   +1.416891749021120e-01   +1.649413851086379e-01   -2.187972138567769e-02   +8.153396899231549e-02   +3.306140823379988e-03   -1.307832681264431e-01   +7.055554290102628e-03   -8.633746569675771e-02   +1.661283920642233e-01   +9.338201069956484e-02   +1.220501844716759e-01   +1.887267578494364e-01; +3.382511827023955e-02   -4.935361949565308e-02   +1.132129887999417e-01   +8.755907445336282e-03   +6.832730545144124e-02   +2.406842358390399e-02   -1.192821017369514e-02   -2.877451146459802e-02   +8.020742799001919e-02   +1.748153721193272e-01   +8.160113687520139e-02   +3.054066916231848e-02   -3.460514916863493e-03   +1.096660752593263e-01   +1.050157090164277e-01   +9.237536762124504e-02; +3.154653286132114e-01   +4.301211078526852e-02   -7.498429852131647e-02   +3.553083484348585e-01   +3.900913813959273e-02   +2.988795994092771e-01   -8.164704573537726e-02   +2.311081289805915e-02   +1.262323200214999e-01   +2.529100635046617e-01   +4.066070016082074e-02   +1.192880315767046e-01   +1.921599848667734e-01   +1.705240779782541e-01   -1.291202232371438e-02   +5.249443816142586e-02; -5.018786434630834e-02   -3.288668679226395e-02   -2.332648167534701e-03   +2.123542581467383e-01   +2.592942607636821e-01   +3.777413085590937e-01   +7.997308650468490e-02   +1.491055145806452e-01   +1.401852262071681e-01   +7.623387431794790e-03   -5.964564002780441e-02   +4.552654297240225e-02   +3.789818813555576e-01   +8.680191367302205e-02   -3.972502873297738e-02   +2.052166450211901e-01; +2.015097865350847e-03   +1.494001703830002e-01   -2.563196320393010e-02   +2.469658988826943e-01   -1.578263143270692e-01   +2.264268623582016e-01   +1.391028590687577e-01   -1.032836197250561e-01   +7.516014636039112e-02   +1.648771470611820e-01   +1.684413438782081e-01   +1.131644276160607e-01   +1.225825025801859e-01   +5.988885485141079e-03   +6.959159281535426e-02   -1.839370807010596e-02; +4.327488752585700e-02   -8.488055633122531e-02   +5.188269470913284e-02   -1.498816780157286e-01   +1.849341817023884e-01   -1.006707218703228e-01   +2.852965697231479e-01   +9.244388775833862e-02   +8.719985311163506e-02   +1.137578527614250e-01   +1.419429039883102e-01   +7.153409662751821e-02   +1.580739198288597e-01   +1.543226360614003e-01   -4.441634048713861e-02   +2.147285709999894e-01; +2.150686597761353e-03   +1.967961484535115e-02   +2.138649210244531e-01   +1.516531746619730e-01   -8.171346832013440e-03   +1.516366429439871e-01   -9.000406662735883e-03   +7.185073401166195e-02   +3.786093664268886e-02   +1.853029267944689e-01   +5.687171599278215e-02   +2.542701455079136e-01   +1.437545544478514e-01   -5.297316314730544e-02   +1.324013050862084e-02   -3.324995715930204e-02; -4.282216221216262e-02   -1.117905651862514e-01   -8.870729089730806e-02   +1.574728694475012e-01   +2.839477825362861e-02   -8.671462972221035e-02   -2.861365610553903e-02   +2.214266244050941e-01   +1.874757607512461e-01   +1.429182776645264e-01   +1.533741578356806e-02   +8.368188262338233e-03   +7.231463407261476e-02   +1.945359536639726e-03   -9.355763533133513e-03   +9.771510917486728e-02; +2.054656427258006e-01   +3.484239105023402e-02   +6.194160053010372e-02   +1.206486149731322e-01   +2.912003975370923e-01   +8.680069966066682e-02   +1.165434686402098e-01   +1.793433773981794e-01   +9.408717521743576e-02   +1.293915788683523e-01   +1.177357685842229e-01   +1.439360619779685e-01   +1.380815851924888e-01   +2.213288108973058e-01   +7.961470387454805e-02   +5.805105210723045e-02; -1.074656889054167e-01   +2.105538914048290e-01   +4.225114919287040e-02   +1.926920333483747e-01   +1.441835892392066e-01   +7.413530338226022e-02   +1.131540867849259e-01   +4.764015636637514e-02   +2.332806104708187e-01   +3.307277604477410e-01   +2.118328790042983e-01   +5.475457302810874e-02   +1.905397797047961e-01   +1.249588811215448e-01   -1.375625209906634e-01   +6.461417415371568e-03; +8.641754737119409e-03   -7.441132634830645e-02   +6.670122887549587e-02   +2.752550407212910e-01   -4.440330849246725e-02   +1.142270408070007e-01   +4.838258046902123e-02   +8.747479562619725e-02   +1.212319198389970e-01   +5.437529106732087e-02   -6.807007916655662e-02   +2.466997448855235e-01   +9.911466897546523e-02   +2.985300925636014e-01   -3.390984564602562e-02   -1.384466879982554e-02; +1.718480281109270e-01   +9.982439765342511e-02   +9.981104893466324e-02   +1.428504007471561e-01   +2.643671646180731e-01   +1.589669803911240e-01   +2.224361213496375e-01   +1.067388558770509e-01   +7.168164116987530e-02   +1.639419694567478e-01   -4.872593139575126e-03   +9.591123821772908e-02   -1.234254044168439e-01   -2.378591194601332e-02   +1.378653024857086e-01   +3.234213639459342e-01; -1.004775054045991e-03   +9.660027518028266e-02   +1.986462273136354e-01   -1.301250458043734e-01   +1.136098172012786e-02   +4.977435956044309e-02   +1.387464526713801e-01   +4.534812648636016e-02   +3.320258418587734e-01   -1.410404774996705e-02   -3.721226039792984e-03   -1.210385036013321e-01   +6.554937835139901e-02   +1.329338793574591e-01   +1.882715718727876e-01   +1.851572711712849e-01];
L1E_L1I_iGABA_netcon = [+5.808148386216420e-02   -1.950806523361595e-02   -2.366302026683102e-02   +4.272560868644802e-02   +1.163759972822017e-01   -3.590213813726852e-02   +7.617335837800002e-02   +3.022345496051216e-01   +1.126195619437553e-01   +1.352930100798765e-02   +1.285249339130377e-01   +1.100691993444950e-01   +3.969076541094473e-01   +1.704347320560133e-01   +6.936602447631643e-02   +2.568813062174524e-01; +2.736021458683551e-01   +1.370480328576030e-01   -1.240365714629246e-01   +1.900258034182842e-01   +6.564795311391072e-02   +1.915389998314228e-01   +1.067616195195494e-01   +4.416989569115969e-02   +1.858140450802602e-01   +9.395165606864893e-02   -5.549062044864002e-03   +2.087449023354119e-01   +2.044915002610190e-01   +1.273506994964224e-01   +1.726818685793869e-01   +5.530143773591843e-02; +4.337412501884899e-02   +1.479727047410747e-02   -1.923233511519665e-01   -9.375271745844531e-02   +2.503244057596345e-01   +5.117955506750248e-02   +1.881192881008471e-02   +1.485309967348002e-01   +9.857512385489933e-02   -5.940918922689768e-02   -1.871275690484189e-01   +2.125816330465351e-02   +2.447742565900272e-01   +2.327904453665116e-01   -1.218070755512251e-01   +1.946664821767259e-01; +1.898641333586144e-01   -1.322107461917313e-02   +5.477730142175455e-02   +9.580621254008868e-02   +7.337988777822634e-02   -5.976375940844447e-02   +1.517881262148308e-01   +1.285402158412733e-01   -4.035314836639017e-02   +2.479919508588782e-02   +5.825808761404747e-03   -4.936986734882658e-02   -3.278861876860428e-02   -7.066317893563009e-02   -1.971949342128116e-01   +2.424117059858672e-01; +2.091175404093030e-01   +9.559271888781154e-02   +1.235415766253670e-01   -9.843162088986412e-02   +1.434368887308622e-01   +1.871075706843293e-01   +5.442613786316663e-02   +2.114290480963245e-02   +1.723076726918885e-01   +1.775314972552060e-01   +3.236288697290780e-02   +7.056829050362423e-02   -5.564646563759836e-02   +8.612154628269836e-03   +4.685074431674384e-02   -9.228149980626187e-02; +1.706424299919364e-02   +1.847107416857342e-01   +2.130710298783328e-01   -2.237833456910615e-03   +2.189377923107549e-01   +2.065173363661369e-01   +1.534904892522941e-01   -1.512230755352462e-01   +2.498080867562060e-01   +1.848767861352458e-01   -9.542656899953816e-03   +1.374491505277681e-01   -3.134594789785144e-03   -1.061258406072726e-02   +1.274445314905107e-01   +1.153428994536234e-01; +1.541408886325890e-01   +1.848912331780899e-01   +1.755972259491256e-01   +2.033706319143005e-01   +1.193353503107594e-01   +2.105432582032579e-04   +1.679005716262382e-01   -3.834642187386359e-02   +1.175078827663324e-01   +4.670024113378689e-02   +5.652239127583528e-02   +1.428878887964804e-01   +2.860190727958879e-03   -1.807835325954270e-02   -2.535629664665856e-02   +2.368725115681187e-01; +1.365627377046933e-01   -5.025481435053310e-02   +2.964958961688942e-01   +1.777721505702073e-01   -1.646014319870808e-01   -1.194722536023406e-01   +2.515541877022344e-01   +1.111390701049652e-01   +2.298375605224881e-01   +7.124776197414948e-02   -5.173053356509171e-02   +2.108784872286545e-01   -5.859220381591870e-02   +1.395141212319485e-01   +2.076722649810962e-01   +2.268869652930978e-02; +1.071625261109143e-01   +2.281596593097336e-01   +2.149610037098533e-01   +1.247096730469980e-01   +2.581275314308210e-01   +5.555932080451326e-02   +1.154251894602219e-01   +1.279872654371211e-01   +2.048405007723791e-01   +1.806365913911084e-01   +1.412167218216683e-01   +4.581594524896822e-02   +6.980358542852497e-02   +1.247078995718369e-01   +3.298287538160671e-02   +1.841343087439661e-01; -1.007865577411527e-01   +1.550516359446148e-01   +1.145877790179264e-01   -1.250745579163673e-01   +1.320464302901872e-02   +1.054044464004789e-01   +1.872457755657887e-01   +8.925080065846897e-02   +2.161670771203918e-01   -2.178643934873036e-01   +5.355760236800459e-02   +1.074377511339920e-01   +1.457436056759506e-02   +1.075275579663274e-01   -2.137575095082607e-01   +1.191540345615935e-02; +1.397027909101326e-01   +1.850705198707074e-01   -3.677260852674533e-02   +8.577648523588284e-02   +1.237839296170883e-01   -2.140904951066775e-01   +2.776553510117121e-01   +1.628359232200798e-01   +1.996976955326226e-01   -1.267139037512853e-01   +1.430870556289084e-01   +6.104178006424503e-02   -5.143053511721282e-02   +2.111609393567522e-01   +2.640558220383203e-02   +1.097806739073379e-01; +5.062279207043684e-02   +1.155432674420211e-01   +1.643624327503686e-01   +8.857433142796052e-02   +7.349600700985989e-02   +1.425822981472868e-01   +1.455951290504547e-01   +9.623717462523898e-03   +3.469925889147552e-02   +2.328980448935913e-02   +1.121284285422121e-01   +2.226310759138733e-02   +1.085517145318677e-01   -2.112308364181256e-02   -2.900593669287622e-02   +2.538905424201421e-01; -9.326092364911999e-02   +2.745687426278264e-01   -1.793484764365777e-02   -4.677677691958527e-03   +2.176897757430249e-01   +3.602708141623602e-02   -6.205424579115617e-02   +1.600212327702795e-01   -2.013595668399829e-01   +1.705617109929404e-01   +1.388232211358313e-01   +3.371356913029742e-02   +2.708777799820387e-01   -9.122642358008570e-02   +2.539144642607968e-01   -3.106499764360557e-02; +8.990051583105428e-02   +1.829862631877941e-01   -8.394152699715274e-04   +3.090766744300833e-01   -6.797917990801502e-02   +2.120541771881088e-02   -2.033414161641024e-01   +1.653771532223518e-01   +5.095816653904400e-02   -3.144931330120809e-02   -3.394185473943187e-02   +1.103080806575037e-01   -8.864406770494793e-02   +1.794385774861216e-01   +8.143878866968499e-02   -1.782563996533175e-01; +2.067971924807329e-01   +4.316344014058592e-02   -2.298167692720192e-02   -1.527547373917374e-01   -9.718807242026180e-03   +1.094218502134370e-01   +7.848328717382184e-02   +2.205044109398348e-02   +1.614658639166422e-01   -3.136921716208604e-01   +1.262010884041251e-01   -2.409857364760900e-01   +2.921743043293589e-01   -1.834172030061472e-01   +4.998723311260336e-02   +2.094940242905882e-01; +1.958162261463083e-01   +2.123957286989914e-01   +1.328930949394264e-04   +2.812497130441571e-03   +2.653732750766737e-02   +2.610224013531745e-01   +1.102101795702792e-01   +1.768211722593873e-01   +2.396195477764334e-02   +2.793190293497153e-02   +1.176426317640798e-01   +2.210757789397649e-01   +3.083127249430308e-02   +1.707053989076764e-01   +1.436573977676518e-02   +1.380621620572351e-01];
L2I_L1I_iGABA_netcon = [+3.360220781062534e-02   +1.490988353470495e-01   +9.997366307917453e-02   +1.781404041534879e-01   +1.394065510867637e-01   +1.435866603066475e-01   -1.662013352492354e-01   -1.100585079914317e-01; +3.212024268873707e-02   -3.963351288223663e-02   +1.370984209234637e-01   -3.502967899791612e-03   +1.231875456587515e-01   +3.630929582887563e-02   +3.232851752126870e-01   +1.621049670921097e-01; +4.688327994338942e-02   +8.561047687663229e-02   +9.240947249600426e-02   +8.419273532197197e-02   +2.276518745388678e-01   +2.415103370197665e-01   -1.455105553861200e-01   +3.503400201484691e-01; +1.853583660875048e-01   -1.551190998828701e-01   -5.565203081728105e-02   +4.029743567067063e-01   +1.602993114786281e-02   +8.474966104690998e-02   +2.706141592010617e-01   -7.554221319309137e-02; -6.832804089242456e-02   +1.072650185997866e-01   +1.653679256049254e-01   +2.633131925791544e-01   -3.331772375547035e-02   +1.242063449973981e-01   -6.361858290280591e-02   +4.204501999802078e-02; -1.326807246856800e-01   +8.070783233885252e-02   +1.017330874988403e-01   +1.846601788113962e-01   +5.396891033361861e-02   +2.958983322534319e-01   -3.072796119847909e-02   +9.495317986009968e-02; -1.561340241203686e-01   -4.786765990003741e-02   -8.201103438628300e-02   +2.161873016184941e-01   +1.040369423965158e-01   +3.200397932872054e-01   +1.080715224806527e-01   +1.750421438957257e-01; +5.234428903164911e-02   +1.024613443490757e-01   -7.979173573317744e-02   +1.244867404550259e-01   +1.522935114654642e-01   +1.388620557121209e-01   +2.251633254668827e-01   +2.769184416238585e-02; +1.264471987802663e-01   -2.573086878570323e-03   -1.791133082345732e-02   -1.317008724149463e-01   +4.536099595007985e-02   +6.386607548774109e-02   -1.347265167106998e-01   +2.883998913888793e-01; +1.005633272195192e-01   +2.180356837293347e-01   +1.629909880211181e-01   +2.073093142061598e-02   +4.149397950607921e-02   +2.642678243191388e-01   +5.626437665804377e-02   +1.263290486886090e-01; +1.881050991963309e-01   +7.622724684502055e-02   +1.018591692188837e-01   +1.347275415183716e-01   +1.267274716513369e-01   -1.296130203210368e-01   +2.116554709080962e-01   +1.349980798446217e-01; +2.008057768016285e-01   -2.571764513963755e-01   +1.852323554765112e-01   +1.785345114005095e-01   +1.595534905572789e-01   -4.626686700577393e-02   +5.172402405282567e-02   -8.148049207800850e-03; +1.609219755865300e-01   -7.503097998599416e-02   -1.871716311368257e-03   -8.883941099124583e-02   +2.906959747824212e-02   +1.165300528823309e-01   +6.594911651607635e-02   -8.222761112170549e-02; +1.272080379530478e-02   +9.376526411301213e-02   +5.777631516034386e-02   -2.840259028729211e-03   +1.035294067687585e-02   -3.318253235112673e-02   +1.348018916597596e-01   +2.637607244385209e-01; +1.380547995920878e-01   -1.629070331799635e-01   +1.954512449012483e-01   +1.712619952120884e-01   -6.737310287300027e-03   -1.511700213414387e-01   +8.240204894405720e-02   +1.616337571781362e-01; +4.365968693387798e-02   +1.956213759311801e-01   +1.043291039899721e-01   +1.830639959722162e-01   +2.334702810610559e-01   +1.775646014510622e-01   +2.381938024940113e-01   -3.363596567277864e-02];
L1I_L2I_iGABA_netcon = [+1.830433844166663e-01   +1.769252594287906e-01   +3.267322206866650e-01   +2.745025399500843e-02   +9.127025259985430e-02   +6.940660530267002e-02   -6.197048333275554e-02   -8.726249858944748e-02   +4.048791754514436e-02   +5.512693439092332e-02   +1.727491937862600e-01   +1.322456113167267e-01   +3.393415109716190e-02   +1.531435646164029e-01   +3.514308652682892e-01   +9.146361203647388e-02; +5.943108645062211e-02   +4.701148269596156e-02   +1.780130727408065e-01   +1.896726300015133e-01   +7.465784890779971e-02   +3.754076905837518e-03   -2.187573229518759e-02   +3.235293801052294e-01   +1.325023486536397e-01   -3.403082562193829e-02   +2.631544200464446e-01   -1.019497480125370e-02   +6.996064489005226e-02   +6.234631459550474e-02   +2.434678425352915e-01   +1.013512048469151e-01; +2.085105420548393e-01   +1.297721164900857e-01   -1.268233615157171e-01   +1.174471187360253e-01   -3.224155455765362e-02   +1.635162042874290e-01   +6.208504981948248e-02   +2.369953797332763e-02   +2.632081106418724e-02   -1.494783403648257e-01   +9.400756154771059e-02   -1.076911481998733e-01   +2.284821407510191e-01   +1.677531145440130e-01   +1.558096018845594e-01   +1.187532724754451e-02; +1.359743024791167e-01   +1.931114402133932e-01   +5.038148765882241e-02   -2.063528620397963e-02   +2.713781174995463e-01   -2.872657914290231e-02   +5.627210614548196e-02   +2.114241444298118e-01   +4.253152059631035e-02   -6.569818468439384e-02   -2.131780552892185e-02   +1.132811731740229e-01   +2.547281551336018e-01   +2.368484160685157e-01   +1.092753750031508e-01   +6.026671269951272e-02; +1.374913230206422e-01   -1.768953692009247e-02   -2.198166525178658e-02   +1.017410696574692e-01   +1.020196410591930e-01   -3.203672329543213e-02   +3.096898753591970e-02   +2.749744472194061e-01   +1.464566890406995e-01   +2.754420844077822e-01   +3.233797421560948e-01   +9.724783828664571e-02   +1.035870230503841e-01   -6.158757151647948e-02   +2.094563502110545e-01   +1.739165714524452e-01; +1.780368447079944e-01   +2.248622824573746e-01   +9.244988973378256e-02   +2.529434435338603e-01   +2.615928579149504e-01   +6.343171560174694e-02   +2.430510991230058e-01   +2.393860728269881e-01   +1.702655579614000e-01   +3.979049380663772e-02   +1.485441655736383e-01   +5.767019895166729e-02   +7.433598948059009e-02   +1.447505440858062e-01   -3.719027878114098e-02   +1.213985671637673e-01; -5.966189484448250e-02   +2.649853066107030e-01   +1.284632855453762e-01   -4.750834182944025e-02   +3.793806209605766e-02   +7.159437061873830e-02   +1.730648991223393e-02   -1.726000552277366e-01   -7.197130193289135e-02   +1.398561583868392e-01   +2.379112909859993e-01   -4.973133524777960e-02   +2.771738065017729e-01   -1.640404039039436e-01   -7.855015015358267e-02   +2.050512550506922e-01; +5.905944247240742e-02   +2.560647807226440e-02   +2.485747121818375e-01   +2.162898208979937e-01   +2.552973452882888e-01   +3.498078024877847e-02   +2.013338725308633e-01   +1.247036747115325e-01   +6.892149249029517e-02   +1.843920866314528e-01   +2.052147434910140e-01   +2.700076455692412e-01   +1.036909774442995e-01   +1.070598631560184e-01   -8.531898241097097e-02   +5.878780618825359e-02];
L2E_L1E_iAMPA_netcon = [+2.297686034197181e-01   +4.662984277367069e-02   -6.312903134362423e-02   +1.110498346756552e-01   +2.409588948355655e-01   -2.178961179908342e-02   +2.536860455246200e-01   +2.440993329677463e-01; +1.318206548519041e-01   +2.005095451729757e-01   -1.866733720306640e-02   -4.126793396691614e-03   -4.931392729879453e-02   +8.663265199471974e-02   +1.799902212119457e-01   +1.867902723892252e-01; +2.463227604290050e-01   +1.176363657417950e-01   +2.051978674552797e-01   +2.006075335635073e-01   -5.924094072573100e-02   +3.235701430783647e-01   +6.016319055774100e-02   +6.835294950414719e-02; +9.018509769674712e-02   +1.118224100565334e-01   +8.145996158704322e-02   -3.663875367113255e-02   -6.734022215195423e-03   +7.719882011063986e-02   -1.851824533374342e-01   -4.674303121260533e-02; +2.262179072122745e-01   +1.385921783991175e-02   +1.471602486495523e-01   +1.951034363908644e-01   +3.044930803017318e-01   -1.341711848191221e-01   -3.509085589995051e-02   +3.994065610144941e-02; +3.200215470404422e-02   +1.754015632867238e-01   +4.107153843711087e-02   -3.372479387695054e-03   +4.615244334138779e-02   +1.546244765478378e-01   +9.728828210886890e-02   +8.134921736646604e-02; -1.940666069742106e-02   +1.173500580836774e-01   +1.521779237348480e-01   -6.827780015510804e-02   -5.984449613135978e-02   +8.173582069678056e-02   -3.081774229348769e-02   +1.291496311842491e-02; -4.139223847985464e-02   +6.082186785150837e-03   +2.377136716888347e-01   +2.558848636418896e-01   +4.549678881499039e-02   +2.610642180046703e-02   -2.179752311789511e-02   -2.062462709950695e-02; +2.750046919715262e-01   +1.156810881379889e-01   +1.422130126123577e-02   +1.888114178577711e-01   -1.139508516956807e-02   +7.350144865955888e-02   +1.446566602501245e-01   +2.468921133253064e-01; +1.151227007792993e-01   +1.571392743195492e-01   -2.567490154946240e-03   +9.216951668584569e-02   +6.031953006609772e-02   -1.071299266697305e-01   -1.646347019428432e-01   -9.754149047553320e-02; +2.336335291015910e-01   +3.068556021355269e-01   -8.828763925063604e-02   +2.897171513619721e-01   +1.191103552842187e-01   +6.818086046178026e-02   +1.933396529547686e-01   +2.865978851137976e-01; -1.105733270148439e-02   +7.450490325813894e-02   +2.099430697337805e-01   +1.381251895500099e-01   +2.247542854320730e-01   +6.132450252019046e-02   +1.875784860690333e-01   +1.302707196973859e-01; -1.351678591704651e-02   -5.957473972271043e-02   +1.965417457590789e-01   +6.705608257601618e-02   -2.749934360941053e-02   +1.008495449481700e-01   +2.158023445059311e-01   +1.939111178482681e-01; -6.850450478054582e-02   -2.065526997844698e-01   +5.878068386583730e-02   -7.158028617875967e-02   +3.161835958081778e-01   +2.474551470839821e-01   +2.010895899779198e-01   +3.119873521669619e-04; +2.554265959424347e-01   +2.326853599874556e-01   +7.882337823489965e-02   +1.620081194797912e-02   +6.305767660326110e-02   +2.897032904781587e-02   -1.270111553723698e-02   -1.786611650998210e-02; +3.113392478107498e-01   +1.754696631499913e-01   +1.324271869842474e-01   +8.419383569188635e-02   -1.978826878509707e-02   +7.258564751948880e-02   +5.463878525280265e-02   +5.064421006036349e-02];
L1E_L2E_iAMPA_netcon = [-9.039892960779772e-02   +4.209181011145463e-02   +4.795116802496417e-02   +2.840943352400335e-01   +1.400302469922697e-01   +7.012274667209047e-02   -4.477951944839839e-03   -8.521764230729137e-02   +2.414480490867301e-01   +3.758066042170006e-02   +1.933281210584932e-01   +1.056416564213078e-01   +2.169464785890235e-01   +2.141481867855773e-02   +1.499324409483737e-01   +1.630952534859935e-01; -4.611126899369247e-02   +3.257648286869708e-02   +3.859803053465533e-03   -1.129920489612735e-01   +8.973483138461408e-02   +1.526064110958148e-01   -7.702399353411127e-02   +6.161708903112116e-02   -5.330665389564469e-02   +6.432699851883174e-02   +2.977821211509150e-01   +1.656423171914865e-01   +7.805636709163963e-02   +4.960918456564124e-02   -7.786964637176985e-05   +2.560008896959337e-02; +3.246960479807580e-01   -1.890456775833141e-01   +2.066668169827454e-01   -3.187993969989347e-02   +1.939849055809380e-01   -1.685707760496860e-02   +2.020930678491463e-02   -1.008281565342037e-01   +3.733155303321721e-02   +1.608209028325598e-02   +8.518778455396818e-02   +5.873163336624813e-02   +9.853755516445857e-02   +2.558583669513183e-01   -7.572837548138622e-02   +1.271209553081050e-01; -1.843054310622751e-01   +9.416998423628534e-02   +3.049301269704534e-01   -5.094493829172226e-02   -4.518205355714956e-02   +5.641578204730809e-02   -5.908828281971762e-02   +7.326993666583444e-02   +5.484582913608427e-02   +3.042613431301532e-02   +7.738672192615309e-02   +2.142752047621216e-01   +2.348631355162064e-01   +2.850430764450406e-01   +2.306154337902619e-01   +7.385931160451668e-02; +2.116660828318772e-01   -8.035781554986017e-02   +7.066291052968805e-02   -2.091769539991969e-01   -9.665501172347982e-02   -3.434118098019939e-02   +2.727317155264453e-01   -1.811653156497077e-01   +7.112076252499566e-02   +1.063384633078563e-01   +3.966105275238899e-03   +1.904443684609778e-01   +2.318988961523106e-01   -2.658192095463099e-02   +1.413544340416185e-01   +7.454349075459936e-02; +2.256803373959803e-01   +5.034174317435747e-02   +2.356240164439994e-01   +1.063123884181362e-01   +1.888896421356633e-01   +1.152969425772006e-01   -1.329019957748671e-02   -1.154079476756575e-02   +1.043364341575476e-01   +1.010780226320699e-01   +1.663256318307257e-01   +5.534345217882199e-02   +2.240866566525770e-01   +7.070585937044145e-02   +1.146900234217259e-01   +1.002091016788534e-02; -1.839446735677561e-01   +2.504500296309761e-01   +1.965774965595979e-01   +6.540429665431341e-02   +8.973665275158955e-02   +3.756393270893189e-01   -2.048017986617884e-02   +1.389844204471670e-01   -7.635080058845653e-03   +4.185856751351278e-01   -1.084700269533490e-01   +1.846700600373681e-01   +1.856284852511418e-01   +1.693289007123068e-02   +1.597351941891609e-01   +9.436636800388071e-02; +1.978489803016681e-02   +2.857919471604137e-01   +7.550900832084648e-02   +6.376147459103831e-02   +1.824932964893570e-02   +4.737205247415929e-03   +2.074580225007228e-01   +2.237758781143608e-01   +9.006000202462335e-02   -2.118258192677132e-01   +9.603951910964943e-02   -7.111313428418999e-02   -1.176602658939736e-02   +3.403675148862535e-01   -5.914033842146766e-02   +4.390773238645572e-02];
L2I_L2E_iAMPA_netcon = [+2.624036465356169e-01   -3.773016961627947e-02   +1.067053030229113e-01   -1.867594835977427e-01   +3.731445017018705e-01   +7.976421310347749e-02   +1.686402400589144e-01   +1.265689277012600e-01; -4.201113978117597e-02   +5.098644868193090e-02   +2.545282686973906e-01   +1.711934841693258e-01   +1.196045380943677e-01   +2.356687994487072e-01   +1.267722665822471e-02   +1.114918913148696e-01; +5.624791452424805e-03   -1.197685513572312e-01   +4.269082302415768e-02   -6.414042341138773e-02   -6.764776620034248e-02   +1.608890872145113e-01   -1.946264048081613e-01   +7.868999991403271e-02; +1.734800012103269e-01   -6.352734879421595e-02   +1.246205683804081e-01   +9.667100547942475e-02   +1.180695398347362e-01   +2.230228660994308e-01   +9.678565425583321e-02   +2.622828553531819e-01; +1.819126265536972e-04   +1.184653120079551e-01   +3.614036707624076e-01   +2.721175607223776e-01   +1.049555088633357e-01   +1.262385145198077e-01   -5.072113013767712e-02   -8.889977056238889e-02; +2.678250368777498e-01   +1.306176023325627e-01   +2.874324436529416e-02   +1.607582552214063e-01   +1.318253336386029e-01   +6.353829713433708e-02   +7.501523288937345e-02   +3.081490816192322e-01; +1.247530914618945e-01   -5.535255237510826e-02   -1.602149139040637e-02   +2.008420649684692e-01   +1.862138423598469e-01   +1.872436894766981e-01   -8.563901125147841e-02   +6.944120268605539e-03; -1.397348668306611e-02   +2.906148411147878e-01   +9.163684631940941e-02   -5.421935456414034e-04   +1.854940381293095e-01   -9.808569960642541e-03   -7.232456531880821e-02   +1.226049070247920e-02];
L2E_L2I_iGABA_netcon = [-1.812691791568348e-02   -1.828096048208221e-02   +2.456414262054440e-01   +1.771755166652879e-02   -1.872082283260510e-02   -1.194013151063842e-01   +1.501426109282398e-01   +9.886525916653451e-02; +2.862175115178816e-01   -6.624128870882143e-02   -1.223964708118004e-01   +1.866473467456220e-01   +5.819229044138313e-03   +2.172972959950240e-01   +4.172028228239008e-02   +1.762792310097577e-02; +1.606796851458920e-01   -1.029921928427412e-01   +2.129242768874554e-01   +2.390758684581422e-01   +8.882507894098737e-03   +5.295366192563347e-02   +3.860667659425208e-02   +1.428598858672262e-01; +1.431122112597339e-01   +3.330127447582785e-01   -9.451250242012717e-02   +1.731738349877879e-01   +9.909882918795754e-02   +1.710431754345785e-01   -1.577665117686126e-01   -1.681230535713631e-02; +1.730825994065736e-01   +9.495956019382386e-02   +1.249962544813152e-01   +1.960671677173390e-01   +2.466363056922507e-01   +1.290322232033175e-01   -2.538254682960188e-01   +2.449238415509216e-01; -1.658723090055761e-02   +1.548290738630009e-01   -8.334085096838435e-03   +7.264969824905518e-02   +2.279365224453899e-01   +2.268488682927589e-03   -1.825536196963139e-01   +2.889813820706504e-02; +6.662645149865801e-02   +1.443985205039898e-01   -1.429970723607146e-01   +3.005073893539953e-01   +1.531770556847319e-01   -3.544894665318907e-02   +3.730841430699874e-02   -1.282834264466778e-03; +2.491889814475299e-01   +1.683239878483232e-01   -7.110042339453190e-02   +2.383891637179739e-01   +4.628672017760631e-02   +1.934262741161354e-01   +2.124183313575905e-01   +1.293133845536667e-01];
L3E_L2E_iAMPA_netcon = [+1.574450167308564e-01   +2.045733251667018e-01   +1.472866588996006e-01   +9.978616428926564e-02   -5.499823461351627e-02   +2.682653719801954e-01   +7.815608122983930e-02   +6.408414449527594e-02   -9.391846483714737e-02   +2.362588835183952e-01   -1.200776842605686e-01   +2.044613919539057e-02; +7.326727062041552e-02   +1.315694805238445e-01   -2.111333109621103e-01   -2.252801993194817e-02   +6.673359520431314e-02   +2.156163005651365e-02   +2.585352439267741e-02   -7.576318764485920e-02   +3.467270278878815e-01   +4.751656460040324e-02   +9.236790070682158e-02   +1.422528160927744e-01; +7.532039430517398e-02   +2.743760896894036e-01   +3.409435580661307e-01   +3.061806953838012e-02   +1.227202819244162e-01   +2.800931888222266e-01   +2.821245585592289e-01   +7.201220553929545e-02   +1.387264568550310e-01   +1.460446624035838e-01   +1.241721160228943e-01   +1.226378934127650e-02; +8.014570720616830e-02   +4.710929732925805e-02   +2.020720754478036e-01   +2.580853292185179e-01   -4.258671320847486e-03   +2.157207091921164e-01   -8.125547847708803e-02   +4.918916639235076e-02   +4.385186882200079e-02   +5.911588457836358e-02   +1.975651009624818e-01   +2.300890497374367e-01; +1.869838773582662e-02   +3.818634455135674e-01   +2.389206615989321e-02   -7.456118820160881e-03   +5.668317728523202e-02   +1.949280479143753e-01   +1.737348820373568e-01   +2.743368587076360e-01   -4.605265079939533e-02   -1.882903886679521e-01   +2.005472946697574e-01   -9.189468844327842e-02; +6.278579313023139e-02   +6.888852012545635e-02   +2.540229521253749e-02   +8.842334240326899e-02   +2.275658928526158e-01   +1.584210119982447e-01   +1.760062162345462e-01   +1.172994412325997e-01   -3.682651595854777e-02   +1.400447100862445e-01   -1.726770991709160e-01   +1.434137335500955e-01; +1.805744729352171e-01   -6.677181806253277e-02   +8.803412610028964e-02   +7.570476307573544e-02   -6.103142391326757e-02   -1.474105792879738e-01   +1.965473067426116e-03   +2.604483399792001e-01   +5.904269063898791e-02   -9.083392419645082e-02   +1.100253459743005e-01   +1.449038747803523e-01; +1.518313925257667e-01   +1.380772299890106e-01   +2.872818989384366e-02   +1.555830254072147e-01   +2.394042349823979e-01   +1.773390205482807e-01   +2.142013160969167e-02   +7.866121034691022e-02   +2.264315212212091e-01   -4.307254982332526e-02   -1.642694363874104e-01   +4.321038457298362e-02];
L3I_L2I_iGABA_netcon = [+2.679233419239763e-02   -1.116318239530495e-01   +2.124979679287763e-01   +1.210306340286647e-01   +6.314970632776901e-02   -8.362867071293659e-02   +2.670660838612837e-03   -5.524492332057920e-02   +7.224151759614288e-02   +1.957005427019780e-01   -4.428015897318144e-03   -7.601192965344866e-03; +2.505878123766594e-02   +5.951586401691827e-02   +1.990450509858031e-01   +1.785305183452915e-01   +1.163157255742663e-01   +2.311135557166099e-01   -5.457529245162025e-02   -1.635700712498599e-01   +2.528993512504580e-01   +2.501427753595019e-01   +2.087093441176014e-01   +1.939000856501380e-01; -2.248759574330558e-03   +7.581734937192994e-02   +1.137533181915496e-01   +8.735321544733007e-02   +1.667323307314990e-01   +8.903379845694670e-02   +6.488367488985312e-02   +2.571498775525558e-02   +1.303049701829806e-01   +2.218268404954666e-01   +1.103304923739086e-01   -1.058104720335196e-01; +1.942651942828563e-01   +1.779683147031126e-01   +1.950739548990542e-02   -8.339741374838747e-02   +3.107390479060589e-01   -4.635844625932048e-02   +1.332456406945385e-01   +4.683668195283486e-03   +2.147279448082338e-01   -1.020848029538257e-01   -7.796930689419897e-02   +1.060266962485970e-01; +1.303476128875268e-01   -2.466241863703123e-01   +2.669832468291073e-01   -2.496566473211975e-03   +1.991978302303234e-01   +4.630558373915995e-02   +1.434420042331221e-01   -1.106539728420177e-02   +9.601493105073938e-02   +2.009118711495749e-01   -1.267677128615825e-01   +9.113918696201520e-02; +1.839530106333838e-01   +1.275335057080511e-01   +2.158026422160663e-01   +2.386327776784780e-01   +2.841061871219902e-01   +2.607944609984919e-01   -3.691310728017486e-02   +1.003951323819188e-02   +2.544559922406398e-01   +8.876790051211669e-02   -1.959719199798772e-02   +6.235055892554442e-02; -9.437358571756257e-02   +2.175030551562835e-01   +2.360814092437708e-01   -1.473378777589863e-01   +7.329378358310555e-02   +4.228638913299530e-02   +1.981698442324170e-01   +1.040791183439068e-01   +4.654134008600715e-02   -5.641678780269726e-02   +2.064115169312848e-01   +5.322639484442796e-02; +1.596484236323434e-01   +9.910563153024204e-02   +1.660415558498303e-01   +1.627702896649346e-01   +2.521030892041378e-01   +1.923020075897576e-01   +1.868131609684485e-01   +2.526848479001884e-01   +1.289525859767287e-02   +9.807610535874930e-02   +3.894629668478804e-02   +3.747399830764020e-02];
L2E_L3E_iAMPA_netcon = [+1.727512374719721e-02   +8.689226496462010e-02   +6.372774829903483e-02   -4.091994918218194e-02   +2.811065764162940e-02   +8.789564833358886e-02   +2.941354218684473e-01   +1.775578283915012e-01; -9.570244216830458e-02   +2.237756145927566e-01   +1.263248300945228e-01   -1.334630250603585e-01   +2.963373621917718e-01   +1.035018751528673e-01   +1.448322390470480e-01   -7.559258309880648e-02; -6.788867167849286e-02   +1.486123214069250e-01   +1.280699610537682e-01   +2.745746381798555e-01   +2.743890854775483e-01   +3.074575647837935e-01   +3.362540640414444e-02   +9.349751159557348e-02; -8.571124371894683e-02   -3.351756939567781e-02   +1.217434670051873e-02   -1.146789052217007e-01   +9.228096990980329e-02   +2.791526504660458e-01   -1.128620243379670e-01   +4.343348642921532e-03; +9.107786865289053e-02   -1.215773182007302e-01   +1.319489396845130e-01   -5.849683216989908e-02   -1.515914016746857e-01   +2.223457372137711e-01   +2.185802654606329e-01   +4.280356878904215e-02; +1.457339429401459e-01   -1.277770624128527e-01   +9.356785012070512e-02   +6.083885793343861e-02   +1.703787782749563e-01   +3.697275446747849e-02   +9.656132262801044e-02   -1.359808635942420e-01; +1.559069294436311e-01   +9.446289744389280e-02   +1.630417095469377e-01   -1.660164792296137e-03   +4.918858645854707e-02   +2.140534205516879e-01   -1.948293197667885e-01   +1.711920132754256e-01; +8.370951591051307e-03   +9.356979077580692e-02   +5.493766328780757e-02   +2.226491666301106e-01   +6.043247851730957e-02   +2.546389209347616e-02   +9.949986031970887e-02   -1.085184338056481e-01; +1.984313941345860e-01   +2.194183644103224e-01   +2.224374090631487e-01   +2.056379506427141e-01   +5.823628964794520e-02   +1.449566004668166e-01   +1.724307023235862e-01   +2.159798647850240e-02; +3.109055585163041e-02   -2.768269382054910e-02   +2.303832324845646e-02   +1.924287675087516e-01   +2.073931688271815e-01   -5.637917477659998e-02   +2.650020345578717e-01   -1.616963270408872e-01; +1.419368623521055e-01   +5.927268055111676e-02   +1.608081028280103e-01   +2.125264857796839e-01   -1.361422930399759e-01   +1.064968448203668e-02   +1.050798645092695e-01   +5.980530676776905e-02; +1.247127456158583e-01   +2.159646148847905e-02   +2.062882720502835e-01   +2.322794265714921e-01   +2.320540134344060e-01   +2.354836350623851e-01   +1.359950177420262e-01   -7.284157771086477e-02];
L2I_L3I_iGABA_netcon = [+1.342927232842633e-01   -2.198399621436729e-01   +8.446447293517714e-02   +1.116733342593887e-02   +2.110005076373846e-01   +5.562491448792149e-02   +3.375604756213917e-01   +2.539857024295923e-01; +1.664631541747967e-01   +1.984572392854156e-01   -7.516998338788622e-02   +1.743245467765527e-01   -8.443933974839285e-02   +7.630399500659819e-02   +1.019756857320375e-01   +3.813858713910964e-02; +6.355443266734118e-02   +9.137904592169577e-02   +1.711028447264255e-01   +2.296066722227938e-01   +1.504004519458790e-02   +1.368376097031071e-01   -5.751625856712500e-02   +2.266309519467818e-01; +9.767949189817404e-02   +8.702486424655995e-02   +2.757213826086296e-01   +1.502273139296103e-01   -3.427968101519088e-03   +1.686775636835380e-01   -1.143751853586676e-01   -6.739033647158285e-02; +3.441685950494031e-01   +3.468454934333437e-01   +1.632713191878979e-01   +2.400391355987337e-01   -2.374709446863542e-03   +2.028736483064018e-01   +1.058176947509939e-01   +2.387759397760220e-01; +2.380352306925873e-01   +2.247698985867830e-01   +1.761600942783034e-01   +1.201912300093395e-01   +1.397995774602989e-01   -1.598593707620082e-01   +3.403376414731663e-02   +3.271060859906005e-01; -5.368805737875525e-02   +2.513485612095195e-01   +2.712056245903708e-01   +3.224792404905615e-01   +1.466128238961905e-01   +2.346697541896037e-01   -6.664653470928122e-03   -7.492270258621687e-02; +1.338637023666706e-01   -3.996378962982186e-02   +9.013936597730110e-02   +6.914398234283446e-02   -4.093217000458464e-02   +1.839522764404924e-01   +8.388203279007386e-02   +4.785248630734698e-02; +2.046811029173105e-02   +2.605282780797248e-01   +3.637259675182928e-02   +1.984517487639142e-01   +1.438577959007680e-01   -1.589642556696368e-01   -1.439317573299437e-02   +1.389971293924222e-01; +2.041581530589170e-01   -5.882519760456140e-02   +9.793270702219026e-03   +1.449425670252286e-01   +1.517482448840455e-01   -2.191639467122815e-02   +6.221183596948390e-02   +8.383947221180699e-02; -1.750885383720504e-01   +1.796937959194858e-01   +2.554998631508664e-02   +4.867183305930776e-02   -2.991336583394578e-02   -9.017221318581743e-03   +6.542514568802210e-02   -3.611980451972367e-02; +1.905354782144700e-01   +2.361788136333320e-01   +3.509309471368550e-02   +2.348551459734952e-01   +1.736331631983050e-01   -9.830534043863114e-02   -1.850943787679521e-02   -2.083040401632417e-02];
L3I_L3E_iAMPA_netcon = [+4.135173816847798e-02   +3.344942025161713e-01   +2.962128282963259e-02   +2.059430897718578e-02   +2.892750592392101e-02   +1.427489923695761e-02   +9.820624757323501e-02   -1.018895594991892e-01   -3.061934672760483e-02   +2.130178146857589e-01   +2.747112260217592e-01   +9.828192086113208e-02; +6.891410810894716e-02   +2.387191334355831e-01   +6.181395375455528e-02   +4.461920049410151e-02   +3.104235480539517e-01   -3.361450881102085e-02   -7.886601116112406e-02   -9.237162863107573e-03   +1.440233489956573e-01   +6.728086116357496e-02   -8.512208622574871e-02   +1.164749454771926e-01; -6.999422635315243e-03   +6.744044452120491e-02   -1.645359519319538e-01   -1.300255956861665e-02   +8.841338594306698e-02   +1.999748864845743e-01   +1.081735797501790e-01   +5.615399782575796e-02   -3.601365508892506e-02   +3.215847485299086e-03   +1.044612147545619e-01   +2.766084954445678e-01; -1.945683994560392e-02   +3.413901092970642e-03   +2.129468836234955e-02   -4.746216980112140e-02   +2.500201236171656e-01   +1.495014897357016e-01   -7.811946429182594e-02   -1.691647630521195e-02   +5.587177304496005e-02   +1.574672569108321e-01   +1.191549165367275e-01   +7.989524839779691e-02; -2.240256713988449e-02   +6.656207028384870e-02   -1.127090719325315e-01   +6.318682754837321e-02   -9.113298678164283e-02   +1.972266356025543e-01   +2.539588530870332e-01   -8.545317229770658e-02   +1.532935441930903e-01   -1.651161641477251e-01   -2.177924783259097e-02   +3.144402064920500e-01; +1.668510106731398e-01   +9.226204545741680e-02   -5.637490817793217e-03   +1.566366025470227e-01   +2.009487967983944e-01   +4.068807792908606e-02   +1.334441440309778e-01   +3.269256690850227e-02   +1.101252968420745e-01   +1.595795259882922e-02   +3.820295768553265e-01   +2.299321955699895e-01; +5.023941470410717e-02   +3.110802528480738e-01   +1.486871154819376e-02   +1.988502015068054e-01   +1.720144003496175e-01   +1.159705323192140e-01   +1.762480208058928e-01   -1.130803388673905e-01   -9.927185546358604e-02   +2.600671070674561e-03   +6.372198052896498e-02   +3.689471225724176e-01; -4.070464941224399e-02   +1.019377613805907e-01   -9.770260141213852e-02   +2.693940465496949e-03   +1.534241022897846e-01   +1.084698708750655e-01   +1.109697673492085e-01   +1.809519495735388e-01   +1.639561944499033e-01   +2.394642393532116e-01   +2.256978718235002e-01   +1.038152859904079e-01; -1.299104798262737e-02   -1.907215239988333e-01   -6.372831656272214e-02   +1.793616643599331e-01   +2.055433643043098e-01   +9.021083222123867e-02   -1.575687542207088e-02   +1.816298101291306e-01   +1.215725969807248e-02   +8.906913206690396e-03   +6.963000190948274e-02   -6.477628058198664e-02; +1.756160383473275e-01   -2.494349888564149e-01   -2.120212108005762e-02   +1.104614585181323e-01   -2.198524974764909e-02   +2.219035355555755e-01   +1.393290954943321e-01   +1.285772742600653e-01   +3.248575908496121e-02   -4.197947569913538e-02   +1.685932314283984e-01   +4.087570139401279e-02; +5.858555304001035e-02   +8.603086680108771e-02   +1.903416710691661e-01   +4.540990592656165e-02   -7.876383499626688e-02   -5.622007605580362e-02   +1.167447417263213e-01   +6.871496161905791e-02   -1.072895097880631e-01   +1.898646560046169e-01   +1.617240832303387e-01   -2.830071389096864e-02; +1.007539731615118e-01   +2.939130692827571e-02   +1.180577627119153e-01   +3.255302317290487e-02   +4.672079525075190e-02   -7.363199307012461e-02   -1.914878421393072e-02   +1.185641412683080e-01   +1.882585057554173e-01   +1.061872387347759e-01   +4.104715471438972e-02   +9.134974527236332e-02];
L3E_L3I_iGABA_netcon = [+1.733512417063887e-01   +2.149300299618298e-01   -7.873815489441285e-02   +2.298234342037569e-01   +1.030655563422032e-01   +8.311134958548425e-02   +1.839644414948527e-01   +1.657565017824565e-01   -2.201073937878952e-02   +2.855370268232962e-01   +2.550448237913465e-01   +2.793894661924946e-01; -6.675779146868979e-02   +1.004008201604067e-01   +1.846931926627403e-01   +1.918372702236486e-01   +2.336702313566038e-01   +1.221595891168631e-01   +1.120768523640311e-01   +2.730152587502509e-01   -1.543915085262942e-03   +4.362536294576022e-02   +3.044244752469175e-02   +1.742680629942336e-01; +5.813612482385904e-02   +2.504380890266193e-01   +7.570429323354012e-02   -1.411028137054477e-01   +8.038279740127557e-02   -3.210631158061421e-02   -6.170696227916149e-02   +2.862989144485423e-01   +1.861436614987124e-01   +3.038684236924834e-02   -1.611749722932941e-02   -8.111733903595164e-02; -1.161997696729793e-01   +1.315622413751292e-01   -6.900285509903223e-03   -5.151905723706891e-02   +3.733420801503586e-02   -2.939562639085179e-02   +1.316174265662818e-01   +2.118406075853966e-01   -1.733172319341791e-01   -7.168278790232667e-02   +2.486112751856426e-01   +2.607815530562979e-02; +1.846405285360018e-01   -1.155582032825211e-01   +2.795399194217150e-01   +2.717196188878240e-02   +1.479843728405422e-01   -2.441507038013993e-01   +1.315308919832367e-01   +5.871176480204863e-02   -1.669138067264439e-01   +7.389708511381404e-02   -6.390900272245906e-02   -5.175801708685676e-02; -4.643604389634783e-02   +7.075576905498389e-02   -6.837475597293678e-02   +6.635004075801851e-02   +3.045986623930751e-02   -6.246104592275714e-02   +1.497221996894068e-01   +2.165442865996206e-01   -3.414539949703903e-02   -9.668062394700798e-03   +1.323694585990584e-01   +4.987732203655107e-02; +7.538767126358546e-02   +1.249781160809029e-01   +2.680680732136976e-01   +1.289791981509619e-01   +1.374507442089818e-02   -6.335712357430365e-02   +2.016460696919993e-01   +2.838301711133275e-02   +4.361470197136699e-02   +2.165783631086651e-01   +2.308995662712029e-01   +1.042038020903598e-01; +1.019223927320189e-01   +3.487228467681098e-02   +1.045331619060411e-01   +2.046373207253868e-01   -5.424973536974248e-02   +9.504194848676063e-02   +2.305070937269318e-01   -4.832142702061509e-02   +2.276142150599372e-01   +2.604639365819302e-01   -3.783775838234141e-02   -1.322080137997856e-01; -1.125275527700748e-01   +5.180429538754058e-02   +3.612292419144562e-02   +2.278960886347501e-01   +2.969990784063285e-02   +6.734357487424852e-02   +7.915110299909670e-02   +1.459859712898673e-01   +1.084764829141887e-01   +2.391696056740290e-01   -5.975639954694469e-02   -3.004619377442601e-02; +7.138887431895286e-02   +6.837330173991170e-02   -2.539181139985923e-01   +1.297938832660490e-01   +9.578425695202109e-02   +1.283665623189311e-01   +4.003309520446676e-02   +2.790518035400895e-02   +9.321988315020688e-02   +2.224327200675060e-01   +3.242217566996132e-02   +5.868098069653561e-02; +1.389570707132563e-01   +3.800152190807047e-02   +1.852442851808832e-01   +1.191799486063696e-01   +1.259199945155699e-01   +1.532897429036669e-01   +1.469735202145733e-01   +1.016712908499058e-01   -9.821578426707119e-03   +1.800667680274590e-01   +2.193215048700939e-01   +2.617554415233269e-02; +5.439228798083216e-02   -1.310562795979026e-01   +7.845775911045397e-02   +3.786254339864019e-02   -6.370122685298361e-02   +1.444500793863320e-01   +8.884908688457013e-02   +2.056542811515981e-01   +1.392243755257224e-02   -1.667997732440062e-02   +9.584782967239638e-02   +1.076105407610121e-02];
L2E_Input1_iAMPA_netcon = [+2.904076837022629e-02   +6.558853535052588e-02   +1.122566445855564e-01   -1.904105662744135e-02   +2.574402586378515e-01   +1.442039638157836e-01   +4.181663013254025e-03   +2.690261881541479e-01];
L2I_Input2_iAMPA_netcon = [+1.179476968945744e-01   -5.858388173568563e-02   +1.946690026021738e-01   +2.608343544832432e-01   -4.349681234985502e-02   +1.424495707672807e-03   +1.124404514772005e-01   -3.550995956338377e-02];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.6*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))*0.9 + 0.6*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.8*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))*1.0 + 0.8*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.8*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))*1.0 + 0.8*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.6*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))*0.9 + 0.6*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.8*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))*1.0 + 0.8*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.8*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))*1.0 + 0.8*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
