function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+2.869334193776419e-03   +2.196539441181374e-02   +3.485904253578086e-02   +3.241762711735800e-02   +3.117376162707415e-02   +5.014907491079690e-02   +1.980027564006156e-02   +8.422597836797439e-03   +1.280882278466105e-02   +2.035232655911320e-02   +2.971755579413700e-02   +1.628956564731263e-02   +2.074633762024121e-02   +3.497292147053278e-02   +2.145268605274490e-02   +2.105526470698817e-03; +1.846116228171862e-02   -6.152450391198974e-04   +2.432980510262946e-02   +3.191364912377030e-02   +9.668737091795535e-03   +1.664586583279090e-02   +4.370458839732173e-02   +4.864606276938150e-02   +3.657072639791165e-02   +1.294126464656007e-02   +4.555629463062229e-02   +6.941331769397251e-03   +5.124838008842801e-03   -4.054748853203486e-03   +2.386825753504284e-02   -2.461456166015927e-03; +3.015467737766734e-02   +2.742632010528509e-02   +4.070907617511876e-02   +2.672263577798296e-02   +6.789838661289411e-04   +4.452689433874323e-02   +3.778257287194738e-02   +2.295349510103707e-02   +2.184621211093097e-02   +2.038668697940475e-02   +2.667125575229513e-02   +1.196486834791763e-02   +2.661773005366768e-03   +9.398945971523864e-03   +3.817768672925580e-02   +2.826243955377178e-02; -2.779114016872133e-03   -5.199662350624768e-04   +2.056457250080062e-02   +3.220720986863114e-02   +1.116129978634773e-02   +3.198581042953442e-02   +2.268859596281431e-02   +4.511379880847619e-02   +2.401085458532567e-02   +7.618932901467146e-03   +3.798189416146849e-02   +3.797444763592572e-02   +1.041770073422268e-02   +4.104266889431069e-02   +1.280399632958434e-02   +1.323871118011180e-02; +2.357477669279093e-02   +2.942293779451285e-02   +3.323700408173661e-02   +3.388849941905563e-02   +2.038742429003916e-02   +4.601936126726366e-02   +2.270970409552073e-02   +1.692165523194824e-02   +2.735292673414315e-02   +4.439791725196186e-02   +1.900334373729265e-02   +3.655703162082612e-02   +1.033458050371873e-02   +1.565586247207737e-02   +4.720309763106700e-02   +1.014697732115631e-02; +2.672473803121317e-02   +2.828661461049499e-03   +4.220268954139696e-02   +1.076641587087799e-02   +2.688288005205130e-02   +1.759490949710010e-02   +1.775575175985149e-02   +9.507818144805587e-03   +2.132800368797526e-02   +2.509354084295373e-02   +3.373638267118956e-02   +1.302142528713954e-02   +2.147346131271511e-02   +2.182595358504986e-02   +2.154595943409564e-02   +3.345944022174056e-02; +1.192467813577075e-02   +3.083013287834535e-02   +4.185861401477883e-02   +3.045866603892201e-02   +2.414378238961727e-02   +2.477345462902145e-02   +1.596767015057052e-02   +4.698238116233680e-02   +4.185068359763019e-02   +1.564447129092679e-02   +3.720098915773873e-03   +1.175066409257623e-02   +1.738442934458530e-02   +3.871199513572035e-02   +1.403705379868747e-03   +9.914055098677925e-03; +3.268544183223574e-02   +1.849559551660705e-02   +3.527598217671318e-02   +3.231997791933525e-02   +3.007837705029243e-02   +7.701361095408884e-03   +3.639378645680169e-03   +2.565487126540584e-02   +4.050109537859373e-02   +3.230864435926943e-02   +1.216529605461252e-02   +3.407971392052225e-02   +9.300742382544937e-03   +5.548704974141633e-03   +3.318059911066547e-02   +3.372346246318171e-02; +2.631423120708705e-03   +3.657493807942572e-02   +2.583014145180021e-02   +2.819809235091525e-02   +2.499270117139678e-03   +4.145861895161486e-02   +1.530897959866311e-02   +1.982280486259618e-02   +2.248553934787242e-02   +2.180743171061314e-02   +7.989202917442281e-03   +4.169767985214011e-02   -6.190425352478490e-04   +3.668105529025364e-02   +1.450840241794711e-02   +1.494392200131277e-02; +2.185628794270207e-02   +1.034296437696005e-02   +4.321488481142526e-02   +3.748788365042945e-02   +2.876431616551330e-02   +1.287645102159770e-02   +1.507205230041972e-03   +3.521472124344261e-03   +3.249877454773169e-02   +1.849057457262977e-02   +4.748798154220498e-03   +2.620153544059282e-02   +4.343859765711792e-02   +1.587786581240904e-02   +4.504598641510795e-02   +2.821526298898752e-02; +2.058576066118731e-02   +2.443849133303360e-02   +2.309138950265561e-02   +3.821889524603020e-02   +3.641850559751962e-02   +6.079864860750230e-03   +2.781540418907606e-02   +3.382436522480135e-02   +1.014622891810659e-02   +1.394175906424464e-02   +3.122932150546237e-02   +4.129710449485755e-02   +3.813536360269129e-03   +2.525859238268000e-02   +3.785757706688711e-02   +9.098375964470622e-03; +2.737868750541977e-02   +9.535265617860660e-03   +3.455626123593496e-03   +2.530128433410890e-03   +4.283466862027941e-02   +4.566017449363224e-02   +3.868899302443855e-04   +3.321750656152862e-02   +3.152358797675689e-02   +1.254582985618805e-02   +6.843823772704267e-03   -3.946978024238878e-03   +4.152819914201461e-02   +8.157295464013415e-03   +2.693782191590341e-02   +2.474586708659609e-02; +3.357404224870844e-02   +3.211540784333437e-02   +3.710003356939293e-02   +8.231297246290932e-03   +3.554021638304075e-02   +2.783805724696657e-02   +3.334038376598640e-02   +3.875969867673207e-02   +3.455815200669354e-02   +1.728735160824695e-02   +1.868990376094361e-02   +5.010634051655870e-02   +3.872150388884044e-02   +3.215660571240106e-02   +2.539703136971711e-02   +4.191089838324141e-02; +3.772380208253787e-02   +3.162125159832695e-02   +1.257442840183971e-02   +2.848013226177906e-02   +4.410161283387439e-03   +1.091952452583430e-02   +5.005911437247264e-03   +1.159430112078173e-02   +1.220271854306603e-02   +3.635072786579355e-02   +8.205040465588348e-03   +4.221137812863536e-02   +3.033431038920240e-02   +2.998140159231322e-02   +1.523283981279795e-02   +1.578449918516770e-02; +3.881446090197902e-03   +2.451594018221921e-02   +4.017769011769706e-02   +2.295530893101122e-02   +1.829803433782784e-02   +9.560404235773534e-03   +1.314526972202483e-02   +2.511798419816487e-02   +1.102043034521432e-02   +4.893799156423848e-02   +2.022316841578860e-02   +2.224748155292623e-03   +2.409196395456676e-03   +4.071373202517436e-02   -1.653217235247264e-03   +2.767993370422612e-02; +4.052752995277573e-02   +9.603926064168477e-03   +9.429384104426227e-03   +4.443202259496751e-02   +3.528474737332489e-04   +1.565329066066927e-03   +3.956517958274474e-02   +7.634652330285440e-03   +2.069957415813304e-02   +4.257179965693174e-02   +3.297046686337806e-02   +2.651453072959046e-03   +3.336991146628223e-02   +3.737763411221325e-02   +4.632469605649729e-02   +4.138538107987733e-02];
L1E_L1I_iGABA_netcon = [+2.317582450302690e-02   +3.067358602289862e-02   +3.457877979953727e-03   +1.661259751930999e-02   +3.959319557387043e-02   +2.168152973691553e-02   +1.836553557575750e-02   +1.167648436742801e-02   +6.811827251090131e-03   +1.313621335493102e-02   +1.624702491023624e-02   +2.139951953807187e-02   +1.465669784637893e-02   +4.256400109754904e-02   +6.394999838881889e-03   +1.868155196715238e-02; +7.151587365929368e-03   +3.861178414373082e-02   +2.321936190734791e-02   +4.269043126948363e-02   +2.029614693482172e-02   +2.233085310455417e-02   +1.303034632834976e-02   +2.713687001733108e-02   +2.334153208509762e-02   +3.449507364123243e-03   +1.186614141824348e-02   +3.494133815874374e-02   +1.532807863212414e-02   +3.095289447517647e-02   +2.783984172689192e-02   +3.849691930884985e-02; +2.823733116345391e-02   +4.924544909900531e-02   +3.893300083442710e-02   +3.386948310021465e-02   +3.561469025915563e-03   +2.165564171572147e-02   +3.067607538341369e-02   +3.804635743346212e-02   +4.414684754544039e-02   +4.660716105425503e-02   +3.027379109600317e-02   +2.655208170189727e-02   +4.367650632344022e-02   +3.699004319291618e-02   +2.037925058688362e-02   +2.993251118947033e-02; -1.436185749873446e-03   +9.468132714228372e-03   +4.164080163129696e-02   +4.559675539424555e-03   +9.278827054011191e-04   +3.095935593719190e-02   +3.851549593344365e-02   +2.187620699602852e-02   +2.462374884777564e-02   +4.227450031803365e-02   +3.097772501565399e-02   +3.311011844335645e-03   +1.826537702188944e-02   +1.449814967414396e-02   +6.628424902163766e-03   +4.789993775094942e-02; +9.485959091152796e-04   +4.579218063612467e-02   +2.190392862224648e-02   +2.708118100989006e-03   +2.578558446821335e-02   +3.715297184962384e-02   +3.162102275482981e-02   +1.991839912636650e-02   +2.327825665135710e-03   +5.106978713089773e-03   +3.449693211702869e-02   +8.341454798312964e-03   +3.699768698010267e-02   +2.201340993460936e-02   +3.011521652116086e-02   +2.005421665075779e-02; +4.134417637625237e-02   +3.784289198351500e-02   +3.789664165462616e-03   +3.196838034454275e-02   +1.367650025707487e-02   -4.988740724822678e-03   +3.445913831653017e-02   +1.460861888784826e-02   +3.789416298537199e-02   +1.092490457710685e-02   +4.020756850924498e-02   +4.740717646158369e-03   +2.207618483784118e-02   +4.666027280190240e-03   +3.336928149051444e-02   +8.481230181189592e-03; +2.117977967595138e-02   +1.290833707059937e-02   +5.076344892718391e-03   +1.443574929444149e-02   +8.608374396268926e-03   +1.998431664486146e-02   +1.205608654148348e-02   +2.163628447167831e-02   +4.739787645304338e-02   +7.603159912867006e-03   +3.976833198669626e-02   +4.813582045572238e-02   +5.149227672420334e-02   +2.829329849223763e-02   +2.543982814962667e-02   +1.295432383586904e-02; +1.693987457912524e-02   +2.705526276999122e-03   +3.070092447558900e-03   +6.645630268208969e-03   +3.175711286746861e-02   +2.478376564331202e-02   +2.545436062613306e-02   +2.517814297680904e-02   +1.573513781092535e-02   +1.812740236241837e-02   +3.747366080703055e-02   +5.449486854769151e-02   +2.623985135878548e-02   +1.824356443994044e-02   +6.231375699686669e-03   +3.097103949708006e-02; +1.328106529991859e-02   +2.803647006395640e-02   +1.626888338931045e-02   -6.120647331767552e-03   +1.168391059195645e-02   +3.627363413025546e-02   +4.348632816652178e-02   +4.702603419217888e-02   +1.871364822387048e-02   +3.331792166691058e-03   +3.527650537286932e-02   +1.770929534995259e-02   +4.231304822834850e-02   +4.458865999792685e-02   +2.313126251994412e-02   +8.057423274533600e-03; +3.446589667218197e-03   +1.553796732286167e-02   +1.032785235777255e-02   +2.701982971540286e-02   +1.386448624635589e-02   +3.555782695851961e-02   +1.854180729744286e-02   +1.120279867726379e-02   +4.375569200907414e-02   +4.344448705723962e-02   +5.319453796103117e-03   +2.636821188575802e-02   +3.897957899154690e-02   +1.071149183031133e-02   +3.493457979760851e-02   +1.450508375675502e-02; +4.393469441188922e-02   +3.276662128115879e-03   +1.019881790260860e-02   +2.294469214989910e-02   +3.256740345544443e-02   +2.684697942752199e-02   +2.299157504833857e-02   +4.909021060050991e-02   +1.642185792131746e-02   +1.578222412838191e-02   +2.251272009471442e-02   +2.719328816901545e-02   +9.587108725832683e-03   +4.565114063629960e-02   +3.927070303830130e-02   +1.704232259106824e-02; +1.020627704440552e-02   +4.913850424333423e-02   +2.794313491881152e-02   +4.248640682284028e-02   +4.554988398596096e-02   +3.265009484680009e-02   +2.236279209931868e-02   +5.467450746175323e-03   +3.628978976063396e-02   +2.256110585322348e-02   +9.565681277444579e-03   +3.685683858210753e-02   +3.252598619263260e-02   +2.953360281519252e-02   +3.553691538080752e-02   +1.084039106443435e-02; +3.467347585147242e-02   +7.746706587541078e-03   +2.654048338590370e-02   +6.357069148556126e-03   +2.668769181406400e-02   +2.517051315317022e-02   +2.792604106895941e-02   +9.975925924002427e-03   +3.706296754877707e-02   +3.930309419260075e-02   +1.354003392422169e-02   +3.808929578954147e-02   +4.589395282723995e-02   +3.560980563272786e-02   +1.479320578427853e-02   +7.816889256100804e-03; +1.360244114681715e-02   +1.114963089975584e-02   +5.789143511664503e-03   +3.944786416927705e-03   +9.432875418039957e-03   +4.146938229592270e-02   +4.288544655784290e-02   +3.639885384839026e-02   +2.137949056865642e-02   +3.004287725554439e-02   +3.898270297866759e-02   +3.315988808553842e-02   +3.098579472337654e-02   +3.902445364502947e-02   +2.910268401935626e-02   +3.297715447273007e-02; +2.144119267370036e-02   +7.553034892980788e-03   +2.081376742644348e-02   +4.210563789817585e-02   +2.701593049207117e-02   +2.484504701886501e-02   +3.651082989404756e-03   +1.387476879922453e-02   +1.163164348868029e-02   +2.915742635610632e-02   +1.321981863462355e-02   +2.147865189014838e-02   +1.280961651391718e-02   +9.405731690104032e-03   +8.008337431959863e-03   +1.455912281730457e-02; +2.439593167932577e-02   +8.715592641405704e-03   +8.877427252307139e-03   +4.005352894676277e-02   +4.671480413599517e-02   +5.549355991441894e-03   +1.068620379328878e-02   +3.991919169104206e-02   +3.864191450551772e-02   +3.788236755001250e-03   +1.451004037546816e-03   +2.594165287790809e-02   +3.409763205674950e-02   +2.422239752769855e-02   +2.147268029410167e-02   +2.432312075659098e-02];
L2I_L1I_iGABA_netcon = [+4.604539010020850e-02   +1.758578723889299e-02   +1.303739166862288e-02   +4.353659091216848e-02   +4.941658839515660e-02   +3.967498425464890e-02   +1.729856214372397e-02   +3.674352561816571e-02; +3.576158474154048e-02   +4.308801027881834e-02   +3.045462471969607e-02   +1.356260384728305e-02   +2.198346331162866e-02   +3.165646282352991e-02   +4.348920675041086e-02   +1.506623234197228e-02; +8.953743724883112e-03   +1.279972905816212e-02   +1.137367619968014e-02   +2.991999381762967e-03   +3.856868929832888e-02   +4.446743424163582e-02   +8.338068210009748e-03   +2.774655123657798e-02; +1.172805485144797e-02   +3.740429393053487e-02   +3.318131018610778e-02   +3.157022516684106e-02   +2.542683851113745e-02   +2.335053157579660e-02   +2.188496990881015e-02   +4.315970811661126e-02; +1.154688455462733e-02   +5.388489727450523e-03   +2.948122565547380e-02   +2.945818102581298e-02   +2.144280339741164e-02   +3.764802858160061e-02   +2.167461293563607e-02   +2.957005309185285e-02; +3.343337514888001e-02   +3.141795746774351e-02   +4.164563874767484e-02   +2.527187219553924e-02   +1.389153147891622e-02   +3.204250388423400e-02   +5.205991099954200e-03   +3.496770515683935e-02; +1.291364171831666e-03   +1.749797161049357e-02   +1.547540846635289e-02   +1.085176023286766e-02   +3.815904151116993e-02   +1.403024343626557e-02   +1.275146840364531e-02   +3.617649649586474e-02; +2.798939660883745e-02   +2.054670114729012e-02   +3.892911131491290e-02   +2.163545371507366e-02   +1.364523755810987e-02   +2.898870033473613e-02   +2.207421613850852e-02   +1.332716551028048e-02; +2.483366094808282e-02   +2.931061920884324e-02   +1.077480884303292e-02   +8.626061557948010e-03   +1.511290826417354e-02   +9.308935981668895e-03   +2.304455655646750e-02   +4.734473633730611e-02; +1.990288849202592e-02   +3.280347286619949e-02   +3.894163161896135e-03   +2.061733289450817e-02   +6.501216081975259e-03   +2.921758605202841e-02   +4.280123331921940e-02   +3.350061117219203e-02; +2.093723294431550e-02   +4.203337189752974e-02   +3.913349934939288e-02   +1.387722187378821e-02   +3.326028566366843e-02   +4.212487578146822e-02   +6.937980198240303e-03   +1.712416769212443e-02; +3.843725173192917e-02   +2.300975979726452e-02   +3.446091681054226e-02   +2.380272757779551e-02   +4.562743005700171e-02   +9.211089361861631e-03   +2.794307937858227e-02   +1.426219660309807e-02; +1.871118228271393e-02   +4.514604853332709e-02   +4.153414174294644e-02   +5.600893544820885e-03   +2.180486544244689e-02   +1.465396797167817e-02   +1.476994546777432e-02   +3.260752323556910e-02; +3.520956206177503e-02   +1.025388704820595e-02   +4.361694076178901e-02   +2.611849645293755e-02   +4.234455407112272e-02   +1.243663118363088e-02   +4.233602079033124e-02   +1.196548345360863e-02; +4.652124188763085e-02   +1.343514822073228e-02   +1.112857512817755e-02   +4.898421352897059e-02   +3.165241371181821e-02   +3.189576639013280e-03   +1.942702836687455e-02   +3.870237791130489e-02; +9.742137569690815e-03   +3.617633813753836e-02   +2.906702148901989e-02   +3.176524474315939e-02   +4.383894435067725e-02   +2.607286125096240e-03   +4.542421555801359e-02   +1.514902997804374e-02];
L1I_L2I_iGABA_netcon = [+2.898570987043862e-02   +3.086796261993984e-02   +4.264275089577241e-03   +2.662118594761606e-03   +2.897985914644511e-02   +1.539437995029206e-02   +4.718433132128894e-02   +3.248535022462265e-02   +2.328119727631459e-02   +4.060613663669626e-02   +5.114018082852228e-03   +1.010454257020038e-02   +5.743649919417147e-03   -2.666438270866342e-04   +9.917696276742088e-03   +4.464166289250888e-02; +3.615973226534242e-02   +2.912128659873421e-02   +2.191055880570449e-02   +2.112826760137910e-02   +4.198220094069487e-02   +2.316089799831215e-02   +2.317885482388382e-02   +4.530893341129488e-02   +2.241868260083973e-02   +4.179857616957728e-02   +3.201977040453560e-02   +1.681920210645760e-02   +2.456413140622918e-02   +4.375255039031301e-03   +2.951654733534537e-03   +3.860963246298867e-02; +4.174262750351247e-02   +2.836415496930552e-02   +9.404794246022363e-03   +3.719078375226656e-02   +1.454828793565117e-02   +4.488844928940245e-02   +2.938770662725514e-02   +3.197081929955094e-02   +1.930043415669028e-02   +2.427030548358796e-02   +2.736847893108590e-02   +1.980259566590831e-02   +2.032933058702599e-02   +8.230807528858767e-03   +2.944830061183199e-02   +1.021287669466246e-02; +1.933552196157763e-02   +3.018778207752006e-03   +2.645801315941565e-02   +3.705414759767068e-02   +8.447282279082629e-03   +1.768988682633826e-03   +1.462738515668447e-02   +1.407422487077480e-02   +2.107790839763195e-03   +3.031909915744012e-02   +2.275561728647197e-02   +2.110489755409770e-02   +1.397256157657210e-02   +4.969728625105483e-04   +3.420340777356631e-02   +1.933969550396798e-02; +7.590063594949035e-03   +3.609211922802889e-02   +3.631570910425139e-02   +3.241388136561747e-02   +3.056925872692073e-02   +2.677810234787931e-02   +2.663189347990690e-02   +4.230348963570558e-02   +2.628557676838538e-02   +5.366194557849020e-03   +1.034393504352523e-02   -8.038926028898774e-04   +1.497958295239919e-02   +4.539231391750800e-02   +5.909344508548187e-03   +2.718305727596214e-02; +2.530574425549267e-02   +3.275906719591782e-02   +3.571651101402422e-03   +4.342651296266076e-02   +2.460234636026810e-02   +4.574310077328352e-02   +3.138129822661139e-02   +3.919912855508913e-02   +2.926964162882140e-02   +2.799300047844440e-02   +4.180421029269647e-02   +3.528770380243690e-02   +9.104234083728794e-03   +4.775422702398947e-02   +2.989180414373118e-02   +4.082583737029167e-02; +4.289430902839594e-02   +9.272720991606528e-03   +3.588423629633868e-02   +4.613712761254403e-02   +1.634222498423213e-02   +5.189267249406434e-02   +2.766064838385894e-02   +1.749684921792817e-02   +8.106516902677760e-04   +2.409828749001367e-02   +1.586720176598393e-02   +1.620305025515912e-02   +3.909089452581874e-02   +1.861710991751072e-02   +4.578063865403651e-02   +2.784905740840024e-02; +3.558786780010655e-02   +2.576380290670800e-03   +4.084680207904989e-02   +3.531069919470500e-02   +2.577351359774947e-03   +3.576480279343303e-02   +3.253932067758739e-02   +3.699932858164214e-02   +2.398642531677917e-02   +3.931225894533152e-02   +9.024152641620604e-03   +2.362140184900493e-02   +2.358775126779955e-02   -3.665483136153530e-03   +3.957386307361326e-02   -8.096450231384089e-04];
L2E_L1E_iAMPA_netcon = [+4.020557783019555e-02   +1.790034328525678e-02   +6.742764523942560e-03   +4.876451837096316e-02   -8.678310642070567e-04   +1.658729203144903e-02   +3.146399056761144e-02   +1.730320171858082e-03; +3.933307507906780e-02   +4.217466041223902e-02   +2.849391211355675e-02   +1.847219294182436e-02   +2.541788740814694e-02   +1.280696013034335e-02   +4.586269893955523e-02   +1.957675218827094e-02; +5.209122380538879e-04   +6.855219301895532e-03   +1.029295193721073e-02   +1.182481528287725e-02   +2.577601567321396e-02   +4.304132628283121e-02   +1.847868227070024e-02   +1.182513837039947e-02; +1.495661698746720e-02   +3.767094969888902e-02   +1.185044912965979e-02   +3.193431632941066e-02   +4.106374424609915e-02   +1.863655828046211e-02   +4.065468364870925e-02   +4.461924562475732e-02; +8.920099347012250e-03   +4.796586289377211e-02   +7.566584363140534e-04   -1.335702926874374e-03   +4.622207450095214e-02   +4.527847305631373e-02   +3.351040158498236e-02   +1.998521569173850e-02; +3.337561234203218e-02   +1.927904081946111e-02   +4.271921049387869e-02   +3.831916805271610e-02   +2.844283890247556e-02   +8.526069995049949e-03   +3.174156657047958e-02   +3.169131504992934e-02; +6.296376014677483e-03   +1.734592082565322e-02   +8.984110296897323e-03   +1.562875868296486e-02   +4.159294317575690e-02   +1.803248922445880e-02   +9.202281106608581e-03   +1.715020757951965e-02; +4.516239432749095e-03   +3.605805417832466e-03   +2.151378313878318e-02   +2.943416295417609e-02   +1.828906356954568e-02   +4.165915465607922e-02   +4.328385422122911e-02   +4.063541326549579e-02; +1.697177246092601e-02   +4.170931781407871e-02   +4.696250452335734e-05   +1.349495119254247e-02   +6.166576809485300e-03   +4.999371312332932e-02   +2.128073123415415e-02   +4.274226638280744e-03; +1.021737904482611e-02   +1.239534705391077e-02   +3.976291084625756e-02   +2.065866956309555e-02   +4.689336631236440e-02   +6.052915387862012e-03   +1.004357572449639e-02   +4.023173042475241e-02; +2.717906493837364e-02   +1.920112075186870e-02   +4.618203548720336e-03   +3.415615833951988e-02   +2.062192926959684e-02   +1.429292390320373e-02   +2.940150220034035e-02   +3.621457119307848e-02; +1.197553930472940e-02   +2.243564189233319e-02   +3.792752026489567e-02   +3.256857832582967e-02   +3.043346994564378e-02   +6.478518259935446e-03   +4.669051268087232e-02   +5.518774325081450e-03; +2.975106928661051e-02   +3.757092638219963e-02   +7.884928542206567e-03   +6.212424752016320e-03   +4.524131881510290e-02   +3.383977969292116e-02   +2.442529708107795e-02   +4.674969144442071e-02; +2.228008428854500e-02   +6.412687367473714e-04   +4.245217788799527e-03   +3.935724270431093e-02   +4.853895281184687e-03   +1.352156486366678e-02   +5.675698281216402e-03   +3.286754895419083e-02; +1.655496390285953e-02   +8.434100409076412e-03   -8.453791431383092e-04   +4.062779943471363e-02   +7.896671736732733e-03   +1.355687134885876e-03   +2.173839621692627e-02   +7.675638311539298e-03; +8.053407017425790e-03   +2.234807536211385e-02   +4.316319685015127e-03   +2.299670948497875e-02   +7.335405115728892e-03   +2.515136490809848e-02   +2.439245813428165e-03   +3.901705321784477e-02];
L1E_L2E_iAMPA_netcon = [+8.702245674271013e-03   +1.297508040741826e-02   +4.344721687978194e-02   +4.426101447995244e-02   +1.672838495679483e-02   +4.220797723288581e-02   +2.345410865127658e-02   +4.855099382779437e-02   +1.046667221567661e-02   +2.993785410028001e-02   +2.479355156324612e-02   +3.451551714803502e-02   +1.928336082243833e-02   +3.048060301636499e-02   +2.836414869182446e-02   +2.300532606293219e-02; +1.410765287717790e-02   +3.517879604148267e-02   +3.621891678356843e-03   +9.832243174598227e-03   +4.920443055515171e-03   +3.250512973342402e-02   +3.726847437313385e-03   +1.209538742837896e-02   +1.195964615565341e-02   +1.601412506452814e-02   +1.528530379509575e-02   +4.410278858483013e-02   +7.333301155009136e-03   +1.106540739351849e-02   +2.779134401744012e-02   +1.406888208268693e-02; +1.711113621537239e-02   +2.752475437111240e-02   +4.470163619444575e-02   +4.105218125700066e-02   +4.140623908770376e-02   +6.964015291518904e-03   +1.759962899089380e-02   -6.709309073812352e-03   +2.167778456630257e-02   +3.219412291789710e-02   +1.234878456568144e-02   +2.780447403554493e-03   +3.372417668319531e-02   +2.687938489489939e-02   +4.724979134547267e-02   +3.361773472400351e-03; +3.192165548748269e-02   -2.751072055479655e-04   +8.526029662034366e-03   +8.424499248611980e-03   +3.286987797969775e-02   +1.144044885478791e-02   +4.737068862636513e-02   +4.649110866957752e-02   +3.589744987081594e-02   +3.759380769770576e-02   +1.594551206804753e-02   +2.434087466451118e-02   +4.741515639625660e-02   +1.951563911070482e-02   +4.494260650881380e-02   +4.131969635868340e-02; +5.598727473282761e-03   +5.033473950239589e-02   +3.373013193492282e-02   -1.791608635864482e-03   +1.114733220789643e-02   +3.425433193509347e-02   +3.894942851224224e-02   +4.920857759187370e-03   +2.485677155132840e-02   +1.826814615724459e-02   +2.446876079014499e-02   +3.530368197145720e-02   +1.398665265635012e-02   +2.671065819645953e-02   +4.520126567733761e-02   +2.520506601231958e-03; +2.430061863662176e-03   +4.411491463000285e-02   +1.410145828675752e-02   +4.379454712230821e-02   +4.413692742984703e-02   +3.897947256910393e-02   +2.010219806012948e-02   +3.795239392484107e-02   +1.638909610843201e-02   +2.196815221568157e-02   +4.069632281154597e-02   +4.422790731061305e-02   +4.324646394947029e-02   +3.207273070212617e-02   +7.462231636425927e-03   +2.572290407545870e-02; +1.317072622761276e-02   +8.083418126955330e-03   +3.168328028174253e-02   +5.706605324940160e-03   +1.679573398300387e-02   +2.098669774018361e-02   +3.249248679357553e-02   +2.831354977967642e-02   +2.595975860923672e-02   +3.886907475073687e-02   +3.652555828241565e-02   +3.668948354188183e-03   +2.049744888624682e-02   +3.186786173280366e-02   +1.667907379692187e-02   +1.502123724520272e-02; +4.680879348766261e-03   +2.828161171401776e-02   +2.424986691710080e-02   +2.102515976950902e-02   +3.111456296790990e-02   +4.568619081060950e-02   +4.629334922874642e-02   +2.764706436316833e-02   +3.994305012202094e-02   +1.926864691873668e-02   +1.633372029074966e-02   +4.963725856385609e-02   +3.452866266639206e-02   +3.785821288877446e-02   +1.352459309276792e-02   +1.215319352630269e-02];
L2I_L2E_iAMPA_netcon = [+3.144583817182297e-02   +1.663074767132565e-02   +4.254369306205052e-02   +2.327970964397583e-02   +3.690550411655893e-02   +5.419320927733979e-04   -2.085559048363828e-03   +4.297312197761508e-02; +1.037462505346599e-02   +9.898339319663397e-03   +1.080623945690046e-02   +3.500325244535005e-02   +3.391366611793971e-02   +1.580536233687150e-02   +3.162880829093565e-02   +2.390188155641745e-02; +3.822604179963135e-02   +3.956054513483627e-02   +4.037660110930179e-02   +3.278577950875124e-02   +2.395222146920915e-02   +2.335423905519344e-02   +1.810611551563984e-02   +3.244469764681492e-02; +1.590667865499450e-02   +1.254065760083563e-02   +4.633883900673966e-02   +2.100559410943275e-02   +4.611640645248147e-02   +6.177780326921455e-03   +1.436135672082117e-02   +4.051571915688353e-02; +2.834847338886871e-02   +4.075354246247024e-02   +2.439312543790365e-02   +3.027196775561967e-02   +4.225662762227250e-02   +3.059950234927472e-02   +2.237119702157967e-02   +3.207761759845741e-02; +3.273077874535701e-02   +3.027332000096833e-04   +4.346428274788144e-02   +3.529076419094461e-02   +2.487596276778722e-02   +1.291296731079278e-02   +5.993193894049487e-03   +3.700880177107099e-02; +4.685075539944557e-02   +2.275048660320510e-02   -1.809598193127555e-03   -2.491072856226473e-03   +8.312922696376950e-03   +8.850919509606760e-03   +8.701374012279212e-03   +1.049840426737258e-02; +4.309049882191609e-02   +9.911616314836171e-03   +2.329167919235960e-02   +2.717015903251491e-02   +4.465443772937199e-02   +1.028341106446914e-02   +4.597062729534199e-03   +6.739583342430244e-03];
L2E_L2I_iGABA_netcon = [+4.810926105202791e-02   +7.626870749556327e-03   +9.317970924701848e-03   +5.485585034966028e-03   +3.511613805270723e-02   +1.947979299993339e-02   +3.564331880002058e-02   +4.592270835741165e-02; +1.456427428908502e-02   +1.682483765898509e-02   +1.332516956268879e-02   -2.970886190255466e-04   +4.708999570027440e-02   +3.442569988171747e-02   +3.725241006240869e-02   +2.264164755980485e-03; +3.013013476592935e-02   +1.779727873582341e-02   +2.025640088129977e-02   +9.997129521356509e-03   +1.205022934815520e-02   -4.930309929911604e-04   +4.996492198728730e-02   +4.110333825766293e-02; +3.277346461348438e-02   +5.012188384846228e-04   +5.322616992377618e-03   +3.697863449194370e-02   +4.201534960437344e-02   +3.779343992048766e-02   +2.128158524962512e-02   +2.923747965326534e-02; +6.000140948686407e-03   +3.775031859408837e-02   +3.954579510493922e-03   +3.784270333981764e-02   +1.727445483610339e-02   +1.660039740335185e-02   -4.280486381896594e-03   +1.342534899253145e-02; +3.269504810622121e-02   -7.355653666765521e-03   +2.340759273245662e-02   +4.035940266173142e-02   +3.979058922988811e-02   +1.795426934057156e-02   +4.611831946018540e-02   +3.532065213761286e-02; +6.455147434931146e-03   +5.188434678061424e-02   +1.202042038274153e-02   -8.442998042139447e-04   +3.775912743766938e-02   +1.848802967529046e-02   +2.177383865945117e-02   +2.496895037354833e-02; +3.909854646924238e-02   +1.539904661608123e-02   +2.446794476123450e-02   +1.710013353149130e-02   +1.966253664666212e-02   +3.850008308732794e-02   +4.397318267133402e-02   +3.302676180607550e-02];
L3E_L2E_iAMPA_netcon = [+1.899968071472056e-02   +2.793616215187870e-02   +7.149022280289214e-03   +1.810577212814046e-03   +1.660434758066205e-04   +4.624641791807152e-02   +1.687328942887597e-02   +4.250215441764959e-02   +3.650204994632314e-03   +8.319956050563017e-03   +1.647901300085562e-02   +5.054886698042981e-03; +8.142816923497347e-03   +4.500859597379792e-02   +1.560519622598693e-02   +2.032717177489056e-02   +2.664822989090881e-02   +2.798122934977913e-02   +4.062868065012752e-02   +4.502287179493331e-02   +3.018895950309463e-02   +4.449754487629715e-02   +1.757597309723872e-02   +1.402061366192054e-02; +5.295691998567295e-03   +3.835641540227858e-02   +5.262571341476186e-03   +3.573928512988210e-02   +3.232509937202001e-03   +2.373561747869014e-04   +2.714428682977528e-02   +4.487555476316457e-02   +2.996687926183907e-02   +2.322620625862959e-02   +1.215135375347370e-02   +3.021320419682031e-02; +5.606300998514314e-03   +1.761642804630972e-02   +4.148631012165599e-02   +1.779874537790639e-02   +1.075382273378791e-02   +2.093185617079316e-03   +1.843473161075741e-02   +1.939714268751867e-03   +5.550212348684119e-03   +1.418295862781857e-02   +9.094811432066561e-03   +1.467719389674632e-02; +4.221192518516702e-02   +1.802999613554096e-02   +1.886785586892403e-02   +4.270499592449787e-02   +3.585566129174862e-02   +1.544980731882760e-02   +4.442600661177507e-02   +7.437151211503495e-03   +3.667402476542695e-02   +1.920238607610154e-02   +3.784308003860926e-02   +1.740195682417826e-02; +3.791646406925191e-02   +2.701634915249086e-02   +4.304702998059583e-03   +1.793344177968691e-02   +2.871247994255412e-02   +4.789017742359837e-02   +4.575249953864731e-02   +1.519585725712972e-02   +2.383796133132162e-02   -6.295403994275008e-03   +2.801831673069002e-02   +7.069230985747694e-03; +3.188869036596408e-02   +1.646769578038636e-02   +2.734501306388538e-02   +1.213476134215838e-02   -1.459896580813544e-03   +2.168237700222393e-02   +4.797340013347078e-03   +2.019980130448563e-02   +1.343516211697964e-02   +6.763280924427588e-03   -7.020429626835748e-05   +1.854295715430627e-02; +3.952644592637373e-02   +1.149754785411486e-02   +8.475446694326032e-04   +1.518676124562838e-02   +2.645237797685367e-02   +4.326256506522128e-03   +5.794924576694952e-03   +1.720981648123007e-02   +2.045384968236142e-02   +4.096567982773654e-02   +9.144335541474782e-03   +2.800662103485964e-02];
L3I_L2I_iGABA_netcon = [+5.029043377153189e-02   +3.107722513123275e-02   +3.370136945256479e-02   +1.736660080302663e-02   +4.670441357364323e-02   +2.125559351735228e-02   +5.412991559979039e-03   +3.292429516077272e-03   +4.080286559167611e-02   +2.819044656118021e-02   +6.907089493935445e-03   +3.642884774895488e-02; +3.731763257234620e-02   +4.889405781540510e-02   +3.926803015684970e-02   +1.027309948810200e-02   +2.080252279619314e-02   +3.418726735473854e-02   +1.697990127232477e-03   +6.846700970614012e-03   +2.587205279781829e-02   +3.382235675023607e-02   +2.360911670896919e-03   +3.413043320373454e-02; +2.478211520394295e-03   +3.405908624431297e-02   +4.688121012163098e-02   +1.412842104698818e-03   +3.441045510106883e-02   -1.767034199621171e-03   +3.599840963280918e-02   +4.815223392068682e-02   +3.001280867723800e-02   +1.094175238967707e-03   +2.816860791521125e-02   +3.842051891085745e-03; +4.970678114948929e-02   +1.606768538669488e-03   -2.067229951874721e-03   +3.113267637941479e-02   +4.290401044535112e-02   +2.790702502772385e-02   -2.249529492774031e-03   +1.991034388050165e-03   +4.432529785748814e-02   +3.954455455620084e-02   +3.976125480851480e-02   +2.926546794517473e-02; +9.181964056031524e-03   +5.169653209220640e-02   +1.512947232887421e-02   +2.021418213824613e-02   +2.384147891483623e-02   +4.840991526396576e-02   +1.408815026678192e-02   +3.535142984513326e-03   +4.206714223153347e-02   +2.678118402895368e-02   +8.013284319694983e-03   +9.929074214553347e-03; -1.290015954967657e-05   +2.679088420052388e-02   +1.117722724204936e-02   +2.975490681089078e-04   +6.188690135110491e-03   +2.564109844212956e-02   +3.388575906725859e-02   +4.922239876076549e-03   +1.129082654377717e-03   +3.722047442352184e-02   +3.281816479083702e-02   +5.313390782559141e-03; +3.223330801795155e-02   +4.026303171965909e-02   +2.391830867603417e-02   +3.289253487958285e-02   +2.369225673407655e-02   +8.539905933067735e-03   +2.675079416477940e-02   +4.312365409926725e-03   +4.510176059753000e-02   +1.721649156639223e-02   +2.374282570231484e-02   +3.167240834165893e-02; +2.577517067542802e-02   +5.521881767565763e-03   +1.623626629375439e-02   +2.635386219910328e-02   +2.000611587113738e-02   +3.739868844475756e-03   +9.150694316938362e-03   +8.540017785156761e-03   +3.151593385698378e-02   +4.728504107996812e-02   +1.154685995843030e-02   +1.417414625952966e-02];
L2E_L3E_iAMPA_netcon = [+3.125508238138589e-02   +2.638151827332798e-02   +1.317263187347906e-02   +3.819019635511599e-02   +2.853664588052238e-03   +2.802198763770726e-02   +3.386996113585004e-02   +4.428246515903624e-02; +2.196269730734784e-02   +3.707895784121627e-02   +3.380655313922339e-02   +3.041282438694553e-02   -3.258256640082481e-04   +3.086576698498964e-02   +4.153370730860260e-02   +2.702585993138176e-02; +3.473040383650232e-02   +4.147756312326167e-02   +3.951606206830584e-02   +4.334325335698466e-02   +3.294152190577337e-02   +3.326862698555192e-02   +3.399239636282130e-02   +2.653840526657559e-02; +2.072850440030936e-02   +4.527525510312326e-02   +3.876792991627394e-02   +2.567737440636476e-02   +2.358499807546318e-02   +2.181471034776842e-02   +1.565478749780719e-02   +5.172577084513537e-03; +6.931788407790408e-03   +2.670093969325065e-02   +1.450300482482102e-02   +5.289462582352490e-03   +5.490517729326800e-03   +2.792655877567184e-02   +4.190989692539504e-02   +3.293844415314288e-02; +2.660427905808570e-02   +4.854956567540970e-02   +4.260019864962030e-02   +2.707235417998193e-02   +2.098004137023053e-02   +4.760807447635125e-02   +2.879627708679738e-02   +4.367952013286550e-02; +1.972601721497300e-02   +2.336947650305823e-03   +2.562265094317265e-02   +5.819431861023459e-03   +1.471128474759899e-02   +4.202672412136027e-02   +1.454702554561406e-02   +3.200182008485851e-02; +4.027809349596079e-02   +3.068036304862548e-02   +2.425047029559862e-02   +3.460084708667449e-02   +1.905874629152389e-02   +3.725905808499734e-02   +2.490215601527720e-02   +1.970969941183745e-02; +1.548386621203405e-02   +2.430215082814081e-02   +4.589218599584147e-02   +2.879672737152327e-02   +2.601664728129573e-02   +8.540751972409815e-03   +2.693603216631687e-02   +3.138431792084365e-02; +1.332580561271533e-02   +1.046094908939346e-02   +3.654375019338651e-02   +4.471074669297063e-02   +4.617995611506865e-02   +7.372969152669162e-05   +5.601894121214875e-03   +3.103252160194594e-02; +2.905485742705129e-02   +1.194545450605087e-02   +3.256991723994767e-02   +3.262199436873231e-02   +4.106739745745045e-02   +5.229219114008315e-02   +1.041318611495791e-02   +1.811302151404327e-02; +4.211820578055294e-03   +3.192328476762701e-02   +1.714351768415321e-02   +3.579533755967725e-02   +2.278137196347622e-02   +7.769692281463368e-03   +3.331508250056867e-02   +3.895037614900877e-02];
L2I_L3I_iGABA_netcon = [+4.286686703383136e-02   +1.951531056803253e-02   +1.522255239127656e-02   +2.766260256371851e-02   +4.224657505700186e-02   +4.121602389201261e-02   -2.677115641067226e-03   +2.449153220449696e-02; +2.057922793148931e-02   +2.145298640970292e-02   +3.834553813230844e-02   +1.255670758102781e-02   +3.655052681880817e-02   +3.815131755726695e-02   +2.405668839989868e-02   +1.853585552614687e-02; +3.244816757118846e-02   +3.858969203873248e-02   +4.195268730308310e-02   +2.898864932913520e-02   +2.023961980999918e-02   +2.739426897625183e-02   +2.307757838859740e-02   +1.874681658177240e-03; +1.056349176135942e-02   +3.804753530977979e-02   +8.435783595224063e-03   +2.182780548532890e-02   +1.181287547831361e-03   +1.402954946530326e-02   +2.202790534052628e-02   +5.008296734828818e-02; +1.792048649309138e-02   +2.068311672445996e-02   +2.346685364699923e-02   +2.050028355282519e-02   +1.570006211395888e-02   +2.653896514088005e-02   +5.484717981136041e-03   +5.323816724991321e-03; -1.833038771271481e-03   +1.222616776509102e-02   +1.625818214992476e-02   +5.971241924178521e-03   +1.974078797441376e-02   +2.200358229471226e-02   +2.195567865221240e-02   +4.014935930324932e-02; +1.737654940645731e-02   +2.103173043763273e-02   +4.590196646180521e-02   +3.489568682328190e-02   +3.895157600983219e-02   +1.373293558809703e-02   +2.105756112922830e-02   +2.047514209389101e-02; -1.766153391901416e-03   +4.069488185258914e-02   +1.238410792229480e-02   +3.487459162003702e-02   +5.479589630838193e-03   +3.449957112619311e-02   +2.762731426417486e-02   +3.218414588198207e-02; +3.773207364050515e-02   +1.987129985684815e-02   +4.246871389604879e-02   +1.904981647022108e-03   +2.464132107735202e-02   +1.039211416489895e-02   +1.726607150715201e-02   +2.531955733033717e-02; +3.670754760286910e-02   +2.502331132213803e-02   +4.396945627107842e-03   +2.548344584978869e-02   +2.360256213649965e-02   +1.175327878729728e-02   +9.599684743421077e-03   +1.379093092353131e-02; +3.570275440089987e-02   +4.591554090691286e-02   +2.973939908396329e-02   +3.497584965178323e-02   +1.512201323395350e-02   +2.086754774368825e-02   +4.157900759001722e-02   +1.007898501869494e-02; +3.260108130477377e-02   -4.083845449789480e-03   +1.419044080975606e-02   +5.790716264441092e-03   +6.756067537302101e-03   +4.247417430012532e-02   +2.686498504970051e-02   +2.836803787373961e-02];
L3I_L3E_iAMPA_netcon = [+1.821056293728016e-02   +4.512209390782432e-02   +6.284873016816056e-03   +2.564978455832259e-02   +3.621683377485700e-02   +2.107055994507157e-02   +1.527743592140061e-02   +5.468664609719186e-03   +2.303449811889726e-02   +1.501731064419082e-02   +1.346172124651531e-02   +5.048690908568558e-03; +2.123922675347822e-02   +3.191962395767559e-02   +1.459552360051285e-02   +6.287242711150492e-03   -2.236388339263479e-03   +2.316709592567796e-02   +2.827210766399589e-02   +2.104538467870091e-02   +1.775755096007615e-02   +2.363605630075674e-02   +3.425203523687162e-02   +2.510626547601403e-02; +3.602065706160203e-03   +2.402434283576560e-02   +2.297692923774231e-02   +2.691645928304639e-02   +2.455327803240158e-02   +1.875464646993201e-02   +2.073000086837316e-02   +1.585753424489632e-02   +2.170914514504899e-02   +2.455583550322808e-02   +1.848770173082005e-02   +2.497539643651175e-02; +2.252674577618455e-02   +3.366441347286975e-02   +2.892577442556265e-02   +2.176804165477637e-02   +2.468811779019503e-02   +4.158111814631856e-02   +3.513338885439575e-02   +8.750005034261061e-03   +4.321452946643750e-02   +4.475340019054879e-02   +1.168618502622469e-02   +2.765515324254614e-02; +5.321436108283508e-03   +2.093775597327856e-02   +8.149187414206158e-03   +4.220951001060934e-02   +3.440762447757155e-02   +2.623346492103951e-02   +4.615562532015464e-02   +9.610681172090314e-04   +4.353623974892751e-02   +2.401670428266618e-02   +1.189041542668183e-02   +3.679018225932052e-03; +1.620430667093719e-02   +2.135857771898851e-02   +3.898080480875980e-02   +2.361865983437772e-02   +4.553474999360663e-02   +3.756575630947131e-03   +3.816085330996800e-02   +1.456638854275878e-02   +3.238718637259513e-02   +8.835601792690800e-03   +1.253880929359298e-02   +1.007066784761875e-02; +3.644441511961034e-02   +1.941163683018359e-02   +1.658777817939496e-02   +1.440049942965139e-02   +2.435512079063273e-02   +8.154236151802741e-03   +2.230475969664801e-02   +4.698040173989390e-02   +4.230035620756251e-02   +4.826386323197970e-02   +2.484975144216255e-02   +3.333832175645158e-02; +3.734775004351167e-02   +4.888797818138437e-03   +3.540747032382731e-02   +3.123499968101860e-02   +4.693637578392549e-02   +2.743839771172051e-02   +1.590321068865967e-03   +2.664016725152267e-02   +2.469097485721886e-02   +1.319813522712016e-02   +1.029873048919940e-02   +4.525654019625101e-02; +4.074541383767890e-03   +3.878558022827777e-02   +3.096072530709627e-02   +2.885554007156556e-02   +1.808200836848931e-02   +3.584356217155703e-02   +1.196927568208743e-02   +3.618141451970902e-02   +3.257676706206465e-02   +1.903129099166315e-02   +1.340143830820536e-02   +8.997015153769836e-03; +4.363251940884885e-02   +4.209762790609570e-02   +1.867662731638819e-02   +1.190262591127767e-02   +2.176355233296020e-02   +3.982010592067234e-02   +2.966393019598644e-02   +4.393717544006976e-02   +3.564626679831663e-02   +1.664872432212177e-02   +4.211992662724575e-02   +1.106169087461377e-02; +2.001148412493992e-02   +2.111262831357981e-02   +4.741677127924110e-02   +4.151834470409546e-02   +3.734566603211806e-03   +2.923337639736021e-02   +6.124557584097754e-03   +1.153667732791312e-02   +3.179462184571154e-03   +4.127159249453186e-02   +3.555137307471005e-02   +1.592274640255068e-02; +3.921993747730999e-03   +1.122586582176641e-02   +3.628788978193903e-03   +2.508451199993171e-02   +2.122233788749559e-02   +1.558804504430815e-02   +3.865860092644223e-02   +4.995135728775467e-03   +1.524332078111935e-02   +8.655768871828451e-03   +3.531280949630717e-02   +1.617699256555150e-02];
L3E_L3I_iGABA_netcon = [+4.451847523744201e-04   +1.853093311829450e-02   +1.391008232715212e-02   +4.807672091529917e-02   +3.389386242253810e-02   +3.255565285382497e-02   +1.826525090957958e-02   +3.135263847120367e-02   +2.935967708936090e-02   +3.447867482185572e-02   +2.373232550644584e-02   +1.080954539554399e-02; +3.758697467630586e-02   +3.483093072856096e-02   +1.719749097916155e-02   +4.080236736138568e-04   +1.288956512445395e-02   +3.461919579205495e-02   +3.091286170846224e-02   +4.831533611253648e-02   +3.837228168948881e-02   +2.252170312467219e-02   +1.203841280533559e-02   -6.203780221076735e-04; +2.378127876896500e-02   +4.622623298870805e-02   +4.360059990478284e-02   +4.174796634810626e-02   +5.426476134451846e-04   +3.456956486860624e-02   +2.806725617266463e-02   +3.390106714549829e-02   +1.948411862539952e-02   +2.080650224603639e-02   +1.478355474628335e-02   +1.801618441837291e-03; +1.596198195594829e-02   +2.231132938539252e-04   +5.990032419974454e-03   +4.040165739454728e-02   +3.294078752607574e-02   +1.617149298585596e-02   +1.593844788439641e-02   +2.299549829214079e-02   +4.959763125671753e-02   +1.904756174154368e-02   +3.344948399276789e-03   +3.023219301816201e-02; +1.901728902086879e-02   +1.961468482529293e-02   +5.139097358145787e-02   +6.497543106838773e-03   +1.836302789653601e-02   +3.820661625851331e-02   +4.703731799501382e-02   +4.202698673247959e-02   +1.642993024006422e-02   +2.974598395289874e-02   +4.135179571389928e-02   +3.725145326559865e-03; +3.133765012523823e-02   +1.545325625278393e-02   +3.843806088690607e-02   +3.221863996231763e-03   +7.855130692894934e-03   +5.056368603681310e-02   +1.474426335494399e-04   -3.602037705278707e-03   +3.428710169600242e-02   +2.894821569115567e-02   +8.881559991173932e-03   +4.553422927795256e-03; +2.846778628281842e-02   +1.682667470579383e-02   +2.648477604755332e-02   +3.034787951599795e-02   +2.582082028650615e-02   +2.155169049134508e-02   +1.182329160378282e-02   +7.952866479828211e-05   +2.382041130002416e-02   +5.853964976817790e-03   +1.337320181293592e-02   +2.591418483578104e-02; +8.371938019376066e-03   +3.820654730153527e-03   +4.394695943833628e-03   +4.340553548607448e-02   +1.912008413919410e-02   +3.750650903107011e-02   +2.763003618775485e-02   +3.331756327206628e-02   +3.623894480664321e-02   +3.984573866258232e-02   +1.082585696181538e-02   +3.223815012465488e-02; +1.075758891201989e-02   +6.959648290411574e-03   +4.085529239492513e-02   -4.565527485962774e-04   +4.553203617688606e-02   +4.233289563016383e-02   +1.275872041085345e-02   +4.148851256012850e-02   +6.010699441987298e-03   +1.293210803760490e-02   +1.988734119590320e-02   +2.726324218185329e-02; +3.948971108613020e-02   +1.385684311199300e-02   +4.131553910155653e-02   +9.945126162813574e-03   +1.577706866204882e-02   +4.851375836083075e-02   +3.199218844008760e-02   +2.296778538271223e-02   +4.709979699467030e-02   +4.694756224531553e-02   +1.181848838706426e-02   -2.197611185802185e-03; +2.302230725995169e-02   +5.200157739284084e-03   +1.631609608360320e-02   +7.869665669203958e-03   +2.731698339014197e-02   +2.191067630152843e-02   +4.619589204155287e-02   +3.526582813456140e-02   +2.520606526421156e-02   +9.196836593592632e-03   +2.872498993458293e-03   +4.226448736267973e-02; +3.475092178974293e-02   +2.684025394607626e-02   +4.842534943290450e-02   +3.382377093990342e-02   +4.415199379635061e-03   +2.028504016671542e-02   +4.225077032647072e-02   +9.554640461892983e-04   +3.470097125471903e-02   +2.297231586146532e-02   +2.415295980672676e-02   +2.026097678194873e-02];
L2E_Input1_iAMPA_netcon = [+4.516534487043297e-02   +4.713887362954355e-02   +3.859967202637338e-02   +4.773134623200587e-02   +5.065427768312772e-02   +5.440191173930667e-02   +4.997492841159194e-02   +4.487153514896530e-02];
L2I_Input2_iAMPA_netcon = [+4.313625395011152e-02   +4.953113714296545e-02   +5.055483114326576e-02   +4.339040599374724e-02   +4.117902382082658e-02   +5.162660079143554e-02   +4.603955622510050e-02   +4.161478548432086e-02];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last =  11.21 * ones(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.0*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.2*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.0*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.2*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.0*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.0*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.2*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.0*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.2*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.0*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
