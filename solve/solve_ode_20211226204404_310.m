function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+2.533203875458976e-02   +1.891942710947750e-01   -2.189312110057695e-01   +3.657255450611542e-02   -5.881742692441131e-02   -5.361953633254501e-02   +1.462143726995277e-01   +9.326561933123818e-02   +4.150505822183840e-02   -1.024630511574492e-01   -1.712796750215383e-01   +1.111806752478168e-01   +1.501797258462971e-01   -2.263941166224399e-02   -4.018031239465755e-01   -4.190632972805083e-01; +4.078526891471940e-01   +5.215941181103215e-02   +3.995287422362009e-01   -9.380801073962267e-02   -2.448739636489174e-01   +2.493714728303350e-01   -4.105802260277730e-02   +1.761036475002509e-01   -2.593678114678939e-02   +1.190287996953426e-01   -3.567508938834109e-01   -3.578274357220244e-01   -3.607379548822828e-01   -1.461132080850145e-01   +2.277943180693054e-01   -4.297711891279370e-02; +2.893490467668616e-01   -2.452039852796740e-01   +9.633573017786801e-02   +7.901660030834672e-02   +1.554137604449883e-01   -1.148427563531387e-01   -1.131553402526573e-01   -3.550672068052235e-03   +4.442344939383255e-02   +2.985675881758409e-04   -2.251791616600406e-02   -4.215131473884376e-01   -9.607894262103292e-02   +2.310196794482726e-01   +1.864825822024946e-02   -1.469555662252789e-01; -4.112597783397229e-01   +2.211511100649148e-02   +1.723623193066586e-01   -3.291494738849579e-01   -7.084629198541614e-02   -2.444007628841555e-01   +2.044315644711476e-01   +2.210555043425213e-01   -6.176751638264879e-02   +1.773601245337328e-01   +1.466947037297871e-01   +7.942218493028008e-03   -1.728994505662171e-01   -1.118290015429879e-01   +5.939749847731365e-02   +3.642917323436528e-01; -1.273984837271675e-01   -8.261652704424000e-02   -2.148069863003098e-01   -2.806073128784156e-01   +4.392005986282063e-01   -4.724343814323076e-02   +2.333743234175601e-01   +1.690958588774597e-01   +1.617546334096638e-01   +1.642250615851048e-01   +3.960477749956396e-01   -4.796350821166592e-02   +2.432569268822495e-01   -5.978562703402175e-02   +3.067869179315074e-01   -2.615137667607333e-01; +5.052243434193994e-02   +1.002869562702965e-01   -1.664138130701943e-01   -1.415899324974383e-01   +2.123325769263340e-02   +2.234643004982820e-01   -1.364094206915892e-01   +1.588811384849487e-01   +3.993009687635238e-02   -7.418150019593203e-02   -2.429085429210524e-01   -2.981799631812379e-01   -4.739806528781968e-01   -5.303945665122026e-02   +2.181883689362965e-01   -3.743903334027212e-01; +1.901012305088630e-01   -5.096930838119997e-01   -2.741273981452416e-01   +2.337656616845415e-01   -2.370786023781058e-01   +3.614075640863712e-01   +2.468930037761105e-01   -4.453556490896562e-01   -3.968831592605579e-01   -2.352871681008235e-01   -3.185420588873688e-01   +1.223289009986555e-01   +4.516897694895201e-01   -1.841945414312558e-01   +4.365903361574347e-01   -1.138537786589797e-01; -2.557227367298035e-01   -2.591042322802138e-01   -1.929509953475447e-01   -2.586090928603896e-01   -4.572659510818120e-01   +1.165604561383048e-01   -2.747420681733087e-02   -2.019683013746285e-01   +1.179912327637651e-01   +2.634755318626942e-01   +2.595867119198143e-02   +9.372926372159869e-02   +6.975839537891014e-02   -2.391219004671931e-01   +1.975136505651905e-01   -6.709953368285990e-03; +1.080373380186376e-01   +1.967296075559572e-02   +1.526457937923857e-01   -1.315574414958199e-01   +2.093607042106883e-01   -1.939515394126620e-01   -9.195149880368857e-03   +2.660799352700601e-01   +1.620522329277281e-01   -1.782243797469830e-01   -4.196613102595207e-01   -3.160925216704318e-01   +1.309277236742344e-01   -3.482506445662288e-01   -1.516754045607134e-01   -8.051709005428000e-02; +2.552413318631066e-01   -2.526752714800916e-01   -1.152592408303126e-01   -3.640230502706522e-01   +1.403148244078314e-01   -8.382765990848874e-04   +2.441249024614498e-01   -2.552788889204357e-01   +2.959489154887748e-02   +6.402777769706672e-02   +1.253440395257708e-01   -9.631134868905156e-04   +1.850601994424093e-01   -3.889101459731675e-01   +3.562475521988839e-01   +3.602238539487558e-01; +3.493958228367586e-01   -3.797000628511592e-01   -5.456954748544633e-02   +8.562326635393062e-02   +2.212690822647543e-01   +3.866753744100191e-01   +3.747753791268366e-01   +1.161734601709070e-01   -2.840993306219917e-01   -2.195132050247301e-01   +5.550128665520356e-01   +2.891214263535713e-01   -1.647877932595376e-02   +1.262128065152211e-01   +1.344351554629508e-01   +4.347070433793930e-01; +1.912239761046411e-02   +1.063902168185641e-01   +7.282379354709839e-02   +4.194739377741395e-01   -3.793153915660977e-01   +1.117247307739506e-02   +1.989979874016027e-01   +4.983678180718666e-02   +9.388286905804359e-02   +2.234031456667013e-02   -3.668406213626592e-01   +1.680141806296459e-01   +1.915492484684181e-02   -9.960592985040531e-02   +1.888566087004270e-02   +1.438969866300305e-01; +1.397845136954372e-01   -1.286683934389238e-01   -7.823200629509144e-02   -3.235601681226160e-01   -1.280259781770733e-01   -3.142898295360957e-01   -2.650823296299525e-01   +2.132550591143781e-02   -1.584376054175859e-02   -9.940803218436785e-02   +1.997337658343039e-01   -3.656644089122860e-01   -1.975556866592194e-01   -4.438718093998019e-01   +2.885581582690975e-01   +2.057460602497071e-01; +1.233744956729140e-01   -1.678798644823782e-01   -6.216299003850265e-02   +5.401373949377342e-02   +1.121868508300692e-01   +1.676472229583770e-01   +1.795229201726604e-01   -3.158037404244428e-01   -7.078874213250123e-02   +5.769666302896334e-02   +2.100676559740042e-01   +1.290635591867398e-01   +1.600472628452701e-01   -1.360024338701346e-02   -1.423995043028443e-01   -1.787001419338016e-02; -6.236293409566498e-02   +3.167052900934866e-01   +3.362329150821198e-01   -4.512021159768883e-01   -9.641676509329294e-02   -2.894152488082720e-01   +6.105119510695825e-03   +2.057356967174302e-01   +9.815176124241851e-02   +1.089409374112189e-01   +2.879053163326770e-01   -1.048612578717659e-01   -3.573797935956682e-01   +1.028418759817092e-01   +1.738876766909122e-01   +1.488379626719077e-01; -3.767187964504614e-01   -3.224749006244088e-01   +2.442565487103110e-01   +2.135353286363155e-01   -3.876520346687086e-01   +2.406871102531007e-02   -1.982277349930127e-01   -1.499310508843288e-01   +1.913338727079361e-01   +1.294794297500958e-01   +3.052939917713494e-01   +1.054690413858966e-01   +8.960349407124424e-04   -2.429209535477625e-01   +2.577049803802382e-02   +1.910164123486496e-01];
L1E_L1I_iGABA_netcon = [-3.709012531615665e-01   +3.646287080064740e-01   -9.313240911663691e-02   -3.003629241893945e-01   -5.544126160209645e-02   -5.669046111189925e-02   +3.018086162206656e-01   -2.923947838958837e-01   -5.736639022997558e-02   -1.659203493780829e-01   +2.822962552499678e-01   -9.399119515124876e-02   -1.659175388088693e-01   -3.093747339323741e-01   -3.648003640752988e-01   +1.171679280113112e-01; +1.980807119684281e-01   +7.453546476293001e-02   -2.856259437899341e-01   -4.297649263767976e-01   +1.665635737368029e-01   +3.768341382861251e-03   -2.453611725759325e-02   +3.751932875842942e-01   +6.790900012180467e-03   -9.026319841419017e-02   +1.345136097647009e-02   -2.969841398237165e-01   -3.858400581037511e-01   +5.576392205916160e-02   -3.426357151628466e-01   +3.148416704164816e-01; +2.688184719231129e-01   +3.910988618810082e-01   -1.091928090849773e-01   +1.444885890609984e-03   +8.025944757934650e-02   -4.232202109333534e-01   +1.680973647548888e-01   -2.988369492847445e-01   -2.665720909820932e-01   +1.757392301658398e-01   -1.134829851607552e-01   -1.924928976064184e-01   +1.143645940451458e-01   -1.337950952776474e-01   -2.009537357257591e-01   +4.909940552564207e-02; -2.811110332191479e-01   +4.597065344941426e-01   +3.967241066056931e-01   -2.585656965995647e-01   -2.127377217044092e-01   -3.374718261020124e-01   -1.202944156442770e-01   -5.131510781907926e-01   +5.357433575870856e-02   +3.508525032107354e-01   -2.089563476866216e-01   +1.788496771450429e-01   -1.263498896185831e-01   +1.847268759747873e-01   +1.729338183676121e-01   -9.206765646831649e-03; +2.002467774365749e-01   -1.625172328462708e-01   -6.166851680686427e-01   -2.529854860326225e-01   -4.261440233505176e-01   -1.413560489946576e-01   +1.066492097380885e-01   +2.453081216310723e-01   +3.384366216290692e-02   -2.286247062879507e-01   -3.844018630101205e-02   +4.755737714383751e-01   +1.758533356800101e-01   +1.043767137673563e-01   -1.274522463807460e-01   -6.270842677522563e-02; +2.135511095041158e-01   +8.486604562821756e-03   +9.277126402303951e-03   +1.581734827849334e-01   -3.099345698155418e-01   -2.384155421628107e-01   +1.406770598650479e-01   -1.389128965079762e-01   -3.342923269281584e-01   +1.337093078554980e-01   -2.854103902529938e-02   +2.920513966296861e-01   +4.433456950243029e-01   +4.015623843470543e-01   +2.142607400025653e-01   -4.037400026759763e-01; -6.921110674465769e-03   +2.269133056699709e-01   +1.727457591002607e-01   +4.075748822770808e-01   -2.482512613155799e-01   +2.352089919057668e-01   +3.995622076554313e-01   +2.672219819110612e-01   -5.069076410038706e-01   +3.034125937137986e-01   +1.045469403588818e-01   +2.035940907610151e-01   +4.590368745884284e-01   -4.102136511126120e-02   +4.015558059434457e-01   -1.096078577113391e-01; +4.704011329524482e-02   -1.847345433391956e-01   -1.908690564369713e-01   +2.828561029049411e-01   +2.891705754143200e-01   +2.990089513444019e-02   -5.576211927377392e-02   +6.360439245909785e-02   -1.904830992269006e-01   +9.007560717952592e-02   -9.008514719319549e-02   +2.520406903011549e-01   -2.290093271566767e-01   -1.065860549376837e-01   +1.598425880035704e-01   -6.090583730193008e-02; +4.872895303339566e-01   +2.083860321423397e-01   -3.455386259855051e-01   +3.184770465830972e-01   -3.476096249397636e-01   -3.236666591721176e-01   -3.335422369215154e-01   +7.750146915568440e-03   -3.933215203146544e-01   -3.822160211574476e-01   +2.578655287510803e-01   +2.391216560085191e-01   +3.137617903755477e-01   +1.722442725665517e-01   -7.472293261071719e-02   +1.807755669630488e-01; -4.424696962371855e-03   +8.756244573036343e-02   -5.407695343464226e-02   -2.335887903962217e-01   +2.584924135735495e-01   +6.349062579623135e-02   +5.969262342698317e-03   -4.094390916459867e-01   -5.079440057423597e-02   -8.200724192403006e-02   +2.954078446489558e-02   +3.769306709950210e-03   +2.086572347451170e-01   -1.306151745281830e-01   -7.805308955037064e-02   -2.335071954971060e-01; -3.846546988262628e-02   +1.993225071625043e-01   +3.773595525019584e-01   -4.915677512661543e-02   -1.294585756974230e-01   -1.184924125443076e-01   -3.578383575638111e-04   -4.032316100913957e-01   +4.219335033522933e-01   -5.051365471247954e-01   -4.429372072875526e-02   -1.000109921743149e-01   -3.591679404797309e-01   +4.329891873742383e-01   +1.861051215970457e-01   +1.757938950328002e-01; -2.679852073987162e-01   +1.323750135300091e-01   -6.672993312327347e-02   +1.277621361232842e-01   -1.285706629277897e-01   +2.240441976670513e-01   +1.847199739790443e-01   -2.832792053945673e-01   +4.969837916878103e-01   +3.778128409711762e-01   -7.110421349281751e-02   -1.593380136503215e-01   +1.558919504789515e-02   -3.073831389166179e-01   -2.156333621481061e-01   -1.246373516339192e-01; +3.521805887995855e-01   +8.743768448091080e-02   +7.509126692056278e-03   -4.058146540061467e-01   +3.083750330817255e-01   +7.709264688499533e-02   -1.896273231251665e-01   +9.453080679972964e-02   +2.279821970234168e-01   +6.170475372164037e-02   +3.667057282159676e-02   +2.995129255596453e-01   +2.807664583705294e-01   -3.736877227940043e-01   +1.017785668453192e-01   +2.193921537323265e-01; -1.349704699551512e-01   -2.425540531797203e-01   -2.836759935344014e-01   -3.337682648649887e-01   +1.284136719976342e-01   -4.238280215661330e-01   -3.287639121071607e-02   +4.434430494873067e-01   +9.649331125350361e-02   +1.572734777227655e-01   +3.144432765254185e-02   -4.467208559107472e-01   -8.012141060780836e-02   -6.516412208803139e-02   -1.416439567845085e-01   +1.052505735956624e-01; -1.089715513629268e-01   +4.267295077071029e-02   +1.252878149449959e-01   +4.174529026583684e-01   +1.245074544582572e-03   +1.006256707684488e-01   -5.269554018049456e-01   +4.692425386149531e-01   +3.171839443534067e-01   -1.600223308579355e-01   -1.308927951710245e-01   +1.807514600996935e-01   +1.981184032044463e-01   -4.321611005392173e-01   -3.681593562315674e-02   -1.322485894328774e-01; +2.958815593455958e-01   -1.482624864762288e-01   +1.614360012427540e-03   +2.819438508729366e-01   -2.054883351009429e-01   +4.728418294231250e-02   +4.305938606278208e-01   -4.381813498364399e-02   +9.092635909316246e-02   +9.928152502840353e-02   -1.500257759741780e-01   +3.009234616811733e-01   +3.684660766179445e-01   -1.496131126964234e-01   +4.141140447644591e-01   -4.116395371056788e-01];
L2I_L1I_iGABA_netcon = [-1.765458929913283e-01   -1.706904502433083e-01   +8.153555894219952e-02   -1.242326547964000e-01   +3.974249229538901e-01   +2.906730014386568e-01   +2.514465663958294e-01   +1.526388235108248e-01; -2.676829849942167e-01   +4.342062172300502e-02   +2.626730013033206e-01   -2.789998603865066e-01   -2.258718305234751e-01   -7.602228727484894e-02   -4.151022745858269e-01   -3.817995735791211e-01; +2.820475986912191e-01   -2.434555187186078e-01   -2.857379796234722e-02   +3.408563688286795e-01   +4.517004043580153e-01   +1.995125914811892e-01   -9.947028840537636e-02   +2.680360295797669e-01; +1.346863996961423e-01   +1.913068167246171e-01   -4.204489149882966e-01   -1.036857311266274e-01   -1.184562569107916e-01   +5.504159876932213e-01   +4.946877204830384e-01   -9.523290435035307e-03; -1.213901769507927e-01   +1.054157096303569e-01   +1.440903524049013e-01   -2.785911165776694e-01   +2.088509280881692e-01   +4.668245685577480e-02   +1.788906680596438e-01   -2.553247271065851e-01; -1.878964244006889e-02   -4.690983937722467e-01   -1.639878300364197e-01   -1.858902602865412e-02   +1.678728652402237e-01   -1.669012555277478e-01   -4.016078988875671e-02   +1.052000668417786e-01; +4.319426381788121e-02   +1.799828672082698e-01   -1.870822041430248e-01   +1.431486992221587e-02   +1.880687456266880e-02   +3.492142641791605e-01   -1.364078898079926e-01   -2.322240601945317e-01; +1.864719404444630e-01   +3.884821859421161e-01   +2.991889741341035e-02   -2.854592537331644e-01   -1.597330670982327e-01   -3.452759235469624e-01   -5.736851517011843e-02   +2.980669075668874e-01; -6.466172490964706e-02   +2.085177685133631e-01   +3.446870513356818e-01   +1.594476930941730e-01   +2.941907996194264e-01   -5.057952883920408e-02   +1.802884082354495e-02   +1.448471918251214e-01; +1.306122256013204e-03   +2.044467404488068e-02   -1.110650753338609e-01   +1.083925934945605e-01   -2.049987220188619e-02   +4.016508075998062e-01   +4.091189169551911e-01   -2.669156993801763e-02; +3.538054339476013e-01   +4.432257750434387e-01   +1.874139191072960e-01   -3.050725434929393e-01   -2.083548854419106e-01   +9.338158081263279e-02   +1.525755014704414e-01   +2.437686347486559e-01; +2.387051151090105e-01   +2.452024825198646e-01   +1.746297456461116e-01   +5.281311793955210e-01   +4.433494526508980e-01   -7.587509702809803e-03   +3.557968708533992e-01   -6.773387415864804e-02; +2.735052516763458e-01   +3.135923540348151e-01   +7.617006318392014e-02   -1.705845463694982e-01   -1.991082967617773e-01   +3.148047306910768e-01   +5.258847337781369e-03   +3.496437865003904e-01; +3.034883017420759e-01   -3.127814727294153e-01   +7.022898679111766e-03   -2.626531570625440e-01   -2.374765024369356e-01   -4.041668169314369e-01   -3.701696514444807e-01   +1.123748446923250e-01; +5.888998992325810e-02   -3.988984989308631e-01   +4.962923177869328e-01   -2.704738879079278e-01   +3.082524663003933e-03   +6.384592640824181e-02   -6.337494990108211e-02   +2.761835705435284e-01; -2.764084625248219e-01   -1.523119219877043e-01   +1.245272470333297e-01   -2.775253148037188e-02   -1.417125652626978e-01   -3.567772348714686e-01   -1.183045190875102e-01   -4.671679476883416e-02];
L1I_L2I_iGABA_netcon = [-5.680575935868053e-02   -1.777357212417437e-01   -4.043351867716264e-01   -3.517696576784174e-01   +2.351314487254041e-02   -1.196737963322034e-01   -6.927743363840003e-02   +1.233507940477823e-01   -4.843958116590373e-01   +4.333495617769735e-01   +2.728970906630745e-01   +4.487613837688051e-02   +3.018153078065761e-01   -2.887417743620787e-01   -2.250972830494956e-01   -1.478879129329169e-02; +1.053174362024027e-01   -2.133960355788861e-01   +2.690325941337544e-01   -3.498891180920610e-01   +4.226205329421003e-01   -1.732029755164365e-01   -4.332764715831744e-01   -2.071940894652775e-01   -5.642918987145293e-01   +1.255432915553189e-01   -1.936717283149082e-02   +1.246066992267189e-01   -3.234600204003890e-02   +4.616043932312003e-01   +1.584650292108037e-01   -1.562533431571281e-02; -5.315920393251183e-02   -2.438970718205104e-01   +1.025293896376307e-01   -1.479730135662106e-01   +2.624012166231034e-01   -8.423944097962632e-02   -1.045850236580338e-01   +8.344071585855875e-02   +6.189445322374962e-02   +1.095175569717059e-01   +1.783506667266042e-01   -4.194986622347573e-02   +1.130213127696464e-01   -3.766730342723144e-01   -2.638918715039398e-02   -1.975552414016800e-02; +2.462636306338475e-01   -4.082447102491226e-01   +2.352807757189260e-01   +4.444930434482725e-02   -3.010470212378192e-01   -3.986291257849188e-02   -2.293651842493856e-01   -1.622342532872930e-01   -1.637058266172121e-01   -8.350790505568351e-02   +9.586388206717550e-02   -2.077477435434289e-01   +1.598357648343907e-01   -5.121192132457958e-03   -2.251362117471547e-02   +2.532817587065011e-01; -1.911875900226435e-01   +1.877587804854026e-01   +3.072407820250155e-01   -1.862161437365425e-01   +1.795567688633103e-01   +1.324982735581042e-01   +3.785106839134572e-01   +2.975240660779278e-01   +9.154663633251190e-03   -2.619430786798231e-01   -1.046875184510911e-01   +2.771820364579247e-01   +9.409645858333154e-02   -3.035700458810350e-01   +3.219366951088015e-02   +3.651053585000709e-01; -8.632756065706984e-02   -9.099850559622999e-02   -1.709407044738048e-01   -2.942239530129250e-01   +7.111606443590328e-02   -1.789851735759478e-01   -7.605679771115567e-02   +3.456598894730340e-02   -3.126585924153841e-01   +1.568771527360282e-02   -2.764427793483668e-01   +2.843146989431592e-01   +8.695376654024201e-02   +2.232835112039373e-01   +2.267814262684911e-02   -2.083385276654039e-02; -1.170104583998725e-01   +5.957314539624463e-02   +2.953896468546621e-01   -1.485648585461035e-01   +1.242983690421566e-01   -7.391781743046165e-02   +3.450138248065049e-01   +2.964011399860667e-01   +2.363591464848668e-01   +3.118367168414973e-01   -6.766443181336845e-02   +3.944089082807064e-01   -3.186097640836330e-01   -2.368013480657798e-01   -3.945949122241297e-01   -2.865682513581088e-01; -3.070456999243290e-01   -2.299816879142022e-01   +1.018868083462730e-01   -2.547486268794237e-01   +3.396479511311445e-01   -2.911364821230690e-01   +6.205500447038226e-02   +2.136418922439850e-01   +1.357997030271889e-01   -1.290934568674971e-01   -2.084591841340759e-01   -2.062481307704069e-01   -4.189324690082816e-01   -3.162960865855682e-02   +3.873151371443212e-01   -9.032895682096485e-02];
L2E_L1E_iAMPA_netcon = [+1.825841959351534e-01   -7.538317602779060e-02   +2.609647817521887e-01   +2.030329419349568e-02   +1.537858685093112e-01   +2.413509422247263e-01   -3.398204263618310e-02   +3.086311113015284e-01; -1.812397910672868e-01   -1.308340845770612e-01   -2.418410847731152e-01   -2.790491211162452e-01   -4.611048479191092e-01   -1.595795196986121e-01   +1.124987753562411e-01   -3.580290701911694e-02; +1.553563228200494e-01   +2.423887002121033e-01   -2.477219326710364e-02   +2.770209818333694e-01   -1.683134602846036e-01   +6.111741254481697e-03   -8.438989244874150e-02   -4.434717959173117e-02; -1.202352795648530e-01   +4.058167816710796e-01   -1.917181346261923e-01   -2.256162404065993e-01   +4.063761201000454e-01   -2.667848604215612e-01   +1.953116636652017e-01   +3.180506902118615e-01; -1.915033355901764e-01   -9.250438360313459e-02   -4.639651750882209e-01   +2.308896845418043e-01   +1.704887033682318e-01   +3.210070166519460e-01   -1.498435209102482e-01   -3.148225187494419e-01; +6.309507333078514e-02   -6.939138512548519e-02   -1.338051246714918e-01   -1.205171301658803e-01   +1.340981249682608e-01   +8.245583201208298e-02   -7.977769380727540e-02   -2.330566351638282e-01; -2.712896130578379e-01   +3.374292494584571e-02   -5.349415777255772e-01   -1.436006071846724e-01   +1.697460730563550e-02   -3.976112690298798e-02   +1.989528167079637e-01   -1.921960284227705e-01; +7.898540553475722e-02   -1.313014615830457e-01   +3.878936358784350e-01   +1.400737032171543e-01   +2.732620079116111e-01   -3.915843355227075e-01   +1.048998570964353e-01   -1.171519473079277e-01; -3.420311025389387e-01   +3.618384805381611e-01   +1.092632442811408e-01   +9.268216336539291e-02   -1.220834264879995e-01   -9.038437938246649e-02   -5.914313567139085e-02   -4.694193628879073e-01; +8.181623623854058e-02   -1.315518450681822e-01   +9.273652094000995e-03   -3.101895310769763e-01   +4.396686893858151e-03   -2.178612173667858e-01   -1.912693194950499e-01   -1.376943100037039e-01; +3.909997128239965e-01   +2.523942486293300e-01   -1.109490346659353e-01   +3.217158929916407e-01   -1.640253517369696e-01   -3.336036659135466e-01   +3.867802303602070e-01   -2.422291878971497e-02; +2.687654702050043e-01   +3.270587250978720e-01   -6.690494803204110e-02   +5.202691798960355e-01   +3.457400013591104e-02   +2.200724910255733e-01   -3.951762153516702e-01   +2.268614928949170e-01; -3.143053939151056e-01   -3.156590776112314e-01   +3.674635177374690e-01   -1.345447671291956e-01   +2.403822608070768e-01   +2.245978390591665e-01   +7.664397753225521e-02   -2.915608017729868e-01; -3.498258758758714e-01   -1.377630032866805e-01   -8.120686100767596e-02   -7.221891701734068e-02   +1.411126435167264e-01   -2.469377170422186e-01   -2.371632648434327e-02   -2.089007351226841e-01; +2.211456291088318e-01   -1.764504335094592e-01   +2.441289591098323e-01   -8.515139098448768e-02   -3.565417037744673e-01   -5.454106822205896e-02   -3.904159162385289e-01   +4.193387803998829e-01; -2.985632716461943e-01   -2.834268729353135e-01   -1.221347936128089e-01   +1.748162769136874e-01   -3.485649723770616e-01   -2.723700960496538e-01   +1.691986598122246e-01   +3.820590913383750e-01];
L1E_L2E_iAMPA_netcon = [-1.866047112769353e-01   -1.378682527628524e-01   -1.676806105673947e-01   -1.740076805829743e-01   +6.170823966769595e-02   -1.403322621038573e-01   +4.640851104887576e-02   +1.354840621397777e-03   +3.708161797413787e-01   -1.606960060303152e-01   +2.405592935529935e-02   -2.677051580268639e-02   -2.993260808858403e-01   -3.470730355684559e-01   -4.819477491935133e-03   -9.294739520237220e-02; -1.268308203386325e-01   -3.465819933402716e-01   +3.265603909013022e-01   +2.483492377735201e-01   -3.406310228326402e-01   +4.936485928631072e-01   -7.693461045897192e-02   +3.298945349657689e-02   +5.452595487775092e-02   +4.429063742154670e-01   +3.489341556319112e-01   -1.412191305595911e-01   -1.558062588111964e-01   -1.647192764386999e-01   -2.132898050348228e-02   -2.797330198423159e-01; -4.559737864961714e-01   +1.415572240220422e-01   -1.294492447938295e-01   +1.237548628580844e-01   +8.661632791961489e-02   +5.123158901136967e-02   -1.369768176347401e-01   -2.962668921908856e-01   -9.629767273605999e-02   +1.234853786539181e-01   -2.960316096324192e-01   -1.970327824870832e-02   +6.419368286706879e-02   +1.255642171654678e-01   +7.626427717716405e-04   -2.932350122894871e-01; -1.853676484804422e-01   -5.042943053109243e-02   -5.133244795765508e-02   +1.123490176122357e-01   +3.058807952660612e-01   +3.254039911922478e-01   +9.405074551278209e-02   -2.085627241505723e-01   -7.346962847476710e-02   -3.970534592947211e-02   -1.451760154467060e-01   -5.121988615128097e-01   -1.483879398630194e-01   +1.795140604150250e-01   +6.969441260307983e-02   -2.938336063180582e-01; +2.821311137161187e-01   +3.973989134797730e-01   +4.362626625635557e-01   +1.309827674988503e-01   -3.107395005510117e-01   +3.676843088664038e-01   +3.485208247726925e-01   +4.199285035754416e-02   +1.223119328888586e-01   -7.993805195960899e-02   +2.102031210526240e-01   -1.865336212729825e-01   +1.101667668962062e-01   -1.165200565807664e-01   +1.491524347713024e-01   +5.998957994839874e-02; +1.728640108098424e-01   -3.605694689506395e-01   +6.700793421576934e-02   -4.164117098916342e-03   +1.202907501685115e-01   -4.487769666523722e-01   +1.238549094276099e-02   -2.051140327375287e-02   +2.556285614163599e-01   +6.448489904885507e-02   +2.684234652725285e-01   +7.294430129405741e-02   -1.556864821075064e-02   +3.330054835429654e-01   -1.069779228941267e-01   -5.630750016000380e-02; +9.522367623951157e-02   -2.288458890310141e-01   +1.185720394585633e-01   -2.897755468863410e-01   +5.616694760020011e-01   +1.124428251220956e-01   +1.474169267723614e-01   -1.762451656883145e-01   +3.518697419759292e-01   -1.331450542256342e-01   +2.377859110621765e-01   -1.972780511276277e-01   +4.819717487858437e-01   +2.660929437295836e-02   -2.037178248445912e-01   -4.920598187715566e-02; -1.355217876206308e-02   -4.414781138533951e-01   -1.051620137129480e-01   +1.566572924974498e-02   -3.189511532895050e-01   -2.065884827170006e-01   +1.598950211566522e-01   -4.430285604387513e-02   -8.664093628708071e-02   -1.448969694853579e-02   +2.769392257616546e-01   -5.089007708353349e-02   -6.708185819387705e-02   +1.401089141633822e-01   -4.685973854363888e-01   +1.561689604080580e-01];
L2I_L2E_iAMPA_netcon = [+1.243862847052083e-01   -3.182910858657332e-01   +2.151990692894184e-01   -4.097602273270164e-02   +3.818474459150168e-01   -7.656908309540386e-02   +4.295600687647005e-03   +4.087672917773329e-01; -1.313023989535258e-01   +2.484978727876618e-01   -2.792891969658510e-01   -3.174859066098011e-01   +2.248323136408448e-01   +1.066012931319079e-01   +1.170746902249512e-02   -9.750815814955652e-02; +3.810536368497072e-01   -1.374960899188338e-01   -8.337958921522505e-02   +5.827703790366640e-02   +1.192336358937437e-01   +1.996196190485661e-01   +2.307250147134926e-01   +2.301898631502543e-01; +1.109718941422319e-01   -2.171623459582723e-01   +4.805697071799397e-01   -1.701583113368730e-01   +2.264736679464783e-01   -1.541359548109336e-01   -1.894187551998467e-01   -1.521378288630852e-01; +7.443671889974635e-02   -5.933609372621409e-02   -2.816349325528086e-01   +6.185034871674393e-01   +1.311303303247220e-01   +2.949176612771144e-02   +4.539604820663873e-02   -3.120631084206330e-01; -1.763297344793968e-01   +1.498194299402595e-01   -1.654181989278179e-01   -2.958249087460099e-01   +2.127377198123137e-01   +2.552903405295635e-01   +2.509990309001203e-02   +1.759420489267391e-01; +5.340717842327000e-01   +3.296989892209951e-01   +1.002310677837600e-02   -3.713305828849381e-02   +2.354298324496951e-02   -5.637687265715956e-02   +2.017852957240053e-02   -2.811653724329619e-01; -1.046572649075098e-01   +2.896368599749033e-01   -7.618642779979007e-02   -2.536383112698441e-02   -8.067247406587968e-02   -2.782200335006833e-01   +5.725554620425476e-01   +1.849378406685054e-01];
L2E_L2I_iGABA_netcon = [+3.128130920935102e-02   +1.726043748421255e-01   -2.281218141704750e-01   -1.613940956114795e-01   -1.855167532881952e-01   -3.327955708856754e-01   -1.072097327577931e-01   -3.090796195371123e-01; +1.694172725011736e-02   -4.060909893679722e-01   -5.518287860796015e-04   +3.102335396082158e-01   +3.956985652048179e-01   -3.354071136799808e-02   -1.114905765200213e-01   +2.538216901416102e-01; -2.372211274201548e-01   -3.791082405569174e-01   -8.715735638401995e-03   +1.832124769692714e-01   +2.121055750676743e-01   -2.439009926690418e-01   -2.024121813757941e-01   +2.414942368385352e-01; +1.629542813063858e-01   +9.796898038159188e-02   +4.508901102164377e-01   -4.872961444023499e-01   +2.531188177927071e-01   -1.591774404078962e-01   -4.646321079670571e-01   +3.796705983104406e-03; +2.530892670375156e-01   +9.982905012138327e-02   -2.328599369118882e-01   +1.225679010527777e-01   -8.971985295782209e-02   +3.345296370833313e-01   +1.783378208360472e-01   +1.411900760617635e-01; +3.922822873995434e-01   +5.214755126319378e-01   -2.276364078091450e-01   +1.966336749065815e-01   +1.414043544334795e-01   +2.973994806352845e-02   -3.700011860086113e-02   +1.481494148803673e-01; -4.703143290286139e-01   -1.879858042156329e-01   +2.538494879275201e-01   +1.847213378973867e-01   +2.987640050106806e-01   +1.723205931602606e-01   +2.957660452544457e-01   -1.774083905201975e-01; -1.911575906123485e-01   -4.274348367943410e-01   -2.176038203996100e-01   +2.285260252976112e-01   +1.327493865307907e-01   -3.154352847491482e-01   +1.058917744177199e-01   +2.239176238665512e-01];
L3E_L2E_iAMPA_netcon = [+3.215819838167053e-01   +1.641801862849416e-01   -4.548050460491049e-01   +1.482968632145821e-01   +3.371088859629658e-01   -2.839876907697905e-02   +5.674748780747491e-02   +1.498109341700811e-01   +6.161319214786014e-02   +4.763487430820589e-01   -1.388204398818434e-02   -1.881220382371999e-01; +4.271932977793664e-01   +3.575441330818790e-01   +1.024695690623098e-01   +8.898233467478067e-02   -1.905590485786452e-01   -5.043864798811861e-01   +4.361814078160073e-02   -3.287073001597079e-02   -2.631850185695263e-01   -1.098391948824105e-01   +6.042413017658677e-03   -2.706973831505621e-01; +3.070613908691053e-01   +5.122467808635779e-01   +1.079614357647578e-02   +3.959195934460344e-02   -3.731344223473408e-01   +2.560596158573168e-01   +9.071540177432716e-02   +1.416064946436322e-01   -1.690826749906199e-01   -3.068773398069217e-01   +1.727651549102645e-01   +1.498180922862692e-01; +2.875989424458197e-01   +1.872635378244124e-02   -1.622722299360150e-01   +8.953466669976454e-02   +4.356976937123378e-01   +2.903104577919086e-01   +4.201944414765180e-01   -1.997286390630919e-01   +1.653898356046410e-01   -2.064345486956093e-01   +1.391000859009356e-01   +1.613738145369329e-01; -3.733539724330578e-01   -1.516802976334721e-01   +1.776261104433505e-03   -2.102060874109858e-02   +3.961395242192993e-01   +3.560247680740065e-01   -1.436079923925993e-01   -2.835133941387910e-01   +1.531550877006244e-01   +3.181358201059792e-01   -3.831474630415032e-01   -5.240216795883688e-02; -1.264235478784189e-01   -3.156876063637774e-01   +4.134663072141997e-02   +4.550297025878921e-01   -2.863767015399375e-01   +2.486742072438450e-01   -2.484222599394912e-01   -4.542053250656514e-01   -1.009381227202241e-01   -1.368673723444017e-01   -1.201374165648566e-01   -4.400845901118444e-03; -4.209243133767397e-02   -4.059999510864437e-01   -1.887933252493260e-02   +2.958347335108396e-01   -1.756602585242513e-01   +9.974996685525730e-02   -2.058150790017445e-01   -3.523406366542140e-01   +1.633932823603475e-01   -1.103897010037202e-01   +1.194479668258266e-01   -1.866164996226721e-02; -7.733157887329666e-02   +2.225406071148129e-01   +2.167749953952466e-01   -9.016524729590022e-02   +1.667888730535314e-01   -9.464116402128553e-02   +1.688088034237069e-02   -3.210307354876585e-01   -2.236911368683205e-01   +1.488038215371166e-01   +5.498599455137708e-02   +3.861920715516795e-02];
L3I_L2I_iGABA_netcon = [+1.271081500078662e-01   +1.958844184088607e-01   -7.129493170620682e-02   -5.106796728947362e-02   -5.328422591276224e-01   -1.796723724771396e-01   -3.924301363612265e-02   -3.535885602667974e-01   +1.139116086120996e-01   -2.488895706570514e-01   -1.930682618699854e-01   -7.805837687391610e-02; -2.417022414943319e-02   +6.082356798109784e-03   -2.360468165941430e-01   -3.845880578682401e-01   +1.617370931273612e-02   -1.537678611183912e-01   -5.566378476545575e-02   -5.576311932049978e-02   -2.174751496109771e-01   -6.377866527551584e-02   -2.002660908940171e-01   +2.772902608891803e-01; +1.493953156507688e-01   -3.695219028746907e-01   +1.471365864547699e-01   +3.120029439922311e-01   +2.327502790286773e-01   -2.062823444883648e-01   -6.060376965504614e-01   -2.129995714062287e-01   -2.455813882676647e-02   -6.048611267564355e-03   -3.356767388485546e-01   +1.710019813727620e-02; +2.789660880132385e-01   -2.693124587397175e-01   -1.388097201105941e-02   +4.503168200255919e-01   -2.863861664137099e-01   +3.635287219801517e-02   +1.880498094313858e-01   -1.705383233908337e-01   -4.888373124142053e-01   -1.337876099847710e-01   +1.609006136486608e-01   -2.267687751532554e-01; +1.859275618221373e-01   -5.506544762040433e-02   -2.115280505665660e-01   -4.582671986038803e-03   +2.646725467651853e-02   -2.425366654850334e-01   +2.941696822337007e-01   -2.015515303560801e-01   -1.535997560928210e-01   +2.372373674424981e-01   -2.718728596435350e-01   -2.498653515221628e-01; -3.838263038945013e-01   +5.932886997899616e-01   -1.075294675438705e-01   +5.707722730793620e-02   +1.167799780776006e-01   -8.461998376523552e-02   +2.632244589488568e-01   +4.477172056963572e-01   +4.103003804833019e-02   +9.664433030017483e-02   -9.329655272747053e-02   -1.691111258618214e-01; -2.216160160498362e-01   +5.394158933459565e-02   +2.530454284261514e-01   -3.455880608092952e-01   +1.772320602374551e-01   -1.278270851728272e-01   -2.449851981118781e-02   +3.575237088197719e-01   -3.354449813157993e-01   +2.879895319781172e-01   +1.404184622726168e-01   -2.548808528358479e-01; -2.894922665684155e-01   -2.094125656969791e-01   -2.320982805472199e-02   -2.434781052060299e-01   +1.496722216385171e-01   -3.667618599544156e-01   +7.549736178942279e-02   +1.020002273795385e-01   +1.237594649585329e-01   +5.667737136653255e-01   -1.722329593644364e-01   -3.829315101688218e-01];
L2E_L3E_iAMPA_netcon = [-1.346132122225221e-01   +2.611759500277887e-01   +1.258226531485017e-01   +4.731009162223118e-01   +1.558433833111584e-01   +1.968554739878773e-01   -1.473922507091481e-02   -6.773918388547628e-03; +3.062028447103431e-01   -3.856235347801896e-01   +2.809282238065191e-01   +3.408696586131545e-01   -1.796329272405900e-01   -4.348506669077254e-02   -2.277471474257679e-01   -4.402415701406377e-01; -9.370909825099491e-02   -1.449445971821421e-01   +7.303580171450388e-02   +2.653314247034897e-01   -1.776073626571704e-01   -3.093090325845663e-02   +3.798513553823601e-02   +1.194748692664672e-01; +2.965856796542829e-01   +3.744127293392668e-01   -4.013417914649692e-01   -2.701275757181308e-01   +8.013428150758155e-02   -1.485272285712208e-01   +2.696384456882406e-01   -2.270450414841751e-01; +1.284399652484066e-01   -2.110416119630665e-01   -1.500510225103242e-02   +3.624090404642478e-01   +2.474480635702500e-01   -3.982510499493799e-01   -1.527815789235440e-01   -1.361329199090643e-01; -2.309720861004233e-01   +1.339407627046982e-01   -1.952362361615723e-01   +9.474970989536616e-02   +2.567984513972834e-01   -2.122780524033405e-01   +1.849883606195857e-02   +2.357256729697869e-01; -3.164425737288662e-02   -3.148185178135643e-01   -2.235133906678503e-01   -8.628747476548593e-02   -7.067693207730105e-02   +1.118753483116354e-01   -1.948981535215105e-02   -2.615781044785129e-01; -4.982534202921133e-01   +9.094552869626218e-02   +4.270349415040144e-01   +3.079299474983601e-01   -2.656797816208482e-01   +6.799919360186543e-02   -4.377759433729080e-01   -4.021689519505654e-02; -2.185030043250731e-01   -1.543067344831094e-01   +1.388339858752327e-01   +4.985335128808452e-02   +1.149150122807935e-01   -1.654049073234256e-01   -3.160079435544526e-01   +8.943580730228960e-02; +6.189172330403544e-01   +2.551519944704357e-01   -7.175743266545728e-02   -2.807023562571960e-01   -2.489892309956741e-01   -1.919640783937186e-01   +2.474506680035614e-02   -1.373107077780964e-01; -4.550158087846509e-02   +2.028502795473041e-01   -1.655999268904117e-01   -1.176813696200543e-01   -2.671882138082051e-01   -2.763232842098043e-01   -4.727336911878385e-01   +4.501474305437332e-01; -3.406334663280122e-01   -1.154315560886854e-02   +3.223718346405984e-01   -1.860442492888301e-01   -3.136122671749595e-01   -4.850091612203795e-02   -1.649189986099633e-01   +7.123903585388287e-03];
L2I_L3I_iGABA_netcon = [+1.109927640338850e-01   +1.490947487182882e-01   -9.246946792688671e-04   +2.063030970157400e-01   -5.049997267198617e-02   +2.166566250398106e-01   +3.420170558289208e-01   +2.461769411835713e-01; -2.722399335358054e-01   +1.210849521283622e-01   -2.246202097178855e-01   -5.533647589072851e-02   -2.227688711887429e-01   +2.725896120130927e-01   +2.801066214585674e-01   +1.173641478451629e-01; +6.345253423329900e-02   -3.181800775601751e-03   +4.890272618771745e-02   -1.095626369175778e-01   -3.027321742363710e-01   -1.573093936890951e-02   +3.051140619178694e-02   +5.481821477363893e-02; -1.180648368446884e-01   +5.629254744935552e-02   -3.043937194238340e-01   +2.483810211707257e-01   +4.567606906129548e-01   +3.968079488858653e-01   +2.926347446894076e-01   -1.656596106691790e-01; -2.898782355261934e-01   +1.714655396411027e-01   -2.841810498179598e-02   +4.211578193320699e-01   +2.020761891992699e-01   +1.018624538722295e-01   +3.490836144231207e-01   +1.174022838185016e-01; +1.509040695029781e-01   +2.970538830335874e-01   +1.982919219828957e-01   -2.481466680473877e-01   -1.347060185329754e-01   -2.261071152055100e-01   +4.321618388209304e-02   +9.038245366624342e-05; +1.814787923197702e-01   -2.348533071108873e-01   +2.994125062867723e-01   -9.538182416818350e-02   +3.069809661296163e-03   +1.571445302844395e-01   +2.271939225653781e-01   -1.927025289819237e-01; -1.093705253688654e-01   +5.835437203357141e-02   +2.956147867566382e-01   +1.282077891272572e-01   -2.639081114855393e-02   -4.004519252500649e-01   +3.306942459414542e-01   -5.108857934146949e-02; +2.581979015364743e-01   +3.359091791634969e-01   +1.611243882134790e-02   +2.064269939605686e-01   -2.134763716141666e-01   +6.460768589393943e-02   +2.365880984956869e-02   -2.657775048769068e-01; +2.968829547744745e-01   +2.310601968134156e-02   -2.598705064008529e-01   -1.297768409997027e-02   +4.844578098861985e-02   -1.630449570905681e-01   -1.412895731656853e-01   +1.304602987844949e-01; +1.384370339867362e-01   -1.511995768024798e-01   +1.183680182726174e-01   -1.874847631703807e-01   -1.654293848071997e-01   -2.552590931594555e-01   -1.664151462873432e-01   -4.352104731537165e-02; +4.388453530446448e-02   -1.087960146165515e-01   -1.261231626982314e-01   -3.764831930551178e-01   -1.467872119297636e-01   -3.146777880113206e-01   +2.321500784748989e-01   -1.335149704237629e-01];
L3I_L3E_iAMPA_netcon = [-5.274288055811652e-02   -1.819182558366901e-01   +3.780745657723303e-02   -8.854383933273677e-02   -1.454373672950845e-01   +3.127451957171878e-01   -3.277228684469165e-02   +2.830300021414024e-01   -2.359847936730794e-01   -6.153137323602913e-02   +6.184530194022392e-02   +1.255061148203899e-01; +2.255941119735686e-01   -1.186816495827014e-01   +8.816560436108700e-02   -2.461018479334096e-02   -1.401316451978516e-02   -4.166102634972234e-01   +1.050475051891945e-01   +2.443926964520282e-01   -2.489797130871434e-01   +3.013094648087462e-01   -2.652317596098984e-01   -1.079085939457117e-01; -2.145431580881957e-01   +4.474269506403167e-01   +7.397475990097044e-02   -3.574479054353232e-01   +7.493121684986423e-02   -2.505222652206431e-01   -1.758930177650706e-01   +7.031506643516965e-02   -2.572580633062950e-01   +1.435707050555452e-01   +1.868499459411265e-01   +2.667442498225225e-02; -2.561831987290382e-02   -8.493703771820520e-02   -2.730966004610885e-01   -1.069356661643479e-01   +3.374647312960359e-02   -1.518804058886358e-01   +9.689519370662694e-02   +2.291062757511363e-01   -1.222910097891701e-01   +5.541921412649181e-02   +1.028168295835717e-01   -6.933586641554731e-02; -4.137576860474435e-01   -3.936747243617607e-01   +6.679856851640725e-02   -2.715590628771311e-01   +2.213296439245424e-01   +2.993397254564110e-01   -1.278262029565317e-01   +2.896546859233045e-02   +3.017931568358823e-01   +3.764392872385304e-01   -2.624776250529234e-02   -5.924595268968377e-02; +8.752573528813276e-02   +3.080589063293245e-03   +4.935748111096375e-02   -3.235849113674890e-01   +3.660637390701282e-01   -5.767234153196504e-02   -3.765448791386604e-01   +1.506835234845766e-01   +2.472372948973333e-01   +1.575928566287325e-01   +1.693326592610704e-01   -5.152994711834230e-02; -3.029129866717875e-01   +1.303223759412309e-01   -2.270883099492440e-01   +5.049642268219988e-01   -2.448079505331062e-01   -1.054257833194228e-01   -2.821460275780107e-01   -2.352513226541469e-01   -3.725139490921848e-02   -1.272349234446340e-01   +1.414953395480129e-01   -1.378881502398124e-01; +3.842070372689847e-02   -2.293579303244769e-01   -8.415410931654346e-02   +3.936934892124621e-01   +2.251116644117278e-01   +4.354374250810461e-01   -6.592109796658616e-02   +2.046069746284736e-01   -8.270309402011668e-02   -2.917358224037600e-01   +6.705345338279309e-02   -4.653956754853575e-02; +1.112959475395496e-02   +2.099188304293328e-01   +1.549599968405013e-01   -2.470698663463554e-02   +2.841217758338115e-01   +1.840158797602036e-01   -2.258647376435126e-01   +7.589767266751003e-02   +2.887938477208905e-02   +1.993002408739308e-01   -2.008271713326405e-01   -1.716093588225316e-01; +2.506113656812001e-01   +7.718803504004020e-02   -2.050514258759927e-01   -1.201530835013992e-01   -3.289512667427869e-01   +1.813150306728337e-01   +1.357356193088325e-01   +2.537524440766065e-01   +2.972872048027469e-01   -2.068556858257087e-01   -4.028284110068935e-01   -2.618400711903728e-01; -1.537236307051921e-01   -2.666284353613567e-01   -1.023018818668334e-01   -2.962689521311820e-01   +9.181086681226655e-02   +1.538776055153860e-01   -1.641819232723393e-01   +3.073884388447768e-01   +1.606495330142150e-01   +1.639747226301349e-01   -1.087348256845450e-01   +3.695969765948833e-01; -9.777620972725252e-02   +1.241806861496305e-01   +1.212189593034790e-01   +1.583349353683194e-01   -1.472290332737736e-01   -1.366085745722904e-02   +4.863269398793002e-02   +1.973067558794003e-01   +2.276004495721177e-01   +2.612021613913884e-01   -4.317401002569806e-01   -3.298379768854262e-01];
L3E_L3I_iGABA_netcon = [+5.355004990216843e-01   -3.224195522156573e-01   +4.636740881365270e-02   +8.223000386603026e-02   +8.695527160392832e-03   -1.516770992937668e-01   +3.103796955637044e-01   +3.772835521840545e-01   -9.698912671900606e-02   +1.199317759439560e-01   +2.324357253092625e-01   +5.093789545075655e-02; -1.266347876756745e-01   +2.235622758463975e-01   +4.327830464684982e-01   +1.580003376507623e-01   +1.218430222560002e-01   -1.506439982626204e-01   +1.886008587489259e-01   -2.396936569664015e-01   +8.906654593360240e-02   +3.948365239533524e-01   +2.084619951923736e-01   +9.798586907674456e-02; -1.453841362979762e-01   +3.886652599843474e-01   +2.663141333830918e-01   +1.006272461555818e-02   +1.468215011727411e-01   +2.057718152102424e-01   -1.264711606531516e-01   +5.964327382799646e-02   -1.762121567986236e-01   +3.145830064100398e-02   +1.361622664990511e-01   -2.146590391095243e-02; -3.113940822151779e-01   -1.551883674450541e-01   +4.734645359986192e-01   +3.291821219330685e-01   -1.833927460509767e-01   +1.032324457752122e-01   -1.520257070324088e-01   -2.104931290853645e-01   -3.773212506933831e-01   -1.047367004819516e-01   +1.509417725365335e-02   -9.163328646088040e-02; -4.234977740608696e-01   -2.678974780886734e-01   +4.763265419309900e-01   -2.129365696816259e-01   +3.531394745193990e-01   -1.623497237545679e-01   -1.345156672029661e-01   +1.149187192276720e-01   -2.132915690228217e-01   -1.314593892728395e-01   -2.448835583511391e-01   +6.729437434430396e-02; +2.107816695630237e-01   -2.799648806865209e-01   +2.010914000623645e-01   +1.900936293760773e-01   -3.273588718011910e-01   +2.537264421705130e-01   +1.878828935807266e-01   +6.783162876764198e-02   +7.353881697849442e-02   -2.754700814375421e-02   -1.069843030072167e-01   -5.601762497676580e-02; -7.418964996756987e-02   -2.202328072464858e-01   +2.553570462807362e-01   -1.276847480749978e-01   +1.575462288422968e-01   +1.850723940169737e-01   +1.464696577771708e-01   +2.423676316771765e-01   +3.968711047409547e-01   +1.751432127697721e-02   -3.120263973170704e-01   +1.877015352131985e-01; -4.390884353616586e-01   -2.542271118800165e-01   +2.726277330319086e-01   +5.581269033065946e-02   +3.074178034824452e-01   -7.753705142431201e-02   -1.604208764638249e-01   +3.818137244854813e-01   -3.291378125597019e-01   +1.830331999180010e-01   -3.439411520331424e-01   +4.298394978202389e-01; -3.417348289741271e-01   +2.252922659584584e-01   +7.388936487896100e-02   +1.638600496045311e-01   -4.583971107907397e-03   -4.907471940508475e-02   +2.582863560525038e-01   +3.578569786165803e-01   +2.597262756831539e-01   +5.074897814380606e-01   -3.106881879679326e-01   -3.752857385598202e-01; +1.709466283112687e-01   -1.130906427737431e-01   -1.325002866735783e-01   +1.502592319305543e-01   +2.783053253553160e-01   +3.278173547535485e-01   -3.140407970731513e-02   -2.835287919061615e-01   -1.274528899137375e-01   +3.479952926931990e-02   +3.311500265176737e-01   +3.565590352453954e-02; -2.769147937836178e-01   +7.263457984805492e-02   -1.002654987839830e-01   +3.906483816310561e-01   +4.474248314682642e-01   -7.836481362089702e-02   +5.302824329528282e-01   +1.702995573023511e-01   -3.659677709859873e-01   +1.504819562078653e-01   -4.185666899147029e-01   +2.316846105828611e-01; +1.406993532150414e-01   -3.909441170793984e-01   +1.797873797331442e-01   -3.976129168435462e-01   -2.749955318243091e-01   +2.676465448843730e-01   -7.065511817541895e-02   -3.424275470786642e-01   -4.766141305896398e-01   -1.349842125565189e-01   +1.238780649303026e-01   -1.883096246671644e-01];
L2E_Input1_iAMPA_netcon = [-4.265884119944051e-01   -2.227697003829455e-01   -3.982258241072431e-01   -3.090791387382094e-01   +3.501460275720619e-01   -2.459384956754737e-02   +1.172458446606117e-01   +4.536773807855161e-01];
L2I_Input2_iAMPA_netcon = [-4.409650864574707e-02   -1.983484023996275e-01   +1.332153794681479e-01   -1.642296347929498e-01   +2.070147169485643e-01   -2.258612641649382e-01   -1.212154284127442e-01   -3.646478133747568e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.03*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.15*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.15*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.03*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.15*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.15*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
