function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+8.935650040566307e-03   +4.347052721354084e-02   +6.647669414264606e-02   +5.138772376105666e-02   +4.890084112944751e-02   +8.582359027114494e-02   +3.576015927935990e-02   +1.108885960481798e-02   +2.023548404705412e-02   +3.886696247589852e-02   +5.154081974648454e-02   +2.184609104736000e-02   +3.556587432797955e-02   +5.996686021668109e-02   +3.731073788431961e-02   +1.709376316191145e-03; +3.082488956449457e-02   +2.643458128495423e-03   +4.165644702156496e-02   +4.848821356496169e-02   +2.096097390455918e-02   +2.673874697912398e-02   +7.781919028928948e-02   +8.327074782509461e-02   +5.512836050136902e-02   +2.099731589008744e-02   +7.844647816748988e-02   +1.612141052992620e-02   +1.518336698389170e-02   -7.907264201822174e-03   +4.392451825421287e-02   -5.325989230402150e-04; +5.300870968948178e-02   +5.405376625530098e-02   +6.691732700844807e-02   +4.292803360240673e-02   +1.017345591882612e-02   +7.430400063956889e-02   +6.616614384991974e-02   +3.458926959415006e-02   +3.336841483840179e-02   +2.800053169870865e-02   +3.550689849917632e-02   +1.700827500599915e-02   +2.403695155062289e-03   +1.341300965210495e-02   +6.823816944455081e-02   +4.682697075124987e-02; +2.752260778574275e-03   +5.076012128658476e-03   +3.354051871119142e-02   +5.123466267255306e-02   +1.871172943783879e-02   +5.816540842061281e-02   +3.645352372034552e-02   +8.032826346937211e-02   +3.099796503209817e-02   +2.299670979945175e-02   +6.631252130678242e-02   +7.559522947959847e-02   +1.703240727395969e-02   +7.115140411085319e-02   +1.948793404476597e-02   +2.386046525937630e-02; +4.314372303536197e-02   +4.989259478781106e-02   +5.460138293288749e-02   +5.573423068910069e-02   +3.221708581347884e-02   +7.108047567267463e-02   +4.104312970755077e-02   +2.138051754348681e-02   +4.231628065468426e-02   +6.843271294453390e-02   +2.740063511077304e-02   +5.755386213588832e-02   +1.570032604430264e-02   +2.268110401535518e-02   +7.907804768636818e-02   +1.483590170917500e-02; +3.671528366975497e-02   +4.187983513721788e-03   +6.555399604896736e-02   +1.520600687544980e-02   +4.698350337033767e-02   +2.919992835044968e-02   +2.890223840654463e-02   +1.729501953495337e-02   +3.168730345195910e-02   +4.251461169172207e-02   +5.902124412639571e-02   +1.739503808286061e-02   +4.089135009863448e-02   +4.336897162983307e-02   +3.917639094282642e-02   +5.778246330532123e-02; +2.394096325081263e-02   +5.733776613974793e-02   +7.572579793403422e-02   +4.763429138837082e-02   +3.608242061729353e-02   +4.628745307269391e-02   +2.914685899938416e-02   +7.242881832004046e-02   +7.922468604042525e-02   +2.890295046319183e-02   +1.104320922158058e-02   +1.741323529900737e-02   +3.500657367960177e-02   +7.321795752014730e-02   +6.765106559313150e-03   +1.665769330316863e-02; +4.750877307497665e-02   +2.691841729203017e-02   +5.696570937809403e-02   +5.241688178959434e-02   +5.077315867423231e-02   +9.404813332525290e-03   +9.605521579723526e-04   +4.316422641918043e-02   +6.215343066898884e-02   +5.251427116419125e-02   +1.883318336234276e-02   +6.081384457254001e-02   +1.566164114662930e-02   +1.144692590574366e-02   +4.991368062800591e-02   +4.694072170087730e-02; +2.557182855764380e-03   +5.431153145306604e-02   +4.818790047505533e-02   +5.340965655699070e-02   +4.038966492606709e-03   +7.173263540371064e-02   +2.978066692836708e-02   +3.804711383189043e-02   +4.473746911784204e-02   +3.810559080779213e-02   +1.375965921594576e-02   +7.275356757284547e-02   -4.544136983003241e-03   +6.025541401931356e-02   +2.703687503543277e-02   +2.994480367506125e-02; +4.981577344955841e-02   +1.516633767654981e-02   +7.386415264676828e-02   +6.117637772070091e-02   +4.950338620097230e-02   +1.708717005426071e-02   +1.216579472239658e-02   +4.405921398515028e-03   +6.025024004756735e-02   +3.397724105499220e-02   +6.536912404677273e-03   +4.862175394503481e-02   +7.562927726859640e-02   +1.848137416865133e-02   +6.872559389508383e-02   +5.237593106365366e-02; +3.513787522904345e-02   +4.153906018448234e-02   +3.902678234000265e-02   +6.411676601637083e-02   +6.842882485591566e-02   +1.322478926638503e-02   +5.135541129016309e-02   +4.670760406721276e-02   +1.729004698573828e-02   +1.787882150411381e-02   +5.447933058581222e-02   +7.700751004906352e-02   +1.007142788930722e-02   +5.006617857554756e-02   +6.004037330846598e-02   +1.710657965546751e-02; +4.263850535755309e-02   +2.205551160923567e-02   +4.561053963698012e-03   -1.351273844325556e-03   +7.075553635997045e-02   +7.459531656005716e-02   +7.364497235253348e-03   +5.477215265421903e-02   +5.643903229916716e-02   +2.722037086123637e-02   +7.638391971139235e-03   -2.046724802607034e-03   +7.548553489876511e-02   +3.758717939175483e-03   +4.057517045477561e-02   +3.808044762477320e-02; +5.125360158951679e-02   +5.894270668112725e-02   +6.719249922017360e-02   +1.427900662195064e-02   +5.586498098018947e-02   +5.481239849295973e-02   +5.964741643281864e-02   +5.657857201085584e-02   +6.355688268358586e-02   +3.276893894720797e-02   +3.164300673149368e-02   +7.691085657201797e-02   +6.238484381297157e-02   +5.348512908989894e-02   +3.691178895641608e-02   +7.217679826943248e-02; +6.655790831280528e-02   +5.259895802773538e-02   +2.320731247233601e-02   +4.350309110293550e-02   +7.108021150730171e-03   +1.884933580489657e-02   +1.112926222301946e-02   +1.644315766138920e-02   +2.754930645014702e-02   +5.858344624107594e-02   +1.224717392476355e-02   +7.190329374302826e-02   +5.018362189363432e-02   +5.519116942274435e-02   +3.087790102325575e-02   +2.745633921499012e-02; +3.852086643652836e-03   +4.079354747564926e-02   +6.909562549062284e-02   +4.644852365714339e-02   +2.559288130756902e-02   +1.410749736761469e-02   +1.986820487703171e-02   +3.556253548085873e-02   +2.287505399574553e-02   +7.613904570845492e-02   +2.650522604670128e-02   +7.576646837351339e-03   +6.877032923513398e-03   +6.240933432708204e-02   +4.976994439936808e-03   +5.511588163857453e-02; +6.456216393246050e-02   +2.111522488916068e-02   +1.813937230207052e-02   +7.662164578161308e-02   +6.295346599391407e-03   +1.063053551699741e-02   +6.746447342317470e-02   +5.540677682669666e-03   +4.135995377175587e-02   +6.274145756765773e-02   +5.825860707604796e-02   +1.286732078763049e-02   +6.054327884269656e-02   +6.060662482924160e-02   +8.054587205534589e-02   +7.280001206449378e-02];
L1E_L1I_iGABA_netcon = [+3.848462824812408e-02   +4.722428402287532e-02   +2.520636140411246e-03   +2.293552516162865e-02   +6.528072850168735e-02   +3.123081765757628e-02   +3.100707146414976e-02   +1.323704889311180e-02   +1.188255635315614e-02   +2.408208636782320e-02   +2.701722551908971e-02   +4.121092534273039e-02   +2.251794100078128e-02   +7.388178489951842e-02   +1.620878777058518e-02   +3.702437055463713e-02; +6.046865022457396e-03   +7.126318646256129e-02   +4.063336960292107e-02   +6.590228760521638e-02   +3.628558973929540e-02   +3.901558566198944e-02   +1.624234482345336e-02   +3.953659415617042e-02   +4.178177168501533e-02   +1.484065949135245e-02   +1.666459794231939e-02   +5.364334207143272e-02   +3.084614670094032e-02   +5.486030574521167e-02   +4.382774672456893e-02   +6.063496684870200e-02; +4.885804375460357e-02   +7.880715768388642e-02   +7.086807744358732e-02   +5.593474433203231e-02   +1.075533911351058e-02   +3.811189619819103e-02   +5.489692366864747e-02   +7.304725997076267e-02   +6.980596745722921e-02   +8.483134281378485e-02   +5.566143218374237e-02   +4.178798098916982e-02   +7.946342810067142e-02   +6.311535962425328e-02   +3.818822033397501e-02   +4.955811544596619e-02; -2.083679680172151e-03   +1.186367924020227e-02   +7.454384968539514e-02   +9.118676448652760e-03   +8.534191164980760e-03   +5.639986476465001e-02   +6.390260699324431e-02   +4.049638040124643e-02   +3.805595372387356e-02   +7.634216787405135e-02   +4.858697656868130e-02   +5.987361172429147e-03   +3.075496773774324e-02   +1.957022240223022e-02   +7.181792548788556e-03   +7.972939576290453e-02; +5.275655641831827e-03   +7.410389778302734e-02   +3.714836398426067e-02   +8.625160486836182e-03   +3.682533708212403e-02   +6.403723385810144e-02   +5.649725407336441e-02   +3.177123149550248e-02   +4.487531168844939e-03   +1.009804523674926e-02   +5.381627695526570e-02   +9.389245433965420e-03   +6.161023729537753e-02   +3.482254381040611e-02   +4.719398197181907e-02   +3.997152042521920e-02; +7.075765100431732e-02   +6.921539042064430e-02   +4.071424283692192e-03   +5.880610997821951e-02   +2.704351174089008e-02   -8.364010335346415e-03   +5.576573297878903e-02   +2.052841932551997e-02   +6.868781565483603e-02   +1.742939436310996e-02   +7.082977623188980e-02   +8.669852258793152e-03   +3.141940480596995e-02   +5.637527817484225e-03   +4.998489155036478e-02   +1.399490296725166e-02; +4.254430682605447e-02   +1.577759647238940e-02   +1.534500571462339e-02   +1.685755821007058e-02   +1.315273116061274e-02   +3.104410011011526e-02   +2.304084850507288e-02   +4.447072166172267e-02   +7.061958347611225e-02   +1.495020530350495e-02   +6.574623353092930e-02   +8.075145169464415e-02   +7.963900527381527e-02   +4.257753087533490e-02   +3.819934792607188e-02   +1.976552811314394e-02; +2.285635651578271e-02   +1.405577972172639e-02   +3.428372521786776e-03   +1.459365253504710e-02   +5.492262988122674e-02   +4.481651521421123e-02   +3.623292882695527e-02   +4.523561023986064e-02   +1.976653567779971e-02   +3.076441706304224e-02   +6.603616831322272e-02   +8.399516390615640e-02   +3.913067281414891e-02   +3.841496416938121e-02   +8.589348549087550e-03   +5.202832081079921e-02; +2.433612789954106e-02   +4.836614467710286e-02   +2.618024443409092e-02   -3.429557779046086e-03   +1.724049574363538e-02   +5.266345504136529e-02   +6.582585452853075e-02   +7.331013336570931e-02   +3.015680498018402e-02   +1.075244438866228e-02   +5.634080192926746e-02   +3.249854206198750e-02   +7.725997987213135e-02   +7.752209589967349e-02   +4.268930324635762e-02   +1.140943923667707e-02; +8.028417827685982e-03   +3.331716589592058e-02   +1.847211495622927e-02   +4.411193551878582e-02   +2.844047133554381e-02   +5.969819879006708e-02   +1.940073145400005e-02   +2.429605867157620e-02   +7.828238354552053e-02   +6.591370814136804e-02   +1.468827206406633e-02   +4.226444548181610e-02   +6.072703400999883e-02   +1.835289626602659e-02   +5.679531553554681e-02   +1.950147001054590e-02; +6.810921802867496e-02   +8.455653786091697e-03   +2.269981098344709e-02   +3.723993015881703e-02   +4.678744317631003e-02   +5.590242202653192e-02   +3.993613550432008e-02   +8.115543422272699e-02   +2.347570828939293e-02   +2.883951522030730e-02   +4.796147189994412e-02   +4.017606087440768e-02   +1.778479462953701e-02   +7.897861447527844e-02   +6.568509387660920e-02   +3.019932757719927e-02; +1.557973892720965e-02   +7.778105155804776e-02   +4.508604200079232e-02   +7.535999610702916e-02   +7.736814804758564e-02   +5.527947739100218e-02   +3.545130245129948e-02   +1.168995302793689e-02   +5.384626442540991e-02   +4.371258999362031e-02   +2.229485590497157e-02   +6.137629817396097e-02   +5.823695883938140e-02   +4.110167838705602e-02   +6.113738857348536e-02   +1.583343168898018e-02; +5.621576875501184e-02   +8.823113528148217e-03   +4.694095484976789e-02   +8.684871299312441e-03   +4.288955377333397e-02   +4.537823028472170e-02   +5.088512302460960e-02   +1.596520945502543e-02   +5.958375794383283e-02   +6.556368434934867e-02   +1.882004438657632e-02   +6.692237508923682e-02   +7.579011804730457e-02   +5.157756188741676e-02   +2.635142694335341e-02   +8.992126222893568e-03; +2.191290433260145e-02   +2.315929159399640e-02   +1.845230808045159e-02   +1.068018482038663e-02   +1.549174745584949e-02   +7.060044807524175e-02   +7.484941397641191e-02   +6.169907805234355e-02   +3.975068049164372e-02   +4.811976909133220e-02   +7.598517305166903e-02   +5.674494015307401e-02   +5.233813929263367e-02   +6.280278096081299e-02   +5.290121613410558e-02   +5.727156704999307e-02; +3.624256552899421e-02   +2.048264981631480e-02   +3.618468807023749e-02   +6.478464028494761e-02   +4.704489498127090e-02   +4.119846480395776e-02   +1.049336140212886e-02   +2.812389928831013e-02   +9.687454860127197e-03   +4.082337625449808e-02   +2.249577257788267e-02   +3.208096550936076e-02   +2.306887157227068e-02   +1.606542537571323e-02   +1.019676983012300e-02   +2.067448685861435e-02; +3.365017935618203e-02   +5.203424583669007e-03   +1.538746767306133e-02   +7.850761886217675e-02   +7.859004631091131e-02   +6.503072013311420e-03   +1.841871117303659e-02   +6.879730266379411e-02   +6.971942107075360e-02   +9.146493797492546e-03   +6.634087636353692e-03   +4.729909172574034e-02   +5.604260211289745e-02   +4.389634103532246e-02   +3.401702664081057e-02   +3.457166955617806e-02];
L2I_L1I_iGABA_netcon = [+7.915058955170590e-02   +3.324922335949052e-02   +2.849829498102364e-02   +6.624339987808857e-02   +8.123761513859508e-02   +7.406005924880482e-02   +3.126382145379614e-02   +6.390875916345644e-02; +6.712316583497104e-02   +6.760231806225150e-02   +5.359941414927478e-02   +2.404465904085191e-02   +3.270231233170919e-02   +5.338106555081491e-02   +7.035055812109926e-02   +1.991424241699031e-02; +1.879749099204584e-02   +1.963714715762916e-02   +1.704853127644927e-02   +4.143287623386269e-03   +6.360844423862888e-02   +7.431248365334095e-02   +7.676431052127742e-03   +5.027814866583213e-02; +2.717483851459846e-02   +6.156717941763792e-02   +5.658832541267053e-02   +4.715581481796335e-02   +4.858529665120176e-02   +4.607327249597781e-02   +3.663138600104087e-02   +6.247338244701761e-02; +2.409088631234850e-02   +9.693130296830305e-03   +5.066828319455060e-02   +5.151644901824088e-02   +3.045339282578152e-02   +5.987202768601419e-02   +3.877524350371245e-02   +3.999999226285290e-02; +5.951609548076574e-02   +5.099477201554153e-02   +7.352368490431332e-02   +4.065274274701068e-02   +2.140176652698097e-02   +5.727205833202046e-02   +6.496632065340474e-03   +5.665837606971507e-02; +4.551151009975116e-03   +3.598785598234533e-02   +3.201410546240987e-02   +2.450028911854701e-02   +6.121257478335226e-02   +2.590735329313924e-02   +1.960277962503155e-02   +5.448936126436686e-02; +4.741620098452635e-02   +2.523691060190075e-02   +6.297175193594452e-02   +3.774113604484000e-02   +2.413167933182787e-02   +5.581050464458907e-02   +3.366759382811397e-02   +2.327935535647524e-02; +3.925434551672037e-02   +5.560181818323104e-02   +1.905806962366399e-02   +1.652833480202048e-02   +2.372879147923668e-02   +1.241289607916369e-02   +3.283742559355359e-02   +7.790902719089067e-02; +4.338785421739592e-02   +5.457263407803369e-02   +1.382151280980435e-02   +3.799131956963961e-02   +7.147001084077872e-03   +5.830579130894993e-02   +7.328460527996675e-02   +5.630612260617478e-02; +3.681333997122739e-02   +6.608331696130619e-02   +6.726557120157618e-02   +2.495027074672621e-02   +5.510793687810723e-02   +7.128699420054160e-02   +1.130576790289684e-02   +2.459062529018890e-02; +6.737301606516291e-02   +4.368268791309927e-02   +5.184104798214384e-02   +3.497416865476752e-02   +7.105540628913683e-02   +1.441188461554450e-02   +4.792679373934198e-02   +2.683121536899056e-02; +3.012720734566285e-02   +8.020148479340349e-02   +6.739550461100033e-02   +6.502658449825926e-03   +4.367372855542995e-02   +3.244738255514312e-02   +2.238962831623271e-02   +4.973527899301290e-02; +6.185808785164604e-02   +2.032509210918606e-02   +7.831102833560695e-02   +3.878375638759821e-02   +6.776375254298886e-02   +1.700767614608164e-02   +7.229245557003278e-02   +2.102481446575454e-02; +7.788470769665193e-02   +1.783898578082660e-02   +2.518664785150918e-02   +7.801285019056213e-02   +5.120749133071354e-02   +8.804589908578695e-03   +2.919345926363579e-02   +5.841967914888353e-02; +1.440838722488157e-02   +5.474111159664564e-02   +5.059672937394308e-02   +5.107366002747442e-02   +7.168535765195921e-02   +9.282640576682547e-03   +7.593261597735301e-02   +2.328251088810706e-02];
L1I_L2I_iGABA_netcon = [+4.770475100147896e-02   +5.698651426256079e-02   +1.308725788030581e-02   +5.766442354328707e-03   +4.445876048979167e-02   +2.501272723061894e-02   +8.206231316905989e-02   +4.994770213483200e-02   +3.530661830897579e-02   +6.198336202008288e-02   +1.107922800034890e-02   +2.292175956368243e-02   +1.099749369362574e-02   -3.252568527553068e-03   +1.458882362744084e-02   +6.533687367169165e-02; +6.125358899313171e-02   +5.252782365705547e-02   +3.186265925038970e-02   +4.043915923980964e-02   +7.732880525772592e-02   +4.060103137318397e-02   +4.699231673878872e-02   +7.448059871033641e-02   +4.003635614170392e-02   +7.937036226009583e-02   +5.604157745357354e-02   +2.597640837900404e-02   +4.270198449214417e-02   +3.408432320141052e-03   +4.273937992966071e-03   +7.099846165700957e-02; +7.001411661713403e-02   +4.649561976510978e-02   +1.484968230045445e-02   +6.585878979505098e-02   +2.733129128993576e-02   +6.813753356813923e-02   +5.359868665317237e-02   +5.227882904773083e-02   +2.865443603366328e-02   +3.584721281800294e-02   +4.434252777748732e-02   +3.284337327023227e-02   +2.953089727342841e-02   +9.413537140318578e-03   +4.870485913714762e-02   +1.470544053349353e-02; +3.100074334181761e-02   +4.009477330138879e-03   +4.885107954915083e-02   +5.992827413890867e-02   +1.323491945886619e-02   +2.944617595470550e-03   +2.839597268920316e-02   +1.938880958991928e-02   +6.419520079494907e-03   +5.097900521693347e-02   +4.054537381069910e-02   +3.282568894441398e-02   +2.201494261364129e-02   +6.467895214548392e-03   +6.324106248909542e-02   +3.869038775825676e-02; +4.603690622289180e-03   +6.947570112002487e-02   +5.510296074314276e-02   +5.679125419314661e-02   +5.197714701081245e-02   +4.236376338630686e-02   +4.468589425645978e-02   +7.195137465439484e-02   +4.846336565312277e-02   +6.449879834357942e-03   +2.001016624853773e-02   -3.597094768760651e-03   +2.571605698944380e-02   +6.913387620394404e-02   +1.097313462892511e-02   +4.631889643434497e-02; +4.867459256827982e-02   +5.315902622522857e-02   +5.744595789393676e-03   +7.302186630531331e-02   +4.670312151388863e-02   +7.634440496967591e-02   +5.738531162269957e-02   +5.857080137469028e-02   +4.512204101279834e-02   +4.538860201741849e-02   +7.379860713034346e-02   +6.461252777082975e-02   +1.074082416362779e-02   +7.780800888511555e-02   +5.412440032559109e-02   +7.595547700767452e-02; +6.689591705412792e-02   +8.633960065520937e-03   +6.678520250592353e-02   +8.114036468651274e-02   +2.953408696478393e-02   +8.423110760098067e-02   +4.324336124610231e-02   +3.373135475038729e-02   -2.695550787326896e-03   +4.220130805982456e-02   +2.888868873361355e-02   +2.532337271904237e-02   +6.213059836287849e-02   +2.923047122948380e-02   +6.832466940344821e-02   +4.682835047517554e-02; +5.824961738883726e-02   +5.696406046658001e-03   +6.529282348671780e-02   +5.509319832518349e-02   +5.523192427228564e-03   +5.650402296543140e-02   +4.989088515914036e-02   +6.254684547954383e-02   +3.192986606075501e-02   +6.705266010174127e-02   +1.697781421721711e-02   +4.017948199438538e-02   +3.501744000984598e-02   +2.333534913801376e-03   +6.981795561211379e-02   -4.942942416853852e-04];
L2E_L1E_iAMPA_netcon = [+6.515658765892858e-02   +2.541153518154479e-02   +6.578324217261797e-03   +8.418372822549502e-02   -7.615396824137604e-04   +3.301854038568041e-02   +5.407782534022066e-02   +7.304326128541195e-03; +7.331135256839169e-02   +6.963682311341952e-02   +4.947686686418259e-02   +2.803820779421079e-02   +3.905978016390953e-02   +1.751101220973948e-02   +7.660115043224824e-02   +3.751275345860731e-02; +5.892017748851685e-03   +1.349990357270568e-02   +2.105566880207504e-02   +1.401233927897052e-02   +4.980739884002945e-02   +6.692000852396091e-02   +3.099097375285972e-02   +2.650594114761726e-02; +2.439439528049269e-02   +6.075612434660670e-02   +1.634335859484025e-02   +5.688364255859772e-02   +6.711296324596329e-02   +2.077439230367975e-02   +7.350533167859283e-02   +7.554500067341401e-02; +1.706509464715466e-02   +8.292587219973556e-02   +5.946986382333578e-03   -1.093458054771148e-03   +7.573033357146002e-02   +7.811258438113361e-02   +5.172485790304146e-02   +2.934749074450197e-02; +5.964318140924369e-02   +4.262225908964674e-02   +7.051352237499914e-02   +6.531848719583937e-02   +4.709932806823963e-02   +1.262922028608334e-02   +5.621257853894527e-02   +4.706944747480100e-02; +1.053653259364951e-02   +2.160254764129338e-02   +1.751125447085033e-02   +3.480020251815229e-02   +6.900313992080641e-02   +3.255385761252428e-02   +1.471039437415995e-02   +2.544352454408425e-02; +7.555712004867300e-03   +1.404152301836154e-02   +4.268141748385260e-02   +5.089680097233528e-02   +2.953853043390826e-02   +6.808589970212547e-02   +7.229286326420588e-02   +6.987131618884201e-02; +3.151979487112680e-02   +7.034283471004668e-02   -3.383703703043458e-03   +2.577297808958744e-02   +1.522182693382712e-02   +8.224632365451923e-02   +4.507415358762074e-02   +4.684904782917899e-03; +2.079860158090337e-02   +1.741452199068665e-02   +6.860212957461821e-02   +2.795254491514650e-02   +6.835758026361340e-02   +6.839118336727863e-03   +1.060628633540879e-02   +7.495659882485771e-02; +4.222919311878847e-02   +3.498447008591789e-02   +8.118792747263143e-03   +5.156423977922600e-02   +3.062120771055647e-02   +2.579501250700220e-02   +4.827469927225276e-02   +6.815007049042571e-02; +2.093551514951430e-02   +3.775995238136996e-02   +6.472134446188513e-02   +5.477539010683333e-02   +5.372243821989155e-02   +1.436658371881644e-02   +7.660777733814042e-02   +1.765843606190271e-02; +4.848460960386006e-02   +6.432091638533692e-02   +1.561326643706522e-02   +4.934831122518563e-03   +7.380542244315033e-02   +5.914696008419947e-02   +3.493307101968172e-02   +6.688321758254522e-02; +3.557588024994898e-02   +3.549237878235842e-03   +6.702908795748669e-03   +6.224611070764098e-02   +7.899041478624334e-03   +2.198119528051890e-02   +5.155097123731529e-03   +6.042923478969427e-02; +2.859949708846440e-02   +1.293166287371156e-02   +6.082530033311542e-03   +6.386558190306980e-02   +8.137017971461198e-03   +6.760779264393427e-03   +3.481042126435093e-02   +1.582437456110114e-02; +1.316198525176039e-02   +3.526402477734921e-02   +7.444177733388235e-03   +4.216486135871469e-02   +1.634202999665278e-02   +4.872237423059260e-02   +3.253573438259403e-03   +6.638006500508060e-02];
L1E_L2E_iAMPA_netcon = [+2.454381442676574e-02   +1.319459314924106e-02   +7.559365582228149e-02   +7.564953727980629e-02   +2.517496417136417e-02   +6.960721908976515e-02   +4.025760984307684e-02   +7.575203436024218e-02   +1.611995307999922e-02   +5.428257103644247e-02   +4.990945105838809e-02   +5.690086517580013e-02   +3.119878048584894e-02   +5.097044480055034e-02   +4.328797849799656e-02   +3.491225109978191e-02; +3.247395496001069e-02   +5.091847519795179e-02   +1.318874429889970e-02   +1.040109046408367e-02   +7.034795402105082e-03   +5.318020455053683e-02   +5.662607763763908e-03   +2.693084807508429e-02   +2.416588830852612e-02   +2.191974646435653e-02   +1.671176386880843e-02   +7.779149337695543e-02   +1.131896278190114e-02   +1.480904575924809e-02   +4.596264266150438e-02   +2.550094582743864e-02; +2.899621511360066e-02   +4.708966004763490e-02   +7.169997895674900e-02   +7.201237026943413e-02   +7.295846410376389e-02   +5.233295998556522e-03   +2.200627619037004e-02   -8.196513855973676e-04   +3.628498543969025e-02   +5.106309074646221e-02   +2.364590216446493e-02   -5.616336619882931e-04   +5.495281786306134e-02   +4.855015845970007e-02   +7.153917136657641e-02   +7.830201834143177e-03; +5.867869577213457e-02   +4.179498653464776e-03   +1.483665188307823e-02   +1.221054374331085e-02   +5.851894635980028e-02   +2.288287262930889e-02   +7.861197233898534e-02   +7.352782689136403e-02   +6.391290759829911e-02   +6.129688509133636e-02   +3.538972991281505e-02   +4.004769051229529e-02   +7.995730028520603e-02   +2.673925040238652e-02   +7.035677141498124e-02   +7.101705032669456e-02; +1.461242047450910e-02   +7.959067291784608e-02   +6.758474056065973e-02   +3.373754260802975e-03   +1.848432801535492e-02   +6.167398347154885e-02   +7.063120930331869e-02   +1.487455921491643e-02   +4.123892970596819e-02   +3.258340168558972e-02   +4.191497801606345e-02   +6.139155985184472e-02   +2.462196343491918e-02   +4.507962393603906e-02   +7.664025759987955e-02   +4.934415781111545e-03; +2.343866130344978e-03   +6.901627829795230e-02   +2.710692759679889e-02   +7.039928950698143e-02   +7.702043296536035e-02   +6.690894959290283e-02   +3.615636821054270e-02   +6.789252989951934e-02   +2.505154497005576e-02   +3.714169345268184e-02   +6.674031246589465e-02   +7.616483560021557e-02   +6.395052168705742e-02   +4.605228609960447e-02   +1.297320336859943e-02   +4.300253682802595e-02; +2.600209702739836e-02   +1.229643690457161e-02   +5.173246911529448e-02   +5.334747429695902e-03   +3.109698242265593e-02   +3.639195954725261e-02   +6.225172396018602e-02   +4.463386965000490e-02   +4.010628153593736e-02   +6.507078984404116e-02   +5.487095456614655e-02   +9.217624785906996e-03   +3.545592640159843e-02   +4.781328712880965e-02   +1.654848131968913e-02   +2.056657778321613e-02; +1.660744298298073e-03   +4.216556711823984e-02   +3.699174447680090e-02   +3.159701021215981e-02   +5.615466664176504e-02   +8.096530080597611e-02   +7.274395071070083e-02   +4.765891275108605e-02   +6.936331296051709e-02   +3.352213485392653e-02   +3.067546875035401e-02   +8.264382423550198e-02   +5.352096353206309e-02   +6.323561328021500e-02   +2.031391063632209e-02   +1.552172093203709e-02];
L2I_L2E_iAMPA_netcon = [+5.618817393873800e-02   +2.707841679131161e-02   +6.969316197999749e-02   +3.476162490104544e-02   +6.315431556888250e-02   +2.524209395681852e-03   -2.638574326586230e-03   +6.896182872912253e-02; +1.217805126178500e-02   +1.499329341925751e-02   +1.604354375000090e-02   +6.207508297173308e-02   +6.108545422741050e-02   +3.037768602335090e-02   +5.778272358321974e-02   +4.023303163958904e-02; +6.761952773114438e-02   +6.443579585297758e-02   +6.998719702132568e-02   +5.149778254760957e-02   +3.757199727847757e-02   +4.658890927724699e-02   +3.648838620106174e-02   +5.628280272488489e-02; +3.181968868574089e-02   +1.787291731685199e-02   +7.345555802103393e-02   +3.555619897084610e-02   +8.254803301234376e-02   +1.301130056673145e-02   +3.473857466536667e-02   +6.764032086681296e-02; +4.686899804597672e-02   +7.481947307022928e-02   +4.412778519116880e-02   +4.682314247229079e-02   +7.626740655407938e-02   +6.013506817981174e-02   +3.470409863898278e-02   +6.281835050685300e-02; +4.675439867511980e-02   +3.349828623579657e-03   +7.256711509101677e-02   +5.973812296309378e-02   +4.472840009220806e-02   +1.838718515040462e-02   +9.934279380791302e-03   +5.639779946113837e-02; +8.160404864989580e-02   +4.016695037843192e-02   +5.176782589170701e-03   -3.040931793873715e-03   +1.372257815403010e-02   +1.993046893862317e-02   +1.342823749465070e-02   +1.682861943290889e-02; +7.210199854659240e-02   +2.048517324990436e-02   +4.289462541416257e-02   +4.349561921791904e-02   +6.965153631582963e-02   +2.082268470332014e-02   +7.794721344618434e-03   +1.066934311923265e-02];
L2E_L2I_iGABA_netcon = [+7.193474269572084e-02   +1.287043541694050e-02   +1.512217687653889e-02   +9.776580149508463e-03   +5.391034237819578e-02   +3.115062040503839e-02   +6.196053381361481e-02   +7.305295039671257e-02; +2.052154561087760e-02   +3.312925213343217e-02   +1.259746613046121e-02   -1.566583426274452e-03   +8.032450090934797e-02   +5.661748165481194e-02   +6.113409011661557e-02   +2.183619847279632e-03; +5.434547081249792e-02   +2.686706051986373e-02   +4.142566412483244e-02   +7.763060938874709e-03   +2.488086061952825e-02   +5.661774527628044e-03   +7.628849350551882e-02   +6.524423443488322e-02; +6.277303757537780e-02   +3.253575922939898e-03   +1.886581580971173e-02   +6.261187022746971e-02   +7.000376489303763e-02   +5.622165767296285e-02   +3.785979047802000e-02   +5.064726785216832e-02; +1.111155856036941e-02   +7.117085324450274e-02   +1.997143218246533e-03   +6.405879053064385e-02   +2.645575487271185e-02   +2.603688245677244e-02   +2.570233620391963e-03   +1.546169484303530e-02; +5.816460393138657e-02   -2.252586127724488e-03   +3.583304344972876e-02   +6.435395303300590e-02   +7.366676955140233e-02   +2.541133629820412e-02   +7.185985230676893e-02   +6.246922424216191e-02; +1.240040725734835e-02   +8.202045991876972e-02   +2.299853149967825e-02   +2.072665730095578e-03   +6.562153047726457e-02   +3.810948188269777e-02   +4.674164740226746e-02   +4.545916484021711e-02; +6.356732851115907e-02   +2.461224029067763e-02   +4.371039804720354e-02   +1.485501936249812e-02   +3.528280190323407e-02   +6.275578168386048e-02   +7.712922162162542e-02   +5.399800938927085e-02];
L3E_L2E_iAMPA_netcon = [+2.964288939378562e-02   +5.573861006192658e-02   +8.521560009882512e-03   +2.888669117433454e-03   -1.006743764142958e-03   +7.619821713370029e-02   +2.803539889174396e-02   +6.889863316490009e-02   +9.740528029256693e-03   +2.020547897724375e-02   +2.276520453092064e-02   +3.877761354378967e-03; +2.325218640886672e-02   +7.236827854042599e-02   +2.162983967694128e-02   +3.009270252408876e-02   +3.532204884682386e-02   +4.421260896053395e-02   +7.014382144715268e-02   +8.058398409066315e-02   +4.741522893570761e-02   +7.493370982568220e-02   +2.669572547715519e-02   +2.173752612221698e-02; +1.047177702051058e-02   +6.324141754660101e-02   +1.576810704990577e-02   +5.790817289485377e-02   +2.502263513301234e-03   +2.110750628160586e-05   +4.516135922202878e-02   +7.946113817808181e-02   +4.729730356210217e-02   +4.093039941774353e-02   +2.405277767567534e-02   +5.360769584126385e-02; +6.169879617932477e-03   +2.165877259920711e-02   +6.793398715202870e-02   +2.717620930440843e-02   +2.044552649626979e-02   -2.157635902719629e-03   +2.475669374198905e-02   +1.558428954221939e-03   +1.217859893180011e-02   +2.819166770398895e-02   +1.865919485515539e-02   +2.581830022579398e-02; +6.993255577963607e-02   +2.865936953109036e-02   +3.048795593391974e-02   +7.588518084324564e-02   +5.780990801678511e-02   +2.984614291184355e-02   +7.692923310869375e-02   +1.042827200203468e-02   +6.716832447954794e-02   +3.765490970713224e-02   +5.578668629579559e-02   +3.118261580612002e-02; +6.929496838901353e-02   +5.337640995995929e-02   +6.729677253624325e-03   +3.481887141339742e-02   +4.629647457419914e-02   +7.967900534800255e-02   +7.484175215206104e-02   +2.664589525218342e-02   +4.202570237377090e-02   -5.402738513030423e-03   +4.718005924272075e-02   +1.985502099132654e-02; +4.993539489840668e-02   +3.432903789046274e-02   +4.908733001626852e-02   +1.847492607806264e-02   +3.093954104188122e-03   +3.080322495057705e-02   +6.044972170769829e-04   +2.816202685371077e-02   +2.353209761472073e-02   +6.722966395951466e-03   +2.711347794030740e-03   +3.112299148981477e-02; +6.810100232987328e-02   +1.209605403365839e-02   +9.088385739106967e-04   +2.411318634983772e-02   +4.181085147114439e-02   +6.003028360863999e-03   +3.919747130728003e-03   +3.573117586474045e-02   +3.752221047795886e-02   +7.165448012010221e-02   +1.045083058363309e-02   +5.039890417791067e-02];
L3I_L2I_iGABA_netcon = [+8.077004328588919e-02   +4.925645488162602e-02   +4.736456215133461e-02   +3.121551739267480e-02   +7.174495917345182e-02   +3.124711350102749e-02   +9.342872461493965e-03   +3.792934817452045e-03   +7.061999959944214e-02   +3.809835149761370e-02   +5.549080729879766e-03   +6.244258624569987e-02; +7.058826803471262e-02   +7.692862925450435e-02   +6.302884585234803e-02   +1.302787682965467e-02   +3.383829615652567e-02   +6.237879992156626e-02   +2.037768856856702e-03   +1.381843647692225e-02   +4.134819768964882e-02   +5.474990073402033e-02   +5.161456669330169e-03   +5.302878125931523e-02; +7.436907080577005e-03   +6.419941117474084e-02   +7.424435243971562e-02   -3.989028246055403e-04   +5.366863658401288e-02   -1.055971636223530e-03   +5.184637588751989e-02   +7.440172538190036e-02   +5.894481573644784e-02   +2.943789859728648e-03   +5.436280334982051e-02   +8.998396672605814e-03; +8.205347838050847e-02   -4.303538286176805e-03   +2.742170190777300e-03   +5.188329001907484e-02   +6.984590036443195e-02   +4.531226763794899e-02   -3.273120389714209e-03   +5.980973912557430e-03   +7.172376122090741e-02   +6.712615767058364e-02   +7.665019486145352e-02   +4.149230130841419e-02; +1.962890011476264e-02   +8.208106201990500e-02   +3.023065532274752e-02   +3.664531667238091e-02   +4.644376613526176e-02   +7.740429005621800e-02   +3.091520824119542e-02   +1.363692948756001e-02   +7.528458237386301e-02   +4.315471491926759e-02   +1.928281299686101e-02   +1.518014993199336e-02; -1.716543334766227e-03   +5.305939039230254e-02   +1.711982809964140e-02   -6.171729234764992e-04   +1.273344733889953e-02   +4.992250206437111e-02   +5.770526440455121e-02   +1.407714675745743e-02   +2.245090587842525e-03   +6.488689353781343e-02   +6.200719144265347e-02   +5.763070144979669e-03; +4.987232975464013e-02   +7.295251919859759e-02   +4.171813196391363e-02   +5.035244481076469e-02   +4.116417040679141e-02   +1.910079138843710e-02   +5.009768919255403e-02   +2.038753433646294e-03   +7.200464743764781e-02   +2.319180469819317e-02   +3.468219043992584e-02   +5.995350712612299e-02; +3.821221931811514e-02   +1.287343475410810e-02   +2.528366180396228e-02   +4.751298427233009e-02   +3.226608329755922e-02   +1.409782963211598e-02   +1.589647370005370e-02   +2.410998265218981e-02   +4.789094376994259e-02   +7.423704641328999e-02   +2.237778878893388e-02   +2.243659861610527e-02];
L2E_L3E_iAMPA_netcon = [+4.941210412716533e-02   +5.035459172932431e-02   +1.886792852120375e-02   +6.112285880072648e-02   +7.009054877018799e-03   +4.088418258939984e-02   +5.906407217493816e-02   +7.735222434798754e-02; +3.893857770328037e-02   +5.641573045493422e-02   +5.754333661974223e-02   +6.076343147947624e-02   +4.445152940358242e-03   +4.725593825808487e-02   +6.816580676497058e-02   +5.205039624734447e-02; +6.219663676699515e-02   +7.249642273418824e-02   +6.676490251509107e-02   +8.093845334665530e-02   +5.098798531973869e-02   +5.290408892616014e-02   +6.586562341504988e-02   +4.586465949705444e-02; +3.388279194035070e-02   +7.556479139835930e-02   +6.495597543889305e-02   +4.745803963977694e-02   +4.029404400971205e-02   +4.231140007583261e-02   +2.095761164196178e-02   +1.114788797074938e-02; +5.062496517483478e-03   +4.068056616274687e-02   +2.610270887362948e-02   +4.533039433225576e-03   +6.971498891126396e-03   +4.532185270407302e-02   +6.780189290066951e-02   +6.015671625813187e-02; +4.290685289280402e-02   +8.374414615062958e-02   +7.006137014666006e-02   +4.561613170999958e-02   +3.918449505711705e-02   +7.849080056727199e-02   +5.603416709222488e-02   +8.172497557030441e-02; +3.802097223878030e-02   +5.107053470891161e-03   +4.137337100086376e-02   +2.754281537530627e-03   +2.530021977748760e-02   +6.797539415049773e-02   +2.824303102017669e-02   +6.159339735549964e-02; +7.117882948252183e-02   +5.403496677211635e-02   +3.743713129038678e-02   +6.671943580742862e-02   +2.807055245050669e-02   +6.030864157131212e-02   +3.919934634952169e-02   +2.722328331962616e-02; +3.556039141182626e-02   +4.129261595179146e-02   +7.861145002096888e-02   +4.939555774793698e-02   +4.432314909604754e-02   +2.461559939193576e-02   +4.095937454735114e-02   +5.217957947894610e-02; +1.799536845450593e-02   +1.330386305520362e-02   +6.263043939734546e-02   +7.153450584132652e-02   +7.626137279562827e-02   -2.928329971024191e-03   +5.972851327129011e-03   +5.233549428567280e-02; +5.109043279494494e-02   +2.019336026385653e-02   +5.789366639302865e-02   +6.047376311124047e-02   +7.049385036078250e-02   +8.417570450697304e-02   +1.577570553687557e-02   +2.958085706552315e-02; +1.383346318997558e-02   +4.699464262154027e-02   +3.140305640857950e-02   +6.883819409634157e-02   +3.908621403142586e-02   +1.728496650430380e-02   +5.097266743004433e-02   +7.152444896392404e-02];
L2I_L3I_iGABA_netcon = [+7.725985167241289e-02   +3.384616280885794e-02   +1.900688573776051e-02   +5.202297418406276e-02   +6.386797470442952e-02   +6.938534784848473e-02   -9.845156445640244e-04   +4.027247042309652e-02; +3.891992147077760e-02   +3.297706381160610e-02   +5.785617346702182e-02   +1.185462656422951e-02   +6.960151884850081e-02   +6.813608232739157e-02   +4.118329399596576e-02   +2.399580840677849e-02; +6.083743756139288e-02   +5.745634343279538e-02   +7.097917230795517e-02   +4.921199494797105e-02   +3.232578384455712e-02   +5.426360868474844e-02   +4.032051993620567e-02   +1.112861932451311e-02; +1.962186270446062e-02   +6.211967215554338e-02   +1.746975311612796e-02   +3.743010155897682e-02   +1.057867404988231e-03   +2.466471960122311e-02   +3.109612028210685e-02   +8.417264349669250e-02; +2.781528110989296e-02   +2.774809740041424e-02   +4.310376369762838e-02   +3.457012712425959e-02   +3.013104551648397e-02   +5.069687425056792e-02   +8.665856924831234e-03   +9.110511677625572e-03; -3.735317576579856e-03   +2.174386812547161e-02   +2.878747808464121e-02   +9.285197375586505e-03   +2.950706977009978e-02   +3.867467614923802e-02   +4.279970089521351e-02   +6.297203928798356e-02; +3.232199852982604e-02   +4.119019617297946e-02   +7.537311462595821e-02   +5.204805549053147e-02   +6.251938991812930e-02   +2.585289786440793e-02   +3.018845077874450e-02   +2.884366737094585e-02; +9.610186313050093e-04   +7.827456493520821e-02   +2.024569352884491e-02   +6.346017523752003e-02   +2.142462501752658e-03   +5.727315539191068e-02   +3.881889311662299e-02   +6.436015994070446e-02; +6.698831839787077e-02   +2.842540881470322e-02   +6.873493580493797e-02   +6.238889908493268e-03   +3.988378626319394e-02   +2.405228858736346e-02   +2.711252657662893e-02   +3.750207492542794e-02; +5.987748693619085e-02   +4.102390529566530e-02   +1.300734332879547e-02   +4.028494728345976e-02   +4.833466911796943e-02   +2.482970100915125e-02   +1.650727023429007e-02   +2.835831879529141e-02; +6.130983452773943e-02   +7.594580844721903e-02   +4.371103554632000e-02   +5.131399274276457e-02   +2.416845192758041e-02   +3.452558511583714e-02   +7.084049458628595e-02   +1.178107289222441e-02; +5.735151209754554e-02   -6.233780127607747e-03   +2.880772532760048e-02   +1.439476182363367e-02   +8.335200780875240e-03   +7.676885903838838e-02   +3.962549782205971e-02   +4.845316200382287e-02];
L3I_L3E_iAMPA_netcon = [+3.559907679779265e-02   +7.565267411353067e-02   +1.890367611606486e-02   +4.746862233842863e-02   +6.515189828188980e-02   +3.254926446693535e-02   +2.841613472830887e-02   +1.806888597480258e-02   +2.789552265843031e-02   +2.097295824578868e-02   +1.919477500323136e-02   +7.085997925689330e-03; +3.036020846301573e-02   +6.077430094994413e-02   +2.457359162952239e-02   +7.751196237387303e-03   +2.665312308698884e-03   +4.811183672274691e-02   +4.684994057276579e-02   +4.157852124112230e-02   +1.868697266665175e-02   +4.261525032781979e-02   +5.763467330151840e-02   +4.340466550550844e-02; +2.483583805474704e-03   +4.457295404969572e-02   +4.252705020597750e-02   +4.965159073641835e-02   +3.969654192883321e-02   +3.591452132358240e-02   +3.621093238897900e-02   +3.687632172244339e-02   +3.768069264870884e-02   +4.353625154451517e-02   +3.124517607947948e-02   +4.375276051519456e-02; +3.273262079494939e-02   +5.994684955571818e-02   +5.188523303533341e-02   +3.891153605236603e-02   +3.793860441623489e-02   +7.653313414661068e-02   +6.186258534346072e-02   +1.436999862134202e-02   +7.056636720029949e-02   +7.249415820139357e-02   +1.629166282627459e-02   +5.360721115931526e-02; +1.001229361112662e-02   +3.403628102275570e-02   +8.784467919594309e-03   +7.081405984454489e-02   +6.698443128359362e-02   +4.434925572020426e-02   +7.877431031620699e-02   +3.809801786994643e-03   +7.710971670254933e-02   +4.501175090940019e-02   +2.564966598339615e-02   +9.861294771024577e-03; +2.739335433238944e-02   +4.234118575568728e-02   +6.187173686387705e-02   +4.029775781704421e-02   +8.111565724098299e-02   +7.665325481743002e-03   +6.626945355800071e-02   +2.314179151466288e-02   +5.425025357626079e-02   +8.587798582612022e-03   +2.561952987304412e-02   +1.348931094549157e-02; +5.927472577170260e-02   +2.937799363184396e-02   +3.091191332754087e-02   +1.772182339193329e-02   +4.737181670160028e-02   +1.289762340661441e-02   +4.044156755399801e-02   +7.768028024307576e-02   +6.620028107818871e-02   +8.140212182694702e-02   +4.463622868726805e-02   +5.399369653831827e-02; +5.729855381807247e-02   +1.637508388834341e-02   +5.503060681628168e-02   +5.088075415249210e-02   +7.822441166231064e-02   +4.577185899006376e-02   +5.028924936291975e-03   +3.895605621111432e-02   +3.734178719203404e-02   +2.556383292173054e-02   +2.012704188809060e-02   +7.402374837445612e-02; +1.190651239414748e-02   +6.792476487360255e-02   +5.332557879289042e-02   +5.748692017665123e-02   +2.846591569397694e-02   +6.540748932420128e-02   +9.612701030708284e-03   +6.345580050439181e-02   +6.329908399047114e-02   +3.828367846239710e-02   +1.851107537431270e-02   +1.466301277189823e-02; +6.988736296908800e-02   +7.030183759511938e-02   +3.250732900886730e-02   +1.923269023165680e-02   +4.092828198203088e-02   +6.555906051677353e-02   +4.525981430523682e-02   +7.511455579487249e-02   +6.076847132748886e-02   +3.180257876550124e-02   +6.822735607812315e-02   +1.690438839491806e-02; +3.907177316235826e-02   +3.051573599382041e-02   +7.812987836560184e-02   +7.004881369957182e-02   +2.781806171919331e-03   +4.573865177694114e-02   +5.612805783740051e-03   +2.261727159711555e-02   +2.548977233303000e-03   +7.216213496671842e-02   +5.861642828521335e-02   +3.467584831085795e-02; -6.526400098227703e-04   +1.452422950434351e-02   +8.245327608024331e-03   +4.016439556109928e-02   +3.749002664948618e-02   +2.069913784001091e-02   +6.425787952296261e-02   +1.288239614610193e-02   +2.663631525507937e-02   +1.528472543482019e-02   +6.040664422108204e-02   +2.355985563205765e-02];
L3E_L3I_iGABA_netcon = [+7.518056585299804e-03   +3.443673934596423e-02   +1.977716512685177e-02   +7.222654171031952e-02   +6.076963799675508e-02   +4.775090295355959e-02   +2.915372510644611e-02   +5.949648872663015e-02   +4.524415837697765e-02   +5.682868525166897e-02   +4.557555910641708e-02   +1.701434635205693e-02; +5.824863806789596e-02   +5.182924342422707e-02   +2.850217516430403e-02   +1.822634055258049e-03   +2.626457186426460e-02   +5.674405838096629e-02   +4.822110101695341e-02   +7.773353216976620e-02   +6.492814286757856e-02   +2.971748895344871e-02   +1.474577796537352e-02   -7.314891860195922e-04; +4.639958275383570e-02   +8.248910657367678e-02   +7.790538223087513e-02   +7.057129919795685e-02   -1.480546470769277e-03   +5.762221217297685e-02   +4.684274000841377e-02   +5.252941595132633e-02   +3.395750305182397e-02   +3.129186895048220e-02   +1.843174338497993e-02   +1.143279001646463e-02; +2.979467119159864e-02   -3.628973831671618e-03   +1.538319562733839e-02   +6.168782966794294e-02   +6.320184512301877e-02   +2.777002917798877e-02   +3.520267257977092e-02   +2.977789876303832e-02   +7.840693035475695e-02   +3.301114360291739e-02   +8.171706272530933e-03   +5.452368590209202e-02; +3.491565390872538e-02   +3.483236143744101e-02   +8.677888005056746e-02   +1.547656856674113e-02   +3.842852119692761e-02   +6.398667895161474e-02   +8.363739146030401e-02   +7.176464298190435e-02   +2.315238463652214e-02   +5.014801795692200e-02   +6.703806926302854e-02   +2.310353212451849e-03; +5.747205972033312e-02   +3.156669839385654e-02   +6.740915001505644e-02   +2.903914138925893e-03   +5.135094652362739e-03   +8.209840607663621e-02   +8.820100148816527e-04   +2.040065315030011e-03   +6.472790878118261e-02   +5.000831399314638e-02   +1.807316274154928e-02   +1.721206036691454e-02; +4.179125605966464e-02   +2.639547850394449e-02   +4.657654530755746e-02   +4.771058093588679e-02   +5.209236948265519e-02   +3.827891260333238e-02   +3.148982189398906e-02   +2.010659703977381e-03   +3.445652215501227e-02   +8.223583150947480e-03   +2.300778887578391e-02   +5.359723955467920e-02; +1.695439514901742e-02   +4.441204276903457e-03   +1.131039059447396e-02   +7.856072165628299e-02   +3.742062264994132e-02   +6.538061322221102e-02   +4.235666924531976e-02   +6.354607828288845e-02   +6.223206181278765e-02   +7.439374347281380e-02   +1.459369546161961e-02   +5.259651760903852e-02; +1.888740719429928e-02   +1.323216366539711e-02   +6.785262968112407e-02   +2.688705025490396e-03   +7.928254288753955e-02   +6.972001668155398e-02   +1.447211379442959e-02   +6.329361147889211e-02   +1.699105186129828e-02   +2.757071241720676e-02   +3.922811339159937e-02   +4.909622223542670e-02; +6.353000805599207e-02   +2.621085837518965e-02   +6.630917053061598e-02   +2.075366140189943e-02   +3.024524998170936e-02   +7.795157056505987e-02   +5.870328433101376e-02   +4.544274467829131e-02   +7.391589438692653e-02   +7.626104535153080e-02   +1.548167960785733e-02   +9.896924473929022e-04; +4.015549890198747e-02   +9.966742546775407e-03   +2.051439680655392e-02   +1.881135481863906e-02   +5.587988076677420e-02   +3.913459009134378e-02   +7.760807388941215e-02   +5.549834743885994e-02   +4.289354271009820e-02   +1.514544993128208e-02   +8.543964628058369e-03   +6.319829150690848e-02; +5.376534186895606e-02   +4.732238139563461e-02   +7.494729351481810e-02   +5.284732647727027e-02   +8.086267770218989e-04   +4.026263504585451e-02   +7.660995723104624e-02   +5.910253249984353e-03   +5.864853336687657e-02   +3.397743297334624e-02   +3.827121228246010e-02   +2.913522753727276e-02];
L2E_Input1_iAMPA_netcon = [+7.929746171413686e-02   +7.721688175451935e-02   +7.580776226017155e-02   +7.966686980384044e-02   +8.344166483466456e-02   +8.948537757235407e-02   +8.116871987208400e-02   +7.891836359124874e-02];
L2I_Input2_iAMPA_netcon = [+7.364132303669899e-02   +8.163839849866004e-02   +7.836396523048977e-02   +7.802555575195549e-02   +7.254448151038650e-02   +8.606028894674835e-02   +8.458663989121369e-02   +7.305550342102612e-02];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.0*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.2*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.0*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.2*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.0*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.0*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.2*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.0*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.2*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.0*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
