function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-1.731615255591942e-01   -2.068017326273948e-01   +9.660902773543489e-03   -1.863572820099627e-01   -1.378719056868523e-01   -1.204001230683011e-01   -7.700104815906135e-03   +1.096189481964079e-01   +1.032207481031014e-01   -2.632520726362466e-03   +1.343005449469689e-01   -2.204011085741295e-03   -2.555579030069984e-01   -7.758683324904300e-04   -6.774152525360691e-02   +3.780474724377259e-02; +2.262930356975994e-01   +1.592836119413847e-01   -2.005211229697849e-02   -1.503478159938423e-01   +3.122312835148039e-01   +1.154354251310597e-01   -1.897521805741821e-01   +1.560945513847372e-01   +1.382454349863290e-02   +6.681010079554447e-03   -2.018805156532154e-01   -5.037315558048750e-02   -6.710123757108077e-03   +4.277065323427679e-02   -1.845055568831427e-01   +1.328758124174664e-01; -2.195831357872056e-01   +1.698770236419886e-01   +4.652902188925594e-02   +5.397331240378142e-02   -1.016183048822778e-01   -7.997026450795930e-02   +1.931052528696488e-02   -2.086482228118697e-01   -1.980755680947900e-02   +2.396333202119611e-01   -8.366218870241515e-02   +1.611587099418155e-01   +1.656301154925703e-02   -2.307811353937768e-02   +2.494541041947027e-02   -2.325515962090374e-01; -1.879680594791882e-01   +1.737332905739393e-01   +3.136505110115869e-01   -1.413606089854322e-01   +1.128449006500027e-01   -1.119734600456843e-01   -6.263990481819995e-02   +2.702470877700127e-01   -3.012380222345978e-02   +1.578296167266044e-01   -1.419307679257445e-01   +8.481424282875726e-02   -5.581336221724250e-02   +1.472500379322065e-01   -2.522369579217537e-01   -2.402159617126024e-01; +2.172221887545761e-01   -3.741667751646639e-02   +3.971576471826856e-01   -2.118425904265826e-01   -4.674157474318704e-03   +2.710676459526682e-01   -3.361153563952645e-01   +2.968130196879876e-01   -1.690213667608980e-02   +5.728171435385591e-02   +1.686610188918355e-01   +6.899722076245404e-02   -9.412577938996163e-02   -6.119071968079651e-02   +6.965435599997186e-02   +1.438382532908878e-01; +1.459778852765219e-01   -1.749819673136788e-02   -1.876037463292378e-02   +1.631911851095681e-01   -3.783005748512067e-02   +3.547303654817276e-02   +4.599872581785171e-02   +2.335589132550378e-01   -1.853119329511790e-01   -5.285767982658868e-02   +5.257279913123290e-02   -1.522472636206576e-01   +1.775728387573026e-01   +1.522086942140902e-01   -3.778503020663758e-01   +1.131421748958611e-01; +6.058384648692104e-02   +4.448559361115480e-02   -1.763682212994296e-01   -2.489266314646983e-01   +1.384095912209918e-01   +2.348289260588362e-01   -1.678175617573162e-01   -2.525620092451725e-01   -3.586323439389579e-02   +1.815136616916257e-02   +5.964230943885343e-02   +2.080397542643956e-01   -3.333324072391670e-01   +1.983665637116720e-01   -8.385846331815013e-02   +1.904355034077893e-01; +6.923110579004145e-02   +6.158407096292192e-02   +3.844768951940945e-02   +8.037796589276457e-02   -4.235455000920647e-02   +1.017353339814691e-01   -7.825423503716436e-02   +2.005649726851817e-01   +2.499527681258690e-01   +2.439916884628023e-01   -9.159784147048546e-02   -5.723719466176738e-03   +6.022009402016410e-02   +3.716243404645597e-01   -2.965080630806994e-01   +7.923176408792421e-02; -9.169612024247663e-02   -9.963297462870695e-02   +1.690677999402812e-01   -1.310273903867138e-01   -2.046347544744311e-01   -8.443830356125714e-02   +2.129981862036566e-01   +1.744464153356539e-01   +1.760694689295439e-01   -2.036404084567613e-01   +1.393977145269597e-01   -1.018559350001339e-01   -2.569595920240529e-01   +5.413637060587424e-02   +2.320207255384974e-02   +1.871094660169332e-01; -5.412046857316468e-02   -2.065797070465904e-01   +2.810250411134814e-01   +1.770824034981699e-01   +6.976915818139753e-02   -1.317152149955445e-02   +9.978517128804057e-02   -3.051003151063564e-01   -3.997961979817079e-02   +6.822786378264779e-02   -7.305000423762276e-02   -3.480171022727397e-01   +1.490966872288328e-01   +1.535829047787689e-02   -8.711835673848146e-02   +3.436729617941398e-02; -1.253984351707899e-01   -4.794532734123489e-02   -2.796792693277831e-01   +3.115351501007034e-01   -2.421341160040597e-01   +8.206742700347450e-02   +5.514967779640300e-02   +2.986948188600662e-02   -1.526992367108768e-01   -1.559505612879883e-01   +7.275666712787580e-02   -5.642849421967242e-02   +2.215893175679980e-01   +2.609600908986831e-02   +1.199629069447644e-01   +1.473163898844154e-01; -2.153821031656141e-02   -2.436980686798750e-01   -2.281587735667683e-01   +1.755545059123600e-01   -1.513536136480468e-01   +6.729193358467851e-03   +7.009670595952751e-02   +1.921722048096510e-01   -7.168750444802043e-02   +1.475210350698945e-01   +3.307297232022081e-02   -7.050229940602202e-03   +2.771755154061596e-01   +3.420720335889795e-01   -3.544559991128006e-01   -6.734555990503530e-03; +4.820182381651190e-02   +1.621812121968292e-01   +1.436915297045330e-01   -2.146288161076723e-01   +1.688474219789655e-01   +1.186931191105682e-01   -2.281152035484612e-02   -1.602351051957133e-01   -8.334539161920372e-02   +7.717689325355086e-03   -5.266382179886740e-02   -3.590351337216174e-02   +1.986572633045374e-01   -1.250663442310507e-01   -2.378621932175868e-01   +2.345363924855154e-01; -3.674882922628922e-02   +2.208547612637978e-01   -8.503816723821342e-03   +1.200388071804343e-02   +2.832639206405954e-01   -1.454536134764726e-01   -1.458189158678317e-01   +2.038835841097733e-01   +5.795013885454382e-02   +1.603099935280519e-01   +4.455546347671896e-02   +7.536836723575172e-02   -6.311012814831871e-02   -2.815871825569707e-01   +3.167920197236170e-01   +1.832261887752099e-02; -2.233175430559097e-01   +1.078286973253443e-01   -2.020086004256309e-01   -3.318194285977840e-01   -1.359583005780167e-01   -1.624322936379540e-01   +8.693401497068896e-02   +7.239742444156463e-02   +2.550170733846820e-02   +1.112058598376919e-01   -3.296135568312425e-01   +2.220541144642654e-01   -7.753258794761379e-02   -1.646808911177342e-01   -2.174731229512181e-01   -4.420861642489964e-02; +2.779122084845372e-01   -1.432623725511248e-01   -3.193125122166636e-01   +6.952211562958942e-02   -1.645450085236714e-01   +2.007684790223977e-01   -1.157750296030396e-01   -8.357807047788919e-02   -1.506222281057372e-01   -9.275183163399828e-02   -2.737209470017619e-01   +1.687972000127866e-01   -3.144704842664568e-01   -1.932839448243337e-01   -1.529941469713064e-01   -2.927398166518272e-01];
L1E_L1I_iGABA_netcon = [-8.707944014245728e-02   +8.072954512019641e-02   -2.075236354054724e-02   +4.974756370727627e-02   +1.621926753007819e-01   -1.813289375647633e-01   -8.185240345925962e-02   +1.025476892516958e-01   -2.512320701255985e-01   +7.140192108331408e-02   +1.289943409391631e-01   -1.748674238221939e-01   +1.106434459552428e-01   -3.342470788806681e-01   -1.899257943078617e-01   +1.006574178441842e-01; -1.635475875714553e-02   -7.615217790137593e-02   -1.128342795515174e-02   -7.302917683434558e-02   +1.842686172178226e-03   -5.228921053071347e-03   -7.801524754150863e-02   +2.495011028571771e-01   +1.775940955062412e-01   -6.750767994910667e-02   +2.169795272965997e-02   -2.584153777970508e-01   +1.267825924337262e-01   +7.068688503639312e-02   -7.690495178577257e-02   +2.242725104111011e-01; -1.184952187843624e-01   +2.171124615059160e-01   +1.736129056622739e-01   +1.840202539812458e-03   +2.066078829285652e-02   +2.183170513345783e-02   +1.208686564600922e-01   +1.154433298592160e-02   -1.958661822067402e-01   +2.230897977891149e-01   -1.601382661741317e-01   -2.367455854156014e-03   +7.182357079272302e-02   +9.705199847560564e-02   -2.910668037762514e-01   -1.030260611808695e-01; -5.081039562498597e-02   -7.566175931909197e-02   -3.441935784630477e-02   -1.016830903392702e-01   +1.555331394573324e-01   -4.808363581833303e-02   -1.272393966979203e-01   -1.112347237413947e-02   +1.787914771098852e-01   -1.861000583252189e-01   -2.617974672848865e-01   +4.993395031884910e-02   -1.194608729602216e-01   -1.761800085493657e-01   +3.419785142756769e-02   +4.812302206818489e-02; +4.709826714391500e-02   +1.490720341083992e-01   -3.460537390004400e-01   -3.477112921810271e-02   -2.349160871779967e-01   -1.158190436538287e-01   +3.687618513296629e-01   +5.771944659095603e-02   +1.368145583741202e-01   +1.102276226117880e-01   +1.016615157724928e-01   +3.928072034016578e-01   +7.759397599899173e-02   +2.209562674697597e-01   -1.333487561633926e-01   -1.980184917147234e-01; -1.112786908990178e-01   -1.867317717112521e-01   -9.706868967756990e-02   +2.211464279540666e-01   +3.310766989564266e-02   -2.484065346507995e-01   -4.155927165441772e-01   -1.951518602614379e-01   +2.900411098106712e-01   -2.862602274215844e-01   -1.210498976108510e-01   -6.322770249577467e-02   -1.109160654991250e-01   +2.767755369259732e-02   -5.851216097450868e-02   +1.214259765578104e-01; -3.423042757252007e-02   +1.295436249412006e-01   +2.543941927171384e-01   -3.280940369827219e-02   +1.884700931915728e-01   -1.535156603330738e-01   -2.813417574224203e-01   +3.676209006103307e-02   +8.349094956223738e-02   -1.432580453787505e-01   +1.143687567953904e-01   -4.311324257795545e-02   +1.067051488351832e-01   -9.874366142186514e-02   -1.570374699505764e-01   +3.098531048781850e-01; +1.252122778634100e-01   -2.478320505343086e-01   +1.522368862370928e-02   +1.617381580676013e-01   -9.432888657928658e-02   -1.327644162115905e-01   +1.500510105991682e-01   -3.645005377597633e-02   -1.754386806023900e-01   +2.217854573001715e-01   -1.533399364826760e-02   +1.819134348262102e-01   -1.171807494280200e-01   -3.154031197144430e-01   +9.582774868404222e-02   -8.283760390873622e-02; +2.567838202849132e-01   -1.828334186462445e-01   +4.202413204395385e-03   -1.250919977843823e-01   -1.097740105643512e-01   +2.759723843981768e-02   +5.072723511298588e-02   +2.710185373300824e-02   -2.825913910381186e-01   -3.181856113266820e-01   -1.819645810086279e-01   +1.964749850825599e-02   +1.624003741199811e-01   +1.379438722470653e-01   +1.142219662945959e-01   -2.770282991490911e-01; +2.036722121233948e-02   -1.650710455949451e-01   -1.517286438877227e-01   -9.572236218272197e-03   -1.732541598418617e-01   -9.990305051852805e-02   +1.184567153418366e-02   -1.321080885612252e-01   +1.846510875339641e-01   -4.101926231824001e-02   -5.476888508442870e-02   +3.535597625466195e-01   +1.026970613313919e-01   -1.769345661332218e-01   -2.564316154363642e-01   +6.107369116681854e-02; +3.729805437368717e-01   -6.619129912238376e-03   +7.247849724347477e-02   -3.245850457567818e-01   -5.837923118530038e-02   +9.730075404324459e-02   -6.363650230362448e-02   -1.168379211090693e-01   +1.801407418780963e-01   +2.311579895208872e-01   -1.753515116425502e-01   -1.841626694270338e-01   +1.457130001321051e-02   -1.639508069638467e-01   -1.242724164143159e-01   -3.532238329778280e-02; -1.972477808927271e-01   -7.322823830022793e-03   +7.490160048517273e-02   -2.238285015421450e-01   -1.882699065540093e-01   -2.808892237846014e-03   +4.096302360409684e-02   +1.777231359382326e-01   +1.120678254677001e-01   -2.710420375475331e-01   +2.987171478759614e-02   +7.790858501184544e-02   +3.511322273146565e-02   -6.095980289845483e-02   -8.644593827897287e-02   +1.216524292967620e-01; +2.219976697779672e-02   -2.623490537414213e-01   -9.428759315032323e-02   +1.884053308385984e-01   -2.708443423449988e-01   -2.300037591095654e-01   +1.969059659194399e-01   +7.248083814539432e-03   -2.468669575649315e-01   +1.146205293173436e-01   -1.226780706193717e-01   -1.772142459122535e-01   +1.002579720937224e-01   +1.176758006715723e-01   -6.481790546659962e-02   +2.165004573291766e-01; +1.332564272407432e-01   +2.818059271058805e-01   -1.988090018854575e-01   +2.071030656869270e-01   +2.025823398628752e-01   -8.752367476957720e-02   +1.034017476469536e-01   +1.076683037698088e-01   +2.552241184820652e-01   +3.029859909805939e-02   -1.947508855931285e-01   +6.924688997366063e-02   -1.295984642169743e-01   -4.417193731748748e-02   -1.614086567541042e-01   +4.125993287674801e-02; -4.532166597498082e-02   -5.800623464729835e-02   +2.026005551478836e-01   +8.183909136188414e-02   +2.285825026042518e-01   +6.115273528080206e-02   +5.134491410524236e-02   +3.915587464318379e-01   -9.963818403165695e-02   +2.247944141176876e-01   +1.215685713487240e-01   +6.649168956137647e-02   +2.082640871775632e-02   +1.153046706462619e-01   +4.103617005820302e-02   +2.193085034671082e-01; -1.211755185762700e-01   -3.542597668790238e-01   -1.687723523047299e-02   +1.661856280449951e-01   -1.606559908840859e-01   -2.213162966148625e-01   +3.902298505424276e-01   -4.657949077673132e-02   -2.132227540677658e-01   +4.733781597572891e-02   +5.596924849938193e-02   +1.403686228399108e-01   +1.433582470106424e-01   +6.227801399481449e-02   -2.763243500150462e-01   -2.552553320480812e-01];
L2I_L1I_iGABA_netcon = [-2.875983659543566e-03   -1.062604009338345e-01   +9.455295283671450e-02   +2.946312514893701e-02   -1.407847299795969e-01   -2.080325269160349e-01   -9.251031543915028e-02   +5.803098502083449e-02; +1.423269497125514e-01   -1.208611533246123e-01   +2.589264036869042e-01   -1.832608586657433e-01   +5.624289909602898e-02   +2.153986138835918e-01   +2.442491607993443e-02   +6.509356134782247e-02; +3.887120308598947e-02   -4.951031776393187e-02   -9.897645756749185e-02   +1.037185885090065e-01   -1.688806222001584e-01   -4.798444260857245e-02   -1.425238024508490e-02   +1.733087321868898e-02; -2.358218088294236e-01   -1.362883194288039e-01   -7.511997498496567e-02   +2.410747035475480e-01   -2.191503530942347e-01   -1.080254568988014e-01   -7.570735253665357e-02   -1.223904254258095e-01; -6.799681250610638e-03   +3.587307611880556e-02   +3.561197074331279e-01   +2.936149196552962e-01   -1.089844926483523e-01   -4.184096977448667e-02   +3.623085537205227e-01   -5.113403291095257e-02; -1.780934388835355e-02   +1.020868902292946e-02   -1.356407631814245e-01   -8.600784868375280e-02   -3.351433062152936e-02   +2.215988739143007e-01   -1.592030595165738e-01   -3.630659435774878e-02; +1.871749214754513e-01   +1.332611022179878e-01   +1.720405073355182e-01   -9.033377585143926e-02   +3.668450083504362e-02   +2.179332841767704e-01   +6.086010295606409e-02   +2.138609771061358e-01; -2.904228060905664e-02   +1.512692545491039e-01   -7.512704029425342e-02   +1.848645821447922e-01   -4.378579643817304e-02   -1.703833869562463e-01   +7.576180061721439e-02   +3.983227689865697e-02; -1.035929580032806e-01   -1.199091595933866e-01   -1.097548912409063e-01   +1.951724603106022e-01   -1.666928233428571e-01   -5.253337443015260e-04   -1.191456947141867e-01   -6.408151872336616e-02; -7.077815073987374e-03   -8.909135864154637e-02   +1.065333575274558e-01   +5.160722775554094e-02   +5.578441588199813e-02   +1.396311161858545e-02   -2.449198376017976e-01   -2.266609085943534e-01; -1.823670994341757e-01   -1.834252497106510e-01   +1.422198761107439e-01   -2.210574587461880e-01   +1.161605109173109e-01   -3.676236925382060e-01   +2.475956483340830e-01   -8.991660575081703e-02; +1.766714471630237e-02   +1.339071044934338e-01   +2.980177630432986e-01   -4.430572314282801e-02   +5.399499654269661e-02   -2.571848340795738e-02   +1.748865184689435e-01   +3.676714858483753e-02; +2.490906988579481e-02   +4.667094388865909e-02   -1.368418680921778e-01   -9.180986130157776e-02   -6.106710338502468e-02   +6.738093427613417e-02   -1.087065880611196e-01   -1.121685975271738e-02; -1.831860557915470e-01   +1.397730166138804e-01   +7.312032569823960e-02   +1.268054202163374e-01   -1.467862816229335e-01   +1.267254570152962e-01   +8.115673163235039e-02   +1.262690840513265e-01; +3.236692975768834e-02   -1.079838204939426e-01   -4.730470115173459e-02   +2.349803346384344e-01   +1.477412910040500e-01   +2.006420697991328e-02   +4.079068076085565e-02   +2.869263047142022e-02; +2.779638083200418e-01   +2.850741996474842e-02   +2.306138770084028e-02   -2.932779910866040e-01   +4.872847285691308e-02   +3.639016176150659e-02   +8.075267192033772e-02   -1.536838418338779e-01];
L1I_L2I_iGABA_netcon = [+6.705698736457716e-02   -7.169902861146284e-02   -2.608710995648018e-02   +1.272419305094075e-01   +2.402461233599029e-01   +9.133177210743397e-02   -1.213126417125971e-01   +2.286145697348164e-01   -3.438549638063410e-01   -9.296229471909745e-02   +5.320772226598201e-02   -1.568965302388818e-01   -2.823948910371450e-03   -1.277001763259947e-01   +3.262587312270649e-01   -3.845476601754164e-01; -7.541817985566929e-02   +2.683500430742323e-02   +3.276354872416397e-01   +2.222859139114261e-01   +4.636993216196341e-03   -2.701275083307136e-02   +4.141531723329227e-02   +2.545313693208703e-01   +3.886848412866768e-02   -1.463722462967707e-02   -3.250912119662393e-02   +1.679220321551635e-01   +3.485274322171589e-02   +3.311732051717662e-01   +4.294498418461261e-02   -3.279691981496892e-03; +1.217516780857591e-01   +3.997419382940648e-02   +2.568205843127590e-01   +3.570671498128177e-01   +1.325184352798262e-01   -1.554136973967963e-01   +1.236847099721105e-01   -5.834561026254603e-02   -6.678624320887892e-02   -4.429542024321413e-02   -2.803593535313494e-01   -4.575525022441054e-02   +8.833230061616275e-02   -1.807668170061056e-01   +1.540519713055366e-01   -2.189281703352666e-01; +2.095122857287929e-01   -1.888946691142685e-01   +2.536829805756556e-01   -3.794646884964364e-01   -2.480449395856634e-02   -5.722858793712107e-02   -8.153492647548749e-03   +5.860622636716445e-02   +1.478416609218779e-01   +9.172957608044993e-02   -7.482434653939109e-02   -1.362527053555898e-03   +3.513127802160040e-01   -1.825813634079413e-01   +2.825490422128707e-01   +1.946235334654480e-01; +1.452042396532837e-01   +5.654504782162525e-03   -7.362280579345484e-02   +9.084416126077535e-02   -8.974358675193318e-02   +1.029720139009620e-01   -1.285676260296027e-02   +1.585148182794713e-01   +7.289000411240966e-02   +7.955534235420230e-03   +1.561351354504043e-01   +1.120417798070427e-01   -1.126601287248042e-01   -9.238840808233809e-02   +1.463650368746044e-01   -1.123870303444237e-01; -1.366963726697643e-01   +2.931048096226238e-01   +2.801700386876209e-01   +5.285695772448137e-02   -1.276444316809456e-02   +2.283974397738553e-02   -1.173023389867443e-01   -1.971799304353005e-01   -6.663155054829996e-02   -2.950044052920547e-01   -1.998139071507239e-01   -2.320402843148434e-02   +5.897710893989911e-02   +1.922800521033413e-01   -3.840028235347233e-01   +2.349104399678879e-01; -1.445357377103870e-01   -1.288969701298710e-01   +2.333881271766102e-02   -1.411276016331227e-02   -3.151232766093875e-01   -3.148112095556281e-01   +8.584904519121112e-02   -1.454997964642314e-01   +1.228539032046560e-01   +4.903948485931585e-02   -1.886719922959519e-02   -3.963452226367317e-02   -2.545735648582730e-03   +3.777161495948059e-02   +1.133771853848147e-01   -6.018674143232920e-02; -2.340198739257255e-01   -2.068464693290128e-01   -3.453487554180946e-02   -1.487370687526684e-01   +1.583719434527366e-01   +5.919207919730780e-02   -9.203433815680415e-02   +1.485562555740316e-01   +3.143205216887821e-01   -2.126767393805270e-01   +3.998414558535737e-02   +2.316601331250338e-01   -1.754060082874186e-02   -1.334330927845885e-01   -1.487702465786923e-01   +1.906773343735108e-02];
L2E_L1E_iAMPA_netcon = [-1.643907366905096e-01   +7.858400313901852e-02   +2.153333166951203e-01   +3.029561151009998e-01   -1.837972758640031e-01   +1.556351864991804e-02   +1.193058784882038e-02   -1.649968514286576e-01; -1.003455779545902e-01   -9.478833196852196e-02   -4.521106589410209e-03   +1.084403775922656e-01   -6.185562836794239e-02   +8.148561218121186e-03   -1.191588625662065e-01   -1.018516182047708e-01; -4.089901139173446e-01   +8.173451523994638e-02   +3.451569287124560e-01   +3.298845564729218e-01   +2.051380922614603e-02   -3.476597925074348e-02   +1.772323009193035e-01   +4.139957472667115e-01; +1.010594694738631e-01   -8.456503049721695e-02   +4.778624791566620e-03   -2.299657872139932e-01   +2.319691367050927e-01   +3.331513505840233e-01   +6.218566276530764e-02   +1.132990156333611e-01; -1.660359136791986e-01   -7.064192498231125e-02   +3.598823518529315e-02   +4.543223259119085e-01   +3.060763525324283e-03   -3.239184419231643e-02   +2.429974071011034e-02   -9.094893633826853e-02; -1.634091679856416e-01   +3.450431968066074e-01   +2.538435817352661e-01   +3.025744348391423e-01   +1.287841740560376e-01   +9.543402150798165e-04   +1.309073171523960e-02   -1.061334942166273e-01; +2.356104874768804e-01   -2.162031908668089e-01   +8.582409720548946e-02   +9.262004214367325e-02   +1.908105188345853e-01   +9.783011800129093e-02   +1.028411039438625e-01   -1.436076583179591e-01; -5.919709940703562e-02   -1.493192061304876e-01   +2.453603265119934e-02   -3.483621639721483e-01   +3.566314418743493e-01   -3.772352297848500e-01   +8.965660401000837e-03   +1.521626414936969e-02; -7.105746364404561e-02   -9.879238324445709e-02   -2.180254461625545e-01   -2.836193338573166e-01   +4.589539893166295e-02   +8.975847182375753e-02   +1.596295575054293e-01   +1.301457165509160e-01; +1.992956544198648e-02   +5.909400044451618e-02   -2.879393430869095e-03   +8.137694708088807e-02   +1.638925482441763e-01   +4.205720317408346e-03   +2.488872219179335e-01   +9.876253147060418e-02; -5.672347825137771e-02   +1.760544045885329e-01   +2.804023354205419e-01   -1.669807818291008e-01   +1.161007636287946e-01   +4.190962428434497e-01   -1.015695496767128e-01   +2.238348927090404e-01; +3.871440338506139e-02   -7.071776454500507e-02   +6.758778085155331e-02   +1.144567262315096e-01   -6.654482676633694e-02   -9.275521091814967e-03   -8.585290746233971e-02   +2.979917027318145e-02; +3.604826029933350e-02   +4.123718953270154e-02   -2.507259638321996e-01   -2.304129540083775e-01   -9.038242217193408e-03   -8.093893946274727e-02   +1.791860767321471e-01   -1.451574961823826e-01; -2.331334333206244e-01   -3.372007303439873e-01   +5.042863411366647e-02   +1.882537040377733e-01   -5.158930238660507e-02   -1.252776421564663e-01   -4.094523379926963e-02   -9.183203633737431e-02; +7.173128507821569e-02   -6.752100362104230e-02   +4.522756349761066e-01   +3.176921373624373e-01   +8.194204011512467e-02   -1.599736182151399e-01   -5.404694449921183e-02   -1.266776327273599e-01; -2.997588044106659e-01   +2.611215285477768e-01   -2.118730634426456e-01   -1.414044161766727e-01   +1.090979536882861e-01   +3.376939369740249e-01   +1.204543667507798e-01   -1.345189767254419e-01];
L1E_L2E_iAMPA_netcon = [+1.083860119892796e-01   -2.449321927958708e-01   +1.359214846038676e-01   -8.425553311568118e-02   -1.475276626052232e-01   -3.165603426098805e-01   -1.419836626960955e-02   -5.646641923188825e-03   +8.365636871419470e-02   -7.696663982695587e-02   -9.838543216896975e-02   +4.417996072877919e-01   +5.002438013664780e-02   +1.153615881730507e-01   +9.758511914403820e-02   -7.989928529806384e-02; +7.683377013432729e-02   +2.041378620696093e-01   +2.300877242894601e-01   -4.948327003845479e-02   +1.682757206525386e-01   +1.621316679149531e-02   -8.886901156900548e-02   +3.037605179527108e-01   -9.642018255055815e-02   +1.819880020490968e-01   -2.692227014446480e-01   +5.533383422131735e-02   -5.514856432924391e-02   -2.019072593909997e-01   +2.823771129088082e-01   +8.028761409967371e-02; -1.871689183256899e-02   -6.546014021974569e-02   -2.560280639506986e-01   -1.228752305978340e-01   -8.790181220574507e-02   +8.162038511018528e-02   -2.591077559640864e-01   -1.583937782352794e-01   -1.725277118521121e-01   -2.548028180400940e-01   -1.330036681794589e-01   +2.827945737591920e-01   -2.220980372547235e-01   +5.690841697213112e-02   -2.154021110856036e-02   +1.476842033499188e-01; -1.240437599198863e-01   -7.770453741906536e-02   +4.860375163790741e-02   +2.817091485599135e-01   -9.625232217688368e-02   +3.455716371976598e-02   +1.750644115766949e-02   +2.219806360009689e-01   +8.717293026274760e-02   -1.272076938485244e-01   -9.289174783004821e-02   -2.464653434832831e-01   -2.097128902247106e-01   +1.339727354266918e-01   -8.415267534141495e-02   -1.103260747726182e-01; +1.671375718011603e-01   +1.614038408326393e-01   -1.001019910061287e-01   +2.915700522189116e-02   -9.491297209022628e-02   +4.357619351037805e-02   -8.828741009131666e-02   -1.749049673060137e-01   -2.127339011687169e-03   +1.815809817453470e-01   -5.137156955075448e-02   -3.367411983185833e-02   -2.303313191796190e-01   +2.762000798808505e-01   +2.746934059171995e-01   +5.247660876569013e-02; -3.277003090913119e-01   -1.221394327205617e-01   -1.791515260156691e-01   +1.247511771773306e-03   +1.478721757884385e-01   +1.591762372523980e-01   +3.672707643101516e-01   -6.123710131829860e-02   +1.541038564346496e-01   -1.425384012333925e-01   +2.527200334018259e-01   -1.610673515100649e-01   -1.497231769765433e-01   +3.634593267268684e-01   +1.952812576210808e-02   +3.730018581567464e-02; +1.149739595314967e-02   +1.923593109451802e-01   +1.158146962122908e-01   -9.452359691544232e-02   +1.019661776179524e-01   -4.558304176627107e-02   -1.743613345473695e-01   +2.955275852261757e-02   +6.727248627348398e-02   -3.266811204327651e-02   +4.004401407731310e-01   +8.747120157839131e-02   +1.926334439325228e-01   -9.075650231937656e-03   -1.949472440075355e-01   -6.924462901491528e-02; -8.385472982407791e-02   -9.019033185307043e-02   -2.629927039737154e-01   -2.310595916398612e-01   -1.356588047248842e-01   +5.626185850581368e-03   +3.495073933217014e-02   -1.254152654380289e-01   -2.528479851965234e-01   -1.025170974273375e-01   +9.684972658584245e-02   +1.124967889727824e-01   +2.848854451936557e-02   -1.403113608780453e-01   -3.481355941549083e-01   +1.679147925178775e-01];
L2I_L2E_iAMPA_netcon = [+1.240623834552791e-01   +2.335690942044314e-01   +2.218996703990492e-01   -4.728912883502391e-02   -6.350285736853541e-02   +2.144106389810316e-02   +5.755805025478770e-02   -1.091866974426600e-01; +2.071763727503151e-01   +2.269434197952018e-01   -1.500715760205883e-01   -2.367427580023646e-01   +5.088481639999270e-02   +2.602967618275389e-01   +1.251179110599964e-01   +1.265804044508393e-02; +5.845771675466689e-03   -1.246657605382660e-01   -5.219546827190504e-02   +9.414148003001929e-02   -3.880083752503434e-02   +7.409052722607656e-02   -3.166832402794310e-02   -9.768933025158918e-02; -1.295690913545837e-01   -5.645359864710987e-02   +1.314086254446966e-01   -1.493828811660474e-01   -3.622227822509977e-01   +1.135769610993274e-01   -1.415545056798316e-01   -1.340336859653934e-01; -2.088260384905041e-01   -1.925912074287013e-02   -1.665108974538661e-01   +4.806798720494803e-02   +2.522290226345690e-01   -4.207136951046055e-03   +3.233056006210003e-02   +1.413915340542757e-01; +9.138998744061126e-02   -6.272395479804646e-02   +1.923213387005596e-01   +7.519732523110428e-02   +1.713285871401964e-01   -1.735531467491545e-02   -1.250446531832110e-02   -1.818104218931070e-01; +1.462579660342408e-01   -5.967154949097643e-02   +7.554548625096580e-03   -2.104304691022872e-01   +1.980199949153333e-01   -8.645083189017044e-02   -1.187924512098348e-01   -2.253865868739875e-01; +1.545591940017034e-01   +8.708597281064476e-02   -5.082054393809819e-02   -1.752556792681858e-01   +6.772144578801624e-02   -1.298290384189812e-01   +6.764258422741271e-02   -5.630231752250085e-02];
L2E_L2I_iGABA_netcon = [-4.574660431301134e-02   +1.252253266517130e-01   -9.997959591692838e-02   -3.141945161939834e-01   +2.053012682033828e-01   -6.763939397978595e-02   -1.001655091667889e-01   -9.838035850523195e-02; -7.025911528856271e-02   +1.467004736012169e-01   +2.221653415772369e-01   +1.509369413157017e-01   -8.765645175735216e-02   -2.377820061834256e-01   -3.992138900906811e-01   +2.802792460565324e-01; +4.084063243097860e-02   -1.318723127822492e-01   -9.148647884431084e-02   -5.106284801590039e-02   +2.100663452239976e-01   +3.482861188781908e-02   -1.191008358935440e-01   -7.002574870332393e-02; -1.278957845892575e-01   -1.009025598162559e-01   -1.309757324202223e-01   +2.460480650729710e-01   -9.568115792270768e-02   +1.904190359248997e-02   +6.013162210704685e-02   +5.613331653478790e-02; -3.125062877135992e-02   +1.418465802097261e-01   +3.535634349280997e-01   -6.920352805682979e-02   -9.011222080431919e-02   -5.186393647303919e-02   -1.807878890456714e-01   -1.884147122433755e-02; +1.873303894059873e-01   +2.858003395058867e-01   -1.199205110072339e-01   +1.225794533570344e-01   -9.929884607326182e-02   +1.842951104159383e-01   +1.261731044141776e-01   -9.767353261075790e-02; -1.549985355351728e-01   -1.455570506258455e-01   +3.220356341789946e-01   -3.482112609416072e-01   -1.092649022008058e-01   +2.196613543110841e-01   -2.675857057672116e-01   -2.321262698425053e-01; +8.828251988284591e-02   +1.357232699456466e-02   +1.397008500341659e-01   +1.248430842107097e-02   -2.487735616336479e-01   +3.123726454669749e-02   +6.021528362856146e-02   +1.875989204384506e-01];
L3E_L2E_iAMPA_netcon = [-1.080683157112121e-01   +1.091823415771391e-01   +1.656328176890044e-01   -9.509889736613154e-02   +3.448276942844561e-01   -1.683861190185948e-01   -6.672882423536032e-02   +3.285473604547239e-02   -3.695325140948560e-01   +4.739070438441434e-02   +1.671360095429689e-01   +3.715758513142574e-01; -2.877017156101536e-02   -5.274150611539617e-02   -1.531578505259396e-01   +4.833078350348843e-02   -1.351860508394896e-01   +9.376518629551434e-02   +1.990730773368869e-01   -3.125214167201824e-01   -1.806340439117675e-01   +9.953706373791381e-02   +2.973381153700989e-01   -7.847996065485868e-03; +1.501552636383565e-01   -9.060798971207384e-03   +8.893888204611453e-02   +1.488133244467717e-01   -1.657237927203439e-01   -2.533241062569392e-01   +3.412594608837345e-01   +1.032560926541484e-01   -1.339167339931729e-01   -1.215302827294071e-01   +2.513287840298247e-01   +6.104497572323250e-02; +1.519812391032873e-01   -3.725644609768941e-01   +4.680623942247802e-03   -1.364470556348085e-01   +8.804587508431028e-02   +2.913251752865066e-01   -2.603944457056123e-01   -1.715851065320539e-01   -1.083166466187368e-01   +2.755950730172017e-01   +4.168621716179632e-02   +5.209437378277341e-02; +1.348987140227876e-01   +1.521559471748200e-01   -1.268307494855828e-01   +2.257082767654312e-01   +2.880655941827153e-02   +3.217762688894298e-01   -9.081743524276331e-02   -1.240118255051952e-01   +3.367117048565912e-02   -2.038935825925505e-01   -2.994090591303841e-02   +6.032178325590624e-02; +1.296309136383071e-01   +2.031142292471710e-01   +2.174091529530451e-01   -8.025313854333690e-02   -2.208670192023985e-02   -1.731917407428275e-01   +1.232732732538849e-01   -1.559952590794453e-01   -2.500107193675590e-01   -1.893715749287389e-01   -1.410052187445589e-01   -4.230230919158363e-02; -1.425017027510714e-01   +2.023528879836986e-01   +2.468760005213060e-02   +1.754220708346760e-01   +1.058579101706388e-02   +5.385104633393447e-02   +3.488266984243449e-02   -8.121067182586091e-03   -7.324428576657041e-02   -1.074501650730577e-01   -2.411443428027595e-01   -2.334337297851765e-01; -3.544713976682392e-01   +8.891015398403915e-02   +1.645018035029124e-03   -6.224487299059261e-02   -1.916363157264917e-01   -7.267562406642147e-02   +1.538612769388494e-01   -7.072289536842227e-02   +1.432577294704332e-01   -9.702012660247655e-02   +3.378182796412322e-02   -3.462497078485608e-03];
L3I_L2I_iGABA_netcon = [-2.735830127064145e-01   -1.004562894448846e-01   +7.288634084168050e-02   -5.228817636466266e-03   +5.973924962261956e-02   -1.692388872307898e-01   -3.362921425550653e-02   -8.640071752296687e-02   -1.027512839050262e-01   +1.464359214289306e-01   -1.043192930760572e-01   +2.830698941456908e-01; +1.536813566000636e-01   +1.133057213315558e-01   -8.897989141075900e-02   -1.798936650803070e-02   -2.492153341835290e-01   +2.556079511386247e-01   -2.423802442889024e-01   -1.329816922766818e-01   -8.136703347164148e-03   +3.278740762174691e-01   -2.784345412584854e-02   +2.045242387123005e-01; -4.928465915765499e-02   -6.342721989486680e-02   -3.202227801824041e-02   -2.396499830731227e-01   +4.930360920389985e-01   -5.861697766746320e-02   -2.642436640742042e-01   +4.809556696067155e-03   +4.446645680837163e-02   -5.335375950735142e-02   -2.064327422778566e-01   -3.785332678986825e-02; -2.351621411906152e-01   +3.891867089368067e-02   +4.656157459898143e-02   +7.764487952892365e-02   -3.455084042393443e-02   -2.877041453192696e-01   +6.200359458435951e-03   +1.256087774558280e-01   +1.258593917778677e-02   +1.253169763594456e-01   +1.081096266083147e-01   -1.211001614562945e-01; +2.806256884800138e-01   +3.874994709041002e-02   +1.287439080381809e-02   +2.244723067258951e-01   -1.705073058300989e-01   -1.856768164407092e-01   -1.476220989293263e-01   -1.330546276723403e-03   +6.393923522810498e-02   +3.771537091784149e-01   -1.455062061857401e-02   +2.818290733123867e-01; +1.603119944888669e-01   +2.301098609490970e-02   -4.206846957113559e-03   +3.017009143268539e-01   +1.059768872300284e-01   +8.697243654947094e-02   +8.227251726185755e-02   -7.360667128948759e-02   +4.157648687828457e-02   -6.209660081312528e-02   -1.978441031901425e-01   +1.100992518388986e-01; +2.127525306868537e-01   +1.586929918566125e-02   +1.026859417979825e-01   +3.715222937584960e-02   -1.488901458698997e-01   +6.281774771424189e-03   +2.347768594186510e-02   -4.349264897875494e-03   +5.372777954252309e-02   -1.511346963122352e-01   +6.833410993582947e-02   -1.662826361772893e-01; -6.881128716725982e-02   -3.017681483649016e-01   -7.878863023501623e-02   -2.884007088246323e-01   +9.498107013857726e-02   -4.061640443229590e-01   -2.141602144139692e-01   +7.767742499779334e-02   +7.765286560954132e-02   -1.192223396020216e-01   -1.035808136099613e-01   +6.159539786127658e-03];
L2E_L3E_iAMPA_netcon = [-1.112384898995506e-03   +9.041374995651447e-02   +3.820273853333256e-02   +1.713869906839538e-01   -7.077693697609794e-02   +2.060077731922578e-01   -5.159079052474894e-02   -1.415379481583124e-01; +1.111597328467706e-01   -4.916918783169979e-02   -1.992800265099468e-01   +9.894798180422840e-02   +2.998043575497465e-02   -2.188060660758003e-01   -3.154751364602009e-01   -9.255332667267330e-02; +3.619319891910866e-02   +1.170812317377973e-01   -1.306999448598451e-01   -3.174496226763222e-02   -2.146330737375268e-01   -7.091328379212469e-02   +1.199970792648871e-01   -3.407650233735371e-01; +2.810507635394791e-01   -1.466688829058803e-02   -3.012165736915676e-01   +1.040800777928579e-02   +1.131728827795955e-01   -1.841755132907871e-01   -2.816358234633526e-01   +3.476886035401957e-01; +8.551251243635850e-02   +8.971375394261759e-02   -1.203609871103623e-01   +9.445370149847766e-02   -9.336193773072121e-02   -5.963885993986798e-02   +4.178846180910444e-02   -2.025639713266753e-01; +3.732507796331188e-04   +2.970908124600949e-01   +1.264229456673094e-01   -6.341783811944113e-02   -2.273831711313321e-01   -3.127752302626238e-02   +2.212176922553494e-01   +8.180925555130017e-02; +2.326591374563435e-01   +1.242947160163506e-01   -6.920076978714935e-02   -1.911759555316276e-01   -2.024450187468157e-01   +3.256163241261286e-01   -3.056609460773440e-01   +2.894952613127310e-01; +1.627567618430298e-01   +9.847714421034925e-02   +1.461578011359060e-01   +1.538322131469985e-01   +3.386556479398073e-01   +1.111141661330210e-01   +3.420405500876787e-01   -7.557085926133894e-02; +2.670443976527527e-01   -1.009406322617968e-01   +2.801838966829522e-01   +1.704528583036480e-01   -3.144380734021693e-02   +2.034023000751966e-01   -2.151404618994861e-01   -3.544193971617304e-02; -9.871779200241888e-02   +1.644254998171290e-01   +5.041564777767701e-02   -5.348783446206109e-02   +1.499867252773016e-01   +2.152143606008419e-01   +1.710637045881346e-01   -1.105302775692218e-01; +2.815622648656865e-01   +1.828105823871263e-01   +4.534941824395163e-02   +1.669477069396784e-01   -7.420089217234649e-02   +1.816226900282171e-01   +1.748752762973309e-01   -1.152864493259052e-01; +5.788941154962358e-02   -1.591380802517720e-01   -9.527682938747811e-02   +1.100522749517523e-01   -2.406525708279879e-01   -1.044780589350125e-01   +9.457531075612818e-02   +5.769777568034290e-03];
L2I_L3I_iGABA_netcon = [+7.190905278108293e-03   -8.229878313846911e-02   +6.553188873710085e-03   +1.100183043839087e-01   -1.904032951321590e-02   +1.094950630426646e-01   -1.902395012494421e-01   -3.117594661644870e-01; +9.096169776162048e-02   +2.153998859644730e-01   -1.834288746062915e-01   +2.674676874836126e-01   -2.096364022302517e-02   +3.817940685509642e-01   +1.538405522153685e-02   -2.758657700174694e-01; -1.125110509469023e-01   +3.682931109574260e-02   +5.051522595248621e-02   +1.019548796193296e-01   +2.820742091408646e-01   -1.614351087929932e-01   +2.042481989296458e-01   -1.145796061803423e-01; -1.428239389420982e-01   +1.275357644987256e-01   -9.473545736016417e-02   +2.998833026335885e-02   -1.456070081823252e-01   +1.008583828906469e-01   -1.130349532102232e-01   -1.042170510053872e-01; -7.459553602343780e-02   +2.236727245579655e-01   -2.109902556401440e-02   -9.716714766419648e-03   -2.733072856102908e-01   +5.335787122551819e-02   +6.117243069098360e-02   +4.963325769412664e-02; +9.122679223712971e-02   -6.566360410054006e-02   +2.341235837918600e-01   -2.086984795475677e-01   +2.847246667777935e-01   +1.624842602673864e-01   +1.116400651263023e-01   -7.445955948529107e-03; -2.736572410092134e-02   +2.475718580711327e-01   -5.104237709857712e-02   -4.349339572293656e-01   +5.191370033444606e-02   -2.147262850492414e-01   -1.604029680952560e-01   +9.161300669537104e-02; +1.019581086563277e-01   -2.874798692317916e-02   +1.768366504748443e-01   +2.158608651756090e-01   -2.061184188772314e-01   +2.437067565198237e-01   +2.099795067467773e-01   +2.859767074509898e-02; -1.584100341707898e-02   +3.861178231055160e-02   +6.396262877161314e-02   -1.909573762843216e-02   +2.011360715750132e-01   +1.515896184407118e-02   -2.221103970664772e-02   +1.373003749483607e-01; +1.902957837473070e-01   -1.225719802799149e-01   +5.661629513018993e-02   +1.986014574574511e-01   -1.727783640618959e-01   +1.132413075264236e-01   +2.435731857586882e-02   +1.993358964115060e-01; -2.233813404675434e-01   +1.013834241673487e-01   -1.598803297211761e-01   +1.806167219506619e-01   -8.626718295743080e-02   -3.655921527353011e-02   +3.509614891697259e-01   -1.668944538236041e-01; -1.171213274833047e-01   -1.428613963452358e-02   +3.960062550293297e-03   +2.157694034937936e-01   -2.616178093007758e-01   +3.135609437904128e-01   -1.189388063589507e-01   -5.834742737837055e-02];
L3I_L3E_iAMPA_netcon = [+4.249849603415404e-02   -1.766784051183577e-01   -5.103895078374469e-02   +2.729020234646330e-01   +2.609716709348372e-01   -1.515409093901796e-01   +3.547148144425143e-02   +2.827585170615113e-03   -1.026405545407521e-01   -1.099071851759514e-01   -4.484853728519623e-01   +2.887411688050725e-01; +1.131851284189316e-01   -1.396179410087170e-01   -3.261846335232338e-02   -1.592488798183662e-01   +1.546115707681328e-01   -1.869415549162620e-01   -2.033856668183849e-03   +4.754767733550565e-02   -2.159859219469328e-03   +1.093035107173111e-02   +5.587981884967350e-02   +2.813321523402863e-01; +4.007119065199287e-02   +7.202716678968629e-02   -4.038927908308604e-01   -1.215900212358278e-01   +9.828285405041412e-02   -5.952951590819445e-02   +6.288981779506983e-02   -1.689148203189603e-01   -2.075882101873205e-01   -1.142064359519844e-01   +1.586578326185641e-01   -1.960565765175979e-01; -1.954417186205566e-01   +2.785156684786796e-01   -1.589480568570499e-01   +1.556553645013556e-01   +1.162378171435659e-01   +2.484185378801360e-01   -1.675372728876549e-01   -1.337153807728578e-01   +2.206770797973179e-01   -4.013744549605149e-02   -5.032876997575594e-02   -3.088260493683193e-01; +1.425266738331970e-01   -1.778083545921196e-02   +4.231680927440336e-02   +6.255917588900217e-02   +1.013341947262529e-01   +2.594957302528099e-01   -2.519887587166211e-02   -8.659616875487858e-02   +3.104182408940039e-02   +2.062972036568886e-01   -2.901839276184108e-02   -2.218926345815298e-01; -1.780220203915318e-02   -1.865389339014843e-01   -1.768791197411347e-01   +6.857941844717784e-02   +1.554546222368494e-01   +1.955369453358081e-01   +1.958602640233945e-01   -5.023664154462246e-03   -5.809591323876966e-02   -9.623369668253284e-02   -7.750914890082314e-02   +1.028705799970548e-01; -3.952125699631223e-02   +2.756268389519851e-01   -1.131455090841095e-01   -2.040645162325256e-01   -5.772943174346414e-02   +6.498059104350620e-02   +1.339449358546521e-01   +8.812010598764104e-02   +1.126504601307094e-01   +8.817586266016704e-03   -1.587081847505870e-02   -1.435607230208284e-02; +1.804512791537776e-01   +1.053336752954386e-01   -3.442934594742960e-02   -3.880662075022510e-02   +1.308174208154144e-01   -1.975441352050306e-01   -1.049382436997881e-01   -1.732434256441497e-01   +1.291563412387231e-01   -2.109237049095657e-01   +6.273085383921323e-02   -1.014295442797626e-01; -9.492341834648985e-02   +4.023710215305296e-02   -1.847673988600087e-01   +3.337563492883243e-01   -1.263345375024299e-01   +6.119673924075276e-02   -7.515441535236417e-02   -3.844320448858048e-01   +2.159168085212777e-01   -2.674549543685173e-01   -2.495257567837103e-01   -2.742712967423930e-01; -5.757093804464301e-02   +5.700930443368658e-02   +5.013249077488461e-02   -8.051576478370229e-02   +2.877579611393757e-01   -1.263754775373083e-01   +2.652102488753084e-01   +8.249124167120769e-02   +2.386071615787523e-02   -5.976151935705324e-02   +3.725824125524014e-01   +2.319223866398386e-01; -3.196899415274035e-02   -1.516624386239129e-01   -2.124263936120629e-01   -1.047797227604419e-01   +3.279581881646101e-01   -8.454466363323360e-02   +7.184648085817576e-02   -2.238382740601019e-02   +1.655747159951130e-01   +2.031998831979292e-01   -1.276656047920064e-01   +6.478761500289310e-02; +1.303082884995635e-01   -1.515073354818556e-01   +3.071007373264810e-01   -2.582272598119172e-01   +4.459347408262011e-02   -2.031953180942987e-01   -2.688628712204894e-01   +1.298917064431551e-01   -7.253938442298721e-02   -7.422206177348609e-02   +1.420315612889535e-01   +4.055442881366899e-01];
L3E_L3I_iGABA_netcon = [+6.637351149510426e-02   -2.346356375314465e-01   -1.530948847242496e-01   +8.116826076151565e-02   +2.807642512277748e-01   +6.365799335032626e-02   +2.298180066964853e-02   -8.734050863372625e-02   +2.568691554856417e-01   +5.000895247810908e-02   +3.569871325849735e-01   -1.220037878799079e-01; +1.214874627444121e-01   -1.351090313918140e-01   +1.399564295627212e-01   -4.269171256467541e-02   -3.711568173708244e-02   +9.461626890988993e-02   +5.946550505874710e-03   -1.191245820967224e-01   +1.137612755767782e-01   +1.547206919731947e-01   +1.601745687509919e-01   -5.357447829290923e-02; -2.243094462792905e-01   -2.059089226707323e-01   -1.947264482156458e-01   -6.318223768228379e-02   -3.361072960932215e-02   +1.193866412148040e-01   +1.780196936520470e-03   -2.146154465795708e-01   -4.914460976086335e-02   +1.140010517852116e-02   +3.254630546061215e-01   +2.001976243928720e-01; +1.855095116387997e-01   +1.259362306147603e-01   +1.570595937843038e-01   +6.353224965940341e-02   +8.515985204097065e-02   -1.152125740393540e-01   -3.859897997041727e-02   +1.221114549967672e-01   -1.017164150431513e-01   -1.946512617534595e-01   -1.649131813018947e-01   +2.126002233501550e-01; +2.344214345257262e-01   +1.331579332705726e-02   -3.727827554452739e-01   -8.152944175522721e-02   -2.763817736171431e-02   +2.228180416535385e-01   -2.769072567935461e-01   -1.374905707644364e-01   +7.626149893235225e-02   -1.747714875898349e-01   -2.073755842232053e-01   -1.563858273978106e-01; -1.439492230304705e-01   -2.085118496908139e-01   +9.188721007178971e-02   +2.814376436005493e-01   -9.508948953507247e-02   -2.710658632471562e-01   -2.369299997364559e-01   -8.843354639198062e-02   +2.773328065497876e-02   -1.319507141223099e-01   -2.348347204306832e-01   -1.106393368002435e-01; -6.790689075059726e-02   -4.400138957350905e-02   -7.642683447693051e-02   +1.253891657391531e-01   -1.053032799819204e-01   -1.577643438115267e-01   -1.801714109273584e-01   +1.002285572255398e-01   +3.047294281809592e-02   -3.985164644835223e-01   -2.020217603491605e-01   +8.833481470149750e-03; +1.520603452171246e-01   -1.769883810618957e-02   +4.528355232306883e-02   -1.462530550365265e-02   +1.844138581778449e-01   -3.543438607377935e-02   -1.891908897065687e-01   +2.139534870075776e-01   -4.925417236624935e-02   -5.298701353612621e-02   -1.721601155227256e-02   -1.407351801244302e-01; -8.493913083875247e-02   +2.100193490398338e-02   +2.710318111250472e-01   +1.325292649217603e-01   +3.079959274241874e-01   +6.637046650191346e-02   +2.921085112354568e-01   +6.447412863236376e-02   -1.087099911905255e-01   +7.691540235462112e-02   -8.059886072577366e-02   -1.651166578850938e-01; +2.752127559930778e-01   -2.120122880510881e-01   -7.952511226874170e-02   +1.754953960074047e-01   -8.841702180172953e-02   +1.447659702037636e-01   -1.976904044983663e-01   -1.124570437271332e-02   -1.502459818071165e-01   -6.688053155634326e-02   +5.038903172330076e-02   -1.562922496258434e-01; -3.419836170309088e-01   -1.417740597050619e-01   -2.004048749419234e-01   +7.560982855527236e-02   +1.062972499795053e-01   +1.895936290963542e-01   +2.660509786863225e-02   -7.261808411098924e-02   -1.903171670081179e-01   +1.253982851519023e-01   +1.645675805203904e-01   +2.817145007874781e-01; +2.926483411138339e-01   +2.277284761302972e-01   +1.460801192995748e-01   +6.533450245470740e-02   +1.536810469124594e-01   +2.686920817782434e-02   -1.044373246541446e-01   -2.257448086583438e-01   -7.204139458173053e-02   +9.507097020253896e-02   +1.116812146721951e-01   -1.928281941852187e-01];
L2E_Input1_iAMPA_netcon = [-9.765182067451801e-02   +6.169562169482937e-02   -5.840980593300629e-02   -2.043680593704058e-01   +1.898348216806576e-01   -1.227017334297421e-02   +1.204127846621059e-01   +6.454027631396031e-02];
L2I_Input2_iAMPA_netcon = [-1.604712640664767e-01   -9.616986170987003e-02   +1.265170132568942e-01   +1.021830732150674e-01   -1.598284260401382e-01   -1.800314349489806e-01   +9.359473771280594e-02   +4.926082781203315e-02];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.03*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.15*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.15*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.03*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.15*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.15*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
