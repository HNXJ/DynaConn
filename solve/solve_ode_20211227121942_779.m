function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-1.176025779256462e-01   -2.075231100179528e-01   +1.831509858719540e-01   -3.475843610606634e-01   +1.935607896362181e-01   -1.803093532554610e-01   +6.949151133640227e-02   -2.249743962031974e-01   -2.483822092557396e-01   +1.636654577155468e-01   +3.530964125438856e-01   -6.318202242052555e-02   +2.706511452687113e-01   +1.839102533133841e-02   +6.577386256146056e-02   +1.561713328271836e-01; +1.715853598757690e-01   +4.527603155514151e-02   +2.550834146878757e-01   +2.473312041259735e-01   -2.977107525291463e-01   +1.038951546683730e-01   -1.723162861217872e-01   +2.509939933066374e-01   -1.812933034502386e-01   -3.008564243583252e-02   +1.644566519441601e-01   +8.716112999909326e-02   +2.767220787874071e-01   +2.937812002799412e-01   +7.082314646818960e-02   +2.932102842575444e-01; +7.573232000496466e-02   -2.909259277064976e-01   +2.462672545616608e-01   -6.831231701872999e-02   -3.524514968774008e-03   -3.476862022823833e-01   -1.553988894678840e-01   -3.006218944329767e-01   -1.060622727493388e-01   -1.795347366140500e-01   +1.002912877201995e-01   -2.741921446071532e-01   +2.629287975645528e-01   -3.452717949966567e-01   -1.696274099781388e-01   +1.309624965417876e-01; +2.449664717174795e-01   +2.562748366959514e-01   -2.129837868718436e-01   +1.676943572470185e-01   +2.853143938535897e-01   -3.952150241398901e-01   +1.121376442015858e-01   +4.523658689185185e-02   +1.589258573684401e-01   -3.400284271889897e-02   +1.326371202835407e-01   -6.693260918518046e-02   +2.423580696829150e-01   +1.637451069661909e-01   +1.799072665528103e-01   +1.179556066601297e-01; +9.707215565781149e-02   -3.142567613347185e-01   -1.480830295460442e-01   -1.370990446086817e-01   +1.039451216334678e-01   +3.992013817832586e-02   +1.442577343423235e-02   -2.147974350737381e-01   -1.193552319551309e-01   +2.607948420853770e-01   -3.462695615752138e-01   +1.434446611020093e-01   -8.285114390483657e-02   +3.976540609322032e-01   +6.371960661085696e-02   -9.337640095873123e-03; +1.506550952641871e-01   +1.226930318411227e-01   -9.489724064449685e-02   -6.815835457685279e-02   +1.453574394461493e-01   -1.276026147872066e-01   -3.762760270390254e-01   -1.900198745435654e-01   -1.910118865473592e-02   -4.441113071568571e-01   -2.328838992195420e-02   +2.108859580796792e-01   +2.567271517241200e-01   +2.139517196249825e-01   -1.506154310545792e-01   +1.608024938173314e-01; +3.705752186305288e-01   -1.317721649054925e-01   -1.870058503651456e-01   +8.788209282233155e-02   -9.510312521376904e-02   -2.293253141034778e-01   +1.897022816606967e-01   -1.627819845272530e-01   -3.904182590440683e-01   +1.366826535698906e-01   -2.111166212681898e-01   -3.108546547032895e-01   +3.162320116486425e-01   -5.821473740573190e-02   -2.917214633947521e-03   +1.266083139508094e-01; -2.403554110925067e-01   -4.282964808422944e-02   +1.784274542196396e-01   +2.332541799174722e-01   +2.021273729031550e-02   -3.225196086132794e-01   +4.885270515234705e-01   -2.707959834065510e-01   +2.344398090282657e-01   +3.190530641765228e-01   +4.753002321462032e-01   +1.756776333216173e-01   +1.477573930939882e-02   +1.525046047906604e-01   +1.185918829035007e-01   -1.067229261126453e-01; -4.903304915597488e-01   +3.644681910314598e-01   +4.134190695619039e-01   -1.337047976288727e-01   -2.857946300567308e-01   +2.466284169920178e-02   -1.532384224995164e-01   +8.078980520327175e-02   -1.240933928357038e-01   +1.102905781434895e-01   +1.476746319933147e-01   -2.351019870233473e-01   +6.762461986648119e-02   -9.169140884044913e-03   -1.743538299708691e-03   +1.451622740302414e-01; -1.065756051155100e-01   +9.909454121150785e-02   -1.466999474427164e-01   +6.490648342514108e-02   -1.386979046648168e-02   -6.406260778603062e-02   +6.080750096146600e-02   -3.415888276521217e-01   +8.984027242198209e-02   +5.686343727801954e-02   +8.900005194343527e-02   +1.956591835961130e-01   +2.829403030284116e-01   -1.361449372635424e-01   +2.543066799400486e-01   -1.069366882365192e-01; -1.421819894448254e-01   -9.770614209361418e-02   -1.941994350494876e-01   +1.216153711333335e-01   -1.693523862772676e-01   -8.113530014098269e-02   -2.278563941896929e-01   -4.935798873428928e-01   +7.757667825875900e-02   -3.262361501648527e-01   +1.167058140056734e-01   -2.358505276581836e-01   -1.781768043391997e-01   -2.083561966361008e-01   +1.037306276379985e-02   +2.568336100679819e-02; +1.861508541695266e-02   -1.846480168629572e-01   +8.548966647334616e-02   +2.426187508945831e-01   +1.333574221376274e-01   +2.340209197817820e-01   +6.101043805134888e-02   -4.616660307094777e-03   -3.043589313336909e-01   +2.280560511615430e-01   -3.488365015695686e-01   -1.042879621867207e-01   -3.708844260118986e-01   +6.250540980647222e-02   +3.284981063984869e-01   -5.756304222568509e-02; +2.226721554789751e-02   +2.165567862527970e-01   -1.020430782333613e-01   -1.660492784719164e-01   +2.172144075302351e-01   +6.610994132496473e-02   -7.586911785974197e-03   -8.593628507789003e-02   +2.129649590601795e-02   -3.606988554599988e-02   -2.371252046178217e-02   -1.732186891673728e-01   -3.863217836636468e-01   +3.914050845494270e-01   +2.415707057882409e-01   +8.850269927353735e-02; -2.390479836939956e-01   +4.246555350237079e-02   -2.576378059272061e-01   +1.388266920858929e-01   +3.745328988905208e-02   -1.960426351782168e-01   +7.919625165750357e-03   -1.106227661650031e-01   +1.944119031551185e-01   -2.203302698727008e-01   -2.676162916697010e-01   +1.456331648124122e-01   +3.241481953599823e-01   -3.049478717644097e-01   +8.960143166555555e-02   -3.178329485968645e-01; +1.313096482154002e-01   -2.291980602742288e-01   -3.180097145262933e-01   -1.055427117133051e-01   +2.235678348471692e-01   +5.282766303532769e-01   +3.544212746110385e-01   +1.402366540116680e-01   -1.140290962481162e-01   -2.644480862410491e-02   +3.722200219971576e-01   +3.175964679565120e-01   +7.462010154865069e-02   -2.634021518280490e-01   -4.469936805716770e-01   -2.282696985821254e-01; -2.115553844675660e-01   -3.327312733105244e-01   -6.962049203621193e-02   -2.744092954392992e-01   -4.875183546618136e-02   +1.634445322083000e-01   -3.093754629619323e-01   -2.147443122791489e-01   +1.713819587966753e-01   -3.244563395429341e-01   +1.246659520265710e-01   +1.422049933952139e-01   +1.143299518736058e-01   -4.589276932555539e-01   -1.718260564530774e-01   +5.699897913895773e-02];
L1E_L1I_iGABA_netcon = [+5.057607029030207e-01   -3.780446356713908e-02   +2.406968874976119e-01   +1.368407743094527e-01   -1.158873843761789e-02   +1.387216433856174e-02   -3.986889394797942e-01   -2.581814545419245e-01   +1.452898673168809e-02   -1.062952446513786e-01   -1.318039063262428e-01   -1.128222167067357e-01   -3.862073700863405e-02   -8.551690116149530e-02   -1.016363453946085e-01   -4.078528501201882e-01; +2.055194160064746e-02   +2.465054377119196e-01   +3.108618983187996e-01   -2.282026383659419e-01   +2.392063998087876e-03   +1.749152849213395e-01   -1.376783152797894e-01   +1.110952341598067e-01   -3.517460008451811e-01   -7.065846737668745e-02   +2.431855904740492e-01   +5.310085117543211e-01   -3.369755144011424e-02   +7.401387770888976e-02   -4.466277119003358e-01   +2.487693595887398e-01; -3.370064858060354e-01   +2.595280200572608e-02   +1.269176050308355e-01   -6.809970463496812e-02   +4.798391241090393e-02   -1.658874340026672e-01   -1.990103899917504e-01   +4.004296854341172e-01   +1.655980677953862e-01   +5.163586723168369e-01   -5.600071948589064e-02   +3.538785183021083e-03   -2.710066453885675e-01   -1.719547674543830e-02   +3.034117240894545e-01   -7.410257556309378e-02; -3.306728500369524e-02   -1.189967489207758e-01   +2.344881366373039e-02   -2.028648229558075e-01   +2.869306719240438e-01   -1.639749266976140e-01   +2.101324884026120e-01   +2.626391658161933e-01   -3.352584853016702e-01   -1.647600065397486e-01   +7.454380705803254e-02   +2.334411800776515e-01   -3.552675377549307e-01   +2.083526070520074e-02   -2.065543326023042e-01   -1.058975877152492e-01; -3.288995360504324e-02   -2.182989391301577e-01   -2.423190370000400e-02   -1.408717415232783e-01   -3.075829662028264e-01   -1.617453646073993e-01   -6.452499845548466e-02   +2.214846072209793e-01   +6.583606420217769e-02   +4.176911296868189e-01   -3.823317002264573e-02   +4.961430923338259e-02   +2.986496035656115e-01   +2.758611464112080e-01   +2.750367595704485e-01   -1.679863816955799e-01; +2.299971612918747e-01   -7.688561632011606e-03   -4.193761672932339e-04   -1.456750709631809e-01   +8.522974193434585e-02   +2.885680029973260e-01   -4.312714735328003e-01   +2.704760078523521e-01   -1.167556776856290e-01   -1.469052016175100e-01   -1.275169427214322e-01   +6.527887412046303e-02   -1.742430953907260e-01   -1.708126034207075e-01   -9.411761647211730e-02   +2.981039404740773e-01; -3.162365122021039e-01   -5.617318888297565e-02   +6.824033170948139e-02   +5.653500178025594e-01   -2.689272128784143e-01   -2.468251908851400e-01   -1.116918792011643e-01   -2.747971281952424e-01   +1.944368691879171e-02   -4.096723713850702e-01   +6.830698130367860e-02   +1.489769735086383e-01   -2.089914277071707e-01   +2.603582966911401e-01   +1.858844634727672e-01   -1.980552154156076e-02; +3.016697095225758e-01   -3.843005555780583e-01   -1.012328306734214e-01   -5.200991220191215e-03   -1.473531209968816e-01   +6.330428422705847e-02   -3.110802139225221e-01   +1.949161150646793e-01   -1.903107605550304e-01   +8.906315420671165e-02   +1.717228940783088e-01   +1.441516234024875e-01   +2.459094212417995e-01   +3.953938919624999e-01   +3.404239039369044e-01   -4.458432585076983e-01; +6.802758080702492e-02   -4.518591121722069e-02   -7.227253646859316e-02   -8.396451347844917e-02   +3.036181095245578e-02   +3.358159365700950e-01   +2.917025933911690e-01   -1.786760632906150e-01   +4.503925071501778e-02   +6.269199361950945e-02   -4.045469066246144e-02   +1.155964984080699e-01   -2.183173499703916e-02   +2.816934830272618e-01   -1.331102738578638e-01   +1.963356449158597e-01; -4.528416563607793e-02   -1.772155636288371e-01   +1.167757062183189e-01   +1.585365820394109e-01   -1.954905125300389e-01   +3.750462669710485e-01   +1.601959609304700e-01   +6.215217465691962e-02   -1.101571813404644e-01   +4.577361234651192e-01   -2.743063003113734e-01   +2.849133000075114e-01   -2.083554353498381e-01   -8.274754783315999e-02   +1.653946925680586e-01   -3.443277860718572e-02; +5.263973799515800e-02   -1.942304420950475e-01   +5.008602547627165e-02   -1.943906993006543e-01   -1.225748290752698e-02   -5.701155663663046e-02   +2.796782819943071e-01   -4.391237883565123e-02   +2.341226164602838e-01   -1.191084418268063e-01   +6.756574087113414e-01   +1.596280945824842e-01   +1.857355493100609e-01   -2.380789379193123e-01   -6.451795959216668e-02   +1.356754351904554e-01; -1.304537346139932e-01   +3.156870192928062e-01   +6.779712216794802e-02   +3.865603413632316e-01   -1.682747228142477e-01   +2.477836354573768e-01   +5.044204659176923e-02   -3.724432332325101e-02   +5.453884978038988e-02   -1.056644214685981e-01   -8.427845410986368e-02   +2.899468595490809e-01   -2.287714921896794e-01   -8.772464995553850e-02   +3.004202666490194e-02   +6.926882094055099e-02; -6.341491476856091e-02   +4.692094595400350e-02   +1.941888168504936e-01   +7.822655635673326e-02   +5.184993031902919e-01   +2.496982858481516e-01   -3.173270058876868e-01   -7.764742019246693e-02   -1.436079862134526e-01   -2.091838417492198e-01   -2.790727617296646e-01   +3.440451397261406e-01   +1.387209574127881e-01   +2.339910801149232e-02   +1.938966275273076e-01   -1.567552929043312e-01; +2.793038986235535e-02   -1.400594554375991e-01   +2.791650559184798e-01   +1.472814002607747e-01   -1.508377653290242e-01   -1.059207010683446e-01   +2.700619647548837e-02   -9.927272374420534e-02   -2.807558295403451e-02   +4.535648086788823e-02   -1.402497626356119e-01   +3.354310733422075e-01   -6.653815312213485e-02   -1.364129320258201e-01   +1.622398987469324e-01   +3.540382418325819e-02; +1.883891034698169e-01   -2.194963289347097e-01   +3.718632956834106e-01   -1.382948403494166e-01   -2.129971210148949e-01   -5.703944186796952e-02   +1.078298215534706e-01   -2.680252850792653e-01   -1.967093607054757e-03   +9.843929839489118e-02   -1.908470693324908e-01   +8.219595586405902e-02   -2.182344523537044e-02   -1.909148444486515e-01   -2.114353632091054e-01   +6.215726424016045e-02; +3.034715015492605e-01   -2.958397574256600e-01   +3.351510030265621e-01   -2.160932270933417e-01   -4.527610451697624e-01   +1.937582128302475e-01   +3.194374168433618e-01   +3.727528050778779e-01   -1.233731917628015e-01   -1.123624486979366e-02   -7.912307115563110e-03   +1.544167503188235e-01   +1.583621914520127e-02   +2.280954529713321e-02   +4.012294609765485e-01   -2.551741818736177e-01];
L2I_L1I_iGABA_netcon = [+6.237558889431925e-02   +1.826144415358222e-01   -1.018574525676786e-01   +3.708561615453888e-01   -5.383169985119221e-02   -2.538957354902567e-01   +4.085182092386495e-01   +1.401276697391377e-01; -2.213622901753232e-01   +2.052878556860899e-03   -9.534174401604212e-02   -2.535574452410509e-01   +2.114529430891646e-02   +2.840715323137493e-01   +2.391043469720764e-01   -3.997688893277872e-02; +1.885718933118907e-02   -4.319213981918641e-01   -5.759672028555710e-02   -7.215247966912933e-03   +1.639719509424762e-01   -2.408205690859256e-01   -1.660894962220664e-01   +2.381139079065757e-01; +1.263545065593495e-01   +3.394987007410504e-01   -2.610941762230575e-01   +4.657647049629666e-01   +1.462014928137557e-01   -3.474993654713656e-01   +4.149695190365044e-01   -3.226181055020523e-01; -2.841119317831487e-01   +2.498271946584854e-01   +1.127104654642151e-01   +4.426694670652425e-01   +2.424525186248179e-01   -1.217154490483071e-01   -3.864824150842147e-02   -2.329945427552529e-02; -3.246743137869867e-02   -3.325262898597177e-01   +4.200914889854649e-01   -9.772258503438352e-03   +1.322303785002125e-01   -6.162928509571224e-02   -1.647226974537819e-01   +2.524191150205139e-01; +2.827110121679279e-01   -3.583505164035727e-01   -2.361563885370795e-01   -3.143747671987592e-01   +1.077452678989219e-01   -3.959612688258722e-02   +2.814357371884035e-01   -2.551835666469652e-01; +3.990915161012898e-01   -4.887447759079365e-03   +1.894826707154904e-01   +7.831189616418005e-02   +1.611595800972784e-01   -8.351038894486346e-02   -1.368117468106824e-01   -3.720770337091961e-02; +1.177059009046765e-01   -1.045664445094593e-01   -9.307369833036631e-02   -2.535694452889405e-01   -6.408211100326661e-03   -4.471160443076576e-02   +5.961404121433598e-01   -8.665222568378121e-02; -8.162575725981108e-02   +9.800430290641725e-02   +3.929541139446766e-01   -3.539704480152853e-01   -6.119978590406126e-02   -8.914774942410575e-02   -2.412209603161680e-01   -1.826206964345974e-01; +1.654332764566090e-01   -3.247330537449226e-01   -2.889518608144645e-02   +3.724522998786484e-01   -7.666376107761914e-02   +4.837702041628829e-02   +2.962069743842098e-01   +5.776849061649311e-02; -2.212274948254866e-01   -2.441190077458184e-01   -2.559204671036787e-01   +2.499610153052007e-01   +3.026816007338448e-01   -1.502674719269189e-01   -3.003834413616207e-01   +1.190329190994704e-01; -2.054488240977285e-01   -6.041779450282965e-02   -1.346756021816644e-01   -1.425538560436668e-01   -5.458323963657045e-02   +8.335162242941954e-02   -2.660488144936842e-01   -2.268718000552414e-01; +2.681167071124856e-01   -2.145834484923768e-01   +1.006700087045932e-01   -9.018958176067479e-02   -1.885883206763152e-02   +2.259340289459278e-01   +3.065632515254972e-01   +3.098411499282638e-01; -1.452258492240851e-01   -2.608515526632337e-01   -9.752220712536946e-02   -1.596228765923934e-01   +1.344264689958591e-01   +1.307461774376909e-01   -4.749739306130619e-01   -3.108392996986546e-01; -8.935263045323658e-02   +1.783926947470085e-01   +6.510259369017270e-02   -2.464512648731636e-01   -2.260229316052594e-01   -1.752390177313166e-01   +9.205513589607724e-02   +2.075948286313155e-01];
L1I_L2I_iGABA_netcon = [+1.108578384889224e-01   -9.378271473681200e-02   +1.903780668510081e-01   +3.343062108295417e-01   -4.880304885352915e-01   +1.626078251260066e-01   +1.353597384371899e-01   +1.963434531372506e-01   +1.556153932522513e-01   +3.325230871872098e-01   +2.375783670061079e-01   +1.074754853768789e-01   +1.077587171353689e-02   -2.164664278676776e-01   -2.904151432319010e-02   -2.459708797561084e-01; -2.942367543713099e-01   -2.922143089606333e-01   +8.654455113411695e-03   -7.222514211070771e-02   -6.090439318815377e-02   -2.112294384782426e-01   -1.589613986324650e-01   -3.782113638674009e-02   -3.117904339336937e-02   -1.021231238672527e-01   -1.211630582292189e-01   +1.522330010606901e-01   -1.851349059380972e-01   -2.910436010473320e-01   -2.478831366128326e-01   +8.342758839871017e-02; +1.443031420783188e-01   -4.888647444047920e-02   +2.389942425704508e-01   +2.348582175142809e-01   +1.236449460563266e-01   +7.610509132790763e-02   +1.654042187767098e-01   +2.852807874016940e-01   +3.219599397594519e-01   +3.895691296668483e-02   +2.461221025756702e-01   -2.634002927845009e-01   -5.151811969395197e-01   +1.788123391540575e-01   -1.805847273850035e-01   +3.211333833316201e-01; +1.618221047112642e-02   +1.067533556485642e-01   -1.174972997718530e-01   +7.279533057361816e-02   +9.348623477833364e-02   +1.382535727758947e-01   +9.691674178326226e-02   -2.133825310360312e-01   +2.006975023012293e-01   -1.716530835770916e-01   -2.969938232360680e-01   -2.160801436563026e-03   -9.259327463825041e-02   -3.297457743883445e-01   +9.545418158708049e-02   -3.300344507235690e-01; +1.998789187784932e-01   +2.073059716225363e-02   +1.990553892583753e-01   -1.829245676736017e-01   -1.053801808898948e-01   -2.948963516002803e-02   -5.640830154180242e-01   +1.486702015929590e-01   -1.167159954722848e-02   +5.936357925738683e-03   -9.081730282138592e-02   +3.250893040524215e-01   -1.429057606348449e-01   -1.162979584052118e-02   -1.169347690673918e-01   -1.257931056015846e-01; -4.151955143123925e-01   -1.098030393738087e-01   -3.008201031965143e-01   -1.149095458346546e-01   -1.692071675335407e-01   -7.519457467984809e-02   +3.311503718414042e-01   +2.711633449477760e-01   +3.222287178410620e-02   -2.501686331236671e-01   +6.608215549180975e-02   -3.272569353152174e-01   -1.097501115358791e-01   -9.931089517387497e-02   -2.330105506148530e-01   +3.751384061120189e-02; -2.796758165165114e-02   +4.541808632905375e-01   -1.958539880182943e-01   +1.354765500148200e-01   -8.088038273200675e-02   +4.787363617806851e-02   -1.541903308640822e-01   +1.075333906824869e-01   +4.253371621090915e-01   -6.264378728783837e-02   -2.833517430076731e-01   -3.044702061150031e-01   +4.594264753391661e-02   -1.850920100338356e-02   +7.760975924077099e-02   -1.404138652560026e-01; -1.247749877537580e-01   -4.500344356048901e-02   -6.836068128430650e-02   +8.899170180636364e-02   +1.633982544894390e-01   +4.083208718547495e-01   +7.824345028691612e-02   -4.198931142495789e-01   -5.580639181298325e-02   +8.425415496952260e-02   -1.191103677061779e-01   +9.118572251201307e-02   +1.456306509101093e-01   +1.085406293557797e-01   +1.334441142542424e-01   -1.185378025278732e-01];
L2E_L1E_iAMPA_netcon = [+2.394427678150869e-01   -3.172952456400604e-01   +1.861761760114778e-01   -6.427598197862616e-02   +2.142153604018359e-01   +7.488024528380940e-02   +1.739014149223475e-01   +4.617413954359023e-02; -3.329731080177392e-01   -1.421312604672797e-01   +2.776285838199961e-01   +2.539266017935465e-01   -4.013447871720740e-02   +2.282127395896845e-02   -2.120839009074698e-01   -4.948311773816115e-01; -7.861573755459042e-02   +3.931936893289875e-02   -3.384833881883088e-02   +2.701855765191400e-01   -1.804041677721466e-01   +2.378269003489518e-02   +4.283621770795147e-02   +2.797253843516765e-01; -9.520250724176832e-02   -1.552211866494475e-01   +9.923415614007086e-03   -3.636584808070719e-01   -1.324568012751653e-01   -2.580249698403146e-01   -1.371329924300784e-01   -5.077070874602597e-02; -3.855831245025163e-01   +1.909606366897034e-01   -3.565636744661630e-01   +2.332534341622974e-01   +8.042019979845766e-02   -8.549612765005957e-02   -4.779677609390842e-02   +1.279496156494108e-01; +2.084467765968156e-01   +3.333967181561506e-01   -1.926950215892405e-01   -2.115147260467583e-01   +1.067057299302390e-02   -1.489238854100481e-01   +1.472986991640422e-01   -1.094902626986745e-01; -2.002266386839890e-02   +2.027398409743901e-02   -1.430401034707878e-01   +8.484926805297963e-02   -1.481506053712183e-01   +2.108205668286464e-01   -1.483002855062951e-02   +1.766956920493640e-01; +1.837422739275600e-01   +2.963490648551982e-01   +1.228975310153380e-01   +2.245690885826489e-01   -5.509503827116957e-02   -1.837539828806545e-01   +3.303505868055148e-01   +2.480501739707266e-02; -1.696663688668176e-01   -7.329690856917935e-02   -2.223665925677887e-02   -1.006727589239735e-01   +9.002498575988858e-02   +3.219634542738141e-01   -1.007524093400110e-01   -6.188571647796044e-02; -3.665094285547473e-01   -2.281947259463826e-01   +1.466974093542500e-01   -2.769575786179375e-01   +9.843177442889307e-02   +2.256936988289894e-01   +2.940472045074489e-01   -4.369740349250074e-03; +4.910230989383405e-01   +4.445078059871236e-02   -1.103458846368441e-01   +3.051768158789717e-01   +4.392788692276439e-02   +1.387284916310323e-01   -6.203714205430297e-02   +2.557161497503359e-01; -1.144594206536946e-01   +6.690533968579546e-02   +5.309278047280422e-02   -2.312270387942407e-01   +1.101200541188615e-01   +2.656707432560808e-01   +3.034757015223442e-02   -3.902501379461346e-01; +3.860875092460885e-01   +1.127860109378909e-01   +2.051148073632468e-01   -1.837508585884833e-01   +1.196409390550656e-01   +5.437889076323761e-02   -4.245339820651374e-01   +1.328421233255500e-01; +3.200436637970013e-01   -1.896305858172409e-03   +3.486408035724626e-01   -4.006819629844748e-01   +2.598517045401939e-01   +3.162856098653521e-02   -2.485952737226868e-02   -3.991111776010672e-01; +2.070876908349729e-01   -1.283125554863717e-01   -4.668603057304316e-01   -6.249399497258451e-02   -1.613670641883966e-01   -6.752249685026304e-02   +1.379640885495037e-01   +9.926216925614513e-02; -4.688916936621513e-01   -1.309816921007611e-01   -3.778873575846978e-02   +3.944007752766757e-02   +8.087469018695957e-02   +1.263849199528126e-01   +4.426474632941834e-02   -2.056380584676068e-01];
L1E_L2E_iAMPA_netcon = [+1.655005030492345e-01   -1.122044892331009e-01   -1.821242122489209e-01   -1.000720028442242e-01   +4.578438900589855e-01   -1.148322164663677e-01   +6.327976962884757e-04   -3.775185635817950e-01   +3.485238095939570e-01   +2.265414159938168e-01   -2.036302841760100e-02   -2.401826759837737e-01   -1.256499304755185e-01   +2.705570961943771e-01   +2.127352989912679e-01   -4.524156256847047e-02; -1.726737559537471e-01   -1.232458001354891e-02   -2.394124751585483e-01   -1.222827988284221e-01   -2.075011974736400e-01   +7.387671683929813e-02   -4.812762736066473e-01   -1.831933580459567e-01   +1.612885887841765e-01   -9.756871814028398e-02   -2.907971828018575e-01   +4.446910012105547e-01   +2.334618908583665e-01   +2.034438821905424e-01   -5.426102508139413e-02   -3.870650761429545e-01; +6.274087054429762e-02   +2.471593642555809e-01   +2.585865855817070e-01   +2.104602949094041e-01   -4.602740111385347e-01   -1.606270089943801e-01   +4.626873461209088e-02   +1.261286318173211e-01   +3.156302040420609e-01   +2.211664170811085e-01   +5.027071744840563e-01   +3.102546086078959e-01   +9.649712887009912e-02   -1.071199011528969e-01   -3.645908032961889e-01   -7.545746598165667e-02; +5.669989042704908e-02   +2.405669015613657e-01   -3.118420630217374e-01   -3.735736810228949e-01   +2.427753824715210e-01   -2.163741207285328e-01   +2.368305134758595e-01   -2.847835586172401e-01   +2.045901939604779e-01   +1.477565346700407e-02   -2.362527237816144e-02   -5.128445257947435e-02   +9.764180325029589e-02   +2.096251672501859e-01   +2.413957816605337e-02   +1.013047908080810e-01; +6.721741394034617e-02   -6.953459976646603e-02   -3.009466976273889e-01   +6.849463648687451e-02   +4.797129495614894e-02   -4.847139408796552e-03   -1.806548555272095e-01   +8.260475323146414e-02   -5.287996119202471e-02   +8.275943353424475e-02   -1.114248380916530e-02   +1.567096819589908e-01   +3.396691721959819e-01   -2.354248712736388e-01   +2.267161807289469e-02   +1.893101211888101e-01; +2.189006085866058e-01   -9.457524845010309e-02   -1.242431023119083e-01   +1.422748854148816e-01   -3.837303740487403e-01   +7.121022420524400e-02   +6.691773050010810e-02   +1.035500841899235e-01   -3.461518728574553e-02   -2.820513959595949e-01   +1.545771803614357e-03   +2.373233788874651e-01   +1.275619140011577e-02   -4.027262605962915e-01   +8.046713303241346e-02   +1.162285620677364e-01; +2.869862184924928e-01   +4.186750231173659e-01   +1.906308385148498e-01   -3.495205223296950e-01   +2.274819852081491e-01   -1.807774067964441e-01   -2.030234748532635e-01   -1.154132360518406e-01   +3.169705264559282e-01   -3.536994480256159e-02   -1.589455442392446e-03   +2.067302823904926e-01   +3.032671862746050e-01   +1.903173465024050e-01   -7.633099533612731e-02   -2.238731862046187e-02; +1.021920218861397e-01   +2.597699505376299e-01   -1.468768144799749e-01   +1.263097304190769e-01   +2.140441754637704e-01   -1.977533446999711e-01   -3.703763067590289e-02   +1.694213423968662e-01   -9.859006444126092e-02   -6.514149950361610e-02   +2.502727547513195e-01   -1.374695239970435e-02   +3.511124417077509e-01   +2.658943684445049e-01   -3.227972618265100e-01   +1.325529505411995e-01];
L2I_L2E_iAMPA_netcon = [+2.132026504114122e-01   -7.864691398529658e-02   +2.918311563030588e-01   +3.567922430885434e-01   +9.531513674989331e-02   -3.546921802555798e-01   +2.381009290152692e-01   +1.489717895252259e-01; +2.793369123095569e-02   +2.857686089523563e-01   -2.761624034484533e-01   -1.413146398597956e-01   +6.920718705148883e-02   +2.580322725992827e-01   -1.355722269946186e-02   -2.381133024844807e-01; -1.769776512151659e-01   +4.628130512391524e-01   +2.712606560029965e-01   +7.547409824110214e-02   -1.694236850804683e-01   +3.397515542768151e-01   +2.546205421911535e-01   -1.574290278240176e-01; +4.325623538556840e-01   -3.823363044281624e-01   -5.633949648491409e-01   -9.304516708655626e-02   -8.003280870256017e-02   -1.327508280203761e-01   +2.844119427603405e-01   -2.411242155332056e-01; -4.601332623600648e-02   -3.322239096686505e-01   +4.343700388779834e-02   -1.189646316859085e-01   -4.088861594758972e-01   -2.216990797640523e-01   +2.855435931971469e-01   +4.255863664667293e-01; -3.386991540032519e-01   +1.967889597562701e-01   -1.163971303535848e-01   -1.116801023333047e-01   +6.801217487234951e-02   -1.110781758833913e-01   +1.003035428238800e-01   +1.934507709594052e-04; -1.406889535337118e-01   -3.292667292063693e-01   +1.755791681459243e-01   -3.367914628808166e-02   +7.344065044936252e-02   +5.672178952853409e-02   -4.503161045488352e-02   +1.263515919728155e-01; -3.731182008905156e-01   +7.909357306591014e-02   -1.431946594492252e-01   +1.814166230459448e-01   +1.621301664663439e-01   -3.619448905905632e-01   -5.180196048090886e-01   +3.860968948264842e-01];
L2E_L2I_iGABA_netcon = [+1.158423943309661e-01   +3.443373437669173e-01   +2.388515518945549e-01   -1.811272100216212e-01   -1.146320360458926e-01   -1.328528966628230e-02   -1.749006981467796e-01   -2.883087824224957e-01; +1.238666557699566e-01   -1.798100967477763e-01   +2.620295855662542e-02   -2.938423298846564e-01   +9.764595348959794e-02   -2.820820598715120e-01   +1.819555995369010e-01   +3.657326535349704e-01; +1.736542149143788e-01   +3.395872434848691e-01   -1.718621764839101e-01   +1.781393413874616e-01   +2.359593328651933e-02   -1.915341284773922e-01   +9.281186987326298e-02   -9.893826164418179e-02; -8.682813341649512e-04   +2.164903216404452e-01   +2.741753631287169e-01   +9.051200112546584e-02   +7.522827373841716e-02   -2.698506510640514e-01   +9.767289721577656e-02   +7.848561789702836e-02; -1.757816570662114e-01   -2.957713606676574e-01   -1.323167297966262e-01   -2.103656475902562e-01   +3.926074532607777e-01   +2.851122921032546e-01   +2.893722858464706e-01   -2.827650896268725e-01; -3.067531287949563e-01   +3.075145291391969e-01   +1.285902938161774e-01   -1.844811683426739e-01   -2.751525750296793e-01   -3.232082752427129e-02   +1.276688986356223e-02   -1.163051529450882e-01; +1.365633043641126e-01   -3.618235069340001e-02   -1.831056754076540e-01   -2.025531132040636e-01   +5.479857211466654e-02   -1.494929321664491e-01   +6.186846189414197e-02   -1.411601621056108e-01; -2.828181204164145e-01   +3.051198111359931e-01   +2.183150458683366e-01   -8.052566196413383e-02   +2.279528781734869e-02   -4.376512720828651e-01   -9.347454536077934e-02   -2.670050497952885e-01];
L3E_L2E_iAMPA_netcon = [-3.843973063546167e-01   -1.055154266542272e-01   -1.923147958530059e-01   -5.158669192072218e-02   +6.798284568049416e-02   +2.775801567591498e-01   +3.085458012029827e-01   -8.452737101924504e-02   -3.766712014122084e-04   +7.703023335278432e-02   +4.946291493272970e-02   -1.290948375764631e-02; +2.610067185703455e-01   +3.734466862318692e-01   +1.327113740659701e-01   +3.304704274278054e-01   -4.112218094697656e-01   +3.193778166865145e-02   -2.488456718576427e-01   -1.610459772379028e-01   -3.152976525929925e-01   -2.196356995025638e-02   +6.860821663141596e-02   -9.988199526660078e-02; +1.028143270232760e-01   +1.980432137900530e-01   +3.388701870890312e-01   +8.003942737468484e-02   +1.105750863369283e-01   -1.866508058465560e-02   +2.630648166743015e-02   -6.449752362747199e-02   -2.706293398885933e-01   -2.736184562228031e-02   +2.987731741044084e-02   -2.051268078595487e-01; +2.241901643567802e-01   -1.142597841377790e-01   -1.735712768014286e-01   -1.027661776578104e-01   -1.188606490234658e-01   +5.299290278111271e-01   -2.335666736997800e-01   +3.342743886918873e-01   +2.291568864756595e-01   -2.345622661490713e-01   +1.774123954481878e-01   -5.919506562407720e-02; -1.456116690277456e-02   +8.439230971528941e-02   -2.443578102269299e-01   +3.419782583007144e-01   +2.274101610888017e-01   +1.300349734562216e-01   -5.137374128105554e-01   -1.783525203857036e-01   +1.756525772249214e-02   -9.517499581264025e-02   +1.033342251383138e-01   -8.730052218206834e-02; -3.140293370316791e-01   +2.869307123920395e-01   +1.807429523735885e-01   +4.461694408227891e-01   +3.717875135195084e-01   +2.613836842754904e-01   +9.620126373304089e-03   -3.488949118011931e-01   -2.302505334037105e-01   +1.342404776326598e-01   -1.916161471230018e-01   -9.467529149253606e-02; -5.302850071966522e-02   -4.570349671647795e-02   +2.232718103499422e-01   +1.158519333912256e-02   +1.885365333680750e-01   +3.160422362118919e-01   +9.944610108521088e-02   -1.882222302290652e-01   +1.102207029114161e-01   -2.542825281290065e-02   -1.200890970702144e-01   -5.637122547119863e-02; -2.376849251783891e-01   -8.558813776279307e-02   -2.861580756229057e-01   +1.898159010394451e-01   +2.921238972476052e-01   +1.818931972859621e-01   +1.008532111192513e-01   -5.442143192302742e-02   +1.344338641575098e-01   -2.473010256228684e-01   +3.095279976927958e-01   -4.153102484761895e-01];
L3I_L2I_iGABA_netcon = [+2.600286574578506e-01   +4.970506916310145e-01   -1.384132870222800e-01   -2.047692792555806e-02   +1.021377898586802e-01   -4.402357990131081e-01   -3.974449431452019e-02   -1.071306159737836e-01   +6.585332689961157e-02   +1.328030578912744e-01   +2.042517448362804e-01   +1.340929703308088e-01; +2.002348859904792e-01   -1.863269599033635e-01   -5.417343798446325e-01   +2.108649191781432e-01   +4.606070981632630e-01   -2.700035303906378e-02   +7.495571114158482e-02   -2.801403277658923e-01   +1.084503946316903e-01   -3.496542939249362e-01   +2.181416597793364e-01   -5.053078638775103e-02; -3.042186089076099e-01   -1.304404195968277e-01   -8.363232875761223e-02   +3.190764296957004e-01   -9.872613008499176e-02   -2.284213364365285e-01   +8.016873579100622e-02   -3.923314560751168e-01   -1.827477790478201e-01   -1.904351593006629e-01   +4.788651698017907e-01   +2.577947432403221e-01; -2.874626095285337e-01   -2.882959581254119e-01   +2.635078451344054e-01   -1.134336251649817e-02   -2.974165237843153e-01   -2.235556595611993e-01   +4.574420573895558e-01   +1.269086586367940e-01   +8.276504574527585e-02   +1.110815942707704e-01   -9.760461601792625e-02   -1.275177932583881e-01; -4.440129829361522e-02   +6.587870948429098e-02   -9.670078025491080e-02   -1.085269165110873e-01   +1.234606842863341e-01   +3.991740618487202e-01   -3.724704123278352e-01   -4.180847495184305e-03   -4.458565586452128e-01   +4.645040276484200e-02   +3.564850399946963e-01   +2.935964302784044e-01; -1.595339308936164e-01   +2.212722695393347e-01   +1.423536487736879e-01   +4.558722834688076e-01   -2.250240891911919e-01   -1.841828221474992e-01   -2.843431038116567e-01   +3.464068790053483e-01   -1.103745174980399e-01   -2.417110111734802e-03   -3.768180864985418e-02   +1.683883209577232e-01; +2.292007008936744e-01   +1.438013339241846e-02   -1.509751843199032e-02   -4.914112362645265e-02   -2.296169524172416e-01   -1.050249764674768e-02   -4.760746970482882e-02   -2.392401341928958e-01   +8.108894431635807e-02   -6.080208726496648e-01   -4.264783743549326e-02   -2.311963798480563e-01; +8.815194393977441e-02   +8.342909286467677e-02   -4.277152979623487e-02   -8.727379591449208e-02   +3.547710852265921e-01   +1.980562952486521e-01   -1.843378482900239e-01   +5.817809354012433e-02   -4.776412061231373e-01   -3.985951121712952e-01   -1.046954967479445e-01   -2.348848821273317e-01];
L2E_L3E_iAMPA_netcon = [-3.632154123711139e-01   +2.316421502724327e-01   -1.776445783568216e-01   +1.305541182088333e-01   -1.741534285181248e-01   +2.766905577943116e-02   +3.237294951265368e-01   -4.893121428051861e-01; +3.013163319386031e-03   -2.484769411760439e-01   -8.154204575043482e-02   +9.526811038871888e-02   +5.756220850387545e-02   +1.641854621543344e-01   -4.699948966525393e-01   +1.255184903421883e-01; -2.534869366045382e-02   +1.476611542352529e-02   -2.296982435503963e-01   +2.797154933710562e-01   +2.499684786287117e-01   -2.672919270944654e-01   +7.193215239640011e-02   +1.161519372192803e-02; +2.484048153215692e-01   +2.836145256843134e-01   -2.166586325890559e-01   -5.282437952654932e-02   -2.317353426935286e-01   -3.102184764099978e-01   +1.098762668497836e-01   -2.230448402314929e-02; +2.651283207992637e-01   -6.253635083196808e-02   +4.800603513435993e-01   +3.294167746569531e-01   +2.496126594493321e-02   +1.167655236116843e-01   +3.919243548107225e-01   +2.056526171494432e-01; -1.046364234011417e-01   +1.372965569913245e-01   +2.425218258457832e-01   +1.567706985635163e-01   -6.667978940781821e-02   -3.515233177299081e-01   -1.254724844300570e-01   +4.014176451508528e-02; -5.499834487828509e-03   +1.199269552318762e-01   -1.013401119009347e-02   +5.131524039065366e-02   -5.192958793401851e-01   +2.446816031138638e-01   -1.424707667180085e-01   -4.782512245793855e-02; -2.452522643099228e-01   +2.983361367932723e-01   -1.236591824956157e-01   -1.161038761577435e-01   +3.217087083386012e-01   -1.747658562784088e-02   -1.871697790226601e-01   -6.848609607897349e-04; -2.586813648780108e-01   -1.398037428945390e-01   -7.552927974446327e-02   +5.959251420297133e-01   +6.594700061599476e-02   +2.831369479242828e-01   -8.974055499993545e-02   +1.107512014410396e-01; -2.231826519626677e-01   +1.084643994983892e-01   +1.888987319718471e-02   -1.938881746245587e-01   +7.458818669165874e-02   -3.799339274711222e-02   +1.145507817036807e-01   +1.837307047323669e-01; -3.093811014563733e-02   -2.577351144878596e-01   +1.950375183958972e-01   -2.369604517900062e-02   +2.076961789183571e-01   -1.763449656807392e-01   +2.210180059208045e-02   +2.628081995458448e-01; +6.280750508704649e-02   -2.140363063070612e-01   -1.241819624938571e-01   +2.382880058130320e-01   +2.736033687286601e-02   +7.933479577709454e-02   +1.539600099259358e-01   -2.020642591110844e-01];
L2I_L3I_iGABA_netcon = [-1.135505892496234e-01   +2.270862857628524e-01   +1.392857246316921e-01   -2.872678190467470e-01   -1.161899020205733e-01   -1.293728767760346e-01   +7.543299628176880e-02   +1.341926740830883e-01; +6.032153030695479e-02   +8.141580340733431e-02   -2.275742002785314e-01   -3.012555706516147e-01   +5.151926236862490e-02   -3.609215961428004e-02   +1.330522333066440e-02   +7.570727742001167e-02; -3.479362062441690e-03   -3.099027048101878e-01   +3.948953292938853e-01   -2.329219411259123e-01   +5.421832028376298e-01   +2.768593720797295e-02   -5.611064640853305e-01   -1.744010313765133e-02; -8.927005946058691e-02   +1.426786897214386e-01   -2.747285730457527e-01   -7.781262670940173e-02   +2.599529132334649e-02   -1.974058648206725e-03   +1.616068524734649e-01   -3.558439622914523e-02; -2.981183973431106e-01   -2.577051625102855e-01   -1.482854271961010e-01   +1.094739731101105e-01   -2.642722658958426e-01   +2.005514751610986e-01   +1.363725566774823e-01   +4.531039079768886e-01; +2.866729044562828e-01   +4.358923981058856e-01   +1.771549164730973e-02   +1.121077836462427e-01   -6.062507779283791e-02   -1.537089591379215e-03   -4.421701681922866e-02   +2.193391780482281e-01; -2.082331657529836e-01   -7.303778684616219e-02   +8.747204509371470e-02   -4.558107292386818e-02   -1.075918073674981e-02   -1.206979021906448e-01   -3.449448692899965e-01   +1.464479861505852e-01; +1.922973161176575e-02   +4.129028965395349e-01   -2.038419071663970e-02   +1.592197411232663e-01   -2.350814252155837e-01   -3.795180381911321e-02   +1.048423218763052e-01   -9.619522964894138e-02; +5.330144507899358e-02   -1.352018542994153e-01   -3.596908823637766e-01   -1.912252122578129e-01   +2.059837864482289e-01   +1.417519462412556e-01   -1.350416451929990e-01   -2.765626877188307e-02; +3.220695953207043e-01   -1.717219779005880e-01   +5.440034439273689e-01   -2.998873817222658e-01   +6.429175899464712e-02   +2.687429374035763e-01   +2.538751150123023e-01   +3.320500670212366e-01; -3.693253680972289e-02   -3.457778568161273e-03   -4.142891685314022e-01   +9.044434659297358e-02   -2.224858450987064e-01   -2.148631795669333e-01   -3.086245165759819e-01   -6.997205664636089e-02; -2.740799727390543e-01   -1.973269416023844e-02   +1.249717576349313e-02   -2.939173752435985e-01   +4.606995471133179e-01   -1.701051680295064e-01   -2.433275250522371e-01   +2.428520315624961e-01];
L3I_L3E_iAMPA_netcon = [+2.330208034582049e-01   -1.486458279617755e-01   +3.372605959290263e-02   +2.011549728833445e-01   -2.317902061137382e-01   +8.297332105213504e-02   -1.293017789434327e-01   -4.002129535632463e-02   +2.464485935688301e-02   -4.552961971236896e-02   -2.737869113166435e-01   -2.825237264257103e-01; +2.571859927594421e-01   -3.007818094741856e-01   +1.871932173186071e-01   -3.345663491532649e-01   +1.780575399537238e-01   -1.682420071893744e-01   +3.470814628636916e-01   -2.698313022408182e-01   +2.622124307279755e-01   -9.768971995376213e-02   -1.159189198209125e-01   -3.229015023604676e-01; +2.210300635933009e-01   -3.045044848535375e-01   -2.634984014155626e-01   +5.509609136433437e-01   -5.224663766966432e-02   +7.749260833168117e-02   +2.042830635841855e-01   -1.594219773693356e-01   +7.686836751203632e-02   +3.796864888861204e-03   +1.036943709532088e-01   +2.592654270875436e-01; +3.862624219346296e-01   -3.182311390132740e-01   +1.680851718825597e-01   +1.036483500401967e-01   -1.959682541913382e-02   -1.860210722783506e-01   +1.506886964110609e-01   +1.002041522786554e-01   +7.132765149340166e-02   -2.061735390483697e-01   -3.857727384874633e-02   -2.264545633534863e-01; -2.626018365914375e-01   +2.069795885748246e-01   -5.068236297404036e-03   -2.111177458663791e-01   +1.535883751144950e-01   -5.043660185492165e-02   -4.501379796713785e-01   -3.410874902773887e-02   -1.979179973647783e-01   -8.120125431244103e-02   -2.118511920620110e-01   +9.726761833072471e-02; +8.640913910827069e-02   +5.770466744792401e-02   -5.081780308144490e-02   -1.891278809624355e-01   -1.987466326271790e-01   -7.412023856891051e-02   -2.549880351156518e-01   +6.286668775292503e-02   +3.107524488667276e-02   +1.802131764835197e-01   -2.324545197216186e-02   -6.667014577384348e-03; -2.375925554150894e-01   +2.347536659716036e-01   -6.431522443028831e-03   -1.435967078457100e-01   +6.021431028104893e-01   -2.409687236665752e-01   +1.825545251576892e-01   -3.023780103948523e-01   -9.297280918531686e-02   -2.172353804781466e-01   +2.020764957690755e-01   -2.832823423884896e-01; -3.585615521623640e-01   -2.328977296984147e-01   +2.723226117773251e-01   +2.358997718258039e-01   +3.844185239404887e-02   +3.557751681807106e-02   -1.739234160122932e-01   +7.904734257543962e-02   -3.633326440371562e-01   +6.553919232393507e-02   +4.681484396740249e-02   +2.318628539060796e-02; +9.662326040522455e-02   +4.275384813584514e-01   -8.537732631148437e-02   +5.168897114351978e-03   +2.308644369035645e-01   +2.542934758824769e-02   -1.047168056742556e-01   -2.851736973993924e-02   +8.645174980754511e-02   -3.013932095538593e-02   +5.479921586391021e-02   +2.358969345888252e-02; +1.028034504939725e-01   +1.642560305736220e-01   +2.084115987447850e-01   -9.783259844998675e-02   -3.427852144502723e-01   +3.184032779337503e-01   -4.094611985030296e-02   +3.135663456100884e-01   +3.135158332320028e-01   -1.219052693261417e-01   -6.255348724437321e-02   -3.140332270257358e-01; +3.958870155882865e-02   -3.297279857243224e-01   +9.798717908266447e-02   +1.032455539114676e-01   -9.987747919170337e-02   +1.580632226929178e-01   -2.697752804743626e-01   +4.436741529534369e-01   +2.764032902536742e-02   +2.447473649540673e-01   +2.812054828517809e-01   +2.166195224681718e-01; +1.869925962675148e-01   -3.205105602183893e-01   -3.376924221094366e-01   -2.070568302799918e-01   -2.288642396398840e-01   +9.242366741903446e-02   +4.460852101798320e-02   -1.170936141746910e-02   +1.277006732123382e-01   -1.842238822788403e-01   -1.367080662908787e-01   -3.011776774891410e-01];
L3E_L3I_iGABA_netcon = [-1.197434972837535e-01   +3.977372153829693e-01   -1.177861790273061e-01   -1.296438556560592e-01   +2.469149249191315e-01   +1.806087131463337e-01   +2.334300084911946e-01   -5.263723355540797e-02   -2.600774922011521e-01   -2.157085452687643e-01   -1.589559089454463e-01   +2.065044123104700e-01; +1.383386104668816e-01   +2.868815394156249e-01   +3.948124709512002e-03   +4.034896421339312e-01   -3.419005119728684e-01   +1.668965215606421e-02   +1.037940541178236e-01   +7.771533904319636e-02   +1.261471312005664e-01   -3.786376297688749e-01   +2.903899757460507e-01   -4.826654490162142e-02; +1.881176962111916e-02   +6.199922608892819e-02   +2.551604105683981e-01   +5.133292546689470e-02   +7.882028972048899e-03   -1.770603810435506e-02   +2.578980502501061e-01   +1.208811988403320e-01   +1.657056696278109e-01   +1.734088552516890e-01   +5.937875269960313e-02   +9.649237076331886e-02; +4.113854069718209e-01   +1.179554958499622e-01   +1.056367909070875e-01   -2.481344876414886e-01   +2.601879880243396e-02   -1.282826709000742e-01   -8.837347328728938e-02   +1.338862775548184e-01   -1.552532387624394e-01   +2.951327260139654e-01   +2.775499129424747e-02   -1.731542831202520e-01; +1.833749967600614e-01   +3.586841769723275e-03   -1.881275427031082e-01   +2.577357363078556e-02   -1.364833685237526e-02   -3.486699378736348e-01   -1.219226584275068e-01   +5.422877397049523e-02   +8.774652175589333e-02   -3.595598319876602e-01   -3.096110256717642e-01   -1.810646182166460e-01; -4.783838827346012e-01   +1.825052010022297e-01   -2.681426989438572e-02   -1.005230028648479e-01   +4.978241311229208e-01   +3.592039054381744e-02   +1.546427182258912e-01   -1.413413980271757e-01   +4.672075941345419e-01   -2.585988143389760e-01   +2.956818903718463e-01   -9.178209302631764e-02; -6.980410433633889e-02   +1.727734445923844e-01   -9.742562795392715e-02   +2.523672259492977e-01   +2.962849915199672e-02   -4.636853063143790e-01   +5.489353238829214e-02   +1.716823597928765e-01   +1.949530534134446e-02   +7.378232097960853e-02   +7.685264617671290e-02   +8.161112090949292e-02; +6.269763732635419e-02   -4.473306987942060e-01   +1.827028341122629e-01   +5.383188230565964e-02   -8.161069649947666e-02   +2.766258156193378e-02   +2.853328797976530e-01   +1.040567325178892e-01   -3.301063279588030e-01   +1.718952811824539e-01   -2.707121438845602e-01   -1.446571936833368e-02; -4.790709376632504e-02   -7.533275057989838e-02   +2.638315861704819e-01   +3.235826931416930e-02   -1.669967058409597e-01   -4.341508387798679e-02   -2.712629501704348e-01   -5.283586831777374e-02   -3.634009770880479e-01   +1.300852719747338e-01   -1.870662091664202e-01   +1.320631727983661e-01; -3.514167361596098e-01   +4.492211643526808e-01   -2.141979092783062e-01   -8.828934305572901e-02   -1.259038407360838e-01   +2.111576761308367e-01   -4.401828194221527e-01   -3.627636013295644e-01   -4.287342597582689e-01   -4.671582389441617e-02   -7.543235254525268e-02   +2.667014172229669e-01; +2.997902003173368e-01   +1.019348740133128e-01   +6.110579909035857e-02   -3.707655675290726e-01   -5.663568464655543e-02   -2.421047518446331e-02   -1.143453023558612e-01   -2.363914355068370e-01   -8.417830893492005e-02   -9.474125754516233e-02   +2.647887146370692e-01   -1.657410038151114e-01; -6.919640808363156e-02   -2.978638700274555e-01   -5.800104143610524e-02   +6.180414895015654e-02   +2.650069170798156e-01   -2.337886407125496e-01   +1.175300995414317e-01   +4.367165673683848e-01   +1.194605937053905e-01   -1.282046471742913e-01   +2.292395610169952e-01   -9.138217966238744e-02];
L2E_Input1_iAMPA_netcon = [-1.720411858910940e-01   +3.770474190874896e-01   +2.480273563765639e-01   -2.867766322260277e-01   -6.348188346578958e-03   +2.738988700967450e-01   +2.374892185448901e-02   +2.864516097328410e-01];
L2I_Input2_iAMPA_netcon = [+3.412973657549772e-01   -2.701098871994040e-01   -3.274711829397384e-02   -9.073143839222132e-02   +3.746482807847998e-02   +2.786330681658296e-02   -8.833419678093943e-02   +9.037226907465279e-02];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.03*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.15*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.15*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.03*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.15*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.15*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
