function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+3.752916106695129e-01   +7.374817551149051e-01   +8.450215209677149e-01   +2.206018252037206e-01   +2.492515495652370e-01   +6.651648197097698e-01   -6.897884082378147e-02   +3.732309441108257e-01   +2.099231172318188e-01   +1.706363177288452e-01   +3.820734430391254e-01   +1.929912323758978e-01   +4.822756191454921e-01   +2.743299358524748e-01   +2.580289018957744e-01   +2.073150356414391e-02; +9.057486887828201e-02   +8.741634648038176e-01   +8.057120609023920e-01   +7.044168105592903e-01   +2.857853808072551e-01   +6.782140310438349e-01   +6.718488049967447e-01   +1.896089360768554e-01   +1.387619891325898e-01   +7.525689979815864e-01   +5.515015521708457e-01   +5.882680415797424e-01   +3.860791983782207e-01   +2.375745953834817e-01   +6.086135706444891e-01   +2.576847069038044e-01; +2.117032744361516e-01   +3.158492982910174e-01   +4.096231372759103e-01   +4.783992077225183e-01   +5.939194588999958e-01   +4.307343271478228e-01   +8.219894200531106e-03   +6.162493809378864e-01   +3.041617226998712e-01   +5.256495083486059e-01   +7.662486724696635e-01   +2.314270092904422e-01   +4.130215757191350e-01   -4.199533865010386e-02   +3.329738076091575e-01   +8.909659715925736e-01; +2.193438849101954e-01   +5.936167151118191e-01   +9.249751528981651e-02   +2.258019102609075e-01   +7.862838735501902e-01   +7.929114528912437e-01   +2.224855174477814e-01   +5.621454159639266e-01   +6.730675688358561e-01   +2.024706681562419e-02   +1.855020841863731e-01   +7.749580554709632e-01   +4.791828138159107e-01   +1.792889242167786e-01   +5.496309366888608e-01   +4.458721892971316e-01; +7.415806556707938e-02   +6.852250944792869e-01   +7.684381694428369e-01   +7.342137280443384e-01   +4.727948376162278e-01   +3.045574083588224e-01   +4.584560403947875e-01   +3.095335501134808e-01   +3.306158326267271e-01   +4.694508284300056e-01   +1.998779568129818e-01   +6.530123726091445e-01   +3.709234509390795e-01   +7.574097933347149e-01   +2.147521237233498e-01   +8.310082662736101e-01; +1.464460377057650e-01   +1.632027175642183e-01   +6.883588638962568e-01   +7.540044311016334e-01   +5.591654871707515e-01   +8.214184320332263e-01   +2.840192376103272e-01   +4.069237999762212e-01   +7.952143335145715e-01   +8.611679784653050e-01   +8.120270309026308e-01   +1.492416909528314e-01   +4.337809285669374e-01   +1.522806510948881e-01   +8.334499018907451e-01   +3.729305785063834e-01; +3.205345587151425e-01   +6.503712465712860e-01   +6.332816975256118e-02   +3.514311078806768e-01   +7.586221648405099e-01   +5.077559649230029e-01   +4.224449461052122e-01   +5.489602045459755e-01   +8.602425134456708e-01   +8.611190801306238e-01   +6.274873130052525e-01   +1.227068312333583e-01   +3.064663772807897e-01   +3.696978847045044e-01   +6.541764041657416e-01   +8.263600248387755e-01; +6.315788295348418e-01   +6.939615035682860e-01   +7.190240252338610e-01   +3.120992507743148e-01   +5.899349323124485e-01   +5.224075281477834e-01   +7.463277110664289e-02   +3.991582829567564e-01   +1.000000000000000e+00   +8.108824275472184e-01   +1.717021301062697e-02   +6.937674275352792e-01   +7.496405961297545e-01   +5.430040200279717e-01   +2.559849534219679e-01   +7.957506651251226e-01; +4.549533535999786e-01   +2.931449868422659e-02   +2.241375306315582e-01   +4.267263380891061e-02   +4.050931234766632e-01   +1.639455862835802e-01   +3.657552124934239e-02   +5.206590799771854e-01   +4.463535208079972e-01   +7.358307037882811e-01   +7.444699330223242e-01   +4.619030705715372e-01   +2.303110680128131e-01   +1.831057946912429e-01   +8.877291629199207e-01   +7.625452890220087e-01; +6.384962687980009e-01   +5.026450010713369e-01   +5.522086121881542e-01   +2.493368560605036e-01   +4.319796450684015e-01   +2.684799177388671e-01   +2.442408671355558e-02   +1.950565002027478e-01   +8.155351789374904e-02   +7.116919893909899e-01   +2.503395320246255e-02   +8.453200583395641e-02   +3.152886440197568e-01   +7.502845949281047e-01   +2.854125866306140e-01   +6.983076255763080e-01; +3.466098529633280e-01   +6.180316798249825e-02   -1.807001812513913e-02   +1.679856637490160e-01   +8.358496294262484e-01   +5.820556503366106e-01   +2.077798393306831e-01   +1.697839648063866e-01   +1.704308662559658e-01   +8.341960701251019e-01   +1.360584225936622e-01   +7.242250458827930e-01   +5.268603416545293e-01   +7.458658361067021e-01   -1.985111132619700e-02   +7.892426036650414e-02; +1.298064930466141e-01   -5.776508943827411e-04   +8.687021579018912e-01   +4.635545536802510e-01   +6.224718451435919e-01   +4.976242576471905e-01   +6.588612934802962e-01   +3.571185329907922e-01   +6.133440005807073e-01   +1.020614260583002e-01   +2.507229113635013e-01   +7.481481834183855e-01   +3.007050390959570e-02   +5.142778378289358e-01   +3.641777122315134e-01   +5.917585337682209e-02; +3.935854092461977e-01   +3.161780992867545e-01   +6.081028946122452e-01   +2.237881081541477e-01   +7.563153639056530e-02   +4.434714401888961e-01   +3.710955254790445e-01   +6.792291711872002e-01   +2.747620433550403e-01   +8.829276307917244e-01   +1.686756711781876e-01   +4.326632855420562e-01   +1.930723186663280e-01   +2.275365996123722e-01   +2.978560839226166e-01   +1.832847737267999e-01; +1.561995600157974e-01   +8.347926102919296e-01   +6.604234498010513e-01   +6.619015050935139e-01   +7.487450874012470e-01   +5.612164174677298e-01   +2.367038606251846e-01   +7.323362246020970e-01   +3.376111664399150e-01   +4.522674915673535e-01   +7.860985704181902e-01   +6.142922275534820e-01   +5.121028338818788e-01   +4.988519991929652e-01   +8.477070631593621e-02   +3.488173714891005e-01; +1.246459789872694e-01   +1.781124213515914e-01   +9.887361016332061e-02   +3.591270942986016e-01   +3.336409732504140e-01   +2.602613378143774e-02   +6.232903877722401e-01   +2.715531907104816e-01   +7.567913515883713e-01   +4.502913128441995e-01   +8.467760744487575e-02   +7.472604190923164e-01   +5.727313883748156e-01   +1.873120029368496e-01   +6.504242182361668e-01   +1.435261827356808e-01; +5.278718524500926e-01   +1.720247201123155e-01   +3.093892354195041e-01   +5.810017475540573e-01   +5.092810694130762e-01   +5.239091144255089e-01   +1.972339470895330e-01   +6.853788247976053e-02   +5.679695469920669e-01   +4.308527786381346e-01   -6.516248486702655e-02   +3.698808295735507e-01   +1.866554988783729e-01   +8.529897464165703e-01   +8.383137355746241e-01   -4.121640965157531e-02];
L1E_L1I_iGABA_netcon = [-3.282166232171066e-02   +2.469453347987307e-01   +8.790356132705975e-01   +1.686821661378214e-01   +4.181548088544698e-01   +1.074859892043971e-01   +2.679141465558524e-01   +4.173388467965758e-02   +1.915026178150203e-01   +7.465183582556367e-02   +4.106158728518923e-01   +9.190633232281573e-01   +1.793835135617333e-01   +7.885270248898261e-01   +7.614164889055923e-02   +3.814775182950482e-01; +7.485858785325428e-01   +7.430216480937831e-01   +5.123310970567387e-01   +8.029738453360163e-01   +6.670284621543765e-01   +7.972066184028841e-01   +5.865752269679679e-01   +7.982018901590617e-01   +8.705470543430661e-01   +9.247473838410383e-01   +1.814036776040636e-01   +1.218997124249142e-01   +6.024961118502258e-01   +8.830524871001367e-01   +1.000000000000000e+00   +2.547298232864593e-01; +2.573315039469510e-01   +8.176415023719987e-01   +1.248260850253555e-01   +1.266225581121123e-01   +1.154563567286427e-01   +2.496530675224566e-01   +5.846146733161537e-01   +2.935494088774262e-02   +2.834960400892468e-03   +9.863328374776908e-02   +5.095619754351318e-01   +4.073415586882464e-01   +7.250790830919691e-01   +7.813220382759992e-01   +7.603153430799239e-01   +7.530101472560551e-01; +3.911992871640455e-01   +5.306115629865753e-01   +5.817147588154181e-01   +7.081342045626542e-01   +6.616262924798801e-01   +5.683449720055399e-01   +5.631914948664259e-01   +8.626754012790272e-01   +8.512754635271752e-02   +2.889779215244477e-01   +5.104583550639739e-01   +2.818539210076394e-01   +8.128114111681776e-01   +4.216854097961500e-01   +8.782216470783575e-01   +5.227463984309300e-01; +6.576284364123549e-01   +5.718716273982896e-01   +8.427557610981907e-01   +3.534323825387694e-01   +8.682727022351475e-01   +5.038309779582330e-01   +3.723392621343939e-01   +4.222685108096791e-01   +3.095421141978659e-01   +4.532753722835954e-02   +3.807229532143720e-02   +5.548655151708223e-01   +9.142119075664770e-01   +7.941053905752905e-01   +4.139188987433406e-02   +1.379688706814151e-01; +2.206908673612513e-01   +2.154804400282159e-02   +3.099905976143781e-01   +2.051060013199653e-01   +5.685923892981966e-02   +4.865958520324179e-01   +8.396862830558854e-01   +3.080953569781232e-01   +5.066978238484390e-01   +4.335951617441525e-01   +8.487390022964677e-01   +1.573936220601154e-01   +2.218866959041235e-01   +2.173970686403624e-01   +6.977172979094028e-01   +3.300728286253966e-01; +6.769410773597695e-01   +5.326713611932483e-01   +2.960257941065480e-01   +7.792009405013026e-01   +3.056467818677797e-01   +8.415000588411663e-01   +6.067046543397328e-01   +5.271543329526022e-01   +7.955286285362436e-01   +5.809015782011571e-01   +8.039673122978238e-01   +2.109711096164599e-01   +8.309297220674881e-01   +5.778573561777411e-01   +9.341263044693392e-01   +7.357267100304279e-01; +9.152750673467861e-01   +1.304342133244688e-01   +6.093901504686142e-01   +4.708620080779404e-01   +6.665490524070484e-01   +1.775657113224733e-01   +3.502790909888929e-01   +5.541976028622791e-01   +1.995170488876233e-01   +8.265101545018935e-01   +7.246172221785129e-01   +8.303047377374266e-01   +2.652078639312093e-01   +6.560456262586301e-01   +4.573273913449610e-01   +5.538564891034582e-01; +5.291136388681433e-01   +9.237622302839461e-01   +3.643665882338552e-01   +9.195082116746036e-01   +2.568539809212508e-01   +6.614561383213463e-01   +5.449825933235471e-01   +8.987297476477173e-01   +8.655799019957366e-01   +1.132791011855397e-01   +1.889062321024537e-01   +1.829606268148692e-01   +8.487683003562666e-01   +4.107113936657922e-02   +5.556469318360526e-02   +4.694524960548437e-01; +2.182815375119408e-01   +3.482591242089835e-01   +5.079003128769417e-01   +2.192004261707241e-01   +8.881429528356262e-01   +3.808500821598615e-01   +3.068607129667352e-01   +8.779499457859051e-01   +8.932406370840290e-01   +8.290182838065074e-01   +8.085377731636398e-01   +9.543384117961273e-01   +4.883428661329998e-01   +3.736068387893534e-01   +2.870816162181345e-01   +7.556794181811044e-01; +1.638187191915389e-01   +2.295921685288149e-01   +7.706424685123974e-01   +8.362153312601464e-01   +1.559100138640638e-01   +6.011879892609515e-01   +8.311333265663190e-02   +4.557446625176010e-01   +4.162545963873497e-01   +6.071298456383465e-01   +3.370727952463508e-01   +9.007930350069657e-01   +1.083420148873175e-01   +4.467085386348615e-01   +4.284671432555048e-01   +4.128732791399946e-01; +1.714007208217168e-01   +8.885320012197160e-01   +7.094465935774461e-01   +4.951457071573689e-01   +4.579987667803095e-01   +6.986627010895212e-02   +2.023840287999626e-01   +3.578531885259981e-01   +1.573310020788533e-01   +4.783396979558952e-01   +1.826735282386781e-01   +3.938261211132183e-01   +3.606863010854382e-01   +8.652007760753764e-01   +3.284896759365592e-02   +4.767260622496191e-01; +8.898589142826506e-01   +1.669683724397113e-01   +4.854242784242421e-01   +4.968595716890980e-01   +6.049649888651197e-01   +5.606042467368088e-01   +2.256274129287254e-01   +4.376607377332847e-01   +4.227301512654823e-01   +3.398618619274608e-01   +9.050310709520325e-01   +9.565431098375743e-01   +8.111485360254173e-01   +5.789468465103323e-01   +2.669418913014394e-01   +7.453445391724125e-01; +4.495060086177521e-01   +8.267866568768579e-01   +3.341228036765410e-01   +4.023145768663632e-01   +7.128954364449089e-01   +1.724532091800719e-01   +2.865025456205360e-01   +5.849156184633933e-01   +3.408188684169965e-01   +4.549877084777618e-01   +2.138249854691620e-01   +1.710308627302218e-01   +2.594347213110456e-01   +2.566369163935959e-01   +5.356994086910982e-01   +8.771606073141417e-01; +5.488801991191800e-01   +5.748639833312382e-01   +7.004490982176261e-01   +6.576789649837660e-01   +6.983085449000175e-01   +1.088131911598960e-01   +7.928775864984482e-01   +2.468964617236764e-01   +8.282016257290160e-01   +4.700963754955813e-01   +7.110119084508393e-01   +5.319274799019043e-01   +3.003075465580183e-01   +4.649136817860773e-01   +8.547697958770329e-01   +4.336664587173620e-01; +3.721133094304570e-01   +5.568069146521323e-01   +5.932883238254576e-01   +2.537819725365180e-01   +4.625488088400777e-01   +2.725878679901088e-01   +5.140274780491508e-01   +2.047955897919739e-01   +8.148179798546127e-01   +2.860629829043002e-01   +2.752598865413209e-01   +1.416829271367089e-01   +6.495446527775349e-02   +4.563250433485408e-01   +9.269953877015574e-01   +9.121596871317609e-01];
L2I_L1I_iGABA_netcon = [+6.391949732162493e-01   +4.561148409025744e-01   +7.037269268645240e-01   +5.570101238093743e-01   +9.358981815450403e-01   +6.566630834739491e-01   +9.264491459967039e-01   +9.231745832833543e-02; +4.683826196105141e-01   +1.496974821088005e-01   +2.101276622196768e-01   +9.460255468064429e-01   +1.958655112059209e-01   +6.207082642531589e-02   +8.223140529509003e-01   +6.519084103307891e-01; +9.973457340529841e-01   +5.273369045464019e-01   +6.597902030607602e-01   +6.735903133712754e-01   +7.473618063116694e-01   +6.364237666556912e-01   +2.939468047609309e-01   +2.327121546428469e-01; +3.625594426729599e-01   +1.738134261471972e-01   +8.717961400887848e-01   +4.344838072406633e-01   +7.528965058298265e-01   +3.289453234457522e-01   +9.219313271441402e-01   +1.613552439512566e-01; +6.900976899581786e-01   +4.959970863790890e-01   +6.397433976974168e-01   +2.256902512898019e-01   +9.145200964580689e-01   +3.553799390610801e-01   +5.417889610898714e-01   +2.293106254521596e-01; +6.088403371606449e-01   +5.586542635487908e-01   +7.438089688529802e-01   +1.595214267136695e-01   +2.303103895772049e-01   +8.096004529936202e-01   +8.649457869030310e-01   +5.470818099538903e-01; +8.300198871814681e-01   +4.883454142468553e-01   +2.472851154873061e-01   +2.797439236533563e-01   +7.230398805098344e-01   +1.542281786860154e-01   +6.735988853465250e-01   +3.470497903955510e-01; +9.724667172573540e-01   +4.183742584790411e-01   +6.018028094640111e-01   +8.663262917953274e-01   +1.032973633230225e-01   +4.338645140055628e-01   +4.431146177733459e-01   +2.499217833716866e-01; +7.462865176218414e-01   +1.776923530625441e-01   +4.771955885900032e-01   +5.999866604145745e-02   +7.139868726582946e-01   +3.560981837527822e-01   +7.368249769055347e-01   +7.125675369003065e-01; +4.551872175381999e-01   +8.067309824591555e-01   +6.065195376361773e-01   +8.017552077699576e-01   +3.466778768999353e-01   +7.998087193025123e-01   +8.516195084291043e-01   +2.798946813692807e-01; +5.568875864064655e-01   +5.916395264222970e-01   +5.141880617609512e-01   +3.617351361969793e-01   +6.279188372210086e-02   +8.671655412931388e-01   +6.041991508870495e-01   +4.455594910406427e-01; +2.283480357015685e-02   +3.970102703870054e-01   +4.014086162387979e-01   +4.181141612742412e-01   +3.700459497768974e-01   +4.756806702655583e-01   +2.838059867586786e-01   +5.393837554799210e-01; +4.019276706165950e-01   +1.863058315589411e-01   +6.478328230574305e-01   +7.491881634524851e-01   +2.140474916097659e-01   +6.643326569169932e-01   +3.407671205405278e-01   +7.177868960451746e-01; +4.975912679444598e-01   +4.724156400014721e-01   +6.501352009335269e-01   +3.665890873847412e-01   +8.041137423343145e-01   +3.949822454670585e-01   +3.616216171185704e-01   +2.775234245257781e-01; +5.403435823098247e-01   +1.701162135607801e-01   +2.120386084923243e-01   +2.093434499573632e-01   +6.367300982180872e-01   +5.308113226345246e-01   +2.346271063405611e-01   +7.309607271826825e-01; +7.622706652181112e-01   +5.773774084094844e-02   +6.924947757697636e-01   +3.502049814768406e-01   +3.679093863151341e-01   +5.630264588873181e-01   +1.517835284314670e-01   +3.153159545860181e-01];
L1I_L2I_iGABA_netcon = [+4.798019397501500e-01   +1.875781898235382e-01   +8.293356705026149e-01   +3.138123479408545e-01   +5.221265037781747e-01   +2.828525682999343e-01   +8.558394098720217e-01   +2.418934970808816e-01   +5.044305767965167e-01   +8.069754338185514e-01   +3.838190982303629e-01   +3.614481053709314e-01   -7.492358225819645e-02   +6.963075533945040e-01   +5.879817228354699e-01   +5.016110009028617e-01; +4.760168182535131e-02   -1.238851518173859e-02   +2.905384095331258e-01   +2.783944699342250e-01   +8.772130599767705e-01   +4.009672715167670e-01   +3.173663631675893e-01   +1.449012420239886e-01   +4.864745933392989e-01   +1.904888671593272e-01   +3.005466275923678e-01   +2.626729781145897e-01   +9.635022655034303e-01   +1.994491553919964e-01   +7.620853872096091e-01   +2.492251417254332e-01; +3.646655536946902e-01   +6.429434406279301e-01   +3.131797444610614e-01   +6.615973863498771e-01   +2.369251419339886e-01   +5.485667963365105e-01   +7.551699383115810e-01   +9.655937834332570e-02   +7.553338381320319e-01   +4.671620039426148e-01   +6.072832797877747e-01   +8.936694501754220e-01   +9.662531746071845e-01   +6.775821042317399e-01   +3.966779116081077e-01   +1.940586070831058e-01; +8.307207362196258e-01   +5.744446708981005e-02   +6.568044742608254e-01   +9.026296094566403e-01   +4.716962883316879e-01   +8.655139821705589e-01   +6.532594869917892e-01   +1.017472881514603e-04   +1.344948401818463e-02   +3.080545325255823e-01   +4.061098473329092e-01   +4.298349973160383e-01   +3.040297298769503e-01   +5.104176650729583e-01   +1.537905500933580e-01   +3.160710006327706e-02; +9.111967697592593e-01   +7.803777274271263e-01   +7.569483009587186e-01   +5.900552567663002e-01   +2.895070909423539e-01   +6.376871883225271e-01   +6.468172779804600e-01   +6.244693092683508e-01   +9.065854055613934e-02   +6.961103238412958e-01   +1.914207973535242e-01   +4.681571395630964e-01   +6.454646314807261e-02   +2.140966520266958e-01   +6.519618043944275e-01   +9.134440262375543e-01; +5.483122723856573e-01   +4.435143318213711e-01   +9.652294188811784e-02   +3.377807952954783e-01   +9.001265162413937e-01   +1.531525101139265e-01   +7.140711500594250e-01   +5.994511445787277e-01   +4.859454201365229e-01   +7.391686555004851e-01   +2.790856618739371e-01   +5.235117250686491e-01   +9.141840864129244e-01   +1.034144012633956e-01   +2.210696374084795e-01   +1.139748321373159e-02; +8.474975195097790e-01   +1.184870739458881e-01   +3.746224158336954e-01   +3.335666878779685e-01   +5.294242293898314e-01   +8.225758580916446e-01   +4.286719294221019e-02   +2.814657851816105e-01   +7.262982961559206e-01   +9.313004520421768e-01   +8.796485618656854e-01   +8.297155147782647e-01   +1.335220088165761e-01   +2.487059890125797e-01   +3.650337375660054e-02   +5.698842870135453e-01; +9.138745152302298e-01   +4.021487883326784e-01   +2.918482940863634e-02   +8.832860213625935e-01   +1.816795686375273e-01   +9.421070354040914e-01   +7.800171995478625e-01   +6.456742386469837e-02   +7.777180668214609e-01   +4.226098085128829e-02   +8.511660256673984e-01   +5.269524675556886e-03   +8.165527659799390e-01   +8.507371293919912e-02   +9.541353020728974e-01   +6.834173533100703e-01];
L2E_L1E_iAMPA_netcon = [+3.100037524978541e-01   +9.106678514389440e-01   +6.276084881302060e-01   +3.955026570632127e-02   +3.088409684977628e-01   +3.494755561562445e-01   +4.606729460077207e-02   +5.871045283365217e-01; +1.742281564320985e-01   +1.263227287777763e-01   +7.613885030794967e-01   +8.508919520370455e-01   +3.710314683481188e-01   +5.189844468218299e-01   +2.344865700287611e-01   +1.243264693476879e-01; +4.805093162302118e-01   +8.943908667501579e-01   +7.614429898748972e-01   +4.004699764502945e-02   +6.732245038918032e-01   +1.335332368809883e-02   +4.398364422513233e-01   +8.515620525330232e-01; +4.615961958596154e-01   +6.570130727147564e-01   +6.924181452919115e-02   +5.626923019341140e-01   +2.485441900560852e-01   +5.629919988883046e-01   +1.766339232299821e-01   +4.834381111347603e-01; +8.456773496074694e-01   +7.068536124907112e-01   +7.825192852315680e-01   +5.040516465680503e-01   +7.473686195051584e-01   +4.095607670292599e-01   +4.208552235212513e-01   +5.125950574850886e-01; +5.046747737255521e-01   +6.285381437748513e-01   +1.104619047057058e-02   +6.370579867730269e-01   +6.779142447786537e-01   +8.284228314929453e-01   +3.030329592324570e-01   +8.077491265625059e-02; +4.334973789335612e-01   +3.212132070476981e-01   +2.666846152378534e-01   +3.860647683882744e-01   +4.022944042822459e-01   +2.259681885160070e-01   +5.930859421508329e-01   +2.779938560260583e-01; +7.297636556390172e-01   +1.963333416959814e-01   -8.665959715266267e-02   +9.650026864011042e-01   +5.004331280868076e-01   +3.610121666953355e-01   +5.976846757147093e-01   +6.099010550075533e-01; +7.728739199298869e-01   +5.620830058774072e-01   +6.286657172780861e-01   +1.156379489229142e-01   +3.603737706148480e-01   +2.692705794702079e-01   +8.467997458176280e-02   +9.776576903868532e-01; -1.488867818822756e-02   +1.476150992950783e-01   +1.660117038451549e-01   +1.784045159398705e-01   +1.329105934424127e-01   +5.533511347587907e-01   +8.042599719640777e-01   +8.455404059011488e-01; -2.787217574131081e-02   +2.232986530824667e-01   +5.221728139235791e-01   +4.084392248196635e-01   +1.607620030164419e-01   +4.456768708307001e-01   +2.153015252868916e-01   +7.182866822407694e-01; +3.320271831806879e-01   +5.724125452797988e-01   +6.115938680198053e-01   +4.710678393222430e-01   +6.839514424782075e-01   +2.759614387058392e-01   +6.980119040019725e-01   +4.752772469051846e-01; +6.745497951031025e-01   +7.138837589766920e-01   +5.913405095959298e-01   +2.142264199005033e-01   +2.082499366580819e-01   +1.069030305727636e-01   +3.984498843109820e-02   +5.214489132140978e-01; +6.962814608614720e-01   +8.330536753319021e-01   +5.466297592189251e-02   +9.065691078420122e-01   +5.198659198604894e-01   +7.689731847863218e-01   -1.347473118631834e-02   +1.600093123433948e-01; +9.466675538925666e-01   +1.977007151543541e-01   +4.799009536898244e-01   +5.752817645099169e-01   +3.081961590753191e-01   +2.125919110085404e-01   +6.247866539501384e-01   +4.209224672883164e-01; +7.882399767624396e-01   +6.042794117150547e-01   +6.945716375244868e-01   +3.775167334082748e-01   +4.795987749902073e-01   +8.326056099078958e-01   +7.207171728967139e-01   +1.685499996173824e-01];
L1E_L2E_iAMPA_netcon = [+8.055444879038309e-01   +4.422074241986519e-01   +5.893047203376567e-01   +1.891145740229992e-01   +9.519002603064929e-01   +2.524778709892689e-01   +4.988156800842016e-01   +4.717516055671799e-01   +9.508216422673423e-01   +5.321909511949680e-01   +6.190872124228723e-01   +4.741596705346362e-01   +5.176148825773879e-01   +3.527269156928827e-01   +5.952919600391915e-01   +2.911519861911108e-01; +7.860222342609183e-01   +1.655932135156989e-01   +1.429537404024971e-01   +5.377620118206977e-01   +7.794273113908851e-01   +5.812724171265565e-01   +9.128479412760722e-01   +2.575178187162944e-01   +3.593085691613033e-01   +3.154714605651855e-01   +6.357893070188003e-01   +6.626832643060924e-01   +6.584081352835441e-01   +8.452361072030500e-01   +3.586811355462083e-01   +5.734091581870735e-01; +7.773045541921466e-01   +1.306200150821613e-01   +1.577910652364817e-01   +9.752007356457980e-01   +2.099065644354740e-01   +3.652732929489467e-01   +8.351223260202708e-01   +3.084281016560200e-01   +2.118249154383540e-01   +6.096144164547815e-01   +7.616359189373647e-01   +4.888011044897407e-01   +7.974987946177716e-01   +9.641414069421066e-01   +8.102516885846346e-01   +6.280091015072953e-01; +6.594928779799377e-01   +8.170301351520978e-02   +5.588183568244109e-01   +3.309887738954955e-01   +3.861093086061851e-01   +7.763854757201669e-01   +1.752244423844312e-01   +1.601534992114678e-01   +5.863615086507417e-01   +4.918585692416610e-01   +4.179628481743731e-01   +9.521299106820149e-01   +7.388895234388575e-01   -6.984193455280330e-03   +7.607549645772161e-01   +8.281304739631712e-01; +6.602568463460271e-03   +2.213622141203020e-01   +1.529464609874403e-01   +7.742698422000912e-01   +1.617559809899501e-01   +4.342767161203384e-01   +9.465203479444055e-01   +3.327282772809541e-01   +1.254221436143345e-01   +7.488852889900270e-01   +1.257863374322418e-01   +5.340392914958196e-01   +7.201023514218224e-02   +6.671987884154749e-01   +4.451086253485911e-01   +1.494796498622516e-01; +6.473776951426341e-01   +3.995831826184789e-01   +4.001466996538340e-01   -1.317559196453234e-01   +8.801582278898246e-01   +1.187560823550874e-01   +5.033272746337781e-01   +1.530655110843080e-01   +7.730400104506141e-01   +8.790127143948620e-03   +7.513997940784839e-01   -5.649500753784429e-03   +7.342789168144958e-01   +5.254622610742854e-01   +6.743418782856616e-01   +3.280351821924996e-01; +2.613133807501599e-01   +7.261610183667371e-01   +3.289064983902142e-01   +3.993079059014438e-01   +2.791714150231993e-01   +8.669634229847258e-01   +9.530613907275777e-01   +4.541354663310884e-01   +6.735121203430211e-01   +7.578314563936719e-01   +1.069621942339938e-01   +9.024937754180344e-02   +9.368521119455486e-02   +3.354795481329279e-01   +2.878702715541606e-01   +7.529481395408980e-01; +1.501801885742904e-01   +4.343762871392208e-01   +2.719915708966615e-01   +4.717192913479833e-01   +9.731732031637360e-01   +5.067511304029804e-01   +9.395153935227158e-01   +8.296539788117054e-01   +4.035796153158492e-01   +6.849516472476058e-02   +4.171662786255913e-01   +4.159313768402240e-01   +3.183947465756199e-01   +6.820008358981016e-01   +3.726947843951876e-02   +5.361402224667176e-01];
L2I_L2E_iAMPA_netcon = [+3.394536459481053e-01   +3.074068049572301e-01   +3.422384001390787e-01   +5.609099968797777e-01   +1.741165434663960e-01   +8.175323118854133e-01   +7.142426408759149e-01   +2.174760542364993e-01; +4.708325162879730e-01   +1.509344646804831e-01   +6.776982834993546e-01   +2.577092615530509e-01   +6.971574232785273e-01   +8.457711640363528e-01   +1.184560819329758e-01   +5.110039029034650e-01; +6.720244814347252e-01   -4.300582405365352e-02   +7.404021612568270e-01   +5.866998240366871e-01   +1.516727389852692e-01   +6.243795502236458e-01   +7.718531158198568e-01   +1.467729931074552e-01; +5.352253082836022e-01   +2.451226263876020e-01   +1.968323082763999e-02   +9.665326555039073e-01   +3.745471074481547e-01   +6.418522887664337e-01   +9.374104420669459e-01   +1.854334553690369e-01; +1.255634173478914e-01   +4.404875124316944e-01   +4.754445024953871e-01   +8.456726084018342e-01   +8.866123694459178e-01   +5.608691200967746e-01   +6.859510993884494e-01   +2.741162410729240e-01; +8.754650602981691e-01   +5.088241639111034e-01   +9.457187404342904e-01   +9.179807232886582e-01   +7.037925359390843e-01   +8.457892075460508e-01   +8.548052936058543e-01   +5.025529899483535e-01; +8.158104103533485e-02   +5.559525362441887e-01   +9.143827745617245e-01   +8.301172330333025e-01   +6.782409346023735e-02   +7.030942027515099e-01   +2.252037696016643e-01   +1.469289922815375e-01; +5.835884115880989e-01   +4.204936102068502e-01   +1.620581971901467e-01   +3.242810456463861e-01   +6.767470098754537e-01   +4.261847026597337e-01   +1.000000000000000e+00   +6.951568972146881e-01];
L2E_L2I_iGABA_netcon = [+4.658529331631664e-01   +6.160921625432820e-01   +6.029306781993284e-01   +3.014503466283011e-02   +4.330866414006910e-01   +5.107517197190841e-01   +2.625952871797138e-01   +6.974978194378091e-01; +4.592337980681972e-01   +3.389451817406501e-01   +6.818803365532905e-02   +4.657875899147367e-01   +4.172717222446150e-01   +6.549879156878521e-01   +5.016650529114784e-01   +3.948205394051756e-01; +5.597058793290981e-01   +5.627365422292379e-01   +4.393365887563069e-01   +6.162451163350378e-01   +2.984462114165281e-01   +2.907447598283719e-01   +1.773860811891915e-01   +9.313187846671171e-01; +7.086383002304071e-01   +5.785985194508237e-01   +3.754495647389501e-01   +8.347802788965070e-01   +2.253784790120146e-01   +6.313200999412479e-02   +1.921115402004116e-01   +4.072621899794699e-01; +4.843248618809240e-01   +7.644870541024064e-01   +4.760370428030626e-01   +7.605847695059077e-01   +3.985276009462133e-01   +7.271898112377583e-01   +5.942333328166394e-01   +4.018365725309559e-01; +4.012765574692703e-01   +2.346844439219502e-01   +4.158222625014924e-01   +3.884460458642524e-01   +7.969079315803966e-01   +8.111973826285770e-01   -9.079404768053015e-03   +4.163899017221370e-01; +7.286931180889827e-02   +4.408736405627073e-01   +8.162463179685502e-01   +5.515176833013310e-01   +5.329783433976184e-01   +4.318483010326517e-01   +9.043712985475523e-01   -4.100673395566944e-02; +9.032635339860534e-01   +5.473730494842011e-01   +8.692359030188325e-01   +4.691498821518709e-01   +8.656238334260116e-01   +5.020858009243823e-01   +3.184607678358141e-01   +3.481834898017139e-01];
L3E_L2E_iAMPA_netcon = [+2.447142091010202e-01   +9.059877027453274e-01   +4.715006952872517e-01   +7.319273289045339e-01   +1.660470296126314e-01   +3.857385796651572e-01   +3.522086322693364e-01   +7.504151332709989e-02   +1.214173527844366e-01   +5.193627884158676e-01   +1.750061694300677e-01   +4.707845581534034e-01; +2.888573224234313e-01   +4.576103987097223e-01   +1.678416820755420e-01   +2.027934172892850e-01   +5.409576534967574e-01   +9.559244662188894e-01   +7.173521782813749e-01   +5.695441816326610e-01   +2.279121879796786e-01   +6.988588617198625e-02   -7.389596809847505e-03   +8.591818045673091e-02; +7.763759357431254e-01   +3.737280591922522e-01   +5.542483189336423e-01   +1.337332095840019e-01   +8.073105528888433e-01   +9.102526179986301e-01   +5.423536094995727e-01   +6.045550760774323e-01   +7.241450359395999e-01   +2.872279000201136e-01   +3.955259374905886e-01   +8.899045350299931e-01; +1.476299861179463e-01   +4.496498576039315e-01   +2.079840732490313e-01   +7.755378512222649e-01   +4.506165037057959e-01   +5.253016343268758e-01   +8.643940785905697e-01   +3.037263917412104e-01   +8.222392816561103e-01   +8.092253907380684e-01   +4.434074787900344e-01   +1.559173713347519e-01; +1.749729006907695e-01   +7.502772850497547e-01   +4.440234168925735e-01   -2.181128921687321e-03   +1.646346733917166e-01   +9.207144919051167e-01   -2.112456269832224e-02   +6.858894421748686e-01   +1.108354179912573e-01   +8.184356739315379e-01   +2.437970547798305e-01   +1.913940103798357e-01; +3.477901462680764e-01   +3.756913202701360e-01   +8.214628222606116e-01   +9.681066325258652e-01   +3.590260873565618e-01   +8.848854072854697e-01   +4.550853982390681e-02   +3.528830034625149e-01   +4.943423231873550e-01   +7.975158171952570e-01   +5.699414518636272e-01   +8.130340924533239e-01; +2.244595586046925e-01   +4.763413249351691e-01   +5.441203836627078e-01   +1.333371956312027e-01   +6.427758475813740e-01   +4.718941317963033e-01   +7.286571497958532e-01   +1.169516957362511e-01   +3.941022414149097e-01   +3.964466351716704e-01   +9.865444527989079e-01   +7.368004272501056e-01; +5.387023881079772e-01   -2.238999965356487e-02   +3.618477280750020e-01   +1.204485033575844e-01   +1.947245787679744e-02   +8.586066282509174e-01   +3.796465367856313e-01   +4.825704165846440e-01   +8.508023162064299e-01   +9.819062441498441e-01   +8.814900294000035e-01   +2.576962395510441e-01];
L3I_L2I_iGABA_netcon = [-1.492674655247096e-02   +2.239150898816981e-02   +1.288830063234901e-01   +6.253392415682801e-01   +4.193784056036365e-02   +4.673615829789390e-01   +7.644091358312667e-01   +3.991613362561132e-01   +3.949327099180959e-01   +8.677989135454793e-01   +8.281770883529234e-01   +6.305097585914722e-01; +4.240332511567267e-01   +4.395155107224738e-01   +2.731880316830176e-01   -6.308551312440985e-02   +4.831056664722989e-01   +6.380613529019826e-01   +4.503231629849458e-01   +9.098508554539989e-01   +1.460411066548709e-01   +9.028007822449444e-01   +2.705643412054144e-01   +6.327167508969584e-01; +3.723037567096839e-01   +6.606499798098465e-01   +2.799919964608725e-01   +7.727058049811830e-01   +3.265947648226144e-01   +8.271003755063197e-01   +9.141058202270429e-01   +6.029830227270809e-02   +6.368478309633210e-01   +4.328534769888063e-01   +1.390930467954267e-01   +5.807693170545529e-01; +5.842243006183996e-01   +9.772024270700075e-01   +3.003677121548603e-01   +2.312088300869536e-01   +1.527888668851164e-01   +5.752910586381966e-01   +2.107925470228977e-01   +2.582311239794989e-01   +3.834936750907593e-02   +3.169277575860965e-01   +5.279762023488344e-01   +7.890720939130985e-01; +9.579375339655295e-01   +1.183434247417989e-01   +4.581670761597137e-01   +8.629537321632285e-01   +4.604817825160106e-01   +8.674894801189135e-01   +9.227120817961884e-02   +5.201707381281994e-01   +5.697401040899527e-01   +7.640196360533656e-01   +7.248326559658298e-01   +4.896085975274657e-01; +8.772525485709549e-01   +2.245916490263081e-01   +1.675469472267075e-01   +7.170773875839530e-01   +8.634531341614801e-01   +7.729488286539817e-01   +9.586068308950728e-01   +5.783709779558132e-01   +8.150193450991336e-02   +8.219779083469851e-01   +3.231877018181903e-01   +5.802315299643320e-01; +1.026963389109788e-01   +4.785145660286028e-01   +8.917351453129678e-01   +5.893852772241224e-01   +1.000000000000000e+00   +7.424640986930041e-01   +8.453119637831114e-01   +7.168543094996653e-01   +5.401851613289956e-01   +3.817843887593601e-01   +3.539385904659310e-01   +5.079886418799011e-01; +3.985666758714700e-01   +2.478139890518757e-02   +7.290405252918697e-01   +1.754051730380066e-01   +4.015759198052667e-01   -3.627395953961196e-02   -3.634638325956735e-02   +9.391469245535660e-01   +4.583886885135441e-01   +1.013475450879799e-01   +7.236976514809761e-01   +3.221296927078872e-02];
L2E_L3E_iAMPA_netcon = [+9.725438326312933e-01   +2.449626530651357e-01   +5.283994427906783e-01   +7.467981265728794e-01   -5.431776854577940e-02   +6.801501514160279e-01   +8.094120769534811e-01   +1.124322889790382e-01; +3.716455214362058e-01   +4.964137572552944e-01   +7.022379522361071e-01   +6.715769191750488e-01   +2.857119287543793e-01   +1.778588243691748e-01   +8.471538562614032e-01   +1.051140345523625e-01; +6.438453800066816e-01   +5.326612161633801e-01   +8.661008285650830e-01   +5.813553498542799e-01   +9.601769131634494e-01   +4.855222474817090e-01   +9.760877167533630e-01   +4.114658007934969e-01; +2.477325727807183e-01   +9.318527086654480e-01   +8.810622608384236e-01   +4.457974642448786e-01   +3.662272780931761e-01   +9.690164817522369e-01   +2.446038710630087e-01   +4.728465161177263e-01; +2.650325928282787e-02   +2.149107938489538e-01   +7.348853384712813e-01   -2.025729904241320e-02   +2.471137463147373e-01   +5.320146661995430e-01   +4.579173169298575e-01   +6.297016988862953e-01; +3.812418273719939e-01   +7.959865881250208e-01   +1.912150655469124e-01   +7.684612181581866e-01   +8.691378632082548e-02   -3.168745759395494e-02   +5.386217399590801e-01   +1.992522712875840e-01; +4.700776320950580e-01   +7.588224970078968e-01   +7.836258094189591e-01   +2.330133150658978e-01   +7.886147866138205e-01   +1.688276830032829e-01   +6.836003870796022e-01   +9.219830464709223e-01; +4.522268877041814e-03   +5.186726837465153e-01   +9.097913739718554e-01   +4.694149084452199e-01   +9.617127167206135e-02   +7.612926398946829e-01   +9.608226945505528e-02   +3.447848618123922e-01; +9.953533315550772e-01   +9.170213629945871e-01   +1.106087353840915e-01   +1.352225316930552e-01   +7.861316713635101e-02   +9.233428948699928e-01   +2.690590370555862e-01   +9.122433714576462e-01; +1.527035014583656e-01   +4.191411626345017e-01   +8.432866072572864e-01   +3.132108816348377e-01   +4.210542235061988e-01   +8.997086646818391e-01   +6.221104869412145e-02   +8.893596698229175e-01; +6.539982377879306e-01   +3.256440302189059e-01   +2.892955026296987e-01   +2.781947798728646e-01   +1.835879561555741e-01   +3.669169957823800e-01   +1.771161573081435e-01   +1.409161880230448e-01; +1.570211570646541e-01   +6.550417538016199e-01   +8.590803183239575e-01   +4.298317316947127e-01   -1.513260148994195e-02   +7.218416532970586e-01   +8.067430695991740e-01   +7.525669771828668e-01];
L2I_L3I_iGABA_netcon = [+3.566032857028460e-01   +6.840877887806111e-01   +2.747987551954935e-01   +6.293994060427202e-01   +5.138907034189794e-01   +3.934752774993464e-01   +4.314913366653869e-01   +4.657539939451346e-01; +3.165769158133890e-01   +7.535951490584013e-02   +1.143210910657464e-02   +7.917454465669043e-01   +7.017904109661708e-01   +1.337850640827890e-02   +9.271472544315122e-02   +6.310638488631422e-01; +3.333856690155294e-01   +6.239439956246373e-01   +3.938240439713213e-01   +7.674047259010666e-02   +8.257114675292172e-01   +6.649547198814949e-01   +2.316981871539456e-01   +1.334799323257851e-01; +5.910063455072770e-01   +8.575325087866739e-01   +5.459418202637289e-01   +4.577248552439508e-01   +5.597454066198894e-01   +6.613883340882859e-01   +3.791041524442081e-01   +6.704008470385734e-01; +3.798276044469645e-02   -1.882158388868796e-02   +4.941612696262274e-02   +7.290132173475952e-01   +2.377954568417264e-01   +5.899519122402970e-01   +4.516988756191122e-01   +2.919745282383435e-01; +5.347834462219755e-01   +3.906603950894399e-01   +3.970275612245917e-01   +7.331690757565144e-01   +2.391558681698585e-01   +7.800993957389019e-01   +4.524128627037869e-01   +1.065275774158923e-01; +2.332800426831214e-01   -8.629229423973081e-03   +3.980797832623304e-01   +9.874425894292731e-01   +7.022285569690646e-01   +6.861837267244232e-02   +2.662386221448735e-01   +8.445371384203560e-01; +1.918315178677137e-01   +8.775629169887145e-01   +8.947702618405029e-01   +8.687380691417804e-01   +5.160576339228815e-01   +1.256381637058187e-01   +6.584371096676025e-01   +1.182461343212821e-01; +3.058668608520714e-01   +5.294473592463401e-01   +2.211672296686350e-01   +1.432662404514268e-01   +4.081832769282756e-01   +3.026115700801942e-01   +5.951928673098793e-01   +4.942654937068959e-01; +4.320790418070208e-01   +1.944839469454395e-01   +2.021300563471785e-01   +4.015614975020858e-01   +9.827597420988080e-01   +5.219622205758605e-01   +4.562385063385485e-01   +9.453724667859142e-01; +5.813252651943712e-01   +7.078696937321173e-02   +3.023106536765781e-01   +6.127906423783289e-01   +5.457851833374084e-01   +6.740522620686651e-01   +8.997949322781610e-01   +6.057474854745095e-01; +3.770957227092718e-01   +1.836590173253798e-01   +6.050456378174300e-01   +3.386197909593438e-01   +1.278323339493345e-01   -9.071667386698578e-03   +3.259144071080814e-01   +6.485231966139349e-01];
L3I_L3E_iAMPA_netcon = [+9.172240561383671e-02   +6.158869837526000e-01   +5.900541432724984e-02   +1.857054202643784e-01   +2.098698862052687e-01   +6.227302567866242e-01   +5.228208815154137e-02   +3.355160914588217e-01   +4.870903726214149e-01   +3.263767928728448e-01   +5.664994444482730e-01   +8.851244647126630e-01; +3.411279092273436e-01   +7.738551342574034e-01   +2.276730612891925e-01   +2.917556490790374e-01   +7.129507013455852e-01   +4.743539579744507e-01   +4.128391943561096e-01   +3.730942260283251e-01   +6.078914202252713e-01   +2.581305274520893e-01   +6.712038511016873e-01   +2.313582809190924e-01; +4.440180420375248e-01   +3.069625107735788e-01   +7.228905307306396e-01   +8.624884982464913e-01   +5.265399417486869e-01   +5.907494001724025e-01   +1.000000000000000e+00   +4.274183409436838e-01   +2.549365035511757e-01   +3.433112695314226e-01   +8.624991956495797e-01   +8.404981649732737e-01; +5.054941064785436e-01   +1.225230678497586e-01   +5.500483759835625e-01   +7.093688305755491e-01   +4.097755154506045e-01   +6.019205271053250e-01   +5.331871355161861e-01   +6.886359846669975e-01   +5.277854626022858e-01   +2.079939328030195e-01   +4.121881596429329e-01   +4.804825180750755e-01; +9.060902299137279e-01   +7.545437384053071e-01   +5.502261626044703e-01   +4.643642801314432e-01   +2.324750821406873e-01   +2.903586248841710e-01   -1.196262688905750e-02   +2.463237885941629e-01   -6.855431553330190e-03   +2.150449640517323e-01   +1.225663990862041e-02   +4.706654354010084e-01; +3.453013959870717e-01   +1.859626692969565e-01   +6.442932766181578e-01   +4.013342130524973e-01   +9.947989857369299e-01   +5.796159948960444e-01   +2.806257420276214e-01   +1.213126118115151e-01   +1.721250151866196e-01   +5.509632057897794e-01   +3.065281595807953e-01   +1.179701307334113e-01; +4.899605597892276e-01   +2.417249598622334e-01   +8.528225348662016e-01   +8.426267163853089e-01   +1.356811366139670e-01   +2.014294364695587e-01   +3.947240393416871e-01   +1.089402549537778e-01   +9.063170287399680e-01   +7.118061293867888e-01   +3.111729650014075e-01   +5.274507801718111e-03; +3.578069657726052e-01   +4.091205609975818e-01   +3.232370043400075e-01   +6.019503746376893e-01   +7.878768564751135e-01   +2.199200870202163e-01   +3.606448634797444e-01   +2.786484132492889e-01   +2.975626890411835e-01   +2.322224336828964e-01   +6.471040643197362e-01   +5.155479618262506e-01; +3.198513906642254e-01   +4.752913869325459e-01   +3.535461605503982e-01   +5.808523323107009e-01   +5.337457249935111e-01   -7.506272508405901e-02   +7.075295823216260e-02   +2.603071846440245e-02   +3.228281164186222e-01   +2.087497783502358e-01   +8.150585508534385e-01   +9.085054683886072e-01; +6.978717095572070e-01   +6.107038964976098e-01   +5.837398292953295e-01   +3.724631633562531e-01   +4.879070856874893e-01   +3.965407517557376e-01   +9.393741486804174e-03   +6.488262019860311e-01   +4.127464554894313e-02   +8.194943405059825e-01   +4.243163791257432e-01   +1.113918275387065e-01; +8.569116028680067e-02   +2.752668979126775e-01   +6.222398028778833e-01   +2.646213727624842e-01   +8.442255250067138e-03   +5.051063836360943e-01   +6.967900290778348e-02   +7.127476995973053e-01   +6.629611026648428e-01   +1.832581381510777e-01   +6.587779069429370e-01   +3.234436038218318e-01; +6.133631432394921e-01   +6.737929733623425e-01   +4.086320713523766e-01   +6.119014804781927e-01   +6.396865756233594e-01   +3.379945486566713e-01   +2.979010403610172e-01   +8.289065528087119e-01   +5.654711698265159e-01   +3.712606541606759e-01   +5.186916756465272e-01   +3.883748590088333e-01];
L3E_L3I_iGABA_netcon = [+3.248346240797017e-01   +7.069865945089664e-01   +6.578261602188743e-01   +9.067671533820978e-01   +4.923166691314040e-01   +5.965458835197623e-02   +2.891289943263548e-01   +6.754705183121633e-01   +7.117139712723318e-01   +3.280092077548968e-01   +4.939524034081453e-01   +2.705815233699635e-01; +8.380556923090640e-01   +3.715724064952793e-01   +5.546277476444466e-01   +9.397317726755441e-02   +8.455089874445033e-01   +3.767250087381752e-01   +8.256705931749722e-01   +6.934826132675467e-01   +5.847505755873310e-01   +7.441780513322910e-01   +2.841136763248588e-01   +4.711756454405487e-01; +7.535064094400515e-01   +3.994993383683937e-01   +4.307628100231472e-01   +5.217712372800304e-01   +5.641651859545995e-01   +5.368999348484620e-01   +2.625072286312354e-01   +8.380628396550061e-01   +4.855036226187814e-01   +2.079817089281557e-01   +8.045448342376729e-01   +8.755761320176230e-01; +1.393065948474572e-01   +6.817281524232784e-01   +3.081536295796745e-01   +3.441615442981066e-01   +7.882445187780887e-02   +6.148749444561988e-01   +2.588647582101299e-01   +7.946728419148802e-02   +3.261209644754681e-01   +5.148201399141730e-01   +7.509622306658903e-01   +6.245380222886296e-01; +2.855448552042983e-01   +6.378371657278293e-01   +6.064749702590837e-01   +2.986864113239807e-01   +1.105226003393984e-01   +6.559931410259401e-01   +8.400252111630583e-01   +2.913242421413670e-01   +2.230197268181334e-01   +8.207239758416822e-01   +5.882226499998997e-01   +1.718609785415877e-01; +4.353113369306803e-01   +7.744998050381829e-01   +6.905491977391525e-01   +4.937558149626338e-01   +7.410999593127147e-01   +6.789748649032466e-02   +3.303264751111537e-01   +2.227201903268429e-01   +9.177830750206815e-01   +9.047537318213785e-01   +8.251133419085078e-01   +2.297186907985935e-01; +5.625066142986606e-01   +7.813067302380168e-01   +2.348630083907387e-01   +2.511197678902229e-02   +4.180056976479929e-01   +5.668416305881407e-01   +5.958222827017994e-01   +1.791367213556148e-01   +9.667578919152543e-01   +5.630547831052349e-01   -4.308142096489904e-02   +3.271890401776195e-01; +4.937949194047951e-01   +3.546865676905673e-01   +9.096753058281457e-01   +4.119208311983173e-01   +1.132891918451057e-01   +6.713792702877849e-02   +5.474908830990927e-01   +2.811085865014784e-02   +5.673466368543207e-01   +7.723381755323994e-01   +2.019533658859420e-01   +9.881428455528735e-01; +2.708493993492133e-01   +5.466340170327196e-01   +2.986544198754583e-01   +7.645389983980856e-01   +8.004102297268999e-01   +9.169298596452505e-02   +4.106713835902380e-01   +6.249534152393761e-01   +6.129433161544811e-01   +8.106317420106409e-01   +6.922094918660714e-01   +6.746642600938723e-01; +6.847283372666009e-02   +5.831158504651604e-02   +3.331732500139520e-01   +5.685473667682359e-01   +7.520882643979498e-01   +1.888312727904198e-01   +5.077367884307107e-02   +3.145453808152344e-01   +7.049066521468248e-01   +2.605086292001187e-01   +6.205841428417680e-01   +3.654079955396041e-02; +8.892130778932734e-01   +5.943204079469548e-02   +7.437151255992097e-01   +5.039575102908361e-01   +3.765124739214339e-01   +8.412361667982133e-01   +1.551038198959999e-01   +8.219716801468062e-01   +3.336561079742502e-01   +8.753146842268651e-01   +5.171405141792231e-01   +6.886008894266401e-01; +6.771893196509841e-01   +8.139194918128682e-01   +4.633992265268508e-01   +8.456042133041075e-01   +8.098246905936509e-01   +5.211378794098882e-01   +8.705438473661047e-01   +8.654286529166817e-01   +4.802469100959485e-01   +8.334079435408692e-01   +5.032524188665531e-01   +9.000945613044335e-01];
L2E_Input1_iAMPA_netcon = [+9.527525568623396e-01   +9.531675638669034e-01   +9.129466646616545e-01   +9.244525944174353e-01   +8.869344640219504e-01   +9.981653887873584e-01   +8.826489774532471e-01   +9.053849313719465e-01];
L2I_Input2_iAMPA_netcon = [+9.190679892405599e-01   +9.613536338315729e-01   +9.370688622300131e-01   +9.131591126131995e-01   +8.433718657087980e-01   +9.040591999928888e-01   +9.351021023294981e-01   +9.173067482073521e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last =  11.21 * ones(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))*0.4 + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.5*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.5*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))*0.9 + 0.5*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))*0.4 + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.5*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.5*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))*0.9 + 0.5*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
