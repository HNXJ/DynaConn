function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+3.406267676824167e-01   +6.911471975598134e-01   +8.436258498103928e-01   +2.526235860976972e-01   +3.039792892143951e-01   +6.363913492668153e-01   -4.967772491238524e-02   +3.742832165982896e-01   +3.131068296300805e-01   +1.193674591719994e-01   +3.948413551947230e-01   +1.592096411735431e-01   +4.184101021398119e-01   +2.349468298098752e-01   +2.227293121860598e-01   +5.394939462078467e-03; +6.635646746551907e-02   +8.148472104614445e-01   +7.765844483354714e-01   +6.861294359183026e-01   +3.121827473515899e-01   +6.198445902688993e-01   +6.367588581030459e-01   +1.716065828723723e-01   +1.176733876315422e-01   +7.259549295260894e-01   +5.397044090736348e-01   +6.196566201218783e-01   +4.087665776217511e-01   +2.616176420024878e-01   +5.452142715402125e-01   +2.994048306638702e-01; +2.039610845149208e-01   +2.291200171234361e-01   +4.480264587530761e-01   +4.182513192922263e-01   +6.060261237060596e-01   +4.529626308763562e-01   -6.348140965420461e-02   +5.947355735324937e-01   +3.382633635202727e-01   +4.383872747377363e-01   +7.824897646773257e-01   +2.753534621724817e-01   +3.819739578258478e-01   -1.003963902445913e-01   +3.142975237989902e-01   +8.643455472067061e-01; +2.081567918419439e-01   +6.308223714780982e-01   +1.404554794797662e-01   +2.554737280921497e-01   +7.787205391953178e-01   +7.298025560263097e-01   +1.922645646428710e-01   +5.506951369630995e-01   +6.711829477207869e-01   +4.930711562774676e-02   +1.831195687385892e-01   +7.395945400489872e-01   +4.875020770429321e-01   +1.923918160607484e-01   +5.742433019606772e-01   +4.558105208438606e-01; +3.901419609557629e-02   +6.189253439824268e-01   +7.597893497731123e-01   +6.988844834276359e-01   +4.658965438831935e-01   +3.251257229356778e-01   +4.003629131872885e-01   +3.001368641552495e-01   +2.810218872891933e-01   +4.762942516675139e-01   +1.813525544049527e-01   +5.862400239582258e-01   +3.144882203241327e-01   +7.329955981199490e-01   +1.892701765046336e-01   +8.083332813646917e-01; +1.056294431001907e-01   +1.683717740118031e-01   +7.107493726748295e-01   +7.694175962855190e-01   +5.589198869351275e-01   +8.020678323585180e-01   +2.681402165851163e-01   +3.748809844833204e-01   +8.005587255867663e-01   +8.661365993337761e-01   +7.822430059250478e-01   +8.807481272087928e-02   +3.801462110096301e-01   +1.066647902115920e-01   +8.069769115033621e-01   +3.675771556203093e-01; +3.422094722031999e-01   +6.450177120562870e-01   +7.001943336268998e-02   +3.054420021113988e-01   +7.016508400947183e-01   +4.527746173427389e-01   +3.744663294473961e-01   +5.221694501894812e-01   +8.704863561699748e-01   +8.169341761862090e-01   +6.072601720489661e-01   +1.236443565912294e-01   +3.834525322302897e-01   +4.171141258464505e-01   +6.134964464870524e-01   +7.730439982422765e-01; +5.688958715323461e-01   +6.261162854419835e-01   +7.445665686198386e-01   +3.913272809012769e-01   +5.407369900965305e-01   +4.904746710378975e-01   +8.597619961642745e-02   +4.385676420884527e-01   +1.000000000000000e+00   +7.936001896325560e-01   -1.059679753094900e-02   +6.813906185969150e-01   +6.711429301005044e-01   +5.520201322832290e-01   +2.312737536162270e-01   +7.947174587448134e-01; +4.359320224401969e-01   +4.442489834266465e-02   +2.052873214492418e-01   +2.551561137572924e-02   +3.618910627926992e-01   +1.073628396239898e-01   +1.287053880971041e-02   +5.168832444438045e-01   +4.930052291767714e-01   +7.145718164250051e-01   +6.680901254873520e-01   +4.313828541906374e-01   +2.499400769565397e-01   +1.575357439464806e-01   +8.762537283904031e-01   +7.486500739628332e-01; +5.944087703863242e-01   +5.232161254551544e-01   +4.935869332970129e-01   +2.146058195493710e-01   +4.390913943281558e-01   +2.179426010512540e-01   -1.246120976669518e-02   +2.208134155483410e-01   +2.191005503586617e-02   +7.626306652645606e-01   +4.762899778294776e-03   +1.368041842254718e-01   +3.100845059882883e-01   +6.869250344434349e-01   +2.966364163857179e-01   +6.592035464850566e-01; +3.191320962954512e-01   +5.467414171291873e-02   +2.357086452866858e-02   +2.218394939318276e-01   +7.589622567919113e-01   +5.430189644752240e-01   +1.809482994608998e-01   +2.109595405528274e-01   +1.530796440508596e-01   +8.200840401811148e-01   +1.033291485220617e-01   +7.384949134646003e-01   +5.083593402420663e-01   +7.246856418923197e-01   -1.580426994755112e-02   +6.657833319020610e-02; +1.883158313797078e-01   +7.279449847175308e-02   +8.432642797959801e-01   +4.957274138387577e-01   +6.011241274304735e-01   +4.566238090887678e-01   +6.278969343085050e-01   +2.554045878471300e-01   +6.262496022483138e-01   +1.332605311554674e-01   +2.153287495325040e-01   +7.210165802369030e-01   +2.830122439375967e-02   +4.833061874326701e-01   +3.276766734917349e-01   +6.159207253504156e-02; +3.454871422436345e-01   +2.912020321598672e-01   +5.438737118659691e-01   +2.017759030155430e-01   +1.115228170216304e-01   +3.948888821992632e-01   +3.933653449933596e-01   +6.243910375786734e-01   +2.997497188380904e-01   +8.622031113759319e-01   +2.142446783318447e-01   +3.778467092940556e-01   +2.150640372906871e-01   +2.261949090358464e-01   +2.281216545917596e-01   +1.937619366960627e-01; +1.266347992963179e-01   +8.185892773720707e-01   +6.652930975008952e-01   +6.347557449456441e-01   +7.573165521382069e-01   +5.718942649922450e-01   +2.262698708139509e-01   +7.040495836535473e-01   +3.889924693480332e-01   +4.129679831456981e-01   +7.067224064943022e-01   +5.562252419943655e-01   +5.185783743800153e-01   +3.992830309506175e-01   +7.480797738381023e-02   +3.569775659289494e-01; +1.431428836940879e-01   +2.164989496414675e-01   +4.735915914055822e-02   +3.772588759485921e-01   +2.627598710752316e-01   +4.731816445144629e-02   +6.021730863231679e-01   +2.275290013701167e-01   +6.996894816697052e-01   +4.461250522846867e-01   +9.010487573726911e-02   +6.572117761339542e-01   +5.373840248513428e-01   +1.499535417124332e-01   +6.322222612658628e-01   +1.599490177975413e-01; +4.758490992866795e-01   +1.727643614944336e-01   +3.125652344277251e-01   +6.067600955368182e-01   +4.570729938981778e-01   +5.818000195430582e-01   +2.464409199468648e-01   +1.381633639431962e-01   +5.422922658039554e-01   +3.795033549792431e-01   -1.860314961483324e-02   +3.251552299047227e-01   +1.935093754670750e-01   +8.765688683933216e-01   +8.277336523688781e-01   -3.720514407182249e-02];
L1E_L1I_iGABA_netcon = [+1.957288414037851e-02   +2.725110878327170e-01   +8.993624815146459e-01   +1.623623535026301e-01   +4.086364576968846e-01   +1.315772711993834e-01   +2.549480709739322e-01   +9.375465362412599e-03   +1.723564527888169e-01   +1.551870261114348e-01   +4.361707946310318e-01   +8.869902188119266e-01   +1.659614333015954e-01   +6.745602355113947e-01   +7.024445551619934e-02   +3.906244244074998e-01; +7.677676180249636e-01   +7.455391811079488e-01   +5.072789146604052e-01   +7.986811581090291e-01   +6.215145089941988e-01   +7.576326798296336e-01   +5.948165435819666e-01   +7.232594415068012e-01   +8.332692723434916e-01   +8.694396995181468e-01   +1.694030430168707e-01   +7.680923084652017e-02   +5.328356044027537e-01   +8.587654007430249e-01   +9.541422421573927e-01   +1.729871714404627e-01; +2.128375693215470e-01   +8.203358255205467e-01   +8.604312176455596e-02   +2.585612106426235e-02   +1.239986052467735e-01   +1.902636046411543e-01   +5.351758645939395e-01   +1.030570308447789e-01   +5.225367964262093e-02   +1.161383653863342e-01   +5.248569523287276e-01   +4.221376544125989e-01   +7.551975397547140e-01   +7.139276417227076e-01   +8.085124592108680e-01   +7.496647214931840e-01; +3.092699239214707e-01   +5.559813952445189e-01   +6.004621750843270e-01   +7.562811936419166e-01   +6.635912406447688e-01   +5.846029635911008e-01   +6.458440426940205e-01   +8.242162626320733e-01   +1.059198524016263e-01   +2.656686713504843e-01   +4.390470081061491e-01   +2.973833249106771e-01   +7.819082549798029e-01   +4.663548596815146e-01   +8.752858620763181e-01   +4.776161275100747e-01; +7.041856078747686e-01   +5.993603497523475e-01   +8.891746357590804e-01   +3.683275207700605e-01   +8.549946706610470e-01   +4.927094344141504e-01   +3.470460625789604e-01   +4.484725869187899e-01   +2.369228894855326e-01   +3.537494944208525e-02   +4.739973343082257e-02   +5.726235856821721e-01   +8.227120637253661e-01   +7.857250481653346e-01   +1.221257270317904e-02   +1.433399592259869e-01; +1.844249822957515e-01   +3.925222244062210e-03   +3.234641171825473e-01   +2.227724153902129e-01   +1.141323675219383e-01   +4.255367271743182e-01   +8.037108440898793e-01   +3.069349537910023e-01   +5.371011841836927e-01   +4.625043584937619e-01   +8.701666278417348e-01   +1.150867519690211e-01   +2.091527056969861e-01   +2.091408537004537e-01   +6.588957545616225e-01   +3.355452962884617e-01; +6.743362407077440e-01   +4.733456971829046e-01   +2.946902331711186e-01   +6.913109583573414e-01   +2.772577812676555e-01   +8.105257513612845e-01   +5.693763125143462e-01   +5.787859189778843e-01   +7.771417656014755e-01   +5.761185747962004e-01   +7.797533744854511e-01   +2.524688633703618e-01   +7.253553617613147e-01   +5.439303989883586e-01   +9.151204418580728e-01   +7.902938735690964e-01; +9.145995969317144e-01   +1.018137385520574e-01   +5.690190707524283e-01   +4.539178982134924e-01   +6.471944547566297e-01   +2.150039484710605e-01   +2.900763644039541e-01   +5.308224630398408e-01   +1.853821436546293e-01   +8.070077031120118e-01   +7.013804187223247e-01   +7.848848539871544e-01   +2.417422453729610e-01   +6.568916905338351e-01   +4.752662743276247e-01   +5.853299518931672e-01; +5.533957348848603e-01   +9.796743491581604e-01   +4.289726922965038e-01   +9.043814951098088e-01   +1.702274031851388e-01   +6.383840964481462e-01   +5.431895458915657e-01   +8.488139707297730e-01   +8.741448030767216e-01   +7.208073372077332e-02   +2.060850712552096e-01   +2.347525220864675e-01   +8.808438021103309e-01   +2.586881268591780e-02   +1.017726350400456e-01   +4.220209656197976e-01; +2.051854591609424e-01   +3.919199191642821e-01   +5.239484962649741e-01   +1.794906912264755e-01   +8.868086416617924e-01   +3.730932953661019e-01   +3.286152761742007e-01   +9.351721978844830e-01   +8.431948619736842e-01   +8.495892609014053e-01   +8.090146315406407e-01   +9.223392603340174e-01   +4.408490806367365e-01   +3.795131847565526e-01   +2.924281334664350e-01   +7.322622755520308e-01; +1.690580589560028e-01   +1.789011097146842e-01   +6.985657876073006e-01   +7.565549889707806e-01   +2.335779045808572e-01   +6.063381420250944e-01   +6.446073255035610e-02   +4.033303438515786e-01   +3.724008501172593e-01   +6.084139810254093e-01   +3.392751042612179e-01   +8.582811801315887e-01   +1.051543048359750e-01   +4.630858737074752e-01   +4.074441334471695e-01   +3.778603364035076e-01; +1.838525227964275e-01   +9.092526959608374e-01   +6.802291142228648e-01   +5.306584036484527e-01   +4.318769149735202e-01   +7.469266948663886e-02   +1.284460739229727e-01   +3.741183177716081e-01   +1.621227853548415e-01   +4.930073709051864e-01   +1.907002836021990e-01   +3.658075799917341e-01   +3.644547300905888e-01   +8.397424538156399e-01   +5.479362285224836e-02   +4.578249702685004e-01; +9.010828335523204e-01   +1.845921864672894e-01   +4.676635826399578e-01   +4.820406973516604e-01   +5.325833794238775e-01   +5.705165400023925e-01   +1.386820549432146e-01   +4.472516317756818e-01   +4.163607913437706e-01   +3.301016054616137e-01   +8.914148472222031e-01   +8.805141487997619e-01   +7.424986086664889e-01   +5.583105336416678e-01   +2.597945085235658e-01   +6.820685654093509e-01; +4.453072063217641e-01   +8.211679745017483e-01   +3.214881774485683e-01   +3.740772769907246e-01   +6.858980102501810e-01   +1.985642276110168e-01   +2.777385333751697e-01   +5.579057537297079e-01   +2.981861358703550e-01   +4.586342689223927e-01   +2.020893079458207e-01   +1.587935789653412e-01   +2.862842527470100e-01   +2.521425078803938e-01   +4.850630487696341e-01   +8.732014825502761e-01; +5.518050689826031e-01   +5.822011590444054e-01   +6.460474980890597e-01   +5.559871389686667e-01   +6.660584427325210e-01   +1.226876053641156e-01   +8.305318879824305e-01   +2.391041931654254e-01   +8.236084620250996e-01   +5.063110999611997e-01   +7.029810699144288e-01   +4.948329301650700e-01   +2.790652542837082e-01   +4.456071107227959e-01   +7.802285525411574e-01   +4.471658186057596e-01; +3.549486538574961e-01   +5.555031714232089e-01   +5.719820443419518e-01   +2.857923775436539e-01   +4.249641957948700e-01   +2.769181226407936e-01   +4.882840406125675e-01   +2.149937879778679e-01   +8.123884154701866e-01   +2.481633904905343e-01   +2.617016940436672e-01   +1.705897108949656e-01   +4.292064520390423e-02   +3.809666204110312e-01   +9.735002152989795e-01   +9.211602974155344e-01];
L2I_L1I_iGABA_netcon = [+5.846215329629932e-01   +4.119281253937933e-01   +6.329567723043011e-01   +5.763587553647866e-01   +8.426443129363878e-01   +5.469331424889562e-01   +8.649791952520833e-01   +7.975075661196442e-02; +4.352165275572635e-01   +1.854108074945688e-01   +2.813050806133517e-01   +9.356430565120061e-01   +2.253866204532973e-01   +5.577975052481900e-02   +7.766958371787963e-01   +5.770646011341688e-01; +1.000000000000000e+00   +5.345956503380602e-01   +5.743931956152644e-01   +7.053072059302266e-01   +6.526604738518825e-01   +6.201150601949306e-01   +2.927993047987441e-01   +2.961570677172590e-01; +3.386837242132196e-01   +1.878955947940912e-01   +8.426506120976130e-01   +4.333122623265409e-01   +7.358489100442130e-01   +3.497963729240413e-01   +9.111070573919486e-01   +1.507962136427993e-01; +6.885893970481849e-01   +4.653666596380098e-01   +5.930709889792142e-01   +1.685265667043108e-01   +9.371935093869017e-01   +2.901810760742602e-01   +5.183186673369486e-01   +1.627354427760126e-01; +5.560997858617512e-01   +5.739685184688026e-01   +7.080129413686744e-01   +1.060149482663497e-01   +1.774584372273786e-01   +8.451349778885887e-01   +8.486376560229895e-01   +5.330263476761294e-01; +7.636872941758774e-01   +5.122817780036620e-01   +2.459630799524211e-01   +2.483489173014846e-01   +6.910816127114460e-01   +1.652960151280144e-01   +6.322739877101782e-01   +3.918211348765254e-01; +8.774998588352627e-01   +4.207150553337785e-01   +6.191176955726941e-01   +8.051038074532629e-01   +1.109014493975839e-01   +4.298923329137550e-01   +4.168745713383925e-01   +2.350756465113355e-01; +6.807082742423756e-01   +1.398726286348086e-01   +4.124878693549621e-01   -3.687868321310739e-02   +6.947764677795448e-01   +3.759971383280073e-01   +7.233397677030957e-01   +6.737241674743701e-01; +4.438745546073991e-01   +7.385476974803212e-01   +6.186250680634722e-01   +7.453598730361983e-01   +3.869807984409825e-01   +8.080863533923173e-01   +7.493028975192765e-01   +2.156423559452218e-01; +5.267372612492354e-01   +5.194510785624536e-01   +5.215642904736129e-01   +3.583761266677918e-01   +1.081015494252832e-01   +8.010702291447235e-01   +5.502719677326665e-01   +3.842683346888861e-01; +6.744649218785825e-02   +3.577657488140063e-01   +4.177267928687473e-01   +4.262033692068506e-01   +3.932142363487880e-01   +4.422353586057207e-01   +2.537392999859296e-01   +5.302692250704329e-01; +3.570948169156322e-01   +1.367494072402483e-01   +6.445309761283009e-01   +7.606639926752233e-01   +2.093910219221056e-01   +6.569849981414919e-01   +3.423278703240185e-01   +7.375902713756460e-01; +4.133409155743671e-01   +4.437141491430462e-01   +6.243404937174184e-01   +2.979956080295349e-01   +7.348663963575965e-01   +3.321856863383418e-01   +3.357974732001591e-01   +3.085983847837139e-01; +5.855401332425754e-01   +1.324048613242417e-01   +2.216652652280075e-01   +2.172046704851182e-01   +5.507339233944452e-01   +5.393219110952001e-01   +2.649327673093093e-01   +6.697847390508710e-01; +7.060315315825818e-01   +8.250841065718409e-02   +6.805629272688398e-01   +3.950998053631530e-01   +3.635421017875662e-01   +5.014135913774460e-01   +1.996658841857813e-01   +3.106050197596532e-01];
L1I_L2I_iGABA_netcon = [+4.800217619682749e-01   +1.650887024736805e-01   +7.827727722546993e-01   +2.468312005004847e-01   +4.652987529488120e-01   +2.573228446278613e-01   +8.750450735074102e-01   +2.743576078425579e-01   +5.095969790548759e-01   +7.959637189761528e-01   +4.034484539875723e-01   +3.906239249732990e-01   -6.215783813165655e-02   +6.669791568339865e-01   +5.891487007229627e-01   +4.074129627104277e-01; +1.238661358239911e-02   +3.204506367409640e-02   +2.808787074890762e-01   +2.644579781830271e-01   +8.657494093382445e-01   +3.894432089027238e-01   +2.867317761369092e-01   +1.794111065318469e-01   +4.793308825291218e-01   +2.045123787293329e-01   +3.131743022830071e-01   +3.083137670981179e-01   +9.727766000494882e-01   +2.190883739361575e-01   +7.342198868312638e-01   +2.536061276685173e-01; +3.169000517023735e-01   +6.086156057683361e-01   +2.971603161731930e-01   +7.095746740243156e-01   +2.628214836366795e-01   +5.738444891522892e-01   +7.937573773261726e-01   +7.642852164241604e-02   +7.595644431588003e-01   +4.730413206544629e-01   +5.143226785012934e-01   +8.165251425889507e-01   +9.235677211082342e-01   +6.402498788311499e-01   +3.574890767166667e-01   +2.285079466719484e-01; +8.992574719443487e-01   +7.787717499711728e-02   +6.685969371562233e-01   +9.179775813218914e-01   +4.246079550006519e-01   +8.687755779671196e-01   +6.234945861037354e-01   -2.443093554576971e-02   -5.477824846047832e-02   +2.785269183904509e-01   +4.177635171550647e-01   +4.598092500393773e-01   +2.913973092964730e-01   +4.609221940257328e-01   +2.122939416860831e-01   +2.002460801206030e-02; +8.600403415623061e-01   +8.455581069592535e-01   +7.971820976997513e-01   +5.696755922732858e-01   +2.825170516158881e-01   +6.889539879205240e-01   +6.665618520001305e-01   +6.213930791596054e-01   +1.049075368010264e-01   +7.065800720200561e-01   +2.659156356382039e-01   +5.207327846816825e-01   +4.996823839969131e-02   +1.921060813699964e-01   +6.997878005352306e-01   +9.627275445437680e-01; +5.489471621630200e-01   +5.557783462902270e-01   +1.077984246050657e-01   +3.186363603815578e-01   +9.155958775026523e-01   +1.174245514450141e-01   +7.101167569851206e-01   +6.596613592092556e-01   +4.535748891660566e-01   +7.527104682205775e-01   +3.568981946342755e-01   +5.061876242151353e-01   +9.213645072361946e-01   +1.448608228954955e-01   +2.221728812546789e-01   +1.157077808966450e-01; +9.051441134709601e-01   +9.692849555152658e-02   +4.167963576808205e-01   +3.130318260159798e-01   +4.973710032819272e-01   +8.333936498782779e-01   +9.427261000754307e-02   +2.092187750868799e-01   +7.828684585228869e-01   +9.292762194043915e-01   +9.051961476738691e-01   +8.141369471946048e-01   +1.286902989244123e-01   +2.067285456252237e-01   +1.034795158429058e-02   +5.540304588696343e-01; +9.047498320761238e-01   +3.825873753272382e-01   -3.675583526261270e-02   +8.117393411844464e-01   +1.602990831021590e-01   +9.092614392063065e-01   +7.932059953623568e-01   +7.250505089659007e-02   +8.479860196537957e-01   +4.257367700920600e-02   +8.956013742049195e-01   +1.902033320281349e-02   +8.161691774340766e-01   +9.068163494143468e-02   +9.293834327339462e-01   +6.560347070497329e-01];
L2E_L1E_iAMPA_netcon = [+3.146163968104934e-01   +9.330593062559912e-01   +5.809418433664149e-01   +6.447220773115084e-02   +3.653803463845971e-01   +3.095559087256862e-01   +2.316014123979191e-02   +5.989800521855142e-01; +1.945712803292486e-01   +1.310536528773353e-01   +7.025695866928080e-01   +8.635941560743716e-01   +3.617737821177349e-01   +5.504091059465328e-01   +1.714744179136669e-01   +9.558881295224024e-02; +5.038495855862016e-01   +8.326198087146204e-01   +6.976986080096137e-01   +2.502001069032582e-02   +6.239878052038377e-01   +2.152408487565741e-02   +3.932286675738596e-01   +8.537423237214021e-01; +4.125551907704748e-01   +6.496130532914814e-01   +6.137346026763737e-02   +5.297545304948632e-01   +2.514771148507580e-01   +5.920522201135034e-01   +1.459198454821388e-01   +4.822188649620132e-01; +8.396468905778206e-01   +6.007363696534531e-01   +7.266274443060291e-01   +5.021070091349485e-01   +6.771882711265471e-01   +3.623829223011320e-01   +3.881849315850990e-01   +5.034542048968977e-01; +4.563184479622349e-01   +6.108591152389758e-01   +3.262761664391062e-02   +6.303440906958078e-01   +6.124591430410717e-01   +8.452198367278984e-01   +2.700435663633889e-01   +8.894582544698465e-02; +4.363596815104884e-01   +3.094306607983607e-01   +2.458045308697483e-01   +4.080220498985236e-01   +4.181936934349254e-01   +2.525597234305722e-01   +5.777211765901742e-01   +2.468678482545247e-01; +7.466833179651696e-01   +1.531572802430490e-01   -9.207654617664517e-02   +9.744695542144813e-01   +5.604464008785602e-01   +3.815013623991346e-01   +5.980389163165888e-01   +6.240072153910714e-01; +7.970907425474294e-01   +6.172176724107189e-01   +6.794512094377059e-01   +1.001991189543631e-01   +3.294577450686731e-01   +1.963720086980217e-01   +1.267478250019399e-01   +9.474663728227963e-01; +4.932043645281401e-02   +1.997192844954142e-01   +1.671447902897115e-01   +2.249913595151967e-01   +8.023902084509243e-02   +5.323295949224321e-01   +8.813477010459128e-01   +8.621954539610737e-01; +3.636932216981512e-04   +1.791897075632666e-01   +5.583779455560346e-01   +4.077405437548441e-01   +1.990423262126647e-01   +3.958449720994379e-01   +2.336789549217045e-01   +6.569060552856568e-01; +3.530790592788245e-01   +5.901643494892105e-01   +5.742814174294473e-01   +4.509998373788459e-01   +6.552569636939158e-01   +3.340610878688432e-01   +6.155110654572598e-01   +5.000898680424497e-01; +7.012411959530704e-01   +7.354416546741622e-01   +5.477184428126125e-01   +1.692873461005430e-01   +1.863329182714456e-01   +1.111431535236790e-01   +9.300849507472968e-02   +5.412322241263300e-01; +6.720125029424161e-01   +8.099152680286064e-01   +1.190233894888480e-01   +8.812469265136668e-01   +5.013271006579531e-01   +7.455340868047040e-01   +5.882927410580133e-02   +1.676464410145937e-01; +9.002099684013939e-01   +2.208366686205251e-01   +5.129838048614617e-01   +5.947403512194928e-01   +3.535735461260793e-01   +1.732554735428757e-01   +6.514519313051580e-01   +4.817470252704864e-01; +7.564722437206441e-01   +5.670480400430475e-01   +7.424228019610073e-01   +3.441092550435307e-01   +5.006261690306721e-01   +8.357891489282123e-01   +6.565068373362858e-01   +1.970750171619121e-01];
L1E_L2E_iAMPA_netcon = [+7.432451612781360e-01   +3.826997421046275e-01   +5.691033176562807e-01   +1.686725281354409e-01   +8.941299991716035e-01   +1.872941363440279e-01   +4.837223654154567e-01   +4.525398221520595e-01   +9.576482667680655e-01   +5.050577290278063e-01   +5.237279664271874e-01   +4.563144110754531e-01   +5.421792225134497e-01   +3.318819196054940e-01   +5.771420617549362e-01   +3.071444844560441e-01; +7.169690906019659e-01   +1.964163761108761e-01   +1.871145807812280e-01   +5.432997521280845e-01   +8.032992445913181e-01   +5.542692273850891e-01   +9.094878556896998e-01   +2.529914920884633e-01   +2.959035334101637e-01   +2.674779123598908e-01   +5.924303873822474e-01   +5.788965718749886e-01   +5.490376930038028e-01   +8.395352347781732e-01   +3.803860563199792e-01   +5.299813497025888e-01; +7.376278361158956e-01   +8.148840331365059e-02   +1.385556105900962e-01   +9.252957314490475e-01   +2.470103716964264e-01   +3.740399016644614e-01   +8.187699783518364e-01   +3.437381024631645e-01   +2.173411600342395e-01   +5.975261319035187e-01   +7.621226173953561e-01   +4.241927070099256e-01   +7.371000268150129e-01   +8.170670688832348e-01   +7.402552171988918e-01   +5.823285285223714e-01; +5.820180194623377e-01   +6.589155962288652e-02   +5.120319033125791e-01   +3.254067994837267e-01   +3.768707962726514e-01   +7.759887520775224e-01   +2.554477250202053e-01   +1.597487022789457e-01   +5.578881940466007e-01   +5.183819890090925e-01   +3.972619499024343e-01   +9.404815369706669e-01   +6.502005305489863e-01   +1.050243427751714e-02   +7.150623303376779e-01   +7.894452433369067e-01; -2.936934723835870e-02   +2.223681279651248e-01   +1.355140591840296e-01   +6.330656228570402e-01   +1.322399483336665e-01   +3.855908155392701e-01   +9.492261496207229e-01   +3.505904757625002e-01   +1.282835549951707e-01   +7.264279896593451e-01   +9.537302149554759e-02   +4.742846369247429e-01   +5.668770049830688e-03   +6.124510310637827e-01   +4.360512757776316e-01   +2.025165160940131e-01; +5.994243385971485e-01   +3.676238691384834e-01   +4.171209481398420e-01   -1.688139820654898e-01   +8.083363731960658e-01   +9.844722636875650e-02   +4.399121698015119e-01   +1.989458603892993e-01   +7.057630694233133e-01   +2.400163301331782e-02   +6.921636720913905e-01   -1.028735819932590e-02   +6.763075081981449e-01   +4.802361730219212e-01   +6.933188541181160e-01   +2.902028747169340e-01; +2.372809438793693e-01   +7.020493925612888e-01   +3.299336875237977e-01   +3.429329320017298e-01   +2.427103671847070e-01   +7.920432404956588e-01   +9.283278540954216e-01   +3.466232636003505e-01   +6.082511641153371e-01   +7.207238247914051e-01   +1.868945760401852e-01   +1.126810755739802e-01   +1.029327201230030e-01   +2.992312730644104e-01   +2.639762236743800e-01   +7.393275018029647e-01; +1.369355804811140e-01   +3.693253218258589e-01   +2.331565838724588e-01   +4.593678634135052e-01   +1.000000000000000e+00   +4.150867362229121e-01   +9.005854151804444e-01   +7.802262244549913e-01   +3.865736458113714e-01   +4.509250429046433e-02   +3.675472072709436e-01   +4.242917191261848e-01   +3.009266155565580e-01   +6.336263269536214e-01   -5.147002264888111e-03   +4.964543017179026e-01];
L2I_L2E_iAMPA_netcon = [+3.208595155082649e-01   +2.647611892831895e-01   +3.212994342828260e-01   +5.652243887211370e-01   +1.473447844635722e-01   +7.969369043532308e-01   +6.658680343830866e-01   +1.896231549148766e-01; +4.551976436502615e-01   +1.921193215737654e-01   +6.988269411211662e-01   +2.617011285517122e-01   +6.488386360596863e-01   +8.661812309583012e-01   +5.286437311455356e-02   +4.559897035118213e-01; +6.348354361893666e-01   -3.022228793535834e-02   +6.556479901987394e-01   +5.611405925521584e-01   +1.646412534124326e-01   +6.156333301469498e-01   +7.805349666427195e-01   +2.058965233683783e-01; +5.043550533824798e-01   +2.075815353427091e-01   +6.961429236457956e-03   +9.356847085660100e-01   +3.094657011856729e-01   +6.506076032179938e-01   +9.394411492885535e-01   +1.657970622581508e-01; +6.955353209534322e-02   +3.849085131276047e-01   +4.786593560787560e-01   +8.417154561105669e-01   +8.748157721709481e-01   +5.122018075907759e-01   +7.092291546971379e-01   +1.541457654910997e-01; +8.473993134796045e-01   +4.718205314655274e-01   +8.675761314991184e-01   +8.845062661256849e-01   +6.670569040382486e-01   +7.887045691681537e-01   +8.150156845574792e-01   +5.496388561128325e-01; +5.941675825410592e-02   +5.280326531275101e-01   +8.531682781111235e-01   +7.986346866465079e-01   +9.427657251827282e-02   +7.161416930664004e-01   +1.873624141129130e-01   +1.080588825526977e-01; +6.041944023040808e-01   +4.184347677456929e-01   +1.566912231582337e-01   +3.182655589664213e-01   +6.509930569261914e-01   +4.299099491114634e-01   +1.000000000000000e+00   +7.076135265697387e-01];
L2E_L2I_iGABA_netcon = [+4.027607445815691e-01   +6.397207403956164e-01   +5.651380794065548e-01   +1.618381187405864e-02   +4.542776847199836e-01   +4.998112148023585e-01   +2.667690071901312e-01   +7.000327919575299e-01; +5.216459528522553e-01   +2.433126986084306e-01   +7.929759554187535e-02   +5.045752795458639e-01   +4.910419762467442e-01   +6.392413633192978e-01   +5.482787409025458e-01   +4.203923704759710e-01; +5.988908122580229e-01   +5.985837131131713e-01   +4.288607825827679e-01   +6.298517699047408e-01   +3.185487254121042e-01   +3.144517567268457e-01   +8.882090510991517e-02   +9.264185672448874e-01; +6.715152887695727e-01   +5.848637777641535e-01   +4.435611600669934e-01   +8.792519185592100e-01   +2.526119554690651e-01   +5.482372843669590e-02   +1.197170807648145e-01   +3.940041706731757e-01; +4.909491840827119e-01   +7.689431193045769e-01   +4.932662395439188e-01   +7.171321922084883e-01   +4.274270380603308e-01   +7.784906118378206e-01   +6.366398504921050e-01   +4.068888047256591e-01; +3.453741100251611e-01   +2.371227167416183e-01   +4.247801199274852e-01   +4.013803937993213e-01   +7.248417067235139e-01   +8.344355591478992e-01   +5.337659123583192e-03   +3.812963482540977e-01; +1.066555894398369e-01   +4.417802113791649e-01   +8.143260391700122e-01   +5.682950560035851e-01   +5.072631501363924e-01   +3.903919208551913e-01   +9.245048360167517e-01   -1.187469369347330e-01; +8.932563137551645e-01   +5.778934433419145e-01   +8.378443623214948e-01   +5.106941521998299e-01   +9.318727689866376e-01   +5.530756437667210e-01   +3.239871813855589e-01   +2.902603738622225e-01];
L3E_L2E_iAMPA_netcon = [+2.570660048028952e-01   +8.387353149164417e-01   +4.575337854909178e-01   +6.327163514569141e-01   +1.910462623335838e-01   +4.047690167815374e-01   +2.922539345492061e-01   +7.809076415825338e-02   +1.493417355789434e-01   +5.178934150172473e-01   +1.439195699400516e-01   +4.929104949436670e-01; +3.112105929801318e-01   +4.007663702757326e-01   +1.309577559133129e-01   +2.457328640823432e-01   +5.335343537240348e-01   +8.668596072021456e-01   +7.213379882827169e-01   +4.981262076892338e-01   +2.437000910844232e-01   +5.857685987174031e-03   -2.221714893194996e-02   +7.646245338815708e-02; +7.572017077702522e-01   +3.615229434473591e-01   +4.840748176711068e-01   +1.158461597446572e-01   +8.159735544283564e-01   +8.674143747465247e-01   +5.345380023504412e-01   +6.283181466544449e-01   +7.072974429116096e-01   +2.867243937882561e-01   +3.238445026159827e-01   +8.973680397857599e-01; +1.150024842762354e-01   +4.376075978241158e-01   +2.493993459057083e-01   +7.722652377327845e-01   +4.874292578691047e-01   +5.739441224825312e-01   +8.250888993911139e-01   +3.628943030590850e-01   +8.342632301980015e-01   +7.260445024349885e-01   +3.918778688161588e-01   +1.345321808373637e-01; +1.320000701346667e-01   +7.383850064470224e-01   +4.123161391625220e-01   +6.078325552483217e-02   +1.514364838781187e-01   +8.959194432872406e-01   -3.274304802496964e-02   +5.804946981815831e-01   +1.216100615066886e-01   +8.583985400297017e-01   +2.009604868841469e-01   +2.048296136026702e-01; +2.897007346251476e-01   +4.076821851933606e-01   +8.111498533570909e-01   +9.437685197347585e-01   +3.767173201073716e-01   +8.844299541037268e-01   +4.045900262814995e-02   +3.211823411275812e-01   +5.051545745039213e-01   +7.439798110078611e-01   +5.532109149884760e-01   +8.144051352232975e-01; +2.593952054839723e-01   +4.492136839547790e-01   +5.145223834899981e-01   +1.483209491027631e-01   +6.414160233330003e-01   +4.943312169804405e-01   +6.921415855193200e-01   +1.564761952656304e-01   +3.485538989120118e-01   +4.292605165947158e-01   +9.751592775866361e-01   +6.648479270190710e-01; +5.473365988174225e-01   -5.602960741901102e-02   +3.570643232444856e-01   +1.137186685692497e-01   +8.518678218676967e-03   +8.413740408955647e-01   +3.589946928106899e-01   +4.498177686720652e-01   +8.665325898630027e-01   +1.000000000000000e+00   +8.687963257720989e-01   +2.445197484769834e-01];
L3I_L2I_iGABA_netcon = [-8.034015111082465e-04   +1.830761910453432e-02   +1.048868764203679e-01   +6.166097910836422e-01   -1.134982571262584e-02   +4.993796060036231e-01   +7.438000344916389e-01   +4.226266090772854e-01   +3.607685275985226e-01   +8.862144900339982e-01   +7.957240311278814e-01   +6.392502585829958e-01; +4.139103422865598e-01   +3.532419853110114e-01   +2.995876942410168e-01   -4.496053295428006e-02   +4.885682842821961e-01   +6.093467938252103e-01   +4.632932696383541e-01   +8.829383256403290e-01   +1.933168023103391e-01   +9.184491894820369e-01   +2.191442991146980e-01   +5.812891549320052e-01; +3.339530400341050e-01   +5.838209697268791e-01   +2.663771681156761e-01   +7.317485783938532e-01   +2.633151946632002e-01   +8.207373112851228e-01   +8.569691822583215e-01   +9.247333622830360e-02   +6.549766308656133e-01   +4.294505133521077e-01   +1.415802702491025e-01   +5.714943336782410e-01; +5.812509890106162e-01   +9.639923801299882e-01   +2.395358642581791e-01   +1.758119543018124e-01   +1.814338246868141e-01   +5.626509212924159e-01   +1.636491639176221e-01   +2.023037339067108e-01   +8.169822915327787e-02   +3.998043001898455e-01   +5.167318957230098e-01   +7.446733140984714e-01; +9.077586265015354e-01   +1.047325944175067e-01   +4.595100632880545e-01   +9.123912579482804e-01   +4.419868797638969e-01   +8.443186247536056e-01   +1.301736150698974e-01   +4.834626743038754e-01   +5.365628140998322e-01   +7.019093233304431e-01   +6.926060785615571e-01   +4.234666002368016e-01; +8.589660216646537e-01   +2.119993499395437e-01   +1.354196815781079e-01   +7.017354797992205e-01   +8.579913085616095e-01   +7.723192998515657e-01   +9.210495742017486e-01   +5.844627067308361e-01   +9.776997339683813e-02   +7.825632274380372e-01   +3.149881722974019e-01   +5.741319269481456e-01; +5.162645101452545e-02   +4.743706102325579e-01   +8.718853762885563e-01   +5.927460262494695e-01   +9.193632376646569e-01   +7.036228147904144e-01   +7.821775896195400e-01   +7.331027218808482e-01   +5.606368994109902e-01   +3.910036326574176e-01   +3.386084703912964e-01   +4.594315071442462e-01; +4.103233701972566e-01   +1.218037407312003e-02   +7.764377798378982e-01   +2.200332894008435e-01   +3.977282780215285e-01   +6.116506209137861e-02   -2.137736745153951e-02   +8.290495150630590e-01   +4.062017521649972e-01   +5.128240719967864e-02   +7.299744357260958e-01   +5.776871044490400e-03];
L2E_L3E_iAMPA_netcon = [+9.099562969014118e-01   +1.976977100294424e-01   +4.422565377557818e-01   +7.532999778784890e-01   -3.597241220748988e-02   +6.183189970995252e-01   +7.825639393036665e-01   +1.652540956151585e-01; +3.564669788732225e-01   +5.055691009238938e-01   +7.023675854249620e-01   +5.684205372843976e-01   +2.584266358434228e-01   +1.174541896529388e-01   +7.885047377766572e-01   +4.139843007091418e-02; +5.881993659007752e-01   +4.674772517547306e-01   +8.682616942901508e-01   +5.399772837935756e-01   +8.955695505271604e-01   +4.530969536001752e-01   +9.751814085820830e-01   +4.279981858875678e-01; +2.202296854841571e-01   +9.054059904400978e-01   +8.402611282643342e-01   +3.482896202015889e-01   +2.988330207812468e-01   +9.531315479790793e-01   +2.372328528875365e-01   +4.760106819313938e-01; +9.239244840794002e-02   +2.413301942776104e-01   +7.167897343277079e-01   -8.466687128981557e-02   +2.340950432995793e-01   +4.957745714360836e-01   +4.638068946631237e-01   +5.746849897396198e-01; +3.234547628428989e-01   +8.314730936040676e-01   +2.052408512945909e-01   +7.686267084435681e-01   +5.012016729658945e-02   -2.266033703793112e-02   +4.674699987363799e-01   +1.882421768575128e-01; +4.157228143314954e-01   +7.391839515833868e-01   +6.978897445131373e-01   +2.475499300204742e-01   +7.418038085389544e-01   +2.031654041058384e-01   +7.036339463183027e-01   +8.636997039360719e-01; -4.422348020941728e-02   +4.882483006777046e-01   +8.673175701768092e-01   +4.101171986957824e-01   +1.302108846045664e-01   +7.294930179417990e-01   +9.707407625753674e-02   +3.608014367115573e-01; +1.000000000000000e+00   +8.874884705998513e-01   +1.029602232929268e-01   +1.367375046406726e-01   +7.846236864436508e-02   +8.821992417115637e-01   +2.635632187655990e-01   +8.667564966012204e-01; +1.427656892453364e-01   +3.847844376785110e-01   +7.618648148041800e-01   +3.129331580017040e-01   +3.947448918422787e-01   +8.322723384671055e-01   +1.141183533862776e-01   +8.243557100596387e-01; +6.660253205619546e-01   +3.266149113900782e-01   +3.265695910586909e-01   +2.919175440337254e-01   +1.200546653818039e-01   +3.298488696841579e-01   +1.704886587323535e-01   +1.617078742979912e-01; +1.015082415694458e-01   +5.829015063776737e-01   +8.459369005976455e-01   +4.655931363851569e-01   -8.330482894067968e-02   +6.799816794572328e-01   +8.058786136234122e-01   +7.017986246855752e-01];
L2I_L3I_iGABA_netcon = [+3.386104465844266e-01   +6.935111075582392e-01   +3.307495601526100e-01   +6.543587807330279e-01   +5.495413457405067e-01   +2.992557107277654e-01   +3.968886342375968e-01   +4.889171892844178e-01; +3.475288063889239e-01   +7.537535374825209e-02   +5.081250688631296e-02   +7.992493678853720e-01   +7.173299891635911e-01   -5.230116745344155e-02   +9.703551398717311e-02   +6.146816209907642e-01; +3.264110352853596e-01   +5.539627631726357e-01   +3.751329359957848e-01   +2.463092753885295e-02   +7.860240425811318e-01   +6.740967958836759e-01   +2.344530817478058e-01   +5.266697177831244e-02; +5.721830084016823e-01   +8.038839764506004e-01   +5.187108005225354e-01   +4.847546127909953e-01   +5.380739256967614e-01   +6.244578623255743e-01   +4.095577806864870e-01   +6.989168693014119e-01; +3.370645867381564e-02   -1.435981538684738e-02   -2.438605862328221e-02   +7.000658906097034e-01   +1.995449842726399e-01   +6.262529520913978e-01   +4.262215782188815e-01   +2.317487732878020e-01; +5.616944608403263e-01   +4.245274828579084e-01   +4.381824402766123e-01   +7.002627784532142e-01   +3.143764319019819e-01   +8.274634182741610e-01   +5.138504561094634e-01   +1.805373683132397e-01; +2.422898474374401e-01   -6.344615466824281e-02   +3.630390146570794e-01   +9.709402056434527e-01   +7.804193225538429e-01   +3.548169671234305e-02   +2.849298187344061e-01   +8.279693930652200e-01; +2.379310011715138e-01   +8.680886969693479e-01   +8.783712101647632e-01   +9.320014302617953e-01   +5.074799990334196e-01   +1.418444218387061e-01   +6.395113615035152e-01   +6.043235585925201e-02; +2.660193114333953e-01   +5.074704847049737e-01   +2.655008594614115e-01   +1.840147852642835e-01   +4.241291300676127e-01   +3.794199666471327e-01   +5.831259282412147e-01   +4.959523866698706e-01; +3.921517497138988e-01   +1.631833035219064e-01   +1.625619435287820e-01   +3.697253426532274e-01   +9.118966154382684e-01   +4.791132308887655e-01   +5.043180951611479e-01   +9.488038777095978e-01; +5.080569944706339e-01   +9.495279209816823e-02   +2.283851588720809e-01   +5.821924362953168e-01   +4.830260428393496e-01   +6.951498382788008e-01   +9.632030916939955e-01   +6.497875321507045e-01; +3.842631152269061e-01   +1.557258983432586e-01   +6.515810986226229e-01   +3.572160364080391e-01   +1.403151077807603e-01   -7.697009753835396e-03   +3.812313649092638e-01   +5.854425971708274e-01];
L3I_L3E_iAMPA_netcon = [+1.585345389473797e-01   +5.755829231844322e-01   +7.488653825156766e-02   +2.007162425171025e-01   +1.742723122297207e-01   +6.944669640103880e-01   +4.166057140105819e-02   +3.582131674800110e-01   +4.578404941133316e-01   +3.588591710513496e-01   +5.200854057654202e-01   +8.890881810971859e-01; +2.872673694857166e-01   +7.434059221309737e-01   +2.020917589556567e-01   +2.924732845353631e-01   +7.056750823400751e-01   +4.787397268118054e-01   +3.263311716932313e-01   +3.676502804492167e-01   +6.472562780964796e-01   +2.321837501395399e-01   +6.734546235132860e-01   +2.481397487070413e-01; +4.480182680311530e-01   +2.693505961745668e-01   +6.931136537530976e-01   +8.214576209542803e-01   +5.801969715542857e-01   +6.218080931155562e-01   +9.942826968192739e-01   +4.602526639331752e-01   +2.885930179407316e-01   +3.932629709212337e-01   +8.326766742294596e-01   +8.216036122140599e-01; +5.096621879619352e-01   +1.039855042792324e-01   +5.559442590172726e-01   +6.954043673244726e-01   +4.402421469740361e-01   +5.915650972663259e-01   +5.311862156523333e-01   +6.861494116704645e-01   +4.484887885617173e-01   +1.761916297169374e-01   +3.463777466764512e-01   +4.932770332829623e-01; +8.932858743692162e-01   +7.606284266061732e-01   +5.471135341215458e-01   +4.804028582409440e-01   +1.935783826273298e-01   +2.629107625085798e-01   -4.136244997124704e-02   +2.475487375032127e-01   -3.945364868908213e-02   +1.971453200801773e-01   +1.080091812624486e-02   +4.236774024324532e-01; +3.402672909066052e-01   +1.186832784585958e-01   +6.463242392571298e-01   +4.815235473500161e-01   +9.466998500621229e-01   +5.535076154344858e-01   +2.249012686026856e-01   +1.801599402114294e-01   +1.596621654842040e-01   +5.517135801906315e-01   +2.635186370264071e-01   +1.181073815025342e-01; +5.302475207627744e-01   +3.074509659533674e-01   +7.457272705735107e-01   +8.380774137278733e-01   +1.385531916618624e-01   +9.995686467840925e-02   +3.811159213819370e-01   +5.653241928449754e-02   +8.577707408651976e-01   +6.897697345635632e-01   +3.139435936216264e-01   -2.297171689655985e-02; +3.053042376106244e-01   +4.013945368954110e-01   +3.091601653432320e-01   +6.221151045257834e-01   +7.786365537435873e-01   +2.031216577782810e-01   +3.411186405535322e-01   +2.678631465647827e-01   +2.710628497022114e-01   +2.774041077508377e-01   +5.677157830426360e-01   +4.792874046153437e-01; +3.920621939089551e-01   +4.241853857784801e-01   +3.847760166255829e-01   +6.174616157429755e-01   +5.651437215243754e-01   -6.643233439515139e-02   +1.425809801600939e-01   +3.577162609578700e-02   +3.328868897760403e-01   +2.330208653341650e-01   +7.606584664542960e-01   +9.177140944699900e-01; +7.173803154839988e-01   +5.607753348945282e-01   +5.380089100350602e-01   +4.416956931885547e-01   +4.221897299353743e-01   +3.225779234672770e-01   +1.992540119764287e-02   +6.639863285680435e-01   +9.455751311437956e-02   +8.209020041787836e-01   +3.605276938444528e-01   +1.351308430257625e-01; +9.406503919138390e-02   +2.658574701087530e-01   +5.570286648087254e-01   +1.702579879999120e-01   +1.211905272591726e-02   +5.163719770685717e-01   +2.901350791630980e-02   +7.420932639322402e-01   +6.734747078730079e-01   +2.101482781092470e-01   +5.918343934717379e-01   +3.239919135295826e-01; +6.031282418423123e-01   +7.086541885872683e-01   +4.140423940623385e-01   +5.506259844688712e-01   +6.490838996958467e-01   +3.406794189600643e-01   +3.178897722065624e-01   +8.534155930903264e-01   +5.574351294058889e-01   +2.606281515657633e-01   +4.219993114329056e-01   +4.400863970598453e-01];
L3E_L3I_iGABA_netcon = [+3.595018273183914e-01   +7.640950944712023e-01   +6.398824633966405e-01   +9.419434283521151e-01   +5.144825998662141e-01   +8.162166888643606e-02   +2.817165199606351e-01   +6.472820857689301e-01   +6.559132515287068e-01   +3.662050131880660e-01   +4.588718103908118e-01   +3.026621358298552e-01; +8.845770470647442e-01   +3.341031574911953e-01   +5.938977220581717e-01   +9.173870676126730e-02   +8.632383623674070e-01   +3.845591663336601e-01   +8.660743260197634e-01   +5.897083503087591e-01   +5.340142504690244e-01   +7.990626611342195e-01   +2.608461491859735e-01   +4.785852316629480e-01; +7.297276716773028e-01   +3.835745867526009e-01   +4.297409353977255e-01   +5.391726475670493e-01   +5.692266744868005e-01   +5.115216851306511e-01   +2.383754473646380e-01   +8.972599231640532e-01   +4.829460953751269e-01   +2.150462135546782e-01   +8.232470889904056e-01   +8.767441383932458e-01; +2.152354782268579e-01   +5.976079230995724e-01   +2.741910565744953e-01   +3.174006723452835e-01   +1.293183403516991e-01   +5.898254718452131e-01   +2.954158497593357e-01   +1.010586189364490e-01   +2.239888372117210e-01   +5.012155889598526e-01   +7.524728069993244e-01   +6.050691315675946e-01; +3.299408298795179e-01   +6.024602252418166e-01   +5.774214376791206e-01   +3.140975176226540e-01   +1.359638173466546e-01   +7.086482677893806e-01   +8.197776250120780e-01   +2.908205749864252e-01   +1.773377013463085e-01   +7.762433629567876e-01   +5.926515514062771e-01   +2.607783952626064e-01; +4.225850654230700e-01   +7.921639202325518e-01   +6.957325729955861e-01   +5.092755759571599e-01   +7.266911517654190e-01   +6.960251935399199e-02   +3.120269318388551e-01   +2.096745712416576e-01   +8.839172707954853e-01   +9.100262852699805e-01   +8.294094032325426e-01   +2.588789916017762e-01; +5.965957301447988e-01   +7.415318250544978e-01   +2.112673942352691e-01   +6.253853531085668e-02   +4.328525714623275e-01   +5.588079418924035e-01   +6.221470410160607e-01   +1.705772914887987e-01   +9.175213624119017e-01   +6.302483895896950e-01   -3.367568649921917e-02   +3.007546128681213e-01; +5.153754100057049e-01   +3.905696763709024e-01   +9.201365116982470e-01   +4.623952295296858e-01   +1.616201997022150e-01   +3.584385419332736e-02   +5.909485410493615e-01   +1.095416144544157e-02   +6.044427369925375e-01   +7.873178039571285e-01   +2.780982573913863e-01   +9.639436375600871e-01; +2.723974688050391e-01   +5.444622236575687e-01   +2.766084457573490e-01   +7.606366082795246e-01   +7.610905699970415e-01   +1.271038704187129e-01   +3.587719716153771e-01   +6.176157023376717e-01   +6.162869727297640e-01   +7.509866647612317e-01   +6.916650787121690e-01   +6.398736986619893e-01; +5.005397070653347e-02   +1.166195337530262e-01   +3.271198275294071e-01   +5.305248548472289e-01   +6.543059607000649e-01   +2.121615802664798e-01   +4.550682020378361e-02   +3.259491746837951e-01   +6.885138577086473e-01   +2.042009139389716e-01   +5.675582446375363e-01   +8.962799884661538e-02; +9.037077794739518e-01   +7.207021711162064e-02   +7.020279344592965e-01   +4.899347405221335e-01   +3.797073285317513e-01   +8.407114255759139e-01   +1.324114733271543e-01   +8.513266363610936e-01   +2.436812516910333e-01   +8.902703609751131e-01   +5.280385650600311e-01   +7.085823019446355e-01; +6.606225001856535e-01   +8.210351249465531e-01   +5.181104612766656e-01   +8.211300858591978e-01   +8.246193197074985e-01   +4.995246009062097e-01   +8.912301386996764e-01   +8.696413415854232e-01   +5.150620039080576e-01   +8.010689863481041e-01   +4.748408497036855e-01   +9.304538701137144e-01];
L2E_Input1_iAMPA_netcon = [+9.276031152676639e-01   +9.694300876035901e-01   +8.494652422063705e-01   +9.361967323479029e-01   +8.598547091693607e-01   +9.897158783874567e-01   +9.149484591834125e-01   +9.155280542900863e-01];
L2I_Input2_iAMPA_netcon = [+9.022013456754664e-01   +9.003087256196445e-01   +9.918628213566653e-01   +8.671781581010711e-01   +8.618178678555688e-01   +8.877489576996724e-01   +9.070994106963688e-01   +9.379445836106576e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last =  11.21 * ones(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))*0.4 + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.5*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.5*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))*0.9 + 0.5*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))*0.4 + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.5*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.5*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))*0.9 + 0.5*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
