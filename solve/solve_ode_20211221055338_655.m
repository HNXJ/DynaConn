function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+7.329859286157194e-01   -8.411807372127941e-01   +5.817588517467922e-01   +6.135340849767842e-03   -4.753455334231745e-01   -3.778989727186918e-04   +5.047462219411983e-01   +4.537526353021180e-01   +3.883407386870349e-01   +2.840354322188352e-01   +2.315125114597580e-01   +3.527453250113982e-01   +1.012506316377557e-01   +2.736278784637947e-02   -9.703751577067316e-02   +3.129448797032079e-01; -2.853248281055406e-01   +1.723232091383358e-01   -4.193301828568938e-01   +1.164979539163070e-01   +3.050068682718228e-01   -2.310426308480656e-01   +3.775792179145885e-01   +2.894946648950547e-02   -2.606418329599905e-01   +6.571025620498669e-01   +5.820832108808422e-02   +8.061357224557059e-01   -1.273086736128568e-01   -3.440795592512899e-01   +2.150670759423064e-01   -1.324862977068400e-01; -1.226434820231069e-01   -4.792537018731591e-01   -3.732206619685174e-01   +4.361784188326728e-01   -7.767243798080221e-02   +1.156230465051210e-01   -1.214919251469289e-02   -7.729244930538276e-02   -3.837862261424509e-01   -5.049358687710809e-04   +1.138024852217175e-01   -9.546347835039284e-02   -2.037911831706403e-01   -2.644341523609253e-01   -3.877357750854301e-02   +1.132056463725507e-02; -4.802027275717962e-01   +5.336930614437972e-01   +1.196347619108423e-01   +6.812105479655232e-01   -4.570967087996526e-02   -4.347256356372190e-01   +7.926334974028890e-02   -1.245747219215420e-02   +4.041520818886383e-01   -1.292828222380753e-01   -4.711384821502699e-01   +5.101561465178482e-01   +4.205256517923919e-02   -6.868732549634220e-02   -1.754008681586002e-01   +1.636260678259661e-01; +1.454875218353971e-01   +1.552202289755855e-01   +6.324840671388736e-01   +6.353160108494535e-01   +2.168213860618055e-01   -2.831832211124755e-01   +5.918505915918690e-02   +2.007675528608181e-01   +1.099895734951592e-01   +6.005283186554689e-01   +3.663821045184951e-01   -1.163116398645136e-01   +2.363510701814283e-01   -3.391956325401967e-01   -1.037917825392071e-01   +5.310667868386946e-01; +4.604057072136255e-01   -4.796950228231933e-02   +2.109704747449526e-02   +3.386034810345616e-01   +3.532019362616094e-01   +3.196695839541966e-01   +3.712259197057926e-01   -5.069551276342819e-01   +5.303699603260297e-01   +1.002781037909321e-01   +2.056483223309640e-01   -6.856020853188318e-01   +4.226969573550189e-01   -1.942464107382001e-01   -9.662925049420870e-02   +5.164948892374888e-01; -4.407948065034096e-01   -1.910208463089885e-01   -8.236301328056919e-02   +3.935887551120937e-01   +7.150765634960928e-01   -2.319058300445989e-01   +2.526580115478821e-01   +4.770241256771823e-01   +7.560500523620239e-02   +1.786166782089685e-01   +6.728346218774205e-01   -2.304170760755671e-01   +2.635877949063693e-01   -4.980600622620263e-01   +1.299259943587098e-01   -5.421076852181028e-01; +6.762520246946011e-02   +3.528774972144797e-01   -1.389646417912439e-01   +3.284468748474266e-01   +1.226170184179757e-01   -3.590326357643475e-01   +2.071175011908519e-01   +4.771109509800344e-01   +1.129627361282561e-01   -5.273263886297181e-01   -3.711864209537677e-02   +7.809762754323755e-02   +6.098263036460616e-01   +4.544501482386972e-01   +2.031890006691396e-01   +3.008174590737670e-01; +3.319283357842462e-01   +6.809348095632967e-01   -3.497764602324898e-01   +5.329511216454944e-01   +1.715477772174320e-01   +1.626777144404373e-01   +3.783589567332547e-01   +3.621230588878356e-02   -1.792941718076168e-01   +3.238893338846809e-01   +4.659750119812110e-02   -4.207206425567737e-02   +4.751118717708696e-01   -3.329451552531324e-01   -1.855078036913924e-01   +4.324277326675364e-01; -2.752229851196656e-01   +8.370750142854594e-02   -2.024100578928307e-01   -2.990458937509953e-02   -8.391491457806505e-02   -3.896336890803913e-01   -5.336257051699229e-02   -5.061268466064560e-01   +2.075572318654491e-01   +4.878407902002335e-01   +3.318787985261475e-02   -2.653693270407305e-01   -2.750130828652925e-01   -2.549263360189581e-01   +1.108502781294861e-01   +1.973393324177779e-01; +2.942077905206459e-01   -4.052536958644543e-01   +1.978126961133564e-01   +2.798467896999458e-01   +2.520184784143727e-01   -1.184195733037386e-01   -2.266243901881173e-01   -5.180543326916761e-01   +1.250299923604986e-01   -4.252069064348466e-01   +1.102178271180028e-01   -1.355140235106762e-01   +5.800003640905980e-01   -3.240560652742200e-01   +1.000200712732811e-01   +7.785532135834139e-02; -3.843692152915631e-01   -4.604022099410051e-01   +6.023307870735743e-02   -2.665064380977525e-01   +2.188793616459651e-01   -4.038648177408723e-02   +5.447914718762957e-03   -3.848937105372380e-01   -2.569930096368200e-01   +4.993545030263762e-02   -1.619187051175666e-01   +3.166096411961978e-01   +4.625241620737710e-01   +6.712258784165226e-01   +1.020413414807069e-01   -2.647145918214622e-02; -2.935970858546506e-01   +4.037566062206753e-01   -3.616500483376651e-01   -1.573120189793051e-01   -3.100438648547735e-01   +4.736781808379245e-01   +4.578086311539104e-01   -7.647109670928125e-02   +3.080237653598686e-01   -2.558773342302344e-02   +2.847854376337661e-02   +6.040340727968757e-01   +1.398839002330879e-01   -1.298402969233700e-01   +1.543192747680465e-01   +1.258206033440067e-01; +4.758629741687679e-01   +5.218600888386780e-01   +3.169115684879234e-02   -1.381487658919304e-01   -5.686371265953315e-02   +4.420432768400150e-01   -4.001187181200943e-01   +3.017651713771107e-01   +5.606181383108345e-01   +5.307250142776575e-01   +3.414306850375134e-01   -2.041097875962837e-01   +1.646359297724310e-02   +3.273894082176835e-01   +3.071930323632299e-01   -2.064792515384966e-01; +4.427727378992823e-01   +4.151257372755230e-01   +5.141102391311477e-01   -3.189751314846101e-01   -4.594405543650582e-01   +1.394042307129765e-01   -2.608522455022078e-01   -3.867588729941328e-02   +2.899358741277401e-01   -4.882551209563877e-01   +7.269459052418836e-02   -3.104614443266431e-01   +7.469344057040708e-01   +1.728148815720266e-01   -2.852301959378563e-01   +2.033633484383354e-01; +5.220589882301199e-01   -3.946700598294287e-02   +4.030142635187737e-01   -2.167489493680352e-01   -5.691444474581748e-01   -1.607849961318099e-01   -2.922141709215239e-01   +1.364799029918452e-01   +6.280488319610569e-01   +3.822681561609408e-02   +9.677569627662369e-02   -1.869156105495697e-01   +4.420889393477163e-02   +3.293823579813442e-01   +4.112826748069454e-01   -3.519442566368161e-01];
L1E_L1I_iGABA_netcon = [+4.773308845184338e-02   +4.979197062633078e-01   +4.733873141996907e-01   +1.105921437211102e-02   +3.892573488169405e-01   +5.102121570000512e-01   +1.317875338026489e-01   +6.829071148370724e-01   +8.965529897302257e-02   -5.056858117287558e-01   -2.046303958647880e-01   -2.946903205527435e-02   +6.704746803404698e-01   +1.939390443933926e-01   +3.900908593236890e-01   -4.942918528999743e-01; +1.361830436827836e-01   -2.135574458285866e-01   -2.615747029429080e-01   -1.577385414523002e-01   +2.283627513270122e-01   +4.172747675453100e-01   -4.598864339490426e-01   -4.416736890657699e-01   +3.855881651290489e-01   -9.920289541806508e-03   -3.785640268497439e-01   +2.373798139720371e-01   +2.473209001570615e-01   +2.514998563139520e-01   +3.872179163138680e-01   +5.867916795494010e-01; -3.851230898117836e-01   +2.385383315367229e-01   +1.672769407650869e-02   -5.368025558328553e-01   +2.216021592597452e-02   +7.042388289696803e-02   +1.300840488395839e-01   +7.740412031716539e-01   -1.650445304965593e-01   -6.433422531951728e-01   -2.289574774430606e-01   +1.774222773631326e-01   +6.379363443742425e-01   -4.978101977986056e-02   -7.328606083771581e-02   -1.718675582312157e-01; -7.417487531596915e-02   +5.527565481285980e-01   +4.471281502347597e-01   -5.465048760536581e-01   +4.090765158216920e-02   -3.129642744985361e-02   +3.845487335330037e-01   +4.071616568588160e-01   -2.711820809248275e-01   -3.744430278684176e-01   +2.359187264532969e-01   +5.193590466489125e-01   -8.905230764968027e-02   +1.859219253823258e-03   -1.867097819464849e-01   -2.478167024405232e-01; +3.461858095331352e-01   +4.570664496585302e-02   -3.907587765789681e-01   +1.384027017587601e-01   -3.301668607251310e-01   +1.390515018497553e-01   +1.114952228148070e-01   +3.339181155576770e-01   -2.454896365694417e-01   +3.269566907314855e-01   -6.781397031720272e-02   -6.652161990893975e-02   +2.626375195615127e-02   -1.549798985246009e-01   -3.472474745508425e-01   +7.458364630481842e-02; -1.454010570181514e-01   +2.312736157434792e-01   -1.767831624530022e-01   +2.150007628201018e-01   +2.461629792239326e-01   +4.525381097563801e-02   +1.027940189520219e-01   +9.979746390546451e-02   +3.322556818518085e-01   +4.711575138976002e-01   +2.731279956191137e-01   +1.335633826988720e-01   +4.123925210751301e-01   +6.520609775995424e-02   +2.814312077399989e-01   +1.195928747951173e-01; +3.041140719342981e-01   -4.975608184193601e-01   -3.729088082278768e-01   -8.712776961685123e-02   +2.506289371030788e-01   -1.457784156238025e-01   +2.611077577029541e-02   +3.130225079463225e-01   +1.121730182146286e-01   +3.509127629076579e-01   +7.931181528899342e-02   +8.963400456595806e-02   +3.390606896923049e-01   +9.889326618636746e-02   -1.823971705753664e-01   +4.560665476748968e-01; -3.386206179807015e-01   -4.219684742170724e-01   -1.782076319890702e-01   +4.365008035790582e-01   +3.546042932629934e-01   +3.131714857319068e-01   -2.194338824837278e-01   -6.989856478432879e-03   -2.879913120029342e-01   -7.193607274275916e-02   +4.591737786759360e-01   -1.881093543461932e-01   +1.090072473888249e-01   +3.435372287422155e-01   +8.511412034400660e-02   +2.335165265653293e-01; -4.303513660408292e-01   -2.736863351258048e-01   -6.218852706027342e-01   -2.238888881149395e-01   -4.680132208775645e-01   +2.608469119481564e-01   -1.309202663332127e-01   +4.262821578781087e-01   -3.210266144730031e-02   +5.178414390805242e-02   +4.291681385076617e-01   +7.352219355860488e-02   -3.578894619046100e-01   -6.404809614014059e-02   +1.383234424957813e-01   -1.078364613182577e-01; +4.752920055634755e-01   -1.439595585066480e-02   -1.191164070227973e-01   -3.616121583697876e-02   +5.214118770756672e-01   +8.629834227910677e-02   +5.807097436779102e-01   +4.837571535203090e-02   -2.166890851085215e-01   +1.084873705011777e-01   +6.753224977936519e-01   -2.595298150437592e-01   +1.205349078474013e-01   +6.735391007842162e-02   +4.477828952967875e-01   +3.293010289133187e-01; +8.606910562430622e-02   +1.304906262156672e-01   +3.704790691860246e-02   -8.917709440785040e-02   -1.631961448760558e-01   +3.679668700601531e-01   -4.290422120973350e-01   -2.229841331102735e-05   +4.328969286074335e-01   -2.059559565314288e-01   -6.347220318635352e-02   +3.603432495994846e-03   +3.076811074201268e-01   -4.967087342538843e-01   -1.341153566588266e-01   -2.794997646548336e-01; -9.946259325136872e-02   -2.057105540656767e-01   -1.582938068632680e-01   +3.687312402482005e-01   -1.665844047198654e-02   -6.300466661016253e-01   +6.975247076602532e-02   +3.583948461484146e-01   -7.129691918322807e-02   -4.415838859150408e-01   -3.779674516480468e-01   +3.633975558078247e-01   -2.037798416385882e-01   +3.359535016227527e-01   -7.930555679347834e-04   +1.572970397615436e-01; -1.649632565516434e-01   +2.887747601758514e-01   -3.442884564634920e-01   -1.860862693146413e-02   +5.801559378218474e-02   -8.831873025203070e-02   -1.903096990662957e-01   +1.511060422772927e-01   -3.578021220489432e-01   -3.122888203514394e-01   +4.520564526017129e-01   +4.103343225959977e-01   +1.589728226886232e-01   -3.063064097239222e-01   -1.582134524849799e-01   -1.273775293723506e-01; +1.986558315427706e-01   -6.726733297099893e-01   +4.203461985249646e-01   +3.236924305650742e-01   -1.762542873736030e-02   +2.292765787062633e-01   -1.702451602344735e-01   +6.132289645587503e-01   +3.733646777831547e-02   -4.448572588689216e-01   -5.851111896492148e-02   +5.168396863911493e-01   -4.851757646100246e-02   +2.644096238831239e-01   -6.409280202655259e-01   -4.253629111384501e-02; -4.833311730661513e-01   +6.190894120800718e-01   +3.280510769409059e-01   +4.021114141613514e-01   +4.441005154558275e-02   +1.833828545753965e-01   -3.711429577077463e-01   +1.415265015639937e-01   +4.296265726853878e-01   +2.313977945712145e-01   -1.732531691441076e-01   -2.333482434671544e-01   +1.474852837077827e-01   +1.858981887707369e-01   +1.384946339684175e-01   -4.058996245497531e-01; -3.786779454265108e-01   -1.002168733164084e-01   -3.809334262271363e-01   -6.213316629971573e-02   +2.622241672719529e-01   +2.072494907539368e-02   -4.558884545730617e-01   -3.931477625909785e-01   +1.982406101301663e-01   -5.818673550937937e-02   +3.402063119991201e-01   -3.863903084943539e-01   -9.984858613467408e-02   +1.213463592813778e-01   +1.599985033157046e-01   +2.856461372886667e-01];
L2I_L1I_iGABA_netcon = [+1.500640289187720e-02   -1.243554234444891e-01   +9.642633702364317e-02   +3.191544135079039e-01   +5.333542590051326e-01   +1.282968913488854e-01   +3.235527889301679e-01   +3.833614910142828e-02; +1.525852560683039e-01   -2.637433563614760e-01   -4.103151430344597e-02   +2.189073715467427e-01   +4.253238255292329e-01   +2.661494866871114e-01   -2.984165820656808e-02   +2.647745684179011e-01; -6.333768728210391e-02   -2.113190241886323e-02   -5.477440316891375e-01   +8.560310791667300e-02   -1.046856828206103e-01   +8.956978541596669e-02   +1.967617020588446e-01   +3.213905117577742e-03; -3.422108396059872e-01   +1.587485847613114e-01   +2.131525882377229e-01   +2.156364750411255e-01   -1.584358689251677e-01   +9.146029242900386e-02   -2.310968598736609e-01   +1.713672305025006e-02; -3.958015568489902e-01   +1.254927557992777e-01   +5.972918600499824e-02   -2.478805202241996e-01   -3.042083043545147e-01   +5.643530358498177e-01   -5.830793451650047e-02   -9.237077652691453e-02; -3.236779622675796e-01   -9.266546875276484e-03   +4.566852435121434e-02   +2.497740602940980e-02   +1.149893610428173e-01   +3.031713770477946e-01   -1.092413675036003e-01   -2.238184122213430e-01; +3.673376313843107e-01   +1.907845395733875e-01   -2.332341920152681e-02   -1.587704170059796e-01   +1.467754752607280e-01   +2.816319166617144e-01   +2.647570141870462e-01   +4.858539711160987e-01; -2.524416785909562e-01   -5.405690687603991e-01   +5.047769510933579e-02   +3.367192149567217e-01   -8.757992877416287e-02   +3.087879388849495e-01   +1.881056935113647e-01   -5.256945063325628e-01; -1.886049730042544e-03   +8.481243888347029e-02   +4.425859566147492e-01   +2.202022886543023e-01   +8.004008540055331e-01   -5.388528122380572e-02   +2.090083361447001e-01   +1.919084272561559e-01; +4.286749599493147e-01   -2.444316102477986e-01   +4.709273336328354e-01   -6.024213127782549e-03   -2.602162172300496e-01   +1.366802321215381e-01   -8.126082100208820e-02   -9.731554888992279e-02; +5.358144461847122e-02   -3.235879883293195e-01   +4.345535954470742e-01   +2.305656310442785e-01   -3.613166683068497e-01   -2.200198925614217e-01   -3.626710209747411e-01   -2.904514105262755e-01; -3.196125178874995e-01   +1.456843328338249e-01   +5.220603317159761e-01   -6.065550439300950e-02   +9.503510911188250e-02   +2.223846992585068e-01   +6.252690581149749e-01   +2.345896259821726e-01; +3.990514477596170e-01   -3.442883776583999e-01   +6.663646804000157e-03   -5.529812852673308e-01   -3.452730535893295e-01   -1.926620470401894e-01   -4.025846679731862e-01   -1.584249222237309e-02; +3.388526113453073e-01   +4.432744872161525e-01   -1.635555184993584e-01   +2.164520630944351e-02   +3.042578838551345e-01   -1.108170662859810e-02   -2.490262544253143e-01   +1.782914573857147e-01; -7.232749895835421e-02   +1.297763284843295e-01   -1.198066118400065e-01   -1.110886559245325e-01   -1.427615694308050e-01   -2.755702716337241e-01   -2.041338443616819e-01   -3.403852335256870e-01; -2.734259882741549e-01   +1.063164202272556e-01   -2.826327577460532e-01   -5.953631466234711e-01   +2.861991957626939e-01   +3.323375478918941e-01   -4.794562666688331e-01   +2.027827962511457e-01];
L1I_L2I_iGABA_netcon = [-4.991576278776747e-01   -4.216099440430778e-01   +1.180518841713021e-01   +2.415460779612107e-01   +1.685578557190804e-01   -3.333336487864963e-01   +3.228865575065556e-01   +1.923451436246300e-01   +4.322509454247612e-01   +1.684171943834560e-01   -8.940256797249234e-02   -2.467372029252918e-01   +6.069255062390038e-01   +1.004691759901719e-01   -1.658803140100105e-02   +6.658856281812593e-01; +3.214291548727353e-01   +6.037315649168183e-01   -1.385411069354206e-01   +7.178558829686614e-01   -6.312196390082386e-01   +6.055641181476009e-01   -9.681280437586773e-02   +1.586293893616782e-01   -5.681085113029434e-01   +1.384523520774120e-01   +3.859827266795038e-01   +2.077549582399272e-01   -6.598561225958247e-02   +3.926131983099516e-01   -5.035235846077134e-01   +1.511623240813012e-01; +1.746529908673079e-01   +2.288635405911648e-01   +7.785152850198781e-01   +4.671367090913396e-01   +3.786645468205178e-01   +4.553420392858256e-01   +1.758343710048858e-01   +5.757172419821834e-01   -2.959672972921737e-01   +2.227168560244558e-01   +9.991846448515630e-02   -4.675500155003519e-01   +1.395982507110627e-01   -2.406562555638583e-01   -5.760796649780722e-01   -1.361064569904674e-02; +4.618651230391714e-02   +9.006294532928347e-02   -7.083692096598624e-01   -2.828885829550144e-02   +1.023435661793658e-01   -1.920488891676520e-01   +1.698326930166456e-01   -3.568630783615242e-02   +2.182941489032398e-01   -2.071123674615697e-01   +1.959987795134233e-01   -5.122139138110258e-01   +1.232190467882992e-02   +8.379493341315389e-02   +1.859650396029864e-01   -5.476406981431784e-01; -3.187899241431708e-02   +1.235259153330702e-01   -2.286213927707098e-01   -2.078540274145258e-03   +1.254819535221079e-01   +1.951756432969143e-02   -9.701117623187233e-02   +3.806044784933126e-01   +5.467570743293658e-02   -2.476164975788632e-01   +4.334708495982856e-01   +7.327689431621948e-01   -7.344108856819218e-01   +7.281566821368442e-02   +1.646497351660941e-01   +1.737485639243520e-01; +2.073966827211961e-01   -2.361286415984428e-01   +2.841049386844122e-01   +3.932571490662280e-01   -3.868686913982251e-02   +2.808127546299759e-02   +1.701901810759889e-01   +2.628100021255512e-01   -3.237506770104956e-01   -2.794539338912886e-01   +2.886170000018924e-01   +3.864686746032394e-01   -3.959129599127446e-01   -3.516581617714655e-01   +1.234627468752072e-01   -5.223927656941550e-02; -3.274595476773178e-01   +7.040149692773662e-02   -5.715092371969152e-01   -1.914312005103374e-02   -4.458401724032915e-01   +2.085593287797995e-01   -2.659945549157551e-02   -5.953182170917490e-01   +4.962920339704743e-01   -5.204123325593799e-01   -3.257569531092637e-02   -4.889811046356036e-01   -2.103956151445545e-01   +1.151259429226853e-01   +1.207112043349893e-01   -8.922718080707816e-02; +3.479037416499960e-01   +2.379543613944724e-01   -4.109410989042269e-01   +6.435251542808790e-02   +3.278793584129446e-01   -3.426762460336252e-01   +4.145770143829994e-01   +4.066135357216545e-01   -1.253709194293007e-01   +2.292503590411953e-01   -1.815148814698738e-01   +3.849578149920475e-01   +1.593508155180445e-02   -2.203539058633872e-01   -1.208391048194987e-02   -1.864012070187593e-01];
L2E_L1E_iAMPA_netcon = [-7.662772743286271e-02   +3.667545983368767e-01   -2.568058487971786e-01   -7.242567484820275e-02   +5.331465625038523e-01   +4.682548340974303e-01   -2.732043634941341e-01   +2.710200762502385e-01; -2.879194201196331e-01   +5.627386526314642e-01   -1.975881980898845e-01   -3.301409007790985e-01   +6.362624687357367e-01   +2.353607356106696e-01   -4.364005485177360e-01   -2.307494520004779e-02; +3.056730920295277e-01   -5.944754812966337e-02   +1.887583083793648e-01   -5.664932256704912e-02   -4.737443414260738e-01   -2.399251655641562e-01   -9.410219990603952e-02   +1.749159052740287e-01; +6.229185258571027e-01   -8.497918408587220e-02   +3.006134431876917e-01   +4.003840287423642e-02   -1.546634012706211e-02   +2.963637482659475e-01   +3.079078470761971e-02   -1.609586624998716e-03; -3.418115213274415e-01   +2.795406869108094e-01   +2.901958123674188e-01   +1.350954206535190e-01   -1.219869655238731e-01   -3.050093916091600e-01   +3.838790365868086e-01   +2.979758810615310e-01; +6.558794786732099e-02   +3.789458782756492e-01   +4.720529106390223e-01   +1.216903204400712e-01   -1.043644007112208e-01   -3.746902768883644e-01   +1.336580299995961e-01   -2.948522898113138e-01; +6.355774684101195e-01   -2.781440426019065e-01   -5.224299302377913e-01   -6.621777874082054e-01   +5.674005236425080e-01   +1.634422478715154e-02   -2.280427865123285e-01   +5.144086047067767e-01; +2.715320942916000e-01   +7.724180990247877e-02   +6.487272525947012e-02   +2.911662944195388e-02   +1.784355626304060e-01   -5.167768944619759e-01   +4.289676622215520e-01   -4.677537750844802e-01; -3.101459655476481e-02   -1.850931724967597e-01   +3.496544963760823e-01   -1.326637851450479e-01   -9.248899454669099e-03   -1.621346639575047e-02   -1.852475954066317e-01   -2.349612534177531e-01; +8.499906270011617e-01   +1.108690618960565e-01   -7.900919072896878e-02   -3.830089888494228e-01   -1.875509832805393e-01   -8.152222111449201e-02   +2.001990581919947e-01   -7.726834651848072e-02; +1.203417304923035e-01   -1.289366557515866e-01   -9.742243026938273e-02   +5.108545962103355e-01   -1.323322540001047e-01   +2.466519666054873e-01   -5.777258180447220e-01   -3.294101625623976e-02; +2.450822110756539e-01   -2.113922470013166e-01   -3.314969147978628e-01   -9.695504629513178e-02   +5.405882175179250e-01   -1.584523334840790e-01   -2.017058358126005e-01   -1.770702806958624e-01; -4.482219021388191e-01   +2.337382594225767e-01   +1.024417274905951e-01   +2.257097232883787e-01   +5.695773945229630e-01   -2.514673476998297e-01   +3.948593583550675e-01   -3.174307906530426e-02; +5.545999819574800e-02   -5.757198693714635e-02   -5.762300365696903e-01   +5.928818057405351e-01   -3.572308533357063e-01   -4.184317950587583e-01   -1.358152149659568e-02   +5.402891656590712e-02; -5.952416233649804e-01   +4.443566910432136e-02   +9.557611174137139e-02   -1.216232881815778e-01   -4.056934587300115e-01   +3.195028630936013e-01   +1.360698389320086e-01   -4.223470811320481e-01; -3.161126052168272e-01   -1.489532674136773e-01   -5.181746042414070e-01   +1.130110767975150e-02   +2.629317888798500e-01   -2.164990835263969e-01   +1.219495071289233e-01   +1.022268774237974e-01];
L1E_L2E_iAMPA_netcon = [+2.444074703701823e-01   +4.051275118854453e-01   +3.986194632450504e-01   -2.021943161119394e-01   -2.806116423006841e-01   +1.599622147015929e-01   -2.778938295749313e-01   -3.226385364560068e-01   -2.612922274641168e-01   +1.504833158315858e-01   +5.198589842262370e-01   -4.495461743944832e-01   +4.881292208759430e-01   +1.988329567386461e-01   +3.954978787995425e-01   -3.838261328210673e-01; -2.031023684418355e-03   -8.479129978350020e-02   +9.859367015052448e-02   +1.520370281883889e-01   +2.394566144423320e-01   -2.849554736318181e-01   +5.924012309338538e-02   -3.813457040440676e-02   -1.369998274576460e-01   -5.845639063845076e-01   -3.919159943223132e-01   +2.550601454647806e-01   +8.972019078910948e-02   +4.235061249940076e-01   -2.467192963317386e-01   +2.176154655322733e-01; -1.623862594894036e-01   +5.861356606011821e-01   -7.651955615623184e-02   -1.323642427326864e-02   -4.987570482671819e-01   +1.650164536297552e-01   +1.861217657504868e-02   +2.645312824498036e-01   -6.590071454822560e-01   -1.456269739143824e-01   +1.044843025410903e-01   +3.314695547084047e-01   +5.170807451549090e-01   +3.348495245924418e-01   +2.110481593019487e-01   +2.688735925779639e-01; -5.943544665813543e-01   -9.504255383799641e-02   -7.616877261240054e-02   +4.348701532934095e-01   -6.704525449693407e-01   +2.451826060989068e-01   +1.107212327319816e-01   -3.762272829838439e-01   +1.665161323412161e-01   +2.302863397042349e-01   +1.902250992324892e-01   +2.700074202778439e-01   -1.981387907038076e-01   -2.830024687657506e-01   -7.701599218332209e-02   +2.643733133049117e-01; +3.010358706755023e-01   +4.506751948530950e-01   -9.724081453884328e-02   -6.597583514345881e-02   +3.019290880255370e-01   +4.701471885922185e-01   +5.936373861544900e-01   +1.068217845294817e-03   +1.289418389447965e-01   +4.407497410342726e-01   +5.171750509678025e-02   -3.505735744453142e-01   -1.601820811314119e-01   -2.313181964875597e-01   -2.218105680077029e-01   -2.320688281988045e-01; +1.525241843226391e-01   +4.822326275605723e-01   +1.763826049236115e-01   +4.872340977413884e-01   +4.694796832705881e-01   +1.677008818661863e-01   +4.552692727793013e-01   -1.701468198559907e-01   -4.552624609034790e-01   -4.449488614197137e-01   +2.937908322468968e-01   +4.485781294256663e-02   +1.657172573397369e-01   -5.639076959987217e-01   +2.026014080115544e-01   -5.135234276266160e-01; +3.584125848639626e-02   -5.745641139138153e-01   -1.465582908124633e-01   +1.724350753652492e-01   +1.102057243735896e-03   -6.085287139720622e-02   +2.879678023716757e-01   +5.800547391713038e-01   -3.608883410380841e-01   -3.210438787819179e-01   -3.752207519346946e-02   +3.509946005288767e-01   +3.928617940286644e-01   +3.879021278841981e-01   +8.073916896672854e-01   +1.808942763349422e-01; +3.364547495121842e-01   -2.128006672623549e-01   +5.190253066912483e-02   -2.216605402786817e-01   +3.493070617654819e-01   +7.277326375408766e-01   +3.344627863282425e-01   +4.709073096766463e-02   +2.373361392235090e-01   +2.140721407697139e-01   +1.602435854115932e-01   -6.410368535168445e-02   +2.400191703800367e-01   -4.368762307848246e-01   +5.201855649082068e-02   -8.672869199396492e-02];
L2I_L2E_iAMPA_netcon = [-4.469276990439566e-01   +2.801052688648041e-01   +5.489210261682850e-01   +4.592911729926273e-02   -2.611331400547762e-02   +3.100005701985689e-01   +1.863135774295652e-01   +6.471269320804254e-01; +2.806098628328108e-01   +5.567037912612023e-02   +2.815181912778573e-01   +6.608793650771260e-01   -6.721345761136908e-02   +4.141326779183274e-01   +2.631024564466628e-01   +1.683002131263054e-01; -9.846849450189492e-02   -2.562757627563043e-02   +4.025037993726744e-01   +5.172457749191929e-01   -1.863192332580240e-01   +3.132324857620163e-01   +1.068922332218457e-02   +5.752664316011185e-01; +2.599564250616737e-01   +4.504120141490867e-01   +4.573209666850493e-01   +5.434192121181184e-01   -4.164449463517452e-01   -8.200728998767760e-02   +2.449679860596463e-02   +9.091148400825737e-02; -7.324275338239616e-02   -1.805411883655266e-01   +2.530321661804715e-01   +2.743105645380149e-01   -6.138099400569700e-01   -5.319626957155340e-01   +8.612666086126171e-02   +6.611953722084544e-01; +1.157340720723175e-01   +3.625860548947692e-01   -1.903839910557503e-01   -3.688848966839738e-01   +4.281555004180327e-01   +4.462820392371502e-01   -1.273266704433165e-01   -2.403782169377828e-01; +1.155437832707530e-01   +9.153391701880630e-02   -9.555521425158291e-02   +3.459060162782256e-01   +5.625244695046827e-02   -4.566278322453718e-01   +2.663148548477785e-01   -2.611044014376215e-01; +3.220931941221866e-01   +3.298662558625378e-01   +3.893027603409902e-01   +1.122744617080196e-01   -5.965525409960806e-01   +1.290504041649747e-01   +2.965975409158224e-01   -1.004890241264670e-01];
L2E_L2I_iGABA_netcon = [+1.809057014185059e-01   +2.926782865197597e-01   -1.696717518679681e-01   +5.361598657643274e-01   +1.020284442118730e-01   -1.737331735489192e-01   +5.055777649235219e-01   +8.282338328002996e-02; -4.676726187834912e-01   +6.358542187355041e-01   +1.274347917632894e-01   -1.553074107244939e-01   -7.075756056694639e-02   +2.901648521194861e-01   -2.476349042483989e-01   +5.658668441040281e-01; -4.080836154731787e-01   +5.189184635381840e-01   +5.040526429671575e-01   +4.018688191097360e-01   +3.420329909942905e-01   +2.461211078946527e-01   +3.740157543801888e-01   +5.878937577241897e-01; -1.994119226675418e-01   +8.718921546174116e-02   -1.367426329712246e-01   -2.661347568125286e-01   +2.437246913109455e-01   -2.839978219909895e-01   -2.600546709199924e-01   +6.453229256852437e-01; -1.421466731483046e-01   +3.115817422037618e-02   +3.741846826752215e-01   -1.887823547394826e-01   +1.272038044027860e-01   +1.247219759313970e-01   +2.062969353416469e-01   -5.309818193140770e-02; +4.132167200932538e-01   -4.965924174433214e-02   -8.283110211855640e-03   -2.773778499672530e-01   +3.680275074392624e-01   +1.229518382735894e-01   +5.398760710371419e-01   +5.091190820008292e-01; +3.587356432089253e-01   -2.420832845809885e-01   +4.430584785989824e-01   -1.146239395025336e-01   -1.989026978658311e-01   +2.331951900874653e-01   -1.105380481999830e-01   +6.394321038807863e-01; +2.241643244174702e-01   +3.520251629059736e-01   -1.163109621000254e-02   -1.488713715439414e-01   -2.018396908061042e-02   +4.716209901287627e-01   +5.605211446418188e-01   +9.375417556257794e-02];
L3E_L2E_iAMPA_netcon = [+3.549136752960485e-01   +6.420835568545835e-01   -3.139488886937900e-01   +3.613733619508179e-01   +2.917230584628127e-01   +4.113743588651762e-04   -3.993790302046240e-01   -1.508099607402814e-01   +4.593260338595929e-01   -6.172343289913276e-02   +5.519497470131717e-01   +6.180643177925313e-01; +1.476596262175202e-01   +4.811621463949138e-01   -3.578072591465192e-01   +4.430746872306471e-01   -1.317091499285635e-01   +3.347577645719216e-02   -3.602312490324483e-01   +2.473473411199591e-01   +1.747628504509073e-01   -1.747736587120380e-01   -1.656546541642921e-01   -7.531269410241733e-01; -5.487693680163772e-01   -2.109258098638055e-01   -2.234566072147338e-01   +1.954335295078311e-01   +6.490783425729615e-02   -3.465128876253756e-01   -4.626921902802666e-02   +2.112769087548851e-02   +3.838795809749428e-01   +3.204961752356247e-01   +2.511216746625610e-01   -3.262374747037842e-01; -8.906316946601339e-02   +4.828459178505652e-01   +6.295344401412753e-02   +1.938197213286580e-01   -3.025959250752796e-01   -1.685319011590082e-01   -4.611193298664628e-01   +4.102605561014527e-01   +4.046175388230270e-01   +3.277657990529463e-01   +4.771140651239678e-01   -7.960303981770869e-02; -1.574345996363343e-01   +3.572876552072770e-01   -4.457788182741411e-01   +4.996764195918802e-01   -4.509374640293917e-01   +2.581857574925195e-01   -2.747756495282282e-01   -1.281788950644414e-01   -3.563452807830743e-01   -4.095308658107470e-01   +2.446241583695166e-01   +4.403194048939909e-01; +1.797188676462184e-02   +5.670947309805393e-01   +6.752978481883580e-01   -9.756901869400071e-02   -5.508546823183438e-01   +2.161980668344352e-01   +3.619307557209893e-02   -2.965261954841175e-01   -2.791813365213931e-01   -5.281868618884353e-01   +6.660505176292026e-01   -5.875296887222772e-01; -5.281452441417566e-01   +1.340422845414189e-01   -2.661936682530599e-01   -5.322344178427706e-01   -5.910434222334595e-01   -1.909697061502064e-01   -2.319539238232342e-01   -1.074273240071911e-01   -4.297957566237199e-01   +1.303513971559918e-01   -2.419523955197835e-01   -3.213275908558583e-01; +8.033817207316260e-04   +1.883007351614001e-01   -8.268235705532902e-02   -5.967695556809856e-01   +1.476041869640482e-01   +3.172917680049589e-01   +2.205269848410006e-01   -4.104252881337177e-02   -9.089140392887871e-03   -2.318261174199263e-01   -4.958088714520937e-01   -3.416806666848167e-01];
L3I_L2I_iGABA_netcon = [-3.110405946362886e-01   +1.373037655261642e-01   +2.480363165585459e-01   +4.252447861565996e-01   -5.473688456068367e-01   +1.245450972747779e-02   +4.563564622109827e-01   -9.599223307981752e-02   -1.269928919217066e-02   +4.849780029974406e-01   +3.237799032214685e-01   -3.099667387299134e-01; -5.701005036741781e-01   +2.516085005676426e-02   -6.140905727771218e-01   -3.945464259080501e-01   -7.522779142440673e-02   -3.426517339686783e-01   +2.337036485097727e-01   +2.210530274146246e-01   -5.821003530741137e-01   -3.530127740818464e-01   -2.708319890222850e-02   +3.455938576493576e-01; -2.982576963118328e-01   +2.278070508264614e-01   +2.686085550459875e-01   +3.257793828519049e-01   +6.156783480198227e-03   -3.105734739702261e-01   +6.274254503685447e-02   -4.030953428742340e-01   +5.925266686257890e-01   -2.162935294351253e-01   +1.033566826805313e-01   +1.131417154577359e-01; +2.369618486240733e-01   +3.182250380243133e-01   -1.867036891558831e-01   -4.105653500883622e-01   +2.055998897140782e-01   -2.519680638844707e-01   +2.387568565045995e-01   -3.428044661636700e-02   -5.775383834866171e-01   -7.749006878408263e-02   -4.224117925141561e-01   +7.983311899195848e-02; -3.961819304236994e-01   +9.396005118807310e-02   +1.151626109180288e-01   +2.545657656555788e-01   +1.686713531540852e-01   +2.248124120536891e-01   -5.560733000483562e-01   +4.642044393778612e-01   +3.004584797935004e-02   +4.812112907476698e-01   -2.961956725181660e-01   +1.140405083513137e-02; -2.975136347035048e-01   +5.215729553876805e-02   +5.817764003685916e-04   +3.809105844747303e-01   +4.962688450104584e-01   +5.751160774033345e-01   -7.578093791263603e-01   -2.363183222880507e-01   -4.254274867991353e-01   +2.088454985415603e-01   -3.996393827061972e-01   +4.300675226054712e-02; +3.732839529450430e-01   +2.045564473244925e-01   +1.229823076649612e-01   +2.125036985802916e-01   -4.187137729156435e-02   -3.594357849024560e-01   -2.286302544037602e-01   +2.016140266295741e-01   -3.690660760035981e-01   -4.787460201781600e-01   +2.427873347792439e-02   +2.509793272762248e-01; -2.048238077056315e-01   -5.947593647431725e-01   -6.024825077634681e-03   +5.631630821018072e-01   -1.960062845829474e-01   +1.123464635210610e-01   +4.255105393789226e-01   +4.722825123994694e-01   +4.231024504047979e-01   +2.398777963647697e-01   +1.154244289226749e-01   -3.951027777540372e-01];
L2E_L3E_iAMPA_netcon = [+6.810131309843695e-02   -2.530943812191215e-01   +5.032787363590319e-01   +1.338999042736218e-01   -2.445317491266162e-01   +3.284661010490776e-01   +1.724843840679472e-01   -1.261688339326144e-01; -1.270593128896960e-01   +1.991685972694651e-01   -5.025985438233024e-01   -1.807353139684394e-01   +1.625615628957141e-01   -1.685803161793236e-01   +9.317720689813738e-02   -1.373053180020586e-01; -4.685496733064453e-01   -4.436204669147916e-01   -3.592916971084238e-01   +6.322086595973526e-01   +4.673284736293340e-01   +2.301901100704238e-01   -4.852302936268292e-02   +2.301211036444018e-01; +7.917298919361507e-01   +7.002311003316469e-02   -2.117047926526827e-01   +5.254781187985011e-01   +2.184571310401316e-01   -3.108827574598706e-01   -4.624451026931505e-01   -6.837987023044262e-02; +3.814369731114685e-02   +2.252367829583971e-01   +1.765983983724925e-01   -9.611622112246590e-02   -3.760244594521620e-02   +3.052964236777210e-01   -5.284028782784439e-01   +3.695924182142669e-02; +5.437138043562094e-01   -1.176572713209803e-02   +4.191774211588680e-01   +9.163646641751148e-02   -1.904778222799788e-01   -2.885478730295186e-01   -5.715112484283598e-01   -5.674194903981727e-01; +5.407692179063356e-01   -6.566021079377599e-01   -2.110834106931708e-02   +3.397573413219839e-01   +9.984599483011285e-02   -3.612265331115779e-01   -2.101061496918688e-01   +3.541252314522159e-01; +2.104136820557098e-01   +5.981018621595134e-01   -5.295634442130308e-02   -1.196822261242844e-01   +4.087201605018528e-01   -5.921051676058073e-01   +5.767094343458518e-01   -2.600255341047292e-01; +2.834353368405169e-01   +5.759981209595408e-01   +8.345617374999967e-01   +4.013810611067665e-02   -1.609536529016636e-01   +1.259728343491633e-01   -2.939255044685875e-01   -1.999055837786718e-01; -3.661858880079925e-01   +1.831804364061206e-01   -1.110936869942080e-01   -4.263770908102483e-01   +4.544253612751020e-01   +1.247647534066716e-01   -1.894669945231522e-01   -3.140406615131872e-01; +2.747976561465665e-01   +9.408749510749694e-02   -4.877344572153001e-01   +1.948429229246799e-01   +1.044022899371890e-02   +1.828920497110219e-01   -6.206718402370228e-01   -4.830652791702010e-01; +3.564827924590577e-01   -1.281787699227835e-03   +1.370464632503980e-01   +1.510255142453963e-01   +4.378629790472686e-01   +4.771579492966269e-01   -4.879145677277171e-01   +1.141060953770090e-01];
L2I_L3I_iGABA_netcon = [+2.405433732232198e-01   +3.842771467125959e-01   -8.952632403022961e-02   +1.047470917778680e-01   +6.320958868318425e-01   -7.460070442036282e-02   +4.748348216586314e-01   +6.490705275805690e-01; +1.950654215952708e-01   +1.476490686558890e-01   +1.952224102563501e-01   +4.686242621256474e-02   -1.350859196940814e-01   -3.048263569073122e-01   +5.493427985450743e-01   +2.533897763420257e-01; -3.333332322019550e-01   +4.387251488348322e-02   +1.490530770629215e-01   +3.665471085238020e-01   +1.075387499960672e-01   +3.001909553547589e-01   -8.838237379360788e-03   -4.177222568060881e-01; +6.291473332793977e-02   +5.374237924834566e-01   +3.458596410065800e-01   -1.763844818124808e-01   +7.891500455685688e-02   +5.590803910884763e-02   -5.025848924717514e-02   +3.188067154494556e-01; -8.357270583316087e-02   +2.555618149469932e-01   -7.369618794236947e-02   +1.459048845962000e-01   +3.919473676521399e-02   +1.990049855289997e-01   -1.881128477218482e-01   +7.836481380975118e-01; +2.179826534618533e-01   +2.177904603852956e-01   -4.515863173469075e-01   +3.786395508400585e-02   -3.614811089564637e-01   +2.608650507531096e-01   +3.715307666021559e-01   -1.597476681604902e-01; +2.196063190919066e-01   -2.720551313315613e-01   -2.432863100928806e-01   +6.872642495643508e-01   -3.016636658776276e-01   -1.306767430836699e-01   -4.119127289663956e-01   +4.501833701315001e-01; +6.594499127829819e-01   +1.878726895418169e-01   -2.369289800318852e-01   -4.838263639708270e-01   +1.029467768675021e-01   +2.979148993636292e-01   +2.582595398477171e-02   -8.498516608318284e-02; +1.330254972720765e-01   +5.336050334230726e-01   +1.476890758434188e-01   -3.693001386094075e-01   +9.625556514468778e-02   +5.534463099841348e-01   -1.605719740818435e-01   +3.613330659906011e-01; +6.133052291000313e-02   -1.517865491593262e-01   +2.592429989149815e-01   -9.996114032855857e-03   +3.443793066726132e-01   +4.079066825219926e-01   +1.290025436957779e-01   +6.915067299701534e-01; +1.352142840776813e-01   -5.227113274757374e-02   +4.874053187686670e-01   +2.068247671937000e-01   +1.295524055022697e-01   +4.602087199051074e-01   +1.672518246533980e-01   +6.641020878220054e-01; -4.150277942280166e-01   -6.588182850562789e-02   +6.365232300228411e-01   +3.977942334079113e-01   -2.669525234290059e-01   -2.329037452847325e-01   -4.310492284249098e-01   +3.390299708049536e-02];
L3I_L3E_iAMPA_netcon = [+3.104130933941717e-01   +6.061231206375246e-01   -1.098787944617615e-02   -6.935738909173419e-03   -2.988887558724736e-01   +5.122630977582736e-01   +6.221221858124827e-02   +4.862368722386677e-01   -6.079415892665477e-02   +8.341455671917472e-02   +5.859358308933187e-01   +8.294626425217614e-01; -2.652425231491115e-01   +5.121713318721535e-02   -5.026860088682389e-03   +1.619215296649577e-02   +3.501335374200908e-01   -2.119861114618961e-01   -3.412816103644045e-01   -8.000059208882796e-01   +2.153695182297663e-01   -1.332156771510803e-01   -2.104380587572854e-01   -5.593973413205678e-01; -2.837879246741007e-01   +3.270964130301462e-01   -3.090067112290393e-01   +2.674584286411701e-01   -2.412688771448612e-01   -5.980473746590901e-02   +5.248934948194218e-01   +2.270271018252489e-02   -1.371643341935364e-01   -5.307914198759022e-01   +4.388974189385002e-02   +7.632557279961019e-01; +4.318514288489617e-03   +4.587176395939372e-01   -2.082378922062130e-01   +6.028460967444307e-01   -6.792812005259315e-02   +3.961669287836365e-01   +3.069244969971812e-02   +5.723580184907948e-01   +2.443346767898812e-01   +5.548572085876566e-01   -5.132850543439311e-01   -3.442819028141344e-01; -4.864334788633898e-01   +1.320880462691910e-01   +5.389544829730966e-01   -1.030849713009429e-02   -1.175667959205641e-01   +2.967365029196297e-01   -1.350803442597131e-01   -5.871659739733711e-01   +2.672755567653938e-01   +8.167910919087485e-01   +8.992327203870726e-01   -1.942391869661289e-01; +3.705678143644340e-01   +6.086977944009967e-01   +5.438196536733664e-01   +1.556598031199060e-01   -3.575812107156240e-03   -2.472531663085591e-02   +4.466322498262880e-01   +1.845540502153726e-01   -1.985201585271839e-01   -6.117823073646548e-01   +4.451904702831280e-01   +4.020544534698244e-02; +6.246320184304062e-01   +1.247853829857011e-01   -3.048450883477551e-01   -1.499672692583109e-04   +1.354960430502602e-01   +1.248480722431935e-01   +2.439708334582648e-01   -1.732013082918439e-02   -5.978611546566955e-01   +6.468349630938415e-01   -3.902525801532933e-01   +2.992226853510180e-02; -5.458057034714739e-01   +2.676665982187634e-02   +4.404137536602166e-01   -2.847453140463503e-01   -2.966358005726085e-02   +5.781011331047488e-01   +2.924282095795874e-01   -2.569068691795137e-01   +1.471649339664693e-01   +4.640674381882558e-01   +4.186962702041756e-01   -8.892452212492116e-02; -2.243065021787189e-01   +1.708370290034913e-01   +5.101759885710082e-01   -1.595842500819272e-01   +7.408785077830783e-02   -1.154439147413046e-02   +6.544802320126072e-02   +2.975110275717833e-01   +6.793194180028106e-02   +6.374260523443415e-01   +1.798639204488293e-01   -3.809819975045383e-01; +6.288021583515006e-02   +1.661278266241661e-01   -1.880751385843660e-01   +8.011154621179388e-01   +1.368775555156795e-01   -7.066024370385514e-01   +8.036114497896263e-02   +8.880038047194551e-02   -4.888619567467496e-01   +3.988573055992162e-01   -3.116269057333739e-01   -1.632808428303835e-01; -3.363554443641241e-01   -4.146403784240372e-01   +5.073174584367588e-01   +5.562892497393936e-01   +1.376050733815505e-01   -5.717564563916255e-01   +5.366020570798979e-01   +1.343446450163489e-02   +5.668689643006002e-01   +3.919412264088021e-01   -2.665813848717354e-01   +2.259881005960094e-01; +4.103316380527721e-01   +2.581973814756123e-02   +2.963156790314646e-01   -6.449378659341801e-02   +7.768098565825273e-01   +6.794199183329182e-02   -1.792714114481158e-01   +3.821814409071220e-01   -9.339931943134172e-02   -3.293044648011977e-01   -4.435931844121834e-01   -3.955426893094975e-01];
L3E_L3I_iGABA_netcon = [-1.265145458016802e-02   +3.355362535197505e-01   -4.371441081494297e-01   +2.477724505341858e-01   +4.720217537527597e-01   -2.620401400884100e-01   +1.861381387855052e-01   +3.138054445780168e-02   -2.534117867660728e-01   +3.959280028570231e-01   +1.536562592657231e-02   +4.501487943479756e-01; -5.258691758410865e-04   -9.073695950715621e-02   -1.618249329774548e-01   +2.968362370559624e-01   -1.655020527558542e-02   +5.313392686035913e-01   +8.408635554006971e-02   -6.486956439962834e-01   -5.478039856458237e-01   -5.971329997533987e-01   -1.854729423846131e-01   +1.698401428392505e-01; -1.577463796540754e-01   -1.163078048729608e-01   +2.364898598167807e-01   +2.695139428344651e-01   +5.500018644432900e-02   -8.244638785450251e-02   -2.662339151602536e-01   +4.671362832987581e-01   -8.223372085726929e-02   +4.305006723514122e-02   -2.210799913614813e-01   -8.282900780722503e-03; -9.484427367967910e-03   -1.004068113843713e-01   +8.551248043567937e-02   +1.789505676364070e-01   -1.569578715420214e-01   +1.766199236143540e-01   -3.202325276860396e-01   +2.642136705690182e-01   +5.842827053402261e-01   +2.330921560027643e-01   -1.116956758588535e-01   -3.236098473426355e-02; -1.744275709587107e-01   +2.961106875461867e-02   -1.316284258652365e-01   +8.327817442446070e-01   -5.999220141862474e-01   -1.939900514956438e-01   -4.091887868742390e-01   +7.822736123387099e-02   -1.285209588101377e-01   +3.821307647385007e-02   +1.911744238843829e-01   -6.594097292797878e-01; -3.917597814349291e-01   +8.289493081978223e-02   +4.095511480829058e-01   -5.654025760921602e-01   +7.161499563381839e-02   +5.873500544488623e-01   -7.204103024514682e-01   +3.443406994823955e-01   -5.739028408570063e-01   -3.423012121482106e-01   +5.169041266053259e-01   +5.912463647160556e-01; +3.834615207427335e-02   -1.434864759524067e-01   +5.134692931732827e-01   -8.034721387816736e-02   +2.463062925904705e-01   +6.018629493174860e-01   +3.651897515807432e-01   -2.154143982075461e-01   -3.263569103877326e-01   +1.523915982559371e-01   -3.786002343047828e-02   -3.701138358997780e-01; -1.720405531046715e-01   +1.447106237619858e-01   +4.037801403392795e-01   +7.156779154781762e-01   +3.483838518819932e-01   +3.945865949943450e-01   +1.678885962425020e-01   +6.054421579444323e-02   +2.572346106431541e-01   -8.411353001027100e-02   +1.838317370797077e-01   +3.459525242864622e-01; -1.599722446973543e-01   +1.821854984783017e-01   +5.936748376412856e-03   +1.745385966151386e-01   -5.505310126190956e-01   -7.681577939471618e-02   +5.246985093596691e-01   +3.729367075419819e-02   -4.985303887416179e-01   -7.376177727910987e-02   +2.672587123730613e-01   +2.860962906833558e-01; -8.310726560963551e-03   +2.015526429840223e-01   +3.326263569189514e-01   +2.989286110786097e-01   +4.885445755814840e-01   -5.452973076202426e-03   +1.465780273945470e-01   +1.783311735972249e-01   -2.991632976827040e-01   +2.109404772327703e-01   +5.910488245427542e-01   +3.172563791106977e-01; -7.316479788003995e-02   -6.188384999081187e-02   +2.234988670407107e-01   +6.318520600889296e-01   -2.398258436452375e-01   +2.703097328696609e-01   +1.106366559084410e-01   +9.934902527815380e-02   -1.151820346338619e-01   -2.051724452158661e-01   -2.823964244220951e-01   +1.353684363113537e-01; -1.143967057434321e-01   -3.200252505469441e-01   -1.528486749648253e-01   +3.332853877572677e-01   +1.170965300468749e-01   +2.102634327733816e-01   -2.393307572753761e-01   -2.605539749838943e-01   -6.505859691562257e-02   +1.248527637432360e-01   +5.257170680079720e-01   +1.554887636588742e-02];
L2E_Input1_iAMPA_netcon = [-2.104116640835721e-01   +7.354218180207858e-01   +3.050596850969623e-01   -3.482723923773111e-01   +2.586624950148191e-02   +5.471659462747995e-01   +3.200552205660755e-01   -1.236886593059586e-01];
L2I_Input2_iAMPA_netcon = [-8.728635650031272e-02   +1.138677871850624e-02   +4.360419785314955e-02   -6.152119450539013e-02   +3.185320655511592e-01   -7.601723620617445e-02   -1.148856590137139e-02   -1.547364308757954e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.4*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 1.0*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 1.0*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.4*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 1.0*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 1.0*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 100*(sin(2*t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 100*(sin(2*t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
