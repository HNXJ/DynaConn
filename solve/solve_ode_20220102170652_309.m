function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+4.661492413465397e-04   +1.403912073661505e-02   +1.871017507927962e-02   +1.817977694212626e-02   +1.130875570489407e-02   +2.236879346628369e-02   +2.132946110426197e-03   +5.403787838738718e-04   +2.121875136268752e-03   +7.591370805196583e-03   +1.016446605556061e-02   +2.855155958129662e-03   +1.226124368668730e-02   +2.260566291880425e-02   +1.431064011693247e-02   -3.281709023918384e-03; +1.202238532215228e-02   -5.755527912932747e-03   +1.609923379823023e-02   +1.942107088391528e-02   +6.739108908409508e-03   +6.214435404573811e-04   +2.379567163550884e-02   +1.940357833103836e-02   +1.613170641768973e-02   +1.146935727453966e-02   +1.930751903835224e-02   +9.370206344703678e-03   -5.759635584580320e-04   -5.254744928744910e-03   +9.251222335954679e-03   +3.967603233143928e-03; +9.013378277755741e-03   +1.634839898005893e-02   +1.566294283004414e-02   +6.291828477017010e-03   -3.229154376273097e-03   +1.992421586287756e-02   +2.277939332769965e-02   +1.331810236040391e-02   +4.140427697452926e-03   +2.902818501540555e-03   +1.228388058908104e-02   +7.849441428027187e-03   +4.826036481911514e-03   +1.105245312480311e-02   +2.202153465407122e-02   +1.295218592523948e-02; -9.703519191221381e-04   -2.177940912210118e-03   +6.494155566958726e-03   +1.331689009609122e-02   +1.182592460957711e-03   +1.480090929342521e-02   +1.554059024434335e-02   +1.914933634703584e-02   +1.465068788494251e-02   +1.533559832370434e-04   +2.039895006219348e-02   +1.380238220419347e-02   +8.745086762843279e-03   +2.217667017469385e-02   +1.108914889444628e-02   +1.878673250217079e-03; +1.254281975008919e-02   +1.263687781454418e-02   +1.345490774117091e-02   +1.167836299111585e-02   +1.517942296635611e-02   +2.145726009385211e-02   +2.861384154539246e-03   +6.071130529552266e-03   +1.394413427928566e-02   +2.848553020893118e-02   +1.200637563296213e-02   +1.107947084857948e-02   +3.403795049574849e-03   +8.510712884968224e-03   +2.910112414069839e-02   -1.380326000593135e-03; +9.592149717848650e-03   -1.183011570866437e-03   +1.537030924819885e-02   +6.821057761471825e-03   +1.091539307346420e-02   +1.133768877898775e-02   +1.326289150918818e-02   +2.713334237029530e-03   +7.923337219126220e-03   +1.542067006743812e-02   +1.797290122991176e-02   +8.214532731464587e-03   +1.306466043891892e-02   +4.744084665899324e-03   +1.146105495812307e-02   +1.652763040982194e-02; +3.452919198852102e-03   +1.242487411216886e-02   +2.124832544277521e-02   +1.988108129046213e-02   +1.632598942583453e-02   +1.169006053381924e-02   +7.451112050991995e-03   +2.439913124667286e-02   +2.703017608881437e-02   +3.605795212608507e-04   -3.368156182969215e-03   +5.594554452861525e-03   +2.374982060476375e-03   +2.062624611681958e-02   -2.687801620793918e-03   -2.341892460728315e-03; +1.773510487294664e-02   +2.974770141031468e-03   +1.910880221664340e-02   +1.782551650369106e-02   +1.164737909704138e-02   -2.057524048618830e-03   +4.773226402524224e-03   +9.762583084246660e-03   +1.857851631038228e-02   +1.969045235014503e-02   +4.688276786322419e-03   +1.217557231478397e-02   +1.024312718114984e-02   +5.302404828928638e-03   +1.643104638314701e-02   +1.608245434728646e-02; +1.636560008232901e-03   +1.458013474272698e-02   +1.648092397616829e-02   +1.346903558870528e-02   +3.291064356652888e-03   +1.877284977459066e-02   +6.707394411179795e-03   +1.052419396590171e-02   +4.747701260026391e-03   +1.174288385413227e-02   +3.650285393533291e-03   +1.822693278772840e-02   +2.823807298532988e-03   +1.810047538868624e-02   +7.766015209616597e-04   +5.190330141739960e-03; +6.705542851031730e-03   +2.885738427393232e-03   +2.406930758225964e-02   +9.063649441965712e-03   +1.321581243453503e-02   +4.171753313126136e-03   +5.993100316965696e-03   -2.686776520114155e-03   +8.213101014390895e-03   +4.644337760918847e-03   +4.437278977987570e-03   +1.452130465277397e-02   +1.984977146922251e-02   +1.602821458235612e-02   +2.153372953969736e-02   +1.542063446083848e-02; +7.989123464610668e-03   +4.388830908689868e-03   +1.842532704492496e-02   +2.044729072453307e-02   +1.505387459557000e-02   +9.982646009863498e-03   +1.507581188811613e-02   +1.782864375880839e-02   +5.711300921404628e-03   +4.927306844943791e-03   +2.044624652278514e-02   +1.538876965991821e-02   +6.081019151674612e-03   +7.698854932972756e-03   +1.350487467579176e-02   +1.024998722210666e-02; +1.367295356140951e-02   +5.244438000368772e-03   -1.071810818546464e-03   +3.750656485648188e-03   +1.807693162497539e-02   +2.624571634337795e-02   +4.514753788455294e-03   +1.381874873792375e-02   +1.052791721140547e-02   +6.210793153948867e-03   -2.396821520001864e-03   -3.408978855743485e-03   +2.427091192724752e-02   +1.415194150965180e-03   +1.268799147458899e-02   +1.005883744139923e-02; +1.589001515606481e-02   +1.758975252143944e-02   +1.190689955167099e-02   +8.468422476822012e-03   +2.044968320545536e-02   +1.414081682916112e-02   +1.353046911537577e-02   +2.063878360396311e-02   +1.815866539677856e-02   +6.849382710101252e-03   +7.049576622685460e-04   +2.047485070871087e-02   +1.031330643624156e-02   +1.386443435361273e-02   +1.312781648119896e-02   +2.157435345088577e-02; +1.583238731879334e-02   +1.747881758679974e-02   +4.300185825876367e-03   +1.405285885720600e-02   -1.318445083315675e-03   +8.320467728861441e-03   +2.462483775959672e-03   +5.057201338847534e-03   +4.765963463984989e-03   +1.568467924678692e-02   +6.199173928493479e-03   +2.691053447029529e-02   +1.561306292056316e-02   +1.124555286933847e-02   +5.556284032740126e-03   +8.077282144707959e-03; +1.319692308455274e-03   +1.848630552901247e-02   +1.948298944678521e-02   +9.710116831188664e-03   +1.717720123120962e-02   +8.168668076227802e-03   +6.202567559556959e-03   +1.233209827701931e-02   +2.388215577417695e-03   +2.192495841557134e-02   +1.729158956451090e-02   -3.352187897037291e-04   -4.763975407766439e-04   +2.232758494250615e-02   -2.185686822831278e-03   +1.090969784441914e-02; +2.065740585900433e-02   +6.105978398248140e-03   +1.318095238632511e-03   +2.703621456146019e-02   -1.845650574702006e-03   +4.239884869246098e-03   +1.578901124241976e-02   -1.288527909684834e-03   +6.040401069317795e-03   +2.097500082084533e-02   +1.425114738629590e-02   +3.588301703382278e-03   +1.683833520183198e-02   +2.104112198028030e-02   +2.374228043391968e-02   +2.346880451621974e-02];
L1E_L1I_iGABA_netcon = [+1.076938322773661e-02   +1.742780679989361e-02   -2.306474105528106e-04   +1.180056557359474e-02   +1.816089303518267e-02   +1.355781968430238e-02   +1.417187559260394e-02   +1.462642420479781e-03   -2.116230547760386e-03   +3.787915741506061e-03   +7.580973314040552e-03   +9.997941702159664e-03   +7.071168218748432e-03   +2.198961658889160e-02   -2.935323353872463e-03   +1.044057132009568e-02; +2.343268010978524e-03   +1.700809022621785e-02   +1.265036242734478e-02   +1.650973271687336e-02   +1.391520273162636e-02   +1.320164556308432e-02   -1.094239674757647e-03   +1.730834454547028e-02   +1.709068308426858e-02   -3.016464177883462e-03   +2.485552713584398e-03   +1.908017773521473e-02   +2.556460027318434e-03   +8.798096879046841e-03   +7.909412810957982e-03   +1.913052351994299e-02; +7.535887881944382e-03   +2.565606592444375e-02   +2.464451860268000e-02   +1.331535819602522e-02   -2.135539143849930e-03   +1.590394320417583e-02   +1.666502489740106e-02   +1.862832894422359e-02   +2.383581585422047e-02   +1.902273748419008e-02   +1.515036263456273e-02   +1.257717112359665e-02   +2.281497647505552e-02   +2.059512677135617e-02   +5.729672779005062e-03   +1.226266022041112e-02; -2.470949942360732e-03   +1.073542891553427e-02   +2.129895133128719e-02   +9.514711216800861e-03   -2.906323176389696e-03   +9.538514570502598e-03   +1.896269291430520e-02   +1.519121286637721e-02   +9.629358258142401e-03   +1.887056928920752e-02   +1.496061027524715e-02   +4.182773721505243e-03   +1.002853377992072e-02   +1.047986179233723e-02   +7.870198438268765e-03   +2.056895519217466e-02; +2.609521548218899e-03   +2.323881387838441e-02   +7.015222323213824e-03   +4.139917535631258e-03   +1.247763658150889e-02   +2.132672595125212e-02   +1.384805996141810e-02   +9.582461566291724e-03   -9.460067265482696e-04   +4.752645388979021e-03   +1.534037026871325e-02   +6.560072531768981e-03   +1.252522676102844e-02   +9.672919151519487e-03   +1.299451838864865e-02   +5.905462742972495e-03; +2.015582586303558e-02   +1.394556775591935e-02   +6.272398082357017e-04   +1.612356185404812e-02   +5.893953816431249e-03   +3.177600952574658e-04   +1.898284301626859e-02   +7.553340265702596e-03   +2.293643423869141e-02   +3.880615297634615e-03   +1.598461367737766e-02   +5.367758369125982e-03   +7.963866936783054e-03   -9.630031315814099e-04   +1.718448893859459e-02   +1.346642301244943e-03; +1.317981887335102e-02   +8.123051498742625e-03   -9.857515712388314e-04   +8.840772947945472e-03   +3.602236868854688e-03   +1.308419450542601e-02   +1.057200824962192e-02   +6.739435470279826e-03   +1.957205210808666e-02   +4.868861772783031e-03   +2.216300296672182e-02   +2.060059759182655e-02   +2.658650765930115e-02   +1.222711715970087e-02   +5.966414208309272e-03   +7.856926589590696e-03; +3.977883360216918e-03   +3.480089620109829e-04   +1.014045803720998e-03   +1.743950283001122e-03   +1.537720932562012e-02   +7.648474486885524e-03   +1.413382117624240e-02   +1.500551833037288e-02   +4.312219279504370e-03   +1.249990605054660e-02   +1.347862801671626e-02   +2.901264903481320e-02   +9.876330676505210e-03   +1.518591029333379e-02   +3.998179800755841e-03   +1.570135410416891e-02; +8.286015742170454e-03   +8.052846517422172e-03   +5.748646235123742e-03   -5.074580333714185e-03   +7.687863162448759e-03   +1.693829387849399e-02   +2.309734219447377e-02   +2.556756934235976e-02   +9.220505200872500e-03   +8.309769607513886e-03   +1.771200180443057e-02   +6.431082154318967e-03   +2.465795233610615e-02   +2.316265753093532e-02   +6.530243192325161e-03   +7.605013263609646e-03; -6.027486501613373e-04   +6.802913019078036e-03   -2.598586493731242e-03   +1.950403393801756e-02   +3.609982602157051e-03   +1.525207388746665e-02   +8.038456627499833e-03   +4.506505657744102e-03   +2.388565214769644e-02   +1.422787036176679e-02   +3.976158414919759e-03   +2.033352060829926e-02   +2.555372830702542e-02   +1.448493089779129e-02   +1.467743718124043e-02   +6.882197440923434e-03; +1.969182432375604e-02   +1.165718544923365e-03   +1.058183492271401e-02   +8.969890406494241e-03   +1.506276158336875e-02   +8.030555578774950e-03   +1.513520890159050e-02   +2.019469851430223e-02   +7.177319390803223e-03   +1.212456087873065e-02   +1.821465547191544e-02   +1.744073378534202e-02   +7.413013784438942e-03   +2.456082236778041e-02   +1.894695001977994e-02   +9.452570886408286e-03; +1.351706792587849e-02   +1.743716150343702e-02   +9.232089485483246e-03   +2.150821224445667e-02   +2.276986686944735e-02   +1.114697968008073e-02   +8.814528622293887e-03   -5.524622038111732e-04   +1.654284782689017e-02   +9.068895590477841e-03   +1.438367931042301e-03   +2.040621176418697e-02   +1.390232341462114e-02   +2.132215547587467e-02   +1.376681613978836e-02   +9.283081254013366e-03; +2.286229919105916e-02   -1.311920431791133e-04   +1.350434895691665e-02   -2.141019317021446e-03   +6.121545905320057e-03   +1.764817148302155e-02   +7.345031460397442e-03   +5.137413203442737e-03   +1.743410428021413e-02   +1.953773208769851e-02   +8.558688888455634e-03   +1.710999212806515e-02   +2.235993064982733e-02   +1.312551304725642e-02   +4.895271484598205e-03   +3.855436559122963e-03; +4.253806523771778e-03   +1.575928332567365e-03   +8.316179048938219e-04   -4.530129235140705e-03   +2.829424283725759e-03   +1.582084553645675e-02   +2.531384819467995e-02   +1.655244796830494e-02   +3.346649922532832e-03   +1.014468006039300e-02   +1.152111345181457e-02   +1.282886504591607e-02   +1.079804207135097e-02   +2.245048287582752e-02   +1.815110839907818e-02   +1.908939082497883e-02; +1.725941342501380e-02   +3.378554487644442e-03   +7.477478197933605e-03   +1.840413037156255e-02   +1.161677925612935e-02   +7.570783562402443e-03   +5.307595848195413e-03   +6.695139674704587e-03   +6.725937020628675e-03   +1.373033407653658e-02   +4.460217336946524e-03   +9.468192569051296e-03   +7.965521173354105e-03   +2.648016777609468e-03   +5.033217349756294e-03   +7.213051747884074e-03; +1.503767278961024e-02   +3.644745664147902e-03   +1.226377169049237e-02   +2.098679108381937e-02   +2.361334635332848e-02   +8.950064658866021e-03   +7.415821022325011e-03   +2.362886326424231e-02   +1.612244407351144e-02   +3.626260607521167e-04   +5.359213493110716e-04   +7.303073767671243e-03   +1.731663853301108e-02   +1.996357540334034e-02   +8.489769178594021e-03   +1.473532454426045e-02];
L2I_L1I_iGABA_netcon = [+2.365651161000169e-02   +7.347245509155037e-03   +4.497487545671514e-03   +2.342912072337180e-02   +2.212975377961960e-02   +1.509094268094662e-02   +6.971576333001578e-03   +2.507758767328262e-02; +1.481816126263831e-02   +1.665769137355956e-02   +1.249827410878191e-02   +1.072105337106367e-02   +1.027504017664635e-02   +1.446792053063273e-02   +1.901177989288100e-02   +6.404233290203769e-04; +1.118452591917594e-03   +9.654431045752946e-03   +4.693774336499677e-04   +1.041968865574158e-02   +2.409803166712311e-02   +2.520184453649401e-02   +8.655514583295025e-03   +1.544448628990304e-02; +5.399634229842107e-04   +1.912658777767791e-02   +1.582921846955959e-02   +1.364474469132511e-02   +1.812887465230711e-02   +1.319482524724096e-02   +1.028675472077450e-02   +2.122851816713013e-02; +1.151245528531991e-02   +3.992613365800228e-03   +2.005109076799772e-02   +1.037100142914586e-02   +1.259602314551357e-02   +2.232190612391481e-02   +1.204240797048967e-02   +2.128968933190777e-02; +1.640499845098866e-02   +1.283853933457306e-02   +1.655413777715053e-02   +1.581266412061236e-02   +1.185409079455423e-02   +1.567150080820426e-02   -2.724186998396103e-03   +1.222139139988025e-02; -8.966439032251328e-04   +1.127257106344745e-02   +1.118046677801596e-02   +1.098729806832975e-02   +1.805224603509360e-02   +3.496713816155442e-03   +9.862629233173910e-03   +2.214925289574310e-02; +1.352438282705731e-02   +5.479547196324612e-03   +1.911374927966632e-02   +6.880609947050461e-03   +6.017982399763771e-03   +2.102676526163707e-02   +1.792839855645243e-02   +5.738368821234874e-04; +1.246440713281556e-02   +1.219679941312924e-02   +1.039024011785792e-02   +1.031851525019786e-02   +7.142734739125340e-03   +5.157026508517098e-03   +8.074581046747260e-03   +1.974293535891367e-02; +7.833571840533925e-03   +8.513850307140292e-03   -8.769480437883524e-03   +8.923488163797186e-03   +3.153920212999080e-03   +1.082504240525008e-02   +2.403001486034683e-02   +8.366241963073999e-03; +6.489228046743357e-03   +2.173504965516647e-02   +2.008817868986542e-02   +3.997520696194817e-03   +1.842799966418680e-02   +2.057122093666732e-02   +7.728178791407232e-05   +1.127913100872267e-02; +1.409100858854951e-02   +1.027926947510553e-02   +1.244280914161320e-02   +6.162857396115056e-03   +2.345213965217173e-02   +5.592685991421871e-03   +1.453944084031308e-02   +3.964075857459223e-03; +5.018020540201252e-04   +2.161360756949688e-02   +1.691853424737568e-02   -2.006078651774153e-03   +1.169317750394198e-02   +5.316032580391767e-03   +1.187516061344039e-02   +1.795120740486661e-02; +2.391998658433758e-02   +4.149326322850172e-03   +2.049727894491803e-02   +1.018632203302709e-02   +1.873795364046428e-02   +7.166809469767855e-03   +2.160138321656372e-02   +7.034003258061006e-03; +1.994244210108160e-02   +8.209028479674720e-03   +4.980904080810304e-03   +2.598180091438586e-02   +1.871922201844922e-02   +2.584732568674699e-03   +1.123928851515926e-02   +1.446640302395646e-02; +1.503795486482246e-03   +1.723629602499899e-02   +1.579345894596211e-02   +1.482030273381726e-02   +2.315258692181913e-02   -4.775991465730941e-03   +2.306521389219483e-02   +1.060863022559492e-02];
L1I_L2I_iGABA_netcon = [+1.782568753737196e-02   +1.798125355185515e-02   +6.064742267670549e-04   +4.418779192716099e-03   +1.111214971833429e-02   +1.062950890701088e-02   +2.209454861073362e-02   +1.555189576653622e-02   +1.240371955348460e-02   +2.603252089626026e-02   -2.603841769919931e-04   +5.039992398840247e-03   +6.064223659596408e-03   +5.572491330682557e-04   +6.779823122419476e-03   +2.500482479681066e-02; +2.302098218019546e-02   +1.518700385673023e-02   +6.630774175003941e-03   +1.061239409111832e-02   +1.410917591966273e-02   +1.666420531012999e-02   +1.293444235099190e-02   +2.097767065631972e-02   +1.205959023483895e-02   +2.680653935342463e-02   +1.303230993646495e-02   +7.773516278397341e-03   +8.289555521659239e-03   +5.653695518831719e-03   +5.563579707737362e-03   +1.891565174211866e-02; +1.583576900480942e-02   +1.378238940275630e-02   +2.404297047348838e-03   +1.536295665602527e-02   +8.925476654670882e-03   +2.155343314513887e-02   +1.666725589416293e-02   +1.799514113873654e-02   +9.738994819942687e-03   +1.418860341144332e-02   +1.172967590923414e-02   +8.919380482031471e-03   +8.324219720347793e-03   +4.784748468247727e-03   +1.685487114266239e-02   +8.869725339994118e-03; +1.341497426425439e-02   +2.221285845793695e-03   +1.134632511860499e-02   +2.638466631860172e-02   -6.394488197147916e-05   -4.377132080544311e-04   +8.894135062647556e-03   +5.423440666348200e-03   +8.311063065031484e-03   +1.004662108832560e-02   +7.701149833067044e-03   +6.177716601478457e-03   +6.058005818253354e-03   -1.910584285228275e-03   +1.861191892433244e-02   +1.213356779665401e-02; +4.935858364908136e-03   +2.268765980507585e-02   +2.035164202476682e-02   +1.707567492603096e-02   +1.481572557770106e-02   +1.679224738899070e-02   +1.482091284143671e-02   +2.551520630497311e-02   +1.226810443235537e-02   +3.448675834632747e-03   +1.070064474733346e-02   +2.592651458742613e-03   +6.732833801837669e-03   +2.017492161144863e-02   +8.025505648422545e-03   +1.533219225122065e-02; +1.385019890844194e-02   +1.762593494395331e-02   +3.438516565574040e-03   +2.034868263181140e-02   +1.179392358963366e-02   +2.041366162282355e-02   +1.958214088215473e-02   +1.920014979784097e-02   +1.879071017406276e-02   +1.214097313153531e-02   +1.915959252545810e-02   +1.556072099751689e-02   +5.371194693919955e-04   +1.761193907936082e-02   +2.197557025944966e-02   +1.989456067511872e-02; +1.806927300190830e-02   +4.523356973692364e-03   +1.659965453527494e-02   +1.952202245081410e-02   +1.036550393260390e-02   +3.000997717674067e-02   +1.069470588987882e-02   +8.360853960470404e-03   -4.021179960846947e-03   +1.610910634765043e-02   +1.168072294832609e-02   +5.137933028634141e-03   +2.424400183785833e-02   +1.126352866053436e-02   +1.798482077346434e-02   +1.026780084648238e-02; +1.787263249328155e-02   -3.233008236946276e-04   +1.449149248732320e-02   +1.795525128640578e-02   +1.141720889521758e-03   +1.501745123172104e-02   +1.649957658825253e-02   +1.582219625160185e-02   +4.684372697357720e-03   +1.519371712809581e-02   +6.360884462932319e-03   +8.097096174742456e-03   +9.455300503668176e-03   +1.374322027686180e-03   +1.614238173430280e-02   +6.528020964279579e-03];
L2E_L1E_iAMPA_netcon = [+1.757594561175575e-02   +4.900306714763058e-03   +1.284830002000582e-03   +2.437688030145650e-02   -6.978074864501815e-04   +3.764129378479494e-03   +1.351933166235336e-02   +7.054517912027674e-03; +1.839487198813064e-02   +1.884258353664756e-02   +1.387733008002641e-02   +6.993437991229538e-03   +1.436089417431816e-02   +7.839114024190543e-03   +2.319183688972809e-02   +1.202840970663831e-02; -3.280683891147812e-03   -1.165798687070547e-03   +3.246020039404288e-03   +1.354938846996728e-02   +1.300947947431107e-02   +2.678798774272094e-02   +9.637017239016029e-03   +7.982244160967513e-03; +3.901435345770829e-03   +1.662055100075217e-02   +4.413969463833047e-03   +2.117592094087438e-02   +2.460577765503309e-02   +9.434278622237828e-03   +1.560660162257001e-02   +2.371092775354726e-02; +2.569813399807825e-03   +1.981444320296736e-02   +2.302346366834401e-03   -5.888090998495967e-03   +2.222684515412439e-02   +2.179899578759052e-02   +2.224925262605873e-02   +8.863963584214912e-03; +1.369902027471545e-02   +8.051978352702872e-03   +2.338873833095068e-02   +1.827871341999737e-02   +1.442960179127315e-02   -3.935921758701074e-04   +1.115799364539206e-02   +1.233069239014295e-02; +1.815812556465078e-03   +1.110236662669047e-02   +8.577266502305227e-03   +8.559945231014976e-03   +1.687561950787234e-02   +1.117330215004965e-02   +2.302880934015757e-03   +1.144335962892623e-02; +1.101464954072512e-03   -3.820640106017266e-03   +9.015092318857843e-03   +1.672386436522235e-02   +1.134750037211315e-02   +2.188647736938791e-02   +1.724565668824102e-02   +1.503150840742997e-02; +7.012310531392806e-03   +2.282412671902343e-02   +2.755916662635308e-03   +1.770378825586989e-03   +1.941630777248206e-03   +2.828568752425051e-02   +1.284702471700123e-02   +5.720289484788092e-03; +9.598796800285277e-03   +6.171116311533165e-03   +2.734155144647400e-02   +1.425567770262168e-02   +2.463569172003302e-02   +6.333254000679130e-03   +4.737497430796850e-03   +1.337983265063864e-02; +1.707120249345756e-02   +9.097210211566327e-03   -8.072106249062249e-04   +1.247817411977026e-02   +1.161978798022112e-02   +6.156658620681909e-03   +1.877752904588244e-02   +1.931804953705175e-02; +5.749720943278549e-03   +9.885274460841717e-03   +1.776088656261751e-02   +1.444012206041993e-02   +1.329303847666072e-02   +1.398340083628673e-03   +2.138030758355608e-02   +2.121666793870193e-03; +9.275393378346252e-03   +1.495308940843744e-02   +8.697279048841180e-04   +3.616213876028766e-03   +2.203707949593907e-02   +5.706859537770908e-03   +1.709435272539754e-02   +1.478693768744983e-02; +9.199056146131996e-03   +5.719092815537593e-03   +5.002759368309982e-03   +1.927017291866029e-02   +4.735347184814756e-03   +8.145152836348275e-03   +4.910445615943005e-03   +2.116408404688110e-02; +9.359778233867109e-03   +6.098227191194842e-03   -8.933586337056074e-04   +2.478578359264193e-02   +4.239490198936395e-03   -6.941219177374839e-05   +1.408056010764854e-02   -2.920489557158816e-03; +1.024581158973187e-02   +1.183213110618989e-02   +1.414856011249712e-04   +1.302237921334766e-02   -4.328928431558193e-03   +1.506004134727172e-02   +6.099915824171877e-03   +2.111930502094734e-02];
L1E_L2E_iAMPA_netcon = [-3.014176500198782e-03   +3.831372649578615e-03   +2.281450525097375e-02   +1.760535733904857e-02   +1.381908149873827e-02   +1.801600014978329e-02   +9.414419462752262e-03   +2.026532479497346e-02   +8.871471527369104e-03   +8.376371325758261e-03   +9.982860999497488e-03   +9.829687672582577e-03   +9.120887807782082e-03   +2.022080505562508e-02   +1.393983586663425e-02   +1.711427051265007e-02; +4.220026145641998e-03   +2.180313447310912e-02   -8.638804785234622e-04   +5.431643106245876e-03   +3.102521526787859e-03   +1.755882920579600e-02   -2.866947152258375e-03   +4.569242113579057e-03   +1.127492482422659e-03   +3.884190104510193e-03   +8.641721396511872e-03   +1.681722967536592e-02   +3.557981737220872e-03   +6.151410600793895e-03   +8.583227496318782e-03   +4.809037479747685e-03; +3.001518519917496e-03   +1.805155715771347e-02   +2.075166074234576e-02   +2.225343189299122e-02   +2.674949797538004e-02   +2.798793721692934e-03   +8.856930736019206e-03   -4.537471459143444e-03   +7.288704320583764e-03   +1.703661931486255e-02   +5.900968845389206e-03   +7.303165493914335e-03   +1.056495860220167e-02   +1.172618603208198e-02   +1.988305502362252e-02   -1.922594189440329e-03; +1.410684074236314e-02   -5.542448546458112e-03   +6.398900489511998e-03   +2.257710571771738e-03   +2.009963681794136e-02   +1.245950972151339e-02   +1.949062066840475e-02   +2.123278126275782e-02   +1.692868828121388e-02   +1.828071713540809e-02   +4.575118942401700e-03   +1.048371594483673e-02   +2.510453338681554e-02   +3.017687339608890e-03   +2.135119887805246e-02   +2.417189937218236e-02; +1.008644441986358e-03   +2.223685268884211e-02   +1.523452653619927e-02   -2.370387823853990e-03   +2.647741593267955e-03   +1.561193805734002e-02   +1.851282419477923e-02   +8.325601245766053e-04   +1.367891276211199e-02   +5.330283738131385e-03   +7.264551314206306e-03   +2.162624167591277e-02   +3.698465315907682e-03   +1.331994121099590e-02   +2.471428824040030e-02   +1.044486699666424e-03; +2.073961799354703e-03   +2.061001179708299e-02   +1.047869252034735e-03   +2.078496251521063e-02   +2.135550402595611e-02   +2.173635792667809e-02   +1.031648298751375e-02   +1.528611726179957e-02   +1.435671104654165e-02   +1.217922292868038e-02   +1.651218472415942e-02   +2.418352072031129e-02   +1.723920571073533e-02   +1.230779624734447e-02   +4.718632151473689e-03   +1.920455945269639e-02; +6.269714796334395e-03   +5.898525627151806e-03   +1.606458684394020e-02   +2.758391877309955e-03   +9.560146747198579e-03   +1.222021477450129e-02   +9.490933472895920e-03   +1.306776334203709e-02   +1.259912446519148e-02   +1.615133555331910e-02   +1.028942352756224e-02   -4.957296021750294e-03   +1.164409858741557e-02   +1.382075222659030e-02   +2.130568488504287e-03   +7.218339686102231e-03; +8.730005383338268e-04   +8.469961815453397e-03   +9.431592690217927e-03   +9.092425354222878e-03   +1.216818814385098e-02   +2.309250416466994e-02   +1.252181486524380e-02   +1.391743327831926e-02   +1.850148045119447e-02   +1.027170702791002e-02   +5.632567943353494e-03   +2.221678567748731e-02   +1.673458644153911e-02   +1.807064997442191e-02   +8.940516364190080e-03   +1.841682111219582e-03];
L2I_L2E_iAMPA_netcon = [+1.369525390121641e-02   +7.899786856711053e-03   +1.811295642930703e-02   +1.292572911049640e-02   +2.038660711259603e-02   +9.633833048613791e-03   +2.983720926356911e-03   +1.559985062836977e-02; +7.966268765838048e-04   -2.417438493737685e-03   +7.456384657149263e-03   +1.722342213544950e-02   +2.307756875531458e-02   +8.299451962684471e-03   +1.317357531292046e-02   +1.505103695198966e-02; +1.934652827260413e-02   +2.053686750240859e-02   +1.419479789366212e-02   +1.653852171083658e-02   +1.653635386643675e-02   +1.228407067166519e-02   +1.050359244513946e-02   +1.328945733443041e-02; +4.747594040946893e-03   +6.415170301247641e-03   +2.427487229488385e-02   +9.530973069956145e-03   +1.964085755824618e-02   +4.068772444417265e-03   +1.596921162085279e-03   +2.488462119421679e-02; +9.303688030039026e-03   +1.830675930910060e-02   +7.243045009799347e-03   +1.093058872839103e-02   +1.629204798745536e-02   +1.365416270946828e-02   +8.231806540794027e-03   +1.751594126970381e-02; +1.539233821884752e-02   +2.749753984889676e-03   +1.766602548823130e-02   +1.543171474790888e-02   +1.274368755829745e-02   +6.631356949640673e-03   -1.768638096725844e-05   +2.042466368769596e-02; +2.132039011549043e-02   +8.048923531111389e-03   -3.150987572818685e-03   +3.232555613159455e-03   +1.818673220095014e-03   +8.813070126213489e-03   +3.736490664443290e-03   +5.642666940770974e-03; +1.890259009572809e-02   +2.494572987145893e-03   +5.537287627053856e-03   +1.216205938689478e-02   +1.874920797766206e-02   +5.469404361299854e-03   +3.802346187416475e-03   +4.437819826552192e-03];
L2E_L2I_iGABA_netcon = [+1.939594681300781e-02   +3.671145114682485e-03   +4.132000084734666e-03   +8.347342346964659e-03   +2.072682249599432e-02   +1.117153655732228e-02   +1.207930249335940e-02   +2.167194177899926e-02; +2.735999515088394e-03   +1.190701221850916e-02   +9.153768545048957e-03   +1.339892935108274e-03   +2.611481386276308e-02   +1.626216985545761e-02   +1.705489667634731e-02   -3.354871814185989e-03; +1.152276081922646e-02   +4.130673964499447e-03   +1.190887557947021e-02   +3.721887747447935e-03   +2.767689857055316e-03   -7.889869553564488e-03   +2.181062750686975e-02   +1.566609038904731e-02; +1.846977133604369e-02   +1.099817265238937e-03   -3.376215637513761e-03   +1.764217306915302e-02   +1.751420125570908e-02   +1.795678691879292e-02   +1.182599160667245e-02   +9.319515468881731e-03; +8.699362039376623e-04   +1.201249067286500e-02   +9.506237266603030e-03   +1.674946072878261e-02   +1.335586590578200e-02   +5.524933489566843e-03   +6.108451322468987e-03   +3.426148531592765e-03; +1.693528863731340e-02   -3.584284176359579e-03   +1.461879176454257e-02   +1.959695500068525e-02   +2.102763559766429e-02   +8.853059550276928e-03   +2.574683532206132e-02   +1.745021938352304e-02; -6.079162763505935e-04   +2.687918142705672e-02   +5.301072446523452e-03   -6.534249714759235e-03   +1.997748537381129e-02   +2.401544665020988e-03   +8.079908531605590e-03   +9.438522226330076e-03; +1.593946175063440e-02   +9.075511641790952e-03   +1.241339494678095e-02   +6.321460258426983e-03   +8.694660720113632e-03   +1.900416173045127e-02   +1.800906568897258e-02   +2.174403622342884e-02];
L3E_L2E_iAMPA_netcon = [+9.994156183722482e-03   +1.813764460698306e-02   +5.809917177047275e-03   +1.370837838189109e-04   -6.001809469623949e-03   +2.620105737062734e-02   +1.006285254206766e-02   +2.028981867359352e-02   +4.564293897547858e-03   +7.157838856981123e-03   +7.477108534669436e-03   +1.019085256594118e-03; +9.262448611402215e-03   +2.347448205624191e-02   +5.613407135071870e-03   +1.319462753739416e-02   +1.329269433381255e-02   +8.045512392557283e-03   +1.766663261347608e-02   +2.395754819974638e-02   +1.922227606523647e-02   +2.294488598075643e-02   +1.691389175295057e-02   +6.789932890015727e-03; +2.724350098545746e-03   +1.764227356672661e-02   +2.844377826183738e-03   +1.909975777937042e-02   -3.830387474298873e-03   -2.280770283038666e-03   +1.365785538391743e-02   +2.654175023884634e-02   +9.258258600521100e-03   +1.096987243611520e-02   +8.295476795389247e-03   +1.350161047111942e-02; +4.180621314329659e-03   +6.442344234052703e-03   +1.620403021224793e-02   +1.469702133804678e-02   +4.222928518172504e-03   +2.735116488214672e-03   +9.128879473525583e-03   +3.467395324054117e-03   +6.303944403342496e-03   +1.433693128711308e-02   +5.843270510266278e-03   +9.398386146395623e-03; +1.813678193152678e-02   +2.267003715497216e-03   +7.235991184453405e-03   +2.566336772501135e-02   +1.697670701757483e-02   +7.424320112357705e-03   +2.000701566133343e-02   +5.150975682540128e-03   +1.541211186528965e-02   +1.962951243419498e-02   +1.981623843084614e-02   +7.111319290354509e-03; +1.948572507615675e-02   +1.238534131793856e-02   +7.565395903406050e-03   +5.463175423882860e-03   +6.204504088107498e-03   +2.391333235677509e-02   +2.624766838648131e-02   +6.872744337408395e-03   +9.851565842846782e-03   +2.858182698519123e-05   +2.010975307377570e-02   +4.182747984082908e-03; +1.421301411973886e-02   +6.804229382052281e-03   +1.514709518987355e-02   +1.281263838676634e-02   -3.859227053485426e-03   +1.021112406496239e-02   +4.291130695641575e-03   +1.113134655681824e-02   +5.679256227916700e-03   +1.108814423271768e-03   -7.296205610368032e-04   +9.518593917474550e-03; +2.071567101538797e-02   +3.309197741533433e-03   -1.694221185698312e-03   +1.155512130080376e-02   +7.259009588779024e-03   +1.601806681102961e-03   +2.743109394520936e-04   +5.668590316950803e-03   +2.996652757289239e-03   +2.738800013337940e-02   +2.803264116092642e-03   +1.137387863361505e-02];
L3I_L2I_iGABA_netcon = [+2.038697489898068e-02   +1.171521073266013e-02   +1.542992247943826e-02   +1.594326817025422e-02   +2.051880830886678e-02   +1.242172893684300e-02   +6.232530313886160e-03   -3.993205664472615e-03   +2.497691970178790e-02   +1.345048330478434e-02   +2.152736271820875e-03   +2.177633824445023e-02; +1.804946972694979e-02   +2.713576258953139e-02   +2.359388131711495e-02   +3.667824897712667e-03   +8.683978311420603e-03   +1.578782652329829e-02   -3.384212374996274e-03   -3.658315812128570e-04   +1.429519112056212e-02   +1.206008589138280e-02   -4.453989502686750e-03   +1.124517381333627e-02; -3.438702283090982e-04   +1.093120715082612e-02   +2.225061284071024e-02   +9.810016389915582e-04   +2.190724033809120e-02   -2.992924853636311e-03   +1.091558597905361e-02   +1.969088611258176e-02   +1.437130608959539e-02   +2.878273137596782e-04   +1.120005237205815e-02   +1.305474142608445e-03; +2.170020255847114e-02   -1.919891443580745e-03   -2.425064290373510e-03   +1.689129385887635e-02   +2.195044746988984e-02   +1.543167663449816e-02   -1.702385854670183e-03   +6.475369876474741e-03   +1.848840603863464e-02   +9.504680444068237e-03   +2.050402659076617e-02   +1.681081367401185e-02; +6.266464838494830e-03   +2.804502109354254e-02   -1.754809091289540e-04   +6.876482539750818e-03   +1.106045375243705e-02   +1.877769085271207e-02   +4.448318823885148e-03   -2.664948472812831e-03   +1.712659057439728e-02   +1.785986309791585e-02   -2.920082189350002e-03   +8.474790054245260e-03; -2.963036629298112e-04   +2.130102316635821e-02   +8.268163087565674e-03   +2.374760938092837e-03   +9.762555216418955e-04   +1.064888260976038e-02   +1.752592192076555e-02   +8.283340607886379e-04   -2.568514095488699e-03   +1.187899842134404e-02   +1.426769211765867e-02   +7.009603607054926e-03; +1.842195466570946e-02   +1.592700151041070e-02   +1.171504943081520e-02   +2.247210695170231e-02   +8.108302730131517e-03   +7.928040292114089e-03   +1.081423851194954e-02   +4.887958541872853e-03   +1.389286747737846e-02   +9.108037574954342e-03   +8.592694724969452e-03   +9.942383019919841e-03; +7.611174862829995e-03   +1.357682231593071e-03   +1.305712032165723e-02   +1.188082548800444e-02   +9.336091253476616e-03   +3.476549550151372e-03   -1.562451140155539e-03   +5.995053878646105e-03   +1.246863547040965e-02   +1.601246775215628e-02   +4.690665290254194e-03   +1.233278320968187e-02];
L2E_L3E_iAMPA_netcon = [+1.552810867974602e-02   +9.673432134618951e-03   +1.057392868734895e-02   +1.595452462042720e-02   -1.850198411562091e-03   +1.248691804336502e-02   +1.929178159990976e-02   +2.494612209111506e-02; +1.433847968916364e-02   +1.579780664406156e-02   +1.789042670440723e-02   +1.080487993750467e-02   +4.628779941755218e-03   +1.636232468653511e-02   +2.322132515639434e-02   +1.261632483947885e-02; +1.779422525258147e-02   +2.074671981909160e-02   +2.645992173825300e-02   +1.911629107610395e-02   +1.534857971914989e-02   +1.629339735901193e-02   +1.345124291026406e-02   +1.971394291084859e-02; +1.094447871124203e-02   +1.467707018318170e-02   +1.766081424144860e-02   +7.057772619379483e-03   +1.119134300623306e-02   +1.125581545300160e-02   +1.292702785098770e-03   +7.486561069806590e-03; +5.329545600129751e-03   +1.200738841423187e-02   +1.527682331789369e-03   +1.028062430133439e-03   +3.610313551309926e-03   +1.107809169381386e-02   +1.637196890082260e-02   +1.977136672143290e-02; +1.533518623610353e-02   +2.590927255872904e-02   +2.096233499421220e-02   +9.149028846331488e-03   +1.711693213414842e-02   +2.878332315362694e-02   +1.125848795720171e-02   +1.821727253199936e-02; +8.350944673318889e-03   -4.413770015604701e-04   +1.144265959284638e-02   -4.864926238551167e-04   +8.574268848993075e-03   +2.275848690319492e-02   -1.703405426987671e-03   +1.349673419076757e-02; +2.566726495094825e-02   +1.947496308468661e-02   +1.563614300772767e-02   +2.455855075817387e-02   +7.156755508488586e-03   +2.032033281687501e-02   +1.616942416861073e-02   +1.042550595484833e-02; +6.481449956034129e-03   +1.090303997228350e-02   +2.322159764922641e-02   +1.547140432892138e-02   +1.089557689993549e-02   +9.454032990481944e-03   +2.233821849882706e-02   +1.758862027196306e-02; -4.537067494879417e-04   +8.733812976995832e-03   +1.348439231692693e-02   +2.274535551685244e-02   +2.458842349126833e-02   -2.393787459227394e-04   +4.419050246131572e-04   +1.767387277217465e-02; +1.601702594540155e-02   +8.694788162403731e-03   +1.404010060796568e-02   +2.102355961911188e-02   +2.776454552151298e-02   +2.361482104993987e-02   +6.075726177803726e-03   +6.486812381845160e-03; +9.192416375594296e-04   +1.397833022589303e-02   +7.758451225712172e-03   +1.881067717283445e-02   +1.370909545202866e-02   +6.817325477319372e-03   +1.917200213131118e-02   +2.192770514848759e-02];
L2I_L3I_iGABA_netcon = [+2.543238837069023e-02   +1.248234497856046e-02   +2.364037314321218e-03   +8.126361450426028e-03   +1.738418051103945e-02   +2.480846474424134e-02   -5.872838145090814e-03   +1.011193439409303e-02; +1.181305492293406e-02   +1.130538267672112e-02   +2.181393775336951e-02   +2.513833760995479e-03   +1.770535417819821e-02   +1.597782493591017e-02   +1.860357518709373e-02   +1.113053776503269e-02; +1.664835047651410e-02   +1.455471594559024e-02   +1.346415121802815e-02   +1.588930855689527e-02   +8.717827066818505e-03   +1.275889629173914e-02   +5.687896119585117e-03   -1.930888550637084e-03; +2.438774165803939e-03   +2.219678932197926e-02   +6.396622629420581e-04   +7.225987320754275e-03   +3.995330340299876e-03   +9.530351493109586e-03   +8.738999131080344e-03   +2.275162696773029e-02; +9.640801290076583e-03   +1.262435538117130e-02   +1.348390911399245e-02   +7.358934368815122e-03   +8.817152885163403e-03   +1.104652103088387e-02   +1.694818374626595e-03   +8.595544041119816e-03; -2.517590905609122e-04   -3.692032042247121e-03   +1.323042371490450e-02   +4.574466559884338e-03   +8.872958996783881e-03   +1.123756480068094e-02   +1.257355128235209e-02   +2.164329708948647e-02; +5.006843118924384e-03   +1.052415585817162e-02   +2.074663281213607e-02   +1.770389857176122e-02   +1.250571871233796e-02   +7.712189923765427e-03   +7.902933262928201e-03   +1.179895537547721e-02; -7.156124873568402e-03   +2.961671627706094e-02   +1.117967391581648e-03   +1.279578862354004e-02   +7.949645414052433e-03   +1.942160793298559e-02   +1.583643442456724e-02   +7.674540802831174e-03; +1.945727808408519e-02   +1.575552945735010e-02   +1.887458384101356e-02   +2.219920382133481e-03   +1.182849033532479e-02   +4.623747899220048e-03   +9.596687173895748e-03   +1.590925220925720e-02; +1.679126664446857e-02   +1.578206620700722e-02   -6.457305589290499e-04   +1.015333516259214e-02   +7.418249108400498e-03   -6.206670253497480e-04   +8.916225835207665e-03   +9.112703529742465e-03; +1.983168432718916e-02   +2.377748399174366e-02   +7.580890766113079e-03   +1.549208203549112e-02   +5.969304491170938e-03   +9.377181984064765e-03   +1.511360867235734e-02   +1.787469386656320e-03; +1.706901693593576e-02   -3.729736606326543e-03   +2.120211185056068e-03   +2.941233404082412e-03   +3.849220962685372e-03   +1.754746153331569e-02   +1.226120472736150e-02   +1.175345512038710e-02];
L3I_L3E_iAMPA_netcon = [+7.324295701157124e-03   +1.926308627615479e-02   +9.479631933093520e-03   +1.601740466868118e-02   +2.065283800302579e-02   +1.240651681695135e-02   +7.633194354381392e-03   -5.568162841959867e-03   +1.596466970093184e-02   +9.004867423143896e-03   +4.743638352419446e-03   +5.876213207945347e-03; +1.081565044877080e-02   +1.740266802899937e-02   +3.281712406984644e-03   +2.407580071859209e-03   -4.141818387479937e-03   +1.467266851808200e-02   +1.430430501825661e-02   +8.648097936648636e-03   +7.850723998967522e-03   +1.168561710516446e-02   +2.142088913034088e-02   +1.553079599493845e-02; +8.702011125889302e-04   +1.567044973562031e-02   +6.492322413093248e-03   +1.593275778592703e-02   +1.654055708326335e-02   +9.181913640614860e-03   +9.319201947227405e-03   +6.984816387662538e-03   +1.713670619508646e-02   +1.254870403518655e-02   +1.158277122018043e-02   +1.636006211048855e-02; +9.949833950303849e-03   +1.564856595616514e-02   +1.213345171515952e-02   +7.818051770375648e-03   +1.556772725743049e-02   +2.164631902676535e-02   +1.839891899013167e-02   +7.366244422322467e-03   +1.986914923334433e-02   +2.229296937428325e-02   +1.151930220529729e-02   +1.736255621152715e-02; +5.174631088718584e-03   +7.837177741946708e-03   +5.458379777799838e-03   +1.301503008141284e-02   +1.663758631875363e-02   +1.149817965854624e-02   +2.287580205523069e-02   +1.874026763111960e-03   +1.768805772738744e-02   +6.407854522470988e-03   +8.792716024310119e-03   +4.326022020754097e-03; +6.767679752997155e-04   +9.904766819630035e-03   +2.366107321650855e-02   +1.148769693729400e-02   +2.277655442733704e-02   +7.056835416808949e-03   +1.877984605232010e-02   +4.769927783387545e-03   +1.770547857825844e-02   +1.127195596137745e-03   +2.858498218069627e-04   +6.838999548314317e-03; +1.882810050412279e-02   +8.929288334704837e-03   +1.240478353717984e-02   +4.188389092838082e-03   +1.170436253826672e-02   +6.881320727824426e-03   +1.163716479242588e-02   +2.294108161177106e-02   +1.651261198441863e-02   +2.225721050530991e-02   +6.919224935012308e-03   +1.961538055037887e-02; +1.652899006601564e-02   +5.483141073323579e-03   +1.328889318571692e-02   +1.429625534999729e-02   +2.438165244200061e-02   +1.481078695819154e-02   -5.848015777172333e-04   +1.368842517914332e-02   +8.934719382878490e-03   +3.515533392961448e-03   +8.054175576573491e-03   +2.245578175097968e-02; +4.569412377258109e-03   +1.626968381566217e-02   +1.523147396508041e-02   +1.427033790183773e-02   +9.083947712410442e-03   +1.623421182778925e-02   +1.924672111350013e-03   +2.073088758335137e-02   +1.346566894240151e-02   +1.066893130494418e-02   +7.489171935608468e-03   +1.801244249205544e-03; +1.492163900649829e-02   +1.890336875026028e-02   +1.692927890223350e-02   +6.961780648136117e-03   +1.213790982904614e-02   +2.147542396210147e-02   +1.032207880139192e-02   +2.679196717092520e-02   +1.660161844743544e-02   +4.740544585799535e-03   +1.401524410369909e-02   +7.279503300176501e-03; +1.481547544464900e-02   +1.039097563182134e-02   +2.025909573136024e-02   +2.732035305556591e-02   -3.563479863862145e-03   +1.823771474968961e-02   -2.307023297368494e-03   +7.551429776291148e-03   +2.775983566267130e-03   +2.048830570105447e-02   +1.010605026381406e-02   +9.012249870778687e-03; -5.867836208812900e-04   +6.876354921863637e-03   +2.565601317225306e-03   +2.016833016708771e-02   +1.313380464302947e-02   +7.370718454353411e-03   +2.166725150605922e-02   -1.650101098805536e-03   +3.185145742386309e-03   -1.629139478158525e-04   +2.112864074884784e-02   +8.648399957628641e-03];
L3E_L3I_iGABA_netcon = [-1.484278906409513e-03   +1.435971965755911e-02   +5.201563143684135e-03   +2.585897340355784e-02   +1.274843078392904e-02   +1.585408442657115e-02   +1.092614763804401e-02   +1.126090265244328e-02   +8.153686326130246e-03   +1.406237404296153e-02   +1.229190030245847e-02   +4.796311968611256e-03; +1.415689902509368e-02   +1.544100441137380e-02   +7.351876922691159e-03   +7.749705040432875e-03   +5.174393571976050e-03   +1.599228414371627e-02   +1.757640982727643e-02   +2.393935083453513e-02   +1.800359555026664e-02   +1.106777568787013e-02   +3.293458443544870e-03   -1.659431049841049e-03; +6.607585510932594e-03   +2.310713613995626e-02   +1.523208181123089e-02   +1.553210958194795e-02   -1.518044376135727e-03   +2.054981970589412e-02   +1.452527851039731e-02   +1.995346409782114e-02   +5.539283103338788e-03   +1.233337472892203e-02   +9.086745080960447e-03   -5.345942961503241e-05; +6.280613253760671e-03   -4.575806456597757e-03   +5.198931374267377e-05   +2.115515241194078e-02   +1.423749573639251e-02   +6.185721366275862e-03   +3.533938995579518e-03   +1.044880751668767e-02   +1.933626237705679e-02   +2.986346945429215e-03   -3.321369781299483e-03   +1.457686620268265e-02; +7.384830291327133e-03   +1.164300588355251e-02   +2.485085483380738e-02   +5.643782518668409e-03   +4.157896964590842e-03   +1.623621145122666e-02   +2.895355962121023e-02   +2.186570469201636e-02   +3.786377571648776e-03   +1.262873713197095e-02   +2.686474429594671e-02   +2.097994353786717e-03; +1.878850984731030e-02   +6.857519845122347e-03   +1.615540630135361e-02   +5.436785905298143e-03   -2.789524350815978e-04   +2.654099724284167e-02   +4.134658059946564e-04   -5.328119735657322e-03   +1.361066282785642e-02   +1.281275770669084e-02   +8.255791730938400e-03   +2.285833119025243e-03; +9.001642036532921e-03   +1.373728712252058e-02   +7.713040813006775e-03   +1.502885301084988e-02   +9.683465472098829e-03   +8.204023423892939e-03   +3.470400067448482e-03   +3.872042494028690e-03   +1.485902637263572e-02   -1.591986732122882e-04   +1.999950051954030e-04   +1.436332130206537e-02; +6.383827812638118e-03   -4.429555240393786e-03   +8.545614665910313e-03   +2.064729344846073e-02   +1.104516032646455e-02   +1.582725014400665e-02   +1.008611540885321e-02   +1.881615069710612e-02   +1.936203198813402e-02   +1.930237067079731e-02   +2.426373886118865e-03   +1.905622507738741e-02; +7.728425072055901e-03   +4.154733488691294e-04   +2.154712500423205e-02   +1.571459426250596e-03   +2.157031142679292e-02   +1.841334337458994e-02   +1.115809905750084e-02   +2.178332246043754e-02   +6.508824913690803e-03   -1.916424414527204e-04   +5.317807344124425e-03   +1.029245870202354e-02; +2.158817664517323e-02   +1.163152410264503e-02   +2.079917598249158e-02   -5.138035435059858e-04   +2.244344465486907e-03   +3.072923548192728e-02   +1.533753617942337e-02   +8.868421149432268e-03   +2.415100018703847e-02   +2.122905985727491e-02   +7.149342554030219e-03   -2.103855071420035e-03; +1.084261091163269e-02   +4.971840570291750e-03   +6.867559101087854e-03   +7.671313828114167e-03   +1.557550086127135e-02   +1.561568707718178e-02   +2.409595514803008e-02   +1.606553049614520e-02   +1.564652879480458e-02   +4.875028364927245e-03   -5.171202203460496e-03   +1.657891261740291e-02; +8.275733996607039e-03   +9.133973253908889e-03   +1.626055391159134e-02   +1.352408151381018e-02   +2.799280337431322e-03   +7.928997243295459e-03   +2.100900231621233e-02   -3.790911053915399e-03   +2.278997866649435e-02   +1.555347890782055e-02   +1.214596857661965e-02   +8.944954021585738e-03];
L2E_Input1_iAMPA_netcon = [+1.996191912475041e-02   +2.220502732542863e-02   +1.481543322320581e-02   +2.464082714440570e-02   +2.488445147729903e-02   +2.859075604850352e-02   +2.320657436201889e-02   +1.567860186557946e-02];
L2I_Input2_iAMPA_netcon = [+1.729297396018417e-02   +2.203190755566447e-02   +2.849127604667091e-02   +1.453280267947157e-02   +1.799629983638679e-02   +2.460854265309368e-02   +1.860684092137120e-02   +2.202380573080547e-02];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.0*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.2*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.0*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.2*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.0*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.0*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.2*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.0*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.2*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.0*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
