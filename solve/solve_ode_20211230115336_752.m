function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+5.560189258268704e-02   +1.132526766394441e-01   +6.394858391450052e-02   +6.059499156660084e-03   +9.267526751925709e-02   +1.444837861659638e-01   +8.065101197495628e-02   +1.079186780973174e-01   +4.602808997556443e-02   +6.593902095530178e-02   +1.118748320256413e-01   +3.054054540061358e-02   +6.279271591624574e-02   +1.564375592577592e-01   +7.737050075142279e-02   +9.389820966523423e-02; +1.923085418997973e-01   +1.408932763202937e-01   +9.462323993611520e-02   +8.486131412069980e-02   +1.295384050908062e-01   +1.012098465654647e-01   +1.161861614200355e-01   +7.934502562932202e-02   +1.048260480822165e-01   +1.032322660407133e-01   +1.731515031999876e-01   +1.071571786185686e-01   +9.977911161906114e-02   +1.106714676729296e-01   +2.324474902903898e-02   +2.348710206112177e-02; +2.209781311733641e-02   +6.066524648492642e-02   +1.214123751551530e-01   +2.463176728525494e-02   +8.828930620316948e-02   +1.451636429707489e-01   +1.910366393082185e-02   +1.596381915791457e-02   +2.162927902975687e-01   +1.001153436541347e-01   +1.843611989912569e-01   +2.075801998658368e-01   +5.562138875902425e-02   +1.443876659132931e-01   +1.511014011605238e-01   +4.447397389060093e-02; +2.372232281948377e-01   +6.500728673150755e-02   +7.152071479118788e-02   +1.673099155043157e-01   +1.441673551737643e-01   +8.836313473798013e-02   -4.853870825798007e-02   -2.058284574159658e-02   +2.682078648463257e-02   +6.502513659017220e-02   +9.731207103707037e-02   +5.477229721273710e-02   +1.962450746527924e-02   +1.231394058579629e-01   +1.810383557389360e-01   +1.407241274100093e-01; +4.210200721142450e-02   +2.428622460482949e-02   +2.393973111125996e-01   +5.464168500730830e-03   +7.996954225215441e-02   +1.771219415123631e-02   +8.188247491660042e-02   +1.593737637088594e-01   +1.014447867126042e-01   +1.583035296979051e-01   +2.260396103711818e-01   +8.189230119561310e-02   +1.102994120231249e-01   +4.733333180745945e-02   +2.150655553241773e-01   +3.602415168285353e-02; -8.015462398763244e-02   +5.926949200250328e-02   +2.302047106166008e-01   -1.467521286278840e-03   +3.809211765543090e-02   +7.501338696119481e-02   +1.012747462694134e-01   +3.415340561017109e-02   +7.615962951161362e-02   +3.201128068794993e-02   -1.346117430697773e-02   +1.188454742553152e-01   +1.502727787476268e-01   +2.772310461668067e-02   +2.082496944484588e-01   +1.146132665031101e-01; +1.510873660271919e-01   +1.405390971098311e-01   +1.154478562783518e-01   +2.074390816729919e-01   +6.553685366113535e-02   -1.035383667797247e-02   +1.027306796155285e-01   +5.231080533750978e-02   +1.735792231731451e-01   +1.357488164099881e-01   +5.959118145754921e-02   +9.726147392989411e-04   +2.319618332993063e-03   +1.806061758655443e-01   +1.444510354474991e-01   +1.243535661852629e-01; +1.541804516436246e-01   -6.048008453158894e-02   +3.882534171638306e-02   +2.038131628296180e-01   +2.182100632849450e-01   +4.657271583022730e-02   +4.003064927472752e-03   +3.430981407249031e-02   +2.376747566530859e-02   +2.199425695474060e-01   -4.995469559861276e-02   +6.979325543865707e-02   +3.178866597098884e-02   +9.267447640318918e-02   +6.642530544870782e-02   -3.310467060587644e-03; +1.564372299548989e-01   +1.580696876880299e-01   +1.657567255948250e-01   +4.422362034829096e-02   +5.946580569355670e-03   +4.527301228162232e-02   +1.370251550885973e-01   +9.680037985033996e-02   +1.021591264965065e-01   -4.140935934865000e-03   +6.228639418090356e-02   +8.261598823387817e-02   -7.628701903978134e-03   -1.330172043539355e-02   +1.875516828038610e-01   +1.564292009868080e-02; +1.483101577878186e-01   +2.255612036513234e-01   +1.103576047912546e-01   +1.310204363425687e-01   +1.066734788456326e-01   +3.016372635530513e-02   +1.090727467585859e-01   +1.073286791602353e-01   +1.905429853927168e-01   +3.822546233415296e-02   +1.534182757530471e-01   +1.086183727196606e-01   +1.262673812815722e-01   +1.416055624588921e-01   +2.327541086818738e-01   +6.548393470127975e-02; +1.001411060584756e-01   -6.608441897317774e-02   -8.412602211356058e-03   +1.257711143121213e-01   +1.462129818777719e-01   -5.376461973485210e-02   +3.261724553987221e-02   +1.330535321782408e-01   +6.776185028616302e-02   +1.113537204274464e-01   +2.457016591875615e-02   +1.042090774112680e-01   +1.194075604880635e-01   +1.354627433354971e-01   +1.877233068622789e-02   +9.739242080074195e-02; +7.182449082850809e-02   +1.190029536006831e-01   -1.330264115599126e-02   +1.031181256385907e-01   -2.049472881343704e-02   +1.486382983963603e-01   +8.925712738378910e-02   +4.165006987796617e-02   +3.383375448323814e-02   +4.276090982331406e-02   +2.947079368800307e-02   +3.505544117468280e-02   -2.040195925298702e-02   +2.073722937220554e-01   +1.745248555226286e-02   +2.342842626881385e-01; -5.786485595346234e-02   +2.538508383530980e-02   +1.232944746379988e-01   +1.364319208759397e-01   -9.478134178385510e-02   +1.411718129354918e-01   +1.009919737097999e-01   +8.604884082039375e-03   +6.321723026898626e-02   +4.831516182949134e-02   +5.049027109754799e-02   +1.174745400912796e-01   +2.403805682073897e-01   -3.798019425351930e-02   +8.204986743157264e-02   +1.554917595940755e-02; +1.175902293623311e-01   +2.134021231918122e-01   +1.027498300338766e-01   +1.457067516569542e-01   +1.721395870030427e-01   -6.713044371844190e-02   +5.427642544081250e-02   +1.286859849529466e-01   +8.007299938983768e-02   +1.718768799348425e-01   +7.938761787571194e-02   +9.705397751109740e-02   +3.385096032713159e-02   -4.085832906929248e-03   +1.409515441736865e-01   +4.503370509957765e-02; +1.042982353552388e-01   +2.921602495489879e-02   +8.923325715185555e-02   +1.073405582004633e-01   +6.303248197930467e-02   +8.216105129608323e-02   +1.407223567691671e-02   +1.690932553997403e-01   +1.133260321595910e-01   +2.078284685125037e-01   -2.209573831907802e-02   -7.038017183181127e-03   -6.099101480482646e-03   +1.274184755208733e-01   +2.452431481064578e-01   -6.302362547264487e-02; +1.335147257583434e-01   +1.444057675947410e-01   -3.314805060337195e-02   +1.723964204098388e-01   +1.811834600613704e-01   +1.365464002944984e-01   +1.028031842672157e-01   -6.484400806094798e-02   +5.654720024397125e-02   +1.455426806699132e-01   +1.853817485112150e-02   +4.873942729073523e-03   +1.114129650910271e-01   +1.708767680656679e-01   +1.028697956927830e-01   +1.777284157613554e-01];
L1E_L1I_iGABA_netcon = [-2.617587778696716e-03   +1.074072191875088e-01   +4.566563763875292e-03   +3.027853636834893e-02   +2.984160558755753e-02   +6.114380728095007e-02   +1.760658456152819e-01   +7.489277735037402e-02   +7.908071636137121e-02   +5.468049913497210e-02   +3.153034806460560e-02   +8.593634574710483e-03   +2.403270073614688e-02   +5.563317201202803e-03   -2.465989405912144e-02   +6.872563170429273e-03; +1.247593907761239e-01   +6.318616728505479e-02   +2.008954338478485e-01   +4.746912420657926e-02   +4.658605383789247e-02   -7.213883163776927e-02   +2.167326844783229e-02   +7.388687538593891e-02   +9.576512381577068e-02   +1.413416913684710e-01   +8.641900712442949e-02   +1.170432373620784e-01   -3.343902970531773e-02   +3.797900127695663e-02   -1.923142984879952e-02   +1.253640706915006e-01; +5.487615741175907e-02   +7.736082389471959e-02   +1.241824848707499e-01   +6.716891256684460e-02   +2.308350360859172e-01   +8.400640014879822e-02   +1.794179693521832e-02   +2.422270978690079e-02   +1.192371863137715e-01   +2.250259526685079e-01   +1.040076748305365e-01   +1.613865363888874e-01   +1.578281252933000e-02   +2.113116888708202e-01   +1.032459997878452e-01   +3.199119112205200e-02; +3.684845370990605e-02   +4.683315778303858e-02   -4.004927921076354e-02   -3.713609369880904e-03   +5.280397624135987e-02   +1.075019809121724e-01   +1.231083111531325e-01   +8.420162512043150e-02   -6.833118050462142e-02   +3.831269188871610e-02   +6.213008844411318e-03   +9.020693714193070e-02   +1.373989966159120e-01   +7.077649703363480e-02   +1.173988386285340e-01   +1.036438681033570e-01; +7.974711059087945e-03   +9.872877112868628e-02   -3.076816825924316e-02   +1.191430730811131e-01   +8.935079515143689e-02   +1.560597876454934e-01   -2.396951670830939e-02   +3.637832360141847e-03   +2.170553358498043e-01   +1.332915383943779e-01   +1.293927345732492e-02   +8.496472376306974e-02   +6.850714141085325e-02   -9.261926911540395e-03   +1.503675419131178e-01   +6.906738581621552e-02; +3.837100758973569e-02   +4.880457341230482e-02   +2.268398024480207e-02   -8.348388575891728e-02   +1.837152724838374e-02   +9.856461006046087e-02   +1.431583851652286e-01   +1.095194799089554e-01   +1.549553635933654e-01   +1.318513937332927e-01   +2.210608710283079e-02   +3.618015391574879e-03   -6.340555304146676e-02   +1.475625733721521e-01   +2.236233671274588e-01   +6.649552244049950e-02; -1.246074825073519e-02   +2.031873335359158e-01   +1.328333099807317e-01   +2.088054831756293e-01   +1.445232222780354e-01   +1.358735053120388e-01   +2.515326751630725e-01   +1.399218631251110e-01   +5.026891128698541e-02   +6.974187050411135e-02   +2.043237420726663e-01   +9.972303246000558e-02   +1.226643797541937e-01   +4.826978822653837e-03   -1.210129012194189e-01   +1.466821871817143e-01; +7.417873494553326e-02   +8.864334238231222e-02   +1.408731826262816e-01   +1.614807632349934e-01   +6.355458626996982e-02   +1.318789758062818e-01   +6.128329009087365e-02   +3.491147572199994e-02   +2.792322316348841e-02   +7.018209512569264e-02   +1.143278692226772e-01   +2.152707994379690e-01   -1.191353184352378e-01   +1.584222149300273e-01   +1.454547887430933e-01   +1.286515137018151e-01; +3.737557512801263e-02   +1.647877903492319e-01   +1.715555342973497e-01   +1.729364877816022e-01   +1.100829647074806e-01   +2.602559534600763e-02   -1.416756896792898e-02   +9.930004907167517e-02   +4.322392056489962e-02   +3.685251108567909e-02   +5.900829931876596e-02   +1.359076831240257e-01   +1.037284762761580e-01   +1.629779205911202e-01   -3.848860127610407e-02   +6.430127485172535e-02; +6.796410186108792e-02   +9.907292529535627e-02   -1.476680071767507e-02   +1.983617108105094e-01   +1.131042506538243e-01   +2.312761679397676e-02   +1.400679552082033e-01   +8.813396440463384e-03   -2.816553927169560e-02   +2.167362776221193e-02   -1.680371714684824e-02   +1.096841472481441e-01   +7.873970880534251e-02   -5.940919640350546e-02   -7.212339913132717e-03   +5.985720847014320e-02; +1.340561849789445e-01   +2.064102630991516e-01   +1.303492587348793e-01   +5.931651953274166e-02   +9.158773317722976e-02   +6.864330499176544e-02   +1.173367357261779e-01   +3.712281371506182e-02   +3.500068995256415e-02   +6.445037534816211e-02   +1.517881961954924e-01   +1.757153780812214e-01   +1.878716840376335e-01   +2.505679029626062e-02   +9.474047413599630e-02   +8.628714393361941e-02; +1.510768174327792e-01   +9.901884963717188e-02   +7.987286583380646e-02   +1.661977809975199e-01   +1.070208756125314e-01   +1.711635353831938e-01   +1.906626914037695e-01   +1.996119959592976e-02   +4.560200585327129e-02   -4.575606510125828e-03   +1.239797415472634e-01   +1.323580147417325e-01   +1.885489351349468e-01   +1.644736684595619e-02   +2.363018117412613e-02   +2.640192011663957e-01; +4.988570960072379e-02   +7.720508121539034e-02   +5.507779534008440e-02   +9.919410478359530e-02   +8.363505659912807e-02   -1.549118490095681e-03   +8.601823767804810e-02   +1.464578039987359e-01   +7.533249881385976e-02   +1.275873801534257e-01   +5.436887208561280e-02   +3.809776028384918e-02   -6.424194718903159e-02   +6.809852030202812e-02   +1.565649445388504e-02   +7.424609253097081e-02; +3.760805658951533e-02   +1.337017793408627e-01   +1.521665396865929e-01   +1.217282322814630e-02   +1.182316503025574e-01   +5.704182708050902e-02   +1.965545864749106e-01   +2.175159817848486e-02   +2.833868718455471e-02   +3.865681847578489e-02   -7.739075865438790e-02   +1.216755965445682e-01   -2.648283272271948e-02   -3.830289403381848e-02   -1.054618097402621e-04   -1.028761441292962e-02; +1.227890182771642e-01   +1.419321160584696e-01   -4.577488360438010e-03   +6.750567320182249e-02   +8.146117541460494e-02   +1.495996144181325e-01   -2.590790463845720e-02   +8.608889028123096e-02   +2.022454227068821e-02   +7.450795300563270e-02   +1.239795819030172e-01   +5.057887870208357e-02   +1.415885370957035e-01   +5.555902299763542e-02   +7.667087489516353e-02   +5.438585318074567e-02; +1.689150574001762e-01   +8.813656330455770e-02   +1.433836577992497e-01   -3.773895334374493e-02   -4.896108480419263e-03   +1.881308274330969e-02   -1.904009538018464e-02   +1.542765976849872e-01   +6.387848212926056e-02   +1.066051509820486e-01   +1.334589726994087e-02   +1.103881254937960e-01   +1.866439995972179e-02   +1.437712361952150e-01   +2.350468249637940e-01   +3.399992437036813e-02];
L2I_L1I_iGABA_netcon = [+1.979842250247170e-01   -1.129849472811034e-02   +9.112964162706061e-02   +1.102886786272357e-01   +4.229738006122736e-02   +1.270129326570307e-01   +6.152640290802542e-02   +1.218563137316927e-01; +1.195873611833795e-01   -3.738716583273365e-02   +6.924934762708239e-02   +7.597109989927714e-02   +5.965427525330362e-02   -4.834611333040349e-02   +1.345544719443066e-01   +7.446301846263120e-02; +3.763517620509036e-02   +9.054218284052944e-02   +2.764825787873473e-03   -1.442037928294131e-02   +1.353697953919752e-01   +2.268339961389692e-01   +1.895879717796366e-01   +5.232722804373291e-03; -5.152313574943029e-02   +1.329830919546278e-01   +1.248359625738033e-01   +1.842719565270374e-01   -3.029663201951229e-02   +7.259345635304451e-02   +1.156892953371044e-01   +3.913160332208210e-02; -1.517178940066033e-02   +1.671324179971743e-02   +1.144335879823112e-01   -6.499842483582816e-02   +1.342075246341962e-01   +1.117435453403190e-01   +7.682885727337294e-02   +3.910453426544881e-02; +1.025988132033446e-01   +8.131434420745175e-02   +5.671857043887991e-02   +4.057381978904324e-02   +1.238216040661706e-01   +4.702586115741629e-02   +1.214460533694769e-01   +2.540757382916090e-02; +1.561672871816321e-02   -4.423408987451566e-02   +9.122404698105957e-02   -4.165705685515467e-02   -8.453791299680986e-02   +1.301127397229491e-01   +1.200253331680448e-02   +6.923450387926374e-03; +1.144704197450718e-01   +9.590525680175421e-02   +1.573443810440164e-01   +1.468851997313650e-01   +4.200833645227933e-02   -2.241860198377938e-02   +1.514907990016987e-01   +6.410215916583992e-02; -1.546768735947838e-02   +5.437204245078740e-02   +1.116775940064657e-01   +2.501289170922417e-02   +6.670268224059191e-02   +1.389586789754774e-01   +1.376176307055506e-01   +1.600889156498760e-02; -5.266891883926272e-02   +2.108648130916025e-01   +1.312505538265648e-01   -6.758598115263803e-02   +2.132691135461695e-02   +9.815006675085125e-02   +3.526152289810022e-02   +6.829188742838085e-02; +1.121381223550060e-02   +1.422188619319145e-01   +1.165747588649410e-01   -2.188856631344166e-02   +1.180203659150295e-01   +2.089334606159460e-02   +5.966597193344379e-02   +8.831200358105037e-02; +1.321822726766539e-01   +9.806282300195365e-02   +1.243452610545749e-02   -9.874125045746444e-02   +7.665853347877991e-02   +7.336476622524796e-02   +1.763445306263584e-01   +2.300589607272624e-02; +1.067528669930432e-01   +8.402477278167415e-02   -2.588437618794753e-02   +9.302308271262393e-02   +9.212182817439019e-02   +1.159992584725969e-01   +1.869105559757439e-02   -2.647921348309147e-02; +1.360669595083655e-01   +1.393159257552957e-01   -3.399760220443471e-03   +1.276487529239345e-01   +5.660100689224825e-02   +2.030416138092493e-03   +2.328885159392844e-01   +6.124846761633243e-02; +5.955349482784747e-02   +7.119903607290318e-02   +2.220241687248272e-01   +1.743352645396445e-01   +1.605073665032116e-01   +5.618195789499057e-02   +4.652982316067918e-02   +6.248806827014847e-02; +4.523517778239579e-02   +1.885883915972367e-01   +6.151338086957991e-02   +1.169532146957735e-01   +5.151076135362348e-02   +1.688095440146520e-01   +1.161792070185087e-01   +6.273016449730362e-02];
L1I_L2I_iGABA_netcon = [+1.325175319114172e-01   -2.033713010262443e-02   +2.014756282534429e-01   +4.574064155004756e-02   +7.030327457058222e-02   -8.733262566360527e-03   +1.856844701354149e-02   +5.701834217157901e-02   +9.879397680792570e-02   +4.059630482635115e-02   +2.408975540849468e-02   +6.147553282624325e-02   +4.803595215289135e-02   +1.358332889054009e-01   +1.881515854379972e-01   +2.512882105027042e-02; +1.839422138792401e-04   +1.631155454207087e-01   +5.336918735466117e-02   -2.378135242246615e-02   +2.013414232850610e-02   +9.567701627865247e-03   +1.706842643284552e-01   +1.177023057767830e-01   -5.214093823539600e-02   -2.314872265860245e-02   +4.404682627942528e-02   +9.039614789768879e-02   +1.735297262901663e-01   +1.553357085817512e-01   -3.715624692096981e-02   +7.130027836718900e-02; +5.911326944872426e-02   +1.081322721637016e-01   -2.304727142060520e-02   +2.019433334723362e-01   +3.139168051439335e-02   +9.743676154408591e-02   +1.509160871565670e-01   +1.092405530768263e-01   +2.047997788365746e-01   +7.344778298084273e-02   +2.496262408123839e-02   +7.309852786632574e-02   +9.101924138839823e-02   +1.184618139048242e-01   +4.822348998505167e-02   +1.528406368024293e-01; +1.143983448614381e-01   +1.964112531721148e-02   +1.284874126964621e-01   +6.911785673202617e-02   +3.676423749976108e-02   +1.663092179840139e-01   +8.935166889606182e-02   +9.192982289810964e-02   +1.111223431224539e-01   +1.868472314059588e-02   +2.266349588628316e-01   +9.661789794483301e-02   +5.158695409751074e-02   +1.314875793525952e-01   +4.381192338948457e-02   -1.079847774774321e-02; +9.425169124542954e-02   +5.066355819373464e-02   +5.383575660148891e-02   +1.052850826346381e-01   +6.632552050465418e-02   +1.310528777872183e-01   +7.783985168795313e-02   +7.043354433582945e-02   +1.089957968406827e-01   +1.466285507972131e-01   +3.159669999710585e-02   +2.696152952382225e-02   +1.788238260016205e-01   +4.127914651321878e-02   +1.068347710130368e-01   -2.533746910904169e-02; +8.739414386741906e-02   +7.391748708731062e-02   +4.160297065221287e-03   +1.493720348986577e-01   +3.101739790418711e-02   +2.577383039487525e-03   +6.426088963237540e-02   +3.687996172514393e-02   +1.121294754973900e-01   +1.476659351889112e-01   +7.814003588535545e-02   +1.404645603940150e-01   +8.078229152739116e-02   +5.534805618460307e-02   +2.226217729515302e-02   +1.553933749650203e-01; +1.441451768952578e-01   +1.769528924253761e-01   +1.798445838011680e-01   +1.267131822894195e-01   +1.778358931900167e-01   +1.729690435025708e-01   +2.226977133396946e-02   +1.190431474637482e-01   +8.986745741401292e-02   +1.410270884787108e-01   -6.842441477957817e-03   +1.764672764587693e-02   -9.533797008598946e-02   +8.015430113448159e-02   +1.516332448998883e-01   +1.505671187562294e-02; +1.904893717886416e-01   -7.256648114650200e-03   +1.844926611261517e-01   -9.686699383539230e-02   +5.888989166384441e-02   +1.284668162120109e-01   +6.370633383196421e-02   +1.409693190370144e-01   +6.034264027924962e-03   +1.554405517597046e-01   +1.232595259230167e-01   +1.906039065252239e-02   +5.782115576026797e-02   +8.115765799493188e-02   -1.638831610700150e-03   -2.943210615604757e-02];
L2E_L1E_iAMPA_netcon = [-2.262027748177633e-02   +1.946791577237190e-02   +1.824854586288986e-01   +4.564216171354454e-02   +6.756299602567579e-02   +9.338883164816728e-02   +9.696229537228133e-02   +2.192647455902509e-01; +5.569824923322387e-02   +4.035064910742397e-02   +8.625571885762567e-02   +2.010263782359618e-01   +1.813027313042228e-01   +1.472212777058642e-02   +8.554977356904898e-02   +2.942548499662939e-02; +1.713860219965695e-01   -1.555355414988429e-02   +1.138903828330809e-02   +1.092786683896358e-01   +8.282922337240808e-02   +1.582197580055277e-01   +7.235995712354781e-02   +1.293612695977714e-02; +4.613909523600668e-02   +8.117568364187212e-02   -2.765088630827360e-02   +6.488785886965992e-02   +1.856393817875716e-02   +5.322698688815489e-02   +5.851182330623442e-02   +1.094460179574839e-01; -6.116937088814836e-02   -9.731248078218951e-02   -1.386900615889468e-03   +1.404504451478352e-01   +2.121578165711772e-02   +1.300825091005236e-01   +5.454446331723518e-02   -3.336619397504098e-03; -2.954972308066569e-02   +8.274909980797578e-02   +6.059367487293930e-02   +1.520838016935105e-01   +2.755356113897585e-01   +1.142180917777770e-01   +1.004903576727405e-01   +1.937721432652394e-01; +1.901783541016387e-01   +6.089268812844013e-02   +5.511782474907077e-02   +1.406970985337356e-01   +1.471420858088522e-01   +9.467811106004784e-02   +2.241977295839771e-02   +8.409530730376535e-02; +4.941958131274733e-02   +6.692036895573548e-02   +1.562230470202177e-02   +2.149762612333260e-01   -1.154212293367999e-02   +1.161512042017337e-01   +7.537486170179686e-02   +2.012226614395233e-01; +1.628500848222104e-02   +2.240207111366936e-02   +9.825564307600276e-02   +2.468044389487186e-01   +9.793373658005802e-02   +6.108120275296519e-02   +9.184286501652940e-02   +1.388741011387608e-01; +6.055027234627812e-02   +1.494947692148945e-01   +1.278100476854828e-01   +1.254819056628904e-01   -2.133393494288342e-02   +5.928892277448111e-03   +5.219501907626262e-02   +8.424166070526130e-02; +6.778648747932700e-02   +1.954964300768788e-02   +4.577955955897058e-02   +5.817199236784931e-02   +1.226371344905957e-01   -7.454328543639552e-02   +1.435705938012274e-01   +1.509949886804684e-02; +6.616618824493213e-02   +3.223008949293371e-02   +1.392380452748415e-01   +1.103282215165946e-01   +8.409704456059729e-02   +1.044755711140766e-01   +5.510618448030105e-02   -2.010451820660729e-02; -7.570951514242613e-04   +1.000698658451708e-01   +1.771349942827321e-01   +1.152827670830589e-01   +7.469288397477998e-02   +1.361538295420021e-02   +7.938427359071995e-02   +1.551240160972764e-01; +1.501065255557352e-01   +1.146254505690004e-01   +1.838436348548110e-01   +4.694097148357110e-02   +6.724866101735491e-02   +1.130099264752595e-01   +5.740771586982307e-02   +1.536276048138893e-01; +7.835229539562130e-02   +7.963491044271988e-02   +8.178108186234026e-02   +2.176990694162578e-01   +5.211999603331736e-02   +6.610290431000011e-02   +9.284159752434050e-02   +1.114694914615859e-01; +1.618024183704175e-01   +2.148661201256043e-01   +2.530967373130012e-02   +8.071807107277557e-02   +1.830402351732255e-01   +1.985589480640421e-01   +8.820008861808779e-02   +1.143034728443386e-01];
L1E_L2E_iAMPA_netcon = [+4.928945072925026e-02   -1.345995590747487e-02   +2.463153861576578e-02   -1.562999725063281e-02   +9.747568012775271e-02   +6.642678674789586e-02   +1.561320988816455e-02   +1.653007045751136e-01   +2.059807542927710e-01   +5.798108364642462e-02   +1.706325156930404e-01   +5.849911283576478e-02   +2.832084830569523e-02   +2.921760745277735e-02   +3.058916414830854e-02   +6.876989213858245e-02; +1.569785293858795e-01   +1.079445287810050e-01   +6.387857021536514e-02   +2.857343515326349e-02   -4.488211771771188e-03   +4.711077999968455e-02   +1.759289032618259e-02   +1.507169586610064e-01   +1.777434743193875e-01   +1.100502547085310e-01   -6.696259826127332e-02   +7.786119188412842e-02   +4.747767730310667e-02   +8.075409918471457e-02   -6.415475768654194e-02   +8.159529358880555e-02; +1.742908732964116e-01   +1.468989524350313e-01   +1.394629050082565e-01   +5.076968515785849e-02   -1.060395829373444e-02   -1.155959057403442e-02   -2.384278552212664e-02   +8.796213922733886e-02   +2.767069990572767e-02   +1.077078516426613e-01   +3.554874877743355e-02   +1.494582109993190e-01   -4.777126248532173e-02   +1.799894042712517e-01   +9.976712470701202e-02   +2.465245116016099e-01; +4.095600146065422e-02   +9.742700852170376e-02   +3.598834936124127e-02   -4.326663228958402e-02   +1.102876702698568e-01   -3.277857740619092e-03   +1.315897963021149e-01   +3.636571333116123e-02   +1.463989951353650e-01   +1.559013810059542e-01   +2.191555506570197e-01   +9.130642248133865e-02   +2.565973917719751e-02   +1.465226478721252e-01   +1.236798586847633e-01   +1.190305825065952e-02; +1.023971494922108e-02   +3.898359690122113e-02   +1.833726584340785e-01   -4.639844657253277e-03   +8.300390158716761e-02   +1.961758012689279e-01   -1.667852288795847e-02   +1.758465262541653e-01   +1.461876318451746e-01   +2.359343142570712e-02   +5.833680933194892e-02   +1.444242683902343e-01   +2.085783459110950e-01   +1.685425834891005e-01   -2.568228945573028e-03   -5.794356296204173e-03; +8.066271384764420e-02   +1.308062860767598e-01   +5.838348319849002e-02   +1.408388792221214e-01   +1.419091837644798e-01   -1.221141397689891e-02   +1.332032557225584e-01   +1.472392923875079e-02   +1.409713275083269e-01   +1.013015350162686e-01   +1.210479063399235e-01   +6.640578350976402e-02   +2.959626696293915e-02   +1.132992503711044e-01   +7.404693686483763e-02   +3.304314657036323e-02; +1.206898582402053e-01   +1.672344244491405e-01   +6.635160569491905e-02   +9.288613113728343e-02   +1.898941408870357e-01   +1.180598807891106e-01   +7.780714392552221e-03   +1.118904575889376e-01   -6.605263551781675e-02   +1.753229675495582e-01   +5.971600774413305e-03   +1.799356270110493e-01   -4.071789294493499e-02   -6.557795469080890e-03   +1.344054151925840e-01   +1.130555954252052e-01; +4.249156438099485e-02   -3.379715986698149e-02   +1.153172579628570e-01   +6.142506668541948e-02   -1.137033166160777e-02   -4.785520104591748e-02   -5.809099619453422e-02   -1.967708638108338e-02   +1.579369608924156e-01   +1.346779912090280e-01   +6.959591345931646e-03   +8.091420406973349e-02   +1.348590940653402e-02   +1.708701439395943e-01   -3.893881266207858e-02   +7.689973698034719e-02];
L2I_L2E_iAMPA_netcon = [+4.458016070525692e-02   +1.779763081581502e-01   -1.479629180947974e-02   +1.375959027239557e-01   -2.131788890158053e-02   +1.403217450185492e-02   -1.984399799295457e-02   +7.538357074410261e-02; -4.183206567712650e-02   +1.973759136428176e-01   +3.396326900434860e-03   +1.564948741663967e-01   +5.278983679932312e-02   +7.916273642331038e-02   +9.827814264960222e-02   +9.919051039832617e-02; +3.324608284057096e-02   -3.276127457450797e-02   +1.958869533520579e-01   +2.097683131615062e-02   +5.141364148855666e-02   +1.219894644107925e-01   +9.879763487175455e-02   +1.609584887062724e-01; +8.941377281934476e-02   +1.173545049412148e-02   +1.436590814643806e-01   +4.092245152394462e-02   +2.193167346574551e-02   +9.528016508527951e-02   -1.867889563306197e-02   +7.191875475422510e-02; +1.949654793506495e-01   +1.703546541157272e-01   +5.713595240163467e-02   +1.169773267172047e-01   -9.946540368083540e-03   +1.321951433809326e-01   +5.072974311898669e-02   +4.122153980204729e-02; +1.033158049352853e-01   +5.550189622794777e-02   +4.940947572791043e-02   +7.269893826205510e-03   -1.508267897065647e-02   +7.699124130056413e-03   +3.055222057460084e-02   +3.629256494664544e-02; +1.076810554905802e-01   +8.159331687176556e-02   -2.493790038303599e-03   +2.790557669299012e-02   +2.149463650371424e-01   +6.543905897484867e-02   +1.712696033539625e-01   +1.631219110816917e-01; +3.908964960384571e-02   +1.520750009667844e-01   -9.669022940696753e-02   -5.781314122227585e-03   +1.369068989057902e-01   +6.630405370316902e-02   +2.199582024375333e-01   +1.068667670807315e-01];
L2E_L2I_iGABA_netcon = [+1.159986263629715e-01   +1.241998626928182e-02   +1.116014458996915e-01   +2.269548576007814e-01   -1.152397991166804e-02   +1.308713206253512e-01   +2.072125179494069e-01   -4.968739614082171e-02; -6.834669898503014e-02   -7.078095706646220e-03   +1.322972174667081e-01   -2.317044073492459e-03   +5.819043395091451e-02   +9.033680822799992e-02   +2.701416145962666e-01   +1.453284902002303e-01; +1.139472664080552e-01   +1.943825228017607e-02   +8.936902246758108e-02   +8.522808215958708e-02   +1.766747643965219e-01   +1.126168814417958e-02   +4.636399545189665e-02   -1.265487653226444e-02; +1.278555717313543e-01   +2.035614504653743e-01   -6.714845089821624e-02   -5.965220011794407e-02   +2.897178449204201e-02   +1.027098520658067e-01   +1.469188015893534e-01   +4.566103691050532e-02; +1.134410269743469e-01   -2.865832427511157e-03   +1.373658220439458e-01   -3.323810563335225e-02   +7.957386729123539e-02   +1.297419117626210e-01   +1.266491270096950e-01   +7.547390994866922e-02; +1.582733331858969e-01   +1.158663816442363e-01   +1.053388840870145e-01   +2.342176999304894e-02   +1.559511141025081e-01   +8.712587763236423e-02   +1.145043006726208e-01   +1.039995709805886e-01; -1.455352945862496e-02   +1.155185427293874e-01   +1.571132846878594e-01   +4.161657051936275e-02   +1.638390051079535e-01   +6.489760530474303e-02   -5.455311823535597e-02   +3.377164649398814e-02; +8.126763853925267e-02   +8.897629409959627e-02   +2.202643796161033e-01   +1.176385538295514e-01   +1.849495441577188e-01   +1.325512519008946e-01   +1.404306276622031e-01   +1.747525359724354e-03];
L3E_L2E_iAMPA_netcon = [+1.440725596897469e-01   +2.345116362982903e-02   +1.995775195504195e-02   +6.528962769743227e-02   +1.592403048125375e-01   +1.726861170842088e-01   +4.180533608445131e-02   +1.937572126470902e-01   +5.396703099657840e-03   +1.317731751380432e-01   +2.353610289958156e-01   +1.751825271756715e-01; +8.689071432538911e-02   +2.094431355184303e-01   +1.177660903753527e-01   +1.429435790806996e-01   +4.739792044235636e-02   +4.606765293879863e-03   +1.211973138049068e-01   +8.326623860944088e-02   +3.853713725005888e-02   +8.775531300579280e-03   -4.575475859611013e-02   +6.005703497717511e-03; +2.850284986911150e-01   +1.121093326053449e-01   +1.338739870512009e-01   +1.509222400745489e-01   +1.263735498683987e-01   +3.045595314557072e-02   +1.856833988645370e-01   +3.393256785474625e-02   +1.122343329461777e-01   +1.146314403441177e-01   +1.545196344463809e-01   +5.008490167495367e-02; +3.902140932085231e-02   +8.067473391705841e-02   -4.392470944586355e-02   +5.149675709309476e-02   +1.050440922646680e-01   +1.000060629952139e-01   +1.911410084854441e-01   +6.610129860981530e-02   +1.475656877460202e-01   +5.350106478426538e-03   -1.555868811186090e-02   +5.728219518915986e-02; +1.446535363674952e-01   +7.084955074147879e-02   +7.431768815667694e-02   +4.500604321028653e-02   +7.632827580621820e-02   +1.060365276491746e-01   +2.424184872578765e-01   +8.701344725028818e-03   +2.803010816919487e-02   +1.333250903530672e-04   +1.879578186721294e-01   +8.736647606416503e-02; +9.248567139538690e-02   +1.152498243522383e-01   +1.666113607193377e-01   +2.774814751289056e-02   -9.900734081522053e-02   +1.107804007049087e-01   +8.837509453509711e-02   +1.867629401457886e-01   +1.213104137691117e-01   -1.751546245104142e-03   +1.467032131060707e-01   +9.448851213535309e-02; +1.743617157285329e-01   +6.204465041822078e-02   +8.188644936998009e-02   +1.510813553123320e-01   -2.106328345365332e-02   -2.594089259019734e-02   +2.348155248407421e-01   +1.726438119007960e-02   +8.879781242969589e-02   +1.137180906818362e-01   +5.948650320737049e-02   +2.843320215182240e-02; +1.416152070046394e-01   +1.232900087587664e-01   +1.437620484927143e-01   +1.712539422591709e-02   +1.419938952469189e-01   +3.562600349116650e-02   +2.307131606522392e-01   +7.277044353778722e-02   +6.873192166874614e-02   +4.416113268186823e-02   +1.792009440156507e-01   +5.130667880986449e-02];
L3I_L2I_iGABA_netcon = [+1.165544528357599e-01   +1.350092432373163e-01   +1.631696500103210e-01   +9.786689651880752e-03   +9.855940334736664e-02   +1.260650227771132e-01   +1.429538921817960e-01   +1.292094542340461e-01   -2.944449429356522e-02   +6.105244642719346e-02   +1.156649742531319e-01   +1.442414214564100e-01; +1.776705690156249e-02   +8.672498979571583e-02   +1.001483866377230e-01   +1.334018384448156e-01   +1.383214427757466e-01   +2.321061616854114e-01   +1.296329801475529e-01   +2.198408230476036e-01   +2.470786177386792e-02   +8.355584243624378e-02   +1.192286689449448e-02   +7.852754439079701e-02; +1.133524002785290e-01   +1.254818620401364e-01   +1.059146281105231e-01   +1.755774270815124e-01   +1.420710364215307e-01   +4.766629697460019e-02   +1.360992609497800e-01   -2.172815923090408e-02   +2.640615859901509e-01   +5.357605554587706e-02   +5.361161595336724e-03   +8.970587622631941e-03; +6.741927269792405e-02   +8.596938881626610e-02   +7.181523641793314e-02   +4.453291187053095e-02   +1.528482143191043e-01   +1.972657208627105e-02   -5.579104829925781e-02   +1.906331607333568e-02   +1.986996153812337e-01   +2.110410210808975e-01   +6.627764213242586e-02   +9.044013668575507e-02; +6.807824559681427e-02   +4.546492433506967e-02   +1.216341535616330e-01   -3.223519446781230e-02   +3.733170653407582e-02   +4.921075036653672e-02   +2.643788779934250e-02   -1.132216614868048e-02   +8.560314710940534e-02   +2.108452392914906e-03   +1.893212109201974e-01   +5.167728233204567e-02; +1.387548062487918e-01   +3.215156425979211e-02   +1.046115920138726e-01   -2.494685614694372e-02   +7.751693631733987e-02   +1.224291307931531e-01   +2.297864513663336e-01   +1.105911664089123e-01   +1.311357239570775e-01   +4.720635147818689e-02   +4.851150849618387e-02   +1.024356700650371e-01; +7.353136006234723e-02   +1.162592934900138e-01   +1.651433614615957e-02   +5.025541370479922e-02   +1.576041208434352e-01   +1.956218011106070e-01   +7.866279104031951e-02   +5.572856612480161e-02   +1.427186605310732e-01   +5.626930793584314e-02   -5.061905740692256e-03   +6.136822024314727e-02; +1.385968447242172e-01   +1.608213292923830e-01   +1.466371801989499e-01   +5.774809669668736e-02   +8.685423993097537e-02   +7.075461731523366e-02   +6.466230382343663e-02   +1.365658429729380e-01   +2.562079748263444e-02   +6.827376290760481e-02   -3.599840646012478e-02   -5.170076093200621e-03];
L2E_L3E_iAMPA_netcon = [+1.375109477538651e-01   +9.136760414441847e-02   +1.687185307404815e-01   +7.083002616779928e-02   +1.058904919912055e-01   +8.976189030989837e-02   +9.170963792183949e-02   +2.159194947707240e-01; +1.858687494361984e-01   +6.681069278481108e-02   +7.849090656561990e-02   +4.513256288754795e-02   -8.195023798740181e-02   +1.489387488570067e-01   +1.619720557520853e-01   +1.011250346322226e-01; -4.730199557475209e-04   +2.383927388443193e-02   -5.482063240940442e-03   +1.456494095671124e-01   +1.801211011379679e-01   +2.847465116840295e-02   +1.514862765691861e-01   +1.235779924626328e-01; +6.892585535186890e-02   +3.203333634797685e-02   -7.975240855914445e-04   +1.020782476567172e-01   +7.747003244813415e-03   +1.510166684123625e-01   +9.792316945845964e-02   +8.781270713349926e-02; +1.291596950024928e-01   +1.679610215922452e-01   +3.845912824968406e-02   +1.702713116482200e-01   +3.066262580758133e-02   +3.512370886567985e-02   -1.099222356642693e-02   +1.191825887496780e-01; +5.791536839330920e-02   -9.400517119773900e-03   +9.441279982855932e-02   +8.405191901810022e-02   +3.991195341044944e-02   +7.470557460609559e-02   +1.446291837641065e-01   +1.360083343033004e-01; +7.633073999753341e-02   +7.207904120706464e-02   +7.388834570739039e-02   +1.443618777845673e-01   +8.177626951083306e-02   +1.700970887922249e-02   +4.976066556778070e-02   +1.666510838984281e-01; +1.547928703836126e-01   +8.549360500073158e-02   +8.249483458504843e-02   +1.704111540376758e-01   +6.095420274890909e-02   +1.372367319850433e-01   +1.351641625431825e-01   +6.739486072544962e-02; +7.747227207342886e-02   +4.805918176365202e-02   +1.040355684484964e-01   +1.557792152465046e-01   +9.852146890832779e-02   +4.355497741481579e-02   +4.154066491900622e-02   +1.391961065644815e-01; +4.736843145600356e-02   +1.192277781016947e-01   -4.369606470447182e-02   +3.014304682798133e-02   +2.950480010179615e-02   +6.537794297326378e-02   +1.615116491680150e-01   +1.487422869653059e-01; +7.646023742388573e-02   +3.270190186308462e-02   +9.907775961752757e-02   +6.050523531581660e-02   +1.456146429745354e-01   +5.115211755560470e-02   +1.527745270602766e-01   +1.107496297614880e-01; +1.324649308433972e-01   +8.714817400560596e-02   -3.426716827535473e-02   +1.254316717283772e-01   +1.489369716712170e-01   +1.880418659743696e-02   +5.615676744237377e-02   +1.052532980488879e-01];
L2I_L3I_iGABA_netcon = [+1.283877758942149e-01   +1.473003896987295e-01   -3.046352728087328e-02   +1.273732924037927e-01   +2.124560103753886e-01   +1.633473400483818e-01   +1.451006634290016e-01   +1.492929647685675e-01; +1.517903767591267e-01   +6.759141587021829e-02   +1.458034615271160e-01   +3.225239137624924e-02   +1.070652405929047e-01   -2.531392403301585e-03   +3.570298673039132e-02   +1.797391225807561e-01; +1.494571477830974e-01   +8.589324178490235e-02   +1.001294278492968e-01   +1.008648659693751e-01   -2.574450385856968e-02   +2.863571300573498e-02   +1.257628228490907e-01   +1.737403768263665e-01; +1.320066713178707e-01   +6.389748046966673e-02   +3.055428459293865e-02   +3.534945254869017e-02   +1.772131731927719e-02   +5.788611889213751e-02   -3.551986689874549e-02   +8.496666356962237e-02; +6.861067633453929e-02   +1.601177659912016e-01   +7.464040798324127e-02   -7.711758647429026e-03   +4.758294496065175e-02   +9.192224306586261e-02   +1.159970721879996e-01   +1.736188806187714e-01; -5.234309131253671e-02   +1.501060724944214e-01   +1.562914252843761e-01   +1.695454835602923e-01   -1.350042762809255e-02   +6.836982287374398e-02   +1.182140651121718e-01   -5.048860863950728e-02; +1.234193535385257e-01   +9.481949823982433e-02   +1.995163251662088e-01   +5.986814564029530e-02   +4.077637839143931e-02   +1.114645105347377e-01   +1.824287753106552e-01   -4.424108240491506e-02; +4.926823651747276e-02   +7.043319256058628e-02   +1.026287930678974e-01   +1.521951972029469e-01   +2.472143766958404e-02   -2.041907554597065e-03   +7.498146395706513e-02   +1.117629390680071e-01; +9.192307319873749e-02   -1.069716113146550e-02   +4.081133313825821e-02   +2.155881966678249e-01   +1.068034767123243e-01   +1.109200932367259e-01   +8.813263095721176e-03   +1.563486626669042e-02; +9.874319906113135e-03   +9.201961572456294e-02   -4.970784783527828e-03   +1.520801039887146e-01   +1.408416613949496e-01   +1.385807422552502e-01   +9.347022830400145e-02   +1.035318008025038e-01; +1.068205659259492e-01   +1.505639700003057e-01   +6.772977082221451e-02   +1.698121329789427e-01   +4.882802470404969e-02   +2.018052432279180e-01   +2.061678840871855e-02   +2.711614264508807e-01; +5.444325360507202e-02   +4.455752801896104e-02   +1.095653080859042e-01   +1.199911156119618e-01   +5.149207941477212e-02   +8.844147073677584e-02   +5.345505749415462e-02   +7.183365756918599e-02];
L3I_L3E_iAMPA_netcon = [+1.155795714713897e-01   +3.469397910885084e-02   +5.251254785306679e-02   +1.613945902820676e-01   +1.888767907080151e-01   +4.705874947986812e-03   +6.771170659006166e-02   -7.987330572172545e-03   +8.197435408626166e-02   +1.319708606028356e-01   -7.383481362422670e-03   +1.001784186290247e-02; +1.457238595942053e-01   +6.956387540706371e-02   +8.384535686818084e-02   +6.131485018837762e-02   +3.025094908595619e-02   +1.120824264455119e-01   +5.612990911093837e-02   +2.129105294794517e-01   +1.403157684332476e-01   +9.004335001165294e-02   +2.143737624795297e-01   +1.924681030058061e-01; +4.370457135828525e-02   +6.169203863560836e-02   +1.724574543831744e-01   +1.237542056592498e-01   +7.326856388755895e-03   +1.720726178823782e-01   +1.098793813865780e-01   +1.271912038272041e-01   +9.822052499491668e-02   +1.028940366629178e-01   +1.687478981459298e-01   +9.867204142359490e-02; +8.306371895178344e-02   +4.288879385068257e-02   +1.271397687724515e-01   +1.786714699630252e-01   +7.863039526392938e-03   +6.144486153315976e-03   +1.439707843756870e-01   +1.372056206985001e-01   +7.568325604377327e-02   -3.400114318024691e-02   -4.842334597165439e-03   +3.286547530202274e-02; +1.157348414881473e-01   +6.978138340515326e-02   +3.297307408589933e-02   +1.526272062227334e-01   +1.003847831000620e-01   +5.086963468451890e-02   +1.105009592603931e-01   +2.139420811332940e-02   -7.263982618476304e-02   +1.433970911306770e-01   +1.213712029288738e-01   +1.361114662234300e-01; +1.331080070062891e-01   +1.716194575858075e-01   -2.299928994405168e-02   +5.320545745373482e-02   +1.460110898690235e-01   +1.565551254896652e-01   +1.464799567815881e-01   -2.907306477046959e-02   +9.534949296039852e-02   +3.662756472539719e-03   +6.857981838131214e-02   +2.204916482246511e-01; +5.141957049898353e-02   +3.069796633832702e-02   +7.588443909502290e-02   +6.950270414232669e-02   +1.884092455374053e-02   +1.884546950668979e-01   +1.955326589751067e-01   +1.364632381876972e-01   +1.341745269110609e-01   +1.711718466319078e-01   +1.339703955000410e-02   +1.212444653469929e-01; +1.085989545923119e-01   +1.167566073554459e-01   +7.720293430335047e-02   -4.280316389574041e-02   +2.199079546319376e-01   +9.837976464958029e-04   +4.282849722050510e-02   +1.449950934066357e-01   +6.199716660384648e-02   +1.400123245207457e-01   +1.453639723738675e-01   +1.005786000367698e-01; +3.952850655363642e-02   +1.585000323711472e-01   +3.944043817556497e-02   +1.275474903640551e-01   +1.682737954302137e-01   +6.281436526877605e-02   +2.421480148477823e-02   +1.584636884746899e-01   +5.382774270249109e-02   +1.729350085341617e-01   +1.582626369857274e-01   +3.249523256303498e-02; +8.241310193833606e-02   +4.188969380744896e-02   -4.125288143542651e-02   +6.149124227809198e-02   +8.796282849635807e-02   +2.453772269954221e-01   +1.058799253320869e-01   -7.688674064410092e-02   +1.444221514083007e-01   +1.364649593015981e-01   +1.382386526357733e-01   +4.284276380060771e-02; +1.250760221127191e-01   -1.161800720153221e-02   +1.896770935932193e-01   +2.119669602076767e-02   +1.365028169982790e-01   +9.646068616079322e-02   +1.368436441157217e-01   +2.701472235133691e-02   +7.741093183618714e-02   +2.819985730561527e-02   +1.418331871587215e-01   -3.218668596305699e-02; +1.247442566062271e-01   -3.598566007648307e-02   +7.587326480589951e-02   +1.419808820613044e-01   +4.069411562082053e-02   +2.479134495771101e-02   -6.150694822825098e-02   +2.014138248934355e-01   -3.076692513528937e-02   +1.374808614028879e-01   -7.372433384327970e-02   +3.228893500238732e-03];
L3E_L3I_iGABA_netcon = [+1.644546471197688e-01   +1.153945550132449e-01   +7.160651305231513e-02   +8.876789294986032e-02   +1.807727274857278e-01   +1.476771601372369e-01   +2.659064371993430e-02   +1.101962468774438e-01   +2.394509229335338e-01   +1.121015959756258e-01   +1.437029378194403e-01   +8.347047522436778e-02; +1.587486203102420e-01   +1.167751096072980e-01   +1.348996886206366e-01   +5.601412087105238e-02   -1.384875896813619e-02   +2.346074759501004e-01   -1.381850189246695e-02   +1.330292288405457e-01   +9.662234018587491e-02   +1.362560177518326e-01   +1.461465059696604e-01   +1.565299634380733e-01; +1.082462334929692e-02   +1.164631604914169e-01   +8.417076555011387e-02   -3.926022147384739e-02   +1.497063752010939e-01   +6.622347903964877e-02   -4.243505873029550e-02   +3.443034490561829e-02   +1.777323458881498e-01   +9.822025294506796e-02   +1.031389049252009e-01   +1.235459363176726e-02; +1.974381116715945e-02   +8.222971128265055e-02   +7.344595260138459e-02   +8.089608695493088e-02   +2.338702655223374e-01   +4.763083452691937e-03   +6.019331541084075e-02   +9.334743238818224e-02   +1.492864132418764e-01   +2.255710434664041e-01   +1.068973715195493e-01   +1.361249209502580e-01; +1.381365729373485e-01   +1.055519877551791e-01   +1.721134140452405e-01   +1.350295939745049e-01   +1.600463261674374e-01   +3.025044972812862e-02   +1.136167124228613e-01   +3.309809115649187e-02   +1.414780110342902e-01   +1.392229411857363e-01   +1.171524288993752e-02   +8.536871962434089e-02; +4.865976407811244e-02   +2.502318183648811e-01   +9.991109074393578e-02   +1.771595098075756e-02   +1.432928162194662e-01   +5.995287781931749e-02   +9.836506960452399e-02   +6.249167740278933e-02   +2.572844099515552e-02   +4.066434579891907e-02   +1.165394387009711e-01   +1.784894581141045e-01; +8.168080261752163e-02   +2.631927636687240e-02   +3.965774057102595e-02   +3.157007687622563e-02   +4.859407730402058e-02   +1.716347310719664e-01   +4.870012193833188e-02   +1.311730394687181e-01   +1.880043829449042e-01   +8.020454928257396e-02   -3.463603048562190e-02   +8.912381657029738e-03; -8.872529713652803e-02   +1.272709514127252e-01   +1.610906854662069e-01   +1.333828661719590e-01   -2.903176915225205e-02   +1.050126427471484e-01   +1.531962903076192e-01   +1.222235556222209e-01   -5.873716279521914e-03   +5.542248964564035e-02   +1.298519022405621e-01   +8.284991022706170e-02; -7.745877854636065e-03   +7.870226304379416e-02   +1.393533858658773e-01   -5.098973951673372e-02   +5.345524863948153e-02   +1.332934846808800e-01   +2.223745228602146e-01   +1.331541496807798e-02   -1.034226094296615e-01   +1.225396099212033e-01   +9.419859047968115e-02   +2.629754300515208e-03; +1.070458544803585e-01   +2.157178461368865e-02   +1.077050770063368e-01   +1.499125695185730e-01   +1.321679627357368e-01   +8.757129848124959e-02   +1.051678370557465e-01   +1.384823671792497e-01   -7.998757828884075e-03   +2.254597070262931e-02   +1.066528382782506e-01   +5.256402477773558e-02; +1.634231188251180e-01   +6.852975379935519e-02   -1.847786329033362e-02   +5.134946255716712e-02   +6.529706100627292e-02   +6.709198630339372e-02   +1.193120824903832e-01   +7.409086065031761e-02   +1.176432933205068e-01   +4.295848884019278e-02   +2.423923640725062e-02   -3.545366572986056e-02; +7.063580652317981e-02   +7.430321852816930e-02   +2.419756177975370e-02   +1.858167565149489e-01   +1.084907035037353e-01   -2.338101677373292e-03   +7.531577036791393e-02   +1.394490377949829e-01   +1.301253424822134e-01   +2.558032134220721e-02   +1.359866821906930e-01   +1.349431057168017e-02];
L2E_Input1_iAMPA_netcon = [+1.118364926014565e-01   -1.158649467926304e-02   -7.645371735539383e-02   +1.719817998901128e-01   +4.888963268669316e-02   +9.221660890919599e-02   +1.304183094333611e-02   +1.134333134126665e-01];
L2I_Input2_iAMPA_netcon = [+4.528198690172276e-02   +4.728943901541514e-02   -4.410841566440644e-02   -8.829521538159937e-03   -3.957396944393923e-02   +4.200337030221073e-02   +9.402898047780350e-02   -6.995649532545095e-03];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.3*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))*0.9 + 0.6*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.3*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))*1.0 + 0.8*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.3*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))*1.0 + 0.8*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.3*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))*0.9 + 0.6*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.3*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))*1.0 + 0.8*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.3*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))*1.0 + 0.8*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
