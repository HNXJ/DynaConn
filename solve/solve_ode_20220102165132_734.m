function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+5.620008469570877e-03   +1.190442131321691e-01   +2.105624675537354e-01   +1.625565505148926e-01   +1.412596659042119e-01   +2.251874820679467e-01   +1.152427265584470e-01   +4.656069957220912e-02   +4.545214863533122e-02   +1.032023773221562e-01   +1.355733923566977e-01   +4.943914187597992e-02   +9.423138159621185e-02   +1.536535981267466e-01   +1.014279151742305e-01   +1.893193920374142e-02; +8.912839517767195e-02   +3.920644125897310e-04   +1.226390461280714e-01   +1.455582335124282e-01   +6.497536103237021e-02   +7.386141122102287e-02   +2.110723381568117e-01   +2.261428060892297e-01   +1.565409303029251e-01   +4.655659760595580e-02   +2.331535688678925e-01   +4.877806061164820e-02   +4.863496753966715e-02   +2.034370603855661e-03   +1.264561202897559e-01   +6.060875672611078e-03; +1.545186484482275e-01   +1.623669807807287e-01   +1.964162255112139e-01   +1.067648676705824e-01   +2.431360199263267e-02   +1.967788131315467e-01   +2.026649392534684e-01   +1.003648288265446e-01   +1.074751398710747e-01   +9.404479722338355e-02   +1.075452163787261e-01   +3.668690597733458e-02   +1.605547728851238e-02   +3.284385037257993e-02   +1.902567401378281e-01   +1.373726028590322e-01; -1.554198541761660e-03   +9.429103334435248e-03   +1.056529021191231e-01   +1.452974963154625e-01   +4.946383024234428e-02   +1.829218305512884e-01   +1.054814330587186e-01   +2.212162912512893e-01   +1.106233648719540e-01   +6.732604276298652e-02   +2.028328899831315e-01   +2.040249083126293e-01   +2.749953068659776e-02   +2.123986112354833e-01   +5.206984247689812e-02   +6.754006739140170e-02; +1.088973345162957e-01   +1.491245240132645e-01   +1.423742605179722e-01   +1.656727792649788e-01   +8.712456839634426e-02   +1.910604053257306e-01   +1.127257378631235e-01   +6.248026327322379e-02   +1.281427205969377e-01   +1.963712812648740e-01   +8.524955910528681e-02   +1.588501260902247e-01   +5.712184267478949e-02   +7.621047492843010e-02   +2.068699334575790e-01   +3.493671788400364e-02; +1.127825375053199e-01   +3.386462158781967e-02   +1.930691284938219e-01   +4.109353600739964e-02   +1.451273969209531e-01   +7.254119382848757e-02   +1.024592829066657e-01   +4.418761292546759e-02   +1.088932744690113e-01   +1.092887586745800e-01   +1.678896282386250e-01   +5.708293903449511e-02   +1.089979063353397e-01   +1.249423638928785e-01   +1.059104426221265e-01   +1.691149742162107e-01; +7.413189395458313e-02   +1.527401357847053e-01   +2.119131736299495e-01   +1.483403201060227e-01   +9.035360456412450e-02   +1.369731826196968e-01   +8.746465777284806e-02   +1.884746716721275e-01   +2.217812465050183e-01   +8.771861817319904e-02   +3.474519316959915e-02   +4.158278936096338e-02   +1.007603324672164e-01   +2.214986382850765e-01   +9.670719300443779e-03   +5.568434815936042e-02; +1.332075234576673e-01   +8.265880474222531e-02   +1.752967800659982e-01   +1.407196542317204e-01   +1.376447771562214e-01   +3.360933610924968e-02   +1.302249555945800e-02   +1.043216051980621e-01   +1.776886238775623e-01   +1.543986728953655e-01   +6.470663423747398e-02   +1.740802491492593e-01   +6.681389648368800e-02   +2.628733776084642e-02   +1.621596855536365e-01   +1.389372573437394e-01; +7.002177521249072e-03   +1.511343799461659e-01   +1.561041338821035e-01   +1.572275535290721e-01   +2.110986896017978e-02   +2.052395986534064e-01   +9.997120186389870e-02   +1.032575196103163e-01   +1.116917003576098e-01   +1.125746380356930e-01   +3.833634740952138e-02   +2.054701944869626e-01   +2.278757553959507e-03   +1.750049700439500e-01   +8.508625242735526e-02   +1.169265072907152e-01; +1.625612978864222e-01   +2.958552819368855e-02   +2.018672705620042e-01   +1.872210456751803e-01   +1.417342478388850e-01   +4.110823156379799e-02   +2.421613916265944e-02   +8.374117869558405e-03   +1.707538745789469e-01   +9.148411364802674e-02   +2.470590643070706e-02   +1.293105302181986e-01   +1.902947107975984e-01   +5.822506455343086e-02   +1.986719213441742e-01   +1.463152249467296e-01; +9.171517781795596e-02   +1.142222152939009e-01   +1.153047423636853e-01   +1.820448671709492e-01   +1.986562849967093e-01   +4.409680825047060e-02   +1.465644428166179e-01   +1.302797651724677e-01   +5.490930756514478e-02   +6.349764274141141e-02   +1.674354035678307e-01   +2.160716450174326e-01   +3.054254935406173e-02   +1.605599248276911e-01   +1.757268524112122e-01   +4.459451908040939e-02; +1.185581035300941e-01   +6.554553107823166e-02   +2.545414264534929e-02   +2.134931238382837e-03   +2.195173174761844e-01   +2.070881868975847e-01   +1.329104527220093e-02   +1.595075783952481e-01   +1.588705496856761e-01   +6.889148968995479e-02   +2.692247234703682e-02   +9.718618711377128e-04   +2.118969977138875e-01   +1.864523745753816e-02   +1.253980323457172e-01   +9.489929623595644e-02; +1.477773885143191e-01   +1.681398164544418e-01   +2.019262906513669e-01   +3.440351247966859e-02   +1.505718659999011e-01   +1.634314299642020e-01   +1.598789694359844e-01   +1.484011158491642e-01   +2.073886571319953e-01   +9.938626058837911e-02   +9.554147681221244e-02   +2.010400268200535e-01   +1.888644770974877e-01   +1.652380400883437e-01   +1.052895426836552e-01   +2.062904800079375e-01; +1.969155600165494e-01   +1.503542620114846e-01   +7.130159785313081e-02   +1.397101667683329e-01   +2.566354618790525e-02   +5.710571426026545e-02   +1.382566923126564e-02   +5.538825447843130e-02   +7.737751232594567e-02   +1.632229806906017e-01   +4.454780806887953e-02   +1.849193165273657e-01   +1.284785925014114e-01   +1.434503261428952e-01   +9.379821069828494e-02   +7.300248326422025e-02; +9.667336419128638e-03   +1.237393009253654e-01   +1.942607432064486e-01   +1.198796521497749e-01   +6.412130065870295e-02   +4.270512279061119e-02   +6.547621937826430e-02   +9.244893181561521e-02   +5.313621760660301e-02   +2.264484558282745e-01   +7.807663623251143e-02   +1.256356246370028e-02   +4.391019059672558e-02   +1.682494149727632e-01   +6.564067112849894e-03   +1.558441850166572e-01; +1.795114521452943e-01   +8.662704388403310e-02   +4.395001778962477e-02   +2.176374182106706e-01   +3.007436231401004e-02   +3.434377783614968e-02   +2.013545841865288e-01   +3.507101838423473e-02   +1.366948924809114e-01   +1.764774598282008e-01   +1.521978239926975e-01   +3.383680027647013e-02   +1.724281562682332e-01   +1.795447003855065e-01   +2.130758717667852e-01   +2.015788206020216e-01];
L1E_L1I_iGABA_netcon = [+1.173129107681132e-01   +1.450995813717795e-01   +1.145704138482171e-02   +7.420672196496148e-02   +1.890917192361670e-01   +8.815879573896807e-02   +8.732902496441870e-02   +5.194307849829576e-02   +2.328473240706656e-02   +8.443146777067970e-02   +8.128643271763862e-02   +1.343687501619121e-01   +7.198119932008495e-02   +2.063811641753004e-01   +5.180613524577748e-02   +1.160875612918193e-01; +3.098893623648858e-02   +2.079961408177125e-01   +1.119804239726003e-01   +1.999383205581566e-01   +1.016218830559322e-01   +9.719241616532873e-02   +3.881597286052905e-02   +1.115231905249240e-01   +1.135645622622614e-01   +3.479359010971601e-02   +4.506741372399373e-02   +1.666982722624162e-01   +1.124915501338569e-01   +1.655522161282605e-01   +1.138229698953168e-01   +1.635120447296548e-01; +1.422079405337381e-01   +2.340162019303620e-01   +1.800800209182437e-01   +1.512087132926197e-01   +1.910538444764733e-02   +1.319476747837894e-01   +1.525139847572663e-01   +1.968684794473850e-01   +1.985432352667412e-01   +2.155769928311322e-01   +1.546840936159248e-01   +1.172740798825978e-01   +2.235452308090328e-01   +1.911051677630654e-01   +9.898420807414791e-02   +1.306342319738159e-01; +1.609181699727119e-02   +3.241188225078787e-02   +2.068416855601894e-01   +1.105125456889053e-02   +4.060501602027218e-02   +1.636370818585065e-01   +1.646889993211065e-01   +1.278546218123953e-01   +1.218823632509648e-01   +2.189968637708087e-01   +1.467674919484803e-01   +1.702658825621888e-02   +8.402180105314694e-02   +4.276480063024028e-02   +2.207560229403748e-02   +2.233160674743209e-01; +2.158330046111244e-03   +2.016387856649762e-01   +1.158908131909210e-01   +2.495936349235926e-02   +9.374038200969968e-02   +1.918356818132556e-01   +1.637757230981023e-01   +9.173903765767277e-02   -1.597260475500169e-03   +3.914049856142249e-02   +1.602245193784750e-01   +2.428164571195998e-02   +1.922605695881289e-01   +1.076959833274219e-01   +1.469174693152122e-01   +1.251773085447925e-01; +1.759694041164289e-01   +2.105637053965089e-01   +2.992738018102371e-02   +1.543816642227492e-01   +8.356938337401780e-02   -3.852941080593022e-03   +1.582513607434708e-01   +6.792197064371087e-02   +1.919248612442637e-01   +3.395703612592522e-02   +2.170242723041986e-01   +3.434486184316904e-02   +8.572818095554634e-02   +3.305233433753207e-02   +1.223053712390833e-01   +3.236315333807339e-02; +1.169083659782125e-01   +4.812179512407628e-02   +3.191580885610169e-02   +5.943119905354673e-02   +4.418186653903160e-02   +8.753669604110868e-02   +6.695387770411340e-02   +1.207455537236917e-01   +2.012823372072816e-01   +3.820077578414198e-02   +1.774467721101837e-01   +2.298822041778154e-01   +2.280827921547132e-01   +1.139401493184514e-01   +1.179706937168531e-01   +6.720926053625373e-02; +6.927138488853925e-02   +5.149267646040005e-02   +6.233622492844777e-04   +3.338763913035708e-02   +1.639980440265278e-01   +1.191057452869032e-01   +1.134483443590490e-01   +1.394871757755444e-01   +4.844111462126436e-02   +9.679592069701748e-02   +1.939385527209269e-01   +2.182538554827156e-01   +1.216919125005632e-01   +1.106979410748581e-01   +4.130372830936068e-02   +1.634841779361102e-01; +6.370568876875544e-02   +1.385857927143292e-01   +6.742372719842973e-02   +4.047435902414456e-03   +3.866478593144142e-02   +1.569821562690299e-01   +1.837592485576364e-01   +2.040822161913323e-01   +8.250436738849368e-02   +2.523330293784002e-02   +1.735094080897427e-01   +8.097409214330789e-02   +2.006250170592205e-01   +2.185173191664631e-01   +1.398186786718672e-01   +1.741209115941612e-02; +1.248404314694110e-02   +9.462538838140755e-02   +3.755421143848882e-02   +1.291351400998193e-01   +8.687404608686200e-02   +1.938877492872741e-01   +6.995950320667217e-02   +5.076405277466081e-02   +2.129422271885576e-01   +1.729543613302862e-01   +5.372377910461118e-02   +1.405065240161145e-01   +1.741716408173591e-01   +4.666478376948782e-02   +1.773681077321758e-01   +4.772307084792123e-02; +1.974409413668740e-01   +2.429700746563522e-02   +7.253633235644662e-02   +9.150350815999642e-02   +1.217293591748014e-01   +1.533986349612390e-01   +1.030667146799641e-01   +2.179179399245445e-01   +7.209641265112908e-02   +9.199846944444956e-02   +1.342016840238519e-01   +1.111042970741387e-01   +5.606997128996154e-02   +2.210485197195861e-01   +2.017999469250984e-01   +7.475478541189996e-02; +4.070749848224151e-02   +2.082746396754086e-01   +1.282863123266257e-01   +2.080295404511785e-01   +2.234772767731296e-01   +1.502964741703705e-01   +1.111063391617363e-01   +3.291859776349731e-02   +1.624148280090829e-01   +1.103085289888126e-01   +7.619447699039980e-02   +1.909424929587623e-01   +1.600218349456199e-01   +1.088500412411489e-01   +1.841128714276946e-01   +5.689614403521714e-02; +1.637581829269482e-01   +2.268523672211498e-02   +1.218879805432810e-01   +3.101361768223744e-02   +1.217702012318628e-01   +1.335467799685770e-01   +1.372288792826430e-01   +5.138053262745180e-02   +1.723149668071250e-01   +1.992991958693330e-01   +4.222791341479487e-02   +1.749619746330620e-01   +2.228236901306004e-01   +1.460627731784303e-01   +8.112793279858378e-02   +2.843775148311647e-02; +5.713899055814011e-02   +6.107785553158454e-02   +5.959113163628306e-02   +2.355864114077136e-02   +4.502064641511298e-02   +2.000006773155366e-01   +2.122328142161156e-01   +1.724072145927493e-01   +1.019697224769168e-01   +1.471439512849450e-01   +2.304974384124978e-01   +1.697113161295481e-01   +1.435439788756457e-01   +1.962325992227024e-01   +1.503675658890962e-01   +1.680168809731496e-01; +1.004452708592161e-01   +3.614069368736195e-02   +1.018910896404761e-01   +1.968708902343082e-01   +1.423699643133547e-01   +1.203438505910414e-01   +3.030068208483314e-02   +7.819764410485759e-02   +4.215964246066856e-02   +1.183238144704840e-01   +6.040408607165730e-02   +1.018662878841363e-01   +8.179145881204272e-02   +5.015359014892478e-02   +3.418874429492613e-02   +7.117238679201973e-02; +1.010151390132969e-01   +1.143511368491393e-02   +4.237368764919255e-02   +2.092353373337816e-01   +2.164435619354564e-01   +1.479766048132432e-02   +4.751939698476740e-02   +1.839367769277274e-01   +1.814281272734435e-01   +3.273572134884088e-02   +9.503569287872594e-03   +1.421934612614381e-01   +1.528100581320552e-01   +1.200896201316885e-01   +8.822612307861817e-02   +1.050853461020058e-01];
L2I_L1I_iGABA_netcon = [+2.273379817514340e-01   +1.129298140731019e-01   +6.845337900285517e-02   +1.989397110290335e-01   +2.123240717744398e-01   +2.122970918629493e-01   +7.983558512657740e-02   +1.787378457334739e-01; +1.823691872987127e-01   +1.972635356253476e-01   +1.591087580777029e-01   +6.617124862740691e-02   +9.998990456537743e-02   +1.512141045768958e-01   +2.065466668983694e-01   +5.269047704994720e-02; +5.213203010702974e-02   +5.015478702777311e-02   +6.058730987895645e-02   +1.091490478169334e-02   +1.874868771230994e-01   +2.201640737167482e-01   +2.317799682944121e-02   +1.365148565396979e-01; +9.050671382596351e-02   +1.820560738398717e-01   +1.546592179003345e-01   +1.413722066194622e-01   +1.438813217347947e-01   +1.422059919189342e-01   +1.179538102205459e-01   +1.824854955216580e-01; +7.696096719351711e-02   +4.080049659873068e-02   +1.404698888583392e-01   +1.358024132164172e-01   +1.044554019919106e-01   +1.783709351189632e-01   +1.180198609729988e-01   +1.325545087545739e-01; +1.761074105807705e-01   +1.673106043481645e-01   +2.093313230874231e-01   +9.746675819423453e-02   +6.644657221048650e-02   +1.573153598396146e-01   +1.774017484930441e-03   +1.557360156901831e-01; +2.972193960665312e-02   +8.118259102434991e-02   +8.198862187795218e-02   +5.748956054917527e-02   +1.623122831296154e-01   +6.339234264713614e-02   +4.872695720605051e-02   +1.488014039393462e-01; +1.295408207421891e-01   +8.382947499757501e-02   +1.840025824151499e-01   +9.007213150451551e-02   +6.618876360445901e-02   +1.605033686328841e-01   +1.036583248238868e-01   +7.347484832969174e-02; +9.154155001414245e-02   +1.551419529219399e-01   +4.694347084215423e-02   +5.853327180685182e-02   +7.636277755034285e-02   +3.869689059650040e-02   +9.380323903611469e-02   +2.230754724458907e-01; +1.236039050691171e-01   +1.524487759344135e-01   +5.461397036419733e-02   +1.212869836843731e-01   +7.618625670067097e-03   +1.637899044095954e-01   +2.063958405485250e-01   +1.528670023457330e-01; +1.217996503788595e-01   +1.824742979294858e-01   +1.914650801720918e-01   +8.065141657950106e-02   +1.645576221583277e-01   +2.223731557514307e-01   +4.180521153969094e-02   +6.325284306633309e-02; +1.748852368625253e-01   +1.170966449619921e-01   +1.358712549250573e-01   +9.318791153294737e-02   +2.233555853928196e-01   +5.979325543947957e-02   +1.442413782707587e-01   +7.901875714864331e-02; +7.142188564028386e-02   +2.183462440587385e-01   +2.106850995670733e-01   +4.385609381785294e-02   +1.276758183655697e-01   +7.274102552669406e-02   +7.375069302435885e-02   +1.207153740588723e-01; +1.617255997691196e-01   +5.938409939958209e-02   +2.306687372798245e-01   +1.193093762367361e-01   +1.898903297144380e-01   +4.405534213042371e-02   +2.154574257705630e-01   +5.314706134029942e-02; +2.210498549669915e-01   +4.761558113432629e-02   +6.132066448872958e-02   +2.105280370918184e-01   +1.516500210258971e-01   +2.810352212176206e-02   +9.275346684821362e-02   +1.606499576300333e-01; +4.718449916885340e-02   +1.631913959009255e-01   +1.615518859538487e-01   +1.419213171669885e-01   +1.908708407269191e-01   +2.720942377335236e-02   +2.291278505217908e-01   +6.431845516576964e-02];
L1I_L2I_iGABA_netcon = [+1.345913719510647e-01   +1.564193424614360e-01   +6.734775530032626e-02   +1.785956036226310e-02   +1.188555845793700e-01   +8.490109758134287e-02   +2.249921525814687e-01   +1.584858377222616e-01   +9.451486944634990e-02   +1.785973065671988e-01   +3.253244415443840e-02   +6.898913256926953e-02   +2.392111597725799e-02   -1.867475335645989e-05   +4.403511118283771e-02   +1.830774823302406e-01; +1.813472308503585e-01   +1.358776775466428e-01   +8.978403799937781e-02   +1.085746006739839e-01   +2.122245579419337e-01   +1.043803763487293e-01   +1.527402324009632e-01   +2.185939310905722e-01   +1.003227845872858e-01   +2.222518574954227e-01   +1.523044299002266e-01   +8.344633363897995e-02   +1.116723641316996e-01   +1.507417453238242e-02   +7.326644941288096e-03   +1.996742098661395e-01; +1.964942388629879e-01   +1.326378923006455e-01   +4.627530752089615e-02   +1.908544645167246e-01   +7.380208138732093e-02   +1.973325058643716e-01   +1.728295652233961e-01   +1.511933783002084e-01   +8.748411224410843e-02   +8.034478809330903e-02   +1.569012112844866e-01   +8.917200685076221e-02   +7.451743562033675e-02   +4.162319035432871e-02   +1.370705577954690e-01   +3.137758262257655e-02; +9.156360822825753e-02   +6.852699507996735e-03   +1.335522476583646e-01   +1.956571194601109e-01   +2.041689275061728e-02   +2.976629916959015e-03   +8.362636163992708e-02   +7.681322374128108e-02   +1.440374774798085e-02   +1.483957721119654e-01   +1.287794169487627e-01   +1.091068843823658e-01   +5.434652356283820e-02   +1.273212796614585e-02   +1.790865234385487e-01   +1.217636306290507e-01; +1.737236638996415e-02   +1.902606771132253e-01   +1.847548889401855e-01   +1.512561169126143e-01   +1.390550094374450e-01   +1.156293446868613e-01   +1.401289252412407e-01   +1.932926701856788e-01   +1.356270139266759e-01   +4.782294261632354e-03   +7.453325130807992e-02   +4.647320063761385e-03   +5.605940012797016e-02   +2.054897537063679e-01   +4.801233567061531e-02   +1.109504035981886e-01; +1.442751383713531e-01   +1.631223460217564e-01   +2.940403518688857e-02   +1.999474063498405e-01   +1.326528563771395e-01   +2.216611850647860e-01   +1.658054878215750e-01   +1.875097922938437e-01   +1.268350939937003e-01   +1.338118229071442e-01   +2.312009539621046e-01   +1.881900316523444e-01   +3.455242493556016e-02   +2.087785567924662e-01   +1.642756198635072e-01   +2.086937283729537e-01; +1.764723560233840e-01   +3.029316038618255e-02   +1.965449512970261e-01   +2.258525104817269e-01   +9.028226226606821e-02   +2.229093577916110e-01   +1.214437746732618e-01   +1.095023165127153e-01   +3.003740206479706e-03   +1.328282672909508e-01   +6.816787679943609e-02   +7.793380077191453e-02   +1.777455858972610e-01   +9.486882599742136e-02   +1.881194125717765e-01   +1.326021034433140e-01; +1.674877242529000e-01   +1.890246028648877e-02   +2.070138271070885e-01   +1.651197695602158e-01   +2.131435594654565e-02   +1.790608546208393e-01   +1.359714145928483e-01   +1.758042875881613e-01   +7.975492097070226e-02   +2.029475290048425e-01   +6.319949898903192e-02   +1.133906490537779e-01   +1.154181978654879e-01   +8.018286225693245e-03   +2.064077548518729e-01   -1.556439286120971e-04];
L2E_L1E_iAMPA_netcon = [+1.810519914491854e-01   +6.748797695626509e-02   +2.994288636965322e-02   +2.296059755642902e-01   +2.472382118758642e-03   +1.120120121102309e-01   +1.542924980433910e-01   +2.229028968189523e-02; +2.159960028045526e-01   +1.969597618595021e-01   +1.255218188968917e-01   +8.655688363713243e-02   +1.131301897844922e-01   +4.564603431889405e-02   +2.075843975341292e-01   +9.131745630528926e-02; +2.623035640372148e-02   +2.622129075673062e-02   +7.300476722054863e-02   +3.532452559674183e-02   +1.454122605460156e-01   +1.919849556233732e-01   +7.305386615870080e-02   +7.414525989172040e-02; +6.511718451671467e-02   +1.675206741463211e-01   +4.808161477366571e-02   +1.566800348591214e-01   +1.715355624977274e-01   +7.320777433648119e-02   +2.063558661405636e-01   +1.882658563018978e-01; +4.029529189173097e-02   +2.257530641771943e-01   +3.111250162460322e-02   +8.342485620376875e-03   +2.100605126552287e-01   +2.209742193872431e-01   +1.521935162653819e-01   +1.029224642000242e-01; +1.622392596752127e-01   +1.192958961245770e-01   +2.165009441598109e-01   +1.752362195477755e-01   +1.562604379073207e-01   +5.361131004526568e-02   +1.774613669218578e-01   +1.585408985988996e-01; +2.210091880468497e-02   +7.385948358381084e-02   +6.177437752266412e-02   +1.050009144210274e-01   +2.082699133834439e-01   +1.088671474034196e-01   +4.321382062421394e-02   +7.900202456120392e-02; +1.399460910490424e-02   +3.137014972639897e-02   +1.212310475672598e-01   +1.546788091599127e-01   +8.807367687728013e-02   +2.084850374322879e-01   +2.207009445490882e-01   +2.084148185692924e-01; +8.367597339357741e-02   +2.053622634996546e-01   +1.232912814106366e-02   +5.820004461677569e-02   +3.631956285899583e-02   +2.229423055773977e-01   +1.273584566771754e-01   +1.672694664395974e-02; +6.183014089921415e-02   +6.801959567287505e-02   +1.932804781254202e-01   +9.056004686837998e-02   +1.851463595255706e-01   +2.031865777675498e-02   +3.344845802477758e-02   +2.177169204544947e-01; +1.324489333564235e-01   +1.126206153642910e-01   +4.347255187709267e-02   +1.439567651251456e-01   +9.558785900097505e-02   +9.557474825106715e-02   +1.402113909200256e-01   +2.041230638741529e-01; +5.678422970205278e-02   +1.003214334995947e-01   +1.898042736173041e-01   +1.710662704905167e-01   +1.494221272101997e-01   +4.435354155395943e-02   +2.302800954668795e-01   +5.305844294413136e-02; +1.332849611082767e-01   +1.941427274066077e-01   +5.423413373418624e-02   +1.062180579777223e-02   +2.235654798044334e-01   +1.544664315544633e-01   +1.005231506210017e-01   +1.844010730547619e-01; +9.138363217181544e-02   +1.220494034116820e-02   +2.544041109264893e-02   +1.543170556465374e-01   +2.160946021765787e-02   +6.470090220182488e-02   +1.344857056025693e-02   +1.714268851780631e-01; +6.291859908649507e-02   +4.766834180079300e-02   +1.862522545510067e-02   +1.752491645327940e-01   +2.193025954333801e-02   +1.828913473389343e-02   +9.179061775392774e-02   +4.950858937816112e-02; +3.312465207442158e-02   +1.041168585264793e-01   +2.864518475976851e-02   +1.256100736667924e-01   +5.416517718006050e-02   +1.237751122354749e-01   +2.350974171895709e-02   +1.853007267972285e-01];
L1E_L2E_iAMPA_netcon = [+8.795400665492054e-02   +3.339114803562586e-02   +2.138798999261346e-01   +2.175348563258238e-01   +7.434375906242084e-02   +2.177706317975897e-01   +1.152336209452061e-01   +2.233924580970710e-01   +3.259291324136938e-02   +1.510859926161219e-01   +1.434483129388792e-01   +1.740250244525484e-01   +8.613340096933396e-02   +1.500884680500122e-01   +1.281079750591475e-01   +1.128491688851268e-01; +8.773119449765052e-02   +1.212143522800487e-01   +4.631100655404956e-02   +1.965543498070679e-02   +1.496226732326614e-02   +1.486592830299202e-01   +1.696281197988161e-02   +7.717458504447916e-02   +5.390355898855918e-02   +7.513412974178371e-02   +6.082855559020849e-02   +2.150801448752621e-01   +3.232968869585234e-02   +5.634392099574642e-02   +1.383510575255096e-01   +6.019745542971888e-02; +7.604645028350371e-02   +1.319272517519246e-01   +2.037310170202171e-01   +2.069395137724891e-01   +2.182040264103552e-01   +2.510793054511955e-02   +6.972535583137679e-02   +1.747733091872278e-02   +1.000673509934577e-01   +1.350440996456622e-01   +7.159273995780685e-02   +2.703004848367745e-02   +1.666445354951421e-01   +1.399985035733170e-01   +1.996012291972938e-01   +1.961677858679249e-02; +1.782356493488972e-01   +7.342877100208448e-03   +5.309560440654886e-02   +4.529611113428299e-02   +1.661956085926663e-01   +7.280056926633927e-02   +2.092887499549202e-01   +2.021972216415770e-01   +1.766215668673403e-01   +1.804883016670437e-01   +1.002634913373101e-01   +1.250791204409125e-01   +2.119490628185086e-01   +7.790642772366672e-02   +2.087614969873458e-01   +2.243632513475693e-01; +3.337740470009815e-02   +1.980068662500462e-01   +1.984621776560217e-01   +7.169826809992976e-03   +4.075216511268499e-02   +1.882229116389632e-01   +2.062119010652383e-01   +4.087312915249651e-02   +1.325546732135873e-01   +9.739029742153783e-02   +1.316679407107515e-01   +1.742791661932985e-01   +5.804804118066220e-02   +1.228973942765509e-01   +2.295529821410646e-01   +1.611670389792027e-02; +1.119045861333924e-02   +2.029412579810970e-01   +6.168958526054490e-02   +1.879936474510017e-01   +2.254535963775798e-01   +1.982496631359778e-01   +1.221360910546139e-01   +2.079437188150295e-01   +7.778875013146444e-02   +9.484801603517685e-02   +1.939741127430950e-01   +2.097741660853821e-01   +1.929815134265566e-01   +1.442447861820488e-01   +4.321267782727072e-02   +1.276137056033885e-01; +7.452043491575926e-02   +4.504574475707232e-02   +1.324039206893806e-01   -1.794510122732088e-03   +8.654271012402401e-02   +1.188965240333624e-01   +1.724538334811641e-01   +1.351077776633356e-01   +1.379116228331793e-01   +1.842771076607887e-01   +1.465986751357815e-01   +3.243928232362420e-02   +8.687700794935536e-02   +1.318520245493384e-01   +5.477014255450566e-02   +7.843698260099435e-02; +1.757685559453079e-02   +1.214705496336055e-01   +1.093741081535424e-01   +9.089549108550302e-02   +1.675755937105807e-01   +2.214988334257069e-01   +2.215576002647422e-01   +1.459236917900248e-01   +2.031609977312558e-01   +9.478491149544764e-02   +7.845008381246472e-02   +2.250460670911831e-01   +1.529549378526525e-01   +2.100823590025568e-01   +7.369414137210721e-02   +2.470239008514834e-02];
L2I_L2E_iAMPA_netcon = [+1.464455768671467e-01   +5.519628532269639e-02   +2.084254395401491e-01   +1.122320454127300e-01   +1.756128479115700e-01   +6.195476659396008e-03   +7.297587137402398e-03   +2.118387681236200e-01; +3.597741283800089e-02   +2.498870201201529e-02   +3.903516793025359e-02   +1.917255442745015e-01   +1.778904290703038e-01   +8.927913309037933e-02   +1.617287606531557e-01   +1.116121459057556e-01; +1.933435364367159e-01   +1.710863557262467e-01   +1.882314000433745e-01   +1.707391106717023e-01   +1.226126699918763e-01   +1.150570730766291e-01   +1.147419422315974e-01   +1.672960111823142e-01; +8.785349332713902e-02   +3.601168294587816e-02   +2.076139634537493e-01   +9.988705331302590e-02   +2.184409589101101e-01   +3.600546019244676e-02   +1.007008165505462e-01   +1.958572419365150e-01; +1.559493254284943e-01   +1.972388858114499e-01   +1.444894457418691e-01   +1.380364893332593e-01   +2.097078375507526e-01   +1.699735848785370e-01   +9.142998357729491e-02   +1.697825652636127e-01; +1.364519509705726e-01   +6.042053873861252e-03   +1.994806400335343e-01   +1.677440072114789e-01   +1.232029801702390e-01   +4.979501702928987e-02   +2.512588679916891e-02   +1.602499363894048e-01; +2.224018798398590e-01   +1.072588177769987e-01   +4.175844016297838e-02   +1.008294076779593e-02   +3.011031918426783e-02   +4.743254459906922e-02   +3.344031285526583e-02   +4.436260213019970e-02; +2.088475132796363e-01   +7.079378333843431e-02   +1.268221160908432e-01   +1.083761510566512e-01   +1.966215117559597e-01   +5.830450336285403e-02   +2.407636266754537e-02   +5.490660793472761e-03];
L2E_L2I_iGABA_netcon = [+2.127317296420728e-01   +5.105040859431804e-02   +4.622594596704022e-02   +3.600718217172545e-02   +1.515101490428577e-01   +8.574363348556772e-02   +1.895810128276543e-01   +2.138196063997696e-01; +5.693873356072034e-02   +9.587933187802415e-02   +3.021778523099489e-02   +3.977898439276843e-03   +2.252664909436438e-01   +1.626314388385117e-01   +1.755985479224028e-01   +1.954611768349349e-02; +1.494182441959062e-01   +8.023972081219409e-02   +1.299558722526509e-01   +1.606934908467825e-02   +9.154281494830015e-02   +2.161205280640246e-02   +2.191816221070406e-01   +1.901227840544999e-01; +1.937199398435450e-01   +1.819935170349679e-02   +6.159824680008037e-02   +1.653029239971154e-01   +2.120431762380076e-01   +1.486939822274398e-01   +9.855972030579986e-02   +1.555911172844369e-01; +3.831270144860138e-02   +2.080439626878799e-01   +1.643637160966445e-02   +1.883386047566631e-01   +7.270389669669543e-02   +8.320943856953777e-02   +1.295150792174443e-02   +6.045609870730068e-02; +1.707512155833294e-01   +5.395484099771563e-03   +1.237615846462154e-01   +1.772784224011868e-01   +2.027870101075701e-01   +6.209307819660588e-02   +2.170296767180387e-01   +1.740319942550074e-01; +3.216587331720766e-02   +2.262002727166487e-01   +6.574019363304633e-02   +8.315011373179842e-03   +1.647834056635338e-01   +1.188226011402606e-01   +1.373467569928813e-01   +1.398547119279397e-01; +1.964491387989820e-01   +7.157678083192415e-02   +1.156224116666461e-01   +4.744416434045135e-02   +1.063481054040170e-01   +1.787297703577183e-01   +2.172166284873699e-01   +1.492617859583095e-01];
L3E_L2E_iAMPA_netcon = [+7.746801289652901e-02   +1.485436059192979e-01   +3.378974604846301e-02   +1.542820638851401e-02   -8.771294489838739e-05   +2.252338249926219e-01   +8.781206803779885e-02   +1.980497384728784e-01   +2.614115308820824e-02   +6.807992858857406e-02   +6.313626031039002e-02   +1.409592624259951e-02; +6.271849290108777e-02   +2.093772265567946e-01   +6.920540714972488e-02   +8.249729585971463e-02   +1.068891517697419e-01   +1.294638910950832e-01   +2.065357113697935e-01   +2.282157334714139e-01   +1.307474631799158e-01   +2.179915998368170e-01   +7.644087862711824e-02   +5.723285174743544e-02; +1.768513695617830e-02   +1.743175122325652e-01   +2.590136164783576e-02   +1.709158213900902e-01   -1.747582011852245e-04   +1.433536470244862e-03   +1.225463704069694e-01   +2.206382016880962e-01   +1.363266263012771e-01   +1.380930370288179e-01   +5.686196866354783e-02   +1.551261291345916e-01; +1.105706042851879e-02   +4.678044805802451e-02   +1.845417738605136e-01   +6.141149280142952e-02   +6.851084819159339e-02   -3.737809139686427e-03   +7.825888404685975e-02   +1.882613169405254e-02   +4.478054514205379e-02   +7.741515208014343e-02   +4.623092263113877e-02   +7.195319020057914e-02; +2.092549287661263e-01   +8.726006454062103e-02   +7.284504341179011e-02   +2.267121183476209e-01   +1.568071521291537e-01   +7.866226119699030e-02   +2.226891597147231e-01   +3.953284334520010e-02   +1.925452387376893e-01   +1.082257066523025e-01   +1.574664565150128e-01   +8.727750423425980e-02; +2.017537343141332e-01   +1.348134899739603e-01   +1.900466439623694e-02   +1.119027193259697e-01   +1.424991542688945e-01   +2.134442159494199e-01   +2.051462783848880e-01   +8.627029961498736e-02   +1.060048011842304e-01   +2.300097543247104e-04   +1.466334928498161e-01   +5.993642611002258e-02; +1.457890885770953e-01   +1.198261680233107e-01   +1.460054817627356e-01   +4.920157340713562e-02   +1.524000212305064e-02   +8.528508857670884e-02   +2.704664294091786e-03   +8.461435927054092e-02   +6.715792771689925e-02   +1.945610770786396e-02   -1.344074381489025e-03   +1.049210986679885e-01; +1.930024516270552e-01   +2.886223135741667e-02   +7.517423674674444e-04   +6.153747781238732e-02   +1.269740683382228e-01   +2.237081980273758e-02   +5.468771088443845e-03   +1.084633007750431e-01   +1.089810738469606e-01   +1.915330438696523e-01   +1.818907319570923e-02   +1.396095468179590e-01];
L3I_L2I_iGABA_netcon = [+2.220065922826992e-01   +1.150024839362779e-01   +1.487581208202635e-01   +6.079651226446318e-02   +2.195985995570049e-01   +9.666761789173188e-02   +9.062582842885686e-03   +3.923474134286851e-03   +1.986725464773337e-01   +1.026486511570978e-01   +2.439990294920548e-02   +1.716824864071128e-01; +2.033424025566802e-01   +2.229226383408852e-01   +2.023014736365218e-01   +3.558990018358239e-02   +1.123805447786885e-01   +1.872914632012201e-01   +9.817598336555359e-03   +5.300168982985833e-02   +1.133491071423195e-01   +1.540595353332543e-01   +3.033050220769124e-02   +1.481688442298004e-01; +2.538014313428912e-02   +1.963182015343669e-01   +2.066558766895296e-01   +2.693491354516415e-03   +1.598525089778784e-01   +1.387305263958339e-03   +1.428494368698674e-01   +2.163997427806061e-01   +1.635434480055111e-01   +5.145646684436119e-03   +1.431347728218746e-01   +2.673770893724471e-02; +2.222162584145745e-01   +9.097741784897804e-03   +8.660028541455577e-03   +1.477702488225945e-01   +2.030628275395339e-01   +1.252825915194305e-01   +5.072476750073342e-03   +8.544364771572091e-03   +1.986873250741715e-01   +1.863589464946902e-01   +2.305775949916986e-01   +1.236440422027337e-01; +3.555578928597351e-02   +2.172832704314436e-01   +9.258848619357474e-02   +1.010058566990642e-01   +1.347143421997828e-01   +2.116233020027665e-01   +8.834654477192176e-02   +3.737265165308472e-02   +2.337489887370766e-01   +1.122630436637522e-01   +4.784341261738010e-02   +4.346428121629329e-02; +1.128451936742868e-02   +1.556449608737693e-01   +4.644334678889866e-02   +2.849419244117196e-03   +3.430151465263802e-02   +1.500115516175264e-01   +1.592652381284464e-01   +5.500638321139555e-02   +1.208494887472321e-02   +1.745085041227386e-01   +2.023932813318254e-01   +1.742303639890868e-02; +1.395748848353139e-01   +1.991861322019248e-01   +1.326448411586128e-01   +1.520097455901942e-01   +9.584095678488769e-02   +6.788461940049735e-02   +1.540017678837449e-01   +4.384135460123242e-03   +1.980678313716539e-01   +8.644897246342263e-02   +1.129072686683788e-01   +1.608511751911399e-01; +1.148482436337757e-01   +4.352026053259511e-02   +7.872328807103560e-02   +1.360277421062968e-01   +7.881664773454714e-02   +2.930835336782671e-02   +5.469003710788966e-02   +5.978906820578044e-02   +1.269832359194693e-01   +2.206521085431876e-01   +6.614978684629193e-02   +6.823332769419248e-02];
L2E_L3E_iAMPA_netcon = [+1.574384617578685e-01   +1.498318455533374e-01   +5.413432362157422e-02   +1.943106428791595e-01   +1.144701899079200e-02   +1.155775760258873e-01   +1.561117153820461e-01   +2.126351236034583e-01; +1.249303506335839e-01   +1.660623350369715e-01   +1.682909303305250e-01   +1.814648763566502e-01   +2.048849379489461e-02   +1.226197517662328e-01   +1.930568576855526e-01   +1.600262973070000e-01; +1.902658969453661e-01   +1.998270952149575e-01   +1.914941704520755e-01   +2.072949529537579e-01   +1.347248393704210e-01   +1.484349755127651e-01   +2.018525792661922e-01   +1.335705701267500e-01; +8.896788413174693e-02   +2.189576436530867e-01   +1.941908240993896e-01   +1.374113020887230e-01   +1.174714209442663e-01   +1.187384120834415e-01   +6.455983471992302e-02   +4.342451329694455e-02; +2.994197134888847e-02   +1.309581428656674e-01   +5.708036637815339e-02   +2.150741112002085e-02   +4.020992187219793e-02   +1.238764516571652e-01   +2.012641304281002e-01   +1.720919372875129e-01; +1.064797591803429e-01   +2.305506487980806e-01   +2.072582399807900e-01   +1.291128655735173e-01   +1.143803824850582e-01   +2.214796999136635e-01   +1.627995170702534e-01   +2.243510914348451e-01; +1.060766528668071e-01   +2.393130271320926e-02   +1.169149786618024e-01   +2.309887817521253e-03   +8.216684169336974e-02   +1.819736426047623e-01   +8.175019809574612e-02   +1.760182613285079e-01; +2.133406183331752e-01   +1.577361228667880e-01   +1.029158283805314e-01   +1.793778898274580e-01   +7.866775294705100e-02   +1.747052671164285e-01   +1.167443335589189e-01   +9.292220798334090e-02; +1.100073426472297e-01   +1.234932775773973e-01   +2.059036163632147e-01   +1.415083573022095e-01   +1.352464152725275e-01   +7.759069406455441e-02   +1.325456143530470e-01   +1.536523911361151e-01; +5.749123749888425e-02   +3.694021950624578e-02   +1.784341639006672e-01   +1.973014880418293e-01   +2.073205881358513e-01   +4.535314793959685e-03   +3.317941370370274e-02   +1.490057058267058e-01; +1.368962586290359e-01   +7.679353108779942e-02   +1.682274164656717e-01   +1.890444579262027e-01   +2.112284814444153e-01   +2.220562184539939e-01   +5.687738938102530e-02   +7.945585457174181e-02; +2.770568239025100e-02   +1.382507984963376e-01   +1.002141431899826e-01   +1.978583989916528e-01   +1.110886207205023e-01   +4.932060461731838e-02   +1.457480627155690e-01   +1.981816581700926e-01];
L2I_L3I_iGABA_netcon = [+2.157176480904542e-01   +9.863819232627144e-02   +6.611305466691382e-02   +1.592267750511536e-01   +1.678359009796050e-01   +1.908817262376448e-01   +7.977212157485156e-03   +1.200040453261817e-01; +1.241713516330414e-01   +1.098583922366052e-01   +1.607062482570173e-01   +3.948762897362267e-02   +2.033675945552752e-01   +1.885325780500577e-01   +1.031670348031662e-01   +6.061722395147733e-02; +1.802313156699238e-01   +1.687123580654430e-01   +2.175026161340908e-01   +1.381291142574842e-01   +7.981800736328307e-02   +1.358954854991550e-01   +9.321638767971686e-02   +3.452893670504753e-02; +5.100269855188184e-02   +1.894954024051957e-01   +4.784239437919412e-02   +1.115980369251915e-01   +1.203872205221495e-02   +7.843431402885410e-02   +8.742719093685236e-02   +2.255563172252628e-01; +6.948293745906971e-02   +8.743113221966917e-02   +1.179956064386115e-01   +1.043678674835983e-01   +8.835367568946742e-02   +1.476222600050391e-01   +2.294367214567546e-02   +3.127402692859082e-02; +6.945227678172872e-03   +6.229882210613400e-02   +9.242822273453213e-02   +3.987596790872069e-02   +8.084099666083269e-02   +9.456331545652222e-02   +1.198981172135388e-01   +1.628822295282799e-01; +8.084810028740484e-02   +1.041820760567514e-01   +2.180973211522775e-01   +1.435157619210751e-01   +1.687159189056726e-01   +7.051848161388048e-02   +7.380349988474720e-02   +7.117799570723465e-02; +7.754331177566048e-03   +2.290883527956352e-01   +7.122193670947496e-02   +1.983820935958094e-01   -2.014533003753711e-03   +1.724538625221101e-01   +1.299943836750679e-01   +1.770524093272883e-01; +2.032653007670074e-01   +6.847266429420731e-02   +1.925586358275027e-01   +1.402896514183415e-02   +1.196613339227618e-01   +6.615184104995518e-02   +9.359710574595981e-02   +1.004002172525483e-01; +1.695451263322723e-01   +1.177566076381591e-01   +6.281055962353099e-02   +1.133603489581475e-01   +1.436582933388734e-01   +7.637313606396938e-02   +4.968276775682569e-02   +7.111981464888953e-02; +1.651521999661404e-01   +2.211650396242550e-01   +1.217919740729829e-01   +1.544023419358220e-01   +6.405053550816019e-02   +8.251523060289923e-02   +2.164111610201471e-01   +2.794371817298176e-02; +1.736480574939323e-01   -1.141852651632358e-03   +7.741556726541249e-02   +3.159162508274437e-02   +3.455644259080801e-02   +2.254038608686528e-01   +1.123183308732838e-01   +1.245787794943696e-01];
L3I_L3E_iAMPA_netcon = [+9.875756987597582e-02   +2.317583439510564e-01   +5.977082895349400e-02   +1.416146683337664e-01   +1.756826835358509e-01   +7.617313987913443e-02   +6.919743190935305e-02   +5.724165191460459e-02   +7.942383831904427e-02   +5.979224762438272e-02   +5.909459172641791e-02   +1.023131070112625e-02; +8.706095722924710e-02   +1.965822822257490e-01   +4.780754534667101e-02   +3.091688548474342e-02   +2.200983932967657e-02   +1.254359047079558e-01   +1.274826324821786e-01   +1.246276751794627e-01   +5.259081514784614e-02   +1.118679258788266e-01   +1.707606927014690e-01   +1.268996499983231e-01; +1.193194856523030e-02   +1.390413906968264e-01   +1.112255921725875e-01   +1.311400935585612e-01   +1.134577560764304e-01   +1.007122612784193e-01   +1.152043072726466e-01   +1.058297711953117e-01   +8.264005821008909e-02   +1.301232204723096e-01   +1.072045963730307e-01   +1.251221285965359e-01; +8.492263515836115e-02   +1.655947867853471e-01   +1.438786583730894e-01   +9.941327887409646e-02   +1.018019580353884e-01   +2.026205155518768e-01   +1.747733372444134e-01   +2.928205136452745e-02   +2.153753790672012e-01   +2.045159162997726e-01   +3.933958738234331e-02   +1.683822000907509e-01; +2.473478323970343e-02   +7.591458955213655e-02   +5.854339495078775e-03   +1.936423873049983e-01   +1.764040393296163e-01   +1.252366798513352e-01   +2.187287790207357e-01   +1.051654544793108e-02   +2.052030010542025e-01   +1.317939257257575e-01   +8.262892724218308e-02   +2.533503231538281e-02; +7.883019205092522e-02   +1.493821402695965e-01   +1.907951860482415e-01   +9.457018111467515e-02   +2.286165571367027e-01   +4.646159400960754e-03   +2.009779615203743e-01   +6.304854376526244e-02   +1.514682454145647e-01   +7.400000839789924e-03   +7.718660263236260e-02   +3.472515221976129e-02; +1.807955266806463e-01   +8.378933208071684e-02   +8.738822583995394e-02   +6.524097081605196e-02   +1.510793102202012e-01   +4.637523892007399e-02   +1.254672314399359e-01   +2.077996706198352e-01   +1.927878731412289e-01   +2.245651277579523e-01   +1.250527294168695e-01   +1.641560587765484e-01; +1.709218579880046e-01   +4.903522646937906e-02   +1.630045310207638e-01   +1.406674469519008e-01   +2.253487546519394e-01   +1.318836475528362e-01   +2.222737295236133e-02   +1.115600779959258e-01   +9.962519993159231e-02   +7.091341620947991e-02   +5.499779931632574e-02   +2.126564513862207e-01; +1.617937426198850e-02   +1.935283929375684e-01   +1.671432870144300e-01   +1.871300402784923e-01   +8.233514878309497e-02   +1.676666475736490e-01   +4.346319564817244e-02   +1.810432760092186e-01   +1.900251317141387e-01   +1.053249318949563e-01   +5.116370936588759e-02   +5.005898448804549e-02; +2.090333156945382e-01   +1.835237954999488e-01   +9.337283408487318e-02   +4.822205594853317e-02   +1.308140101112158e-01   +1.803089699518216e-01   +1.143961625683831e-01   +2.048902559012714e-01   +1.538919986026566e-01   +7.167455417337583e-02   +2.028101320004324e-01   +4.713294791580142e-02; +9.884055513085824e-02   +8.336885633984237e-02   +2.274778598841186e-01   +2.187319058362297e-01   +5.148178983749627e-03   +1.394015120988477e-01   +1.713353727065879e-02   +5.853950662283826e-02   +6.056759812371994e-03   +2.220775075203221e-01   +1.669458339802319e-01   +8.486230053804383e-02; +2.228440317770292e-02   +3.733732014348933e-02   +1.243688364026146e-02   +1.014131048957854e-01   +1.018259850208125e-01   +5.545727273069659e-02   +1.816209938831751e-01   +4.053029359267016e-02   +7.640431558072849e-02   +5.360951138157736e-02   +1.720124851052111e-01   +6.333398203675178e-02];
L3E_L3I_iGABA_netcon = [+4.247334128040037e-02   +1.033680314831228e-01   +7.706487890393039e-02   +2.090928107407181e-01   +1.868896304879925e-01   +1.245550414028226e-01   +7.408953097871364e-02   +1.708165077481178e-01   +1.466265213754099e-01   +1.663891249717867e-01   +1.377390497153028e-01   +5.869941732981708e-02; +1.786702979923794e-01   +1.471263098653121e-01   +7.290366871952698e-02   +2.525764871089737e-03   +8.329377128083512e-02   +1.660683918715862e-01   +1.472021950505485e-01   +2.256036021521275e-01   +1.944221064290400e-01   +1.033500011536835e-01   +2.829107128221280e-02   +1.186296260645072e-03; +1.306321251492510e-01   +2.202734297356412e-01   +2.203593564108508e-01   +1.933529257040486e-01   +1.139623271239210e-03   +1.700895993332323e-01   +1.350656842347674e-01   +1.576998484553604e-01   +9.288946633732058e-02   +9.519428344044266e-02   +6.462284587306133e-02   +3.235978134101097e-02; +1.008811798499977e-01   +1.055831132227976e-03   +3.466634442980153e-02   +1.634593835507250e-01   +1.625485924218841e-01   +5.928076316439650e-02   +9.431221688147771e-02   +8.240049094040976e-02   +2.232553455592456e-01   +1.063540827302140e-01   +8.345402221019729e-03   +1.345890073517085e-01; +1.007768387993098e-01   +9.137867168317013e-02   +2.280506479013503e-01   +5.907423023008818e-02   +1.206636074585704e-01   +1.757303609955418e-01   +2.240014458773430e-01   +2.139761404276808e-01   +6.044466235662724e-02   +1.324105228747613e-01   +1.913867499441656e-01   +1.344754386627985e-02; +1.531187488362426e-01   +1.077007666525912e-01   +1.945741373563205e-01   +1.930055773963016e-02   +9.893389787141705e-03   +2.253436277136425e-01   +1.807433845430838e-02   +1.248927225327981e-02   +1.873536501900459e-01   +1.363600809370970e-01   +5.987969015682618e-02   +4.625339173065303e-02; +1.311137627456236e-01   +8.227129251863449e-02   +1.136721224592070e-01   +1.303946336086027e-01   +1.551673765157690e-01   +1.105450435850524e-01   +7.627754352872991e-02   +6.974637137435938e-03   +7.914722448820685e-02   +3.500537682036190e-02   +7.054179369157354e-02   +1.651782981142196e-01; +7.056704313583836e-02   +3.460742221283240e-02   +2.935262094980215e-02   +2.079534784946195e-01   +1.032625713287418e-01   +1.780122628209624e-01   +1.204033736870667e-01   +1.763515553476129e-01   +1.766018942462713e-01   +1.918970143888842e-01   +3.344377938984387e-02   +1.352571955083587e-01; +6.218317385500843e-02   +4.332039252551702e-02   +1.759563715060272e-01   +7.871180060882910e-03   +2.155025796496488e-01   +2.054913498204259e-01   +4.035313318246429e-02   +1.638912607744596e-01   +5.261057425546655e-02   +9.101711291334148e-02   +9.664500876994170e-02   +1.353372749496365e-01; +1.883718278363056e-01   +7.358805623453180e-02   +1.919415991904922e-01   +7.475695377034924e-02   +8.237174539509748e-02   +2.259904401769446e-01   +1.717640976402183e-01   +1.278183106177963e-01   +2.124392987159839e-01   +2.218259176534882e-01   +3.819738157623978e-02   +6.217285364666720e-03; +1.229641134249702e-01   +3.475007612468617e-02   +4.838142522549330e-02   +4.545451978566351e-02   +1.792328380250074e-01   +1.155844912798023e-01   +2.002963791899208e-01   +1.406391968618334e-01   +1.311660114409459e-01   +4.210772238754658e-02   +2.046612367944131e-02   +1.827412050114299e-01; +1.469077750884093e-01   +1.164112873133047e-01   +2.294203616940272e-01   +1.621321645374200e-01   +6.068989372911729e-03   +1.176277724603193e-01   +2.261929006305014e-01   +1.700795778011027e-02   +1.760220655197503e-01   +9.021147531307989e-02   +1.077360947697164e-01   +9.785678103049815e-02];
L2E_Input1_iAMPA_netcon = [+2.313789031504198e-01   +2.331786193076575e-01   +2.303229130510523e-01   +2.313808066814344e-01   +2.306246479729804e-01   +2.351886824221706e-01   +2.295950599006345e-01   +2.263909002307964e-01];
L2I_Input2_iAMPA_netcon = [+2.320970954944136e-01   +2.355525101909267e-01   +2.300830405288379e-01   +2.280239155974955e-01   +2.279773634259819e-01   +2.292144095543921e-01   +2.304220364821206e-01   +2.304512823447179e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last =  11.21 * ones(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.0*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.2*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.0*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.2*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.0*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.0*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.2*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.0*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.2*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.0*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
