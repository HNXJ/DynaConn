function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+5.409382582194078e-02   -3.419274807867400e-01   +9.805388773043749e-02   -8.635529438306049e-01   -2.179678640188718e-01   -2.417943956019645e-01   +3.694223290107642e-01   +4.392121200126972e-01   +1.928215692403847e-02   -8.213594497699241e-01   +4.356243361965285e-01   -3.240849285443094e-01   -5.776855327900545e-01   +4.522688533496027e-01   +3.976917942529532e-01   +1.901570721784013e-01; +9.298460741292051e-01   -7.558516065159363e-01   -5.430677826164808e-02   +4.016000151619927e-01   +5.014002436610578e-01   -8.242186871435736e-02   +8.825236941032506e-01   -1.844579796632560e-01   -1.591775155072231e-01   +2.582155045158773e-01   -6.299395598162600e-01   +6.029837534454754e-01   -3.357228732257553e-02   +4.161511199728755e-01   +4.842616842165166e-01   -8.422673031338828e-01; -2.485169555940568e-01   -2.644506116767784e-01   -5.517597094851174e-01   -8.069284147189878e-01   +3.556458841151346e-01   +2.139238063164111e-01   -6.080313248088476e-01   +1.779675437540303e-01   -2.476195449411899e-01   -1.753686085288324e-01   -4.482594551272999e-01   -4.523873911156448e-01   -1.206757964891347e-01   +9.510613765779850e-02   -2.419482335775241e-01   +3.553926091592697e-01; -2.314220637218427e-01   -2.186670879455942e-01   +3.573748772022464e-01   -5.112423808219657e-01   +3.365676935807177e-01   +5.184908829254751e-01   -8.569246932106490e-01   +3.083071598233812e-01   -1.285836452549675e-01   +8.274496126437624e-01   -5.846031297202707e-01   -4.489729807263709e-01   +5.622843643897075e-01   -5.088399486454614e-01   -2.386230163200573e-01   -1.316467286304404e-01; -3.307570786912544e-01   +2.854245572921512e-01   +1.560022816687756e-01   -3.883258216778692e-01   -5.247996540842047e-01   -5.736501515537085e-01   +3.249091095210039e-01   +3.043455178139582e-01   +7.178543603961314e-01   -3.681528226132290e-01   -4.184219904951549e-01   +7.696687942996094e-03   -1.894517202364150e-01   -2.577299143640461e-02   -5.086899366340036e-01   -6.926190161611855e-01; +7.616843237654272e-01   +2.699380360377582e-01   -5.014507308638846e-01   +6.716314394072669e-02   -5.262774565563573e-01   +1.870954571067010e-01   -1.622638267003763e-01   +8.565948570599317e-02   +6.041675348243745e-01   -4.453150303672243e-01   +4.633783538323848e-01   -6.071281187471981e-01   +5.069265394315309e-01   -9.622682733796019e-02   +5.162863707440609e-01   -3.898396347661735e-03; -7.311720601514089e-01   +3.805317440083478e-01   +3.010242743503249e-01   -1.357083228279132e-01   -5.836003013619472e-01   +6.184268295897856e-01   -2.834312447378814e-01   -4.905427682945051e-01   +3.075779255394039e-01   +4.411550358507386e-01   +3.847107943214785e-01   -1.845500106881244e-01   +9.175239524282669e-02   -7.529319031052031e-02   -1.497693670459493e-01   -5.633395228692581e-01; -3.600154075442623e-01   -6.644901280757686e-01   +7.282013294914984e-01   -5.014009687819786e-01   -7.974913092683954e-02   -5.041251181700404e-01   +2.825196399053653e-01   -3.949206903903573e-01   +2.370111687443956e-01   +4.003091345840195e-01   -2.954043284557553e-01   +7.522606880961933e-01   -6.516547850035882e-01   +2.637851624616240e-01   +2.000262960016669e-01   +7.827029025154814e-01; -5.956280762665481e-01   +3.950461065068244e-02   +6.054053976160518e-01   -7.669876822515028e-01   -3.240060288864499e-01   +2.120013491726605e-01   -1.135746355745911e-02   -7.066485660169859e-01   -1.939084933898825e-01   +1.659003264655798e-01   -7.163519262228633e-01   +3.858080616778825e-01   -5.022276238605630e-01   -1.836745498040629e-01   -1.845071957241554e-01   +9.609629308517584e-02; +3.871314120442549e-01   -3.025523144187541e-01   +4.986086641145224e-01   +6.523106874035962e-01   -5.898549434065271e-01   -4.234983700334506e-01   -5.054492804694173e-02   +2.835090351685902e-01   -3.293992721850120e-01   +3.695917769587436e-01   +5.561811102094811e-01   +8.743024562569518e-02   -8.162742530688778e-02   -5.401565102658291e-01   -2.901823937807798e-02   -5.625534434215391e-01; -9.430467297986919e-01   +4.899794199636541e-01   +2.624890529425559e-02   -4.663739901470375e-01   +8.794001977483615e-01   +5.740594117627166e-01   -6.068709768579555e-01   +2.384175195552731e-01   -5.312318574038805e-01   -4.988022591482817e-01   -2.136741305544539e-01   -2.137043640751005e-02   +4.383241415439780e-01   +3.823345561413442e-01   -1.765809904093068e-01   +4.336239890612249e-01; +4.043724741067060e-01   -4.861761909023377e-01   -2.116037771935428e-02   -6.684400464918648e-01   +1.000000000000000e+00   +7.650622525540676e-01   -8.739962083171994e-01   +8.398518903522785e-02   -2.872120709329916e-01   +3.676709881407198e-01   -1.359727035352120e-01   -1.726169785556240e-01   -5.984593075741181e-01   -8.026584421746360e-01   -2.496748209171641e-02   +3.446743775642358e-01; +1.033545098026719e-01   -2.060448959424991e-01   -9.133578395958666e-01   +2.302156249406634e-01   +1.229506220399703e-01   -4.526525006222768e-01   +3.122193834575487e-01   -1.756978367860952e-02   -7.736147493541428e-01   -6.772402821209202e-02   -4.095178767031266e-01   +3.971459845907134e-01   -7.472092270759088e-01   +1.692712581925078e-01   -7.308182922566588e-02   +3.223632058091260e-01; +4.190611030954757e-01   -3.678215120077005e-01   -2.094554745130998e-01   -7.841473562583926e-01   +7.604004186863823e-02   -2.693131125130890e-01   +8.151916524903491e-01   -7.416700551458005e-01   -3.375132856416334e-01   -4.436341376339622e-01   +7.980510153281554e-01   -1.204979243940339e-01   +4.153749826307860e-01   +3.296826478830179e-01   +4.334563996311729e-01   -1.294365807624844e-01; -2.702752592508429e-01   +8.297230163973449e-01   -3.574641605290617e-01   -1.497257847019264e-01   +2.944534014575406e-01   -4.320977808044660e-01   +7.471901538797733e-01   +1.817142295659840e-01   -4.746846217001122e-01   -2.901375172799979e-01   +1.107832178191595e-01   -1.847868680214749e-02   +1.550250858322337e-01   +5.508795386023635e-01   -6.625596407738991e-02   -3.826249703525608e-01; +3.651240070310425e-01   +7.087719514854345e-01   +1.726652408052348e-01   -5.258516295445724e-01   +4.782459580632434e-01   -3.736201456767630e-02   +2.263032875593417e-01   -2.365054997689233e-01   +7.870535486401899e-03   +6.761316093530862e-01   +5.072630560923362e-01   -5.798729213708160e-01   -2.599414283606810e-02   +5.963209543774243e-01   -2.905086047883138e-01   -2.829196738153733e-02];
L1E_L1I_iGABA_netcon = [+1.647502156243595e-01   -3.733429042893379e-02   -3.567797436629673e-01   +6.700030966252951e-01   +1.836753978868465e-01   -1.980406156501176e-01   +2.305172356347911e-01   -7.928502535069550e-01   -3.901216454738480e-01   +1.888895754211554e-01   -4.785447316078538e-01   -9.238569229031446e-01   +3.896978568114793e-01   +4.750977161287819e-01   +5.060282547477732e-01   +4.284635935005673e-02; +5.650083340017972e-01   -8.373712303576371e-01   -8.906606185549018e-02   -1.599383234756307e-01   +1.180917933836775e-01   +1.489768853632104e-01   -8.165023521637688e-03   +2.347191452672072e-01   -9.226563840273844e-02   -3.912762180144027e-01   -3.575466684776865e-01   +3.614287561149719e-02   +6.839936679254591e-01   +8.104194115016412e-01   +2.320010997405718e-01   -4.282888595634473e-01; -4.606556240929657e-01   +7.183061215540038e-01   +1.159207450127746e-01   -5.970074078448046e-02   -2.049963041859014e-01   -7.771461880028399e-01   -3.484880932576860e-01   +4.771754054163760e-01   +3.452269742796842e-01   -6.735687287893006e-01   -3.574237734567643e-01   -4.350650712030549e-01   +3.184345364039374e-01   -2.974238651813457e-01   +4.476844397483716e-01   +1.819633688534703e-01; -3.416289721382056e-03   +2.646913850094967e-01   +3.609111073922311e-01   -4.101369672506532e-01   -5.734545737741423e-02   +2.253209876180960e-01   +3.485760999432095e-01   -3.718174590494818e-01   +5.990263970790569e-01   -3.560670155415874e-01   +2.914182197263220e-02   -4.359526658844216e-01   +1.741014206811828e-01   +7.611829165089892e-01   -2.311068485739456e-01   +6.311396286782324e-01; +5.321971180829699e-01   +5.493718635819496e-01   -4.588751027156592e-01   +6.221701965040003e-01   +9.799859381133354e-02   +2.708771825878198e-01   +6.344713357723585e-01   -4.084187626848131e-01   +1.279619613730265e-01   +6.133435907183635e-01   -4.638261900093370e-01   -5.334414556499932e-01   +1.508035884538993e-01   +1.693685057866302e-01   -4.815592126609740e-01   -3.924252293447247e-01; -3.339138062733664e-01   +7.641001241409475e-01   -6.826572155908086e-01   +3.800537386912824e-01   +3.953193988992689e-01   -5.795368561985613e-01   -2.257836608472209e-01   -7.021880548351473e-01   +4.229055767463116e-01   -1.679573564777323e-01   -6.139290998592493e-01   -4.846368582037662e-01   -3.904132178515760e-02   +2.487633901057204e-01   +4.946068288822066e-01   +1.329642098648385e-01; +6.946701686005363e-02   -3.353336470354029e-01   +8.801490867046549e-01   -9.690295480026524e-01   -6.483988422468326e-01   +5.208580602554296e-02   -3.237697262531319e-01   +2.765131052185885e-01   -7.414173692869094e-01   -3.187479364940097e-01   -1.891343352069674e-01   -8.349344627351357e-01   +2.727023966043755e-02   +3.017936838268906e-01   -2.953020488324669e-01   +6.578679377956919e-01; -9.355054129648259e-02   -3.645780855227256e-01   +3.737688110383444e-01   +8.907179438675071e-01   +1.108500787940682e-01   +5.343765786913746e-01   -3.954764153050617e-01   +1.000000000000000e+00   +7.154639015860411e-01   -2.070468908936731e-02   -6.012781910256374e-01   -4.949319325623247e-01   -3.952134485058547e-01   +6.172487135696113e-01   +6.040928480906471e-01   +9.830650829088490e-02; -3.970565409466960e-01   +3.553863119145292e-01   -4.950052334562933e-01   +9.604733299419771e-01   +8.796297161920317e-01   +1.282600528541209e-01   +9.296170408977298e-01   -8.463282167999310e-01   -3.119015349415849e-01   -6.552585737155786e-01   -6.106140085743967e-01   -1.255699090248192e-01   +2.119730030172772e-01   -1.245955972433401e-01   +3.503180632190733e-02   -5.850398050815042e-01; +2.385770077293576e-02   -8.061719816063827e-01   +6.875050179057027e-01   +5.331019509590272e-01   -8.746570208425970e-01   -5.759524837004679e-02   -2.550450241565112e-01   -4.345477183651614e-01   -1.305398157223708e-01   +7.496109866775370e-01   +4.900072828670161e-01   +5.786493436901912e-01   -3.474230866755017e-01   -5.000157253375105e-01   -3.562421497760276e-01   +3.337857849365684e-01; +1.436011719914080e-01   -3.005998737187797e-01   -1.263601496836027e-01   +2.514747263964609e-01   +3.048834321865566e-01   +2.347900325058562e-01   +8.911427617354942e-01   +7.269424721705889e-01   -1.255088671470645e-02   +7.282622031382152e-01   +1.722049827295707e-02   +2.208604905950923e-01   +5.751824328598211e-02   -4.707871722096380e-01   -6.829915982562555e-01   -3.355397549762410e-01; -4.489771445165258e-01   -5.132234255371759e-01   -7.326880815914373e-01   -3.331436028603657e-02   +3.137291346042276e-01   -7.059974409695106e-02   +1.852151259678173e-01   +5.738460989752749e-01   -3.712444841592758e-01   +2.492672183622668e-01   -3.236449812639119e-01   +3.914092974272414e-01   +9.627262758081120e-01   +4.370753857183032e-01   +3.621803885283779e-04   -5.077068127233260e-01; -4.688948117831807e-02   -4.618674814263644e-01   -2.241456792459468e-02   -7.018072262499921e-01   -4.158202730262062e-01   -2.403983947508928e-01   +3.197037763478150e-01   -6.793854935871310e-01   -1.597858914351809e-01   -9.370305343804416e-01   +6.650453524075928e-01   -3.211865233821475e-01   +4.821080009297589e-01   -1.132586339799426e-01   +5.989005099650123e-01   +1.175782918292101e-01; -3.880110339664721e-01   +1.939923839801045e-01   +6.190456043543588e-01   -1.946006369124558e-02   -2.157687353323496e-01   +5.477195661014984e-02   -1.593539713144182e-01   +1.327119443359855e-01   -4.090967261202618e-01   -1.005056485449886e-01   +2.849028315348437e-01   -1.151315503658674e-01   +8.432646439572962e-02   +4.287075642073728e-01   +8.035822974819809e-02   +3.377889416231641e-01; +3.629296025718091e-01   +7.006277557389380e-01   +6.205243446063811e-01   -3.865955180780640e-01   -3.159651783634588e-01   -1.966625685807639e-01   +1.566106992875981e-01   +6.137288877865460e-02   -4.855553875424329e-01   +3.751495569979171e-01   +6.570195245724678e-01   +1.770475233797507e-01   +7.360156272972472e-01   -5.127364921163828e-01   +8.588087259880014e-01   -7.198957346994164e-01; +3.345379067882848e-01   -8.750029993851623e-02   -3.660446104008344e-01   -1.531306864011946e-01   -6.244262160038114e-01   -3.598027864787410e-01   +1.950944009605324e-01   -9.893048412242808e-02   +9.576278562056041e-02   +2.299368953612695e-01   +4.146959220361204e-01   -5.802815232106038e-01   +1.125540015993042e-01   -6.498115317010756e-01   +3.225083696390770e-01   -5.256979841633165e-02];
L2I_L1I_iGABA_netcon = [+8.303771033761984e-02   -1.485889135768203e-02   +8.951030830550201e-01   +3.912573420047839e-01   -3.290364234519270e-01   -5.243049414088873e-01   -5.329536729912274e-01   +1.000000000000000e+00; +2.067392330979769e-01   -9.925167357101031e-01   +2.411475974851932e-01   +1.124212948602426e-01   +5.696540672187445e-01   -4.481619372543119e-01   +3.475552382211652e-01   -9.180674753630883e-01; -1.792462591840242e-01   -2.231526506928514e-01   -5.526139284949433e-01   -3.581931014181486e-01   -1.477848549162195e-01   -8.134004048936927e-02   +3.135299567996254e-01   -4.861004364779126e-02; +1.350261653416152e-02   +9.336882920774459e-01   -2.806355206064137e-01   -2.722742200576205e-01   +4.944468741975255e-01   +1.798398213287483e-01   +1.765752665482048e-02   -3.793274167880170e-01; -4.599738715623573e-01   -5.535171168020466e-01   -2.586789560345198e-01   +6.867956074344014e-01   +4.256827635627377e-01   -7.271824554896549e-01   +3.975368926746249e-01   +2.911664817071834e-01; +1.590036485511233e-01   -5.922176708305411e-01   -3.277902791708073e-01   +3.297142045988440e-01   -2.633966956859518e-01   +6.269923117281738e-01   -7.432843494860136e-01   +8.169725070599776e-01; +3.662189799674005e-01   -6.388373878052870e-01   +3.644769402078011e-01   -2.692162606532587e-01   +8.036555238004168e-01   -8.801362752886465e-01   +3.933307872773005e-01   +3.877436393709461e-01; +2.089129903345552e-01   -8.316280989986403e-02   +4.705221533192163e-01   -3.199596629537886e-01   +2.905126408101203e-01   -1.562484944478784e-02   -3.439885553992553e-02   +5.153196697296620e-01; +7.770236666292168e-02   +1.532239029922839e-01   -1.323520177825325e-01   +2.897040001114104e-01   +4.162122983691151e-01   +2.074008296635514e-02   -1.798770894300359e-01   +7.382875273212165e-01; +4.418340705041439e-01   -3.981930000233669e-01   -7.359695396475521e-01   -5.415142562592660e-01   -6.285461931153074e-01   -4.482941428836795e-01   +3.001168862454846e-01   -4.749549828090349e-01; -3.634636579578692e-01   +1.430101936417299e-02   +7.634603466736370e-01   -1.834978741282687e-01   -5.532109216111433e-01   +3.840077441987079e-01   -2.692363806306203e-01   +4.048120884991421e-01; -2.643497496337655e-01   +6.130694467807501e-01   -8.092659853042802e-01   -4.985598465816078e-01   +2.126494499472961e-02   +3.327455795196976e-01   -9.186109260482454e-02   -2.795371529274281e-01; -2.341000418101490e-01   +1.147396175540602e-01   +3.969894741812369e-01   +3.569825920249248e-01   -3.774130475170284e-01   +4.454248404873228e-01   +6.462418647532419e-01   +2.338809680564579e-01; -2.234964402420860e-01   +3.931575325633943e-01   -1.670739097900538e-01   -3.671941495224718e-01   +4.327294820424682e-02   +4.426425044993970e-02   -3.791009195665087e-03   -6.362040009508178e-02; +7.523707508956661e-01   +3.310424596025221e-01   +5.037434707981092e-01   -3.457587407828669e-01   -8.993427363264247e-01   -7.209153651530535e-01   +4.019059382374882e-02   -4.442258209239016e-01; -1.168454425792195e-02   +3.400904639452498e-01   -3.729219231780829e-01   -2.427626959844643e-01   -4.462181824263826e-01   -2.137194877751222e-01   +2.823823046214633e-02   -3.521706058107104e-01];
L1I_L2I_iGABA_netcon = [+3.891899667990766e-02   -3.140065986701281e-01   -6.651716418479602e-01   -3.660204851414212e-02   +8.059419206868711e-01   +9.269270896907246e-01   -6.273502360994179e-02   +7.844489517080989e-01   -1.731207971798382e-01   +5.923644586480641e-02   -5.486432287634665e-01   +1.637120900831519e-01   +1.965364034912878e-01   -2.711509019065816e-01   +4.393497386202781e-01   -1.008338192900017e-01; -2.167673325170985e-01   +9.393195330072932e-01   -4.702813713412320e-01   -7.892076382272952e-01   -5.900084048671838e-01   -1.797366993896733e-02   -7.490771584271318e-02   +1.865292621111201e-01   -4.896529967485352e-01   -6.244280381590585e-03   -2.770837314711662e-01   -3.924435434392922e-01   +6.360412074107147e-01   +5.106091270338514e-01   +3.444927216606825e-01   +6.993205548112139e-01; -2.020603412984336e-02   -4.181582819903322e-01   +2.777629420385069e-01   -3.569633211654948e-01   +3.439582467223639e-01   -9.648221056752752e-01   -6.112540027158773e-01   -5.820687513128825e-02   +2.689355516936003e-01   +1.155408301200420e-01   +2.620448244800080e-03   +3.830726742228920e-01   +1.217293434780533e-01   +2.630301638594983e-01   +3.699691043384812e-02   +4.239213098062756e-01; -7.530387197413461e-01   +9.336053009601969e-01   +5.524041814540622e-01   +4.876487646298287e-01   -7.759068191747459e-01   -7.252427193220863e-01   +4.107431400231985e-01   -4.713079735113893e-01   +6.415899271559291e-01   -3.728802085852317e-01   +1.194727157751194e-01   -3.429425020169116e-01   -4.246057062402068e-01   -8.064641741940529e-01   +4.409350148760392e-01   -1.051339433820741e-01; +5.001692890738785e-01   +7.290663512111809e-02   -3.730890089120680e-02   +3.117586519495115e-01   -4.306282500231143e-01   +4.880819740605835e-01   +4.918433625558554e-01   +7.573972111486728e-01   +1.508563000030567e-02   +2.005880576611186e-01   -3.834562787304099e-01   +7.136947359381594e-02   +1.675223769468304e-01   -1.777037099231772e-01   +6.451284629116044e-01   -4.401627205818241e-01; +1.568798372341860e-01   +4.094961499556473e-01   -5.416542491298428e-01   -2.849660552061154e-01   -2.933575379399014e-01   +3.859989898508794e-01   +1.038075103578751e-01   +8.754450789337876e-01   +7.065466492086179e-01   -1.651974849383007e-01   -3.861543451494900e-01   -7.734840047298842e-01   +1.609264637651236e-01   +3.957745023906633e-02   +2.859730097296556e-01   +8.901653714186621e-01; -1.591201122827948e-01   +7.244763303644589e-02   -7.577156665320951e-01   +4.180412208551969e-02   -5.127572155233679e-01   +5.124495017571670e-01   +1.063223691188977e-01   +3.049224032314450e-01   -9.098628108413677e-02   +6.546896372613136e-01   +3.913067794720111e-01   -2.200876859083636e-01   -1.000000000000000e+00   -2.563479852158250e-01   +4.916592452024767e-02   -5.640135477893830e-02; -5.581348249713071e-01   +1.643562415212211e-01   +2.413039076383038e-02   -2.841828490364426e-01   +2.268883695449331e-01   +6.325301156443845e-01   -1.224320893169883e-01   +8.079000724457256e-01   +5.713143811855526e-01   +5.952917706158619e-01   -2.600048624200863e-01   -6.110558140365197e-01   +2.161382687464359e-02   -5.057896618387472e-01   -1.458533802695914e-01   -3.882914059243754e-01];
L2E_L1E_iAMPA_netcon = [+4.613495743284682e-01   -3.826515088836751e-01   +3.103692820877331e-01   -5.846608663803813e-01   -3.015641259413770e-01   -3.148354959564241e-01   +7.302858484010377e-01   +6.886122821218708e-01; -5.543354622720809e-01   -4.850144157520742e-01   -3.029909646263717e-01   -4.009389170704547e-01   -4.542362375054755e-01   -4.819652386005814e-01   -6.582562313435976e-01   +1.864527984202229e-01; +5.316244546776178e-01   -3.566156638251967e-01   -3.837195239669519e-01   +4.044214920931096e-01   +5.429782998554817e-01   +8.287357079920427e-01   -1.572982401623628e-01   -7.000534067641110e-01; +5.635571797790673e-01   -3.135228184053525e-01   -4.069586450877465e-01   -1.468014445485278e-01   +3.451499670586866e-02   +3.712205121476746e-01   -3.445441800033180e-01   +2.679138580907842e-01; -1.574511730099487e-01   -7.973721911517304e-01   +1.660477920140757e-01   +3.760849283799693e-02   -6.542448966667906e-01   -7.244520430694078e-02   +6.829672557667238e-01   -1.515735891705542e-01; +3.848873893508613e-01   -3.233739140419716e-01   +1.807052156570867e-02   -8.620910048410111e-01   -2.649701683670357e-01   -1.413102842387478e-01   -1.954287714818993e-01   -2.432840236089860e-01; -2.961648414668713e-01   +1.795066975372596e-01   +3.598302353714813e-01   -2.485787852621335e-01   -1.134342415984204e-01   +6.945581981211200e-01   +5.455689934790534e-01   -2.380252367454173e-01; +2.427610644174471e-01   +1.628615789208071e-02   -5.273081385536943e-01   +2.743435284685872e-01   -1.070488659409772e-01   +5.699451776508155e-01   -9.472605624796652e-01   -1.866781922623165e-02; +8.530310561582136e-01   +5.788092809618424e-01   +3.023945761501846e-02   +7.742058824375406e-02   -8.663302367982280e-01   -1.598124741016042e-01   -4.734118728044273e-01   -7.627618682798485e-01; -4.288330576049926e-01   -1.126446230444807e-01   +4.321125368084732e-01   +5.533720132197959e-01   -2.220320306873403e-01   -4.176971702057999e-01   +6.831515453030657e-01   +3.185497626234809e-01; +9.426634861997614e-02   +1.953500227642964e-01   +5.638396388068994e-01   -1.256241101448317e-01   +1.000000000000000e+00   -5.514845959696760e-01   -9.601958165732087e-02   +4.144857027994042e-01; -5.449016140407755e-02   -6.748039010540711e-01   -1.791252754891477e-02   +1.101183008672922e-01   +6.468469529310817e-01   +2.561583622839301e-01   +7.863010109553753e-02   +3.842023504219796e-01; -5.551654866612240e-02   +2.446193558895156e-01   +3.104669017756252e-01   -7.829369200662544e-01   +3.450152178653159e-01   +3.470617319552017e-01   +4.156895682143952e-01   -8.039877103308493e-02; -4.725029050380357e-01   +2.798924883700795e-01   +8.063692424612904e-01   -2.108151317141668e-01   -3.799398884051963e-01   -3.900777286041148e-01   +8.117119908628942e-02   +3.166410422038932e-01; -1.870533785834899e-01   -1.586640946137961e-01   +3.792908479774060e-01   -8.204744742044325e-02   -3.442277790358412e-01   -6.020639879984520e-01   -6.870523771203040e-01   -4.148857235581252e-01; -6.405302805674599e-01   +4.151455699775141e-01   +5.796254137845509e-02   +1.374276626395378e-01   +2.467322823314326e-02   +3.431581577992968e-02   +4.725938447782748e-02   -1.479726147688707e-01];
L1E_L2E_iAMPA_netcon = [-8.578692090510153e-01   +3.522935901123596e-01   -2.494103130328746e-02   +3.590232347740417e-01   +7.729766534261031e-01   -7.723525856815675e-01   +7.576022359209771e-01   -4.305814007601260e-01   +6.315575822620548e-01   -7.579848442111081e-01   -4.064777091560222e-01   +5.982040769238721e-01   +6.416658984675639e-01   +2.017551578169298e-01   -7.808721493895580e-02   +4.667957328750039e-01; +1.718144750742409e-01   +3.155930656465424e-01   -2.035919713988098e-01   -9.220487976953017e-01   -8.342638242717144e-02   +2.577740722068328e-01   -4.946899467296710e-01   -4.157076890018094e-01   +1.349087255311115e-02   +7.439591510098812e-01   +7.247342781005427e-02   +2.160775085111077e-01   -9.121015730784814e-02   +5.491900744187579e-01   +2.222559806055570e-01   -1.954760698679089e-01; -4.395069344150204e-01   +3.105958483694184e-01   -5.061833454587056e-01   +5.934062861909338e-01   -2.504988900346141e-01   -1.382154502888839e-01   -7.848990338320485e-01   +2.846413955938849e-01   -4.789457252535683e-01   +5.990293899985929e-02   -5.648192955305408e-01   +4.014335913288517e-01   +7.731976475575659e-01   +8.759186980170937e-02   -4.176977491017390e-01   +2.671732282373190e-01; +4.429665239060626e-03   +1.784678405142791e-01   -6.040160530514218e-01   +2.420700042165575e-01   +2.405154991487440e-01   +4.057163298292033e-01   +3.150129238776948e-01   -5.584788693677416e-02   -7.585459348235267e-02   -2.307801161759046e-01   +5.358886969575395e-01   -7.913754772550133e-01   -4.370775789499145e-01   +1.939957413392190e-01   -4.181745001702037e-01   -7.377069211326171e-03; -6.722572957775387e-02   +2.268690644859099e-01   -8.861899156041008e-01   -5.577853376469417e-01   +7.103195669299019e-02   +7.504875684021536e-01   -2.425856337698549e-01   -2.782748361214972e-01   +6.666055734737985e-01   +3.186419157898563e-01   +2.704665674966981e-01   -4.687715192518238e-01   -5.011755647920967e-01   +5.192266437967380e-01   -2.265577513589692e-01   +1.262932353438972e-01; +2.940260377351405e-01   +9.154399397362095e-02   +2.035603793081888e-02   +6.493219417344994e-01   +3.875808184897348e-01   +2.561131763425167e-01   +3.695864950957046e-01   +1.178918272501914e-01   -3.631456133560156e-01   +1.807104264185654e-01   +1.420924444358259e-01   +1.014655492229219e-01   -5.818582778722597e-01   +2.224057753776813e-01   -2.807492628625825e-01   -8.091669380931891e-01; +4.207143506928527e-01   -3.418608726156874e-01   +3.161229887575437e-01   +6.460168719187022e-01   +7.653218068292307e-01   +6.647438816296648e-01   +3.916854268645386e-01   -4.531848753466753e-02   -2.149579962956330e-02   +3.562731646018883e-01   -4.070497778104906e-01   +5.361788872555171e-01   +6.370053907437185e-01   -1.000000000000000e+00   -2.397576614351960e-01   +4.662553987761510e-01; +7.611103195661441e-02   -7.053771943398224e-01   +3.286931881979691e-01   +7.495213495367121e-01   +2.360345068549755e-01   +5.945766681387499e-01   -6.649798459063218e-01   +3.740985498401761e-01   -4.155019661812579e-01   +1.880126170358699e-01   +2.850442103698667e-01   -1.862186163257430e-01   +2.771128091866612e-01   +4.891077397940257e-01   -2.803455471786326e-01   -2.010977829059664e-01];
L2I_L2E_iAMPA_netcon = [-8.147798250350083e-01   +8.454615346492567e-01   +3.768232798445217e-02   +2.097990206841889e-01   +1.921554743170605e-02   +5.059177969978754e-01   +2.584864416088038e-01   +1.000000000000000e+00; +2.942527792935371e-01   -3.518714741978580e-01   -2.115223485994990e-01   -1.587636414926127e-01   +1.286095725898320e-01   -1.925912216421173e-02   -3.893650172995219e-01   +3.712603116532453e-01; +7.539564974365180e-01   +7.396369569627355e-02   -5.085933683736212e-02   -5.887127205835925e-01   +1.948689224086167e-01   -4.466592143843470e-01   -6.112005389029576e-01   -5.167993547647531e-01; -6.477703682749139e-01   -7.986798808670555e-01   -3.194529242490990e-02   +5.758718506855277e-01   +3.945731754028268e-01   -3.122677491140865e-01   +5.397301982935800e-01   -1.392546519713215e-01; -1.513736952377880e-01   -3.515792514819224e-01   +2.937442802672142e-02   -5.240959601032028e-01   +2.200872401883020e-01   +3.676295611469724e-01   +8.622923289768153e-03   -5.895421547146901e-01; +5.087209184139648e-01   -7.561089427280492e-01   +2.463994341226844e-01   +4.807552958979917e-01   -6.645539817100761e-01   -7.953501613809594e-02   +1.172647185874829e-01   -2.978045342026420e-01; -3.374828614203986e-01   +8.425240447992517e-01   +2.398996649441416e-01   +6.729516175029826e-02   +5.550593880159752e-01   +5.907607822484205e-01   +7.955809269114874e-01   +3.146902481583581e-01; -7.247858075493031e-01   -1.904158445034692e-01   -6.400431268716614e-02   +9.759444777530676e-02   +7.411378505397967e-01   -4.806837989387482e-01   -5.656136703490586e-01   +1.995509854965769e-01];
L2E_L2I_iGABA_netcon = [+6.600436774022468e-02   -3.238479295502322e-01   -4.024031760622140e-01   -2.983194318954456e-01   -4.309089374315817e-01   -9.008637201823423e-01   -3.254325848191752e-01   -3.041460973168060e-01; +2.370523571035169e-01   -8.087959673374570e-01   -1.790523197170005e-01   +5.583033842481927e-01   -7.437774919777059e-01   +4.106078212572760e-01   -5.724499237887647e-02   -5.628696016265525e-01; -9.652505627581909e-01   +5.602137854800163e-01   +6.917028688638943e-01   -3.197722048592231e-01   +2.682198351318349e-02   -2.884013719166265e-01   +8.947955646381351e-01   -1.296048123428394e-01; +9.759988446821870e-01   +3.726818224930444e-01   +5.798349986340135e-02   -4.796745580271058e-01   +4.888735156495801e-01   -2.434082806941863e-01   -9.522648087808890e-01   +3.122485999657481e-01; -5.245052250432108e-01   -3.518006548659169e-03   -1.179233987288670e-01   +5.137309372862059e-01   +2.009955238127540e-01   +7.272617870004454e-01   -2.061814641110684e-01   -4.421014564436790e-01; +8.531015226092861e-01   +2.892587256267327e-01   -2.318667384150500e-02   -1.000000000000000e+00   -6.502543789814114e-01   +9.426224318870504e-01   -2.601607922309331e-01   -7.809034379492928e-01; -1.930255636189739e-01   -5.065839266286307e-01   +2.422298204953624e-01   -3.665286327405790e-01   -5.425404823985257e-01   +6.607079188466305e-01   +1.056576890980889e-01   +3.982736125350790e-01; -5.922486204435539e-01   +3.242894662784809e-01   -4.413006057050775e-02   -5.970068144571863e-01   +6.902560157527372e-01   -4.564642394330630e-01   +7.837898772111557e-01   +4.178713686370196e-01];
L3E_L2E_iAMPA_netcon = [+1.848092671563851e-01   -2.818716432493460e-01   -3.753861858479350e-01   +1.485073646326589e-02   +4.595316425213714e-01   -3.750330649036665e-01   -7.083233029460402e-02   +6.713219611340727e-01   +5.696140769185157e-01   +3.052213007210175e-01   +2.628603377574614e-01   -1.316245562268700e-01; -5.915039969218759e-01   -1.000000000000000e+00   -6.086011604861383e-01   +1.404544448561428e-01   +1.774929749462002e-01   -2.427329825654869e-01   -2.668562052794508e-01   -5.296391226982003e-02   -5.656372808517852e-01   -4.365878221354536e-01   -3.599673324073044e-01   -3.011384346612623e-01; +6.219594649222557e-02   +5.933130330997656e-01   -4.385000471721732e-01   +5.560222593594354e-01   -9.785059955557931e-01   +2.434040225885530e-01   -5.612870597895694e-01   -8.044642324748066e-01   +2.267711176389093e-01   -5.001152602606826e-01   -2.160916467518817e-01   +2.805507845601115e-01; +1.841833359564392e-01   -8.087173329326734e-01   +3.781264976134578e-01   -7.427127758382659e-01   -3.011638064050919e-01   +8.292600511505498e-01   +1.452477669147970e-01   +4.165035829073727e-01   -5.238245677159192e-01   +2.203946739049756e-01   +7.320896480671146e-01   +1.844933032457147e-01; +3.225306234256874e-01   -4.274836832966062e-01   +2.689190672520601e-01   -8.224711463314341e-01   -3.263187856509394e-01   -4.142879085257765e-01   -3.821391461521781e-01   +1.417242915990999e-01   +7.476650429194236e-01   -1.053987782176220e-01   +1.700455922609078e-02   -2.500251397117889e-01; +3.577550803053703e-01   +5.972145265099414e-01   -3.387307572514283e-01   -4.231707560897823e-01   -1.529336316473386e-01   +4.047544196503640e-01   -2.836353074043124e-01   -2.055575352628923e-01   -4.190389651238856e-01   -1.908526298449381e-01   -1.694114620980253e-02   +4.100213637245003e-01; -3.443843718443930e-01   -1.358565020809256e-01   +1.375100013481265e-01   +4.994940419339101e-01   +1.491993898552389e-01   -1.847718535402607e-01   -4.535063697243836e-02   +5.744336298081583e-01   -4.188941354394020e-01   +5.556447577663473e-01   +5.595743480305478e-01   +1.296195004529918e-01; -5.816075605850892e-01   -2.538399632501769e-01   -2.989034714697726e-01   -7.697388369275959e-01   -5.844898425165108e-02   +3.563285232116996e-01   +6.422903906237875e-01   -1.171269477441923e-01   -6.233771404838134e-01   -3.609607923021233e-01   -8.336053555754018e-01   +7.737510381182627e-01];
L3I_L2I_iGABA_netcon = [+2.332249617188817e-01   +2.636131490729655e-01   +5.930313741357666e-02   +2.476200964477994e-01   +4.180005330851722e-01   -9.986800909222301e-02   +1.220018657801037e-01   +6.821607232741459e-01   -1.931179977552505e-01   +4.433314356356550e-01   -3.606430851493882e-01   +8.828614446598930e-01; -2.104837207161480e-01   -5.811602952510126e-01   +3.008942394972179e-01   -2.341175806872240e-01   -4.670465269238788e-01   +4.024210897749910e-01   +3.572362662748388e-01   -3.883353972418095e-01   -3.557785846683060e-01   +3.775897379511554e-01   +1.624961863435678e-01   -3.524574124456470e-01; -6.119356156663230e-02   +7.175109405109757e-01   +1.318063791677146e-01   -8.153782586234708e-01   -2.540445825872714e-01   -2.344297357462876e-01   -1.120269161116577e-01   -6.731188581581548e-01   +4.940574578068788e-01   +9.309762082619842e-01   +2.266057108666450e-01   -2.346303460168171e-01; -3.996837416824977e-01   +1.923436782142471e-03   -2.053916333313349e-01   +5.719510596714066e-01   -1.582475955809251e-01   -7.068647241555335e-01   +6.198225935846479e-01   +2.123579894847501e-01   +2.868712424555545e-01   -2.068538221598148e-01   -6.157627824778520e-01   -1.009567425981314e-01; +2.939550252520065e-01   +5.859299592171894e-01   +5.730852640276746e-01   -5.504721980852030e-02   +5.873735164608294e-01   +2.814468595105967e-01   -4.674817369754380e-01   +6.561108663554588e-02   +1.780612740689341e-01   -6.461348743903045e-01   -2.296609176403742e-02   -2.309843241857192e-01; +3.151612356206416e-01   -7.120884412567743e-01   +3.863703593303199e-01   -2.134374891529791e-01   -4.825233225742259e-01   +1.732757374212566e-01   -4.151681930704060e-01   +1.000000000000000e+00   +9.095350432983746e-01   -5.986481672725021e-01   -4.993462535526773e-01   -7.684893158654171e-01; +8.534896170246088e-03   -2.650299661911306e-01   -2.653447013477228e-01   +7.748968189529809e-02   -9.422598838314549e-01   +5.697960268626684e-01   -1.522200265161279e-01   +3.703746678146019e-01   +3.138925653287728e-01   +2.687543369469432e-01   +4.320395652908360e-01   -1.387247002123860e-01; -4.002074988352686e-02   +3.473500841050819e-02   +6.587335919207582e-01   +9.490409125983599e-01   +1.870419513432816e-01   -2.619576913699478e-01   +2.473983992430246e-01   +3.158874127132896e-01   -4.343142793555040e-01   -5.612647045640993e-01   -2.553220497040997e-01   -6.343233354108175e-01];
L2E_L3E_iAMPA_netcon = [+7.433055354349439e-01   -1.621443901811735e-01   -6.636266980523620e-01   -5.044885353443561e-01   +7.876389360617869e-01   -3.290039855842550e-01   -2.518062699295801e-01   -1.218765777779014e-01; +4.889659927166212e-02   +1.258019930855923e-01   -5.887188607093713e-01   +9.426736588169771e-01   -2.594600064173729e-01   +8.986188391317758e-01   -3.631110373853539e-01   -7.550905720139290e-01; +2.518796864819179e-03   +5.105808164395489e-01   +7.242100582139294e-01   -4.807980443283014e-01   +5.609478364855114e-01   -4.116944113931666e-01   -3.166792758873896e-01   +5.424390895477696e-01; -1.470340465694699e-01   -4.573876644073436e-01   -2.387950280439858e-01   +8.501377064016141e-01   +2.954294470892432e-02   +2.629611478340657e-01   -2.303098179147646e-01   +3.474740406788224e-01; +6.674454041237858e-01   +5.054166442133903e-02   -3.795263541765819e-01   +9.155134771787418e-01   -5.055204900332157e-02   -4.491140565803124e-01   +6.036049897367510e-01   +3.807848587219434e-02; -1.651598084746062e-01   +6.328766021987524e-01   +6.278355243612276e-01   -7.681611220065906e-02   -4.630991734166305e-02   -7.210461940521665e-01   +8.580838872697738e-01   +2.539970293351121e-01; +3.176497993265006e-01   +4.921690444667442e-01   -2.258175709041605e-01   +7.134073895082459e-01   -6.283758871666691e-01   -2.878415131925266e-01   +3.391869236353148e-01   +1.000000000000000e+00; -5.077630325872254e-01   -4.236072410804664e-01   -9.502668156054074e-01   +3.234974258000936e-01   +1.672422268961488e-01   +6.228078005204557e-01   +9.257576797603420e-01   -2.240446182787259e-01; +2.277648747342973e-01   -8.578029636930329e-01   -1.033589749872900e-01   -3.699785976171805e-01   +6.967229375538534e-01   -2.788968140573981e-01   +2.506897992103959e-01   +2.832149776575643e-01; -7.948742157982258e-01   -2.885870509789956e-01   +5.969228318544435e-01   +4.805188159059572e-01   +4.909991145051282e-01   +3.812291905774414e-01   -4.262959459233487e-01   +1.235978718211817e-02; -7.911496917491366e-02   +8.434295792577329e-02   -6.411624396700425e-01   +4.415880560633208e-02   +8.114568529411814e-01   +3.332294265927981e-01   -2.984717660530333e-01   -6.891844857795807e-01; +3.912429147504483e-01   -5.365160486626173e-01   -8.460723573453770e-01   -1.736517127520951e-02   +2.388231922734722e-02   +8.367544358632957e-01   -1.398765155561489e-01   +1.684175126140430e-02];
L2I_L3I_iGABA_netcon = [+3.137725955237793e-01   +4.932431980990211e-01   +2.324853474861694e-01   -1.833057563175549e-01   +1.000000000000000e+00   +1.389658894858995e-01   -2.867950819146091e-01   -9.565635146164485e-02; -2.380342324232898e-02   -3.692496881225433e-01   +1.555236710063426e-02   -8.640082501215113e-01   -3.396610114906735e-01   -2.242001419253299e-01   -5.963639472435439e-01   +4.164102252855080e-01; -1.976244503431738e-02   +5.601265858945978e-02   +1.916572704016463e-01   -7.246786972324845e-01   +5.919994665606553e-01   +6.346908525237225e-01   +9.200705853215231e-01   +2.432817542441339e-01; +8.127683006988450e-02   +1.652970155339432e-01   +3.814829535808375e-01   -3.489933746345298e-01   +1.347614614361441e-01   +4.484540220045484e-01   -4.760213997169643e-02   -7.869868860712850e-01; -7.665331109738356e-02   -3.604874202027366e-01   -3.726667793158001e-01   -6.640497957037323e-01   -9.830629637758863e-01   +2.559475121358294e-01   +5.928936414652476e-01   -3.882604200112647e-01; +4.392931481451733e-01   -1.728045814108065e-01   -3.114384780387514e-01   +1.604365678427347e-01   -7.293924441744413e-01   +7.164112593001790e-02   -5.857555244835880e-01   -6.185243746904679e-01; +2.916061832834724e-01   +2.039264327617477e-01   -3.470722896368984e-01   +7.870413276970217e-01   +6.897898096959527e-01   -2.759532894138537e-01   +1.305923918095633e-01   +6.617832256711061e-02; -6.880072150438734e-01   -7.091613940987631e-01   +5.616380632133655e-01   +1.972890689725574e-01   +1.999874475136601e-02   -8.713200883277847e-01   +1.386666405357696e-01   +2.106472135425906e-01; -2.152254230199225e-01   +1.829071116561119e-01   +1.680465568073844e-01   +2.790261119937677e-01   +6.011958443529719e-01   -1.771600813774596e-01   -1.388047132476097e-01   -3.855488739821819e-01; -2.189107363040944e-01   -1.781621778041103e-01   +5.394833098704535e-01   +1.821914132025575e-01   +4.025801074908736e-01   -2.601040194360104e-01   -7.610376703794869e-01   -1.886798756558188e-01; -3.929634003487266e-01   -3.504627419935416e-02   +3.148167703598639e-01   -3.566516599174608e-01   +8.192123190977962e-01   -4.228006785874148e-01   -6.286212801071236e-02   +2.547486520007787e-01; +2.527478980939414e-01   -6.661649649576314e-01   -1.463609178203977e-01   -2.227919354932809e-01   -5.103570621335257e-01   +5.048075748061941e-01   +9.451292847574376e-01   -9.524866538954648e-01];
L3I_L3E_iAMPA_netcon = [-5.339070695254603e-01   -6.653224114430886e-01   -5.540557823059533e-01   -3.478842037998714e-01   -6.783965894130599e-01   -2.879418029555090e-01   -4.466544219773821e-02   +1.835318771763430e-01   -1.870281758704110e-01   -3.928817618782732e-01   +1.403671359178277e-01   -3.092522696832432e-01; -1.114278184176611e-01   +5.965492317770502e-01   +2.066158275102062e-01   -9.296091999666227e-02   -1.875325738806642e-01   +1.264502708369981e-01   +3.814355052522042e-01   -3.929367350469491e-01   -3.745990311071448e-01   +2.364952177260669e-01   +8.400228892482449e-01   -4.574061996731988e-01; +2.287519742438005e-01   +4.404576092115052e-01   -3.853088411311106e-01   +8.552132827647454e-01   -1.383207142744704e-01   -7.011765248046250e-01   -1.033698871813673e-01   -9.872428647512940e-01   -5.657325984101439e-01   -8.911809085817097e-01   -3.777229386337561e-01   +2.076323819328770e-01; -6.949444261175949e-01   -2.962245347571071e-01   +3.391611366349989e-01   -1.173802361067389e-01   -4.789948103714969e-01   +3.933614459891814e-02   -6.901479884593466e-01   -7.154276371952184e-01   +7.191160784069661e-01   -5.620091144066540e-01   +1.851446396361698e-01   -7.543107036030093e-01; -4.354810307778335e-01   +3.301624319561359e-02   +4.116216569217442e-01   +3.999977556182541e-01   -3.436035127548007e-01   +3.919274164188474e-01   -7.648879243936607e-01   +1.401819954779318e-01   +1.304585933890857e-01   -5.276598715967610e-01   +2.322431918184750e-02   -4.198080214519916e-01; +7.124181135140140e-01   -5.204310735829583e-01   -4.016134151952729e-02   +5.503302158181272e-01   -3.753541422114242e-01   -4.529765503503011e-01   +7.804629916105034e-01   +6.417310071742897e-01   +4.905932933070309e-01   -2.992857442477254e-01   -5.557774983801060e-01   +1.857346092930582e-01; +5.905722753788534e-02   +4.156010608222851e-01   -7.947743205085444e-01   +5.532429432111260e-01   -1.411878277901553e-01   -2.481184596782271e-01   -3.753551776575030e-01   -1.598062855739583e-02   +6.144551987990666e-01   -8.669063372197946e-01   +1.115539328771064e-01   -5.536355046120111e-01; +6.412779891532897e-01   +3.480705932222234e-01   +3.194860517727880e-01   +2.225973463070528e-01   +3.963388887403558e-01   -2.589857246332001e-02   -5.287095073176690e-01   +7.589407227781471e-01   -2.214528659017894e-01   +7.782485784152455e-01   +3.543946801274503e-01   -6.006589455802590e-01; -6.079380840877263e-01   -5.349756481539151e-01   -2.849484314477523e-01   +3.783736556549050e-01   -2.354754296950706e-02   -2.056446630189103e-01   -6.315919038816888e-01   -3.376865865911956e-01   +5.335297290123759e-01   -4.756224965876236e-01   -1.481103427540199e-01   +1.277311512186818e-01; +1.050543690736181e-01   -1.044226884357108e-01   +2.037031143914924e-01   +1.160365044469230e-01   +1.000000000000000e+00   -6.760428280957869e-01   -1.347767999306651e-01   +2.817356260456954e-01   -6.811529403792661e-01   -2.512786883962423e-01   -1.138688257908360e-01   -5.178402131448477e-01; +3.652170449709287e-01   +1.008953855662563e-01   -3.802511720504185e-01   -5.162692173445167e-01   +3.358660038195262e-01   +8.097886683909050e-01   +4.307472863267982e-01   -2.244357611180716e-01   -4.358064529403243e-01   +3.816156429173677e-01   +4.513565061620810e-01   -1.558267103704316e-01; -2.117877116296783e-01   +2.371229506149131e-01   -6.649013790882522e-01   -2.954741275522037e-01   +7.041195689512956e-01   -4.672503762881079e-03   -1.033066178634847e-01   -4.161774504994197e-01   -4.367862780314711e-01   +7.267446154665991e-02   -2.161965381370947e-01   +7.924514770312425e-01];
L3E_L3I_iGABA_netcon = [-2.659502141401569e-02   +4.780754924221506e-01   +5.173601395691342e-01   -4.146948205498283e-01   -4.277939766796078e-01   +4.764922657021849e-01   -7.145798958611483e-01   +5.762240633403015e-01   -9.569885102752635e-01   -4.037507109280952e-02   +8.059723556647823e-01   -4.090968316841299e-01; +6.107140358124712e-01   -6.290530307427951e-01   -8.487340236115117e-01   +2.297867362118831e-01   +3.924510033173693e-01   +3.575034441525804e-01   -1.692121012920846e-02   -1.426476810240780e-01   +4.766069274297838e-01   -5.088282774562575e-01   +7.849293938311340e-01   +6.058930900456585e-01; -2.535503662556457e-02   -9.080636580238483e-01   +3.975084305602243e-01   +7.004045417133269e-01   -2.104681748702427e-01   -1.884267338186979e-01   +5.785755997998310e-01   +4.963784327016902e-01   -2.849334342240508e-01   -1.469701696014832e-01   -4.222521406715574e-01   +1.739636241839287e-01; -4.421497057177156e-01   +8.633081527131737e-01   +6.303267393014055e-01   +4.261431738897170e-01   -2.933062933628293e-01   +3.394817744095799e-01   -1.023315434949605e-02   -8.016582776057017e-02   -7.748461680943255e-02   -6.677761671643532e-01   -1.560099732390271e-01   -3.581684384123903e-01; -3.626200330640420e-02   -4.705008924886293e-01   +6.571457777599995e-01   -1.785709902278199e-01   +3.434251430989358e-01   +2.017768203780404e-01   +4.521320684787092e-01   +1.746041743865215e-01   -5.445878274434944e-01   +8.486936465701850e-01   +3.912147581184523e-01   -8.575351469581308e-01; +5.841205808313581e-01   +3.653185712236428e-01   -3.586952414454785e-02   -7.504767614528378e-01   +3.827825908668126e-02   +4.245903202172907e-01   -7.944904564160860e-02   +6.393277729256936e-01   +7.107255829440375e-01   -6.781355654670858e-01   -1.141419626052871e-01   -2.305170490429690e-02; +5.644981288515569e-01   -4.854378972372089e-01   +5.659768373646422e-01   +3.323483672625457e-01   -8.480026853201554e-01   +1.180863811962702e-01   -1.871007757764707e-01   +1.076441153228551e-01   +6.281872921178276e-01   -5.879852220053138e-01   -7.579518189109180e-01   +1.296403278831741e-01; +8.621796439094722e-01   -1.522004199558150e-01   -3.558662014458613e-02   +4.831555989950583e-01   +5.714419094806896e-02   +4.256561455233590e-01   -7.007104573653485e-01   -4.120575267623006e-01   +2.514156692291705e-01   +1.000000000000000e+00   -9.013496895704048e-01   -1.873125231682929e-01; -8.461796422757494e-01   +2.338990931056577e-01   +5.106580907516916e-01   +1.668019194980641e-01   +1.364824532618849e-01   +5.774960672857310e-01   +1.943544271954515e-01   +5.865518241653579e-01   +6.403280752092216e-01   +5.102504393885925e-01   -2.154182191514565e-01   -1.489852000106759e-01; +3.548392156864755e-01   -7.058852394357358e-01   +3.864371170554277e-01   +1.364443508058562e-02   +3.359130139644192e-01   +1.563415219683865e-01   +4.756129455742455e-01   -2.089513068473675e-01   -6.687479459925416e-01   +6.205214036515247e-01   -6.471548492153694e-01   +7.897100660111525e-01; -1.954164509697743e-01   +4.049068077071709e-01   -1.589351648028307e-01   +5.629814202464116e-01   -5.544712403009304e-01   -6.330190059303537e-01   +4.542003461427657e-02   -5.460209300088033e-01   -1.282571009979810e-01   -1.117099417461428e-01   +3.853275434003498e-01   +2.475094231153117e-01; +2.380482272130261e-01   +3.635379585092567e-01   +5.605342913242821e-01   -5.513615726409404e-01   +5.146946920534270e-01   +6.415164453492025e-01   +1.197026204276025e-01   -9.271952247645628e-02   +8.580584794719734e-02   +3.249446537176930e-01   +1.125644933478573e-01   +1.340850825339341e-01];
L2E_Input1_iAMPA_netcon = [-4.188062668423997e-01   +3.306051974055729e-01   -3.459988852571306e-01   -2.202665454513116e-01   -1.000000000000000e+00   -9.284575550237257e-01   -4.580609714949816e-01   +4.164371166105337e-01];
L2I_Input2_iAMPA_netcon = [+1.000000000000000e+00   -4.857737503699850e-01   +8.874486606140025e-01   +8.936971344684519e-01   -6.212409329028982e-01   -2.558124745895869e-01   -3.456732137868631e-01   -7.988569944584741e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last =  11.21 * ones(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))*0.4 + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.5*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.5*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))*0.9 + 0.5*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))*0.4 + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.5*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.5*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))*0.9 + 0.5*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
