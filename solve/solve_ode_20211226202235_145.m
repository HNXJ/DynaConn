function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+1.603054912997356e-01   +1.896389000508356e-01   +3.092525421317596e-01   -1.484909955573771e-01   +2.091488657882590e-02   -3.149502140603120e-01   +2.464588033450513e-01   -2.484909079661472e-01   -2.290178143937530e-02   +3.116534031249519e-01   -4.495801153329536e-02   -1.646854684952778e-03   +1.526085683173013e-01   +1.935129748284878e-02   +6.886484204760708e-02   +6.335897233999643e-02; -6.832635710603524e-02   +4.564694605187693e-02   -1.943453014542879e-01   -4.893997158345242e-02   +4.171563059545419e-02   -3.684875590641571e-01   +9.029678676202352e-02   +1.822285330653343e-02   +1.473130155709633e-01   -2.000014902743548e-01   +6.640634593185187e-02   +1.264647356123820e-01   -4.674141608209678e-01   -2.507842163947537e-01   +1.044595856948211e-01   +1.107875742823838e-01; +7.200736411662103e-03   +1.040226073406861e-01   -2.513966115270045e-01   +2.622806091937965e-01   +2.818316786797982e-01   -3.880662010431168e-02   +5.981122150541732e-02   -1.631658869953826e-01   +1.166061180093601e-01   -8.307262337826805e-02   +1.788778106189007e-01   -7.061781195213827e-02   -4.446846631877101e-02   -5.553268885946072e-02   -1.388698108220165e-01   +1.882646831433414e-01; -1.304817327691423e-01   +1.806573456712798e-01   +2.577560528178230e-02   -3.424897741207478e-02   -1.253068429574468e-01   +1.091681491788758e-01   +1.287254404013487e-01   -3.814465299993958e-02   -7.893586509064829e-02   -4.238162843799194e-01   +2.180701616427687e-01   +1.821917173939422e-01   -2.378097139308986e-01   +2.394690479581986e-01   -9.900004310199887e-03   +5.666792001753590e-02; -1.173216089927607e-01   +3.945471132749999e-02   +1.042180046791692e-01   -2.430389797902436e-01   +5.427868737022382e-02   -4.889915817543874e-03   +1.901762762545361e-01   +7.949375712934721e-02   -6.984871901065286e-02   -1.483576661746286e-01   +2.109233861617407e-01   -1.336336808074256e-01   +6.971907386325810e-02   +1.573601152124144e-01   -2.162324423041638e-01   -5.007114310140885e-02; +1.570074340387363e-01   -2.846340228418175e-01   +8.895107451343240e-02   +8.378646690982300e-02   +1.236804624482689e-02   +1.180824266574108e-01   -1.161389628823177e-01   +1.184383390512819e-01   +3.644989842316592e-01   -2.537629292142037e-02   -3.610972504045762e-02   +1.303301919403581e-01   +6.753321137074657e-02   +2.768986018994961e-01   -1.526784853842216e-01   -1.069292342390519e-01; +1.480587114471235e-01   +8.828628346611478e-02   -1.017561744193678e-01   +1.156251496682951e-01   +7.142422618594269e-02   +1.345775144685299e-01   -1.526916061330656e-01   -3.019892183921092e-01   +1.136803616709172e-02   -1.748084187290966e-01   +6.471876050116547e-02   -7.966822122391744e-03   +1.110996723470988e-01   -1.206555629176341e-01   -2.189496793502620e-01   +1.887057460649580e-01; -1.036866148782659e-01   +4.535615442503889e-01   +2.383075961075691e-02   -2.776032835597194e-01   -1.429164863425852e-02   +1.540866220548654e-01   -1.446817861830257e-01   -1.664323874965493e-01   -2.095455697389476e-01   -2.173462841582133e-02   -7.211005259889688e-02   +7.000207447256510e-02   +2.091816650657747e-02   -2.303527130434193e-01   +5.353308151372160e-02   +2.649343492826856e-01; +1.225043713266730e-01   -2.229381447826229e-01   +5.354126472115099e-03   +6.009193977521376e-02   +7.342279140976919e-02   +6.294785832138218e-02   +2.507489715583660e-01   +3.599064307082717e-02   +2.986948609020196e-02   -1.184478034534095e-01   +4.888473096069766e-02   +1.321651336422222e-01   +1.234774300377250e-01   -1.400826264997446e-01   +8.018159386639472e-02   -3.758076177851650e-02; -1.243069490487271e-01   +3.030394972770269e-01   +3.547600621129206e-01   +3.949855480011850e-02   -7.176004401045427e-02   -4.801433514258180e-01   +1.857721694948547e-01   +1.918892274057561e-01   +3.035135280978969e-01   +1.180920100629952e-01   +4.555627086450872e-01   +3.464610125394292e-03   -1.797279235380240e-01   +1.353751656559654e-01   -3.801800333512440e-02   -8.342543935258337e-02; -2.184458157922452e-01   -3.027659484229578e-01   -2.843345540366174e-01   +1.139907915258430e-01   +1.562898742563688e-02   -1.319448856223539e-01   +2.256873853073577e-01   +9.639801393600041e-02   -1.841520976816749e-01   -2.438573363399569e-01   +2.656255606922614e-01   -3.385400584388026e-01   +4.135076541610994e-01   +1.200931474800096e-01   -1.376518779884688e-01   +1.330095690657973e-01; +1.279353184211417e-01   +2.599444856843343e-01   +2.115796222287365e-01   -1.113518205973119e-01   -1.465804850561055e-01   +3.394370308993600e-02   +1.184790565118773e-01   -2.276989133138082e-01   +1.477711036918014e-01   -1.376598222791251e-01   +1.730051711121868e-01   -1.581012908056968e-01   +1.779284090916425e-01   +8.214246740979691e-03   -1.505159667691572e-01   -1.413785368525886e-01; +1.448727764555741e-01   +2.684507659960453e-01   +2.398032209823232e-01   -1.773171486093962e-01   +9.793884709699952e-02   +1.332246684316333e-01   +4.020864405673438e-03   -7.199834007488977e-03   +6.034715716155611e-02   +9.499491380502335e-02   +1.994497160248325e-01   -1.498880923452132e-01   +3.451649060245972e-01   +2.251832847391216e-01   -1.713560045727100e-01   +1.954306827093734e-02; -1.568776199701817e-02   +1.137527701602883e-01   -8.840586212425003e-02   -8.050329121314527e-02   -8.221772650287107e-02   -2.781562732231600e-01   -2.510217214795175e-01   +2.548336131609946e-02   -1.872285562885464e-02   +1.716440257922466e-01   +4.560634248202005e-03   -2.806101837177919e-01   -6.866051546747887e-02   -1.217001094698433e-01   -1.290023528046583e-02   +4.084988094020827e-02; +5.334020448121346e-02   +2.124830564877352e-02   -1.306820313811464e-01   -5.647077990603015e-02   +1.988917714092592e-01   +1.358660003306753e-01   -1.947232167814777e-01   +1.355876864043647e-01   +9.981382401383580e-02   -1.972279385661997e-01   +1.639893775949660e-01   -1.375078433732912e-01   -2.853709507454211e-02   +2.990567567007179e-02   -4.534074386074072e-02   -6.137844220293093e-02; -9.989584101920604e-02   -1.819279376570345e-01   +9.076488495367108e-02   +7.633790007642560e-02   -1.037838105600312e-02   -6.416357081345019e-03   +2.372869432561411e-01   -4.655405932414166e-01   +3.767170145500884e-01   -1.580194924386585e-01   -2.962788701422561e-01   -3.182395794082687e-01   -8.179662590695372e-02   -5.635254091041103e-02   -5.394515494351148e-02   -1.674575481905331e-01];
L1E_L1I_iGABA_netcon = [+1.900358349104018e-01   -1.540788749293800e-01   -1.967820979226718e-01   -4.122616935538677e-01   +1.655195509771535e-01   -3.475689246052960e-01   +3.466794621986076e-01   -1.066134215800959e-01   +8.111241333350749e-02   -7.456804971135741e-02   -1.098227061696585e-01   +2.577813816059333e-01   -2.108050274857262e-01   +1.009543458176843e-03   -1.051084810918858e-01   -3.468198823445052e-01; -2.373811622069828e-01   -2.366933514825163e-01   -1.140420180510093e-01   +5.693423845637337e-04   +2.321164030982952e-01   +5.119651803426762e-02   -1.296844108204578e-01   -1.487977494785918e-01   +1.393223088553154e-01   +1.264413857207308e-01   -6.783383557743085e-02   -1.096575919628284e-01   +1.172006668831092e-01   -4.229231624307287e-02   -1.134210429510670e-01   +9.708182890916797e-02; +2.092407166261445e-01   +5.708382719260562e-03   -7.830703841546488e-02   +3.027608872821315e-01   +2.742938062331973e-01   -1.525923612926169e-01   -5.637569951223059e-02   -8.869697450588400e-02   +9.416942509404222e-02   +1.515701979529722e-01   -6.066121913229586e-02   -1.579213726099978e-01   -1.178656345873849e-01   +7.949499946968679e-02   +1.915221168172264e-01   +3.307590771559138e-01; -7.755855432777631e-02   -3.244384607908536e-01   -3.433328134298018e-01   +1.958894044178760e-01   +8.839483292758889e-02   +1.544735624923362e-01   +1.558341846967801e-01   -1.619802287388504e-01   -2.170515726183541e-01   -9.879441658788570e-03   +5.520457390977521e-02   +2.117906675963187e-01   +9.931261624268686e-02   +1.705445967788258e-01   -2.187887990665514e-01   -2.902238036374690e-02; -9.874870230284648e-02   -5.480180136201643e-02   -2.409797694520468e-02   -2.204853707163235e-01   -7.515799490626383e-03   +8.489472215030833e-02   +9.332742438289310e-02   -3.745906561244147e-02   -1.026648415735986e-01   -1.280086316482108e-03   +8.898532680419083e-02   -1.391110313874102e-01   +2.065063219387766e-01   -4.032907983633802e-01   +4.149130131270126e-02   +2.335726645865758e-01; +1.430880594147518e-01   +8.235831639300689e-02   +2.538002306492859e-01   +2.210946448385001e-02   -5.220917505732891e-02   -1.252436571756823e-01   -2.529260001680544e-02   +1.199211721471943e-01   -8.103789130759680e-02   -2.088755771254397e-02   +3.101698364606106e-01   -1.227656515534321e-01   +8.770223059632007e-02   +4.899885224264957e-02   +2.285188958155187e-01   +1.939261642268631e-01; -5.890724048868350e-02   -8.925115853893709e-02   -2.610098725556992e-01   +4.404501201390831e-01   -7.329076222068455e-02   +3.205732704048468e-01   -2.115891298408197e-01   -1.119020272144861e-01   -2.176637760110068e-01   -1.757026255618819e-01   +4.682922843707615e-02   -2.014160021687813e-01   +2.813493512317938e-01   -1.901449204606314e-01   -1.267793290988791e-01   +9.733823928497513e-02; +1.056381668918371e-01   -1.628034980981052e-01   +1.413157806372438e-01   +1.511885285941093e-02   +2.401496409246416e-01   +4.149341900173065e-01   -1.501668490346945e-01   -1.176279119746292e-01   -1.928219939563971e-01   +1.280243353430488e-01   +2.547350971643116e-03   +2.403235904694815e-01   +9.293223525638891e-02   -1.009333623838231e-01   -3.132337163642998e-01   +1.925998264978279e-01; +8.241394210268377e-02   +2.615136875913966e-02   -2.073131809068263e-01   -8.932383306889259e-02   +3.719793657007487e-01   +9.685502797499292e-02   +1.752518866595997e-01   +1.981828820831501e-01   +3.126319338448781e-02   -9.946434551504602e-02   -6.208143270784776e-02   -1.496525069556156e-01   -1.240544763446645e-01   +1.750788527747402e-01   +1.075330806099484e-02   -9.946429391777993e-02; -9.020312631303870e-02   +1.107452466355511e-02   +2.901892219694888e-01   -5.758984669853279e-03   +1.635263987558325e-01   +5.831071743050600e-02   +9.863495385507474e-02   -1.981498714012564e-01   -1.516381405422388e-01   +1.541624140723341e-01   -3.631320056065452e-01   +2.387887139919176e-01   -2.046060885580500e-01   -2.313867090400929e-01   +3.884465286576987e-02   -1.602306244160177e-01; +1.292676693688909e-01   -3.241686091035515e-01   -1.534231991708208e-01   +1.765710680629250e-01   +1.754995065001849e-01   +9.526115918184666e-02   +1.125741276415763e-01   -5.946147808609961e-02   +2.215775664136661e-01   -1.793051639139388e-02   -1.401124463030797e-01   +2.864455923789686e-01   -9.081342456847603e-02   -7.786594936677135e-02   +8.191431358172137e-03   -1.213890909318562e-01; +1.094478100506918e-01   +2.406081679647386e-01   -1.699300828952357e-01   -2.118615493219706e-01   -1.623603487362196e-01   -7.086315722581275e-02   +2.527234127708087e-01   +1.174844444160593e-01   +1.254576531414475e-01   -2.556990917441148e-02   +1.372615526888679e-01   +2.568883527860813e-01   -1.074573089591150e-01   +9.669070947464428e-02   -1.182525988344720e-01   -7.985569931008302e-02; +7.937710679635666e-02   +8.228111246957617e-02   +9.061958401532875e-03   +1.356389956986870e-01   -8.829094679294043e-02   +1.392904550656970e-01   -1.713964778386002e-01   -1.142479848118190e-01   -2.846700934602193e-01   -2.701024784670835e-02   +1.656499667364086e-01   +1.755782100657126e-01   +1.369815545104622e-01   +1.624316651672310e-01   +1.077074836316129e-01   +1.455233258517484e-01; +2.335670413407599e-01   -6.957876400366207e-03   -1.580644676445618e-01   +2.986460392551679e-01   +1.889570922447269e-01   -7.359417747339256e-02   +4.795070588110138e-02   +2.587045138817189e-01   -1.291432536156429e-01   +1.690994526607571e-03   +1.178321685873872e-01   -4.789042327530434e-02   +1.827807310917815e-01   -1.387986514146307e-01   -1.528388451099771e-01   -9.496271031921194e-02; +1.331074468122190e-01   -2.633697204339346e-02   +1.079066496967032e-01   -2.310008649376108e-01   +2.760662951047511e-01   +4.015478388150101e-01   +1.623076383409586e-01   -5.596910486386326e-02   -2.688778911525134e-01   +1.293952179996892e-01   +2.185448682600222e-01   +1.231525093197863e-01   -2.195587069131746e-01   -6.943222125010740e-03   -4.938405083046779e-02   +1.200343040987481e-01; -5.875722435117900e-03   +7.763230128122217e-02   -1.602167235076310e-01   -1.612270901064808e-01   -9.744873939137258e-02   -6.386869041551488e-03   -1.063494660766975e-01   -2.561501722255828e-01   -8.228761778007980e-02   -1.461245741698507e-01   -1.596357289601187e-01   +1.252340903639672e-02   -7.477354325450147e-02   -4.061335099395601e-02   +8.893458478614000e-02   -2.687365649403393e-02];
L2I_L1I_iGABA_netcon = [+3.421236248189547e-01   +2.358221988199969e-01   +6.542696331194078e-02   -1.254129279457172e-01   +1.745407799959348e-01   +4.077675498488297e-02   -8.807120506229539e-02   +2.361912897252386e-02; -9.460719577795840e-02   -1.742851580012383e-01   -1.019934255727190e-01   +3.269691319002601e-02   -4.788812259047766e-02   +2.451584669760194e-01   +1.745526741473484e-03   -2.833177335362368e-01; -2.128633731748230e-01   +2.339298258094332e-01   -7.132556515652277e-02   +2.796171762086141e-02   -1.234868715465785e-02   -1.577359484100450e-01   +1.900794072082145e-01   +1.160965111712794e-02; -3.476743404759809e-03   +1.049234065441272e-01   -3.224871654260288e-01   +3.813294842115963e-02   -1.660370720543512e-02   -9.895312412474797e-02   +3.579282664434282e-02   -5.689939527879063e-02; +1.491893290284538e-01   +1.383689995715557e-01   +2.053942448771147e-01   -1.533612566220576e-02   -2.982027969194538e-02   +1.241445071001113e-01   +1.805583781956336e-03   +1.775073498445965e-01; -8.019976432350813e-02   -7.900144876054349e-02   +2.783028784717527e-01   -1.397511183558019e-01   +7.618581493004198e-02   -2.284319247274756e-01   +2.244852359358143e-01   -1.267344133211244e-01; +2.281419286961381e-01   -8.147225419494242e-02   +2.009037792563877e-01   -3.200261321635860e-02   +3.930747253463502e-01   -3.567099018461698e-01   -9.770723021161720e-02   +5.211022820643892e-02; -1.805798794320001e-01   +2.758027734040774e-01   +1.760494270743428e-01   +2.268681428170286e-01   +9.933821624061162e-02   +1.312070899338505e-01   -6.715584835992941e-02   -2.509541062050248e-01; -5.656646054289691e-02   -1.716246906855665e-01   +4.541791830667054e-02   +2.761302065442681e-01   +6.624449404734366e-02   +2.046187999539048e-01   +8.666936256378975e-02   +1.583161843916753e-01; +1.961758191732770e-01   -8.270092615114072e-02   -3.243346922430862e-01   -1.286747061490334e-01   +1.690305755312218e-01   -2.388809774579657e-01   -7.271225330235578e-02   -8.725453983248966e-03; +8.174061506999082e-02   -4.083285028630675e-02   +1.182643255046964e-01   +1.107321859842462e-01   -1.189667699049128e-01   -3.416304359560298e-01   -2.033892114379716e-01   -4.212832276196538e-01; +6.447848211706311e-02   +2.773351005463059e-01   +1.326528941430062e-01   +6.469000222155843e-02   -9.595734654473756e-02   -1.948606686651667e-01   +2.730819021967199e-01   -1.144199547781705e-02; +9.280974775077580e-02   +1.901068352787516e-01   +1.754551673153721e-01   +1.611849316087301e-02   +1.047236560036652e-02   -2.452335724749080e-01   +8.520861271546637e-03   +2.192581783337178e-02; -5.684078378773480e-02   +1.585672205098801e-01   +6.519164046285872e-02   +1.198115238664483e-01   -1.346162624470880e-02   -3.196598961605886e-01   +2.831198481583395e-01   +8.894401132627162e-02; +1.538828849413558e-01   +3.246290215243872e-02   +8.814670746701649e-03   +1.576233387105301e-01   +1.411180224613426e-01   +2.245659113340717e-01   -6.677474596120976e-02   -8.950808216261324e-03; -1.386064760720710e-01   +1.031664451347767e-01   -1.771003631181214e-01   -8.173205914546094e-02   +3.603962568748933e-01   +6.248837497568154e-02   -5.666300957729681e-02   -4.116874783115250e-02];
L1I_L2I_iGABA_netcon = [-3.347620641914567e-01   -1.316998297658026e-02   -1.838533979892986e-01   +9.199155205713248e-02   +1.237388868309957e-02   +7.565058659910967e-02   +3.779786336207343e-03   -1.690591113587590e-01   -1.272643142728316e-01   +3.185036642765174e-02   +5.984675279428481e-02   -1.708457025396724e-01   +1.913255506883564e-01   -1.652334686388978e-01   +1.449253731661479e-01   -3.028504736745236e-03; -5.638686058440311e-02   -6.235012721559335e-02   +2.046720770960481e-01   +7.419459073939223e-02   +1.660267621068572e-01   +1.008358428209364e-01   +1.257564532535785e-02   -1.104896673129265e-02   +5.027596549095982e-02   +1.896998460136772e-01   -6.237598538785222e-02   +3.630442389275575e-02   -6.277199508709089e-02   +5.002690712058269e-02   +1.568641668647940e-01   -9.293365840796368e-03; -2.530698120769496e-01   -9.877924525774795e-02   +2.492757605357835e-01   -1.140745277674780e-02   -1.316910395817296e-01   +1.224975975729122e-01   -1.008623510027935e-01   +1.188884198016545e-01   +7.020924616481045e-02   -3.438122907905605e-01   -1.630568405614355e-01   -3.382385951507710e-01   -2.469037497312972e-03   -1.982188018930622e-01   -2.377813244594918e-01   -7.307126351869257e-02; +2.955066345085609e-01   +5.780498799942829e-02   -2.548123614777176e-02   -6.584654077947780e-02   +5.686855260675392e-02   +1.136548366069945e-02   -2.606155530002998e-01   +1.998290664538762e-01   +2.280379006299970e-01   +6.222771495169664e-02   -1.109780442370916e-01   +2.529626527808048e-01   -2.235276402302890e-01   -3.045954408532848e-01   +3.034864454867449e-01   +1.697881335498098e-01; +1.373597196557198e-01   +2.070401291616329e-01   +1.702063486371859e-01   +3.789096281175221e-02   +2.498749331813528e-01   +1.611139665018509e-01   +1.409842939109778e-01   -1.501497927285717e-01   -1.806936705342338e-01   -1.270742447718807e-01   -1.518260338536242e-01   +7.991802990827589e-02   -7.178056887749544e-03   +2.459135443781670e-02   -3.541113404395278e-02   +1.618830580828292e-01; -9.590326360904242e-02   -9.760884038012338e-02   -2.117295863425763e-02   +1.820633086046904e-01   +5.121923977665387e-03   +9.895432300339438e-02   -7.457508572460075e-02   +7.493158272780528e-02   +2.235752152225219e-01   -1.041453094630188e-01   -2.098609275555628e-01   -4.056632264959473e-01   +1.183975783313636e-01   +3.762328430931490e-02   +2.941277528954071e-01   +2.186361861818812e-01; -3.370817307848217e-02   +2.250777569919943e-01   -1.735672182186611e-01   -3.605910352854549e-01   +8.020152720845659e-02   -7.393109893057363e-02   +9.029627804396671e-03   +1.198765616611232e-01   -7.418375014112231e-02   +3.762282056627073e-01   -1.441545998755810e-01   +2.848961221328813e-01   -4.873114586987250e-02   -3.823119251199222e-02   +6.764302733682259e-02   -4.193023224630025e-01; -1.354374996412960e-02   -3.232592436825958e-01   -1.601053264533822e-01   -2.357524699906572e-01   -2.213861110185907e-01   -1.324524427135211e-01   +6.966048275329564e-02   -2.622608905862426e-01   -1.958923108536351e-01   -5.169827720403716e-02   -2.408305612365871e-01   +1.409120577197080e-01   -2.028737768017138e-01   +4.976815403488179e-02   +3.210774878461666e-02   +4.057497060708317e-02];
L2E_L1E_iAMPA_netcon = [-1.225144399115826e-01   -2.535188213290059e-01   -2.651280389542642e-01   +1.719367946936502e-01   +2.964371954668018e-01   +1.653003499823608e-01   -1.809646343294951e-02   -5.957938282815075e-02; -2.174681199834043e-01   -2.962804568459514e-02   +1.796026338971316e-01   +8.711145626619010e-03   +3.108470029806345e-02   +2.567929332969703e-01   +4.173551426985933e-02   +3.801642494772157e-01; -6.176354923472573e-02   +6.324483210749475e-02   -2.170301051404910e-01   -8.830997600305601e-02   -3.833262268086719e-02   +4.858228401752261e-02   -8.644571813507695e-02   +5.872083223353908e-02; -3.177060075741369e-01   -1.034067654163437e-01   +1.751180991909491e-01   +1.527816203681756e-01   -6.358682136059492e-02   -3.155849878650881e-01   +7.538362582930080e-02   +1.875662739954537e-01; +3.370546227905054e-01   -7.276064757587929e-02   -8.707585621917317e-02   +5.462137240013538e-02   -1.202826881716992e-01   -1.614727710865497e-01   +1.306617313554485e-01   -2.283456513780716e-02; +1.085340065530799e-01   +2.603411838590296e-02   -2.330036799249458e-01   +2.989131624463476e-02   -1.628701412151401e-01   +3.238643025656984e-02   -1.419486970562562e-01   +1.283833254003148e-01; -1.638445157239079e-01   -1.857549700915486e-01   -3.232335224055416e-02   -9.696880817509658e-02   +1.832820465064961e-01   -3.510607827530111e-01   +1.974898040345504e-01   -5.495360775218595e-02; +6.268702782843646e-02   +1.510025690491300e-01   -1.532864906316702e-01   +1.810853309495335e-01   -1.198703733113000e-01   +1.484264697287160e-01   -1.659903056848388e-01   +3.660426538844466e-02; -1.993561872668109e-04   +1.223512442716572e-01   -2.557489837436425e-01   +2.826133765052989e-03   -1.494455183770289e-02   +4.093750437742336e-03   +8.546663891315837e-02   +9.310021508913199e-02; -6.244581656034035e-03   +1.261196889946749e-01   -7.559012034790066e-02   -2.007044879231357e-01   +2.219309170037946e-01   -8.210047318339761e-02   +5.265956852935619e-02   -6.173463633200342e-02; +1.057279593480573e-01   +7.925644267559663e-02   +2.133840346964096e-01   +6.343234660641597e-03   +1.457469511901391e-01   +2.882161638864774e-01   -3.160536228142253e-01   -6.474920661159440e-02; -9.070231359896029e-03   -4.127850028740380e-02   +5.719652655495443e-02   -5.264920835819449e-01   -1.577364428481981e-01   +3.420862669620058e-02   -1.527096083528230e-01   +1.857379374676477e-03; +2.272729697124858e-02   -2.922924684026963e-01   +1.606081136470930e-01   +1.169548633528436e-01   +5.957066909134479e-02   +1.304938073870055e-01   +1.823691455323097e-01   +3.996208515417916e-02; +3.448879883995334e-01   -1.348103207770507e-01   +1.375400871395967e-01   -7.087497086471681e-02   +1.825171863725746e-01   -1.801398931652721e-01   -1.505825110754073e-01   -5.186549806394984e-02; -1.486121993772146e-01   -9.416972128812498e-02   +2.178967558695560e-01   -1.625181829474097e-01   +4.026676235018960e-02   -5.697337011247774e-02   -2.275016528490700e-01   +1.721820900178760e-01; -1.279800102812407e-01   +1.934924001808840e-01   +1.462465764787989e-01   +1.036712640941196e-01   +2.126554913430328e-02   +5.232471796616406e-02   +6.443696970219079e-02   +2.161397439536838e-01];
L1E_L2E_iAMPA_netcon = [+3.055943426398652e-01   -1.383263337378289e-01   -2.110789937368306e-01   +3.249646218552148e-01   -1.482463363485594e-01   -2.643379615945108e-01   +2.186635789310195e-01   +2.188817074873017e-01   +1.319601131774573e-01   +6.534789006146142e-03   +9.138393458040454e-03   -1.815832932328115e-01   +2.345463956495380e-01   +1.059008681101043e-01   +1.627765309976917e-02   +4.533825480926826e-02; -5.563039815938826e-03   +1.778329161584994e-01   -9.058445443723581e-02   -2.775534840347760e-01   +1.005055025530994e-01   -6.734891833307800e-02   -1.189007893917811e-01   +6.406396016110599e-02   +4.776824014076798e-02   -4.552767741960989e-02   -2.489041402748792e-01   +1.671083108626964e-01   -2.146298000741902e-01   -1.537034714174406e-01   +3.196971965058157e-02   -7.371234827473783e-02; -9.610429915113630e-02   +3.672011214958295e-01   +4.101420309466965e-02   +7.451358673027975e-02   -2.705817114611034e-01   +1.992645583715563e-01   -2.009393576485359e-01   +3.228936705731399e-01   +2.219679400216585e-01   -8.850390428611482e-02   +1.349024621301463e-01   +5.536377656820398e-02   +1.291005790327550e-01   -1.101375652714081e-01   +1.263295378386430e-02   -5.053265101078832e-02; -2.140371451390893e-01   +1.178185317667796e-01   +2.382241305737697e-01   -1.276549363017540e-01   -3.425687470747299e-01   -5.771369929777474e-02   -1.317250626232740e-01   +6.153916039235323e-02   -5.324107093032261e-03   -1.134318060278701e-02   -3.083550899063485e-01   +1.826001535338058e-01   -4.421637215796336e-01   -1.007421704559021e-01   -1.422444822472645e-01   -1.466350196137346e-01; -9.448948155059464e-02   +2.079643328803408e-01   +3.286962410753057e-01   +1.328216402358888e-01   -2.724572339447345e-01   -6.978768812030549e-02   -1.414494623892456e-01   -1.356399574147434e-01   -3.477668949184525e-01   +3.368261837525171e-01   -1.592066370903114e-01   -1.011375798101883e-01   -1.665442619125614e-01   +4.063130821059827e-01   +2.214003586205717e-01   +1.632166310520333e-01; -3.122971395382647e-01   -3.700914800301062e-02   +1.752733075010492e-01   +1.373165492734899e-01   +1.104771383476446e-01   +1.089024787287639e-01   -2.726698579198413e-01   +1.123801583933880e-01   +9.793199428868204e-02   +1.896420170954672e-01   -2.245203246513963e-01   -1.215666678155382e-01   +1.414093751000699e-01   +2.602966929752946e-01   +2.192068841725169e-02   -9.401887986113085e-02; +5.544814737472026e-03   -7.764597816253828e-02   -7.557991637965418e-02   -1.962736155265182e-01   +2.172095863122188e-01   +4.830741102387298e-01   +7.131389978456396e-02   +1.888078767580620e-01   -1.878827232045440e-01   +2.661975247161740e-01   -1.744210201998050e-01   +6.834333660623131e-02   +2.660259924084458e-01   -3.126169792084313e-01   +2.941646298818396e-01   +2.788370976699829e-01; -9.643831796002232e-02   +5.436684827260441e-02   +2.598265855914277e-02   -7.431718513670484e-02   +1.803305071960926e-01   -3.999880138358283e-02   +6.392400359493317e-03   +7.113769206707501e-03   +4.145561545253732e-02   +2.153507000395084e-01   -4.278743649212112e-02   +1.705164188515133e-01   -1.174137462099380e-01   -2.930594522019641e-01   -4.918373719722866e-02   -1.463078572774723e-01];
L2I_L2E_iAMPA_netcon = [-4.306990989362251e-02   +1.204114082716496e-01   -5.720350266650513e-03   -1.598082726514176e-01   -4.141908434411152e-02   -2.181989003043369e-01   +1.145235899141175e-01   -3.727931347828110e-02; -2.100247995609656e-01   -4.312226487214730e-02   -7.829831340020471e-02   +2.660365200112996e-01   +5.284334447329700e-02   -3.389886863098716e-02   +1.679612424733568e-02   +4.739147563740362e-02; +5.735317138247117e-02   -1.632326665721109e-01   -1.527749543746477e-01   -1.965685393744635e-01   -1.894415694683685e-01   -8.638393763480512e-02   -4.556898735928922e-02   -1.469141200630076e-01; -4.025602887268459e-02   +1.241549770156758e-02   -4.470255162917752e-01   -3.241799439234673e-03   -9.643808074627566e-02   -4.210925342543868e-02   -2.158319568926700e-02   -3.483374306010957e-02; +8.224307959390784e-02   -4.515618647510006e-02   +7.702473183888092e-02   +2.087366863052399e-01   +1.162250188191849e-01   -3.668416551415726e-02   -1.548121045644701e-01   -3.259917537432562e-01; +7.778448678925926e-02   -7.941656970339216e-02   -1.947673587647858e-01   +3.424346827208892e-01   -1.050272552474983e-01   +2.481696232137692e-02   -8.179595248920971e-02   -2.206936778168400e-01; -8.104136231880308e-03   +1.883761999512434e-01   +5.420013855513864e-02   -1.495898626406947e-01   -1.749024978206682e-01   -3.996566567533275e-01   -6.161727997644563e-02   -7.148557733790022e-04; +1.179017699915103e-02   +9.634434172383705e-03   +7.173761136339493e-02   -1.210317200692242e-01   -1.297642853772747e-01   +1.330564348062999e-01   +3.240798304312041e-01   -1.824054085123122e-01];
L2E_L2I_iGABA_netcon = [+1.751460413666946e-02   -2.140870064892628e-02   +1.480285428474381e-01   -8.223447289207330e-03   -1.677614265803109e-01   -3.295458280807234e-01   -9.135972237146160e-02   +2.819140273393374e-02; +1.604674010545998e-01   -2.188482609037137e-01   +2.518190663455687e-01   -9.363525512678875e-02   +3.248537090865641e-02   -2.745693840253988e-01   -7.028179388953394e-02   -3.091376368917614e-01; -7.022537903149009e-02   +1.370260144991346e-01   -3.366752322841522e-03   +1.386172591227993e-01   +3.023948028116447e-01   +2.019519325567636e-01   -3.224727891501900e-02   -1.975657569070766e-01; -4.864446794219967e-02   +1.584421404944648e-01   -1.531470087145496e-01   +2.080667675023795e-02   -6.312397475396282e-02   +2.037231498865484e-01   -1.957033088310038e-01   +2.502381669977472e-01; +1.701531002719283e-01   -1.955680689710606e-01   -1.291277926956475e-01   +1.479131673361671e-01   +1.422501093699746e-01   +3.798698815442364e-01   -1.649006636502440e-01   -5.618192118554981e-02; -1.689798663089001e-02   +4.122754496282637e-02   -1.233201240922125e-01   +1.013523726008012e-01   +1.347814955985307e-01   +1.419736249145918e-01   -4.832885522938252e-02   -2.736057090974210e-01; -1.232322566107304e-01   +4.578132229108031e-02   +4.229621479621877e-01   +2.311719318566405e-02   +1.506635378013283e-01   +1.118074692737946e-01   -1.052943836134273e-01   +4.072013334702951e-02; +1.387351568019830e-01   +3.231791498130535e-02   -1.509924306423582e-02   -1.923024048456188e-02   +5.683306246218926e-03   +1.823864315515656e-01   -3.543215415795696e-02   +3.100372883957875e-01];
L3E_L2E_iAMPA_netcon = [+2.040364197291815e-01   -3.316417641413666e-01   +2.941979473078324e-02   -1.353834997774847e-03   -6.611042035780074e-02   +1.261817937082499e-01   -3.652912973617714e-02   -7.557179198569770e-02   -2.102393427672704e-01   -2.648024739812672e-01   -1.705403833786161e-01   +1.687751109610308e-01; +2.237389310347225e-01   -2.212896031424403e-01   +1.167614642467757e-01   -2.986006476035709e-01   -1.687925957840098e-01   -9.074151082529892e-02   -1.262169662957948e-01   +1.058169145911664e-01   -2.355469076645159e-01   -1.469558598974782e-01   -2.791083727694936e-01   +1.003301957134651e-01; -2.716403978060133e-01   +8.063419745785343e-02   -1.133378044906826e-02   -4.032278392537961e-02   +6.815467347960541e-03   +2.002771055662179e-01   -1.318878418583539e-01   +1.191662440295611e-01   -2.099090949142741e-02   -5.103538789535383e-02   -7.952692717809369e-02   -2.598594012108655e-01; -3.076011474363200e-01   +8.746756892081695e-02   +9.299937773156489e-02   -1.078438670908468e-02   -1.270894645421695e-01   +1.052557737818040e-01   +2.169081874368680e-01   +2.025382878007726e-01   -2.594404141629021e-01   -7.931720600541683e-02   -1.570472060349449e-02   +7.943716706815736e-02; +2.163375527267452e-01   +2.052146260631094e-01   -3.994232305656874e-02   +8.824173887553753e-02   -4.262578896232944e-02   +1.158124668466706e-01   -6.248856124621589e-02   -5.753167295342369e-02   -2.829061401267162e-02   +1.285417105188145e-01   +1.678253753024965e-02   -1.285777077066385e-01; +1.506896736646300e-02   +6.414492673744251e-02   -1.797162067301484e-01   +1.351995493051756e-01   +7.541480302997852e-03   +1.724958636100327e-02   +3.914931848988865e-01   -4.565163431456107e-02   +1.073965774685636e-01   -9.785835995836908e-02   +2.816466230695550e-01   +1.262260429306928e-02; +3.150190803453106e-02   -8.998202410694917e-02   +3.783127395827228e-02   -1.197737563536120e-01   +3.105965701809710e-02   +6.356427149360648e-02   +1.754265046975252e-01   +1.396654031250158e-02   -4.521962415439514e-02   +6.195986933248416e-02   -3.044459442783443e-02   -1.258990016681003e-01; -2.666103254864142e-01   -6.955676655067965e-02   +5.033269949061114e-01   +2.066892554552651e-01   +8.834897865526031e-02   +4.373137132137872e-02   -1.365106571564731e-01   +2.983315418341957e-01   +5.026172621741411e-02   -1.271097393027228e-02   -2.966914472165251e-01   -5.891611187676325e-02];
L3I_L2I_iGABA_netcon = [-2.218406162170281e-02   +3.134163378815135e-01   -7.605021093486809e-03   +5.166416951077678e-02   +1.281032133139770e-01   -1.254960523320348e-01   +5.565365397464137e-02   +4.289613303555882e-02   -2.556789665129888e-01   +1.308735569710292e-01   +1.165064000288963e-01   +1.234333237919694e-02; +2.339153163512800e-01   -1.805182270855984e-01   -3.209788725717900e-01   -8.638654778071045e-02   -9.593723422246137e-02   -4.391368831923216e-02   -4.083737798077426e-02   -1.290183876274911e-02   -3.144458273562704e-01   -8.114992221890595e-02   +2.029961154845421e-01   +1.805082981119176e-01; +3.619389330768867e-02   -4.164813864143059e-03   -6.657221382068595e-02   -1.263448914464165e-01   -4.921082348984962e-02   -1.122466019150956e-01   -1.773481732542391e-01   +1.775675324161308e-01   -4.869373717674404e-02   +2.740870575723147e-01   -1.069561889244086e-01   -1.243150975791990e-01; -1.930998803682246e-01   -7.594384719961050e-02   +2.129707908407414e-01   -1.605736094685664e-01   +8.022914995696813e-02   +2.163973453104637e-01   -7.151107611005413e-02   +2.721844731050548e-02   +2.065955834539983e-01   -3.384821298001167e-02   +5.947939717032880e-02   +2.810036950524320e-02; +6.644961927238724e-02   -2.812602364845067e-01   +2.511734703081811e-01   -3.643102403385948e-02   -1.762216630330741e-01   +2.417777632601734e-01   +5.050798721934928e-02   +5.208230292992949e-02   -1.697137872288086e-01   +2.426751040201578e-01   -8.075062653736439e-02   +1.500995439435304e-01; +1.962530426863539e-01   -2.695087180205871e-01   +1.466384001300229e-02   +6.338666950825839e-02   +5.685689082658355e-02   -3.043075394599641e-01   +1.258957384441891e-01   +3.127540544781672e-02   -1.405647817987538e-01   -4.768567033308101e-02   -2.050049531902917e-01   +2.743852550667935e-01; +2.513095501701130e-02   +2.632683200181534e-01   +1.755233252737479e-02   -3.851427701236304e-01   -1.238149610045154e-01   +2.428188518825953e-01   +1.192037450126363e-02   +3.668503537983947e-02   +2.468119056353864e-01   -1.880019023893721e-01   +6.791957548268042e-02   -2.485911038255769e-01; +4.449775980114100e-02   -3.310952569164252e-01   +5.871669326755903e-02   +1.741908962281481e-02   +2.156436426757708e-02   +2.700873978889791e-01   +3.295990798342883e-01   -3.542528744975932e-02   -9.048265800199609e-02   +1.762058836061294e-01   -2.564252772798374e-01   +1.927594340458124e-01];
L2E_L3E_iAMPA_netcon = [+1.793499830695593e-01   -1.722807255207775e-02   +3.294502057978495e-02   -4.161226836397125e-02   +2.303600129547731e-02   +2.048702033807080e-01   -1.198809033033010e-01   +6.574492355726171e-02; -1.078900963580761e-01   -1.088083438655787e-01   -4.185464349292382e-02   +2.007292642508055e-01   -3.152990515059339e-01   +1.239120995740317e-01   -8.468309060731601e-02   +6.744280317286024e-02; +5.661701502469956e-03   +2.848086963715907e-02   +8.413679818609869e-02   +1.812465792167289e-01   -3.222001013994297e-03   -6.956624937238019e-02   -5.361507574769880e-02   +1.211882957340770e-02; -1.569022808260260e-01   -6.528776818736132e-02   -3.099778927478199e-02   +9.166481787810567e-02   -2.729542283898149e-01   -3.622629539463872e-02   -9.504391791295588e-02   -7.930367442816573e-02; +2.735986745213499e-01   +2.157692620182339e-02   +5.394780839090819e-02   +3.128706200960109e-01   +8.711929769928642e-02   -2.311889581323837e-01   +7.755032017060716e-03   -1.129287727760195e-01; -1.676012445047712e-01   +1.557994000857005e-01   +8.084443716066832e-02   -7.838362753406962e-02   -8.832673280369131e-02   +4.052385891262655e-02   +4.981112644289948e-02   -2.897161452134597e-01; +2.196347695839042e-01   -1.770304306288203e-02   +1.311932904022946e-01   +1.374673766830556e-01   -2.868477735474573e-02   -2.893176450771403e-01   +1.165551912574944e-01   -5.185790891137634e-02; +6.343239463711523e-03   +1.571091748463866e-01   -7.590556535021190e-02   -6.418051872448829e-02   +6.609141924112057e-02   -1.660644418540148e-01   -6.830923764676136e-02   +9.034428160251726e-02; +1.147437253315680e-01   -1.193085130437158e-01   -3.248260157613441e-01   -1.491686553971580e-01   +3.557356111550914e-01   +1.168722516447253e-02   -3.544454630227603e-01   -2.260022105601925e-01; +8.628650460864437e-02   +6.819105649008943e-04   +7.264598970687965e-03   -2.295931259517360e-03   -3.087512898027901e-02   -1.426993974198583e-02   -1.255297553810737e-01   +1.918631012135181e-01; +2.517218577442860e-02   -1.766660639326067e-01   +6.745907273253440e-02   -3.575057292342655e-01   +3.000479203465887e-01   -3.842948640900922e-01   +3.510082687003201e-01   +2.721198814617944e-01; -1.812389110343313e-01   +5.043246020685480e-02   +1.283046542092532e-02   +3.416031129130360e-02   -6.318443881514101e-02   -5.104836596670352e-02   +1.649157486931879e-02   +1.565059291952248e-01];
L2I_L3I_iGABA_netcon = [-4.713362229617542e-01   +1.767244027532090e-01   +2.340576043131468e-01   +4.996639491610828e-02   -2.360025569503374e-01   +1.886117344407195e-01   -1.316028387952075e-01   -1.860621498246413e-01; -2.913174043473841e-01   -1.452776374303234e-01   -1.997439542602229e-02   +3.770020151632449e-01   -1.053203850014172e-01   +2.208961670653229e-01   +1.893018254177411e-01   +8.488634268836311e-02; -1.793719321792484e-01   +2.023391644958796e-01   +1.357611633728046e-01   -6.211395019962494e-02   -1.965846356708710e-01   +5.785938771030513e-02   +1.335614053574009e-01   -7.002061741614310e-02; -4.145045303584207e-02   -5.039652846065417e-02   -1.921590037214375e-01   +6.431693701902526e-02   -2.622018388951196e-01   +1.624749600954579e-01   +3.747642693038258e-01   +8.850541194958725e-02; -1.836909349418142e-01   +1.109623531319127e-01   +2.068622315262309e-01   -2.538048722424292e-02   +1.382472651135051e-02   -1.071117680006117e-01   -8.797323504191643e-03   +1.731771456088781e-01; +9.689856973595919e-03   -1.000374313622117e-01   +1.160612932393635e-02   +5.693081157639215e-02   -2.305973382244547e-01   -4.595989311377397e-02   -6.316187336217319e-03   -2.253639070743897e-01; -2.169836030789263e-01   -6.626934599852156e-02   +8.923341624620990e-02   -1.571710835750725e-01   -1.772968130146971e-01   +1.083960623232007e-01   -1.116344096495835e-01   -1.360797103509643e-01; +3.976746071802845e-02   +8.202855853732463e-02   -1.214191906789966e-01   -2.420081921356439e-01   +4.881641722134699e-02   -4.412664227945252e-02   -2.192580848200160e-01   +1.597410459869598e-01; +1.566398029583150e-01   -2.213985627632477e-01   +1.037181491837331e-01   -3.690929492899182e-01   -2.004292438278648e-01   -3.680054293369482e-01   -7.823227176673668e-02   +1.447554905311415e-01; -9.491533041024161e-02   +1.175072137556717e-01   -2.476794869929072e-01   -2.549202764429873e-01   +2.473412489871724e-01   +2.155901506261825e-01   -1.173297442329098e-01   -9.515776787473135e-02; -1.695819792348899e-01   +4.530584879339161e-01   +2.930905180819477e-01   +1.622072691121479e-01   +5.285046101464453e-03   -8.177808356905325e-02   -1.740402036456390e-01   +2.468491893644785e-02; +7.183511560033809e-02   -9.217238304754830e-02   +2.130955686274668e-01   +2.516047895610879e-01   -2.173851920237803e-02   +1.082615625022710e-01   -3.607209010391997e-01   +7.952105730907487e-02];
L3I_L3E_iAMPA_netcon = [+4.003026569236925e-02   -2.858285537108283e-01   -5.737169399269949e-02   +3.269925873594632e-01   -1.770878651334725e-01   -2.043159535917275e-01   -2.247464769036535e-01   +3.016277640695900e-02   +7.072605036282306e-02   -1.035611582510722e-01   -2.670612769185623e-01   -2.080660937908219e-01; +6.257118648741104e-02   -1.788132665426483e-01   +8.970334191390242e-02   -2.830136784879017e-01   -2.546739422460766e-01   -7.128050770206233e-02   +6.614793305043110e-02   -1.290823979892361e-01   +1.242636922687658e-01   +1.561711266365390e-01   -2.229472193994851e-01   -1.071643594529822e-01; +1.224653166778257e-01   +3.088837325465911e-02   -2.362867737788679e-02   +1.146533398583846e-01   +1.111046846517124e-01   +2.787049732168247e-01   +1.548610258572521e-01   +9.359814885554604e-02   +1.982592245149847e-02   -2.024105046114003e-01   -1.575749745184938e-02   -2.854470584457512e-01; +5.167525017306052e-02   -1.966780692863242e-01   -1.060929432512446e-01   +2.033950049402076e-01   +3.178418824868763e-01   +2.223165805803566e-01   +4.184464236182298e-02   -6.701490776389787e-04   +1.284101036790495e-01   -3.414705448078021e-01   +1.294423323221413e-01   +2.197617931039369e-03; -4.092846584105893e-02   -1.636660475762060e-01   -2.390154785792742e-01   +3.934291350939609e-01   +1.686754458032187e-01   +2.028098661247167e-02   +1.344212250064351e-01   -1.964632121974514e-02   -1.852700146083668e-01   -2.848668393464728e-01   -2.935392285208002e-01   -7.639572999855045e-02; +6.574698754468755e-04   +1.958979470821512e-01   +1.343994059022906e-01   +1.954626962678752e-01   +3.236409742684669e-01   -1.105830886464399e-01   -1.554082914279296e-01   +3.777817341666002e-02   -5.248482503685031e-02   +2.259449504534230e-01   -4.182505635264343e-02   -7.006310514695266e-02; +2.911687984881997e-01   -2.367415178652033e-02   -3.910134767338119e-02   +2.691805257603936e-02   -2.640698510345235e-01   -3.536433130593059e-02   +7.235655999642017e-02   -2.241957633328068e-02   -1.291049276170712e-01   +4.743748587549921e-02   -7.177405950526830e-02   -1.863694673697675e-01; +7.400169614110426e-02   -1.430608713733728e-01   +8.527840610109530e-02   +2.359530138980312e-03   +1.588099474850411e-01   -2.470222507417213e-01   +1.154798557453986e-01   +3.008265678980487e-01   +4.925666754214837e-02   -2.360618942527574e-02   -1.207616539684881e-01   +2.336994816000923e-02; +1.365826335570203e-01   +1.767920823576871e-01   +8.896071349697877e-02   +1.643569531174529e-01   -1.121926688077771e-02   +2.379993698600327e-02   +2.028679392253833e-01   +4.163664169377889e-02   +3.471269154172946e-02   -1.818935144343561e-01   -1.266141348787156e-01   +3.981392133821307e-02; -4.243641629973283e-03   -2.795684358358209e-01   +2.060919262977462e-01   -8.250391471912649e-02   -1.844015505818380e-01   +7.043002033349109e-02   +1.656998778759519e-01   +1.428970188359123e-01   -2.917349233319720e-02   +3.266417973352741e-02   +4.364204338100306e-02   +2.095564204563424e-01; +4.780722105522328e-02   -1.083417955927153e-01   -2.349092389370011e-01   +1.149413330593219e-01   +2.097589268191064e-01   -1.010327564144019e-01   -1.100270620416409e-01   +7.567703139094849e-03   -9.442042611236365e-02   +3.232051876061295e-02   +7.793219963231134e-03   +1.349726994110409e-01; +1.656212725550092e-01   +5.520896704956063e-02   +1.047733523898080e-01   +2.417489065949106e-01   -7.804084217560248e-02   -2.860938385695712e-01   -2.174953031853687e-01   +2.845582908760761e-02   -6.253926887490947e-02   -1.064610933218249e-01   -2.129556527969352e-02   +1.926757207148195e-01];
L3E_L3I_iGABA_netcon = [+2.356906115372589e-01   -3.327265225751071e-02   -2.025619892200642e-01   +8.056189062276971e-02   +1.355079629375295e-01   -1.956226640798839e-01   +6.777121799044070e-02   +2.957343868683718e-01   -1.209803897450675e-01   +3.258486645294849e-01   +8.201825662686041e-02   -4.152963346182841e-02; +2.170429734794136e-02   -2.823379280085787e-01   +1.599892380000831e-01   -2.171469519347085e-01   -2.662275229598249e-03   -2.928498041828095e-01   +5.373451917496402e-02   -1.580534954154579e-01   -3.466448291179939e-01   +5.660793675321558e-03   +9.590245698088250e-02   -1.608751280332581e-01; -2.725371151292546e-01   -1.350803210213417e-01   -6.322213197846215e-02   +1.839503056065836e-01   -2.388112234802880e-01   -8.917023457065217e-02   -4.948688388492187e-03   +3.250506303688460e-01   +1.877060702820121e-01   +7.264904994135521e-02   -1.263577590358440e-01   -2.700632114954627e-01; +1.374186871078195e-01   -4.360578056701556e-02   -1.367512863047457e-01   -1.981529004790512e-01   +7.403471307051263e-02   +2.632974375239528e-01   -1.195098934678777e-01   -2.992242257032051e-01   -6.014702762189759e-02   +2.378223481709987e-01   +1.617228131290518e-01   -2.498739559751210e-02; -2.249668022665755e-02   +1.120722252428848e-01   -2.782108374529857e-01   +1.101073864333004e-01   -2.391239428748320e-01   +2.396685262591704e-01   +2.545391756181031e-01   -4.581393963402669e-02   -2.202383128082633e-01   +2.715305302734635e-02   +6.525731480798255e-02   -1.772673842820071e-01; -1.974491312272887e-01   +7.924564472641468e-02   -8.335832460978630e-03   +3.483550539134833e-01   +9.622528264245560e-02   +1.456903495586050e-02   +1.869411708937422e-01   +5.420452599989366e-03   -2.339513657873130e-01   -2.665169379459790e-01   +2.219661400955297e-02   +2.993682727452678e-01; +6.671023326021842e-02   -2.033324743124953e-01   +1.378818538139538e-01   -4.555693305942214e-02   +1.244261402201222e-01   +1.290612245974499e-01   +1.794017483205848e-01   -3.148848440151654e-01   -2.241383657282446e-01   +1.362765294382671e-02   -3.913056208257919e-02   -2.454836627090409e-01; -1.851460493580440e-02   -8.878248373171877e-03   -2.064725341693748e-01   +5.262302268617421e-02   -2.358989510957733e-01   +1.628733856833149e-01   +1.002765559489430e-01   -1.286260069333460e-01   +2.946527047552038e-01   +6.373984468638567e-02   -8.485542489882111e-02   -2.693710294759826e-01; +6.827886197574837e-02   -1.338490586968341e-01   -1.917651003357466e-02   -1.547522815939866e-01   -4.041781533238909e-02   -3.958647271328986e-02   +2.482563133272327e-01   +7.644440928341192e-02   +2.885805447681269e-02   -1.426974842851306e-01   +6.023172877690891e-02   +1.537431775984682e-01; -3.067670755591271e-01   +4.663975305779285e-03   +2.982344426565515e-01   +7.533009622697115e-02   +3.105862695558385e-01   -1.308945921833120e-01   -8.214154936075724e-02   +1.671343806429696e-01   +1.533720555838503e-01   -2.363801841697261e-01   +5.743025965251704e-03   +4.245705638155875e-02; -2.273930659944237e-01   +9.445180834784311e-02   +6.137041066568778e-02   +1.064607795432393e-01   -3.562038423661224e-01   +1.459768905458995e-01   -1.315606204666497e-01   +3.748100378532297e-02   -2.025529277927575e-01   +1.585209284129287e-01   +3.267818595672616e-02   +4.821919814094183e-02; -9.124725021543850e-03   +2.100180755696131e-01   -1.951871885628136e-01   +1.993226581883576e-01   +2.658052343935483e-02   +1.704454667864349e-01   -1.856070118283985e-01   -3.555387239109130e-01   +2.594108181617057e-01   -3.676160951336260e-01   +3.416720681175502e-01   -2.376926163177436e-01];
L2E_Input1_iAMPA_netcon = [+3.340104027722585e-01   -9.167605839311105e-02   -1.178618505084319e-01   -1.342740119472096e-01   -7.893888031036458e-02   -9.732113060670865e-02   +1.476677051316188e-02   -1.623178398204896e-01];
L2I_Input2_iAMPA_netcon = [+2.237082344818406e-02   -1.838333324222823e-01   -7.403617939517745e-02   +6.916928424938032e-02   +1.178624048112315e-01   -6.654583605980573e-02   -7.907766349019325e-02   +2.171153576502937e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.03*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.15*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.15*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.03*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.15*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.15*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
