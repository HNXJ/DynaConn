function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-5.040057175883884e-02   +1.102635422142495e-02   -3.810704766851151e-01   +3.268847887082351e-01   -1.205662542325943e-01   +8.141436622382435e-01   +4.891727702682345e-01   -3.560971197259414e-01   +7.060285115014028e-01   -2.745708338435003e-01   +1.000000000000000e+00   +7.377215473450341e-01   -2.662811255934946e-01   +6.948258593962016e-01   +3.654968321372351e-01   +7.479768998795789e-01; -1.695698957723318e-01   -3.444034060154567e-01   -2.055905038613549e-01   +5.086241009642148e-01   +2.212880586035547e-01   +9.626777635273226e-02   -9.604081908171437e-02   -4.319758080591400e-02   -2.519026729475495e-01   -3.423911642552010e-01   +1.354486749003317e-01   +5.272103286958506e-01   -1.706370683407018e-01   +1.773604847515922e-01   +4.131804820752188e-01   +2.946814924674171e-01; +1.799242041069024e-01   -3.629541942487271e-01   +7.395357324386761e-01   +8.229727029279865e-02   +2.978810579256865e-01   +5.131318962290352e-01   +4.057123251617847e-01   +2.396442660864204e-01   -1.414144164129102e-02   +7.978152636044944e-01   +8.958050493718640e-01   +6.526363119080522e-01   +8.729541997497851e-02   +3.116406751448776e-02   +2.981768362370154e-01   +2.496049443955289e-01; +3.967127005748280e-01   +2.736673458394853e-01   +6.087588496098895e-01   +7.838322467145735e-01   +8.805812713213214e-02   +4.677781115825431e-01   +9.269304458866499e-01   -4.701214773659109e-01   +6.677315908793063e-01   +5.619107280680355e-01   +5.891198834341406e-01   +1.659555951617632e-01   +6.470065883238855e-01   +3.994199247504794e-01   +9.629127258628427e-02   +5.628062062340029e-01; +5.818770091630431e-01   +2.814429914413646e-01   +6.176879941995307e-01   +3.012163403996215e-01   +9.694431938214562e-01   -5.089600894708348e-01   +7.688290468423642e-01   +5.858768466980451e-01   +6.392625530227926e-01   +5.043607921840481e-01   +2.021573940655089e-01   +4.402150169401639e-01   +4.433011989792432e-01   -1.500958479689025e-02   +5.371439689348634e-01   +6.080465997536200e-01; +7.128267235196890e-01   +4.711852086070037e-01   +2.043079536283440e-01   +6.131725821299586e-01   +1.059633258860908e-01   +4.018130996932399e-01   +7.701220068150720e-01   -2.857391451878782e-01   +7.065709517209791e-01   +6.491378573799177e-01   -7.462111173749877e-02   +1.374204800369941e-02   +4.910200981529970e-01   +2.543283649693318e-02   -2.054932215211415e-01   -4.944395385371521e-02; +6.382928713947684e-01   +4.587405979184336e-02   -7.658945410944325e-02   +4.263841552949391e-01   +9.017069095473205e-01   -2.411299761455501e-01   -1.123010185259629e-01   +2.825428771867275e-01   -1.840319543060435e-01   +5.416753932945135e-01   +5.298955693206331e-01   -3.578207075030537e-02   +1.113764271116533e-01   +8.867120102293045e-02   +3.377750882364314e-01   +1.297973463475341e-01; +4.839800701943726e-02   +1.952394149367881e-01   +8.964376307398108e-01   +3.332056539432734e-01   -3.045771077720101e-01   +2.480407079260736e-01   -8.958116621415378e-02   +5.373496956099637e-01   -1.666649030281942e-01   +3.579408892056263e-01   +6.091563555637073e-01   +5.029022898902781e-01   +7.785173169194507e-01   +4.518531145688841e-01   +6.220200414172643e-02   +7.487103953586180e-02; +7.110454618961705e-02   +7.894133382681711e-01   +5.622545040104605e-02   +2.739313268745036e-01   +4.394736606842180e-01   +8.196251100250066e-01   +6.685183498213688e-01   +1.610513622789528e-01   +6.331929805382760e-01   -1.389351018754883e-01   +5.265693231125618e-01   -6.321308021250731e-02   +4.949476809147197e-01   -1.790325530993289e-01   -1.808738615843569e-01   +7.327204804053303e-01; -5.149241692066541e-01   -4.322660806875050e-02   +4.734978095724041e-01   +7.846838419977106e-01   +1.458323029809465e-01   -5.562762469200679e-02   +7.595052756612979e-01   +4.059227181177676e-01   -2.167409412372346e-01   +2.419944596839339e-01   -3.970561540503022e-01   +5.689930925890259e-01   +1.238462908359277e-01   +8.661207131630262e-01   -1.493017422957602e-01   +7.680929810365443e-02; +7.804717195811840e-01   -2.233237323261958e-01   +5.409055892347321e-01   -3.392709513921302e-01   +5.967472793932473e-01   -2.681005450024060e-01   +1.121718987493778e-02   -2.861415430104534e-01   -1.241179390539308e-01   +6.782436135541547e-01   +6.497593848813923e-01   -1.805490420083290e-01   +3.429684682332089e-02   +6.386778421656913e-02   -5.010240168031853e-01   -1.232507364797262e-01; +3.026687651697100e-01   +7.275639518846210e-03   +5.675177078913981e-01   +4.074819318863516e-01   +3.961091757458562e-01   +4.057611585538441e-01   -3.491980909488935e-02   -1.618941295540949e-01   +7.419805341275090e-01   +4.016073110482757e-01   -9.434984991118497e-02   +1.373853058152115e-02   +2.345189997329225e-01   +4.619425689453401e-01   +1.804518619460859e-01   +3.202981443809564e-01; -2.756565202979949e-01   +3.624013865462180e-01   -3.079151864718977e-01   +4.818242230150098e-01   -2.502576673112034e-01   +5.692576453574891e-01   +6.892290718677964e-01   +4.340854182806612e-01   +3.683706239812808e-01   +1.397636611716231e-01   +2.207341657818352e-01   +5.991502972096739e-01   +8.627693450344245e-01   +3.382906148395778e-02   +6.482829155380556e-01   +4.857783613715272e-01; +1.419345056019769e-01   +7.758362690286257e-01   -1.103691068787289e-02   +4.352412474034590e-01   +5.794216741507933e-01   +1.193499714493733e-01   -6.644955782822186e-02   +6.082843023986199e-01   +8.314222510052898e-01   +5.709021524866476e-01   +4.791225489014042e-01   +5.458315603289903e-01   +4.912832163297036e-01   +3.521296830530957e-01   +5.060643211128019e-01   -1.772428046404610e-01; -3.153502116101414e-01   +3.962992017935146e-01   -2.321527626719791e-03   -1.370633170529429e-01   -1.209043545141649e-01   +2.430591792880984e-01   -2.047121287109019e-01   +1.029346697916123e-01   +3.465568378415818e-01   +7.291034846149881e-01   +3.411257164081726e-01   -6.126435258312433e-02   +7.660978667389363e-01   -3.427562105858654e-01   +1.757964985956611e-01   +6.324151331689234e-01; -3.419650444943633e-01   -3.137814635030986e-01   +5.314525241285730e-01   +3.403816027615989e-02   +1.963130725791628e-01   +3.719717400237949e-01   -5.598231767488568e-02   +2.106059592655917e-01   +8.355267615484875e-01   +3.487427649379667e-01   +4.506814817106848e-01   +1.342530591294667e-01   +6.320617265683636e-01   +9.079897469862538e-01   +4.937399270966005e-01   -2.200302005115932e-01];
L1E_L1I_iGABA_netcon = [+4.957906317403420e-01   +7.643617735063059e-01   +4.178558115071922e-01   +4.072410670016632e-01   +6.367452082150827e-01   +2.552118774321042e-01   -2.327789193515409e-02   +4.415541031178490e-01   +4.349684753707636e-01   +1.150724321506743e-01   -4.595627111371526e-01   +3.770351464062645e-01   +1.745113102183484e-01   -4.377691087939422e-02   -4.030595114473695e-01   -4.544885764973786e-01; -4.470277594772947e-01   -7.115125299674814e-02   -1.740761758338822e-01   +2.163215413383157e-01   +6.324576600850597e-01   +5.608982875383416e-01   -7.393546954608450e-02   -1.621839955266552e-01   +2.093030323535009e-01   -7.024720536031329e-03   -1.923367340120508e-01   +4.896367522112808e-02   +1.169327002971606e-01   +2.135365598237211e-01   +1.150382038446984e-01   +9.748311444297693e-01; -6.494984870926858e-02   -5.145187166257764e-01   -1.911787544136588e-01   -3.816893459505000e-01   +7.781436778105754e-01   +4.584713071756826e-01   -1.282839680905390e-01   +3.746739752994631e-01   +3.358247544842564e-01   -4.952708090780336e-01   +8.725598344918165e-01   +9.154481075460755e-01   +6.671416365862176e-02   +2.263870807651672e-01   +6.567850921202995e-01   +5.972263839465090e-01; +6.802973714608330e-01   +5.468429226977104e-01   -2.669369917861128e-01   -1.116955727724475e-01   +1.226557241285825e-01   -7.525175419147326e-02   +1.713172447837278e-01   +2.380679639436059e-01   +4.779700306553608e-01   -1.787056023422254e-01   -2.809620684876793e-02   +3.621092096214705e-01   +6.414399626491480e-01   -1.387539525818933e-01   +5.347228327240307e-01   -5.224266281708130e-03; +8.034425750341954e-01   +7.716978275094044e-02   +4.185823777961468e-01   -1.492290575161381e-01   -1.450146918931819e-01   -2.164592310013456e-01   +5.010514833934945e-01   +2.300960259927401e-01   -3.459123300471961e-01   +7.638554578274934e-01   +5.238598585032984e-01   -6.264176725419564e-02   +5.132514324087248e-01   +3.562133299635689e-01   +7.048117116583291e-01   +7.819367137053901e-01; +1.878228781921625e-01   +2.680420599632953e-01   -9.715093291907977e-02   +5.559908038150756e-01   -2.358292468312910e-01   +4.242399835898341e-01   +5.880246545673788e-01   +5.948819082970872e-01   +4.598746381185047e-01   +2.424989643094475e-01   +3.255126815228770e-01   +7.902898849209601e-01   +5.944298065786804e-02   -6.326551518861796e-02   +9.425453052072345e-02   -4.795766749798340e-01; +4.732390941325688e-01   +1.010729583066902e-01   +3.872729365549836e-01   -4.099331613286307e-01   +4.986509992917142e-01   -6.876338298111374e-02   +1.298769095188107e-01   +5.795129333574249e-01   -7.879881087650389e-03   +5.427916260939101e-01   -6.527302690133249e-02   +6.041028484944109e-01   -1.974526301750291e-01   -2.861550853269660e-01   +3.338146236424092e-01   +3.072145944090734e-01; +5.663262295289170e-02   -3.714614100814853e-01   +1.121530546548568e-02   -1.054263340909282e-04   +2.775124622604290e-01   +7.856505246765592e-02   -2.245789302194062e-01   +4.352013724457726e-01   +5.076618637457238e-02   -3.468477381274283e-02   +4.234650071863008e-01   +1.152226527964990e-01   +7.227227456267858e-01   +6.654546028103965e-01   +1.099444231293796e-01   +3.795379530993290e-01; +7.001526054273670e-04   -1.865306525802020e-01   -9.958610775958292e-02   +2.349595873363078e-02   +2.332214467190982e-01   +6.013730887845102e-01   +5.304160504434441e-01   -3.190358527651668e-02   +7.496427653997179e-01   +8.424626248166509e-01   +8.051545058609226e-01   +1.280102901743186e-01   +1.661048479550900e-01   +2.689093678540499e-01   +3.451488871584038e-01   -1.091147290933805e-02; -1.425928909476817e-01   -2.121560964114774e-01   +2.116582183953462e-01   +2.054382494586860e-01   -6.337383402409283e-02   +2.611616024568153e-01   +7.142689642931883e-01   +1.832042156675044e-01   +8.891357005696520e-01   +7.545263050977995e-01   +8.527439977171135e-02   +7.483499233789751e-01   +4.050786767949895e-01   +5.105022332476150e-01   +1.061278619356042e-01   +4.348130895341116e-01; -2.345267523333265e-01   +2.458992056076403e-01   -3.624032634869390e-01   +2.618779861749982e-01   -4.375275762038493e-01   +2.434754362220835e-01   -2.514496231193297e-01   +6.100565307642605e-02   +1.000000000000000e+00   -3.257917709739885e-01   +3.104509371951590e-01   +4.707105758241946e-01   +9.578221888304599e-02   +6.837065394839471e-01   -3.660552246937664e-03   +7.814030069228570e-01; -4.249401882592820e-01   -2.764336862601088e-02   -2.146551071040121e-01   -3.078140612059223e-01   +8.311498646020697e-01   +3.677555936557658e-01   -1.378617530597506e-01   +1.648500169032265e-01   -3.646712471707463e-01   +5.415944631487681e-01   +4.816090874614634e-01   +5.261555214407454e-01   +2.442773278246309e-02   +7.216872747144250e-01   +5.593754892330466e-02   +9.025480635935577e-01; -5.674968704660177e-02   +4.078024699415726e-01   +5.826700039553255e-01   +7.172632763750708e-01   +5.701255716760991e-01   -1.065475329835501e-01   -4.922099312746360e-02   +1.915494410006867e-01   -1.295267961010020e-01   +9.335223609042337e-04   -3.523922269917062e-02   +1.797031792071884e-01   +4.438414186885772e-01   -1.489548121152200e-01   +2.198590108627088e-01   +3.771156971865335e-01; +1.225001196233003e-01   +1.008901917142302e-01   +7.639582760737761e-01   +3.385903172223463e-01   -3.001591605545783e-01   +8.783181825753341e-01   -3.012831329743343e-01   +1.255924518227151e-01   +6.646025887535778e-02   +4.150764333550227e-01   +6.969100607738192e-01   +4.278378201694592e-01   +8.524201549933341e-01   +4.179281289804287e-02   -3.155851079165701e-01   +1.325859377518556e-01; +2.368077428626372e-01   +5.083657022562594e-01   +7.086044749578820e-01   +5.552885831300689e-01   -3.304000044546532e-01   +9.436639159812957e-01   -3.417638727426878e-01   -3.411408747079928e-01   -1.426267454961272e-01   +7.251066991513405e-01   -2.045806729852051e-02   +3.503038442951468e-01   -7.460850705512428e-02   +1.395203106214253e-01   +3.943003603077481e-01   +1.329137663708960e-01; +6.097703037176326e-01   +7.354341778637203e-01   -1.926836541398746e-01   +4.323186093727631e-01   +6.302892461091826e-01   +2.198680071245480e-01   -4.025668766535430e-01   +1.884208517107581e-01   +2.654693481157426e-01   -7.470178465056397e-02   +6.259962856147988e-01   +3.065168358036054e-01   +9.934544697530582e-01   +5.870743909591171e-01   -2.007601008210275e-01   +2.295150121768508e-01];
L2I_L1I_iGABA_netcon = [+3.564915724813387e-01   -1.887227932584965e-02   +5.733609940151159e-01   +3.330526828051930e-01   +5.672470785129813e-01   +2.048772475604289e-01   +5.522514827536459e-01   +8.652828368087697e-01; +5.953576471196992e-01   +1.383810269160785e-01   +9.311451440287573e-01   +1.800890076932268e-03   +8.473079729437060e-01   +6.228138273377626e-01   +2.630365858161173e-01   +3.796924021248120e-01; +9.136637980426530e-01   +2.106704295414726e-01   +7.388379104893857e-02   +4.980360164804543e-01   -1.761197878997119e-01   -1.389669201744932e-01   -1.554847566169406e-01   +4.944956211563228e-01; +4.765704051660399e-01   +3.882999104027817e-01   +5.561644065859214e-01   +3.605735474111740e-01   +6.970821743601828e-01   -5.289600235081014e-02   +4.322649122589474e-01   +4.574449799476912e-01; +1.732953358754983e-01   +3.989856490084147e-01   +5.690147421882917e-01   +5.842100432943647e-01   -1.903082027675618e-01   +6.385563387254433e-01   +4.349657400338619e-01   -3.492742436074268e-01; +4.539400388984567e-01   +3.895059501106068e-01   +1.284204670506137e-01   +5.210440196053682e-01   +4.766313397002064e-01   +6.370975695139705e-01   +1.143502423200455e-01   -7.256586515450786e-02; -1.591270594896383e-01   +2.241575298268200e-02   -1.777743191149974e-01   +3.858260441090500e-01   +9.579111968898544e-01   +6.088796378661325e-01   +6.478014014784329e-01   +7.778607652878340e-01; +2.950290632830565e-01   -1.146076891142390e-01   +4.805753571872279e-01   +3.541294609317044e-01   +3.347196032656223e-01   +2.218436039328735e-01   +5.302622284766649e-01   -3.012897900634844e-01; +8.659274146464847e-02   -1.972308901962117e-01   +8.698591090230867e-01   -6.785349732892218e-02   +9.622277613927799e-01   +3.194330439564640e-01   +4.120337725395058e-01   +8.832597084080681e-01; +6.131869498383895e-01   +6.590438725650875e-01   -8.362393786245664e-02   +6.378572275488482e-01   +1.856985763157207e-01   +5.707596366452473e-02   +3.527808151080813e-01   +6.095463487289742e-01; +2.811484326153629e-01   +2.143418778235267e-01   +4.115683916413937e-01   +3.678253380478269e-01   -2.885902834384348e-01   +8.164425122248530e-01   +4.443607237150601e-01   -2.235047511210445e-01; +3.528807755404731e-01   -6.244197459011780e-03   +1.686479084787317e-01   +3.914639552406159e-01   -4.224760042849474e-01   +7.793133708090980e-01   -3.512759251249922e-02   +4.789991975757468e-01; +6.020187611290577e-01   +1.000000000000000e+00   +3.479123190679360e-02   -3.901734511677647e-02   -3.673294080713586e-01   -1.390901860823354e-02   -2.178386261768430e-01   +6.573669168583087e-01; -2.265062235983435e-01   +4.406558871275959e-01   +7.575825034167263e-01   +1.001479824234025e-01   +5.835361288417589e-01   +3.727083410767121e-01   -5.277625348329836e-01   -3.500763581780983e-01; +9.255714573876148e-01   +5.740400887389027e-01   -3.512685532911017e-01   +5.233050220167976e-01   +2.078285053664876e-01   -3.961449925772128e-01   +5.126912768775395e-01   +5.959067993867809e-01; -2.736790949970249e-01   +4.894768278967835e-01   +6.308292965586287e-01   -3.899417348284667e-01   +6.516084710133047e-01   +1.628069385355582e-01   +1.134936623704171e-01   +5.478671661627683e-01];
L1I_L2I_iGABA_netcon = [+5.530035838356043e-01   +2.195213339350279e-04   -1.436904362255185e-01   -1.557407224825189e-01   -2.443621799793316e-02   +2.194275182766325e-01   -3.393217789754327e-01   -1.391730693361854e-01   +3.830108813617972e-01   +7.734511080703664e-01   +6.290885077472194e-01   +6.942503011408362e-01   +4.586776060351287e-01   +7.913474518837126e-01   +5.241122408923712e-02   +7.100139663529348e-01; +2.085495107755716e-01   +7.910049613753651e-01   +4.000913407786955e-01   +5.041716161500709e-01   +1.703596911258846e-02   -8.318593721586118e-02   +2.774464108345330e-01   -6.039530877893838e-03   -2.814909268980497e-01   +1.538752839245056e-01   +9.031120853783230e-01   -7.368726299910251e-02   +5.243076854136365e-02   +5.510062073613349e-01   +3.521494267957373e-01   -3.088171976094962e-01; +2.886064284932841e-01   +1.461726152062600e-01   +1.759343552773671e-02   +4.431519512799412e-01   +2.871949163861019e-01   +3.005796457022920e-01   -1.997628437135223e-01   +2.800544889676124e-01   +2.792210821157448e-01   +3.779782163359504e-01   -2.469345509927678e-01   +3.285379441437846e-01   +5.439689497299045e-01   -4.705929453808624e-01   -2.510938902114886e-01   +4.936749350526406e-01; +8.337078796384784e-01   +3.166218289690454e-02   -3.148961934129802e-01   +3.915524178071895e-01   -1.700918969811674e-01   -2.863259393249969e-02   -1.698328298032274e-02   +4.603410962360107e-01   -1.340677216810998e-01   +2.593881766766331e-01   -3.254632619728783e-02   -1.865496086300241e-01   +4.620536426516625e-01   +7.145905887942788e-01   +2.918166793669750e-01   -2.228765155428531e-01; -5.275333468756954e-01   +4.640928618684212e-01   +3.114629928212702e-02   +7.920800933489310e-01   +8.291263180557532e-01   +1.479277759820449e-01   +3.695224571879766e-01   +3.561289772699939e-01   +2.071464745549921e-01   +8.142484759904757e-01   +1.193320720670303e-01   +4.880812938775665e-01   -1.674773671572816e-01   +5.404026170627119e-01   +2.591810361215335e-01   -1.541257094179905e-01; +5.887537119697140e-01   +4.340564927290047e-01   -2.404359015825607e-01   +3.062426787941215e-01   -1.580722557050038e-01   +1.073131639955720e-01   +4.074563104167005e-01   -1.483930265478839e-01   +2.044174354664557e-02   -4.781607306722412e-01   +1.061520188090360e-01   +1.000000000000000e+00   +9.062300514764212e-01   +4.478509670298866e-02   -3.069272746234525e-01   -1.469891789604702e-01; -1.998287167881944e-01   +3.359584360877922e-01   -3.031335441770324e-01   +3.241216990929052e-01   +1.771868333920879e-01   +1.314917361864149e-01   +8.419344350407714e-01   -1.322196684390679e-01   +7.461912580385303e-01   +3.403023849585233e-01   +4.294206637416709e-01   -3.276299508947001e-02   -4.128331764026617e-01   +6.646229248443893e-02   +4.641793924021531e-02   +9.171096607685909e-03; +1.214247628114909e-01   +4.368121380361390e-01   +3.616372211024737e-01   +2.762398117287780e-01   -3.661067903272956e-01   -2.482242028643408e-01   +7.326978678294416e-01   +3.542467196752033e-01   +5.091407929044800e-01   +8.427660743770196e-01   -1.831081015826475e-02   +5.921179961682469e-01   +5.690561690595328e-01   +6.914778936875651e-01   +7.567159371716892e-02   +1.684624497151951e-01];
L2E_L1E_iAMPA_netcon = [+2.511003997339726e-01   +8.703480047859619e-01   -3.376032140128127e-01   +2.904961679342739e-01   +3.886869642798919e-01   +9.066570926903480e-01   +3.297608922486969e-02   +4.974079938820451e-01; +1.272050442519626e-01   +3.558570153565384e-01   +8.524827668027117e-01   -4.967340461242864e-02   +5.673019299400889e-01   +1.823748877932128e-01   +5.811589477049558e-01   -1.515700448595755e-01; -5.878315502781082e-02   +6.094080843188203e-01   +4.657512798545149e-01   +1.257606942948250e-01   +3.945997949810329e-01   -4.877808205446720e-02   -3.758225327427595e-01   -1.531249539882754e-01; -1.801977365105454e-01   +2.515580034967066e-01   +3.509023951463264e-01   +7.994076615752488e-01   +1.191420925904478e-01   +3.144389690312351e-01   -1.362281322634045e-01   +2.137841677100591e-01; +2.522654723863355e-01   +6.951131097723103e-01   +2.973390293389719e-01   +3.019091478925752e-01   +6.418590365264848e-01   +1.841932037731352e-01   +4.763602983308540e-01   +3.999206924276850e-01; +8.329251096655648e-01   +2.320115849145066e-01   +7.697156192944701e-02   +6.661759378800255e-01   -8.271353221984330e-02   +4.493314724287268e-02   +1.468736446328353e-01   -3.290036471521933e-01; +5.618463035324383e-01   +2.532426219588205e-01   -1.511315975095885e-01   -2.106847787142170e-01   -3.642346485945013e-01   +6.946995993807678e-01   -3.640496283879723e-01   +4.251579583267953e-01; -1.771410175527321e-01   +1.084565164802860e-01   +5.280060622954089e-01   -1.470763537115043e-01   +5.261460742835640e-01   +4.627535939011593e-01   -2.469006917305626e-01   -4.005951477665154e-01; +3.857210914172623e-01   -1.760320449103802e-02   +8.568825648221991e-02   +1.924761333073504e-01   +2.995327283780333e-01   +4.843840449735979e-01   -4.392132880855665e-01   +4.772005793857649e-01; +2.810672765751861e-01   +4.315300665532996e-02   +7.415979103100451e-01   +2.678903156381391e-01   +2.730793727412398e-01   +7.189332937843042e-01   +5.326167191330222e-01   +1.000000000000000e+00; -2.362904913663990e-01   +5.337417935527888e-01   +5.041914057412896e-01   +6.730470388833706e-01   -3.185453941983474e-01   -3.063929174058544e-01   +7.011919629901177e-02   +3.072259893804666e-01; +4.928305255613567e-01   +1.030534286468408e-01   +7.598697930611419e-01   +3.082647805883649e-01   +4.948922290787673e-01   -1.083108377755321e-01   -6.636043484880780e-03   +1.958873709417892e-01; -3.632613867825696e-02   -4.382023120446515e-01   -1.601892217145633e-02   +3.315955594486679e-01   -1.716469290376639e-03   -3.098383662205504e-02   +2.723977534540628e-01   -4.329515645780708e-01; +2.386133404405114e-01   +4.909422532951300e-01   -1.777633621502065e-02   -1.636237984904598e-01   +2.580900784641009e-01   -5.369406767946081e-01   +6.045136850937615e-01   +7.245491263820579e-02; +2.529627239443861e-01   +3.155802326217105e-01   +2.335115196991840e-01   +8.583865367088153e-01   +4.836441516034902e-01   +4.859286388440305e-01   -3.442073172832685e-02   +7.892004835024989e-02; +2.369170599710941e-01   -3.950487194129949e-01   +3.170686715677984e-01   +1.702663929287716e-01   +1.833980000071527e-01   +2.716767594735339e-01   -8.171010383569351e-02   +3.683832780137538e-01];
L1E_L2E_iAMPA_netcon = [+3.342987097434253e-01   +3.805316816193918e-01   +9.413472474186185e-01   +4.042203063356573e-01   -2.137894416550110e-01   +5.597850000980765e-01   +5.151771909572084e-02   +5.720597155501371e-01   +3.503946341215198e-01   +5.488395941430964e-01   +4.715569404749721e-01   +3.374018950566583e-01   +9.695608235990250e-01   +5.182947023018671e-01   +1.418096967860560e-01   +6.702371978819877e-01; +3.502689463100802e-01   +4.719740889698641e-01   +3.040858171525313e-01   +2.367012566032642e-01   +1.876436955291341e-01   +6.652708621151170e-02   +3.419175611213400e-01   +3.804791821575106e-01   +3.222248807475743e-01   -3.538732982863614e-01   -2.753062236212832e-01   +9.013462290436873e-01   +1.632522891501914e-01   +6.265579100656874e-01   +1.535726744308560e-01   +5.933942349070183e-01; +3.996471576753768e-01   +6.236273375213314e-01   +1.000000000000000e+00   +1.591947996883888e-02   -5.841889750922193e-01   -1.228808859550063e-02   +4.226604121830147e-01   +4.717826122548550e-01   -2.914310801304869e-01   -3.608678814627741e-01   +5.822088560272440e-01   -2.051320271695150e-01   +1.641679293607291e-02   +7.932479004814935e-01   -4.842420736040583e-02   +4.577357390484924e-01; +2.746698332327635e-01   -5.240228225171290e-02   +4.029567314882440e-01   +4.926645647509160e-01   -4.379448234337850e-01   +8.750661531997413e-01   -6.604898538568585e-02   -2.503303756983533e-01   +1.204706699438932e-01   -3.424896016809861e-02   +4.268534719732879e-01   +2.373948395329811e-01   +9.499650662330452e-01   +8.682557522240713e-01   +1.470663988031169e-01   +5.136926567358314e-01; +1.959935556841768e-01   +7.610579717799011e-02   +6.297829412077224e-03   +5.768438975719543e-03   +6.183106244200821e-02   +3.374930484359888e-01   -1.377164870319312e-01   +5.124301382429118e-01   +1.428124274762296e-01   +4.767907191580301e-01   -5.479996679633329e-01   -4.560875950256331e-02   +3.064998485465689e-01   -3.692346336146285e-01   +2.947997981170908e-01   +9.507321576172266e-02; +6.233219228221180e-01   -1.115803829753190e-01   +2.171975655367394e-01   +5.346504928362820e-01   -2.669841195689788e-01   +7.893391211090857e-01   +5.599296723513192e-01   +4.645517839266476e-01   -3.088962362213586e-01   +5.511273926550012e-01   +5.951239003455606e-01   -1.000236456968998e-01   +1.043972445511951e-01   -2.508187330322447e-01   +1.635585570860415e-01   -4.546446457894457e-01; -3.552546874838320e-01   -2.888002123414049e-01   +4.036074146143451e-01   +1.504785135440992e-01   +3.979902883977081e-01   +6.008192169077128e-01   +8.725164025590353e-01   -1.472053976330801e-01   +4.537164210548165e-01   +8.107433817992614e-02   +6.260553831780605e-01   +5.139679703672558e-01   +7.157255544710551e-01   +5.281330905358972e-01   +8.107241121885823e-01   +8.185096599015457e-01; +8.008669459810960e-01   -3.546996064677047e-01   -1.744610449895371e-01   +7.657915254712332e-01   +2.513524546247043e-02   +1.309929587837868e-01   +4.925988130425052e-01   +3.806938833511981e-01   +3.837134545249898e-01   +9.177969012393657e-02   -3.128969445517795e-01   +7.052809141019245e-02   -2.624015930775747e-01   +3.514075108181759e-01   +7.622253778232816e-01   -8.861159914935711e-02];
L2I_L2E_iAMPA_netcon = [-5.159123318503117e-02   +1.576286367115614e-01   +8.603838255621603e-01   +3.313756381371576e-01   +3.589798487566245e-01   +5.530715320640108e-01   -3.423802700925218e-01   +5.050491797898926e-01; +7.247339193887982e-02   +5.126160865942072e-01   +5.667460244387179e-01   +6.150896970944182e-01   +6.623433132186037e-01   -3.343509409656781e-01   +3.291450145791915e-01   +2.474143966969231e-01; -3.679904265464183e-01   +4.947848664624679e-01   +5.659204843445467e-01   +6.739355145062502e-01   -2.499456128396746e-01   +1.218590608508103e-01   +3.946458687674768e-01   +4.382294776176311e-01; +4.397673254732746e-01   +7.364227749491569e-01   +2.015616952709206e-01   +3.347189927764899e-01   +4.348037584913765e-01   +1.720379365981368e-01   +7.364745406470939e-01   -2.004480730639696e-01; +6.762551310811752e-01   -3.265603422943539e-01   +9.539660401364544e-01   +5.146126806822107e-01   +1.014451491800338e-01   +5.303641693746743e-01   +8.747529044412403e-01   +1.000000000000000e+00; +6.217964353414632e-01   +2.496708162841196e-01   -1.836013587709837e-01   +3.875777544860968e-01   +8.625635999017763e-01   +4.758793070329333e-02   +4.829280373416636e-01   +6.257156766366121e-03; +8.049019049688633e-01   +2.577718345531651e-01   +1.536371701356282e-01   +6.589118997551771e-01   +2.630378515748786e-01   +3.259541928577562e-01   -3.831197940768993e-01   +7.246119923072719e-01; -1.208031001376853e-01   +6.583389553062087e-01   +6.415038154702440e-01   +7.740333196642663e-01   +1.093916900466244e-01   -3.734000913653261e-01   +4.190085008169575e-01   +3.351428587764674e-02];
L2E_L2I_iGABA_netcon = [+7.790630724668057e-01   +5.159826249580289e-01   +3.540004264786721e-01   -3.785455448985541e-01   -2.159086713586600e-01   -2.386320021885538e-01   +7.883443566360141e-01   -2.688447078544308e-01; +3.273319410692786e-01   +7.733863269945720e-01   -7.513430699745498e-02   +9.259098924185469e-01   -4.186734741547244e-01   -1.135062030249573e-02   -9.237878158611464e-02   +5.935879039723683e-01; -4.811881467068025e-01   +1.201657625676674e-01   +1.876184320712810e-01   -2.117469613600399e-01   +8.162952590031464e-01   +7.542218118293657e-01   +7.948018987347655e-01   -2.599754514180295e-01; +2.478844058877706e-01   +9.255366883866220e-01   -1.085215734384754e-01   -1.486204843611889e-01   +3.542772702119363e-01   +4.423139508562207e-01   +9.686481283718228e-02   +5.165924356954350e-02; -2.386225212208697e-01   -1.888580288537090e-02   +3.718581966520657e-01   +3.389983273101475e-01   +4.081492237315042e-01   +7.017072084344010e-01   +2.952728943604390e-02   +5.902883311871763e-01; +2.431707890371862e-01   +7.544786633801551e-01   +2.434629816651888e-03   +3.560728157413493e-01   +6.476625094470347e-01   +6.301649664073814e-01   -1.114761668444941e-01   +9.389355740582642e-01; +7.580599446553767e-01   -2.406527120212248e-01   +9.255340316945142e-01   -5.445830336730666e-01   -3.280305203217260e-01   +1.000000000000000e+00   -6.711565486753179e-02   +4.173505964135134e-01; -1.042165211870152e-01   -8.101272552809045e-02   -3.182814396064704e-01   +6.671481921596112e-01   +5.869054218973859e-01   +8.608187995823881e-03   +5.781105201479319e-01   -1.670926209377822e-01];
L3E_L2E_iAMPA_netcon = [+3.231564053751891e-01   +6.335695659596909e-01   +6.847639703752207e-01   +2.359915903286355e-01   +1.888954058102026e-01   -3.771783262962324e-01   +1.562550681291748e-01   -9.721536900686086e-02   +7.745880288846198e-01   -1.132376222653179e-01   +6.886029975901894e-01   -5.262004644501786e-02; +8.303927212546157e-02   +2.890544599287408e-01   +6.878415667942196e-02   -2.433502307726928e-01   +5.039444199077558e-01   -1.399139375076936e-01   +1.573139826483670e-01   -5.262170512254136e-02   -2.347340990018836e-01   -1.622095699649089e-01   +1.256276634681806e-01   +3.481608352204589e-01; -2.171405421740754e-01   +6.886440886077925e-01   +1.595361793822429e-01   +2.199660924708495e-01   +4.131986554490483e-01   +7.158746596562413e-01   +3.505980266702339e-01   +3.049218590061374e-01   +4.525290893521489e-01   +3.145935434299635e-01   -3.692930019689533e-01   -1.385578987962796e-01; -4.599816295383758e-01   -1.162337898763131e-01   -4.395702743616917e-01   -2.710009596879715e-01   +7.376665394462233e-01   +2.455599924193783e-01   -1.009730560952333e-01   +3.011056098861424e-01   -1.911159773905300e-01   -2.329316076622086e-01   -2.332331543027558e-01   +1.000000000000000e+00; +1.121801589858482e-01   +2.990389361954698e-01   +2.311266443336459e-01   +2.692430319680253e-01   +1.441328401651305e-01   +1.626184082410689e-01   +6.515035748147360e-01   +5.729009122720281e-01   +3.520923996212864e-01   +3.337404844765992e-01   +4.684212378729053e-01   +6.577682409720735e-03; -2.867355438899644e-01   -1.568072686550475e-01   +3.600102985106887e-01   +3.353177536584656e-01   -9.253332405213442e-02   +1.218214260099729e-01   -2.847206304670870e-01   +3.211998663703851e-01   +1.858450024467306e-01   -1.370065840081490e-02   +9.040557285287232e-01   +3.963473060456978e-01; +1.549229551967005e-01   +5.505207592610277e-01   -1.169089339003536e-02   +4.086532157059450e-01   +5.260314260951195e-01   +5.935729118700461e-01   -1.509595538794581e-01   -1.647610516734186e-01   +1.775124739414158e-01   -2.875083459187650e-01   +4.703891133095015e-01   +3.324718750474385e-01; +4.346839958469036e-01   +2.398713879418557e-02   +8.452198325067038e-01   -3.133332956437745e-02   +4.743937917835198e-02   +2.478790252100818e-02   +8.112955806842769e-01   +4.509516232732814e-01   +8.133278201350171e-01   -1.435159947437828e-01   +5.222290285257138e-01   +7.111408287186118e-01];
L3I_L2I_iGABA_netcon = [+3.287654123464643e-01   +2.085817558792264e-01   +5.778282357462133e-02   +5.058196897666579e-01   +2.579268257320418e-01   +2.564130140914383e-01   +8.295139790509053e-01   +2.144714797104472e-01   +5.662241179176195e-01   +2.666169563504658e-02   +2.209041133986936e-01   +4.539251366350903e-01; +5.332107307318695e-01   -5.041200711141280e-02   -2.679732351935908e-01   +6.220383113996145e-02   +9.299129924905801e-01   -6.057247607373752e-02   +6.077394393568230e-01   -2.740423086838434e-01   +2.216367733397804e-01   +1.754902760648930e-01   -3.694306871859730e-01   +4.515916109466321e-01; +2.037708703005261e-01   +3.683274843613784e-01   -3.418272354927665e-01   +7.164932519923007e-01   +8.389231689456131e-01   -2.647249734552117e-01   +4.089180539009457e-01   +6.830934051306226e-01   +1.000000000000000e+00   +8.927611275190115e-01   +4.606394544430617e-01   +2.827209593836457e-02; +1.003051328992123e-01   +7.011983677912212e-01   +2.537327034288639e-01   +5.553814985970484e-01   -1.611141095601034e-01   +2.442120794549313e-01   +8.525147540663766e-01   +4.920242800893903e-01   -3.282039548601715e-01   +4.649000494220502e-01   +3.917485570686842e-01   +6.587576008806303e-02; -2.982928648349508e-01   +6.992619613883216e-02   +5.919494733350262e-01   +7.896504624598810e-01   +2.376416823095709e-01   +7.735552371220443e-01   -1.168369652174355e-01   -1.996750604017269e-01   -3.769838010851574e-02   +8.869771873267101e-03   +9.251438639538861e-01   +6.952002332966768e-01; +2.620150851105710e-01   +2.683966297260414e-01   +3.773558900793647e-01   +2.274287582153423e-01   +8.785568298625076e-01   +3.994372884220811e-01   -9.004724276265935e-02   -5.690069366036052e-01   +6.902848435441488e-01   -2.353167023235202e-01   +1.255201965199632e-01   -1.107338803438943e-01; +8.533099063587416e-01   +2.927397005935752e-01   -2.583762048179065e-01   -4.186801522681197e-01   +2.252133039689005e-01   +4.943201257069618e-01   -1.940493267984478e-01   -3.458545130451741e-02   +6.639344289278747e-01   -5.675945169795148e-01   +5.734928238636849e-01   -1.946829399503341e-01; +3.867741873147389e-01   +6.678227842739033e-01   -6.069030272291928e-01   +3.343467220994783e-01   +8.652798793091365e-01   +7.680315648818574e-01   +4.862343237308568e-01   +5.739880966530047e-01   +2.477893520077173e-01   +4.910126558892261e-01   -5.751238714429963e-01   -2.758034636310395e-01];
L2E_L3E_iAMPA_netcon = [+3.170813499342484e-01   -2.481475244994537e-01   +8.488029632583093e-02   +3.892852294643577e-01   -4.773768717988723e-01   +6.400871425545951e-01   +5.624473852272017e-01   +1.910690617500772e-01; +7.652818350337580e-01   +3.050810145906293e-01   -9.118759956701016e-03   +3.733404085414703e-01   -1.830525193779058e-01   +8.327354687179708e-02   +6.571013182734408e-01   +6.453124365636506e-01; -3.010755115932802e-01   -5.049430145223572e-02   -3.389916830755577e-01   +2.057057775815326e-01   +8.206958621354572e-01   +4.649859797886488e-01   +6.494099257161446e-01   +4.607356187412721e-01; +3.133314554667953e-01   -2.344114532866182e-01   -2.310499171650721e-01   +7.414633573208138e-02   +7.128131621503259e-01   -2.329149209228224e-01   +1.712278951746514e-03   -8.559450148817906e-02; +8.280312074148902e-01   +3.045843970702008e-01   +6.239727626059388e-01   +2.512660632239671e-01   +8.897364836530883e-01   +2.382299258873615e-01   -1.709481581170646e-01   -3.250653391559166e-01; +7.167047322594534e-01   +6.267655894416817e-01   -4.624066176469952e-01   +8.628352346770231e-01   -2.712855515350839e-01   +1.643939102457537e-01   +1.160130118162080e-02   -1.761470384790293e-01; +5.187940815708592e-01   -2.953808773573853e-02   +9.967046470601547e-01   +1.993192554453340e-01   +5.971957555832921e-01   +2.174709209512786e-01   +5.355558595622830e-01   +2.716039747080985e-01; +2.218831788472301e-01   +4.901487826830744e-01   +3.973240501653392e-01   +4.650551904658691e-01   +1.783016947274990e-01   +2.547695381574958e-01   +7.573301480054405e-01   +2.846677793100714e-01; +2.580864040445180e-01   +1.982690586484642e-01   -6.920418738283336e-02   +5.714953320310931e-02   +2.494909254446378e-01   +4.207544862087730e-02   +4.226891726131874e-01   -6.408591788660700e-01; +5.126143132045716e-01   +9.835350400937790e-01   -4.224154321900595e-01   +5.287332195766101e-01   +3.018202433940286e-01   -8.309044810397928e-02   +4.376479549073660e-01   +1.170183759697945e-01; +8.283125196908856e-01   -3.745282970853780e-01   -4.152046130702344e-01   +6.869247927404736e-01   -3.444709045481995e-01   +2.329382336260251e-01   -2.625383128745915e-01   +1.000000000000000e+00; -4.422541543800256e-02   +9.837801815084325e-01   -2.628699127252803e-01   -2.606966176145197e-01   +3.567756837038099e-01   +9.222415429443085e-01   +3.994615838113556e-01   +6.746165533167322e-01];
L2I_L3I_iGABA_netcon = [+1.411951016806644e-01   +6.957183592297531e-02   +4.107050148862033e-01   +2.575337704137832e-01   +2.538875862595820e-01   -1.247931585255348e-01   +4.129771465395712e-01   +8.220796198340867e-01; -2.945690752982246e-01   +2.422747142898978e-01   +1.238175748566637e-02   +1.140951656095884e-01   +2.683082585703297e-01   +1.184229194402790e-01   +6.714661157042577e-01   +8.731001461748202e-01; -2.610404330122668e-03   -3.683651797177492e-01   +3.122840471881846e-01   -3.011338123014132e-01   +5.393225199688603e-01   +7.235349710514453e-01   +1.000000000000000e+00   -4.389898757903801e-01; +6.534518546481271e-01   +8.934316768039734e-02   -3.137708635953687e-01   +2.005099270607262e-01   -5.278385199789502e-02   +3.047819745522762e-01   +3.574699402524286e-02   +3.516843807102134e-01; +3.463389348523236e-01   +3.930991707391422e-01   -1.211201275379712e-01   +1.291142383266756e-03   +4.941457755091804e-01   -1.117780598609301e-01   +8.139040479102543e-01   +6.908823639989932e-01; +8.091555187260887e-01   +6.784506470432411e-01   -2.716776658528725e-01   +1.821365513527008e-01   +6.311222123521641e-02   +1.552871400610136e-01   +2.190088621488312e-01   +5.968661842279667e-01; -2.955889414232920e-01   +7.080952048180136e-01   +6.776539888544444e-01   +2.260438442426126e-01   -2.770757691618467e-01   +2.337474933565245e-01   +1.008968595997553e-01   -4.088502742711024e-01; +2.701128593897723e-01   +7.547796069598144e-01   +3.095232946969555e-01   +8.389279464055176e-01   +5.925288283001818e-01   -6.264177001321214e-02   -2.159951677086447e-01   +2.036359104948912e-01; +9.322442526268304e-02   -8.022938421111325e-02   -5.796424968956907e-01   +2.215207815408593e-01   +4.219827667675287e-01   +5.056993710814381e-01   +4.561147748951076e-01   -3.376596045310648e-01; +1.499566968855810e-01   -1.628344136233429e-01   +8.227279600634468e-01   +8.275311693200558e-01   +1.479704115071501e-01   +7.328695900504011e-01   -4.898759446370594e-03   +5.440800418782710e-01; -3.953795079394566e-01   -5.045043027849779e-01   +2.862697930646843e-01   +6.542438240375307e-01   +7.149936557633285e-01   +9.625749423932414e-01   +5.077485847755824e-01   +6.864891165473964e-01; +7.682866931008092e-01   +3.489832022844729e-01   +3.453893103645151e-01   -3.981723632814294e-01   +5.736064198019365e-01   -1.785529817264726e-01   -1.212513550182192e-01   +4.309067495762951e-01];
L3I_L3E_iAMPA_netcon = [+3.021833064972936e-01   -5.189364984847427e-01   +7.695280103999563e-01   +2.582389061438496e-01   -1.303540057208004e-01   +2.116790444513828e-01   -5.099546831667413e-01   +6.974340039279167e-01   -1.956376953248303e-01   +8.355967250566781e-03   +9.222033892145023e-01   +3.004492485495205e-01; +3.543786639684445e-01   -4.664849518195305e-01   +2.974882235075392e-01   +8.171394397571276e-01   +8.228577907314700e-01   +6.859310099633928e-01   +5.846192212899677e-01   -2.345287121057905e-01   -2.161393271430914e-01   -1.766828325328505e-01   +3.785360688338444e-01   -2.348832102500822e-02; +1.114643048057513e-02   -8.959178866971500e-02   +1.936651404061624e-01   +4.805864226090278e-01   -1.089168923076786e-01   +4.917637834884229e-01   -4.408106210417349e-01   +4.400940693525506e-01   -4.527982770911636e-02   -1.284523831954085e-01   +4.801656662610149e-01   +1.577822619750685e-01; +3.728188639868601e-02   +3.338555943831967e-01   -8.387895097582351e-02   +2.165117879122062e-01   -2.078731435558463e-01   +9.546855795988576e-01   +2.998404604903773e-01   +1.427801258270185e-01   +1.499485028403862e-01   +3.192071791039588e-01   -2.423453877549412e-01   +1.745794064222787e-01; +2.397314185488760e-01   +4.852628752517921e-01   +6.956808358314255e-02   +5.199525067815914e-01   -2.950391344119273e-01   +2.736636743604239e-01   -3.730322170122529e-01   +2.139456118248272e-01   +7.876638102070389e-01   +5.746043150720028e-01   +9.148218200574058e-01   +6.287140744788187e-01; -1.882877926345755e-01   -1.296017841353100e-01   -2.129490274302421e-03   +3.991022219534103e-01   -2.319091082797905e-01   +6.341066186770593e-01   +8.013013107029443e-01   +4.535104758006341e-01   -2.096092140241406e-01   +2.415267214487580e-03   +3.464725896720544e-01   +5.835080638039521e-01; +7.807315764638574e-01   +3.625843065201865e-01   +3.945537034001615e-01   +7.818657610202159e-01   +2.264493617927925e-01   +1.000000000000000e+00   +5.008907214485735e-01   -4.241013552430341e-02   -9.942495372949599e-02   +2.314806326203014e-01   -2.797850094547421e-02   -1.226856713523107e-01; +7.803553683739516e-01   +4.055512074022457e-02   +5.483163494222364e-01   +5.018993500865777e-02   +4.921037219250173e-01   +3.754502068860079e-01   +7.692805046127077e-01   -8.624703160180569e-02   +2.747529276010020e-01   +7.297295620321613e-01   -7.326690882073100e-02   +4.023098330337563e-01; +2.614635785544372e-01   +1.311717827908453e-01   +3.888352419813329e-02   +3.317114322377380e-01   -3.383596527566052e-01   +4.404919478211228e-03   +5.661792613878096e-01   +6.125813674790723e-01   +1.875048682620887e-01   -2.414040765123950e-01   +3.327745785301852e-01   +1.683935134803110e-01; -1.504425224410442e-01   -1.848909104422005e-01   +3.437926606021575e-01   +2.863880512944319e-01   +5.628644846056534e-01   -1.294487884879464e-01   +4.009835447752138e-01   +3.546477936734816e-01   -3.803139944589981e-01   +1.633958162074548e-01   -1.089756041548022e-01   +6.950169512752652e-02; +7.875004202687832e-01   -3.366327342224551e-01   +4.114142070114753e-01   +9.161014597153253e-01   +5.079324724730458e-02   -7.431931427455693e-02   +6.847095204453660e-01   +3.981932788607693e-01   +4.833863173546147e-01   -4.275690963517750e-01   +4.820250824035955e-01   +7.355591145074118e-01; +2.382770738516296e-01   -1.777976709024703e-01   -4.467444981956073e-01   +6.284320958993885e-01   +5.164825742798871e-01   +2.824507701352553e-01   +5.682227803101526e-01   +6.079490140997496e-01   -1.947065086539785e-01   +1.342758287111337e-01   -4.339039364423827e-01   +2.373724391348630e-01];
L3E_L3I_iGABA_netcon = [-2.932266179553643e-01   +2.463086170195224e-01   -4.532430762680906e-01   +5.631770824654575e-01   +6.309359156545452e-01   +6.122454462285810e-01   -3.731053864877185e-01   +2.645793773480182e-01   +6.504034721761655e-01   +5.656453083646089e-01   -4.405693248651242e-01   -2.339754213134601e-01; +5.910335030332130e-01   -1.423133009272195e-01   +1.843002471319554e-01   +2.484480215432892e-01   -1.278377487464600e-01   +3.485824296940688e-01   +4.160056659358246e-01   -1.222944080946212e-01   -4.042985608323257e-02   -9.377009451732683e-02   +3.999568155268291e-01   -7.999502772570526e-02; -3.846822823374685e-01   +5.273971462494284e-01   +4.055280197245604e-01   +2.568585453690242e-01   +4.240946697307069e-01   +6.123843912415554e-01   -2.323312801489535e-01   +7.203692564622844e-01   +4.954868895898875e-01   +8.932113770285438e-01   +2.985224317841276e-02   -3.941288361301900e-01; -4.272522771792263e-01   +5.726901672674385e-01   +7.215947665256709e-01   +6.398557130839267e-01   +3.801834050216899e-02   +3.216194541381027e-01   -2.649338639347242e-01   +2.748109427193131e-01   +3.119059940148715e-01   -4.251557299073984e-01   +1.270168380965775e-01   -5.254950733604774e-02; -3.132030903373982e-01   -9.065755617267443e-02   -1.088372446254414e-01   +7.407940638280117e-01   +4.240804380377500e-02   +3.416057432053961e-01   -5.112176250733200e-02   +2.481151205641240e-01   -3.422715529216921e-01   +4.827809390611780e-01   -1.784620480494160e-01   -7.707433530641204e-03; -2.891963845095554e-02   +4.004546778170583e-01   +2.130333805712546e-01   +3.124921082716338e-03   +3.238211300269345e-01   +1.000000000000000e+00   -2.878546962263722e-01   +2.377065079095973e-01   -3.461617893163993e-01   -2.438930510096194e-01   +6.790160110325272e-01   +1.707928919347266e-01; -3.859299512648567e-02   -2.045483651628767e-01   +2.576560982751241e-01   -2.709754566016317e-01   +2.736075366197734e-01   +6.685416303791057e-01   -2.004878218454058e-01   -3.276291150261621e-01   -1.729482768419553e-01   +6.244616437098427e-01   +1.126417903922144e-01   -1.292472722975153e-01; +5.216053357629644e-01   -1.942694309050752e-01   +4.798315814266709e-01   +9.315643243202958e-02   -3.220207726264647e-01   +1.757500506598078e-01   +1.786084880808648e-01   +2.328728208756121e-01   +2.070019498675742e-02   -4.225407560990916e-01   -1.557544306322673e-01   +4.283111488873843e-01; -2.460010086777131e-01   +2.911841628721624e-01   -1.872755445659809e-01   +5.793342611380318e-01   +2.532711474221487e-01   +6.529632589521583e-01   +8.185963626282270e-01   -1.135037668478312e-01   -7.324003907562358e-02   +1.214281075067704e-01   +7.276137730249467e-01   +5.445584463201322e-01; +3.727963839360040e-01   +6.294825881581634e-01   +9.696008306094153e-02   +6.738051348042237e-01   +6.252977746018638e-01   +9.921565632385478e-01   +5.388977646887023e-01   +6.372964466877966e-01   -4.494262058514482e-02   +2.345991863065809e-01   +4.540755141743175e-01   +7.369862617713607e-01; +1.409073286614166e-01   +2.411470933262129e-01   +4.478659634414275e-01   +4.431104272141613e-01   +3.342890250390548e-01   +5.129605189258176e-01   +7.010937820159339e-01   +7.043285477436091e-01   +2.320917418849048e-01   -5.462866831213054e-03   +3.571289650879729e-01   +1.792951168743560e-01; +3.319597056960124e-01   +2.813725946779959e-01   +2.206962419465528e-01   +1.257022894097447e-02   +7.790982870872647e-01   +1.939609835418356e-02   +3.230431168627232e-01   +5.464715484122407e-01   +7.063275349623327e-01   +6.479334153833992e-01   +4.230967444579208e-01   +9.082910515293559e-02];
L2E_Input1_iAMPA_netcon = [+7.066701000354682e-01   +7.891286727645166e-01   -1.218487158343681e-01   -2.296627271603079e-01   +6.403761267617360e-02   +6.725255097450410e-01   +8.968297139732223e-01   +1.000000000000000e+00];
L2I_Input2_iAMPA_netcon = [-2.687309089335557e-01   +1.057802659486273e-02   +6.759768649420180e-01   -6.967139598136450e-01   +7.480057601116206e-01   +2.961127528165770e-02   +7.028254550463207e-01   +8.524605819146583e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.4*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 1.0*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 1.0*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.4*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 1.0*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 1.0*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 100*(sin(2*t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 100*(sin(2*t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
