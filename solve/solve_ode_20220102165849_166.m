function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+7.911733935911313e-03   +3.825590169492982e-02   +5.968031927706762e-02   +4.747538845071647e-02   +4.473697697033822e-02   +7.682773161572838e-02   +3.188583987596160e-02   +1.024937984654687e-02   +1.855922612547168e-02   +3.452488655940673e-02   +4.673086458796041e-02   +2.089994205975756e-02   +3.080235517871170e-02   +5.424320459007625e-02   +3.326168451680586e-02   +8.729751150986101e-04; +2.826542932374842e-02   +1.927294166681418e-03   +3.836603460962047e-02   +4.374936509553945e-02   +1.939079954781971e-02   +2.307992929581196e-02   +7.010301710677927e-02   +7.391938633747308e-02   +5.041983980816098e-02   +1.901329918147815e-02   +6.968997612172860e-02   +1.459028782591481e-02   +1.258751819667227e-02   -5.976487919851576e-03   +3.890770138433041e-02   -5.505308224852670e-04; +4.790601990869107e-02   +4.810670714495941e-02   +6.090421648500995e-02   +3.936259121886034e-02   +8.047581089978164e-03   +6.596247683632962e-02   +5.949609876520535e-02   +3.223746676379781e-02   +2.960166359293652e-02   +2.468028863152350e-02   +3.167719688544457e-02   +1.432400276831091e-02   +1.019143793224184e-03   +1.187488518860844e-02   +6.160621683980001e-02   +4.259614960132702e-02; +1.530881867171208e-03   +5.120666848371674e-03   +2.941575129323171e-02   +4.634035016667548e-02   +1.786781638017845e-02   +5.179963737144003e-02   +3.215380208664663e-02   +7.321698526569934e-02   +2.913471604856333e-02   +2.020605340358946e-02   +5.969494149663580e-02   +6.759450680727398e-02   +1.424458369234091e-02   +6.492557555048384e-02   +1.786334287104025e-02   +2.247150242326090e-02; +3.896240327536291e-02   +4.604385226316222e-02   +4.860753112066705e-02   +4.962471769163910e-02   +2.981037531147869e-02   +6.363531033025159e-02   +3.654359319476377e-02   +1.831036450358618e-02   +3.746779163156013e-02   +6.156360273883543e-02   +2.487715980642618e-02   +5.244893455527075e-02   +1.338930422189426e-02   +1.917786332782728e-02   +7.041943343828409e-02   +1.411998403730119e-02; +3.379807723432057e-02   +5.002909495445798e-03   +5.838785276984435e-02   +1.434453997853968e-02   +4.153849218861269e-02   +2.573205686459278e-02   +2.592260049353324e-02   +1.676051054605620e-02   +2.948137404748828e-02   +3.701442469628866e-02   +5.407008013156706e-02   +1.447362085997766e-02   +3.564877370456664e-02   +3.782869510287865e-02   +3.480287703456373e-02   +5.225272541782477e-02; +2.147438869485327e-02   +5.121059663609881e-02   +6.784507250269890e-02   +4.306394203649794e-02   +3.143145021525799e-02   +4.145470818702430e-02   +2.534160942656368e-02   +6.504562604828830e-02   +7.052051835468873e-02   +2.643326391407975e-02   +8.920099279108657e-03   +1.592574419982640e-02   +3.041484655406064e-02   +6.670329859076775e-02   +5.380731776932873e-03   +1.388162575739431e-02; +4.251362146424503e-02   +2.323318502207512e-02   +5.086546873974087e-02   +4.636427450820903e-02   +4.535689192323653e-02   +8.731256039136361e-03   +4.564748607025933e-04   +3.959818618912584e-02   +5.704849296807703e-02   +4.669843358770579e-02   +1.787024985749784e-02   +5.577773534098305e-02   +1.386548258403107e-02   +9.742211545135614e-03   +4.577980187352276e-02   +4.249129210834206e-02; +2.798075730695323e-03   +4.944546600220891e-02   +4.442615576254973e-02   +4.730748665111672e-02   +3.551370586709611e-03   +6.339142326229154e-02   +2.626999923647891e-02   +3.379712542591801e-02   +4.048275611150110e-02   +3.415191155382594e-02   +1.163685768232716e-02   +6.547028412395102e-02   -3.741657005506460e-03   +5.378574162763603e-02   +2.415266421897908e-02   +2.739070544011257e-02; +4.389724460948086e-02   +1.329996338012927e-02   +6.731681974891777e-02   +5.542534565716736e-02   +4.537069980349235e-02   +1.587939389838834e-02   +1.089932507353397e-02   +4.753762656379969e-03   +5.423898335074245e-02   +3.055381563477031e-02   +6.116568710425629e-03   +4.490198797484181e-02   +6.820622840023720e-02   +1.620860173849251e-02   +6.244933179412561e-02   +4.690281166042467e-02; +3.130632542179428e-02   +3.743311651473416e-02   +3.509045518247798e-02   +5.814052722466181e-02   +6.080560373750396e-02   +1.099210862573638e-02   +4.707334884107543e-02   +4.228420754832699e-02   +1.651571706195212e-02   +1.548483187542683e-02   +4.884901368427592e-02   +6.849155930183615e-02   +1.007852909076102e-02   +4.427001980541308e-02   +5.358403285103798e-02   +1.521397880780100e-02; +3.853386641029501e-02   +1.877492137432736e-02   +4.427825494318798e-03   -8.529563370116031e-04   +6.251602013898137e-02   +6.708344554588871e-02   +7.766719454462405e-03   +4.900308591188034e-02   +5.015046675709077e-02   +2.360418761554264e-02   +6.664659458405815e-03   -1.222565788506103e-03   +6.825635837992511e-02   +4.101861997140885e-03   +3.730786773927363e-02   +3.435468978493888e-02; +4.602954099004959e-02   +5.215278961660062e-02   +6.132814360298845e-02   +1.200430231593557e-02   +4.919041860140611e-02   +5.045535940429202e-02   +5.427713434227979e-02   +5.086810817050224e-02   +5.707166010652053e-02   +2.952428298069779e-02   +2.883371399070117e-02   +7.042985642463241e-02   +5.548244625999080e-02   +4.765949935397435e-02   +3.237924475169736e-02   +6.398805977804105e-02; +5.975760965980705e-02   +4.802924297868465e-02   +2.207642014807289e-02   +3.987459646144917e-02   +5.585663851376568e-03   +1.677462362927119e-02   +9.297201581457802e-03   +1.573420654728940e-02   +2.372795840608274e-02   +5.386248330798432e-02   +1.159522098539122e-02   +6.393572387384350e-02   +4.478616351503347e-02   +4.851688941383318e-02   +2.800202628985213e-02   +2.454487216764126e-02; +3.234709653990775e-03   +3.707690901413602e-02   +6.181319344499185e-02   +4.165557458063089e-02   +2.339373613611565e-02   +1.211945766114911e-02   +1.808498163157991e-02   +3.141483049250813e-02   +2.149808342959185e-02   +6.806850921115323e-02   +2.293742836136927e-02   +6.149043330292900e-03   +6.136785175171697e-03   +5.601716346252629e-02   +4.066472062574818e-03   +5.029035149068701e-02; +5.798315914846506e-02   +1.832680833185873e-02   +1.574091613355612e-02   +6.888700821831441e-02   +5.552124063763908e-03   +9.457509487711860e-03   +6.078047194308159e-02   +5.871677387196486e-03   +3.662992990588465e-02   +5.713830364863270e-02   +5.269018490531664e-02   +1.038660856359913e-02   +5.510092353296597e-02   +5.419622706250328e-02   +7.290081481461193e-02   +6.578555718521477e-02];
L1E_L1I_iGABA_netcon = [+3.413074175069913e-02   +4.229322530122913e-02   +1.316987545197649e-03   +2.155549979624606e-02   +5.756841474887988e-02   +2.763489819778793e-02   +2.758554088821981e-02   +1.311834673612643e-02   +1.120299083874266e-02   +2.184163032922267e-02   +2.426025433124587e-02   +3.755217368089562e-02   +2.001556481375196e-02   +6.554093920941061e-02   +1.531795185493521e-02   +3.450797188157948e-02; +6.459980861874163e-03   +6.291014073996022e-02   +3.648617426012853e-02   +5.853771692520408e-02   +3.202344526961469e-02   +3.443132543099842e-02   +1.584829519616058e-02   +3.611108920763270e-02   +3.852612187323963e-02   +1.223223848002404e-02   +1.488381166583566e-02   +4.904384292893706e-02   +2.729666957893265e-02   +4.965410084980408e-02   +3.841725010304723e-02   +5.392595957019336e-02; +4.433330152697983e-02   +7.171186481422655e-02   +6.388967413161553e-02   +4.973881016674842e-02   +8.913105621709739e-03   +3.449385177107735e-02   +5.008353029792793e-02   +6.569334498479570e-02   +6.377572263531517e-02   +7.695886583563458e-02   +4.989689747812912e-02   +3.693259873873989e-02   +7.091096289025815e-02   +5.750362120618695e-02   +3.464560999681342e-02   +4.476291309181819e-02; -1.291883227620323e-03   +1.187635903690092e-02   +6.669991110466351e-02   +8.349424178094303e-03   +7.385641553426289e-03   +5.185828740447417e-02   +5.810247731846465e-02   +3.589025536624246e-02   +3.446779081298890e-02   +6.963705987253055e-02   +4.468263099473773e-02   +5.469020058983007e-03   +2.831454668979634e-02   +1.788735794044976e-02   +5.442040607225142e-03   +7.247781913976695e-02; +3.752780282564118e-03   +6.590683609773186e-02   +3.302749141245364e-02   +7.409745255612214e-03   +3.437692062772960e-02   +5.689323154283708e-02   +4.981126067887805e-02   +2.954090747515637e-02   +3.524319968676921e-03   +9.975349914908890e-03   +4.875582847011894e-02   +8.237153794341971e-03   +5.560802907510854e-02   +3.069516668236566e-02   +4.280277660526539e-02   +3.573585619055521e-02; +6.261309181006462e-02   +6.105248381955921e-02   +2.835993796828793e-03   +5.239419903096319e-02   +2.504479300780667e-02   -6.403025323273738e-03   +5.009642452964064e-02   +1.961884176751277e-02   +6.110459102273796e-02   +1.540260267656859e-02   +6.392790689057506e-02   +6.767180322106073e-03   +2.706870812304005e-02   +5.402876458498154e-03   +4.567373858675836e-02   +1.363943469393020e-02; +3.761351433946456e-02   +1.343158669058927e-02   +1.438523323606735e-02   +1.514712162997443e-02   +1.158116088672428e-02   +2.748959751165092e-02   +2.095136598389603e-02   +3.944686831023318e-02   +6.418722893644377e-02   +1.411584025591962e-02   +5.908879963613638e-02   +7.297440394871571e-02   +7.115220682964551e-02   +3.780585370762059e-02   +3.476954215432453e-02   +1.727019402866631e-02; +1.955954794753137e-02   +1.207875625482203e-02   +4.160411459589312e-03   +1.321781139711421e-02   +4.939990544684539e-02   +4.043777839750037e-02   +3.340691613420217e-02   +4.088027426811737e-02   +1.777704953265657e-02   +2.796090494950691e-02   +5.958708232971701e-02   +7.673055656758355e-02   +3.565545545754992e-02   +3.453442690398122e-02   +8.318899756946958e-03   +4.710086677522289e-02; +2.203509744458351e-02   +4.438256276988420e-02   +2.366371755288215e-02   -2.996652198331074e-03   +1.531321101956061e-02   +4.834594356066184e-02   +6.021274216612992e-02   +6.557648463413845e-02   +2.817885928888045e-02   +9.172860466656288e-03   +5.020225962905586e-02   +3.007836484512673e-02   +6.932632465275186e-02   +7.070842058543554e-02   +3.879558824934571e-02   +9.674397893860549e-03; +6.034084224454404e-03   +2.953664639921580e-02   +1.641328615949673e-02   +4.052877440067853e-02   +2.582426591814662e-02   +5.485782176075390e-02   +1.767136828455709e-02   +2.104522672037154e-02   +6.977826721180631e-02   +5.909136178684687e-02   +1.377205011179742e-02   +3.837551729092954e-02   +5.375659486019512e-02   +1.600572874884528e-02   +5.089802110706274e-02   +1.683316860028811e-02; +6.232038913926547e-02   +6.674532717542337e-03   +1.931196073132749e-02   +3.293194668375427e-02   +4.243869064022012e-02   +4.924761884543004e-02   +3.620567349207422e-02   +7.287127127677016e-02   +2.031182565681139e-02   +2.584488071806122e-02   +4.195978857589572e-02   +3.516068372508670e-02   +1.646229605742477e-02   +7.117873678273443e-02   +5.963322975587832e-02   +2.776675449572748e-02; +1.523698539083082e-02   +6.901216772704988e-02   +3.987611098788191e-02   +6.764711191382372e-02   +7.064860889109977e-02   +5.038537450525493e-02   +3.269482022960932e-02   +1.076477265714308e-02   +4.932874245035868e-02   +3.827131865175008e-02   +2.050967386181530e-02   +5.413160726619451e-02   +5.246721412525467e-02   +3.754920517941730e-02   +5.517373306221658e-02   +1.435634941311666e-02; +5.129319138020216e-02   +7.296591923458962e-03   +4.301545632681300e-02   +7.190128024598575e-03   +3.939117113424991e-02   +4.104459375987257e-02   +4.485233779504115e-02   +1.370513803292943e-02   +5.480260803934908e-02   +5.902855028933177e-02   +1.776312595812244e-02   +6.022336505889552e-02   +6.829472161727368e-02   +4.752592499817579e-02   +2.446346308857862e-02   +8.349859095484431e-03; +2.056395563403866e-02   +2.037272761605387e-02   +1.565668651536773e-02   +9.177702101231424e-03   +1.295544736570378e-02   +6.454695836940624e-02   +6.622913146057405e-02   +5.634488058757663e-02   +3.564522677494819e-02   +4.245934980610707e-02   +6.791753815903637e-02   +5.197237111806384e-02   +4.731052770244721e-02   +5.586890895648673e-02   +4.700369923767457e-02   +5.178415213467665e-02; +3.230784503000850e-02   +1.802336700301620e-02   +3.338437820567966e-02   +5.720661702081495e-02   +4.194640534109709e-02   +3.825397199932200e-02   +8.538940121343498e-03   +2.536594584599910e-02   +9.312255696467091e-03   +3.782304056465249e-02   +1.963475244339077e-02   +2.929645885968584e-02   +1.980249494258868e-02   +1.350970044500501e-02   +1.015725068470529e-02   +1.820576439950619e-02; +3.129091423028820e-02   +5.071763920567083e-03   +1.403189143030008e-02   +7.003374921578139e-02   +7.019628829557788e-02   +4.961020196623129e-03   +1.684805069816240e-02   +6.118728069229715e-02   +6.226277219325701e-02   +9.437012854166442e-03   +6.053625995269264e-03   +4.326405958183629e-02   +5.102112140674340e-02   +3.963982324588459e-02   +2.963227494413266e-02   +3.157636194078246e-02];
L2I_L1I_iGABA_netcon = [+7.162347824611182e-02   +2.905737635501349e-02   +2.488762201103183e-02   +5.979642999159152e-02   +7.313225570430794e-02   +6.596313895034073e-02   +2.895691612524727e-02   +5.699698565284696e-02; +6.049753964971612e-02   +6.097916046745234e-02   +4.727683508264759e-02   +2.174589885797043e-02   +2.825533570890034e-02   +4.817190960284712e-02   +6.429867879134372e-02   +1.718164286618695e-02; +1.789668830512241e-02   +1.786258918554543e-02   +1.602567949612493e-02   +4.832917819846397e-03   +5.722575489482193e-02   +6.680917669485550e-02   +6.156045321152161e-03   +4.607565576594327e-02; +2.406684526134949e-02   +5.651433177913491e-02   +5.086884101837901e-02   +4.305527860697878e-02   +4.432648576956279e-02   +4.139189431390693e-02   +3.175771463977016e-02   +5.738137130580934e-02; +2.248922145704595e-02   +9.935289908245871e-03   +4.551648446185572e-02   +4.548875480007683e-02   +2.615858549224312e-02   +5.372489300358079e-02   +3.553516233591064e-02   +3.689818729342550e-02; +5.427378508345943e-02   +4.579824124403904e-02   +6.693305634853473e-02   +3.674919316007134e-02   +1.866359070703319e-02   +5.057888096066093e-02   +5.624978599832978e-03   +5.160112052957212e-02; +2.859764522538649e-03   +3.190810564563296e-02   +2.900069219977180e-02   +2.150400998546301e-02   +5.586306621170333e-02   +2.293984719917323e-02   +1.779432571564686e-02   +4.850085462158593e-02; +4.315525424344207e-02   +2.363381124063544e-02   +5.617708571673134e-02   +3.458990285588245e-02   +2.137765371632459e-02   +4.933320245049381e-02   +3.062563141695150e-02   +1.985041092280826e-02; +3.475654076504249e-02   +4.905961957481098e-02   +1.676402882790682e-02   +1.379870319309256e-02   +2.115818493522403e-02   +1.081939700256177e-02   +2.902012546101600e-02   +7.015675240326762e-02; +3.944833432848142e-02   +4.835964348482188e-02   +1.160880652674236e-02   +3.533720341596489e-02   +6.744908367534066e-03   +5.293899073855839e-02   +6.649746526219306e-02   +5.120447356043641e-02; +3.253793371412282e-02   +5.829281188285487e-02   +5.965732399368424e-02   +2.360768978687521e-02   +4.956933510799218e-02   +6.341789654169959e-02   +1.052684111082477e-02   +2.228791222241898e-02; +6.100485279374156e-02   +3.963057687280985e-02   +4.595410221116515e-02   +3.183201597193769e-02   +6.518432613117034e-02   +1.216020870360164e-02   +4.412010387008240e-02   +2.419527530342812e-02; +2.716952159287072e-02   +7.191706121501351e-02   +6.137563472278580e-02   +5.162062978457748e-03   +3.890696699322162e-02   +3.011870762394064e-02   +2.010632972004423e-02   +4.417450682344940e-02; +5.469992591599974e-02   +1.774716985913875e-02   +7.047516041453962e-02   +3.534583186800494e-02   +6.163124292778600e-02   +1.502121590733763e-02   +6.421526002482424e-02   +1.908947545152396e-02; +6.994896745358822e-02   +1.638843230038898e-02   +2.167661512261932e-02   +7.116176266667931e-02   +4.717861469731809e-02   +6.931645470362031e-03   +2.651354213190676e-02   +5.262612825732683e-02; +1.417251152455844e-02   +4.960127921102211e-02   +4.481217012978336e-02   +4.507182471075534e-02   +6.410431385692771e-02   +7.721488804164584e-03   +6.864776049396169e-02   +2.109140315238504e-02];
L1I_L2I_iGABA_netcon = [+4.379690646274818e-02   +5.081964607224876e-02   +1.270134010729839e-02   +5.058906861148060e-03   +3.962115134382922e-02   +2.307642488368621e-02   +7.421149174092818e-02   +4.552350266284060e-02   +3.098706671005016e-02   +5.619675524463634e-02   +9.058444587619074e-03   +1.946331099790097e-02   +9.154217011858654e-03   -3.172016316608253e-03   +1.415548679044880e-02   +5.971600884714807e-02; +5.619680440140540e-02   +4.657631029519432e-02   +2.866005048705249e-02   +3.558555021048877e-02   +6.946374822868133e-02   +3.767464065175716e-02   +4.110835946170274e-02   +6.754361644570525e-02   +3.709571981607081e-02   +7.036435087749032e-02   +4.930208210226028e-02   +2.442139371741451e-02   +3.864160445248822e-02   +3.067322040076497e-03   +3.762649374908246e-03   +6.283247480682083e-02; +6.376169253871100e-02   +4.277368340420613e-02   +1.278093617101993e-02   +5.957551729861420e-02   +2.389608361447084e-02   +6.165279998883352e-02   +4.853173870918394e-02   +4.633552242752036e-02   +2.483076485059832e-02   +3.228204113825379e-02   +4.022015675820816e-02   +2.974310337740151e-02   +2.698468960679277e-02   +8.800593762890359e-03   +4.402021465291187e-02   +1.339499835676807e-02; +2.886362839092454e-02   +2.466403490039240e-03   +4.421952407144895e-02   +5.284083610075638e-02   +1.204355827511127e-02   +3.060594488489147e-03   +2.648525054615214e-02   +1.789815602534190e-02   +5.418057902625563e-03   +4.628687558382399e-02   +3.771995269499237e-02   +2.995966223049658e-02   +1.932989885855844e-02   +6.199367029101734e-03   +5.579060218820158e-02   +3.394104096648170e-02; +5.033580613761245e-03   +6.374091306593893e-02   +4.918677752402544e-02   +5.163411160170672e-02   +4.724972289873364e-02   +3.924991882297183e-02   +4.145011357104059e-02   +6.453709261642630e-02   +4.263668307614728e-02   +6.379080366933142e-03   +1.828324353688377e-02   -3.911410090843387e-03   +2.199555661847595e-02   +6.130453035951112e-02   +9.717755509121550e-03   +4.183025910532501e-02; +4.438361691541464e-02   +4.841077505297751e-02   +5.963056781677057e-03   +6.695098434296623e-02   +4.166123123628136e-02   +6.808721655856143e-02   +5.093783088053665e-02   +5.172939965434339e-02   +4.051975291766692e-02   +4.168859308106978e-02   +6.692904990488667e-02   +5.741851924784312e-02   +8.516615424111661e-03   +7.065239608303765e-02   +4.964783847466402e-02   +6.777709205293816e-02; +6.141483764425833e-02   +6.597134343771580e-03   +5.959475870599243e-02   +7.373820786464307e-02   +2.782143562464543e-02   +7.478968991349519e-02   +4.004825204463711e-02   +2.929967790259796e-02   -1.856045937904624e-03   +3.741194805443454e-02   +2.675743650777903e-02   +2.212009039525445e-02   +5.497817447840762e-02   +2.741468071778709e-02   +6.160094914702617e-02   +4.316768463882545e-02; +5.148281357260175e-02   +4.094495542164372e-03   +5.931225521839606e-02   +4.958908929080821e-02   +4.631954806743603e-03   +5.017991677635160e-02   +4.493184569688331e-02   +5.548988824482864e-02   +2.996156319187428e-02   +5.991952408293965e-02   +1.485259107449323e-02   +3.703925625663038e-02   +3.185791957818086e-02   +2.768645259056760e-03   +6.247259524061673e-02   -2.539689473254826e-06];
L2E_L1E_iAMPA_netcon = [+5.788040361085121e-02   +2.402453737727512e-02   +6.503695125271684e-03   +7.563040529976392e-02   -1.341463568113389e-03   +2.909766104665525e-02   +4.949583565937524e-02   +7.200691903294778e-03; +6.495744455712361e-02   +6.288625836822362e-02   +4.502259941703114e-02   +2.576969293424520e-02   +3.503976272945467e-02   +1.619576288051906e-02   +6.904939245479773e-02   +3.387830700898827e-02; +4.409904999103786e-03   +1.237454109958437e-02   +1.848431888788848e-02   +1.154229757588839e-02   +4.389893611605081e-02   +6.111307637823131e-02   +2.770144315644578e-02   +2.319994181332597e-02; +2.094887737203700e-02   +5.455389762752879e-02   +1.426613102682659e-02   +5.154704762479886e-02   +6.039131205379100e-02   +1.979859612789373e-02   +6.690993150581458e-02   +6.816671745066490e-02; +1.577777078827974e-02   +7.493171458960650e-02   +6.279422248129173e-03   -4.611921635297533e-04   +6.860758415759494e-02   +7.058985301320399e-02   +4.652226941645355e-02   +2.741149257541436e-02; +5.282186595673646e-02   +3.908961422247161e-02   +6.417772650103021e-02   +5.809516230240074e-02   +4.289484691865290e-02   +1.167294823349764e-02   +5.076961417699816e-02   +4.248075129131095e-02; +1.022386192721803e-02   +1.904331023127153e-02   +1.608752786415665e-02   +3.141003162776027e-02   +6.090171341007385e-02   +2.870668618043636e-02   +1.279251527927488e-02   +2.176580589916452e-02; +6.611269483256316e-03   +1.349855254382627e-02   +3.797488647735801e-02   +4.533393365584396e-02   +2.664506951010992e-02   +6.197624396307559e-02   +6.562491206175657e-02   +6.335006922933446e-02; +2.895097233129651e-02   +6.296667709271976e-02   -2.392626364702160e-03   +2.333099618025065e-02   +1.264975249897063e-02   +7.282619438928351e-02   +4.129640820935047e-02   +4.119604418889939e-03; +1.931906865687325e-02   +1.556515447707653e-02   +6.159479372289491e-02   +2.503281131218841e-02   +6.251606846495614e-02   +5.500612062466778e-03   +9.256839023217722e-03   +6.813588965945530e-02; +3.685376937870272e-02   +3.044873686634832e-02   +7.936776431299721e-03   +4.685528498771682e-02   +2.829343286624643e-02   +2.322364276550513e-02   +4.426980490787643e-02   +6.034395941814732e-02; +1.997168089214597e-02   +3.362817781418426e-02   +5.782129649483304e-02   +5.003334762809219e-02   +4.934767195662655e-02   +1.229856198884587e-02   +6.948299385212474e-02   +1.680482287217779e-02; +4.291563944357681e-02   +5.666690952863596e-02   +1.326592647272553e-02   +3.620447048164627e-03   +6.762702183495656e-02   +5.252434676912710e-02   +3.212569389219260e-02   +6.030326496719682e-02; +3.085786912688241e-02   +2.302917615788119e-03   +5.860202888326165e-03   +5.543647172501030e-02   +5.878388172423193e-03   +1.856864365889879e-02   +3.749074375480103e-03   +5.538949058891674e-02; +2.535628839220592e-02   +1.286007389398138e-02   +5.418264851309114e-03   +5.826790097884126e-02   +6.606555509611471e-03   +5.052101958606012e-03   +3.016859837989657e-02   +1.305357859589001e-02; +1.099534280587080e-02   +3.194069168749064e-02   +6.913130993130584e-03   +3.780047465050712e-02   +1.511873608405631e-02   +4.392754129807390e-02   +2.377822351774617e-03   +5.876535804443253e-02];
L1E_L2E_iAMPA_netcon = [+2.086020679929464e-02   +1.101342754669264e-02   +6.928124809710119e-02   +6.683543935630008e-02   +2.344927221358471e-02   +6.278053380761453e-02   +3.572899502808647e-02   +6.801811151560369e-02   +1.364300127874682e-02   +4.893390530937466e-02   +4.389170875257580e-02   +5.119931432269016e-02   +2.803124984223243e-02   +4.584306705225738e-02   +3.997068305124000e-02   +3.066008561208392e-02; +3.003806521965111e-02   +4.650831498712803e-02   +1.132919518787766e-02   +1.047094107220110e-02   +5.152021322512591e-03   +4.730440196445958e-02   +6.002875107156832e-03   +2.385939224449446e-02   +2.173268090254448e-02   +1.860858582702758e-02   +1.609478824401093e-02   +6.969032877512421e-02   +1.097729990873314e-02   +1.435105673413649e-02   +4.045100034203943e-02   +2.278402752837228e-02; +2.703850307861089e-02   +4.165310599950222e-02   +6.340387703892505e-02   +6.453043127427564e-02   +6.615841873582839e-02   +3.647320929939356e-03   +2.046698434601629e-02   -1.974874518051068e-03   +3.178887431882062e-02   +4.697308629808122e-02   +2.198099677214030e-02   -7.413234974225672e-05   +4.892063407914354e-02   +4.353952468972101e-02   +6.342858106554895e-02   +7.674199476957479e-03; +5.280752883472974e-02   +4.540548416535554e-03   +1.261225731670609e-02   +9.912411185891670e-03   +5.228573595923354e-02   +2.031397763333992e-02   +7.145524416297301e-02   +6.496548108512486e-02   +5.680659671264673e-02   +5.614612903252632e-02   +3.085769723966492e-02   +3.502519542924555e-02   +7.092165119889932e-02   +2.343449642166005e-02   +6.259889473947783e-02   +6.510224086704436e-02; +1.408024452140511e-02   +7.169094090206667e-02   +6.023663936659668e-02   +3.311487581555229e-03   +1.712945732639909e-02   +5.632591228312267e-02   +6.462097723674222e-02   +1.302248249851925e-02   +3.664671291676944e-02   +2.859737820567045e-02   +3.695764158991345e-02   +5.605404815968749e-02   +2.284527536844776e-02   +4.156199077792402e-02   +6.797006731466763e-02   +3.225396509856201e-03; +1.727925628628769e-03   +6.308717286764239e-02   +2.555697840340085e-02   +6.334040707582768e-02   +6.866239366598209e-02   +5.919520649408844e-02   +3.309118347891036e-02   +6.179987025649326e-02   +2.135864023142856e-02   +3.339104182459954e-02   +6.053332463964911e-02   +6.869012809926098e-02   +5.809379005762277e-02   +4.046879266999046e-02   +1.100546868254388e-02   +3.985335177574970e-02; +2.442269232457712e-02   +1.219771638727839e-02   +4.598873755105383e-02   +3.596203795612428e-03   +2.751488442009112e-02   +3.303490633817455e-02   +5.631027995210767e-02   +3.898468288805010e-02   +3.506965099962285e-02   +5.757825263410527e-02   +5.030444796344558e-02   +7.998952977899130e-03   +3.128249097972403e-02   +4.356035817385129e-02   +1.406969684729805e-02   +1.932838799420763e-02; +1.640889199675324e-03   +3.822266100395376e-02   +3.360377849965442e-02   +2.725389151783487e-02   +5.020073057284208e-02   +7.259263644817382e-02   +6.654999841707263e-02   +4.246391167465781e-02   +6.209300993722739e-02   +2.894650450680702e-02   +2.834932862909978e-02   +7.510931125897571e-02   +4.875533701639351e-02   +5.770815950341091e-02   +1.942144811517543e-02   +1.332951015592844e-02];
L2I_L2E_iAMPA_netcon = [+5.136389153975408e-02   +2.427904174684202e-02   +6.206485758675442e-02   +3.211881063800189e-02   +5.658092125014628e-02   +3.370035373324974e-03   -2.015890423813687e-03   +6.289492019931447e-02; +9.960759505316044e-03   +1.231416542020913e-02   +1.556364968725245e-02   +5.498796590017801e-02   +5.376567452629353e-02   +2.797985167526990e-02   +5.169997134008188e-02   +3.685166056893926e-02; +6.181991892073115e-02   +5.867185266100962e-02   +6.183809438007128e-02   +4.747136605641076e-02   +3.384849007625434e-02   +4.288248122776818e-02   +3.325290365791393e-02   +5.041151021719795e-02; +2.915335364076580e-02   +1.661276810306377e-02   +6.679933146765404e-02   +3.269819008093947e-02   +7.310760838561436e-02   +1.107158618636669e-02   +3.161832988540820e-02   +6.173506347497932e-02; +4.111121269025535e-02   +6.682021410710867e-02   +3.888271225682603e-02   +4.285438303893230e-02   +6.868676467052871e-02   +5.465169074106651e-02   +3.128602010497654e-02   +5.733501067092864e-02; +4.284497058491677e-02   +3.962700725814774e-03   +6.655940079654059e-02   +5.489861726262320e-02   +4.066523659773745e-02   +1.656998860934313e-02   +9.142054525454506e-03   +5.070612928414443e-02; +7.315191278716807e-02   +3.610303754231049e-02   +5.665540251545402e-03   -2.221195913845642e-03   +1.147611555146923e-02   +1.875206802475998e-02   +1.129715415040188e-02   +1.548865553262705e-02; +6.392230280919076e-02   +1.760031465954424e-02   +3.967814851136267e-02   +3.871592687037900e-02   +6.351199676371672e-02   +1.765349566038176e-02   +8.216377176741963e-03   +1.008982011006605e-02];
L2E_L2I_iGABA_netcon = [+6.597623904285613e-02   +1.102088387615602e-02   +1.305945330091159e-02   +8.791641157411321e-03   +4.853940792462878e-02   +2.690387389292193e-02   +5.537631835261572e-02   +6.678109933979791e-02; +1.760779137035924e-02   +2.998314419736450e-02   +1.218211296030609e-02   -1.036923995252558e-03   +7.273099132264910e-02   +5.176294353863695e-02   +5.467922163150343e-02   +1.594677291406584e-03; +4.798695931430221e-02   +2.438173747547812e-02   +3.739168051663171e-02   +7.919323477849833e-03   +2.115557216272333e-02   +4.118913567003423e-03   +6.981803568205826e-02   +5.778689745109903e-02; +5.612034215970895e-02   +3.106062558833132e-03   +1.752077478963490e-02   +5.712096439312174e-02   +6.422343522135787e-02   +5.011441820833560e-02   +3.463847615139511e-02   +4.549448843873811e-02; +8.961437113449978e-03   +6.309228321111034e-02   +2.694068293492893e-03   +5.834231194457103e-02   +2.403012309277371e-02   +2.249025023452064e-02   +2.360495370124071e-03   +1.277045307735395e-02; +5.276913857208212e-02   -2.767232706651899e-03   +3.281935508045699e-02   +5.728346938299415e-02   +6.724952687982833e-02   +2.407793469034099e-02   +6.436686530083638e-02   +5.609399741542698e-02; +1.185959960460248e-02   +7.257976703173676e-02   +1.977198345414691e-02   +1.126608951836278e-03   +5.820612173981829e-02   +3.344228667335799e-02   +4.249246546079039e-02   +4.068347324651105e-02; +5.798272954444551e-02   +2.238669967582822e-02   +3.881627245849612e-02   +1.448833178001560e-02   +3.082049314236024e-02   +5.530036461114148e-02   +6.891744781244211e-02   +4.767538234647829e-02];
L3E_L2E_iAMPA_netcon = [+2.744443945510317e-02   +4.978054824400385e-02   +7.898163372458916e-03   +1.698462057400124e-03   -1.865524523586532e-03   +6.908923336055359e-02   +2.398295375561384e-02   +6.205355945358067e-02   +9.584045275447890e-03   +1.776546343585074e-02   +2.085101136180754e-02   +2.901575766603400e-03; +2.055242989527092e-02   +6.549765807701752e-02   +1.885521877208199e-02   +2.625938754111099e-02   +3.236698813650796e-02   +4.092902035220791e-02   +6.190590712025940e-02   +7.247860113708163e-02   +4.272063848855392e-02   +6.792736791667672e-02   +2.518504587275250e-02   +1.931732778888769e-02; +8.799624841478183e-03   +5.810526620586177e-02   +1.351130923417075e-02   +5.176046510580320e-02   +1.174056918116526e-03   -1.923790643564963e-04   +4.165869097833337e-02   +7.191040692224762e-02   +4.323839276024685e-02   +3.585305868235314e-02   +2.216179820779001e-02   +4.767056960416145e-02; +4.512891564645200e-03   +2.040248717954229e-02   +6.171786427639711e-02   +2.517827079850253e-02   +1.877418190848842e-02   -1.217322828839617e-03   +2.291289632663456e-02   +5.525527372519223e-04   +1.033243011717082e-02   +2.645793485919243e-02   +1.749777022449825e-02   +2.424762839235443e-02; +6.264529134442458e-02   +2.455701409278016e-02   +2.715012399714298e-02   +6.781533327724991e-02   +5.301005163724556e-02   +2.619580527971933e-02   +6.823766888300922e-02   +8.228447057738916e-03   +6.043030694382516e-02   +3.280736547446974e-02   +5.075098130386033e-02   +2.708891852459186e-02; +6.199673094329664e-02   +4.737719199337404e-02   +4.882257725390582e-03   +3.212445539692308e-02   +4.261777271146520e-02   +7.200069614005723e-02   +6.619412488748608e-02   +2.515522118482048e-02   +3.791117955154793e-02   -3.734893240209710e-03   +4.306662152953063e-02   +1.846945558977129e-02; +4.416710482440771e-02   +3.024086295903064e-02   +4.357305039965718e-02   +1.736158520767235e-02   +2.776356383996285e-03   +2.761205172275478e-02   +1.507929418224061e-03   +2.632907546355281e-02   +2.066132413766048e-02   +6.528471360623261e-03   +3.486777781170371e-03   +2.859104072429895e-02; +6.039668431315897e-02   +1.092295715915310e-02   +1.476291190765723e-03   +2.249745660948534e-02   +3.693386941770049e-02   +6.107386356746774e-03   +4.276053481618258e-03   +3.200040196235208e-02   +3.312957276211537e-02   +6.545356466416097e-02   +9.657150413875633e-03   +4.523873499267501e-02];
L3I_L2I_iGABA_netcon = [+7.381889573348967e-02   +4.527151383641791e-02   +4.340220074374134e-02   +2.834270105117435e-02   +6.574253974870937e-02   +2.761850185668620e-02   +7.265931346332592e-03   +3.416589688935030e-03   +6.285495773744247e-02   +3.407734115240645e-02   +5.287981735364994e-03   +5.538966109392483e-02; +6.352658206695570e-02   +6.983699081785656e-02   +5.582375288360753e-02   +1.222216508245046e-02   +3.149786919773684e-02   +5.603791446439974e-02   +2.988395388665898e-03   +1.258736210661354e-02   +3.635369199353487e-02   +4.951372188574583e-02   +4.897930570784820e-03   +4.774634267980010e-02; +6.951050057026779e-03   +5.755918375086721e-02   +6.778376264294385e-02   -1.588003934498844e-03   +4.743620883774521e-02   -2.013217275549582e-04   +4.686865880820581e-02   +6.811614208765186e-02   +5.298381240979228e-02   +2.375541944595614e-03   +4.789711750914279e-02   +8.578328259280382e-03; +7.287195931397343e-02   -3.612201316093441e-03   +3.120469201814812e-03   +4.653342182953746e-02   +6.284789297180737e-02   +4.153998312181223e-02   -2.303652552846171e-03   +4.278742573084433e-03   +6.469331203523938e-02   +6.082494996819664e-02   +6.897767628117783e-02   +3.824593789143945e-02; +1.703572262917614e-02   +7.427367308682203e-02   +2.638859829978854e-02   +3.316087093594952e-02   +4.214569545637093e-02   +6.985633284870064e-02   +2.774819308727813e-02   +1.260844726650973e-02   +6.658262492231432e-02   +3.994720275624797e-02   +1.632349772900108e-02   +1.375857329595845e-02; -9.350510300950863e-04   +4.800900918565287e-02   +1.559892381527378e-02   -1.291120140615454e-03   +1.054035375496487e-02   +4.462433629202853e-02   +5.223423348425648e-02   +1.360498673911861e-02   +2.980927237817455e-03   +5.728768794981267e-02   +5.541443278841948e-02   +4.195500422997777e-03; +4.563926102429217e-02   +6.690411795841382e-02   +3.666327973677067e-02   +4.532000825663586e-02   +3.723874059553974e-02   +1.670432160533798e-02   +4.632827638094063e-02   +2.330875646128949e-03   +6.568733456240171e-02   +2.075345638210669e-02   +3.120864345736597e-02   +5.372909334276063e-02; +3.514596332278016e-02   +1.043768379257280e-02   +2.258243573923594e-02   +4.311347843319687e-02   +2.980321889813447e-02   +1.254673177579947e-02   +1.352951118817389e-02   +2.106559610033248e-02   +4.388604708870782e-02   +6.799084662171961e-02   +1.969392589182837e-02   +2.141341332333435e-02];
L2E_L3E_iAMPA_netcon = [+4.527319164956035e-02   +4.439083385134974e-02   +1.718882647936507e-02   +5.398616008884993e-02   +5.654132944801839e-03   +3.792134909721333e-02   +5.382607388061557e-02   +7.048248353978985e-02; +3.588893502975013e-02   +5.198925520239274e-02   +5.190947985631843e-02   +5.352206351235159e-02   +3.010601493458245e-03   +4.210459890558502e-02   +6.050863639711409e-02   +4.607747318244573e-02; +5.582476052976339e-02   +6.471205525481626e-02   +5.991125909670272e-02   +7.331987777172055e-02   +4.493345731068615e-02   +4.678771079039340e-02   +5.963214420641163e-02   +4.221239829077418e-02; +3.146256780843870e-02   +6.797663774450587e-02   +5.846873194110559e-02   +4.231599038225761e-02   +3.672787476712795e-02   +3.764306517367272e-02   +1.857923440573207e-02   +9.663852244848321e-03; +3.787096883695975e-03   +3.663446952190676e-02   +2.374931795226105e-02   +3.245816400261848e-03   +6.819076254693562e-03   +4.185755050319368e-02   +6.062868163896334e-02   +5.513310966701025e-02; +3.798122807632130e-02   +7.481522710495690e-02   +6.363722269105469e-02   +4.054368390022102e-02   +3.585542178684629e-02   +7.175705573996713e-02   +4.980484586314125e-02   +7.339854438945870e-02; +3.323891758134646e-02   +4.264141079275654e-03   +3.734598886669823e-02   +1.377087642607603e-03   +2.351168233506176e-02   +6.224708726473083e-02   +2.446874607554431e-02   +5.584886162112537e-02; +6.497740882880204e-02   +4.888346781730493e-02   +3.347765227984709e-02   +6.107556365313187e-02   +2.420367986316812e-02   +5.372091678669943e-02   +3.647362583363320e-02   +2.383045588949969e-02; +3.110239722319723e-02   +3.772386467005559e-02   +7.038621777044984e-02   +4.540311991899157e-02   +3.977756228894427e-02   +2.129800170052153e-02   +3.741226771985090e-02   +4.583781367215206e-02; +1.678832152836280e-02   +1.128891774960450e-02   +5.598003193446072e-02   +6.519918680531818e-02   +6.847980699671209e-02   -1.697234060232805e-03   +5.167880365861298e-03   +4.595257452723614e-02; +4.601443328098772e-02   +1.746911344904691e-02   +5.271411820769353e-02   +5.465997848346123e-02   +6.242012989974296e-02   +7.577585886925080e-02   +1.467277736740329e-02   +2.705230799842358e-02; +1.280626843308787e-02   +4.305679248041253e-02   +2.832157526521838e-02   +6.089209070400068e-02   +3.399722983097722e-02   +1.590675431865108e-02   +4.639153899836505e-02   +6.508690215962661e-02];
L2I_L3I_iGABA_netcon = [+6.972655093731454e-02   +2.959925819462070e-02   +1.691769312408004e-02   +4.569714129991523e-02   +5.842821172369693e-02   +6.126955292692073e-02   -8.838134184111254e-04   +3.524224182029742e-02; +3.619791288738846e-02   +2.962791011760534e-02   +5.122247799569079e-02   +1.063764273757977e-02   +6.187389417488597e-02   +6.111947557345273e-02   +3.729083815399393e-02   +2.242774400548647e-02; +5.427942113053696e-02   +5.204911524238870e-02   +6.430977876714898e-02   +4.306592494788336e-02   +2.784641473444401e-02   +4.797096778014930e-02   +3.662937608500450e-02   +1.053880707866548e-02; +1.812809599813322e-02   +5.513553749739366e-02   +1.620418655710214e-02   +3.485202970203143e-02   +7.183816192285288e-04   +2.298509941067317e-02   +2.679253574767755e-02   +7.499366175756135e-02; +2.395164336258335e-02   +2.495716258092932e-02   +3.829848449785633e-02   +3.006637990564419e-02   +2.656814177894138e-02   +4.504524729096945e-02   +8.545970369669737e-03   +8.127447710083006e-03; -4.485821431966381e-03   +1.978769242691714e-02   +2.524080549784403e-02   +9.410912985271934e-03   +2.712438679384246e-02   +3.502935675995505e-02   +3.942775513320336e-02   +5.770090694873634e-02; +2.830039103594339e-02   +3.689422083788268e-02   +6.890148963653239e-02   +4.758413605882070e-02   +5.664003349367921e-02   +2.445847420313105e-02   +2.750457005286360e-02   +2.561606957971724e-02; +6.352908280507540e-04   +7.049765588378526e-02   +1.933568459759681e-02   +5.666297939812920e-02   +3.012711561101256e-03   +5.271833316507048e-02   +3.531143459476090e-02   +5.828117117686360e-02; +5.985261047822361e-02   +2.550519431563014e-02   +6.196854027899061e-02   +5.622895212307802e-03   +3.581373841711226e-02   +2.046709575095504e-02   +2.515758445336655e-02   +3.471736916633567e-02; +5.354498193009770e-02   +3.587450752935169e-02   +1.070339054796736e-02   +3.573101837335640e-02   +4.341683996046996e-02   +2.193892438479154e-02   +1.416117651860893e-02   +2.624457275110317e-02; +5.514037798993045e-02   +6.932353415948887e-02   +3.952249295626402e-02   +4.538159915186686e-02   +2.179107982931197e-02   +3.075065209099704e-02   +6.360141402959019e-02   +1.072925180538497e-02; +5.078037100336791e-02   -4.684573272453464e-03   +2.530370427312936e-02   +1.277265182138535e-02   +8.034246292378519e-03   +6.875990417329195e-02   +3.503838635386908e-02   +4.266862585445071e-02];
L3I_L3E_iAMPA_netcon = [+3.095366216370447e-02   +6.885698642680413e-02   +1.745439289004532e-02   +4.217673979261620e-02   +5.738690729761919e-02   +2.989415353860974e-02   +2.569522847127050e-02   +1.533022823044192e-02   +2.489882941585644e-02   +1.916226932869048e-02   +1.670483756651189e-02   +7.386548161030553e-03; +2.699200668449608e-02   +5.384260966371954e-02   +2.248515895218310e-02   +8.215817275723113e-03   +1.353570802638895e-03   +4.259432252369732e-02   +4.291983596177366e-02   +3.712201379831424e-02   +1.800994125445643e-02   +3.906865576271235e-02   +5.124548824401805e-02   +3.785969631650469e-02; +1.735348430405961e-03   +3.988662312421304e-02   +3.821781668790019e-02   +4.412359264131529e-02   +3.540802295097790e-02   +3.247127165038375e-02   +3.358756336449268e-02   +3.287672158555518e-02   +3.292621383850640e-02   +3.917778377732930e-02   +2.859738912998984e-02   +3.899797941058389e-02; +2.984123933440198e-02   +5.316984471980529e-02   +4.609746857969735e-02   +3.538834230705538e-02   +3.406363448610796e-02   +6.996195253482844e-02   +5.601826802407965e-02   +1.393875704871580e-02   +6.365446935408815e-02   +6.573808176494109e-02   +1.507413340252274e-02   +4.820174475534999e-02; +9.249776880162333e-03   +3.156806375414244e-02   +9.078457541801168e-03   +6.359106954288285e-02   +5.945103754093666e-02   +4.099639044390749e-02   +7.032222177644766e-02   +3.256915393513196e-03   +6.992021450624332e-02   +3.952098925605629e-02   +2.278126744850083e-02   +8.132230387417444e-03; +2.418255014088014e-02   +3.827669632189910e-02   +5.468220663563698e-02   +3.620115365451667e-02   +7.420587959947034e-02   +6.820657754974691e-03   +5.901376817639178e-02   +2.148843215114383e-02   +4.901180743328010e-02   +6.623140619812007e-03   +2.253328134578292e-02   +1.105816849217759e-02; +5.326942093319015e-02   +2.608225841427955e-02   +2.844491443785436e-02   +1.508220571108091e-02   +4.201419588081498e-02   +1.270041196226973e-02   +3.710692960921962e-02   +7.052103717384389e-02   +6.051241337285947e-02   +7.205986915201987e-02   +3.913440463247425e-02   +4.778008539910825e-02; +5.077415122627398e-02   +1.474340310412523e-02   +4.958598673046914e-02   +4.588165878514049e-02   +7.052454244456985e-02   +4.069716293877169e-02   +3.780638341863987e-03   +3.608348442275308e-02   +3.379266176886827e-02   +2.355228781723550e-02   +1.735556979762177e-02   +6.550530808033730e-02; +1.030094309781497e-02   +6.041547400647717e-02   +4.748869640056405e-02   +5.244097159790438e-02   +2.685262753325809e-02   +5.947629361144997e-02   +8.774245245202393e-03   +5.739000549498558e-02   +5.659027837600106e-02   +3.414542745941339e-02   +1.779775225177437e-02   +1.343523920662298e-02; +6.260080632276212e-02   +6.228710403547592e-02   +2.824840436973031e-02   +1.727615237907853e-02   +3.643808951583728e-02   +5.966280900893760e-02   +4.045921303277818e-02   +6.734965182170288e-02   +5.540598691009870e-02   +2.982054408289259e-02   +6.029954928600741e-02   +1.588457751186655e-02; +3.626575997716524e-02   +2.724058943103874e-02   +6.918516298233794e-02   +6.202795347723129e-02   +3.676731740298143e-03   +4.113507091886745e-02   +5.915846593892190e-03   +2.120439117944671e-02   +3.323009877469908e-03   +6.527541881114785e-02   +5.266348707075118e-02   +3.009907460332258e-02; -1.027988140129261e-04   +1.198073208959339e-02   +8.167041493715815e-03   +3.683891981719848e-02   +3.310656761748733e-02   +1.846666027868922e-02   +5.888946388412392e-02   +1.168098704975999e-02   +2.299986107999708e-02   +1.496221081613404e-02   +5.416188692543908e-02   +2.124081219523148e-02];
L3E_L3I_iGABA_netcon = [+6.589974941169838e-03   +3.000815642315639e-02   +1.717103813864704e-02   +6.606979091001179e-02   +5.491782450000500e-02   +4.312617349299886e-02   +2.587201612468551e-02   +5.460073350689180e-02   +4.116466277724978e-02   +5.220081438183510e-02   +4.103250139740703e-02   +1.461825181198256e-02; +5.192417784483224e-02   +4.558997262886116e-02   +2.481677378054103e-02   +2.696542117746387e-03   +2.297956419222084e-02   +5.163264314361151e-02   +4.258100178317736e-02   +7.120529759709905e-02   +5.720712385755496e-02   +2.676525626267809e-02   +1.345015357189330e-02   +2.562484161545600e-04; +4.288024355903357e-02   +7.518640603467344e-02   +7.063001827869830e-02   +6.421836687624516e-02   -1.634620352953570e-03   +5.193498188798584e-02   +4.138261834204764e-02   +4.725387435087698e-02   +3.002402254737557e-02   +2.826514212732769e-02   +1.771321091641975e-02   +1.058091237851382e-02; +2.556921001948506e-02   -3.572692851814977e-03   +1.341842076417496e-02   +5.596827172619770e-02   +5.811420076988322e-02   +2.462278188909382e-02   +3.123914421387620e-02   +2.796685922114525e-02   +7.128017755181527e-02   +2.915913661682409e-02   +6.152753098021354e-03   +5.014654548141607e-02; +3.193836937908550e-02   +3.141459266136860e-02   +7.700844987408551e-02   +1.425942624332722e-02   +3.334695264072328e-02   +5.716070801021730e-02   +7.460743880349091e-02   +6.539299678308799e-02   +1.988018689849790e-02   +4.606769135950897e-02   +5.930611550500479e-02   +1.983522251219995e-03; +5.108472598200719e-02   +2.880279758495514e-02   +6.008346695339011e-02   +2.670192350655814e-03   +5.664486107014241e-03   +7.393400689927902e-02   +5.926065940431646e-04   +2.609977371047741e-03   +5.745723352726727e-02   +4.436376547808400e-02   +1.705327858462965e-02   +1.513153404679158e-02; +3.859499565984048e-02   +2.328828198996291e-02   +4.135970224515940e-02   +4.360570143404199e-02   +4.604268622367495e-02   +3.348880830095961e-02   +2.748480129348106e-02   +6.811609520435808e-04   +3.195582325037119e-02   +6.846317430116688e-03   +2.184518850669914e-02   +4.708781223226796e-02; +1.618259216728307e-02   +5.212454852632384e-03   +9.401251122308236e-03   +7.069572459854738e-02   +3.484627009818978e-02   +5.791985291492199e-02   +3.882557686556040e-02   +5.620249448696536e-02   +5.546721271439554e-02   +6.651198436037024e-02   +1.265256959008901e-02   +4.762338885732746e-02; +1.803492602376561e-02   +1.144842627043689e-02   +6.062523300521014e-02   +1.516983084634456e-03   +7.238811966431753e-02   +6.347789620518030e-02   +1.238355689202135e-02   +5.668465001468783e-02   +1.564283552651538e-02   +2.483634729142191e-02   +3.638950091046345e-02   +4.408831588488273e-02; +5.672705769081280e-02   +2.303002629293553e-02   +6.091640860961233e-02   +1.898928691541922e-02   +2.639391251765636e-02   +7.003226090182681e-02   +5.239245434504999e-02   +4.000938074956957e-02   +6.569347021503173e-02   +6.920007547069952e-02   +1.378926371137790e-02   +1.205903394956120e-04; +3.546453013058527e-02   +9.678101722618411e-03   +1.971077105575787e-02   +1.574042854674964e-02   +4.917117410781385e-02   +3.518997406196038e-02   +7.106123702898413e-02   +4.912434333100565e-02   +3.939580774141415e-02   +1.428338315020902e-02   +6.509772768884722e-03   +5.692606658771780e-02; +4.915589891274476e-02   +4.157792304384015e-02   +6.802192394707829e-02   +4.703067737828445e-02   +7.084845109340812e-04   +3.500913670947065e-02   +6.827649461751575e-02   +4.074900983014393e-03   +5.279073860387008e-02   +3.127655373356582e-02   +3.458234281132426e-02   +2.659833900269522e-02];
L2E_Input1_iAMPA_netcon = [+7.027020076435121e-02   +7.025389934167899e-02   +6.765521111708805e-02   +7.265689173006808e-02   +7.557083296370208e-02   +8.060315588496035e-02   +7.427309881851839e-02   +6.979192856359337e-02];
L2I_Input2_iAMPA_netcon = [+6.734454301126827e-02   +7.375945940297790e-02   +7.173858930786642e-02   +7.034976948434885e-02   +6.565054745786067e-02   +7.679036436323264e-02   +7.551705826370185e-02   +6.656676036447845e-02];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last =  11.21 * ones(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.0*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.2*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.0*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.2*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.0*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.0*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.2*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.0*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.2*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.0*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
