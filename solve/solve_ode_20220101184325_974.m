function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+5.758716963080237e-01   +2.103646660065893e-01   +3.067555509111072e-01   +5.816123219714007e-01   +1.729012530131152e-01   +1.237989625799105e-01   +5.252911978009649e-01   +1.143403082614628e-01   +2.748148639775174e-01   +2.532737086334817e-01   +5.571834549759497e-02   +1.002857426285623e-01   +2.866587556854773e-01   +5.207390247680600e-01   +5.385373955983725e-01   +6.559938838312916e-01; +5.600700996982625e-01   +5.980348109207327e-01   +4.403212392940965e-01   +8.271106280495499e-02   +1.125146689468556e-01   +2.214632486835904e-01   +1.553412374394648e-01   +2.605534826495501e-01   +5.439464869632277e-01   +4.895932173684255e-01   +6.816997032177009e-01   +4.630279265036196e-01   +6.755554666597652e-01   +2.752675140005153e-01   +4.793432160987683e-01   +2.081560781188578e-02; +7.185401039037775e-01   +5.396604421967861e-01   +6.737939867992695e-01   +6.389492822877160e-01   +6.912320911742038e-01   +6.153744939014201e-01   +3.713114520176953e-03   +8.563562056532195e-02   +3.192631510956907e-02   +7.239670538345866e-01   +3.744486342497412e-01   +2.173991757336416e-01   +5.635398200561305e-02   +3.383046595021864e-01   +2.460800019978806e-01   +5.059037034639268e-01; +5.263635448844139e-02   +7.289593429891044e-01   +2.696404532666899e-01   +7.263111197139940e-02   +9.675187006284625e-02   +1.270632187804206e-01   +2.782345447092629e-01   +3.293239946907704e-01   +5.310632737122661e-02   +4.712066568813286e-01   +1.921549924045102e-01   +3.740132731932797e-01   +3.701144198462164e-01   +6.019361398766496e-01   +6.863801759823784e-01   +2.629178435545409e-02; +6.780160242921471e-01   +1.895165843091507e-01   +5.698586523856813e-01   +6.808212767517844e-01   +2.760541385134345e-01   +1.118333833941475e-01   +6.242215334198721e-01   +4.170798380653495e-01   +5.796642743787767e-02   +1.212761519730115e-01   +7.296552574844356e-01   +5.071003179826189e-01   +6.183062589912066e-01   +5.406450961468415e-01   +2.648716524911087e-01   +6.054264274593477e-01; +3.900147514338906e-01   +4.059751545979479e-01   +4.244971828004688e-01   +1.066956662804222e-01   +3.869704669217369e-01   +3.369820032242118e-01   +1.946532848714652e-01   +2.619833319560314e-01   +4.051519379670934e-01   +4.146960748359988e-01   +4.135943174888537e-01   +7.998935930319477e-02   +2.301396731165997e-01   +6.761385785107259e-01   +3.833863737567942e-01   +6.641767245822883e-01; +6.132770657882625e-01   +4.241907821312761e-01   +6.229738544490465e-01   +3.692047623365191e-01   +6.659908781422371e-01   +3.193849077614979e-01   +2.494708643916520e-01   +2.469146556561234e-01   +5.027517693575765e-01   +4.640822394090838e-01   +4.431980408980531e-01   +7.771391782389096e-02   +6.920914559278557e-02   +6.914363399187466e-01   +4.289152319784033e-01   +5.597230890443038e-01; +1.023617453974933e-02   +6.939540526808990e-01   +2.842253715047742e-01   +6.111739706088398e-01   +2.976471991843368e-01   +5.059585591034144e-02   +3.558750297964073e-02   +1.390181343881818e-02   +6.601145014213533e-02   +4.257605405098017e-01   +6.750371096492257e-01   +5.698184533031517e-01   +2.175160024180390e-01   +1.809730144577521e-01   +5.133535071200118e-01   +2.183974855148655e-01; +4.376448189721711e-01   +1.299102846326986e-02   +6.237776215207263e-02   +1.787001964080315e-01   +1.263697511601642e-01   +4.510991076229427e-01   +4.980401895726547e-01   +2.646752706083897e-01   +4.309102831094114e-01   +4.185397762680906e-01   +2.300126613651429e-01   +5.272466741671928e-01   +1.964357903914389e-01   +1.786873845641418e-01   +6.663610308566005e-01   +3.007781853861211e-01; +6.216114461048801e-01   +1.627499398477320e-01   +6.358638586377303e-01   +1.479904971311644e-01   +1.177751691929015e-01   +1.400152875872792e-01   +2.082047530682397e-01   +4.357509457202480e-02   +2.121388848772610e-02   +1.510592389053937e-01   +5.985694582241928e-01   +7.141420537392623e-01   +9.109063852847828e-02   +2.540839654911743e-01   +6.334299864252643e-01   +7.205602361927398e-01; +2.467753584561535e-01   +7.091193243069995e-01   +4.513204512934774e-01   +4.979369864166262e-01   +1.079453781438565e-01   +3.461352194385134e-01   +5.819392251644699e-01   +3.129644173352510e-01   +3.541405776382096e-01   +2.359657582693172e-01   +1.410315697511320e-01   +3.879946103183698e-02   +6.817526050633403e-01   +1.955155942595072e-01   +6.490626534594344e-01   +4.880423687102120e-01; +6.503887790047327e-01   +1.978213655104819e-01   +6.907558067089146e-01   +5.643078568921481e-01   +1.947819971775585e-01   +2.001122410587171e-02   +4.586710499964222e-01   +3.469621557552108e-01   +6.742247439158087e-01   +5.420088947547642e-01   +3.941020569118679e-02   +1.160698016768333e-01   +5.843440503845019e-01   +3.783139541164171e-01   +6.179913932379456e-01   +2.139728931044909e-01; +1.328418221863995e-02   +5.744152893655462e-01   +5.020626992305185e-01   +8.176709695328394e-02   +2.343097144987071e-01   +4.469091184662390e-01   +1.230712215093016e-01   +5.347061829955972e-01   +4.516163593839719e-01   +2.687023159343259e-01   +1.950836837761974e-01   +5.910842472615419e-01   +6.979124146943915e-01   +6.845314515126726e-01   +1.168608099460721e-01   +2.806685593903179e-01; +8.292234073038779e-02   +6.125709990546803e-01   +6.833899019424245e-01   +6.851342288892348e-01   +1.875582540696941e-01   +1.883854658175185e-02   +2.625676199677425e-01   +2.148722419878856e-01   +5.295403087800652e-01   +6.264200971580013e-01   +3.655463910386978e-01   +6.305762777938166e-01   +6.384215564165050e-01   +9.932185845314850e-02   +5.323657367222404e-01   +4.905618957162381e-01; +2.762960213863524e-01   +2.737054660141872e-01   +6.051130090707896e-01   +1.138713125522614e-01   +4.426360541931200e-01   +3.609723974267336e-01   +2.301963385786407e-01   +3.312230827364020e-01   +7.090000791158935e-02   +9.559620959337935e-03   +1.443351223412048e-01   +7.197304577045328e-01   +6.014061717949770e-01   +4.583660209223359e-01   +5.735784919569700e-01   +5.327661990191914e-01; +2.546782342119798e-01   +6.974237724604087e-01   +3.539651614286983e-01   +5.374613080282632e-01   +7.239249220864991e-01   +5.345248857106542e-02   +3.496569787674374e-01   +3.364822589953247e-01   +4.906734938015137e-01   +7.186904362654921e-01   +6.355095700435489e-01   +2.662598495461490e-01   +5.677300043919726e-01   +1.223162142266478e-01   +1.822809849400684e-01   +6.896698920069222e-01];
L1E_L1I_iGABA_netcon = [+4.185774737839430e-01   +4.472666634330438e-01   +2.359862258411762e-01   +6.088376516001407e-01   +2.342879387136849e-01   +6.566228194421420e-01   +4.238209109469382e-03   +1.220858063400406e-01   +2.756066710819167e-01   +6.909597976082608e-01   +2.649467290486032e-01   +4.298903362270839e-02   +1.068096852379047e-01   +4.727350383234631e-01   +5.743980571727380e-01   +3.408202679781787e-01; +2.373889273444961e-01   +1.152282499255688e-02   +4.826744060252959e-01   +6.670031666426581e-01   +7.147098211571841e-01   +4.099624162555819e-01   +1.001271248775114e-01   +7.229033786669835e-01   +4.154610185945327e-01   +6.222263190735916e-01   +1.449617159085476e-01   +6.656434230909890e-01   +1.496403713848494e-01   +6.989018253654928e-01   +4.339451851788728e-01   +5.817929619900174e-01; +6.753282307793241e-01   +5.632725881381303e-01   +1.459106993117013e-01   +6.882483137843508e-01   +7.181038811114137e-01   +3.776097603752619e-01   +6.885702631284193e-01   +3.712315948529578e-01   +2.503620646829838e-01   +1.184429931198628e-01   +9.646904859456405e-02   +3.097168924325208e-01   +1.674771602523747e-01   +6.427403313156403e-01   +2.327960564961149e-01   +2.299022293190076e-01; +2.053333440325383e-01   +2.121544829420073e-01   +7.155284929122354e-01   +2.896924229713480e-01   +4.630749166313489e-01   +5.962406012080841e-01   +8.929522698448154e-02   +5.664143225582725e-01   +6.962054953360433e-01   +5.343425850115452e-01   +6.753338162560780e-01   +2.512002141742689e-02   +3.010078405447015e-01   +5.015683979289777e-01   +4.911631496778513e-01   +5.398603672077530e-01; +6.305108692377739e-01   +8.572074068011859e-02   +3.275944703799205e-02   +1.155069355274993e-01   +7.196708067529210e-02   +1.698883780771170e-01   +3.955680440320017e-01   +4.343999671099465e-01   +2.376297730633888e-01   +2.593758541690643e-01   +3.762958008859029e-01   +1.218910566672917e-01   +2.965498735322415e-01   +3.193008233462946e-01   +3.014389538821231e-01   +2.940019767903282e-02; +6.485556053632253e-01   +1.510138673756998e-02   +1.037666636997640e-01   +3.701860314092612e-01   +5.609676285168501e-02   +2.224409548923933e-01   +5.098297569859813e-01   +7.001656207525618e-01   +3.514343156988681e-01   +3.882264945831141e-01   +5.066291089103582e-01   +4.778335534150852e-02   +2.507523395233951e-01   +3.015734327450590e-01   +1.025831310652969e-01   +1.120558837362271e-01; +7.195215558866803e-01   +2.939815878157208e-01   +6.480318176735664e-01   +3.187956531281001e-01   +6.243411282094853e-01   +1.260340642369268e-01   +6.251442556539147e-01   +3.076493890065450e-01   +3.405409109942545e-01   +3.886207883905739e-01   +2.512117587872437e-01   +6.393191050436769e-01   +8.577745500241003e-02   +4.488323441525525e-01   +5.913061386168742e-01   +9.794158880662911e-03; +6.902208311558489e-01   +1.213986350526256e-01   +1.128844143932277e-01   +4.274677090549678e-01   +6.235571967076617e-01   +1.135933037772373e-01   +1.322600614793866e-01   +1.095864464842169e-01   +9.150398244957422e-02   +2.120355909526009e-01   +1.485762216124505e-01   +2.340680141060709e-01   +5.818522421840724e-01   +8.722203508690747e-02   +3.399758236021139e-01   +1.422517786455697e-01; +5.600329864222129e-01   +3.961732413270521e-01   +6.122641425134353e-01   +1.326926726004189e-01   +5.399741803310703e-01   +5.558759759769304e-01   +7.280214944538801e-01   +9.396626662153700e-02   +6.564943893935916e-01   +2.498175945079617e-01   +4.832461663499650e-01   +4.424884549297418e-01   +6.052654717649078e-02   +2.532842849645281e-01   +5.990711287306177e-01   +2.185730915680441e-01; +4.551499878760062e-01   +6.573260812539550e-01   +3.088070377552564e-01   +3.667981827869493e-02   +7.008521419851894e-01   +2.611253785637416e-01   +3.849094552807907e-01   +4.177207806476226e-01   +5.333987666996678e-02   +5.911616751836352e-01   +1.509898695175951e-01   +2.280152762196560e-01   +3.218492665253993e-01   +4.359360652394138e-01   +7.456999260688081e-02   +4.837375966609367e-01; +6.164991118974991e-01   +5.607752756282154e-01   +3.475078986546276e-01   +4.113306237865240e-01   +2.567784712741719e-01   +1.897418549946128e-01   +3.377473203794014e-01   +6.768728084423329e-03   +2.232872008250670e-01   +3.250954363633579e-01   +2.880581383310803e-01   +5.363230430203159e-01   +4.846372772366373e-01   +1.472167801419723e-01   +3.272672877449931e-01   +6.757450099061078e-01; +2.721296034103490e-01   +3.122599160037740e-01   +4.382244830259987e-01   +5.484292413823895e-01   +4.755284848620883e-01   +2.116908594197384e-01   +1.845880162143988e-01   +5.105199107296504e-01   +3.685496268294777e-01   +5.515957755079866e-01   +5.890429475815087e-01   +2.330281562025961e-03   +5.820539039144900e-02   +3.450320455656781e-01   +6.009314874694546e-01   +3.212824732445204e-01; +5.406099505408068e-01   +1.539899619318647e-01   +4.404313657460600e-01   +6.241367638762589e-01   +5.255923132258823e-01   +4.042743603258475e-01   +2.934624291376882e-01   +3.836359644894951e-01   +2.889825240530169e-01   +2.725292881371708e-01   +1.890348279176264e-01   +2.010902021285963e-01   +5.973186835724936e-01   +7.242506662360504e-01   +2.738116217970001e-01   +3.777170602704022e-01; +2.988234487664579e-01   +1.206854781404317e-01   +3.511833092559139e-01   +2.689671352998037e-01   +2.807265117359052e-01   +5.075656923516806e-01   +6.063070630367948e-02   +6.830315189114731e-01   +7.041741815189431e-01   +5.701960245849140e-01   +7.473287180036332e-03   +3.175965157478851e-01   +9.957935867343812e-02   +1.808717142325267e-01   +1.486215797505996e-01   +6.445851299604118e-01; +4.579608213215014e-01   -1.872811890643683e-03   +2.926538324905948e-01   +8.526048462609659e-02   +1.434614743317358e-01   +5.920718759842473e-02   +6.348038753734491e-01   +3.566777004795012e-01   +6.898494423995931e-01   +4.754595642298231e-01   +3.020023020378879e-01   +6.374299041513199e-01   +2.790964689443491e-01   +6.990850987382616e-01   +6.859549388796637e-01   +5.475082075568203e-01; +2.444801932987816e-01   +1.175506791374690e-01   +1.181430514660062e-01   +3.811558114486125e-01   +4.945556616261433e-01   +6.861861435770820e-01   +2.875538493620863e-01   +5.708330028019979e-02   +7.205323802208455e-01   +2.020777388464676e-01   +4.269289745307114e-01   +4.612622869677235e-01   +8.099565650708435e-02   +6.722827877406420e-02   +9.299201317762899e-02   +1.856638741028544e-01];
L2I_L1I_iGABA_netcon = [+3.362655264742352e-01   +7.060609614283428e-01   +4.447795266371109e-02   +4.412844580252531e-01   +6.803417069108024e-01   +2.334544553581239e-01   +2.798202033380539e-01   +5.128242914175402e-02; +1.379128707873844e-01   +1.531443071315939e-02   +4.707752840650288e-01   +5.769657032261574e-01   +2.242130158901686e-01   +4.265445883500014e-01   +2.756448735336748e-01   +1.997168128459486e-01; +5.388493253604583e-01   +1.680858928136389e-01   +1.720739489076777e-01   +5.088700504678840e-01   +1.685974317488150e-01   +4.582680647589507e-01   +4.206018739650599e-01   +5.089447933159291e-01; +3.244322249072769e-01   +5.249874177021643e-01   +4.800555469646353e-01   +2.390934805489119e-01   +6.424061206498197e-01   +4.471531551154454e-01   +8.857734807008021e-02   +5.436682875469540e-01; +3.505296357538109e-01   +1.581664219203998e-01   +3.216442758595043e-02   +1.716324742500379e-01   +1.047880693861169e-01   +6.099930799410059e-01   +5.480071879501917e-01   +1.702513769331963e-01; +6.943743859954921e-01   +2.429020617487110e-01   +4.719153628711225e-01   +2.415435761591278e-01   +5.715276184914539e-01   +5.621740479996328e-01   +8.835583829038729e-02   +1.322429932949492e-01; +2.864763052825268e-01   +6.293590300851012e-01   +5.219688793767955e-01   +6.242830540200202e-01   +4.719707844251128e-01   +2.270009217836315e-02   +7.098880585972835e-01   +1.207713440422154e-01; +7.178875934878862e-01   +3.020989340505871e-01   +3.401203817456288e-02   +3.961131185155278e-01   +3.851736707707271e-01   +1.877937079287804e-01   +5.958792748358261e-01   +1.059393673763029e-01; +4.171605197389083e-01   +1.813218170772425e-01   +2.089565361050102e-02   +7.888473420422931e-02   +1.519210405117023e-01   +4.200268080377551e-02   +5.750527182471505e-01   +1.784343581823863e-01; +2.050251566641928e-01   +3.151394041233967e-01   +3.050070171906147e-01   +9.545713452664327e-02   +6.141006934330003e-01   +4.958657466651728e-01   +1.029239338239672e-01   +2.015967367502535e-01; +2.130371634904805e-01   +5.608842938994739e-01   +1.016979354203245e-01   +5.021774976332546e-02   +3.194655655815374e-01   +2.056997236179549e-01   +1.635337806356919e-02   +7.295726688450854e-01; +7.013791174050825e-01   +2.643006679873462e-01   +2.303507817482766e-01   +6.995814339602631e-01   +5.952866616940300e-01   +1.523834922675432e-01   +2.485801794433723e-01   +1.096672068510808e-01; +7.264664079710761e-02   +3.711862724159066e-01   +5.721103498631299e-01   +4.516006363747520e-01   +4.810612911750073e-01   +4.850216067558149e-02   +2.123585959908845e-01   +7.199803507890734e-01; +2.439073045966011e-01   +2.494227591001780e-01   +9.496986876053251e-02   +1.590625793215170e-01   +7.047998785243709e-01   +8.634434853724998e-02   +3.631543278279672e-02   +4.043133133388197e-01; +5.662654529621436e-01   +5.372088368266953e-01   +6.894708177004947e-01   +5.585614731439298e-01   +8.619572028587505e-02   +8.985922969934512e-02   +1.405548669840175e-01   +1.494089388495193e-01; +5.242477376432612e-01   +6.660446780923031e-01   +5.198303880205053e-02   +1.369492770664993e-02   +1.570903176736273e-01   +5.793002381191690e-01   +2.461788243009790e-02   +4.657508700105785e-01];
L1I_L2I_iGABA_netcon = [+2.545833828042485e-01   +4.617027697499881e-01   +6.410470957965266e-01   +1.520788626279161e-01   +2.512606281493913e-01   +5.338421275996105e-01   +6.858228595843417e-02   +1.028240535012641e-01   +1.074532199910255e-01   +5.343714991242061e-01   +2.724860342916874e-01   +3.870458786779692e-01   +5.672419858015018e-01   +5.958495569484422e-01   +5.709565467170124e-02   +3.363813153207059e-01; +2.380006002592636e-01   +2.525310736848113e-01   +1.689611692751127e-01   +2.883124977964612e-01   +6.279502908908542e-01   +1.312367754249309e-01   +4.329835849157810e-01   +1.595669392534352e-01   +3.610992775364911e-01   +1.190045924330557e-01   +6.857130501484140e-01   +4.898814203401488e-01   +7.226339268304272e-02   +1.590488650306077e-01   +4.821914767571547e-01   +4.456033883092900e-01; +3.824284913327386e-01   +2.252238294677147e-02   +1.261758862636660e-01   +6.977662286923100e-02   +2.654361946397807e-02   +1.328750315219159e-01   +5.814605922561028e-01   +2.296282733450934e-01   +4.477528103065381e-01   +3.769574397247256e-01   +4.967992765827193e-01   +2.983608401057659e-01   +5.069717011753558e-01   +4.417194561544268e-01   +3.237776211534510e-01   +3.719682393611936e-01; +4.168364524083755e-01   +7.272714821005453e-02   +2.985053237642808e-01   +7.128852445683635e-02   +4.183994044392134e-01   +5.245407248522294e-01   +4.660741009788232e-01   +2.561613215744665e-01   +4.362369908665950e-02   +5.574563449472381e-01   +7.854796967584282e-02   +5.738032730889198e-01   +3.587882163510880e-01   +4.561289344456564e-01   +1.180121203432896e-01   +7.007944955330356e-01; +8.038139207873227e-02   +6.266679255164076e-01   +7.001495536861495e-02   +4.434228980070387e-01   +2.505490895198565e-01   +3.263939041300239e-01   +3.914247992158703e-01   +4.769345770922545e-01   +3.888079670653179e-01   +5.121745048788771e-01   +3.272324908006164e-01   +4.581107503952829e-01   +1.838387326876191e-01   +5.715090074273682e-01   +6.798381700492451e-01   +2.042741184321476e-01; +1.087655877128291e-01   +3.963460020843987e-01   +6.696625122366875e-01   +5.843486385837344e-01   +5.142330849264234e-01   +6.465734065981564e-02   +3.130050796723411e-01   +9.343320394435010e-02   +1.425072808455735e-01   +2.557617187654943e-01   +1.594186484033584e-01   +3.385490218386419e-02   +6.641699590231686e-01   +3.885458016730514e-01   +6.194411612761470e-01   +2.713663662178613e-01; +4.381931428354242e-01   +2.513889587555119e-01   +1.050770539186949e-01   +5.597128004788711e-01   +9.413838458626184e-02   +4.735929631866741e-01   +2.296361908035420e-01   +4.925605386437682e-01   +3.383383255861022e-01   +6.478714355366822e-01   +5.886063526315473e-01   +2.665681940809304e-01   +4.576768256917113e-01   +4.305074488011431e-01   +4.664434088079744e-01   +1.953484704214503e-01; +3.570281106745493e-01   +6.885012922834527e-01   +1.622378586085606e-01   +6.712310989218800e-02   +4.696687254019678e-01   +5.208928699314851e-02   +4.332122880206503e-01   +1.883658589863370e-01   +4.231717567408498e-01   +1.754658628649985e-01   +6.434208110972198e-02   +3.755546462400478e-01   +5.871001944225798e-01   +2.122083857958917e-01   +5.631502122807641e-01   +2.767149954319559e-01];
L2E_L1E_iAMPA_netcon = [+6.593523916953976e-01   +6.195681839668051e-01   +5.601848176183543e-01   +7.002381041730915e-01   +5.966782228848365e-01   +5.280429901809814e-01   +4.470719770022274e-02   +7.191317506100195e-01; +3.573649527679254e-01   +9.549985519008057e-02   +1.812929022799960e-01   +1.521690017965042e-01   +2.789771372627488e-01   +2.879729846991689e-01   +1.057163882977660e-01   +2.229951334650187e-01; +1.128823394609282e-01   +4.552328801116796e-02   +3.979187114817401e-01   +3.656888076507291e-02   +5.163333976941286e-01   +4.332488574300807e-01   +5.849125919453132e-01   +7.243945284164789e-01; +5.271202121053588e-01   +3.798644918466520e-01   +7.214365923894994e-01   +6.951189153689071e-01   +6.380499492617193e-01   +4.173430279137330e-01   +2.778209850025286e-01   +8.670713463360145e-03; +5.819318438752661e-01   +4.195294345336084e-01   +3.783226834141121e-01   +4.837395212754761e-01   +3.377782332707003e-01   +6.661196112730158e-01   +6.088917623388348e-01   +2.572007578106174e-01; +4.255334911679815e-01   +7.247562353473260e-01   +6.016302229694063e-01   +1.800949111341276e-01   +2.884868328190676e-01   +3.179566338672295e-01   +2.178905795764098e-01   +6.246621513806440e-01; +1.987398931248168e-01   +5.333255124013587e-01   +6.199239105176092e-01   +1.911804932730362e-01   +6.366393155022446e-01   +3.632812544565506e-01   +1.813996246218313e-01   +1.995130867676518e-01; +4.464637561962134e-01   +6.439889088475834e-01   +5.827783561862769e-01   +7.206307434962274e-01   +3.681772288212062e-01   +2.922866236096427e-01   +6.755099862739873e-01   +2.144824111619844e-01; +3.844064044315362e-01   +3.886440549981145e-02   +2.397698631602403e-01   +2.912067455098239e-01   +3.170402314508294e-01   +2.982178452313597e-01   +5.706261377366579e-01   +1.131492168918983e-01; +6.694776974917280e-01   +4.757184841793700e-02   +3.474445911206830e-02   +6.009913759544924e-01   +5.883187586686032e-01   +5.738036160729020e-01   +4.452259180081336e-01   +2.268381178754438e-01; +5.372567155903083e-01   +6.380448959793600e-01   +1.506170981620419e-01   +3.990866175748328e-01   +2.737955166964177e-01   +3.062373242319203e-01   +4.285005933594331e-01   +5.569082876793090e-02; +4.163473819084151e-01   +5.645096709019124e-01   +7.189843405188503e-01   +5.117391781240886e-01   +3.804471871062572e-01   +5.632079373100660e-01   +3.138418347110410e-01   +6.037531454412147e-01; +8.462815439474962e-02   +7.009276266032451e-01   +1.337714672921314e-01   +4.577548143119386e-02   +4.189375679445907e-01   +6.537390998873410e-01   +2.059174025145714e-01   +4.775191419828179e-01; +7.141701892793489e-01   +5.454219060215173e-01   +4.215168289198655e-01   +2.948875410290911e-01   +6.481824704854749e-01   +5.549902409520934e-01   +3.620051300340826e-01   +4.240396160956459e-01; +2.562345842621296e-01   +5.151156654506919e-01   +4.271507930002734e-01   +5.454388237618660e-01   +3.318760895770105e-01   +5.180619047148018e-01   +4.873561164566837e-02   +1.899086152206171e-01; +3.810726953891875e-01   +2.706196960035593e-01   +2.009089078526494e-01   +3.019545143718931e-01   +4.635643109033528e-02   +4.875571165877783e-01   +3.389660722365687e-01   +1.183936284538079e-01];
L1E_L2E_iAMPA_netcon = [+2.863288663895148e-01   +4.545494334718291e-01   +5.521101899875365e-01   +6.596544435811955e-01   +5.953465258222543e-01   +6.863173762548138e-01   +4.557910968249304e-01   +5.796025055782043e-01   +3.683122971407463e-01   +3.612236066712120e-02   +2.189575181512782e-01   +5.235733072587970e-01   +3.474902483938184e-01   +1.175509688665016e-01   +1.109913105798045e-01   +2.222316233320855e-01; +3.913706293841167e-01   +3.417072427195750e-01   +4.431414895474661e-01   +2.952570706113923e-01   +7.159508403700564e-01   +1.913698261450060e-01   +3.108031212123726e-01   +3.958673113023611e-01   +4.423436316292657e-01   +5.867321300799374e-01   +7.108070487211799e-01   +1.941246793876464e-01   +1.384269984794396e-01   +1.315692004054135e-01   +5.311770746253797e-01   +1.279124494101425e-01; +4.328926084074023e-01   +6.637288255014825e-01   +2.354180602972941e-01   +6.318089994790715e-01   +1.104789159736453e-01   +3.920215253894935e-01   +3.666368512434383e-01   +3.884596411974812e-01   +7.047808933645197e-01   +5.292541613397247e-01   +4.396926526365547e-01   +6.404590513521601e-01   +3.854689090505318e-01   +4.840638133600685e-01   +4.051702269324432e-01   +6.234752129159016e-01; +1.892610541311285e-01   +4.294766401167053e-01   +4.574174099895458e-01   +1.037802386964601e-01   +3.175153740467466e-01   +7.704991954676102e-02   +5.290776388237360e-02   +8.975315452235516e-02   +4.237959263825780e-01   +4.624083441792298e-01   +3.750064027974086e-01   +3.356249906621449e-01   +2.668606548314969e-01   +7.826287791705888e-02   +6.957381624831114e-01   +4.963175419619484e-01; +2.031253420586926e-01   +3.778279086343215e-01   +5.066492409487435e-01   +5.704930354439083e-01   +6.953199531506531e-02   +1.715951701397279e-01   +2.645241993690270e-02   +1.191787347542255e-01   +6.135953429970241e-01   +3.793321828618125e-02   +2.761537401476812e-02   +1.472845257204645e-01   +3.246631303248515e-01   +7.057545962145202e-01   +3.978639655943760e-01   +7.178487941786494e-01; +1.605376705840852e-01   +2.973840191999496e-01   +4.306942397165645e-01   +5.029209894654841e-01   +2.297170334317252e-01   +2.206783747144337e-01   +1.840936162166768e-01   +7.217134757105385e-01   +5.627576250513870e-01   +3.640511328368264e-01   +6.815406999668474e-01   +5.143890201322845e-01   +2.949487915924552e-01   +2.357462094943476e-01   +2.096639965869229e-01   +1.882105957218612e-01; +6.286604931407193e-01   +1.942408242270895e-02   +6.443436254697839e-01   +3.426717359147686e-01   +4.664114754256042e-02   +6.757433943623060e-01   +2.995090466973804e-01   +3.463626466590140e-02   +6.222714237725200e-01   +3.772070044445007e-01   +3.770748907390824e-01   +1.339856235534967e-01   +5.334245203487917e-01   +4.665859855143170e-01   +2.009396524671494e-01   +7.110164749348636e-01; +6.409734216219425e-01   +2.965142168331564e-01   +6.081688693883823e-01   +2.747959503017107e-01   +1.843157449489365e-01   +3.214788489345199e-01   +5.829089484871512e-01   +5.243306431680896e-01   +3.790159236432610e-01   +2.483535765778223e-01   +1.769833851098012e-01   +3.795243781569789e-01   +3.910126371386499e-01   +2.445047214499351e-02   +2.518837148711157e-01   +1.247830150160938e-01];
L2I_L2E_iAMPA_netcon = [+5.331187915014388e-02   +8.705478424394826e-02   +4.852162566020789e-02   +1.273406972709928e-02   +4.215971252768984e-01   +6.555775769601315e-01   +6.658150232215593e-01   +7.201562491556726e-01; +5.808990937080665e-01   +3.168002177354313e-01   +3.063854128530001e-01   +4.402885125055913e-01   +4.344947639761395e-01   +4.098798115799731e-01   +3.122045907248738e-01   +3.804674505376387e-01; +8.447029643461679e-02   +4.096710038271084e-01   +8.947273081044320e-02   +4.722300308460757e-01   +1.924579423388857e-01   +4.642018087534009e-01   +5.262142807464604e-01   +8.437129092632469e-02; +2.701600498670620e-02   +4.559426342500086e-01   +6.516681092174097e-01   +6.303376468339250e-01   +3.762956406970201e-01   +5.066552866368368e-01   +4.001997734054165e-01   +2.673490430393013e-01; +6.075891296210917e-01   +4.441649930890149e-01   +3.569193885298062e-01   +5.629124138364006e-01   +6.213010410117844e-01   +5.579247180747998e-01   +3.402804064111489e-01   +4.859842329992254e-01; +5.071723379442770e-01   +1.774857791783344e-01   +4.568203145794551e-01   +8.221014433025584e-02   +2.054301404712058e-01   +5.420951792869930e-01   +6.504686315572985e-01   +2.201453984024575e-01; +5.804651590805708e-01   +6.123574351418222e-01   +4.385882608250570e-01   +6.636960883634959e-01   +3.739103542939741e-02   +7.454391119583194e-02   +6.909401345164002e-01   +6.925319449793210e-01; +3.631578874978722e-02   +2.057155520200701e-01   +6.404800722016291e-01   +4.543867187886938e-01   +2.791530053856404e-01   +3.835835988287662e-01   +2.122064864144668e-01   +1.277444212734480e-01];
L2E_L2I_iGABA_netcon = [+5.246301795140204e-01   +4.614818370126240e-01   +5.791962852258100e-01   +1.595774614696730e-01   +1.977581543484520e-01   +3.284407244209195e-02   +4.634736655833452e-01   +1.185308185092580e-01; +4.912795536578554e-01   +3.541462358464602e-01   +4.008005030403587e-01   +3.366286415470478e-01   +5.015539632386954e-01   +7.657563244970780e-02   +6.632691804009037e-02   +1.883191965426556e-02; +2.201192515561993e-01   +2.553010012951052e-01   +1.128722871162103e-01   +3.071065194722475e-01   +7.094787226916226e-01   +5.689773348761269e-02   +6.531804260924299e-01   +3.183375020858968e-01; +7.284793536969437e-01   +9.514259622298736e-02   +4.401925942295902e-01   +5.789883338537096e-02   +6.347987044373632e-01   +2.418119721592770e-01   +6.269052608553981e-01   +3.451131665726047e-01; +6.130267267483867e-01   +3.207944946302903e-02   +2.272934092240037e-02   +1.262981492438162e-01   +2.388666123354285e-01   +5.283946814875226e-01   +4.992165564792888e-01   +4.176460563668900e-01; +2.278859422117391e-01   +1.300169521482728e-01   +2.774041981331989e-01   +1.168040782102574e-01   +5.612894215869561e-02   +9.889038691166682e-03   +5.578833104317525e-03   +1.804364705876566e-01; +1.909576309680524e-01   +6.248080431153886e-01   +6.053771494715057e-01   +2.885949393793113e-01   +6.361814978877472e-01   +3.396477944495302e-01   +3.094585486779426e-01   +3.838956899239768e-01; +9.307847909362611e-02   +5.189452625082009e-01   +3.760281523836224e-01   +4.617834574524999e-01   +1.502348323622493e-01   +1.659061393873776e-01   +9.954228925669334e-02   +2.244448679541065e-01];
L3E_L2E_iAMPA_netcon = [+3.454187127954083e-01   +3.920647975236516e-01   +6.107591896078721e-01   +3.437727659412244e-01   +3.325697252909658e-01   +4.628181876166216e-01   +1.187169779653234e-02   +3.431848432130867e-01   +4.616697868550846e-01   +6.703888950327866e-01   +3.127790437090901e-01   +6.453840858657807e-01; +5.341664833820728e-01   +4.334158584317600e-01   +1.800236381338117e-01   +2.573476920672267e-01   +3.273613884651530e-02   +8.705535460857604e-02   +1.572010949833486e-01   +8.745320213897531e-02   +1.890059748248244e-01   +6.424105239051872e-01   +5.864853940389829e-02   +1.305636463345537e-02; +5.645428499304643e-01   +5.933854925382679e-01   +7.132845810561697e-01   +6.425096813000248e-01   +2.293582190651620e-01   +1.293952803049642e-01   +4.642831417022760e-02   +2.580360044087199e-01   +3.367800901554406e-01   +1.050052659134062e-01   +4.136468889312075e-01   +3.609036888192818e-01; +2.690725590482663e-01   +5.113953353610978e-01   +3.089424619052255e-01   +5.021061532597982e-01   +3.975686374802934e-01   +3.616776829463525e-01   +3.711999020126843e-01   +3.094217622445206e-01   +1.490106313061843e-01   +4.301659309092358e-01   +2.311616702144050e-01   +4.881574451250775e-01; +2.392367930094060e-01   +1.821246192287157e-01   +4.729513107717332e-01   +6.836639446230675e-01   +4.597778776829609e-01   +2.995894798794727e-01   +1.258868727369092e-01   +5.432415510872847e-01   +5.464656173400229e-01   +2.882235283161408e-01   +1.426114175490651e-01   +7.018469903316363e-01; +1.987530447410453e-01   +2.982276423695532e-01   +4.113112585963730e-02   +3.586749411436885e-01   +2.802584692370027e-01   +4.696757317110275e-01   +3.143418821413130e-01   +6.052551120415532e-01   +1.238641221125980e-01   +7.087712201729626e-01   +5.833343723259256e-01   +1.735269999121147e-01; +5.737894238567327e-01   +6.446319395929272e-01   +3.492503523899648e-01   +7.258677582077688e-01   +6.250859725800392e-01   +6.710261470972303e-01   +4.720410280459822e-01   +3.334752371729004e-01   +6.601478385876295e-03   +9.061930415313413e-02   +1.146696478559452e-01   +2.563792375813940e-01; +2.076386534283428e-01   +2.446249054713639e-01   +3.812468273616594e-01   +4.935104649312267e-01   +5.765076270196747e-01   +5.937209005791668e-02   +2.968590672248326e-02   +6.677826630518723e-01   +3.491304295747184e-01   +5.639980065657948e-01   +2.426581194781128e-01   +2.623124101965980e-01];
L3I_L2I_iGABA_netcon = [+5.868739614394470e-01   +4.949262650181647e-01   +4.461402218199678e-01   +6.599479174422417e-02   +4.077105618721101e-01   +1.908300890933984e-01   +3.775774129483905e-02   +6.538030261055955e-01   +1.662346062734900e-01   +3.226758833584972e-02   +5.350463140794852e-02   +4.505824539064588e-01; +4.634241287935116e-02   +6.124749491244123e-02   +2.385055814409804e-01   +4.266661874371606e-01   +5.864817999130469e-01   +4.013031811017380e-01   +2.570184428123143e-01   +6.544624304351803e-01   +5.659172352854195e-01   +3.876756364067002e-01   +7.245304082771927e-01   +2.129612523112225e-01; +3.605098442823836e-01   +1.857021446748768e-01   +4.614670376252544e-02   +3.238443599952132e-01   +5.530448218513223e-01   +3.520618257383075e-01   +3.872461516378352e-01   +2.585607514881118e-02   +4.774043224997765e-01   +9.920604359446883e-02   +2.461644431132554e-01   +3.877646283018550e-01; +1.296677915612443e-01   +1.784505504958266e-01   +6.062148396022767e-01   +3.584156963778103e-01   +5.077267717256163e-01   +4.940778383483130e-01   +2.149159163936784e-01   +1.533805524839303e-01   +2.316330063624083e-01   +3.644985921668932e-01   +2.965201680017820e-01   +3.429360822288060e-01; +3.322917853670503e-01   +2.171924781904189e-01   +6.545820264655342e-01   +6.480705337419043e-01   +8.194707458517397e-02   +1.801049299239832e-01   +5.330571794487964e-01   +4.991857342876165e-01   +1.690966079113346e-01   +4.180916818615964e-01   +2.291449086768923e-01   +1.750925132972262e-01; +1.009538872792739e-01   +7.170302787586602e-01   +1.438905171040679e-01   +5.715500253642067e-01   +2.417056210800642e-01   +5.931493623590148e-01   +5.093262699218715e-01   +7.049042797208910e-01   +4.713428686648104e-01   +6.451208277632942e-01   +7.116582193794049e-01   +8.082131765191532e-02; +5.753473329351975e-01   +2.512087159335939e-01   +3.384566179931360e-01   +2.301435657073330e-01   +1.093266840880474e-01   +2.777445230083469e-01   +5.580759731744854e-01   +5.500346205894848e-01   +4.121003581411215e-01   +9.885709329580893e-02   +2.473036574789932e-01   +1.947029690421969e-01; +1.942680772215518e-01   +5.643544464030752e-01   +4.603187839311658e-01   +7.101529432372392e-01   +6.431096247761483e-01   +5.885804137929126e-01   +1.301520276674454e-01   +3.390265032646935e-01   +1.250277088302109e-01   +3.377248163203158e-01   +6.961352738160004e-01   +5.345915078488325e-02];
L2E_L3E_iAMPA_netcon = [+5.029348850434314e-01   +1.086016758115704e-02   +1.186467958078844e-01   +4.466984325757672e-01   +3.669158684670561e-01   +4.338386104535402e-01   +5.163039789619559e-01   +3.052468166234413e-01; +7.050581992550538e-01   +6.010694960200397e-01   +6.858429778503767e-01   +4.581641270077300e-01   +4.207773550851642e-02   +5.177145578105965e-01   +3.095375729983871e-01   +6.610898562124057e-01; +3.867267527867756e-02   +5.077299521601182e-01   +3.128282065152452e-01   +4.158834908502173e-01   +5.363066633772287e-01   +1.279721642368822e-01   +1.083196695093135e-01   +3.289473593798751e-01; +3.655797662683988e-01   +4.260998283595207e-01   +1.984718700631301e-01   +2.262153388177271e-01   +6.979638184886213e-01   +3.490107589418354e-01   +6.256089471103757e-01   +4.356064043243107e-01; +2.679941867014126e-01   +6.781147697849729e-01   +5.072353674400830e-01   +4.457984210973799e-01   +1.842958477330445e-01   +6.214481387391290e-01   +1.663325698524571e-01   +3.792538582334972e-01; +6.729851926553184e-01   +6.299606709599751e-01   +2.426535820043864e-01   +1.802779608272333e-01   +8.122325521078035e-02   +6.647079168818911e-01   +3.657028057181587e-01   +1.107615500307042e-01; +2.994187769109044e-01   +4.939351556785526e-01   +3.724304007461803e-01   +4.301077928436306e-01   +4.970300687427872e-01   +6.976785805473039e-01   +2.322896336093230e-01   +7.190643605367805e-02; +3.780821997526434e-01   +2.412955500909781e-01   +3.250669979098109e-01   +2.739877502381128e-01   +5.311979967837483e-01   +3.269602371823330e-01   +5.754829900176461e-01   +4.021778422875610e-01; +5.076186137784556e-01   +4.419785015275323e-01   +4.434695250452219e-01   +1.733903081295960e-01   +5.717823834521827e-01   +6.190769267179792e-01   +2.902546186845442e-01   +2.842994726049293e-01; +4.465133679453131e-02   +2.997567096441910e-01   +6.083458480746160e-01   +8.467513242913439e-03   +1.124121106289466e-01   +7.009612428903638e-01   +4.234675208161752e-01   +6.414675672000900e-01; +7.154190985265405e-01   +6.127772239734254e-02   +5.386587684256698e-01   +1.274289694243698e-02   +4.894621467312803e-01   +4.202738639712161e-01   +5.800183310417740e-01   +6.288696169176237e-01; +5.904797854037724e-01   +6.048741267994895e-02   +3.350316895191594e-01   +1.739806244108411e-02   +6.535917569171585e-01   +6.452789683564271e-01   +2.780334970107600e-01   +1.634926378553952e-01];
L2I_L3I_iGABA_netcon = [+1.421534827819838e-01   +6.275741360355491e-01   +3.585437765919240e-01   +4.240753857863360e-01   +4.730040618657499e-01   +3.701449744461259e-01   +4.541680995888791e-01   +6.842859616050887e-01; +1.156831141433652e-02   +5.605937070528336e-01   +7.366322628224815e-02   +8.618672973894185e-03   +7.105655061521077e-01   +6.540947703922465e-01   +1.606127542935322e-01   +2.394785120450288e-01; +6.599544591970972e-01   +1.626528910802681e-01   +4.161291696675498e-01   +5.494084039337036e-01   +2.087499088853581e-02   +3.356213221737073e-01   +1.271786932883628e-02   +7.282126139337530e-01; +2.649789556253097e-01   +1.331136777307213e-01   +6.581875131367487e-01   +6.612672905862493e-01   +7.285546716742366e-01   +7.033646283382479e-02   +5.046705547805596e-01   +5.582637375529321e-01; +2.788909366358094e-01   +1.739235994798546e-01   +9.439933884406398e-02   +2.525872797775349e-01   +3.733455132117623e-01   +1.577302407347765e-01   +6.468162412616320e-02   +5.837583267445526e-01; +3.480491076742111e-01   +5.114165112649591e-01   +5.808311211437636e-01   +1.004377793636784e-01   +4.575014811160297e-02   +5.110427874991650e-01   +6.704231201133422e-01   +5.754764142904009e-01; +2.803405024322219e-01   +6.141857838717337e-01   +6.847931010833894e-01   +5.453061123894738e-01   +1.982564937779439e-01   +5.756692648617797e-01   +5.718057881183213e-01   +1.199538092522643e-01; +1.134613607438887e-01   +1.888595608738402e-01   +2.472506359600530e-01   +5.749046495351441e-02   +3.462779190797228e-01   +4.793781359439381e-01   +3.973180381578378e-01   +5.219224789257856e-01; +2.432604152544019e-02   +1.471117071715748e-02   +1.031532014319299e-01   +4.418674775724437e-01   +2.705180347929961e-02   +4.779651505470472e-01   +8.438601649227602e-02   +5.516796056552611e-01; +4.248703050787633e-01   +1.014991823273154e-01   +7.601433053637402e-02   +2.529637444729987e-01   +1.257705541676089e-01   +4.352281648247158e-01   +8.669993731723309e-02   +3.805961955499518e-01; -1.544670017272344e-03   +7.080694455628197e-01   +2.454921232747511e-01   +2.280151125953281e-03   +8.071448756681998e-02   +2.009584877214294e-01   +6.781800468761428e-01   +1.640372244797522e-01; +2.543632256560641e-01   +1.081261806406291e-01   +6.989489449222467e-01   +3.284802845114814e-01   +4.495590462617258e-01   +7.590707075756763e-02   +2.734101350952645e-01   +2.047186575441181e-01];
L3I_L3E_iAMPA_netcon = [+7.257487720285491e-01   +3.930996655425234e-01   +2.563402866913164e-01   +6.864103730136130e-01   +4.226460233476931e-02   +1.864393787476876e-01   +3.503716589412408e-01   +6.810725303775537e-01   +5.264928294559987e-01   +9.480628340841704e-02   +2.455983377224702e-01   +4.562971780405926e-01; +3.934729395456695e-01   +2.227321842812654e-01   +5.524051401621320e-01   +3.763327525019943e-01   +4.896157282268619e-01   +5.655279852549659e-01   +6.731360591842979e-01   +8.306382562832909e-04   +5.047439577893623e-01   +3.447921783792865e-02   +2.212609565830854e-01   +2.653375130069881e-01; +4.878762088400544e-02   +6.517222562996778e-01   +3.428666589633010e-01   +2.745025242161527e-01   +4.070692299333246e-01   +7.802762050294841e-02   +3.268828690840054e-01   +9.957476838598878e-02   +1.938670781157200e-01   +6.081276544376126e-01   +1.794222225541607e-02   +5.933236728778517e-01; +6.678336192478636e-01   +1.683353705503321e-02   +1.500800670697677e-02   +3.572134690069300e-01   +3.210276085164749e-01   +5.009683982207112e-01   +2.068256195099314e-01   +2.359357085269453e-01   +4.288868247784930e-01   +1.060539469978216e-01   +6.019842535903349e-01   +2.576895312066192e-01; +5.416094369174684e-01   +2.204622683317971e-01   +2.369147117158240e-01   +2.001418111839362e-01   +4.933406781404385e-01   +4.190283775386291e-01   +7.168481697467485e-01   +2.614940279921077e-01   +1.453705855408413e-02   +2.634852350942422e-01   +5.899394983868177e-01   +3.737565080155207e-01; +4.127936843040523e-01   +1.718793932167628e-01   +5.363863412952871e-01   +7.231405708158415e-01   +4.064274606735353e-01   +3.979429177795529e-01   +6.782954643407716e-01   +4.565022546802722e-01   +3.922418681069381e-01   +5.138891240767515e-01   +9.495957172837446e-02   +6.785933740286590e-01; +2.347133551255935e-01   +2.927642605295633e-01   +6.235961655433511e-01   +6.344644704425564e-01   +3.464217688674239e-01   +4.161547850884275e-01   +6.261054209426518e-01   +5.535240787764893e-01   +1.226680424801890e-01   +5.214286875612593e-01   +4.664557656325795e-01   +5.418519672807603e-01; +5.518330880803040e-01   +6.794999605447808e-01   +4.255550272112893e-01   +1.321582682276398e-01   +4.554362898919492e-01   +1.020873654766192e-01   +1.636410331954730e-01   +3.096013364019979e-01   +2.985678377169485e-02   +5.214945839416836e-01   +6.519997330696010e-01   +2.724804055479040e-01; +4.034575067448775e-01   +5.584730889846632e-01   +2.449730558528459e-01   +5.430272280106376e-01   +5.303113977122924e-01   +2.799201840693239e-01   +2.361250823649754e-01   +6.972505848601162e-01   +4.135774300504638e-01   +6.690641472172977e-01   +3.545269026259120e-01   +1.713138701665985e-01; +3.826592284941593e-01   +3.316210253874134e-01   +1.141369514191956e-01   +4.546242987555653e-01   +1.394566695288465e-01   +4.834190102771969e-01   +1.980704899138799e-01   +3.075624387864682e-01   +6.233264766552331e-01   +2.727874420521627e-01   +5.948656683823181e-01   +3.574316179361582e-01; +4.839838791699119e-01   +6.947119485754266e-01   +2.711490903412939e-01   +1.466012200672403e-01   +1.469594969570784e-01   +1.468138454458161e-01   +2.156634531029736e-02   +1.031749993741757e-02   +5.194264792361096e-02   +4.861447308858685e-01   +5.957488781387534e-01   +4.154307383796633e-01; +6.364344279486694e-01   +1.532858077353896e-01   +1.773099260977848e-01   +5.221896325967814e-01   +6.442343996041874e-01   +2.123880071649732e-01   +3.516930365153156e-01   +4.863623813940726e-01   +3.230971384532282e-01   +3.575458735790306e-01   +3.368431962416805e-01   +6.276122704785896e-01];
L3E_L3I_iGABA_netcon = [+2.502390358597931e-01   +3.645065558149180e-02   +1.586664517466849e-01   +1.146180419777320e-01   +5.545918648885904e-01   +1.310024446647263e-01   +1.476236181905608e-02   +6.556518567309683e-01   +2.779320265409713e-01   +3.083995651623522e-02   +1.418675749382896e-01   +4.927756955766766e-01; +2.435948572437450e-01   +4.408376514113977e-01   +7.146707902062340e-01   +2.616846240368082e-01   +7.133624496048681e-02   +3.822773310540033e-01   +1.541128543598316e-01   +4.030568247288344e-01   +2.700055800675113e-01   +7.061484216041503e-01   +2.582990239343854e-01   +2.658147588755895e-01; +1.983324136318460e-01   +6.844840640008857e-01   +2.016409521247862e-01   +3.473255069988303e-01   +3.318039576866244e-01   +5.214057703113351e-01   +6.620461810627721e-01   +5.074281419334013e-02   +1.267164545147157e-01   +2.007354109282310e-01   +4.752740791104739e-01   +6.088162292986623e-01; +1.652617543397176e-01   +6.520594602564710e-01   +3.327312866592563e-01   +5.714940831192289e-01   +2.024998885984639e-01   +6.822280606946076e-01   +7.132686754956984e-01   +4.475164084034704e-01   +4.226747643071220e-01   +2.749243472638719e-01   +4.851640755608809e-01   +4.070627928979689e-01; +5.623615661559189e-01   +3.847562061091516e-01   +7.274818577840204e-04   +6.886903174870422e-01   +9.880092043136135e-02   +3.496116355693056e-01   +6.297406535476182e-01   +3.811094772543091e-01   +3.092316297337142e-01   +7.006556300135822e-01   +3.347223516682427e-01   +3.547065818072904e-01; +6.859651690744042e-01   +4.849966000775026e-01   +3.397124858212996e-01   +2.523608751056283e-01   +5.387075802654510e-01   +1.746510022851419e-01   +3.458350564037179e-01   +5.913706387720099e-01   +2.037980733046419e-01   +1.770075022780468e-01   +8.702033576076583e-02   +5.138274059072845e-01; +5.387711939639809e-01   +1.243013113563106e-01   +6.919783072786651e-01   +2.835460537975149e-01   +2.446127666746966e-01   +4.849368554796020e-01   +4.606484643566385e-01   +5.560073847848351e-01   +3.691599046122335e-02   +6.679466158731660e-02   +1.499559289572074e-01   +2.035695153263084e-01; +1.973039324369473e-01   +2.311374539043647e-01   +4.084655696973721e-01   +3.571914814312819e-01   +6.517883532189780e-01   +4.977124671520308e-01   +3.978667484545722e-01   +1.578865637147608e-01   +5.999718400496287e-01   +4.292303680532822e-01   +7.695208464814708e-02   +3.551412211179298e-01; +2.240420643554183e-01   +3.786757199313861e-01   +3.237669659297127e-01   +2.182551474671091e-01   +5.927475932576753e-01   +3.707364040746376e-01   +1.113766625698033e-01   +5.201410106914461e-01   +6.883847051400348e-01   +1.558565972768358e-01   +1.673040400047277e-01   +6.088046008853565e-01; +1.122321245373857e-01   +1.198316033005760e-01   +3.206329214952940e-01   +7.154179685274203e-01   +4.199778044056384e-01   +7.909113961513214e-02   +6.080046530099810e-01   +2.161131576790770e-01   +4.458337548779729e-01   +5.163733515197658e-01   +1.005110070624579e-01   +4.764288953288550e-01; +6.292499879166924e-01   +2.072467623307217e-01   +2.240450999102493e-01   +3.403166547312894e-01   +2.314053733527857e-01   +2.404955237602732e-01   +7.228786325347271e-01   +7.504022990325954e-03   +1.444943303795345e-01   +1.484831376487592e-01   +5.391495578193033e-02   +3.226994403612692e-01; +1.952650223896821e-01   +4.014590229700003e-01   +9.690872896949945e-02   +3.401994049425285e-02   +7.062607532761551e-01   +4.826179303630825e-01   +3.166758033755495e-01   +2.187878741744330e-01   +7.779236136327253e-02   +2.932656523875802e-01   +6.399834302487910e-01   +1.326791757481159e-01];
L2E_Input1_iAMPA_netcon = [+1.803608338201895e-01   +4.322295081435926e-01   +1.636874986063932e-01   +9.788016634844346e-02   +4.513774933396237e-01   +1.514099104936759e-01   +5.267852644260332e-01   +3.132243725169279e-01];
L2I_Input2_iAMPA_netcon = [+7.184090257973526e-01   +3.638790320630290e-01   +3.657906434471198e-01   +1.801115924084983e-01   +1.089781769900974e-01   +9.697166153106825e-02   +5.342770572484262e-01   +4.190987078715587e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 10*((exp(-10*((t)-( 50))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 10*((exp(-10*((t)-( 50))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
