function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-3.966869955681142e-01   +3.955728140819511e-01   +4.163793775551435e-02   -6.436635423574741e-01   -1.002172345050837e-01   +5.380529388682499e-02   -3.824026971127009e-02   -4.594616278718053e-02   +5.275406462118017e-02   +2.531968873076815e-01   -4.284835979142370e-01   -5.269799914450675e-01   +2.973989758014253e-01   +8.532105913553684e-02   +4.110829501644185e-01   -1.084187051755410e-01; +9.917040511053801e-02   +1.692114517878174e-02   -2.312080748652282e-01   +3.380605500111520e-01   -2.442122754411482e-01   -2.647076762536140e-01   +5.432626731356055e-01   -1.933748882107186e-01   +3.205540376712390e-02   +9.005487434753923e-03   +2.837693414872300e-01   -1.021488524102325e-01   -2.946568025442252e-01   +4.636858823906285e-01   -2.653739643766728e-01   +4.233021962830823e-01; +5.414156780056120e-01   -2.086879000912536e-01   +6.938030974437917e-02   +4.223865967200065e-01   -6.015060555288588e-01   +1.400357137082456e-01   +2.616752723716559e-02   -6.086001279275437e-01   +3.839286371767295e-01   -2.955244549435703e-01   +1.872326895384915e-02   +4.511727554876535e-02   -3.487735632798153e-01   -1.874152229339236e-01   +1.653595840998810e-01   -2.614765531297523e-01; +2.196975005159462e-01   +6.044286084922904e-02   +1.437849290832837e-01   +5.922132241984175e-02   +1.795915194081539e-01   +2.970380340716891e-02   -5.030164380701255e-02   +1.869320870209744e-01   +2.049642439446034e-01   +7.116180121961733e-01   +8.254100109170252e-02   +6.875977851955506e-02   -4.236346377864787e-01   +9.401636934772942e-02   +2.498165179328008e-01   -3.043931472604912e-01; +7.649317828105714e-02   -3.921822843055995e-01   -1.023525868793357e-01   +2.235114994189727e-01   -2.326056615866441e-01   -4.612539656101964e-01   +3.633735725554617e-01   +1.689497077192832e-02   -4.170572355607088e-01   -2.149615036286835e-01   -4.831541135829161e-01   -1.772839880341394e-01   -1.239078095500815e-01   +8.141650400927468e-01   -2.086327979693067e-01   -1.616242051859171e-01; -2.558401455720490e-01   +2.489363958747897e-01   +7.920086591753929e-02   -3.212559199312274e-01   +8.550480224651053e-02   +3.505392085057465e-02   +4.556271303023308e-01   +3.001633463467740e-03   -6.551618442189051e-01   +3.846845386262867e-01   -5.355533853645547e-01   -2.433458234030262e-01   -1.164771938938772e-01   +6.851977500064523e-01   +3.842824365183748e-01   +4.208572741855694e-02; -4.409240213456773e-01   -1.090848941178765e-01   +1.441388772714054e-01   -4.335859325865188e-02   -4.464134139488931e-01   -6.215444822870411e-01   +6.882583919281747e-01   -2.680272029402376e-01   -1.065548647317525e-01   -3.467756601648020e-01   -7.486832563419962e-01   +2.554352651180377e-01   +2.840563095586754e-01   -1.856043722074748e-01   +1.766887267246537e-01   +3.431527513548071e-01; -5.187476602524854e-01   +9.660082760143948e-03   +2.478517620055693e-02   +1.955263510528666e-01   -8.055116559398459e-01   +2.239560800013891e-01   -1.267639824520818e-01   +2.291689885546195e-01   -7.460483039425082e-02   +3.889609472454886e-01   -9.518027937262900e-02   -2.209200094115325e-01   -1.155233602676644e-01   -2.559306853922038e-01   +7.609083887994819e-02   -8.330305365345735e-02; -1.275224151812113e-02   -4.794097199678536e-01   +4.403860167672355e-02   -1.692812772245957e-01   -1.324510529119641e-01   -7.444287051852290e-02   +3.506047294801526e-01   +6.319299553757445e-02   -7.412318614170617e-02   +8.950659207006101e-01   -2.441290839634028e-02   -2.955709399899805e-01   +7.586753634615256e-02   +3.248317062296979e-01   +6.375588188576614e-01   -5.973803774967283e-02; +5.904211302247195e-01   +1.187691255409956e-02   -2.094222657279919e-01   +2.048334444846939e-02   -2.024415483452210e-01   +5.317849436737527e-01   +2.831528462396514e-01   +3.507277608234526e-01   -2.494756063762519e-01   +6.148497918246991e-02   +3.457630789074857e-02   -3.896354872349538e-01   +1.682689422098940e-01   +1.941149623824887e-01   -3.059231746134982e-01   -2.767525647517058e-01; +1.718943879223253e-01   -1.643646293948682e-01   -4.440187228899349e-01   -6.904699220076564e-01   +1.329616722193237e-01   -2.814764122402297e-01   +2.744918305506855e-01   -2.960097870051295e-01   -2.404629067873402e-01   -4.719571427777303e-02   +3.517008341168155e-01   +2.607645575062141e-01   -1.651792424818240e-01   -3.770083651888074e-01   +2.028768739284596e-01   -3.148199998990843e-01; -2.652132143946983e-01   -3.161190941441730e-01   +5.744482067510444e-01   +4.276048865785299e-01   -1.681431443285885e-01   -3.262088503508175e-02   -9.346100419583403e-02   -2.409707470200025e-01   -1.595952758039039e-01   +3.968610818084879e-01   +1.443187553138751e-01   -1.754808849851598e-01   -1.927207729489089e-01   -1.469828528165455e-01   +2.768993529381011e-01   -6.778863216025058e-01; +4.440970944734504e-01   +6.429474870819070e-01   -3.937298704469845e-01   -1.452435943367732e-01   -6.354895962235152e-01   -1.865092823576552e-01   +5.939770207159069e-01   -7.625981819255491e-01   +9.508822888344726e-02   +3.819844179259879e-01   -3.512180892072810e-01   +2.290135861843102e-01   -1.428717260962208e-01   +3.035805844066009e-02   +2.840848366130149e-01   +2.765727052645602e-01; +4.052536547726440e-01   +5.578525623334246e-03   +1.912699731227736e-01   -1.760923520892912e-01   +8.869102749819473e-02   -4.645041862849322e-01   -1.239245732107387e-01   +3.179257683066706e-01   +1.073458239920042e-01   +1.596641206630958e-02   -6.591422167258908e-01   -3.660288660050579e-01   -5.044782839271462e-01   +1.939812996218502e-01   +1.769688720149417e-01   +5.688818633671044e-01; +8.776005235455658e-02   +8.007993501999191e-01   +5.403229266702657e-01   +4.390008733052083e-01   +1.160160260964762e-01   -2.055852302852711e-01   -4.511511731558046e-01   -4.951805918993464e-01   -5.072745830469011e-01   +3.174713555523017e-01   +3.468057613641941e-01   +1.486681544560101e-01   +6.345022245582148e-01   +2.462941068023422e-01   -2.229372829599138e-02   -2.722103833579357e-01; -6.957769478490147e-01   +3.689324569436881e-01   +6.291533753610075e-01   +3.779768831687551e-01   +3.724663025500518e-01   +2.422746943623519e-01   -6.187162096892955e-02   +8.483062487299324e-02   +1.143436123652762e-01   +2.402239827017150e-01   +4.330120131522076e-01   -1.805210573301349e-01   +4.725486338023027e-01   +2.986456620881671e-01   -3.009089586340994e-01   -1.927196714362142e-01];
L1E_L1I_iGABA_netcon = [-4.787734562379344e-01   -2.894005514025261e-01   +2.802739549992536e-01   +3.399291639365381e-01   +3.218770127164819e-01   -2.271246774395484e-01   +1.319240112603373e-01   +1.095281948828068e-01   -5.121030387567932e-01   -4.051591383004689e-01   +3.494720019972745e-01   +3.168400618038143e-01   +1.046656441390051e-01   -1.455321301108625e-01   -4.562854445510567e-02   +3.545465513369099e-01; +5.612787065101875e-01   +5.522315498706076e-01   -1.565692661961788e-01   +3.389784223113830e-01   -1.262899019447677e-01   -1.968601051466333e-01   +3.223672969325363e-02   +3.158444188079902e-01   -1.683025535220050e-01   +7.349149560496775e-02   +4.156824637218988e-01   +2.107409111918400e-01   +2.877890722006651e-01   -1.433626055846529e-01   +3.974750202753553e-02   +1.387522066135957e-01; -6.826400774493614e-01   -1.088381543244165e-01   -4.011993290116513e-02   -3.404798436770723e-01   +7.243896147539476e-01   +2.296088502591301e-02   +6.172169541270840e-01   +3.010237346148207e-01   +3.027894434665868e-02   -4.799375112865587e-01   -5.469004795587049e-01   +1.290509145058354e-02   -2.408963126246176e-01   -2.454213059412211e-01   +1.551745458712650e-01   +1.019565300155764e-01; +4.858515845535649e-01   -6.080005117616688e-01   -3.568929949418469e-01   -5.799188090054226e-01   -4.509835604782392e-01   -6.735156894125180e-02   -3.772051292972616e-01   +7.911318228439864e-01   -1.099681590762766e-02   -9.753743371665850e-02   -1.128532880145410e-01   +3.683037006669328e-01   -2.476885484110049e-01   -2.822200837268291e-01   -3.019371102546055e-01   -5.000894271620860e-01; -1.687952241771705e-01   -2.555212678015990e-01   -3.937607659205382e-01   +2.257721006923069e-01   -4.752226629126095e-01   +1.105184485657347e-01   +3.790846587170397e-01   -2.068596704793007e-01   -4.828401904250083e-01   -1.440176355638580e-01   -3.642783139304917e-02   -2.160827608153800e-01   +3.559998550850404e-01   -6.057365165433687e-02   -2.048004479403006e-01   -1.593750386322307e-01; -2.588876401464430e-01   -1.147035468177063e-01   -3.963350219353318e-02   -1.182765726493911e-01   -5.035148808933028e-01   +5.378796793229444e-01   +1.563455896392687e-01   +1.799822592695411e-01   -1.565583086873572e-01   +4.567951499713621e-02   +1.644413332290726e-01   -4.116991412769083e-04   +4.758307798365055e-01   +3.712822470744753e-01   -1.478457018155796e-01   +1.434056218869698e-02; +1.235404761403677e-01   +8.088505823558015e-02   -8.095219130048097e-02   -6.176579873682703e-01   -2.136947850563372e-01   -7.553770107327203e-02   +3.219353627775111e-02   +4.833062275839142e-02   -1.382683904869864e-01   +2.855247187614850e-02   +4.789035884791781e-02   +1.703021761572715e-01   +4.599855266202523e-01   +5.231233467020364e-01   +4.671546836858504e-01   -5.804331805649926e-02; +3.572261831315575e-01   +5.202690148278436e-01   +1.980950519101592e-01   -3.928702121034204e-01   -3.458473039159469e-01   +1.878026380572813e-01   -2.021992234780399e-01   +1.352996708202732e-01   +6.558253383948482e-01   +8.206292296473463e-01   -5.046639950153972e-01   +4.228011044391195e-01   +4.653591469590743e-01   -1.361836879486268e-01   +3.939056927254707e-02   -1.808453809558263e-02; +5.120969181377584e-01   -1.061876925154021e-01   -2.813433123890317e-01   -8.019727241106280e-01   -2.278994527624038e-01   +4.852988873191659e-01   +4.640389003456708e-02   +2.494719203594308e-01   +2.360959048928057e-01   +6.469302711596629e-02   -3.050980261403279e-01   +5.668500327250215e-01   +7.886320529108481e-02   -1.988619335015958e-01   +3.051119530008404e-01   -3.152758916313811e-01; +3.766699147910926e-01   -1.421278098965146e-01   +7.519503437909821e-01   +2.944489294173270e-01   -2.676970977544398e-02   +5.071856270872630e-01   -2.691748026695766e-02   +4.697618421975461e-02   +2.509540146916865e-01   -4.070868010549013e-01   -5.683356666650629e-01   +7.542945560722959e-02   -6.413131839005290e-02   +1.741256385669937e-01   -3.877184537659950e-01   +3.269094666347028e-01; -2.054823183992727e-01   +3.736438560127270e-01   -2.689290724274639e-01   +2.631232055923194e-01   -1.597062832528827e-01   +1.324300017235017e-01   +5.777275694881470e-01   +7.225365270295958e-01   +1.467384664911316e-01   +6.017938702792593e-01   +3.572365354472685e-01   -1.012285493782671e-01   +1.238302573930089e-01   +2.801146642502886e-01   +2.555493861922367e-01   -2.312939665125808e-01; +1.869206057388607e-02   -4.441978819495742e-01   -7.097233652452629e-01   +9.844937548213803e-02   -2.453749965217521e-01   +4.663416349032902e-01   +9.999967435765442e-02   +4.115612265162846e-01   -3.801090566707642e-01   -5.779546444629952e-01   -3.086841117805856e-01   +5.979608411304629e-01   +1.411381962249382e-01   +5.125618748886458e-01   -3.116782119037912e-01   -3.193898257498828e-01; -3.184139653392024e-01   +7.009972216717381e-01   +3.676686813189701e-01   +2.591945522576842e-02   -2.804898628863436e-01   +8.007740296466309e-03   +1.966457403944084e-01   -3.880105129280945e-01   +6.920334789896904e-02   +4.832878188065157e-02   +4.076273506080881e-02   -7.181581915590997e-02   +3.096835092619932e-01   +3.911015612859937e-01   +5.247348549130660e-01   +4.709340727669409e-02; -4.765601638480939e-01   -2.512531673275198e-01   -5.352027123494216e-01   -3.504257673668588e-01   -7.098014045085506e-02   +4.559103727524815e-01   -4.355082336027499e-01   +5.328535889834782e-01   +2.433878745444019e-01   -1.554316378056671e-01   +5.009118414238182e-01   -1.217927937632594e-01   -1.317346472569042e-01   +5.843322815986463e-01   +1.343985944418553e-01   +3.528757886517364e-01; +4.092175963028252e-01   +1.395251886274637e-01   +2.514409508056985e-01   +9.899886189500121e-02   -1.101496454290246e-01   -2.447741512731032e-01   +9.017065950849026e-02   -1.672670917581208e-01   +4.688403695282260e-01   +4.805534771348208e-01   -4.852429822207487e-01   -1.168030864996489e-01   -3.231349577202365e-01   -8.009427548695129e-02   +5.732196099819348e-01   -2.681212294448972e-01; +2.183998761144103e-01   +1.240778165741581e-01   -3.144359222252266e-01   -4.889994412462972e-01   -2.320128139161548e-03   +2.718958085523299e-01   -6.948870417022221e-02   -4.338943075456886e-01   +5.084401759495130e-01   -5.298509955192232e-01   +1.619596943564018e-01   +1.542505327129680e-01   -1.739167081131720e-02   -1.006401623101768e-01   -6.685492166406051e-02   -5.831263359239541e-02];
L2I_L1I_iGABA_netcon = [-1.262970526213203e-01   -4.950886935131278e-01   -1.642758474523145e-01   -4.615252970496833e-01   +2.593584163149180e-01   -3.550031922237894e-01   +1.575085189515121e-01   -1.008357101085878e-01; +5.177724449349397e-01   +8.616480394191273e-03   -3.866773224760559e-01   +4.092002371379739e-01   +3.104311606911178e-01   +4.413404705791577e-01   -3.285618692003828e-01   +4.782802277089901e-01; +9.389416814699056e-02   -5.615683621584977e-01   -6.407184524117540e-01   -9.764256300420646e-03   -2.990833101203218e-01   -3.871116862648357e-01   -6.534746149733414e-01   +6.836210128445589e-01; -6.357067614673686e-01   +4.968526273662860e-01   -1.008092759356899e-01   +1.003571892270548e-01   -3.656661042539890e-01   +2.071568892138417e-02   -4.095131266612104e-01   +5.028688133208548e-02; -2.007013804320538e-01   -1.598137094271478e-01   +4.073042220590144e-02   -2.276084225428101e-01   -2.330527375567135e-01   +4.109161470746287e-01   -5.407283630885453e-01   -2.415319852511323e-01; +4.745546850837325e-02   +9.662504458092595e-02   -3.407591562922458e-01   -7.110206837968334e-01   -5.428420939295778e-02   -8.966144754583011e-02   -5.379520139638021e-01   +4.276134771222260e-01; +4.514314016484210e-01   +4.096199732969644e-01   -3.481775953238743e-01   -5.166223513255640e-01   +3.158553847955354e-01   +4.433362523649670e-01   +2.082270411388218e-01   -4.910263751029534e-01; +2.644859233235233e-01   -2.781298298082807e-01   +2.662352309229964e-01   +6.548959344222739e-01   -2.954509249247972e-01   +3.263429511529327e-01   +3.401356531298056e-01   +1.210779119947611e-01; -2.509546589613560e-01   -1.131602413548553e-01   +4.412839924675547e-01   -1.283577165296677e-01   +5.135328165390156e-01   +3.948318963640352e-02   -3.866504766911937e-03   -1.792702825471694e-01; -4.189939037149298e-01   -2.070817582853565e-01   +1.806724016371846e-01   -2.566723117236781e-01   -4.628708133989168e-01   +6.381237889409871e-01   -5.234523654256776e-02   +5.126649739586164e-01; +1.795182871967245e-01   -4.847901371334148e-01   +1.552340344873201e-02   -7.681152221689906e-02   -1.273696117103538e-01   -9.546477049536778e-02   -1.689056097212269e-02   +2.060921541466328e-01; +4.975092559747528e-01   +1.689951979223331e-01   +1.859033675539951e-01   +7.998454677120331e-02   +3.358009065539141e-01   -3.866643334936321e-01   +1.301548399799611e-01   +8.596404909733657e-02; -4.706885809613237e-01   +1.818433691439530e-01   -2.855156855318428e-01   +9.875563771978400e-02   -1.497220886149994e-01   +4.081609872088313e-01   -7.058269726281038e-01   -3.024649363368684e-01; -3.952376683423914e-02   -1.172900582980282e-01   -1.875110411245752e-01   +4.179925511659456e-01   -5.097144430117627e-02   +1.981439435098287e-01   +1.070093135560237e-01   -4.262293699190947e-02; -4.379901291024735e-01   -1.593041952127830e-02   -2.571410502970418e-01   -2.721413831902941e-01   +6.474975285404696e-01   +8.356679614624886e-02   -2.738076512015081e-01   -6.198747934505729e-01; +3.011272647729206e-01   +3.176821042628426e-01   -1.175673137295758e-01   +3.688120008053539e-01   +4.343356900989189e-01   +2.325348993071823e-01   -1.797343151100002e-02   +2.203829017504735e-01];
L1I_L2I_iGABA_netcon = [+3.589077911845546e-01   -2.483188823037163e-01   -9.532728935824117e-02   -2.826180652228425e-01   +3.568454034095364e-01   -3.322947608798120e-01   +3.427111983715124e-01   +2.887040505024769e-01   +3.815274463167962e-01   +8.272235594723014e-02   -2.983811871411390e-01   -5.919251067589782e-01   +2.586913516878430e-01   -6.373440797529559e-01   +2.115174124039143e-01   +5.554290527333597e-02; -1.846309763749334e-01   +1.532069590358388e-01   +9.241914573762412e-02   -1.984215756164692e-01   +2.055438041983393e-01   +3.362316019470736e-01   +3.832187577551355e-01   -3.866260346991103e-02   -1.545844200611342e-01   +9.067279038905636e-02   -1.239113490003537e-01   +2.917945683983187e-01   +1.899757999860357e-01   -1.393815489414616e-01   -4.132252605102778e-01   +5.528775199608844e-02; -3.319106851659945e-01   +4.030904877563660e-01   -3.648060366989832e-01   -3.323135984941644e-02   +3.011482593169670e-01   +3.949844259422553e-02   -1.039447039447536e-01   -3.507915613099081e-01   +3.062135568301838e-01   +3.210479983258372e-01   +2.737961045520977e-01   +1.507954406833430e-01   +4.252786512439933e-01   +1.000854721472013e-01   -1.070632082611369e-01   -2.511417484813107e-01; -9.666705023953598e-02   -1.810478627860470e-01   +2.488943100883136e-01   -1.924754414250202e-01   +1.821309428642791e-01   +2.144112899656087e-01   +2.833812740711675e-02   -3.882489463670599e-01   -1.175110236404955e-01   +3.826738830259241e-02   +3.879011712324422e-01   +1.848701530604862e-01   +5.693072337012111e-01   -4.911279865871623e-01   -1.104860390030025e-01   -5.976373649734401e-01; +6.605998682263797e-01   +1.665294082583479e-02   +1.128341413522727e-01   +3.180557860490870e-01   +2.921136098735246e-01   +4.174567561041653e-01   +9.467493579960874e-02   -3.986899319843665e-01   -7.505695563388187e-01   -7.165214210363423e-01   -4.433990414100893e-01   +3.534975222236683e-01   -6.718956651165994e-02   -4.043011147040019e-01   +5.021300848178584e-02   +2.868798317805207e-01; +4.846223523114068e-02   -1.728840050252160e-01   +2.344402524227556e-01   +3.577190423123970e-01   -1.323465414222954e-02   +1.249270061307784e-01   +5.968779695088146e-01   -2.075607279520351e-01   +1.427739990373570e-01   +8.997134151606602e-01   +8.142908688809389e-03   +5.362132318173965e-02   -6.253266343190611e-01   +2.092294880990837e-01   -1.425933450093991e-01   -2.980409721397617e-01; -2.373323104473853e-01   +6.989616509074562e-02   +3.286621130649258e-01   -4.650352115853876e-01   -7.959231119883708e-02   +2.740525566251087e-01   +8.073745035250038e-02   +4.291400939763985e-01   -5.232055052072574e-01   +7.553548727471062e-01   -4.192339888294123e-02   +2.739664461528872e-01   -4.322286669461065e-02   +3.206871125741228e-01   +5.485459519984502e-02   +3.403217893999181e-01; -4.690670999712190e-01   -3.161793974712079e-01   -4.756217536214413e-02   +3.239909543455548e-02   +1.998396664042185e-01   -2.095364239667389e-01   -2.728173692685822e-01   +2.350132880069913e-01   -1.440948002203845e-01   -1.218901031786967e-01   -2.814515034083598e-01   +1.262728330093079e-01   +1.344995528812646e-01   +1.916692920467474e-01   +2.690602167520702e-02   -3.542791024273848e-01];
L2E_L1E_iAMPA_netcon = [-4.320731375209536e-01   -2.357635477830665e-02   +1.027813462487913e-01   +1.313354263819958e-01   -1.922914950126065e-01   -2.939774038990211e-01   +4.760156034916661e-02   +5.009077796148319e-01; +9.892483477616558e-02   +6.623996491051778e-01   -1.213409508241228e-01   -4.893610372295070e-01   -1.409877577753550e-01   -2.114184834444797e-01   -6.205707142941062e-01   +5.213625594884076e-01; -4.726200589923868e-01   +6.072654292064911e-01   +2.568062830902664e-01   -6.920012281676638e-02   +1.665498432696287e-01   +1.204043863244467e-01   +6.317485151172947e-01   +5.338546059664339e-01; +3.732810950541880e-01   +3.260861723960028e-01   +8.551722890154571e-02   +2.064439022980160e-01   +2.955247928544814e-01   -7.132445583976597e-02   -1.414961465399503e-01   -2.227885370287638e-01; -1.825684185004173e-02   +3.150474700572991e-01   +3.514352572762053e-01   +2.130323347199609e-01   +7.970820862669961e-02   -4.277129966255442e-01   +6.716291115311260e-02   -3.766276786919863e-01; +3.937908412913189e-01   -7.354778503095561e-01   +2.052417126903240e-01   +2.952537909226069e-01   -2.218852454527897e-02   -1.711098281189148e-01   +5.288469134917587e-01   -1.518955900060232e-01; -1.238422877653367e-01   +3.424235248486286e-01   -2.149796634904444e-01   -3.690826433992972e-01   -3.699159584579730e-01   +1.766354747322826e-01   -6.612192110977182e-01   +1.713070325780296e-01; -2.173956148712759e-01   -2.581698281582038e-01   +1.428624339520443e-01   +3.813033211789731e-01   +1.961496871195942e-02   -1.705785351122950e-01   +3.447717968485975e-01   +7.542704564069821e-02; -4.211394229286388e-01   +1.360696529510057e-01   +5.958733775707552e-01   -5.232774565719984e-01   -2.117339810207338e-01   +1.580981323037612e-01   +5.053532330760068e-01   -2.214908334017907e-02; -2.118514021267897e-01   +7.590832103229622e-02   -6.914655326261946e-01   +3.087847153710133e-01   +2.967460021232403e-01   +1.199634893523570e-02   +2.457978253467421e-01   +1.215252885483619e-01; +3.207759896546890e-01   +3.623294702053166e-01   -1.094922632895916e-01   -7.190941663771319e-02   +1.168069059686130e-01   +3.081623016828399e-01   +1.962097510155708e-02   -3.609036289654487e-02; +4.843132748417509e-01   +3.051508102705949e-01   -4.133734244752316e-02   +2.433638341128624e-01   -1.391752499701398e-01   -2.740299928162573e-01   -7.524941680693137e-02   -6.674827318113746e-02; -7.248477003350228e-01   +3.672009337187847e-02   +2.801799815765061e-01   -1.890588715801553e-01   -3.152554267114802e-01   +6.607734804577721e-01   +1.538152171794651e-01   +5.579931503694045e-02; +1.437279649411292e-01   -6.775769922213648e-02   +1.854238845755523e-01   -4.451056510475255e-01   -2.987345230894318e-01   -1.210343448899099e-01   -4.700263670798822e-01   +5.640839848543954e-01; +2.436454615532914e-01   -2.284375425575998e-02   -5.253716093797925e-01   +1.669733396714577e-01   +5.988981542594795e-01   +5.681769098159057e-01   +4.126093936205952e-01   -1.829115027777538e-01; +4.028261785515881e-01   -1.440168770324285e-01   +7.675838315402624e-01   -4.153268265504866e-01   +2.862640809802166e-03   -6.154206434067313e-02   -7.506507399402079e-02   -3.062612981212482e-01];
L1E_L2E_iAMPA_netcon = [-2.671156223060506e-02   +4.365123001672210e-01   -7.350552538116854e-02   -4.079014189974869e-02   -4.201857678744673e-01   -3.452279761708684e-01   -4.572887163413903e-01   +3.162257793481660e-01   -2.874903525331043e-01   -3.017019710980067e-01   -3.631164146279065e-01   +4.858511362211413e-02   +1.257439507085191e-01   -1.944206213127834e-01   +6.470046594428598e-01   +2.110765962247841e-01; +9.711012215534381e-02   +4.768941554939779e-01   +2.795129775283923e-01   -1.436188988509764e-02   -9.212651999790086e-02   +2.717285109075275e-01   -5.880992045698085e-01   -1.048652301441909e-01   -4.653223911741047e-01   -9.770521749711557e-02   +6.987539277837471e-02   +1.680661213827761e-01   -3.509144090822407e-01   -6.193800262287632e-01   -1.704069398161087e-01   +7.124689421140647e-02; +2.253893325437935e-01   +9.077625116788208e-01   -4.630207403853023e-01   -3.258708067442139e-01   -3.684670626414202e-01   -1.668229341405412e-01   -1.652244568278043e-01   -2.619783795891980e-01   -2.882497869467137e-01   -2.188669907608733e-01   +3.921750902548659e-01   +1.371966180203940e-01   -3.282530810030106e-02   +7.941240889612808e-02   +2.937669760219541e-01   -1.665254542043192e-01; -4.860268418138595e-01   +4.048676042784934e-01   +5.734525278606710e-02   +4.816433854988014e-01   +3.136943217411821e-01   -4.289609855045864e-02   -2.057874408693264e-01   -3.968196038455782e-01   +1.323009530444650e-02   -7.287295328662624e-02   +3.844449413902301e-01   +4.440582630948271e-01   +5.536200523234402e-01   +1.877014431763424e-01   +3.333004980959263e-01   -4.707875636961025e-01; +3.867343080625026e-01   -2.642671177652391e-01   +5.042328088205766e-02   -4.432131094501322e-01   -8.595775412285436e-02   -3.281778045675213e-01   -2.766345828484973e-01   +5.057355185220058e-01   +4.169826290430487e-01   +2.832805379517246e-01   +3.008150901603836e-01   -1.675646611476671e-01   -6.562645881501656e-01   -1.446273429527606e-01   -3.363321438705424e-02   -2.437475287419880e-01; +1.578642467058555e-01   -6.177261185593572e-03   +7.070023444498216e-02   +3.585559919916061e-01   +3.745818988729291e-03   +4.143343858464609e-01   +1.399565984930607e-01   -2.458419298183044e-01   -1.758419142718009e-01   +2.254635081362468e-01   +4.135485225220498e-01   -1.859721545856290e-01   +4.186831982104959e-01   +3.970738108170174e-01   +2.715170579146647e-01   +3.310404042342910e-01; +2.929205764403833e-01   +2.930196232659506e-01   -1.165128138718797e-01   -9.659596971450021e-02   -1.081386896911576e-01   +3.217806272283894e-02   -1.919587892423005e-01   -5.931862668017818e-01   -3.790913952201879e-01   -3.404085541436314e-01   -1.101888724873627e-02   -4.230119636546020e-02   -3.386241208918255e-01   -1.953425832264021e-01   +1.349268502504435e-02   +1.275851543539277e-01; -2.040896192663262e-01   +5.346864661193328e-01   +4.358845989029697e-01   -3.001160317194279e-02   -4.198409705511958e-01   +7.286777684493164e-01   +4.476919234481386e-01   -3.138936939049337e-02   -4.955464950433786e-01   +2.719572973714717e-01   +1.751094935665627e-01   -1.593977296874032e-01   +3.480132757816898e-01   -9.623675208515151e-02   +1.872317544657910e-01   -6.022724695855541e-02];
L2I_L2E_iAMPA_netcon = [+2.685055673662371e-01   -2.997779962020494e-01   -2.942484759241492e-01   +3.027745281692006e-01   -5.018054358725549e-01   -3.631799441868570e-01   -4.159267405515116e-01   -1.594502160902502e-01; +4.392566845755873e-01   -1.273177780689289e-02   -5.204195893925131e-01   +5.141777230546810e-01   -2.246781350204110e-01   +2.153879724292236e-01   -9.615368124883951e-02   +2.814214955815484e-01; +5.736976374407630e-01   -1.157395986488225e-01   -2.811641767111652e-01   -3.822981400790398e-01   +2.909742856104142e-01   +1.212876345571925e-01   +2.457030223768212e-01   -4.704201340322389e-02; -9.565367696125764e-02   +5.865335681008058e-01   -3.608252404644010e-01   -2.372124701783579e-01   -4.111628409757901e-01   -4.180265660464278e-01   +7.733149334057106e-02   +3.365120265955826e-01; +4.908422496368353e-01   -1.206954161397040e-01   -6.296297753362656e-01   +8.049284520041842e-01   +4.191934097751993e-01   +4.611771709939980e-02   -4.666114825344469e-02   -9.918411271502432e-02; -4.147293211733061e-01   +9.810275001827698e-02   +6.261510399448680e-03   +2.928725268186495e-02   -2.419974692748579e-01   +4.701444252046801e-01   -4.272219921515944e-02   -4.693663076978752e-01; +2.592227252254500e-01   -2.078369221587973e-01   +2.557264699626891e-01   +6.223146159047512e-01   -4.185071735793715e-01   +1.846928734655422e-01   +4.633924935386374e-02   +2.398370987247170e-02; +6.340737535200527e-01   -3.544748335362100e-01   +1.667954551694823e-01   -9.814820120407727e-03   +1.776275963801158e-02   +1.503908183740558e-01   -7.147462333497441e-01   -4.067104161538183e-01];
L2E_L2I_iGABA_netcon = [-1.094922785203021e-01   -5.890630145603620e-01   +5.338023524858293e-01   +1.320106232248445e-01   +2.166814042405031e-01   +2.950524191345623e-01   +2.357404893899273e-01   -1.076582077188844e-01; -4.995254339299342e-02   +7.192090465392600e-01   -6.518586803493151e-02   -4.452207343675061e-01   -2.923210899750834e-01   +2.953298423705940e-02   +3.849503445287221e-02   +5.845382632735931e-02; +3.972914820676463e-01   -3.505141223179024e-02   +7.944126989383168e-01   -4.409008081843370e-01   -3.771478775479692e-01   -4.168422197116676e-01   -3.237318630537277e-02   +1.396891877024250e-02; -2.266704173389202e-01   -2.043642217158661e-01   +2.303696156226304e-02   -3.830844630001075e-01   +3.815151584183711e-01   -6.572442825053857e-01   -1.423604742020019e-01   +3.150131811644407e-01; +3.632359719842537e-01   +2.294275879196632e-01   -1.566696032876827e-01   +1.733894967843101e-01   -4.736192088301665e-01   -4.559848057096160e-01   -2.108562114742924e-01   -4.860026580824509e-02; -9.465942934496988e-02   +1.720365714294496e-02   +2.719314030353114e-01   +7.043569410673103e-01   +7.025613569464122e-01   +5.304066657725428e-02   -1.006081651461196e-01   -5.562576108092340e-01; -2.738428727024927e-01   +5.602364092537740e-01   -3.220595096729272e-01   +2.172789194638741e-01   -2.915210487180049e-01   -5.025938660030935e-01   +4.666048199204566e-01   +1.757946906778823e-01; -1.152669034096315e-01   -1.906579379684007e-01   -1.849343494654890e-02   -1.518682781106455e-01   +3.800767451523799e-01   +5.205539256636424e-02   -1.097430930620971e-01   -2.241500746092498e-01];
L3E_L2E_iAMPA_netcon = [+3.615137514199170e-02   +7.581908317094085e-03   +6.535939466118786e-02   +3.737478577432150e-01   +9.309219049365111e-02   -4.505019400101980e-01   -4.801381086374736e-01   +7.115523551975367e-02   +4.726102116493289e-02   +4.063655683378902e-01   -4.749263810633613e-01   -1.757411108274938e-01; +2.730518167592146e-01   -3.504066214119547e-01   +3.615611579337275e-01   -9.719495075356921e-02   +2.256255756228127e-01   -1.179268020367787e-01   -1.904963303653815e-01   -9.445316941184197e-02   +3.797309280070254e-01   -4.116262055053880e-01   -3.099017596414970e-01   +2.388001077999602e-01; +8.090399721211612e-02   -1.781267912830966e-01   +3.232992717000105e-02   -1.805704592448732e-01   +4.434839257074552e-01   +4.383836455977203e-02   -4.903196767217744e-02   +6.329462632325061e-01   +2.109163304772656e-01   +3.239425640189841e-01   -6.846778679800389e-02   -5.403041973202929e-01; +7.506399333201805e-02   -5.500545287041670e-01   -1.893227931949774e-01   +1.472213379894506e-02   +1.784657763235245e-01   +6.111412587825803e-02   -5.923725313304425e-02   +5.232030966575277e-01   -1.688723354910214e-02   +1.830415908560801e-01   -4.368201093753200e-02   -3.243875611182704e-01; +2.897301908247198e-02   +3.257206285718158e-01   +3.470015230502248e-01   +1.517698432556641e-01   -2.001608051463693e-01   +3.607434694236789e-01   +2.812006831481830e-01   -5.240915225837292e-02   -5.052843671795276e-01   -1.536830633896563e-01   +1.213707602209019e-01   -1.212812120538132e-01; +6.736435467674957e-02   +2.270617399234811e-01   -8.258097117759557e-02   +1.864759569729303e-01   +2.744320789087661e-01   +5.377225659708341e-01   -1.624616636899965e-01   +9.684230135620669e-02   -8.509074876541668e-02   -4.798746544329403e-01   +2.983276808440745e-01   -3.411096051118168e-01; -1.682208523791038e-01   +1.016342427933694e-01   +3.941644252274855e-02   -4.860173016000847e-01   -2.257314365794206e-01   -4.477907770019710e-01   +4.386752897668146e-02   -2.992559794186980e-01   +5.126096338759342e-02   -1.415554648595825e-01   -1.069619049761706e-01   +7.768927953017145e-01; +3.771070035893166e-01   +1.873340304969690e-01   +7.922512064325272e-02   -3.355455937205555e-01   +1.772976639189391e-01   +9.446544227580400e-02   +1.239117989069696e-01   -4.435061123351168e-02   -3.226629800576311e-02   -4.937189476759581e-02   -5.910718092032873e-02   +3.443197240187502e-01];
L3I_L2I_iGABA_netcon = [-5.102257234262400e-01   +9.198632389234503e-02   -1.528284783989788e-01   +8.371500810306784e-02   +2.542098170217142e-01   +6.904922429684655e-01   -2.738370571384282e-01   -6.072259797959996e-02   +3.648535447680200e-01   -1.570684012892440e-01   -5.829128751262303e-02   +2.681836537917219e-01; -4.399220101014087e-02   -8.388126373342444e-02   -2.849220041032517e-01   -1.347784525766306e-01   +2.754759419256627e-01   +3.440184942855483e-01   +7.604007545965118e-02   +4.457706082586661e-01   -2.383395086251385e-01   +1.346548245341303e-02   +5.636666579294777e-02   -1.442791457662500e-01; +2.202560896822340e-01   -2.268871705739060e-01   -1.011796417390234e-02   +1.185499856099375e-01   -2.891847112181116e-01   -8.482628038827772e-02   +1.319376029240272e-01   -2.261574840263393e-01   -9.374785604657918e-03   -2.120204247306733e-02   -1.606710883713038e-01   +2.406989673795164e-01; +4.033181175676732e-01   -8.415088660881234e-02   -2.219246483216608e-01   +6.879168803659443e-02   -3.288977546319277e-01   -6.091732673893185e-01   -7.710127780726424e-02   +1.217295061229154e-02   -2.913946493545067e-01   -2.750198858361316e-01   -2.555393819252054e-01   -5.684109735073148e-03; +3.057863275211768e-01   -9.750889914525949e-02   +2.377444579793035e-01   -6.071225215484830e-02   +1.401670613236064e-01   +4.397511930926423e-01   +9.239056174028744e-02   -4.358894419398891e-02   -3.358131580429566e-01   -3.534295157805045e-01   +5.907996075516332e-01   +7.720896859194113e-01; -1.356098604253133e-01   +8.179161488619833e-01   -1.252948479682202e-01   +4.277854141480182e-01   +1.494695865556840e-01   +2.669315742734717e-01   +4.227964507123227e-01   +2.658462676667174e-01   -3.487483575598906e-01   -3.337003512946385e-04   -3.172210440435203e-02   +4.131196525443468e-01; -1.508499923652460e-01   +6.569104116988742e-02   -4.056559453027026e-01   +2.276608632366550e-01   +1.268754904242569e-01   -3.006098326766388e-01   +1.944011647346297e-01   +3.945853428042361e-01   -1.004940815839964e-01   +4.285764331427089e-01   +8.554132850394641e-02   -2.403430138563664e-02; -4.115591026489923e-01   +1.391707986777892e-01   +9.886806789845246e-02   +9.342776474204190e-02   -2.480642324376830e-01   -3.184601380008630e-01   -1.619312144930534e-01   +1.604146985840453e-01   -1.805008437158927e-01   +6.151346923729202e-01   +2.734537893667091e-01   +1.068035188115083e-01];
L2E_L3E_iAMPA_netcon = [+4.117798334355673e-01   -1.374428778161866e-01   -4.328665113350442e-01   +3.323056382674751e-01   +2.701490354644624e-01   +2.332770475064280e-01   +7.034742787817766e-03   +1.332790741035605e-01; +3.656437660392295e-01   -8.565244314136938e-04   +2.715870990860917e-01   -1.783366904508186e-01   -7.147394080608631e-01   +2.636887268528462e-01   +1.078030165809996e-01   -2.443205775103371e-01; -5.497309378552540e-02   +1.356757898210056e-01   -6.190799370223959e-01   +3.016973013126845e-01   -1.021530865287851e-02   -3.142145565865223e-01   +3.488004529074655e-01   -2.553799940963088e-01; +3.548796166657150e-01   +6.577816230978425e-01   +3.198989340447316e-01   +1.090701823427026e-02   -2.827147426950946e-01   +5.416258656018855e-01   +2.843220847727537e-01   +1.610675425860039e-01; +6.038680963420034e-01   +5.398962154588431e-01   -3.967372516437940e-01   -2.781066798264716e-01   +2.612897797070590e-01   -2.946696569254878e-03   -4.439643852481674e-02   -4.943248658500696e-01; -9.138539309506928e-02   +1.571441515412945e-01   +8.818372189660378e-02   +4.790892239952980e-01   +1.208886946299705e-01   +3.262035464904160e-01   +1.631707373710302e-01   +1.564088987278499e-01; +3.726909940437558e-01   +5.078565183769698e-01   +3.653224335156528e-01   -2.449804667339716e-01   +6.436710063612486e-01   +4.141104735230077e-01   +1.918744770703022e-01   -3.252875136843193e-01; +1.245153603723326e-01   +3.723307227847031e-01   -9.559376422215625e-02   -1.122318222054849e-01   +2.209847043878146e-01   +1.919772724940887e-01   +2.878993088470729e-01   +1.712846602071574e-01; +3.589268697757106e-01   +1.422639170625168e-01   -5.255397947484273e-02   -5.888015014607966e-01   +2.536203202284089e-01   -2.573638221653304e-01   +1.808398015320358e-01   +3.688715114479353e-02; +3.032242088372195e-01   -2.773989352119928e-01   -3.306023994140785e-01   -1.916951494438131e-01   -2.524409739828072e-02   +1.167808682399038e-01   -1.660969941284784e-03   +3.969981593410792e-01; +2.647187462187147e-01   -1.277164567352561e-01   -7.105621342947999e-02   +2.267726325425196e-01   +2.816193596423602e-01   -3.449243400687961e-01   -9.751433190437074e-02   -4.918464877608313e-01; +7.396759285990759e-02   +5.292676417037023e-01   +5.201061912178437e-02   -4.772983263556338e-02   -2.381519583776178e-01   +3.949872374704525e-01   -8.649700796361683e-02   -5.106608520334772e-01];
L2I_L3I_iGABA_netcon = [+4.642571899479127e-02   +7.935838684070091e-01   -4.384454062889852e-01   -2.997614195650885e-01   +4.531236699960259e-01   -2.930702065463574e-02   +2.642867955727111e-01   +2.450897538241720e-02; -3.003129064959846e-01   +2.554867916248108e-01   +6.522341561188087e-02   +1.660362677435559e-01   +7.947518853240800e-01   +6.453464996483953e-02   +3.545858585698901e-01   -2.391440024216598e-01; -1.354902347500927e-01   -3.506259794933712e-01   -2.295787391919908e-01   -9.623511138926528e-02   +2.398599649944241e-01   +5.898629821965633e-02   -5.918117007818076e-01   +2.948436042133907e-01; +3.642361947897094e-02   +5.565942574799249e-01   -1.178107974934505e-01   +2.513386457762641e-01   -6.350909623964125e-02   +4.487800219977882e-01   -4.120443573500972e-01   -1.375408710776853e-01; -3.143152385682158e-02   -1.206794838511993e-01   -1.291895586873642e-01   +2.385205090159447e-02   -4.138253213068254e-01   +2.200052502220450e-01   +1.831100507880281e-01   +3.351988990333526e-01; -7.825344123628831e-01   +9.147738509986961e-02   +3.822292893073617e-01   +3.825504841210762e-01   -3.452228552289035e-01   -2.389417169854778e-01   +2.311802995287053e-01   +3.203290486843617e-01; +1.552026714724961e-01   -1.865380349366380e-01   -4.868864197685697e-01   +2.014104108340859e-01   +5.253106979763177e-01   -2.743001413469079e-01   +1.042062056764364e-01   +2.815097320005053e-01; +4.856565932167990e-02   -3.383888504215838e-01   -6.235253602534377e-01   +4.005706056929271e-01   +1.996112950551253e-01   +6.467132693814389e-01   +4.116284252783433e-01   -4.998789853236825e-02; +2.229431933471485e-03   +3.922758683322321e-02   +1.919914254784499e-01   -1.918056051710626e-01   -5.159348913545713e-01   +2.805246570569708e-01   +3.683037760590298e-01   +1.146979837140184e-02; -2.404010296377804e-01   +2.028327138507554e-01   +1.970017029520117e-01   +1.020580327523774e-01   -6.040635040949918e-01   +2.578551968322598e-01   -2.982556208361707e-01   +2.154085058693790e-01; -3.276445338179521e-01   -3.827324319808240e-01   +3.450342534871231e-01   -3.765398477043018e-01   +2.610485377700103e-01   +6.171218245814881e-01   +1.604603890471486e-01   -1.490022702228240e-01; -4.352525051206877e-01   +1.769514016313231e-01   -7.727653919430871e-02   -5.567092699228647e-01   +1.766265538570267e-01   -4.349658912719498e-01   +2.169678530745306e-01   -4.194572999229401e-01];
L3I_L3E_iAMPA_netcon = [+3.479045696581562e-02   +1.381915053793381e-01   +2.200577726345982e-01   -3.051489974008879e-01   +8.828830167476437e-02   +1.144677496679321e-01   -1.984022035885198e-01   +1.697103137924328e-01   -4.711713905196099e-01   -5.844600689439788e-03   -4.664517172403254e-01   +6.702692446285187e-02; -5.095235471366467e-01   +6.296257849925359e-02   -2.630294713408103e-01   -1.207513414080841e-02   -9.836467240864323e-02   -4.680812977318269e-01   +5.126397748982909e-01   +7.524750682125881e-01   -1.576611913515939e-01   -2.057433638134727e-01   -4.670229073681598e-01   +4.095094054258134e-01; +1.592435714162657e-01   +1.108008864345747e-01   +4.827199353933418e-01   +2.860060027396981e-01   -2.696332940118780e-01   -4.818315554617690e-01   -4.510113189371074e-01   +5.145678406154673e-01   +2.370959379579085e-01   -1.556970923438032e-01   -2.352643534209252e-01   -2.223882466372976e-01; +5.678990219639867e-01   -2.591049905110781e-01   +4.242827747862172e-01   -3.003706470044006e-01   +1.345979444409205e-01   +2.732241483244077e-01   -2.461941439818726e-01   +2.351543954371414e-01   -1.447107851471733e-01   -4.185273242480629e-01   -6.334385614396607e-02   -8.090927844199053e-02; +1.426738937069100e-01   -3.050556032566948e-01   -1.328389117882565e-02   +3.444567473262302e-01   -5.598559643301091e-02   -3.127661779232756e-01   -4.524616830349907e-01   -3.736150617331330e-01   +1.901587317206410e-01   +4.273066192955473e-01   +1.029716525815963e-01   +1.799907891369699e-02; +2.217313389293685e-01   -5.413388748292588e-01   -1.578774048779586e-01   -1.596813433456049e-01   -3.101010662710918e-01   -3.579502192809959e-02   +6.184429431244037e-01   -7.383908748548007e-02   -2.249451568166247e-02   +2.902191047356197e-01   -1.908741937367444e-01   +2.122378397448241e-01; +1.125540679983347e-01   +5.427254711846504e-01   +5.095106027627033e-01   +8.756621186801883e-02   +2.808221635789147e-01   -4.594407641883131e-01   -3.034490675498170e-01   -1.533511849541744e-01   +3.502544838838433e-01   +1.167585137754620e-01   +7.506532047032555e-01   +2.060480648047220e-01; -3.451002105579037e-01   +6.695495577266738e-01   +1.455383074292148e-01   -2.436465731859547e-01   -2.847857684785977e-02   -3.002707169832501e-01   -1.165754743446415e-01   -8.507859330422377e-02   +1.614797827569412e-01   +2.271686206427525e-01   -3.898546753892928e-01   +1.525704660917853e-01; +3.852542500464988e-01   -3.698863027301427e-01   -2.941211764067011e-01   -2.152781361489322e-01   -3.456922145256358e-02   -3.705605209281475e-01   +6.133756701381672e-01   +7.197241846287655e-01   +8.341987838486410e-02   -6.297154291917513e-01   -8.631896660392803e-02   +1.469274598258235e-01; -3.672578229871190e-01   +3.312212274746902e-01   +2.353631317610164e-01   +4.219464817680951e-01   -1.751750159440098e-01   -2.080383743668898e-01   -8.438311298709013e-02   -1.426405960190195e-01   +5.811347757901507e-01   -2.343372146712570e-02   +5.585046156257092e-01   -7.195082627755702e-01; -3.923469642059164e-01   -1.302714799895621e-01   +3.656063761190467e-01   -3.597549853201130e-01   -2.885152654265201e-01   +2.591928437797882e-01   -7.006781398521024e-01   -1.583504345778736e-01   +3.968146642447759e-01   -1.224289243265027e-01   +3.021400613928402e-03   +5.071945942357131e-01; -2.793980900462235e-01   -2.796319554984557e-01   -3.054819784551412e-02   +1.496105409535688e-01   -1.428261703264289e-01   +1.964166522317765e-01   +4.231549757773753e-01   -1.628135070488876e-01   -5.087353454724818e-01   +6.580803727255088e-01   -1.791889718202361e-01   +2.471097953221257e-01];
L3E_L3I_iGABA_netcon = [-7.194085954706858e-01   -4.037471138806256e-01   +1.987865648350899e-01   +2.768563064939888e-01   +7.826528338349165e-01   -7.786403694676410e-02   -3.906899475464051e-02   -4.978022039146198e-01   +8.349393471190771e-01   -1.339389554339203e-01   -2.396582379679285e-01   -3.970720864184872e-01; -2.158887552719085e-02   -3.427617142830653e-01   +6.502443929192021e-02   +2.567913741284918e-01   -1.700884476619847e-01   -6.535397596568632e-02   -4.253268795795199e-02   +3.324301382858599e-01   -3.219318989971752e-01   -4.705929136120754e-01   -8.812125805452052e-02   +3.175172015695036e-01; +3.732317547997216e-02   -8.029818982647512e-02   +3.731473791543247e-01   -1.424705782797277e-01   -1.479037446934228e-01   +5.962945748536499e-02   -3.934239227605835e-01   -1.059682940087124e-01   -1.022965273892857e-01   -4.374732391451686e-01   -1.257312708422868e-01   -2.468037519997396e-01; -3.926380902338112e-01   +1.848538370923999e-01   +2.619977154115177e-01   -3.995675935672516e-01   -1.231577787772026e-01   -5.234727857519241e-01   -1.479141857397269e-01   +4.587145901213188e-01   +1.810781628690977e-01   -5.891919903311044e-01   +9.567976919730359e-02   -1.900149385586651e-01; -7.457015000018630e-02   -2.008684254355000e-01   +1.875720376243755e-01   +4.018981726966036e-01   +2.946295888483992e-01   +1.490557525838855e-01   -4.462532518607822e-01   -6.833974943548146e-01   -7.349960355714330e-02   +1.476550472325376e-01   -2.460773069488422e-01   -1.016937280888489e-01; -7.919190972930484e-02   +8.337653959864383e-04   +3.824692350336646e-01   +1.133890715948284e-01   -3.374667144260348e-01   -4.968643488855856e-01   -2.158603614251261e-01   -4.529495244839419e-01   -1.000259437765207e-01   +3.302028211351869e-01   +3.910587980326309e-01   +2.022787562057244e-01; -9.813535955493669e-02   +1.709808294154437e-01   -4.027615320687323e-01   -3.080644272943888e-01   +2.721129437622605e-01   -2.752554398170218e-01   +3.386419232840034e-01   +7.202265601419999e-01   -3.433593950130521e-01   -4.173074741125157e-01   -5.740298883186310e-02   +1.232040612683774e-01; +7.944815567280195e-02   -3.000760373710065e-01   +1.690135013339422e-01   -4.965046342976164e-01   -5.448310321234844e-02   -2.904733949481859e-02   +1.022723411025344e-01   +2.187826104076095e-01   -4.218958121761873e-01   +6.066949490061213e-02   +1.516275086142861e-01   +1.061507339396817e-01; +3.687073597431992e-01   -1.208624442327388e-01   -7.552009859966778e-02   +4.907964327226229e-01   +2.462635227575576e-01   +1.944160141077197e-01   +9.189897999928025e-02   +4.188625969671884e-01   -1.672809859754890e-01   -1.270091539229663e-01   -7.234204682763781e-02   +1.845828129162169e-01; -4.253790294359635e-01   -7.899477531057575e-02   +1.500244677989950e-01   +4.592603087108525e-01   -3.095517693772541e-01   +2.842946426916331e-01   -7.508063045288975e-02   -3.687567385828901e-02   -1.539017731035339e-01   -3.213396004741356e-02   +1.437689311379791e-01   -7.203825588512131e-01; -2.993942320821339e-01   +9.046249702150115e-02   -9.600066620616798e-02   -1.551456803230626e-01   -2.410041298184548e-01   -3.091553347291494e-01   +1.724472629531471e-01   +7.755102127055368e-01   +3.998952710128059e-01   +3.787339799424930e-01   -7.126086024228734e-02   +3.661119361317377e-01; +1.900669511483792e-01   +1.331366844382910e-01   -1.542341882417230e-01   +1.204740116882808e-01   +6.079408283086898e-02   -6.838861948902959e-02   -3.840735830755149e-01   +1.214273770532855e-01   +5.250288734954374e-01   +5.741406195787673e-01   -2.971181907513728e-01   +2.352518000866106e-01];
L2E_Input1_iAMPA_netcon = [+2.644343241646776e-01   -5.878744049786591e-01   -5.485620472971916e-01   +6.888070946746225e-01   -6.311185678407524e-01   +5.517748847091981e-01   +6.384907993798820e-01   -5.999503551994098e-01];
L2I_Input2_iAMPA_netcon = [-3.811418352536160e-01   +2.739413628326398e-01   +3.579587451759078e-01   -3.161752097608029e-01   +1.719135682411417e-02   +7.923542032773315e-01   +2.100095182830113e-01   +2.724659968330223e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.4*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 1.0*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 1.0*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.4*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 1.0*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 1.0*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
