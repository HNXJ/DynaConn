function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+3.727739859027225e-01   +7.422514804478768e-01   +8.970146508193754e-01   +1.885297214107518e-01   +2.331371783168858e-01   +6.870177590628042e-01   -5.182815466087509e-02   +3.685170980524786e-01   +2.381815309103070e-01   +2.033748295307221e-01   +3.814659814861037e-01   +1.766116681984393e-01   +5.002150789580210e-01   +2.843740076635861e-01   +2.461261406634409e-01   +1.288167244984538e-02; +7.676337746314130e-02   +8.981285680211576e-01   +8.407345682453680e-01   +7.339871470678254e-01   +3.169079151876324e-01   +6.953641030818765e-01   +7.111429708519583e-01   +1.606169892870610e-01   +1.511718566272220e-01   +7.436270108303563e-01   +5.545347622436798e-01   +6.352141339482374e-01   +4.384777621106807e-01   +2.563960816881652e-01   +6.618528967969438e-01   +2.474730588688655e-01; +2.166912571890601e-01   +3.337255119285452e-01   +4.036044802440727e-01   +5.210317586862900e-01   +6.087093955984250e-01   +4.272018624020754e-01   +3.327981666773286e-03   +6.417609496845169e-01   +3.006380314824636e-01   +5.115098892244556e-01   +7.675376399091488e-01   +2.317066789293870e-01   +4.081392912759404e-01   +2.491991710038410e-03   +3.117885724066300e-01   +9.475089327249431e-01; +2.004406768024391e-01   +6.462680714373228e-01   +8.651951629486736e-02   +2.793098384311626e-01   +8.328636332876498e-01   +7.827700567361147e-01   +1.936537470644271e-01   +5.660179384597790e-01   +7.116868524556591e-01   +4.618468377865875e-02   +2.081795552232193e-01   +8.247233608339680e-01   +5.168125442131770e-01   +2.089060212094321e-01   +5.636976100889677e-01   +4.705907001315305e-01; +8.105092826180969e-02   +7.228064639880570e-01   +7.927713941443895e-01   +7.614558395573922e-01   +4.839092110638519e-01   +3.317646360145176e-01   +4.868039712942585e-01   +3.067463524938622e-01   +3.051939951607661e-01   +4.780954401357337e-01   +1.853173362684642e-01   +6.593588522176741e-01   +3.888885172221004e-01   +7.754340391817426e-01   +2.286999003828215e-01   +8.530330651477896e-01; +1.197109438670054e-01   +1.834869810355765e-01   +6.836561022982127e-01   +7.567739864849465e-01   +5.741460863172426e-01   +8.644281952676498e-01   +2.850891113254399e-01   +4.256972483040286e-01   +8.707649390835634e-01   +8.996427751028673e-01   +8.519539740316584e-01   +1.885217225033404e-01   +4.220018865943359e-01   +1.499226257723453e-01   +8.475466866978679e-01   +3.767160794604854e-01; +3.228933107993120e-01   +7.158292563116957e-01   +6.303737242152287e-02   +3.590866813141017e-01   +8.000494125240476e-01   +5.165607103098968e-01   +4.233342118707303e-01   +5.651016312923736e-01   +8.969196836446595e-01   +9.131803410615795e-01   +6.732346011807828e-01   +9.473929898746801e-02   +3.215354003684874e-01   +3.585502052771240e-01   +6.658403462260210e-01   +8.573292387764564e-01; +6.695713555881456e-01   +7.160372120035848e-01   +7.263210492453550e-01   +3.138245566627083e-01   +6.251146470339091e-01   +5.194482092311695e-01   +6.293929199757844e-02   +3.793967111156132e-01   +1.000000000000000e+00   +8.343100740841395e-01   +3.220477652671212e-02   +7.085514359478530e-01   +7.668806957945402e-01   +5.581362407919955e-01   +2.896266710453773e-01   +8.191638262785691e-01; +4.916596514163011e-01   +7.236180830577042e-02   +2.441658270682847e-01   +3.294844801441699e-02   +4.436644651338136e-01   +1.697959662366742e-01   +4.634951876027792e-02   +5.751701759798976e-01   +4.684905815720902e-01   +7.396657529315708e-01   +7.421397406276005e-01   +5.101528757556080e-01   +2.653617916111806e-01   +1.724871079870009e-01   +9.445536377251735e-01   +7.576305331510371e-01; +6.271872576639641e-01   +5.345562523682504e-01   +5.608094126814426e-01   +2.297402217533150e-01   +4.207720298881331e-01   +3.261659543127488e-01   +4.466744249231958e-02   +2.322621889212217e-01   +9.926104675874954e-02   +7.614247715418844e-01   +1.236850762730844e-03   +9.289506936006871e-02   +3.251624087122281e-01   +7.334902407293805e-01   +3.198314561730280e-01   +7.381644817215103e-01; +3.830957881971628e-01   +4.302795352696207e-02   +8.677325672601153e-03   +1.657828325169735e-01   +8.914447949576745e-01   +5.700090424240526e-01   +2.390150689190859e-01   +2.022408842948307e-01   +2.231389543907008e-01   +8.472290479355108e-01   +1.224078301785517e-01   +7.338627936177839e-01   +5.148234082115990e-01   +7.865364482831002e-01   -3.551139792763929e-03   +1.016056245718726e-01; +1.413955813491818e-01   +4.839531786345998e-02   +8.968629055752453e-01   +4.450717954536311e-01   +6.468108789292702e-01   +5.182561086457087e-01   +6.763723385711409e-01   +3.579396477010009e-01   +6.519669565088982e-01   +1.243978591698003e-01   +2.862373474101285e-01   +7.606938365237211e-01   +5.089628363393399e-02   +5.049805757054036e-01   +3.963907596560275e-01   +9.651193686949355e-02; +4.266215779881953e-01   +3.200234836039836e-01   +6.331743742707703e-01   +2.121692301678038e-01   +1.010794495370522e-01   +4.498351045472918e-01   +4.166929471516646e-01   +7.135094393245942e-01   +2.988890084696320e-01   +8.793119942074858e-01   +1.470807699986725e-01   +4.215453808925199e-01   +2.117135163120894e-01   +2.089602548986279e-01   +2.904361429162857e-01   +2.145024334069488e-01; +1.449499258307876e-01   +8.619116795834223e-01   +7.100566407257859e-01   +6.941403740799024e-01   +7.457588779545791e-01   +5.611514517127383e-01   +2.529948029863898e-01   +7.529623100299569e-01   +3.583800455387989e-01   +4.511875617243152e-01   +8.620764715332164e-01   +6.191255420559322e-01   +5.556264259608248e-01   +5.376599573501634e-01   +1.227645506746033e-01   +3.614180263733531e-01; +1.129116080054109e-01   +1.780207503703877e-01   +8.824474999385994e-02   +3.568138287965878e-01   +3.712146159732541e-01   +5.786704411521206e-02   +6.510678469244149e-01   +2.818415610892437e-01   +8.107284440839631e-01   +5.023096186365471e-01   +1.215288621733722e-01   +7.807592181729797e-01   +6.190126039418463e-01   +1.798539269267653e-01   +6.914621917248722e-01   +1.479565823751630e-01; +5.589932642133932e-01   +2.295482760573064e-01   +3.062591075541380e-01   +6.037035196974192e-01   +5.319804457265858e-01   +5.382261421129543e-01   +2.345659225133835e-01   +8.884481646239109e-02   +5.569310226221381e-01   +4.629005427333827e-01   -6.755718478583393e-02   +3.545505581141099e-01   +2.200370725360037e-01   +8.900141253592254e-01   +8.905301930915200e-01   -2.543879158928153e-02];
L1E_L1I_iGABA_netcon = [-3.938503841072107e-02   +2.636304054733702e-01   +8.872351572933995e-01   +2.078742449729681e-01   +4.146316513642651e-01   +1.014758464163511e-01   +2.635998360567897e-01   +4.968268185167005e-02   +2.134926361998697e-01   +3.839851140127681e-02   +3.780529739128300e-01   +9.174867633732833e-01   +1.986035581402997e-01   +7.672115305982382e-01   +7.810744592745757e-02   +3.885735444950798e-01; +7.540823161812070e-01   +7.356587020932726e-01   +5.280602023289430e-01   +8.281657882188643e-01   +6.911201424134666e-01   +8.244490152447720e-01   +6.002869513569555e-01   +7.958596023142952e-01   +8.752166877549129e-01   +9.380737540492596e-01   +1.437602496787530e-01   +1.384411016886278e-01   +5.996181077010686e-01   +9.364876125493394e-01   +1.000000000000000e+00   +2.828132644607506e-01; +3.004393144779276e-01   +7.955224022665587e-01   +9.919409529629947e-02   +1.294812657838802e-01   +9.261065199119155e-02   +2.296265226762450e-01   +5.745218103739078e-01   -2.063476899911966e-03   -1.363274227232753e-02   +1.028135612304143e-01   +5.118041503647012e-01   +3.835214523588257e-01   +7.682851903034261e-01   +7.974184732256703e-01   +7.984718805434033e-01   +7.685235814470479e-01; +3.726142919772201e-01   +5.434825532356417e-01   +5.575434037385195e-01   +7.390440595304267e-01   +6.593608767829596e-01   +5.901846798560814e-01   +5.256344994042523e-01   +8.785608602917722e-01   +8.916755259490737e-02   +2.933987444524147e-01   +5.346827458136173e-01   +2.562935118897808e-01   +8.178911667426078e-01   +3.933966886962507e-01   +9.115173503005991e-01   +5.004766042638735e-01; +6.682790803611315e-01   +5.730774148437633e-01   +8.304635040719114e-01   +3.790837067899295e-01   +9.075571849496936e-01   +5.292642384657663e-01   +3.432254774289218e-01   +4.501803928047070e-01   +3.146369167033193e-01   +3.783452543784054e-02   +4.072502929660229e-02   +5.757987489781446e-01   +9.334520020024231e-01   +8.015752318713060e-01   +4.159810021656493e-02   +1.382574139531551e-01; +2.130870638851634e-01   +4.096099865781740e-03   +3.361416199292456e-01   +2.060098454630721e-01   +4.875929416875684e-02   +4.760000113342943e-01   +8.414798807515284e-01   +3.063475782417943e-01   +5.324499593553442e-01   +4.217530081683065e-01   +8.807843294076115e-01   +1.738251552528517e-01   +2.436447242297334e-01   +1.954931493224772e-01   +6.971238830241686e-01   +3.725284955021178e-01; +6.857798605587860e-01   +5.288943459278381e-01   +3.237010051850573e-01   +7.894556150368351e-01   +2.798995399697982e-01   +8.180775395566940e-01   +5.971605801020314e-01   +5.246934845192909e-01   +7.954385844332802e-01   +6.241570769867201e-01   +8.290424587072687e-01   +2.435827836214611e-01   +8.118794001054669e-01   +5.685978088576864e-01   +9.386577750893744e-01   +7.257842920469350e-01; +9.368665934047007e-01   +1.333172558455037e-01   +5.815420851884884e-01   +4.803066015675133e-01   +6.752793040694330e-01   +1.718491823927529e-01   +3.472223407492499e-01   +5.793143877874626e-01   +2.177248990119535e-01   +8.291232513878382e-01   +7.533578565483157e-01   +8.583420113663554e-01   +2.490810334029660e-01   +7.088294109731007e-01   +4.804095754031351e-01   +5.789082660464199e-01; +5.120338512166640e-01   +9.018152106653864e-01   +3.928243228216831e-01   +9.365022108141503e-01   +2.483657780973472e-01   +6.749424203851558e-01   +5.378085023017507e-01   +9.317264958405783e-01   +8.652383589551614e-01   +6.300759527157858e-02   +1.883487259008503e-01   +1.955111259713362e-01   +8.351049788528575e-01   +6.080303087993722e-02   +6.658618927553221e-02   +4.732901203321314e-01; +2.329555929720733e-01   +3.482803491091663e-01   +5.605246981242424e-01   +2.453659573225707e-01   +8.504194572054778e-01   +4.243985011631991e-01   +2.791084381745446e-01   +8.552251220650765e-01   +9.152473091786023e-01   +8.311564372479957e-01   +7.938296927320285e-01   +9.306856464253266e-01   +5.212944992315827e-01   +3.739777408846697e-01   +3.296816502267571e-01   +7.780930623153127e-01; +1.417278582957131e-01   +2.143879744192825e-01   +7.528496865534969e-01   +8.721276883373252e-01   +1.673954768530277e-01   +6.250225056058428e-01   +8.229287545920159e-02   +4.801725322947797e-01   +4.004754629357590e-01   +6.277017130681461e-01   +3.305430067842906e-01   +8.855466964894751e-01   +9.432637136709510e-02   +4.920527753656606e-01   +4.270032186802876e-01   +4.425092580435062e-01; +1.780540959208590e-01   +9.226049792400142e-01   +7.415762693579676e-01   +4.794155454707215e-01   +4.502876072223367e-01   +5.115396346672286e-02   +2.067335943951940e-01   +3.675685215908453e-01   +1.445208094201282e-01   +5.124312773498906e-01   +1.989559158036588e-01   +4.130035773690728e-01   +3.784234410772189e-01   +8.984799436144781e-01   +4.526055441952334e-02   +4.896511201995077e-01; +9.101928056058772e-01   +1.709089119025117e-01   +4.513919456555763e-01   +5.364204489450677e-01   +6.096609607848524e-01   +5.874106486572155e-01   +2.260063048801388e-01   +4.751919993017367e-01   +4.384785656536910e-01   +3.479425272718371e-01   +9.430373155669813e-01   +9.614306858198554e-01   +8.113637302081752e-01   +5.882662890260788e-01   +2.808745298858581e-01   +7.703554561002932e-01; +4.450239490644441e-01   +8.250545896554258e-01   +3.212859256106754e-01   +4.201450772486306e-01   +7.329284482775611e-01   +1.780053499728733e-01   +3.190966321638780e-01   +5.684479919058018e-01   +3.535759696917294e-01   +4.530995369082325e-01   +1.824449618896643e-01   +1.723897222460437e-01   +2.799357806267418e-01   +2.656903143183779e-01   +5.625954013836046e-01   +8.831377677463365e-01; +5.824097716287580e-01   +5.958903345882400e-01   +7.079262994472542e-01   +6.924773450921243e-01   +7.217534550571315e-01   +8.131804086463168e-02   +8.009561841093904e-01   +2.921870773394412e-01   +8.229719087527255e-01   +4.694706639825815e-01   +7.129353991732408e-01   +5.359655510822129e-01   +2.913544047739859e-01   +4.902916197975762e-01   +8.714047411668092e-01   +4.615009240529540e-01; +3.786560017327987e-01   +5.905098692952816e-01   +6.396425084943888e-01   +2.139100058414230e-01   +4.608489906366885e-01   +2.909690718304428e-01   +5.185156573363285e-01   +2.266314933704782e-01   +7.915950903944547e-01   +3.167377227657038e-01   +2.789455126056114e-01   +1.087982460339363e-01   +5.331793088310331e-02   +4.726481541117122e-01   +9.135068897666653e-01   +9.254777289524518e-01];
L2I_L1I_iGABA_netcon = [+6.658455970623006e-01   +4.698382684485685e-01   +7.537198996181106e-01   +5.596718314992257e-01   +9.313398009763967e-01   +6.751194861941906e-01   +9.086025068134810e-01   +7.370258541089272e-02; +4.954910572332229e-01   +1.122343470886129e-01   +2.197778435563442e-01   +9.460304402915606e-01   +1.583145450107020e-01   +7.471421874210639e-02   +8.365944697644965e-01   +6.862950090817450e-01; +1.000000000000000e+00   +5.121653365383809e-01   +6.307528723290095e-01   +6.594807904494130e-01   +7.673266459560728e-01   +6.772939368520547e-01   +3.002687935398512e-01   +2.333160327831203e-01; +3.182742040588272e-01   +1.469918815972484e-01   +8.874571732538423e-01   +4.175132434609178e-01   +7.415114587062110e-01   +3.213570495138259e-01   +9.069337233019870e-01   +2.005506659911872e-01; +6.869714542734041e-01   +4.865790122664179e-01   +6.424032679839718e-01   +2.640758100442189e-01   +8.980644372220837e-01   +3.409174749213157e-01   +5.253870379996326e-01   +2.152272773984894e-01; +5.921879362556518e-01   +5.795176893978422e-01   +7.552366956047214e-01   +1.873557007218865e-01   +2.059032605477907e-01   +8.141685934519221e-01   +8.866331518227698e-01   +5.615447805993301e-01; +8.630229840906150e-01   +4.598297916437662e-01   +2.242634445189099e-01   +2.750354475748018e-01   +7.384130787415581e-01   +1.728129645852563e-01   +6.428221467115689e-01   +3.246972724331536e-01; +9.866969179902543e-01   +3.999782181867215e-01   +6.251824210647494e-01   +8.975277647913823e-01   +1.216058624999039e-01   +4.117927983400321e-01   +4.469040829430275e-01   +2.395132833925347e-01; +7.310102142159964e-01   +1.590179616744505e-01   +4.754155732661053e-01   +3.989159793561537e-02   +7.547622903280672e-01   +3.827614713101237e-01   +7.400838525214597e-01   +6.998431310171211e-01; +4.610059005374453e-01   +8.237017437367208e-01   +6.378686629380095e-01   +8.095073769770446e-01   +3.923328602982518e-01   +8.567580160068264e-01   +8.595676729775257e-01   +2.573932583446912e-01; +5.352201420379009e-01   +6.068682940341072e-01   +4.894734733214924e-01   +3.749987507940891e-01   +4.625311886547562e-02   +8.718581658069137e-01   +6.327174840186686e-01   +4.183729290332960e-01; +3.302412908812066e-02   +3.964226432025490e-01   +3.659832401666980e-01   +4.275168479596607e-01   +3.607729338142117e-01   +5.178883502375876e-01   +2.667774937081425e-01   +5.373699322892382e-01; +3.796108661015294e-01   +1.616117583797956e-01   +6.427583953448992e-01   +7.361888581143174e-01   +1.961550817310720e-01   +6.763749378815761e-01   +3.472428634847765e-01   +7.082880354549541e-01; +4.991201426696816e-01   +4.681905275671417e-01   +6.537073257320324e-01   +3.528804285559137e-01   +8.217218724443943e-01   +4.015245154132138e-01   +3.409972042022074e-01   +3.173431077975478e-01; +5.593294731292257e-01   +1.898958403284987e-01   +2.296979934104757e-01   +2.287392222095981e-01   +6.051371470500621e-01   +5.515740717626818e-01   +2.623434090370341e-01   +7.258152170686119e-01; +7.702116403566458e-01   +6.128706612179531e-02   +6.873820314988973e-01   +3.126342114069425e-01   +3.899281758845968e-01   +5.758431415859059e-01   +1.163347493488893e-01   +3.017893489358898e-01];
L1I_L2I_iGABA_netcon = [+5.195016643468590e-01   +1.895293673252983e-01   +7.834711017151711e-01   +3.338046863888547e-01   +5.297430737816301e-01   +2.889144411029355e-01   +8.668960582351468e-01   +2.281021384026340e-01   +5.491584482241230e-01   +8.540847498365780e-01   +3.835297753999934e-01   +3.916861694748454e-01   -5.245537701918479e-02   +7.340690240637323e-01   +6.305320536878539e-01   +5.026895503032299e-01; +1.220361020237256e-02   -6.111032277913117e-03   +3.189095513058315e-01   +2.703514603757497e-01   +8.844608912073576e-01   +3.715523259960946e-01   +3.292387388732820e-01   +1.337642959186270e-01   +4.674237376262168e-01   +2.352351028113974e-01   +3.212777075383924e-01   +2.859155542884519e-01   +9.465394531752187e-01   +1.720113966750478e-01   +7.825722347957119e-01   +2.136371555406743e-01; +4.051917123247636e-01   +6.613100272142035e-01   +3.098520945759294e-01   +6.875693527084302e-01   +2.478120269551761e-01   +5.367525580836341e-01   +7.469781018182202e-01   +1.135947432944432e-01   +7.407695827478460e-01   +4.449988666920537e-01   +6.060641219206759e-01   +8.690359307781986e-01   +9.584582293030172e-01   +6.554668930348775e-01   +3.609093981485682e-01   +1.714983625622926e-01; +8.221003594284619e-01   +6.729112814314062e-02   +6.640439886730427e-01   +9.228555179819945e-01   +4.811875613984165e-01   +8.862064662632406e-01   +6.542640825495897e-01   +3.439147664577983e-02   +3.045989428742688e-02   +3.196131877184683e-01   +4.213694735238923e-01   +4.570351526167281e-01   +3.385318712430314e-01   +5.294925248796258e-01   +1.518373197854162e-01   +6.407155897226728e-02; +9.319668820441575e-01   +7.791195347609502e-01   +7.283731225014934e-01   +6.379163838642474e-01   +2.845957662368473e-01   +6.565323547118360e-01   +6.417474834798800e-01   +6.237140715780298e-01   +9.476501217271542e-02   +6.816411802122251e-01   +1.883210698524685e-01   +4.796181152199514e-01   +6.610368044922116e-02   +1.900515116303165e-01   +6.767185269467458e-01   +9.385671745128231e-01; +5.183603850809068e-01   +4.159670185774038e-01   +1.021295506085168e-01   +3.501927650021424e-01   +8.915256966716025e-01   +1.384036932732231e-01   +7.013549822676886e-01   +6.334090546731199e-01   +5.056551863066990e-01   +7.452621319708741e-01   +3.140030135731975e-01   +5.400218129066447e-01   +8.855206849625548e-01   +9.394498484108904e-02   +2.060494264742231e-01   +5.405456835824767e-02; +8.584106170674541e-01   +1.059496523766660e-01   +3.787850927729766e-01   +3.116349677248627e-01   +5.391440315750475e-01   +8.429437277150447e-01   +4.562018053903656e-02   +2.356236899039598e-01   +7.058522371205431e-01   +9.134561502910878e-01   +8.877210222010099e-01   +8.346719527386054e-01   +1.251400228836052e-01   +2.475161253701673e-01   +7.011802721641583e-03   +6.065674257113600e-01; +8.986735607117298e-01   +4.073600535704645e-01   +4.673956981041452e-02   +8.883267919052326e-01   +1.842781829103327e-01   +9.714530658826214e-01   +7.695491506897210e-01   +3.475465787208680e-02   +7.682042004379397e-01   +4.379095563982159e-02   +8.675777053434154e-01   -2.864035986982558e-02   +8.315802465590888e-01   +9.452752268976874e-02   +9.800332930285702e-01   +6.856146068441272e-01];
L2E_L1E_iAMPA_netcon = [+2.906283597394874e-01   +9.353001649836304e-01   +6.563123085621523e-01   +5.617389529490076e-02   +3.075260114887252e-01   +3.820005064747592e-01   +8.378916329559834e-02   +6.282784907705440e-01; +2.065677010737910e-01   +1.326611817648213e-01   +7.676255398410680e-01   +8.361280878114626e-01   +3.395527141126513e-01   +5.199869050783529e-01   +2.566581377466995e-01   +1.353041073644120e-01; +4.655210973030049e-01   +8.778287333281797e-01   +7.965000806012784e-01   +2.034456648741083e-02   +6.739285614213196e-01   +9.992522951512024e-03   +4.388250015259715e-01   +8.383460581252530e-01; +4.910251552025788e-01   +6.233084982750293e-01   +8.949663489487379e-02   +5.569144584315535e-01   +2.645937652615886e-01   +5.339865392239198e-01   +1.845781560219937e-01   +4.585933350944401e-01; +8.561064078529116e-01   +6.713226093602449e-01   +7.620620996138613e-01   +4.935239210012231e-01   +7.547619690308177e-01   +3.714410978200771e-01   +4.394339271543937e-01   +4.910931697141262e-01; +4.857736694312903e-01   +6.500102776634800e-01   +4.664521750922976e-02   +5.982442243324567e-01   +6.559305623333562e-01   +8.242228128631826e-01   +2.854489170044257e-01   +9.036077768876509e-02; +4.366807362766869e-01   +3.208546755369332e-01   +2.326430487270300e-01   +4.149938461047420e-01   +4.172837594608429e-01   +2.485827028575065e-01   +6.178311802722383e-01   +2.768942157430925e-01; +6.845549846428388e-01   +1.716296422130029e-01   -4.916435849135892e-02   +9.804394076784677e-01   +5.314311278932693e-01   +3.658782431379277e-01   +5.850620386528201e-01   +6.132855931546164e-01; +7.707189612256959e-01   +5.949469992996972e-01   +6.523143989390527e-01   +1.256608264051697e-01   +3.929729831799521e-01   +2.484842171537954e-01   +7.026423696541184e-02   +1.000000000000000e+00; -1.980846982786744e-02   +1.482419585381665e-01   +1.810320315565829e-01   +1.501203594650989e-01   +1.537274017721713e-01   +5.479662495199203e-01   +8.228918151995672e-01   +8.187986882645772e-01; -8.254654257569520e-03   +1.937357071291703e-01   +5.361354843819351e-01   +4.517982780651197e-01   +1.234692537038590e-01   +4.182437237226052e-01   +1.784576825332254e-01   +7.245428525236436e-01; +3.400765697723935e-01   +5.399014420953869e-01   +6.451149002010386e-01   +4.977346873214668e-01   +6.864018793561925e-01   +3.082712404748567e-01   +6.981277904241725e-01   +4.312209009644386e-01; +6.833098601423436e-01   +7.380390536457924e-01   +5.800030268894076e-01   +2.374195958981472e-01   +2.083028825238894e-01   +1.058563820358333e-01   +5.602979639039028e-02   +4.945807583188664e-01; +7.172059125821969e-01   +7.982695573062306e-01   +3.265475839431876e-02   +8.780478941580064e-01   +5.025910018231645e-01   +7.913907799038562e-01   -3.704390911591066e-03   +1.766216136764085e-01; +9.289264301783065e-01   +1.956976655263947e-01   +4.541202808142851e-01   +5.547492209957628e-01   +3.324520158625222e-01   +2.307000272787441e-01   +6.043435154970781e-01   +4.111828848383859e-01; +8.099801641182316e-01   +6.120668408501011e-01   +6.916301132641812e-01   +3.834097111478639e-01   +4.923870382031620e-01   +8.122549672536233e-01   +7.455219021668887e-01   +1.549810560577603e-01];
L1E_L2E_iAMPA_netcon = [+8.256693019680893e-01   +4.531364550985924e-01   +6.152753073036977e-01   +1.634697816561407e-01   +9.410861347134767e-01   +2.695783369145157e-01   +5.046552892844091e-01   +5.010849853061139e-01   +9.110700621134882e-01   +5.138502707572079e-01   +6.434396491299949e-01   +4.409398343681618e-01   +4.908451964135036e-01   +3.338233450378197e-01   +6.142455736885437e-01   +2.824998212850701e-01; +7.951960185940150e-01   +1.550650148687633e-01   +1.255444576593971e-01   +5.318703669943595e-01   +8.019507342254069e-01   +5.659735489277680e-01   +9.095647661005313e-01   +2.189296161373228e-01   +3.761755463155997e-01   +3.202077040361549e-01   +6.643444080912949e-01   +6.268554188382216e-01   +6.672032754654060e-01   +8.584184148111054e-01   +3.755360116607528e-01   +5.484040940290520e-01; +7.483559233944611e-01   +1.490452788723553e-01   +1.667371873090882e-01   +9.861340342316651e-01   +2.072005177724865e-01   +3.794714094987627e-01   +8.506453788335580e-01   +3.061112652259367e-01   +1.760927773328493e-01   +6.109924808281912e-01   +7.484855807899540e-01   +4.791653870507260e-01   +8.045407490155999e-01   +9.591343236071269e-01   +8.063125217633906e-01   +6.177973307670022e-01; +6.771121154860382e-01   +4.902369264513565e-02   +5.454019415860182e-01   +3.257042166247431e-01   +4.205607957250169e-01   +7.999219596310899e-01   +1.667405744611842e-01   +1.614080596485481e-01   +5.700442979300259e-01   +4.722343396368597e-01   +4.001965106652259e-01   +9.306437265593328e-01   +7.403016967824315e-01   -3.070302176069812e-03   +7.477702713550555e-01   +8.027197589398170e-01; +9.651560204587595e-03   +2.171442490517276e-01   +1.477195480249282e-01   +7.275879000809566e-01   +1.996086899602361e-01   +4.444392397667086e-01   +9.338915840894096e-01   +3.314216810306646e-01   +1.013937917986007e-01   +7.122993628996236e-01   +1.005716547792516e-01   +5.376218066608850e-01   +4.081471076666850e-02   +6.373340998578807e-01   +4.443529108762260e-01   +1.486124202020846e-01; +6.343863497259373e-01   +4.388508395713064e-01   +3.952440130403295e-01   -1.420606661225748e-01   +8.737013578963456e-01   +1.038313444734597e-01   +4.756814306283744e-01   +1.822606256058212e-01   +7.532983543582725e-01   -4.534040809388802e-03   +7.547824904404290e-01   -2.190751727260163e-02   +7.292403928641374e-01   +5.312694657241430e-01   +6.970993189948690e-01   +3.354854731553497e-01; +2.850805663963680e-01   +6.983072632377909e-01   +3.249054593697039e-01   +3.790969600094829e-01   +3.030165013715439e-01   +8.912719907621107e-01   +9.208836034840404e-01   +4.626207141996118e-01   +6.754411495414927e-01   +7.408294129264441e-01   +8.598994784147325e-02   +9.982305703344312e-02   +9.352679651468712e-02   +3.695659072176551e-01   +2.751057042916755e-01   +7.349608120651182e-01; +1.627819102208357e-01   +4.550190235578156e-01   +2.951448972489748e-01   +5.005747198431164e-01   +9.415874099058122e-01   +4.881436606085804e-01   +9.288790398759535e-01   +8.245686189506657e-01   +3.721260226022754e-01   +5.158286307322622e-02   +4.299920010197200e-01   +4.223711621415120e-01   +3.607686039166785e-01   +6.730113967664297e-01   +5.841602534008016e-02   +5.375864308732690e-01];
L2I_L2E_iAMPA_netcon = [+3.134676131158414e-01   +2.968161104432082e-01   +3.337873348294338e-01   +5.469595084144969e-01   +1.779177298806942e-01   +8.195316804971989e-01   +6.967674634924331e-01   +2.122467993370559e-01; +4.881710187383261e-01   +1.282998523175473e-01   +6.788529460931562e-01   +2.661825972630203e-01   +6.890073957091216e-01   +8.197345369332575e-01   +1.079250814275306e-01   +5.140739433684542e-01; +6.361067433582713e-01   -3.092612157443825e-02   +6.946650099428727e-01   +5.824257574715147e-01   +1.533997729925207e-01   +6.231368563187089e-01   +7.444047961805587e-01   +1.003072187083685e-01; +5.550541749575538e-01   +2.517583949905280e-01   +5.228935407649812e-02   +9.499489562820268e-01   +3.685146107421203e-01   +6.167027479128639e-01   +9.653810449165681e-01   +1.685466144307874e-01; +1.358724715548804e-01   +4.501312468909291e-01   +4.687176590037523e-01   +8.498469513610540e-01   +8.563961213402891e-01   +5.358391240056237e-01   +7.124654338379898e-01   +2.663037176417132e-01; +9.036444138872720e-01   +5.295050459533033e-01   +9.080384941012267e-01   +9.052296005098772e-01   +6.766902145439151e-01   +8.560547510757579e-01   +8.511361965582527e-01   +4.972809704332727e-01; +1.276720918008148e-01   +5.632422673824617e-01   +9.077804582179390e-01   +8.494260207067272e-01   +1.111545550858626e-01   +7.366491679502011e-01   +2.416095951564628e-01   +1.377103527767886e-01; +5.889590680578480e-01   +3.782239245888923e-01   +1.343119592592607e-01   +2.909789041010653e-01   +6.960827751806307e-01   +4.269979035817427e-01   +9.682142056855996e-01   +6.535957748096328e-01];
L2E_L2I_iGABA_netcon = [+4.354085652310167e-01   +6.280022363903103e-01   +5.809002978489026e-01   +4.494337368181922e-02   +4.144396602492333e-01   +5.120027081518101e-01   +3.021358861264880e-01   +7.231202803735957e-01; +4.233949154958422e-01   +3.447312843196245e-01   +2.751185522802342e-02   +4.807176022308821e-01   +4.120776170134938e-01   +6.558832775802135e-01   +5.079758574583876e-01   +4.061576717715319e-01; +5.722362427352083e-01   +5.697325800548024e-01   +4.068812561161133e-01   +5.788878800546436e-01   +2.876616093856303e-01   +2.902380512109921e-01   +2.006413278216494e-01   +9.554613337382732e-01; +7.491769060233412e-01   +5.592941526126192e-01   +3.588768583998880e-01   +8.702368001412536e-01   +2.292976662165003e-01   +5.487033209344837e-02   +1.624889553328712e-01   +3.808059826902489e-01; +4.995556858769560e-01   +7.552387550487077e-01   +4.465254484343829e-01   +7.945273827444251e-01   +3.695022341913499e-01   +7.036988727476535e-01   +6.145166866542801e-01   +3.926069729338338e-01; +3.981576119499914e-01   +2.323883473265671e-01   +4.226846193362216e-01   +4.177403753444547e-01   +8.024198754791425e-01   +8.153024973192398e-01   +5.123777078254413e-03   +4.545983981367329e-01; +5.655685319856694e-02   +4.672522891238498e-01   +8.266257778003115e-01   +5.746465926904464e-01   +5.301802684067723e-01   +4.164108255711822e-01   +9.007354485486586e-01   -2.557892960517968e-02; +8.988760225566987e-01   +5.610682441442705e-01   +8.879011724872343e-01   +4.786975263444666e-01   +8.891511724727695e-01   +5.323611667203622e-01   +3.233893651423554e-01   +3.587916699063721e-01];
L3E_L2E_iAMPA_netcon = [+2.593051350818238e-01   +8.992511799414276e-01   +4.632581065393919e-01   +7.391096280146112e-01   +1.887078946242219e-01   +4.010155139052230e-01   +3.636421280807493e-01   +9.295292502794433e-02   +1.359265764877238e-01   +5.333517707399126e-01   +1.428237069494819e-01   +4.926014799199274e-01; +2.716459447764623e-01   +4.437033132610242e-01   +1.409835123905664e-01   +1.951727121523568e-01   +5.435206701940539e-01   +9.167052483322705e-01   +6.793758917775863e-01   +5.621874036146326e-01   +2.135346045558418e-01   +7.858741942183549e-02   -2.210851010951865e-02   +9.796825646706797e-02; +7.664273074120337e-01   +3.541057893105582e-01   +5.051087105695733e-01   +1.297213659827202e-01   +8.149894234049072e-01   +8.768848323617394e-01   +5.438729029621224e-01   +5.915955313281513e-01   +7.149173412072994e-01   +3.330272610811072e-01   +3.646933542632539e-01   +8.684515431045651e-01; +1.796648018235203e-01   +4.744678091106352e-01   +1.830350953604513e-01   +7.745627172365877e-01   +4.748754930619563e-01   +5.416049608072631e-01   +8.310954200397260e-01   +2.588159378401880e-01   +8.024053503508307e-01   +8.027618129356627e-01   +4.291859255888860e-01   +1.745535430249553e-01; +2.130731346589157e-01   +7.561743857875152e-01   +4.255980476471025e-01   +1.896831568980453e-02   +2.021343079975584e-01   +9.482479837853675e-01   -2.510617150368839e-02   +6.662856225143571e-01   +9.510262469505190e-02   +8.555824570988139e-01   +2.690001568666971e-01   +2.120159701872541e-01; +3.240581533441050e-01   +3.867300203486503e-01   +8.301839052599189e-01   +9.569461141569702e-01   +3.581393093783060e-01   +9.038532048472033e-01   +7.449413616583930e-02   +3.507736751933742e-01   +4.899683198154376e-01   +8.271067205287586e-01   +5.819899143639726e-01   +8.526019946374440e-01; +2.175493013136029e-01   +4.627959831581042e-01   +5.560546970710556e-01   +1.021501368838453e-01   +6.278398346065489e-01   +4.640760194217373e-01   +7.386537531016095e-01   +9.512181672955079e-02   +4.261209623183931e-01   +4.214810319931901e-01   +9.820336631548943e-01   +7.037594752897287e-01; +5.805454792835176e-01   -1.618984216744913e-02   +3.764393450779621e-01   +1.453463322223283e-01   +1.953185149336551e-02   +8.617714742668060e-01   +3.705125135462962e-01   +4.669778149356715e-01   +8.235753152376937e-01   +1.000000000000000e+00   +9.066233274568919e-01   +2.982226280649515e-01];
L3I_L2I_iGABA_netcon = [+7.086311053830675e-03   +2.693499970807734e-02   +1.591016879302880e-01   +6.408952962115351e-01   +3.575717879804492e-02   +4.707452686052881e-01   +8.051948565855748e-01   +3.876975377511631e-01   +4.115658076467784e-01   +9.036409856518857e-01   +8.182398750789350e-01   +6.371507543189989e-01; +3.986324245380017e-01   +4.283099460433200e-01   +2.707598490329187e-01   -5.397187201477240e-02   +4.658164878220710e-01   +6.351708851874721e-01   +4.357705936104637e-01   +9.226486951519087e-01   +1.302842057058025e-01   +8.953898710679967e-01   +2.428029407874452e-01   +6.391480609292209e-01; +3.808600850658603e-01   +6.491571512865011e-01   +2.705648336077235e-01   +7.709721985792324e-01   +3.375961061839234e-01   +8.433811408832382e-01   +9.670074931836367e-01   +3.005268651580183e-02   +6.846293389346724e-01   +4.474592922479447e-01   +1.128452755654900e-01   +5.831976333053307e-01; +6.091069841996989e-01   +9.741634078100503e-01   +3.133209267104471e-01   +2.646181950027686e-01   +1.778611862825017e-01   +5.883226148443177e-01   +1.722415470120075e-01   +2.255229900249317e-01   +7.172800500209350e-02   +3.443996848588310e-01   +5.165562301747348e-01   +8.251249978759961e-01; +9.715094742391738e-01   +1.277570802111618e-01   +4.729225711531856e-01   +8.676897632505489e-01   +5.050910557806584e-01   +8.687550013072052e-01   +7.569928082907208e-02   +5.034391617646788e-01   +5.767530662804542e-01   +8.082922427403371e-01   +7.255389445966189e-01   +5.246653457089937e-01; +9.327961524336035e-01   +2.221735467895308e-01   +1.758430275629375e-01   +7.567233158301281e-01   +9.060481159353125e-01   +7.552652410881719e-01   +9.477591127891087e-01   +5.898260465123412e-01   +9.078800888461154e-02   +8.404216064844452e-01   +3.100283416945872e-01   +5.624617939234252e-01; +8.456180164115441e-02   +5.198133376073008e-01   +9.038679739427924e-01   +5.700512352156670e-01   +1.000000000000000e+00   +7.706133625727041e-01   +8.490729007338582e-01   +7.663392297752749e-01   +5.845772629356185e-01   +4.089673320217393e-01   +3.433506761053151e-01   +5.396321908155972e-01; +3.771449642502345e-01   +4.193592934342236e-02   +7.742448796426687e-01   +1.565403122136963e-01   +4.300683329422438e-01   -1.536897767349792e-03   -3.901293064316301e-02   +9.193894515926284e-01   +4.763317544139752e-01   +9.588067819382719e-02   +7.027537035835386e-01   +3.873505806965928e-02];
L2E_L3E_iAMPA_netcon = [+9.383100521500590e-01   +2.401670521146620e-01   +5.677235015338442e-01   +7.246748015388146e-01   -1.127631338900435e-02   +7.137605530377810e-01   +8.199780586755798e-01   +9.990257823944487e-02; +3.407226459577476e-01   +5.315474502897969e-01   +6.665793923385048e-01   +6.919229177314876e-01   +2.522229825701103e-01   +2.118051221713804e-01   +8.154261312649170e-01   +9.073591863477078e-02; +6.287502240591124e-01   +5.048147158754354e-01   +8.298935229318558e-01   +6.038246963344053e-01   +9.419314280345060e-01   +4.689137048344189e-01   +9.820212600612791e-01   +4.203693574082655e-01; +2.014142334241742e-01   +9.018839533825115e-01   +8.678618661061487e-01   +4.033584826551518e-01   +3.895443751490064e-01   +9.445922276384597e-01   +2.254650940891332e-01   +4.757671624167871e-01; +6.313043722212815e-02   +2.005178357698413e-01   +7.223652055584281e-01   -3.587260445410520e-03   +2.048517453973945e-01   +5.360202720980761e-01   +4.523379408103598e-01   +6.066424909644221e-01; +4.046831527349860e-01   +7.997093131815842e-01   +1.644366351250997e-01   +7.607839737614124e-01   +1.072736934872768e-01   -6.460784394491897e-02   +5.182382695409571e-01   +2.501532384440409e-01; +4.586646644861099e-01   +7.692877075370704e-01   +7.974265881065582e-01   +2.494778407539513e-01   +8.008519163694061e-01   +1.761376013289989e-01   +7.146737746814020e-01   +9.393398030110168e-01; +1.282848454634793e-02   +5.266637780150482e-01   +8.911538699742442e-01   +4.578437261914210e-01   +6.707180021356356e-02   +7.699205158397494e-01   +6.392427091042886e-02   +3.218915707276114e-01; +9.692228629466320e-01   +9.338868104486120e-01   +1.095794305678504e-01   +1.802427995314573e-01   +9.264728936144573e-02   +9.083374856878554e-01   +2.864471881519293e-01   +9.230651947497283e-01; +1.479204599775663e-01   +3.909128033673587e-01   +8.071204333423074e-01   +3.375533892908458e-01   +4.269197256067847e-01   +8.865131332116158e-01   +4.073957333442879e-02   +9.137740822719009e-01; +6.845167675205083e-01   +3.450348948425881e-01   +2.957090914613582e-01   +2.540963250474572e-01   +2.153250859560513e-01   +3.311883935192117e-01   +1.807214637939889e-01   +1.263408829497669e-01; +1.359370323988700e-01   +6.481982976281628e-01   +8.381715307181965e-01   +4.187391659053609e-01   -6.037361519644624e-04   +7.172723415247364e-01   +7.854858309116863e-01   +7.744418829001650e-01];
L2I_L3I_iGABA_netcon = [+3.313638624640476e-01   +6.833468262848749e-01   +2.639681787231998e-01   +6.461638553842017e-01   +4.821122676936296e-01   +4.185455978279728e-01   +4.333681436687184e-01   +5.016821340334330e-01; +3.332326323544624e-01   +9.289979959483134e-02   +1.753485042499972e-02   +8.063625840903307e-01   +6.611149051322931e-01   +4.114873561391523e-02   +1.044054243967514e-01   +6.188925735111315e-01; +3.177216826423607e-01   +6.318782982008072e-01   +3.746257177668894e-01   +9.982574464513712e-02   +8.359571615464317e-01   +6.442222328181176e-01   +2.114825855139206e-01   +1.488763959418714e-01; +5.965241675167035e-01   +8.308338685515801e-01   +5.521720997126416e-01   +4.473400050682403e-01   +5.595257351295622e-01   +6.725759274234085e-01   +3.652374591976253e-01   +6.377756470566079e-01; +2.006541221184157e-02   -3.148570237152000e-02   +6.616475362057975e-02   +7.030639899190932e-01   +2.175396616442844e-01   +6.266928970847289e-01   +4.405587466640790e-01   +2.728426330181518e-01; +5.594778919506965e-01   +3.904687393773638e-01   +4.163201550295712e-01   +7.019808654368330e-01   +2.076325547514588e-01   +8.048249860832737e-01   +4.269888047261708e-01   +8.360063743166696e-02; +2.099571239681096e-01   +9.263899612744451e-04   +4.003345579311594e-01   +9.844486844593162e-01   +6.662233144535987e-01   +3.268851903169184e-02   +2.343174484817353e-01   +8.564366586676652e-01; +1.893179178821393e-01   +8.790811435269976e-01   +8.938018729447877e-01   +9.003928304835825e-01   +4.791434582315748e-01   +1.289423982505111e-01   +6.936684244684902e-01   +1.052216442167827e-01; +3.290224036410553e-01   +5.460102704841688e-01   +2.604118617345130e-01   +1.782501012874479e-01   +3.955485601929383e-01   +2.633226392644683e-01   +5.871153562142658e-01   +4.744937719499489e-01; +3.994880332813610e-01   +1.932928501693913e-01   +2.100602960013247e-01   +4.012020595934752e-01   +9.702658283369704e-01   +4.871383699646881e-01   +4.655901545580011e-01   +9.257768826189592e-01; +6.087922791763405e-01   +8.568990413800270e-02   +3.284388809085013e-01   +5.685249055392226e-01   +5.406913032425640e-01   +6.508129507956494e-01   +8.757884168542710e-01   +6.326300787352488e-01; +3.739470755819014e-01   +1.908290200674711e-01   +6.197163648377294e-01   +3.487111921100102e-01   +1.126465901252701e-01   +4.387570254490783e-03   +2.988350636962337e-01   +6.484259306847601e-01];
L3I_L3E_iAMPA_netcon = [+1.106245811261725e-01   +6.503293954803354e-01   +8.425747644526231e-02   +1.710288784738453e-01   +2.481853410123002e-01   +6.343095826629038e-01   +8.157871159474257e-02   +3.401281430154227e-01   +4.862094899167195e-01   +3.622106595352234e-01   +6.047991114859858e-01   +8.626437810799372e-01; +3.517797916999318e-01   +8.185869316793573e-01   +2.476438539535513e-01   +3.302121288959057e-01   +6.850374617829159e-01   +4.318136806788345e-01   +4.212334381879146e-01   +3.555791926532555e-01   +6.255158929717176e-01   +2.925255311826947e-01   +6.751372353609791e-01   +1.863504166388826e-01; +4.348183193774450e-01   +3.160670392323794e-01   +7.080759968420950e-01   +8.619462136902571e-01   +5.515630754651880e-01   +6.372946119914341e-01   +1.000000000000000e+00   +4.310371299829576e-01   +2.211630791490632e-01   +3.303641021046905e-01   +9.114716710397041e-01   +8.393908420751248e-01; +4.853923818796297e-01   +1.244397100525469e-01   +5.562965019011341e-01   +7.237985132862065e-01   +4.049358257842619e-01   +6.025790851112883e-01   +5.531966320235777e-01   +6.921689469487357e-01   +4.960376388969531e-01   +2.198686516050960e-01   +3.996606601500478e-01   +4.902302352213528e-01; +9.015010288148853e-01   +7.707312237870750e-01   +5.567005313698659e-01   +4.953713716935832e-01   +2.445082133638630e-01   +3.108551562104333e-01   +1.803180485650620e-02   +2.448237582974823e-01   -1.871646623804704e-02   +2.359975372249662e-01   +2.206972840365827e-02   +5.140628811442862e-01; +3.860283776045968e-01   +1.657031717132162e-01   +6.383739957252974e-01   +4.196981160605080e-01   +9.722984866586173e-01   +5.956244366804110e-01   +2.950459841621417e-01   +9.602635808635242e-02   +1.930962396518978e-01   +5.459063707921468e-01   +3.175971878718853e-01   +9.386305295264405e-02; +4.986355657651443e-01   +2.509118345579742e-01   +8.105219198080940e-01   +8.390425374609174e-01   +1.357596991976170e-01   +2.389160236314319e-01   +4.172633381653684e-01   +1.335572617680311e-01   +8.897713164075730e-01   +7.200550814675067e-01   +2.866894405674011e-01   +2.528471214017737e-02; +3.726461058384177e-01   +3.993131866281807e-01   +3.127093080658875e-01   +5.946780035253449e-01   +8.171596439166869e-01   +2.374119957532302e-01   +3.892453353463957e-01   +2.836782931632380e-01   +3.212238029868998e-01   +2.475477378892998e-01   +6.519016436205723e-01   +5.303283465469929e-01; +2.995744785214272e-01   +4.586063901519768e-01   +3.802417060782636e-01   +5.575131769868313e-01   +5.562141241577780e-01   -5.052986771276679e-02   +9.719032142429672e-02   +3.512498913926385e-02   +3.098499508531218e-01   +1.919514702164463e-01   +8.295588434339639e-01   +8.947655391094140e-01; +7.033807105883845e-01   +5.637281054967535e-01   +5.885448222305006e-01   +4.079646421199985e-01   +4.717365431030568e-01   +4.018478253497195e-01   -2.931457563096502e-02   +6.380811094137676e-01   +6.976406946293241e-02   +8.514590020651089e-01   +4.373817328277884e-01   +1.505576246491659e-01; +5.546959543538289e-02   +2.906808515151229e-01   +6.149589554781953e-01   +2.638498242039514e-01   +2.030937373499379e-02   +5.253367822345817e-01   +8.511429594274145e-02   +7.290840231410829e-01   +6.812091564964866e-01   +1.400541337704599e-01   +6.309204804902353e-01   +3.047055804858299e-01; +6.240465852973507e-01   +6.802582465924636e-01   +4.019497008835871e-01   +6.014950609984235e-01   +6.483432389624436e-01   +3.460720922680716e-01   +2.903972975024943e-01   +8.057800394624015e-01   +5.535824110111732e-01   +3.913332662497818e-01   +4.958624888582068e-01   +3.695689653357230e-01];
L3E_L3I_iGABA_netcon = [+3.043411871398350e-01   +7.273073959852180e-01   +6.347173920513773e-01   +9.110215286338262e-01   +4.672310729989809e-01   +6.221908022024109e-02   +2.442608543765029e-01   +6.955888144732344e-01   +7.123987965092465e-01   +2.916671382844946e-01   +4.920338699858539e-01   +2.861555437051509e-01; +8.526148224608144e-01   +3.530464205372070e-01   +5.806508613610314e-01   +1.185643142020995e-01   +8.461418508776850e-01   +4.095901138680773e-01   +8.121430085761823e-01   +6.678963080994436e-01   +5.832950080547580e-01   +7.307274343212501e-01   +2.526693749699267e-01   +4.393920103263239e-01; +7.636857394204603e-01   +3.902382748164236e-01   +4.119269530080265e-01   +4.923626231361588e-01   +5.473422790852556e-01   +5.501843033622994e-01   +2.443380652841751e-01   +8.408084550292658e-01   +5.000365456258150e-01   +1.787583598202002e-01   +7.844209366380374e-01   +8.819052816327818e-01; +1.541447496002792e-01   +6.679107346050349e-01   +3.346734599459232e-01   +3.056099399506038e-01   +1.047620883554601e-01   +6.380010002132571e-01   +2.707803572126826e-01   +4.497810447174473e-02   +3.419967404641734e-01   +4.916675406698419e-01   +7.228357780528141e-01   +6.100918759242667e-01; +2.594793276702398e-01   +6.341836431002981e-01   +5.787702467031474e-01   +2.630808068851652e-01   +9.984119881601020e-02   +6.383999611588420e-01   +8.731752195319933e-01   +3.013039615203602e-01   +2.559777553223507e-01   +8.520885864642678e-01   +6.049075674886967e-01   +2.056324969739592e-01; +4.677355854068976e-01   +7.949869294830367e-01   +7.122554036454589e-01   +4.780327482712154e-01   +7.156552901927116e-01   +9.609889712176500e-02   +3.452703477487039e-01   +2.458057890870816e-01   +9.082766678360844e-01   +8.639254482889799e-01   +8.193333023389765e-01   +2.280879620822996e-01; +5.885451452113525e-01   +7.871888247116943e-01   +2.232508942994645e-01   +1.216349606276525e-02   +3.920693047533710e-01   +5.786649778649168e-01   +6.124957352521787e-01   +1.866254371168750e-01   +9.532574415697551e-01   +5.627391014417228e-01   -6.310682254126210e-02   +3.271436972229279e-01; +4.857266492678620e-01   +3.947774734912019e-01   +8.857827899296845e-01   +4.143375962883467e-01   +1.038770572161219e-01   +9.852096082985941e-02   +5.792674863960746e-01   +5.374280429497329e-02   +5.759906011936056e-01   +7.814511008026035e-01   +1.986475421732042e-01   +9.776766077129537e-01; +3.041110909962978e-01   +5.283434906243237e-01   +2.553406454725275e-01   +7.362628515874909e-01   +7.949771031919806e-01   +9.832906188505861e-02   +3.944152036524853e-01   +6.092041224242011e-01   +5.851822045300068e-01   +8.230484450493809e-01   +6.511543468647959e-01   +6.427604701043921e-01; +7.503103973487814e-02   +1.537832249193401e-02   +3.037802771080063e-01   +5.852189405342101e-01   +7.597457320753817e-01   +1.814879122024606e-01   +3.676128767654885e-02   +3.029819240626171e-01   +6.918894350078688e-01   +2.859504920665715e-01   +6.152151907346459e-01   +2.098021136121347e-02; +8.464075814363722e-01   +3.254735232231617e-02   +7.115132065219996e-01   +5.105161780194879e-01   +3.758896542464980e-01   +8.362414147887817e-01   +1.618873470658341e-01   +7.960434142328282e-01   +3.286903871203484e-01   +9.014507362899395e-01   +5.088731617843767e-01   +7.076673800986224e-01; +6.627143560895923e-01   +8.377601874690327e-01   +4.684423198887991e-01   +8.651875018865556e-01   +8.073801920425048e-01   +4.987482767154874e-01   +9.028407018871007e-01   +8.964887231903922e-01   +4.508748982058649e-01   +8.579214739255949e-01   +4.869181697770181e-01   +8.519986614643600e-01];
L2E_Input1_iAMPA_netcon = [+9.600382831960328e-01   +9.279940172340044e-01   +9.002190389343179e-01   +9.412470684316302e-01   +8.888020055750770e-01   +1.000000000000000e+00   +9.032345026265209e-01   +9.261827785616732e-01];
L2I_Input2_iAMPA_netcon = [+9.391274811514747e-01   +9.662057764339661e-01   +9.530919750480258e-01   +8.926588293179076e-01   +8.829718649380687e-01   +9.076294769266405e-01   +9.405486141610163e-01   +9.295087123970022e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last =  11.21 * ones(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))*0.4 + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.5*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.5*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))*0.9 + 0.5*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))*0.4 + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.5*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.5*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))*0.9 + 0.5*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
