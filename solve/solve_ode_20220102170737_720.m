function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+1.260325627670065e-03   +1.182236752718129e-02   +1.586090026389528e-02   +1.572850654940594e-02   +9.738201276711751e-03   +2.130064566827202e-02   +2.795055189765530e-03   -6.197303490945629e-04   +6.980079615396889e-04   +6.800744044380995e-03   +9.807448612617569e-03   +2.676724224567961e-03   +1.023382053567809e-02   +2.149009071497297e-02   +1.296993104773336e-02   -2.914942491706402e-03; +1.134636561519101e-02   -4.444669566187243e-03   +1.464362813620955e-02   +1.685738486399422e-02   +5.670413652256831e-03   +3.695145866690734e-04   +2.082413119664379e-02   +1.687320786244985e-02   +1.570507756605508e-02   +1.072688238359695e-02   +1.856363274425532e-02   +9.589302159071221e-03   +6.127738705690781e-04   -5.068293120428663e-03   +9.019836098088171e-03   +3.822115372780167e-03; +9.225642302584108e-03   +1.533803245019104e-02   +1.407758368965380e-02   +5.324062759506263e-03   -3.921469680657025e-03   +1.746907511714268e-02   +2.127132725630597e-02   +1.136660133278728e-02   +2.843070868013467e-03   +2.489475268465574e-03   +1.032406173994525e-02   +6.302761043975439e-03   +5.345023258294925e-03   +9.152614493175693e-03   +2.057811892186084e-02   +1.219112880608086e-02; +6.457490650292315e-05   -1.192248858440730e-03   +6.633513407637311e-03   +1.179695600927529e-02   +3.444468151320157e-05   +1.253584695508792e-02   +1.420548664218950e-02   +1.689009209716216e-02   +1.329646024624053e-02   -8.229170449721972e-04   +1.906937546494376e-02   +1.275546866127067e-02   +6.927032562712611e-03   +2.084260168678598e-02   +9.232150991990623e-03   +1.540701409664993e-03; +1.018416085131112e-02   +1.188564872571782e-02   +1.267441272747552e-02   +1.037699896665385e-02   +1.450140995485964e-02   +1.838420542908674e-02   +1.914527770351178e-03   +5.024700557728774e-03   +1.168007867988817e-02   +2.621427101603193e-02   +9.770992316396202e-03   +1.001944534092000e-02   +2.666641348075294e-03   +8.291022300108565e-03   +2.668875231679929e-02   -7.178158019700946e-04; +7.865544910971472e-03   +1.680337960630269e-05   +1.489471924925891e-02   +5.384933046023324e-03   +1.029866988306373e-02   +9.542917317484882e-03   +1.215616061372806e-02   +2.397696192018635e-03   +7.490744744826612e-03   +1.434132797365315e-02   +1.680477126396647e-02   +6.182047170360095e-03   +1.104347903260446e-02   +3.983480562288472e-03   +1.146736693748517e-02   +1.460202845627169e-02; +4.200864394750948e-03   +1.135730273026440e-02   +1.873994965062081e-02   +1.899874717259157e-02   +1.527684387539687e-02   +9.515250197513068e-03   +7.482489983136536e-03   +2.160006420549496e-02   +2.353014446026601e-02   +1.563993139310045e-03   -1.848821539172776e-03   +5.944505469831608e-03   +1.348300605819817e-03   +1.824066822820326e-02   -2.674669674080516e-03   -1.794520421425934e-03; +1.707674276090125e-02   +1.738863107469014e-03   +1.626094785513291e-02   +1.626792451936632e-02   +9.578362554559771e-03   -1.332028893925139e-03   +4.634429142604235e-03   +8.090746733450588e-03   +1.688187293586206e-02   +1.866081469516490e-02   +3.528731311302132e-03   +1.192609604454430e-02   +9.834420214254631e-03   +4.064665877284717e-03   +1.393993439364432e-02   +1.366988252528550e-02; +7.049561434403266e-04   +1.308349521194163e-02   +1.359864352460085e-02   +1.266881766484097e-02   +2.916208363226787e-03   +1.587563030492197e-02   +5.047059259492956e-03   +9.561337375148809e-03   +4.364714387783917e-03   +1.113262266019837e-02   +2.182671510035080e-03   +1.525015447974675e-02   +2.993885661001993e-03   +1.590672875006984e-02   +1.284917455143228e-04   +3.980133219616324e-03; +5.792734498206530e-03   +3.318221609025201e-03   +2.282750019800531e-02   +9.037303781211500e-03   +1.206830789883676e-02   +4.705226083430721e-03   +5.815280299670863e-03   -3.016632004688042e-03   +8.441198970914297e-03   +3.894527637181832e-03   +4.980993370722514e-03   +1.421584158149370e-02   +1.760075024063815e-02   +1.409622763843432e-02   +1.997138135301865e-02   +1.312152125265283e-02; +6.352196485563800e-03   +3.152877489288237e-03   +1.711387074789310e-02   +1.725479300124508e-02   +1.439576452928655e-02   +9.811798030859735e-03   +1.320743120320516e-02   +1.679501763195490e-02   +4.392995637612891e-03   +3.682350372017340e-03   +1.746134681401182e-02   +1.473538241417716e-02   +4.376057818805417e-03   +6.397430854511524e-03   +1.275010280576162e-02   +9.002820741872768e-03; +1.241674560977108e-02   +4.154134066172236e-03   -3.688706423213825e-04   +3.176911761248682e-03   +1.511953984273997e-02   +2.266737854164139e-02   +3.264144797155183e-03   +1.247559177668184e-02   +1.001744157243298e-02   +4.961656083468343e-03   -2.194943198863597e-03   -2.814487975895940e-03   +2.107607705181686e-02   +1.801418693101967e-03   +1.195919793937317e-02   +8.327033885635968e-03; +1.332798357763858e-02   +1.618499520943486e-02   +1.079342460781177e-02   +7.271857743345769e-03   +1.943069120944938e-02   +1.216545772569571e-02   +1.155499270533587e-02   +1.958227373010172e-02   +1.723313316133851e-02   +5.533631642049602e-03   +9.441643492186466e-04   +1.746622143591079e-02   +1.014282712478602e-02   +1.127866669007271e-02   +1.166927383342981e-02   +1.994045358463454e-02; +1.475635574694155e-02   +1.548439708992131e-02   +2.991337719478706e-03   +1.313240413945765e-02   -5.955695584574324e-04   +6.784119451690747e-03   +2.074354988583733e-03   +4.965046209008700e-03   +3.772963755156664e-03   +1.445078001855805e-02   +4.723538284019680e-03   +2.322569566164383e-02   +1.306974211742195e-02   +1.026563913126806e-02   +5.303864098598680e-03   +7.683767550773541e-03; +5.205663974792233e-04   +1.690139502907332e-02   +1.684306079623608e-02   +9.697689492903165e-03   +1.464663904748401e-02   +7.877762588423362e-03   +6.104995791103618e-03   +1.099578423990452e-02   +1.062029993079949e-03   +1.882320034100445e-02   +1.539086841084447e-02   -1.202014707900347e-03   -1.351956913775523e-03   +1.954088943181275e-02   -1.179979840836584e-03   +9.968177118504767e-03; +1.824771411013422e-02   +6.634523447572620e-03   +1.686288246659388e-03   +2.521459006638621e-02   -1.669688734471599e-03   +2.668674367394751e-03   +1.366331028130744e-02   -1.599020581686210e-03   +5.041131494776406e-03   +1.940857174310818e-02   +1.355721741754519e-02   +3.102974938278084e-03   +1.590855089651216e-02   +1.964857233460301e-02   +2.075392209366742e-02   +2.010173603216084e-02];
L1E_L1I_iGABA_netcon = [+9.931106602972395e-03   +1.467552992175355e-02   -6.567677539941006e-04   +1.018236214076811e-02   +1.624695192840877e-02   +1.272598814981804e-02   +1.193507997289471e-02   +2.827587925585805e-04   -1.598410012406100e-03   +4.311735865929315e-03   +6.765043681074550e-03   +9.180883866858058e-03   +5.629988411574653e-03   +2.072159673192763e-02   -3.130887231821835e-03   +8.228844429090944e-03; +2.419023040861015e-03   +1.583572368697279e-02   +1.210357461574043e-02   +1.410919035070327e-02   +1.233713990539376e-02   +1.168551597300574e-02   -2.000814799783669e-03   +1.662089847112482e-02   +1.594348067048366e-02   -3.870225333452631e-03   +1.850062793468117e-03   +1.649032235913973e-02   +2.743431458525002e-03   +8.493206244496863e-03   +6.264104729625145e-03   +1.767744665735299e-02; +7.494569099248482e-03   +2.275520590605671e-02   +2.183747553520435e-02   +1.109952321232308e-02   -1.376937176536225e-03   +1.426027621455635e-02   +1.560398518241369e-02   +1.718077800909179e-02   +2.074694173174450e-02   +1.720928562114234e-02   +1.344363787085812e-02   +1.020564801678874e-02   +2.170087762719141e-02   +1.770399901012255e-02   +4.139333679276497e-03   +1.192788756238002e-02; -2.903960257757042e-03   +8.634625272909953e-03   +1.867357650750892e-02   +7.575467305092260e-03   -3.315572480008628e-03   +9.645512589897404e-03   +1.605562741915572e-02   +1.410347708669493e-02   +7.740297986409978e-03   +1.606969044622763e-02   +1.245603805767984e-02   +4.585006408303388e-03   +9.114334581826236e-03   +8.257225089020341e-03   +7.777943803537382e-03   +1.842198081399092e-02; +2.682266923213179e-03   +2.172721875423364e-02   +7.531259664647369e-03   +2.724872133471142e-03   +1.156132404830725e-02   +1.821881313373439e-02   +1.301567502929734e-02   +9.260720768282408e-03   -4.633993395116238e-04   +5.160034404565412e-03   +1.299961521299917e-02   +5.420123000891318e-03   +1.004238732278914e-02   +8.281079718331533e-03   +1.129375126583402e-02   +5.027008564267496e-03; +1.782789321594962e-02   +1.185863059008052e-02   +1.478136105484692e-03   +1.399422516784532e-02   +4.948854153138724e-03   +8.741398505503031e-04   +1.768659203932838e-02   +6.853559538959723e-03   +2.032035656837612e-02   +4.007351269549697e-03   +1.560829259054650e-02   +3.717995095393841e-03   +6.149047971040439e-03   -1.724400605739069e-03   +1.555194538978722e-02   +1.526569521096493e-04; +1.142256985282725e-02   +8.087472351384926e-03   -2.043549764285073e-03   +8.813970194013690e-03   +2.768976431762897e-03   +1.210292958460515e-02   +1.019924331336541e-02   +5.345633060210154e-03   +1.808683279173572e-02   +3.504333330916831e-03   +2.001081597302144e-02   +1.949904459421964e-02   +2.507358965894992e-02   +1.118813382546314e-02   +6.609791069241791e-03   +7.848104517961405e-03; +4.323913355822682e-03   +5.458361398894226e-04   +2.302449209267651e-04   +4.529760976067383e-04   +1.317067540713725e-02   +5.724477139212411e-03   +1.338380086535729e-02   +1.396630549120143e-02   +2.781735366862808e-03   +1.025580646440492e-02   +1.156765372756005e-02   +2.687620939476119e-02   +8.883805988209977e-03   +1.311901474551230e-02   +4.518178012127027e-03   +1.407259850143226e-02; +7.582302254548643e-03   +6.662191731762492e-03   +5.774322172374283e-03   -5.032467663298425e-03   +7.440610765214768e-03   +1.496569788742773e-02   +2.038011019678720e-02   +2.227425398267970e-02   +9.185767853839819e-03   +6.959342481152877e-03   +1.588541608014088e-02   +4.728877180439699e-03   +2.290122901786298e-02   +2.058215563010822e-02   +4.779526265391550e-03   +6.198293756529796e-03; -3.857199845106865e-04   +6.995564335690082e-03   -3.506649979158244e-03   +1.712013132988095e-02   +3.282157340863709e-03   +1.359114597233026e-02   +6.473449865584982e-03   +3.452973908255869e-03   +2.057825683251696e-02   +1.251550378242031e-02   +3.660792923853847e-03   +1.944389747714541e-02   +2.174958257218979e-02   +1.236183122043006e-02   +1.435341148252791e-02   +6.780200811930353e-03; +1.811345670387067e-02   +6.402559175216357e-04   +8.289257491623967e-03   +6.863188814706797e-03   +1.340684526635862e-02   +6.669794678463409e-03   +1.269265580825060e-02   +1.898209911935324e-02   +7.498691948992402e-03   +1.171303185529888e-02   +1.657017916427584e-02   +1.663393981422407e-02   +6.588503086531719e-03   +2.152359181893670e-02   +1.757144124934446e-02   +9.372879212776008e-03; +1.253956367329285e-02   +1.553457120831536e-02   +8.741194533604661e-03   +1.944587088736689e-02   +2.132175847532031e-02   +1.068163406569624e-02   +7.638663957676615e-03   +2.116634592131724e-04   +1.509194976975244e-02   +7.447915215331114e-03   +3.418848113614864e-04   +1.851927276976290e-02   +1.324666273925633e-02   +2.009602090761017e-02   +1.115979655841094e-02   +8.952928808982127e-03; +2.073584901191609e-02   -1.003838665785889e-03   +1.233704140453128e-02   -2.754062428895619e-03   +4.956476095772422e-03   +1.500015498993483e-02   +7.831466986511241e-03   +3.875852155387455e-03   +1.684253700060860e-02   +1.672465653820728e-02   +8.279286175477624e-03   +1.423945914157736e-02   +2.128287311018639e-02   +1.090880830473636e-02   +4.883339656590610e-03   +3.658732149267886e-03; +4.133924876005998e-03   +1.835324792550385e-03   +5.711148327117708e-04   -5.143415723784537e-03   +2.781282008684855e-03   +1.535921160143285e-02   +2.312028061984716e-02   +1.498528703972655e-02   +1.779897575021319e-03   +8.686315585195314e-03   +1.148238691318812e-02   +1.264120717953430e-02   +8.849428251374003e-03   +2.127524899915289e-02   +1.664628978617991e-02   +1.663076488862783e-02; +1.670074558918469e-02   +1.981609353100170e-03   +7.540299195439680e-03   +1.733141194080090e-02   +1.110545969823283e-02   +6.939570257583119e-03   +5.562843478201338e-03   +7.003231954561444e-03   +6.628777354213045e-03   +1.316475442641189e-02   +4.637536757707682e-03   +8.574683552010749e-03   +7.627888261508018e-03   +1.276093599052450e-03   +4.495154832359409e-03   +7.224248978037568e-03; +1.235516299165319e-02   +3.046215966000466e-03   +1.040213723549396e-02   +1.791859450130477e-02   +2.134849788441038e-02   +8.238825666604582e-03   +7.244755956887934e-03   +2.193567165369068e-02   +1.485539808868136e-02   +1.141299659175566e-03   +9.569600955097062e-05   +6.876385679586576e-03   +1.598541912115976e-02   +1.852398747445809e-02   +7.387849159103111e-03   +1.304801753194324e-02];
L2I_L1I_iGABA_netcon = [+2.082479984013141e-02   +7.391808212474445e-03   +3.740960711779202e-03   +2.095871330539855e-02   +1.980418015238073e-02   +1.250715440210110e-02   +6.029735745216117e-03   +2.346901206186102e-02; +1.433166951819938e-02   +1.593808871047347e-02   +1.041288212742969e-02   +8.410653556185950e-03   +1.009546958430326e-02   +1.192632046889726e-02   +1.712018598711059e-02   +1.605175670798113e-03; +7.583500496336243e-04   +9.427814971921957e-03   +1.291501191594552e-03   +9.999973759226793e-03   +2.093707833013618e-02   +2.282455007206506e-02   +7.062454189211531e-03   +1.484653709053915e-02; -3.530193783405048e-04   +1.617440979588721e-02   +1.470811216383090e-02   +1.139990146287668e-02   +1.741419568349485e-02   +1.307680984624634e-02   +8.023680266434730e-03   +1.850329880974930e-02; +1.113451327707171e-02   +4.371037850181964e-03   +1.812632741112527e-02   +1.012319040353388e-02   +1.064870902724206e-02   +1.993195645599452e-02   +1.111712702339664e-02   +1.932346925828854e-02; +1.403605082845638e-02   +1.084061303479790e-02   +1.609254845573758e-02   +1.384009850362763e-02   +9.577616164625475e-03   +1.512479711622951e-02   -1.226659909544319e-03   +1.073270600327888e-02; -1.892023816503523e-03   +9.973662911373991e-03   +9.438098803046012e-03   +1.081399811180332e-02   +1.709994058249194e-02   +3.766561362585982e-03   +9.120886747260229e-03   +2.082545869691125e-02; +1.243549772221649e-02   +5.741525291736262e-03   +1.744977131035253e-02   +6.665578346605182e-03   +5.537726890171141e-03   +1.900987109081943e-02   +1.631684724222461e-02   -4.849526810414766e-04; +1.142975894599351e-02   +9.859754715592821e-03   +8.466440907557982e-03   +9.096232376667405e-03   +5.815340156577548e-03   +4.099933971719262e-03   +7.556393424207612e-03   +1.674941808077722e-02; +7.320174915350115e-03   +8.735546094342605e-03   -8.652380882748266e-03   +7.070656557676492e-03   +3.655215091574403e-03   +8.585317664289837e-03   +2.051694343637573e-02   +7.601415629226139e-03; +6.120318757858568e-03   +1.900851592399178e-02   +1.720477051533475e-02   +3.220741833385912e-03   +1.644113896503849e-02   +1.937086024869834e-02   +1.219569334415984e-03   +1.123707634755595e-02; +1.270640297432978e-02   +9.356357050793938e-03   +1.086801163861191e-02   +5.009112801811143e-03   +2.064925107066156e-02   +4.810912608676772e-03   +1.275213527444052e-02   +4.802332674792082e-03; -5.433881323930603e-04   +1.980838228081354e-02   +1.405100427472191e-02   -9.252927343445411e-04   +1.076086620048407e-02   +3.986136108861048e-03   +1.187255756295055e-02   +1.583120221692710e-02; +2.080531085823774e-02   +3.820597259996696e-03   +1.731787276678674e-02   +8.927708386166236e-03   +1.689925683326934e-02   +5.894147895159726e-03   +1.886909196985279e-02   +5.451308032855182e-03; +1.731159461064527e-02   +6.626351045572130e-03   +3.891375666861782e-03   +2.255385210720309e-02   +1.639717486881941e-02   +3.394620099623633e-03   +9.097909533464314e-03   +1.250950867414239e-02; +1.050076829214883e-03   +1.488808705705489e-02   +1.378984924603371e-02   +1.249317120840172e-02   +2.049948739579655e-02   -4.573625514900868e-03   +1.985387252134383e-02   +8.465358830776747e-03];
L1I_L2I_iGABA_netcon = [+1.619146500033729e-02   +1.641080660714658e-02   -6.723930513277205e-04   +3.252152732462623e-03   +1.093442537648166e-02   +9.295128732321722e-03   +1.894885449521415e-02   +1.487220186611048e-02   +1.069447491081083e-02   +2.282143200001696e-02   -1.294496414715822e-03   +5.570219917733173e-03   +5.226109542664626e-03   +3.411476184390660e-04   +5.269221270910339e-03   +2.287024899356305e-02; +2.109563121065770e-02   +1.298951078405596e-02   +5.397102647832171e-03   +1.047175986366449e-02   +1.243550451982178e-02   +1.459982433251103e-02   +1.146863981659726e-02   +1.847800087983649e-02   +9.692985942201979e-03   +2.379447174850168e-02   +1.047914382966522e-02   +5.824022576747171e-03   +7.514046982627091e-03   +5.436625665536839e-03   +4.282648941726797e-03   +1.733371209163538e-02; +1.492806660475535e-02   +1.216928059043143e-02   +9.516136301418740e-04   +1.467933918709047e-02   +7.197006067725780e-03   +1.840079174498893e-02   +1.422395494800399e-02   +1.729126142550088e-02   +7.539624634310099e-03   +1.280295095642479e-02   +1.072969362081519e-02   +8.381312055051864e-03   +8.623770261616839e-03   +4.616965420531545e-03   +1.465713099956471e-02   +6.846301680245026e-03; +1.204803601843495e-02   +2.606070568241212e-03   +1.028546025196095e-02   +2.402532221338385e-02   +3.755416588032789e-04   +1.562183901633065e-05   +8.134899929084921e-03   +5.321304321914339e-03   +8.488750815927920e-03   +1.027809256955751e-02   +6.926061078861355e-03   +6.513368407391106e-03   +6.411735355351193e-03   -2.514419721907165e-03   +1.602323645300158e-02   +9.696050269699729e-03; +4.247577872871122e-03   +1.941874910341541e-02   +1.907695510898428e-02   +1.560130568234991e-02   +1.311580669113491e-02   +1.419482636385372e-02   +1.443482010228697e-02   +2.326373473113725e-02   +1.087103826787790e-02   +2.305183984889831e-03   +9.897477641882337e-03   +3.460252599376885e-03   +6.413397604260948e-03   +1.770467779898730e-02   +7.057493674636723e-03   +1.386229825358939e-02; +1.192778667447572e-02   +1.608527090003686e-02   +2.314783223739448e-03   +1.937253326217304e-02   +1.134009431636731e-02   +1.717775593270505e-02   +1.697991104953823e-02   +1.637932223615866e-02   +1.761526431391116e-02   +1.196588761277599e-02   +1.626607187397619e-02   +1.434214152872152e-02   +1.504106613918270e-04   +1.637736078984432e-02   +2.023913706377540e-02   +1.895659196339405e-02; +1.663733667783919e-02   +3.093604176258270e-03   +1.498675546579884e-02   +1.780283722696008e-02   +9.922941786491550e-03   +2.590612159506523e-02   +9.094849482538154e-03   +8.568394092249836e-03   -3.259349221194140e-03   +1.347552066740850e-02   +1.007896429404398e-02   +3.668848143710637e-03   +2.302209748607206e-02   +1.047946309213762e-02   +1.599052150176974e-02   +9.138357925432498e-03; +1.718293007929276e-02   -5.535481400932840e-04   +1.223484879711099e-02   +1.613968635117817e-02   +6.706241380042644e-05   +1.382405167238912e-02   +1.514319470198542e-02   +1.412364761613921e-02   +5.038877249388268e-03   +1.462699390217444e-02   +5.048426948626149e-03   +7.389012587142732e-03   +7.528809800488439e-03   +2.011778449425586e-03   +1.528514198666016e-02   +7.048300108125116e-03];
L2E_L1E_iAMPA_netcon = [+1.537738497702903e-02   +4.847334921821121e-03   -9.123478503975818e-05   +2.201020404912359e-02   -1.034789299442504e-03   +3.607843796494418e-03   +1.135591267853839e-02   +6.380684097966461e-03; +1.564988532511660e-02   +1.599644562568719e-02   +1.338283887875856e-02   +5.058587449744049e-03   +1.205334843958417e-02   +6.101857149783033e-03   +2.014478153628080e-02   +1.071183865481371e-02; -4.101412081931459e-03   -1.731929263505880e-04   +2.675850510946473e-03   +1.136228440725703e-02   +1.177534996749272e-02   +2.483041930275886e-02   +9.258278936664527e-03   +7.751344911025414e-03; +3.407558322342242e-03   +1.612016705377658e-02   +4.674359218628810e-03   +1.831607325710137e-02   +2.280415055181119e-02   +9.168175329406057e-03   +1.475173247598619e-02   +2.219388094033352e-02; +3.394385022562306e-03   +1.848944762716051e-02   +1.259527318987939e-03   -6.502692503852849e-03   +2.041764793729108e-02   +1.983004268394220e-02   +2.085569539169507e-02   +7.846142628597666e-03; +1.212170668988921e-02   +6.136289196387102e-03   +2.050940416348789e-02   +1.695514761147828e-02   +1.211322679839001e-02   +1.237060949656379e-04   +1.102543512776185e-02   +1.006106780466933e-02; +1.099162832726077e-03   +9.814551545446354e-03   +7.080968177452119e-03   +7.416081073646528e-03   +1.419440518977616e-02   +1.047694331520134e-02   +1.399537330145739e-03   +1.018723866855787e-02; +4.810740633386509e-04   -4.610456342294751e-03   +7.189600988389290e-03   +1.594154939708649e-02   +1.113789919879617e-02   +1.960885112108116e-02   +1.476490602721357e-02   +1.247778783335456e-02; +7.150824266210140e-03   +2.126325153077751e-02   +3.141741752372850e-03   +1.945941553314628e-03   +7.328853586554369e-04   +2.432178745609914e-02   +1.039703054795397e-02   +5.223227972685151e-03; +8.790219913842044e-03   +5.552905279774186e-03   +2.560204022980603e-02   +1.314304032837885e-02   +2.143177013185017e-02   +4.483233465975216e-03   +4.557086782285733e-03   +1.229295971254299e-02; +1.496352962795841e-02   +9.150004284708715e-03   -1.665444678603020e-04   +1.179547264020677e-02   +1.102881618956388e-02   +6.375400358700557e-03   +1.706083802078364e-02   +1.830913154950672e-02; +5.859196488331851e-03   +9.652142635226041e-03   +1.659898400804520e-02   +1.267884010267294e-02   +1.104388471745525e-02   +2.846060676674360e-04   +1.973238665697200e-02   +2.402776857879083e-03; +8.692695895372070e-03   +1.421905538261204e-02   +1.095679349365692e-03   +3.487423595855171e-03   +1.912340175953752e-02   +4.530508662347353e-03   +1.442696310829940e-02   +1.231111594096165e-02; +7.036510977584285e-03   +3.939021731620033e-03   +3.306552509663480e-03   +1.793261685804070e-02   +4.636895274060212e-03   +6.864808078763033e-03   +5.068282136194216e-03   +1.967235793163204e-02; +8.712962524609576e-03   +6.382743234718984e-03   +3.600731625629767e-04   +2.185219025536955e-02   +3.759101698881211e-03   +1.093261080795653e-03   +1.227780275925177e-02   -2.172298797219965e-03; +1.014671801828866e-02   +1.042921708522104e-02   +5.931549772352080e-04   +1.099315490543222e-02   -2.648948033137147e-03   +1.282441451145071e-02   +6.034842752564574e-03   +1.784731251561353e-02];
L1E_L2E_iAMPA_netcon = [-3.336016841223191e-03   +3.568078304107408e-03   +2.089809052959055e-02   +1.689115952868372e-02   +1.202923728992418e-02   +1.739775848123449e-02   +7.443929088655902e-03   +1.741726556211469e-02   +7.519215070865894e-03   +6.352484704075808e-03   +8.776780552352755e-03   +9.825606684146717e-03   +8.828904992447064e-03   +1.764422682700864e-02   +1.365018640714886e-02   +1.449477065897628e-02; +2.756486496630043e-03   +1.858089125857673e-02   -4.689782206062270e-04   +3.815655132296216e-03   +4.024520972441444e-03   +1.685073860958788e-02   -1.595458618420659e-03   +5.338585187131841e-03   +1.584985178906053e-04   +3.743611202837352e-03   +8.865603135817961e-03   +1.589507162928189e-02   +3.493757891824500e-03   +4.705634942472700e-03   +8.841845961042059e-03   +4.712079224686257e-03; +2.602777737850884e-03   +1.545639261014523e-02   +1.909238589740745e-02   +2.090567365662257e-02   +2.452796113877597e-02   +3.240994998694337e-03   +8.048801931875665e-03   -3.589247402810250e-03   +5.674835812954370e-03   +1.644570867528640e-02   +5.837293415507675e-03   +6.965880988652144e-03   +8.912607124229074e-03   +1.045101019446689e-02   +1.808925582281482e-02   -2.126024276287807e-03; +1.270997739695796e-02   -5.103733768050211e-03   +5.044326000162125e-03   +3.118553093368577e-03   +1.838710881679928e-02   +1.065766408653464e-02   +1.822907359860088e-02   +1.797216934328036e-02   +1.447515597842193e-02   +1.550838668297388e-02   +3.151111939760287e-03   +9.681526210086220e-03   +2.329302250027691e-02   +3.240102606169524e-03   +1.955354506372805e-02   +2.116775088184483e-02; +2.110021635249376e-03   +2.002570245884247e-02   +1.341201909001925e-02   -1.391629480634291e-03   +2.555702422313774e-03   +1.380594946018177e-02   +1.724741441352540e-02   -3.857134718611952e-04   +1.277070360184910e-02   +4.561362988787281e-03   +7.105744417506984e-03   +1.870639533286640e-02   +3.397097940473391e-03   +1.291796473649282e-02   +2.311121672059019e-02   +1.438835339963044e-03; +3.034326682093605e-03   +1.735352584008104e-02   +7.060894479302298e-04   +1.851285903564980e-02   +1.915108465791103e-02   +2.048530381150411e-02   +9.585312835730199e-03   +1.291924072241873e-02   +1.205254047749383e-02   +1.141364981618694e-02   +1.371530005657503e-02   +2.066189762982148e-02   +1.639665632608136e-02   +1.136967712809657e-02   +4.739456423210714e-03   +1.705862678180366e-02; +5.261313129594881e-03   +4.987650379843808e-03   +1.428878902146308e-02   +3.599070423408710e-03   +8.138184927000641e-03   +1.116597277746063e-02   +8.621300092425802e-03   +1.293524501309529e-02   +1.179027662265254e-02   +1.530231713683907e-02   +8.261561446516217e-03   -3.297071035389806e-03   +1.026389253202213e-02   +1.223136657072278e-02   +2.946621249310325e-03   +7.519994043249729e-03; +4.563151249132838e-04   +8.732422853597354e-03   +9.683311731187876e-03   +8.783475386101155e-03   +1.199356270220425e-02   +2.186507753010956e-02   +1.176097121855047e-02   +1.317748273303343e-02   +1.736740424740014e-02   +9.625246334791861e-03   +5.915020046169494e-03   +1.931089837148684e-02   +1.589154720150080e-02   +1.552427757848035e-02   +7.753458125874050e-03   +6.166229051575494e-04];
L2I_L2E_iAMPA_netcon = [+1.303353832987928e-02   +7.592069367742710e-03   +1.554889800257781e-02   +1.049137709380503e-02   +1.754758041398289e-02   +8.689860658184841e-03   +3.078859895516651e-03   +1.463956107540527e-02; -4.667477380219101e-04   -2.757730210315547e-03   +6.219782245066596e-03   +1.442238102110320e-02   +2.145984081879097e-02   +8.284205326858416e-03   +1.291840928266665e-02   +1.270382143257316e-02; +1.801595051015046e-02   +1.884428066942409e-02   +1.395446959287625e-02   +1.531477746428678e-02   +1.372302055235102e-02   +9.808218581866993e-03   +1.007688474047973e-02   +1.253152586497240e-02; +4.727090675537488e-03   +5.764516536940086e-03   +2.150487851066256e-02   +7.672655558794301e-03   +1.865294944991682e-02   +3.193199301866445e-03   +2.563066037907215e-03   +2.242140258483291e-02; +9.116813867191745e-03   +1.655464149772622e-02   +5.705717129893859e-03   +9.032411113224779e-03   +1.576169667310029e-02   +1.239968811451529e-02   +7.378646998018467e-03   +1.657203483711736e-02; +1.439910177050350e-02   +2.484667973825147e-03   +1.683934966798501e-02   +1.301808367461891e-02   +1.147457156955725e-02   +5.252960949429437e-03   -9.511929654655295e-04   +1.853889308304798e-02; +1.989912096916803e-02   +7.122930037503986e-03   -3.439509041703599e-03   +2.139869866466729e-03   +2.352347413606216e-03   +8.968113287518177e-03   +3.787514553564964e-03   +4.420289578771423e-03; +1.630497978782610e-02   +1.695678045938375e-03   +5.350747816742949e-03   +9.738307106486703e-03   +1.770085028758897e-02   +5.099230079570910e-03   +4.215060787928311e-03   +4.485513273259382e-03];
L2E_L2I_iGABA_netcon = [+1.696721531158852e-02   +2.269791559815579e-03   +2.865058364673378e-03   +6.705585848754478e-03   +1.855143470738719e-02   +1.129291573073580e-02   +1.011361937582564e-02   +1.860843368698737e-02; +3.376514306709077e-03   +9.533811509409627e-03   +8.289188951316508e-03   +4.137442377715302e-04   +2.251695345885015e-02   +1.511086291406351e-02   +1.639267652062419e-02   -2.434140912414919e-03; +9.197845701098445e-03   +4.330561586688701e-03   +1.028831865937146e-02   +4.556387675100077e-03   +3.323246378214534e-03   -8.038601936386211e-03   +2.030886820825294e-02   +1.482549696712783e-02; +1.742347746089431e-02   +1.085020679944105e-03   -3.206771226875463e-03   +1.586231098452941e-02   +1.645210453620151e-02   +1.613589135897715e-02   +1.006478467263142e-02   +8.196148715943267e-03; +1.855855122185256e-03   +9.805377817678302e-03   +8.752870938345838e-03   +1.388357050705849e-02   +1.177347119627461e-02   +4.740199525606299e-03   +5.939741541982953e-03   +4.229419536173588e-03; +1.604476291476575e-02   -3.653402987103785e-03   +1.345272804604279e-02   +1.723959095510339e-02   +1.840111459917772e-02   +8.132972290520379e-03   +2.406073879360140e-02   +1.481370630388548e-02; +5.004108487676384e-05   +2.423515867925374e-02   +5.732730181300430e-03   -5.078052136821433e-03   +1.681681566107459e-02   +3.246628356119198e-03   +7.923713147144764e-03   +9.607292696860380e-03; +1.550598631560501e-02   +7.540640963891816e-03   +1.223956205807454e-02   +5.396198650627913e-03   +8.779496187884830e-03   +1.792200734924864e-02   +1.715076276225551e-02   +2.062506461328918e-02];
L3E_L2E_iAMPA_netcon = [+1.009269757474987e-02   +1.534518987839235e-02   +6.106922637453137e-03   -5.938295410395926e-04   -6.366647185917608e-03   +2.296198699765547e-02   +8.569284086533574e-03   +1.819029055321393e-02   +5.150795180340116e-03   +6.756912012167478e-03   +7.928928040660376e-03   +1.130698322175728e-03; +8.775950991169306e-03   +2.061867069502991e-02   +5.649766451543175e-03   +1.167708982066041e-02   +1.107827289956789e-02   +7.444110282800541e-03   +1.626241900746073e-02   +2.276199923171560e-02   +1.718035693162040e-02   +2.024115989495999e-02   +1.638953972929481e-02   +4.902507619644313e-03; +2.715449127968434e-03   +1.525481937909966e-02   +1.706636524319559e-03   +1.817077073952766e-02   -3.760277808256927e-03   -1.078359393027315e-03   +1.225026130799825e-02   +2.508274284282819e-02   +8.542514039442893e-03   +9.707013332234046e-03   +7.167113921148751e-03   +1.267091164313039e-02; +3.003255079528923e-03   +4.988461728606152e-03   +1.427165302832560e-02   +1.380027900679080e-02   +3.882982109337603e-03   +1.631465941788280e-03   +7.767545850667362e-03   +2.952318021560323e-03   +4.521725362756505e-03   +1.332278081540104e-02   +5.630870129393209e-03   +9.600580516091443e-03; +1.545943985171286e-02   +1.972524320945849e-03   +5.430140797550203e-03   +2.360536880736645e-02   +1.518504686927942e-02   +6.905837535984396e-03   +1.839834657701364e-02   +3.795153439515852e-03   +1.335239867372989e-02   +1.839380596161098e-02   +1.686646670179205e-02   +5.747163238768086e-03; +1.832617995900590e-02   +1.202946370566567e-02   +5.960993478112378e-03   +3.929050187645830e-03   +6.727061756330630e-03   +2.139505187779788e-02   +2.460846408122774e-02   +5.998526458445758e-03   +8.354325137807983e-03   +4.995637005337513e-04   +1.761035457923074e-02   +4.829473709298994e-03; +1.280890689723274e-02   +5.139304087245271e-03   +1.482225846356970e-02   +1.066531038999643e-02   -3.445055060795239e-03   +8.276946973107404e-03   +4.281168572655039e-03   +9.507771600523499e-03   +4.900228948332469e-03   +1.012116408183234e-03   +3.916005194335101e-04   +8.623674056769068e-03; +1.764809470415223e-02   +3.726695854879604e-03   -2.659646261768835e-03   +9.206109574530660e-03   +7.692375916196637e-03   +1.686598951544358e-03   +1.037515959801287e-04   +4.631895842217779e-03   +1.984476639931289e-03   +2.542728944073463e-02   +2.645063338605083e-03   +1.051263155074408e-02];
L3I_L2I_iGABA_netcon = [+1.871977707081452e-02   +9.713375037439726e-03   +1.512893436928866e-02   +1.447407936293413e-02   +1.792290939725365e-02   +1.107756302751241e-02   +4.482748025947619e-03   -3.055601592115234e-03   +2.318188645849936e-02   +1.166579513189969e-02   +1.898595290096173e-03   +1.928172209355216e-02; +1.590370744158171e-02   +2.506184943071224e-02   +2.145268932238274e-02   +3.821140346036558e-03   +7.904716265509740e-03   +1.508064120595340e-02   -3.871710924627287e-03   -2.454581452706109e-04   +1.220901775178302e-02   +9.964573377419005e-03   -3.194478895146183e-03   +1.118559406475095e-02; -5.718692165490665e-04   +1.013564755589623e-02   +2.124867293211058e-02   +4.942764987117898e-04   +1.849159113252560e-02   -3.710069244974475e-03   +1.074759856546477e-02   +1.873417041175993e-02   +1.174018130361130e-02   -6.323022754371732e-05   +1.094514220511075e-02   +7.265994996418959e-04; +1.930029809797626e-02   -1.029461994808594e-03   -3.077862693054302e-03   +1.442037355604043e-02   +2.000957687942926e-02   +1.281881807411970e-02   -1.957846284353296e-03   +6.407378426431552e-03   +1.752288214108803e-02   +9.227930750474646e-03   +1.811711418304164e-02   +1.541558340617528e-02; +6.395918542712267e-03   +2.539102936068188e-02   -5.099583637949609e-04   +6.183461663568993e-03   +1.111991435281250e-02   +1.756636693328611e-02   +3.176455240571010e-03   -2.247782218689818e-03   +1.649190177215481e-02   +1.539185775602793e-02   -3.700235909867604e-03   +7.157321444488409e-03; +7.521270932111720e-04   +1.841030092964954e-02   +7.715155821512616e-03   +1.259589973010842e-03   +1.579728958584865e-03   +8.544317068867305e-03   +1.552659511860555e-02   +1.617017302622961e-03   -2.852770320071346e-03   +1.181539977140050e-02   +1.177391651658983e-02   +6.174468405143252e-03; +1.714760539535619e-02   +1.376473644874871e-02   +1.093184185044545e-02   +2.036656450516148e-02   +7.297399485837371e-03   +8.081145405735972e-03   +1.000858465433542e-02   +4.245081590204176e-03   +1.149690641833394e-02   +7.329168311148822e-03   +7.346953957040115e-03   +8.839794101903973e-03; +6.536408131365352e-03   +9.965553836679432e-04   +1.056491607786637e-02   +1.130578978996984e-02   +8.155325787896054e-03   +2.816958179410714e-03   -1.566310553690085e-03   +4.242716584981087e-03   +1.221455640159449e-02   +1.430546086011062e-02   +3.501068037318857e-03   +1.178222554231793e-02];
L2E_L3E_iAMPA_netcon = [+1.343207162830120e-02   +9.411912249332740e-03   +9.910155459310970e-03   +1.372650244008866e-02   -1.047799353379256e-03   +1.073634318649502e-02   +1.843934333810438e-02   +2.210127311015986e-02; +1.386262850923282e-02   +1.491522971847632e-02   +1.666306144139185e-02   +8.698875965648722e-03   +4.198255017369769e-03   +1.411280974123329e-02   +2.127844025375227e-02   +1.040263204744602e-02; +1.637879952650738e-02   +1.949055949445281e-02   +2.418571956601658e-02   +1.658786689545265e-02   +1.293993984529712e-02   +1.573479701856973e-02   +1.304427408332288e-02   +1.687230371182089e-02; +8.840644166159999e-03   +1.401566960220154e-02   +1.609960143408066e-02   +6.806124009793509e-03   +9.634264202562066e-03   +9.739541190338744e-03   +2.006929734946136e-03   +7.419984358262018e-03; +4.285969503115759e-03   +1.108231910195379e-02   +9.372732215871084e-04   +1.689352008243790e-03   +2.837648491223316e-03   +8.932974073237078e-03   +1.451952661566377e-02   +1.661718611878553e-02; +1.437181212860061e-02   +2.211527937789609e-02   +1.932446444669380e-02   +7.432005685391843e-03   +1.497219523765721e-02   +2.493613277201793e-02   +1.051024511527099e-02   +1.538678777711536e-02; +6.807100626904737e-03   -3.633984253774940e-04   +1.137415850488527e-02   -1.139675475858587e-03   +8.292505548743169e-03   +2.109189761866933e-02   -8.051094957763203e-04   +1.250275984673674e-02; +2.289620318295045e-02   +1.729177034144945e-02   +1.332671059422913e-02   +2.160597996141708e-02   +5.280817480648041e-03   +1.808721132493956e-02   +1.497237154860272e-02   +1.024935083620504e-02; +5.824645157537782e-03   +8.816575154612087e-03   +2.104657378422781e-02   +1.446090250937973e-02   +1.076280785618572e-02   +7.272726576780251e-03   +2.033279717680581e-02   +1.662882094273004e-02; +4.822528229927172e-04   +8.628833742612647e-03   +1.140873399828365e-02   +1.928142105353467e-02   +2.168048807576025e-02   -9.771723802816821e-04   +3.104413740279387e-04   +1.554597593066812e-02; +1.414370831740475e-02   +7.400914882335050e-03   +1.346846732064399e-02   +1.874310249182722e-02   +2.466392341661943e-02   +2.133318299635787e-02   +4.927287812765873e-03   +6.726329408623100e-03; +1.486548524064603e-04   +1.162448670382226e-02   +8.004601574112022e-03   +1.732200903718798e-02   +1.210220264297845e-02   +4.964524919821291e-03   +1.754688892118085e-02   +2.051830748007490e-02];
L2I_L3I_iGABA_netcon = [+2.283242930328462e-02   +1.047250893555620e-02   +3.135854986279885e-03   +6.809607508901856e-03   +1.593212917679340e-02   +2.120553956638211e-02   -5.390281024939094e-03   +8.170775946698985e-03; +9.508973825504472e-03   +1.130250654622813e-02   +1.876184871075712e-02   +3.256045363196756e-03   +1.484032359465307e-02   +1.430674886861448e-02   +1.571571703037061e-02   +1.123687575294409e-02; +1.530222349476517e-02   +1.393624985170803e-02   +1.258351510191156e-02   +1.524125733161308e-02   +6.722306515585879e-03   +1.036383793113328e-02   +4.246716097965537e-03   -1.819421630877863e-03; +2.440546647614960e-03   +1.920236751602434e-02   +8.093936492745094e-04   +6.688879641111396e-03   +4.690399014275627e-03   +8.487493812745051e-03   +7.349771526143927e-03   +2.074558290800296e-02; +9.748017859469577e-03   +1.015463750402011e-02   +1.111240940550636e-02   +5.438341395279685e-03   +7.703107525948731e-03   +9.478217771569077e-03   +1.862843839086648e-03   +7.984247783452870e-03; -1.998859682637862e-04   -4.312471182957314e-03   +1.079988928490809e-02   +4.993710897706895e-03   +8.158923684337755e-03   +1.080607028158716e-02   +1.209272774723619e-02   +2.022371698140233e-02; +5.001253143584937e-03   +1.006277289585978e-02   +1.874200775869456e-02   +1.512696412419723e-02   +1.103282688634870e-02   +5.814788783135775e-03   +8.038445576841524e-03   +1.016822796379002e-02; -7.302249104906181e-03   +2.591277499485548e-02   +7.717738082505273e-04   +1.163695674975800e-02   +8.084849015994985e-03   +1.682249134003787e-02   +1.331062675028786e-02   +6.859979115090924e-03; +1.743599540236982e-02   +1.420400191308582e-02   +1.816570224783622e-02   +2.871713893930344e-03   +9.646168680781837e-03   +3.326987983813129e-03   +7.856189310906016e-03   +1.307746014075470e-02; +1.431129301755580e-02   +1.544023802227486e-02   -1.547091509875163e-04   +9.673423822290939e-03   +5.950224755675411e-03   -1.674361634030360e-03   +8.768635606073888e-03   +9.327239406512143e-03; +1.768451556434381e-02   +2.214352560852642e-02   +5.646687137920850e-03   +1.361817820979619e-02   +5.756410828229159e-03   +8.237270129616538e-03   +1.273969168298456e-02   +2.699136870206002e-03; +1.476367920892083e-02   -2.822833135778745e-03   +1.107318546874062e-03   +2.334740537231190e-03   +3.704197315907971e-03   +1.491688849493939e-02   +1.126385433305124e-02   +1.081571118432386e-02];
L3I_L3E_iAMPA_netcon = [+6.220744087040032e-03   +1.819795306724516e-02   +8.459592781532981e-03   +1.506106085220212e-02   +1.942591231983312e-02   +1.217577171019180e-02   +7.549452102973318e-03   -4.324437469935105e-03   +1.490900836131796e-02   +8.830603430036723e-03   +5.493846740041999e-03   +5.377121537515665e-03; +8.701505376911178e-03   +1.548097179052836e-02   +3.463782974522453e-03   +2.748764375710819e-03   -2.722756179290198e-03   +1.199526128551260e-02   +1.263846429635881e-02   +7.177335744614277e-03   +7.829857541518465e-03   +1.109264166756220e-02   +1.824467463005216e-02   +1.349280627876675e-02; +1.866417953643889e-03   +1.445889108275745e-02   +6.341888369750670e-03   +1.483174500223858e-02   +1.429133431940285e-02   +8.608056068219650e-03   +7.139451689517487e-03   +7.259627796768380e-03   +1.660564216388179e-02   +1.231314664432970e-02   +1.134309688793811e-02   +1.589507893775192e-02; +8.713426201052170e-03   +1.309794546962481e-02   +9.874499239038371e-03   +7.974620042490423e-03   +1.284197820788067e-02   +2.011737267564477e-02   +1.607732722888604e-02   +7.743520468898168e-03   +1.710342621424252e-02   +1.932814326148485e-02   +1.081296016560530e-02   +1.548233936508244e-02; +3.534835509195648e-03   +7.635011345787941e-03   +3.874790602519764e-03   +1.243491709062762e-02   +1.421184919917618e-02   +1.044088149538741e-02   +2.133038491825744e-02   +1.604344331457188e-03   +1.496530531192593e-02   +4.929542039601543e-03   +8.699718305606780e-03   +4.793216373895069e-03; +3.296094510799141e-04   +8.294640444254013e-03   +2.156845682342250e-02   +9.999774476081592e-03   +2.011514741447718e-02   +6.852133571231186e-03   +1.584776827479442e-02   +3.582075114544806e-03   +1.514596509276523e-02   +7.595531763732503e-04   -4.368529313005396e-04   +6.177331091526555e-03; +1.708974435173541e-02   +7.198579711922586e-03   +1.198850699048617e-02   +3.028875764308449e-03   +9.461542130934706e-03   +4.960379589901353e-03   +9.507520347616429e-03   +2.148432332906479e-02   +1.533278616958363e-02   +1.972834751464752e-02   +5.420028108661296e-03   +1.686212126737572e-02; +1.596958611391196e-02   +3.919479888211492e-03   +1.269204410384487e-02   +1.210168698527448e-02   +2.274202836603290e-02   +1.253032334243720e-02   -3.028556977036175e-04   +1.247896506528480e-02   +8.756454433835371e-03   +2.711665331501938e-03   +6.965998550232007e-03   +1.975154464557327e-02; +5.157209675431548e-03   +1.470897969050501e-02   +1.246807639872085e-02   +1.249721460469340e-02   +9.074509232556524e-03   +1.477948095786470e-02   +1.533269898179700e-03   +1.954344763870486e-02   +1.159143541864133e-02   +1.032939315934045e-02   +6.554383923464303e-03   +8.442025671457408e-04; +1.380422540991682e-02   +1.676170338604340e-02   +1.485755685181440e-02   +5.918163810578659e-03   +1.134209381808180e-02   +2.000969188956260e-02   +8.640664871195403e-03   +2.472181692458031e-02   +1.486868792688879e-02   +5.463837551535219e-03   +1.256623126109670e-02   +6.226110726396441e-03; +1.334361245648796e-02   +8.534620901761023e-03   +1.890269333862610e-02   +2.459266318697690e-02   -3.969471003869653e-03   +1.759734033568520e-02   -1.840158247965963e-03   +7.972791760098283e-03   +3.605717927202065e-03   +1.810079962301077e-02   +8.519103040224154e-03   +7.656528599434929e-03; -8.894249240306452e-04   +5.525389951785537e-03   +2.691934706426356e-03   +1.859481892423309e-02   +1.060835694315011e-02   +5.474414438436968e-03   +2.038253697691340e-02   -2.797201029451381e-04   +4.053780604395705e-03   +5.375786957707107e-04   +1.952332001950067e-02   +7.496120640706006e-03];
L3E_L3I_iGABA_netcon = [-1.272466077256772e-03   +1.275005678980344e-02   +4.141832563268085e-03   +2.206064999655380e-02   +1.260087516522993e-02   +1.506838330573179e-02   +1.030126374780122e-02   +1.052333378381431e-02   +6.447454635504452e-03   +1.359928982686991e-02   +1.174495759130052e-02   +4.572114949905306e-03; +1.374335144854952e-02   +1.482022747401099e-02   +7.236477660238580e-03   +6.326512126821554e-03   +3.605582734644604e-03   +1.528537658634247e-02   +1.466219383669885e-02   +2.106605166989378e-02   +1.739650428902524e-02   +8.716699241630224e-03   +3.505913385426590e-03   -2.414863262047483e-03; +4.742779972524812e-03   +2.060102080067962e-02   +1.252946907055562e-02   +1.330960821890827e-02   -2.436877812037185e-03   +1.910193775146618e-02   +1.418759554614366e-02   +1.829715765171757e-02   +3.973096349904550e-03   +1.149915721336373e-02   +8.238108582604825e-03   -1.189578505945422e-03; +4.602020305521728e-03   -2.874648816819593e-03   -8.504312145839394e-05   +1.865842532406404e-02   +1.296863861574277e-02   +5.009987128312971e-03   +2.673548703969643e-03   +8.974011348472370e-03   +1.637867900183402e-02   +1.576232736739546e-03   -4.172168926844185e-03   +1.341493567678661e-02; +6.420639212803442e-03   +1.030075817757689e-02   +2.260787344628552e-02   +4.911313480766671e-03   +4.915155447120218e-03   +1.565159689191878e-02   +2.690128709309192e-02   +2.079310579630535e-02   +2.564936758665648e-03   +1.183422172693631e-02   +2.419762745539107e-02   +2.267150186110359e-03; +1.692005795551026e-02   +6.884791680504307e-03   +1.574781972803729e-02   +5.397922487315387e-03   -1.293401107698437e-03   +2.503918707984584e-02   +6.832554003925370e-04   -5.409754055334790e-03   +1.128353988665380e-02   +1.244515870574610e-02   +6.553491202987435e-03   +2.588534140324067e-03; +8.662365727052309e-03   +1.271545674660832e-02   +7.402121911212856e-03   +1.443287450178940e-02   +9.351025359330446e-03   +7.842990783738140e-03   +2.121681013469307e-03   +3.672799825185309e-03   +1.375375108247015e-02   -3.138571972699851e-04   -4.477353101045544e-04   +1.311713682966805e-02; +4.899621845220266e-03   -3.361965868204011e-03   +8.755158541144991e-03   +1.753591807950328e-02   +1.009678747732754e-02   +1.440789625056560e-02   +9.875490187865531e-03   +1.629375974574412e-02   +1.687186375939611e-02   +1.821873721714664e-02   +1.101964929776487e-03   +1.628218888898116e-02; +6.440340380990665e-03   -6.052697283630672e-04   +1.984051513322384e-02   +1.962101963200861e-03   +1.820204712167076e-02   +1.727973092363018e-02   +9.779542353246184e-03   +2.076273615813866e-02   +4.962202386829687e-03   +6.265823483847628e-04   +3.791843983951086e-03   +9.684198618852263e-03; +1.927899482592769e-02   +9.810134491761354e-03   +1.754449935310830e-02   -1.420318199851819e-03   +1.525332172062284e-03   +2.680741661687387e-02   +1.275734608592169e-02   +8.810520360677917e-03   +2.141847079603895e-02   +1.883625310805058e-02   +7.103098259707491e-03   -1.510332531967582e-03; +8.908494041782202e-03   +3.744696536254997e-03   +5.444877268723677e-03   +7.340159155620467e-03   +1.495925419387711e-02   +1.387126669506620e-02   +2.115886165109599e-02   +1.536323765156616e-02   +1.430148490475780e-02   +5.180663774963428e-03   -5.731040837531557e-03   +1.481015018611905e-02; +7.917593910678323e-03   +7.766757102576586e-03   +1.500882813890558e-02   +1.153623221832432e-02   +2.241287661134537e-03   +6.947168848870293e-03   +1.974512061583915e-02   -4.404554033529379e-03   +2.124259038040820e-02   +1.277137774517114e-02   +1.156491949508779e-02   +8.171022224270854e-03];
L2E_Input1_iAMPA_netcon = [+1.920180523795716e-02   +2.093885138978718e-02   +1.390644923454850e-02   +2.189929459010695e-02   +2.194740674538672e-02   +2.686635926409386e-02   +2.059228687901118e-02   +1.289321613693338e-02];
L2I_Input2_iAMPA_netcon = [+1.514052911518598e-02   +2.088665301809985e-02   +2.451383583916734e-02   +1.305612616022136e-02   +1.511984892940597e-02   +2.127926290959586e-02   +1.626089623609338e-02   +2.009298878689711e-02];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last =  11.21 * ones(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.0*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.2*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.0*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.2*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.0*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.0*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.2*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.0*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.2*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.0*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
