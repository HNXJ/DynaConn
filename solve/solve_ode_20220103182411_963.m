function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+7.126479162463089e-01   +9.499108328178568e-01   +6.979023571529290e-01   +1.656177976775416e-01   +9.167331017105046e-01   +2.162157210555677e-01   +7.416497051039006e-01   +3.095817423731678e-01   +5.423364967759413e-01   +8.436218027934343e-01   +9.743466046546955e-01   +9.705890665700275e-01   +6.997490102581121e-01   +3.639479727029106e-01   +2.978722590959046e-01   +3.853647842964433e-01; +3.474201337096187e-01   +8.703190808918324e-03   +1.410878881714674e-01   +1.684458247085932e-01   +7.450393744846712e-02   +8.124062747781314e-01   +7.939875128217686e-01   +7.590746001613183e-01   +7.934984215078869e-01   +1.918948220955802e-01   +4.695678346870401e-01   +6.649135949603356e-01   +3.703304069440999e-01   +2.746372271048407e-01   +6.912142652003065e-01   +9.687723474153063e-01; +2.063752844686631e-01   +4.759713396288743e-01   +8.610941406953135e-02   +7.055260706898043e-01   +3.189486433684654e-01   +3.837150325428090e-01   +6.566304194909244e-01   +9.558687789133081e-01   +5.166389844927431e-02   +9.274055922937400e-01   +8.683246574674269e-01   +2.025273564427479e-01   +5.500496606232027e-01   +7.516608546036266e-02   +7.839206764571278e-01   +8.103672059776632e-01; +2.537199058431519e-02   +4.887198777900818e-01   +4.284847600938775e-01   +8.371138427627808e-01   +6.382126292684029e-01   +8.585982870269998e-01   +4.411941148357436e-01   +3.699067999867518e-03   +4.622289268274097e-01   +4.242785533485278e-01   +9.442678356098519e-01   +8.996991538904250e-01   +5.140701401228909e-01   +1.583395535257363e-01   +7.151795593465010e-01   +8.910930712145153e-01; +7.701304573399702e-01   +5.165422909931552e-01   +9.000804476249723e-01   +8.551461091906452e-02   +9.045042859170058e-01   +3.238233071286813e-01   +5.811956095442077e-01   +3.973308101472072e-01   +9.363887578859074e-01   +3.039220691407558e-01   +2.435337743820760e-01   +4.808454315738568e-01   +7.702012488033075e-01   +3.634642710021811e-01   +2.704631191645979e-01   +6.949723085281312e-02; +5.710875658830454e-01   +2.901212736741707e-01   +7.149629640778405e-01   +8.361120309544668e-01   +7.996731999529902e-01   +3.784936825945782e-01   +5.143610891136047e-01   +1.554985108062741e-01   +4.823297338338711e-01   +3.533940638747216e-01   +9.234263158368784e-01   +6.703065377895856e-01   +7.563909445384728e-02   +7.154039025542761e-01   +1.673217950798540e-02   +8.999331797285406e-01; +5.792984975728139e-01   +5.570589187594499e-01   +6.881772904090976e-01   +5.540564081947581e-01   +6.469759180380621e-01   +6.419764357469419e-01   +7.306932542135601e-01   +8.288899213793667e-01   +7.816050799259752e-01   +9.764600549474853e-01   +6.344837141005230e-01   +5.310965388480444e-01   +2.650162075933159e-03   +5.402190446039344e-01   +1.531407151694500e-02   +6.741819589402159e-01; +3.909623757154309e-01   +5.223754637794830e-01   +2.051448249748316e-01   +9.644152000811183e-01   +4.486487032009647e-01   +3.922391929274188e-01   +2.231226225679531e-01   +2.845098765046981e-01   +1.097902493229790e-01   +5.363935070608211e-01   +2.869491936151647e-01   +7.078342161976299e-01   +4.004121844284742e-01   +2.332907313241553e-01   +9.284076169121944e-01   +3.445241723945199e-01; +5.494717217822793e-01   +6.716606727144205e-01   +5.239437498032623e-01   +6.695952369409220e-01   +7.496135221407267e-01   +7.486687296215166e-02   +9.985273875057621e-01   +9.837481812582166e-01   +5.226561074389753e-01   +7.974415475344258e-01   +8.527845167347057e-01   +7.155126491518252e-01   +6.652262496582397e-01   +4.663705307978462e-01   +9.349000975502969e-01   +8.397488277523760e-01; +1.874133859198636e-01   +6.179903189399455e-01   +8.208095381803850e-01   +3.391588988285585e-01   +8.296923451189017e-01   +1.334524645216375e-02   +6.192344511249235e-01   +6.250711197483386e-01   +6.410309842842401e-01   +8.030425398336596e-01   +1.620048634897451e-01   +2.995990083895100e-01   +3.762535936754275e-01   +7.217794708643739e-01   +3.714017310042683e-01   +1.981246700912113e-01; +1.138045419056484e-01   +5.673035280500042e-01   +1.844390785755680e-01   +2.103404566397293e-01   +3.464389782133932e-01   +8.781050545350398e-01   +9.949057911944973e-01   +7.415021583747627e-01   +5.795242725834095e-01   +1.383648882442047e-01   +8.251730421691210e-01   +1.077285175254161e-01   +3.998208436270330e-01   +5.184609889305164e-01   +1.008421760401423e-01   +8.453814223432897e-01; +5.503094043366824e-02   +5.066026356881115e-01   +5.155935862749772e-01   +5.691875658913838e-01   +1.547722652635979e-01   +1.639497312361239e-01   +4.951298760760841e-01   +8.859089636936887e-01   +8.376398457011269e-01   +4.525899196341819e-01   +2.164892946701852e-01   +3.346154748070909e-01   +1.396060313601847e-01   +5.128686304666151e-01   +7.185610583348278e-01   +4.265019457568607e-01; +9.360787958997314e-01   +6.681920873428078e-01   +3.525632734599261e-01   +3.056597670637616e-03   +5.031155659057298e-01   +9.199808967360071e-01   +5.325052530577872e-01   +3.325465987805012e-01   +1.154187305010906e-01   +4.550269277909497e-01   +2.772092399663472e-01   +4.595402737301700e-01   +3.428908889157569e-01   +3.982214158366576e-01   +4.564819024058028e-01   +5.578967751400731e-01; +7.443708412591099e-01   +6.331145408953990e-01   +6.524923040915014e-01   +5.927550973364190e-01   +4.109208398015066e-01   +5.635293550718717e-01   +8.626138391103370e-01   +9.537463945733234e-02   +5.513459048541462e-02   +9.638742575686904e-01   +9.165166698480864e-02   +7.206678695307027e-01   +1.217414718165966e-01   +4.785245841845131e-01   +1.312622864652341e-02   +4.457800466364719e-01; +2.362166581828872e-01   +1.448121738462381e-01   +2.827179570517175e-01   +8.980072368636257e-01   +1.717488199417844e-01   +9.258089084934435e-01   +2.532351306371360e-01   +4.446699383264692e-01   +5.192187130503723e-01   +5.143154131193126e-02   +9.211268751924651e-01   +4.036201889856142e-01   +3.699678093406389e-01   +7.474279254414916e-01   +1.195656450578892e-01   +7.650169974967703e-01; +2.034099470270407e-01   +1.824439616288165e-01   +4.348568120778794e-01   +2.565727312310307e-01   +4.967826749909648e-01   +5.981791919342048e-01   +5.784038026978042e-01   +2.397895165620040e-01   +7.010161435124737e-01   +3.525217954881333e-02   +7.313922077956592e-01   +2.465718727538140e-01   +2.475627399435533e-01   +7.059647555111648e-01   +6.652911909492394e-01   +9.584613481695438e-02];
L1E_L1I_iGABA_netcon = [+8.477153367116272e-01   +7.545532580771486e-01   +8.742654809572129e-01   +4.358012384969824e-01   +9.201031495789450e-01   +7.722242851513212e-01   +3.240688495054680e-01   +6.434748922350335e-01   +9.157714099864381e-02   +2.775423908055517e-02   +1.266143410846033e-01   +5.207498829731491e-01   +8.832546873174567e-01   +5.753652876306197e-01   +1.713112994866257e-01   +6.446929371820602e-01; +6.216068709424685e-01   +9.973680196270220e-01   +3.145285938585096e-01   +1.407516331709157e-01   +8.956350421627833e-01   +2.786850335970054e-01   +9.694329548701545e-01   +4.451054435865138e-01   +2.963834323394575e-01   +5.099228347035037e-01   +4.386971405726647e-01   +2.037527165738168e-01   +8.084990085883338e-01   +2.922818130325857e-01   +5.047592035258106e-02   +3.391289734331604e-01; +6.684712531227222e-01   +3.730099783972591e-01   +4.310459415218323e-01   +6.556515699174684e-01   +5.852581464383962e-01   +5.214963805192473e-01   +3.548016373522070e-01   +4.835627073525782e-01   +3.344423084708933e-01   +8.716687485580420e-01   +4.835957555506464e-01   +7.767153628251794e-01   +6.522107282028715e-01   +1.455327878877549e-01   +2.258656933139995e-01   +1.509201593329410e-01; +7.866103495540557e-01   +5.085198153992851e-01   +3.798846457842865e-01   +7.330784768263441e-01   +8.392333764605668e-01   +4.155110347065715e-01   +3.223663171282496e-01   +9.705285415431811e-02   +4.795400992177391e-01   +5.828588559686910e-01   +6.796858072373161e-01   +3.872158475846693e-01   +7.360523279424446e-01   +4.590438285892613e-02   +2.012456670262471e-01   +3.998619827996735e-01; +3.150685835353747e-01   +7.604204135204194e-01   +6.567599628404038e-01   +1.705125035877877e-01   +7.845570524439857e-01   +7.861516781479990e-01   +9.191580127757571e-01   +8.069055293920857e-01   +2.431822327976014e-01   +4.250987586192396e-01   +3.503755745332707e-01   +6.510035067364066e-02   +6.701901636482401e-01   +6.212994949345780e-01   +2.101154901889519e-01   +9.222077623999480e-01; +3.245181541067554e-01   +1.353100551193472e-01   +2.481809732136587e-01   +3.403553852250190e-01   +7.926617921791077e-01   +2.823844366764451e-02   +8.848071980048156e-01   +6.355233710484831e-02   +4.609839253567203e-01   +7.260815312300766e-01   +4.849368999149398e-02   +7.514251790743439e-01   +8.875229616865838e-01   +6.069050129533861e-01   +5.839361707388766e-01   +1.590724304764233e-01; +6.274839830442497e-01   +5.176908835501669e-01   +6.878834352964571e-01   +9.972371136794490e-02   +7.004417683725318e-01   +4.059314136331302e-01   +3.619841125171298e-01   +9.546931835503226e-01   +7.588206383847985e-01   +2.287578442065094e-01   +2.935219639334490e-01   +4.610487578214002e-01   +8.550104085221377e-01   +3.751183690776193e-01   +3.356093414753263e-02   +4.631984361769414e-01; +9.030137358380039e-01   +9.133778913142908e-01   +3.292686288101188e-01   +4.449906172094253e-02   +1.408194621185406e-02   +8.341944679500782e-01   +7.425682239040323e-01   +7.757139745994578e-01   +7.149352259135137e-01   +5.894100271395535e-02   +8.097646403258634e-01   +3.095881954724021e-01   +4.066499593037006e-01   +8.373397433841969e-01   +7.995575202575754e-01   +8.171984178413945e-02; +3.733006239513343e-01   +9.702399610350990e-02   +8.827964864832823e-01   +4.774367486740752e-01   +3.289230400227132e-01   +5.918783968070640e-01   +1.186656621639502e-01   +4.504396796030034e-01   +2.365911665985403e-01   +9.769422380241130e-01   +6.534602649891422e-01   +2.693647720619651e-01   +1.158301768678785e-01   +5.195805415285970e-01   +1.407205723196113e-01   +3.410625935241769e-01; +8.889866948852126e-01   +1.888425948300417e-01   +9.978977290588527e-01   +4.774268291967234e-01   +9.561791525332624e-01   +2.105478676556641e-01   +5.980364423181171e-01   +1.666218153554262e-01   +6.993119663567617e-01   +9.756722398136954e-01   +7.146001370960705e-01   +5.766107185261944e-01   +4.123369133538486e-01   +8.193383279107882e-01   +5.782027271617639e-01   +4.936988673463910e-01; +1.158031508470747e-01   +1.742298134796149e-01   +6.911249372503920e-01   +5.546688108623474e-01   +4.066963417792771e-01   +2.952254809054491e-01   +4.355330092912830e-01   +7.939344328672948e-02   +3.029038839688097e-01   +1.269431444924870e-01   +7.580756355965531e-01   +9.134924948438078e-01   +3.336704523396183e-01   +5.866992655900614e-01   +8.476214274425457e-02   +5.034285428170245e-01; +9.101173468642028e-02   +5.362177578068649e-01   +3.531358563008065e-01   +6.460601285800979e-01   +6.275777241896913e-01   +2.712929610643633e-01   +9.701149379751437e-01   +7.448729557920422e-01   +4.724443910248322e-01   +6.308365680358214e-03   +3.911010854718408e-01   +4.511651561686164e-01   +1.067534174678981e-01   +7.132059234510356e-01   +2.261549522238417e-01   +1.312242870808031e-01; +5.428974026991885e-01   +9.774323809800766e-01   +5.606049181414132e-01   +3.526822895051357e-01   +8.528188582685211e-01   +9.429924940988857e-01   +9.805509799310355e-01   +5.354204278728736e-01   +4.343935601873167e-01   +9.379173944780487e-01   +3.632151284827539e-01   +9.798197379429230e-01   +8.646860653801191e-01   +7.360057480803537e-01   +4.382224073457907e-01   +7.666129829090021e-02; +6.025819597848817e-01   +8.455938964970766e-01   +8.980795914976055e-01   +2.549428178485833e-01   +3.720282723998090e-01   +5.590970899951316e-01   +2.498697014600548e-01   +4.899092923483334e-01   +7.336988570059965e-01   +7.431305667050044e-01   +8.143695152478791e-01   +1.049142544751720e-01   +9.025640462183087e-01   +4.483840269942477e-01   +1.751637760112328e-01   +6.713542691975870e-01; +7.263513137539220e-01   +6.680148121595386e-01   +6.508309669170897e-01   +1.821521331063269e-01   +2.057992191374970e-01   +4.382673844526870e-01   +7.793153939411938e-01   +8.910698310509255e-01   +8.772955369889159e-01   +4.284705338121707e-01   +3.908397123513852e-01   +4.211366742506341e-01   +6.954827615617528e-01   +2.788228138593862e-01   +4.189755101014421e-01   +1.184365947716685e-01; +9.941422762644689e-01   +1.591920252784632e-02   +3.823883123687985e-01   +4.786773136910305e-01   +9.109078274810906e-01   +3.231946842644344e-01   +7.133454237369082e-01   +5.911934079292910e-01   +9.116241194704937e-01   +9.477969700553736e-01   +8.759411124348326e-01   +3.933663280370895e-01   +7.495075560862846e-01   +1.574379790535005e-01   +9.709433018993410e-01   +9.860758758105455e-01];
L2I_L1I_iGABA_netcon = [+5.720455062955802e-01   +5.653989998718917e-01   +1.045502115334912e-01   +4.555372173880447e-01   +7.992723239376506e-01   +9.680142980749948e-01   +2.224420543016788e-01   +7.540898643701545e-01; +5.563403140589697e-01   +9.502589847025086e-01   +1.380960910075848e-01   +5.692368059199171e-01   +5.429285443810316e-01   +4.253935734351890e-01   +6.141864780628835e-02   +4.994313015326847e-01; +6.044677684162910e-01   +1.612097609734401e-02   +4.374792261670410e-01   +8.186371508874073e-01   +2.603640086435838e-01   +3.894803977210142e-01   +8.348266092797924e-01   +8.237504181671399e-01; +4.673522265491995e-01   +1.199837712648860e-01   +9.320146165553347e-01   +3.616385288558739e-01   +7.787788828845241e-01   +4.576120536498687e-01   +4.057366201213168e-02   +9.136452937035294e-01; +4.351165357778671e-01   +8.561273636558623e-01   +1.387624204370850e-01   +2.412394413482914e-01   +7.822772260863612e-01   +1.293446468940914e-01   +9.119242527384044e-01   +7.053034488781399e-01; +6.980154215877894e-02   +2.181920424551849e-01   +8.183624697774046e-01   +7.645440214284538e-01   +1.497240700649841e-01   +4.656819729240149e-01   +4.548293163748711e-01   +8.056869398288345e-01; +6.367203543424473e-01   +7.005652732070482e-01   +9.339552935206032e-01   +8.771098003559503e-04   +8.301860217707181e-01   +2.671265874157221e-01   +2.833498313878661e-01   +9.647052570061547e-01; +4.277238407218278e-01   +7.779944872493951e-01   +5.736805330021103e-01   +2.781020650600996e-01   +6.226219606750200e-01   +1.047842978314197e-01   +7.559256936533301e-01   +9.471981295729881e-01; +7.544952120569477e-01   +4.244301614503965e-01   +4.947528237072122e-01   +3.295017112334308e-02   +4.612376455479683e-01   +6.585879709601418e-01   +9.287286511642768e-01   +2.952185851740709e-01; +3.066393580211733e-01   +7.322798297147095e-01   +9.251673589344744e-01   +6.685153327839329e-01   +4.921094792080232e-01   +9.354444787833056e-01   +1.381329680001751e-01   +3.591760311604334e-01; +6.008821048247016e-01   +4.510541198940600e-01   +8.620176314823307e-01   +9.755384810702386e-01   +2.188597304188388e-01   +7.701140544074359e-01   +9.488193522373211e-01   +5.438541081625539e-01; +3.303787542334513e-01   +8.047416238706943e-01   +2.489211186461587e-01   +9.444248824903908e-01   +8.555788829760717e-01   +3.991090115202022e-02   +3.158208746676882e-01   +2.101701000555854e-01; +6.455379401737592e-01   +4.316846303632869e-01   +4.537934125225467e-01   +5.256447623636551e-02   +8.817619146577095e-01   +2.602935536829999e-01   +2.025667982700185e-01   +7.724861450418852e-02; +2.527905484066510e-03   +1.484676964405550e-01   +7.331975129596576e-01   +2.885068811050193e-01   +8.354723749303310e-01   +6.455284301325122e-01   +4.645700672506913e-01   +5.074004386848326e-01; +1.451028159440020e-01   +8.006405780740030e-01   +7.484213009366109e-01   +4.779780607620079e-01   +4.405538486404006e-01   +8.879457993810795e-02   +5.993882442449872e-01   +1.951444128052819e-01; +2.529787660768826e-01   +3.734129854761308e-01   +2.347431171915516e-01   +8.874001115706748e-01   +5.429933403262647e-01   +7.587579637343313e-02   +5.463858205866641e-01   +1.407671500889525e-01];
L1I_L2I_iGABA_netcon = [+7.148630783421274e-01   +8.753149137919911e-01   +6.139144645097356e-01   +5.223891008012442e-02   +1.523802815945987e-01   +2.357656305210415e-01   +8.468574455753917e-01   +3.723841712721510e-01   +7.153703401944528e-01   +3.917898160451063e-01   +2.456535827172318e-01   +6.814278504211624e-01   +1.631300273070164e-01   +5.742015825862633e-01   +4.887152323506175e-02   +4.888246529228372e-02; +6.088412329344520e-01   +8.007030733633396e-01   +6.182266953627522e-01   +5.185599581629890e-02   +7.495275263145493e-01   +5.545946685546995e-01   +1.986243538907476e-01   +5.704836917315510e-01   +1.958317088207463e-01   +7.289636191403935e-01   +5.109484236380194e-01   +3.387246107918325e-01   +1.142646804050890e-01   +8.173728114171146e-01   +4.371465906843066e-01   +9.253114809445173e-01; +1.620084465408969e-01   +6.216979276253685e-01   +3.156747596433221e-01   +6.051874956291244e-01   +9.519828585071051e-01   +1.178919052859214e-01   +6.145855921895790e-01   +8.394286747650500e-01   +2.360332843838581e-01   +6.352561921696310e-01   +7.367133960487701e-01   +5.499366736025163e-01   +7.474625326040745e-01   +6.794665275309918e-01   +9.249363840076852e-01   +1.795387075183165e-01; +4.854265424167875e-01   +4.827512795206102e-01   +1.341401292294656e-01   +6.657059788966097e-01   +2.617358863939729e-01   +8.255281503401948e-01   +1.603165692395135e-01   +7.167956979302293e-01   +9.947517527175040e-01   +9.513667723597748e-02   +7.848455682458998e-01   +5.358054831799687e-01   +2.179736344439329e-01   +4.437629157973695e-01   +8.860082685850146e-01   +7.493380764532408e-01; +2.877640526888980e-01   +2.202024319966606e-02   +6.049833938582566e-01   +4.904663080061831e-01   +9.024507779488543e-02   +6.544331395179283e-01   +5.831277606237132e-01   +1.129005795356884e-01   +9.069720370128135e-01   +5.017516731468035e-01   +6.844153410861026e-01   +9.071686223022711e-01   +4.894726494896520e-01   +8.964567008651668e-01   +9.370155808249060e-02   +4.705184626524429e-01; +3.996210063525539e-01   +1.291225384618369e-01   +8.991927389631286e-01   +9.841408611351397e-01   +2.308257533494575e-01   +2.293139796554122e-01   +5.461352358299102e-01   +7.472832217253764e-01   +1.342649626589001e-02   +5.583515126898418e-01   +8.161782765214678e-01   +2.859864035643729e-01   +4.594988087541164e-02   +7.885562006396583e-01   +6.869606326303942e-01   +2.482809451537439e-01; +4.939545378531539e-01   +7.235045906731105e-01   +5.730621470242171e-01   +8.657126883234958e-01   +8.978621884944689e-01   +3.045888191778547e-01   +6.925353670862401e-01   +9.231932051428782e-01   +8.403511695366758e-01   +5.501856899417316e-02   +4.295510395001749e-01   +1.373730676333383e-01   +5.826150641953912e-01   +5.916191841137474e-01   +1.364218385813120e-02   +6.626970372705991e-01; +8.664176311704889e-01   +6.719475391292062e-01   +6.418404181712436e-01   +9.617147822534421e-01   +1.997829993863267e-01   +3.280684252451339e-01   +7.022507543965374e-01   +9.320534011792131e-01   +2.560533966968752e-01   +8.499266721060116e-02   +4.930886710191449e-01   +9.593004558516028e-01   +4.975221986154191e-01   +6.254704536929830e-01   +1.278734722671842e-01   +6.183312472860024e-01];
L2E_L1E_iAMPA_netcon = [+3.708938353935244e-01   +5.650862838758222e-01   +2.002952431176973e-01   +5.193288995371401e-01   +2.918376569753286e-01   +7.205435472967339e-02   +2.834756092271301e-01   +2.631961611907310e-01; +4.365147431619145e-01   +1.885186002857908e-01   +1.456572104196971e-01   +6.841366321450928e-01   +6.131598750554735e-01   +5.915387033147851e-01   +9.307147371196105e-01   +8.996505503693595e-01; +7.237432099392919e-01   +6.038993996171620e-01   +7.430236551959861e-02   +2.160611924673666e-01   +8.647771003859621e-01   +7.822469455868378e-02   +7.548932081923130e-01   +1.571167301257805e-01; +1.981083314614628e-01   +7.280305067408455e-01   +9.269619815609459e-02   +9.711313817934456e-01   +8.150359907036749e-01   +3.927256032982377e-01   +2.577426527369798e-01   +5.482762400353212e-01; +4.742531516076506e-02   +8.359267136578283e-01   +5.495553157743093e-01   +3.439278880432108e-01   +2.084090005820635e-01   +5.215734147972491e-02   +2.444703047674231e-01   +4.259247951586206e-01; +3.123770023739812e-01   +2.754452017709507e-01   +7.291488356259841e-01   +1.844587226617971e-01   +7.521474351671679e-01   +1.290817188697820e-01   +1.627305647494149e-01   +5.464796366308671e-01; +7.942992730227184e-01   +6.092442007287913e-01   +5.484911009385884e-01   +2.439152525107605e-01   +2.045612214285828e-01   +2.362481122287986e-01   +2.958713978770104e-01   +7.497842142652257e-01; +4.190030393266662e-02   +5.498423014768731e-01   +4.369389765410142e-02   +2.633428503738086e-01   +5.808880663391394e-01   +9.446992937930890e-01   +5.680867512407942e-01   +1.610134020464572e-02; +2.113366685469582e-01   +2.802802466041900e-01   +6.380502229337859e-01   +2.190560732910695e-01   +8.729799222190668e-01   +2.086718948708528e-01   +3.979834939222625e-01   +1.562139166918988e-03; +2.685974771860677e-01   +3.397739278494997e-01   +9.855402423050464e-01   +3.580976618592733e-02   +7.156589229369507e-01   +3.274015952674753e-01   +9.841173555432748e-01   +2.140249289624702e-02; +7.898538009271545e-01   +5.722185612625966e-01   +9.157456772725074e-01   +3.493530202430556e-01   +6.959675759131299e-01   +8.658481207570804e-01   +5.463425670804984e-01   +3.459572694195851e-01; +9.801188025211842e-01   +7.491767923181255e-01   +7.768015923583038e-01   +9.005314751999344e-01   +4.594478611178190e-01   +9.263966820846614e-01   +9.328544766695105e-01   +4.255933930030797e-01; +9.311493636636159e-02   +7.652814052241197e-01   +1.918873945642517e-01   +1.396890918365057e-01   +5.042540625933565e-01   +1.772192215777128e-02   +9.900933298211494e-01   +5.411370798990233e-01; +1.949125711293828e-01   +3.987990308526708e-01   +3.087943646293429e-02   +9.483249162447692e-01   +7.965613662341718e-01   +3.651281239283872e-01   +8.299222386197724e-01   +4.833221263680406e-01; +1.182843894674774e-01   +1.581662560229634e-01   +3.803017139999919e-01   +9.048078297196596e-01   +9.384295290612746e-01   +5.368314231350327e-01   +1.788801254267127e-01   +9.111158753587132e-01; +6.435267110541945e-01   +2.073340573388521e-01   +5.753729767225786e-01   +4.127948273921273e-01   +7.955539178406206e-01   +4.101628234920828e-01   +3.129192786954085e-01   +4.190471386752347e-01];
L1E_L2E_iAMPA_netcon = [+4.969369111423382e-01   +4.596622061562204e-01   +6.153363910078387e-01   +4.943089822913593e-01   +2.360684200736261e-01   +7.181597301091784e-01   +6.843024707560061e-01   +6.343152078783115e-01   +5.218597593171935e-01   +2.428253381586701e-01   +8.751666119523406e-01   +1.736701383902138e-01   +1.378900792238001e-01   +2.416379484761999e-01   +1.849958529810937e-01   +3.222811293862895e-02; +8.394709992272114e-01   +3.688292687142547e-01   +9.958146764746294e-02   +6.599174514407018e-01   +8.368689492104558e-01   +3.779803122166115e-01   +9.774267832929544e-01   +6.235812398129907e-01   +6.715266030902706e-01   +7.310727375775607e-01   +6.610700093442823e-01   +3.014809958724161e-01   +2.881878595487969e-01   +7.435374798325028e-01   +1.547116598253675e-01   +2.512875916015571e-01; +1.845799178894872e-01   +2.935744999134767e-01   +7.570989605701511e-01   +1.765261348092305e-01   +7.311324011429307e-01   +3.794598523882157e-01   +7.548189401103482e-01   +4.084943372130648e-01   +7.773014538567379e-01   +1.230588060231565e-01   +5.456169098865714e-01   +1.051575461493386e-01   +3.785984965927683e-03   +9.324587951414722e-01   +1.347172105735010e-01   +9.879188728342430e-01; +3.413278180216839e-01   +2.391504479914005e-01   +5.405770494580801e-01   +4.784660489416609e-01   +4.896499492984815e-01   +7.116466488995881e-01   +5.509799966153911e-01   +4.325021195876523e-01   +4.634088891276341e-01   +3.585253615286531e-02   +2.447223045881781e-01   +4.575095921279972e-01   +3.076770733525275e-01   +3.816470093203028e-02   +1.640675344689514e-01   +6.364019439303660e-01; +6.916616457214707e-01   +1.373259096904284e-01   +4.458545188136075e-01   +5.045641683368637e-01   +8.488812940774020e-01   +8.321263282512009e-01   +2.283184828157630e-02   +5.102864793058833e-01   +9.077120208382403e-01   +6.460151519271262e-01   +1.093478501170490e-01   +5.873605166139170e-01   +9.092259533577501e-01   +4.264476814001278e-01   +9.225322280138767e-01   +3.549370273839015e-01; +6.862911217793274e-01   +1.005148347455479e-01   +7.415721670896710e-01   +5.995941011935888e-01   +7.206266699000634e-01   +6.695739725956154e-01   +1.940520668315388e-01   +2.617178654667633e-01   +2.292013582591721e-02   +1.953519342398842e-01   +9.695887238312454e-01   +2.149600001571918e-01   +2.940132960226849e-01   +8.210877810879028e-01   +2.634374655433033e-01   +9.961228922971602e-02; +3.680883136238181e-01   +2.357111186858634e-01   +3.890091783868336e-01   +2.441595758560079e-01   +5.173661635360003e-01   +6.504746446607267e-01   +9.441771946471775e-01   +4.230080574532195e-01   +4.888196047376756e-01   +9.780384002970923e-01   +5.878100519435815e-01   +1.078570051545185e-01   +8.235902874025318e-01   +9.983848519770825e-01   +2.032325127869877e-01   +4.156746299946341e-01; +3.248533846200569e-02   +3.510439404300725e-01   +5.318130591894373e-01   +5.211495326984376e-01   +9.400947239629552e-01   +5.606327499808554e-01   +3.946219112396805e-01   +5.137344939512983e-01   +2.686012207746148e-01   +8.286373175167617e-01   +8.185359207331521e-01   +5.604138420349580e-01   +7.347856410527088e-01   +9.194207381291581e-01   +6.216426556426039e-01   +9.295217001450161e-01];
L2I_L2E_iAMPA_netcon = [+6.782608539478095e-01   +6.190261455679675e-01   +4.025669673118568e-02   +7.993775656785725e-01   +5.156053551237219e-01   +8.249477720617656e-01   +6.498048244086929e-01   +3.866903352899700e-01; +2.087035304687051e-02   +9.463181990671552e-01   +5.453074226844447e-02   +9.406431645107050e-01   +6.591277661416091e-02   +1.080354151417230e-01   +3.336888240814482e-02   +1.710037436366621e-01; +7.280826603730455e-01   +9.612999917838545e-01   +4.088425100761894e-01   +9.431879302111847e-01   +2.909559133017487e-01   +2.465141243649487e-02   +5.619418719192592e-01   +4.449973087671892e-01; +2.169326049479089e-01   +3.665562581967530e-01   +9.800753308359174e-01   +1.428428244906598e-01   +7.134030706087562e-01   +7.136647141052540e-03   +3.083614601525488e-01   +8.734951327648768e-01; +8.504904004112290e-01   +7.952088988386388e-01   +7.093881923560893e-01   +3.260239879346654e-01   +8.841309152685077e-01   +3.369079941048724e-01   +2.630226808526434e-01   +4.049630032658982e-01; +1.568212616325379e-01   +7.214895508257368e-01   +9.947554983195853e-01   +4.224148344071340e-01   +3.692031400376930e-01   +6.626894985959066e-01   +7.207375357438435e-01   +1.694153991450109e-01; +6.694291598571740e-01   +9.479770847644807e-01   +6.525103870460895e-01   +7.087466045686243e-01   +5.600754013937947e-01   +5.930081900319839e-01   +3.057607494345878e-01   +6.631661843178042e-01; +9.297649477432500e-01   +1.329525987192226e-02   +5.036537322861501e-01   +6.171510867106762e-01   +8.791314050776392e-01   +8.052591291460187e-02   +9.024747575449447e-01   +9.274482044127953e-01];
L2E_L2I_iGABA_netcon = [+6.710533331654038e-02   +5.217920222282784e-01   +3.425598129668518e-01   +2.583287705893099e-01   +4.282842467384625e-02   +9.034281449489799e-01   +3.422991155735462e-01   +4.566963637641606e-01; +3.560833108356142e-01   +6.255610102949055e-02   +5.536533671942614e-01   +9.823320709304137e-01   +3.638994573850090e-01   +5.575812193591697e-01   +9.401090641836429e-01   +6.704629130564381e-01; +9.273728008835809e-01   +1.775605954740744e-01   +6.846273565514838e-01   +3.489239662325974e-01   +4.041468343915638e-02   +7.089870758286634e-01   +9.071245421557242e-01   +7.670414158774042e-01; +2.409383557531892e-01   +3.158725980461729e-01   +9.361477484948336e-04   +3.923778024027510e-01   +4.902796015640590e-01   +7.143556004607231e-01   +7.299898537162475e-01   +9.266609726309261e-01; +1.142916142480758e-01   +2.422369060033573e-01   +5.081625516271357e-02   +7.509080244859205e-01   +7.302538640744062e-01   +1.750093710159721e-01   +4.447182037390862e-01   +6.495681878087316e-01; +7.108253961948883e-01   +3.205325642461301e-01   +3.080227337824452e-01   +1.069302043782495e-01   +1.437421092050005e-02   +3.516020889751630e-01   +1.475846237838459e-01   +5.015147950422845e-01; +3.713615926956162e-03   +8.714971992310490e-01   +8.760786017931561e-01   +5.980211379537487e-01   +5.048526461870926e-01   +3.670398168300659e-01   +8.288534223949967e-01   +3.412647604951984e-01; +1.755494617387234e-01   +2.993643339224630e-01   +6.285987831864549e-01   +1.258802145382657e-01   +2.536382343469976e-01   +7.613770271750445e-01   +2.506255403971040e-01   +9.431781757106988e-01];
L3E_L2E_iAMPA_netcon = [+7.364276739193718e-02   +1.794818053579793e-02   +3.683766989732095e-01   +4.954204524910805e-01   +1.763180310469795e-02   +9.629661723687475e-01   +3.606846936742630e-01   +1.816541893663491e-02   +2.050762069352006e-01   +6.578470490098670e-02   +2.433739508308789e-01   +9.974015625842659e-01; +9.513755956387666e-01   +9.828720071316205e-01   +1.229049569695813e-01   +6.536404340747105e-02   +8.075784827203739e-01   +3.819625338224701e-01   +2.310596927191707e-01   +1.246975930117088e-01   +3.534350328003995e-01   +7.528961845885239e-01   +5.388928006925249e-01   +3.388851816280409e-01; +6.676079718252985e-01   +7.262892885301132e-01   +5.072427726596369e-01   +8.734841210772651e-01   +7.961911231720424e-01   +6.604618379249659e-01   +7.223482647835949e-01   +6.674919565915178e-01   +8.939602251226266e-01   +9.985122183505780e-01   +3.339850527882560e-01   +8.305392947058426e-01; +1.717864488260127e-01   +8.787471811929968e-01   +9.185401095218877e-03   +9.971962169550729e-01   +4.124036489766844e-01   +5.848302019399989e-01   +7.778119597568798e-01   +5.114248313316684e-01   +8.191041785351179e-01   +7.694000757327936e-01   +6.697949190867767e-01   +1.147762619621815e-01; +2.012794910079620e-01   +8.123775301977282e-01   +8.707122454902787e-01   +1.225703770951623e-01   +6.383781154883265e-01   +4.597002976752101e-02   +3.361850953747448e-01   +7.628607077337364e-02   +3.129713579526719e-01   +8.930125429235853e-01   +8.758733058328624e-01   +7.823026017249365e-01; +9.884830145590264e-01   +3.640242987353390e-02   +9.096252436295205e-01   +1.040219728270857e-01   +5.649911404161343e-01   +7.689865694944348e-02   +5.708160005395465e-01   +5.364972032761685e-01   +5.968871562441016e-01   +3.898687143455336e-02   +9.757415377751030e-01   +1.581566595272584e-01; +9.361417155979080e-01   +9.487282099401198e-02   +1.102403506900643e-01   +1.462731220968709e-01   +9.109431285299073e-01   +2.293941605874582e-01   +6.360732810363591e-01   +6.853190944789346e-01   +7.003970380973693e-01   +7.975650115106692e-01   +1.312845725830884e-01   +7.294379616891267e-01; +9.846494800932851e-01   +9.463333384538861e-02   +4.327419034521433e-02   +1.324783719533432e-01   +7.506363664752677e-01   +4.172822320121468e-01   +3.618780704626268e-01   +5.867421778515963e-01   +1.768438913246825e-01   +7.163892497707162e-01   +8.834126062779700e-01   +1.188040327505230e-01];
L3I_L2I_iGABA_netcon = [+7.698463887117800e-01   +5.407401194896128e-01   +5.975761548075204e-01   +3.103882474693206e-01   +9.608993872605349e-01   +1.125832782296380e-01   +2.945853580415684e-01   +7.907336168545726e-01   +9.162273151273321e-01   +9.910747779435455e-01   +3.081311450808332e-01   +9.957944478489651e-01; +6.381102449803594e-01   +4.519671077080972e-01   +5.622597717838212e-01   +7.595374651894122e-01   +5.470437595545026e-01   +6.632955680269380e-02   +1.636692882990079e-01   +4.888152942580694e-02   +3.891967655680587e-01   +2.910101079593449e-01   +4.437516841088985e-01   +9.191915327656831e-01; +8.032175158732049e-01   +1.164386771392401e-01   +6.997211640249319e-02   +6.532048191824521e-01   +9.767331961691503e-01   +4.735955161027616e-02   +7.248922434321599e-01   +1.854982884192319e-01   +7.524401374535745e-01   +5.228936175201464e-01   +2.053399087475568e-01   +6.911399561504540e-01; +9.644768270952147e-01   +7.185990197691897e-01   +7.613664606887689e-01   +3.304352561314581e-01   +1.219338242920309e-01   +1.259562348964728e-01   +2.958775972379780e-01   +2.488713614576964e-01   +8.759053295796286e-01   +3.638643814225724e-01   +9.409312075535969e-01   +2.185779916521881e-01; +7.113656515276536e-01   +1.886577856837628e-01   +8.704363378985995e-01   +9.803098345620482e-01   +1.565647005453293e-01   +4.907397175922857e-01   +6.742138270313454e-01   +2.571836961817067e-01   +3.999524425858267e-01   +5.246119733540685e-01   +2.890027953403763e-01   +3.130429084916301e-01; +6.484433095005773e-01   +3.229150686074814e-01   +6.987006335247424e-01   +5.319376351073153e-01   +3.371625027865983e-01   +4.688901437664169e-01   +7.564540713647052e-01   +6.511457577592671e-01   +1.699847099485769e-01   +4.956362565956363e-01   +1.125110862714032e-01   +2.288941601923039e-01; +5.201078247866249e-01   +9.706116572900880e-01   +1.161402349960881e-01   +7.539116741109209e-01   +5.257357260912029e-01   +1.575269291821392e-01   +7.471537631136680e-01   +1.017238190446022e-01   +4.426863115870521e-01   +1.841894615632552e-01   +6.546347566606761e-02   +7.036989754088832e-01; +9.513619458611033e-01   +6.923383596925272e-01   +6.599036880931277e-01   +2.633278351986679e-01   +6.890972142215420e-01   +1.291035396417951e-01   +7.780253787169685e-01   +4.731420182890032e-01   +8.525946809342027e-01   +4.900619742073324e-01   +7.267433190817267e-01   +3.730863209136057e-01];
L2E_L3E_iAMPA_netcon = [+6.532941510540925e-01   +3.789512209868655e-01   +2.359968045905215e-01   +4.692658896163799e-01   +9.114364782899814e-01   +9.525530265292115e-01   +7.646256731816246e-01   +3.551734010044907e-01; +3.752983704455596e-01   +2.825844365431332e-02   +9.109912360302195e-01   +2.887889471615792e-01   +6.829212811148510e-01   +2.095154200168341e-02   +8.935553163357562e-01   +6.629692117887085e-01; +3.028217111756829e-01   +3.261455058499050e-01   +4.889415749979508e-01   +2.708408355268000e-01   +8.424717891398793e-01   +5.051540337439152e-01   +7.888941588693823e-01   +5.944640881800733e-01; +1.586404112818142e-01   +4.990596800731253e-01   +5.894943927667364e-01   +1.466494165760315e-01   +9.297123210476831e-02   +3.334385294461700e-01   +9.402919003005326e-01   +5.502833809262205e-02; +7.788023126415838e-01   +2.718909243455435e-01   +9.530090862053185e-01   +1.412481018193357e-01   +7.352504169279571e-01   +6.668985495154147e-01   +5.346581525677547e-01   +2.098552752089464e-01; +7.121204524761405e-01   +5.339099598327218e-01   +8.231237794536868e-02   +2.633545844676279e-01   +5.522122702937550e-01   +1.612999178309397e-01   +1.557559444439535e-01   +5.946635437181406e-01; +1.808197470771781e-01   +4.190109031989868e-01   +2.198688441792819e-01   +6.032233528470564e-01   +2.478014518187398e-01   +2.194085798916252e-01   +1.338577139986263e-01   +2.673466485669277e-01; +4.490486192657012e-01   +5.428317551689527e-03   +1.580656211860127e-01   +1.051616394310691e-01   +7.222206666487072e-01   +1.109037751554789e-01   +2.595187637559393e-02   +1.188109704007340e-01; +8.392732523270517e-01   +8.965516054902789e-01   +3.860177819686600e-01   +4.924808086457155e-01   +3.658725668607053e-01   +9.933911291377263e-01   +6.846152934903863e-01   +2.138479039291653e-01; +7.007071226973240e-01   +2.382817936967026e-01   +1.861919273624222e-01   +8.943545979026157e-01   +8.485891976190558e-01   +1.469940392541783e-01   +5.809245400848877e-01   +8.756558683709148e-01; +7.617755498437216e-01   +8.061799923814342e-01   +7.609306999840374e-01   +1.829628819042745e-01   +8.282959841746648e-01   +7.676992376966251e-01   +2.960952514045078e-01   +4.635578393074604e-01; +9.772807447552644e-01   +5.815714175922133e-01   +2.339251187424929e-01   +5.286546198818662e-02   +6.186239895014074e-01   +6.271021751757733e-01   +7.106201926815318e-02   +7.307231636019276e-01];
L2I_L3I_iGABA_netcon = [+5.886969634626755e-01   +1.437060934022635e-01   +3.458079561202032e-01   +3.720327602995021e-01   +5.974885150279452e-01   +5.123295402780621e-01   +7.745292512303593e-01   +2.611079567050175e-01; +8.386029103595419e-01   +9.900898433637320e-01   +4.640221485452240e-02   +5.385230228276573e-01   +4.775003931399338e-01   +2.396953148912652e-01   +1.810491775559897e-01   +5.942810679863385e-01; +6.050286673297250e-01   +4.817832357747764e-01   +9.505786924225120e-01   +9.754191246368991e-01   +3.793533317818542e-01   +2.658990964945501e-01   +4.506903236082515e-01   +6.833326032916255e-01; +7.463708388673116e-01   +4.340511098954717e-02   +8.602755088121364e-01   +9.990790787868624e-01   +9.822361096205436e-01   +4.134192401851555e-01   +3.046477157983987e-01   +4.190372227901369e-01; +8.537384767292366e-01   +2.734461767363872e-01   +1.404061824837635e-01   +4.059134160275649e-01   +1.347809799680775e-01   +2.679811952855434e-01   +3.819484337504221e-01   +5.185278357754882e-01; +1.431225873847199e-01   +6.715300461514119e-01   +5.789345251463017e-01   +4.509202891471197e-01   +2.699248615366845e-01   +8.541057861435435e-01   +7.950010562007854e-01   +8.175558078912843e-01; +7.327409848016984e-01   +1.398250975710041e-01   +6.292063594827990e-02   +2.439273253163618e-01   +2.266141610253264e-01   +4.843926480875066e-01   +7.833054451228995e-01   +5.421809026142437e-01; +1.652587046763085e-02   +7.751469322560415e-01   +9.509284535776953e-01   +5.948819235533687e-01   +7.932186528665119e-01   +3.307299715110480e-01   +6.449330907747165e-01   +5.916538852341660e-01; +2.338272667680522e-01   +2.660992913957219e-01   +4.975028313217957e-01   +7.639923392203410e-02   +8.201182126263942e-01   +6.344854064493312e-01   +2.417184125906942e-01   +5.398250690884872e-01; +5.375921136641095e-01   +8.785579393039602e-01   +2.695536884357362e-02   +9.089025167169656e-01   +8.023291690582326e-01   +4.198131205197511e-01   +6.025325209902748e-01   +5.474707926077050e-01; +7.078958247200612e-01   +3.652683382867413e-01   +5.088065140002585e-02   +4.732421653902086e-01   +1.198384436364056e-01   +5.434407679286223e-01   +4.182671950753349e-01   +1.545592191988766e-01; +4.363482751394244e-01   +1.779584624934493e-02   +3.091327827775566e-01   +5.011797463000052e-01   +6.433766556553510e-01   +3.372948881248951e-01   +3.021414138717683e-01   +7.022178102665994e-01];
L3I_L3E_iAMPA_netcon = [+6.156404926902757e-02   +7.774078530115114e-01   +5.609062915987324e-01   +5.668227989159412e-01   +9.149037641001004e-01   +8.333994070919454e-01   +8.529638582173835e-01   +8.681507210527971e-01   +5.307850488098955e-01   +9.894334574840968e-01   +4.826349436788584e-01   +3.512960507117441e-01; +9.213720162530058e-01   +8.331373244303274e-01   +8.499277789684822e-01   +9.362924278529197e-01   +5.924813814816661e-01   +4.011252430879881e-01   +6.282806442646311e-01   +8.604204313144085e-01   +5.741520293900986e-01   +7.027150497694116e-01   +7.406753321646187e-01   +3.975009572035810e-01; +1.827423906225848e-01   +5.971638317447830e-01   +9.734914841807103e-01   +7.749717240582179e-01   +5.795715156657800e-01   +6.643958175933974e-02   +4.406962980002312e-01   +9.476718466226802e-01   +9.772540033708421e-01   +8.403240729591803e-01   +5.923805761244996e-01   +9.985038566120548e-01; +5.374788829603435e-01   +7.612566035974554e-01   +4.712873752040109e-01   +6.032102596934923e-01   +6.542581650797100e-01   +3.790439144430243e-01   +2.294113693918500e-01   +6.964942973796385e-01   +9.592845861157048e-01   +7.289970438936637e-01   +2.535634096238146e-01   +2.857161382392787e-01; +3.967286110043069e-01   +6.594289275616193e-01   +7.731930590815735e-01   +6.393237637064227e-02   +4.323710610074328e-01   +8.604431618765439e-01   +4.987608759824413e-02   +3.631548806883849e-01   +5.596908973074837e-01   +9.986408835409555e-01   +6.159846578748842e-01   +2.342194926360526e-01; +9.460793411257933e-03   +5.885248101924510e-01   +2.315828406747751e-02   +5.321929260527090e-01   +9.394304355724117e-01   +2.813567934046186e-02   +7.042731171268065e-01   +3.828485782927360e-01   +5.225562711472481e-01   +5.086038868323464e-01   +2.270603620530730e-01   +3.348055277847923e-01; +1.097620051463347e-01   +2.160459581628848e-02   +6.735289002495800e-01   +8.590591709129798e-01   +1.042058692517305e-01   +4.250359248244970e-01   +8.527536620793821e-01   +8.515647273784446e-01   +4.749741889976900e-01   +1.997817150258573e-01   +1.904984714333636e-01   +1.635236746454954e-01; +8.553032764672555e-01   +6.886923947899195e-01   +8.352117927379989e-01   +3.415413082324222e-01   +4.111499721552688e-01   +2.467221306549550e-01   +3.977366145732859e-01   +3.828538636574985e-01   +9.005106459957505e-01   +9.534046935093448e-01   +4.544134720341471e-03   +3.878667134697084e-01; +3.337114641122054e-01   +3.293014404353345e-01   +6.919085425555405e-01   +1.841172933302424e-01   +8.959536558162396e-01   +6.730875239543690e-02   +2.936974766892269e-01   +7.680478135496372e-01   +4.814939322022146e-01   +4.492330647782620e-01   +6.490722865549828e-01   +5.277939639229414e-01; +1.408846316863758e-01   +8.977460049477710e-02   +9.001129729350171e-01   +8.827765547258306e-01   +7.347588881607231e-01   +9.196237774712408e-01   +2.541085038899358e-01   +7.814333507450296e-01   +4.946665034958851e-01   +5.996588258738088e-01   +4.018449926784112e-01   +5.919728646636365e-01; +7.959163395339599e-01   +7.449726193922839e-01   +9.154140272209936e-02   +8.436457280596945e-01   +9.629757430014367e-01   +2.680256983714528e-01   +5.100114685888923e-01   +4.252714202941693e-01   +3.099538046917692e-01   +6.438782230648290e-01   +2.685220083717175e-01   +1.703667698507943e-01; +6.553339083037276e-01   +9.735678000957029e-01   +7.865239480545798e-02   +8.286537811365957e-01   +9.758479813783657e-01   +1.046562113591293e-01   +1.157403114469496e-01   +4.893498566922781e-01   +8.552807479405001e-01   +7.520132237792989e-01   +4.881727086660455e-03   +6.359477573237494e-02];
L3E_L3I_iGABA_netcon = [+4.428201739717458e-01   +6.383308018277319e-02   +7.681075928183419e-03   +5.039682980774268e-01   +5.385424948964651e-01   +2.506388175850771e-01   +7.207957274991272e-01   +7.592766068341061e-01   +3.803503088116157e-01   +4.478664091040381e-01   +2.043296338012273e-01   +6.549890926930518e-01; +5.380989885135349e-02   +8.068171386241633e-01   +1.322409808795061e-01   +1.912663566689174e-01   +2.218342364713982e-01   +3.369587630600021e-01   +2.189711600150560e-01   +8.864215611105375e-01   +6.072627016543959e-01   +3.926767361163258e-01   +8.292758495629116e-01   +8.998471589880932e-01; +6.314656866454528e-01   +9.138521865701896e-01   +3.080094932214851e-01   +6.447403680138483e-01   +2.653322246346745e-01   +5.960403200579988e-01   +4.925400194858491e-01   +7.293933936906427e-01   +1.604556366854950e-01   +6.787943052488369e-01   +4.425520188268153e-01   +8.380366586298980e-01; +8.062720164084286e-01   +4.209536938556829e-01   +2.335812563588426e-01   +2.530704076668619e-01   +1.343129443930799e-01   +4.767678540555698e-01   +4.762027591330935e-01   +6.844782156412268e-01   +1.015695189508236e-01   +3.424564614071536e-02   +4.609293175333890e-02   +1.632195192515574e-01; +4.004688550658096e-01   +1.908231588097720e-01   +6.554818207358846e-01   +9.430484381283646e-01   +9.999287739558348e-03   +9.022558671437043e-01   +4.352675941910340e-01   +6.561970847020425e-01   +6.190685314908316e-01   +7.831816436854742e-01   +7.634462375906080e-01   +1.603801599997657e-01; +8.877229668965226e-01   +1.836075829594496e-01   +8.036519985850032e-01   +2.962282481887697e-01   +1.572747329886971e-02   +2.842033293731826e-01   +5.601919565805540e-01   +6.213805032120367e-01   +9.618740464452429e-01   +3.740437503095533e-01   +9.305405568133250e-02   +1.349151361606640e-01; +7.168388675427414e-01   +6.719900337970590e-01   +7.371384994413375e-01   +1.467146990787656e-01   +9.863831647164596e-01   +8.089904704973132e-02   +2.054613864351822e-01   +7.448608910294141e-02   +6.715426926608007e-01   +6.392516348268298e-01   +6.601648856979603e-01   +1.525651072670607e-01; +2.068468554227050e-01   +5.205517380258575e-01   +1.183947760811545e-01   +8.651256693949025e-01   +6.525961876795349e-01   +3.833218507748872e-01   +2.792103577336245e-01   +5.501731243725303e-01   +4.778257333308968e-01   +4.953383219861063e-01   +2.614350891773443e-01   +3.969836924336982e-01; +3.759623540365759e-01   +7.810891196420069e-01   +1.692368517761250e-01   +8.832777196217781e-01   +8.066926459653512e-01   +1.860424345478698e-01   +8.046513653780788e-01   +8.763614294947202e-01   +3.355655727183435e-01   +2.273857416915065e-01   +4.427113366098062e-01   +6.624409059290619e-01; +2.104428662940092e-01   +3.011494012271755e-01   +2.649102377607804e-01   +6.606833787959161e-01   +2.789518608202993e-01   +7.289880624520317e-01   +1.036543840431369e-01   +9.797942401463077e-01   +5.887484895130606e-01   +2.142837571082578e-01   +8.482348980881085e-01   +2.217139098415595e-01; +2.602325015986388e-01   +4.684434226186027e-01   +8.184451683190499e-01   +9.993015411661461e-01   +1.963770450125867e-02   +4.311411638759634e-01   +3.437882583814361e-02   +6.378503742059019e-02   +5.476950245853465e-01   +4.507623232856149e-01   +9.059151406600734e-01   +6.400690595793613e-01; +9.934898243876482e-01   +7.086072353573383e-01   +5.860795640240430e-01   +2.564951369142886e-01   +1.004389538342410e-01   +2.624842604910572e-01   +7.583599894038930e-02   +3.019029184570338e-02   +3.723515596261402e-02   +6.312546532255048e-01   +2.805702110755473e-01   +6.109099453076392e-01];
L2E_Input1_iAMPA_netcon = [+9.996214305449244e-01   +9.994334454360538e-01   +9.993745458458292e-01   +1.000000000000000e+00   +9.995733035950953e-01   +9.997205304467472e-01   +9.999312629849488e-01   +9.994034875629938e-01];
L2I_Input2_iAMPA_netcon = [+9.997085313677133e-01   +9.998004430007074e-01   +9.998411956129644e-01   +9.998424074842359e-01   +1.000000000000000e+00   +9.997867934330257e-01   +9.998492626591760e-01   +9.999289065441690e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last =  11.21 * ones(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))*0.4 + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.5*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.5*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))*0.9 + 0.5*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))*0.4 + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.5*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.5*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))*0.9 + 0.5*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
