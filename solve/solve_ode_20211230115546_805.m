function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+5.577415827818900e-02   +8.123889398249731e-02   +3.990739483311534e-02   +2.466801779653600e-02   +9.415237605669606e-02   +1.178251970100438e-01   +7.361928550047395e-02   +8.693175976186857e-02   +3.065301820507468e-02   +3.787977461783689e-02   +7.204799025917362e-02   +9.087888212529724e-03   +4.585281301932554e-02   +1.302081379695788e-01   +5.228169112681660e-02   +8.596545257819285e-02; +1.733356964171496e-01   +9.950706191913952e-02   +9.073682205245698e-02   +9.120536950911642e-02   +1.106660978286582e-01   +8.332551480766581e-02   +9.622172340862750e-02   +4.253185765396739e-02   +7.607258685763572e-02   +9.803938469662829e-02   +1.413219653329131e-01   +1.015922566241122e-01   +6.013209911030066e-02   +8.497824180522812e-02   +4.166028784745588e-03   +3.064749629759970e-02; -6.060783312064714e-03   +4.149283485380723e-02   +7.402515522389960e-02   +2.192708951558853e-02   +8.565476140716011e-02   +1.023318477121044e-01   +3.506924799984652e-02   -5.309342668573453e-03   +1.787863949763226e-01   +7.080373681355777e-02   +1.515715724347056e-01   +1.633623212492822e-01   +3.872639800677572e-02   +1.194283417481646e-01   +1.373912595941389e-01   +1.779019302668012e-02; +2.081235737304402e-01   +3.158894654698324e-02   +8.035172963060667e-02   +1.287421627408120e-01   +1.373341640724256e-01   +5.787628238387491e-02   -6.064484635708417e-02   +5.679514617517121e-03   +2.587132526560408e-02   +6.402278608798791e-02   +9.873984598300754e-02   +4.438352278667551e-02   +1.525836775901130e-02   +1.127467292235900e-01   +1.584386071857535e-01   +1.240082148926493e-01; +2.350698895178742e-02   +1.759145116778095e-02   +1.977115569661658e-01   -9.384249170632835e-03   +7.689458527273244e-02   -5.122705638699609e-03   +8.017075956365319e-02   +1.341457454477834e-01   +5.838745358654381e-02   +1.044013642872796e-01   +1.617197011099571e-01   +4.891071384302613e-02   +7.045234153612716e-02   +4.959947325438020e-02   +1.772912427406886e-01   +5.199058488703990e-03; -7.886498492095949e-02   +3.624828991676587e-02   +1.619754728919663e-01   +2.173029471812861e-03   +1.648478046312479e-02   +5.502403323729196e-02   +8.079974232194653e-02   +3.194771878163970e-02   +5.707246491632923e-02   +4.408892101552826e-02   -5.902645023074133e-03   +9.629201245093924e-02   +1.372783634029067e-01   +3.142557525206314e-02   +1.477276547056611e-01   +6.980630656716144e-02; +1.379047041185774e-01   +1.322421087691236e-01   +9.272452372112748e-02   +1.701335103713986e-01   +6.351443988207123e-02   +3.176372865635586e-03   +8.682688035020660e-02   +2.967826342596296e-02   +1.466790171020325e-01   +1.269632016520610e-01   +2.580666613351249e-02   +3.959671575440697e-03   +2.023616775943417e-02   +1.446065470373558e-01   +1.204508352175729e-01   +1.167959655456546e-01; +9.962337332293686e-02   -3.362103810661346e-02   +4.360247654176720e-02   +1.408775407384029e-01   +1.754244301650941e-01   +1.840578660877446e-02   +1.878368885373874e-02   +3.263555135807721e-02   +2.013546308927762e-02   +1.887283120229940e-01   -2.082796690613339e-02   +7.015395522950182e-02   +4.159596622183758e-02   +5.882835128019612e-02   +4.369831934246941e-02   -1.541983200997935e-02; +1.130249108516909e-01   +1.339012620700248e-01   +1.312855412224402e-01   +1.776639280409397e-02   +1.967741000770705e-03   +2.776384073093934e-02   +1.072851524143566e-01   +6.244804557017995e-02   +1.033531738950629e-01   -4.835257139054690e-03   +4.878030522418456e-02   +5.775562310571745e-02   -1.105221501124072e-02   -1.853004708630260e-02   +1.719249838369336e-01   +3.306913679501157e-02; +1.326439583133831e-01   +1.616416987887054e-01   +1.109852007797579e-01   +1.165446881361523e-01   +8.621585591536067e-02   +4.007234414587448e-02   +9.705455795241641e-02   +8.598956173739794e-02   +1.479353118362902e-01   +3.079056342124782e-02   +1.254080777960170e-01   +1.057028854868714e-01   +9.492113251254107e-02   +1.057676987735091e-01   +1.979873866332703e-01   +5.944913136311395e-02; +6.559741533906295e-02   -4.151215301106671e-02   -1.448824661193611e-02   +8.842378456934862e-02   +1.391503943411989e-01   -1.960570982748742e-02   +4.837884257078977e-02   +1.090425208247277e-01   +7.322377831064658e-02   +7.077930658838917e-02   -2.622118920067022e-03   +9.089176448459871e-02   +8.999975103410982e-02   +1.174982264225578e-01   +3.070981097402489e-02   +6.147566866378959e-02; +3.810252430103726e-02   +9.809472822904171e-02   -5.235287466883380e-03   +6.189514574989406e-02   -2.550829411239900e-02   +1.091406853633738e-01   +5.479585932037741e-02   +1.491665680298348e-02   +4.997282617350451e-02   +2.504722097052526e-02   +1.382496429375153e-02   +2.148743245833316e-02   -8.233917879452820e-03   +1.720702496435337e-01   +1.126473857499427e-02   +2.043013994021740e-01; -3.383977697156944e-02   +3.227507818235611e-02   +1.110544741175904e-01   +9.041358519723348e-02   -5.929623842080559e-02   +1.346605873638599e-01   +9.757505221409299e-02   +1.788131773557159e-02   +4.535734699854731e-02   +3.157782618546918e-02   +3.578013135779340e-02   +1.023079098220976e-01   +1.760785202909933e-01   -3.763642310153616e-02   +8.026131570793785e-02   +5.433768862278645e-03; +1.101963194722285e-01   +1.851128180225878e-01   +6.362391172253209e-02   +9.805501385677155e-02   +1.398718460434808e-01   -4.290207984133462e-02   +2.192056822766388e-02   +1.257414417845936e-01   +4.723649088440392e-02   +1.363791191791796e-01   +7.065988938533474e-02   +9.824104072513851e-02   +2.489207679425377e-02   -2.631857860988198e-02   +1.203870486684545e-01   +2.586902525449550e-02; +8.474407791872500e-02   +1.874413671947374e-02   +4.999039389336082e-02   +6.316448277719765e-02   +7.226051435456865e-02   +7.505705053690648e-02   -9.852114098845377e-03   +1.574701413989130e-01   +1.036232513730368e-01   +1.738764974684519e-01   -3.044464745217890e-02   -2.671520089462755e-02   -2.193464820333227e-02   +7.869750417033214e-02   +2.053238599801338e-01   -5.650760999396139e-02; +1.045850363166419e-01   +1.264679402579451e-01   -2.538344937690367e-02   +1.462503822433297e-01   +1.263808034589624e-01   +1.280974060203053e-01   +6.961732698038341e-02   -5.523396842239867e-02   +5.122020904720835e-02   +1.010825751033909e-01   -1.646744450617207e-03   -9.956907160509907e-03   +9.926971770481971e-02   +1.315781514329838e-01   +1.025270322873552e-01   +1.195139967108494e-01];
L1E_L1I_iGABA_netcon = [-2.260802614548079e-02   +6.649435277463706e-02   +1.352491206420583e-02   +3.547965025321573e-02   +3.299715063336028e-02   +4.556484471676463e-02   +1.253335008439157e-01   +5.287903214323596e-02   +8.532781595819600e-02   +4.932246190189089e-02   +1.916065582816095e-02   -3.808225445808699e-03   -3.429980814436840e-03   -6.614978265937747e-03   -2.776031944340817e-02   +2.647662816870188e-02; +1.209469826906751e-01   +6.093137480791120e-02   +1.601907700130221e-01   +5.859945910020425e-02   +4.667122316918863e-02   -5.515354925744716e-02   -1.528527479254325e-03   +5.246736348583551e-02   +7.096101251771986e-02   +1.264409829826215e-01   +5.691456203019618e-02   +1.155939350690130e-01   -3.626405116072835e-02   +3.821595855407772e-02   -3.555830100473983e-04   +9.220546429436796e-02; +5.235186250542885e-02   +6.822843094426369e-02   +1.157827127794968e-01   +7.622220793971694e-02   +1.703609544904654e-01   +7.483049508858516e-02   -8.219878434103416e-03   +3.134154622585008e-02   +9.472901802708998e-02   +1.756788055370014e-01   +6.480706136429767e-02   +1.183004010556084e-01   +2.710199158054659e-02   +1.580989983307695e-01   +1.033094153811928e-01   +1.106449640601531e-02; +3.119658774580952e-02   +3.263918608342557e-02   -2.211409561305930e-02   +5.384179223285280e-03   +6.137786613961888e-02   +7.831831734759857e-02   +7.584415897226475e-02   +5.801406707840089e-02   -3.365016599855612e-02   +1.281663386588587e-02   +2.817855099325135e-03   +7.906505222252132e-02   +9.869442252383330e-02   +5.946131154626035e-02   +1.172290093968406e-01   +1.057527324475702e-01; +2.458089957466844e-02   +9.107915215743155e-02   -3.042774472829838e-02   +9.632836230194150e-02   +5.917286115112004e-02   +1.397695682684168e-01   -8.441582862712214e-03   -1.320452628632821e-02   +1.891219336411485e-01   +1.263051560016953e-01   +8.458693432721088e-03   +7.774759357270453e-02   +4.918905992302532e-02   +2.014879992024371e-04   +1.258845267771736e-01   +5.002623804065708e-02; +1.115763670593921e-02   +4.006311639846297e-02   +7.234711660404521e-04   -8.397794016939125e-02   +3.701872920882010e-02   +9.985761673591095e-02   +1.370841450839013e-01   +6.387845209009704e-02   +1.057474113296504e-01   +1.060283648163876e-01   +3.815664009874105e-02   +1.544070585847806e-03   -7.149635441035400e-02   +1.372172378515321e-01   +1.985646630605835e-01   +5.067372228062065e-02; -2.299972558201605e-02   +1.859770598032411e-01   +1.011089669618642e-01   +1.626942758884025e-01   +1.166249885237617e-01   +9.676733330235317e-02   +2.085172320578024e-01   +1.260037061202232e-01   +4.307494480545191e-02   +4.333170210023032e-02   +1.689646656190938e-01   +9.900929448079272e-02   +8.266293559362271e-02   -1.642113075884121e-02   -7.630562934542472e-02   +1.265798095978376e-01; +7.406085080667270e-02   +8.737830860878132e-02   +9.968413282634180e-02   +1.274911120481822e-01   +3.195905013606970e-02   +9.040951339310636e-02   +2.852072360340624e-02   +3.407179375964013e-02   +1.086471098562197e-02   +3.261693189665372e-02   +7.276838899488855e-02   +1.659456216192889e-01   -1.172544785334832e-01   +1.232279557403856e-01   +1.290596820599539e-01   +9.300851491422082e-02; +4.762884595793505e-02   +1.405079664737511e-01   +1.537414749675432e-01   +1.533977518249757e-01   +1.086767824690505e-01   +3.459176312518247e-02   -2.570358248616941e-02   +8.384067010198368e-02   +3.497799927973499e-02   +4.620772799345210e-02   +5.374187455430832e-02   +1.100799070391725e-01   +8.524557948888109e-02   +1.133275761598993e-01   -3.190663031950331e-02   +6.357447673551556e-02; +4.597234538915795e-02   +7.761915077564147e-02   +2.081765097747696e-03   +1.409680765070834e-01   +1.089257297566917e-01   +5.686806831302961e-03   +1.282848797356164e-01   +7.667108057237429e-03   -2.447858560776946e-02   +4.094590910682358e-02   +8.917161739430374e-03   +9.285752151296461e-02   +7.746736649662231e-02   -4.557239481967554e-02   -2.055628588504042e-02   +5.513040112585199e-02; +9.462967046870972e-02   +1.458429340448184e-01   +1.018139757255861e-01   +3.494871296717840e-02   +8.419965332907189e-02   +7.837191012266992e-02   +1.005670202645646e-01   +4.050117471759852e-02   +4.748597344266297e-02   +4.269792992507922e-02   +1.175486979376213e-01   +1.484700737084068e-01   +1.636998354825724e-01   +2.647351241313696e-02   +8.466147382478781e-02   +8.560433620397592e-02; +1.264395162164819e-01   +8.024071019236741e-02   +8.003521968336494e-02   +1.241254828697860e-01   +6.269579204047956e-02   +1.604498543048210e-01   +1.632938165518216e-01   +1.027625024926039e-02   +3.119705297504070e-02   -4.981815519372055e-03   +9.632518295169379e-02   +9.861595519189524e-02   +1.296767232655984e-01   +6.505475092088756e-03   +2.043199469668544e-02   +2.246230775476929e-01; +1.862584385664951e-02   +5.941597996429187e-02   +5.081451600445642e-02   +5.591774875472394e-02   +6.859694708880713e-02   +1.813342304936128e-02   +7.879868386531325e-02   +1.118415739932932e-01   +5.310272727170023e-02   +8.579881464499593e-02   +4.605691582118448e-02   +2.716884435528368e-02   -5.957061029012233e-02   +3.083767022517050e-02   +4.183563314612539e-03   +7.613526472523034e-02; +3.441413842024776e-02   +1.043255472162073e-01   +1.444456183785615e-01   +2.310566756049878e-02   +1.152774549514920e-01   +5.273697823327708e-02   +1.410776772960303e-01   +2.949460934408496e-04   +2.278428838771042e-02   +3.620719873442865e-02   -8.023104370266723e-02   +7.599375681595340e-02   -1.896091917483409e-02   -3.666074420403227e-02   -1.101322364964366e-03   -2.390413745113148e-02; +9.289351860288964e-02   +1.218441152168918e-01   +2.956871579656228e-03   +4.876587098469504e-02   +7.651994730704471e-02   +1.162396131157694e-01   -2.952896036479033e-02   +4.863078191736311e-02   +2.029796349296166e-02   +7.241250242017160e-02   +1.035827674006270e-01   +3.401675956603000e-02   +9.372255959104364e-02   +6.708914000630702e-02   +6.389872099905775e-02   +4.857825109366240e-02; +1.161709823473847e-01   +5.505630888314570e-02   +9.953861195198688e-02   -1.996808057257193e-02   +9.669552214451307e-03   +3.804113821455374e-02   -5.012227669383848e-03   +1.397726606241667e-01   +4.555574890034621e-02   +1.061612373738304e-01   +3.241962297575522e-02   +7.967364867222054e-02   -2.763459076441366e-03   +1.098373835031306e-01   +1.687272248884056e-01   +1.390059685460673e-02];
L2I_L1I_iGABA_netcon = [+1.789648897305048e-01   -2.904322337459195e-02   +9.300446078724334e-02   +1.047567993944012e-01   +1.472455450575889e-02   +1.097452218905515e-01   +5.296562211252498e-02   +7.515116974836557e-02; +1.021396405479836e-01   -4.631174895687361e-02   +7.895365768237302e-02   +4.573216027665236e-02   +6.699440947450247e-02   -2.000532446678112e-02   +1.135355418963159e-01   +4.891918287692838e-02; +1.010069226961080e-02   +5.524044222675539e-02   -1.997937503718366e-02   -3.223242271677565e-02   +8.771689234124969e-02   +1.636038740665259e-01   +1.316281826552115e-01   -1.813936686441389e-02; -4.632838190431763e-02   +1.174848889014286e-01   +9.852173658469213e-02   +1.342782604053070e-01   -2.953097891780946e-02   +7.876237016513310e-02   +9.389906992369619e-02   +3.086457047935541e-02; -1.245922454669599e-02   -6.827166357682914e-03   +1.122574639632544e-01   -5.524148416167471e-02   +1.027791517762867e-01   +9.566833691879610e-02   +6.305844354381800e-02   +1.884751008920000e-02; +9.841418859297785e-02   +8.628796578320325e-02   +3.411984840220430e-02   +8.726441351861635e-03   +1.185533572985080e-01   +4.286375494488928e-02   +1.090693197648358e-01   +2.098259742595430e-02; -1.058081370888002e-02   -1.977648546713785e-02   +9.515015406249888e-02   -1.547933658114187e-02   -4.731899086350824e-02   +9.931040154065292e-02   +2.005404728500220e-02   -9.008816237278339e-03; +1.107302619607841e-01   +7.718375439077302e-02   +1.339064603546987e-01   +1.256029136546230e-01   +4.953650150115667e-02   -2.989589725472310e-02   +1.195021550399251e-01   +3.636594066184201e-02; -4.220554472401944e-03   +4.794632658352971e-02   +7.444552897396316e-02   +1.067759042690518e-02   +7.253650371666745e-02   +1.338134366257741e-01   +9.115646951609960e-02   +1.433897027841930e-02; -4.980240150364367e-02   +1.900196276613681e-01   +1.097426322122964e-01   -3.524051328682785e-02   -2.355453348177102e-03   +1.007796065126603e-01   +3.066778500691921e-02   +6.130680078417273e-02; -7.499462530659142e-03   +1.272894247475221e-01   +1.094942985356087e-01   -1.070169129014454e-02   +9.498384912985873e-02   -6.814259505182038e-03   +5.081353580347332e-02   +8.498529894691528e-02; +8.381987076679169e-02   +8.271728576277973e-02   +1.581262155514896e-02   -9.697551005926189e-02   +6.655682863269374e-02   +3.726250755647677e-02   +1.533606381991983e-01   +2.150254815223651e-02; +1.033673984311513e-01   +8.273265626032289e-02   -2.142545803071663e-02   +5.869516229812202e-02   +8.720282980188999e-02   +8.162585788741269e-02   +3.742746190776276e-02   -3.403491104551926e-02; +8.574942900161339e-02   +1.224315819325794e-01   +3.808875439121791e-03   +1.005674694992857e-01   +2.822986845893012e-02   +2.318394326165757e-02   +1.862131453657813e-01   +4.343146838709316e-02; +3.449111090510371e-02   +4.504288253121896e-02   +1.936902374367988e-01   +1.358855574979031e-01   +1.430571016951483e-01   +4.097794651302308e-02   +1.617265757190853e-02   +6.860289817368984e-02; +5.389658716288149e-02   +1.634458387639985e-01   +6.943176642216138e-02   +8.199772763838009e-02   +5.792710325107775e-02   +1.571012350607246e-01   +1.055238170473749e-01   +4.426798688822498e-02];
L1I_L2I_iGABA_netcon = [+1.017109440266276e-01   -8.019995309911652e-03   +1.619122710821760e-01   +4.461779459245195e-02   +6.817961868765153e-02   -2.955423973559458e-02   +3.169674593131800e-02   +3.273738216243904e-02   +5.750787003778993e-02   +2.293678641784962e-02   +2.861046964586686e-02   +6.763173854879213e-02   +3.074432926719096e-02   +1.279559442992675e-01   +1.323936499219017e-01   +3.723507897098031e-02; +6.945211226691638e-03   +1.203745499125553e-01   +4.782699863721309e-02   -4.251250318674059e-02   +3.605743898503713e-02   +6.239120383736799e-03   +1.345110141106656e-01   +8.545541311739251e-02   -2.481228328044887e-02   -2.479145335732426e-02   +3.036775926268133e-02   +6.650756217229954e-02   +1.397587814088315e-01   +1.080090223107036e-01   -5.302374165637631e-02   +6.653957831811144e-02; +6.414818105902850e-02   +1.082167549055710e-01   -3.282619470778543e-02   +1.539959786472756e-01   +1.537199987339363e-02   +7.912027085813016e-02   +1.286729361735155e-01   +9.465561822075254e-02   +1.621722186798749e-01   +5.483400995956596e-02   +1.717222782890351e-02   +4.450859928157104e-02   +5.386853177577344e-02   +7.752942917264080e-02   +5.492926594847740e-02   +1.000254591406600e-01; +1.102068310461080e-01   +1.004317401009552e-02   +1.089498232165098e-01   +5.609032191666796e-02   +1.506660081853563e-02   +1.338688900941976e-01   +6.750111155671726e-02   +6.887537470857218e-02   +8.751514385900842e-02   +1.174957131311200e-02   +1.600015844142209e-01   +7.183206712339583e-02   +4.565392065833464e-02   +1.073012564144401e-01   +4.442971528681940e-02   +2.702080362690262e-03; +7.548773310216249e-02   +5.075079000075351e-02   +5.559128500408381e-02   +7.599197639410257e-02   +4.387376840478478e-02   +1.149671686618659e-01   +4.466150514388439e-02   +3.521995677398050e-02   +1.039662954805355e-01   +1.268986267739192e-01   +4.687022318037323e-02   -7.598975434167758e-04   +1.512738679062177e-01   +1.357657511452921e-02   +9.070086564434675e-02   -3.321874784697588e-02; +7.316169617077656e-02   +4.240114741689588e-02   +2.042290965036655e-04   +1.351081373411116e-01   +2.510439671196812e-02   +1.512871108767794e-02   +5.926593707446588e-02   +3.909461694409887e-02   +7.359690071353141e-02   +1.364426079674705e-01   +4.635332647470300e-02   +1.279812965517784e-01   +8.560960734066653e-02   +3.773363481109075e-02   +2.709846407308423e-02   +1.162537295366656e-01; +9.598335814417749e-02   +1.573848309541104e-01   +1.231433703743868e-01   +1.029889352123105e-01   +1.632390111944724e-01   +1.535862683065985e-01   +2.557391832304883e-02   +7.820933779668583e-02   +8.425520033233083e-02   +1.153324366035310e-01   +1.039142041558962e-02   -7.963071443748639e-03   -5.945295409434755e-02   +5.473576902563619e-02   +1.302132089332281e-01   +3.044820285585665e-02; +1.519297228328841e-01   +1.624669124918405e-02   +1.412941288703364e-01   -7.750387779860438e-02   +5.426597557314622e-02   +8.371241632575185e-02   +6.620360313088614e-02   +1.187794903345984e-01   -3.691712725125298e-03   +1.038441507522447e-01   +1.082631163826745e-01   -7.029721932730533e-03   +2.456034426904662e-02   +5.916970078076359e-02   +2.181771530703030e-02   -2.943558504032987e-02];
L2E_L1E_iAMPA_netcon = [-2.055425657167428e-03   +9.535211783449829e-03   +1.656778857618713e-01   +1.978428296123631e-02   +7.330292703553622e-02   +8.495841328208753e-02   +8.018686114021463e-02   +1.601667149850812e-01; +4.709206653920180e-02   +3.278456211841133e-02   +7.504777961034897e-02   +1.768666467362745e-01   +1.278649052755054e-01   +2.245621190050790e-02   +6.374716180370889e-02   +1.139371124141434e-02; +1.441399620449806e-01   -1.921462284383514e-02   +2.236152875113469e-03   +1.021971656399868e-01   +7.479905226323763e-02   +1.414434215698572e-01   +4.484791196297453e-02   +1.613475674250760e-02; +2.419343372248790e-02   +7.396770898782337e-02   -5.983233643475919e-03   +5.351897903011397e-02   +2.681348301497834e-02   +2.140238723039804e-02   +3.926524958342363e-02   +1.023006172617799e-01; -5.626106530191011e-02   -8.721086655592883e-02   -7.363474667649830e-03   +1.115868296219908e-01   +4.932790814748862e-03   +8.116502344089566e-02   +6.709681381920045e-02   +6.928229522413935e-03; -2.668360763741226e-02   +4.781119785213780e-02   +3.067904477345603e-02   +1.351731106445273e-01   +2.058062092252997e-01   +1.031770777656704e-01   +1.033037682840012e-01   +1.715911940369567e-01; +1.713285847574699e-01   +6.345657479635303e-02   +4.368386236777957e-02   +1.311626644561805e-01   +9.770986291925307e-02   +7.095217591439841e-02   +3.256078538503657e-02   +6.152331733645822e-02; +3.302013189474735e-02   +6.793749972363218e-02   -9.380823849814202e-03   +1.942198268484981e-01   +5.734104348627487e-03   +8.023701134421439e-02   +4.823022277407854e-02   +1.838764376249561e-01; +1.668537042531430e-02   +3.789194180871409e-03   +8.716465870830693e-02   +2.075457989326150e-01   +8.771035769447266e-02   +2.665478900012431e-02   +9.357449872637179e-02   +8.912205829096681e-02; +2.533956018680279e-02   +1.215874005158489e-01   +8.772584552322035e-02   +1.115784281311103e-01   +1.246608667487423e-03   +2.746411731053989e-03   +2.349122376896782e-02   +8.261998061884124e-02; +7.333288850398692e-02   -3.711109235753567e-03   +3.648977904715071e-02   +6.073036246790001e-02   +9.914624927845750e-02   -8.223246965980766e-02   +1.140239942223220e-01   +2.686225126903204e-02; +4.406030740901288e-02   +3.890975868555304e-02   +9.119188439837911e-02   +1.091843323124707e-01   +7.073272359896908e-02   +7.412618419485414e-02   +2.814991547977170e-02   -3.881568314696784e-02; -2.497604602232007e-03   +7.631158718181595e-02   +1.450280982132724e-01   +1.107627885689469e-01   +5.156270697606106e-02   +3.099527667593741e-02   +7.806535575590422e-02   +1.389404858373759e-01; +1.434154882652791e-01   +1.079855661524811e-01   +1.239553901694700e-01   +2.020662599783519e-02   +3.562069242014574e-02   +1.072598594926739e-01   +5.219938473259571e-02   +1.107286885307159e-01; +4.160060715112945e-02   +6.112728045465932e-02   +8.900773798556155e-02   +1.861530964464841e-01   +3.452618414977649e-02   +5.784539635639001e-02   +8.907695836361210e-02   +9.480403744088770e-02; +1.415339844799434e-01   +1.592037364101312e-01   +3.754355416700590e-02   +6.916204563712811e-02   +1.233293222871223e-01   +1.741464191412312e-01   +6.335801944238820e-02   +9.493480843651389e-02];
L1E_L2E_iAMPA_netcon = [+2.852680899985330e-02   +1.129621387230031e-02   +1.374822079327861e-02   -8.439394121553510e-03   +6.035412547273368e-02   +6.780094893989586e-02   +2.065952414372879e-02   +1.543206648324462e-01   +1.856465053644909e-01   +4.124567943846051e-02   +1.516988142352114e-01   +6.708977730377687e-02   +1.636095524686854e-03   +4.534006700739852e-02   +7.346330643210681e-03   +3.642695555672383e-02; +1.214417666118916e-01   +7.322745222788496e-02   +3.290181115218241e-02   +1.297186498839708e-02   +6.406334072532830e-04   +4.841759865669093e-02   +4.253917094388911e-03   +1.083534897701609e-01   +1.364799725366629e-01   +8.100170708002973e-02   -6.625592060722146e-02   +6.300538788754907e-02   +1.813818438819396e-02   +6.844670948754689e-02   -3.893695960441046e-02   +5.959159324393822e-02; +1.342992772283876e-01   +1.091801049609311e-01   +1.305889204799567e-01   +4.626746473694803e-02   +8.416309233533030e-04   -3.041676030675586e-03   -2.346566398890555e-02   +8.407539911433985e-02   +3.629671849128542e-02   +1.035456776564606e-01   +2.010233318332864e-02   +1.089754760687892e-01   -2.858330191150908e-02   +1.223431337788078e-01   +5.642835483127588e-02   +1.787369555986500e-01; +1.166623843949250e-02   +8.987162768120049e-02   +2.007708390825435e-02   -3.813824017780652e-02   +7.359701407976554e-02   +2.047699281577565e-02   +1.024480790326880e-01   +4.018174623642227e-02   +1.218582100013729e-01   +1.434460858712164e-01   +1.981591898774480e-01   +5.672595600169093e-02   +3.693783649256456e-02   +1.087065895046518e-01   +1.153646440311344e-01   -1.239478151777778e-03; -6.044479238954525e-04   +1.647211210899708e-02   +1.512963561996500e-01   -2.370337138769606e-02   +4.361579097141524e-02   +1.717732919233163e-01   +7.732718830514089e-03   +1.264666112542545e-01   +9.476555217363490e-02   +1.172044979905643e-03   +5.640669661654762e-02   +1.111257939314595e-01   +1.759480219792774e-01   +1.520394352790339e-01   -2.567175339527436e-02   +2.560364956659998e-04; +8.733305063847571e-02   +1.279407233411101e-01   +4.250726859019273e-02   +9.136248632554526e-02   +1.152723590678984e-01   -5.796658299363038e-05   +9.175265570986404e-02   -1.172972480226499e-03   +9.628764205759469e-02   +9.184303008559408e-02   +7.964867020748331e-02   +6.773154055238910e-02   +4.329240636553974e-02   +8.525658171591158e-02   +5.953704966665581e-02   +3.254771249610072e-02; +1.058047165970739e-01   +1.565281943542908e-01   +6.766384014898137e-02   +6.703816400916270e-02   +1.499318581316542e-01   +7.730913269155461e-02   +2.875091795752603e-02   +9.290715353399646e-02   -4.997983001248989e-02   +1.298071735738275e-01   +2.586227521078523e-02   +1.204470354477967e-01   -3.087596355389985e-02   +3.716648120335789e-03   +9.342925321880034e-02   +8.242254559867954e-02; +5.212445361909578e-02   -3.812105296751356e-02   +8.309503282003121e-02   +5.584954449424131e-02   +8.050532246448115e-03   -5.392327911081194e-02   -5.690205022558220e-02   -9.862392124961230e-03   +1.212408037488753e-01   +1.235015665977169e-01   +2.600285775473330e-02   +8.282727716978780e-02   +7.878843205442781e-03   +1.249553830891606e-01   -4.273258862264852e-02   +6.627049024972631e-02];
L2I_L2E_iAMPA_netcon = [+5.406053195827268e-02   +1.464512317421727e-01   +1.173217015476061e-02   +9.300667468535387e-02   -6.036505357157940e-03   -8.704796738735060e-03   -3.034968678089822e-02   +4.586082597695905e-02; -4.811880803411481e-02   +1.686856695496184e-01   +7.555790227177417e-03   +1.117820147342369e-01   +4.225627953104122e-02   +5.209269809586476e-02   +9.366317079491200e-02   +7.147561178101121e-02; +3.464307815806598e-02   -1.569249528099577e-02   +1.356803219874939e-01   +1.099027124273688e-03   +6.037817635278063e-02   +7.673557854465772e-02   +5.974581174248525e-02   +1.359242979997230e-01; +7.981675558853728e-02   +1.275925002529778e-02   +1.115389616082329e-01   +2.357913504558719e-02   +7.258380473176146e-04   +9.155547382618098e-02   +3.151985378172392e-03   +6.660174451600751e-02; +1.368492062586876e-01   +1.163779803520698e-01   +2.196105656195483e-02   +1.046857399241240e-01   +7.207780878455942e-03   +1.088081515810532e-01   +2.720012892956486e-02   +1.090123501413432e-02; +8.722757610216206e-02   +3.899289585085510e-02   +4.386386098485395e-02   -1.421942173284577e-02   -8.120302295563087e-03   -5.447635119078329e-03   +2.526701782168844e-02   +8.529588143018216e-03; +9.924507469158748e-02   +6.884032767253571e-02   -1.748671916313823e-03   +1.136580362147289e-02   +1.543964331548436e-01   +3.725749668187180e-02   +1.161350190527367e-01   +1.298455059244104e-01; +3.508918406950039e-02   +1.116318080526555e-01   -7.716808532384450e-02   -2.683064804797846e-03   +1.330565215337991e-01   +6.960781105859973e-02   +1.598731601954397e-01   +7.006745783909386e-02];
L2E_L2I_iGABA_netcon = [+7.852935773133975e-02   +1.456400786269004e-02   +1.012343834548528e-01   +1.852663965128477e-01   -1.007631299801182e-03   +9.616661101191915e-02   +1.587613600174890e-01   -5.108048592810575e-02; -6.474432999829358e-02   -8.079386017372289e-04   +9.452541355175641e-02   +3.942809885664378e-04   +5.653802797779171e-02   +6.924109957318875e-02   +2.041264298448275e-01   +1.358626777122071e-01; +1.093396776157725e-01   +1.947515751394299e-02   +6.894494618695571e-02   +4.542212120253815e-02   +1.178259370889810e-01   -6.598948943390481e-03   +4.107816977400990e-02   -9.041050764882111e-03; +1.053851716956707e-01   +1.514178405923903e-01   -5.179701624134259e-02   -3.232403054996519e-02   +1.280780258525772e-04   +8.565506030262948e-02   +1.064323659792848e-01   +1.609506349025306e-02; +1.081418227586268e-01   -2.084630811310342e-02   +9.752599089779238e-02   -3.907134677740322e-02   +7.951113516181416e-02   +1.122830679645277e-01   +9.351477170308335e-02   +7.267643856100486e-02; +1.215671849870502e-01   +1.133097320320523e-01   +7.585804513201994e-02   +2.961863066965970e-02   +1.052423856130290e-01   +6.698953089991677e-02   +1.018810052405270e-01   +9.141340156911409e-02; -4.132261817415656e-03   +7.049765105899466e-02   +1.035563971294957e-01   +5.135414761020124e-02   +1.397227783319600e-01   +3.829338970338628e-02   -5.547692453410963e-02   +1.047859917357336e-02; +4.313112433528663e-02   +4.909220904304126e-02   +1.570427514641582e-01   +1.058704955963472e-01   +1.356289120078457e-01   +1.236119478386682e-01   +1.052438465933434e-01   +1.322567175793833e-02];
L3E_L2E_iAMPA_netcon = [+1.261276230549349e-01   +1.815400965243588e-04   +2.536947327492643e-02   +4.136365807314072e-02   +1.191767411012579e-01   +1.411559286229737e-01   +2.559690542821679e-02   +1.455258655506693e-01   +8.445368049792699e-03   +1.266593869144174e-01   +1.839058682137815e-01   +1.435017490110656e-01; +7.620639126428197e-02   +1.612671427028073e-01   +9.795410685578897e-02   +1.110665995982819e-01   +5.968444468615597e-02   +3.145158737769828e-03   +8.702384164824241e-02   +6.756791966482424e-02   +3.439094582399752e-02   +5.562898420907563e-03   -1.596308450968213e-02   -9.268673600135249e-03; +2.045640650785031e-01   +1.108364569712195e-01   +8.427256626105528e-02   +1.047507462206024e-01   +1.203142300636068e-01   +1.745833736072423e-02   +1.479037884994917e-01   +4.323440781356340e-02   +9.508261179753030e-02   +1.037656147628317e-01   +1.441932035504104e-01   +5.263501589920306e-02; +3.833970966459815e-02   +7.287750497645412e-02   -3.801138782708795e-02   +3.394071333033469e-02   +7.401903202652005e-02   +9.427840674160191e-02   +1.384549243799947e-01   +6.725018516881753e-02   +1.049311959330364e-01   +1.000030763901132e-02   -2.167782562378287e-02   +5.443761728894959e-02; +1.386163446159699e-01   +5.594688669637485e-02   +3.642488788119341e-02   +4.839514515730847e-02   +4.226167128689574e-02   +7.071888265948809e-02   +1.745918423819648e-01   +1.748129247609826e-02   +1.833340069049552e-02   -2.167714763154377e-02   +1.642509391266602e-01   +5.065505960626450e-02; +6.116070532721525e-02   +1.156903916814741e-01   +1.364341190409738e-01   +1.896316972848670e-02   -6.432264397676933e-02   +9.785729423934054e-02   +8.608714393417487e-02   +1.262430732611904e-01   +1.057738823731062e-01   -1.147968177534104e-02   +1.224776399906420e-01   +6.502901647655425e-02; +1.272626930920615e-01   +4.039797837312466e-02   +7.122192140078450e-02   +1.282489970054247e-01   -2.463879954956168e-02   -5.629472130058445e-03   +2.015975078550630e-01   -3.866798272039351e-03   +8.130243034130209e-02   +9.407946481831936e-02   +6.434309535055899e-02   +2.456236179173052e-02; +9.987523144013091e-02   +1.055830946658799e-01   +1.228706141041249e-01   +3.464812060787120e-02   +1.043216850003885e-01   +2.122746479511109e-02   +1.872116247764762e-01   +4.958041255817545e-02   +7.421683805333602e-02   +1.336224046250723e-02   +1.441225815171142e-01   +5.871698059318180e-02];
L3I_L2I_iGABA_netcon = [+8.243499253815906e-02   +1.296747726121602e-01   +1.192269548179403e-01   -5.181417163435556e-03   +5.755540957363432e-02   +1.003851872221483e-01   +1.047134284139914e-01   +1.061250048406695e-01   -9.388540767110584e-03   +6.332850557377465e-02   +9.335058154704289e-02   +1.205155852150512e-01; -3.386281659346674e-03   +7.393437862947998e-02   +9.772541203465343e-02   +1.065359005589434e-01   +8.929597331534019e-02   +1.820670775419962e-01   +9.245070621594310e-02   +1.873513568080794e-01   +2.377250388177840e-02   +4.624876836785397e-02   -3.338038475700477e-03   +5.647063155538606e-02; +8.767555028416547e-02   +1.018218023716112e-01   +8.010662951249511e-02   +1.219070044355256e-01   +1.162580565430104e-01   +1.448517205269280e-02   +1.097948043651497e-01   -1.769829426540770e-02   +2.218032018237589e-01   +4.183276810534277e-02   +2.058863727504189e-02   -1.447879722157801e-02; +3.531228002560068e-02   +8.822136397989377e-02   +6.001456574902359e-02   +3.610796557815047e-02   +1.010400162205852e-01   -5.550989748545700e-03   -3.602173986705904e-02   +9.774643874677398e-03   +1.363311599022763e-01   +1.574009867739042e-01   +2.988221433372245e-02   +5.640810877853528e-02; +6.499107477889339e-02   +2.609710682149240e-02   +8.999826227151789e-02   -2.613920228567219e-02   +8.713366293167824e-03   +1.594782016517897e-02   +1.935257535567094e-02   -9.618164233048045e-03   +5.830930373949816e-02   +1.120406810833374e-02   +1.475142245540869e-01   +5.708423767391108e-02; +9.261439580112905e-02   +4.023975834964497e-02   +1.010666417672165e-01   +6.117538799263016e-04   +5.446629175018552e-02   +1.185074422131603e-01   +1.869639381286974e-01   +7.707780817905975e-02   +8.308095131522758e-02   +1.526432255305149e-02   +2.538830495270366e-02   +1.000135127818841e-01; +4.550803122114209e-02   +1.049175970923177e-01   -1.199370416492623e-03   +3.043018471162262e-02   +1.406025971988560e-01   +1.329316808365796e-01   +7.198973485991776e-02   +4.169621913118228e-02   +1.026931575917957e-01   +4.970931607145171e-02   +1.499450240012718e-02   +4.665154433342503e-02; +1.313183778959431e-01   +1.131836189350486e-01   +1.119212006282584e-01   +6.400823650768067e-02   +5.941547726964376e-02   +6.737124870016067e-02   +5.943351529102266e-02   +1.226399242636326e-01   +1.826266803506117e-02   +7.332963694631910e-02   -1.888589624772329e-02   +1.622940822623707e-02];
L2E_L3E_iAMPA_netcon = [+1.097696790929082e-01   +8.913958572963095e-02   +1.389393563524241e-01   +4.413743015512708e-02   +9.805839409130432e-02   +9.239427080827707e-02   +7.055094677138653e-02   +1.841709874075806e-01; +1.318199618328749e-01   +5.986721375610413e-02   +7.251320490036968e-02   +3.678761184433718e-02   -5.447161758460172e-02   +1.185684957714296e-01   +1.360752760882570e-01   +1.041344610983860e-01; +5.145795460283580e-04   +3.905936571310320e-02   +8.742110846248423e-03   +1.242953872688405e-01   +1.542125688794937e-01   +3.447957169219153e-02   +1.044318821778716e-01   +1.116618052863210e-01; +5.131292097709197e-02   +1.399794081211895e-02   +3.991856125145035e-03   +7.908374886603083e-02   -2.297294492056368e-04   +9.834639608322759e-02   +7.494167127742710e-02   +8.861770479509552e-02; +1.208140808890539e-01   +1.351833460151321e-01   +1.146037312177380e-02   +1.174867818812312e-01   +2.411383185865483e-02   +3.669671486516476e-02   -8.484141603668973e-04   +1.016477438975808e-01; +5.198482913339648e-02   -1.391447076996734e-02   +9.454367409240377e-02   +6.262965206695650e-02   +2.680895029182676e-02   +4.398922144547590e-02   +1.289961092171078e-01   +1.067316184795323e-01; +4.204949270887801e-02   +3.496186756866843e-02   +4.680685248214243e-02   +1.126622716205399e-01   +8.127258254562776e-02   +4.770266274880027e-03   +5.298811084585138e-02   +1.242408267324653e-01; +1.050736234634360e-01   +6.775635906980342e-02   +8.923086371890414e-02   +1.191188121239287e-01   +6.412049515393156e-02   +1.301627619533234e-01   +1.298181321841833e-01   +4.394759771868979e-02; +8.478191045803558e-02   +6.135858346988209e-02   +7.826297813302728e-02   +1.053682568555198e-01   +8.084066244718138e-02   +5.692996154097946e-02   +4.224584870081630e-02   +1.122152183569964e-01; +3.749646165947819e-02   +9.397115387004541e-02   -4.073429351137768e-02   +3.572530601255499e-02   +2.628862697925320e-02   +6.050758396198956e-02   +1.222637888740742e-01   +1.217730207906859e-01; +7.459272889093625e-02   +4.271539441929185e-02   +8.907284791570277e-02   +4.583299218227407e-02   +1.213618309718661e-01   +3.317083885171107e-02   +1.148025042110912e-01   +8.874747549823014e-02; +8.466974396576255e-02   +6.693886990972493e-02   -4.466018266495653e-02   +1.035145038312733e-01   +1.360184367102807e-01   +2.833755668215084e-02   +5.716271027201603e-02   +8.692299562312426e-02];
L2I_L3I_iGABA_netcon = [+8.196372845948295e-02   +1.300733580093729e-01   -2.676495827409626e-02   +1.209988901690214e-01   +1.545466790798583e-01   +1.077293051765346e-01   +9.251033555752625e-02   +1.074651246996723e-01; +1.040328993716396e-01   +6.612772900487733e-02   +1.122388168479595e-01   +7.545217261721072e-03   +1.003694006154098e-01   -5.512994846024201e-03   +5.229709551996250e-03   +1.518712210420869e-01; +1.310028970388478e-01   +9.045192953784018e-02   +7.267930814522842e-02   +8.551435696762731e-02   -2.756203065705320e-02   +1.812620631458942e-02   +8.103557794980273e-02   +1.322568706816550e-01; +1.068387660223002e-01   +2.975719703271812e-02   +3.272113208424330e-03   +3.934229692898807e-02   +6.946968757704225e-03   +4.753261461137070e-02   -3.257581819779980e-02   +8.381371898684130e-02; +3.281362258770804e-02   +1.433116120909396e-01   +6.193645353605286e-02   -8.345980992601273e-03   +1.462721758733895e-02   +7.323902024351732e-02   +9.409867177550402e-02   +1.524015282702630e-01; -4.093607979916227e-02   +1.013641842568661e-01   +1.334991518545828e-01   +1.396341308446762e-01   +6.071695515349768e-03   +5.505175396839625e-02   +1.133165514865216e-01   -6.161101024461398e-02; +8.702680707072766e-02   +7.177320425556498e-02   +1.688652122116117e-01   +3.600497362796866e-02   +5.295354946454213e-02   +1.011493000094703e-01   +1.585285364853152e-01   -2.986616657973878e-02; +2.346809778727468e-02   +6.613731015697429e-02   +7.257841626832226e-02   +1.283121008852984e-01   +4.307238814965111e-02   -1.338974963961395e-03   +4.973049456881078e-02   +9.061413479915667e-02; +8.821605635421162e-02   -2.963918472827166e-02   +2.131484742028052e-02   +1.641415515032260e-01   +9.791956293820304e-02   +8.782880372910756e-02   +2.719048477557670e-02   +1.078529018850949e-02; -1.047520061476388e-03   +9.244839267427091e-02   +9.241742037697061e-03   +1.013224030158736e-01   +9.733729310641008e-02   +8.939923619929356e-02   +6.769710891363748e-02   +9.091149931974779e-02; +1.037271249453432e-01   +1.000820134172698e-01   +6.975726253171735e-02   +1.172812441387712e-01   +2.650370225023001e-02   +1.415257654439095e-01   +2.531021514244151e-02   +2.180180299047067e-01; +4.112995997438583e-02   +3.824415409265230e-02   +8.626326762859762e-02   +8.219837972192637e-02   +3.208831810820720e-02   +4.843343590709071e-02   +5.634777200373252e-02   +6.464285194367374e-02];
L3I_L3E_iAMPA_netcon = [+8.019904470310255e-02   +3.377429923074197e-02   +3.022341789839202e-02   +1.084957288373666e-01   +1.463563349485567e-01   +2.223870303385461e-03   +4.584525727854030e-02   -2.016034497052259e-02   +7.343689531926893e-02   +8.466272875875172e-02   -2.807236494688608e-03   -1.044248941269868e-02; +1.241859269113711e-01   +6.576649038281038e-02   +4.951119272338858e-02   +3.206081067077551e-02   +1.660289354394558e-02   +9.526868783520034e-02   +6.838295607721445e-02   +1.822742080896387e-01   +9.376784121799887e-02   +6.110557496039501e-02   +1.634314510516114e-01   +1.710099090251188e-01; +1.482455733529647e-02   +5.296257697805177e-02   +1.349547534272738e-01   +1.147053468658566e-01   +1.113336871999765e-02   +1.323750023156648e-01   +1.028708943028191e-01   +1.159266764932355e-01   +8.075132278074612e-02   +6.510641036678479e-02   +1.581928775804443e-01   +6.177777346154902e-02; +5.649556783700262e-02   +2.692217089344300e-02   +1.140764340039275e-01   +1.429208839963627e-01   -9.922612053861447e-03   +5.348810053203937e-03   +1.158541317581061e-01   +1.101167390148765e-01   +5.921334409342578e-02   -2.089347627606948e-02   +1.420776165079948e-03   +3.400571336597771e-02; +8.153511869564696e-02   +4.051982066699455e-02   +6.345743464774831e-03   +1.422447921576153e-01   +6.545429466863893e-02   +5.916719029270374e-02   +6.546734317278641e-02   -9.853479583273039e-07   -7.375559435315227e-02   +1.003126065829277e-01   +7.720135376282469e-02   +1.079849047348549e-01; +1.000693344501019e-01   +1.319926866017817e-01   -2.859467423062359e-03   +4.472609325779738e-02   +1.266493636260542e-01   +1.344153466288527e-01   +1.342287565275875e-01   -3.480747995684381e-02   +7.667643995876476e-02   +2.619923691565323e-02   +6.341233645441151e-02   +1.880007933301453e-01; +3.329756522402177e-02   +3.971330079925026e-02   +6.388119259724549e-02   +7.333498839752275e-02   +2.327712116538713e-02   +1.400428352507616e-01   +1.566214059941016e-01   +1.124044022362204e-01   +1.297001459066746e-01   +1.397284951335944e-01   +1.998472762954109e-02   +1.131550831441536e-01; +9.404440647590515e-02   +9.990192209637697e-02   +7.924875922568073e-02   -5.149641691654031e-02   +1.576751263868406e-01   -1.393862858648335e-02   +3.913069047624381e-02   +9.321928435406258e-02   +3.114896944513167e-02   +1.196456182256463e-01   +1.025336749120015e-01   +6.032142584537289e-02; +1.969672355481873e-02   +1.146219473999946e-01   +1.641005399511990e-02   +1.229298829049414e-01   +1.222398260867469e-01   +4.872382306835220e-02   +4.907975496575189e-03   +1.143170891664683e-01   +4.184263680833848e-02   +1.510155740325262e-01   +1.067120772543378e-01   +3.246180058427342e-02; +5.925984969959418e-02   +1.669721834628551e-02   -3.113238197771119e-02   +3.003411977770878e-02   +5.021890249574887e-02   +2.082773622764821e-01   +7.756671927662809e-02   -8.384571627244830e-02   +9.743242653542762e-02   +1.301847205712461e-01   +9.123403530106775e-02   +5.165544872204256e-02; +9.475079097268883e-02   -1.335786367171449e-02   +1.675432701568996e-01   +1.046022306506438e-02   +1.171377821071737e-01   +6.239242221035654e-02   +8.654841388736409e-02   +1.047364782933583e-02   +7.903727037970236e-02   +4.354385398966513e-02   +9.352274551299333e-02   -1.554401752053115e-02; +8.984373475839870e-02   -3.952793276528609e-02   +7.620504303063011e-02   +1.216315886134409e-01   +4.702739527500395e-02   +2.155021615114489e-02   -5.534588545805943e-02   +1.759083825933363e-01   -4.718856895106127e-02   +1.086270897542647e-01   -3.817149067105365e-02   +2.533991415104582e-02];
L3E_L3I_iGABA_netcon = [+1.510106094578085e-01   +8.136539446888269e-02   +6.058884954316778e-02   +7.039247487019828e-02   +1.263556339600602e-01   +1.285139433968529e-01   -7.208021703878388e-04   +8.933361882661614e-02   +2.067047913115891e-01   +1.119613110148548e-01   +9.444891258993705e-02   +8.351750305866110e-02; +1.211242739840503e-01   +1.157306807654673e-01   +1.306076320882484e-01   +4.900772137094375e-02   +6.384005176339984e-03   +2.008829734736624e-01   -1.052425920039697e-02   +1.023216909049600e-01   +8.981956630999145e-02   +1.002535691202477e-01   +9.786190350964011e-02   +1.297297243767520e-01; -4.523950390940779e-03   +1.159518174967169e-01   +5.804686985811740e-02   -5.030520179396038e-02   +1.057019150926769e-01   +3.302991762322086e-02   -1.318884904920676e-02   +6.010498800868434e-03   +1.243818960050704e-01   +5.737890791757681e-02   +8.513834673326950e-02   +2.284945548075171e-02; +5.537162559155326e-03   +4.531696709851284e-02   +4.683435846544823e-02   +7.324862164921812e-02   +1.841774525986313e-01   -2.766839137097991e-03   +3.801597850062879e-02   +7.175718295111849e-02   +1.163854663554608e-01   +1.834622687598600e-01   +9.265222417601185e-02   +8.553170252755052e-02; +1.202603129049808e-01   +9.969842245203492e-02   +1.405576800125203e-01   +1.157293609231215e-01   +1.317123424723687e-01   +6.300230471828584e-03   +1.081025138897104e-01   +3.274971046024193e-02   +1.291281222749814e-01   +9.473027074933299e-02   +9.722869271891095e-03   +8.857147405543186e-02; +4.596846599611262e-02   +1.870183458315823e-01   +9.355950710221130e-02   +2.101841729532775e-02   +1.325423690868464e-01   +4.448427413038393e-02   +6.926500943072719e-02   +3.175498797975740e-02   +3.742850044168324e-02   +5.577818564860357e-02   +8.134141256908499e-02   +1.368586240759827e-01; +4.320211844618828e-02   +5.327122992255136e-04   +1.620448710935089e-02   +1.031970385295671e-02   +4.426559518928347e-02   +1.310616486261465e-01   +3.497599908228337e-02   +1.090158459291103e-01   +1.640189561418006e-01   +4.739336313717486e-02   -2.338097476048560e-02   -2.300032379367220e-03; -5.939581125156029e-02   +1.154851748866998e-01   +1.257367198699317e-01   +1.294603165539266e-01   -2.523653472139734e-03   +6.824836469589679e-02   +1.176124982396492e-01   +7.912516060513437e-02   +2.997437285069275e-03   +4.301741982756277e-02   +1.179203440414818e-01   +4.473164694308800e-02; -1.528028371236247e-02   +5.256425070900658e-02   +1.280735517745643e-01   -2.949438499869703e-02   +5.985009831799668e-02   +9.225539201708909e-02   +1.723456889037239e-01   +4.926325584861886e-03   -8.481613848534665e-02   +9.206143163800244e-02   +7.894363507969089e-02   +1.052667585954562e-02; +7.111250847748489e-02   +1.731375269855570e-02   +9.862192350304939e-02   +1.273332466605742e-01   +8.661923362210748e-02   +4.799929115802627e-02   +1.008633189540792e-01   +1.136936056614964e-01   -2.615982480413540e-02   +3.802652152692387e-03   +9.889731971404651e-02   +5.845532152658245e-02; +1.514527236644004e-01   +4.300547788473813e-02   -3.611057964292015e-03   +3.045173286165835e-02   +6.392906209539254e-02   +4.243911394956405e-02   +8.273911220592700e-02   +5.305870075084776e-02   +1.144264610424384e-01   +3.243002259713364e-02   +2.420997365741629e-02   -1.272876741735332e-02; +6.311152707819810e-02   +5.714965733445329e-02   +9.738527512634858e-03   +1.512365068071739e-01   +9.872518204037890e-02   -1.348274805325828e-02   +6.414713937289916e-02   +9.072117162048782e-02   +9.481439345756104e-02   +2.816494686603941e-02   +1.004429223599712e-01   -4.573826793311640e-03];
L2E_Input1_iAMPA_netcon = [+1.050426746633253e-01   -2.900684071964442e-02   -4.934039412573733e-02   +1.510063720299147e-01   +1.610969460438254e-02   +9.202040330158386e-02   +4.127505867553474e-04   +1.047083300004345e-01];
L2I_Input2_iAMPA_netcon = [+4.478174692004275e-02   +3.943419126270076e-02   -3.591051025430862e-02   -1.410780751582715e-02   -5.037331763607687e-02   +1.627579333659513e-02   +9.520693469597789e-02   -5.904996433866039e-04];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.3*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))*0.9 + 0.6*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.3*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))*1.0 + 0.8*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.3*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))*1.0 + 0.8*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.3*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))*0.9 + 0.6*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.3*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))*1.0 + 0.8*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.3*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))*1.0 + 0.8*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
