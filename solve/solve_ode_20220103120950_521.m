function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+5.322778234975318e-01   +1.384489829330858e-01   +3.948844619914761e-01   +7.067118233770379e-03   +8.702143192954170e-02   +4.707293600819846e-01   +2.528656118741392e-02   +2.169008286794082e-01   +1.257715158542373e-01   +5.301756782884793e-01   +8.520172530917022e-02   +2.404241716708130e-01   +2.417435565383893e-01   +3.528383248222571e-01   +3.384541803832521e-01   -2.502011035502297e-02; +4.423843099503256e-01   +1.927405407027954e-01   -2.395958429043873e-01   +1.694097522577265e-02   +4.504723334687745e-01   +4.140320868515429e-01   -4.097861945494873e-02   +2.304338179382923e-01   +3.729271615431551e-01   +3.271540680539823e-01   +2.941892937578429e-01   +3.526866556341574e-01   +1.695937759327574e-01   +5.899094427551942e-01   -2.681791277122975e-01   +3.251863476530124e-01; +3.812284999555429e-01   +4.473405542651531e-01   -1.769368065345222e-01   +1.841823876960526e-01   +4.327428017410268e-01   +2.360553786114363e-01   +3.482233880990039e-03   +2.945412422707735e-01   +8.171408881303610e-02   +5.717610792958399e-01   +1.003597465591916e-02   +2.600642945635692e-02   +4.072791509531359e-01   +3.721889670229094e-01   -1.619191593760655e-01   +3.042646108689809e-01; +4.930360781592317e-01   +1.751945950054536e-01   +4.984030985158107e-01   +8.926340752278140e-01   +4.603820949924975e-01   +5.430816123641603e-01   +6.573508338920497e-01   +8.589023621461110e-01   +8.795095829408969e-01   +3.490564290953978e-01   +2.964884731707470e-01   +1.052021927959454e-01   +3.763042323411049e-01   +4.760879279070904e-01   +1.577192526727731e-01   +3.792153537473766e-01; +5.325085569460141e-01   +5.327899019457241e-01   +4.885780123744858e-01   +9.344925967714283e-01   -4.211025604431945e-02   -6.244974152648533e-03   +2.071517623905162e-01   +8.415439691476950e-01   +4.349972279115394e-01   +2.158161270521331e-01   +7.322577881721444e-01   +2.780511115858695e-01   +7.391236535443141e-01   +6.506560990093696e-02   +1.112069600543861e-01   +5.296023297579834e-01; +9.981427568174821e-02   +4.410908170100781e-01   +5.013545635496423e-01   -3.887000460357681e-02   +1.595689845195217e-01   +5.572843593131102e-01   +3.302318267521114e-01   +5.518043353751781e-01   +2.655511553752258e-01   +3.385351940605926e-01   -2.312816759352325e-02   +4.255544313695621e-01   +2.981382341793806e-04   +4.277235822572441e-01   +2.208328006738209e-01   +6.239030614532367e-01; +3.691029902511080e-01   +6.899008622753900e-01   +6.826307139997548e-02   +3.848841639650045e-02   +1.840643107058333e-01   +5.251228917247066e-01   +3.868132820907135e-01   -1.898320718093049e-03   +2.131118110392348e-01   +1.565793997475197e-01   +5.095566980178201e-01   +4.587515408465289e-01   +4.744137417801964e-01   +2.558208099863645e-01   +1.439243309737138e-03   +1.980756242135112e-01; +5.865569228719706e-01   +6.559826551987106e-01   +4.385913583449818e-01   -2.470086882082848e-01   +3.649715177978814e-01   -1.476708732596053e-01   +4.148700596579240e-01   +1.903455528953973e-01   +2.985108207640524e-01   +4.594684705972741e-01   +1.816588668339379e-01   +3.681193915389915e-01   +3.634357086261801e-01   +3.118819658732276e-01   -6.284600199024645e-03   +4.547197398786959e-01; +2.819106865354740e-01   +4.978736140929427e-01   +1.694065783035129e-02   +1.652902197624702e-01   +6.799806916141881e-01   -2.722349548589720e-02   +3.575215387985317e-01   +5.106649430392121e-01   +2.486180609098062e-01   +2.097095395329623e-01   +4.542118277380724e-01   -1.313217175591685e-01   +1.709127899754381e-01   +1.822952382803023e-01   +3.675533355619697e-01   -5.035394859057620e-02; +3.402620558819185e-01   +5.926018756862391e-01   +4.012778229772037e-01   +3.063237065814883e-01   +3.245963756199766e-01   +5.772971824607073e-01   +6.909937935373853e-01   +1.963768446817734e-01   -1.652786635695098e-01   +2.688512783407694e-01   +3.207190555511568e-01   +3.792481857831694e-01   +6.349959627090227e-01   +6.053072729058407e-01   +4.627681372523985e-01   +2.653888123102731e-01; +3.122033576803173e-01   +2.618634110512692e-01   +2.107046890394577e-01   +5.850817492489565e-01   +5.625434434446462e-01   +3.474660422086277e-01   +3.449102294000819e-01   +5.637389656814344e-01   +3.042526939810327e-01   -2.052890400622183e-01   -2.630847748634568e-01   +5.011686904510083e-01   +4.199053984931636e-01   +2.567915586502344e-01   +3.747422718950586e-01   -1.029191081542206e-01; +3.152773202636238e-01   +1.200360580845137e-02   +3.799707530515412e-01   +2.729825226201552e-01   +3.748665996381277e-01   +4.755086176474253e-02   +1.825068051590018e-01   -8.017754416368721e-02   -4.796826051495429e-02   +5.515954552870319e-01   +2.341439589478797e-01   -3.074084771648262e-01   +5.192068688409168e-01   +5.212539041941120e-01   +1.364981998876039e-01   +2.317451849562940e-01; +7.455599777109308e-02   +3.176259848133725e-01   +8.341558838181393e-01   +5.317219679743369e-01   +4.985369436241781e-01   +7.049419073415165e-01   +2.873260525513938e-01   +3.846036450224793e-01   +3.793933374439874e-02   +4.428477665616567e-02   +3.809998678201472e-01   +5.913926319390070e-01   +5.798449648740953e-01   +4.564463743163194e-01   +2.628535506376315e-01   +2.085003666748113e-01; +3.993352328300459e-01   +5.251463362499732e-01   +5.175009821751984e-01   +4.935401444742656e-01   +6.724791244597859e-01   +4.158735981969993e-01   +1.670884329414900e-01   +1.541693993328875e-01   +5.121148167148208e-01   -2.591317588288360e-01   +3.802489450998945e-01   +1.505162747714449e-01   +1.527415068243895e-01   -4.658159321671484e-02   -8.101607862504331e-02   +1.407867687654538e-01; -4.248736644745253e-02   +3.565809671280263e-01   +1.923739037195142e-01   +5.579447751185886e-01   +3.311941477061823e-01   +8.450473093351009e-01   -1.295559459760292e-01   +1.076527053272928e-01   -4.730508467367050e-02   +4.269754258467093e-01   +5.591937031949556e-01   +5.900412266962488e-01   +4.571486587858033e-01   +6.804391306058326e-01   +4.194425721887544e-01   +1.985945498711788e-01; +3.004060210716464e-01   +1.973571075419009e-01   -1.680484467307032e-01   +1.106124185779359e-01   +6.151530930651947e-01   +2.406269602531896e-01   -1.210078275063754e-01   +5.765871968901808e-02   +2.960287962830436e-01   +2.460328839257258e-01   +2.928378914015446e-01   +1.648068125565689e-01   +4.583815240803309e-01   -1.132492542096001e-01   +6.829308393233305e-01   +2.309086964715314e-01];
L1E_L1I_iGABA_netcon = [+3.567223667003409e-01   +4.668081914896792e-01   +5.995247007952509e-01   -5.664656359307441e-02   +1.107877920754382e-01   -5.982023498201101e-02   +4.273457287619778e-01   +2.268303094726916e-02   +5.443181617195787e-01   +5.516143448177360e-01   +5.320234413637540e-01   +5.129836841867389e-01   +6.203101495989145e-01   +2.939199273770968e-01   +2.380071840477443e-01   +2.385282775657196e-01; -8.554555305800614e-02   +2.850252760616834e-01   +2.706062433361109e-01   +2.073948694463107e-01   +2.776763413042083e-01   +3.549361632188841e-01   +3.117695579651718e-01   -3.629540175007543e-01   +7.963654733013733e-01   +5.040107396505678e-01   +5.418801161284550e-01   +1.063542312284143e-01   +4.156446492387157e-01   +1.811225758639750e-01   +3.899516969149021e-01   +1.831929516928978e-01; +5.925709148451719e-01   +2.789644054105097e-01   +5.856305783576939e-01   +1.034449361121810e-02   +4.423967684041992e-01   +7.487192315409171e-01   +3.895847177771599e-01   +1.928964513954421e-01   +1.961344975418137e-01   +1.986644304524700e-01   +6.569189248513978e-01   +4.855293655046279e-01   +6.603448951762875e-01   +3.639442972327940e-02   +5.905902666744488e-01   +7.359685941607644e-01; +1.842748947717771e-01   +2.887909516751782e-02   +3.321974175038939e-02   +5.069276543519958e-01   +3.804376682076454e-01   +2.730607525586776e-01   +7.517719484353119e-01   +2.924673186045646e-01   +5.181030938519162e-01   +8.603969581374828e-01   +2.392449947398453e-02   +1.304010274245118e-01   +6.611652501239870e-01   +3.963539873267967e-02   +3.776597218293913e-01   +6.034015531691844e-01; +1.113737294251136e-01   +2.023767656884911e-01   -2.308701463569666e-01   +1.030149312732297e-01   +3.372604815635251e-01   +5.566064949395081e-01   +5.960110608882616e-01   +5.858743185201650e-01   +2.442919071583798e-01   +5.175723878475472e-01   +2.057628135203839e-01   +5.291676745499750e-01   +2.212564611475318e-01   +3.306843730098757e-01   +3.710169270400027e-01   +2.431691405559213e-01; +6.157007196378755e-01   +2.365301971957046e-01   +3.642487569012500e-01   +1.150590261505615e-01   +3.784496501792193e-01   -3.278965585692202e-02   +4.387255230861024e-01   +2.699599025124124e-01   +1.221214906525517e-01   +5.004278159116876e-01   +3.769759253514652e-01   +3.596095079462118e-01   +1.155722671125044e-01   +3.887531834378571e-01   +3.307702212989875e-01   +5.461679800845601e-01; +1.217192088691098e-01   +4.711442375942861e-01   +1.143620847411448e-01   +1.256243819256839e-01   +9.326896003241135e-02   -3.140631066711057e-01   +6.409352394584781e-01   +6.528350927856155e-01   +3.246510429995282e-01   -9.030052240084992e-02   +6.397682734235280e-02   -4.222871314585427e-02   +8.440104979118054e-02   +4.726276227850543e-01   +3.676597421462662e-01   +3.371475136427193e-01; +2.932719775741446e-01   +6.293864693675921e-01   +6.490202414554306e-01   +1.246551762836369e-01   +3.770648995309529e-01   +6.629959853063822e-01   +6.484847324840891e-02   -1.756172709410794e-01   +1.454965388704303e-01   +2.659673474043858e-01   +6.846529334361598e-01   +6.546222273887731e-03   +3.683016833382425e-01   +7.776586929795181e-01   +2.053983479668971e-01   -1.739442604575293e-02; -3.424018715953714e-02   +1.003885872635363e-01   +3.139683139367379e-01   +4.857735022037922e-01   +6.057089672368207e-01   +1.359979120620141e-01   +5.111172583853720e-01   +2.307215687200613e-01   +5.020916191478282e-01   +1.969477890137770e-01   -1.367152624021452e-01   +3.642584079565682e-01   +2.374017253259622e-01   +6.072206419934317e-01   +3.801088163290983e-01   +9.474020969805695e-02; +8.806811359956543e-02   +9.098693845535383e-01   +5.495888412177797e-01   +5.869194067899789e-02   +3.482302782018774e-01   +5.039024802418343e-01   +9.449854165006465e-02   -3.312474541847633e-02   +3.096572948302860e-01   +3.722525386172165e-01   +3.632704435351609e-01   +6.717934217607248e-01   +2.865310925840622e-01   +3.833839653829176e-01   +2.816416702197407e-01   -7.737114429899523e-02; +8.150336425390457e-02   +7.099054526316211e-01   +5.823273284716930e-01   +6.805470311715405e-01   +3.845911812021973e-01   +5.204877807765056e-02   +6.480070974204127e-02   +6.701638230721971e-01   +4.297370296281802e-01   +3.482380029367046e-01   +5.924321635316485e-01   +4.624799317727505e-01   -3.884521804926207e-02   +5.717608336149790e-01   +5.040492117642057e-02   +4.448640341969565e-01; +6.981447251632309e-01   +4.172911413345091e-02   +1.479716611991985e-01   +5.297607666547848e-01   +6.853117744134599e-01   +8.512029794899759e-02   +1.520389619528803e-01   +4.550685034655168e-01   -6.685282961234593e-02   +1.833951092799216e-01   +5.432298858669381e-01   +5.130630171837798e-01   -8.909621022199911e-02   +9.572757620386836e-02   +1.914878871826272e-01   +5.403222506831585e-01; +6.332910452963959e-01   +7.305329228529325e-01   +8.144780219050879e-01   +2.098415163669669e-01   +2.657431132616983e-01   +9.272537524999526e-01   +4.133540414368571e-02   +1.690044572444406e-01   +6.188267637488557e-01   +4.964384069998551e-01   +7.005659647524721e-01   -7.936890470760910e-02   +6.000562745653300e-01   +1.876308100001816e-01   +8.297665504841738e-02   +4.871748513912041e-01; +3.154362173466547e-01   +2.110168427336607e-01   +5.183061929775206e-01   +6.169255408191286e-01   +9.666891782583894e-01   +5.827240104441546e-01   +7.867276146552787e-01   -4.820418921083602e-02   +8.422901702872847e-03   +2.546399757947138e-01   +5.645096599758139e-02   +6.819710301337526e-01   +4.855689066525695e-01   +2.838104351162348e-01   +5.662341856848071e-01   +4.119033319714733e-01; +4.275652661734044e-01   +1.000000000000000e+00   +1.254787433434640e-01   -1.605068988757882e-01   +4.771275608634563e-01   +2.431464446828943e-01   +2.314320210361767e-01   +2.136999542668472e-02   +4.501911272317025e-01   -1.182615651376573e-01   +3.509506028137407e-01   +4.147262489140920e-01   +5.520851423252442e-01   -2.018084194620658e-01   +2.661812850219085e-01   -3.525098326886338e-01; -6.414701740097087e-02   +4.120605017086059e-01   +6.977680994486524e-01   +1.727508996747000e-01   +3.127676742283112e-01   +3.653752346889835e-01   +6.103672142352271e-02   +6.070718036248377e-01   +4.162562675157997e-01   +1.465634947377278e-01   +2.388096123560753e-01   +7.361142455267016e-01   -9.288378049180034e-02   +9.542403273811256e-02   -2.331718841491814e-02   +3.220692633360960e-02];
L2I_L1I_iGABA_netcon = [+1.394878477585187e-01   +1.376658388760044e-01   +7.641428244821670e-01   +2.549520148699990e-01   +4.499375469562564e-01   +4.508746562754773e-01   +6.573497634112567e-01   +8.684662804542690e-01; +1.366686183842989e-01   +2.793242075517928e-02   +1.676691390039956e-01   +3.966340055170656e-01   +6.345992744456149e-01   -6.926442965451472e-03   +3.262245599954124e-01   +5.784481249183322e-02; +5.067399695168455e-01   +5.248699351725264e-01   -7.030156428637332e-02   +3.413153589855105e-01   +4.669212488798202e-01   -2.130493980123686e-02   +2.714671149348859e-01   +4.069441775672936e-01; +3.337310715554833e-01   +4.493678230914908e-01   +1.977431085678951e-02   +5.305111404338644e-01   +1.286805389962269e-01   -1.132701475697385e-01   +7.993628274010070e-02   -7.922447497841947e-02; +1.517773663053183e-01   +5.144776007129210e-01   +4.042779798180029e-02   -2.144593882010100e-02   +5.285328978132662e-01   +2.975413311505625e-01   +4.944070459488913e-01   +5.431768233990606e-01; +5.057238282420016e-01   +3.795461974085333e-01   +4.828876990756066e-01   +5.535514763783093e-01   +2.952385383774581e-01   +1.844499466001727e-01   +3.926097804249916e-01   -1.723467294919456e-01; +2.044276715474872e-01   +6.172275044777440e-01   +3.921075570060605e-01   +8.152895635174494e-01   +1.007517459460353e-02   +5.650956800313497e-02   +1.453522461208654e-01   +3.857915337884898e-01; +4.611424409972061e-01   +2.548925711348610e-01   -1.051982294445922e-01   +3.397926449153928e-01   +2.319667353731059e-01   +3.047135295487531e-01   +4.018163283306694e-01   +8.400063978737660e-02; +2.839536305440079e-01   +1.763078362643415e-01   +5.629975077959660e-01   +2.168752226864244e-01   +2.075299854934760e-01   +9.894489092839247e-01   +2.194613474093808e-01   +9.454797511371280e-01; +5.823826139777586e-01   +2.234929351729135e-01   -7.796207996422223e-02   -8.328373710107382e-04   +5.275179616002875e-01   -1.866730952753357e-01   +1.279677245333988e-01   +3.830686506851921e-01; +2.131663900993632e-01   +6.423511272649340e-01   +3.014828086694151e-01   +6.916030528871515e-01   +2.564607465766901e-01   +2.274108371773805e-01   +7.827849089725953e-01   +6.533169734298472e-01; +5.843819775239740e-01   +9.981664951704233e-01   -2.361539406191239e-01   +1.047839234018595e-02   +2.127892020427307e-01   +3.826165428987171e-01   +2.427009842849577e-01   +2.171569179660953e-01; +1.000000000000000e+00   +3.418843484053892e-01   +5.975877385012955e-01   +1.064501679976503e-02   +3.302720018105267e-01   +1.653473542751917e-01   +7.033907176783142e-01   +1.470318433678373e-01; +5.901403248881264e-01   +2.951829049665899e-01   +2.969616467606234e-01   +2.417127242490308e-01   +3.844667703946265e-01   +3.041853815680136e-01   -9.392972380337893e-03   +1.415694497068454e-02; -1.152984506463639e-01   +8.023827016241747e-01   +6.058444684696647e-01   +9.012820605245553e-02   +3.680308672068665e-01   +5.066514316038666e-01   +7.255884168596789e-02   +2.746764788350332e-01; +1.509678927900271e-01   +4.907362175129436e-01   +2.338792817611342e-02   +3.946267796441872e-01   +1.976083807992633e-01   +2.765660714273113e-01   +1.220569718778849e-01   -9.739908567493730e-02];
L1I_L2I_iGABA_netcon = [+4.029644927552811e-01   +5.851989693003794e-01   +1.226949293741816e-01   +3.110236080717789e-01   +8.126236149815445e-01   -2.357272743547114e-01   +5.330906345416935e-01   +2.002562943247237e-01   +1.482464795445621e-01   +4.181341598347649e-01   +5.433484561997445e-01   +4.851021403659914e-01   +5.782368597375831e-01   +2.285610307363049e-01   -1.062740216820273e-01   +3.913001141924322e-01; +7.753202531406085e-01   +3.775086764293146e-01   +6.090363052164118e-01   +6.420372677978995e-01   +5.486021449372090e-01   +1.000000000000000e+00   +4.598586996579324e-01   +2.731793815366522e-01   +4.251457613683056e-01   -5.890682553799573e-02   +7.706543915575452e-02   +7.753248202712605e-01   +6.002751635746649e-01   +1.246893492802835e-01   +5.218905952489944e-01   +7.765823596446740e-01; +2.914095233859372e-01   -1.476466168351086e-01   +6.798293298585772e-01   +5.491434858567102e-01   +4.261771398548188e-01   +4.404650650033643e-01   +2.816857291036431e-01   +6.726868174700735e-01   +4.216700716069552e-01   +3.334006637149917e-01   -5.045722574794127e-02   +3.835117696869375e-01   -1.194860260826855e-01   +6.516662701778764e-01   +3.993226599437928e-01   +3.257336057750532e-01; -1.677716919148956e-01   +4.445826913873049e-01   +3.967568607159996e-01   +7.661817490601328e-02   +4.000008009991854e-01   +5.577854410772380e-01   +8.531375031634220e-01   +3.224885276406864e-01   +6.824239923056091e-01   +1.327021338421632e-01   +4.338974516518751e-01   +8.233880716931982e-01   +4.529709813552690e-01   +4.491941641276319e-01   +7.271317527059911e-01   +3.520457059688748e-01; +6.286696714824498e-01   +7.560468183338404e-01   +1.868039590330152e-01   +2.630044252001215e-01   +1.649153588154875e-01   +1.162873772698330e-01   +7.134981110278112e-01   +1.484955589897434e-01   -2.524904289781775e-01   +3.588899622017481e-01   +3.985936088198345e-01   +6.359432245522106e-01   +2.334170553542788e-01   -4.952259799551783e-02   +5.565149203163373e-01   +7.726904136881771e-01; +6.117595098977349e-01   +4.673110717284748e-01   +4.633926081811153e-01   -5.986404084013753e-02   +3.189920888920231e-01   +5.052069692139034e-02   +8.752527926414206e-01   +1.683214738123560e-01   +4.857550477222965e-01   +6.938267133230089e-01   +9.340881115292721e-01   +7.757915158173082e-02   +2.203046741661190e-01   +3.924113836894944e-01   +2.707596340578485e-01   +3.126098920154818e-01; +1.433876011739659e-01   +6.683533006858344e-01   +6.058167337550875e-01   +2.914665523049238e-01   +3.844383312943382e-01   +9.320402694992802e-01   +7.212559675074844e-01   +2.746085910051665e-01   +8.778809877759605e-02   -8.438038324046382e-02   +5.877973767792952e-01   +1.814244830136048e-01   +6.410327064046065e-01   +9.135468033912979e-01   +1.339257312065255e-01   +4.890341517956734e-01; +1.947562988677952e-01   +7.581710868923708e-01   +4.067854384817960e-01   +6.625057755696449e-01   +5.074684657874819e-01   +3.825546149563921e-01   +4.794366461003333e-01   -2.773782082397141e-01   -2.398028772006877e-02   +2.089764108196807e-01   +5.729690199385389e-02   +6.476585724953505e-01   +1.018914808403737e-01   +8.550062799510815e-01   +4.314829085797329e-01   +4.092024026665395e-01];
L2E_L1E_iAMPA_netcon = [+4.646170355652574e-02   +3.003100977167723e-01   +5.160419415848876e-01   +4.589052552454293e-01   +5.501047327176198e-01   +1.915544640108207e-01   +4.992850260399936e-01   +6.757831004822916e-01; +5.533254911825628e-01   +3.211067291511787e-03   +4.549310297189285e-02   +1.095874318855956e-01   +3.315469001905885e-01   +3.387263612346540e-01   +8.328049184217839e-02   +4.289064809398110e-01; +2.868449035419224e-01   +2.714415774452634e-01   +3.328413440059566e-01   +1.000000000000000e+00   -5.849390861011278e-02   +2.966940442810916e-01   -8.386269108526167e-03   +5.088208637410434e-01; +1.268329219633571e-01   +2.247484967583954e-02   +3.164928835817227e-01   +4.722660003507689e-01   +6.654340192314240e-01   +1.387613131363354e-01   +6.461870434881188e-01   +2.985261006182319e-01; +7.435682066149757e-01   +5.859109281859239e-01   +2.430527898017411e-01   +8.800418982245413e-02   +2.098515600124403e-01   +3.093061593394436e-01   +1.952727516363378e-01   +1.213297852483036e-01; +5.571950187467553e-01   +3.183522064630155e-01   +6.812218750482727e-01   +5.959405126868134e-01   +6.582537275806943e-01   +4.520274276113320e-01   +4.000851620936439e-01   +7.414387772929456e-01; +6.890831313067606e-01   +2.738515683579695e-01   +1.393535428952912e-01   -1.352356347864329e-01   +2.846436749224364e-01   +3.834298832253053e-01   +3.938733799156937e-01   +6.740609682966417e-01; +6.270804222091538e-01   +4.616808251463214e-01   +2.345056096484272e-01   +5.308131771263798e-01   -1.437940005946180e-02   -3.986839386590368e-02   +3.933123033653784e-01   +9.875350769377106e-01; +9.366037339306729e-02   +8.572108447667919e-02   +4.044020126238858e-01   +7.622450756728695e-02   +4.211255774322859e-01   +4.754550416450441e-01   +3.870308170064533e-01   -4.381465136972175e-02; +2.974141809727857e-01   +4.968329116932965e-01   +3.415756057551321e-01   +6.547449643006993e-01   +5.302157553314241e-01   -2.346576126550144e-01   +6.886567578076020e-01   +1.572148996668795e-01; +1.003366169012222e-02   +1.297890318057101e-01   +4.335740574571889e-01   +5.854733115005881e-01   +8.869341536174828e-03   +2.705379912676160e-01   +5.925933944131719e-01   +4.115581208031255e-01; +6.623852919141845e-01   -9.091001955265754e-02   -1.715046673193297e-01   +7.276333023966394e-01   +4.874596779668720e-01   +4.566425270578131e-02   +3.420404804675458e-01   +4.265296215621907e-01; +5.279844790010737e-02   +5.191840210616795e-01   +2.016944249079970e-01   -1.919251195342985e-02   +3.143024312415622e-01   +2.159828171800166e-01   +5.026412472829833e-02   +3.420824088618912e-01; +9.255630568349413e-02   +4.899812748262165e-01   +6.808740189825619e-01   +3.802583883599474e-01   +2.016683136702220e-01   +3.331615843346406e-01   +1.724857806453977e-01   +5.654209860579043e-01; +2.624413571360271e-01   +2.565347791701106e-01   +2.391251167598353e-01   +6.147900216705251e-01   +5.371444958725231e-01   +2.366111146323552e-01   +3.834031384765563e-01   +7.155211700199046e-01; +2.127916243060934e-01   +2.100250387260556e-01   +2.913118625263963e-01   +2.192897489724773e-01   +6.142769842364011e-01   +1.261847448775531e-01   -6.309508340897248e-02   +2.064336957909339e-01];
L1E_L2E_iAMPA_netcon = [+4.927203455644303e-01   +7.650417334803244e-01   +1.072776503716160e-01   +4.271319303900579e-01   -3.513728636587365e-01   +3.158400581383813e-01   +1.064040849582517e-01   +7.304710041641166e-01   +8.135181511747117e-01   +3.290908010632795e-01   +6.074893322370086e-01   +6.152427205376696e-01   +6.605322410599779e-01   +2.170266147107202e-01   +8.043250369960828e-03   +6.767545278641182e-01; +4.556734444350075e-01   +6.116311006302518e-01   +7.519887228251479e-01   +6.269073806431921e-01   +3.750232474783548e-01   +3.855530856279298e-01   +5.150363245556532e-01   -3.006350580839697e-01   +2.439623168696632e-01   +6.214666152377016e-01   +4.381717423047361e-01   -2.621495650942720e-01   +5.717120715975735e-01   +8.295290552660521e-02   +1.568376930906990e-01   +1.355966668819799e-01; +5.304396581253719e-02   +4.407485232298074e-01   +6.096684646762317e-01   +7.137292280690697e-01   -4.467821520410008e-02   +3.240295693819597e-01   +2.874492809277378e-02   +8.351178847321251e-02   +3.650492446452667e-01   +6.927024034397927e-02   +7.633219404432799e-01   +4.589324124629990e-01   +1.622535357771794e-01   +6.147592355602509e-01   +7.225384323648028e-01   +5.228364001197043e-01; -1.013480679114551e-01   +5.434163156241418e-01   +2.674695959212656e-01   +5.939435134826098e-01   +8.004500039352978e-02   +5.506239277245976e-01   +3.825784984619121e-03   -8.046119267352067e-02   +1.708141294405278e-01   +4.107971826813108e-01   +4.787329073939485e-01   +1.679275902888303e-01   +2.050748553921146e-01   +2.403067337607136e-01   +1.991104963575276e-03   +1.113167389205684e-01; +3.086314165346267e-01   +7.927109143462457e-01   +7.540814539921064e-01   +8.794376355388930e-02   +3.925456015470034e-01   +8.205386061759103e-01   +4.097686834439984e-01   +1.956232480378336e-01   +5.010221904982081e-01   +5.576389830151475e-01   +9.535696536158266e-01   +1.359367930885547e-02   +7.397124327307137e-01   +7.058371598057596e-01   +4.142414629734158e-01   +2.466305270106314e-01; +4.021971779995880e-01   -3.115222855032833e-02   +4.629397666864750e-01   +5.914134196762294e-01   +4.286893350114666e-01   +5.564383071500227e-01   +8.298827056120873e-01   +3.059733667082153e-01   +1.677546293041053e-01   +6.759946084896642e-01   +5.288769703926082e-02   +5.449708164998409e-01   +4.828639119295824e-01   +2.464309893623474e-01   +6.958240729987683e-01   +7.685592711772512e-01; +5.379349951461573e-01   -2.058421412547197e-02   +2.626088947337522e-01   +4.925222727528750e-01   +3.970021094308109e-01   +1.977847668234158e-01   +9.380615893545879e-01   +8.978548466698714e-01   +2.843902683021278e-01   +3.138458475493259e-01   +5.760377193525585e-01   +4.698300595567859e-01   +2.096510370205483e-01   +6.289826261363481e-01   +2.829719614745785e-01   +2.421878970439245e-01; +4.964932161677609e-01   +5.845037583250771e-01   +5.943708416054274e-01   +7.395413917847782e-02   +8.320477907007692e-01   +1.835947523214214e-01   +2.575734872555450e-01   +5.315287074063311e-01   +5.608905072753977e-01   +2.856462501976320e-01   +3.671372858654223e-01   +2.419433228683436e-01   +5.137617246572213e-02   -1.749001270559296e-01   +3.203211528384974e-01   +4.117763028979422e-01];
L2I_L2E_iAMPA_netcon = [+2.340572417514730e-01   +9.024345260489378e-01   +6.230405535481230e-01   +6.755735900581114e-01   +4.338648468183687e-01   -8.562648751783891e-02   +8.207545629651952e-01   +6.574106324626222e-01; +8.243019906727459e-01   +8.446575188180176e-01   +1.769410179248005e-01   -3.748941701366429e-02   +5.176855919315571e-01   -2.420139161776402e-02   +3.499855704502902e-01   +2.180566028350019e-01; +5.485295960538766e-01   +6.498312062525329e-01   +7.432684663913134e-01   +1.212952331773180e-01   +3.643219232245176e-01   +7.340247949731725e-01   -4.499858444390447e-04   +2.754688705453541e-01; +6.465643420986955e-01   +7.312721642570608e-01   +4.382490146198482e-01   +2.029569904444164e-01   +7.445258507623450e-01   +9.306922015552689e-01   +8.562551331088014e-01   +8.972706481802913e-01; +9.657202166475989e-01   +4.645480302207849e-02   +3.565582844094333e-01   -1.361683686907730e-01   +1.709992329652042e-02   +7.563950738098182e-01   +4.556232163253231e-01   +3.000917203862323e-01; -2.237275195004430e-02   +1.450674028306227e-01   -5.735158686411872e-02   +4.313211526027323e-01   +8.854313903008736e-02   +6.864023475245633e-01   +6.666217813795680e-01   +1.052795045707303e-01; +8.870531553605131e-01   +9.895450250927128e-02   +3.039251310053169e-01   +4.727751089851848e-02   +2.931978639235382e-01   +4.625187175191925e-01   +5.333236541194457e-01   +3.426362486983462e-01; +4.025726885525734e-02   +2.170057608482477e-01   +2.487047015753745e-01   +1.613020438070978e-01   +7.654890554696221e-01   +5.867960485056024e-01   +4.079416040110076e-01   -4.906321963384287e-03];
L2E_L2I_iGABA_netcon = [+8.603413975517583e-01   +6.881713215476042e-01   +7.615462155755537e-01   +5.942922915321821e-01   +4.006360545353157e-01   +1.284528131363603e-01   +2.682515350269640e-01   +1.937546354844183e-01; +3.341929350063298e-01   +7.519515630034792e-01   +8.527879336471414e-01   +1.000000000000000e+00   +2.654885517429484e-01   +4.202447344929095e-01   +6.252521925204470e-02   +6.830112287773823e-01; -1.310259107501302e-01   +5.553532463521419e-01   +8.161598376211924e-01   +6.802473776116817e-01   +5.828737643525799e-01   -4.594459297479392e-02   +5.975359214792897e-01   +1.554515650192293e-01; +4.311125984278130e-01   +1.747900016295197e-01   +7.455981126560122e-01   +1.531713963544583e-01   +4.770414157968424e-01   +2.757948045161844e-01   +1.595039924273980e-01   -2.136045036593902e-01; +4.637842557845591e-01   +7.575148596439916e-01   +5.105075424267923e-01   +4.003793535255060e-01   +3.398935554423990e-01   +5.895484964837867e-02   +6.919741183912351e-01   -4.815382502478944e-02; +4.474043658628570e-02   +5.940942484426591e-02   -1.943254119074893e-01   +2.272084088179535e-01   +6.371865227654125e-01   +3.418821365047137e-01   +3.242802149452382e-01   -5.900577023063083e-02; +4.140165326805760e-01   +5.038232908749992e-01   +1.356042743120592e-01   +4.874411707268590e-01   +4.059550507564253e-01   +6.809548274864451e-01   +5.154602880349330e-01   +6.766798908065393e-01; +3.502727324366990e-01   +1.699195635111407e-01   +4.491668946382155e-01   +5.017071721431382e-01   +2.997278661249440e-01   +1.683567817455761e-01   +1.597128753281148e-01   +3.166848511955757e-02];
L3E_L2E_iAMPA_netcon = [+2.233982484613327e-01   +1.032623035462322e-01   +5.552346095848589e-01   +3.219105425019384e-01   +4.378885971873220e-01   +3.703287601890295e-01   +4.325413948476176e-01   +5.605297749912567e-01   +2.301514570825958e-01   +7.533127432251353e-01   +7.434556471279451e-01   +4.176060061413944e-01; +3.061125935298881e-01   +3.131107712508438e-01   +5.354278635733498e-01   +3.388762071334874e-01   +9.187575161653948e-02   +2.392830272398329e-01   +1.864200422510980e-01   +7.398273860629161e-01   +2.931529305224698e-01   +4.040194021957551e-01   +4.948461828707708e-01   -1.277231597621921e-01; -1.218151342101881e-01   +2.974978433893516e-01   -5.831623168097576e-02   +4.661521801555777e-01   -1.033792650945045e-01   +1.612162240515071e-01   +4.344798443275988e-02   +2.753223016485515e-01   -1.881610582603396e-01   +2.195836309067636e-02   +1.529018867888174e-01   +3.691857412379423e-01; +4.218242717436715e-01   +1.847896673998826e-01   +1.026308226010045e-01   +2.545470026908388e-01   +3.757066986645009e-01   +3.157133747384770e-01   +7.875070203307057e-02   +1.720016906845902e-01   +4.531416969331625e-01   +2.347261592407373e-01   +3.768948958422264e-01   +6.742788321999200e-01; +6.224838724784740e-01   -2.654610781936928e-02   +5.903275803194620e-01   +4.326530798850993e-01   +2.383703947250013e-01   +6.929456716189343e-01   +4.300976424852782e-01   +6.978468655604277e-01   +9.797637965718481e-02   +5.210423132438754e-01   +3.666883622393320e-01   +2.626886722774568e-01; +6.345884271330673e-01   +3.216387488585486e-01   -2.447028253834896e-01   +6.332584686725878e-01   +5.178995582214799e-04   +6.053395011842253e-01   +7.276614278810644e-01   +3.875128276021820e-02   +8.680575830342713e-02   +6.878795829716413e-01   +1.795883177960844e-01   +4.518946116140188e-01; +1.140914542672976e-01   +4.574709048697168e-01   +5.867157814228537e-02   -2.056986730083034e-01   +9.293188309174261e-01   -1.346351253291413e-01   +3.000312703535885e-01   +6.316114938634952e-01   +9.216849713784769e-02   +5.405088050356975e-01   +2.383511830438555e-01   +6.933328783283061e-01; +3.987291999696753e-01   +9.265194425745611e-02   +1.839266455698920e-02   +9.280404749249094e-02   +6.546879677091344e-01   -2.399052864850983e-01   +4.613451675098456e-01   +1.410943119040892e-01   +9.529155824988872e-02   +4.106750824945090e-01   +6.339711043082041e-01   -3.593613562884938e-02];
L3I_L2I_iGABA_netcon = [+5.097140777407788e-01   +4.076128510440863e-01   +5.731729241013640e-01   +1.403038644119912e-01   +2.489480758540118e-01   +5.268209854822091e-01   +4.932024164050924e-01   +2.480928383846221e-02   +1.450095565072980e-01   +4.505881521310615e-01   +5.242462935261822e-01   +6.383710349902526e-01; +3.277526757126917e-01   -3.113964463682683e-01   -1.646959577626061e-01   +7.617664787406873e-01   +2.530148084949043e-01   +6.169193798859328e-01   +3.747349270682120e-01   +1.444542629204160e-01   +7.752941406266987e-01   +1.826149855528482e-01   +7.534692084205280e-01   +4.097358515456910e-01; -3.851595373621457e-02   +5.828426028361021e-01   +7.216510226082423e-01   +4.733734976481495e-01   -3.316504611529190e-02   +3.902910290316801e-01   +1.136138872601215e-01   +6.979668892006838e-01   +4.372826148286263e-01   +4.050668588079183e-01   +6.616217070730475e-01   +5.631911491571030e-01; -2.359029733663298e-01   +1.656346522314271e-01   +8.206663589263263e-01   +3.860312131369545e-01   +4.889299269789702e-01   +4.557904025070231e-01   +1.273938317920723e-01   +3.640708545121072e-01   -1.143073635852030e-01   +2.099927517968357e-01   +1.531277749451629e-01   +6.389380686705987e-02; +1.776606490692156e-01   +3.107251484536191e-01   +1.070578587469891e-02   +5.728074828416625e-02   +2.847526133778046e-01   +4.012592081344124e-01   +3.761357679021139e-02   +1.237899442459170e-01   +1.946434587387761e-01   +4.526053564646988e-01   +6.990592238651151e-01   +5.029622679667676e-01; +5.943268320500840e-02   +5.861697168294588e-01   -2.627142900145250e-02   +4.746068878786625e-01   +8.005295786093880e-02   +1.724072268897853e-01   -1.779806628266322e-01   +6.383971204025259e-02   -1.566780752280378e-01   +8.160883711857158e-01   +7.181194718535768e-01   +5.681283724056814e-01; +6.226525169748460e-01   +4.086247970048337e-01   +5.602839309163984e-01   +4.972528112606607e-01   +4.050006991686522e-01   +2.674475121147362e-01   +3.886916169569791e-01   +7.190962643897672e-02   +2.036546782743322e-01   +7.555333518466122e-01   -1.407350239110347e-02   +3.567077372861852e-01; +4.797519598946945e-01   +6.129541223634163e-01   +3.779629435152627e-01   -5.912837013474614e-03   +4.827182400631386e-01   -2.104681913439587e-01   +9.699086821444073e-01   +5.760960667887708e-01   +8.670793708601234e-01   +5.139967977989454e-01   +3.090925596156354e-01   +6.292056390231008e-01];
L2E_L3E_iAMPA_netcon = [-4.332560410273922e-02   +1.752403962164523e-01   +1.778726576469005e-01   +5.880210855461137e-01   +3.372299705500343e-01   +1.017335107226677e-01   -3.417554783172087e-02   -5.358668509492781e-02; +4.210444452013816e-01   +5.211664339651769e-01   +5.644697737910100e-02   +5.363562125202086e-01   +1.125015507875085e-01   +3.836278327073280e-01   +1.165122236307779e-01   +6.541321427967408e-01; +5.269426673910804e-01   +3.947812595046204e-01   -4.344222192693938e-02   -7.880828432893482e-02   +5.938614696113339e-01   +3.912148164354646e-02   +2.423870518445911e-01   +2.337472642735764e-01; +2.388997989959684e-01   +5.545723096815079e-01   +4.882852557552037e-01   +2.890089909975716e-01   +5.743555386702743e-01   +3.865843620536786e-01   +1.772153718114290e-01   +4.803467463746876e-01; +8.885394664056612e-02   +2.688133073966254e-02   +4.636581743002789e-01   +4.896957765634030e-01   +3.755578416975366e-01   +1.557460074495432e-02   +5.477901377409398e-01   +6.139812832037404e-02; +4.539751612092138e-01   +5.220143082672111e-01   +9.888469043018100e-02   +6.992217434086588e-01   +1.037442771149090e-01   +3.489273984024326e-01   +4.436820388356990e-01   +5.221955598748150e-01; -1.661624777826645e-01   +3.431935788723259e-01   +3.968452940349153e-01   +3.549228046037942e-01   -1.073495052281538e-02   -1.834440548366197e-02   +7.071315977247750e-01   +2.771087827446431e-01; +4.960906071609448e-02   +6.336203636508088e-01   +3.563826970141854e-01   +2.820855105494095e-01   +2.840931360773051e-01   +5.177967472937107e-01   +5.056272309986649e-01   +1.421487513838161e-01; +7.458747165008052e-01   +6.206516417361717e-01   +3.955996660381726e-01   +7.168723827185723e-01   +1.409726186723213e-01   +2.839488462893650e-01   +4.015239731352680e-01   +9.344407190274385e-01; +2.394358356003246e-01   +1.616362996685324e-03   +2.809831531593362e-01   +5.531308006659488e-01   +2.870085379365707e-01   +1.788974716509569e-01   +5.855214285895571e-01   -3.889042632409366e-01; +1.629746874979116e-01   +1.669441256367944e-01   -7.815204512374309e-02   -1.151113107929513e-01   +2.856851594756590e-01   +3.506678304756501e-02   +1.655162738426840e-01   +7.501402760074867e-01; +3.219357787980248e-01   +1.904226275673981e-01   +5.534510461475253e-01   +4.408429127282024e-01   +6.620731341478944e-01   +1.573818616577212e-02   +1.710082802382094e-02   +3.562998508279526e-01];
L2I_L3I_iGABA_netcon = [+2.391574914483537e-01   +3.007872743856822e-01   +1.630004436514006e-02   +8.728927149325907e-01   +2.097094379177797e-01   -2.368741403121182e-02   +4.340865065567998e-01   +3.475035710271326e-01; +3.713966005327728e-01   +1.499741659564109e-01   +1.059470977862523e-01   +1.927344315117086e-01   +1.061179718532007e-01   +3.034886750047394e-01   +1.000000000000000e+00   +1.745721887570136e-01; +1.559527539223778e-02   +2.471755054488330e-01   -1.316319131286685e-01   +4.993666155462759e-01   +2.165791656958353e-01   +3.421100524375510e-02   +1.018439295117138e-01   +3.692009878238806e-01; +1.037760089916981e-01   -3.262820931921348e-01   +3.074952762705130e-01   +4.873596929355225e-01   +6.667637242051236e-01   +1.707155080029354e-01   +4.925092036954080e-01   +2.156807369733885e-01; +2.622952579192428e-01   +5.753444011854982e-01   +2.902852649820055e-01   +3.943939310006912e-02   +3.057440722831282e-01   +2.789360997598254e-01   +2.214413152940669e-01   +4.883940511706206e-01; +6.080744741628276e-02   +3.183814598735326e-01   -4.400526521077171e-02   +5.422746117568378e-01   +3.559206288273489e-01   +6.846657567287933e-01   +1.443721628676983e-01   +4.167248695935663e-01; +4.784223110734168e-01   +3.988284248702797e-01   +2.952573269328392e-01   +4.578903881341019e-01   +4.004712490886149e-01   -1.799832735972781e-01   -3.817806984142430e-02   +2.585564991431346e-01; +4.468839452803090e-01   +5.682531572403697e-01   +6.310044663895146e-01   +3.002260918174893e-01   -1.398280585490047e-02   +4.348829389244350e-01   +1.932494966042774e-01   -1.115908832075178e-01; -4.040236434629003e-02   +1.165131459624540e-01   +2.878869419428040e-01   +3.333062568461216e-01   +4.684852432390665e-01   +4.891517425587844e-01   +4.396747557969297e-01   +2.915880206847886e-01; +5.490734172182024e-01   +4.620638769553134e-02   +3.839253227978720e-01   +3.684979549171750e-01   +4.175702281958033e-01   -2.978557686778737e-03   -8.938153410619769e-02   -4.925874448498943e-02; +3.123602939372192e-01   +7.515486188590290e-01   +3.140239409915255e-01   +5.146810204800820e-01   +1.193256602141215e-01   +9.214652796330451e-02   +3.344154769953590e-01   +1.404459322782479e-01; -5.472338486073510e-02   +2.472240503433874e-01   +4.404615330433758e-02   +2.143335580274582e-01   +6.509034359458121e-01   +5.462596410323660e-01   +5.699948378659675e-01   +1.141826981245108e-01];
L3I_L3E_iAMPA_netcon = [+1.615338254927038e-01   +6.764102235924667e-01   -2.458806376135091e-01   +4.864093347551071e-01   +9.412534829574148e-01   +2.226810102780904e-01   +4.428977019126222e-01   +5.389584546919904e-01   +1.269127664154351e-01   +1.159946466882254e-01   +2.822127759043908e-01   +4.084300788798601e-01; +6.847711608208069e-01   +9.883629884199943e-01   +3.807444830701435e-01   +3.361996329115454e-01   -1.647032301914654e-01   +6.505701776380703e-01   +5.713909304622671e-01   +9.977282047925889e-01   +6.037085962590027e-02   +8.409855486358532e-01   +4.184614916472431e-01   +5.246743970475659e-01; +4.355816864591806e-01   +4.886525445514495e-01   +8.358478259474272e-02   -2.492655255909238e-01   +8.463786191034539e-01   +5.570920446358364e-01   +3.536474093110629e-01   +7.972906043196764e-01   +2.662592829025577e-01   +3.738673635671322e-01   +7.984975756643624e-01   +5.253016576407241e-01; +8.680260287377888e-01   +4.218161864089857e-01   +4.021436723816702e-01   +9.927069918625444e-01   +7.991020140143383e-01   +7.609815054584159e-01   +7.855061358973195e-01   +6.644957472752991e-01   -8.317630333437374e-03   +6.475848888210830e-01   +3.635517660828200e-01   +7.313184082581526e-01; +1.027524523814240e-01   +2.145671037808057e-01   +4.287988005397259e-01   -1.422739663797162e-01   +5.856099820701752e-01   +9.487183385762973e-01   +8.798449759241904e-02   +7.907197679520025e-01   +9.404897873260515e-01   +1.856305379641505e-01   +7.766663309738153e-01   -2.955277021646102e-01; +1.124464352867441e-01   +7.890413544943734e-01   +2.496448863792716e-01   +3.625442189847944e-01   +3.290129822557111e-01   +8.197934344006895e-03   +5.047856352173210e-01   -1.451687035487923e-01   +3.666360677967740e-01   +3.759123194849900e-01   +4.098720140974626e-01   +2.725562928259243e-01; +4.348261047549436e-02   +2.249894621338993e-01   +2.904781058853350e-01   +2.203820425500592e-01   +8.970962085159282e-01   +5.206945924510527e-01   +3.596909889076290e-01   +6.186635708547432e-01   +1.031966486786116e-01   +5.094110776799549e-01   +9.359747668185998e-02   +2.765139974076575e-01; +2.704060785806862e-01   +2.634889908683805e-02   +3.410331872078247e-01   +2.130236078161690e-01   +1.694141949060507e-01   -1.217220245882497e-01   +1.953038792005353e-01   +2.700060953347033e-01   -1.240360172348829e-01   +8.301303332046490e-01   +3.748070089817178e-01   +2.127214731270636e-01; +2.028892306618120e-01   +4.391436295542049e-01   +4.124841652810950e-01   +2.015629966179674e-01   +3.679417369352094e-01   +1.805566560971207e-01   +4.460664606734654e-01   +1.534100651358077e-01   +5.579123809381175e-01   -1.191665193674982e-01   +4.595019338357405e-01   +4.213103248528561e-01; +7.010422738681277e-01   +7.236587181649777e-01   +3.902056236826701e-01   +5.221659271878637e-01   -8.642319416374705e-02   +5.405239255253913e-01   +6.098752329864693e-01   +6.261639301382488e-01   +5.983425178723768e-01   -2.134417221908571e-01   +6.638685196912526e-01   +2.459110844130310e-01; -1.494724233313889e-02   +2.033981307966566e-01   +3.034710573199192e-01   +3.372420847240033e-01   +1.690390599061854e-01   +2.858912946953666e-01   +1.064217266083587e-01   +6.509236633378395e-01   +8.710232975852176e-01   +6.391792919983688e-01   +3.200155133260938e-01   +5.245300484169697e-01; +2.364951484831342e-02   +5.935648454925611e-01   +1.639257815921715e-01   +7.340259126104965e-01   +9.256337189005103e-01   +2.249726089166396e-01   +2.117346922631285e-01   +4.574559331017136e-01   +4.932716916022569e-01   +2.412930360520001e-01   +3.321008179021301e-01   +3.056694916719722e-01];
L3E_L3I_iGABA_netcon = [+6.468216066838666e-01   +7.030587773007348e-02   +1.850886849669907e-01   +5.066701544710391e-01   +4.500705809462140e-01   +9.615090406701919e-01   +6.899871641796850e-01   +8.288390444205196e-01   +6.295202924927502e-01   +2.769747237634702e-01   +3.361718095727290e-01   +4.612599358832910e-01; +3.358940637788961e-01   +1.651536948480712e-01   +7.529904290110846e-01   +1.013679775320998e-01   +3.698311190996539e-01   +7.900016809646698e-01   +9.523730195204274e-01   +1.979710455956861e-01   +1.738383796735280e-01   +3.584114088452893e-01   -9.840922327989552e-04   +5.300422751786500e-01; -7.362999068058103e-02   -1.217368659690098e-03   -3.513360550609554e-01   +5.449753444339551e-01   +2.539107279458941e-02   +4.271291330000450e-01   +4.644053450215030e-01   +5.587107780376076e-01   +5.917054367762260e-01   +4.936258681612445e-01   +4.348314871467051e-01   +3.382419023006852e-01; +3.318832193235019e-01   +6.531354609967296e-01   +5.002611117366790e-01   +2.167389821243793e-01   +6.122570541391578e-01   +2.915170549324310e-03   +4.426049412062378e-01   +2.204896498203185e-01   +4.731244332112509e-01   +1.087690519027038e-01   +5.410167718602775e-01   +2.430829308522670e-01; +1.208047828557827e-02   -1.842423660908513e-01   +4.549520920089512e-01   +5.002513707241067e-01   +1.847053300067797e-01   +2.363766709572018e-02   +3.867118616573675e-01   +4.362681429417630e-01   +2.131866925465567e-01   +2.168066302693148e-01   +4.143268727080122e-01   +1.347875480468771e-02; -1.582909730930565e-01   +9.359274501439301e-03   +7.159844581609982e-01   +6.366366224162077e-01   +4.655429769408292e-01   +1.309779448417506e-01   +8.227651233228192e-02   +2.346307006580929e-01   +3.633969498320534e-01   +4.015716035095677e-01   +5.276861323080417e-01   -1.767866715975255e-01; +5.965738114918125e-01   +2.484008900506068e-01   +4.425190194410714e-01   +5.319841794471496e-02   +5.278934625171652e-01   +4.133293617570653e-01   -1.831733502797531e-01   +6.296967856356926e-01   +4.182683008347297e-01   +3.867788776101809e-01   +3.808665278058001e-01   +1.520823853652829e-01; +2.120242124851894e-01   +1.026535735186189e-01   +1.338575034187785e-01   +5.300921571378967e-01   +5.832716931088886e-01   +3.115602368014591e-01   +3.723473159393831e-01   +1.210529911062678e-01   +5.185601747018258e-01   +1.391227262517979e-01   +4.586981832207586e-01   +6.671360860321992e-01; +2.554398709183388e-01   +2.130141033015224e-01   +4.678668929997897e-01   +7.176434302611195e-01   +4.871616687386930e-01   -3.044280067954162e-01   +5.419041075496988e-01   +4.208805427758945e-01   +2.241879590124595e-01   +6.499476569266432e-02   +6.034522220947859e-01   +6.848532104993165e-01; +2.902739241616671e-01   +6.148640886233965e-01   +7.906095795819374e-01   +9.459189937315533e-01   +4.438572417220449e-01   +3.019549077223496e-01   +7.420020050400116e-01   -3.251475490137934e-01   +7.366334835324797e-01   +5.265904254433154e-01   +9.517490074269219e-02   +1.795251770180221e-01; +1.940244727512048e-01   +4.423043665206818e-01   +1.082218835859641e-01   +6.359906338818015e-01   +5.692733398708077e-01   +2.692353374261154e-01   +5.812793106638158e-01   +5.721291835656441e-01   +7.167755659531101e-01   +7.219514931999595e-02   +2.505865888202875e-01   +7.103117968632989e-01; +7.659704054884197e-01   +2.103644220204272e-01   +4.234343233070126e-01   +4.170165907325823e-01   +3.446880518571224e-01   +4.056918704682121e-01   +3.832427256018599e-01   +2.508367607779222e-01   +2.824294670329776e-01   +2.124980634229825e-01   -2.151066022067256e-01   +2.910748833500429e-01];
L2E_Input1_iAMPA_netcon = [+4.947204843330896e-01   +6.698485143544820e-01   +4.896129190611317e-01   +6.901491577322725e-01   +1.000000000000000e+00   +6.672082727812035e-01   +9.678593819472767e-01   +4.407264506080265e-01];
L2I_Input2_iAMPA_netcon = [+9.260375683784315e-01   +5.803065212506822e-01   +6.912921863389980e-01   +6.093314976443527e-01   +4.565427234142266e-01   +8.961309676882779e-01   +1.333555926220686e-01   +6.652826130248990e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last =  11.21 * ones(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.5*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.4*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.5*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.4*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.5*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.4*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.5*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.4*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
