function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+5.017935920087806e-01   +1.615835975277270e-01   +7.508497521915490e-01   -2.479014402800243e-02   +2.450737907665078e-01   +8.092054486982686e-01   +9.034354618702467e-02   +1.718426097124307e-01   +2.794575615837011e-01   +6.941723281421769e-01   +1.198619086226081e-01   +3.146755916274048e-01   +5.828869686914204e-02   +4.361807014213270e-01   +6.688709490382133e-01   +4.789218031061065e-02; +6.657061728078087e-01   +3.142302500882243e-01   -2.473687856573718e-01   -1.779915751180617e-02   +5.830241208305471e-01   +6.057855242578905e-01   +9.425179512425745e-02   +2.549808377816333e-01   +3.462595139494242e-01   +1.718197104053892e-01   +4.386184657401946e-01   +5.303519884714250e-01   +4.924656541783166e-01   +8.779628841993250e-01   +6.287684840582707e-02   +2.796667057386354e-01; +5.853829778833585e-01   +4.259170639786782e-01   +5.461718593125810e-05   +4.709908092084574e-01   +4.842656996988161e-01   +1.424608357645513e-01   +1.569983048314175e-01   +1.948270216286094e-01   +2.463715278312371e-01   +3.015642513598332e-01   -1.391431332457064e-02   +3.116051071462633e-01   +3.823379208386127e-01   +6.144618476536725e-01   -5.202006774806097e-02   +3.766820259325859e-01; +6.056143995134228e-01   +4.647419713294532e-01   +7.393727808467584e-01   +9.909338499977456e-01   +8.589107336980296e-01   +4.744307531855654e-01   +8.083871769842800e-01   +8.728871757827036e-01   +8.646358836584955e-01   +5.098846167945245e-01   +2.893384342496257e-01   +2.853572655607378e-01   +4.144041831188908e-01   +4.930656140241008e-01   +1.902964025127691e-01   +3.128932470875208e-01; +3.877386914477198e-01   +7.630704775822998e-01   +4.305467068374838e-01   +9.894344758227672e-01   +2.133837366443635e-01   -5.551493656295063e-02   +3.189898026734669e-02   +9.209673049227476e-01   +6.712974176173673e-01   +5.710526417577705e-01   +8.262596158552479e-01   +2.918926748092819e-01   +7.568144285413119e-01   -3.128124809763089e-02   +1.332791047943654e-01   +3.384350161645742e-01; +2.884700718538522e-01   +2.759121945678591e-01   +5.665914102313661e-01   +4.025453920387077e-02   +2.232077418454301e-01   +7.713073885801994e-01   +4.710762113941814e-01   +5.009976672955033e-01   +1.961951564588941e-01   +4.280455463787874e-01   +1.598663939576688e-01   +7.991473803809657e-01   +6.263433462128373e-02   +3.385216426497912e-01   +5.019564486326973e-01   +6.084594058622457e-01; +6.143226139853968e-01   +5.306835097748334e-01   +6.493285864111391e-02   +1.293537662798086e-01   +5.344477076666854e-01   +5.132345710777482e-01   +4.872701624003940e-01   +1.464391619169094e-02   +3.088448922837782e-01   +4.196578408857108e-01   +5.211422789739112e-01   +5.486219789640140e-01   +6.175622739692814e-01   +6.512126142931934e-02   -8.492729596042989e-02   +2.099946211365843e-01; +8.156183310757967e-01   +7.898247066286895e-01   +4.900665264536667e-01   -1.140501062186684e-01   +4.074406056587868e-01   -1.066479079119137e-01   +3.747360951861745e-01   +2.132320087744783e-01   +4.329789527852391e-01   +6.934559500089833e-01   +3.282674928861892e-01   +1.565319772445725e-01   +1.988819823480896e-01   +2.509898097280093e-01   +1.038895977887807e-01   +7.674902408949219e-01; +2.190546724996228e-02   +5.235019303788213e-01   +1.527659952488200e-01   +3.714871699252587e-01   +7.210057637389389e-01   +1.122460455875890e-01   +4.012308978449264e-01   +4.350025020338085e-01   +2.373650652347341e-01   +1.771179813132842e-01   +5.953302499883129e-01   -2.103188546059104e-01   +1.880219308702500e-01   +2.116119854392767e-01   +1.960414692696016e-01   +9.201137728828371e-03; +4.127943967280418e-01   +3.763388120856447e-01   +3.000471497958113e-01   +3.612571522638333e-01   +7.390642304842218e-01   +5.164947194820823e-01   +5.253151174390559e-01   +3.376557504990041e-01   +1.784360448061355e-01   +5.803935763283660e-02   +1.336700422662604e-01   +6.505531023931607e-01   +5.644659300675579e-01   +7.061347788706680e-01   +1.582569967357880e-01   +7.232878777786345e-01; +4.379173138838280e-01   +5.460633910841450e-01   +2.791103048488432e-01   +5.293039757257223e-01   +6.027813875388885e-01   +2.946397708707558e-01   +4.694735506503532e-01   +8.007246736959991e-01   +3.350319447119255e-01   +8.368943852003616e-02   +4.497668636017167e-02   +7.464504225855148e-01   +3.368921031427292e-01   +4.096729852658096e-01   +3.909660048659179e-01   -6.171234140215575e-02; +3.452231687237504e-01   -4.053268757183994e-02   +5.043444977136472e-01   +5.424901251033789e-01   +4.692906957979451e-01   +2.927925875957892e-02   +4.696668101537928e-01   -1.056043532244307e-01   -1.090258788565902e-01   +5.078878976764705e-01   +1.985179185620634e-01   -1.985592563357177e-01   +7.245226726029290e-01   +6.192048686849279e-01   +7.129744746411068e-02   +2.932085346916889e-01; +2.515699971737244e-01   +2.582249582578377e-01   +9.322964998457148e-01   +7.428784005514262e-01   +6.796597588858994e-01   +8.345725720985736e-01   +1.959483290984049e-01   +2.920563607619550e-01   +2.177273752511440e-01   +1.911444595102854e-01   +3.988286417484586e-01   +5.758208874551428e-01   +2.895140345455660e-01   +5.415409144129020e-01   +5.127020126232239e-01   +4.034139232823922e-01; +5.424230347802755e-01   +8.619551480046461e-01   +6.392224340485755e-01   +6.933084258526303e-01   +7.598585265559964e-01   +4.284492234509728e-01   +1.931916821598156e-01   +2.123102876414119e-01   +5.082199310780382e-01   -2.006263228470924e-01   +3.940135562293436e-01   +3.304065452208089e-01   +2.712418764214819e-01   -1.987018616617161e-01   +1.446500602043919e-01   +2.619353752163496e-01; +1.418208246398731e-01   +5.044856205844261e-01   +4.258198152139330e-01   +3.229549394365885e-01   +5.261302394608950e-01   +8.088154251232752e-01   -3.191627119692171e-02   +4.104886551026506e-02   -2.069638292564150e-01   +4.194746159745560e-01   +5.187883317160130e-01   +6.974190286730398e-01   +7.597570159994683e-01   +8.162611433379365e-01   +4.056843213812178e-01   +6.035487744210659e-02; +6.705836503731698e-01   +1.468660245834796e-01   -1.580478648461322e-01   +3.031700801371938e-01   +5.947231809797109e-01   +4.835381124393231e-01   -1.778630723791110e-01   +5.319343329448822e-02   +3.344873683539308e-01   +5.303136791665229e-01   +6.585389380566516e-01   +3.675623068299552e-01   +6.837643551034676e-01   -1.814450732810781e-01   +5.283975058032470e-01   +4.138539385987931e-01];
L1E_L1I_iGABA_netcon = [+4.874803847172351e-01   +5.904042130821867e-01   +4.976667296965055e-01   +6.332939202677741e-02   -6.877076460982537e-02   +2.874678600472185e-02   +5.721580571767823e-01   +1.037675620235720e-01   +6.133197541827131e-01   +4.970886995063977e-01   +4.331044406097431e-01   +3.827798182423762e-01   +7.095413533903600e-01   +1.420382170522438e-01   +3.828799568533719e-01   +1.876242868652965e-01; -1.009045387754803e-01   +2.172811336209769e-01   +1.466527917610002e-01   +3.508967505351678e-01   +1.736724384776361e-01   +2.934175172998561e-01   +4.159760707931265e-01   -2.562655712914271e-01   +7.531520851773678e-01   +3.659131271574236e-01   +5.011843052857001e-01   +5.350977016350591e-03   +3.368033804538215e-01   +2.152321962964814e-01   +3.049040996022343e-01   +4.636628594851038e-01; +6.730579466086750e-01   +4.351517871311217e-01   +4.113249195501282e-01   +6.867207909192628e-03   +4.901486747004231e-01   +7.476600246057042e-01   +2.469741129625961e-01   +1.384752040632679e-01   +4.074416190889079e-01   +2.170297498987783e-01   +7.549234407316230e-01   +6.515738588390751e-01   +6.958011067653957e-01   +1.203598408602392e-01   +4.667204524895171e-01   +5.265682897775059e-01; +1.615871847549449e-01   -4.134422062436113e-02   +1.062816962105781e-01   +5.700782127253708e-01   +5.791918634035258e-01   +5.258624472938087e-01   +7.603253389454274e-01   +2.977704472566822e-01   +3.733850577672231e-01   +7.417963232805850e-01   +1.587182404955368e-01   +2.311921883274456e-01   +5.337453655235297e-01   -1.516757437510966e-02   +5.510239660082390e-01   +4.375632034127002e-01; +1.428349838230535e-01   +1.278802765028360e-01   -3.872379594666867e-02   +2.833826354170494e-01   +2.209328900550954e-01   +4.717310706913120e-01   +6.033526773653184e-01   +8.294709785226004e-01   +3.723085723333782e-01   +2.728346818161668e-01   +2.842093972577768e-01   +6.293857439294724e-01   +1.545966192810593e-01   +4.757748705363480e-01   +6.038795145989804e-01   +2.297585227190282e-01; +5.620980297341293e-01   +2.531614908517846e-01   +3.009685045852919e-01   +2.004111340183738e-01   +2.580028884919744e-01   +1.093753764882710e-01   +4.259874140196138e-01   +5.214336154997941e-01   +1.955841458555865e-02   +5.706906965752329e-01   +3.211958805005128e-01   +2.598508753161326e-01   +6.369694497245351e-02   +5.209788851477637e-01   +3.072955474323794e-01   +5.754482311582731e-01; +1.298652893690574e-01   +5.870203390084614e-01   +5.400274481662239e-02   +4.125717097676350e-01   +6.728608940790655e-02   -3.695347238352078e-01   +7.060084633714538e-01   +3.537739489635206e-01   +1.947712574973947e-01   -4.182595791275079e-02   +3.090927426152938e-01   +6.315284943777688e-02   +2.209906594889160e-01   +4.525362750412966e-01   +6.058902436729351e-01   +3.402299643143166e-01; +3.105349345298491e-01   +9.286931069543096e-01   +5.792391359385267e-01   +1.920316093400071e-01   +4.479384879217475e-01   +7.329409632444587e-01   -1.656761013995175e-02   -5.292334084907684e-03   +2.806815640181479e-01   +5.058660222567783e-01   +5.444849191054916e-01   +1.681632532561464e-01   +4.205453027156935e-01   +7.044680742333534e-01   +6.565695639133622e-01   +1.272015602553825e-01; +6.571166470812004e-02   +6.526318069182710e-02   +4.253821553542738e-01   +4.503909166431583e-01   +6.210579775006352e-01   +2.689161963432998e-01   +6.256202197788251e-01   +6.375764314292753e-02   +3.264802192149975e-01   +1.149024478723679e-01   -4.478867384601799e-02   +2.721189783225469e-01   +3.917699487924675e-01   +4.924201635137846e-01   +3.015371522304382e-01   +1.375788017235239e-01; +2.857161378786178e-01   +7.093234011143276e-01   +4.277541182533900e-01   -1.117467267066099e-02   +2.635510458479481e-01   +5.832010540505967e-01   +4.072369760594555e-01   +1.073948270993806e-01   +3.123629034848733e-01   +4.978616687026806e-01   +3.027646396616760e-01   +7.000475716289940e-01   +4.147223118992037e-01   +1.701202878603875e-01   +5.505461097677469e-01   +2.787276211574909e-01; +3.113201138029789e-02   +6.051850824870276e-01   +7.872367494021385e-01   +6.257930855209484e-01   +4.951507758483906e-01   +1.168982998390980e-01   +2.665548782092690e-01   +5.265534861455557e-01   +6.131349096223337e-01   +3.782993841128219e-01   +6.007679274558034e-01   +4.280831961845663e-01   +1.486164888546831e-01   +6.566300409130368e-01   +2.149268751559869e-01   +4.354177520730146e-01; +6.407733612204400e-01   -4.040381195426058e-02   +5.916922182899493e-02   +6.110478188229238e-01   +6.444834615635973e-01   +2.647624839189992e-01   +2.537158637345727e-01   +3.382011176404494e-01   -1.822232731201403e-02   +2.389847651501832e-01   +4.886198366878838e-01   +4.156244443128190e-01   +5.543816351602032e-02   +1.079336846353546e-01   +2.705533786734683e-01   +5.838164722137719e-01; +5.239855910304284e-01   +6.627644632213208e-01   +6.618419404274242e-01   +6.647311294403241e-02   +3.299834349972632e-01   +9.503596501620467e-01   +2.079467832870371e-01   +6.185604834246703e-01   +3.935064653432893e-01   +4.602662223103849e-01   +6.688543099455461e-01   -9.761446966309215e-02   +7.060963323429785e-01   +2.311822848925742e-01   +2.487583653959248e-01   +4.997844019047045e-01; +3.518609231775235e-01   +3.808374611048709e-01   +2.497888992130771e-01   +7.777298212064020e-01   +7.938512937214702e-01   +7.499985797670333e-01   +7.366295057211542e-01   +8.550192110443328e-02   +3.385689468323568e-02   +2.433793758605210e-01   +3.508972830236713e-02   +5.924543330369380e-01   +3.820883054945695e-01   +4.486269635736577e-01   +5.871327272260247e-01   +3.472611251177644e-01; +8.823463889888558e-01   +8.166701613457926e-01   +2.302079529323528e-01   +4.599035496173978e-03   +4.661336341888740e-01   +2.288453960712367e-01   +3.450122768650565e-01   +1.330984806277985e-01   +6.499414662038087e-01   -1.560171097119269e-02   +6.485461489609108e-01   +4.028308386624711e-01   +6.948306132258864e-01   -1.325343621899865e-01   +1.768423005638567e-01   -2.041260871161387e-01; +5.555508496373918e-02   +1.719432289931483e-01   +7.059111495470303e-01   +1.669056772677738e-01   +2.162091940449918e-01   +3.733233175298704e-01   +1.926524532409054e-01   +7.025201188073036e-01   +6.870730411586681e-01   +1.261096196615461e-01   +8.353724652670511e-02   +7.807290954218301e-01   +4.053733400772135e-02   +7.533185451521629e-02   +1.936765726074686e-01   +3.116703277263323e-01];
L2I_L1I_iGABA_netcon = [+4.064273982765798e-01   +2.629563904596928e-01   +7.844530522182005e-01   +1.405848369347382e-01   +8.310103228203521e-01   +6.001958806054006e-01   +6.567964274864413e-01   +9.615127222456668e-01; +2.820013684398306e-01   +3.908911472091885e-01   +3.435457848788775e-01   +3.193099871102964e-01   +6.849661669247404e-01   +1.156731857693611e-01   +2.119923508506142e-01   +8.064496994254922e-02; +5.233037386161480e-01   +5.499440574348173e-01   -1.934565633780947e-01   +2.103136336715192e-01   +5.920472963409007e-01   +1.729979962247949e-01   +4.938803941872760e-01   +4.049081171650215e-01; +5.453115960145737e-01   +4.598366715824173e-01   +2.391551575715444e-01   +5.511341833011411e-01   +4.809232711682382e-01   +8.964182375214436e-02   +3.212137736072085e-03   +5.170913059189591e-02; +4.662693769124784e-01   +5.987821608991349e-01   +1.865896714796128e-02   +1.200803778930711e-01   +6.955709864677445e-01   +3.185132194525782e-01   +5.228689441609008e-01   +6.119943608502250e-01; +7.944375913334184e-01   +6.348661679282505e-01   +4.013124421125295e-01   +4.979512542909260e-01   +4.148656668060430e-01   +2.084138393355108e-01   +6.739771215072051e-01   +1.322234988705610e-01; +2.467025763966424e-01   +4.678388583623990e-01   +6.419183127371207e-01   +7.544539149038797e-01   +1.194205263199085e-01   +1.580195038427045e-01   +4.054807439072625e-01   +5.394694175613681e-01; +4.725081235929509e-01   +3.792682069558494e-01   -7.116209963234160e-02   +3.005690308401116e-01   +1.925835969474833e-01   +5.199318997977800e-01   +2.584330099740054e-01   +4.708062202009761e-01; +1.845967932456699e-01   +2.481198981865044e-01   +8.723650830542489e-01   +3.409966876374193e-01   +3.445193716699091e-01   +8.695808649009134e-01   +3.829522324070146e-01   +8.019047226063307e-01; +6.170108038776418e-01   +3.325614272106306e-01   -1.941882735519741e-02   +6.766845237156935e-02   +7.083660077698305e-01   -7.955777168919224e-02   +2.563533766429280e-01   +4.470240855369239e-01; +5.024619031774009e-01   +3.455225598805868e-01   +2.702360138580386e-01   +9.696688239723862e-01   +8.911319685727528e-03   +4.241339700046632e-01   +9.165151903260590e-01   +7.732006228846056e-01; +6.129206757532311e-01   +8.232400185034551e-01   -7.692947562826659e-02   +2.190520351952251e-01   +2.784372982122340e-01   +6.043474220487791e-01   +5.937686000605596e-01   +1.480838616751937e-01; +9.755768196483673e-01   +1.191697739369843e-01   +6.620386599576964e-01   +1.834712030535846e-02   +4.867072132507415e-01   -1.009429976294364e-03   +7.537602536525778e-01   +1.902240416740760e-02; +6.296629487980298e-01   +2.252713001878984e-01   +4.487893565816269e-01   +2.191812454287653e-02   +3.296062198804851e-01   +5.019666229407236e-01   +1.235902434050190e-01   +1.843126297509937e-01; -1.476009040457490e-01   +7.598855453996921e-01   +5.633080424018947e-01   +2.601567813108852e-01   +2.851368610570690e-01   +6.082735909220067e-01   +5.603698568594362e-02   +4.459432639108535e-01; +2.625088293192471e-01   +7.563111693261116e-01   +3.811821026776080e-01   +5.407574574053328e-01   +2.833602222483630e-01   +3.452551183756147e-01   +4.460047570376960e-01   +1.833447063488014e-01];
L1I_L2I_iGABA_netcon = [+1.880654171041538e-01   +4.587547721342357e-01   +4.587864487750307e-01   +3.427978023792693e-01   +6.496543647708258e-01   +4.293453788475863e-02   +5.251471885719355e-01   -4.061750483550710e-02   +2.496341250427233e-01   +6.638665376831430e-01   +4.164676187333451e-01   +4.874503621154236e-01   +4.472152429849536e-01   +3.318294010751728e-01   +1.754540488342469e-01   +4.199656049924537e-01; +7.235395603456330e-01   +4.798747948771130e-01   +5.672582005240270e-01   +4.690780244718717e-01   +6.311518138872216e-01   +8.208993019487298e-01   +5.020960590565258e-01   +2.839257818360058e-01   +4.687791383561266e-01   -4.857819190690812e-02   +2.688747557803878e-02   +7.557557723996556e-01   +5.452606928845938e-01   +2.707839943263600e-01   +4.810990377280890e-01   +7.127287662850259e-01; +2.457675236926060e-01   +7.519523241723987e-02   +3.132011583932907e-01   +3.612264844075108e-01   +4.398512293027621e-01   +6.317276307034321e-01   +5.087524272275313e-01   +4.140022666625378e-01   +4.785230310279532e-01   +3.581348566318955e-01   +2.960149100339630e-02   +4.546150131347745e-01   +5.690627938158002e-02   +8.873713194878182e-01   +3.843086852758161e-01   +2.012018496429872e-01; -1.987341551441247e-01   +6.266068031765943e-01   +5.135635425414544e-01   -1.152060604458421e-01   +4.418157683969279e-01   +5.764349952835583e-01   +8.444199627815849e-01   +2.496510920958842e-01   +6.833540509171429e-01   -7.828686529180177e-02   +1.556630059352116e-01   +7.916511519859382e-01   +1.828040853280472e-01   +4.350246779348254e-01   +7.602007003261714e-01   +6.309234735810823e-01; +4.680776947998442e-01   +7.290832622307374e-01   +5.655666033604052e-01   +2.235451818271324e-01   +3.012038992006758e-02   +2.396343009568675e-01   +5.284632522137920e-01   +8.996495681520231e-02   -5.608341154602155e-02   +3.862805137289420e-01   +5.830138877761455e-01   +5.148236637479687e-01   +1.082406394306532e-01   +6.819820817942013e-02   +3.785002381855057e-01   +6.058740960706932e-01; +8.319163290029959e-01   +5.014693984662002e-01   +2.428591281098691e-01   -2.482443435273481e-01   +2.693768833092512e-01   +1.859040016570483e-01   +7.061263023754437e-01   +3.566514888186778e-01   +3.268970693219853e-01   +8.521098818490181e-01   +1.000000000000000e+00   -2.224210416624021e-02   +7.398131697372499e-02   +5.824234522154910e-01   +2.654223081321358e-01   +3.431690573851504e-01; +1.369401639861472e-01   +6.136739684013800e-01   +6.189064178668057e-01   +4.251367542300050e-01   +3.380009599860802e-01   +7.893143006810117e-01   +4.567054389837673e-01   +2.214873349838028e-02   +2.463329026651319e-01   -1.167101221279384e-02   +4.728464963060929e-01   +1.982989948743180e-01   +7.684150328303994e-01   +7.670583601793243e-01   +1.939985896097489e-01   +5.272335088049093e-01; +4.209607780120307e-01   +6.626035473267953e-01   +4.445501037642460e-01   +6.784239031999020e-01   +6.764668241052816e-01   +4.783903815935000e-01   +3.401368367971334e-01   -3.687360408815806e-02   +1.064597461804701e-02   +7.863786482121667e-02   +1.873622391027265e-01   +2.809892046548437e-01   +1.799109217037496e-01   +6.871079684915474e-01   +4.513147905474552e-01   +4.618181881939222e-01];
L2E_L1E_iAMPA_netcon = [+7.396888792266225e-02   +3.325322783220697e-01   +8.562572550671382e-01   +4.722809078981918e-01   +5.364595462634602e-01   +2.756458447427113e-01   +7.432410888226311e-01   +8.815095962487013e-01; +7.714027841667813e-01   +9.624746313691233e-02   +3.332031780281203e-01   +5.116529190737524e-01   +2.673985486579122e-01   +3.519621433144504e-01   +2.535371615359868e-01   +5.694330828330216e-01; +2.191192152064811e-01   +2.083613904188574e-01   +4.810644642699676e-01   +1.000000000000000e+00   +1.853812003040030e-01   +5.507061390002999e-01   -1.036013281202390e-01   +6.859202658108453e-01; +3.430441597789149e-01   +2.464720129444225e-01   +5.764789139922534e-01   +8.168628931480721e-01   +5.323235249774192e-01   +3.616737048071234e-01   +6.208408558450677e-01   +5.515903968722488e-01; +8.733970398705254e-01   +7.485814756925432e-01   +3.611641728074025e-01   +1.117687607360950e-01   +3.830544762217052e-01   +3.316745596187551e-01   +3.323402856517789e-01   +4.862811046580433e-01; +7.503447867060760e-01   +2.331619916838263e-01   +9.305406834884857e-01   +8.079735663547222e-01   +7.319911373978572e-01   +6.360811635272363e-01   +6.637889554068427e-01   +7.757636834601186e-01; +5.667584780818580e-01   +1.668502150391865e-01   +1.846892217573194e-01   +7.510990070514333e-02   +6.601025656245937e-01   +6.319323050122582e-01   +1.834227341324765e-01   +7.972022296139293e-01; +7.409715683185791e-01   +5.057712278804336e-01   +5.142806740600352e-01   +4.694380163069384e-01   +4.604708221636863e-02   -1.344138769373668e-01   +5.100502497936215e-01   +8.364022642103652e-01; +3.471371180849227e-02   +1.917584307005653e-01   +4.731831622875189e-01   +2.161817709668285e-01   +6.511621381054938e-01   +6.697237302572269e-01   +3.971077605898226e-01   -4.490342256325291e-02; +5.054782111716207e-01   +3.854928034283672e-01   +3.894584549861627e-01   +7.493538926284208e-01   +5.447530437618466e-01   -4.819360124064675e-02   +8.067472117767459e-01   +4.415636983254184e-02; -9.885785879917175e-02   -3.300547395863764e-02   +3.682138997269422e-01   +5.942380202879632e-01   +2.275812671962072e-01   +5.248691761275623e-01   +7.879664463712529e-01   +2.371049554348846e-01; +7.041256026517021e-01   +2.627317345504430e-01   +1.341458693527604e-01   +7.826733174589854e-01   +5.860603523826963e-01   +4.668756589950177e-02   +2.877310320381145e-01   +6.525118636051469e-01; +1.830878320969647e-01   +6.639422311980071e-01   +4.909765356553835e-01   +3.944619328828365e-01   +5.066186523710794e-01   +3.454254079814245e-01   -4.543915639662079e-02   +3.952152931602405e-01; +5.515402938196397e-02   +6.053600614228063e-01   +7.574646905890736e-01   +5.518105035910096e-01   +3.215904168728070e-01   +5.456834045304172e-01   +3.910895067683228e-01   +7.658298574591516e-01; +5.706384158212352e-01   +1.834974102904667e-01   +3.868438558100504e-01   +6.515051604359567e-01   +8.590370657253398e-01   +5.308614941719771e-01   +6.337980590329074e-01   +6.416928394225733e-01; +4.138959109181003e-01   +3.552347498644450e-01   +1.572998145390189e-01   +1.741833957784946e-01   +6.458731617797440e-01   +1.262993050740833e-01   +1.075964443950115e-01   +1.600504195097443e-01];
L1E_L2E_iAMPA_netcon = [+2.886778929369967e-01   +4.540475392978178e-01   +2.021710462397517e-01   +4.052669312519384e-01   +2.859640661101603e-02   +3.163073600244347e-01   +2.527267865099521e-01   +7.476641856164291e-01   +7.702240875212223e-01   +3.548760655123229e-01   +3.554459749687176e-01   +6.291800470633405e-01   +5.777520961332836e-01   +1.683303989623850e-01   -6.010657709192235e-02   +5.707166833339610e-01; +4.606931183880498e-01   +5.451419248846759e-01   +8.290679148466273e-01   +6.867205449014667e-01   +4.724675850612333e-01   +5.985144902800075e-01   +5.616485548179123e-01   -2.358189338577015e-01   +3.280921011627056e-01   +5.124831434780843e-01   +2.003935266318678e-01   -1.224422991354412e-01   +5.107033242718849e-01   +1.133055722107598e-01   +1.953704078074365e-01   +2.057476446670154e-01; +1.649958970157596e-01   +2.781977229795399e-01   +6.340198928659060e-01   +6.443543584477667e-01   -4.506600370534580e-02   +2.534673782116999e-01   +7.819799558655574e-02   +2.130653897303922e-04   +4.586764915605160e-01   +2.203002410333572e-01   +9.223947187158884e-01   +4.895252843377040e-01   +3.836985153236919e-01   +5.983702617842054e-01   +4.996210046491883e-01   +4.167793743783771e-01; -5.410789613873224e-02   +6.116697694526609e-01   +4.320016389757292e-01   +6.329586992267494e-01   -1.449704467405647e-01   +4.947192873257713e-01   +2.195025421215936e-01   +1.846138656756772e-02   +2.613108667191198e-01   +5.525502658530386e-01   +4.618057687931658e-01   +3.584719264330397e-01   +3.086567869857517e-01   +3.743534412717737e-01   +3.248227851365033e-01   +2.036028344278109e-01; +2.888312446069784e-01   +6.067450130446239e-01   +7.516089015297145e-01   +2.210908239798164e-01   +2.812851097294647e-01   +7.215576103805613e-01   +3.658849967382274e-01   +2.283532943094303e-01   +5.484704679627295e-01   +6.048653370015650e-01   +8.718907582160295e-01   -1.108766254802260e-01   +8.598137971000382e-01   +7.816232244462971e-01   +3.085179434097434e-01   +2.519488472996962e-01; +4.369780135513555e-01   +1.465653244061220e-01   +3.246912169346148e-01   +4.368254606877170e-01   +4.865944562142030e-01   +4.407312842458569e-01   +7.175865190773641e-01   +2.128020432675111e-01   +1.813283658712466e-01   +5.849209463967059e-01   +2.782013335838601e-01   +4.449393803900524e-01   +5.296506767826754e-01   +3.517368819363239e-01   +5.118473918181455e-01   +4.288485169064419e-01; +4.530855132026893e-01   +2.768047265293199e-01   +4.411936884589170e-01   +6.573829949322068e-01   +1.619530878424001e-01   +3.335904557663929e-02   +7.422181916346988e-01   +8.140401149736158e-01   +4.052498559416796e-01   +5.222829016734551e-01   +4.877234935058203e-01   +5.969281250056512e-01   -5.159182016581222e-02   +4.677855728422480e-01   +2.196312086987791e-01   +1.369901238795075e-01; +4.660573433916756e-01   +5.805322355131024e-01   +4.483974722339156e-01   -7.359118448677936e-02   +7.518210025218002e-01   +4.340478313213865e-01   +5.233381711350170e-01   +4.809127117849090e-01   +3.888722929931174e-01   +1.653785604724595e-01   +4.990982349575254e-01   +2.361370481963371e-01   +5.285179888721118e-02   -2.112696624693928e-01   +4.322062541901220e-01   +4.708225152355854e-01];
L2I_L2E_iAMPA_netcon = [+1.655052727708470e-01   +7.577811265955364e-01   +5.641488940326059e-01   +6.666096160039237e-01   +3.637145842302962e-01   +2.992828133199631e-02   +9.573295732333543e-01   +6.098964950161240e-01; +6.053933050728239e-01   +9.331085107901032e-01   +3.833667309705297e-01   -3.346850522564189e-02   +5.600476374579808e-01   -5.195490123832198e-02   +1.875273067118950e-01   +3.955149200793858e-01; +6.768656830980452e-01   +4.787829267411215e-01   +7.360117964853230e-01   +1.503381437450313e-01   +2.933894797952180e-01   +7.368117366088588e-01   +6.610479366471680e-02   +2.099186494886917e-01; +3.988775820048340e-01   +7.063967949971143e-01   +2.043541710341200e-01   +1.322896751510715e-01   +6.098442844408218e-01   +7.634307290050383e-01   +6.956197998338062e-01   +6.400769222842277e-01; +7.500423305792843e-01   +3.007911090102583e-01   +5.739912669159027e-01   +2.683758256191920e-01   +3.012604368349988e-01   +7.658823237443658e-01   +7.081694106185528e-01   +4.523137083808498e-01; -1.255178618911035e-01   +2.341949259682794e-01   +1.616277258628920e-01   +3.699609040595350e-01   +2.930062636881213e-02   +7.139246878191320e-01   +8.803665565457935e-01   +1.836512507046398e-01; +7.817401576526722e-01   +1.766597155796356e-01   +6.053429045672516e-01   +1.076891618324428e-01   +2.113186255120873e-01   +2.367980271273636e-01   +6.837953489285198e-01   +5.089518605943978e-01; -3.581932349108436e-02   +3.554156170295379e-01   +2.926396858136242e-01   +1.109297880519957e-01   +8.749955297802862e-01   +4.893370804522227e-01   +1.743564512294546e-01   +9.406216530502842e-02];
L2E_L2I_iGABA_netcon = [+8.515526089470817e-01   +7.525760858042342e-01   +7.085305442871781e-01   +7.037216062682342e-01   +2.979550421396402e-01   +7.805191827146327e-02   +3.721838041685245e-01   +3.035445550694155e-01; +4.363988592950716e-01   +9.372214876494944e-01   +8.061835796422029e-01   +8.357761710505149e-01   +2.013582192129820e-01   +3.009634582105064e-01   -2.211331901606077e-02   +9.681540513342595e-01; +2.333254823958724e-01   +7.558936050574597e-01   +8.804510889113730e-01   +8.980546693204472e-01   +5.243686107255279e-01   -1.453182318823991e-01   +6.404008264430090e-01   +1.680458618857167e-01; +5.168604823920956e-01   +2.898876028766327e-01   +6.799948247733163e-01   +2.147805821134179e-01   +5.928322934220045e-01   +4.415983730042136e-01   +3.618014763227544e-01   -1.573721654346253e-01; +4.944239446035457e-01   +8.983920217372254e-01   +6.228520231369857e-01   +5.224917955819662e-01   +6.738045672243519e-01   +3.212472302344080e-01   +8.126430165929062e-01   +2.630082896303169e-02; +2.207352397235713e-02   +2.089280914757256e-01   -2.112001523618628e-01   +1.843543123489756e-01   +7.905009087754719e-01   +5.245026575389385e-01   +4.767928971366135e-01   +2.254086281125753e-01; +4.453177905598277e-01   +8.890642300142231e-01   +3.807232821757430e-02   +2.890788082170143e-01   +4.627051941186545e-01   +8.923156023197008e-01   +5.643828285526979e-01   +8.367622912887015e-01; +3.390699780679613e-01   +3.093303148370797e-01   +2.652924336947313e-01   +7.583667491541438e-01   +4.211365360109760e-01   +4.640907803439989e-01   +2.135053182001585e-01   +2.272102365610928e-01];
L3E_L2E_iAMPA_netcon = [+1.893257454204672e-01   +1.547393936504083e-01   +6.772437534520326e-01   +4.911740212223667e-01   +6.627954308409686e-01   +6.020354704402482e-01   +6.856789666489891e-01   +5.991480070947764e-01   +1.090316918828926e-01   +8.402065377430551e-01   +9.615330804455451e-01   +5.950170442684601e-01; +3.004972784039764e-01   +4.482917725940068e-01   +8.464584383125090e-01   +2.803858184697512e-01   +4.423100153395902e-01   +2.844145705418138e-01   +2.207460665719005e-01   +9.887298638416130e-01   +2.040856115172434e-01   +5.789689164918097e-01   +4.608898368148044e-01   +6.276406736868366e-02; +1.823809490465700e-01   -7.610659869472611e-02   +1.443394399920999e-02   +5.640356245837206e-01   +8.704830522315109e-02   +5.082170805820324e-01   +2.635122910359757e-01   +3.514869436382216e-01   -7.082087573981272e-02   +1.763617804136040e-01   +2.628086198963977e-01   +5.305781483631620e-01; +5.423114269613686e-01   +4.958430123634028e-01   +1.613469332722517e-01   +5.753266249604110e-01   +5.585965508954173e-01   +9.845982963581762e-02   +2.689083576009795e-01   +1.466406581564910e-01   +7.438722345922165e-01   -2.088463737380416e-03   +2.505726240783070e-01   +6.451718098122285e-01; +6.568404064919705e-01   -1.042203887778727e-01   +6.576298018548139e-01   +5.011750311718216e-01   +5.898945211825134e-01   +9.169548148395149e-01   +4.213366154928097e-01   +4.813087857005393e-01   +3.496113304265317e-02   +8.429822101123511e-01   +5.064113725084044e-01   +1.573429255976209e-01; +6.118028453372739e-01   +7.033533121086532e-01   -4.184543106585218e-02   +5.059073493614543e-01   +2.982897379843190e-01   +8.145887637878498e-01   +5.989334895482207e-01   -5.000776574655596e-02   +2.297123639373577e-01   +7.180293421608909e-01   +2.325824514997182e-01   +7.060505233304726e-01; +1.323758675132850e-01   +4.283782720753186e-01   +4.721736556490325e-01   -1.662823189570548e-01   +9.803372008151727e-01   -5.243041756373009e-02   +5.563679883062642e-01   +6.846983438720804e-01   +1.545920247648575e-01   +3.833603315411611e-01   +9.764468167410317e-02   +6.158780086146385e-01; +2.455597984918954e-01   +4.048136274567413e-02   +7.709044861320191e-02   +2.724610322672019e-01   +7.372313423454124e-01   +6.655633245552736e-02   +5.241451375400299e-01   +1.713561469536314e-01   +9.396216581471067e-02   +4.911115517989770e-01   +5.464424001527444e-01   +8.358754627164158e-02];
L3I_L2I_iGABA_netcon = [+6.757192848499055e-01   +4.214591808068124e-01   +7.233496088815407e-01   +1.044963550015417e-01   +2.575743193840442e-01   +6.214227100898885e-01   +5.058609624266419e-01   +3.071005182525950e-01   +4.738346379582032e-01   +4.695599510160282e-01   +5.380143839005908e-01   +7.762323041219059e-01; +4.983757350945228e-01   -2.065418003022580e-01   -1.575035126495348e-01   +6.974467703416899e-01   +2.001472464346375e-01   +4.970996204512070e-01   +2.841572268446970e-01   +3.666348866652361e-01   +8.306445425020654e-01   -1.934285533098222e-02   +6.558524903472752e-01   +2.603181084153604e-01; +2.370975781996391e-01   +3.685331177767209e-01   +8.132227763137467e-01   +7.984434942728279e-01   +1.312640280997194e-01   +3.299316719433737e-01   +1.207269232585994e-01   +6.231592239481059e-01   +6.089724710899990e-01   +3.355569814973131e-01   +6.829739991173687e-01   +8.311791545208248e-01; -1.106498430517716e-01   +2.917698851272074e-01   +8.544375877212566e-01   +3.454646139397780e-01   +4.881354295650633e-01   +7.239977387446715e-01   +1.732175925788101e-01   +4.535942541414310e-01   +1.753963951770223e-01   +1.170828077284476e-01   +4.275229059115843e-03   +1.432373885281744e-01; +3.191586788405470e-01   +5.117348592810349e-01   +9.700873226195386e-02   -8.386166994759253e-02   +4.019253556665553e-01   +3.125561125963585e-01   +2.222418734406279e-01   +3.511592628514589e-01   +3.280561989536298e-01   +6.830627804352257e-01   +8.535212514274382e-01   +6.744849133726772e-01; -3.940202076309779e-02   +8.791930972045743e-01   +2.184907461120529e-01   +5.391478968933334e-01   +2.568413172201687e-01   -4.086942534639917e-02   -1.454748085362840e-01   +3.848126321755975e-01   +2.725164052169841e-01   +5.924569193964860e-01   +7.063706556982822e-01   +5.981258278951029e-01; +6.328704022462852e-01   +3.498209824328570e-01   +6.320795603434068e-01   +3.296006589150997e-01   +5.156353590016319e-01   +3.829720585911376e-01   +4.046564642002530e-01   +3.501568036145579e-01   +2.473892765269002e-01   +6.872748594582851e-01   +3.510163144866054e-01   +6.489519981236020e-01; +5.121961658947402e-01   +8.164813432383528e-01   +4.111448686236198e-01   +1.303388628375126e-01   +2.950313094141976e-01   -2.611025014140347e-01   +9.435149275267689e-01   +5.752992224447119e-01   +6.411977874494185e-01   +6.915358817075954e-01   +4.410976065368444e-01   +6.836181989519059e-01];
L2E_L3E_iAMPA_netcon = [+1.490064003375083e-01   +2.825772154172340e-01   +2.445673460802349e-01   +5.509092812169722e-01   +6.993504002196488e-01   +2.634938703819461e-01   +2.271473038772303e-01   +2.730110951590822e-01; +5.210755713389764e-01   +7.182046370361028e-01   +1.720080976299094e-01   +5.979564149895058e-01   +1.867993794363537e-01   +6.436976724198571e-01   +4.424243761903001e-02   +5.860644409513830e-01; +9.170460381380695e-01   +4.510578621221721e-01   +3.118891205687966e-01   +8.731579528907929e-02   +8.437403251095165e-01   +1.828623414632797e-01   +3.959877037860341e-01   +2.949912238322701e-01; +4.093486958242604e-01   +6.980133848979921e-01   +6.034005251240302e-01   +5.118337106782714e-01   +6.531990157568306e-01   +2.939377395787161e-01   +3.821945714846671e-01   +6.311889680885245e-01; +2.833922035863334e-01   +3.168702948995651e-02   +7.133542559558703e-01   +4.990822500755838e-01   +3.951775567384773e-01   +1.452612921769471e-01   +7.663449700635887e-01   +2.682276754204966e-01; +4.140842492158250e-01   +6.487342430968834e-01   +7.736198437563072e-02   +8.428334454649418e-01   +8.255076424076987e-02   +7.043311305224019e-01   +3.451403046211440e-01   +6.161095873987659e-01; -3.059847300513008e-01   +5.005860221715607e-01   +4.258995537074578e-01   +2.494768638888603e-01   +3.420859791108526e-01   +5.136596475971390e-02   +8.407649696654558e-01   +5.141915437973592e-01; +3.567614307315726e-01   +7.797441723932138e-01   +4.100390531383792e-01   -2.361927211975007e-02   +4.088134452760651e-01   +3.845925576871224e-01   +6.681590691458338e-01   +1.482112976089570e-04; +5.475300473922040e-01   +8.473315196042958e-01   +6.963174343344926e-01   +7.486900100025865e-01   +6.981547644222903e-02   +5.687980856544111e-01   +6.431002029513735e-01   +1.000000000000000e+00; +4.439310721044987e-01   +6.280886585001885e-02   +2.459312875312342e-01   +6.945382251815795e-01   +4.434881434121123e-01   +1.020330359144060e-01   +7.088680678698452e-01   -1.526093743761991e-01; +2.444953969622122e-01   +4.522491620738834e-01   +4.744280897439400e-02   -3.774762584297258e-02   +3.374457461276516e-01   -5.471605231816962e-02   +3.378069735839233e-01   +9.351867410513840e-01; +6.002282653502241e-01   +5.200329184138041e-01   +3.629971946781106e-01   +8.624702410380571e-01   +8.586922395705917e-01   +2.098246161960899e-01   +2.885677673333375e-02   +3.743044400339006e-01];
L2I_L3I_iGABA_netcon = [+4.441970432641385e-01   +2.438914512724081e-01   -2.501320569535221e-02   +1.000000000000000e+00   +4.499414191639500e-01   +8.226993607248849e-02   +6.984482783614877e-01   +1.464237633394452e-01; +3.165438101343191e-01   +2.858607792479078e-01   +9.659254581406243e-02   +4.779490740298709e-02   +2.841409883268411e-01   +7.197707387374355e-01   +8.051557067348800e-01   +4.048203952445046e-01; +2.510065915418189e-01   +5.953959111960483e-01   -3.642590024091798e-02   +5.803896944263540e-01   +1.732901823257067e-01   -1.093984123287487e-01   +3.995515587770000e-01   +4.001121436794939e-01; +2.255535904763400e-01   -2.540060432088331e-01   +6.471230523449809e-01   +5.466354240678400e-01   +7.734303631299013e-01   +1.849693003495037e-01   +5.040838140914160e-01   +3.124996221342126e-01; +2.027379469343389e-01   +5.021886012745964e-01   +3.063170926315963e-01   +1.217998033790918e-01   +2.155345593858408e-01   +4.667095466835561e-01   +5.714314535480715e-01   +6.439296794252899e-01; +1.871581428280715e-01   +4.124541881302848e-01   +4.061747572364707e-03   +3.675831449988146e-01   +3.857778897525894e-01   +6.518479019200298e-01   +1.170591006179637e-01   +5.069543862145144e-01; +5.833360626848449e-01   +2.387823320588575e-01   +3.143813491670202e-01   +7.319156177948501e-01   +3.822607950713917e-01   -1.270626957696750e-01   +1.339298663470526e-01   +4.675417467987436e-01; +4.941056762531280e-01   +6.321211749304831e-01   +4.155846805014506e-01   +2.562988750828996e-01   +2.972452794281608e-01   +5.370993312087415e-01   +4.093580013631672e-01   -6.138935431414035e-02; -2.100948548232940e-01   +2.135830346025775e-01   +3.900408358691465e-01   +3.000232969992734e-01   +6.121250674182973e-01   +4.824147050148727e-01   +4.807546609216018e-01   +3.287742040527390e-01; +7.352453852808221e-01   +1.884572841604167e-01   +4.002415105213787e-01   +1.287358032816865e-01   +4.247599319542250e-01   -2.962577300564275e-02   -6.277386515986118e-02   +6.892561859908726e-02; +3.814661426004904e-01   +7.063246768281791e-01   +2.203220268247434e-01   +7.314946283144471e-01   +9.111675807236029e-03   +1.390547014665240e-01   +1.784238708040203e-01   -8.923226244344093e-02; +2.106123325494861e-02   +3.784313829442384e-01   +7.966691453071222e-02   +3.130031715207512e-01   +6.185882262316276e-01   +7.948893463658029e-01   +8.408671002277208e-01   +1.106275205206042e-01];
L3I_L3E_iAMPA_netcon = [+3.689830241379007e-01   +7.529822714987002e-01   +4.042898840369964e-03   +4.293826185489193e-01   +8.849829520918897e-01   +1.617267163164065e-01   +6.908582469986893e-01   +5.575052212474254e-01   +8.759644182028878e-02   +2.562701853142889e-01   +1.922808071325524e-01   +5.659107440133887e-01; +7.435321525748145e-01   +8.119938094563330e-01   +6.460927809967582e-01   +1.874347481779002e-01   -4.588917673094392e-02   +7.433090989607467e-01   +6.226377590864525e-01   +9.900606032593281e-01   -1.440150024808804e-02   +7.601973708352534e-01   +4.125250815835444e-01   +6.209973333176331e-01; +4.838756515790253e-01   +5.796673133472563e-01   +4.091955243572136e-01   -2.058582059383937e-01   +7.542234015794043e-01   +8.108937100856051e-01   +4.575993688341822e-01   +7.682889833061576e-01   +2.014787196195444e-02   +6.020696235589792e-01   +9.362949908992775e-01   +5.827360787551639e-01; +8.413412464575819e-01   +5.781605211576372e-01   +4.518510939432910e-01   +7.769802597965876e-01   +7.669660713685997e-01   +7.322363338548767e-01   +9.309620811377048e-01   +7.999498602828069e-01   +1.016541056670029e-01   +7.784738654614254e-01   +4.848101941651427e-01   +6.587123030673961e-01; +8.055443276212490e-02   +5.929594478069542e-02   +1.219336429108350e-01   -1.803967911490420e-02   +6.239178714429280e-01   +8.487349650239105e-01   +1.085277742683200e-01   +6.326571516128093e-01   +6.289672793958009e-01   +1.814081147839391e-01   +8.671357556498052e-01   -6.189988327479932e-03; +4.008332238485697e-01   +9.419936805617056e-01   +2.691024947670759e-01   +7.663564921584636e-01   +3.902480000833168e-01   +1.766810676860620e-01   +5.038539824039925e-01   -1.138472097027704e-01   +4.537743973498857e-01   +3.608118668431006e-01   +3.166473223750048e-01   +3.074699704152598e-01; -4.359883716667332e-02   +3.072969193256067e-01   +1.196959282726909e-01   +4.701546312220307e-02   +9.136144596139948e-01   +3.322189856898686e-01   +4.761378464636917e-01   +5.728945916722108e-01   +2.756351088566684e-01   +4.333885811830719e-01   +4.369850022725038e-01   +3.550431950468858e-01; +2.073573953585520e-01   +1.327722382848581e-01   +3.687940867892849e-01   +2.386653610384630e-01   +2.487724074963557e-01   +2.240221456654708e-02   +3.252527353301788e-01   +3.921981714963971e-01   -6.265597749218473e-02   +7.592598320960626e-01   +3.900758753811124e-01   +2.707531287042336e-01; +1.391459561009862e-01   +1.445638183996345e-01   +5.452210684640679e-01   +4.902403364935547e-01   +4.108450270193856e-01   -4.884613138412380e-02   +2.145211260413207e-01   +4.580726131524810e-01   +7.177950814854485e-01   -1.529976488361567e-01   +1.861012695291769e-01   +3.837562139082499e-01; +3.787182522642710e-01   +6.034846192902212e-01   +4.248967910264477e-01   +6.051004321668807e-01   -1.392765670103344e-01   +3.199044029097876e-01   +6.622846162428372e-01   +5.391949269114272e-01   +7.199445656355200e-01   -1.271011215729025e-01   +5.196498093956633e-01   +2.843922656646954e-01; +4.607552560411292e-02   -6.207544354455304e-02   +6.054116836121975e-01   +2.980038718560223e-01   +1.754275641293035e-01   +4.714245536704767e-01   +4.429434295350878e-02   +5.649963515935906e-01   +8.122489362267722e-01   +8.062008680548329e-01   +1.178867153220162e-01   +5.586874542320253e-01; -1.107246097352694e-01   +4.405200105767630e-01   +2.897899297491609e-01   +5.456771183372117e-01   +8.824595231232113e-01   +9.788331434234487e-02   +4.711776452996791e-02   +4.093971553640132e-01   +6.501373257775186e-01   +4.321715600657407e-01   +3.251665216383914e-01   +3.837884860930511e-01];
L3E_L3I_iGABA_netcon = [+5.418070975386087e-01   +2.082199283210909e-01   +3.088635970900792e-02   +6.860213164213678e-01   +3.702774719923430e-01   +6.922463866352853e-01   +6.551033642830314e-01   +7.734959664614812e-01   +6.586744423905727e-01   +2.154569790865660e-01   +1.670754669843696e-01   +4.456072626175959e-01; +5.239783887477134e-01   +2.668653730365790e-01   +8.554149085672750e-01   +4.036283435541181e-01   +5.251825069781407e-01   +6.482309896059181e-01   +9.664599763161212e-01   +1.784422547818932e-01   +3.362589918036833e-01   +1.916107488818738e-01   +2.015226890654536e-01   +5.090302756640093e-01; -4.772442361613578e-02   +1.092901219691766e-01   +1.032022172903519e-02   +3.686200499837425e-01   +3.362471064205836e-01   +4.217565748430168e-01   +6.577352645197347e-01   +5.488922658555877e-01   +5.158994230594163e-01   +4.727347356829663e-01   +4.831755797563649e-01   +3.294197044636688e-01; +5.764397423473617e-01   +8.018243794418729e-01   +6.468448815110365e-01   +7.286254306415538e-02   +7.288430407085587e-01   +2.505235549287561e-02   +5.696123249864359e-01   +4.623470320447037e-01   +2.570763272728928e-01   -1.848187178580306e-02   +5.795808936837307e-01   +4.464221390185494e-01; +9.315142983704545e-02   -3.823589551558176e-02   +4.993542706948912e-01   +3.755896534884222e-01   +3.580043433692261e-01   +1.630355526242011e-01   +4.997486509647462e-01   +4.395706331309816e-01   +4.051190945116310e-01   +1.303158050001484e-01   +4.078953392624955e-01   -4.866256430966270e-02; +1.197436165511179e-01   +1.434236780157972e-01   +5.460831557160506e-01   +7.052864678089469e-01   +3.345483652062995e-01   +4.161689172518030e-02   +2.947720488076546e-02   +1.382311467037626e-01   +2.181566199638036e-01   +6.415678492048690e-01   +5.717391604748518e-01   -8.262631158886004e-02; +3.817518379024237e-01   +3.859051554229805e-01   +6.793145038236436e-01   +1.709083923071658e-01   +5.343811836867616e-01   +5.118906427713651e-01   -9.293930065895101e-02   +5.700536793299995e-01   +5.812892880211817e-01   +3.310679444447448e-01   +5.445585300016003e-01   +3.682229692865180e-01; +2.013674360379669e-01   +2.148331416469723e-01   -1.309658870491368e-02   +8.876713180770834e-01   +5.236406000099771e-01   +2.712136885777199e-01   +5.159896224725350e-01   +3.767920075095266e-02   +2.235632972201017e-01   +2.766075822999236e-01   +3.650032554333166e-01   +7.596656441963090e-01; +4.951926567964559e-01   +1.718780824582402e-01   +6.762592370479192e-01   +6.588285430124012e-01   +4.775072843462773e-01   -2.288386622465637e-02   +4.227932856194773e-01   +6.303581207604863e-01   +3.478741947212967e-01   +1.125644465135781e-01   +4.490333715088879e-01   +7.222472129412361e-01; +3.552937881419634e-01   +7.906387991898702e-01   +9.473327978687374e-01   +7.087065284266356e-01   +2.058344558220156e-01   +2.176863692821269e-01   +6.717839490691202e-01   -8.740253475082815e-02   +8.915053331871134e-01   +6.832569518629311e-01   +2.704732052246031e-01   +1.144761100085993e-01; -9.139721011402587e-03   +4.749955747111971e-01   +2.792150082060192e-01   +5.084981031373180e-01   +6.708090411928439e-01   +3.408305181476805e-01   +7.982826591024997e-01   +6.279739084663941e-01   +6.391889999793211e-01   +4.264027957353427e-01   +9.063486642678331e-02   +7.729875658122286e-01; +5.964477401346832e-01   +5.347399955218465e-02   +4.124435299830013e-01   +7.337250168361084e-01   +5.441948390610162e-01   +5.627675096387481e-01   +3.551537007716536e-01   +3.514034621686581e-01   +3.745170010441072e-01   +4.691249346154943e-01   -2.859080595545783e-02   +3.690454426235954e-01];
L2E_Input1_iAMPA_netcon = [+7.209899944799694e-01   +9.455895086475820e-01   +7.743788437141896e-01   +8.185635521201771e-01   +9.689803227881804e-01   +7.602639462088048e-01   +1.000000000000000e+00   +5.776385703450824e-01];
L2I_Input2_iAMPA_netcon = [+8.297569708056574e-01   +7.742318267826644e-01   +4.935980232445179e-01   +6.864056456860936e-01   +6.350018964967040e-01   +1.000000000000000e+00   +5.521769973954512e-01   +6.496135695300032e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.5*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.4*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.5*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.4*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.5*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.4*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.5*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.4*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
