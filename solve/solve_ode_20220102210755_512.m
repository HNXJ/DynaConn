function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-1.871311874878362e-01   -2.185480819574814e-01   +2.337664469185300e-01   +2.472626966587517e-01   +2.735821484570565e-02   +1.174820032467266e-01   -2.720458075354334e-01   +8.160513459344709e-03   +5.675387779014391e-01   +4.670477127032776e-01   +1.418398231213225e-01   -1.363664077514228e-01   +4.281397612936629e-01   -1.745075742518778e-01   -2.753116932463509e-01   +1.556468610257318e-01; +4.117312660504738e-01   +2.180534811052932e-01   +1.036606909429275e-01   -4.019921228180073e-02   +5.738725945733399e-02   +5.190017765978634e-01   -4.228037969952304e-01   +1.063014696977310e-01   +3.842482972850768e-01   -1.020977231784584e-01   +3.025398319345782e-01   +1.884882188047086e-01   +2.875459064681185e-01   +1.374529182186508e-01   +8.932461737171722e-02   -1.928691634648844e-01; +4.812954513954201e-01   +2.534068534867281e-01   +1.524729681239023e-01   +1.905595396866661e-01   -6.414206376920656e-02   +3.641303152637210e-01   +4.907836410972781e-01   -2.041141702844012e-01   +4.797157183943178e-01   +1.152425735789817e-01   +6.823141633395147e-01   +1.060149586045711e-01   -3.757629085417636e-02   -5.070478111209183e-01   -2.487077612963782e-02   +2.028571143463106e-01; +9.720322162139072e-02   -6.414097462548873e-02   +8.254600748258093e-03   +5.186379203508801e-01   -1.429025143334476e-02   +4.833252959703233e-01   +7.619720826085177e-01   +8.527900833491511e-01   +1.805372080968201e-01   -2.793697024461094e-01   +4.352896666778511e-01   +3.997324180183264e-01   -5.387331124908318e-03   +4.076368450649889e-01   +9.607298454595364e-02   +7.838229300641010e-01; +7.282296501308781e-03   +2.398916591523562e-01   +6.489133598799396e-01   +6.923166741201896e-01   +6.815646787564766e-03   +2.567265181569039e-01   +1.703853090458828e-01   +1.882650483158713e-01   -7.978020591528504e-02   +7.689871821420915e-01   +8.720917896504855e-01   -1.174620418638435e-01   +2.499837882819800e-01   +1.452318126637140e-01   +2.829944249115028e-01   -1.667968513379008e-03; -2.360189782031730e-01   +8.520199411039219e-01   +3.649839709938660e-01   +8.840428768082848e-03   +3.556172778051486e-01   +3.135878042058014e-01   +5.209131635861801e-01   -3.707705252641100e-02   +1.593934006183740e-01   -4.522003844211874e-02   +4.369449980638497e-01   -3.581495262294490e-01   +1.800449768947471e-01   +2.019766692058536e-01   -2.057305738755285e-01   -6.559197580028325e-01; +2.644390443200079e-01   +2.706354181185305e-01   +5.379636541751556e-01   +5.568019519477460e-01   -3.291136106669539e-01   +3.893156355283013e-01   +2.050858931407064e-01   +1.087019670900864e-01   -8.004406517638659e-01   +3.483563994226090e-01   -1.926463823058060e-01   +1.037285695934368e-01   +5.897445565416424e-01   -1.411899043656075e-01   +2.879989791192931e-01   +7.471370616432607e-01; +2.258537923946408e-01   +5.144871672485035e-01   -8.051487905787270e-02   +2.403691728384182e-01   +3.094745422382612e-01   -3.392371004258361e-01   +4.683267278382280e-01   +4.686305934365902e-01   +5.197681283715905e-01   +1.975950771809618e-02   +5.198415673594893e-01   +1.471131346822659e-01   +4.522280766991526e-03   +2.327097322266526e-01   -2.106702630325765e-01   +2.509298290574044e-01; +4.265576936091975e-01   +7.496730208466353e-01   -1.420140624956523e-01   +3.719547088059774e-02   +2.585841032064980e-01   +5.444518283772932e-01   +3.791504202797304e-02   -3.413620586182409e-01   +3.022971460902129e-01   -1.312538163543717e-01   +3.002596955339329e-01   +4.006614946373826e-02   +3.264299402013161e-01   +3.147219020975360e-01   -1.464622314585254e-01   -3.049593572523267e-01; +4.853249323006519e-01   +7.523804264053888e-01   +1.408777707706898e-01   +1.707146152570267e-01   -1.822995500541115e-01   +2.682003646025240e-01   +5.683249676161940e-01   +2.389711344266247e-02   +3.472979822438103e-01   -5.829506662131723e-02   +9.663983536234584e-01   +5.914753030653320e-02   +3.759352144944647e-01   +1.620046073564779e-01   +2.562399184425262e-01   +3.598769226764277e-01; +2.793081845022531e-01   +1.000000000000000e+00   -4.260111696322540e-02   +2.069669940284437e-01   +4.817331635663071e-01   +1.600820088835687e-01   -7.335730592950258e-02   -5.085160936142333e-02   +8.799498349902631e-02   +5.328979258066240e-01   -1.460829921513349e-01   +6.070611957275298e-02   -7.003771162387845e-01   +8.333856688572201e-02   +2.532314666948427e-01   +1.572574008909297e-01; +3.998123391902301e-01   +2.092217006729733e-01   +7.719875438386974e-02   -8.288228610021903e-02   +7.994028579350702e-02   +3.100095997979309e-01   +2.281412411853058e-01   +1.534471275083015e-02   +5.074207418053946e-01   -3.509888960032232e-01   +4.592025766626581e-01   +6.907828582864930e-01   +6.643751538055973e-01   +5.805243518085251e-02   -3.382638363795936e-01   -6.425167825122696e-02; -1.521478403647545e-01   +3.208455918128184e-01   +3.122623976299716e-01   +3.455131605139499e-01   +8.985113913452063e-01   +5.792269154120904e-01   -1.293470582238337e-01   -2.084155658672703e-02   +3.287472668515447e-01   +4.503061082651887e-01   +3.739041858166327e-01   +2.120359672980280e-01   -4.109751501749151e-01   -8.303414900371209e-02   +3.165311322539786e-01   +5.728397684320423e-02; -2.670952249186841e-01   +4.883778476621588e-01   +3.872662397114827e-01   -2.125183800998693e-01   +2.783170524797441e-01   +4.434689049059179e-01   -2.243065587770723e-02   +2.645307836886407e-01   -3.395992287456732e-01   +3.292836166017760e-02   +5.977058438852068e-01   -1.772238641253296e-01   -2.427842011733235e-01   +6.388537567685916e-01   -1.751156284721858e-01   -3.368387058427878e-01; +4.694985164403790e-01   -3.034992124217760e-01   +5.338817568638209e-01   +3.890024080515551e-01   -2.281363470429714e-01   +8.460059358468362e-02   +4.315685504446728e-01   -6.279055642910002e-02   +1.058800261683676e-01   -2.043737360089465e-01   +7.257027411543145e-02   +1.404166983183678e-02   +5.965389619598349e-01   +9.245264451214502e-02   +1.926452599841888e-01   -2.208382645798743e-01; -6.776767221458502e-01   +1.974826802518840e-01   -2.824456712316302e-01   +3.877518029077221e-01   +9.591440579627746e-01   +5.350387670456510e-01   -1.500492624592242e-02   +8.037778666608426e-01   +1.536498203922091e-02   +2.592317120283585e-01   +2.909996460436642e-01   +1.649107729693801e-01   +5.290578938083929e-02   +3.390280860846494e-01   +1.488872204184015e-01   +2.324815501456309e-01];
L1E_L1I_iGABA_netcon = [+2.190107690997575e-01   +6.449046317728014e-01   -4.232840140709794e-01   -1.970319746322212e-01   +6.841256054731966e-01   +3.092245615080388e-02   +5.643160635153864e-01   +3.719922316037035e-01   -1.757054125195450e-01   -3.049324004456741e-01   -1.077748117138029e-01   +3.073676148172100e-01   +5.824666696763579e-01   -2.071045012511460e-01   +5.721104383696860e-01   +6.919312903447709e-01; -2.743612567610492e-01   -2.823252502753903e-01   +8.506205936443962e-01   -3.693663288576537e-01   +4.327557917532279e-01   -4.225887433330613e-01   +5.733195260450934e-01   +5.179108751413903e-01   +2.873421542950902e-01   +5.276404702827364e-03   +4.069501442456402e-01   +6.491308945441237e-03   +4.597387388833402e-01   +3.401216020765182e-01   +6.565654245054057e-01   +1.054330771465076e-01; -1.832546232522210e-02   +3.589436847304713e-01   -4.208872588961434e-01   +6.542398340394697e-01   -1.577420737331707e-01   -1.134869623023304e-01   +2.026058226036324e-02   -1.017082409567692e-01   +4.587042815644586e-02   +2.065096810027178e-01   +7.701518676363511e-02   +4.293415252692396e-01   +1.100591494920040e-01   -3.508702511847562e-01   +7.484269298234532e-01   -1.228143225144801e-01; +3.190958573091929e-01   -2.508761298128905e-01   -4.567762075249482e-01   +7.232032859145476e-04   -1.905677060515301e-02   +3.649780421412422e-01   -2.742958981164111e-02   -9.791743589371651e-02   +1.211793512735658e-01   +1.973581117896393e-01   +4.793071207603796e-01   +3.139096494052762e-01   -1.365195007660861e-01   +3.566841535359327e-01   +1.765978441063392e-01   -1.038689922229966e-01; +5.083666419344920e-02   +2.288548531000067e-01   +4.268564886166605e-01   +1.054904394693194e-01   +5.303825272330662e-01   -1.564766859577571e-03   +1.460360448686744e-01   -4.228146180150284e-01   -7.390670833149141e-02   +2.434499481272472e-01   -4.127431743934368e-02   +5.741659089630032e-01   +7.488668710621855e-01   +6.071391436037031e-01   -1.344718372722055e-01   +2.547005115257315e-01; +3.192567248838964e-01   +1.406194398347099e-02   -9.669481636858546e-02   -4.599686260876120e-01   -2.977648213803679e-01   +6.808904293020490e-01   -1.200348604050570e-01   -3.461416758647611e-01   +2.550062996379499e-03   -1.385475252592919e-01   -3.815658713638848e-01   +6.457474007735171e-01   +7.186685692377337e-02   -2.363391824770098e-01   +2.770817238430655e-01   +2.550729506823069e-02; -4.069463325182215e-01   -2.524490098259612e-01   -4.000430017398956e-01   -4.593633269125835e-01   +4.817199572149299e-01   +3.921658670491679e-02   -3.485093211356302e-02   -3.550844194520857e-01   +3.703925667192233e-01   +3.827372741786794e-01   +6.749847986887766e-01   -1.611635788320323e-02   +8.475254977827151e-02   +2.984382043534534e-01   +8.902413153661862e-01   -1.109374459737727e-01; +2.891304928395222e-01   +3.238466067580352e-01   -1.331495287894738e-01   -5.489164528105045e-02   +1.039966239317073e-01   -3.632804534464809e-01   +7.614314469219068e-01   +4.059841547010765e-02   +5.150876374016268e-01   +3.122896609580967e-01   +1.345350553161987e-01   -1.785808863413940e-01   +7.035300549621846e-01   +5.698003722461016e-01   +2.451059802941302e-01   +6.077305365126484e-01; +3.959774947108979e-01   +8.921498796171828e-01   +2.330203705794480e-01   -1.975914158893292e-01   -4.678827278163633e-01   +6.755199212351063e-01   +8.637210634505450e-02   +6.213641278124071e-02   +3.696454084655391e-01   -3.704068085551280e-01   +3.790197927890895e-02   -2.410449867197406e-01   -3.050540653409516e-01   +3.425666904127637e-02   +6.521342493445441e-01   -3.507345366834510e-01; +2.587354472277695e-01   +7.762653511466260e-01   +7.637953089765392e-02   -4.309184263841257e-01   -1.704520607469410e-01   +5.954933633872819e-02   -3.563269128589561e-01   +9.022313831595352e-04   +5.285105444256351e-01   +3.091845499832327e-01   -4.873815645098784e-01   +6.704914419444150e-02   +6.215979467520769e-01   +3.607919384900633e-01   +3.488935240714038e-01   +2.534587502031808e-01; +1.966076069443047e-01   +3.278222875316145e-01   +3.054912592312055e-01   +7.559360657370292e-01   +4.769998372703740e-01   -6.687198761582218e-02   +3.324342030602409e-01   -2.049674231855179e-01   +6.492904691185843e-01   +2.994455424701571e-01   -2.021207677146669e-01   +4.435155709632608e-01   +7.630809845706128e-01   +3.501049216894416e-01   +3.186233678338932e-01   -4.747289700942705e-01; +7.728739896069570e-02   +2.151733717410340e-01   +1.539028382712382e-01   -6.279553989460394e-01   -3.535154843894991e-02   +2.749248539755512e-01   -2.658935885585210e-01   +2.184994431760978e-02   +7.279838089045958e-02   -1.719406076434105e-01   +1.796106670086481e-01   +1.588083894390428e-01   +2.627316575647354e-01   +5.060066109816034e-02   +3.368799190379523e-01   +1.872539554557452e-01; +3.371207910334379e-01   +5.626531254508289e-01   +5.837444143330978e-02   +3.892375328855778e-01   -2.649424275327480e-01   -1.271282579489948e-01   +1.102435918116806e-01   +2.750405691132827e-01   +4.086305737084891e-01   -7.265907602207307e-02   +4.304032035417751e-03   +2.804069543638330e-02   +4.398311536455863e-01   +4.408872679875657e-01   +3.217778634879060e-01   +9.892067233046314e-02; +4.856885422790809e-01   -7.991738172490369e-02   -2.101309227663492e-01   +1.410764494860210e-01   +7.696806939126578e-02   -1.753081759759487e-01   +1.035928794779454e-01   +2.966512077581318e-01   +5.311723319096087e-01   -3.157707433487161e-01   -9.241178737431910e-03   +4.073833784362184e-01   +1.220349859163973e-01   -1.571134115511040e-01   -3.649901267639277e-01   -2.484726942977882e-01; +1.551094730675063e-01   +2.067591834601167e-01   +1.301178264685208e-01   +8.772681031908615e-02   -6.034128991037765e-02   +7.534952382267923e-03   +9.765303879720667e-02   -1.659359318333126e-01   +6.134358988447333e-01   -1.998783388488460e-01   +4.021727075875461e-01   +2.992209589384659e-02   -6.399256410221710e-03   -7.930143326754583e-01   +9.788032742077245e-01   +1.278667109420651e-01; -3.420765293979314e-01   +4.160296769292563e-01   -3.722567720900310e-02   -1.551956969689161e-01   -8.032643370541859e-02   +1.478075302428271e-01   +4.969074959229824e-03   +4.829266453344057e-02   -4.718773261546677e-02   +3.412014442193945e-01   -2.034802146668107e-01   +4.945908133130042e-02   +2.684031630804192e-01   +1.916705565553314e-01   +4.239790148626579e-02   +4.112132649860420e-01];
L2I_L1I_iGABA_netcon = [-2.210043187274298e-01   -1.730034452440932e-01   +2.543275988731614e-01   +1.851660985653451e-01   -3.175510592372106e-01   +1.399434062258005e-01   +1.274456982378082e-01   -3.046406737846633e-01; +3.376897119577251e-01   +4.980977468089181e-01   +2.892576557220037e-02   +2.896177741675310e-01   +6.355877315322858e-01   +4.698054973173539e-01   -1.451075534539787e-02   -1.057472235705406e-01; +5.619447699534237e-01   +9.957870203734805e-02   +7.699983937239767e-02   +2.997880798360504e-01   +5.814525542232393e-02   +1.574516883854883e-01   +1.371175576981708e-01   +1.717453171393327e-01; +3.390941506538304e-01   +3.502125052548704e-02   +7.010783603087710e-01   +2.548266497710581e-01   +2.622061551655958e-01   +2.786229390598450e-01   +2.967704141189282e-01   -4.576531679340444e-02; +3.292751953855523e-01   -2.472268068001316e-01   +5.292793536073402e-01   +3.329905019481578e-01   +5.102837328853596e-01   +2.916567002272145e-01   +1.345353365678033e-01   -6.579923124328711e-02; +1.703217575050766e-01   -1.272431323181333e-01   +3.516187840984399e-01   +2.076514356447558e-01   +4.595562491906590e-02   +3.105489240657326e-01   +2.591095607665605e-01   +3.185813663946405e-01; +3.910020134570267e-01   +1.880727876776443e-01   +3.672817799794729e-01   -1.328535913336110e-02   +3.024323795114338e-01   +7.112365691272926e-01   +4.743025974653647e-01   +5.644166757821160e-01; -2.409114189666215e-01   +4.410916922710082e-01   +2.046792947746230e-01   +1.580873368056341e-01   +2.650640576181219e-01   -2.707143791557577e-02   +1.243339032079479e-01   +4.782837877974417e-02; +2.863552941826772e-01   +1.000000000000000e+00   -2.410103878819497e-01   +5.579168460316188e-01   +2.347719692884510e-01   +2.999289298374184e-01   +1.597824717886702e-01   -2.752159735611701e-01; -2.356849179809702e-01   -1.233114870445825e-01   +2.499401482176479e-01   -6.134532108068195e-02   +3.636496940088212e-01   -1.718060565446651e-02   -3.408795798215556e-01   +2.842283187631700e-01; +6.502091249322259e-02   +3.069150525875643e-02   +3.707551907472922e-01   +2.364047741488433e-01   +2.275508733849236e-01   -1.516821742052508e-01   +2.741464274170150e-01   +3.140892215000695e-01; +2.869453420177596e-01   +3.538175295932665e-01   +2.586392306355190e-01   -4.816285678812099e-02   -4.238792394806975e-02   +4.080428822241744e-02   +6.666300564832004e-01   +4.582588082888852e-01; +2.930399818472763e-01   +1.881134839894407e-01   +2.039724516398231e-01   +3.231831098076798e-01   +5.343028935820916e-01   -5.969963833456683e-02   -1.107274489104357e-01   +4.618493095186175e-05; -3.843883825396051e-02   -1.686061215289103e-01   +2.178444095067173e-01   -5.096233416929031e-01   +3.589187103006791e-01   -3.326686364840018e-01   +2.669349749204134e-01   +3.142083640615684e-01; +2.302798802373901e-01   +9.734339274437805e-02   +3.577367966095519e-01   +1.635820687273129e-01   -2.745065721916660e-02   +8.839923244550167e-01   +6.158729939708475e-01   +4.955383784513736e-01; +1.192005964988413e-01   -4.427996228625580e-02   +2.257302463664354e-01   +3.924795417489763e-01   +1.892295672312191e-01   +1.973238448587322e-01   -2.467677150963081e-02   -2.246428152191335e-02];
L1I_L2I_iGABA_netcon = [+2.460168791048481e-01   -2.182336187764244e-01   -3.315316741142961e-01   +2.731471156839164e-01   +3.396165438095827e-01   +8.305986812488872e-02   -6.048745955851302e-02   +6.163975601254076e-02   -1.226050508985905e-01   +3.446780128323809e-01   -2.480249999671847e-01   +8.085528196461098e-02   +7.637455473854428e-03   -2.000105468450067e-01   -2.287502123580579e-01   +1.271747830116418e-01; +3.209638368125786e-01   -3.584433163673972e-01   -3.214383245064066e-03   -2.756789108726751e-01   -1.593935309558847e-01   -1.229746339856554e-02   +2.328679607771393e-01   +2.321916191955662e-01   +1.047994780445543e-01   +6.346093363735109e-01   +2.525361478448949e-01   -4.035372698692389e-01   +7.296443337145578e-02   -1.965006277050070e-01   +4.411683945565671e-01   +1.276277651612917e-01; +2.976934446443733e-01   -3.662371729484413e-01   +3.912692357657356e-01   +2.909493690198693e-02   +1.767345930745854e-01   -2.025163740082205e-01   +5.464273165430857e-01   +1.810996513968178e-01   -9.246450397513929e-02   -2.157964039047714e-02   -2.663237522410862e-01   +7.875268127530019e-02   +2.058942568947513e-01   +3.846012444324557e-01   +7.194978914921785e-01   -4.961034485744082e-02; +1.512522489050883e-01   +7.614062779227802e-01   +1.980349868069520e-01   +4.573667937385936e-02   +3.173637911034610e-01   +7.435523708208388e-01   +3.171023348279491e-01   +1.613391085995776e-01   -1.110616540539181e-02   +6.042624246437275e-01   +3.632976767922198e-01   +3.220434049416016e-01   +4.330177471118248e-01   +4.225537848552470e-01   +2.375471239304482e-01   +1.980794875363906e-01; -5.284789365861043e-01   +1.943687616243875e-01   +7.981570806824695e-02   +3.066976388753999e-01   -9.463988505412125e-03   +5.892276122430437e-01   +4.935822960154396e-01   +3.958980118132541e-01   +4.363261557732131e-01   +3.420011427496219e-01   -2.430533325791826e-02   -1.731424579042020e-01   -6.175377637653141e-01   +1.136829571560178e-01   +2.438314619257554e-01   +6.176981759658285e-01; -8.289214457781717e-03   +4.600382670935730e-01   -3.788315448256941e-01   +4.807009874493599e-01   -1.340938782028800e-01   +4.181375657369403e-02   +3.638956101339651e-01   -1.037165269734467e-01   +1.825082036224146e-01   +1.522880335587310e-01   +1.679644990567185e-01   -2.273386105701720e-02   +4.333283549846799e-01   +1.000000000000000e+00   +1.342338038880364e-01   +8.503082523241189e-02; +1.681786619950136e-01   +1.354952347906849e-01   -3.242303735421890e-01   +2.746895498543236e-01   +3.952167593072248e-01   -3.209796970887945e-01   +4.324384233523778e-01   -1.432045833257640e-01   -1.594905132903288e-01   -3.470854699950340e-01   +4.611764201622312e-01   +2.249797614500044e-01   +1.199785345911428e-01   +7.137991326781221e-03   +7.516696712585533e-02   +2.642457847579537e-01; +4.421454342614604e-01   +1.352570033325187e-01   -1.245207853529316e-01   +1.810910131082496e-01   +2.339285370545928e-01   +1.452174701512462e-01   -1.489017554180407e-01   +7.199846826685669e-02   +1.435715950927429e-01   +2.419938773366334e-01   +2.002483918081788e-01   +4.285628574648669e-01   -2.743928708404681e-02   +1.668594627062319e-01   +5.967560906555280e-01   +4.715669877016553e-01];
L2E_L1E_iAMPA_netcon = [+3.345405828302946e-01   -4.071707161819435e-01   +1.581307401747966e-01   +4.915840124854339e-01   +8.834232289211708e-01   +5.281876402376980e-01   +6.272477759102921e-01   +7.206464835344975e-02; -1.426049085280855e-01   +2.081466350843686e-01   -2.035984906388920e-01   +1.821254057044329e-01   +3.093419888021625e-01   +3.531818280761120e-01   +3.170857084179910e-01   +1.874363634411856e-01; +5.019441339560995e-01   +2.178658795687762e-01   -2.002262724286030e-02   +2.746511034896174e-01   -2.229642481522200e-01   -3.609812188531306e-02   +1.176004795018172e-01   +5.249920533034097e-01; +5.669108729376936e-01   -1.503683092933092e-02   -2.430353723162894e-01   +5.905067392671423e-01   -2.065419956510271e-01   +1.648586278737189e-01   -2.977162185611598e-01   +4.568406559293137e-03; -1.692693788421861e-01   +9.300192506396786e-02   +4.568950481469535e-01   -1.396045887339564e-01   +5.003126109980735e-02   +1.048476648104069e-01   -1.284756857333934e-01   +3.660326778455507e-01; +5.612924960016759e-01   -3.259298736384022e-01   +9.229089180768849e-02   +3.807606140279469e-01   +3.232883112034857e-01   +6.894481905172107e-01   +7.471530513173328e-01   +3.283505938332832e-01; -2.495723084491032e-01   +5.801143490556756e-01   +2.141431886006397e-01   -2.891213384832948e-01   -1.774977142776428e-01   +2.757582733897684e-01   +6.321846078942931e-01   -3.733185299435877e-01; -1.456999284734672e-01   +4.259702524380871e-01   +9.509220711612312e-01   +3.806786199725267e-02   -2.407175141155534e-01   +3.653443785188890e-01   +2.336390048364695e-01   +4.328421865500290e-02; +3.527039313886464e-01   -4.570220581481307e-03   +5.835556828004582e-01   +4.555773388449464e-01   -3.640750118129170e-01   +4.065253910614514e-01   +4.984423218076609e-01   -3.940680024233351e-02; -1.546751253934639e-01   +1.461572884577495e-01   +3.249410272951089e-01   +1.637310763431235e-01   -1.565412468613697e-02   -1.455303462595350e-01   -5.293419369991693e-02   -1.511063315023508e-01; -1.824814382069685e-01   +4.099687551683773e-01   +7.797270365759229e-01   +1.402560240997309e-01   -3.432029610265133e-02   -8.052774645080846e-02   -9.628032053086635e-02   +9.257752693097704e-02; +8.076744381118256e-02   -9.128259814902145e-03   +3.607823789196341e-01   -2.130171541826927e-01   -2.102473030041697e-01   +1.470233894022328e-01   -3.231201233720304e-01   -1.763162681636392e-01; -1.661095642085638e-01   +4.558611175864042e-01   -1.201540707268745e-01   -1.082232700522344e-01   +7.087862840268113e-01   -2.662170862135614e-01   +1.632557831426850e-01   -2.096102752445664e-01; -8.139869949343884e-02   +8.877769133379172e-01   -1.193281442906788e-01   -1.573446212099430e-02   +3.840811659926150e-01   +1.775087312098247e-01   -2.176831416281582e-01   +1.907434102523860e-01; -3.175903675049774e-04   +1.968176756574098e-01   -9.841265192985021e-02   +3.752503305132330e-01   -7.970340665988467e-02   -1.775046987433025e-01   -1.900173103891677e-01   -8.667619898348355e-02; +3.103267545700834e-01   -3.705607951814295e-01   -5.326325966727097e-01   +1.134578356089080e-01   +1.866331797243224e-01   +3.460365508962878e-01   +5.543611346843145e-01   +1.070377252176952e-01];
L1E_L2E_iAMPA_netcon = [+4.019824237176328e-01   +2.837457121461920e-01   +1.691833195145456e-01   -2.241289505403435e-01   +3.650620553947822e-01   +3.046362134339246e-01   +1.354374008961906e-01   +1.022844870021934e-01   +2.017018628899561e-02   -3.273274266172981e-01   +5.773129131131272e-01   +1.487551996798722e-02   +2.176802911033221e-01   -1.802433370872474e-01   -2.570871858649559e-01   +5.709988992382066e-02; +2.155995154561066e-01   -1.341216661781013e-01   +4.049646685673369e-01   -1.136052116055447e-01   +4.149618324571459e-02   +3.325608164294455e-01   +3.519323160963966e-01   +1.169177333752606e-01   -1.440805251008039e-01   +4.760517247619520e-02   +5.075495057664733e-01   +1.931349198062836e-01   +4.866144474077133e-01   +2.350656183167480e-01   +8.718166859853915e-02   -3.356696014493866e-01; +8.959055119517524e-01   +2.729056214857715e-02   +1.682133593196735e-01   -1.838545688738226e-02   +3.481637707078738e-01   -2.553187885279665e-02   -1.321839791477288e-01   +2.486000188960834e-01   -1.563547430970834e-01   -6.056359011629008e-01   -2.576016492726528e-02   +3.654222610570462e-01   -1.091920769922379e-01   +4.353973003939214e-01   -1.924089585576220e-01   +1.166611503770261e-01; +2.117715560658330e-01   -1.716979359405028e-02   -2.620856817923070e-02   +4.291179004257937e-01   +3.334677508255968e-02   +6.971100780255413e-01   +8.719533861661757e-01   -3.238120839333899e-01   -1.255471037870039e-01   +2.526106879938895e-01   +5.333192486393061e-01   -3.531306259687743e-01   -3.674218553183872e-01   +8.337044060137271e-01   +3.649960870332285e-01   -8.977095368578419e-02; +1.110716107287855e-02   -5.610754405027075e-01   +2.232532679999874e-01   +5.426852483959523e-02   +1.998364780754325e-03   +2.568342058135916e-01   +4.671565389589385e-01   +1.640061864656721e-01   +5.903655733665544e-01   +8.472926553968060e-02   -4.234533796983089e-02   -6.208031910921065e-01   -2.163465960548778e-01   -1.839037960201112e-01   +1.805746287157238e-01   -3.063875847237368e-01; +3.889726828348397e-02   +4.300774929307386e-01   -7.830466236039824e-02   +5.005057916384108e-01   +1.642133396505082e-01   -7.885263261079398e-02   +9.165431518270356e-01   -2.975878976354997e-02   +2.768783797426072e-01   +7.382181028083883e-02   +4.719093905836254e-01   +2.347402448379916e-02   -1.270305102653433e-01   -6.950968058740248e-02   -3.131512369653910e-01   +6.734978145196542e-01; +2.514498456208998e-01   +1.888877072148111e-01   +2.348976641665997e-01   -2.650094058215016e-02   +2.102330767233147e-01   +2.130237749952789e-01   +3.925661868915963e-01   -5.412209649664839e-01   -1.100412927604284e-01   +2.733764814719835e-01   -4.108581834952953e-01   -7.416094353693922e-02   -4.804746025152629e-01   +5.448503883500331e-01   +5.875549130359783e-01   +4.135999152190429e-01; +5.269408030729921e-01   +2.729920124711718e-01   +4.767658213442788e-01   +8.228861443458640e-01   +2.236866129724304e-01   +4.820479780803367e-01   +1.483837064029619e-01   +1.636502210746013e-02   +2.123435859304491e-01   +1.099675508979450e-01   -3.159998968011506e-01   -5.775537283918608e-03   -7.290655700038060e-01   +2.840873455892139e-01   +3.284985299348793e-01   +4.760344486887338e-01];
L2I_L2E_iAMPA_netcon = [+1.032835698751135e-01   +7.346069570886067e-01   +2.296692166789430e-01   -2.623224269601482e-02   +1.613141008478348e-01   +4.452468120202754e-01   -1.654715070372448e-02   +5.854354829106779e-01; +5.890142807713639e-01   +1.253015907949709e-01   +5.246271573049867e-01   +8.561324840033622e-01   +4.353312389109156e-01   +6.963267380339228e-02   +2.311469423027000e-01   +1.394842754832498e-01; +4.862003462958356e-03   +3.780819788202577e-02   -3.569496016094158e-01   +1.929549322530072e-01   -1.023401404195527e-01   -1.592754368851101e-01   +2.437799659332315e-01   -1.224555180245538e-01; +3.635889949847662e-01   +4.006454100685419e-01   -5.913194020998210e-01   +3.614029735370954e-01   +4.890572586837508e-01   -2.446015786642238e-01   +3.933118654401413e-01   +3.914976784706561e-01; +3.546438924366386e-01   +7.501133359244613e-03   -9.349283378448639e-02   +1.963582156690842e-01   +6.782312270695879e-01   -1.733478399831485e-01   +3.128770928202378e-01   -1.693506176891282e-01; +4.790320445732745e-01   +1.468353863397731e-01   -2.715239988588471e-01   +3.223908495460583e-01   -3.131899588169186e-01   +1.219654710836242e-01   +6.870369898822824e-02   -1.691135635077761e-01; +4.954467658865169e-01   -4.810766948893027e-01   +3.548913259545051e-01   +5.977016363462906e-01   +2.417289232467827e-01   -3.454283558587197e-01   +8.328190429331378e-01   -4.111435603314169e-01; +1.364782825470498e-01   -1.221883504221286e-01   -7.423390122230529e-01   +1.939821380694679e-01   -6.829052840264506e-03   -2.204155382003481e-01   +7.893381984396554e-02   +7.568579763708386e-01];
L2E_L2I_iGABA_netcon = [+1.848548327195316e-01   +3.094424764334442e-01   +1.484640532404570e-01   -3.270354143436864e-01   -1.041023597701491e-01   -3.799157309461523e-02   -1.183619494391569e-01   +7.784531591036600e-01; +2.314276904579130e-01   -2.527555661529356e-02   +3.179303150157692e-01   +1.000000000000000e+00   +5.241919614595554e-01   +5.773229586453736e-02   -2.729737290161117e-01   +2.820228391762206e-02; +2.939579806373501e-01   +7.106700845879258e-01   -4.358102136542740e-01   -5.498203813350463e-01   +3.830458036392498e-01   +6.376407526265038e-01   +1.331422259691632e-01   +2.193623666078607e-01; +2.805684112718276e-01   +4.147099249422515e-01   +1.156844384582308e-01   +4.254788769286314e-01   +6.987006814329200e-01   -3.382203350895669e-01   -3.172626086693235e-01   -6.360046513809087e-02; -2.447921400124896e-01   -1.970252667194963e-01   -1.623072638526195e-01   +3.228373181805769e-01   +7.468145912541586e-01   +1.710926097851562e-01   +2.378435733966532e-01   +8.082949755018178e-02; +7.151741676088696e-01   +3.886351981410167e-01   +4.807732580182109e-01   +3.238086766938211e-01   +2.348380289264568e-01   -1.645388268273981e-01   +4.438889598808128e-01   -5.053813715737641e-01; -1.372406447912402e-02   +2.552520056830513e-02   -5.080264058896063e-01   +7.715046319026780e-02   +1.023637320226841e-01   -2.776634856565504e-01   +2.142749041951624e-02   +7.335403696626964e-01; +6.067792285743112e-02   +3.580100536018503e-01   +2.845523212716695e-01   -1.133431581681981e-01   +5.129240853287562e-01   +3.261909601157831e-01   +3.352856414365318e-01   +4.114066481092253e-01];
L3E_L2E_iAMPA_netcon = [+3.030621386608848e-01   -2.629174685149795e-01   -3.253440029727109e-01   +1.821192023679455e-01   +4.978775923839773e-01   +2.509727479803024e-01   -3.881342592864385e-01   +9.833409377533847e-01   +4.163689641450857e-01   +1.482775021395612e-01   +2.823440053290509e-01   -6.658727604304466e-01; -1.883548062800036e-01   +2.463260911548469e-01   -9.400043196551272e-02   -3.555309306978131e-01   -2.537990276932741e-01   -3.286278579170789e-01   -5.309712499248960e-01   +8.993446751045743e-02   +1.062039697279851e-01   +3.699888449256603e-01   -9.075941019790992e-02   +5.356294341754723e-01; -4.905023620537717e-01   -2.878198570427542e-01   +6.089130755417584e-01   +2.051362511465340e-01   +7.668873586517394e-02   -1.020831503528194e-01   +7.670631020259931e-02   +6.150275902028518e-02   +7.138680769912555e-01   -5.099990603031426e-01   +8.403094001212887e-01   +3.682593347287931e-01; +4.551034433647758e-01   +4.296599750366494e-01   -3.612532744604126e-02   +1.750932513696593e-01   +5.985824684064984e-01   +2.893228547445311e-01   +8.378200872101568e-02   +5.823326487902512e-01   -1.366467247455052e-01   -3.848777056658206e-01   -2.619334519439596e-01   +1.684349977371080e-01; +3.276445811891665e-02   +5.511758178665762e-01   +4.960327049225279e-01   +2.146349225990148e-01   +2.924583515780796e-01   +5.529218605759626e-01   -8.471627655890200e-02   -1.879704946022645e-01   -1.702885186236336e-01   +6.753986585445366e-01   +2.358077710891997e-01   +6.349702522705042e-01; +2.768254786167013e-01   -6.801924498388676e-02   +4.496171885048596e-01   +2.685687880455910e-01   +6.293228315509651e-01   +4.600151459506484e-01   -2.553283193571568e-01   -2.583741999158044e-01   -1.657252046487394e-02   +1.604509996975391e-01   -1.722642266618241e-01   -3.170492383969368e-01; +4.808418419380419e-01   +2.637859662873081e-01   +1.688420123549232e-01   -1.590603277625380e-01   +3.177185062741551e-01   +5.388744532490404e-01   +5.720053305783496e-02   +2.081368817644832e-01   +9.110876779028368e-02   +6.587433658356956e-02   +1.455209607122936e-01   +1.750996521693900e-01; -2.573527242459074e-01   +8.791292819718178e-01   +2.443908947283620e-01   -6.114950914835814e-01   +3.767053736153208e-01   -3.048708923221424e-01   -3.456960788755561e-01   -5.286579288584980e-02   +2.678265422735834e-01   +5.807751567157302e-02   +3.327027190891509e-01   +1.031590225374197e-01];
L3I_L2I_iGABA_netcon = [+8.218172671643782e-01   +8.000936579024414e-01   -1.322931537744518e-01   +4.933490331075481e-01   -4.188601107476904e-01   -1.855388313818404e-03   +8.921058593707984e-01   +5.967629819749991e-01   +2.318764601334911e-01   +3.558877613608558e-01   +2.313175358593846e-01   -6.995071030582455e-03; -9.574121170037460e-02   +1.572153480839095e-01   +2.345492980298544e-01   -2.377851599770220e-01   +2.991331362015671e-01   +2.043521133016046e-01   -6.218026782755265e-02   +7.246567963494384e-04   +4.065286244575239e-02   -3.391567585990496e-01   +1.591703959760079e-01   -7.010481669507168e-02; +5.562425594914497e-02   +2.528992230812827e-02   -1.650207719477719e-01   -9.425631124933445e-02   -3.275798757312890e-01   +4.054280588182638e-01   +2.931459783562387e-01   +7.237803847500596e-02   +2.005597739569407e-01   -5.474093720762130e-03   -1.605247876979845e-01   +8.823165649179393e-01; +6.087684453357879e-01   +2.822477514272943e-01   +5.771280597727487e-01   +4.769193208326711e-02   +8.188867308055044e-02   +7.441493809681748e-02   -6.342898418438576e-02   -1.741690694004873e-01   +2.707087148318750e-01   +6.837314650993064e-01   +6.375447016507058e-01   -2.453848091650994e-01; +1.789562785577597e-01   +3.399464299744386e-01   -9.440372963986844e-02   -4.910601728311936e-02   +3.187106025401313e-01   +5.966659722545194e-01   +1.886373927956936e-01   +4.970253020702665e-01   +2.507415475200987e-01   +2.512377358209443e-01   +3.561657575674316e-01   +1.705358645993294e-01; -1.491602300416855e-01   +3.094093376444594e-01   +5.000857834534274e-01   +9.486313906695495e-02   +3.337372238972051e-01   +4.467401929043213e-03   +7.679054114173320e-02   -5.699455641112777e-02   +2.608901568371377e-01   -5.094805047814510e-03   -8.387097818113624e-01   -2.511555893251168e-01; +2.588940134862223e-01   +2.056606463075784e-01   +3.315696355033751e-01   +4.396774360246808e-01   +5.109367503188300e-01   +7.120731849667824e-01   +4.123665874820459e-01   +2.337134052213666e-01   -7.903766246712205e-01   +5.304758858202884e-01   +1.326485391403874e-01   -5.378317493930687e-01; +2.431481946190055e-01   -1.453024870944392e-01   +5.770391552975760e-01   +1.861805640198895e-01   +1.544244507729729e-01   +3.101145295226597e-01   +5.943739120247442e-01   +6.164104270404307e-01   +5.097955302204173e-01   +4.571823567909578e-02   +1.832847551292799e-01   +1.473409328382777e-01];
L2E_L3E_iAMPA_netcon = [+4.381087705533185e-01   +2.520902938326729e-01   +5.655597853637386e-01   -7.144909682694145e-01   -5.959875772993518e-02   +5.072951586800131e-01   +7.629897659141482e-01   +4.748798645727763e-01; +3.954018648345853e-01   -1.873071144706663e-01   -1.081026368074840e-01   +2.192460552756277e-01   +8.197971261134116e-01   -4.979278156174004e-01   -6.459718511391315e-01   -4.028665502364701e-01; +1.007849075269577e-01   -2.986834495892062e-02   +1.524372786449287e-01   +2.298778897596476e-01   -8.109627780356829e-03   +1.821201849284544e-01   +1.238992016738461e-01   -1.807927017290105e-01; +3.014117115066267e-01   +5.218136615171839e-01   +8.048216586438487e-01   +8.124079359513873e-01   +3.358590747696223e-01   +4.473130839131136e-01   +1.371594615647351e-01   -6.092287385021498e-01; +1.187867045110977e-01   +2.282499073084934e-01   +2.368631724277589e-01   +3.837362404167625e-01   +1.254907753686341e-01   +7.219265746858966e-02   +3.736303210213560e-02   -5.352364505774913e-01; +1.590967082070476e-01   +5.798577580996913e-01   +4.905164300945495e-01   +6.074563301326342e-01   +1.394195995518878e-01   +1.012516817561770e-01   -2.212513738566573e-01   +1.563523857752282e-01; +2.106693507765012e-01   +8.121346773304812e-01   +4.595848352176059e-01   -2.298753445132664e-01   +3.975604458684702e-01   +1.411332354339315e-01   +4.723968658785113e-01   -1.277141569559234e-01; +2.736840731431807e-01   +2.850509798515035e-01   +8.614039213762106e-02   +2.350120671269202e-01   -4.577925060830321e-01   -9.536722926889978e-02   +2.080239252673238e-02   +5.618890666980939e-01; -1.819590908568550e-02   +5.631717115605004e-01   +6.096277865902582e-01   +8.579260971448838e-01   -4.731163200955424e-02   -1.581911979313797e-01   +6.880087330854110e-01   -1.242411875103125e-01; -2.037667645079287e-01   +1.128213013772262e-01   +3.193783436015191e-01   +1.633517098367129e-01   -2.180997327284789e-02   -3.119577067043965e-01   +3.953140914548902e-01   -6.878154607038438e-03; +6.773642533548543e-01   +4.067202491218010e-01   -7.498670408452507e-02   +4.977863312656354e-01   +4.061981733309795e-01   +8.342965850782490e-01   -6.239197940103794e-01   +2.273704208302093e-01; -3.473848171449100e-01   +4.798657577760438e-01   +4.646219310309320e-01   +5.598198518694925e-02   +3.872562286125900e-02   +8.082088534133047e-02   -5.995795545676949e-02   +7.738486226855443e-02];
L2I_L3I_iGABA_netcon = [-2.622166105140943e-01   -6.223023061542535e-02   +2.064820140075811e-01   +2.485962688135591e-01   +3.256937408857998e-01   +7.205131797064145e-01   +4.252342001842507e-01   +2.099021065330821e-01; -3.985383848229149e-01   +2.890272983727505e-01   +1.871099377976423e-01   -1.588417056803883e-02   +4.260354735444538e-02   -1.611000577227864e-01   +1.986149130789431e-01   +1.003644370537482e-01; +1.804085189534168e-01   +1.000000000000000e+00   +2.159309817158904e-01   +4.864189216786317e-02   +2.476290705102981e-01   +6.138143218584257e-01   -2.065570086125379e-01   +5.972728878862178e-03; -6.895966866589315e-02   -9.973275566306186e-02   +8.251869590768565e-01   -9.084965319707008e-02   -1.324700545879545e-01   +3.992980977606170e-01   +4.328510741356683e-01   +3.470128914419028e-01; +1.029292552306345e-01   +8.254365752559001e-02   +3.463897546915701e-01   +3.069071673550313e-01   +1.238415374088874e-01   +4.596207533988940e-01   +4.575373791099245e-01   +2.978847897713944e-02; +1.194756691942945e-01   +4.503612543367895e-01   +1.444531276970226e-01   +1.370901701102695e-01   +5.201270625180583e-01   +1.627502117911415e-01   -2.772610928289767e-01   -1.073399204091398e-02; -1.812541214360129e-01   +7.306427309406217e-01   +4.355785496008339e-01   +2.517163694875180e-01   -2.078394170555965e-01   +1.661994239800584e-01   +8.980120828946606e-01   +2.925787247463818e-01; -3.116622935347509e-01   +5.316326567578414e-01   +2.787664985166747e-01   +6.434045828033624e-03   -2.251782826281777e-02   +5.343006134733141e-01   +2.012911423349957e-01   +5.924805549096788e-01; -4.990406502055934e-01   +8.234886294134524e-01   +6.333434655718230e-01   -7.668741583490069e-02   +3.329401730159774e-01   +1.317983922515894e-01   +1.873997320254449e-01   +8.155105235465651e-02; -1.014540394594540e-01   -1.689343616531868e-01   +2.543704809163609e-01   +2.102278497634948e-01   +3.091767173566788e-01   +2.195807201942304e-01   +1.332431752984086e-01   +1.961136138694650e-01; +4.979285994317463e-01   +1.604873528088040e-01   -5.943369704943369e-01   +3.898887299732216e-01   +1.601610530934900e-01   -1.687191735590027e-01   +2.087680731589414e-01   +3.732399431526393e-01; -6.717457152931576e-02   +3.432474899346262e-01   +8.392057742749860e-02   +1.997548926133798e-01   +4.790255841915335e-01   +3.759064934728283e-01   +2.511471312219020e-01   -9.015774815174350e-02];
L3I_L3E_iAMPA_netcon = [+9.234253659053382e-02   -5.575310622374592e-01   +2.694545169355927e-01   +8.811604905256140e-02   +2.468413323050950e-01   +1.608348794865316e-02   +6.113734313492021e-02   +6.933099590209377e-01   +5.698637680584110e-01   +3.769297705336770e-01   +1.292912609137677e-01   +6.189690357327431e-01; +1.772844270873551e-01   +7.991581053846690e-02   +2.375936684387087e-01   +6.803648510628156e-01   +5.057794465818506e-01   +1.787892840244754e-01   +3.637173469921999e-01   +6.062824289184565e-01   +5.842153820587729e-01   +5.020460646963981e-01   -5.853919965518714e-02   -1.004667954401249e-01; +2.546862413166932e-01   +5.923496533139732e-01   +1.498749652990749e-01   -7.972685774996789e-02   +8.219009732688923e-01   +4.647809027691279e-01   +6.113483257271541e-01   -2.315292529665926e-01   +2.978705240248980e-01   +1.870558623679900e-01   -7.644034689666568e-03   -2.256605352627424e-01; +1.605246406181304e-01   +1.167814493651134e-01   +7.148141747121023e-02   -1.354416897807948e-01   +2.999009552672817e-01   +1.729358361393143e-01   +1.857469678267350e-01   +5.107187627459560e-01   -1.197700805805066e-01   +2.179366867692499e-01   -3.296525248849449e-01   +1.362875750842822e-01; -9.390107970168043e-02   +4.711559906618953e-01   +9.761026502175819e-01   +4.215040783059278e-01   +1.230692696350496e-01   -1.064594678469473e-01   -1.226219633489892e-01   +3.848317674739575e-01   +4.217714505964480e-01   +3.995304480617062e-02   +1.631849296994441e-01   -1.823698036478014e-02; +2.603005191805806e-01   -2.082555444185829e-01   -1.824425339299712e-01   +5.243159510501308e-02   -1.173873799645118e-01   -2.426758857088308e-02   +6.652797827083937e-01   -1.784257300400301e-01   -2.046237801603845e-02   +2.118697568054189e-01   +1.486907798223768e-01   +8.210095707046665e-01; +3.023970496684062e-01   +1.432251222004810e-01   -3.339390917290950e-01   -8.927274670821146e-02   +2.141371417969510e-01   +1.111475652042599e-01   +2.700600541772242e-01   +9.160440934221402e-02   +3.872399389890997e-01   +7.469973947104455e-02   +2.256648899042167e-01   -1.252602771913617e-01; -6.676545274261712e-02   +2.772390710094726e-01   -3.701775030465656e-01   -2.527748045134037e-01   +2.245789967503856e-01   +2.843306641805450e-01   +7.305011352661650e-02   +1.473927917096279e-02   -2.630489924100206e-01   -4.040048238108263e-01   -3.552710103751442e-01   +1.864045515541242e-01; -4.244726585476634e-01   +7.660838380882846e-01   +2.439502188156821e-01   +5.761553732319221e-01   -1.089709023246619e-01   +4.655344936422323e-01   +3.727331464717466e-01   +6.625833908472629e-01   +2.365495472541957e-01   +3.056442709204364e-01   +3.822214291523658e-01   +5.683656087800257e-01; +8.230836167628397e-01   -7.380186900615759e-01   +6.485316544483164e-01   -1.078482087562932e-01   +5.837672919973610e-02   -9.077490534069498e-02   +1.008338149430187e-01   +2.853689397218064e-01   -1.297298977184194e-01   -8.122853257332976e-02   +4.746023046545131e-01   -3.156210844981908e-01; -3.728754603142070e-01   +5.981507093447376e-01   +5.134896559881423e-01   +3.115612392514787e-01   -1.546153806779033e-02   +1.538376139032715e-01   +3.675584715386366e-01   +2.207002640978528e-01   +5.925372726825878e-01   +1.866347654402885e-01   -4.571918012539206e-02   +3.909590141787690e-01; +2.757091489791461e-01   +9.793202167903202e-02   +5.514432815203479e-02   +5.093793777558863e-01   -3.771964144869770e-02   -2.043346659016174e-01   -4.374141538281173e-01   +3.313238223793854e-01   +4.365162523351057e-02   -3.202326216507874e-01   +2.232629845023816e-01   -1.283032960321048e-01];
L3E_L3I_iGABA_netcon = [+4.587964305385642e-02   -1.841667384422831e-01   +4.881299152115791e-01   +2.091720386411944e-01   +2.911739073534046e-01   -9.235294549495290e-02   -4.542755437590832e-01   +1.112565807674424e-01   -2.594888877676544e-01   +5.718586971126766e-01   +3.693981444732304e-01   +3.266430246317235e-01; +2.643975372293925e-01   -1.224461669262727e-01   +2.898855447537101e-01   +9.765962372804377e-02   +5.376555956584382e-01   +8.573336576818302e-03   +2.007425486553053e-01   -5.043411098348000e-02   -4.745568975089310e-01   +2.359795099317955e-01   -7.830445363873324e-01   -9.960171032297170e-02; +6.647863635102955e-02   -3.133916365213506e-01   -4.799092046014534e-01   -1.249948734204193e-02   -9.842435838628000e-02   +2.439131430521143e-01   +5.652647584381673e-01   +1.079799749530274e-01   -1.256043516689822e-01   -7.303200858065653e-02   -3.591211258924469e-01   +2.213806601138561e-01; +4.601127141756480e-01   +6.767603530774755e-03   -2.439776892049648e-01   +7.555040879958149e-01   +7.917400615513469e-01   -2.309405095115362e-01   +3.482384874958126e-02   +1.821834684085003e-01   +7.446799715363002e-01   +4.083487364962889e-01   +3.222576645433798e-01   -3.361426178189707e-01; +2.202982597793192e-01   +2.772472932016093e-01   -3.106811283035086e-01   +1.093276979887198e-01   -1.311441148676662e-01   -2.968944390869611e-01   +1.906973169673211e-01   +5.225722576601164e-01   -1.725062548353297e-01   +8.665907485424752e-01   +4.122859186688545e-01   -3.160957194637312e-01; +3.355748147008268e-01   -1.383191038922776e-01   -1.076540987843716e-01   -1.326135838378967e-02   -4.517695945275940e-02   +1.339558064933999e-01   +3.482000009146248e-01   -1.539169039585545e-02   +2.533512854598777e-01   +1.654627822338142e-02   -2.258496670369360e-01   +9.680540668735962e-02; -2.835070181537849e-01   +3.404692584053799e-02   +3.890566806246167e-01   +7.556609606117386e-01   -1.033540865975124e-02   +6.146960604993744e-01   +4.673371811617863e-01   +5.892992839946994e-01   -2.553777527507455e-02   +2.314563694079443e-01   +1.666510420114411e-01   +1.733689552095157e-01; +1.776150268495791e-01   +4.732387541839395e-01   +7.492011536647611e-01   -1.907848628834579e-01   +3.576892783811224e-01   -4.541482852181961e-01   -7.513964036413001e-01   +6.704869782071360e-01   -1.779330825777002e-01   -4.554194237634434e-01   +6.956516542182229e-01   +3.102924100942517e-01; +4.804465171805673e-01   -3.070578587411404e-02   +5.504859050935056e-01   -1.330054527149961e-01   +3.377231823100908e-01   -9.162627074285776e-02   -6.384824078100639e-01   -7.738164814786147e-02   +3.623605783245218e-01   +1.901456449524165e-01   -6.722377379163356e-02   +5.795419888149435e-01; +3.765917435841821e-01   -2.363381134543457e-01   +3.522915217188003e-01   +4.208544877397775e-02   -6.411059179766183e-01   -2.078517382102775e-02   -3.193744602283157e-01   +2.408121724010918e-01   -1.126319089164817e-01   -7.106435739993958e-02   +3.521824756141037e-01   +3.635658882489812e-01; -1.630920562064018e-01   -1.740063563123241e-01   +1.415550268775433e-01   -7.003770992022140e-02   -3.782961041991974e-02   +5.332893507437042e-03   +3.917232010656548e-01   -5.767791718805670e-02   -2.643015778502861e-01   -4.655376798206368e-01   +1.353558054139760e-01   +1.947282049181344e-01; -2.850714166530771e-02   -1.687725155122956e-01   -5.045815069787796e-01   -1.696436627939940e-01   +8.346266841075624e-01   +3.037142595761730e-01   +3.430394971200275e-01   +4.079401229193727e-01   -6.301154708468086e-02   -4.252583039633082e-01   +8.675797424274065e-02   -5.882967066743701e-01];
L2E_Input1_iAMPA_netcon = [+8.026816041724392e-01   +1.000000000000000e+00   +7.035652044943270e-01   +2.370794075114398e-01   +3.105552779020115e-01   +4.557298783300245e-01   +8.911073635797968e-01   +4.183037356093859e-01];
L2I_Input2_iAMPA_netcon = [+6.110214325805223e-01   +7.011940670149318e-01   +4.354709516894962e-01   +1.040266111622323e-01   +6.977466954943988e-02   +7.214128071755513e-01   -2.277442245660750e-01   +5.976926917014990e-02];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last =  11.21 * ones(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.2*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.2*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.2*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.2*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.2*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.2*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.2*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.2*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
