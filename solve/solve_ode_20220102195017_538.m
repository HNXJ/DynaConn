function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+2.140364735560754e-02   -2.685966353581170e-01   +6.202897590098519e-01   +4.404516871337729e-01   +1.752307163954311e-01   +3.841501380811196e-01   -1.441760217325020e-01   +9.213652814951494e-02   +2.588405821100059e-01   +6.404487268663268e-01   +4.055073317612788e-01   +3.267211707693939e-01   -1.682309967113442e-02   -1.204685814896542e-02   -2.450551019643437e-01   -8.497858083771022e-02; +2.277949924635008e-01   +1.006933590339588e-01   -2.891523493448194e-02   +7.391480652415146e-01   -1.531361745010018e-02   +3.570490546468514e-01   -2.250339682227001e-01   +4.764077735831858e-01   +5.279533429194836e-01   +1.069548705745801e-01   +4.863762301821036e-01   +3.754876080922452e-01   +1.251492750808763e-01   +2.440025139609423e-01   +3.849901446466181e-02   -1.147617928800062e-02; +5.386587883344109e-01   +3.222176570401622e-01   +1.987972665315917e-01   +4.247529175589632e-02   +1.984782631433241e-01   +3.100430455523068e-01   +4.101139568462468e-01   +1.787267449678275e-01   +1.033601146861955e-01   +3.968838993350411e-01   +4.784641819304056e-01   -7.186589252500718e-02   +1.695729539195170e-01   -1.225608480237552e-01   +1.773039910393407e-02   +5.138345516164511e-02; +9.795804373149225e-02   -2.370757830074442e-01   +2.161701344415883e-02   +3.153595919105338e-01   -1.069451366204495e-01   +3.268645730710826e-02   +6.070268660729851e-01   +6.701820371768542e-01   +5.087989416318166e-01   -7.253413796295059e-02   +4.319313689429569e-01   +6.778763680089258e-01   +2.685419045600983e-01   +6.642657206491619e-01   +1.116443519688949e-01   +6.694798478812279e-01; +7.422022371916852e-01   +8.370803001453397e-02   +3.926637692597121e-01   +6.352078526994034e-01   +1.073102976595121e-01   +3.816111325195995e-01   -1.062519950677198e-01   +5.468828124458035e-01   +4.646662452286755e-02   +3.022509982299049e-01   +3.658277235919614e-01   -2.213261596867019e-01   +4.984724436573152e-03   +3.361124635237871e-01   +4.287041386805380e-01   +2.283278610499136e-01; -7.078639319550799e-02   +6.256054386579593e-01   +1.962166120448963e-01   +5.138475025273009e-02   +6.604705550561357e-01   +1.797289842766070e-01   +6.181289167879739e-01   +1.294499350847141e-01   +4.505091734519224e-01   +2.044866663845170e-01   +3.973915318015864e-01   -5.470580764797863e-02   +2.796560379774829e-01   +3.047178369760035e-01   -6.443797512685338e-02   -5.318274657064573e-02; +3.943197431511613e-01   +5.831354519730673e-01   +3.182732597557091e-01   -6.629684356239743e-02   +7.582187138498275e-02   +2.584208235507321e-01   +2.988131521558038e-01   +1.921844244112472e-01   +4.326984388806013e-01   +4.410952429245129e-01   -9.458753157431879e-02   +4.317731014081868e-01   +2.703355722393609e-01   +3.370274988893888e-01   +3.683377384161245e-01   +3.543020659637054e-01; +2.677174813313480e-01   +5.185369449281122e-01   -2.834365897760895e-02   +7.414365991104254e-01   +2.489300874757554e-01   +1.346199068248781e-01   +3.719372040906362e-01   +7.465691241064327e-01   +7.680740916039164e-01   +5.617699389749911e-01   +1.148070922821397e-01   +5.347579031874571e-01   +1.101327938526344e-01   +6.649139490802369e-02   +9.748363589697645e-02   +3.423247719007458e-01; -1.444990190955677e-01   +6.332824030165564e-01   -4.229580686093626e-01   +2.222714188138034e-01   +1.150978881224660e-01   +4.906741170597164e-01   +3.177768191246794e-01   -3.765648940043718e-01   +3.796955165963450e-01   +3.167360516938491e-01   +4.937194568687829e-01   -1.184119050651133e-01   +5.618672887504246e-01   +3.149943693487642e-01   +9.323005023460695e-02   +1.211704831170695e-01; +1.076975177987766e-01   +1.756979512124391e-01   +3.409137373163837e-01   +3.078106810749351e-01   +3.239084613453547e-01   +2.243160981706671e-01   +3.482743090598410e-01   +1.089054224205794e-01   +2.235278311855137e-02   -4.324430894215799e-02   -2.588416504538186e-02   +1.330723666018133e-01   +7.542474560804751e-01   -5.776541317372543e-02   +1.750885086603495e-01   +5.636144243280564e-01; -9.575472663909895e-02   +7.145638697046263e-01   +2.369463787309561e-01   +1.881076783432864e-01   +5.173809471604083e-01   +6.203709889032767e-01   +6.140121038647161e-01   +2.049947662582508e-01   +1.078144433638525e-01   +4.851333367852304e-01   -1.146628173414410e-01   +5.314108795323739e-01   -3.365006992378299e-01   +3.936569980794978e-01   +6.490798546113801e-01   +2.685726685154537e-01; +6.892649726566943e-01   +2.158126564178951e-02   +2.665940207463883e-02   -3.699567430101625e-02   +3.423520560098089e-01   +3.333895504867909e-01   -1.409297230423156e-01   +3.176015973357515e-01   +6.262673509653170e-01   -2.508198384994763e-01   +6.495339575153480e-02   +4.167483138256202e-01   +4.724969233658976e-01   +3.659069050632706e-01   -4.447751906173663e-02   +2.674804914506239e-01; +2.748768148895675e-02   +6.703706198038252e-01   +5.196327550410492e-01   +3.800954340815922e-01   +5.017437853616568e-01   +4.362991492951002e-01   +3.553274161904669e-01   +6.090898857811172e-01   +6.162998879255376e-01   +4.614977605772503e-01   +2.870399616847157e-01   +1.821712695568856e-01   -2.727685621195048e-01   +3.254762120595104e-01   +1.037667815373464e-01   +9.190633048968780e-02; -2.544329588274522e-02   +3.880464837142868e-01   +2.683105262076529e-01   -3.882383614287608e-01   +1.308304496107528e-01   +7.342921101130896e-01   +1.347980442336540e-01   +7.049295793449117e-02   -6.951744157673681e-02   +1.915294283494837e-01   +7.616474300463213e-01   +5.205185853950071e-01   +4.927187778043640e-01   +4.331744739989401e-01   +1.662597365015483e-01   +2.660055238094338e-01; +2.755746312034043e-01   -9.918200963349473e-02   +3.981077884689148e-01   +6.291421672826625e-01   -1.398498904311219e-01   +6.420130127591232e-02   +6.425604354858120e-01   -9.480574197602629e-02   -3.029839299302081e-01   +4.040908519147874e-01   +2.655806002066730e-01   +2.143280032215993e-01   +2.165376585961466e-01   +1.022016650654177e-01   +2.108718589541495e-01   -1.454271746819873e-01; -2.190502433823139e-01   +4.309389677136704e-01   -7.946273417072931e-02   +5.052154337595931e-01   +1.000000000000000e+00   +6.489015926523454e-01   +6.245882433609555e-02   +7.303547385909327e-01   -5.978496132857611e-02   +5.274829926847759e-01   +5.533414529859028e-01   +3.058800046445294e-01   +1.348332015283285e-01   +5.699527138131717e-01   +5.176631059866688e-01   +1.992163122298491e-01];
L1E_L1I_iGABA_netcon = [+2.291743591572516e-01   +3.979389146274085e-01   +2.099838001157922e-01   -9.508900771814796e-02   +3.291356741164626e-01   -2.040661937368133e-01   +1.870534002559614e-01   +1.182878984385881e-01   -1.794057689919677e-02   +1.352488037981301e-01   +3.039604865960062e-01   +2.945055460807942e-01   +6.553810498380077e-01   -3.734960880559628e-01   -1.667887298401170e-01   +9.202040567811322e-01; -1.165459802400324e-01   -9.522749621036097e-02   +2.359641426948302e-01   -1.606483237668549e-01   +1.085811135611518e-01   -6.755592098577309e-02   +4.780305236889121e-01   +3.086822776931137e-01   +6.524967364928164e-01   +7.525945163671265e-02   +5.968627520460050e-01   +2.968412470009389e-01   +5.643343895631098e-01   -7.888246675061907e-03   -1.251664119512541e-01   -1.806001695018170e-01; +2.628830369298961e-01   +7.776395835719295e-02   +5.077585503463108e-02   +4.522720400049218e-01   +2.755876707227547e-01   -3.257874514676223e-02   +9.801416590474593e-02   +2.031579783353642e-01   +4.641307674115470e-02   +9.224061325210791e-01   +6.346106740012403e-02   +2.622568118187568e-01   -2.818066617302781e-03   -1.976439681840895e-01   +3.357778665564614e-01   +5.875982342520704e-01; +4.880240903661571e-01   -1.901831696469516e-01   +1.789376283037437e-02   +2.306196632641790e-01   +3.780168982280947e-02   -1.009811975272395e-02   -5.279914474258156e-02   -1.702955757218633e-01   +1.900362429547097e-01   -9.439020181045514e-02   +5.656828182027440e-02   +3.809839128107260e-01   +1.700438310183725e-01   +2.717877774190822e-01   +1.734875216481976e-01   +1.402256133866588e-01; +1.525522923053839e-01   +1.250317100517150e-01   -9.514166405426862e-02   +2.705243121527085e-01   +6.116819798068986e-01   -3.191104461911280e-01   +3.665886302025458e-01   -1.444303230471164e-01   +7.913057631473949e-02   +2.851813214418785e-01   -8.790467739950131e-02   +4.406562897769075e-01   +3.130502663555609e-01   -2.004583239695772e-01   -1.924681454201755e-01   +3.239115507404819e-01; +1.079120246671273e-01   +1.924979060617341e-01   +2.216395308386729e-01   -4.036079278701279e-02   +4.573228592159154e-03   +4.554658095181380e-01   +4.208221350909515e-02   +4.937370517108429e-02   -1.792357890776341e-01   +2.072988925292011e-01   -1.746531644016179e-01   +3.267230917111876e-01   +7.406973685878733e-03   -1.848100600239736e-01   +3.517581954344730e-01   +4.610959750405270e-01; -1.555497387686091e-01   +9.078859352276419e-02   -1.471354466872453e-01   -4.690158768484855e-02   +1.552167468507722e-01   +1.778318400779676e-01   +7.220534023976434e-03   -2.219569641527082e-01   +4.917135289955661e-02   +4.723835305214882e-02   +4.217530328996260e-01   +2.128066152885394e-01   +1.919609689739264e-01   -2.860660058324601e-01   +7.109874926825784e-01   -1.191454544365823e-03; +8.802631371107734e-02   +3.666486246246809e-01   +9.030503036638973e-02   +2.802526279755705e-01   -9.890917526053901e-03   -9.934884452429918e-02   +6.840507686708238e-01   -1.986105852419241e-01   +6.898351541680728e-01   -9.165277599619205e-02   +2.146912180706872e-01   -2.049821812937447e-01   +2.471123379545060e-01   +1.694277866352693e-01   +3.858792002374223e-02   +1.189673718974495e-01; +4.593560544274300e-01   +5.400303535542504e-01   +4.540443144626565e-01   +3.868425042144667e-02   +1.927342657814348e-01   +2.616942016329092e-01   +2.637974207965652e-01   -1.205169034632673e-01   +4.247076927949442e-01   +7.735709612215388e-02   +3.080649106415752e-01   +4.092865947464393e-02   +1.081291379617547e-01   -1.951968785281191e-01   +5.853366339235393e-01   +2.605718161762258e-01; +2.267638586762004e-01   +5.183528900343777e-01   -8.112307306037111e-03   +4.495346973655384e-01   +3.727009985480353e-03   +2.646068355025337e-01   +8.667165780979079e-02   +2.252503652395393e-01   +2.406208989411782e-01   +1.231281042474952e-01   -9.589263622685049e-02   +1.459566592212683e-01   +1.099986271247022e-01   +2.561472737489826e-01   +2.126770076893081e-01   +2.962997257900765e-01; +9.995034069417295e-02   +1.522608897552670e-01   +6.355498844688325e-01   +1.725717391934853e-01   +2.676839437486089e-01   +3.586702220515062e-02   +2.967758470319788e-01   +1.910844293267028e-02   +4.963503266086218e-01   +8.490558654368548e-02   +7.280609222826093e-02   +5.102371913250743e-01   +6.167378328371619e-01   +1.158624088383743e-02   +1.131316490289537e-01   +2.649792888373739e-01; +2.271251692619865e-01   +1.237682397081062e-01   +1.766489892890885e-01   -1.850497461393862e-01   +2.101471706079536e-01   +3.235075669012392e-01   +1.257549684935202e-01   +2.076015941120879e-01   -1.911700877812890e-01   +2.848556373768407e-01   +4.461371855485848e-01   +4.262193646460748e-01   +7.680875459691068e-02   +1.549903894299708e-01   +5.501606781348057e-02   +2.480764789851709e-01; +2.069388961153662e-01   +1.449035297581861e-01   -2.558796944726771e-02   +8.841596413238719e-01   -2.830600951614086e-03   +9.295013222008183e-02   +9.499812321287016e-02   +5.024726642354086e-01   +2.887566461754973e-01   -1.584234094101784e-01   +2.231077059436345e-01   +3.332295094139301e-01   +3.547430418717934e-01   +2.817356294815427e-01   +4.022584778978611e-01   +3.901383993052746e-03; +2.595581120753406e-01   +1.651046389370922e-01   +2.317415644834613e-01   +4.707390833643424e-01   +2.958821724303722e-01   -5.090040085469831e-02   +1.307171898505869e-01   +1.133671281378321e-01   +3.443198171540197e-01   +9.520181489512010e-03   +4.086741827734570e-01   -2.165159607518987e-01   +1.244463570017915e-01   +2.098254437405752e-01   +4.078896648312344e-01   -9.503217794233840e-02; +3.860494689327095e-01   -8.324539594770161e-02   +4.280042760205270e-03   -5.504727394874122e-02   +1.056360200250092e-01   +1.699357137963885e-01   +8.263150974698852e-02   -3.872999221822253e-02   +4.098476594888686e-01   +2.804103106889223e-01   +4.201124928686845e-01   +3.576559274587643e-01   +2.665650373526979e-01   -1.782946793820754e-01   +3.958520541328245e-01   +1.326671028977489e-01; +5.496907362593706e-02   +1.807102666909320e-01   +3.387252700958845e-01   -7.718661289710539e-02   +4.281701155511433e-01   +2.722027689805159e-01   -1.241719390527093e-01   +8.914426601871803e-02   -2.681167039291966e-01   +1.731178324445650e-01   +1.251803208358641e-01   +3.921055416467710e-01   +3.395487592595050e-01   +3.936759253245249e-01   -3.169406904183391e-02   +4.204089630073142e-01];
L2I_L1I_iGABA_netcon = [+2.715468275895394e-01   -4.048982578257148e-02   +2.026430399260606e-01   +5.701256469045647e-01   -1.136935932873070e-01   -1.619016943983362e-01   +5.758578456212230e-03   +1.586614899875619e-01; +3.996101117451617e-01   +6.015304887681798e-01   +1.200594006054053e-01   +2.690705209341630e-01   +2.571088397863515e-01   +2.052752675598940e-01   +2.743490739565264e-01   -1.049516155595694e-01; +3.619764978525367e-01   +4.708432168184711e-02   +4.795341748442243e-01   +8.104522771307052e-02   +3.907277547815306e-01   +1.895282841564822e-01   +1.977695647251296e-01   -3.740549983638728e-01; +7.977096106740412e-01   +1.864868232063610e-01   +5.526968131330453e-01   +1.382775382094350e-01   +8.178810273726168e-01   +3.910287586931409e-01   +5.509025734769526e-01   +2.505646664049822e-01; +1.497428675779575e-01   +4.406595894707224e-01   +3.332487758952239e-01   +3.845657608393201e-01   +2.410938530649436e-01   +1.824511153273309e-02   +1.783162294687840e-01   +3.780340290924525e-02; +1.605613404392263e-01   +2.757410339135389e-02   +3.897667086153762e-01   +3.228188461878556e-01   +2.103631884908468e-01   +4.425469930554478e-01   -4.845796263544255e-02   +4.133541162914834e-01; +4.110454613632947e-01   +3.315977181105231e-01   +3.575124913982148e-01   +4.881619673302989e-02   +3.848088944386435e-01   +8.944804243348792e-02   +5.078083666995906e-01   +2.064084716607377e-01; +1.416092663071019e-01   +2.926668526050332e-01   +4.181581791334272e-01   +1.347526628025751e-02   +1.775917583039303e-01   +2.257804948226632e-01   +7.843277993947158e-02   +2.393050693161614e-01; +5.657474844857807e-01   +1.000000000000000e+00   -1.689085012552613e-01   +4.013437231922231e-01   -2.178672844025126e-01   +8.419783286890460e-02   +9.435086789839180e-02   +4.067423302659851e-01; +4.055332842086662e-02   -1.216734269102028e-01   +1.345275689169156e-01   +2.972926327141120e-01   +4.384898288850591e-01   +3.437111199070003e-03   -7.139652693889879e-02   +6.122121811019156e-01; +6.658519598534800e-02   +2.284202829151723e-01   +4.306551814468448e-01   +4.149341627144280e-01   +9.259765115985906e-02   +3.578787399973984e-02   +2.610279423804147e-01   +2.960505845115803e-01; +1.085102360546694e-01   +5.058788132382032e-01   +3.026660584206139e-01   +3.332370673437566e-01   +1.243116312768322e-01   +2.905839506642579e-01   +3.362742549748784e-01   +3.762653498510041e-01; +2.249593021581821e-01   +5.082482389233690e-01   +5.899848430589465e-01   -1.268937597695128e-01   +9.476092034514255e-02   +2.748720193540688e-02   -2.115877288900344e-01   +1.253034612515634e-01; +3.373829736492241e-01   +4.319276804367598e-02   +2.812315297271756e-01   -3.206648412149092e-03   +5.064394542266445e-01   +2.201018068226825e-01   +1.332774948205732e-01   +9.385435308994178e-02; +4.262545138107052e-01   +3.847316483176064e-01   +3.873301003902683e-01   +6.702646920422662e-01   +2.061295893069609e-01   +9.622552596228613e-01   +3.136880176944103e-01   +5.620741658278611e-01; -8.802842237745259e-02   +4.250188763712689e-02   +3.264751726993101e-01   +7.949979745228636e-02   +2.907608359663281e-01   +1.600031649828025e-01   +2.431694224549915e-01   +4.000866310543414e-01];
L1I_L2I_iGABA_netcon = [+3.244496957228360e-01   +1.268305004959979e-01   -6.243262404911579e-02   +4.017232234635704e-01   +2.412966137822381e-02   +1.388642254155339e-01   +1.931079158339490e-01   +4.543811585052183e-01   -3.801733771079322e-01   +6.225057105084532e-01   +8.562459663228360e-02   +4.631014514943038e-02   +4.956634968296171e-01   +2.334906000749117e-01   +2.545617111069437e-01   +3.752485775527329e-01; +3.592049350884249e-01   +2.490741556627677e-01   -2.341896541953349e-01   +2.923897453215735e-01   -1.621779075101846e-01   +2.641206194628415e-01   +6.575538111195798e-01   +3.287921149382559e-01   +4.081390410370138e-01   +6.696937950875882e-01   +1.597962201247418e-01   -3.159440924682811e-01   -5.485245768246259e-02   -6.874700147708215e-01   +2.592205130123321e-01   +5.403616079306840e-01; -2.059374739970248e-02   +8.888775455685502e-02   +4.391795262301493e-01   +1.393374294100140e-01   +1.334343941033270e-01   +1.214523787421665e-01   +4.745847758143324e-01   +2.979941979909131e-01   -2.333996709719874e-01   +5.872292466327107e-01   -2.456299419195075e-01   +4.745469370001211e-01   +4.626020419677302e-01   +3.325592572717351e-01   +6.558437206580965e-01   -6.158811430043765e-03; +5.747364453124650e-01   +2.780918823196202e-01   +2.497430052327977e-01   -6.551787662390618e-02   +6.524671070921161e-01   +2.948015915374671e-01   +7.327409249212821e-01   +6.414416141984942e-01   -2.353599080952714e-01   +5.707669909483515e-01   +5.841215177744342e-01   +5.255378196227141e-01   +4.131842161411238e-01   +1.305265120577978e-01   +3.616062403417299e-01   +2.376958268383351e-01; +9.327639746954522e-02   +1.736737004445474e-01   +7.674536649719907e-02   +4.154687830701400e-01   -2.292187349357849e-02   +7.434401228928519e-01   +5.148884167449670e-01   +3.149201056230376e-02   +4.897849031809456e-01   +3.962530660193606e-01   -1.173326300550772e-01   +2.843087407474488e-01   -1.668101320824091e-01   +2.964438073401174e-01   +2.338229879987545e-01   +7.355990366484425e-01; +2.099960652133182e-01   +3.501536772020473e-01   -5.420525919182169e-02   +7.194452110746972e-01   -2.704128830981964e-01   +3.880192746954668e-01   +4.178830561073307e-01   +2.152625394561452e-01   +1.861074200581292e-01   -3.402141468666020e-01   +6.338204232142789e-01   -1.071110835131397e-01   +6.100072601863354e-01   +6.514166563515433e-01   +5.377667769531108e-01   +2.609368502221709e-01; +1.622476134559140e-01   +6.046236544456058e-01   +3.245059683231136e-02   +3.744881188299662e-01   +2.362703581538453e-01   -1.977425300048041e-01   +4.007758692683324e-01   -1.258329403295326e-01   -1.200321505030299e-01   +5.084156963506111e-01   +4.012971055732093e-01   +2.247978882033008e-01   -7.372186125336189e-03   +5.450019139032488e-02   +3.096172550815040e-01   +5.288959488736994e-01; +4.357187792956234e-01   +2.996543607193000e-01   +3.487816011650717e-01   +2.048228111071386e-01   +1.143035281726857e-01   +5.197513449852774e-01   +5.643930255125874e-01   +4.280378540933209e-01   -1.837190354675597e-01   +2.190640672112706e-01   +9.995387691042903e-01   +5.853299144071580e-01   +3.134786319212112e-01   -4.534251940494148e-02   +2.584598273488318e-01   +3.271135007140681e-01];
L2E_L1E_iAMPA_netcon = [+3.538514574716462e-01   +1.358852285862067e-02   +2.996648843661448e-01   +3.599429271090399e-01   +7.586384252766943e-01   +5.777795317124962e-01   +2.413499283398817e-01   -2.561929483157739e-02; -3.126315996077483e-01   +4.570697342328741e-01   -3.229813612516981e-02   -9.532399982929347e-02   +4.570938250820807e-01   +1.691681998325514e-01   +5.683066060902904e-01   +6.258384890261963e-01; +9.448770622533446e-02   +6.459939531656160e-01   +6.324764275706574e-01   +5.811758608778278e-02   +1.779684309650448e-01   +5.065416609374437e-02   +7.072574798609699e-01   +1.924751733416037e-01; +3.956577583975259e-01   +2.007724885211537e-01   -3.230624860037044e-01   +4.369133119873308e-01   +2.949720801727011e-01   +1.188915918831734e-01   +3.451797288193733e-01   -2.437400326295489e-01; -2.140673689281390e-01   +6.302797328018847e-01   +2.993210803685666e-01   +6.989604581606743e-02   +3.720838547478458e-01   +7.052567366289654e-02   +4.658451125634160e-01   +5.564658229656257e-01; +3.700154704388483e-01   -2.277468123493569e-01   +4.327961372282713e-01   -1.285717920065568e-01   +5.035101012829288e-01   +7.438095772085697e-01   +3.239185529502872e-01   +8.893064585529771e-02; +1.383182459101082e-01   +5.290843567210242e-01   +8.885276240609917e-02   +4.000348829435628e-01   -1.665115192916918e-01   +5.156747917605486e-01   +9.127026388405787e-01   -1.927234135979718e-02; -9.307482764102973e-02   +4.318322537947116e-01   +7.807895091619409e-01   +1.324054791894836e-02   +5.633052427522682e-01   +2.014839562519711e-01   +2.384580561372571e-01   +2.506132028453117e-01; +6.119933911528727e-01   +5.100333531957820e-02   +3.992983299613384e-01   +7.974986482104280e-01   +2.119099596615053e-01   +3.824736558276161e-01   +2.495380145732656e-01   +2.048325460534015e-01; +2.540157699414045e-01   +4.183791562179776e-01   +2.804743869565852e-01   +6.379788639599435e-01   +1.430131380841160e-01   +1.740668810217740e-02   +1.756770801026876e-01   +3.947233032930675e-01; -7.012581412855221e-02   +4.624143200616631e-01   +3.764721401496504e-01   +1.965886279755990e-01   +1.417165553181858e-01   +2.213873526902399e-01   +6.247077336229388e-02   +1.494622244789528e-01; +4.183301633193134e-01   +2.852857544815388e-01   +9.373570908798209e-01   +1.314664427478097e-01   +1.050019655101572e-01   +2.662326330864613e-01   -4.370236638350098e-01   +1.025815084374563e-01; -1.816244001714903e-01   +4.427605536283005e-01   +2.318849828596253e-01   +2.327856795456008e-02   +8.948977304637616e-02   +5.157691064654945e-02   +3.700374333403985e-01   -1.162812443351283e-01; +1.913345520604566e-01   +4.874195939194484e-01   -8.205881284404798e-02   +2.165076655045959e-01   +1.577393623876052e-01   +1.321214801074458e-01   +2.176456366448941e-01   +2.381951517740027e-01; -1.521376257698685e-01   -1.153047626299585e-01   +2.954939225262692e-01   +5.989386846947735e-01   +1.283531961117498e-01   +4.351215719908160e-01   -9.749430204510109e-02   +5.670436515970878e-02; +2.896126372117469e-01   +2.342361054482079e-01   -3.875044866233182e-03   +1.007852881107031e-01   +4.308075699555346e-01   +1.974343305857143e-01   +4.219977718904404e-01   +5.405094250080409e-01];
L1E_L2E_iAMPA_netcon = [+2.114058246164850e-01   +2.120974521007823e-01   +4.591995564321211e-02   +2.994641555373826e-01   +1.687528883498685e-01   +4.021091780193196e-01   +7.736830668158423e-02   +1.988888328740828e-01   +3.865796026394885e-01   +3.152617698114034e-01   +3.204647076228353e-01   +4.339043373945762e-01   +5.246111901596774e-01   -6.502531864813141e-02   -3.056290875693471e-01   -7.606769426730525e-02; +3.294611459049536e-01   -6.373868140606072e-02   +6.318257010704535e-01   +1.395057933016810e-01   +2.507147704805642e-01   +2.190712600981946e-02   +3.282823735619472e-01   +2.043493808924627e-01   +1.639719278356388e-01   +4.389693320634601e-01   +2.706264612836876e-01   +3.399404961089307e-01   +3.849137158322837e-01   +2.931956448244106e-01   +4.293315591802980e-01   +1.956211272920083e-01; +6.645275055707662e-01   +1.088913958448613e-01   +2.203189768395596e-01   +2.965225912608584e-01   +3.180391267991581e-01   +4.929352323518758e-01   +2.956808678491071e-01   +3.305172719974743e-01   +2.022935036065559e-01   -6.410426456159024e-05   +2.030563841235039e-01   +5.445644085532297e-01   +2.130590929264524e-02   +4.984348465678772e-01   +8.065401430397953e-03   -2.368017930802140e-01; +2.487298340324169e-01   +9.311703708812140e-02   +3.927631249263843e-01   +1.021049672553139e-01   +1.433579060241674e-01   +2.641041492518840e-01   +9.034248291863873e-01   +3.453059831848755e-02   +8.239887498763736e-02   +1.843553679418259e-01   +4.257454188855734e-01   -1.419794751905605e-01   +1.887693749200296e-01   +5.528279973531520e-01   +3.692689394863835e-01   -2.356892914783387e-03; +6.119570434396557e-02   -2.677292855013017e-01   +5.888056179012212e-01   +1.370946953333189e-01   +5.301537897221765e-01   +1.074438790052145e-01   +5.870576882839971e-01   +1.746471475792613e-01   +2.644479119884649e-01   +3.332865228397354e-01   +2.384172981990645e-02   -2.917836480598738e-01   +2.357187393982208e-01   +8.138892462387720e-02   +8.490927879087802e-01   +2.244432196903446e-02; +1.451238822416211e-01   +4.716191076840126e-01   +3.232553923414156e-01   +4.788014197687236e-01   +3.004077245050178e-01   +1.587545410063493e-02   +4.566457158847673e-01   +4.028751041038201e-01   +7.483671437927765e-01   +1.855703827375376e-01   +4.232503169438817e-01   -6.997930692886428e-02   -8.240565621636123e-02   -4.133733034294123e-01   -2.144489999942285e-01   +5.500681302470073e-01; +6.566755327997641e-02   +1.807302685345215e-02   +5.378349926190791e-02   +6.487509157579312e-01   +2.843636318713093e-01   +5.329864868498515e-02   +7.341119903866937e-01   +2.179202863484431e-01   -2.893260224416825e-01   +1.893727154252067e-01   +5.923964810401069e-02   -1.705787837250048e-01   -2.473231020970719e-01   +1.757089725544095e-01   +5.153250863576913e-01   +1.215101615649527e-01; +3.122326352491496e-01   +1.933333655997653e-01   +2.389858576959113e-01   +7.393302927816149e-01   +1.975930036485002e-01   +9.059675945174746e-01   +5.563798065898143e-01   +2.252932363240113e-01   +2.354636776796191e-01   +4.936055948104493e-01   +3.137460572734274e-01   +3.165476368873802e-01   -1.208747409601751e-01   -9.680434888086809e-02   +2.894666093457555e-01   -5.987671168315713e-02];
L2I_L2E_iAMPA_netcon = [+3.713647234946398e-01   +4.139998434551129e-01   +5.238419638177152e-01   +2.312720169039790e-01   +1.373629090627441e-01   +6.355077360111383e-01   +3.786659579414872e-01   +4.639879251914640e-01; +3.562407257556334e-01   +2.465981830812423e-01   +6.771974495301091e-01   +5.673798808105773e-01   +4.207471992354083e-01   -1.546104632052505e-02   +3.033334945438797e-02   +2.826660917318955e-02; +2.389479531511567e-01   +5.192942209320222e-01   +3.185062936789490e-01   -2.015730406625554e-02   -1.990868998425030e-01   +2.219060382361226e-01   +3.104007878594191e-01   +1.503663498011210e-01; +9.102553892920442e-02   +3.169501669793374e-01   +9.904164340646923e-02   +4.545097196321387e-01   +3.841868324333389e-01   -1.335639532894136e-01   +1.738710904181771e-01   +1.499265694269682e-02; +4.726595978651212e-01   +9.502351379866658e-02   +5.548579796630013e-02   +3.393207541730945e-01   +3.044243431452192e-01   +1.822616727330863e-01   +4.787492403609196e-01   +2.682654121406164e-01; +2.337201348085351e-01   +2.299024734424379e-01   +1.689447673950749e-01   +2.833093849609878e-01   -4.983432730058877e-02   +2.942622153361217e-01   +1.401907045736669e-01   +1.568972677049058e-01; +2.973103562584295e-01   -2.202511351201687e-02   +1.657861984932958e-01   +4.299618476084004e-01   +1.934215234932510e-01   -1.300701737224921e-02   +9.178609878254715e-01   +1.280983833785083e-01; +4.790026432439512e-01   +5.895743962585446e-02   -2.136336215530410e-01   +2.302951551131175e-01   +1.271178860782612e-02   +1.247650041407729e-01   -1.626992523460645e-01   +2.328705419400466e-01];
L2E_L2I_iGABA_netcon = [-1.448166855071167e-01   +4.737586698558435e-01   +5.619115016595765e-01   -4.595822530093263e-02   -6.193709816523334e-02   +2.003299599685807e-01   +1.359739568426037e-02   +3.687447067901504e-01; -1.913672184593873e-02   +2.514310316396347e-01   +1.747345528562533e-01   +3.925691463664866e-01   +4.573189722506609e-01   +3.803971687513228e-01   -4.469949265474423e-01   +3.064444725395833e-01; -3.793980980283770e-02   +8.032605809804264e-01   -1.858295138571224e-01   +2.565784818606496e-02   +3.643063039529892e-01   +5.924867411559827e-01   -4.804273762193123e-02   +7.692758741543456e-01; -2.226583862091211e-01   +3.075469927564579e-01   -1.298760098360848e-01   +5.229955184087992e-01   +7.584441553659371e-01   +4.603244810180726e-02   -1.308617256785556e-01   -1.968753844945255e-01; +1.231155761721673e-01   -8.125849147855790e-02   -1.689057921119791e-01   +4.605075033838066e-01   +7.181358942197595e-01   +2.521451173383045e-01   +2.382062693931721e-01   +1.612016065714551e-01; +3.477960513162969e-01   +2.660869664995084e-01   +4.039757752297022e-01   +2.432305926481493e-01   +3.737830392897962e-01   -9.156238306546921e-02   +2.261681368047231e-01   -6.595835244564885e-02; +2.373735283211851e-01   +3.308786715866523e-01   +1.511776251400876e-02   +8.236002317317964e-02   -1.680635101838135e-01   -6.153746481259855e-02   -4.759559463222142e-02   +8.046361859891480e-01; +2.151799110373613e-01   +4.752857528563154e-01   +4.676493035860265e-01   -1.336151150731557e-01   +4.199166288031494e-01   +2.034857838315309e-01   +4.566708463347391e-01   +3.999542653964047e-01];
L3E_L2E_iAMPA_netcon = [+6.019538765786846e-01   -2.530178806924599e-01   +1.188742294294754e-01   +2.338838699649186e-01   +6.621054608312356e-01   +2.322077408099024e-01   +3.913767038079927e-01   +4.636408728193153e-01   +2.467678155149496e-01   -2.841356291176909e-02   +2.047817862060229e-02   +2.319800063020196e-01; +2.896946219880026e-01   +8.842058621853174e-01   +1.841926555946783e-01   +4.538682454544897e-01   +2.110594724098369e-02   -4.093593658263496e-01   +2.281067995180671e-01   +1.044714326238024e-01   -1.022018402862416e-01   +1.142790804921701e-02   -1.989492269022551e-02   +3.043175388790962e-01; -1.873995062897191e-01   -3.504757497619200e-02   +8.159538673494504e-02   +2.360252430773530e-01   +7.436695447800268e-01   +4.519260797137537e-01   +3.249422295172754e-01   +2.959916617428391e-01   +4.824478673183881e-01   -3.247599476436397e-01   +2.538728337201632e-01   +7.481824941421271e-01; +2.114940455410627e-01   +3.368780864161118e-01   +3.399098062694569e-01   +1.179868314071493e-01   +4.723592377537557e-01   +9.067654218507094e-02   +2.405442437952909e-01   +2.738631661538394e-01   +1.482453492357731e-01   +5.043586812404945e-01   +5.309189512815770e-02   +1.715442887718864e-01; +5.214328580547236e-01   -1.065444335128542e-01   +3.092762072725052e-01   +5.787702104848937e-02   +1.000000000000000e+00   +1.843298505255719e-01   -2.661152844792209e-02   +8.501595447712915e-02   +4.175938088091564e-01   +5.211268322948549e-01   +6.431462369202368e-01   +5.844137451715850e-01; +6.400223289832936e-01   +6.435646734706955e-01   +2.115103109961550e-01   -7.876411383115639e-02   +2.412086816803614e-01   +6.773119983388567e-01   +2.491450310896067e-01   -1.640030471736261e-01   +6.912648724562989e-02   +5.327149168625813e-01   -1.442423007339426e-01   +4.687399699071703e-01; +2.320204684163861e-01   +1.618770396449480e-01   +7.874276097987856e-01   +1.053105944374896e-01   +1.600371875797048e-01   +4.001843299823651e-01   +1.631498911211911e-01   +4.529988064118373e-01   +5.147060793907324e-01   +6.362244838714856e-01   -7.186728639065254e-03   +2.141085122816939e-01; -1.831072593468703e-01   +7.310442132882747e-01   +5.147134589936805e-01   -2.934112297263674e-01   +8.061819709048637e-01   +1.903685686971008e-01   +1.994524186090519e-02   -5.823373390737796e-02   +4.764781995262231e-01   +5.323578963559207e-01   +2.387460709871951e-01   +1.232981268292883e-02];
L3I_L2I_iGABA_netcon = [+6.093974075699684e-01   +4.361703648495830e-01   +2.961419157926057e-01   +3.516546770150185e-01   -2.694012224370029e-01   +2.379610490356827e-01   +6.321127078846653e-01   +5.465358991606319e-01   +1.000000000000000e+00   +2.102119889467792e-01   +3.097841566196108e-01   +4.053471724845851e-01; +2.962643455002898e-01   +4.439596540290189e-02   +1.027708888548221e-01   +2.215700133090283e-01   +4.654829498557270e-01   +3.676460832734957e-01   +5.336030958902076e-01   -1.390648918099476e-01   +2.649740224721541e-01   +1.393553081305380e-01   +4.227672972520670e-01   -2.246872784674804e-01; +3.132939206325332e-02   +5.364999277164281e-01   +4.689907961851397e-01   -2.160273929861280e-02   -1.009783945973495e-01   +1.001107630869435e-01   +5.127601903350055e-01   +5.356424928529140e-01   +3.015220599473348e-01   +1.797337506131835e-01   -2.079111727650653e-01   +6.949580026776574e-01; +3.702764198101354e-01   +2.866499088767572e-01   +4.891796581401965e-01   +8.167847412213920e-02   +2.311046240476282e-01   +2.786710458940105e-01   +1.700033017398899e-01   -9.278339584628204e-02   +3.160837934750015e-01   +3.770175911534141e-01   +4.981631590335920e-01   +3.271125836601081e-01; +2.396362299229185e-01   +3.195264123214861e-01   +2.159365101881869e-01   +4.298425509021830e-01   +4.946194445699990e-01   +4.227497075121983e-01   -1.521926431506773e-02   +8.830854809221271e-01   +6.010487454154586e-01   -8.062256994430543e-02   +1.093709710869499e-01   +4.755617110062084e-01; -7.912682398413788e-02   +3.998973490726950e-01   +4.538441892384285e-02   +3.863971398367590e-01   +6.295336833369622e-01   +3.022249376156818e-01   +3.231340768724913e-01   +2.629371209821928e-02   +1.717523020973987e-01   +1.501466485744455e-01   +2.516382613300852e-01   +4.887195981998263e-01; +5.635754307606659e-01   +2.631301626058416e-01   +4.742435523771268e-01   +2.425549531534493e-01   +6.854433781621860e-02   +4.510730478568581e-01   +3.756834745323929e-01   -6.356513539258671e-02   -2.791389523394289e-01   +5.995589135970237e-01   +5.266932868270937e-01   +2.050866103483885e-01; -9.144189816097728e-02   +2.929232664229588e-01   +6.207034654578105e-01   +6.623201441456571e-01   -2.638677732432234e-01   +5.527591304819949e-01   +7.474437722655628e-01   +3.235847758355918e-01   +6.304814537630491e-01   +2.223876533492163e-01   +6.348914395400260e-01   +3.865512154543051e-01];
L2E_L3E_iAMPA_netcon = [+5.549497859473057e-01   +1.069010544592446e-01   +1.559959865382706e-01   -1.392913342558205e-01   +2.490338657035640e-01   +1.273608477033342e-01   +4.064036967037208e-01   -4.352374606547901e-02; +1.378862398236984e-01   +1.036364769403089e-01   +4.619931841854547e-01   +2.635220780142816e-01   +4.509124545817753e-01   -2.689170879683329e-01   -2.120379935822071e-01   -4.069115020251944e-01; +4.035319321763894e-01   -2.363092347737535e-01   +3.279785809339785e-01   +6.705184602943653e-01   +1.285338746244945e-01   -1.347520140945869e-01   +3.082392467849833e-01   +2.794981632397528e-01; +6.918342239623054e-02   +7.318542969770871e-02   +6.218705608093136e-01   +8.080300332111343e-01   +6.385598939911824e-01   +5.601430477122241e-01   -7.392189162035974e-02   -4.333476068838545e-02; +1.860067993527357e-01   +2.558330539464806e-01   +2.921417941379480e-01   +7.731682464139071e-01   +5.984150709191747e-01   -4.005033668429279e-02   -1.313775831723490e-01   +1.184929262887474e-01; +4.186909290238194e-01   +8.566524241719946e-01   +6.453049784682521e-01   +6.222936522369571e-01   +6.623595469438487e-01   +9.536808627534940e-02   +4.802883911893056e-01   +8.861337697309074e-02; -3.417512570708321e-02   +3.033821442669818e-01   +6.567887465269506e-01   -6.501297382210740e-03   -6.227646162066496e-02   +1.360368460192225e-01   -3.207020689569430e-02   +4.374974353902744e-01; +4.451340954843216e-01   +1.550386691344103e-01   +3.716122707313714e-01   +7.965158949459278e-02   +2.929963207587887e-01   +2.499330441136728e-01   +3.233799908312944e-01   +7.445203755543051e-01; +4.928445485005759e-01   +2.755906734673112e-01   +3.474433187135106e-01   +1.203806757010358e-01   +1.566383535022967e-01   +6.434476877799364e-02   +5.740759437729388e-01   -2.815406286445472e-01; +3.805192978829821e-02   +1.031440300611596e-01   +3.566626077338878e-01   +2.455713870407752e-01   +1.534342904143502e-01   -1.534690018729825e-01   +4.274301398054395e-01   -2.749449401278301e-02; +4.398507951346385e-01   -3.266318092238293e-02   -9.903285972014374e-02   +8.327829613998583e-01   +1.823818171439045e-01   +2.525674305054581e-01   +2.591351137842277e-01   +6.166575921452409e-01; +1.065758968368957e-01   +1.000000000000000e+00   +5.891896364484763e-01   +6.098044409375416e-01   +7.930107486286839e-02   +1.320740334894951e-01   -2.025923490906282e-02   +3.979932753053386e-01];
L2I_L3I_iGABA_netcon = [-3.078972534796005e-01   +6.873521395816673e-02   +5.552057828394696e-01   +5.122908313805837e-01   -1.288993497458420e-02   +6.240737664069376e-01   +2.541380043457359e-01   -4.290754566124793e-01; +4.608935305357012e-02   +2.649241293002529e-01   +3.225930169967889e-02   +1.685813747626141e-01   +2.764237263487408e-01   -1.670302184263433e-02   +3.918879777332954e-01   +1.514772302397303e-01; +7.730118353761302e-01   +6.417518383516192e-01   +9.446617866638209e-02   +5.518828582865448e-01   -1.742309148963526e-02   +9.344024488890545e-01   +3.759139723511327e-01   -1.242357835172083e-01; +1.163275414118137e-01   +3.371356788001224e-01   +6.729485258563701e-01   -2.354388478788871e-01   +1.627551195874675e-01   +6.188569512844641e-01   +5.839363306658393e-03   +6.237116745189240e-01; +7.203993246914527e-01   +4.324555400811161e-01   +2.302874429779030e-02   +3.709339748298672e-01   -1.873020067422438e-01   +2.220467723184918e-01   +4.229373957470307e-02   -1.522440557207680e-02; -1.927074469413406e-01   +4.204177001204164e-01   +6.170128272955652e-01   -3.180136446484341e-01   +4.089064834830574e-01   +8.185002846127148e-01   -1.565465388445649e-01   +1.118803071694579e-01; +6.448205168411552e-01   +1.498870266522628e-02   +3.093742114436611e-01   +1.241830357782836e-01   +1.942343894104908e-01   +5.652220599521507e-01   +6.977717098122516e-01   +3.779854036274048e-01; -1.906243766526150e-01   +7.026805989647933e-01   +1.615557425303551e-01   +1.302521585801933e-02   +2.617920885108526e-01   +1.134805118416096e-01   -8.210972227806564e-02   +7.833117259477420e-01; -7.429488583443093e-01   +7.014016693844857e-01   +6.890199868907513e-01   -2.497239453393808e-02   +2.285695775376018e-01   +4.148411686548562e-01   +3.836046640239704e-01   +4.016612079160251e-01; +4.614776412784709e-01   -3.219588045428684e-01   +2.523870266632487e-01   +2.006753081003127e-01   +4.193309095055608e-01   +6.151275721951597e-01   +7.379116701173294e-02   +4.166259651409324e-01; +9.141224301293713e-01   +2.733078561413129e-01   -2.591980188891890e-01   +1.319898348204266e-01   +4.436886881484246e-01   -2.918485540768240e-02   +4.999968771919394e-01   +9.476664165812994e-01; -3.894002244854551e-01   +6.407712549249003e-01   -3.863181369179576e-01   +6.969127425311130e-01   +7.699913190130843e-01   +2.036261680626525e-01   +2.722787896157798e-01   +2.884378896581691e-01];
L3I_L3E_iAMPA_netcon = [+3.536298509242650e-01   +4.917494562957780e-02   +1.790514138090085e-01   +4.782223247389517e-01   +4.464909736937319e-01   -4.114895899026455e-02   +2.317893271115895e-01   +1.448538481656767e-01   -3.177559937150488e-01   +4.798556001493900e-01   -2.730387264621662e-02   +6.035942904997117e-01; +1.993187611277601e-01   +1.898013840943746e-01   +3.194764727214078e-01   +6.312755885322343e-01   +5.120700570606023e-01   +7.964819572108976e-03   +1.994580593326191e-01   +3.036619976473998e-01   +5.265006094368688e-01   +2.052018635493864e-01   -9.418573836368480e-02   +1.965048972841262e-01; +5.108097844439802e-01   +4.969076571414099e-01   +5.939832646677655e-01   +4.757138563563522e-01   +8.600315754279726e-01   +3.868403020896242e-01   +6.164724490387161e-01   -2.395059215009503e-01   +3.361145150390633e-01   +3.713573201687317e-01   +1.570806603333562e-01   +4.737382684524405e-01; +4.719426573782660e-01   +5.687214117367716e-01   +4.284001775402175e-01   +1.442347890796099e-01   +1.265510302745824e-01   +9.046896074015067e-01   -2.334774494100229e-01   +3.492473628639368e-01   +3.478351482794470e-01   +3.959315356826411e-01   +1.183550942356391e-01   +2.674785196139644e-01; -1.853903280779055e-01   -9.803555009141064e-02   +8.340754782616469e-01   +1.762036091842565e-01   +5.763717579246571e-01   +3.590338334039721e-01   -1.088542631012510e-01   +4.837013968589837e-01   +6.205094814427858e-01   +7.760406309133712e-01   +2.550049868385494e-01   +3.353171340975778e-01; -3.145331185519594e-01   -3.045137725577367e-02   +1.806774286919251e-01   +8.503776036595634e-02   -5.946566075124792e-02   -1.556004691676585e-01   +3.868236008473044e-01   +3.256136577100019e-01   +1.084728932285078e-01   -2.178333142420090e-02   +2.380551607239616e-01   +3.108890544883656e-01; -2.275587989183478e-01   +1.560305598091627e-01   -1.547620290044893e-01   -2.525648035361799e-02   +6.280473594813398e-01   -1.020513436318344e-01   +5.279316397316602e-01   +5.435796226218598e-01   -1.107716662472785e-01   +4.537376476517239e-01   +5.260302028916649e-01   +1.789179945955047e-01; +7.892350539826479e-02   +2.459850434447277e-01   +2.774360456463968e-01   +1.462194574951833e-01   -7.862432333141500e-02   +1.741424416186004e-01   -8.579308978464303e-02   +5.893417438401208e-01   +5.982213272275921e-01   -3.813906621731116e-01   +1.014815439746683e-01   +5.036788463116788e-01; +2.675794660011471e-03   +8.284679319531050e-01   +6.585881234442809e-02   +1.102212627123930e-02   +2.829754776579943e-01   +7.576809218932242e-01   +1.631617534062325e-01   +6.179356659001201e-01   +1.005567325709666e-01   +2.865194925285091e-01   +6.696368938086646e-01   +8.974965115335579e-01; +8.347930129078700e-01   -5.427784852913184e-01   +9.707564823150304e-01   +3.690339675875049e-01   +3.096521227041263e-01   -3.291615230688906e-01   +4.737534357293373e-01   +1.957158494509554e-01   +2.506315265701230e-01   -1.795708588786741e-01   +8.780311061041125e-01   +1.296277834200250e-02; -4.269078906738961e-01   +2.610893973372140e-01   +7.389509936350449e-01   +5.813014543970272e-01   +3.670593350745556e-01   +1.490183928204132e-01   +2.880936414680462e-01   +4.034377997558740e-01   +9.443615151264263e-01   -9.529885304253856e-02   +1.562851100708193e-01   +4.545025249674706e-01; -1.662436343191714e-01   +1.785296640587414e-02   +2.984372591296721e-01   +9.286831534130859e-02   -3.778010031408669e-01   -2.047517893402005e-01   -1.162894022661742e-01   +2.059965316164826e-01   +6.758051642832777e-01   -5.553346022031574e-02   +4.430666796744549e-02   +3.781805481478550e-01];
L3E_L3I_iGABA_netcon = [-1.844078178428883e-01   +2.422906168123115e-01   -8.552698870904668e-02   +3.541713367888834e-01   +3.083625824739824e-01   -4.507662745767835e-02   +9.078714280809741e-02   +2.172894856728425e-01   +2.103953794028822e-01   +2.782417215033544e-01   +4.414292964947316e-01   +1.553580217693399e-01; +5.019343587890165e-01   +2.438069447372019e-01   +1.389967172548305e-01   -1.909048151829063e-01   +2.463834248687416e-01   +7.031861918555476e-02   +1.686365954695220e-01   +3.278973849973799e-01   -1.516872829950736e-01   -4.178985439045650e-02   -5.866627172011999e-02   +2.290088089311121e-01; +6.003588233707929e-02   -1.582983400785429e-02   -2.165373425606028e-01   +9.499666525685439e-02   +2.644137602924155e-01   +2.012328976822854e-01   +1.870895159009255e-01   +2.550602828599012e-01   -1.260319267038321e-01   +4.433555694219920e-01   +4.386355395889040e-03   -1.740612104507826e-01; +2.659373246997729e-01   +4.074347430420828e-01   -3.168502374699337e-01   +3.455012137207081e-01   +7.850453269982441e-01   +1.309147953059249e-01   +1.187972281309723e-01   +1.222961182156807e-02   +8.172119173772650e-01   +4.674832472525350e-01   +1.024438205753417e-01   +2.109549581670935e-01; +3.191484526683150e-01   +4.478497233772283e-02   +8.172502111690239e-02   +4.263456035241601e-01   -3.355955557183029e-02   +2.505744533917930e-01   -2.794322094469672e-01   +5.744852682122092e-01   +2.085142210816533e-01   +4.157480442180413e-01   +4.316683976795891e-01   +3.978417154000978e-01; +4.624798673444599e-01   +7.024477324708112e-02   -8.826273626845915e-02   +9.683601751241808e-02   +2.645189097867797e-01   +1.207527400945283e-01   -1.868844918932493e-03   +3.512576927378205e-01   +5.338652142651613e-01   +4.108365396090258e-01   +1.468175749225411e-01   -2.783209660229902e-01; +1.086377241287990e-02   +1.865455783589632e-01   +6.084634594315096e-01   +1.000000000000000e+00   +2.220031181348932e-01   +2.137500226063420e-01   +7.131364084231429e-01   +4.496230687039416e-01   -1.118348063640355e-01   +5.379845505597370e-01   +5.512546185437525e-01   +1.052587264106088e-02; +2.776802600038598e-01   +1.167067260833144e-01   +6.066948631712342e-01   +7.531555365755981e-02   +3.033824919635095e-01   +8.514745434756624e-02   +1.357210933546326e-01   +5.289708840512822e-01   -1.566900682774202e-01   +2.622198408147038e-03   +3.547875924550447e-01   +4.711982799666934e-01; +1.117603126327505e-01   +2.212802386620079e-01   +2.305213425570945e-01   -2.927101116878927e-02   +1.904693928710598e-01   +9.977214072918361e-02   -2.917999743090141e-01   +4.344009245789476e-02   +4.639763229063635e-01   +5.411691959734189e-01   +6.042637126967613e-01   +5.355966081180742e-01; +2.532868590837544e-02   +5.062303493713657e-02   +4.702585994238219e-01   +2.030755029278272e-01   -4.421493407428627e-01   +3.238270154349697e-01   +3.374744015409163e-01   -2.744371211155633e-02   +1.230131094936405e-01   +3.098085119400963e-03   +1.260507118402535e-01   +2.999384381883317e-01; -5.630289355305984e-02   +1.399999989163668e-01   +4.738512767322115e-01   +4.982739763154301e-03   +1.913978705867738e-01   +1.388323044762930e-01   +3.583633190959379e-01   +1.951211631195333e-01   -1.043924103951735e-01   +2.332309308087448e-01   +3.084631454588539e-01   +1.955250804582168e-01; +2.267374246596238e-02   +3.940683502125956e-01   -1.112570824347023e-01   +1.262936820078960e-01   +8.528023605275293e-01   +3.725283413706276e-01   +4.620092748268083e-01   +2.666028724238841e-01   +6.645165822902571e-02   -2.544724051371579e-01   +2.391744397189706e-01   -6.109404241555126e-02];
L2E_Input1_iAMPA_netcon = [+6.145737490474369e-01   +6.848585013157762e-01   +7.640131735160597e-01   +8.712852316163140e-01   +7.238276359040093e-01   +7.849099849654951e-01   +7.202032940408282e-01   +7.294759135351337e-01];
L2I_Input2_iAMPA_netcon = [+6.194889335548585e-01   +5.178989872097851e-01   +8.558497613861327e-01   +8.726821834652023e-01   +1.481766904247944e-01   +8.652678086886118e-01   +2.069677761633613e-01   +1.306858199237718e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last =  11.21 * ones(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.2*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.2*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.2*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.2*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.2*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.2*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.2*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.2*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
