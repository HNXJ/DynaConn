function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-1.005997906817502e-01   -3.640264892566490e-01   -6.421474106748455e-02   +4.456421719298915e-01   -3.648596336910997e-01   -4.199705072638480e-01   -2.606545428019219e-01   +4.104393585359706e-01   +3.744533738974087e-01   -3.471921800901991e-01   -1.579429793268559e-01   +3.296816120234253e-02   -5.077245862017635e-01   +7.021338726900608e-01   -3.827313511091349e-02   -3.377803210175748e-01; +4.437506614747220e-01   -2.826928425726664e-01   +7.229619248553759e-01   +7.685271065106594e-01   +6.834884877764976e-01   +2.182581487651884e-02   +5.258806953449839e-01   +2.600917022355763e-01   -3.757403309567804e-01   -2.530222025007242e-01   +6.002547991552332e-01   -5.969876251101590e-01   +4.505612373835597e-01   -4.843649865064316e-03   -8.933702651502069e-01   -5.427920936738658e-01; -5.666771255483479e-01   +1.235250396664691e-01   -2.185170802541112e-01   +1.231672551910738e-01   +3.108169795047109e-02   -4.082647240607188e-02   -1.396229479999477e-01   -2.336679180522395e-01   -7.092156953683075e-01   -2.434475458536365e-01   +3.907400206322665e-01   +7.527487945362876e-02   -2.949056665864676e-02   -7.597042962681572e-01   -2.819364781806247e-01   -3.179116655690668e-01; +5.100120771999871e-01   -6.902611728531632e-01   +3.216743537168432e-01   -4.830135866165483e-01   +4.630476213607253e-02   +1.984241028898050e-01   +3.195856276733180e-02   +7.123665111067345e-02   -2.472985134533153e-01   -4.724584465498328e-01   -2.024774019332400e-01   -2.880147490435306e-01   +3.832503094663898e-01   -8.228818990659521e-02   +4.179480001251571e-02   -3.873478572829524e-01; -5.561102927274355e-01   +8.893943632563379e-02   -4.938914155747537e-01   +1.328255923238892e-01   -8.101663430779467e-02   -4.343445522157492e-01   -4.935562779906141e-01   -4.337489305096133e-01   +1.963217397572979e-01   -6.798311237121566e-01   -3.792065699936371e-01   -2.161037987596440e-01   +3.175634846336648e-01   +2.801920125531185e-01   +5.771182826560003e-01   -9.543642818306275e-02; +5.680666338129724e-01   -2.671560837919615e-01   -6.472139713405998e-01   -1.431396135073162e-01   -5.360000799093879e-02   -7.856593067994450e-02   -2.798052213204665e-01   +3.896390888427277e-01   -1.414575934656832e-01   +2.272850847223059e-03   -5.132333327198753e-01   +6.115999185342900e-01   +4.320516417852207e-01   +4.678872217792953e-01   +5.438070286243488e-01   -3.678071141380821e-01; -8.408205247578135e-01   +6.640619357988206e-02   -6.863824022632278e-01   +6.284754534305402e-01   +5.162832667648777e-02   -6.749000899794777e-01   -1.918161024240787e-01   -4.234768699494592e-01   -1.431894494252955e-01   -1.264719824541099e-02   +1.817386638972578e-01   -2.773259659617173e-01   +1.600762447790696e-01   +4.554568255014635e-01   +2.537398696511735e-01   +1.124069456776768e-01; +9.708778460568394e-02   +4.224237889710101e-01   -3.552917547380213e-02   -2.080901303680351e-01   -4.106099131651451e-02   -2.763928071791042e-01   +4.840030393661949e-01   +4.989487341154434e-01   +1.564691939754433e-01   +3.751482255963086e-01   -8.068739324823007e-01   +5.352576807974050e-01   +2.749004315903456e-01   -2.348300328244512e-01   -4.830552328790832e-02   +7.337605833326997e-01; -1.210373777748907e-02   +4.669014352603661e-01   +8.594708405955132e-02   -3.644213985209815e-01   -2.309184224357321e-01   -4.346412711507552e-01   -3.063849406232416e-01   -5.017659028232861e-01   -4.936560170348533e-01   -2.108261804196381e-03   +2.479933309796040e-01   +3.193009034188466e-01   +2.372857404006875e-02   -3.029841787486023e-01   -3.925565571147205e-01   -5.675103396769657e-02; -4.410914009465723e-02   -2.330224033657997e-01   -3.201475055118906e-01   -5.972282496326186e-01   -2.250362942272855e-01   +1.449618885406473e-02   -5.587595420658173e-01   -1.115598894097477e-01   -7.768679136746375e-02   +5.023812414221966e-01   +1.277381778557548e-01   +5.907215863964842e-01   +4.716801732751441e-01   -9.344628519060830e-01   +4.756906824245593e-01   -9.797660612760395e-01; -3.302723843581683e-01   +1.077934958853994e-01   -2.488689758380390e-01   -6.159572631762616e-01   -4.033784070452709e-01   +2.070951619751814e-01   -2.421993716038977e-01   +8.141668469578879e-01   -1.000000000000000e+00   +1.008511275835458e-01   -9.532918200761681e-01   -1.998782194037953e-01   -1.704395832491696e-01   -5.673415538669862e-02   -4.706489899471261e-01   -9.229818766099803e-01; +1.875041732209262e-01   -3.343885883147832e-01   +2.624608887356591e-01   -3.368464634242806e-02   -8.554400149448753e-02   -4.051835464993433e-01   -1.214717547240391e-01   +6.531259204033030e-01   +5.452205916414350e-01   -1.768440064264860e-01   -7.393414996883454e-02   +7.322454928571501e-02   -1.261792604691915e-01   -2.632384742657544e-01   +5.490593071443743e-01   +3.382513693241417e-01; +5.817897313071915e-01   +4.204908248553810e-01   +2.405200707557298e-01   -7.411869566052217e-01   -1.276670376370187e-01   -4.397972841882995e-01   -2.766328968356616e-01   +6.114768433783885e-01   +2.610545429482410e-02   +6.208237353293666e-01   -2.932966306271211e-01   +3.226209677002740e-01   -4.760365608956073e-01   +6.959344395731001e-02   -4.786851601433307e-01   +9.110666285616006e-01; +8.762178894457208e-01   -3.038465248202941e-01   +4.986622097695297e-01   -1.886361984086711e-01   +5.191705317349501e-01   -3.300890845048156e-01   -8.210483347025316e-02   -2.996658993912497e-01   -1.503107703542939e-01   +4.400324671156576e-01   +2.494161187492083e-01   +5.773542076886444e-01   +3.103535355099725e-02   +1.704736904562008e-01   +8.449504988100218e-01   -6.130030079522544e-01; +2.827648841192072e-01   +6.105683495162327e-02   +4.421527754926877e-01   +2.760609840244069e-01   +3.138002314424657e-01   +1.574689707357580e-01   +1.528497331345146e-02   -1.757678604412535e-01   -6.263682571000271e-01   -5.276855131280810e-01   +7.029321364666221e-01   -7.050414921771563e-01   +3.125105598778754e-01   +2.624345443257278e-01   +1.810844715313510e-01   +8.351635585730691e-01; +1.456730453932928e-01   -1.168161509319757e-01   +5.504365383064522e-01   -2.486334934117469e-01   +7.936093348654377e-02   +3.862954645654707e-01   +3.039726139896161e-01   +3.088408042434633e-01   +3.613607700779667e-01   +3.703616847577854e-01   +4.620108647254988e-01   -6.694021388188826e-03   -7.137413566164241e-01   +2.806459020914041e-01   -7.824433498329350e-01   -1.308635874706999e-01];
L1E_L1I_iGABA_netcon = [+7.326570893343877e-01   +5.864869935360368e-01   +4.506219362937200e-01   +8.721656388630088e-01   -6.332325864765831e-02   -2.888584762039925e-01   -3.797025862220106e-01   +7.305537440571491e-02   -5.295649100562054e-01   -8.563502181303465e-02   -3.686798144632972e-01   -3.161394933689156e-01   +4.050571169075494e-01   -5.261388415003465e-01   +4.246944630247217e-01   -8.134119746266746e-01; +4.107106194316024e-01   -2.005343323106940e-01   +2.967376602734212e-01   +2.958430758488390e-02   +1.113572200291592e-01   -1.858781317761598e-01   +7.446352416027373e-01   -2.344045624407718e-01   -6.437584213990191e-01   -6.877514033828989e-01   +5.973252837809051e-01   -3.595040326098158e-02   +3.890203410796062e-01   +8.125931383396485e-01   +3.067971363691370e-02   -1.674924911424704e-01; +9.006527566332347e-02   -5.908889212072060e-01   -3.184009989611737e-01   -1.973902588391516e-01   +1.668051223111654e-01   +3.230674753422386e-01   -4.844589669097910e-01   +4.983567522303705e-01   +9.011502059284500e-01   -2.189465850090634e-01   -2.894123963728925e-01   -3.170450105798219e-01   -4.806145629802035e-01   +3.745255575980541e-01   +8.293814684496648e-02   +8.009834405508601e-02; +4.351498666518295e-01   -7.132802906806993e-01   +3.233613171753234e-01   -5.699217608316457e-01   -2.287255117105315e-02   -2.204930898330747e-01   +7.232866727341534e-01   +5.375428584397214e-01   -7.506127627694198e-01   -3.019052807743227e-01   +3.108914792806528e-01   -1.823159575394892e-01   -1.862203488117647e-01   -2.583756170306819e-02   -5.125051859325984e-01   +1.000000000000000e+00; -6.903103850224375e-02   -1.031894479542091e-01   -1.961628915281505e-01   +2.095905108306395e-01   +3.137237959763274e-01   -6.244864817997812e-01   +2.211918486422343e-01   +4.160235193820870e-01   +7.051540022589614e-01   -3.824000860763196e-01   +1.888316882236156e-01   -8.523162080207469e-01   +1.961719874727321e-01   -7.892844328260809e-01   +5.561478112142701e-01   -2.564080912461745e-01; -5.737299000634327e-01   -5.091448312942514e-01   -3.933104791380573e-01   -4.797141434217429e-01   -1.745747003271771e-01   +7.327002522481639e-01   +3.148537169083865e-02   -5.670041151899098e-01   -3.285652026726187e-01   -6.158024476467286e-01   -5.734173055884686e-01   +3.294407777741095e-01   +2.649447718420129e-01   +3.537689981551274e-01   -1.126054846940697e-01   +5.580798056793016e-01; +1.975113252086040e-01   +2.053349934805208e-02   +2.379491527723247e-01   -3.934759533291849e-01   -8.298620225930712e-01   -7.707428627612012e-02   -1.373204502972244e-01   +2.276764417102667e-01   -7.634007612096250e-01   +8.727042982580847e-03   -5.340484042534539e-01   -3.232879867349255e-01   -6.914991315543620e-01   -8.757211281294187e-02   -1.079946186941922e-01   +7.118457351097859e-01; -2.875191280562778e-01   +2.856215644987520e-01   +3.654247925706702e-01   -2.412683236204192e-01   -1.126868739105284e-01   +2.843681552728787e-01   -3.996330192094498e-02   +7.849017199987076e-01   +2.825734433184899e-01   -3.630212035389445e-01   -2.487946524512555e-01   -8.480952119174756e-01   -3.842661809162352e-01   -1.387122768530640e-01   +3.404102321901515e-02   +4.294576473430062e-01; -5.879077592977026e-01   +2.675419284090989e-01   +1.034409646919415e-01   +2.350282234924830e-01   -1.538713686792465e-01   -5.029498556411227e-01   -6.173186077963554e-01   -7.308393551718698e-01   +1.999662365556754e-01   -3.229772088922637e-01   +1.990990106857748e-01   +4.654674890132835e-02   +1.413483472089750e-02   -1.737000748819132e-01   -7.677266546512769e-01   -3.723159065140983e-01; -6.976224965771359e-02   -8.527677108037730e-01   -3.458759116661261e-01   -3.168614501370312e-01   +5.473509972820750e-01   -4.383559062024148e-01   +2.803220814497527e-01   -1.116926169440867e-01   -4.297049342206551e-02   -4.649424745741505e-01   +4.627333765006497e-01   +4.687527313921427e-01   -1.654191420732092e-01   -5.974363717828629e-01   +1.631162623411900e-01   +6.900396259788562e-02; -2.071076316667370e-01   -1.977300757659484e-01   +1.303093052951185e-01   -6.425465134406616e-01   -8.192997239633001e-03   +1.899428601005781e-01   -2.939172169067151e-01   +8.718498361991623e-01   +7.261096475935951e-01   +2.059471054543957e-02   -2.842904833670900e-01   +5.176002821681334e-01   +1.236079021227818e-01   +8.650362362131660e-02   +2.838429923224545e-01   -1.362297734719338e-01; -2.571665506737945e-01   +5.791727411653337e-01   -3.552414560686988e-01   -2.464223926329909e-01   -3.262492882975151e-01   -5.168455192840934e-01   -3.214743942192189e-01   +3.159660851530092e-01   -3.233541541293904e-01   -4.238630506497973e-01   +2.501773913306855e-01   +6.830028930408935e-01   -3.112706114157583e-01   -2.087010707040335e-01   +3.405708402633346e-01   -2.522185177148470e-01; -1.640397115730898e-01   -7.051646793043841e-01   +5.699766446735168e-01   -5.830197221242504e-01   +3.159498546680054e-01   -1.438208431558857e-01   +1.348041187406532e-01   -9.427772137653384e-01   -9.801272837853126e-02   +2.563059723174951e-01   +7.688952475858551e-01   +4.630860703533050e-01   -2.100183271793647e-01   +1.089524088533057e-01   +7.576731843145479e-01   +7.699377899594961e-01; +4.751594111111335e-03   +5.966201764460509e-01   -4.674599515862304e-01   -7.151600758362032e-01   -2.186188065482115e-01   +3.367247940769436e-02   -2.998081891095551e-02   -6.148350274049158e-01   -2.135854011383251e-01   -5.455615676427418e-02   +1.987677312232984e-01   -6.159606733228337e-01   -2.107434636499285e-01   +4.031816411863374e-01   +5.253837243005924e-01   -5.029202399180256e-01; +5.870697561345427e-01   +2.818935796924823e-02   -5.156185799372465e-01   -2.244555828098474e-01   +3.145676613720275e-01   -4.620381594941772e-02   +6.528152302168300e-02   +2.834980963171653e-01   +7.918499968395954e-01   +1.802998134788485e-01   -6.242050773831405e-01   +2.656570040393865e-01   +3.223538654036631e-01   +4.597282829922278e-01   -2.922180240393215e-01   -4.806665850238955e-02; +2.645247804767952e-01   +2.148820432360774e-01   +1.406660212641815e-01   +3.678194562876584e-01   +4.286167620938367e-02   -4.994598879942286e-01   -1.811584714072138e-01   +1.937783603616287e-01   +1.713699610094002e-01   +5.094688921416575e-01   -2.549700189140246e-01   +1.405399357025350e-01   +8.677145578786574e-01   -2.324488187372403e-02   -4.817986946082944e-01   +4.782935931144427e-01];
L2I_L1I_iGABA_netcon = [-2.112329725807880e-02   -3.946626100016223e-01   -1.791968061885505e-02   +1.495468583013310e-01   +8.887720901274861e-02   +3.869170806613981e-01   +4.434959029918024e-01   +6.535686938334392e-02; +4.542175597151762e-01   -1.557204940058466e-01   +7.250502445071220e-01   -1.154971112584894e-02   +3.629464925933250e-01   +1.282425856346362e-01   -1.658019732447314e-01   -6.121955381091814e-02; -8.558869059934009e-01   -1.503742399152721e-01   +3.942921250588736e-02   -6.663825426503341e-02   +3.558788572972891e-01   +5.465640243065883e-01   +5.138759294008240e-01   +2.414873999981162e-01; +2.972216695444524e-01   +4.074830609991544e-01   +5.944328323579867e-01   +6.402912862363227e-01   -5.687119813118270e-01   +2.849678112227805e-01   +4.689876094268736e-02   +7.266410932969156e-02; -7.189530315284970e-01   +6.000576625848346e-01   -7.988488178252659e-02   +2.670687307405230e-01   +6.428015247996569e-01   -3.116825061011718e-01   -2.602231429617546e-01   +3.396516780905640e-01; -4.651794243568547e-01   -5.295319784506577e-02   -3.626852309982301e-02   +6.767477210156969e-02   -8.067695796180675e-01   +1.048351852068440e-01   -7.016652702963617e-01   +3.268542657973773e-02; -4.519612172218038e-01   -6.473961510602666e-01   +1.000000000000000e+00   +2.474332097994336e-01   -2.860792340454468e-01   +4.307599931897220e-01   +3.813381503888334e-01   +1.043812069333934e-01; +4.648329525890406e-01   -1.665109585878597e-01   -3.820659302755670e-01   +6.177958739665892e-01   -2.940153700439970e-01   +1.798320511308258e-01   -1.672911657699812e-01   -3.180711852960260e-02; -5.272626285024665e-01   +2.651052849076728e-01   -2.604774977022105e-01   -1.731605746933000e-01   -2.686970930534646e-02   -3.669117393051300e-01   +7.395105691044092e-01   -3.353040151726916e-01; +7.687731637341803e-01   -2.596394934286152e-02   +2.775934558206662e-02   -6.124683517690112e-01   +2.016690937088461e-02   -3.002094507192581e-01   -1.556463732791384e-01   -1.263471034196669e-01; +2.288313943425299e-01   -7.196244225207126e-01   +5.206861232660316e-01   +2.566865308370898e-01   +2.214983984904308e-01   -9.964371532970907e-02   -3.128158442977760e-01   +5.944605867307881e-01; +2.516093733681420e-01   -6.037274100349579e-01   -7.591979312597728e-02   +6.628041221637473e-01   -6.639744648054320e-02   +1.794114879475220e-01   -3.541302837070904e-01   +5.143450377458927e-01; +4.025792605341728e-01   -8.740855233085940e-02   +9.930832377809369e-02   +9.400630250625576e-01   -7.847997895063373e-01   -1.860148871197916e-01   +5.936077893097781e-01   -4.593807619587186e-01; -3.094072743735026e-01   +1.527693641814374e-01   -2.380536823323425e-01   +3.529077328531391e-01   -5.029969431059350e-01   -2.285407293730143e-01   -2.498054192226548e-01   +2.650404313109052e-01; -2.593580220733813e-01   -2.561495605322981e-01   +1.764755587990201e-02   -1.273200436212743e-01   +6.640526710123713e-01   +7.083416153429001e-02   +3.479736343688449e-01   +1.840668129129067e-01; +2.628846043602491e-01   +3.716405550933327e-01   -1.981029911754711e-01   -1.055136320871154e-01   -7.175254279543231e-02   +3.166791848353347e-01   -6.949913849028813e-01   +1.012578539966438e-02];
L1I_L2I_iGABA_netcon = [-1.915555175459700e-02   +2.295692746978972e-01   -2.970221960696197e-01   -2.889983098958476e-01   -1.788059475881635e-01   -3.702399524609072e-01   -6.555273946184114e-01   +1.945030002823479e-01   +7.282976672845440e-01   -5.443879602020009e-01   -6.596527447611490e-01   +2.700136197944519e-01   -1.389575387191923e-03   +2.642002765747812e-02   +6.459542617295205e-01   +6.932866621141991e-01; -3.179088970103746e-01   +5.809358229071274e-01   +3.729812730515646e-01   -6.132284965644769e-02   +2.517694894611650e-01   -2.895189947016195e-01   -1.000000000000000e+00   +2.538549823742292e-01   -1.487358474194393e-01   +2.428673938863160e-01   -1.510281340431176e-01   +1.804381589956141e-01   +1.823768041933154e-01   +3.342792649092274e-01   -2.364571717203802e-02   +6.295643578637214e-01; +1.476741875958900e-01   +2.768283809848941e-01   +3.731718027313343e-01   +7.569254046321708e-01   -3.397298936557613e-02   -4.136848675216047e-02   -1.029920570883095e-01   +3.253212110872210e-01   -1.679463915515820e-01   -2.955808874460950e-01   +2.794427862751400e-01   +4.077947890933867e-01   -7.580169382716611e-01   +2.269465649956882e-01   -5.778222291997473e-02   +8.230342525042765e-01; -7.846861200704884e-01   +4.012485563802113e-01   -7.409100580173907e-01   -7.802786994425791e-01   -6.652394702491504e-01   +1.626884407233151e-01   +4.037804865659525e-01   +1.104803838123188e-01   -6.693399131410198e-01   -9.966460528541281e-01   -3.901023530907253e-01   -2.662758198359778e-01   -3.209507167453372e-01   -1.715959583882434e-02   +7.121081108392671e-01   -7.472616687757058e-01; +9.931828595560612e-01   +2.164834513804970e-01   +5.047584715550835e-01   +3.116534068240487e-01   -4.390907492390504e-01   +2.237016196845528e-01   +5.918193776155509e-01   +4.132768725313814e-01   +1.421196529102572e-02   -5.023685421088833e-02   -2.946871269403001e-01   -1.612125850868280e-01   -7.394555446530006e-01   -2.331353452421669e-01   +8.092382253971853e-02   -8.118808096388611e-01; -2.325263049164852e-01   -1.855236709566532e-01   -4.723300173459603e-01   +8.206549188603116e-01   -8.439502003996928e-01   +2.864520342414650e-01   -9.304158006528827e-01   -1.708209911210315e-01   +1.682294196783556e-01   -1.590375619381632e-01   -3.464203442187921e-01   +2.694421590255742e-01   -5.832941013464146e-01   +2.116687667196993e-01   -5.260973052264593e-01   +1.314712109306466e-01; -5.523277563597127e-01   +5.188467063266418e-02   -5.020012218713453e-01   -7.187874940377527e-02   +6.253519826560400e-01   +3.520245799007112e-01   -3.122174544314829e-01   -2.301337374320594e-01   +1.218840691223552e-01   +4.446319528693686e-01   -1.174768967873309e-01   -6.707102692855179e-01   +1.806942487741073e-01   +5.318436456106771e-01   -9.756581018403618e-02   +1.854637855582253e-02; -2.562038653508414e-01   -3.371779205059474e-01   -3.239481651582340e-01   -6.586008261883287e-01   +6.101409130243719e-01   +8.773184706962371e-01   +4.131265660215913e-01   +5.079223302113118e-01   +9.034240458884160e-01   +2.280681198013604e-01   -8.498177895055143e-01   -2.401172669143671e-01   -3.121320620215586e-01   -9.026438837454571e-01   +8.152835056369725e-02   +7.199641621101153e-01];
L2E_L1E_iAMPA_netcon = [+1.268480444909477e-01   -7.360682065097085e-01   +6.168266416032133e-01   +4.277083707564994e-01   +6.552012427168739e-01   +5.071944003263011e-02   +3.825660355429060e-01   +5.266399489731785e-01; -5.170766786036645e-02   +4.105921865537352e-01   +6.174204523955795e-02   -1.923945952258093e-01   -1.451740477142622e-01   -7.888785775671182e-01   -8.575907875915942e-02   +1.317914144758981e-01; -5.495694947354834e-01   +2.083323025155287e-02   -6.721777971438145e-02   +1.477096400520858e-01   +4.651840065574610e-01   +5.207117712641024e-01   +6.981860663417525e-01   -7.229092507957697e-01; +5.398044516158719e-01   -1.367227267969290e-01   -5.746448278162929e-01   -7.961129403901414e-01   +1.840041803668623e-01   +8.297179212572207e-02   -4.642369851124114e-01   -2.874615048051368e-01; +1.743210568554505e-01   +4.851958961365449e-02   -5.447150531624469e-01   +1.415695538638399e-01   +6.074574271712804e-01   -3.707808934514187e-01   +4.068417080261924e-01   -6.167998692755686e-01; +2.734497475784423e-01   -6.534553477292921e-01   +3.437143518436663e-01   +1.952803407272344e-02   -2.898579433787382e-01   +2.041675360989755e-01   +7.098274308381189e-02   -8.341249687281342e-01; +6.101237332409354e-01   -2.472591306356832e-01   -3.068166090789459e-01   +1.255571536742107e-01   -4.451737836340438e-02   +2.559300711044119e-01   +6.989580755865906e-01   -7.755110584170596e-01; -7.193492190512557e-01   +4.791829179500270e-01   -8.976754019451137e-02   +3.559751041875880e-02   +2.388745274241620e-01   +1.191829196967287e-01   -1.000000000000000e+00   -4.655223194671004e-01; +4.876195217563411e-01   +2.762805248079320e-01   +4.946511604837336e-01   +2.570758077704657e-01   -3.306921116501662e-01   +3.360553605863722e-01   +1.704270604919984e-01   -8.168399810384220e-01; -1.464395026607925e-01   -4.662015903122086e-01   -1.047824503804697e-01   +5.448190409001851e-01   +5.818542214894210e-01   -7.023585444947504e-01   -3.668851844203387e-02   +3.193898329972724e-01; -3.351572489078227e-01   -3.754596765480664e-01   +1.358016418797507e-01   -4.074868598150975e-01   +5.117506749811167e-01   -2.610961741932874e-01   -5.462445093606090e-01   +4.832747688983434e-01; +1.467350537428837e-01   -9.874822470986288e-01   +5.878276163569199e-01   -1.920458796612333e-01   +8.705250277495841e-01   -4.638290968983127e-01   +6.598620644487500e-02   -4.193234409024943e-01; -5.445900348044574e-01   +5.186320803208930e-01   +3.621026738902208e-02   -2.991285906978817e-02   -3.609360052421357e-01   -7.409810991955397e-02   +1.260272517766161e-01   +3.102008659245140e-01; -1.325652972188566e-01   +4.160361173469315e-02   -5.316128668656661e-03   -9.913021413479320e-01   +2.305477035605227e-01   -1.836588165738981e-01   +5.978073395838874e-01   +5.816145510966297e-02; +1.785552111104007e-01   -2.012369366960113e-01   +9.956849286278879e-01   +7.802781556112562e-01   -4.417117788945376e-01   -3.782908567026280e-02   +6.799148750505019e-02   -2.901273119814369e-01; -3.695353302229699e-01   +6.647816654361907e-01   +4.990656228481377e-01   +8.622061733694826e-02   +2.297164645800008e-01   +5.155052546306819e-01   -4.127350220470444e-02   +4.693124734447988e-01];
L1E_L2E_iAMPA_netcon = [-1.220568905385851e-01   +7.415503542848580e-02   +7.401489190499408e-02   +9.208227061354324e-01   -4.073060033895509e-03   -5.904839067665749e-01   +4.880356219481975e-01   +6.114938654355200e-02   +5.580345122180368e-01   +4.663329411485923e-01   -5.957387336339890e-01   +5.545072631841935e-01   -7.153255679166451e-02   -1.211151683811130e-01   -6.925587091068840e-02   +3.410715457967405e-01; +2.801609248795838e-01   -3.704762032805280e-01   -2.587831492616215e-01   -9.015507875737924e-01   -6.554943284937389e-01   +1.090368903607506e-01   +4.065235453386442e-01   -3.881858560028595e-01   -5.993536233294261e-01   +6.797355570209593e-01   +5.119815919300053e-01   -4.505148412156865e-01   +2.571366402728398e-01   +7.387721466497690e-01   +5.417247057587784e-01   -6.167182587331377e-01; -9.623477378483200e-02   +6.332026520156769e-02   -8.442621327041618e-01   +8.586735568916198e-02   -6.972439898870173e-01   -1.035700757395407e-01   -5.279691847427167e-01   +1.802819658688215e-02   -7.353388856472394e-01   +5.442659656016371e-01   -7.726432983061934e-01   +5.109879327885652e-01   +7.933812284376662e-01   +3.446209841771594e-01   +6.040930864254844e-01   -8.303485528951716e-02; +1.252765648493571e-01   +6.495974761495781e-01   -3.939896600700484e-01   +5.131487597775630e-02   +4.001529528069606e-02   +4.269995243356876e-01   +1.942714216360418e-01   +2.768226854820392e-01   -2.244803342468293e-01   -6.667230743010339e-01   -2.189122500398549e-01   +1.943870101472392e-01   +3.381763530213641e-01   -7.257625818107016e-01   -1.000000000000000e+00   -5.408042707633836e-01; -8.310714640113047e-02   +3.919138393567476e-02   -1.442528023054467e-01   -7.421314267446912e-02   -1.478229407270781e-01   -4.314551555967696e-02   +6.703765665790726e-01   +6.806191513277117e-01   -1.673553878613903e-01   +6.920441320520813e-01   -6.261036064256117e-01   -2.507258391926734e-01   -2.499640752008282e-01   -7.266205912616230e-01   +2.336977527879462e-01   +4.632582141924286e-01; -1.224342492615106e-01   +3.526433837873569e-01   -3.464409073200522e-01   -3.573453126654402e-01   -1.956123472330016e-01   -1.618811703161083e-02   -1.763060620550929e-01   +1.075950730278571e-01   -1.436022019263367e-01   +5.887267918269510e-01   +1.300560296861805e-01   +3.868787654888545e-02   -8.919004484823606e-02   +5.683274598604326e-01   +3.697883934700331e-02   +3.529769144186529e-02; +4.417932435145330e-01   +1.274842261985479e-01   -3.941443743832683e-01   +1.228396331441240e-01   +5.401890981096521e-01   +5.413660208756295e-01   -4.057774029114536e-02   +1.574947290216608e-01   -7.876134605580321e-02   -3.264177694047494e-01   +6.178195390050522e-01   +1.945009219911165e-01   +2.975741383843850e-01   +2.076464797374398e-01   -6.333392881233538e-01   -6.884227823054735e-01; -3.462000075594073e-01   +2.859991084956309e-01   -8.370057751567775e-01   +5.895632464764366e-02   +8.329905534274816e-01   -3.257975454075179e-01   +3.298043354546709e-01   -1.308792284024113e-01   +7.076666240939522e-01   +3.318666935903318e-01   -4.183278921321069e-02   -2.729504044966179e-01   -8.568913928178537e-02   -2.306181416844200e-01   +2.444048399560995e-02   -7.143513776311931e-01];
L2I_L2E_iAMPA_netcon = [-8.384974559658837e-01   +6.786971616931462e-01   -8.135969077303161e-01   -2.004939842953471e-01   -4.522805122050626e-02   +1.676151290758262e-01   +1.785693623432062e-01   -3.497004842757991e-01; +7.217191093297306e-01   -7.573924952264407e-01   +3.847024814146484e-01   -8.756804873313094e-01   +5.454531857728805e-01   -4.970137775857869e-01   -3.039160088433077e-01   +4.425623360697454e-01; -4.026576808027261e-01   -4.984395815383545e-02   -2.592903752864662e-01   -5.157853636322163e-02   +3.769862203387240e-01   -1.997937826388088e-01   -1.068699831747237e-01   +6.914933845528801e-02; -2.648126143988969e-01   -5.892733228224361e-01   -6.941694850298610e-01   -2.369359953813180e-01   +3.228785713193953e-01   +2.044929118274746e-01   -2.547657734019729e-01   +6.066097669039927e-01; +1.477539628562237e-01   +4.218169138805029e-01   -1.952088471655014e-01   -4.682024338113666e-01   +3.362134940671900e-01   +2.290189339322790e-01   -1.244842016812152e-01   +7.000687713702632e-01; +3.661936144607004e-01   -1.000000000000000e+00   -1.286217970189438e-01   -8.738122471614881e-02   -1.866609138876982e-01   -5.825794556369142e-01   +9.519148315856270e-01   -5.123870044432487e-01; -3.284678286315697e-01   -6.449027001784143e-02   -3.386668276212350e-01   +2.431663300726871e-01   +2.170695388975828e-01   +5.760929851845867e-01   +6.404235279058628e-01   +7.957704381498290e-01; -5.107886546678372e-01   -4.519293104495943e-01   +7.452652162089877e-01   -5.180414054948580e-01   -2.174628547497958e-01   -2.350926565330698e-01   -9.665608586027485e-02   +4.611452902623732e-01];
L2E_L2I_iGABA_netcon = [-1.102464513267643e-01   -9.624787190008239e-01   -8.674832725232236e-02   +9.034097405588609e-01   -4.468865865070430e-01   -6.726159359519519e-01   -1.000000000000000e+00   -3.343542972243911e-01; -5.341517028088583e-02   -3.832959016548005e-01   +1.429822806917752e-01   +2.862735207610241e-02   +7.588547297330961e-01   +3.932779754936213e-02   +2.233865891621339e-01   -4.613114927769658e-01; -1.760018991274895e-01   +4.359720244682090e-01   +1.995712861067668e-01   -1.873379438253713e-01   -2.543870609252109e-02   -5.253717047188378e-01   +8.182737137173078e-01   -5.181458571630720e-02; +3.061586035960754e-01   +4.787624618570860e-01   +1.503672323138500e-01   +7.905363009290305e-02   +3.435847933380132e-01   -8.890243134720557e-01   -2.487914072957509e-01   +4.360758006908541e-01; +8.526567432751054e-01   +7.203862032774345e-01   -1.224123448912367e-01   +5.203262850530997e-01   +3.576530254475335e-02   +2.566232931322452e-01   -1.663768149792170e-01   -9.929297779534476e-01; +5.453531741856917e-01   +2.922946011091380e-01   +1.613912216983955e-01   -2.608785417767078e-01   -4.698601493206220e-01   -4.002998343014027e-01   -5.792051459456536e-01   +1.805089889445036e-01; -1.367517956063662e-01   -8.275011427954240e-02   +9.780738426258766e-01   +9.253044368471859e-01   -6.830267043678569e-02   +9.883812618597739e-01   +3.342899044395245e-01   -5.290178279709923e-01; -9.736229430907065e-01   -3.282869595945735e-01   +6.631264793181879e-01   +5.675081191693909e-02   +1.985749994867128e-01   -5.043182107615330e-01   -2.229551949127213e-01   +4.693463986584342e-01];
L3E_L2E_iAMPA_netcon = [-2.226955341216992e-01   -1.148885404889323e-01   -2.674241761727521e-01   -3.603028450005892e-01   -4.299076262606779e-01   +1.987798434799732e-01   -4.251756978828419e-02   +4.904941049308725e-01   +1.367931947806847e-02   +2.585622135343845e-01   -1.751553591113970e-01   -1.127268064646573e-01; -2.714834110210170e-01   +1.104030446563039e-01   -4.737853671459285e-01   -2.411045438304778e-01   +5.236701268621443e-01   +6.100030293061396e-01   -1.667339815872213e-02   -6.435738909219836e-02   -1.014861076655614e-01   +1.499402720702588e-01   -2.984786392500535e-01   -4.440787037609086e-01; +3.991644645954505e-01   +1.435682386651815e-01   -7.086132468760652e-01   -4.322581185776921e-02   +1.417810822389617e-01   +6.881783175487628e-02   +1.394952886970186e-01   +3.450781061600238e-01   -4.227214284189291e-01   +7.072362441663829e-01   -6.788029178594185e-02   -6.785546475919952e-01; +8.670752458445516e-02   +1.392474875534285e-01   -2.868375383937602e-01   -6.410862549323694e-01   +5.504219015888736e-01   -1.692221128592986e-01   -2.765169147417402e-01   -3.757098601373235e-01   -2.243910694957507e-01   +5.478789722487201e-01   +6.406168432610048e-01   -9.917904084671800e-02; +7.585605673674854e-02   -6.111103860343964e-01   -1.331088925444925e-02   -1.834789551119743e-01   -4.671926110192348e-02   +1.154605810511828e-01   -3.137361946728309e-01   +1.316345365419054e-02   -5.307308567184534e-01   -1.521546322115558e-01   +2.588449373178365e-01   -1.402768232056328e-01; -5.682048243348340e-01   +2.726133696749924e-01   +3.027555179032638e-01   -6.864840140435002e-01   -8.493913616074515e-01   -3.686067377432434e-01   -3.251068346211937e-01   +1.526912661107379e-01   +2.845584338411689e-01   -2.947480867744582e-01   -6.027723144634538e-01   +4.268617223945929e-01; +2.278765682806899e-01   -1.176815009025739e-01   -5.126621079363100e-01   +9.853403622971973e-02   +7.062718324100352e-01   -5.043620510532117e-01   +7.763460545105063e-01   -1.039633941215578e-01   +4.216071101309459e-02   +5.374950151764255e-01   +5.369301623769264e-01   +6.153041595045378e-01; -3.039411003051357e-01   +5.446428016952327e-01   +2.322189847665292e-01   -5.812506456626053e-01   -3.845549234210345e-01   -6.939791797400122e-01   +4.245328229557971e-01   +2.564180384085260e-02   -4.444392879211249e-01   +7.955071914457174e-02   -7.956726679929861e-02   +1.000000000000000e+00];
L3I_L2I_iGABA_netcon = [-6.912655016526844e-01   +3.084751669865114e-01   -6.115095889674463e-01   -4.332533396437740e-01   -7.342378608415761e-01   -2.207024873757377e-01   +4.470094236489547e-01   -1.601007359599983e-01   -8.415540994250665e-01   -9.139628971043623e-02   -5.795638220540059e-02   +7.137425381394404e-01; -9.134744394619852e-02   -6.390908181201571e-02   +6.048186944833144e-01   -2.504931243991386e-01   +3.127207898494576e-01   +3.893521128126812e-01   -3.150200837076638e-02   -3.852380370009834e-01   +7.573918146249587e-01   +2.209561164278339e-01   +1.335197909514443e-01   -2.551476092857745e-01; -1.524604144108760e-01   +7.400051125849438e-01   +3.033945113864555e-01   -6.688225844368940e-02   -4.170359754978295e-02   +3.058159561621857e-02   -5.523365779286203e-01   +2.251574483293194e-01   +1.172855007812900e-01   +3.333921053240175e-01   +6.598426481755841e-02   -2.042269780316225e-01; -6.095997980917831e-01   -1.195267889061789e-01   +5.425989189846320e-02   -1.237334653339242e-01   -7.211334514455316e-01   +3.154843992505559e-01   +1.420255627541792e-01   +7.455999819190917e-01   +8.330757164837478e-03   -8.811656470041680e-01   -4.402399656812878e-01   -1.197068332971632e-02; -1.912162531751003e-01   -3.018079060829447e-01   +8.431990480810121e-02   +1.463241448641024e-01   -3.633201726528850e-01   +7.374370257363404e-02   +3.430441549883286e-01   +3.144088774705763e-01   -5.515147040486318e-01   +2.592213656882359e-01   +2.761130834050062e-01   -1.548795635523613e-01; +2.265435943211315e-01   -2.678240721516212e-01   +4.356551824531005e-02   -3.150094487400520e-01   -1.111026093076431e-01   +3.289321562378567e-01   +7.755458809856988e-02   +7.944866944902994e-01   +1.569447322689796e-02   +2.430182039458005e-01   -1.000000000000000e+00   -9.685740710533498e-02; -5.816537527607406e-01   +2.366655978959164e-02   -2.636627216694520e-01   -2.894640539326376e-02   +2.453668399723681e-01   +1.339023273618272e-01   -5.776998401828760e-02   +4.315716794299689e-01   +1.121230098448338e-01   +1.784641245556849e-01   +1.518181339661408e-01   +5.075094424219683e-02; +1.928611511606342e-01   -2.256029318561927e-01   +7.551171985459796e-01   +2.502364102949496e-01   -6.490223080272108e-02   +6.309634497570669e-01   -4.183769180824379e-01   +3.695568653642075e-01   +4.436232439962321e-02   -4.798806150434028e-01   -2.800818053608125e-02   +8.043318135979557e-02];
L2E_L3E_iAMPA_netcon = [+1.000000000000000e+00   +3.798117924160384e-01   -1.080928727100431e-01   -8.659834705900306e-02   +1.377259533433060e-01   -6.458005674116504e-02   +1.116740500058554e-01   -3.378225560004661e-01; +4.079012707376731e-01   +1.163448337419324e-01   -2.796889058371932e-01   -5.268298352688083e-01   -3.314195193175833e-01   +3.620969104632588e-01   +2.862352013933439e-02   +1.567235331266191e-01; +4.854515607297888e-02   -4.448333501775589e-02   +4.098108629482050e-01   +4.434577214466520e-01   -1.622005078292553e-01   -1.285544663827348e-01   -3.736158548990531e-01   +4.108355158633681e-01; -8.663645152493857e-01   -3.614937753490757e-02   -5.953612619311972e-01   -6.420615045894551e-01   +8.370121054863470e-01   +1.513858678563033e-01   -5.427954567248541e-01   -2.373395790264999e-02; +4.220025419925928e-01   -7.355266792270048e-01   -1.518457694955418e-01   -3.917579038207229e-02   -8.984335496903561e-03   -6.220379316892447e-01   +5.437488015779626e-01   -1.526444617415379e-01; -2.166421348991010e-01   +1.683125137298310e-01   +3.537277360928253e-01   +2.967495197275187e-01   +1.739404798136997e-01   -2.830210080518248e-01   +8.217436441269775e-02   -7.499666755650538e-01; +4.858024017332903e-01   -1.027663858847812e-01   -1.285906995850755e-01   -7.683615566081395e-02   +7.205456627368068e-02   -3.970106009168002e-01   +7.767176547567238e-02   +1.528198353277552e-01; +7.765778398662585e-01   +5.164774252072897e-01   -8.401916996190914e-02   +8.596838093301677e-02   -3.560124435799793e-02   -1.431007664958794e-01   -8.575195343338030e-02   +7.814292822404317e-01; +2.367394409090090e-01   -5.808807912389196e-01   -4.119720825866054e-01   -2.545256437928806e-01   -5.331416390440917e-01   +1.982215764258751e-01   -1.308298535541930e-01   +2.595990842654545e-03; +2.800631651479581e-01   +2.448645785431718e-01   -2.314441159373008e-02   +1.259564456930943e-01   +2.633321174519409e-01   +2.747636206423101e-01   -5.080820236098607e-01   -4.908050996334286e-02; -3.357832499193573e-01   -2.663504378269389e-01   -4.366856961434980e-02   -8.016118174015505e-02   -8.947550440050575e-02   -3.710437763170464e-03   +4.524208452154544e-01   -6.954161874494860e-01; +3.167072294574324e-01   -8.324468588374656e-01   -3.849815557054729e-01   +1.243465326759383e-01   -8.660986740840309e-01   -4.995010097384883e-01   -7.996730305921779e-01   +1.249331018906213e-02];
L2I_L3I_iGABA_netcon = [+1.758220366231277e-01   -3.637489693376644e-01   +6.124835703296458e-03   -6.253261468368230e-01   +5.562921138755126e-01   -7.240716834016540e-02   -5.403376142267406e-01   +6.219667071675226e-01; -4.083429088725627e-01   +6.612133220565515e-02   +2.648160145528261e-01   -3.491492351846513e-01   -9.123487547829422e-02   +2.365012085466287e-01   -9.105145455121173e-01   +2.324989993426562e-01; -3.098794851924676e-01   -1.258222979619418e-01   -4.911734697715602e-01   +1.196802440643487e-01   +3.973266516573577e-02   -2.596632610882271e-01   +5.294422495189260e-01   +7.594748170664923e-01; -2.891613680946692e-01   -3.101715206411401e-03   -3.213118786791040e-01   +1.276124126804576e-01   +2.662911251925630e-02   -1.068344384307369e-01   +5.370888740866003e-01   -8.711020042105901e-01; +4.302889635623994e-01   +2.714213274681806e-02   -4.067497371031406e-01   -2.360679213567910e-02   +3.671572641178985e-01   -3.215246692092854e-01   +1.011885431910287e-01   -1.442760774214923e-01; +5.271019164077865e-01   -1.610710290887152e-01   +7.445335810896783e-01   -2.243706602723211e-01   -1.759210103718410e-01   +4.858399974648462e-01   -2.901854897129311e-01   -1.333046203177180e-01; -4.763582195734295e-01   +3.228240381365229e-01   +1.839854857664535e-01   +3.866943623672138e-01   +2.644794917525933e-02   -1.883678189313805e-02   +3.429000858792528e-01   -1.061353297518592e-01; -1.000000000000000e+00   +4.933945728615045e-02   +2.693911906133846e-01   -4.477961553743900e-02   +3.882820942549513e-01   -3.935324615941230e-01   -4.149476146301084e-01   +2.783121628063356e-01; -6.240530018499316e-01   +3.328325921383333e-02   -3.680789415877698e-01   +1.597405127478086e-01   +2.209037568901860e-01   -2.108325429654699e-01   -1.372525789836780e-01   -3.239216852582356e-01; -3.765931166949865e-01   -2.923983506155829e-01   +5.513391301912017e-01   +1.937206949176985e-01   +4.415380632463447e-01   -6.434984048470520e-01   -2.885422909820053e-01   +6.718072277642402e-01; +4.955736662824402e-01   -3.497266397544923e-01   +5.348395477883071e-01   +1.009284420743179e-02   +8.076242756434013e-02   +1.857470108207577e-01   -2.115019012652366e-01   -1.025548824858838e-01; -3.422727343155113e-01   -1.812753199511562e-01   -4.790992631415462e-01   +5.896822566513008e-01   -8.668395650801944e-01   -4.262808582193924e-02   -4.015605027834367e-01   -4.383543199174836e-01];
L3I_L3E_iAMPA_netcon = [-2.416444870227990e-01   -5.728387173995804e-02   +6.603333342074166e-01   -1.527327336416653e-01   +1.886863082935876e-01   +1.450248856479583e-01   -1.070284114849102e-01   +3.107593289537477e-01   +1.439376289713375e-01   +6.699971162331855e-01   +1.775678986370185e-01   -1.339852958135368e-01; +7.489610229352452e-01   -1.399234920551929e-01   -6.257674729405946e-01   -6.488199528742450e-01   -1.294837041074776e-01   -1.267543344217610e-01   +5.870496643781665e-01   -6.785342806585358e-01   -5.725415274174411e-01   +1.590698943731680e-01   +6.621300041070019e-02   -4.103483932292297e-01; +3.113321823673128e-01   -7.104631155253566e-01   +5.439342321570918e-01   +4.481777997596622e-01   +1.168738198561699e-01   -8.159350726876996e-01   +2.866160150901740e-01   -4.343311071337452e-01   +2.097673246739522e-01   -3.921776906357515e-01   -7.969086200647660e-02   +3.379897903424137e-01; +4.955857911518288e-01   -3.574624697076482e-03   -5.403886055719581e-01   -5.316506311852817e-01   +5.065680240397527e-02   -6.500630874572821e-01   +6.351768080927994e-01   +7.441124665414331e-01   +2.059997786951594e-01   +5.056280143489336e-01   -3.291643984371502e-01   +6.679698688054554e-01; +1.823934762273229e-01   -5.693730595295043e-01   +2.739082205959282e-01   +2.372595218438425e-01   +1.410387779570039e-01   +3.899212691209379e-01   +1.149433547479922e-01   -5.265770242460751e-02   +3.118499666147927e-01   +1.960387933716986e-01   +4.424367635474481e-01   +9.523713917489308e-02; -3.013018794572007e-01   -3.905258407542870e-01   +2.546320729082707e-01   +6.914248798217099e-01   -7.290714075563728e-02   -2.004274521075267e-02   +1.846531599725669e-01   +2.390573767417298e-01   +3.728115438046170e-01   +1.459147834321581e-01   -1.478813134512270e-01   +1.288578834198839e-01; +1.553262393381816e-01   +6.195481033359702e-01   -1.000000000000000e+00   +3.427565098851302e-01   -5.691694820785662e-01   +4.888906499717204e-01   +5.443921579034509e-01   -2.147073703323395e-02   -3.554245560530042e-01   -2.021070929471794e-01   +4.768699895838029e-01   +4.815885673446121e-01; +2.212340381107944e-01   -4.267695105517039e-01   -5.677172130172311e-01   +2.955340105118907e-01   -1.667361881109116e-01   -4.822344750724803e-03   +6.473218682075729e-01   +6.303342180211079e-01   +4.937605425793099e-02   +1.299161462889868e-02   +7.774530923955300e-01   -9.274227248111467e-01; -4.453460218692690e-01   +3.073002659936520e-01   -3.406494324539607e-01   -4.336739625556977e-01   +8.455507867339895e-02   +5.047952679264371e-01   +4.984021556057423e-02   -7.658416438749327e-01   -2.436863859507746e-01   +7.116453359865728e-03   -2.019274846989432e-01   +4.065368202246272e-01; -7.360400704014216e-01   -4.855227146575649e-01   +7.585049398152266e-01   +5.415472661555604e-02   +1.032163641331467e-01   -1.801156339821252e-01   -4.728125742007820e-01   +2.128558149726273e-01   -1.718424314999706e-01   +1.928600843985474e-01   -1.820447377284928e-01   +6.007459544462179e-01; -4.038060902047046e-01   +1.065660689802268e-01   -5.685359264333358e-01   -9.735297903664633e-02   +2.584977512934675e-01   -1.325107404127008e-01   +5.252651077866071e-01   +4.342772938192095e-01   +4.073038181545446e-03   -1.234696165015326e-01   -9.504069910979328e-02   +6.828219642280191e-01; +5.343517178630253e-01   +5.159347247691410e-01   +9.105802360425659e-02   +3.165792750431102e-01   +7.893612167753413e-01   -1.233889095161384e-01   -1.639496083692482e-01   -8.469932918688733e-01   -7.956813672881496e-01   +6.850022274392400e-01   -2.462328427952575e-01   +4.115996022886028e-01];
L3E_L3I_iGABA_netcon = [+7.678128082391483e-01   +4.562099120992913e-01   +2.992719164594471e-01   -1.010569725754549e-01   -5.226491862038697e-01   +3.781869397178886e-01   +3.708869264817296e-01   +9.125379423919452e-01   -7.377877973610076e-01   -8.803544460327149e-02   +3.573383815909704e-01   -6.558415234861058e-01; -1.575967845098532e-01   +5.151842004365209e-01   +2.134268353059803e-01   +6.367970100865271e-01   -3.232923547272080e-01   +1.527611377333147e-01   +1.790024918720048e-01   +2.604738266500790e-01   +6.185169385487489e-01   +3.301866223742503e-01   +3.178080041654820e-01   -2.155521043879394e-01; +9.160683690657810e-02   +3.441787673470510e-01   +2.781685468635528e-01   -6.597325283681111e-01   -8.783662274063617e-01   +3.931161593697343e-01   +1.252172672995547e-01   +5.172372097293225e-01   +5.239138310993651e-01   -1.256571615544669e-01   -9.442740745109751e-01   -5.123977778713648e-01; -5.483546889902078e-01   +5.930167378311982e-01   +6.373698404703749e-01   +4.530290382535133e-01   -3.734365431923362e-02   +5.178729250801224e-01   -3.745963909585168e-01   -1.901770096911122e-01   +8.413653951168594e-02   -6.591619676075442e-01   -3.493863230730155e-02   +5.424771991033646e-03; +1.223890009816430e-01   +4.593116313963556e-01   -3.867539113672448e-01   +6.476304413302414e-02   +1.638985392208584e-01   +7.047201394408235e-01   -6.559338780317771e-01   -2.089008332752261e-01   -1.186012808947507e-01   +7.239321396387117e-01   +6.064446080462458e-01   -3.434105974466289e-01; +3.148404750987877e-01   +6.662342545234078e-01   -8.401041428042286e-01   +2.592769030858006e-01   -1.479262111786366e-01   +7.162910183233943e-01   +4.192379669467708e-01   -4.036556783097572e-01   +5.802886557877920e-01   -4.782423527908765e-02   -3.478266648261135e-01   -3.699383745018771e-01; +1.930992895376249e-01   -9.080295879205662e-02   +5.646952357165202e-02   -1.896890867839542e-01   -3.153397758050975e-02   +1.120229909895508e-01   -2.566314678380348e-01   +8.630787861331907e-01   +6.394686001830548e-01   +4.953827444682821e-01   +3.321703228704396e-01   +1.833187582681376e-03; -3.773746124958999e-01   -3.646093469753338e-01   +5.304482971613368e-01   +2.638640518719206e-01   +9.987681187502131e-01   +5.707018471903551e-01   -9.608402203970676e-03   +2.583918164497074e-01   +1.368113801453714e-01   +1.000000000000000e+00   -4.889427810877704e-01   +4.645430860104092e-01; -8.942209724941234e-01   +1.323476801122172e-01   +4.178104336057926e-01   +6.503231714308563e-01   +5.342561306438803e-01   +1.546078532202416e-01   +2.350014596131948e-01   -1.142508979140328e-01   -2.224467919186053e-01   +3.983259045415685e-01   +1.506760874941494e-01   -2.044965610497917e-01; +7.801941472381865e-02   +1.115297625287462e-01   +6.880355097232553e-01   +8.038297741106124e-01   +5.010432977063998e-01   -5.334877964302570e-01   +5.339005056671054e-03   -9.857498931233948e-02   +5.603120614224062e-02   +5.416729577679767e-01   -8.357375670039659e-03   -3.312443411273221e-01; +7.486531437494787e-01   +3.769147497930824e-01   +2.470285780249113e-01   +6.520259738342410e-01   -3.036985441138018e-01   -8.530019300765640e-02   +2.578621508150676e-02   +4.920879026452191e-01   +5.901094664301142e-02   -2.351935869094152e-02   -6.784456409055590e-01   -5.671783604070890e-01; -7.358686577699325e-01   -4.182770680742233e-01   +1.380184130444186e-03   -6.843727800815349e-01   +6.724622604416053e-02   -3.649219796495802e-01   +6.436070867088505e-01   -1.122114500470991e-01   +4.390407277949144e-01   +7.331670950957223e-01   +1.312787372782032e-02   +2.265849949888616e-02];
L2E_Input1_iAMPA_netcon = [+7.038601207834229e-02   +3.613291488388127e-01   +4.628436737383888e-02   +2.633119421429986e-02   -1.000000000000000e+00   -1.293778630372067e-01   -1.580331075516512e-01   +3.757807501479433e-02];
L2I_Input2_iAMPA_netcon = [+1.000000000000000e+00   -1.102641219457508e-01   +4.955129176765120e-01   -5.828886148460952e-01   +6.769148531673822e-01   -3.820668482648284e-01   -7.044800657691824e-01   -4.317923321649855e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last =  11.21 * ones(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))*0.4 + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.5*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.5*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))*0.9 + 0.5*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))*0.4 + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.5*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.5*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))*0.9 + 0.5*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
