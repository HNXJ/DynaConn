function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+5.233124086581704e-02   +6.336885780737139e-02   +5.694218048217416e-02   +1.009330861040851e-02   +5.394768454006484e-02   -3.361889315272738e-03   -2.123344607383010e-04   -1.842330019969390e-02   -2.624289508674903e-02   +3.395029183670507e-02   +2.843067781043163e-02   -7.019486730550528e-03   -2.332202406059659e-02   +2.672125328028932e-02   +4.381015347479543e-02   +3.697299908339497e-03; -1.216940921741074e-02   +5.176189823777462e-02   +9.904179704719379e-02   +2.019302158159848e-02   +8.674199005557782e-03   -5.052717604367689e-02   +7.247417756975419e-02   +4.135350486102636e-02   +2.761771672853931e-02   -4.981949210713526e-02   -1.592614394886632e-02   -7.278479532491628e-03   -7.037118899366956e-02   -1.110556879416687e-02   -9.667180283964855e-02   +1.350287713670761e-02; +2.204877508938969e-02   +3.735718280049338e-02   -9.706996174620909e-03   +8.339452372115065e-02   +2.138685765639023e-02   +9.431909538234654e-03   +3.358498984641792e-02   -4.413953692938109e-02   -1.692776405773963e-02   +5.952595053048325e-02   +4.101158537476019e-02   +2.702010971915218e-03   -4.482181647054684e-02   +4.567754801366582e-02   -5.979075989799592e-02   +1.293076671925845e-02; +2.339540251553383e-02   +4.860351948851009e-02   -2.808878849075525e-02   -3.920282645696399e-02   -1.635635349149622e-03   -6.007666421026961e-02   -2.892174980896433e-02   -5.958287885266013e-02   -2.984205484174484e-03   +7.761678634732140e-02   +4.647760101326837e-02   +1.722823747747468e-02   -1.547901783023710e-02   -3.776466178373206e-02   +1.300313005413152e-01   -8.399521508948765e-02; -6.111787938926606e-02   +4.541738633633392e-02   -4.719523034421828e-02   -3.106930847987367e-02   +7.213602531001392e-02   -1.717610329126510e-03   +3.584947188937130e-02   +3.041460210224709e-02   -7.068899789628959e-03   -1.704254683887875e-02   -3.819544401053453e-02   -2.845782288247234e-02   +7.182838434369970e-02   -3.498356020607107e-02   +3.037049561421793e-02   -5.503511321548886e-02; +2.082714066853092e-03   +1.941074437325896e-02   +6.476468097065673e-02   -3.047338112927260e-02   -5.179446719090232e-02   +2.192231859986267e-02   -3.921398555373684e-02   -3.644019350140129e-02   -2.035071317158096e-02   -5.403188149075708e-02   -3.978787650305607e-02   +7.157841688861380e-02   +4.997990364024218e-02   +2.509726565121007e-02   -2.525981892849507e-03   -3.651243582720465e-02; +1.617761928954711e-02   -3.367743258249346e-02   -1.225109401659731e-02   -1.417814243682572e-02   -8.360269945317780e-02   -6.069882281449566e-02   -1.126741728901381e-03   +5.491681121163436e-02   -4.158314053588622e-02   +3.445217618592151e-02   +1.628633671979411e-02   +6.951183951184194e-02   +5.139186761475550e-02   +1.421221328592296e-02   +1.219806630606930e-02   -3.611359719781444e-02; -1.875149250867190e-02   -2.857945736847877e-02   +2.318965958375312e-02   +1.002478945514489e-02   -4.677435094339248e-02   -5.121259507278135e-02   +4.955275847531670e-02   -2.408898479700986e-02   +1.455813390765292e-02   -2.327666499230915e-02   -8.116467515315459e-03   -1.784578616562419e-02   -4.390803278274173e-02   +8.132448526281056e-03   +4.003789616066725e-02   +6.407051878578290e-02; +3.158416818514748e-02   +6.348177585589521e-03   -1.756976659866709e-02   -4.293926073933717e-02   +1.116467404329935e-02   -1.003466658719920e-02   -1.965973433637151e-02   +9.825129029202670e-02   +3.840691293328217e-02   +5.470531787111280e-02   -1.537239764056045e-02   -1.014710064110380e-02   -2.627208393136776e-02   -5.768208080839903e-02   +6.671525630323830e-02   +9.500811867987690e-03; -1.463758549913406e-02   -5.402826741623652e-02   +2.568332873064322e-03   -5.233675687977665e-02   +3.881044122091151e-02   +4.293610060004060e-02   -5.548881719065218e-02   +6.791750659195131e-02   +1.066050913755682e-02   -1.300574727741259e-02   -1.868208919174339e-02   -5.346739470724815e-02   +5.618353973028577e-03   +2.956337241853816e-02   -4.721744475962967e-02   +5.873638378771706e-03; +3.309387933262364e-02   -4.852568411231790e-02   +1.172250097294536e-02   -5.796475347328933e-02   -8.456739499920291e-02   +1.355774080515466e-02   -2.522045267792512e-02   +6.197283043330921e-02   +1.455394782038637e-02   +1.025441016362761e-01   -2.649973150824256e-03   -2.506335912203543e-02   -1.077507663161569e-02   +7.559280604734639e-02   -1.302837286915499e-04   +4.222528340254046e-02; +5.545668406810857e-02   -9.488765990873260e-02   -5.391158096943094e-04   +1.233575260047978e-02   -1.937838998762729e-02   -1.468837433540973e-02   -2.803495071119270e-02   -3.533707506730972e-02   +4.676686728032558e-02   -3.576969856745711e-02   -2.974382737318760e-02   -4.262135013970329e-02   -3.185296836537968e-02   -3.733612584666780e-02   -4.405759262244508e-03   +5.222757226221252e-02; +3.570843559018538e-02   +1.737364488358009e-02   -1.079494120616965e-02   -4.337452912260844e-02   +1.245547156302721e-01   +6.059885102011218e-02   +7.238825068598793e-03   +4.776999029520390e-02   -4.242392737360148e-02   +1.244816068987366e-02   -8.308823304038546e-02   -4.532264514613277e-02   +3.464727969642030e-03   +7.005027508288524e-02   -4.302980011229082e-02   -1.592622805613593e-03; +2.074987922737465e-02   -3.417714851955082e-03   -3.461803756141085e-02   +5.462697195837259e-02   +6.692775383514608e-02   +6.373876304192368e-02   -3.991099223414055e-02   -4.704525593828683e-03   -1.401340194391768e-02   -3.832303736403281e-02   -2.060803806052631e-02   -1.964847874102696e-02   +3.834554689771610e-02   +1.474367470579386e-02   -3.642559076442078e-02   +5.041138164487469e-02; -3.408579650275233e-02   +7.521041041096859e-03   -1.930695016437046e-02   -4.952734678625235e-02   -3.634332448796646e-02   +1.522192068058909e-02   -2.688560160590976e-03   +1.207542380526219e-01   +3.357745603152924e-02   +2.477132218106846e-02   -7.844800318652613e-02   -1.294855290802010e-02   -2.872365615026766e-03   -2.188898086033490e-02   +6.125802003917030e-03   -1.836418254300424e-02; +3.328009718685356e-02   -1.100152198766047e-02   +6.382808881642738e-03   +4.239017927234773e-02   +4.428843319594543e-02   +4.834717974729475e-02   +8.908376759544191e-03   -4.794721789767635e-02   +1.103050597814758e-02   +4.684461053652409e-02   +7.150333317522579e-02   +9.248505171544336e-02   -1.320401596613524e-01   +1.415514928568512e-02   +3.690418302020275e-02   -3.431586598129301e-02];
L1E_L1I_iGABA_netcon = [+3.130897864017969e-02   +4.020310413530004e-02   -5.154308990201630e-02   -4.920022145206995e-02   +3.917092512848122e-02   +2.053730619165810e-02   -8.957966298586412e-02   +1.190907173374784e-02   -4.844802821163673e-02   +1.102649457881014e-01   +6.849045907825783e-03   -1.519975357534353e-02   -4.613266691922470e-02   -9.419722151802404e-02   +3.404795785926158e-02   +1.232501907405538e-02; -2.118205581728545e-02   +2.079976803222665e-02   -1.539246974686774e-02   +7.407439591018486e-02   -7.327018768875882e-03   -1.557965252440756e-02   +3.232056446311044e-02   -1.735534778953068e-02   +2.561777908168130e-03   -3.063568139739795e-03   -8.520645224102116e-02   +5.153668853378686e-02   -6.870180661949275e-02   +3.978553157698116e-03   -4.890134425870465e-02   -1.837928358772370e-02; -5.392487374158397e-02   +1.186439852562303e-02   +9.437320246089498e-02   -4.306408824488184e-02   -3.542677725567989e-02   +1.598286377395993e-02   +3.634056776040780e-02   +4.890537173445540e-02   +1.697069256656338e-02   -9.848309995456796e-05   +1.989578759362746e-02   +5.827983008100561e-02   +5.495694859784558e-03   +6.153966969468349e-02   -2.460562354847033e-02   +1.630765181347917e-02; +2.348270977935746e-02   -2.009821523910221e-02   -1.492060720519700e-02   +1.955006653649027e-02   +6.123786458293336e-02   +9.626174639672408e-02   -2.988016350021022e-02   +2.161452878685055e-02   -2.754874381382954e-02   +8.196687030906476e-03   +5.251410110852338e-04   -2.675744983334647e-03   +1.429778154294528e-02   +5.651168415191286e-02   -2.430914433438212e-02   +3.871115493321955e-02; +1.040408791778282e-01   +8.296559900843498e-02   +1.078861653594659e-02   -4.914419024957797e-02   -3.124760068534182e-02   +4.536042032410448e-02   -8.456904847579139e-02   +9.632266501877498e-03   -3.323220840105947e-02   -1.852743266895334e-02   +4.022596919862891e-02   +4.372087769301376e-02   +5.680069165849486e-03   -7.777202783977931e-02   +5.906291063549464e-02   +7.213901997432555e-02; -3.267060291344680e-02   +7.916644369655267e-02   -9.248400640040041e-02   -1.217940856990874e-02   -6.583906146881410e-04   +7.081136360196383e-02   -1.301179565781439e-03   -4.686533544297513e-02   -6.482253108901131e-03   +2.858831496475045e-02   -1.070716826178090e-01   +3.374433800296423e-02   +3.663601748757019e-02   -2.833200929211412e-02   -1.524891215757230e-02   +2.913294605556268e-02; +2.911882601850123e-02   +3.667936608243163e-02   +1.214857513745727e-01   -3.321045441255339e-02   -4.341646184532477e-04   +2.746490890409792e-02   -2.065640230911348e-03   +5.345218107890937e-02   +3.753497167194654e-02   +6.775910740725372e-02   +3.006746822479434e-02   -2.117131868648637e-02   +7.149080581799409e-02   -5.317181501127830e-02   -2.531696614394129e-02   +4.458629216332680e-02; +5.271623621838072e-02   -1.760004509568736e-02   +4.398492253654879e-02   +6.593737820861352e-03   -5.466876965239906e-03   -1.595619541917086e-02   -4.082264159102174e-02   +2.836018104592801e-02   +3.269350439634396e-02   +1.203356490320269e-02   -6.973838793875380e-02   -6.122162315181333e-03   +9.837223359680923e-03   +6.549878472873258e-03   +4.472780560714831e-02   -2.082933803402129e-02; +4.911426128929638e-02   +2.661177687281309e-02   -2.613074543660236e-02   -3.404533336318818e-02   +4.228731892248510e-02   +2.796786992300417e-02   -3.727738450093528e-02   +8.810597291601077e-02   +6.224033719438117e-02   -4.245508462644153e-02   -3.153113259247808e-02   +7.736896183003725e-02   +7.661319541867119e-02   +6.500196342876290e-02   -3.789805244565156e-02   +6.901670965424742e-02; +6.989799515108193e-02   +1.350424756488417e-02   +4.192561551274633e-02   +2.702843768669808e-02   -3.551521937533399e-02   +6.210159729885665e-02   +6.381391090842861e-02   -3.359879154852286e-02   -9.536792015866984e-02   +1.201055547579742e-02   -3.848013219979719e-02   +9.330933805825409e-03   +9.470886370791878e-02   +5.674773943822217e-02   -7.498968174583942e-02   +1.434391624973671e-02; -2.758375320480053e-03   +7.294916661517953e-02   -6.229400835434456e-02   +5.204060023611749e-02   -4.523278239552687e-02   +4.330775871561829e-02   +1.220596102031467e-02   +2.521083744449443e-02   +1.268095418700499e-02   -3.879799266475394e-02   +1.454929472140436e-02   +2.176076176513333e-02   +3.398073881652509e-04   +3.874104482054123e-02   +3.175419882881403e-02   +8.444163870669559e-02; -1.268497851700384e-02   -8.014795361645376e-02   +1.335079504450496e-01   +6.399704914581783e-02   -7.900830602075326e-02   +3.943838089991041e-02   -3.756096427513873e-02   -5.573617266312979e-02   -6.767335583626670e-02   -2.235924153255961e-02   +4.140567353354248e-02   +9.183535901654116e-03   +2.455517623442784e-02   +4.816711669823439e-03   -3.457013975214786e-02   -2.892297861073623e-02; -4.449521917134099e-02   -4.298234921445561e-02   -3.101222520806789e-02   +2.413117003185613e-02   +4.451182017049091e-02   +5.193037633697459e-02   +5.644714819856612e-02   -5.540320478722226e-02   -5.766901672001494e-02   +3.145092947361456e-02   +3.235780946673168e-02   -1.791005854832152e-02   +7.199299440434899e-02   +1.033568654043056e-01   +5.492812744203309e-03   +3.354582570295069e-02; +3.993557982591173e-02   -2.617527388090351e-03   +3.767790660352864e-02   +8.818978462256740e-03   -8.411362530640032e-02   -1.672634086616484e-02   -1.748621503273859e-02   -7.791873614418984e-02   -8.095540181440596e-02   -2.673283532763447e-02   -9.670762293366365e-03   -6.408744399521203e-02   -4.082330313803360e-02   +9.811071446079081e-02   -1.625454241967472e-02   -4.093392480997082e-02; -2.778937934008555e-02   +5.053509064814865e-02   -3.249558069658771e-02   +3.260844401417028e-02   +1.898636056408917e-02   -3.223346787580599e-02   -1.782347944157736e-02   +4.500322010685675e-02   +1.873504797314337e-02   +9.785382255363063e-02   +3.691158967573428e-02   +2.255433063579330e-02   -1.904348332010136e-02   -5.760282098632935e-02   -5.067909647890863e-02   -2.348034736587394e-02; +4.112550647329447e-02   +8.097618537216288e-02   +3.394730646486518e-02   +3.098143817998786e-02   -5.374441468571592e-02   +5.461846440899637e-02   -7.789101646977323e-03   +5.642409133049810e-02   +4.381835048596146e-02   +3.496095626614128e-02   -9.697440535274600e-02   -3.197145195864384e-02   +1.154290309413687e-01   +4.260417087730230e-02   -2.451905349433776e-02   +2.583284056023429e-02];
L2I_L1I_iGABA_netcon = [+7.811786956379584e-02   -1.278888600292283e-03   +6.297416582594261e-03   +2.296259392923581e-02   +5.241077472680297e-02   +1.094893432648492e-01   -4.625177292319545e-02   +1.346668869686025e-02; -1.814456882719280e-02   -7.161544709527948e-02   -2.820380414813482e-02   +1.414205274657118e-02   -4.161487136459404e-02   -2.957861873665178e-02   -4.999580013946466e-03   +1.106993713260317e-01; -4.288694410277835e-02   -2.680704425372934e-02   -5.327270473305060e-02   -3.981434269538744e-02   +3.329309096125310e-02   +2.636581977205498e-02   -1.515930823013947e-02   +6.856976556000942e-03; +5.104042363285022e-02   +3.932583146976205e-03   -1.251549561424337e-02   +8.394105394778162e-03   -3.949850341176403e-02   +2.779076406439514e-02   -3.778414438592197e-02   -4.849329836011944e-02; +2.015169455590387e-03   -2.670281925013621e-03   +8.518085017180613e-02   +1.655320444020525e-02   +5.265932615773993e-02   +2.109847387811404e-02   +7.113708606505038e-02   -4.789303889537622e-02; +3.586861469379542e-03   -2.393053297848932e-03   +1.956806865306551e-02   +3.158694101304312e-02   -1.201581283137350e-01   -1.031211315756787e-02   +1.799709078196226e-02   +4.181758802742949e-02; -9.077969780529261e-03   -7.886815422612155e-02   -3.455532069227772e-02   +4.376939844625023e-02   -3.041640242152734e-03   +5.258214985105276e-02   +2.721710665397300e-02   -4.702182100045035e-02; +5.846336705975848e-02   +9.499043852151291e-03   +6.294122614826023e-02   +5.933556969903358e-02   -5.827292333272477e-03   -5.914282156203470e-02   -8.438042048592576e-02   +5.041523512509988e-02; -5.778205832165033e-03   +2.962340791982859e-02   +8.996826097833650e-04   +2.005893654218158e-02   +4.647770220327527e-02   +5.016884409488852e-02   -1.369093757075542e-02   -1.833476966806151e-02; -2.608057863392248e-02   -4.957228142970746e-03   -5.348940799382693e-02   -7.726592644765293e-02   -4.270343529506410e-02   -5.683100828173006e-03   -9.780752849193709e-03   -2.843512647325772e-02; -3.700628472082004e-02   -4.996447942262684e-03   +3.027993553199205e-02   -2.165867680687468e-02   -3.956163359213833e-02   +4.811697190284361e-03   -3.357277833130497e-02   +6.929930293828047e-02; -1.439584210823129e-02   +2.318952925510284e-02   -9.769965246231697e-03   +6.574065602522623e-02   -8.015759845581838e-03   +2.225074441431465e-03   -2.603588270063549e-02   -5.816266453419506e-02; -2.044590352014301e-02   +5.098383246152103e-02   -1.095772655824603e-01   -1.271525282197413e-02   +7.127912036237030e-02   +1.287918663664680e-02   +1.674945369833156e-02   +3.066343186488428e-02; -1.844941371504618e-02   +2.393501680603479e-02   +5.939379956102196e-02   +5.204434566548496e-02   -6.465142983886628e-02   -7.834912525080662e-02   -4.047303301658958e-02   -3.458925649420873e-02; -3.803355654604222e-02   +1.105611751597207e-03   +3.877428774447326e-02   +1.934441276029139e-02   +3.933897082678391e-02   +1.786169712085436e-02   -1.806350733006439e-02   +1.827025732718220e-02; -2.295326350750917e-02   +3.151255124940981e-02   +1.392235916438713e-02   -2.918613996990325e-02   +7.160278556728379e-02   +5.291260765674309e-03   -1.475232312572674e-02   -4.605750983052915e-02];
L1I_L2I_iGABA_netcon = [-4.641952461332827e-02   -6.568175240774092e-02   +3.363551260904896e-02   -9.988509946328362e-03   +4.812810414798663e-02   -3.771853347016160e-02   -6.655342440661759e-03   -3.568276823498526e-02   +6.639851539778151e-02   -1.841187278211467e-02   -9.073432243650681e-02   -6.454081640279337e-02   +2.065403503773089e-02   -1.307289497692695e-02   +3.521204008571434e-02   +7.330708630488185e-02; -2.194570699811786e-02   +9.884521180653007e-02   -1.764849765041080e-02   +2.955225680941412e-02   -2.924321508663966e-02   -8.600104836321854e-02   +6.755988945151652e-02   -3.990098686222297e-02   +3.888272536556844e-02   -6.085693650814326e-02   -2.384099422938862e-02   -2.731091929494331e-02   +4.719726299032571e-02   +4.971323596752878e-02   -3.529112982766860e-02   -6.519615368198900e-02; +2.882952542335020e-02   -2.155030787812477e-03   -1.814338965902675e-02   +4.407598092828493e-02   +1.239551196005396e-02   -7.317361748732792e-02   -2.567583578857992e-02   +6.509175208657758e-02   +4.672231143342752e-02   +4.142614703022197e-02   -1.971336208799297e-02   +2.496427519055136e-02   +1.142125975377021e-02   -4.819999078405442e-02   +2.112639781249976e-02   +4.004555302648365e-02; -2.563981295806013e-02   -4.442084373598205e-02   +3.308801966102545e-02   -2.985901246574375e-02   +2.561076854280458e-03   +1.821446316516977e-03   -3.896317822919517e-02   -4.534561310534081e-02   -5.645458565116492e-02   -3.331334114232598e-02   -3.954192190085436e-02   +5.741887435861038e-02   +1.226418059352550e-02   -1.070914496082002e-02   +4.444244593481046e-02   +2.614742505227191e-02; +6.929854752140052e-02   +7.551088393741459e-03   +3.285747557232688e-02   -9.212550256913105e-02   -1.829405695374984e-02   -4.274632825545801e-03   -1.335205520492069e-02   +4.235954782553322e-02   +6.570331394369980e-02   +1.954888008422647e-02   -7.535178532034671e-02   -1.893232151556325e-02   +6.359713992399259e-02   +1.752724980299421e-03   +2.586518548389416e-02   -6.178851498559804e-02; +2.507361758168716e-02   -3.368898776263257e-03   -5.871328010338333e-03   +3.162323878338961e-02   -9.027402488532471e-02   +1.121883680681330e-01   -2.449506595838193e-02   +3.169607749063028e-02   -1.768633130138259e-02   -6.417457053018852e-02   -2.382377068264483e-02   +1.034005998654283e-01   -6.857097072741403e-03   -2.164352724771317e-02   -6.166721605941175e-02   +1.965702040792083e-02; +7.293721782615565e-03   -2.614427918647349e-02   +2.279600593220137e-02   -1.351339798078272e-02   +5.406564994131839e-02   -3.032214632488365e-03   +6.235313542407236e-03   +1.232064479533464e-02   +5.428564424264451e-02   -4.548027528969214e-03   +1.006071758885685e-01   +1.011765083349264e-02   +3.626091295301403e-02   -7.585392973861816e-03   +1.328533395789445e-02   +1.589434568570942e-02; -8.985446387944858e-02   -1.059750450467323e-04   -7.562548423294291e-02   +1.686487644836843e-02   +9.066780799672169e-03   +1.396997421335156e-02   -6.695141789614710e-02   -1.898821874368377e-02   -6.158569609301127e-02   +4.727799861829508e-02   -4.600669690646805e-02   +7.499008874476205e-02   +2.112006312100862e-02   -3.003280602607148e-02   -3.224418949923748e-02   -6.116453352818266e-02];
L2E_L1E_iAMPA_netcon = [-3.724997981792713e-02   -7.638883308117797e-02   -1.683550425902011e-03   +6.112739598612800e-02   +3.551644994236915e-05   +8.438102045687760e-03   -1.197958702366881e-02   +2.087782994964855e-02; +1.906107445912553e-02   +4.101959123491590e-02   +8.277362849576389e-02   +3.614939391251992e-02   +8.026505226537317e-02   +1.964774338972858e-02   +3.297606987829499e-02   -3.994916817407833e-02; +4.373829324934897e-02   +1.253794741547355e-02   +3.075219681573740e-02   +1.235565193559352e-02   +1.237048862767129e-02   -2.881888348022380e-02   -3.268115539504425e-02   +8.531165295200814e-03; -6.530176093218611e-03   +4.977462924822498e-03   +4.395374338980346e-02   -4.221935540210577e-02   +1.375140103352522e-02   +2.028582629720548e-02   -4.293149420261760e-02   -4.040959821046577e-02; -7.528513007558063e-02   +1.616668737942366e-02   -1.052623440495098e-02   -1.979766891002186e-02   +3.343140190918159e-02   +5.606612484455814e-02   +4.034306195325569e-02   +2.130686075524673e-02; -7.443451479178747e-03   +2.047407473137575e-02   +1.289727414236286e-02   +1.981488524880837e-02   +4.389414129978306e-02   -1.626989200128490e-02   +4.408910111051145e-02   +4.210867276874881e-02; -7.372312877270634e-03   -4.944726504987283e-02   +2.771656524507098e-03   +6.791956061299954e-02   +5.938567214949735e-02   -2.082913154092632e-02   -9.688705364965492e-03   +3.814188464440042e-02; -3.418592116138348e-02   -4.855886804865112e-04   -5.667851914312207e-02   -2.649351881648462e-02   +6.395808292221705e-02   +3.787650791174380e-02   +4.626664948331474e-02   -1.339668295858195e-02; +3.102518478506909e-02   -2.843116137203429e-02   -3.112092087726490e-02   +5.913478513061120e-02   +8.610265749714138e-02   +2.144993109685941e-02   -1.938524142074476e-02   -3.944939453098336e-02; -2.183130674996523e-02   +1.608497549246480e-02   -2.443230876829632e-02   +2.096706345907468e-02   -2.633276311395701e-02   -3.954054409495668e-02   -2.789067775999247e-02   +1.301175327996877e-02; +4.327567959719258e-02   -1.693531687789067e-02   +4.580748702849687e-03   -5.187979848540425e-02   +1.100639198951860e-01   -4.824902475375267e-03   -1.607285630159612e-02   -6.279010072874953e-02; +5.302202643293916e-02   -3.387451533525124e-02   +9.081600663864951e-03   -6.967705582639851e-02   +6.369398746977188e-02   -5.673390841927396e-02   -1.262220341522187e-03   +4.356555844443170e-02; -1.007410945593604e-01   -2.959605077626380e-02   +5.678059109305748e-02   +7.183659529447311e-03   -1.866106532676553e-02   +1.631517258683283e-02   -7.126435127896869e-02   -3.674522903209416e-04; +4.559269734863747e-02   -6.015728320219025e-02   +2.169804801667845e-02   -2.837199784038420e-02   +1.072428813446109e-01   -1.994848589119777e-02   +2.909644284793910e-02   -7.251093217354017e-02; +1.018094651579003e-02   -9.789145744495088e-03   +6.112588313287474e-02   +4.741630234084553e-02   -6.543159143193235e-03   +8.904025862001624e-03   +4.799021957402329e-02   +2.257515493647333e-02; +6.599237980520772e-02   -1.374052627771703e-02   -4.683368072203009e-02   +1.105144120473281e-02   +3.860931949982720e-02   -6.868623829292006e-02   +4.009875980022722e-02   -1.542761294262025e-02];
L1E_L2E_iAMPA_netcon = [-2.376166932358630e-02   -3.796104273516943e-02   -6.617017952327116e-02   +1.170488560485266e-02   +2.125444136215638e-02   -6.383326116091002e-02   +1.370518633768678e-03   +2.979968998870049e-02   +3.020232773415002e-02   +2.605397576886766e-02   -2.036842020814170e-02   +3.985310743503866e-02   +4.357929389196209e-02   -7.393921880444640e-02   -3.131122114211863e-02   +8.754166631081921e-02; -7.021981630849386e-02   -1.966679465846520e-03   +1.316952992265237e-02   -4.672222383295463e-02   -2.369835475214933e-02   +5.191563734655551e-02   -8.456582127675985e-02   +8.041475529891275e-02   +8.464633153913017e-03   +5.737514328376127e-02   +4.876002662291860e-02   +5.909943241029295e-03   +9.803158562098180e-03   -2.515163105266854e-02   +3.543069885359767e-02   +1.106264507795797e-02; -6.570978179617235e-03   -5.332200624719276e-02   -7.067713905263684e-02   +6.826059331128911e-02   +5.461246049728812e-02   -2.413064193885452e-02   -6.337415722182681e-02   -6.467914421522211e-02   +1.810640579570207e-02   +2.230954560443855e-02   +4.325908791291983e-02   +3.589149944027183e-02   -6.704706197711766e-02   +7.820929736312741e-03   +1.542346743390871e-02   +2.670867344215496e-02; -3.538482372864409e-02   -2.744530104279817e-02   +3.392250220896414e-02   +2.788261761801882e-02   -2.169591322940087e-02   +1.205272745231079e-02   -4.627801483093644e-02   +6.781997068390820e-03   +3.022114979206414e-02   +7.856466645128081e-02   +3.466592564703379e-02   +3.074998200428062e-02   -3.614165305246712e-02   -4.388515173197907e-02   +8.396784362861297e-02   -1.702978147911954e-02; -8.591021185442453e-02   -5.500356094572140e-02   +2.061576617173855e-02   -5.189565185854919e-02   -1.252898022604091e-02   +6.135590379348414e-02   +8.753927133985133e-02   +5.784797895668599e-02   +6.627862629015154e-03   +3.063829786498260e-02   +1.883705802872540e-02   +3.590578145910517e-02   +2.753755595137101e-02   +9.074305510627734e-03   -2.643618697133097e-02   +3.891255479393162e-02; +5.042789779415989e-02   +6.711758126214654e-02   -7.748815913610242e-05   -1.217355759423518e-02   -2.237954592192035e-02   +7.666049833824289e-02   +3.539761036664221e-02   -2.954049968016842e-02   +9.375939024955683e-03   +7.572209971207854e-03   +6.425009033354251e-02   -4.296260728671407e-02   -1.067116094849608e-02   -8.727326538502892e-03   +1.808689358498723e-02   -1.558790623739089e-02; -8.083977189393650e-02   +2.757391196164615e-02   +8.543544480694772e-03   -4.815732007742047e-02   +3.365025296002556e-02   -1.788648682282512e-02   -4.044036411711099e-02   -2.797191617921439e-02   -6.007373801050649e-02   +2.855861694941081e-03   -8.560118878545246e-02   +2.226335007074234e-02   +2.647894321013188e-02   -4.413040643113346e-02   -1.244210239699508e-02   -1.046441599287392e-02; -4.070065463849263e-02   +1.772826113377457e-02   -1.150409826269038e-02   +4.209553401785124e-02   +5.105086907473636e-03   +6.308905984741628e-02   +9.471370818877108e-02   +6.182891172794927e-03   +2.310241719096086e-03   -2.425811231218711e-02   -3.295246161124666e-03   +5.192440993397904e-02   -5.330857653804709e-02   -2.885506868230858e-02   -1.466416859844620e-02   -1.289825084695990e-02];
L2I_L2E_iAMPA_netcon = [+2.865734470273778e-02   -2.275911452914826e-02   +8.610952957295860e-02   +5.737973903279992e-02   +2.079952496174810e-02   +2.244754539132834e-03   -2.526945781252812e-02   -2.138184772947772e-02; +3.196213768599940e-02   -8.794638203509751e-03   -1.895162587950853e-02   +3.222751619459287e-02   +3.451051701488356e-02   -1.694521124199798e-02   +2.040813237440156e-02   -1.776116456828485e-02; +2.745302462581915e-02   -8.570255016484302e-03   -7.634367150068707e-03   -8.943883452679267e-03   -4.224599224788336e-02   -5.375596588578949e-02   -5.394364133416180e-02   -3.754129182410323e-02; +4.619265368697959e-02   -2.681799539259924e-02   -8.839972812124293e-02   +1.594036261846864e-02   -2.727726944618801e-02   -2.995788298489368e-02   -3.416359928278973e-02   +2.691076286611224e-02; +5.423841817743628e-02   +1.535110505136804e-02   -2.717764523447331e-02   -2.454974310435705e-02   +1.515165037727593e-02   +5.011134373715542e-02   -9.294422928626003e-03   -1.270980208780892e-02; +8.452624939920940e-03   -4.419790630688058e-03   +3.956521871364074e-02   -8.050910183359193e-02   -2.014491250118281e-02   -1.458683856255885e-02   +4.126218836200996e-02   +1.015055805132111e-03; -2.425276394516870e-02   +1.313171440122122e-02   -3.922387300408403e-02   +5.013812592838792e-02   -1.803100937995239e-02   -2.330894544594789e-02   +2.312495124095825e-02   +2.457355185533205e-02; -5.785510386465784e-02   -3.119785367811633e-02   +3.829958345064598e-02   +5.304357101418704e-03   -6.685416325853203e-03   -3.428798549917915e-02   +2.728002773366628e-02   -3.281988715808126e-02];
L2E_L2I_iGABA_netcon = [-1.848308974344076e-02   -3.539648733600551e-02   -1.388340313989554e-03   +4.046831640844101e-02   +3.833137267380705e-03   +9.618158800654776e-02   -2.315162433185497e-02   -4.131562799009244e-02; +6.887655190650484e-02   +4.699779701073295e-02   +5.213018379815476e-02   -5.149880272374623e-02   +6.837438443077283e-02   -8.012436765094358e-02   +8.567048616876574e-02   +9.992140215629995e-03; +4.218246728215310e-02   -6.836118937859531e-02   -6.184299393153405e-03   +2.283538141781966e-02   -2.683014284817086e-03   +6.408194659593618e-02   -2.062326259222663e-02   -9.023271347917364e-02; +1.390240398393714e-02   +8.492764352665515e-03   +3.644760678412408e-02   -2.630748101924080e-02   -5.801564749828417e-02   -5.042429705976022e-03   +4.632824150935995e-02   -8.118564409380206e-02; +7.540483156327779e-03   -7.580745966517341e-02   -3.481518146061744e-02   -5.410311295082040e-02   +3.214945103705698e-02   -4.183935132840581e-03   +5.080755237611816e-02   +6.681303934732394e-02; +6.342457394519650e-02   -6.432930438228543e-02   +2.062955741711825e-02   +6.772790824194218e-02   -7.565917846631921e-02   +9.563651291828273e-03   +4.049690809885487e-02   -7.066723218883781e-04; +1.993466045350792e-03   -5.459908977765978e-02   +5.045580310762762e-02   +4.526447168010301e-02   -1.427428741226502e-02   +1.997241449058179e-02   -7.284878215698201e-03   +2.197336356310304e-02; -2.734447130944436e-02   +7.377481460768954e-03   -4.180833953520494e-04   -5.068315772434044e-03   +5.207167320431041e-02   -1.119234970601294e-02   -3.079174058445065e-02   -5.711614744610622e-02];
L3E_L2E_iAMPA_netcon = [-9.568682903589337e-03   +5.624214112896938e-03   -6.235557916878483e-02   -5.955650675695304e-02   -3.355517602618094e-02   +3.427744219785225e-02   -3.498363612679521e-02   +1.403101684200416e-02   -1.509461148274187e-02   +1.325257859193523e-02   -7.733958606588696e-02   -1.712321437241363e-02; -3.436840626057115e-03   +3.772949304036744e-03   -8.306795368378200e-02   +7.591425802719826e-02   -3.501549619967913e-02   -5.187955497502145e-02   +4.244417164590199e-03   -8.565950512001037e-02   -3.002549900645885e-02   -3.071449247491797e-02   -3.462908502728881e-02   -2.423082116688211e-03; +7.139430008802082e-02   +7.536801578259519e-02   +2.237997815833301e-02   -8.860259356695757e-04   +6.018565290963306e-02   -1.312681960025699e-02   +7.559075675072849e-02   +3.302245376691357e-02   +4.702480372080226e-02   +4.423456452852675e-02   +8.360508852632563e-03   -1.217593240335712e-02; -2.827586662539251e-02   +4.638466904306264e-02   -1.768036450450495e-02   -1.667273657468211e-02   +4.821797979544504e-02   -8.768442322846563e-03   -6.138133087629820e-02   +7.250979639997474e-02   -4.546328341743390e-02   +7.421397120442796e-03   +1.317231889694330e-02   +1.607213835090762e-02; -2.080545017010332e-02   -4.936968619651852e-02   +1.188843970331963e-01   +2.518296188806683e-03   +3.044041240957753e-02   -6.957334209948840e-03   -4.196729668890314e-02   -6.513384018838200e-02   -1.589529096209067e-02   -6.663308907414614e-02   +3.336544638955349e-02   -8.725466175279153e-02; -4.656686248931728e-02   +6.444351162728684e-03   +1.333107714537905e-02   -4.617759911562337e-02   +4.065923734680994e-02   +3.488186839478687e-02   -2.995888103890623e-02   -2.486908740929835e-02   +4.092440315478992e-02   +2.948396051210137e-02   -8.280701056774989e-02   -2.251067575042422e-02; -3.755734565195962e-02   +1.171039382608703e-03   +2.671298760956716e-02   +2.710867710383222e-02   +3.600006531313078e-03   +8.148202052261872e-03   +9.095764667722665e-02   +5.455883724027085e-02   +1.179664045354489e-01   +7.219802205120501e-02   +7.924281481406333e-02   +7.624925354614868e-02; +8.255509408614244e-03   +5.299678233470838e-02   -5.733782639304545e-02   +6.691539749537452e-02   -8.617085601175068e-03   -2.346139862644935e-03   -5.485798369719463e-03   -9.128303210136540e-02   +5.161635191389409e-02   +7.719697197182029e-02   +5.324727251022009e-02   +6.871311360426052e-03];
L3I_L2I_iGABA_netcon = [-5.010487312031341e-02   -5.328717191996489e-02   -7.190451524014847e-02   -9.561422245794635e-03   +7.971345164248722e-03   -1.001913693879215e-03   +5.639407320142749e-02   -1.536659355377460e-03   +8.384756149817289e-03   +3.951793144634388e-02   +8.559492700284306e-02   +4.057138422611187e-02; +7.599340280660220e-04   -4.227981072188199e-02   +4.064266986768827e-02   -1.488755214556199e-02   +4.381236344187447e-02   +2.946271539028490e-02   +3.096490321460864e-02   -2.166153311836145e-02   -6.055739331001404e-02   -7.976620606001109e-02   +2.324908047305885e-02   +1.968127271202530e-02; +3.414591753759955e-02   +2.281692173777700e-02   +8.652126120286464e-03   +1.147094468988005e-02   +6.488572055471305e-02   -4.692518208059184e-03   +2.081655348664667e-02   +3.243150029963190e-02   +3.766812532748270e-02   +1.534137554595125e-02   +1.389278293193598e-02   +4.783323160440552e-02; +2.250609137524585e-02   -6.526098539911870e-02   +2.547882084926392e-02   -3.070689630743598e-03   +2.298006177553952e-02   +1.217078344137236e-02   +3.976050468610173e-02   -5.999742593908654e-02   +4.069215197447430e-02   +6.131286840522532e-03   +5.302757668778570e-02   -1.927552892816821e-02; +3.540896780183769e-02   -1.342090722480737e-02   +3.748955016021573e-02   -2.985920209186615e-02   -5.645842454191070e-03   -3.975346236549666e-02   +5.714010464120169e-02   -1.473213818286956e-02   +5.562516066854301e-02   -8.206442855457363e-02   +4.822583285200086e-02   -4.141863970027231e-02; +1.167807764062751e-02   +1.396785756704596e-02   -5.267489067016343e-02   +1.879781084190402e-02   -3.710815134589136e-02   -1.401654542071634e-02   -1.588534459359070e-02   -6.930485346690798e-03   +1.654995066104941e-02   +3.483490297862320e-03   +2.696293609329845e-02   -2.374780919019741e-02; +2.591291339532891e-02   +5.852236701070889e-02   +5.911644223033276e-02   -5.832466188997940e-02   +3.058271636766467e-02   +4.001793101942156e-02   -9.294505305761282e-03   -1.308678509307416e-02   +6.741276650583433e-02   +7.175339886720039e-02   -4.629018982380421e-02   +5.087167375664287e-02; +5.079318872093441e-02   +4.981737419208236e-02   +3.777096135790311e-02   +8.453641732533998e-02   -2.799605348708143e-02   +4.052208488218827e-02   +2.484809942714530e-02   -1.735029399974892e-02   +4.588018044366540e-02   -5.567960155547928e-02   +6.839547172661621e-02   +1.176294921291113e-02];
L2E_L3E_iAMPA_netcon = [-3.641843041301464e-02   -2.196270296452578e-02   +5.183695016598817e-02   -5.546179122964085e-03   +6.014333158879090e-02   +1.370661693391042e-02   +5.978043953817355e-02   +1.316681032971397e-02; +2.598386748166426e-02   -2.622084791621953e-02   -2.978789466301268e-02   +2.152327846035617e-03   -3.698568872964633e-03   -3.737532805709479e-02   +2.017702768898976e-02   -6.370472982472159e-03; -3.564308044114489e-02   +7.355218305649000e-02   +1.062602812934453e-01   +1.788826107072606e-02   +6.468235207686188e-02   -6.192855934238901e-02   -8.694648444260889e-03   +3.380900688600308e-03; +7.125755115670271e-02   +1.986083599640474e-02   +1.874250597778390e-02   +4.770493248056146e-02   +8.827122164413452e-02   -6.339579594683464e-02   +6.999904677170836e-02   -5.016127846989460e-02; +3.438158418518705e-02   -5.625959183398258e-02   +7.101224486554802e-02   -3.525791018223195e-02   -4.593040116147153e-02   +7.078452369501982e-02   -3.648189684374693e-02   +4.155572993335538e-02; +1.574022877676286e-02   +4.586751067825254e-02   -5.997790777288933e-02   -9.046921926706506e-03   -3.940293601631073e-02   +5.785953375599768e-04   +4.812234075992774e-02   +4.497651626504735e-02; +6.166256231973936e-02   +1.318567713021693e-02   +5.796464643949199e-02   +5.726960458462715e-02   +7.960851223253504e-02   -2.474905942310342e-02   +1.494872145640109e-02   -6.001653185597606e-03; -3.241266908656295e-02   -1.064162570550109e-02   +3.540078613141551e-02   +2.974210759834304e-02   -3.019392031898885e-02   -2.408014101324244e-03   -3.885738771300210e-02   -3.479766512229147e-02; +4.001125589482853e-02   -5.802837469207325e-02   -2.389354270268427e-02   -1.269928831817033e-02   -4.923966517936765e-02   +2.919663276388075e-02   +2.780949919451510e-02   -3.849861392008173e-02; -2.356854580003846e-02   -3.345843194995500e-02   -1.295051884681835e-02   -3.246506235609877e-02   +3.581943102856953e-02   +5.110130090836358e-02   -2.067960080864474e-02   +2.818007494191942e-02; +8.645677860989714e-03   -2.663995554798552e-02   +1.456991011882000e-02   +8.227584450095840e-02   -1.641566771560139e-04   +3.662774203110525e-02   +4.270486867851313e-02   +8.535385769425199e-02; +9.379159441938933e-03   +4.932979635470063e-02   +2.207088406086461e-02   -5.536175137054861e-02   +2.379561491101073e-02   -3.958427345753672e-02   +6.591124228933466e-02   +4.038150033837101e-02];
L2I_L3I_iGABA_netcon = [-7.444598834375843e-03   +4.743365766156943e-03   +1.765073744646305e-02   -1.071319008574491e-01   +4.253917924524197e-02   +1.077513671165964e-02   +9.669935510110107e-02   +7.621806887272763e-02; +3.040008529613027e-05   -3.576395574528189e-02   +7.857493257439049e-02   +2.922284616785066e-03   +6.534624028740552e-02   -1.540798007110975e-02   +1.825112920802793e-02   +8.001228673379115e-02; +7.419059165021599e-03   +1.898020430736342e-02   +2.894769077746766e-02   -2.267196144364671e-02   +3.489396163222840e-02   +4.816489370064503e-02   -4.875184430724065e-02   +5.954425586610485e-03; -2.831535016934115e-02   +1.479292590450461e-02   +1.045754330071506e-02   -4.175778954888384e-02   +1.140615695016410e-02   -7.146323343500754e-02   -1.258522062585511e-01   +5.184173597382703e-02; +6.125814934471558e-02   +6.266622816467171e-02   -5.711337744718305e-03   +1.210618558354489e-02   -3.943490507219818e-02   -6.099774105878197e-02   +9.171712007504324e-03   -3.356886196427891e-02; +6.195605652474376e-03   -7.415265326780211e-03   +4.109370753148900e-02   -3.546598316717679e-03   +2.133482627732534e-02   +3.870444854529625e-02   -7.869589115471123e-02   -9.406523479455231e-02; +3.130119553857250e-02   -3.154113240304900e-02   +1.146543115800926e-01   -4.403227374262237e-03   +4.949512592853154e-02   -3.532821111102326e-02   +8.830250957371814e-02   -2.581375048244582e-02; -8.597910292048552e-02   -1.029779011039695e-01   -2.881727972424572e-02   +4.819724010785607e-02   -4.556237236498024e-02   +2.575718463665158e-02   -7.497711417990658e-03   +5.371617784835161e-03; +1.314070984127052e-02   -8.378473635595447e-03   +1.003874889750387e-01   +4.973609156933585e-02   +1.525336184782008e-02   +2.711379037247757e-02   +3.772963315989541e-02   -3.581088549409518e-02; +7.972773786457120e-02   +4.457447593285592e-02   -1.198035710277420e-02   +3.911425003015619e-02   +2.797600010552208e-02   -4.135337736257396e-02   +9.243945667949972e-02   +5.619527810222191e-02; +1.401240963168899e-02   +3.977123723933560e-02   +6.257843640237587e-02   +8.515655866338301e-02   -8.114046066392846e-03   -3.320969296916627e-02   -2.379977923312740e-02   +4.934203984499183e-02; +9.709020952255587e-02   -1.080436396675631e-02   +5.022279158247404e-02   -1.093656200886426e-02   +2.123033997873821e-02   +2.834483311161108e-02   +4.757245203056811e-02   +4.388854482268574e-02];
L3I_L3E_iAMPA_netcon = [+6.893103868487650e-02   +2.404036706706791e-02   -6.097321675486130e-02   +2.687338131227042e-02   -1.012460149601267e-02   -5.684430225042621e-02   -2.697683039568075e-02   -4.481562684407620e-02   -4.065926881181787e-02   -1.217994659826623e-01   +1.399997686933926e-02   -8.355210281240595e-03; -9.057053370077905e-03   +4.675824329740298e-02   +2.449856292245005e-02   -2.374573745765225e-02   -4.226760525991319e-02   -1.440407938303539e-02   +2.671295097743816e-02   -1.455709238730316e-02   -4.758034090685748e-02   +9.538455142322007e-02   +3.286639884758968e-02   +6.685055162357999e-03; +5.575553421463082e-02   +1.670848131986537e-02   +3.734942537577401e-02   -3.730976985091748e-02   -2.137005597970096e-02   -1.012947356429641e-03   +6.523173096711869e-02   -2.344619694449263e-02   +3.059750486381625e-02   +6.324136381463376e-02   -5.903779590447406e-02   -6.720852007104944e-02; -2.538795512097032e-02   +4.705516947321733e-03   +2.992877746901050e-02   +6.234924652776935e-02   -9.213386770080423e-02   -7.779919013399136e-02   -3.691184959052714e-02   +6.786617446954615e-02   +5.436736632015235e-03   +4.315452253223549e-02   +4.367238213047449e-02   +2.322132502349512e-02; -2.575135948461791e-02   +9.788042675130910e-03   +1.062927688763824e-02   -6.875024644133969e-03   -6.598481943730851e-02   +3.749407008436229e-02   -2.864344982000872e-02   +4.000789714583920e-02   +7.640144277703444e-02   +7.735972849480509e-02   +3.583533660968231e-02   +1.696282780681826e-02; +3.770131861456595e-02   +2.194399748807783e-03   -3.795488357620734e-02   -1.217589390481540e-02   -4.847568067697633e-02   -4.893658649296341e-02   +5.488313922073034e-02   -6.319295175167272e-04   -8.698765595939227e-03   +2.775942542164831e-02   +7.708054478667620e-03   +4.100492511933708e-02; -3.888572070319712e-02   +3.969859109907109e-02   +8.266758292054262e-02   +2.014095693674144e-02   +1.436284076789820e-02   -5.137482831092131e-02   +3.411586595966110e-02   +3.683496862446113e-02   +3.426057416240083e-02   +8.285304303712124e-02   -6.989559511301918e-02   +2.952080315978635e-02; -9.927252935494078e-02   +2.612368307900911e-02   -1.630788412854687e-02   +7.871964484820893e-02   -1.835561623420875e-02   +4.668701471628953e-02   +2.885735585516313e-02   -5.326165111954488e-02   +8.791153567897589e-02   -1.464642821471645e-02   +6.380097618592873e-02   +5.878607558535970e-02; -1.982843998677301e-02   +1.150011263859437e-02   +1.564001770203622e-02   +3.919314189027533e-02   +3.497239655925449e-04   -1.581484220358478e-02   +2.571761956496735e-03   -3.476867041138804e-02   -3.317432865765185e-02   -4.335277660092560e-02   -3.585310700951139e-02   -1.544008210847409e-02; +3.796236314259339e-02   +4.203969972576164e-02   -3.960631913178968e-02   -8.475044966597530e-03   +5.760883822891978e-03   +2.661558992221457e-02   +2.664204628082227e-02   +3.020065519402264e-02   +4.882534372620503e-02   -1.815408211299646e-02   +6.791786848026185e-02   +5.942493347488089e-03; -4.517079893840597e-02   +2.756374167534460e-02   +5.871891815095349e-03   +5.696314026612725e-03   -8.239648295445570e-03   -4.218401897029955e-02   +5.911392183089601e-02   -1.320783214943308e-02   +9.568814449391823e-02   -3.161149915470243e-02   +3.757516916270792e-02   +2.942769331595331e-02; -1.122278541518088e-01   +4.407650921630700e-02   +9.497078262334216e-02   -1.701241929732686e-02   +3.537475266783165e-02   -1.582538019667728e-02   +6.574176921094062e-03   +3.753102161124025e-02   +2.803049870668363e-02   +2.646894578310358e-03   -5.778137234212129e-02   -5.408691568873036e-03];
L3E_L3I_iGABA_netcon = [+6.095667116716184e-02   +3.158764230564259e-02   -3.865016146164645e-02   +4.232872044799032e-02   +7.741705390084318e-02   -9.736603026794690e-03   -3.658553364134107e-02   +1.617620952583982e-03   -7.124084431891167e-02   -2.311216960598226e-02   +3.403022683877132e-02   -6.038766856529317e-02; +6.293185583308988e-02   +4.540356486205083e-02   +1.108352247460605e-02   +1.231855153062259e-02   +8.770690304588612e-03   +3.259695618047841e-02   -1.369682466914377e-02   -1.168091264094842e-02   +4.224292346110339e-02   +1.091924207920066e-02   -6.039057634725820e-02   -1.868266509503450e-03; +6.247631989760438e-02   -2.785925718665810e-02   -1.896209093180127e-02   -7.243523408331450e-02   +7.486337054900137e-02   -2.697591563633368e-02   +1.302735420152865e-02   -2.468307406305764e-02   +2.094678363447929e-02   +1.293052364025342e-02   -1.693636577084804e-02   -1.381155402806572e-02; -7.487178455089713e-02   +2.769155309550368e-02   +4.113890000939732e-02   -1.781413019260991e-02   +2.790043698671583e-02   +2.062035459991028e-02   +9.101135794220182e-03   -2.884763294265563e-02   -4.437868579372607e-02   +7.950510500797207e-02   -2.372873709151346e-02   -4.054624081826084e-03; +1.847157907474827e-02   +7.771016896579128e-02   -1.540116191695615e-02   -3.629975914161569e-02   -1.074473286907664e-02   -1.490286556051685e-02   +1.749456853810049e-02   +3.062924468497980e-02   +2.777292706154195e-02   +5.440676553195773e-02   -1.784215650567854e-02   -3.469983029619603e-02; +1.172103388226715e-02   +3.165945021611525e-02   -7.305832790003101e-03   -7.116743653384422e-02   -1.760941118900453e-02   +3.663161047514435e-02   -7.416346396927015e-03   -3.287859671170219e-02   -1.580660425914972e-02   +6.872100124156622e-02   -2.058192654021240e-03   +3.611663029297196e-02; -3.168344806690593e-02   +3.275820205199959e-02   -2.311253249542358e-04   +4.716606848871443e-02   +1.441731344097981e-02   -1.024480317572397e-01   +5.897506203896358e-02   -5.082337515239066e-03   -2.902029313934776e-02   -5.938697468999544e-02   +3.133808580083661e-02   -9.899213921145254e-02; -1.628038734934320e-02   -2.617366777140681e-02   -5.883388893838366e-02   +3.391088558420344e-02   +7.074580709127462e-03   -2.081577967689919e-02   -4.075497019923709e-02   -8.847917147659987e-02   -2.636579593151923e-02   -1.695105856467517e-02   -8.186960966588306e-03   +2.364730092011093e-02; -3.991487540814159e-02   +5.889860429611231e-02   +2.702541934818282e-02   -6.670000474579996e-03   -1.346427591319503e-02   -8.033158676154531e-02   +7.010870081611731e-02   +3.952314610854279e-03   -2.047060921258120e-03   +7.004891132225209e-02   +7.065214685015515e-02   +3.223639468417621e-03; +9.799106491954411e-02   +3.952698084571416e-02   +2.902182221745016e-02   -2.073072604909649e-02   -4.550412054572586e-02   -7.424959711048926e-02   -2.513182564537431e-02   +2.774830188046699e-02   +1.055269820861276e-01   -5.208084261837155e-02   +2.813397524981009e-03   -1.554303843614586e-02; -1.856871839392247e-02   +4.941754908364763e-02   -4.456873464996696e-02   +2.576428924999217e-02   +3.079037236104942e-02   -9.737386342375774e-03   +1.070154433384401e-01   -6.510406526104406e-02   +1.021689235182872e-02   +3.590744753010443e-02   -3.416886571408431e-02   +3.053894279657491e-03; -7.872997445759250e-02   -6.317038596219431e-02   +6.382558328400884e-03   -3.097021778350968e-02   +1.042439232561057e-02   -5.937480905980206e-02   +6.229160031453961e-02   -2.475049638284869e-02   -3.304767740992933e-02   +5.847521537642275e-02   -5.120792274827764e-02   -3.109132143078254e-02];
L2E_Input1_iAMPA_netcon = [+2.322288447883173e-02   -6.418333624491075e-02   -3.183545220009847e-02   +1.766557741341906e-02   -2.007641943092182e-02   -5.810275363577630e-03   +7.996379142188460e-03   +3.555894753230772e-02];
L2I_Input2_iAMPA_netcon = [+3.803265448668389e-02   +1.109506152780139e-01   +4.989410749124869e-02   +4.374185607162257e-03   -7.763735357468568e-02   -4.506876205046510e-02   -4.091749496617507e-02   +1.186115985514922e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.3*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))*0.9 + 0.6*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.3*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))*1.0 + 0.8*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.3*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))*1.0 + 0.8*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.3*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))*0.9 + 0.6*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.3*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))*1.0 + 0.8*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.3*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))*1.0 + 0.8*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
