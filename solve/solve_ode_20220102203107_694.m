function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-2.235107755686020e-01   -1.636890032296965e-01   +4.386918037815187e-01   +3.513205504301283e-01   -1.236344192751669e-03   +4.564083187944286e-02   -7.163608881092758e-01   +2.260134859494596e-01   +6.619448057623345e-01   +6.895048809920679e-01   +2.508166531005520e-01   +4.917229808701815e-01   +2.271415718982572e-01   -5.464300739386424e-02   -2.889960827558298e-01   +5.499508793348597e-02; +4.998177053075260e-01   +2.207605351682402e-01   +1.390791147458941e-01   +8.522584353915569e-02   -3.190717394040524e-01   +6.736731032985263e-01   -5.990008815548297e-01   +2.761843579492035e-02   +5.702567336945233e-01   +1.145472180475705e-01   +9.015907328777479e-01   +5.796058865555946e-01   +4.042242255731313e-01   -9.054607670496723e-02   +1.966399216766914e-01   -1.662968845625266e-02; +4.722336323345854e-01   +3.072298958756457e-01   -4.908999038751079e-02   +1.833081884770319e-01   +2.257838911670746e-01   +1.158578394727888e-02   +4.623091401424176e-01   +1.368554361931076e-01   +3.428910125599696e-01   +3.900020832047043e-01   +4.443947666370265e-01   +2.527720607637941e-01   +1.841288233932283e-01   -4.505701396745175e-01   +5.835772193793266e-04   +7.692242050764918e-02; +4.483818417374103e-02   -2.515803897570866e-01   -5.585777154506984e-02   +5.993031679056812e-01   -1.725179065734841e-01   +2.738640456171293e-01   +5.086499834790363e-01   +8.413719481107778e-01   +3.865617127490608e-01   +1.352547858265849e-01   +3.265924423645131e-01   +3.432673259503627e-01   +1.165384543752623e-01   +4.316701730663066e-01   +1.545010864528390e-01   +7.716026928568226e-01; +3.166728146301990e-01   +3.550934047794519e-01   +4.722179687626509e-01   +6.109998995360124e-01   -7.010301338434111e-02   +2.599068095755280e-01   +1.591048553113153e-01   +1.805923898633214e-01   +1.600492381160168e-02   +4.057141553669769e-01   +5.877536923875168e-01   -2.310914873230394e-01   +3.605688354773013e-01   +1.284664429238713e-01   +3.234124282023400e-01   +1.779837264196507e-01; +1.628500337640023e-01   +6.417327055730151e-01   +1.708686213721188e-01   -8.841527454361822e-02   +5.350965381984357e-01   +1.074855026196164e-01   +4.617836330258608e-01   +1.718136232712064e-01   +3.593140352774575e-01   +3.684096538637570e-01   +2.121113653752697e-01   -2.923228836329627e-01   +3.361273088401258e-01   +3.238164422480905e-01   -3.067928314597194e-01   -3.363276735012628e-01; +3.538325728699128e-01   +2.376894600073833e-01   +5.285590536657976e-01   +1.578214407945454e-01   +1.659121221471939e-01   +5.096558760221631e-01   +4.607373872746794e-01   +3.097480972482020e-01   -3.286546333693687e-01   +2.003645898291978e-02   -6.393833068876149e-02   +3.318261653483375e-01   +2.880242587153243e-01   +3.858129606063647e-02   +4.255752407076749e-01   +5.744540756418879e-01; +5.530703157673164e-01   +6.760771426359702e-02   -9.509529282385956e-02   +3.086408609114446e-01   +8.854039790995677e-02   +1.399645010570172e-02   +5.787249313122426e-02   +6.422952894738727e-01   +3.290769959485966e-01   +2.194028600449130e-01   +2.765245369157036e-01   +2.991406275091533e-01   -2.863103551830888e-02   +1.952618091399638e-01   -2.969329673321429e-01   +2.633465321075091e-01; -2.294645825659997e-02   +5.236546001830538e-01   -4.062167852209533e-01   +3.585857489646858e-01   +2.537736994371756e-01   +4.803972067388649e-01   +1.357501140972043e-02   -3.874493340887526e-01   +2.339078887598742e-01   -9.076693409154943e-03   +5.471553521270749e-01   -1.812022859836288e-01   +3.661551945616727e-01   +5.644705132017706e-01   -2.390988964359474e-02   +1.183789228045573e-01; +2.229471904776168e-01   +6.045126323541551e-01   +4.763591576079469e-01   +2.249627351876174e-01   -2.664286527142831e-02   -2.865511881676500e-02   +3.995540381309787e-01   -9.895932354354228e-02   +1.748186046570016e-01   +1.557941615146626e-01   +4.350180283539678e-01   +2.838908634957613e-01   +4.421210489272330e-01   -1.186523310488541e-01   +1.101696049415446e-01   +3.759283816801893e-01; +1.173104083739076e-01   +5.761473146570839e-01   -8.799608775128698e-03   +1.914428153802677e-01   +5.454433048542984e-01   +6.778561570786505e-02   +3.400779455462684e-01   +1.044881899613157e-01   +1.501420993718688e-01   +5.537556728022626e-01   -4.785674766076744e-01   +2.292134486972843e-01   -5.546180174858294e-01   +4.218526833055804e-01   +3.489714502285761e-01   +2.282557809940968e-01; +3.475680578012799e-01   +2.589303506064012e-01   +5.349166365654605e-02   -1.665666782394803e-01   +3.691741116272031e-02   +2.400309662111247e-01   +3.918504874673534e-01   +2.859752694350339e-01   +6.032295252814038e-01   -8.134494636895151e-02   +3.558269110853312e-01   +6.545640148174270e-01   +6.536583767561908e-01   +1.226464476404212e-01   -3.885883382627409e-01   +1.692924905734745e-01; +1.330785447746393e-01   +1.691544196624793e-01   +5.915432263962133e-01   +1.842000199187375e-01   +6.547551058314115e-01   +5.364296449423436e-01   -5.417865812832287e-02   +2.082532637268732e-01   +8.117661688631328e-01   -9.325857414383118e-03   +2.327624590159541e-01   +5.104538450877840e-01   -1.476678724271636e-01   +1.247776282495796e-01   +1.239849351062056e-01   -1.596635209429847e-01; +1.057976696679493e-01   +2.482009724841854e-01   +3.044946076038609e-01   -6.602005718358955e-01   +1.144705880610746e-01   +7.954546792538105e-01   +4.203162176763703e-02   +3.372035258966152e-01   -2.290981388837575e-01   +1.608241652151769e-01   +5.059122867896840e-01   -2.383924926807215e-02   +3.516295614536940e-01   +4.736963836806775e-01   -9.262928303137671e-03   -1.385335007364701e-01; +3.251005534010878e-01   -3.306960808483963e-01   +6.070086667481347e-01   +3.139185893312383e-01   -2.386602587063648e-01   -3.160117000099713e-02   +3.550833116893236e-01   -9.499691439733859e-02   +7.113743243639696e-02   -1.055798714509372e-03   -1.230926718047544e-01   +2.560086650444404e-01   +4.902015242573433e-01   +1.184250573942847e-01   +1.614293435295388e-01   -4.236004030968706e-01; -4.990874178175002e-01   +5.998157279123733e-01   +3.789661987775828e-02   +4.349002777417186e-01   +7.339881025316658e-01   +6.537795323521557e-01   +6.731806832042420e-02   +7.632802462199397e-01   -4.253351114603403e-02   +3.787889505612557e-01   +3.252969717160394e-01   +3.780958420978494e-01   +4.990350491616142e-01   +4.646378731107080e-01   +4.003136678158608e-01   +2.899491295136073e-01];
L1E_L1I_iGABA_netcon = [+4.303134949626967e-03   +2.864788748671843e-01   -2.192706839851905e-01   -1.685148718444393e-01   +7.271539115494985e-01   -1.601213707114490e-01   +1.759725798369005e-01   +1.324727272128729e-01   -1.092903828702597e-01   +9.998558660558815e-02   +3.653914518490537e-01   +3.271908912089861e-01   +9.640343090632228e-01   -6.386096917281131e-01   -3.774794859975113e-02   +8.571987370301364e-01; -4.611093022902817e-01   -1.587842700206512e-01   +6.564909419925110e-01   -3.611371895532473e-01   +1.775570180151309e-01   -2.148881376840785e-01   +4.019654358794200e-01   +4.483837298132212e-01   +3.603043452970722e-01   +1.874543816759921e-01   +5.391309757150824e-01   +8.239983759466141e-02   +7.600286400450484e-01   +5.861447886477235e-02   +2.510593824677266e-01   -1.916345406544977e-01; +1.221897079434373e-01   -4.438593674713821e-02   -2.197784491907745e-01   +5.326643113747149e-01   -6.624461376754431e-02   -2.149245856678944e-01   +5.670985019099735e-02   +2.972050862801725e-02   -1.409376848842426e-01   +6.620642519706906e-01   -1.588675063430289e-01   +1.867018425102336e-01   +3.288921204547177e-02   +1.327825505475971e-03   +7.139126354825802e-01   +2.762180550248407e-01; +5.655711348712441e-01   -2.747468085400781e-01   -2.938490732097392e-02   +2.958438066846807e-01   +8.514836566202978e-02   +4.873616589610795e-01   +2.497087806489667e-02   -1.313876503941887e-01   +1.668325264848911e-01   +2.385484170859539e-01   +3.488807291057301e-01   +6.457754730013501e-01   +2.300820153132818e-02   +2.314921402838861e-01   -2.332702566263201e-02   -3.386788942711951e-01; -2.213153050331899e-02   -7.138864942566435e-02   +2.781507508894890e-02   +3.906033035971311e-01   +2.224176044305793e-01   -1.057392198802874e-01   +2.430144937503033e-01   -4.250417349048839e-01   -2.523450017002860e-02   +1.790166097182779e-01   -5.471276401004779e-01   +6.820784729897601e-01   +1.918609257299288e-01   +3.315265778980046e-01   +1.266286684799052e-01   +1.000882971233505e-01; +2.224837559141366e-01   +1.832639045184496e-01   +2.366652402917823e-01   -3.219114556968862e-01   -1.025167422269364e-01   +7.151204914959893e-01   +7.626281607779650e-02   -5.887257965637571e-01   -2.060114613113413e-02   +1.222554166598601e-01   -4.246554890675316e-01   +2.808081020656911e-01   -3.615027991431900e-02   -4.992963355022950e-01   +5.027584754346408e-01   +1.130964231451191e-01; -4.836217521650924e-02   -1.324917120167600e-04   -1.490098244987280e-01   -3.583726593185510e-01   +3.682995334071953e-01   +1.461040597457939e-01   +2.577036881923197e-01   -1.843319074252527e-01   +4.742845750654628e-02   +5.165269396764445e-01   +6.331305513151835e-01   +2.935220381028387e-01   +4.542549381631593e-02   +8.996162858464093e-02   +9.729822638566826e-01   -3.235355181961902e-01; +1.023770298403285e-02   +1.880078404286525e-01   -1.162029575351654e-02   +1.592137087169966e-01   +9.926220026524224e-02   -1.292673429540894e-01   +6.266104389897376e-01   +6.189083530966597e-02   +6.220467995271135e-01   +4.362067601301639e-01   +2.393158292473052e-01   -1.683371530578701e-01   +3.462756194223693e-01   +3.513477320235877e-01   +4.236093881391307e-01   +4.692947715538865e-01; +7.219953394411420e-01   +7.484459160541199e-01   +1.619497722588308e-01   -2.725329161136247e-01   -5.792699977602385e-01   +2.897961270035805e-01   +1.788467394332255e-01   -4.377825031087188e-01   +1.090408441072189e-01   -1.965619110091719e-02   +1.718068602299403e-01   -2.301236403623149e-01   -6.239838526921597e-02   +4.825759075766580e-02   +7.762631392999908e-01   +1.193972237378430e-02; +3.779069713356883e-01   +5.219710145429814e-01   +3.645272285569441e-03   -1.760786246039496e-01   -2.092257250611855e-01   +1.508943561430831e-01   +3.106734338459861e-01   +8.755704338677664e-02   +4.179363823503660e-01   +9.299262639035427e-02   -4.391505083210340e-01   -2.846112221016127e-01   +5.803741202733669e-01   +4.576973627043831e-01   +3.138668873568744e-01   +2.599799134073232e-01; +3.434501005702932e-01   +1.484471306957285e-01   +2.068743630996569e-01   +5.568526212193260e-01   +1.962477319344068e-01   -2.854171509024644e-02   +2.256657093256095e-01   -1.353761782887972e-01   +3.687421109045613e-01   +1.492872988501888e-01   +4.523648228728991e-02   +9.007921298206431e-01   +7.528297925699317e-01   +2.161623219844898e-01   +4.819086724338568e-02   -2.410542626832406e-01; +2.433875324948946e-01   +2.587837127782416e-01   -1.027907950059778e-01   -5.069932879431511e-01   -3.025711296550469e-01   +1.361237546440255e-01   +2.180078424081111e-02   +5.949413486418684e-01   -1.751516993867931e-01   -2.885661351000613e-01   +3.090176011166165e-01   +4.796336142551750e-01   -1.493063821507764e-01   -3.086222604857629e-03   +3.783476284509672e-01   +3.694864757281342e-01; +4.251989398991917e-01   +4.957321028395351e-01   +1.444130477228263e-01   +5.474496550365189e-01   -1.187529645306264e-01   +3.492028092862793e-01   +5.855127862052389e-02   +4.111581218291126e-01   +5.558039915012348e-01   -3.003500545159594e-01   +1.122376772304425e-01   +4.644087774478340e-01   +2.534591836259762e-01   +9.494729358557583e-02   +5.187843328673474e-01   +3.977171896157001e-01; +4.965566453320284e-01   -1.124007364868832e-01   -2.801921721439088e-01   -6.826937792908470e-02   +5.237603832640326e-02   -3.619595759562200e-01   +4.059012342321373e-02   +2.938686457269891e-01   +4.875658720627792e-01   -2.100280142106717e-01   +4.586096046307239e-01   -2.943774880998034e-02   +1.312410823224321e-01   -1.112742404899162e-01   +9.750100925691998e-02   -3.395694874858343e-01; +5.283138549848931e-01   +1.372514312498468e-01   -4.777016433397528e-02   +6.115404534519753e-02   +2.558136090442524e-01   +1.345763365469019e-01   +4.581934300726479e-01   +4.925096029540930e-02   +5.926313712448021e-01   -1.677130626382729e-03   +2.109058083363310e-01   +1.718288908072400e-01   +1.759270056394057e-01   -2.297164316951265e-01   +6.750391770179508e-01   +6.974828289135587e-01; -4.761460822967128e-01   +2.699022311161965e-01   +1.199224584439781e-01   -7.746700680046265e-03   -1.702196345728782e-02   +3.526173603902880e-01   -1.234076733038071e-02   +2.317024520793686e-01   +4.268497908789806e-02   +3.619700416148822e-01   +2.879394301642507e-02   +1.915271361351349e-01   +7.957628994601934e-02   +2.588931772065035e-01   -7.612253350249601e-02   +5.863052776242395e-01];
L2I_L1I_iGABA_netcon = [-3.217815173161328e-01   -3.574460870623531e-01   +1.807551294012638e-01   +4.651659578206424e-01   -1.667351020283185e-01   +7.594944939311926e-02   +4.533530027759270e-01   -4.804249273827251e-01; +3.879960273697531e-01   +7.588865658806939e-01   -3.093938684485708e-01   +7.474539568044884e-02   +4.334922865625114e-01   +6.154460545787798e-01   +2.374969056459806e-01   -5.639675807059857e-02; +5.591640993868147e-01   +4.251350426311286e-01   +9.981365788600696e-02   +3.355428083125937e-01   +5.176145282855849e-01   +2.077134737917801e-01   +1.152234149232665e-01   -3.462750988466017e-02; +6.547358752278128e-01   +2.250595014857575e-01   +6.658171448317090e-01   +1.605465881248385e-02   +3.950175610684971e-01   +3.129959404812885e-01   +6.495758890006511e-01   +1.970823567482334e-01; +1.395184702110729e-01   +9.073265336733971e-04   +4.712031649907609e-01   +3.587063321296365e-01   +5.287816761386316e-01   +2.441424966364079e-02   +2.140926872673587e-01   -1.250921504250484e-01; +3.425177501433364e-02   -1.043214888873369e-01   +1.436829068206756e-01   +1.827492222564704e-01   -2.740204599323216e-01   +2.559497684853903e-01   +3.429880124539845e-01   +5.715648514418569e-01; +6.976710881215197e-01   -7.524624915025563e-04   +1.972061853491921e-01   -2.645693940015306e-02   +2.740486709742985e-01   +6.140712972118768e-01   +3.994941032260842e-01   +1.083750059726924e-01; +5.330749851827601e-02   +5.346164295968475e-01   +2.324340462045704e-01   +1.795452124001997e-01   +9.257603590342782e-02   +1.226577519873486e-01   +6.702479939870060e-02   +1.505261261440076e-01; +2.853133162439307e-01   +9.271151001436400e-01   -6.992694969478229e-01   +2.823934845594906e-01   -1.948428114195014e-01   +1.841559749327848e-01   +2.732971988369752e-01   +3.820346808445763e-02; -3.028647873168550e-02   +2.290853212496882e-02   +1.966209574810577e-01   +4.748300657344641e-01   +6.204557323388383e-01   -4.559941260709284e-02   -9.211780523108939e-02   +3.643350633937065e-01; +3.649483842185589e-02   +7.356132891365538e-02   +4.591133740143607e-01   +1.941403824162450e-01   -1.067762990999463e-03   -1.897964333000244e-01   +2.451530300170279e-01   +2.964432870523362e-01; +3.305547911490602e-01   +4.566024277960337e-01   +5.987767320416697e-01   +4.715587465947026e-01   -1.599670477895415e-02   +1.249467089612755e-01   +4.107236566181861e-01   +3.451718218266273e-01; +2.856309523092102e-01   +5.146979616470679e-01   +4.543588603463140e-01   +2.051624410658773e-02   +2.297951900256198e-01   +2.412166607894228e-03   -1.774993881103512e-01   +1.317819627711657e-01; +8.029150222873729e-02   -2.533978304015863e-01   +2.024238792465897e-01   -2.041659726561619e-01   +4.593257919872545e-01   -1.676988107102341e-01   +4.545596391304405e-01   +2.076306393308399e-01; +2.867148900276164e-01   +9.418109232436377e-02   +3.539355054100149e-01   +9.110633745010534e-02   +5.082770530507229e-02   +8.458305584195831e-01   +2.824259440316350e-01   +4.679870599830718e-01; -3.477269080756162e-02   -1.768855029580971e-02   +2.786286759506951e-01   +2.794093057776564e-01   +2.888686404467429e-01   +8.989244101091808e-02   +2.070982280134961e-01   -1.599731920363229e-02];
L1I_L2I_iGABA_netcon = [+4.898077406829624e-01   -1.549213470393921e-01   -2.506841182275039e-01   +5.129999493482402e-01   -7.238147915669921e-02   +9.367783024458122e-02   +3.578836774786633e-02   +3.279827736440167e-01   -1.006699642387934e-01   +3.715481380934197e-01   -1.620723746298860e-01   +2.230272784842151e-01   +2.831408019439581e-01   +2.094694514031309e-01   -4.697880183358889e-02   +4.422876039783085e-01; +3.505357465457591e-01   -1.236252212619575e-02   +1.078160310062696e-01   -2.281008956801331e-01   -8.760120242089452e-02   -1.725517613123098e-02   +5.382119274802227e-01   +3.590127721109116e-01   +5.237795471540334e-01   +8.222092553087332e-01   +1.787910818907247e-01   -1.235782863143659e-01   -2.080492465098878e-01   -4.091875029240691e-01   +2.797424490664713e-01   +3.282387133321491e-01; +1.915691348247299e-01   -3.312370581853404e-01   +4.070980265733209e-01   -1.079729928480286e-01   +3.026890694501190e-01   -1.843216565241437e-01   +5.938227655784920e-01   +4.722065577917130e-01   -2.274538570759354e-01   +3.441207753381695e-02   +4.839015603229890e-02   +3.577900806569694e-01   +6.107894745683835e-01   +5.209470106677723e-01   +9.116431074637475e-01   -6.356867087422118e-02; +3.061905158810302e-01   +6.986562427358187e-01   +4.280701503973284e-01   +3.054491223027250e-01   +6.045150656297034e-01   +6.141113918992975e-01   +7.386799561696046e-01   +5.631646809810176e-01   -2.242292833642459e-01   +7.600000004650596e-01   +5.629281267758600e-01   +2.735962891442483e-01   +1.967664737729654e-01   +1.657866815988657e-01   +3.898652641114659e-01   +7.772940527413674e-02; -2.746021561272088e-01   +8.060739500995358e-02   -1.996792582353205e-01   +3.048975077644917e-01   -6.206176821338026e-02   +8.135495933592337e-01   +7.094421803407472e-01   +2.937939269166762e-01   +5.276378260145611e-01   +4.466572194837973e-01   -2.574100181252428e-01   +2.048378527805339e-01   -4.579164951670070e-01   +2.211209942709841e-01   +2.688565347509572e-01   +5.341984624972794e-01; +2.764579727382242e-02   +4.411924521299276e-01   -8.023062451038276e-02   +6.595103765134293e-01   -1.000970210760903e-01   +1.755340359182817e-01   +3.035376327445456e-01   -9.360319121370334e-02   -4.779040283532003e-03   +1.010210474249953e-01   +1.309726257995635e-01   -1.235560476322166e-02   +6.499840698782607e-01   +1.000000000000000e+00   +2.055304297585414e-01   +4.642707940996487e-01; +5.106225714358249e-01   +4.795976546811554e-01   -4.400181978783859e-01   +1.072626016938835e-01   +4.594745148969286e-01   -3.197342019035194e-01   +5.171193832850243e-01   -1.108849890332949e-01   -1.904774361097749e-01   +1.524596053279731e-01   +4.243200689512479e-01   +4.232007127181459e-01   +3.049349363549148e-01   -2.234722855277297e-01   +1.165181274307863e-01   +4.472333963969859e-01; +5.454105049800786e-01   -2.241884744137327e-02   -1.050787652327342e-02   -5.697599504216151e-03   +9.009124936262965e-02   +5.264630035158271e-01   +1.900591985337282e-01   +7.387046197076791e-02   -1.842378181094685e-01   +4.037271625946312e-01   +4.218068437694133e-01   +4.205290421687429e-01   +2.858960944195735e-01   -1.419090844437824e-01   +3.585940131221699e-01   +4.942820628394807e-01];
L2E_L1E_iAMPA_netcon = [+3.478972258232905e-01   +2.005061967629248e-01   +1.454689065921793e-01   +3.748094023967582e-01   +9.480790321303878e-01   +5.612740423898041e-01   +3.841136526524806e-01   +5.809364961945473e-02; -2.096786884931270e-01   +2.991750531639280e-01   -2.290272970443148e-01   +5.803179601814978e-02   +6.477784578677673e-01   +1.676113574112649e-01   +4.759194502584563e-01   +2.119790116161515e-01; +2.765969584276677e-01   +5.390846502885583e-01   +3.998298473956696e-01   +4.358642836534743e-02   +1.591690665613032e-01   -1.014509689320680e-01   +2.271341982414683e-01   +3.289841499290895e-01; +3.862099697862688e-01   +1.248121599615442e-01   -9.212656514609946e-02   +4.315516187290629e-01   -7.314080807725068e-03   +2.290856445280314e-01   +3.218251027978318e-02   -2.640208485142320e-02; -8.100265295466576e-02   +6.949381515691871e-02   +5.884756434573604e-01   -1.979053383940287e-01   -1.015507397579207e-02   +2.610091514045026e-02   +3.530249442058665e-02   +2.868631159990538e-01; +3.665444685391345e-01   -1.019447955021485e-01   +1.914040716299258e-01   -6.067349030746562e-02   +3.548830386365231e-01   +5.540276461306610e-01   +4.172987815773892e-01   +2.886061483137708e-01; +1.644500080845454e-01   +5.793741406096692e-01   +2.508094795158487e-01   -1.492769803963032e-01   -2.510524838690930e-01   +4.065715403572465e-01   +7.591981469491909e-01   -2.058162687116742e-01; +1.136944890558376e-01   +2.960373818367202e-01   +7.760270400672511e-01   +9.903599922387996e-02   +2.719348593864796e-01   +3.048029897615922e-01   +5.270244418059490e-01   +3.003419959377811e-01; +5.199204276301717e-01   -7.879802045875972e-02   +3.812081729078101e-01   +8.036913135159334e-01   -2.647295250624430e-01   +4.527176732924236e-01   +4.009874955471754e-01   -1.513391771710428e-01; +1.259771493057597e-01   +6.289410983165808e-02   +8.641178204184251e-02   +2.108774028597130e-01   +2.959265020628676e-01   -1.051187190918111e-01   -5.456570926677370e-02   +4.597091619369806e-01; -4.060894528674158e-01   +5.921670165584972e-01   +4.525575711042983e-01   -2.868201373461199e-01   +2.082420788085647e-01   -1.826913504906384e-02   +2.472348372318589e-01   +2.618174173401216e-01; +2.022584144923900e-01   +1.385191211771291e-01   +5.538787772171537e-01   +1.139587581389481e-01   -2.956071607350169e-02   +5.026827016813027e-01   -3.334502774169089e-01   +1.528653255617957e-01; -1.476743683261953e-01   +3.655192078945754e-01   +6.222118638893361e-02   -1.350201080596239e-01   +6.033015451117815e-01   +1.918539826227376e-02   +4.037286922297901e-01   +5.362014685290438e-02; +1.383058739338676e-01   +6.607932200351714e-01   -4.115285653003531e-01   +1.241806440003770e-01   +2.667919703035766e-01   +2.179501009783494e-01   -4.306600739355588e-01   +1.442947128267361e-01; -6.957516920884246e-02   -6.505770352983917e-02   -2.628042286398014e-02   +3.528934435143177e-01   -1.416709872637588e-01   -1.691661017744621e-01   +1.534847906906495e-02   +1.350143152557933e-01; -8.630454212795499e-03   -5.069013220202750e-02   -1.051543855650808e-01   -8.125665603442125e-02   +2.426823835005890e-01   +4.351613158446830e-01   +3.547086880043984e-01   +5.291456071847398e-01];
L1E_L2E_iAMPA_netcon = [+2.548875710292199e-01   +2.187209714075128e-01   +2.519325570733843e-01   +1.318971128629211e-01   +4.235483945523041e-01   +1.809635636521623e-01   +2.092454730753935e-01   +1.626432043500449e-01   -4.821524904930107e-03   -1.585758228100521e-01   +3.122421569738190e-01   +9.853970854173648e-02   +3.237374644486825e-01   +1.354640266263443e-01   -2.254708542595202e-01   -2.606635350856002e-02; +3.217642283722442e-01   -3.223729816567856e-01   +6.787381045255970e-01   +4.100419120045821e-01   +2.772928467503064e-01   +1.444643973749849e-01   +6.781631423247045e-01   +3.113089111686788e-01   -2.536027054602248e-01   +1.755742493317350e-02   +3.707765352964641e-01   +3.583470691035266e-01   +5.860163726715645e-01   +2.319886833589626e-01   +2.252139966505541e-01   -2.151739019930062e-01; +6.272901962402632e-01   +1.405132415676456e-01   +5.297026633627655e-02   -1.197420732122271e-02   +6.915984860193250e-02   +2.951941146865129e-01   +2.043280673302512e-01   +3.591177605953496e-01   +1.855795850152945e-01   -2.380408912146825e-01   +3.093102239747069e-01   +6.497735708804239e-01   +5.447778347098697e-03   +4.302038901076419e-01   +1.836727446197836e-02   +2.989367593874398e-02; +1.647214656193685e-01   +1.176259751925529e-01   +4.508351364017913e-02   +9.075749901999919e-02   +2.510085067234129e-02   +5.565964241452316e-01   +1.000000000000000e+00   -7.409044327145481e-03   -8.672666828820276e-04   +2.384916675596756e-01   +4.384362967925089e-01   -3.132077994371765e-01   -1.321923931952682e-01   +8.665694213490591e-01   +1.323129530192877e-01   -1.752228765032863e-01; -1.289854775190660e-01   -5.026164291814039e-01   +3.010366088816248e-01   -2.698914907146069e-03   +1.292036848602324e-01   +3.172384269625794e-02   +3.996373383372868e-01   +3.091214857695787e-01   +3.571267158728979e-01   -5.849386968039616e-02   +8.471611113032683e-02   -2.726606264094232e-01   +4.617451601127060e-01   +1.802542097443960e-01   +5.529910394343162e-01   -9.915198749472591e-02; +6.153568528033416e-02   +4.032503078626558e-01   +1.086616279818360e-01   +6.583435529421404e-01   +3.696414877683464e-01   +1.092711220493170e-01   +6.034708994153444e-01   -7.607589193688474e-02   +2.669919852405565e-01   +3.776710309878435e-03   +7.062354503386058e-01   -1.120745477292674e-01   -1.930442753033102e-01   -2.660334082645559e-01   -3.464821449220652e-01   +4.503256702986971e-01; +1.732120308902139e-01   +1.637926711383845e-01   -1.926392858433183e-01   +3.627856779814123e-01   +4.100556355210568e-01   +3.981088123883795e-01   +4.693959644107493e-01   -1.531998932766541e-01   -4.616044903669418e-01   +5.200476806002193e-02   -1.514855182810969e-02   -2.884268252575725e-01   -2.806642108814538e-01   +3.596471320880009e-01   +5.540222511383921e-01   +1.289998176060372e-01; +3.502949477073845e-01   +3.459573584403727e-01   +3.660045584755932e-01   +4.583683855856508e-01   +4.218801359896420e-01   +6.115178329735871e-01   +7.463090292330238e-01   +3.006450792144245e-01   +2.975502647976235e-01   +4.323003605751521e-02   -1.161212059278554e-02   +1.065100168356496e-01   -5.263341592516689e-01   +1.292946153634945e-01   +8.111446420094633e-02   +1.031467579507169e-01];
L2I_L2E_iAMPA_netcon = [+1.743063427203548e-01   +5.988414369969368e-01   +5.581172241920587e-01   +1.119279588058951e-01   +9.422252489730702e-02   +4.614871841777480e-01   +2.803406517528435e-01   +6.999486281498503e-01; +6.939912183217291e-01   +6.021010948664202e-02   +9.258660717490027e-01   +6.637617693779232e-01   +3.603357648746195e-01   -7.849253083492453e-03   -6.676206945288309e-02   +2.789521406726211e-03; +1.019623016626983e-01   +3.664527249570064e-01   +6.046437790801069e-02   -1.249262415435319e-02   -1.041667259926911e-01   -5.258522155797159e-02   +4.073562491116265e-01   +1.247007171629170e-01; +3.109629895164817e-01   -4.407225072545560e-02   -3.050679268848780e-01   +3.230419833374096e-01   +3.909282503633334e-01   -3.722779306660248e-01   +6.359993696023799e-01   +1.268302990589210e-01; +3.672564249911582e-01   +1.135491452430592e-01   +4.434976456239370e-02   +5.482025956038167e-01   +5.027384790376623e-01   +5.508167607786216e-02   +6.451689032648449e-01   +4.921969852361070e-02; +3.870648472869087e-01   +4.292882755691988e-01   -6.174461535050609e-02   +6.053449826450463e-01   +7.046740325293084e-02   +3.038775859292997e-01   +1.877602360018841e-01   +1.718434363639430e-01; +3.210067751380649e-01   -2.399573916187502e-01   +4.879053098994240e-01   +6.861848748176816e-01   +7.605268844561733e-02   -3.460493661037017e-01   +7.487451400148118e-01   -8.346272401734089e-02; +2.772235161342849e-01   +2.591731405043914e-01   -5.107013334769538e-01   +3.090071100581098e-01   -6.816473198899992e-02   -9.082566633567750e-02   -2.555716636398363e-02   +6.962484590916433e-01];
L2E_L2I_iGABA_netcon = [+6.671039643894185e-02   +4.649813398144136e-01   +5.434233745517407e-01   -2.080675862706122e-01   -2.086734961478339e-01   -1.427425425524163e-01   -1.192265915907880e-01   +4.556218433557002e-01; +1.434938152772188e-01   +1.563751379312900e-01   +2.538538999966137e-01   +8.756434154139131e-01   +4.902670335835624e-01   +2.081596038941847e-01   -4.862000940707870e-01   +2.948246351347922e-01; +1.341641704361447e-01   +8.276784538056420e-01   -3.029729955044451e-01   -3.639265421269213e-01   +2.371380441110235e-01   +5.854659857214961e-01   +2.699415784719640e-01   +3.161196999553643e-01; +3.747234397645600e-02   +6.116990886652058e-01   +9.484149270501935e-02   +7.262912643242605e-01   +7.960131493391450e-01   -3.104722114049444e-01   -2.916609235800095e-01   -1.148009258949656e-01; -1.471719878943283e-01   -3.376606202356923e-01   -1.939962658542546e-01   +2.755650103877244e-01   +7.226192687215111e-01   +1.908560905479791e-01   +1.654553608846528e-01   +1.344230938432427e-01; +7.840030190923009e-01   +5.287294663159012e-01   +3.006588065276008e-01   +6.352891062787913e-01   +3.103568010554185e-01   -5.277850520579035e-01   +6.146229705542242e-01   -3.364311312888468e-01; +1.700177031814151e-01   +1.669949819809257e-01   -3.203462688129703e-01   +5.414995181237096e-02   +3.192313454603866e-02   -4.395998676592259e-01   +3.778817944095227e-02   +8.579181483073413e-01; +8.581918184386401e-02   +4.074821201558493e-01   +5.800893825626376e-01   -6.031067653934685e-03   +1.776667111679156e-01   +4.188901268414574e-01   +3.308715737667248e-01   +5.708383261049854e-01];
L3E_L2E_iAMPA_netcon = [+3.887608815071203e-01   -3.329727118568920e-01   +1.278650169575277e-01   +2.980870902416416e-01   +4.423352698181981e-01   +3.124144412889279e-01   +4.807404228757014e-02   +5.396697421162312e-01   +2.577788929940743e-01   -1.327861055751205e-02   -5.814404590658143e-02   -2.731828251637463e-01; +2.246339861115157e-01   +3.853622390341269e-01   +6.308453147744876e-02   +2.271598547750905e-01   -3.466785818546610e-02   -3.746795580931566e-01   -8.884531791128068e-02   +1.240953893509916e-01   -3.847302452445855e-02   +2.210801163239776e-01   -6.742972255287781e-02   +6.353513641453477e-01; -3.466063869243730e-01   -2.127834543590413e-01   +5.641545292220577e-01   +4.063508906569514e-01   +5.831850678095469e-01   +1.197070092709704e-01   +4.275040852172226e-01   +3.441593308942773e-01   +7.712037200113053e-01   -2.808539843574493e-01   +5.857492654191155e-01   +5.159868441373501e-01; +2.918968380216163e-01   +3.649342867835755e-01   +4.473964701445626e-01   +1.875712281737467e-01   +5.513785182284013e-01   +2.377836989546606e-01   +1.232567662261876e-01   +3.614356477219998e-01   +6.129917521809673e-02   -4.068668271350390e-02   -1.883987926759875e-01   +6.128404600334013e-01; +2.003392018272694e-01   +2.275331043208574e-01   +2.728723253286637e-01   +6.443746744663434e-01   +5.489367997771271e-01   +4.150968714678856e-01   +7.837313942809364e-02   -5.056910673950144e-02   -4.979066364459162e-04   +5.332453253996636e-01   +5.576135459335497e-01   +6.369011649673280e-01; +2.882104652997892e-01   +4.438743798499771e-02   +5.761989497235233e-02   -1.833810434630847e-01   +3.455910111699034e-01   +5.550209441081830e-01   -1.771714397915545e-01   -2.503833921394686e-01   +3.506387191994135e-01   +3.010223882676708e-01   -1.496207782948606e-02   -1.247347516219843e-01; +2.388198454045605e-01   +2.605335173857046e-01   +5.615053582915704e-01   -4.598481067557432e-02   +2.989378650571071e-01   +2.031205983070428e-01   -9.965008481243753e-02   +7.118218104928263e-02   +2.641021127132487e-01   +6.007370569993582e-01   -9.558044087806895e-02   +3.775396846444418e-01; -2.370411443344804e-01   +8.453675352983304e-01   +3.161981960700136e-01   -6.962835036789865e-01   +4.747482028601666e-01   -7.815708474641127e-02   -2.778174112280892e-01   +3.344152483126361e-02   +2.283166514065467e-01   +2.652335813306282e-01   +7.869548323408584e-02   -2.533543460415576e-02];
L3I_L2I_iGABA_netcon = [+7.223728779347696e-01   +5.490955091693894e-01   +2.708721365294875e-01   +3.616709448063501e-01   -4.922260262464235e-01   -1.051773524141644e-01   +9.743807352146016e-01   +5.571242865647767e-01   +6.637654036627025e-01   +4.197636328359080e-02   +9.100497337221330e-02   +3.732832375776411e-02; +2.046228221345894e-01   +2.220309739397124e-02   +4.605428231599949e-02   -2.942605919611559e-01   +5.426833621351377e-01   +1.770112378958611e-01   +2.924786978772084e-01   +3.981319243741284e-02   -9.170609145505892e-03   -3.301574996026451e-01   +3.483354739572559e-01   +1.379324338151709e-01; -9.909109575312855e-02   +3.292861966785632e-01   +2.411806075539602e-01   -1.744653665317853e-01   -6.650936172718867e-02   +3.530636695713145e-01   +2.729333876288589e-01   +2.144531461881710e-01   +2.639862477322725e-01   -1.241074091625736e-01   -5.244991420590960e-02   +8.831499327786949e-01; +5.589709077443806e-01   +4.544882290533926e-01   +7.342601180660105e-01   -1.012321112976171e-01   +2.138539560585253e-01   -2.263392202785234e-01   +2.723823657797821e-01   -2.342689814852775e-01   +3.136719471796638e-01   +5.969621609531176e-01   +6.001003796893657e-01   +1.977425266047124e-02; +5.271933055552255e-01   +1.810940377279416e-01   -1.626507377644389e-01   +9.783487191374077e-03   +5.730814389636584e-01   +3.519612351743512e-01   -2.397764625552136e-01   +7.975111178174746e-01   +5.574883324032992e-01   -1.316255868756305e-03   +3.357124111764253e-01   +2.744726186774383e-01; +6.624178902290827e-03   +4.320818301791876e-01   +5.927065467256155e-01   +1.781985315371673e-03   +5.084782336957917e-01   +4.576291817182753e-01   +8.356269237835978e-02   -2.748937192734812e-01   +5.334644541840723e-01   +4.874870449581056e-01   -3.166755561343871e-01   +1.459075929271201e-01; +6.433528242421866e-01   -7.550367873568584e-02   +5.609657446305067e-01   +2.340103615631164e-02   +6.566060377648562e-01   +6.127292747906725e-01   +4.623037940580171e-01   +2.098126767335873e-01   -4.792630741114367e-01   +7.882314988977516e-01   +1.270215379421122e-01   -1.176476834259494e-01; +1.741842941126386e-01   +3.274262799311946e-01   +3.838042403265647e-01   +3.586293113526074e-01   +1.409769736128412e-01   +4.821315406453591e-01   +8.330360793879661e-01   +8.758796763537202e-01   +4.971407946579149e-01   +2.806166637689034e-01   +2.417738097916970e-01   +4.826716427353862e-01];
L2E_L3E_iAMPA_netcon = [+5.050920544247560e-01   +2.215549994585831e-01   +7.301887454946707e-01   -6.669382307983530e-01   +1.658149423837962e-01   +3.769726705350808e-01   +5.539042222897117e-01   +5.392064744503520e-01; -1.132808242647122e-01   +3.207255255552931e-02   +1.627797083507153e-01   +4.946453582184097e-01   +6.061564435564590e-01   -2.028336745743456e-01   -1.657647463698756e-01   -5.277570377095366e-01; -1.676508817182103e-02   -2.391980380707874e-01   +1.071892947739644e-01   +3.991619455578274e-01   +4.054532416861724e-01   +1.405076275212059e-01   +4.628857969921289e-02   -4.238202379223820e-02; +2.303027717588877e-01   +3.422174845261602e-01   +6.713435176914007e-01   +7.826435521472526e-01   +1.602305126415488e-01   +8.604800827920116e-01   -2.424209723317348e-01   -3.981654018294559e-01; +1.272576497922734e-01   +2.361577555600673e-01   +1.026126943019049e-01   +5.037169393415298e-01   +2.454099299793259e-01   +2.133185283284317e-01   -7.354734938375956e-02   -1.986959137613696e-01; +1.331360287571564e-01   +6.173737895889639e-01   +4.668062976499422e-01   +7.653886536148733e-01   +2.150082866172072e-01   +1.083250549004145e-01   +2.046966695348150e-01   +3.374741887041945e-02; +1.721091463912602e-01   +8.202775872539736e-01   +7.355927516615842e-01   -2.349117565185738e-01   +1.005992246685879e-01   -3.832850607078809e-02   -5.662235278035115e-02   +1.964698936398298e-01; +5.094602477799155e-01   +3.820387561258488e-01   +1.721023941391877e-01   +2.973453744556021e-01   -1.214319744632215e-01   +1.772366105211338e-01   +6.865540806900240e-02   +6.302075943513235e-01; +8.058352262076439e-02   +6.679230685568859e-01   +4.601213478445510e-01   +2.759656668281546e-01   +2.993170362993208e-01   +1.008998254490465e-01   +8.473785760283230e-01   -1.152052661935561e-01; -6.212728948670383e-02   +1.776990778867564e-01   +3.306188826638797e-01   -3.687004917561822e-02   -2.628252737137891e-02   -3.380954484243386e-01   +3.358332660846978e-01   +6.325111801593587e-02; +4.376171860499289e-01   +1.896538442200557e-01   -2.664749727934869e-01   +1.000000000000000e+00   -3.910015486235468e-02   +5.727306844014763e-01   -1.580953776620369e-01   +3.081505298048299e-01; -3.425579689105508e-02   +7.406884543183909e-01   +2.094381369981349e-01   +6.421605056248642e-01   -4.411928909995000e-02   -8.520936353452273e-02   +1.214414857491213e-01   +1.508082508051757e-01];
L2I_L3I_iGABA_netcon = [-7.427524891331137e-02   +1.450703683329032e-01   +9.254497974168487e-02   +5.928050791041312e-02   +3.175825218907862e-02   +6.936934695312059e-01   +3.458176819557598e-01   -1.158586992896147e-01; -1.715669691810441e-01   +2.793281978849787e-01   -1.714701411411332e-01   -5.324109999382737e-02   +1.263218103738664e-02   -2.495106169019133e-01   +4.458464753979933e-01   +3.655683696905245e-01; +6.400439549184157e-01   +1.000000000000000e+00   +2.667322744809133e-02   +5.333646503990025e-01   -9.007561983810980e-02   +7.380676080615972e-01   +1.257701344997369e-01   -2.364450214632477e-02; -2.346609809891453e-01   +1.506313637762576e-01   +7.400812442410976e-01   -2.756835251535963e-01   +7.390911249652067e-03   +7.295699110849795e-01   +3.328154747790996e-01   +3.418889567538709e-01; +5.072824980270366e-01   +2.225539465938095e-02   +3.935029385587961e-01   +3.613155520531489e-01   -1.326127665511269e-01   +3.448929172429051e-01   +2.756009730677919e-01   -8.941846375768202e-02; -8.844614370974460e-02   +3.531821577774522e-01   +6.237169101026597e-01   -1.517471470223015e-01   +3.604115866284407e-01   +7.163856140348147e-01   -3.237459080404071e-01   -6.679242395158133e-02; +2.267698088347280e-01   +3.517534337294890e-01   +8.299009154728587e-02   +3.929384118814958e-01   +1.173063437103237e-01   +2.054587903396767e-01   +8.599442344678737e-01   +5.697507038242252e-01; -4.209585707571014e-01   +2.199066474548517e-01   +5.278588010235791e-01   +4.215686642177367e-03   +5.588413751765716e-02   +4.376172108131207e-01   +3.844593398557691e-02   +7.750791022436015e-01; -5.871147632912200e-01   +5.856357720437770e-01   +6.453479555504745e-01   +1.295426701583948e-01   +3.191636673328329e-01   +1.550300463576593e-01   +3.726466304030323e-01   +3.171163133833552e-01; +1.370871828397347e-01   -1.756617072925758e-01   +1.453341966607761e-01   -1.090840589257535e-01   +2.478613874280760e-01   +5.715530502599835e-01   +2.242253970586414e-01   +2.797492390880852e-01; +5.276260673748232e-01   +1.609574458321392e-01   -4.419959666739781e-01   +2.919633303632292e-01   +1.791008123109041e-01   -1.301702304823541e-01   +4.966478576271562e-01   +4.500611301430496e-01; -4.629624144995786e-01   +7.516670926800257e-01   +1.571101614931413e-02   +6.710730715810058e-01   +5.308570193924953e-01   +3.187073502384644e-01   +4.467502305499321e-02   -2.722105150205705e-01];
L3I_L3E_iAMPA_netcon = [+9.639634531136630e-02   -2.827803906685928e-02   +3.239673477921660e-01   +2.687294832768243e-01   -4.230361031540966e-01   -1.534379815913236e-01   +2.849153102454171e-01   +3.677272604588220e-01   +3.327158776894209e-01   +6.427357787570226e-01   +1.504227212049066e-01   +3.871387801026045e-01; +1.843149273516436e-01   +1.214118428484267e-01   +2.543983253550993e-01   +7.620040152764730e-01   +1.963701213465492e-01   -2.301850906812765e-01   +3.646145271884224e-01   +3.979606610470717e-01   +4.825926429327019e-01   +3.047980401006828e-01   -2.740870358711065e-01   -2.414047896936805e-01; -1.154354752327513e-02   +4.809443685243892e-01   +4.357152727881038e-01   -2.359335519521284e-02   +7.753982315333688e-01   +3.088837430376531e-01   +6.277774788977212e-01   -2.097168513417813e-01   +3.228119985878591e-01   +4.687434300837194e-01   -5.020021339088417e-03   +4.152723056732400e-01; +3.566055303861050e-01   +2.706604897844966e-01   +4.837469866652040e-01   -1.108932144015873e-01   -9.077406988106627e-02   +3.101310994208786e-01   +1.295794913804578e-01   +2.723960993819379e-01   +9.772522545254117e-02   +2.924595930044821e-01   -1.034806485909098e-01   -1.067294645779527e-01; -5.824401079484591e-02   +1.508973817964665e-01   +8.329910628789312e-01   +4.522178347746303e-01   +1.361070231148040e-01   +1.808122558661349e-01   -7.536695507999407e-02   +3.823836891607094e-01   +2.991107269521076e-01   +3.393733765412192e-01   +2.919163951158334e-01   +1.150789356500670e-01; +2.166301460955299e-01   -1.358616566311226e-01   +4.823345365219116e-02   +1.607869216232216e-01   -1.727465507370389e-02   -1.607591404355525e-01   +2.120895638764725e-01   +1.639355707217543e-01   +4.377524637549707e-01   +1.960065814764363e-01   +1.774624557840185e-01   +7.480132505310778e-01; +1.221233869186943e-01   +7.389624511567933e-02   -2.561552124586749e-01   -1.912154233019148e-02   +4.527440704826561e-01   -1.123065415183865e-01   +6.681860163318039e-01   +3.131692925756367e-02   +2.603628173912683e-01   +2.199002616133430e-02   +3.941824205215699e-01   +1.533127907619306e-01; -2.141301594058457e-01   +2.092592629293744e-01   -7.344258502875722e-02   +9.335581328943782e-02   +2.617507203138275e-01   +2.068415249601278e-01   -1.862689400741005e-01   +1.115189106238999e-02   -1.148291248399554e-01   -4.042234278361713e-01   -1.476812951946594e-01   +2.104829139099140e-01; -3.030268269352878e-01   +6.159963104993718e-01   -9.722200558110783e-02   +3.569404729344141e-01   +8.484217287814530e-02   +5.080458623878078e-01   +2.937791670415794e-01   +5.620629037534765e-01   -6.677910161778786e-02   +1.241100228391535e-01   +3.280417621306310e-01   +6.688837960034453e-01; +7.148839354336372e-01   -5.016580093386811e-01   +6.374355425946856e-01   +3.042347186194269e-01   +1.137819090357138e-01   -4.105024774839524e-01   +3.884969483060881e-01   +3.784241924250190e-01   -8.119550632449071e-02   -2.085502090814516e-01   +9.211671700437929e-01   -5.004541352247004e-03; -3.631420447492917e-01   +4.366999759643837e-01   +7.865789133212147e-01   +3.156098332220696e-01   +1.153918840499751e-02   +2.720781518194691e-03   +3.354481490275550e-01   -7.311405522379422e-02   +5.259638849910713e-01   -2.138935764922245e-03   -1.061795012075387e-01   +4.521923440937039e-01; -1.670195115124901e-01   +1.404086938632632e-01   +1.023057800958806e-01   +5.860618123201660e-01   -1.521161049322494e-01   -1.564108047302782e-01   -2.829727484548486e-01   +2.125371437748856e-01   +3.225916111025068e-01   +2.021695793337539e-01   +3.193139422006221e-01   +8.434892549237181e-03];
L3E_L3I_iGABA_netcon = [+6.709894718976184e-02   +2.952540769776207e-01   +1.437901313748437e-01   +2.329101061065449e-01   +2.079150357270680e-01   +5.312061427784329e-03   -1.932250830378819e-01   +3.190885541938658e-01   -1.903112201291984e-01   +6.646603341450330e-01   +6.274429784894339e-02   -1.174864078408673e-01; +1.293315313687617e-01   +5.679695381004604e-01   +3.871305572419645e-01   +2.290283600772347e-01   +6.446124013296715e-01   +5.112964765271915e-02   -4.301467434413683e-02   +2.975191234872489e-02   -5.511227890157726e-01   +1.985427021353656e-01   -5.798114732237336e-01   +3.224554105127693e-02; +9.248960725066982e-02   +9.323068643921166e-02   -4.434928812777835e-01   -4.106046900939378e-02   +2.378243996558424e-01   +9.380927417036228e-02   +3.751546251297930e-01   +2.499138363923437e-01   -7.957954291323134e-02   +2.451661990073310e-01   -2.215546243717729e-01   -3.085452127148079e-02; +4.052883924512242e-02   +3.463744203349385e-01   -6.762848296747552e-01   +4.460425447843964e-01   +9.604061846097129e-01   -3.866976837012850e-02   -9.629022348146419e-03   +4.643498614547209e-02   +8.301107496712353e-01   +4.085382107069982e-01   +6.889225173224305e-02   -5.920991053907815e-02; +2.700243740219022e-01   +5.271736029097768e-02   -7.193369682894103e-03   +5.311644422653629e-01   +7.874177544346940e-02   +5.566232675937553e-02   -9.406282457435003e-02   +7.344708247688427e-01   -2.856107133306687e-01   +5.528581112811738e-01   +2.746255569499393e-01   +3.338543428488035e-02; +7.643001525173551e-02   -2.699673696267377e-01   +4.930091396094811e-02   -1.202086475401204e-01   -6.238337225809090e-03   +3.536556157621314e-01   +2.713352847958053e-01   +1.967557816428270e-02   +5.777619653574537e-01   +3.353622400851464e-01   -2.668517540977452e-01   +2.528140204431545e-02; -1.211856525176156e-01   +9.354949392992076e-02   +2.027378784327537e-01   +8.719798383684804e-01   +1.022486981250460e-01   +3.987478114705277e-01   +4.034025792178632e-01   +4.402033081634284e-01   -2.040625580828653e-01   +3.823128516061061e-01   +4.794016667545741e-01   +2.398621751928495e-01; +1.763694583028477e-01   +2.707522269337362e-01   +3.172525419868025e-01   +8.954097554708472e-02   +3.792314412845201e-01   -4.688469296328640e-01   -2.447000175724363e-01   +6.213171142974946e-01   -9.582109038020417e-02   -2.431360847767290e-01   +6.607646395811531e-02   +2.881918071684903e-01; +3.090901549152992e-01   -1.557030906828794e-01   +3.634757099345378e-01   +4.256696539933438e-02   +3.058450269405570e-01   +7.413898368733041e-02   -6.265108897271986e-01   -1.093131893472486e-01   +5.716028443838815e-01   +4.283777498249428e-01   +1.496341938930340e-01   +5.397345117541904e-01; +1.138301610356571e-01   +1.061316190127460e-02   +2.469472835396142e-01   +6.752479117025541e-02   -6.630866900321306e-01   +7.252343350392215e-02   -1.936624246142135e-01   +2.086597852180101e-01   -1.141178700599259e-01   +1.544272761793107e-01   +9.314002803977493e-02   +7.044712959926640e-02; +1.217625876372161e-01   -2.002215356195947e-01   +3.469429573367534e-01   -1.076432215076098e-01   +1.628767038311990e-01   -6.161261751237643e-03   +3.346333556312148e-01   -1.341169619979719e-02   -1.793598958467497e-01   +6.774804512944511e-02   +2.809876818416865e-01   +3.256014846922307e-01; +3.724237986999296e-02   +3.968245359442213e-02   -2.876167135491273e-01   -1.662900081225765e-01   +9.829906305561501e-01   +5.869155854373419e-01   +4.992682424921925e-01   +3.920997832709006e-01   +1.729653897440635e-01   -2.706775540508538e-01   +4.052229966329249e-01   -1.796136916391685e-01];
L2E_Input1_iAMPA_netcon = [+7.078805852570228e-01   +7.806831823420365e-01   +5.107675358369159e-01   +6.456684981298023e-01   +9.501698258485387e-01   +3.185658880944933e-01   +5.327719320609760e-01   +5.757753288221772e-01];
L2I_Input2_iAMPA_netcon = [+5.235720049490391e-01   +6.742037492158074e-01   +6.783795095943199e-01   +4.914441759667301e-01   +1.578063523168908e-01   +1.000000000000000e+00   +2.049913109318565e-04   +4.482890444598021e-02];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last =  11.21 * ones(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.2*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.2*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.2*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.2*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.2*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.2*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.2*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.2*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
