function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+7.642250582325039e-02   +1.339944679825913e-01   +9.762051786647208e-02   +2.771885328034330e-02   +1.795951833683791e-02   +7.453284102623675e-02   +3.114214830211639e-01   +3.089019993444728e-01   +2.839680704989965e-01   +3.029600602311335e-01   +1.002024098682700e-01   +2.250372645109466e-01   +1.705331359764107e-01   +1.435863684568603e-02   +2.703369973289447e-01   +5.461686142734146e-02; +2.330011338327642e-01   +2.591048756130918e-01   +1.258671518700467e-01   +1.454988343989990e-01   +3.062467555447049e-01   +3.100009142893245e-01   +1.356521770384720e-01   +9.909861344285889e-02   +2.934315731439411e-01   +2.809347985160071e-01   +1.214061853330041e-02   +8.281088695479463e-02   +2.503773870492007e-01   +3.294306383685021e-01   +1.251351404118011e-01   +3.183992175138899e-01; +9.751920765074781e-02   +2.210595889142890e-01   +3.353918060730717e-02   +3.237006685224192e-01   +1.602632138661729e-01   +1.693565788054921e-01   +2.593703923652619e-01   +3.034188241255305e-01   +2.377333477489927e-01   +4.754625686092469e-02   +4.414812455722184e-02   +1.241264919332718e-01   +1.914817327109067e-01   +1.711950723111966e-01   +2.599563413385559e-01   +1.397661863704645e-01; +1.894386927200351e-01   +1.659643946613100e-01   +2.169660145270261e-01   +1.866059780744532e-01   +2.405599250835000e-01   +1.421060455723793e-01   +2.868856243702411e-01   +1.634572510219045e-01   +1.973340635104515e-01   +1.980409576441580e-01   +3.162320224348374e-01   +2.227977362970431e-01   +3.973403031641571e-02   +3.045199969157030e-01   +1.573278354536815e-01   +1.052669266812049e-01; +3.119345257001896e-01   +1.865259589409961e-01   +1.834784110126496e-01   +1.882488664474020e-01   +2.025187799086631e-01   +2.210435777721187e-02   +3.039085221690714e-01   +1.597764120347299e-01   +1.000744037915479e-01   +2.824135682581675e-01   +1.639041885692084e-02   +2.788955354679135e-01   +9.583827388036811e-02   +3.161619528303146e-01   +5.901777291495797e-02   +2.664875000644242e-01; +2.900604904934973e-01   +7.839008999621291e-02   +2.023147000118951e-01   +1.554255839034496e-01   +2.262059272172202e-01   +5.068611428897213e-02   +1.692642674737366e-02   +7.951926262890097e-02   +2.882314950245631e-01   +2.088072951461285e-01   +7.046817913030892e-02   +3.286211565588071e-01   +1.184790079678246e-01   +2.936784228728861e-01   +5.679028377935552e-03   +9.280304746182319e-02; +8.320490952939748e-02   +2.013026027708086e-01   +2.709323198380614e-01   +1.190676502547515e-01   +2.318969314098607e-01   +2.233163492473280e-01   +1.974422320542423e-01   +1.375057608829494e-02   +2.929944178584577e-02   +1.379310615432534e-01   +1.783411581487508e-01   +2.595215298538103e-01   +2.365326366562557e-01   +3.051761387175050e-01   +1.312904736177727e-01   +2.701961650870798e-01; +9.850913851679838e-02   +1.807055237949072e-01   +9.906257548130556e-03   +3.057869405478989e-01   +1.226056976331571e-01   +1.517597118410285e-02   +2.381706604195520e-01   +2.790494217559239e-01   +9.857345684988278e-02   +6.634720065590854e-02   +7.285578456052005e-02   +3.177343511447909e-01   +2.673796995683065e-01   +4.846145865559347e-02   +1.302846846961626e-01   +7.559555254308586e-02; +2.462846914492345e-01   +1.857793684847924e-01   +2.197626021773975e-01   +1.647629473163487e-01   +1.968280895071855e-01   +3.028038017885247e-01   +4.480711382282335e-02   +2.464716031732953e-01   +1.616442406169439e-01   +8.513454245549471e-02   +2.398314978579824e-01   +3.079589184727763e-01   +9.653610175337085e-02   +1.354795351007054e-01   +3.185501846846712e-01   +2.984774126332739e-01; +2.604434589977785e-01   +8.162495622754383e-02   +4.694350574283921e-02   +5.457206267331543e-02   +4.648127218480920e-02   +2.994719163510183e-02   +1.104539489762294e-02   +2.986414067655570e-02   +1.199575304268103e-01   +2.387246325929054e-01   +1.205244970281120e-01   +2.891968906202115e-03   +1.983016832021391e-01   +2.268638918311930e-01   +3.605521602182841e-02   +4.605040380221730e-02; +3.259324420911573e-01   +3.127905206788270e-01   +2.551584331733605e-02   +1.770460592308232e-01   +1.972925343808772e-01   +8.291839232135251e-02   +2.621236579009620e-01   +2.543806382705453e-01   +1.250383745367921e-01   +2.081433072393823e-01   +2.764311574195875e-01   +2.797571262172920e-01   +3.810176311465906e-02   +1.899279612304828e-01   +1.283227947220026e-01   +1.675171805722676e-02; +2.724656457330994e-01   +3.192611645297614e-01   +1.496190961305333e-01   +1.524296478498315e-01   -8.206480992031151e-04   +1.463993650927916e-01   +2.839126775606432e-01   +2.218157391704581e-01   +2.690519040931263e-01   +1.336671949513954e-01   +2.583598431179071e-01   +1.861394557368715e-01   +2.072218540367361e-01   +1.414390365851595e-01   +2.614874951802291e-01   +2.652161393735697e-01; +2.710136401279126e-01   +7.748067919851247e-02   +1.240536743082107e-01   +1.071551215748322e-01   +3.063784352832425e-01   +1.030984443480746e-01   +2.507693820841888e-01   +2.095861580228237e-01   +1.714770826150858e-01   +2.365671915502372e-01   +1.752224660628694e-01   +1.575031443476481e-01   +2.539521774904028e-01   +5.557397165513107e-02   +2.702060625745310e-01   +5.206908691535574e-03; +8.917600509417056e-02   +6.236819916931037e-03   +1.375345825088188e-01   +1.403904559365241e-02   +2.872718005311897e-01   +2.024808421996734e-01   +2.563232091851686e-01   +2.099833381676009e-01   +2.283269568483595e-01   +3.054005673008408e-01   +1.791075995078117e-01   +4.144524154919840e-02   +5.586718562271064e-02   +3.113726569761611e-01   +1.473926006024434e-01   +1.241106702978127e-02; +8.900203855364926e-02   +2.243311198993067e-01   +1.071684607427057e-01   +8.655660929491582e-02   +2.514323864827346e-01   +1.549561199935761e-01   +1.820951075507074e-01   +5.424721205838588e-02   +4.750728646292623e-03   +2.891183618260685e-01   +2.453331851312726e-01   +2.853831376230034e-01   +3.692741706994031e-02   +7.497927541893316e-02   +2.968944284124193e-01   +1.747821094365595e-01; +2.171716401443677e-01   +1.357818558963381e-01   +1.895089881270750e-03   +3.226441483152180e-01   +2.427423653382155e-01   +1.839547439790135e-01   +1.203400172248242e-01   +3.049130776884039e-01   +2.100934587476926e-01   +2.870894410706889e-01   +2.315258910110132e-01   +4.734238982397604e-02   +2.834800398242816e-01   +2.759430670090577e-01   +2.253568161141069e-01   +8.897303657922910e-02];
L1E_L1I_iGABA_netcon = [+2.357419699090622e-01   +3.285078917857627e-01   +2.587922139315377e-01   +1.458687258958163e-01   +2.452425745389929e-01   +1.169532304455911e-02   +3.089019763794658e-01   +3.088280743769397e-01   +2.975633584882952e-01   +1.303570734127971e-02   +8.477573680659779e-03   +1.435014971909350e-01   +9.494650300854855e-02   +1.588794301512035e-01   +1.142391287843775e-01   +1.428839748723453e-01; +1.508951444742028e-01   +3.224154886319178e-01   +1.363191388900439e-01   +1.629823435571179e-01   +9.117647966421837e-02   +2.729951756745256e-01   +1.836259649768626e-01   +3.242100899935731e-01   +2.969578178734539e-03   +1.803787812398747e-01   +1.197339734107385e-01   +9.152293090880637e-02   +3.090038611125671e-02   +1.101303665558465e-01   +1.315730187251324e-01   +2.835807061042771e-01; +2.772365139036361e-01   +2.810357282922368e-01   +3.174665561343105e-01   +2.688123435506243e-01   +4.943333901089249e-02   +2.576805565257503e-01   +1.232280381641494e-01   +1.232626653086113e-01   +1.167718469473560e-01   +2.688328180222294e-01   +1.406528256461362e-01   +1.827368404730352e-01   +2.684163567130147e-01   +2.043873220875104e-01   +7.903133258583991e-02   +2.563885300088074e-01; +3.524100665230434e-02   +2.276500465326315e-01   +1.146609851777645e-01   +1.959188637375737e-01   +3.206528697116005e-01   +1.294994678808201e-01   +1.188128717989212e-01   +2.566135681614267e-01   +2.336841960307881e-01   +2.411388888346958e-01   +1.894581329268856e-01   +3.229244771929454e-01   +1.132743275278265e-01   +2.319828466277443e-01   +3.181869890045855e-01   +2.533336140448747e-01; +1.285832260764934e-01   +1.547365992541043e-01   +1.753646966150550e-01   +3.141173055598887e-01   +1.268144833323646e-01   +1.245125130883235e-01   +1.852928347452180e-01   +3.202593594170102e-01   +1.066774607055035e-01   +1.126501153786053e-02   +3.014403685815712e-01   +1.388101597687371e-01   +2.681426645836216e-01   +2.821927715945420e-01   +1.935480238705233e-01   +4.324864837329501e-02; +3.231149617401661e-01   +1.956548908699162e-01   +3.264643023953725e-02   +1.039635393501663e-01   +1.564206430165755e-01   +7.373286889284129e-02   +2.306613105312954e-02   +8.742014833258835e-02   +2.373896548059159e-01   +3.069350122996858e-01   +1.333750290882529e-01   +1.930782257877728e-02   +2.071747206777860e-01   +1.782786442162419e-01   +6.249750416148518e-02   +2.461683574990613e-01; +2.759692545377288e-02   +7.089772841279489e-02   +2.155016382878300e-01   +8.666410642335243e-02   +1.661955230559945e-01   +6.938641253599606e-02   +1.215603471684237e-01   +3.591463683253926e-02   +1.242226681501008e-01   +2.670989405776860e-01   +2.516846616382659e-01   +1.094036805590865e-01   +1.275997475594234e-02   +7.601984098162801e-02   +1.983177913830270e-01   +1.593435810458700e-01; +2.930631094851293e-01   +5.689603581584505e-02   +9.715670557474744e-02   +2.149318382259837e-01   +2.071413203738436e-01   +1.357093687135346e-01   +7.019328430813881e-02   +1.144416785596458e-01   +1.975362049077781e-02   +3.647756030207817e-02   +6.214550571945532e-02   +3.070579133226973e-01   +4.603894553333542e-02   +1.011661329282010e-01   +2.255752721384227e-01   +2.834289520267350e-01; +5.414470513753623e-02   +1.367810036451610e-01   +9.199663529254330e-02   +1.223768946395020e-01   +9.612210149385399e-03   +1.631633014406599e-02   +7.092360386055961e-02   +8.182534231540738e-02   +2.235579429415432e-01   +6.988122652274953e-02   +5.646470278973989e-02   +2.730998447381952e-01   +2.151727321525169e-01   +6.819616246158494e-02   +2.736274703902402e-01   +3.015146694669564e-01; +7.290647806603669e-02   +2.058689843552426e-01   +3.322750889171248e-02   +1.489350435346990e-01   +9.858113819651287e-02   +1.815100683066380e-01   +3.028744861844279e-01   +4.839868680438028e-02   +2.877559737975619e-01   +1.509854699928367e-01   +2.274711638330636e-01   +2.844303261469792e-01   +2.110833212263831e-02   +2.114394257198643e-01   +1.326039500027039e-01   +2.882240056223340e-01; +3.128952088179266e-01   +2.494208388355780e-01   +2.926433031930479e-01   +1.106350340970142e-01   +9.122307762186356e-02   +1.774761283980049e-01   +1.040337862055740e-01   +2.203090022966901e-01   +2.484703473878963e-01   +2.679622743424967e-02   +1.760909777050363e-02   +2.226920308157905e-01   +1.576259161596151e-01   +2.606613375764156e-01   +1.268128169494706e-01   +2.693974518600786e-02; +2.986165389343006e-01   +1.153817511010015e-01   +3.208126128677624e-01   +1.122846321541098e-01   +9.887206515163080e-02   +2.626697122619079e-01   +8.331923336343795e-03   +2.645707906220611e-01   +5.529239298068171e-02   +2.513627980664142e-01   +2.792956240714958e-01   +7.192994299742968e-02   +1.681781342866570e-01   +1.566972515513807e-01   +3.086241737322987e-01   +1.302255217488028e-01; +7.428003737913647e-03   +8.876081557258060e-02   +1.144855541577727e-01   +7.503480832236174e-02   +2.343053247323473e-01   +1.427409659903690e-01   +6.759547527646390e-03   +1.716157541314811e-01   +2.049200518194188e-01   +1.424822417975466e-01   +3.251585759821720e-01   +1.313639108713436e-01   +1.527177153274491e-03   +2.397777458583918e-01   +2.869933689453128e-02   +2.773364665494842e-01; +1.624235786975703e-02   +2.675477693134715e-01   +1.998763008909274e-01   +7.659095668350763e-02   +2.163852811778786e-01   +2.104950962409696e-01   +2.620867044982864e-01   +6.720540853456428e-02   +2.874224858533497e-01   +2.947452820999901e-01   +1.192484597941761e-01   +4.709238536235352e-02   +3.126132941804804e-01   +3.122616976441431e-01   +1.031463065011346e-01   +2.703775499885828e-01; +3.004343050431605e-04   +2.100030828061507e-01   +2.902385353799210e-02   +1.092087377580839e-01   +6.213291080782334e-02   +2.650976722208073e-01   +2.613939316072936e-01   +2.765731034111044e-01   +1.846354798220664e-01   +1.904021180321866e-01   +1.535704670598163e-01   +1.686983911203412e-01   +1.961776613316802e-01   +7.740989118165159e-02   +1.290328995417675e-01   +1.053424763447020e-01; +1.329028708323798e-02   +1.931989828723497e-01   +1.103874362843726e-01   +1.208180515324500e-01   +3.019322679572908e-01   +2.773297814941756e-01   +7.205120151120527e-02   +2.988371843693216e-01   +2.549150007099070e-01   +5.774767503861274e-02   +1.041691526764985e-01   +2.704416449636756e-01   +3.155252535575674e-01   +2.859590135471057e-01   +1.639460031645862e-01   +1.766067104586281e-01];
L2I_L1I_iGABA_netcon = [+1.365650108198766e-03   +2.147688129021837e-01   +3.282387476255853e-02   +2.854410478031691e-01   +1.679477209483424e-01   +2.510868665385775e-01   +1.415457680783373e-01   +3.980109430702802e-02; +1.001310766087505e-01   +1.534936313753949e-02   +2.413925576072829e-01   +7.406277974034002e-02   +7.079457078668420e-02   +7.144567688055715e-02   +2.776079821153153e-01   +1.699905192143744e-01; +2.165278871350875e-01   +1.248311488160835e-01   +1.438422569401828e-01   +1.950859360317989e-01   +3.260869536828347e-02   +3.138616922923109e-01   +9.150094935195283e-02   -9.280502250747736e-04; +2.563279975521521e-01   +2.992529114735192e-01   +1.947580544876277e-01   +2.047786512576771e-01   +2.215465449151696e-01   +7.430345791479780e-02   +2.991041184341277e-01   +2.627076875012505e-01; +2.078863773190972e-01   +4.934173719087154e-02   +8.334766882817500e-02   +2.854911768528131e-01   +1.583851911606119e-02   +2.753053140687415e-01   +8.700011804524806e-02   +1.589625946213007e-01; +1.985268346875478e-01   +3.077418349769400e-02   +2.917826482550825e-01   +1.389786082081664e-01   +2.461534505154643e-01   +2.763184304384422e-01   +3.337253347554325e-01   +7.219399417120008e-02; +2.538763772940340e-01   +1.059758828105676e-01   +3.190817481747089e-01   +1.939035227099473e-01   +4.785054691156918e-02   +1.185191278892158e-01   +6.500904164772583e-02   +3.027408739945830e-01; +5.893517041933562e-02   +2.688539681844345e-01   +6.212506987517718e-04   +2.735999102455976e-01   +3.178253665381557e-01   +7.877712695545770e-02   +1.685504047257862e-01   +1.027394081650566e-01; +2.168743884402146e-01   +2.194759599099916e-01   +1.072132395878724e-01   +2.325458912894042e-01   +2.091850801005788e-01   +8.767826427736564e-02   +1.275151912829569e-01   +9.362672708793522e-02; +1.777518680712994e-01   +1.050914892556154e-01   +1.386150540509659e-01   +2.232264379606183e-01   +4.052765067336122e-02   +2.478737775795905e-01   +1.580292795880386e-01   +2.028736372055516e-01; +1.587093991197774e-01   +1.996711834356555e-01   +1.373210668560652e-02   +1.247789115977870e-02   +1.552776318881073e-01   +7.903239099566967e-02   +9.382080669111111e-02   +1.576231489975931e-01; +7.899670191053078e-02   +2.082344892083906e-01   +4.313646447384577e-02   +1.246176575972617e-01   +4.912040197976417e-02   +1.839150815456526e-01   +1.421215400674945e-01   +2.061841765800813e-01; +2.503183544561387e-01   +1.966341866585669e-01   +6.799983751116571e-02   +1.724345297214712e-01   +3.698826540573676e-03   +1.995085475772014e-01   +6.290552737390033e-02   +3.034209985225786e-01; +1.673330161269234e-01   +1.687054494294692e-01   +5.606445232147177e-02   +3.221172567761701e-01   +1.382890282004611e-01   +3.282628662314847e-01   +2.273798352165682e-02   +1.901751768991894e-01; +8.861712369370933e-02   +1.546037499408229e-01   +3.971737685309946e-02   +2.002023306709404e-01   +4.512953870780648e-02   +1.103560705629219e-01   +2.559511174041748e-02   +6.906273432998798e-02; +3.839641378566995e-02   +1.963139321073126e-01   +2.123574998204693e-01   +2.754322757090351e-01   +5.591009938100810e-02   +2.967822765055851e-01   +3.131954248338553e-01   +5.430672458930634e-03];
L1I_L2I_iGABA_netcon = [+1.876067713916046e-01   +9.865923365254071e-02   +1.403594432131137e-01   +8.776085750493953e-02   +4.627410557845283e-02   +2.431219798818725e-01   +1.524211732419053e-01   +2.756567752579134e-01   +1.024576832135159e-01   +2.382725651783743e-01   +2.286042555124603e-01   +2.873024080360970e-01   +1.383292682489410e-01   +2.683949635810842e-01   +2.044209513110255e-01   +1.417612317501298e-01; +1.144146261723502e-02   +5.232580703423435e-02   +9.231533796289348e-02   +7.475249288946655e-03   +3.016170564987724e-01   +2.189156333794473e-01   +2.451698106494329e-01   +2.204047013682260e-01   +2.146060244809049e-01   +1.243067445150078e-01   +1.088948110197693e-02   +1.331023517277861e-01   +1.915763637267084e-01   -5.706993819199808e-04   +2.633923073911356e-02   +1.999090258198259e-01; +4.185945093079369e-02   +3.595078944659250e-02   +1.335382449350767e-03   +5.324696720163290e-03   +3.222752235148507e-01   +2.182111154184621e-01   +3.054725637971818e-01   +2.831753426811497e-01   +9.092041031032576e-02   +9.815631443296832e-02   +5.663249214830742e-02   +7.432595046716250e-02   +2.885122836049445e-01   +7.345906556271802e-02   +8.958533834460150e-02   +2.163792918017098e-02; +1.706218555967962e-01   +2.755027163878137e-01   +1.688058110140264e-01   +1.068578316003679e-01   +8.927357144613758e-02   +1.787808062509843e-01   +1.411520427951957e-01   +2.498048032280383e-02   +8.592758888358477e-02   +1.815744228422407e-01   +2.959283474410896e-01   +3.042563418035283e-01   +2.849389998227827e-02   +3.747158826847971e-02   +1.181850483258534e-01   +1.914643281944963e-01; +1.376044389479895e-01   +9.511169947173627e-02   +3.312899634700323e-02   +2.908199739559744e-01   +1.833529352740961e-01   +2.762653789591912e-01   +4.253062573573289e-02   +1.758912194419892e-01   +3.073987220793322e-01   +1.878259154410292e-01   +2.892760970717747e-01   +8.983042111509593e-02   +5.090648414781069e-02   +3.202057651844677e-01   +2.775715910512059e-01   +3.186064452714177e-01; +1.059621440271353e-01   +2.353734020082405e-01   +1.038404885801927e-01   +2.535144813923804e-01   +1.398157457137090e-01   +2.458344732563261e-01   +2.678834167497625e-01   +2.158612031978955e-01   +1.292881274791122e-01   +3.139498006992213e-02   +1.856390498128099e-01   +2.849360798032958e-01   +8.859058389029142e-02   +2.030298247722268e-01   +2.964902999647591e-01   +1.140939897697290e-01; +3.102032688064932e-01   +2.764942025562057e-02   +2.274610547596926e-02   +7.681060659806502e-02   +3.239010694301274e-01   +1.916950102927818e-01   +3.088991618381285e-01   +1.374277547029580e-01   +3.077799052562697e-01   +8.591916545789922e-02   +3.185147078464450e-01   +1.723926881059965e-01   +1.432974879186435e-01   +1.802013063692752e-01   +7.505753812153161e-02   +2.502002118021437e-01; +2.411476330336035e-01   +2.146503233413228e-01   +8.815155460152764e-02   +1.006132679798968e-01   +2.770875721397550e-01   +1.294314003119824e-01   +5.488948491351624e-03   +5.034770507441749e-02   +1.230181967232594e-01   +1.022995968344828e-01   +4.034024304507904e-02   +3.015600294050683e-01   +1.180063615256635e-02   +6.649028673460183e-02   +3.150138116109408e-01   +3.156544316604940e-01];
L2E_L1E_iAMPA_netcon = [+3.010882020383212e-01   +1.249579695937507e-01   +2.186998750084951e-01   +1.910619838513687e-01   +2.808985810107704e-02   +1.097846665627969e-01   +2.863843989907469e-01   +1.834611372284133e-02; +1.083519912639652e-01   +9.879272561289762e-02   +2.636113213362237e-01   +7.341590358562186e-02   +2.314406156619802e-01   +1.450152809863298e-02   +1.036385258507743e-01   +2.297627106594454e-01; +9.995069985846432e-02   +5.354547636494001e-02   +2.488050492141098e-01   +2.181851623113472e-01   +1.623167590267595e-01   -7.286317227803905e-03   +7.355133188127674e-02   +1.236857195497969e-01; +1.873640401388335e-01   +6.613240246539139e-02   +8.810724241588515e-02   +3.149509954374566e-01   +1.781896716592572e-01   +7.686582316467398e-02   +2.041119593078569e-01   +4.589360457412709e-03; +6.113970597637756e-02   +1.653661106829715e-01   +2.377233695417927e-02   +1.293815459967153e-02   +8.669115149074932e-02   +1.781590353086268e-01   +7.835537327995705e-02   +8.056907973087236e-02; +8.321742168871508e-02   +1.703701502672470e-01   +5.035317403817808e-02   +1.480511877192031e-01   +2.949507404917712e-01   +3.223249729457656e-01   +1.260615691869369e-03   +2.726711418807523e-01; +1.336688025473489e-01   +1.333426543714826e-01   +3.125041046764286e-01   +1.316964559871635e-01   +8.176188655873209e-02   +3.448984368379313e-02   +1.406501253505405e-01   +1.614731612109494e-01; +6.383296832173968e-02   +2.387380700713866e-03   +2.405487823765670e-01   +2.235464872274440e-01   +9.521509874727441e-02   +1.638309592896990e-01   +2.622031374542158e-01   +2.572784195318953e-01; +8.287456592886842e-02   +2.709225999281487e-01   +1.614141615583572e-02   +2.775241974861968e-01   +2.247037056436861e-01   +8.958263675630669e-02   +9.368974546454548e-02   +1.094185822445936e-01; +4.066931010276988e-02   +2.893457896619344e-01   +2.361880477607530e-01   +2.675178031541705e-01   +1.405518878518961e-01   +3.234424192698524e-01   +3.170494085478093e-01   +2.252836097142976e-01; +2.691820587988911e-01   +1.186162455266902e-01   +1.779141467664932e-01   +4.013194699768389e-02   +1.622314385509164e-01   +2.403445204210947e-01   +9.857096594300611e-02   +6.680719107868296e-02; +1.959632578923168e-01   +3.196136714008223e-01   +1.309283365993425e-01   +2.771695466306259e-01   +3.213096559944076e-01   +2.597196131030502e-01   +1.624948935338292e-01   +3.202402267223355e-01; +1.610436194863677e-01   +1.844310960548706e-01   +6.459796801783448e-02   +2.893627794369876e-01   +4.010945151457332e-02   +1.515807677542164e-02   +7.896312936205072e-02   +1.089649445244056e-01; +1.397291509090405e-01   +1.814920471622549e-01   +2.932346187160650e-01   +1.293259280525391e-01   +1.545983874069626e-01   +2.005775719930403e-01   +2.873971485180375e-01   +1.691910612226296e-01; +2.595960311297373e-01   +8.004067784861012e-02   +1.302619560218974e-01   +6.334096116122621e-02   +7.429244551688144e-02   +2.555608196537170e-01   +3.052163112386368e-01   +2.092104651578674e-01; +1.892142357197638e-01   +1.044697820017305e-02   +9.155982600587267e-02   +2.458466116454048e-01   +1.554371757736066e-01   +2.317379529310873e-02   +1.656189109791410e-01   +2.445810055849575e-01];
L1E_L2E_iAMPA_netcon = [+4.221576287930087e-02   +1.178850575250004e-01   +2.415649065288210e-01   +2.433328055611919e-01   +1.280057577204373e-01   +1.937276065929348e-01   +1.847768689519969e-01   +2.999525096237112e-01   +2.605940541296902e-01   +1.583563187560973e-01   +9.910379356540924e-02   +3.098492859435002e-01   +1.480876355548875e-01   +9.362400775822163e-02   +1.832052913341069e-01   +4.353430308722117e-03; +2.446531963179620e-01   +2.157397002816922e-01   +3.149243587796175e-01   +6.830777642379501e-02   +1.430446460004983e-01   +2.273052790087260e-01   +2.287425215996621e-01   +1.432753428699967e-02   +8.463726102427689e-02   +9.071938972510953e-02   +2.347373220080307e-01   +1.473713399815701e-02   +2.639287659824430e-01   +1.663357116805453e-01   +9.231335470313946e-02   +2.566949734263035e-01; +1.129317735631640e-01   +1.327944702613902e-01   +7.969140608752871e-02   +3.321990513828886e-01   +1.876735785407074e-01   +1.859043564436241e-01   +2.766187781410562e-01   +8.837702043700708e-02   +1.589203107545221e-03   +7.294682590333008e-02   +5.973125881987478e-02   +1.892071237869500e-01   +2.953958711746737e-01   +5.610585449715145e-02   +1.096672458212579e-01   +1.786598038776281e-01; +5.880494146087030e-02   +1.053765020441065e-01   -4.549102999480772e-04   +1.543606918057595e-01   +2.622644131843468e-01   +2.730330340860723e-01   +1.925133492704220e-02   +7.106954921434509e-02   +2.770068941022086e-01   +1.416546662533943e-01   +2.616094931701990e-01   +1.132560966242385e-01   +3.314333099560481e-01   +9.630882215584853e-02   +6.388788186882431e-02   +1.735309397977232e-01; +6.631420826443041e-02   +5.593443645745100e-02   +1.240126564793812e-01   +1.640665682779944e-01   +9.652713396154547e-02   +1.952044335769931e-01   +2.070899935870854e-01   +1.437864974494766e-01   +8.831752495258588e-02   +2.261708238267622e-01   +1.092593804309051e-01   +1.925222466224067e-01   +4.379453570966668e-02   +1.235063811057784e-01   +2.906147340091915e-01   +1.181366826240060e-02; +1.590417247351036e-01   +1.708984384978511e-01   +1.745327059252626e-02   +1.559992048864579e-01   +9.711390163045579e-03   +1.274242819344114e-01   +2.060238573705467e-01   +2.318361158420469e-01   +8.284692704021343e-02   +2.580050595010538e-01   +2.859607920350359e-01   +9.546254209397127e-02   +5.890081939281793e-02   +1.664903545895234e-01   +1.105770038653137e-02   +1.949821360812589e-01; +2.211548897087101e-01   +5.085674887965357e-02   +1.531187739050046e-01   +2.289458956631470e-01   +5.972901195922328e-02   +2.670407306040467e-01   +2.718381562258766e-01   +3.919655012769480e-02   +3.086452332157862e-01   +2.970896130229247e-01   +1.772509463191538e-01   +1.259332436304758e-01   +9.509521944109263e-02   +1.112280138541779e-01   +2.459356622180805e-01   +1.450315098191806e-01; +4.535818530583306e-02   +1.154984811984512e-01   +3.789206240999673e-02   +8.216541107537195e-02   +2.733697900699135e-01   +9.091618894493507e-02   +8.070886085851814e-02   +2.360079666622175e-01   +2.926041044898700e-01   +2.123041461299097e-01   +1.018809645005350e-01   +2.916399394728190e-01   +8.986296355744697e-02   +3.741781750710304e-02   +2.950002284356513e-01   +2.287340225147729e-01];
L2I_L2E_iAMPA_netcon = [+1.892075181022697e-01   +2.572864114806908e-01   +2.745813392389997e-01   +2.923154307125611e-01   +9.997086249273006e-02   +3.245192094625988e-01   +2.655499955860814e-01   +1.521373241996147e-01; +5.233499276472334e-02   +2.317850110507350e-01   +1.687161411298290e-01   +1.999352030113311e-01   +1.112784971929844e-01   +1.283529944283335e-02   +2.549951253495871e-01   +2.085526047099827e-01; +1.500278514972872e-01   +6.759074962788786e-02   +2.964554396263557e-01   +1.936191430655347e-01   +1.682159008899576e-01   +3.134251820847448e-01   +3.170510633465064e-02   +5.081161074500395e-02; +9.701492544397816e-02   +2.440751029480458e-01   +2.740753027198214e-01   +2.295854052525888e-01   +3.236752707859137e-01   +3.122708907013676e-01   +2.001402436780460e-01   +2.908184259182739e-01; +8.839848823875031e-02   +3.461399113931533e-02   +2.946481293125343e-01   +3.176305657740081e-01   +2.627991082625108e-01   +3.404098167854384e-02   +1.942353899455434e-01   +2.628449690178217e-01; +6.017878094944898e-02   +2.631768801474306e-01   +2.276321927500662e-01   +1.721534785318880e-01   +1.934236707694977e-01   +2.660247342737721e-02   +1.977462576774694e-01   +2.692205454037316e-01; +3.017618022509744e-02   +2.336754239686786e-01   +1.873547008859267e-01   +1.492865498850193e-02   +2.917236482341837e-01   +1.329118825168890e-01   +2.476717091177748e-01   +2.773443145570943e-01; +2.683542878234492e-01   +1.062213882627621e-01   +2.039639841791580e-01   +2.279599305367621e-01   +5.637626002589588e-02   +2.581675033909350e-01   +1.392928734226167e-01   +1.457361242889335e-01];
L2E_L2I_iGABA_netcon = [+6.390444238517222e-02   +2.362883362284428e-01   +3.089544897067746e-01   +2.374127711330020e-01   +3.205734726035906e-01   +2.574054861164631e-01   +3.005480311513487e-01   +1.751443306675045e-02; +3.156145123677251e-01   +2.770945570136067e-01   +1.583830939707861e-01   +2.525133380917333e-01   -1.110165159375734e-03   +2.883272540602166e-01   +7.064519252023717e-02   +6.518426460078396e-02; +9.335099595728752e-02   +9.953254269960363e-02   +2.216049972683582e-01   +1.063231978426398e-01   +3.139282633859489e-01   +6.800316245591638e-02   +4.993408756916689e-02   +6.846052867665745e-02; +2.373883143669371e-01   +2.159386649437939e-01   +4.753086260484873e-02   +1.979212211334491e-01   +4.057451529851935e-02   +1.625057110087615e-01   +2.691048870661910e-01   +1.593188424964511e-01; +2.279251636031022e-01   +1.823927375367491e-01   +2.617871506082221e-01   +1.700918661099192e-01   +4.345100341142636e-02   +1.932806054129733e-01   +3.150963979497038e-01   +1.439147631661374e-01; +2.181475862864106e-01   +9.226113928536089e-02   +3.234752396966157e-01   +3.801911444699048e-02   +1.991564609465316e-01   +1.284469225283986e-01   +2.657341208805836e-01   +2.488287947818480e-01; +3.097603002185570e-01   +2.506340736088395e-02   +1.892058686897383e-01   +9.990066393445460e-02   +8.695107611993638e-02   +3.155942359603810e-01   +2.668459939518554e-01   +8.424757550250675e-02; +3.145013640937325e-01   +2.898409475581440e-01   +2.758096942055033e-01   +4.042417071211613e-02   +3.186944513171571e-01   +4.206998164311746e-02   +2.727481737299247e-01   +2.870352982439802e-01];
L3E_L2E_iAMPA_netcon = [+2.217347504774684e-01   +1.610100619080643e-02   +1.784127660301738e-01   +5.143266976565031e-02   -4.847753080815922e-03   +3.444992907092917e-02   +9.612655056302895e-02   +2.807039884878851e-01   +1.203475468762074e-01   +1.149954115135813e-02   +1.147696992377544e-01   +3.077653170969484e-01; +2.591063076346435e-01   +2.714650234588858e-01   +6.459205739904415e-03   +1.782416670943719e-01   +2.654107928097229e-01   +2.426187064653228e-01   +2.235459589741709e-01   +1.774231664475785e-01   +2.642679591731403e-01   +2.899341430080161e-02   +1.573803217557870e-01   +8.326856865513739e-02; +2.118971746302023e-01   +1.483557589182827e-01   +2.877412866579086e-01   +2.069880244695947e-01   +2.169127016391824e-01   +3.819801700403670e-02   +1.226718103306617e-01   +1.723951163723088e-01   +7.539054748181588e-02   +1.864059374876259e-01   +1.794754182282396e-01   +3.169475023877360e-01; +6.409938731492469e-02   +8.801354062949360e-03   +2.478198378361516e-01   +1.473742699379859e-01   +1.864688404286781e-01   +1.059895060284257e-01   +1.834308143120422e-01   +1.804047552530069e-01   +5.925865995456910e-02   +3.002271488800044e-01   +1.521102146755927e-01   +6.989952613833865e-02; +1.943727827898982e-01   +1.609941524339878e-01   +9.822896151262334e-02   +1.489881537148708e-01   +2.697746940443358e-01   +2.033492948939547e-01   +2.678093868699284e-01   +2.534908704068483e-01   +8.298261072004083e-02   +2.978430773091326e-01   +1.645941752617066e-01   +2.465932760211383e-01; +2.050135369404069e-01   +2.955606194709642e-01   +2.914750089293807e-01   +6.368783733163032e-02   +1.835019417714090e-01   +1.318958034805343e-01   +5.160501653637637e-02   +5.511496309860711e-02   +2.103136418549590e-01   +5.820016291768183e-02   +5.932114693775150e-02   +1.619773927238457e-01; +3.087535016719248e-01   +1.742934508267705e-01   +3.085760248875498e-01   +2.583172170752096e-01   +1.082493492047733e-01   +2.125158102427421e-01   +2.028066742754583e-01   +9.728365735066162e-02   +1.670279474217385e-01   +1.175269842880127e-02   +3.037988480416053e-01   +3.102083967050517e-01; +1.768064421316816e-01   +2.798492769117495e-01   +2.981178794233430e-01   +3.261573281054608e-01   +2.071365734469222e-02   +2.320820593487384e-01   +2.494973851401827e-01   +5.176343208904564e-02   +3.115217908534287e-01   +2.650885660251590e-01   +3.328438313692478e-02   +5.869532376009644e-02];
L3I_L2I_iGABA_netcon = [+2.586853708139892e-01   +2.156137431309689e-01   +1.402557100877293e-01   +2.892840938994471e-01   +2.664583548440724e-01   +3.064217829346877e-01   +2.245638417637669e-02   +3.278549029116416e-01   +2.843909971650614e-01   +1.454485728810686e-01   +4.478045268217246e-02   +5.654320093715801e-02; +2.292644478141864e-01   +1.426849518568900e-01   +2.171978503405027e-01   +2.135880829581523e-01   +2.100700052578399e-01   +1.936820322779944e-02   +7.362724254881120e-02   +2.986263200161856e-01   +1.231578062227117e-01   +2.170355170441652e-01   +2.394741343390840e-01   +1.636680998146507e-02; +6.137612869170954e-02   +1.691533971019080e-01   +2.722347809635484e-01   +3.220633897190542e-01   +9.277461924819466e-02   +2.818811719087606e-01   +2.056887386832260e-02   +1.333994764113134e-01   +1.629208912975485e-01   +1.089643861647324e-01   +3.124855782751922e-02   +1.588614912433836e-01; +2.507234977986406e-01   +1.202575619905123e-01   +3.027087034428059e-01   +3.209667002992646e-01   +5.432789064885311e-02   +2.334909748010941e-01   +2.012789985412828e-01   +1.992248327576600e-01   +2.108732629720442e-01   +1.080007451318271e-01   +2.167446575078326e-01   +2.495955363237123e-01; +7.149678299615489e-02   +3.114484721191470e-01   +2.668919188443556e-01   +1.335576789594315e-02   +1.388790121239057e-01   +2.647762799384413e-01   +1.818281365455535e-01   +3.030233853959292e-01   +7.685235587191891e-02   +2.248736488402492e-01   +2.454830736964095e-01   +1.845984049435776e-01; +1.097286461221174e-01   +2.443292396668894e-01   +2.200006672107339e-01   +2.093038178129288e-01   +3.100913316535187e-02   +9.879521171300432e-02   +1.884232138485017e-01   +2.505565207527792e-01   +3.160431120620837e-01   +8.401757634692274e-02   +1.719523440369447e-01   +1.324157719770148e-02; +2.243869602719735e-01   +1.850176298656265e-01   +1.803014013873294e-01   +2.361012122691052e-01   +1.914314101554797e-01   +1.108921292448089e-01   +4.848901102749489e-02   +7.030212399762924e-02   +7.656970159350862e-02   +2.862769179654569e-01   +3.041644389403489e-01   +2.393683170922613e-01; +2.124124597003449e-01   +2.776707160608616e-01   +2.405760184119735e-01   +3.139354566487431e-01   +3.232117168729794e-01   +5.080876467951032e-02   +2.846097331435620e-01   +2.748108564203194e-01   +2.219376196210737e-01   +3.213119101599354e-01   +1.930730185279563e-02   +1.589226553343484e-01];
L2E_L3E_iAMPA_netcon = [+1.310010859278630e-01   +2.822969523436869e-01   +1.059414863568136e-01   +3.086714181253152e-01   +1.716535041220592e-01   +2.168397340624088e-01   +2.235522457272443e-01   +1.347939913473325e-01; +1.221477130898959e-02   +7.546986035395013e-02   +2.114605101489637e-01   +1.198654427031373e-01   +1.282291778421099e-01   +1.710793896628449e-01   +2.656698901476424e-01   +2.913017616156190e-01; +3.114684266887099e-01   +1.083900112222858e-01   +6.479955406555075e-04   +1.587803084981313e-01   +1.944669756245640e-01   +3.043505180676958e-01   +1.599980469260773e-01   +1.999298205527827e-01; -8.558756193126953e-03   +2.567142387189599e-01   +1.142548956161622e-01   +3.124156662529051e-01   +2.698392878419640e-01   +2.706668227163717e-01   +9.931390440498566e-02   +2.506690739070209e-01; +1.566112678287345e-01   +9.404276418992473e-02   +5.988939685251060e-02   +2.010368240296122e-01   +2.139489619619768e-01   +2.358451618781055e-02   +4.351006089559144e-02   +1.976205894719672e-01; +2.504951774061933e-01   +6.993617156645703e-02   +3.819438847331796e-02   +1.002155167314277e-01   +3.330759602131783e-01   +2.695222938691938e-01   +7.158158892114205e-02   +1.470906527031883e-02; +2.365429682236129e-01   +1.734856513861570e-01   +1.904815224929115e-01   +1.868088504181100e-02   +1.595107220185185e-01   +2.707631982374450e-01   +3.185774290764182e-01   +1.622611605078101e-02; +1.498494393956366e-01   +2.430562668028265e-01   +2.546948375497702e-01   +8.505520633111269e-02   +1.856722797857150e-01   +1.931813330899237e-01   +1.843601668425332e-01   +2.350081117355877e-01; +9.338105563405287e-02   +1.468320869985422e-01   +2.049257320240264e-01   +3.580886876250762e-02   +2.081378609602710e-01   +8.768638832042791e-02   +1.280427539259419e-01   +2.947021656411722e-01; +9.097827960860574e-02   +2.005538704384283e-01   +1.897453617884510e-01   +1.086848373526212e-01   +7.707851629700969e-02   +1.829234986696649e-01   +2.064246306684309e-01   +1.413929718761436e-01; +1.358818559202377e-01   +8.397376590792310e-02   +2.800346423049284e-01   +2.719757605641367e-01   +1.502862190955410e-01   +1.551269701080234e-01   +3.227032265653019e-01   +9.817668466265472e-02; +7.124773884143666e-02   +1.510759022554284e-01   +1.672592937025509e-01   +3.011475120356561e-01   +8.853335166454167e-02   +1.866579182238048e-01   +1.426027372135818e-01   +1.244976888118089e-01];
L2I_L3I_iGABA_netcon = [+1.301720933227226e-01   +5.621561353423027e-02   +3.258948104370956e-01   +2.104023132218821e-01   +1.843232449549412e-01   +2.590570898696410e-01   +2.100124681682808e-01   +2.743059943424139e-01; +7.605625831680973e-02   +2.486255873846204e-01   +2.988087945035863e-01   +1.916695740130629e-01   +3.166526871148270e-01   +1.598724639005589e-01   +2.168907123451392e-01   +2.441638594386983e-01; +8.818912814856159e-02   +3.735027997113882e-02   +9.353276586867623e-02   +7.152614558753490e-02   +1.747062337165687e-02   +8.823124953996325e-02   +2.407866728049912e-01   +1.645090903046851e-01; +1.747771789799923e-01   +2.542176780983805e-01   +3.557313593503587e-02   +9.667827676085324e-02   +2.882067269139296e-02   +2.934415443732640e-01   +2.683425584452205e-01   +3.177600635050604e-01; +2.632879365600876e-01   +2.678267565415783e-01   +2.948488020538299e-01   +2.762615856793376e-01   +3.187993800661382e-01   +1.138541459819916e-02   +2.299088070950119e-01   +2.550166673022025e-01; +1.485209577394617e-01   +1.736608248460646e-02   +5.695659318720338e-02   +1.462719590180571e-01   +9.041609373061837e-02   +1.549437447577329e-01   +1.859990015317594e-02   +2.542086509802748e-01; +2.192970210214725e-02   +2.129463672927630e-01   +1.009921083630398e-01   +3.260206487275666e-01   +2.807391079758517e-01   +1.536261939283611e-01   +2.593524487846220e-01   +3.219581169043690e-01; +2.159116011002796e-02   +5.146370196325019e-02   +1.555596847910809e-01   +1.656872156342170e-01   +1.652144750917007e-03   +3.060497253873952e-01   +1.512613123304320e-02   +2.850420458269346e-02; +9.369864751201264e-02   +1.394194774803026e-01   +1.699801042178082e-01   +2.897331092118007e-02   +2.881191956997466e-01   +2.631034484142555e-02   +1.592896859397453e-01   +1.328200741307923e-01; +2.009978347682094e-01   -5.139145354100139e-04   +2.523737616132101e-01   +2.299379174188219e-01   +1.377100028914583e-01   +2.747362079328436e-01   +3.471813859101815e-02   +1.285674546886504e-01; +3.305104947432410e-01   +9.620543744716709e-02   +2.562122180106000e-01   +2.041546750818195e-01   +1.236206106816622e-01   +1.525917649974655e-01   +2.128225547250700e-01   +1.502521308273302e-01; +2.902837220657102e-01   +1.187897766934976e-01   +2.437144975503398e-01   +1.133273687993356e-01   +1.522302229945382e-01   +2.143049733503783e-01   +1.795622639806155e-02   +1.909388101294497e-01];
L3I_L3E_iAMPA_netcon = [+1.163700277795171e-01   +7.582607545978315e-02   +1.796986861543576e-01   +4.545115575573260e-02   +1.871837893550027e-01   +1.848083308205843e-01   +1.987878306015878e-01   +3.036928325267331e-01   +9.718420237309257e-02   +1.569518395637844e-01   +8.126169823154427e-03   +2.333604114324067e-01; +2.228399250396846e-01   +1.508453911432294e-01   +7.084770806788754e-02   +1.442072839356595e-01   +2.366670344862910e-01   +2.173602700982359e-02   +7.745736099290679e-02   +1.419426336014650e-01   +2.956464248925463e-01   +2.164898791932801e-01   +9.165910533024947e-02   +2.911190475635771e-01; +6.344847570456430e-02   +2.068536061855044e-02   +9.202888297142159e-02   +1.546342240521349e-01   +8.597812500202387e-02   +4.482818707000229e-02   +7.505823281363677e-02   +2.895439830383388e-01   +5.769800697396903e-02   +9.055028371793743e-02   +2.433256545838798e-01   +2.884378050127843e-01; +2.406210147124428e-01   +2.358122873258465e-01   +9.805510540370140e-02   +3.234309382515815e-01   +2.078817286980073e-01   +2.166676756914474e-01   +2.648044734293422e-01   +9.023379372311831e-02   +1.321453015277025e-02   +2.907701210560600e-01   +3.706032029614440e-02   +8.883563551135214e-02; +4.497009291412744e-02   +1.977072802991890e-01   +9.859766857995614e-02   +4.720779965039589e-02   +4.542144997540931e-02   +1.870323770154015e-01   +2.123623577440872e-01   +1.254929464062527e-01   +1.610035311563267e-01   +1.439330186146088e-01   +1.746925707964297e-01   +2.260402227352900e-01; +1.792513243683617e-01   +2.028852840440649e-01   +8.299410465045684e-02   +1.509666810394756e-01   +1.962658234634698e-01   +9.046451101166074e-02   +2.075169336221321e-01   +2.854271085813539e-01   +2.938553749154023e-01   +1.353440278141846e-03   +4.973262622528957e-02   +3.635581201244231e-02; +2.789540264771602e-01   +2.469027845500935e-01   +4.130046971777712e-02   +1.912022808673305e-01   +2.247422441869210e-01   +1.766472320983560e-01   +2.845520388576331e-01   +3.121136971390707e-01   +3.111949799878024e-01   +7.654811961266188e-02   +2.829979123224785e-01   +2.919789652068465e-01; +9.080964409280372e-02   +2.399160180766498e-02   +5.024167852179735e-02   +1.336569001246247e-02   +2.697321330958101e-01   +2.380720491602175e-01   +1.579615074920944e-01   +9.611643168291585e-02   +2.046854017165045e-01   +1.308921240180478e-02   +1.254094810884759e-01   +8.461374260176149e-02; +1.765945125358965e-01   +2.279845229471322e-02   +1.674145491808205e-02   +2.331879007673271e-01   +6.843388117486783e-02   +2.989488221625665e-01   +7.354016521734444e-03   +1.925906136341590e-01   +2.285534822670339e-01   +2.168700539930975e-01   +1.199378742666948e-01   +2.071134360635632e-01; +1.548919804815339e-01   +2.278730343947952e-01   +1.975069981065344e-01   +3.257055895869041e-01   +2.960993955937692e-01   +9.091125253918476e-02   +1.816482261454835e-01   +1.956342223055609e-01   +5.509520360935981e-02   +1.921515489915673e-01   +1.461274662115011e-01   +5.843571433598511e-02; +2.790777325455705e-02   +2.741686125181118e-01   +4.976263113074376e-02   +1.589993580938219e-02   +2.565504696358724e-01   +3.188892544101948e-01   +1.953913706956666e-01   +2.248472161069843e-01   +1.714733798605101e-01   +4.661415618730856e-02   +2.212081271761194e-01   +2.789896137338272e-02; +7.316464224769642e-02   +2.059661815882957e-01   +6.793802375653034e-02   +2.654469134964227e-01   +2.838036384685513e-01   +1.102504564675658e-01   +8.711984937632362e-02   +1.954691809743023e-01   +2.061545110376213e-02   +9.998899767232361e-02   +1.804691542731092e-01   +7.461850880074412e-02];
L3E_L3I_iGABA_netcon = [+2.628440925380416e-01   +1.934176012275692e-01   +8.050215664507507e-02   +1.781043813770153e-01   +1.841168675345364e-01   +4.589927653442175e-02   +1.810369109955096e-01   +2.557224861925069e-01   +1.918540953570976e-01   +7.166994893659756e-02   +7.825174078869053e-02   +2.152453461422279e-02; +2.073921170479505e-01   +4.242833576754203e-02   +1.018268356978674e-01   +2.868764220883305e-01   +1.272763173120369e-01   +2.944471625019904e-01   +2.334551621625899e-01   +2.533254332512461e-01   +9.368843415858240e-02   +1.340997058843329e-01   +1.559719775206399e-01   +1.586713930607724e-01; +7.480097454139835e-02   +9.062625757226798e-02   +3.198390247755102e-01   +2.521653638720658e-01   +2.632485137821111e-01   +7.736564407835975e-02   +1.583345184645822e-01   +2.813539595891738e-01   +2.502580838024910e-01   +1.570221932008198e-01   +2.898264951186385e-02   +7.732326075861726e-02; +9.168129071688982e-02   +1.269735778847267e-01   +2.896337868132269e-01   +2.376832582933194e-01   +6.038678790790484e-02   +2.552585894402013e-01   +1.062572058386681e-01   +1.867598312505740e-01   +1.368205194567048e-02   +2.997900136450214e-01   +3.195764333165725e-01   +1.219881235523918e-01; +2.485355042335544e-01   +1.435928652770970e-01   +2.535944446324123e-01   +9.238421323487439e-02   +2.123869242542138e-01   +9.512484916486978e-02   +3.141464768196628e-01   +1.157524290523225e-01   +2.577593033373810e-01   +1.588978367469123e-01   +1.333687474729854e-01   +1.489237622491984e-01; +3.045158074961827e-01   +1.288933339791583e-01   +1.886293594719241e-01   +5.231992782800354e-02   +2.590917622873161e-01   +3.318646796392476e-02   +2.714045214556101e-01   +9.102951797240759e-02   +5.812617162627327e-03   +8.141993088051845e-02   +2.489594450248183e-01   +7.722463469568093e-02; +2.052011778173521e-01   +2.398885330289116e-01   +1.192779622805719e-01   +6.665469590355165e-02   +5.596215693775888e-02   +3.172262463113920e-01   +4.453013193031705e-02   +3.016323195295753e-01   +2.116243975164270e-01   +2.481337980403361e-01   +1.143881343231309e-01   +8.517735920227039e-02; +9.331650963560352e-02   +1.640315513099014e-01   -4.083562386158707e-04   +3.039107312277396e-01   +5.505600956488808e-02   +1.243260177432907e-01   +4.953374544818137e-03   +4.925056465792516e-02   +2.523906375572532e-01   +2.428520144127979e-01   +1.579935853977706e-01   +1.545696044010388e-01; +2.519354681515267e-01   +6.723449308913446e-02   +2.544565069461718e-02   +2.289039265420176e-01   +1.527789992215424e-01   +2.905011037642007e-02   +1.966199122476260e-01   +1.075745028852380e-01   +2.891565324493475e-01   +2.911872049396150e-01   +7.256039060234203e-02   +3.273195241624357e-01; +1.844669351322115e-01   +3.181201646381586e-01   +3.302954907228224e-01   +2.316327748018561e-01   +5.463622784978640e-02   +2.721138868067223e-01   +1.341967403983642e-01   +9.224214608680008e-02   +1.826908071780997e-01   +3.132677830332459e-02   +2.167509033823044e-01   +3.152400134370762e-01; +4.000409333656755e-02   +1.539637052894578e-01   +2.913364098853092e-01   +1.735451062228485e-02   +1.745652346429604e-01   +2.742333272922510e-01   +2.149050094193173e-01   +9.452163593434806e-02   +8.805550474430139e-02   +1.506880573222874e-01   +2.542715263237194e-01   +3.006483858998186e-01; +2.390288032336773e-01   +4.597375802465027e-02   +2.138291324475840e-01   +2.501806059096212e-01   +2.846891950535875e-01   +4.836219415132707e-02   +2.364747128241835e-01   +2.517650730759359e-01   +1.506767273167913e-01   +2.541615816679672e-01   +1.109576264577428e-01   +1.353230261375314e-02];
L2E_Input1_iAMPA_netcon = [+2.184138555288725e-01   +1.510465394622460e-02   +4.004356765263689e-02   +2.949384894977552e-01   +7.240811246023726e-02   +2.905411574662266e-01   +2.755453475113135e-01   +1.663196942772414e-01];
L2I_Input2_iAMPA_netcon = [+2.835478915631083e-01   +6.549628755628721e-02   +3.158021103356374e-01   +2.804853485824117e-01   +2.205025338997957e-01   +2.912119134438864e-01   +1.187737592458907e-01   +2.546600482977844e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last =  11.21 * ones(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = -20*((exp(-10*((t)-( 50))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 20*((exp(-10*((t)-( 50))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
