function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-4.525451702183103e-03   +1.227113877470036e-03   +5.904922251735175e-03   +8.731224970030781e-03   -4.573913631334428e-04   +8.052838055491280e-03   +3.931200401392106e-03   +8.979770624123592e-04   -3.184053558822275e-03   +9.519195320889727e-03   +4.687620147515469e-03   -6.103336985357204e-04   +6.675783412631637e-03   +4.459969309421420e-03   +4.749688567063277e-03   -5.326895833975450e-03; +4.273801036495569e-03   -9.876349016632864e-04   +4.548007955435323e-03   +1.154014571584683e-02   +8.711350915962956e-03   +2.280668294273973e-03   +1.010084393494259e-02   -9.887612008351167e-04   +3.149925154925928e-03   +7.512354352751289e-03   +7.223264851803286e-03   +3.463501424392106e-03   -4.449505761700846e-03   -4.325803748870529e-03   -1.429035845093261e-03   -8.872347473730120e-04; +8.576365900982409e-04   +6.298746621730534e-03   +6.764956019339022e-03   +8.993475756171704e-03   -5.390378425900030e-03   +2.569139149417440e-03   +6.634748049180820e-03   -1.954178360274211e-03   +2.217869685040417e-03   +5.652989868518575e-03   +6.549972356935108e-03   -3.110089792680225e-03   +1.015895901856274e-02   +3.231719149895088e-03   +3.811485674033181e-03   +4.087703244480873e-03; +9.016713815681232e-04   +2.586596437980490e-03   -1.525163800280966e-03   +2.116468120417765e-04   +5.210633084703001e-05   +6.526667950176976e-03   +4.926711557799566e-03   -6.628794234800261e-04   +4.991709553986061e-03   +5.344202689482712e-03   +4.096901308117710e-03   +7.771263724374449e-03   +8.373895224028783e-04   +7.437746459384885e-03   -2.351935236698257e-03   +4.241103300372346e-05; +2.711191693680645e-03   -2.947732724369501e-03   -2.725842519471926e-03   +6.204146470402435e-03   +1.129896852167716e-02   +3.830080615053074e-03   -3.289447034407980e-04   +6.119638047989948e-03   +1.900938735430701e-03   +1.201827668740723e-02   -3.125733921706473e-03   +6.501175865051269e-03   +6.761032785614675e-04   +6.327129325030233e-03   +1.089388727817324e-03   -3.618149141508264e-03; +8.930015797800814e-03   +5.487760674056515e-03   -1.489589669855148e-03   +3.830533887496123e-03   +2.024996870731668e-03   +1.587507872641606e-04   +4.818932435299299e-03   -6.800767131762257e-03   +5.971929809624901e-03   +7.814301717948154e-04   +2.965928303484300e-03   -5.116964481007963e-03   -5.122127442525372e-04   +7.797713561232207e-04   +9.110076449854714e-04   +7.123737177895516e-03; +6.260759917501219e-03   +5.496105634384844e-03   +1.623800834418934e-03   +6.084104569428679e-03   +7.727144266110483e-03   +3.891701162915363e-03   +4.009966846748790e-03   +8.394151712946812e-03   +1.003409634996283e-02   -4.303219683325816e-03   +1.840883774097345e-03   -2.523570353689998e-03   +2.947206269786046e-03   +4.049260549291464e-03   +3.840442700719262e-03   -1.598462746223954e-03; +2.697268119284965e-04   -8.379476428825387e-03   +3.768522867741826e-03   +1.018151445284912e-03   +3.902978082519286e-03   +8.337245547971352e-04   -3.728532410178802e-03   -2.106731494460626e-03   +1.132793803089428e-03   +5.555952743104250e-03   +5.008807013673985e-03   +7.669242008992543e-03   +4.418612865255573e-03   +1.213424899007747e-03   +1.160728070576482e-03   +5.460155378890630e-03; -1.354555946900237e-03   +2.319241331042481e-03   +4.388623808355841e-03   +7.419368389560646e-03   -4.407211684393710e-03   +7.660647844690818e-03   +1.862119067675800e-03   +4.959606585218117e-03   +5.723012277155061e-03   -6.555221814057748e-04   +6.217317235586302e-03   +5.648840601681012e-03   +4.354296800390471e-03   +6.776356578793953e-03   -3.173010794496159e-03   +1.580776966820744e-03; -2.240570911904947e-03   +8.279514657045415e-03   +1.040163760435912e-02   +6.167713005636167e-03   -3.045945935005323e-03   -3.969027770003969e-03   +6.312567748129019e-03   -3.674904298706057e-03   +5.834004331863720e-03   -4.581735679751022e-04   +5.157716590889387e-03   +5.163712612442797e-03   -4.804794557505578e-04   +1.170749226610548e-04   +1.316438373644794e-02   +8.770460456388844e-03; +1.024324878257695e-02   +5.147737359086650e-03   +1.079685357330597e-02   +5.153635129362131e-03   +2.522035516271268e-03   -2.799246908355319e-03   +6.250043918239940e-03   +1.246228151785824e-02   +4.985771800638469e-03   +3.537678177087823e-03   +1.162371227297184e-02   +4.852282361484487e-03   +6.292320957453931e-03   +4.841923359266772e-03   +8.782870535554443e-03   +1.096044118163598e-03; +5.889506947390964e-03   -7.981344825726143e-03   -1.613536387658321e-03   +5.154343189259841e-04   +7.929084306019329e-03   +3.169994689618887e-03   +2.091678670055894e-03   +1.821232589484555e-03   +4.548147458487602e-03   +3.931668546476614e-03   -7.182310566102821e-03   -4.553418452232681e-03   +5.280115781684355e-04   +6.781808040216479e-04   +4.149667491980775e-03   +2.936140958654419e-03; +4.643319370575594e-03   +1.167086440062512e-03   +3.541826776072149e-03   -4.854809569854431e-04   +8.012770878670089e-03   +1.302971221391342e-04   +3.522816945084832e-03   +1.013649458398085e-02   +6.009574301234796e-03   +3.493700445834384e-04   +2.981597159665493e-03   -2.035418750914592e-03   +6.743397930169825e-03   +1.058067580347417e-03   +3.771600817577146e-03   +4.424459731539354e-03; +6.484077943427115e-03   +9.401355573125214e-03   +5.617200803311451e-03   +3.609692382636611e-03   +2.283150057712103e-03   +8.009839101618448e-03   +7.464211362516828e-04   +9.567943927917547e-03   +1.094254957556312e-03   +3.262271131675722e-03   -2.164770549144574e-03   +5.612809080949426e-03   +5.350880693859934e-03   +3.759896518762553e-03   +2.283376836976162e-04   +3.875851476587401e-03; +1.799000784757636e-03   +1.956926625239267e-03   +5.894950238678250e-03   +2.303891188037128e-03   +7.861397784521593e-04   +2.483285571977472e-03   +7.118584914535500e-03   -3.074761126713154e-03   +4.113924722185055e-03   +5.849580713376080e-03   +3.208967080676212e-03   +4.244750005216518e-03   -1.195714666481099e-04   +9.310536725247101e-03   -5.450569921191391e-03   -9.399033676351453e-04; +7.055015601301129e-03   -2.665126606181501e-03   -2.867310465360455e-03   +5.549079111816237e-03   +6.603275970442539e-03   -2.413758208260137e-03   +2.101549291202733e-03   +4.156979974691017e-03   +1.941952092704377e-03   +9.090647878606696e-03   +8.509766084195998e-03   -3.576014590675350e-03   +1.835076270803202e-03   +4.325692441341910e-04   +1.168553993003535e-02   +5.517269052801021e-03];
L1E_L1I_iGABA_netcon = [+1.610747016958560e-03   +1.154487636890890e-02   +3.478246750026114e-04   +6.477905548404507e-03   +2.263026622530648e-03   +6.034364679642542e-03   +9.391244099117861e-03   -3.091920322596467e-03   +4.358031841243859e-03   -4.784147193196578e-03   +7.697150161595384e-04   +9.562062108943925e-05   +6.907333523642931e-03   +7.282479954449904e-03   -1.206181375918985e-03   +8.022173362593751e-03; +1.134080330150887e-04   -1.888694955398599e-03   +7.692470327999952e-03   +8.827874985537894e-03   +8.201620325520023e-04   +4.035944228711179e-03   -1.424966308544274e-03   +5.473075330696406e-03   +1.482549004575355e-03   -3.329955011770121e-03   -3.437195396531863e-03   +6.361154991510609e-03   +1.193076461427566e-03   +5.312581096439928e-04   -3.675039991878039e-03   +3.049105451194738e-03; +5.913980843830447e-03   +8.598878253301906e-03   +7.806203788404418e-03   +2.281693747419830e-03   -6.803263930238785e-04   +2.974193557866866e-03   +1.191644306738354e-04   +8.116473158314994e-04   -4.062353866010559e-04   +5.190540222885332e-03   +6.037359235135742e-03   +3.378482974831226e-03   +2.617276950853308e-03   +9.377568123568067e-03   +5.264080176077599e-03   +3.919485675618346e-03; +1.185140756271504e-03   +1.704328536693631e-03   +8.887820842212931e-03   +2.697233066245915e-04   -4.785821690266850e-03   +8.982779574830185e-03   +4.454114111610360e-03   +6.224752898608871e-03   +9.091446046163375e-03   +3.363778604759062e-03   +4.566897748749454e-03   +5.082985937174619e-03   +4.597211105862696e-03   +1.331081450358082e-03   -8.257927069497738e-04   +8.895117295940530e-03; +3.874179632421753e-03   +4.524509861500531e-03   +4.861264803642280e-03   +3.026317270222282e-03   -2.384152048215305e-04   +9.726347969432721e-03   +2.691477524913888e-03   +6.108619226998582e-03   -1.987249265610801e-03   +4.697480005453589e-03   +5.486291790282741e-03   +1.739394033669836e-03   +7.840317555589556e-04   +1.546994057601303e-03   +5.199656220613517e-03   +7.370026644210413e-03; +5.892177920337319e-03   +7.676880629504616e-03   +7.597122875966167e-04   +5.280357629136913e-03   -3.129748717598754e-04   -1.652334543976383e-03   +9.868016100168913e-03   +2.189986470212078e-03   +4.824994701755797e-03   +8.968032034446351e-04   +1.062576197317182e-02   +2.632179745458586e-03   +7.550064837283686e-03   -1.102814648456145e-04   +6.141044688562389e-04   -1.975920619235107e-03; +5.342856963809742e-03   +1.028228539314671e-03   +1.042680325346386e-03   +2.551661044195392e-03   +8.744660069545027e-03   -3.742782102098673e-04   +7.950050202871968e-03   +6.235086473311472e-03   +3.309021227321827e-03   -3.653007255317648e-04   +4.969948811907290e-03   +7.107876243634214e-03   +4.306438752968559e-03   +6.638008849585110e-04   +3.138038105081876e-03   +3.730025355473552e-03; +5.401575447466746e-03   +5.226111957504406e-03   +3.174554091934498e-03   -2.530571319805829e-03   +4.363227901040039e-03   +4.509418204922846e-03   +9.390098152997068e-03   +6.464490807890009e-03   -1.060432327772695e-02   +5.661577057207318e-03   -1.486103727034232e-04   +9.226794246463341e-03   +2.201259332044048e-03   -2.686501366063829e-04   +3.817249573921180e-03   +6.915586448303173e-03; +3.643923445928974e-03   +2.052779051452605e-03   -1.374079076021781e-04   -3.603098033835322e-03   +4.639100594842092e-03   +6.615770316820495e-03   +1.516672365574562e-02   +4.764880469380285e-03   +1.003270515944993e-03   +1.123035847277274e-03   +8.220583000900171e-03   +4.880281870744067e-03   +8.319484654396411e-04   +5.034160728742213e-03   -3.026927556781646e-03   +6.064543508016592e-03; -1.383886610645218e-03   +9.670104921267231e-04   -8.245195235453593e-04   +1.335719212891816e-03   +7.321554884329343e-03   +8.168084670954819e-03   +3.114021373660146e-03   +1.542271419334427e-03   +7.833796522029554e-03   +6.360613590838865e-03   -3.477290078581008e-03   +1.547972434991006e-02   +2.399833776149533e-03   +1.068777131420908e-03   +5.703119256084254e-03   +4.630282676437692e-03; +7.482870843898081e-03   -7.075225314931370e-03   +2.868614154965404e-03   -1.162064890384931e-03   +6.952412095699113e-03   +2.667638114410295e-03   +9.503852976305556e-03   +8.366148289802920e-03   +2.304200649886430e-03   -3.982344464237770e-03   +3.247100895858180e-03   +5.825078905437071e-03   +2.140051093613780e-03   +6.350151999337257e-03   +4.017636279622447e-03   -2.986207233275381e-04; -1.418185382589415e-03   +1.752081062607300e-03   +7.942020795208567e-03   +3.914784275896428e-04   +3.920971107696078e-04   -1.417359405283780e-03   -2.255414871254433e-03   +4.463094089741219e-03   +5.349729344615020e-04   +1.412433220637452e-03   -3.059257244270400e-03   -1.366243317116467e-03   -1.349908463211044e-03   +8.658467486915766e-04   +5.358523843242155e-03   -2.712705898336970e-03; +5.237233517303192e-03   +4.521173007433653e-03   +5.609700371536611e-03   -2.390296487030457e-03   +3.495749458315975e-03   +1.667104142923523e-03   +9.951839312473116e-04   -4.239687828464134e-03   +6.186758201309902e-03   +3.559099581636020e-03   +5.172752949725249e-04   +8.490485750575149e-04   +5.123015332128895e-03   -3.623159839111336e-03   +5.082975943525566e-03   +9.457655463783205e-03; -3.123536203984891e-04   +3.359387329954745e-04   +1.164274858035160e-04   -5.016440782992708e-03   -1.858817669411796e-03   +6.653905418324319e-03   +1.440106649172050e-02   +4.312572747168021e-03   +2.237799913975273e-03   +7.032602134287435e-03   +3.200874601212926e-03   +7.539757502271829e-03   +1.016449069198821e-02   +3.204892548539135e-03   +4.837712499117616e-03   -2.813748683938698e-03; +4.724577229120867e-03   -6.640886394424349e-04   -1.684223859643091e-03   +5.632751771102690e-03   +7.508210981287180e-03   +5.878131998669224e-03   -3.295772595993497e-03   +4.460791622704582e-04   -4.192256352800395e-03   +1.178064404033433e-03   -2.380337683580394e-03   +9.099525363053640e-03   +1.308320796815469e-03   +7.173874388681863e-04   +2.603171520814926e-03   +1.709565685036119e-03; +3.980998034851721e-03   +4.104086245331567e-03   -1.817424940487208e-03   -2.681887378151377e-03   +8.943900437044095e-03   +1.000455755137707e-02   +6.364339656003402e-04   -2.756518800245355e-04   +4.189344707140771e-03   +2.921359792801162e-03   +1.974650740876124e-03   +7.515125992250174e-03   +9.250891374233475e-03   +6.268178862237924e-03   +5.454331141132513e-03   +7.530993216523623e-03];
L2I_L1I_iGABA_netcon = [+1.202076394370223e-02   +6.667825893128429e-03   -1.883250036220625e-03   +8.304740244717161e-03   +3.788347595982939e-03   +8.792254158857629e-04   +3.650496199761467e-03   +7.035017359272790e-03; +7.716339806593921e-04   -1.653219355690069e-03   +1.562499712355633e-03   -5.885393556180427e-04   +1.643901576159230e-03   -9.307137770507006e-04   +4.936772948918913e-03   -1.557683144303824e-03; +3.787480158582173e-03   -1.653610750746578e-03   -4.613857963723734e-03   +5.634159172412762e-03   +1.101005246556262e-02   +1.484055987885783e-02   +6.603633870718288e-04   +2.550649218984669e-03; +2.010019162350005e-03   -4.725731789217721e-04   +8.024928286334856e-03   -1.562637580603871e-03   +9.822688096801325e-04   +2.780924653930059e-03   +4.655262905195579e-03   +7.816384018864055e-03; -1.981707210645869e-03   +3.512712636807426e-03   -7.104144380990851e-05   +4.502500637060718e-03   +4.679106659221037e-03   +2.406637582529638e-03   +3.312240215828205e-03   +1.346120657971287e-03; +1.025813502278108e-02   -3.726401289880646e-04   +2.777816028533510e-03   +9.607050643913775e-03   +6.022283794787104e-03   +7.178720773086197e-03   -3.134756788453300e-03   +8.198687701306238e-03; -2.679363709230472e-03   -2.222001199143207e-03   -2.089155684600713e-03   +2.942455895472691e-03   +1.297307481078803e-03   -3.095859735689988e-03   +1.431890369586283e-03   +4.403541373280640e-03; +6.702345798892414e-03   -5.323860581640005e-03   +3.675322417424381e-03   +4.674289701804888e-03   +4.475921955549821e-03   +1.536291794201804e-02   +1.527095690967058e-03   -1.792152927159401e-03; -2.170533878061142e-03   +2.580709668747403e-03   +2.606351416723497e-03   +2.164432666759787e-03   -1.156382024003529e-03   -1.088618430298493e-03   -2.135169535677440e-05   +1.310142515731709e-02; +1.724282708838218e-03   +3.258890708809353e-03   +2.190402239913179e-04   +4.706930113989198e-03   +2.243263165546335e-04   -1.190775891683172e-03   +5.749170947186005e-03   +2.679272831002519e-03; -3.216344000165300e-04   +8.207811466400608e-03   +1.101260362642584e-02   +6.387974489599624e-03   +3.075043604560502e-03   +1.206682918431129e-03   +6.488997599826049e-03   -4.590417049117016e-04; +1.007985414377670e-02   -3.120714343431371e-04   +4.294025692981754e-03   +8.120759960853186e-04   +1.306244562335188e-02   +2.877423816912989e-04   +3.628968173535697e-03   +2.684343491067061e-03; -8.113381315699926e-03   +5.983534604423258e-03   +4.444748082479221e-03   -1.482159118731266e-03   +8.193071976709198e-04   +1.181577585514982e-03   +1.239459000914604e-03   +9.627707608970942e-03; +5.175392075139919e-03   +2.100977677705106e-03   +1.063996706304672e-02   -7.005980289008138e-04   +3.736084730126028e-03   -3.069532814069029e-03   +7.678694393962983e-03   +3.144880788466567e-03; +2.984858069747083e-03   +8.820822481725367e-04   +2.263938342659757e-03   +8.751156862277561e-03   +5.287572863875011e-03   -2.835306597443439e-04   +6.696843381477287e-03   -3.742228315421116e-03; +5.592354245037802e-03   +6.081409118783064e-03   +6.429854552436147e-03   +5.262291906115292e-03   +6.476340160908912e-03   -2.999607229000518e-03   +4.876779790006896e-03   +2.023098084537310e-03];
L1I_L2I_iGABA_netcon = [+1.020839279362510e-02   +8.538569172803561e-03   +3.248451740039667e-03   +1.306771982591516e-03   -4.139509852224455e-03   +7.883238831300163e-03   +1.242182159248465e-02   +2.476144177479787e-03   +9.848981481293815e-03   +5.679657077082739e-03   -4.962644553245862e-03   -1.657183122242020e-03   +8.795019978065755e-03   +4.580609725323211e-03   -4.820897179493714e-03   +5.715013550042806e-03; +7.116270913157518e-03   +1.893831373392511e-03   -1.695445692975253e-03   +3.263369753242450e-03   +2.573187023649494e-03   +2.403165754199808e-03   +5.062451502132901e-03   +7.309388508161316e-03   +2.949698292324559e-03   +5.667578384060884e-03   +4.789002475405882e-03   +2.085574520683318e-03   +4.286372130574544e-03   +2.049633021324112e-03   -3.099303961671496e-03   +1.856119454597681e-03; +4.219231409662389e-03   +2.875081747056392e-03   -3.912743572149584e-03   +5.615896965871039e-04   +1.127404820846713e-03   +9.698431175109948e-03   +7.966883011760642e-03   +1.087455661850673e-03   +2.819936833112127e-03   +6.853272706008428e-03   +1.980651183045322e-03   +1.648286884877963e-03   +1.700089439500457e-03   +1.611914627262927e-03   +3.513586380337643e-03   +7.749995315273869e-04; -1.323411355042466e-03   +9.074479331825393e-04   +6.288801433202745e-03   +1.021433225331045e-03   +1.841691484922611e-03   +1.105822329778781e-03   +4.422881941212039e-03   +4.412190231992214e-03   +7.356825662116349e-04   +1.802854748387907e-03   +6.780788498029591e-03   +7.038555905731667e-03   +4.584634513595334e-03   -2.264407487155484e-03   +2.294584834928550e-03   +3.930453338685372e-03; +1.859979705655671e-03   +7.851831589973770e-03   +2.826338333739368e-03   +4.618086746100701e-03   -5.862549117367640e-04   +5.935108030012582e-03   +2.358883312120055e-03   +1.237477621612208e-02   +2.618839428035293e-04   +3.394199081398393e-03   +6.494369764091462e-03   -6.895944354461591e-04   +1.077169639067729e-02   +3.973051948188925e-03   -2.198278288364403e-03   +3.201860960490169e-03; +6.444473211111978e-03   +3.570445504119346e-03   -3.965745010087090e-03   +7.550608012738793e-03   +1.208643219280455e-02   +5.359163618881596e-03   +1.054579624618994e-02   +3.541979328495179e-03   +6.048922296409614e-03   -1.334314248066981e-03   -1.301482260234728e-03   +9.227537740095325e-03   +2.329751287834364e-03   +8.007514340811503e-03   +1.059333677056296e-02   -9.944917495434856e-04; +4.828127928083562e-03   +4.417025985983312e-03   +1.865689259948761e-03   +2.888074861569992e-03   +4.436927534216626e-03   +6.896391571857664e-03   +6.386283154314091e-03   +3.366702795669982e-03   +4.926657521779452e-03   +6.180421810121829e-03   -1.095533582768324e-03   +4.645246630640759e-04   +8.755978169887898e-03   -6.450177638361997e-03   +4.441407756045735e-03   -5.506993997164335e-04; +6.495881349751124e-03   +5.495770505858560e-03   +5.309556548290747e-04   +5.829523271857298e-04   -2.326407355048438e-03   +8.072128903967427e-04   +1.380785307258645e-03   +3.557187134837309e-03   -3.961637761791720e-03   +1.316211001093610e-03   +3.153817977583313e-03   -2.558684510192508e-03   -4.381873163306156e-03   +1.063688713278707e-03   +2.935741108507247e-03   +1.254029025524371e-03];
L2E_L1E_iAMPA_netcon = [+2.790574789058972e-03   +5.016286387072228e-03   +1.127659000344385e-03   +3.714506098478192e-03   -1.639029908492497e-03   +2.333458972444298e-03   +7.513037162189503e-03   +3.163825256219153e-03; +8.396354129495014e-03   +4.021360647043587e-03   +8.491638404049711e-03   +3.729887071608068e-03   +4.359794375178406e-03   -4.269515063684661e-03   +1.446655434690139e-03   -1.697749710938450e-03; +3.155728650671155e-03   +3.657118775490981e-03   +4.545627609197874e-03   +7.182346452410119e-03   +1.712489125905950e-03   +1.108929426173456e-02   +2.045745776608296e-03   +1.873275386446614e-03; -6.578472382609837e-04   +3.454066461369149e-03   +3.543459458962706e-03   +1.230800399045443e-02   +1.042809442520855e-02   +2.855420728255377e-03   +3.476039503342143e-03   +7.312290676423042e-03; -1.112423279249100e-04   +1.042374078267986e-02   -1.404151994619061e-03   -5.983946216122740e-03   +4.364088293530568e-03   +3.967463234456799e-03   +1.138445980552362e-02   +1.855783423419009e-03; +5.497464586605737e-03   +7.994812098662919e-03   +9.843126691178693e-03   +7.891187315729966e-03   +4.996355621464776e-03   -4.269098672522876e-03   +4.037795862719974e-03   -8.963841750856123e-04; +3.428605229125432e-03   +4.131101058045548e-03   -6.170938500531766e-03   +2.382940090286674e-03   +4.371188517747831e-03   +6.084150869700998e-03   -4.460920943363562e-03   +7.620819949817371e-03; -6.812006153841443e-03   -7.697945359581980e-03   +2.134214405842065e-03   +4.692982393944539e-03   +9.345062039602375e-03   +2.726773366435543e-03   +6.846587898777175e-03   -1.398607227600970e-03; +6.537349426207313e-04   +1.894259498187728e-03   -2.609192112358824e-03   -2.432728969095148e-03   -3.907876109179105e-03   +5.035214639815974e-03   +2.200476707693377e-03   +6.367914604347404e-03; +8.614694240563887e-03   -4.136576896646229e-03   +3.665370589637956e-03   +8.838818300157236e-03   +9.699226836480560e-03   +1.140526419059519e-03   -5.673273011141731e-03   -1.267292590518649e-04; +4.206800392048353e-03   +3.633668584919552e-03   -4.200668362588068e-03   +2.970389064832593e-03   +3.716974995868599e-03   +1.739307367712271e-03   +5.895627641558295e-03   +3.886881172560323e-03; -7.106383389113888e-03   +5.781125781697947e-03   +3.954610902521991e-03   +4.327337769028753e-03   +5.697201152749325e-03   -6.421096664845859e-04   +1.082050535494672e-02   +2.357247846964254e-03; +4.854620402799802e-03   +6.273381459650991e-03   -1.916260422429229e-03   -1.272803293664517e-03   +1.208549477576964e-02   +2.113973571265911e-03   +8.129460319775789e-03   +9.848540524468005e-03; +1.323018428837523e-03   +6.950335600152022e-03   +1.945761807356136e-03   +1.651844503647184e-03   -3.444299814104766e-03   -1.539828821238414e-03   +1.720329801288156e-03   +9.321410517964821e-03; -1.113536949059656e-03   +5.903293046928948e-03   -4.766281040404583e-04   +2.349055956577945e-03   +2.995479810761084e-03   -6.887065096917837e-04   +7.214249594361623e-03   +2.943018608362028e-03; +5.812583028457476e-03   +5.820141036371215e-03   -6.702709329050531e-03   -9.803400907894754e-04   -6.097194961371143e-03   -3.632592891954966e-03   +5.323657509386234e-03   +6.946369387336774e-03];
L1E_L2E_iAMPA_netcon = [-3.654390108836962e-03   +1.288280793057294e-03   +5.449292661257568e-03   +7.443931144645556e-03   +1.074138159134383e-02   +8.002049683700010e-03   +4.593151126490608e-03   +5.510722242903355e-03   +3.114295388450806e-03   +9.032805437029037e-04   +2.818935891935721e-03   +1.793768841824746e-03   +6.660302365357012e-03   +3.753470033987456e-03   +4.512383268952927e-03   +8.448353122757067e-03; +6.020590175026139e-03   +9.722898510204041e-03   +1.881076981793218e-03   -1.762766197360006e-03   -1.660178326397926e-03   +4.078112704086277e-03   +1.181417358742468e-03   -5.825608284019687e-04   -4.609433594152217e-04   +4.033865789137003e-04   +9.607940588217683e-05   +4.665760243194341e-03   -7.348028579375287e-03   +5.521678866989895e-03   +6.256492351424600e-03   -1.349363298890260e-04; +2.407052511266175e-03   +1.987046719448449e-04   +9.351989629821027e-03   +1.268473014271429e-02   +4.768982843420886e-03   +1.534509439264872e-03   -7.845079965770579e-04   +2.690803520597228e-03   -4.649002327865630e-04   +1.336129559140713e-03   +4.117076207760043e-03   -1.212370387166689e-03   +2.238392777535497e-03   +1.613892124978375e-03   +9.939275447882307e-03   -2.689638709345117e-04; +4.304166672254807e-03   +1.754443277466828e-03   -4.247512233425512e-03   +3.223356403967247e-05   +6.578401536076889e-03   +9.198086868674958e-03   +6.355839149302931e-03   +3.827214641410820e-03   +3.073138026976065e-03   +7.930572049115941e-03   +2.266859357656515e-03   -3.181135039146528e-03   +7.854003787835389e-03   +3.568727142284291e-03   +5.331248958751401e-03   +8.594594423785011e-03; -2.186919812165402e-03   +1.157002994845837e-03   +4.207999816763866e-03   +1.434582584385632e-03   +9.147423498119577e-05   +5.127719268511421e-03   +9.825962645634746e-03   +8.158933194415473e-04   +1.074444092711899e-03   +1.842770440403354e-03   -3.279016369673937e-03   +9.163968324153986e-03   -1.606233655303474e-03   -1.492725938726959e-03   +6.615013795000076e-03   -7.722836246552389e-05; +7.651385153323300e-03   +9.641268929507169e-03   -8.938710172688531e-04   +4.252771031552009e-03   +1.843026877895793e-02   +5.896987224719223e-03   +1.537144878452762e-03   +6.701419129092789e-03   -3.237655481155332e-04   -1.412937339288240e-03   +8.333541274846123e-03   +5.646865311644526e-03   +7.007707339003570e-03   -4.752707539851610e-03   +1.524402166749627e-03   +7.548553799419900e-03; +3.861990019633756e-03   +4.767160233654785e-03   +2.845451095165759e-03   -4.360269120998013e-03   +3.169490191265848e-03   +1.695616565533496e-03   +4.890757956365969e-03   +3.894495378386870e-03   +2.084243575896897e-03   +4.563834372000100e-03   -5.667835449310486e-04   -1.212467858634023e-03   +8.259817795349686e-04   +4.907622520305462e-03   +2.588383065898255e-04   +2.304859463251218e-03; -4.549962428252997e-03   +1.818688795427900e-03   +5.067122054546776e-03   +9.311073384061768e-04   -3.777532678730102e-03   +2.661351485194283e-03   +2.738651099230677e-03   +8.597356005998346e-03   +3.802700905749696e-03   +5.809338179273645e-03   -2.137046488454398e-03   +1.720853267815868e-03   +2.470945840681160e-03   +2.391624885338520e-03   +8.217487015005556e-04   +3.038894236183325e-03];
L2I_L2E_iAMPA_netcon = [+7.823146363167555e-04   +1.054122654075366e-02   +2.094764250496362e-03   +9.158941079103514e-03   +5.838138827490347e-03   +4.069373115279454e-03   +5.179715193886494e-05   +5.801299408904951e-03; +8.435394065614739e-05   -9.723764885886282e-04   +2.702099470739368e-03   +1.059131781183970e-02   +3.191122296760515e-04   +7.961322286272011e-04   +4.561677055961970e-03   +2.862773849604225e-03; +8.159157581518067e-03   +4.903273431935369e-03   +7.141515322311637e-03   -4.020466566752060e-03   +4.239864208874654e-03   +4.618290657384335e-03   +3.967315167546256e-03   -1.755432527749648e-04; -1.314155244768990e-03   +1.461824488014665e-03   +1.103604648862303e-02   +1.157137742341937e-03   +7.858291243792389e-03   +6.420058112307066e-03   +1.838715984444504e-03   +1.188208503942187e-02; +5.228601983050214e-03   +6.826268285141700e-03   +3.452167712405928e-04   -5.816291629015310e-03   +7.990154308669534e-03   +5.245034915070616e-03   +6.726852069771448e-03   +1.011884057715640e-04; +6.689376516312359e-04   -2.223517593872850e-03   +3.578715980711506e-03   -2.831376218325539e-04   +6.551240219968224e-03   +6.259502393148676e-03   -6.512144685600150e-03   +6.309069881063552e-03; +6.550502917655580e-03   +3.763210103322400e-03   -1.024289112425191e-03   +9.361541183545723e-04   -2.677599697652554e-03   +4.494434605318431e-03   -7.113068388326215e-03   +8.271219057936959e-03; +5.765703418300705e-03   -1.227591280924074e-03   +2.073892969405177e-03   +2.734769107494094e-04   +5.165956808349265e-03   +5.594086379814458e-03   +7.156562619667663e-03   +8.136974578459885e-04];
L2E_L2I_iGABA_netcon = [+3.983392582672219e-03   +1.925618733134942e-03   +3.353305332300330e-03   +4.941687539918482e-03   +1.036902234065181e-02   +3.436644895751218e-03   -2.522891336334001e-03   +6.849130870818099e-03; -4.981617973883858e-03   +3.035456262381951e-03   +6.124160952137198e-03   -4.336360367939114e-03   +7.497119807251457e-03   +5.641408891130823e-03   +1.139783668758846e-02   +1.481484517205303e-04; +5.067211584444933e-03   -2.712757333048051e-03   +6.217014271419502e-04   +1.597952925032379e-03   +4.882045787875490e-03   -6.336489510945409e-03   +3.864392531245187e-03   +6.669865920382926e-03; +3.749751584774323e-03   +1.417597785045634e-03   -2.011039451096729e-03   +4.165827762840614e-03   -2.898508959397973e-03   +3.281471376917849e-03   +3.800721546112203e-03   +4.054549036972924e-03; +4.234912953797429e-03   +1.512509798376803e-03   +6.163543241883708e-03   +9.283355565535410e-03   +2.371620148262266e-03   +2.023252318598396e-03   +5.032118918881948e-03   +1.192141383421219e-03; +7.095114629835130e-03   -4.639407812125473e-03   +4.144435818304005e-03   +8.110002942792167e-03   +4.122540867523342e-03   +1.557027922229268e-03   +3.319672920399095e-03   +1.871955129287070e-03; +8.700679522658003e-03   +5.264043223418327e-03   -4.004540954715200e-03   -2.698618504268858e-03   +7.275978490620155e-04   -1.819178726619367e-03   -1.629873473865164e-03   +1.266699855576799e-03; +1.072917432421499e-02   +1.929231653997645e-03   +7.954827721139593e-04   -3.709725589861601e-03   +1.992736742457902e-03   +5.935539018155029e-03   +2.167820735449699e-03   +1.800095137624571e-03];
L3E_L2E_iAMPA_netcon = [+1.277955893439510e-03   +1.345517796969816e-02   +9.132672956681290e-04   -3.120173447869715e-03   -4.360417492745055e-03   -5.352406377289376e-04   +5.847424294586765e-03   +9.099863208239706e-03   -2.147850964581806e-03   +1.861562888854112e-03   +1.566646465040285e-03   +3.807386936735965e-04; +1.983956200807603e-03   +7.401286836796380e-03   +7.933388564592568e-03   +3.645836412476044e-03   -1.507507968183693e-03   +1.321732163665092e-03   +7.419052860906408e-03   +1.070943820393070e-02   +6.632212741040309e-03   +4.012430794815540e-03   +1.394356502566577e-03   +3.421776314277705e-03; -6.645809445965465e-05   +7.598895922943492e-03   -4.705374911424213e-03   +2.203716781280288e-03   -2.696007114618060e-03   +7.506865247567788e-04   +5.651588624832206e-03   +6.180658659216628e-03   +7.870361068855041e-03   +1.821194815966000e-03   +8.080120191385935e-03   +4.910341681266961e-03; -6.952560497077924e-04   -1.171053405202339e-03   +6.355033681758530e-04   +6.079127991565286e-03   -2.262751793186290e-03   -2.062092861425271e-03   +2.181212522647133e-03   +4.518203597615711e-03   +5.778702294890465e-03   +7.053662097361040e-03   +3.619194678968043e-03   +4.472398063668122e-03; +4.185764397358215e-03   +1.679343099942790e-03   +5.083125689174272e-04   +1.171500888107870e-02   +1.123346396539046e-03   +2.916388163009247e-03   +5.493718894958368e-03   -4.435981078886602e-03   -2.416446594291308e-03   +1.413609216472433e-02   +9.771565446391545e-03   +6.240296032563359e-03; +1.033252088091283e-02   +2.611267029936188e-03   -3.044958361867539e-03   -1.297765260974762e-03   +2.703753892012438e-03   +1.031738193559526e-02   +9.342846627061259e-03   +7.092909751308274e-03   +7.167032458581859e-03   -2.149606944585107e-03   +6.164660892898434e-03   +4.855871294615745e-03; +8.897482643148099e-03   -2.492049531086425e-03   +4.990272679363451e-03   -9.323959858568848e-04   -5.805944639983292e-03   +2.968697108313178e-03   +9.951690412959235e-04   +8.807554432519345e-03   +7.577131357020890e-04   -5.579329549785447e-04   +6.139665955386634e-03   +4.508634048021650e-03; +2.130131488254043e-03   +8.813435302286836e-04   +1.424371292136895e-03   +1.351576015724146e-03   +5.102633890901422e-03   -4.682975891683979e-03   -3.365202040674346e-03   -5.583490132715818e-04   -9.436978824500710e-04   +7.202246751691396e-03   +3.225981562513800e-03   +1.710289062791717e-03];
L3I_L2I_iGABA_netcon = [+1.236775147352631e-03   +6.976209338143869e-03   +8.110346227958972e-03   +1.031762556311555e-02   +3.532805538261243e-03   -3.212998514813383e-03   -4.441527176075028e-03   -6.378946544743823e-03   +2.694803694189688e-03   +1.257478227012804e-03   -9.148034366424826e-03   +1.253682446412755e-02; -9.967109641101104e-04   +3.294400718838638e-03   +6.476944598367153e-03   -2.396600460715950e-03   +7.533394914012464e-03   +5.887550301181559e-03   +7.620756314736009e-03   -2.301223796856318e-03   +7.461551586727101e-03   +5.169670850590155e-03   -2.285055168704865e-03   -3.344396610223022e-03; -7.665396288539246e-04   +1.491531153054984e-03   +6.733599152476214e-03   -2.936234313332067e-04   +2.006421345379459e-03   -3.616731354094851e-03   +5.582230569539763e-04   +1.657855672907474e-03   +6.456396380928245e-03   +3.367509605706824e-03   -2.938343674846644e-04   +3.468691484455728e-03; +1.157759670491210e-02   +3.514695744680036e-03   -3.428084700867527e-03   +2.405476509040215e-04   -2.473604881950173e-04   +8.188644364225763e-03   -4.071554627102408e-03   +3.828283124200292e-03   +6.812772275138737e-03   -3.422198098177453e-03   +5.518625595304285e-03   +1.009324654699998e-02; +4.632194349160710e-03   +2.437044050441478e-03   -2.215335512737202e-03   -2.244984105034671e-03   -5.614048441775461e-03   +9.839176141521910e-03   -4.689675948974672e-03   +2.192537033858350e-04   +7.427141640583453e-03   +1.510536140461456e-02   -4.653369051135603e-03   +1.134651763052072e-03; -2.782529016539202e-03   -3.474210556854792e-03   +3.129690224787065e-03   -2.741323733954537e-03   +4.564540015305175e-04   +3.358057994680609e-03   +4.985269993005919e-03   +4.871016232035815e-03   -9.957259167319940e-04   +3.048383318101812e-03   +3.906333995143997e-03   -8.821372282899823e-04; +8.308380443278172e-03   +1.983464896764703e-03   +6.925914602091042e-03   +9.178430711840536e-03   +4.198661487485162e-04   +1.627422093135978e-03   +6.724117422640287e-03   +6.117877774723871e-03   -1.276629999631317e-03   +9.335597202936387e-03   -9.360308530423984e-04   +3.387961997808106e-03; -1.258382212329833e-03   -4.232695013420616e-03   +1.956230334237105e-03   +7.554208704839130e-03   +5.956247505323398e-03   +3.881647711588362e-03   -3.154505999954008e-03   -1.337324582768777e-03   +1.260392847629643e-02   +1.451995672620980e-03   -5.254777542448756e-04   +4.617708992025423e-03];
L2E_L3E_iAMPA_netcon = [+4.396452843246997e-03   +4.964649143983256e-04   +1.343539842768283e-04   +7.756181196065313e-03   -4.957882875501687e-03   +3.488439242601701e-03   +8.113658598498677e-03   +5.827662064366293e-03; +5.656716191094043e-03   +4.002359847611398e-03   +1.097137885048612e-02   +8.991545239858147e-03   +1.779702726908686e-03   +5.366494107015513e-03   +7.237020546430893e-03   +5.407947403488621e-03; +5.970534086192501e-03   +7.942383939237879e-03   +1.132314104372156e-02   +2.110327645537730e-03   +2.546168015413124e-03   +3.932997868192584e-03   +5.759254864817478e-03   +5.433700248355650e-03; +5.143870849149216e-03   +1.359798299086079e-03   +6.926870258087055e-03   +2.456250375277583e-03   +1.317014286205073e-03   +1.697198640963663e-03   -9.383015235553967e-03   +3.942977941795694e-03; +4.909388113291510e-03   -1.555738232990399e-03   -3.993878355701101e-03   -3.214241551093087e-04   +4.387789385547999e-03   +3.270614720947573e-03   +8.054450288639201e-03   +5.082343539839131e-03; +6.167997167879404e-03   +2.429547342016949e-03   +3.385138245319491e-03   -5.599282250703518e-04   +2.676408890881568e-03   +1.059042065521315e-02   -1.107246233417354e-05   +1.056198382541653e-02; +8.170126616468730e-03   +2.896647781448628e-03   +5.529564858129250e-03   -4.051547924586122e-03   -3.222691632011974e-04   +3.781499358580412e-03   -1.723579993137916e-04   +4.009862233782190e-03; +1.352381628840173e-02   -3.583752946576074e-03   +5.849399951549716e-03   +7.369656007067784e-03   +4.878310556237036e-03   +7.872416070211852e-03   +8.221871155938127e-03   +3.715768780951452e-03; +2.645645836641234e-03   +4.219637602607069e-03   +1.031733767461243e-03   +8.153060024682924e-03   +6.837576550476487e-03   -2.856856031187453e-03   +4.163599069222995e-03   +3.900739532773210e-04; -8.932952244808732e-04   +1.083689743340707e-03   +1.814611916098619e-03   -6.793855412963717e-05   +7.443885081116410e-03   +2.754759222186483e-03   -8.886247572304847e-04   +8.558544540024787e-03; +2.107310985434766e-03   +9.555928325572028e-04   +7.682700473621828e-03   +3.600936825093879e-03   +1.395334956188161e-02   +6.415677265660827e-03   +2.243454829378098e-03   -1.067373011360710e-03; +4.103226808519126e-03   +3.104811126986300e-03   +2.697348218402611e-03   +7.941286188296313e-03   +6.130653407346813e-03   -8.819321604300678e-05   +6.106956792547854e-03   +4.359585839025179e-03];
L2I_L3I_iGABA_netcon = [+8.144211744403511e-03   +6.876445267381556e-03   +2.850692835411695e-03   +6.859413953017699e-03   +8.336196797537776e-03   +7.144463927140354e-04   -1.651931305827278e-03   +5.581020519860209e-03; +3.324709967848260e-03   +6.329052911565301e-04   +5.853550257810985e-03   -1.699501585609095e-04   +6.473452873021195e-03   +8.038546254119277e-03   +1.987466389448153e-03   +4.775293537267449e-03; +2.931499285024455e-03   +3.868374811927065e-03   +9.324131510420268e-04   +9.968761154044077e-04   +1.423902370328839e-03   +4.880949813843594e-03   +8.798834334258862e-03   -2.971220622531893e-03; +2.409618973738115e-03   +8.941993227144588e-03   +1.955771070912644e-04   +6.261350222600751e-03   -9.682957402135551e-03   -1.007280610031694e-03   +7.905214748285334e-03   +4.891082559046366e-03; +2.764561429740410e-04   -1.486557016843505e-03   -1.427449020486595e-03   +2.352577362669463e-04   +6.561169594441557e-03   +3.293535143001526e-03   +3.253818431596667e-03   +4.205355428000369e-03; -1.299997963003456e-03   -2.476122076616937e-03   +4.257853310780632e-03   +1.660389808344551e-03   -1.546065760769358e-03   -4.587555420993417e-03   +2.409671583768013e-04   +1.162881338239225e-02; +1.698935701957801e-03   +4.977726214174121e-03   +6.787664719553696e-03   +2.673175828807135e-03   +1.664116320590821e-03   +6.031102639078860e-04   -4.842416904569390e-03   +5.774631066536437e-03; -9.963369207592466e-04   +3.304035888698027e-03   +7.132801895547416e-03   -8.324419441238257e-05   +3.359358249398817e-03   +1.079802613011079e-02   +3.210229529383331e-03   -8.168617795873989e-04; +8.132570450444739e-03   +2.085843487279045e-03   +9.750843447811455e-03   +4.547340567468535e-03   +4.272720399559644e-03   +2.649805247503215e-04   -2.486867297516577e-03   +7.503611991539731e-03; +5.550685710090174e-03   +6.457257327057109e-03   -1.184855416219684e-03   -3.658694862010564e-03   +2.481963439013537e-03   -3.971760393686310e-03   +4.961344356452034e-03   +4.581580416510156e-03; +2.760821708810176e-03   +8.207783732043544e-03   +2.328984352489103e-03   +3.916068488854986e-03   +2.618708224634250e-03   +6.000702132707644e-03   +9.142494115542445e-03   +4.574391317516626e-03; +2.314732968514488e-03   -6.123880714023730e-03   +2.953615329033056e-03   +7.188226144250680e-03   +7.343528518797384e-04   +8.674811973264291e-03   +8.974439376630176e-03   +6.981890219378914e-03];
L3I_L3E_iAMPA_netcon = [+6.334210729137875e-03   +5.476720456678364e-03   -3.252397513071274e-03   +6.412361563451851e-03   +8.851390382450294e-03   -3.870446347233876e-04   +4.951034624730238e-03   -5.519617570082504e-03   +4.090014693839425e-03   +4.580412691108086e-03   -1.703900294607132e-03   +1.358308017556288e-03; +2.349912890728331e-03   +8.961556057249431e-04   -1.771308254167430e-04   +3.789007942198752e-03   +1.054585927783790e-04   +3.371640242246323e-03   +1.048741646060704e-03   +4.228581723116227e-03   +3.788286130984943e-03   +3.828496476050033e-03   -4.170088705585918e-04   +6.610389177410904e-03; +1.711998611641193e-03   +4.605478733824299e-03   +3.343290996045217e-03   +4.129010276643299e-03   +1.761981595952230e-03   +7.977330446131418e-03   -1.152216063200762e-03   +6.942103439622847e-03   -6.946400775034549e-07   +4.295907687054668e-03   +3.197457387770311e-03   +3.279501672426298e-03; +7.758504714279102e-03   +1.092614654023549e-02   +6.194153461173434e-03   +2.648502362511922e-03   +7.331503056287425e-03   +8.518044352573145e-03   +7.288103617513243e-03   +2.305488385152409e-03   +1.857256422733142e-03   +8.990365390893857e-03   +1.713388633814435e-03   +1.088279200411261e-02; +2.157796169792062e-03   +4.730335200962025e-03   +3.716146514366911e-03   +6.601271646004915e-03   +1.882960258852437e-03   +5.531828156271854e-03   +3.429556497516330e-03   -2.600894276351152e-03   +3.093059156197701e-03   +4.812437043897467e-03   +9.825033927444602e-04   +1.042608850091153e-03; -2.283985495130230e-04   +1.148428660394310e-02   +4.738464927746874e-05   +1.136703885415796e-02   +4.237004214860979e-03   +3.736450168246773e-03   +8.054699676305704e-03   -2.619878459328691e-04   +2.926997295198793e-03   +2.672774486287602e-03   -6.590231231471778e-03   -1.999844631076303e-03; +2.555000382885698e-03   -2.112470628959597e-04   +3.314885721685448e-03   -7.691482263659114e-04   +8.936698011306110e-03   -4.794642267126987e-04   +4.848662637318259e-04   +9.653916163215466e-03   -2.117917070482982e-03   +7.351114072711907e-03   +2.607351647247707e-03   +4.620196326917689e-03; +6.858383376364897e-03   +5.292484000900917e-03   +9.845468050566734e-03   +1.980013595559871e-03   +6.370331449798303e-03   +1.909193736106571e-03   +2.650928062974449e-03   -1.260451383685795e-03   -4.730215398201869e-05   -6.628732046631072e-04   +7.471482835256407e-03   -7.583976817878459e-04; +9.507077286795655e-04   -1.870776164156532e-05   +1.946333227523753e-03   +2.121496780128902e-03   +3.193645629744717e-03   +4.303155194033584e-03   -5.654271125744264e-03   +7.280448617224572e-03   +9.802455383425644e-03   +4.043672976030607e-03   +2.333569142868440e-03   -2.910989813748515e-03; +5.157804125676696e-04   +7.839705745299899e-03   +9.583714464811649e-03   +1.722520301314456e-03   +6.167566376007673e-03   +5.257448277990514e-03   -3.113362998004264e-03   +1.220161738824465e-02   +4.425620202331519e-03   -2.045031480803961e-03   +2.448063089716628e-03   -1.646371477498762e-03; +2.458281368078890e-03   +7.112688136820723e-05   +1.321824346883030e-02   +4.215243095553849e-03   -2.431134564365762e-03   +2.117854681166017e-03   +3.274990688807790e-03   +2.904381500454000e-03   -3.080982045081016e-03   +3.215696782755445e-03   +6.470819446415561e-03   -1.304824261034995e-03; -7.144993287782506e-03   +2.748882401869105e-03   -1.962212160192160e-03   +6.545240330328098e-03   +6.278084428856433e-03   -1.863811865689669e-03   +9.087392820524615e-03   -8.263748873660491e-03   +2.806765388833117e-03   -3.840900121662546e-03   +4.881653561713021e-03   +5.361529943152645e-03];
L3E_L3I_iGABA_netcon = [+1.174808649780667e-03   +3.676429891736107e-04   +2.235753932848749e-03   +1.018591744447273e-02   +1.346045946277307e-03   +1.386878052451445e-02   +4.310600676320730e-03   +4.480791377425947e-03   -1.457395151852432e-03   +1.341321757002009e-03   +4.709744109152527e-03   -2.112019316483567e-03; +6.290890296016947e-03   +2.689532349608833e-03   +2.048822398790476e-03   -5.699697547267089e-04   +6.086466573494229e-03   +6.050074807439805e-03   +1.187302886590112e-03   +7.043945081932095e-03   +4.842838291802990e-03   +7.445332148374785e-03   -7.884992135911192e-05   +2.904735535795553e-03; -2.262374584240147e-03   +1.103139206191376e-03   +5.691998781601567e-03   +5.799004194542587e-03   +2.534408015884939e-03   +9.223543311415878e-03   +1.211850384134812e-03   +1.002460859660497e-03   +4.707520512289910e-03   +1.522047545235040e-03   +3.991717566792250e-03   -5.354148654881550e-03; -1.316611972623268e-03   +5.254032347816339e-03   -7.544079666201675e-04   +1.023738610456034e-02   +6.373438355019444e-03   -2.922703466393634e-03   +3.232848045977740e-03   +2.240735155479322e-03   +7.806251723466487e-03   -1.417834928614070e-03   -2.013356450929744e-03   +6.874985791714917e-03; -6.102088345486892e-04   +9.618875121805287e-04   +7.584127017911882e-03   +1.549157587214811e-03   +4.142268998233303e-03   +6.119636672139113e-03   +6.298369992236332e-03   +1.043836512061709e-02   +5.193434586901602e-03   +5.181143181504323e-03   +1.056363125677654e-02   +3.043149461643335e-05; +5.912791526886145e-03   +4.496392387177236e-03   +8.538341731320485e-03   -7.440802067308159e-04   +3.463693879721592e-03   +8.451855504042188e-03   +6.017667762521210e-03   -6.841418606134275e-03   +2.207248531299411e-03   +4.556364044001247e-03   +6.764052294851516e-03   -1.207904288527343e-03; +7.389184526694498e-03   +4.344953991152953e-03   +3.707536399918226e-03   +1.403749635998134e-03   +3.183678700272121e-03   +5.574560375312062e-03   -1.922281935284311e-03   +1.439753190854850e-03   +1.387999984237753e-03   -4.581484687268378e-03   +8.262083888877845e-04   +7.202885891495494e-03; -1.804566144574121e-03   +2.227101511158964e-04   +3.365483523946116e-03   +9.860236032067548e-03   +2.438448925231295e-03   +1.828261534099311e-03   +4.935833214771520e-03   +2.671709987130362e-03   +5.958849325798617e-03   +8.560964835951507e-03   -3.706975928219068e-03   +7.668060624536131e-03; +1.962034394050375e-04   +3.551950038903894e-03   +5.437428602231085e-03   +2.889385466041371e-03   +3.899811984152351e-03   +9.183981574911682e-03   -1.056451378812759e-03   +8.110298244156310e-03   +4.521317811396379e-03   +6.789432720579415e-03   +6.293507638470918e-04   +4.344624234871541e-03; +4.013103285434138e-03   -4.309951636357596e-03   -5.286244526075566e-05   -4.291644097930765e-03   +1.520446738933409e-04   +8.013673053998714e-03   +8.439579194909492e-03   +4.642940671997877e-03   +3.946642714460306e-03   +6.563084050120652e-03   +3.912146763919064e-03   -7.308867910969083e-03; +4.642623552678142e-03   +3.198464929290689e-03   +2.090857580775467e-03   +3.606941472192071e-03   +7.231093309453775e-03   -3.642078037586577e-03   +9.364393320696584e-03   +3.076801877323367e-03   +9.681181773819270e-03   +8.155801814036667e-03   +4.733992568692137e-03   +6.662085301252457e-03; +9.242276491725781e-03   +4.793251203599577e-03   -6.673366660006500e-04   +5.740639477238730e-03   -1.101423754014611e-03   +2.844418526846105e-03   +9.595029312107147e-03   -4.917469531686073e-03   +1.194160211288369e-02   +2.189673221803892e-03   -1.930208638477960e-03   +4.556799018917625e-03];
L2E_Input1_iAMPA_netcon = [+1.838405238408407e-03   +1.344453963468010e-02   +5.578097128006660e-03   +5.840498249076963e-03   +1.067587882948192e-02   +4.695319313362080e-03   +3.257935061640657e-03   +2.679877103330450e-03];
L2I_Input2_iAMPA_netcon = [+7.560752213252667e-03   +9.923619226629115e-03   +9.822058629964305e-03   +6.857598047405922e-03   +4.913458024985096e-03   +3.813622908025578e-03   +6.020882008053435e-03   +1.110726555418030e-02];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.0*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.2*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.0*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.2*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.0*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.0*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.2*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.0*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.2*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.0*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
