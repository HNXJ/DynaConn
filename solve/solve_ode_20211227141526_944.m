function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+6.660039470658100e-02   +2.988445665330640e-02   +1.143315444007445e-01   +3.591113462343083e-02   -3.823433568183633e-02   -1.836998041226441e-01   +2.626787193827250e-02   -1.172094297216934e-01   +1.187167492467888e-01   -8.187524393941002e-02   +1.057731113110681e-01   +1.773934286324746e-01   +6.593782454445538e-02   -6.190271427704991e-02   -1.158403707319295e-02   +5.656347092426191e-02; -7.332473707078503e-02   +5.129383837326457e-02   -5.480292713118013e-02   +1.154132320138857e-01   -4.874632148512673e-02   +4.563727925188119e-02   -3.638641836720899e-03   -6.619947995606465e-03   -1.642927072240321e-01   -2.505914787050249e-02   -5.089165997710508e-02   +7.430999871150379e-02   +6.024648373736594e-02   +2.775949051771276e-02   -7.816052982638930e-02   +1.130421918380303e-01; +2.094426874605100e-02   -1.470222096128233e-01   +8.332625512293265e-02   +1.129871344130073e-01   -3.141097026403446e-02   -6.718496445591593e-02   -1.593551535467611e-01   -2.010323670150233e-01   -1.728678047504776e-01   +4.364500072904277e-02   +1.668093095757756e-01   -6.498972988097293e-02   +1.841109697055090e-01   -1.500935997855904e-01   +2.257641572290001e-01   +6.249594188459247e-02; +4.880888362274549e-02   -5.041913973584074e-02   +1.757881522905973e-03   +7.384184792180622e-04   +2.704239649952222e-03   -2.794188144311683e-02   +5.943362482528083e-02   +4.747277646311841e-02   -1.680685212673388e-01   -1.293000939833258e-01   +4.362134096612437e-02   +9.779303625633318e-02   +1.626259906253447e-01   +5.699111639553621e-02   +1.189077921346082e-01   +3.414460109720825e-02; +9.666388304463633e-03   -9.135578277620345e-03   -1.648456340469464e-01   +5.846394165187205e-03   -1.908706928738089e-01   +1.216495889094799e-04   +1.036318342712421e-01   +1.305904150952544e-01   +1.331960116345604e-01   -1.493739766446827e-01   +2.256979072404685e-02   +1.031380724693376e-01   -5.164737288418120e-02   +1.166066318888562e-01   -5.664078183611652e-02   -3.036930724068276e-02; -1.795421565264560e-01   +1.591131083398304e-01   +1.556995267216190e-01   -1.206776960669153e-01   +9.222277397793560e-02   +1.276436221759178e-01   -1.629389474169680e-02   -8.831723989732546e-02   +8.077703481117578e-03   -7.805150158630413e-02   -3.145098245408432e-02   -9.982803812412470e-02   +1.541048638817838e-01   -1.424874501021444e-01   -1.671495652444978e-01   +1.188466656932556e-01; +4.778419283514177e-02   +1.410729591424482e-01   -2.316850492827173e-01   -1.483291613383822e-01   -1.615460844869534e-01   -6.898153516033292e-02   +3.174744733958677e-02   -6.399899316105058e-02   +9.085496362689693e-02   -2.219942143042615e-02   +7.510840901271065e-02   +9.013568043134214e-02   +9.820280487356639e-02   -6.325833177867383e-02   +1.560551244004628e-01   +8.192822551693199e-02; -2.996911389184249e-02   +1.827300819624351e-01   +1.567282463132511e-01   -1.204288080018721e-01   -2.137292222457874e-02   -6.742615452563532e-02   +1.376860247353645e-01   +1.096179462856313e-01   -6.015229888806061e-02   +4.278954685616521e-02   +6.953199937184365e-02   -9.464349633742779e-02   +1.298417814181391e-01   +8.565884581510227e-02   +5.465411561883848e-02   +9.663440225845990e-02; -1.326418108878316e-01   -1.245775498380904e-01   +2.235607781639296e-01   +1.118437939175564e-01   -8.809778174937838e-02   -6.507804756608068e-02   +1.940647201125396e-01   -9.359052666396493e-02   -1.616614888896498e-01   +2.270218149676057e-03   -2.414610102210534e-02   -4.635555471421921e-02   +2.417986237068440e-01   +1.481314185411204e-01   +1.601515160030516e-02   +4.127254276529331e-02; +3.237015906763910e-02   -7.324614412144793e-02   -7.585889619175953e-02   +2.253417990116429e-01   +2.250155593439670e-01   -8.187839002699202e-02   -3.999244062380156e-02   -9.359669375002840e-02   +2.357972184495248e-02   -1.614324537602293e-02   -9.791247077422770e-02   +1.589147133804492e-02   +1.468221727774726e-01   +2.003347797380270e-01   -1.041759088659868e-01   -2.135727971949124e-01; +1.939243053423430e-01   +2.564731412897429e-02   -2.152597987756850e-02   +1.034687354447121e-01   +3.299587287671682e-02   +2.342038511398060e-01   -9.230699100058697e-02   -1.549016209272439e-01   +1.467062271042346e-01   -9.116841201907887e-02   +3.179696349325817e-02   -4.693357516975047e-02   -1.350318585954765e-01   -1.296325747641287e-01   -2.215870231487436e-01   +4.218406843224895e-02; +4.836864599329742e-03   -2.148747570245745e-01   -3.050675491398665e-03   -8.119147250911990e-02   -1.001451326329698e-01   -2.547173877243793e-02   +7.441143645572806e-02   +1.138241221530588e-01   -9.815198743285838e-02   +8.089500885054783e-02   +6.740546046399265e-02   +6.511474245039697e-02   -1.102762078590513e-01   -3.667051309180326e-02   +9.131574446928231e-02   +6.112536951539960e-02; +3.287519329863998e-02   -6.714093705393125e-02   +1.271937426274616e-02   -3.756508579599704e-03   -5.499449734674097e-02   -1.305420680127771e-01   +1.482270662653625e-01   -1.589245811598284e-01   +6.198214350126312e-02   -2.195252880900856e-01   +4.241868366018348e-02   -3.152303233165430e-03   +8.737674257391276e-02   +1.411198258913930e-01   -5.791787474075775e-02   -6.664302483742671e-02; -5.619638060259901e-02   -3.852079156409727e-02   -1.581947601334674e-02   +4.744897543651195e-03   +1.612218733080777e-01   -1.546328686387842e-01   +1.304536028347030e-01   +8.416685314855503e-02   +1.150678685970033e-01   -2.945597783037399e-02   -4.469188803829144e-02   -1.051531154619133e-01   -5.904760437915124e-02   -1.625441345756541e-01   +2.300198955634730e-01   -4.940581137027287e-02; +1.047111710275536e-01   -4.081339277972403e-02   +5.380014565034237e-02   +2.889328888445860e-02   +1.812952826887545e-01   -1.692979737918894e-01   +1.521670188085432e-01   +1.103516819449170e-01   -3.837159828012172e-03   +8.793936185775864e-02   +4.865045112082025e-02   +3.430116299363399e-02   +8.351755319935220e-02   -1.857720113101364e-01   -2.672937777216827e-01   -2.584989420007019e-01; -1.165784929901116e-01   +6.429993084048502e-02   +3.020394912621409e-02   -1.615618744363442e-01   -1.554743405199224e-01   -5.675824322959876e-02   -1.207941487460242e-01   -1.920474952715701e-01   -8.239478744308337e-02   -3.219770065613302e-02   -2.031351934167719e-01   +1.282856233935827e-01   -8.066184237890575e-02   -7.344947535618576e-02   -1.087396909701014e-01   +6.869883154690988e-02];
L1E_L1I_iGABA_netcon = [-5.393544694002314e-02   +5.840885469808370e-03   -7.885641756473519e-02   +2.592287186068807e-01   -7.050881240786767e-02   -1.314393399718125e-01   -1.770728714104929e-01   -3.836056005140615e-02   +9.041544666407021e-02   -9.397442578318214e-02   -7.117993573246731e-02   -1.525714758372906e-01   +3.227802337712068e-02   -1.359932196158791e-01   -1.622769541162774e-03   -1.369808524837186e-01; -4.262391169786978e-02   +1.375359938168402e-02   -2.944829268682404e-02   +6.436315397145588e-02   +2.773568444794391e-01   -1.393200255683048e-01   -9.472952918470569e-02   -5.665502770909745e-02   +4.648675597487358e-02   -4.457438703075636e-02   -1.265784375553649e-01   +8.245393696502812e-02   +4.706937444653167e-02   +1.909635762310500e-02   -8.346895302878651e-02   -5.486731223349291e-02; +3.197358063054916e-02   +2.475468163254262e-01   -2.251305766804746e-02   +5.330627766813713e-02   -8.414617579052949e-02   +1.231516425787917e-01   -5.285038648130878e-02   +1.583701984246031e-01   -1.725609604317328e-01   -9.963687188407443e-02   +1.118349345550141e-01   -2.814071379608865e-01   +7.989801877603964e-02   -2.837381629426540e-02   +8.543013081451410e-02   +4.416206612358584e-02; +5.560610800516456e-02   -4.080292630479729e-02   +8.192107708331384e-03   -3.029804478666713e-02   +1.258487039798798e-02   -5.737216426111674e-02   +3.069611242056836e-02   +1.175312909147416e-01   -1.281305354644713e-01   -8.263524837697776e-02   +2.378409321535379e-01   +1.319774835449382e-02   -2.119600030117563e-01   -4.104136915486497e-02   +1.541160129263519e-03   -8.673474064655559e-02; -2.441183653113471e-01   -3.185730020977513e-02   -1.704065936449702e-01   -1.039010120889982e-01   +4.380448722179299e-02   +4.559451224349421e-02   +1.709395599351693e-01   +2.819875525417305e-01   +1.758900295149909e-01   +8.904394636832236e-02   -1.248392293142066e-01   -1.603821836063934e-02   +1.127490139133280e-01   +1.024518215599025e-01   -4.194263679815896e-02   +1.990113162561184e-02; +1.783898814868839e-01   +1.181388746552202e-01   +1.315638067469181e-01   +5.971422783093443e-02   +1.326343708953031e-02   +1.113804011748565e-02   +4.347978097804962e-02   -5.885275605451339e-02   -7.693317924418333e-02   -2.064418441875280e-01   -1.476047876934384e-03   -6.515490220792776e-02   +2.015574747291812e-02   +2.059287197207330e-02   +1.136681728973350e-01   +3.300279761169335e-02; +1.828240654605823e-02   +8.809617575837730e-03   -1.391534003816625e-01   +1.528840614344498e-01   -1.669120525835338e-01   +2.500330635483455e-01   -5.903935614068169e-02   +6.974613059347226e-02   -1.240174575475569e-01   +9.994823219555957e-02   -5.862745022875013e-02   +7.393669474251351e-02   -8.037082581491393e-02   -9.849565268337618e-02   -7.024275106155989e-02   +9.261383466020656e-02; +7.074779839557621e-02   -9.309871016497308e-02   -1.059037038803950e-01   -9.627502696359044e-02   -1.458784954777748e-01   -9.222713739948508e-02   +1.235226034414321e-01   +2.542400899417595e-02   -5.266211967027035e-03   -7.102900169010235e-03   -2.418965153410330e-02   -1.879139045365689e-02   -3.925571882511728e-02   +7.177812333350238e-02   +5.622924774203193e-02   +1.906074966189371e-01; -1.064597159404257e-01   -2.605596065126013e-02   +1.580162194439470e-01   +7.790093371066620e-02   +1.017629293247034e-01   -8.594806999689369e-02   +8.297479657321453e-02   +8.991262736934771e-02   -1.685603180555071e-01   -1.667610541388491e-01   -9.444466906481910e-02   +3.652666797000588e-02   +9.119195231357813e-02   +1.430824144492712e-01   +2.269651856633607e-01   +3.591311431879491e-02; -4.717258048078055e-02   -1.046106674127269e-01   -9.113355605948656e-02   +2.940099851014744e-01   -1.249545540442835e-01   +2.269659166464809e-01   -4.777287516918769e-02   -1.799002538618779e-02   -1.119903626275295e-01   -6.379007745037422e-02   -1.442924459067621e-01   -5.017047583318479e-02   -9.687824513323028e-04   +1.420685127339930e-01   -4.011697342631731e-02   -1.123759235532669e-01; -2.049016593178940e-01   -1.970962785746021e-01   -4.970358402419071e-03   -1.707081794301610e-01   -1.027305938898894e-01   -2.841028421672883e-01   -4.177041213946180e-04   -1.158187955547346e-01   -9.885698828364931e-04   -8.389141799364359e-02   -4.241669514557417e-02   -1.201972962967331e-01   -4.822678190347483e-02   +4.486231099078684e-02   -5.324725670501574e-02   -2.054639204681248e-02; -1.207558429820250e-01   +1.821432639287560e-01   -1.144019598163349e-01   -6.994600896805363e-02   +1.141293287846518e-01   -6.731882803723023e-02   -9.000552820773586e-02   -8.619336158409852e-02   +1.678552106661425e-01   -6.515988766107997e-03   -1.775839977432696e-01   -1.352605673593189e-01   +4.652785500350249e-02   -8.532991730355505e-02   -1.389840823712886e-03   +1.139089084605964e-01; -6.333273946732518e-02   -4.322125987470295e-02   +1.936831859131497e-02   +1.253155799566861e-01   +1.042481808459063e-01   +1.271590965665665e-01   -2.174198298758742e-01   -6.303229861628425e-02   -1.478716918851802e-01   -3.478871504927200e-02   +5.652981350351981e-02   -3.805334340936487e-02   -2.090891062553228e-01   -1.234993701793163e-01   -1.431595114625715e-01   -8.507188112995720e-02; -4.494879959961579e-02   -1.057026073731209e-01   +4.628569110270817e-02   +6.382963632874174e-02   -1.665066412927685e-01   -1.308759481998815e-01   -4.001227206641936e-02   -1.067574732948202e-01   +1.191883413925341e-01   -7.763099226730844e-02   -1.339255398344678e-01   +6.211575504945718e-02   +1.116465797622026e-01   -2.753049358684763e-02   -1.266180318519407e-02   +9.196614919268355e-02; -7.109641103099962e-02   -1.399642990143473e-01   +6.151593417201870e-02   +1.062794599425773e-01   +2.870511844594084e-02   +9.552549095974679e-02   +9.298068187089480e-02   -7.490325568719530e-02   +1.376249943075318e-01   +2.721562956188117e-02   -4.743091542130874e-02   +2.423131464764740e-02   +1.555381297828171e-01   -1.800245108024004e-01   -4.943635064985447e-02   -2.023590546674838e-01; +6.149907706355483e-02   +2.038514435601615e-01   +2.550854391026940e-01   -1.786094051487095e-01   +8.968725539916055e-02   -1.662647721638661e-01   -2.456133956033012e-02   -6.573823456295999e-02   -3.496632362519769e-02   -7.262978311316136e-02   -5.801716255859785e-03   -8.839427650359229e-02   -1.698512662191223e-02   -6.090152262311810e-02   +6.314301162649773e-03   -4.314846649124019e-02];
L2I_L1I_iGABA_netcon = [-2.961301993356873e-02   -8.875166678399665e-02   -1.502634832966958e-01   -1.645351643626962e-01   -8.059170252264700e-02   -6.331536322946822e-02   +1.293838139558316e-01   -1.296374367376293e-01; -9.394952638748964e-02   -6.448332531957485e-02   -1.029988603474589e-01   -4.867565780523998e-02   +2.331222586412821e-02   -4.769752522000768e-02   +4.172868123848429e-02   -8.271927570121429e-02; -1.557515677968969e-01   +9.277738956366455e-02   -8.129847377757442e-02   -1.063832156539014e-01   +2.486581047633830e-01   -8.165897728576157e-02   -1.061495571303362e-01   -1.856013366245611e-01; -2.163542162799756e-01   +6.411737802883204e-02   -3.015103223010174e-01   +1.350373524496566e-02   -4.133068631094361e-02   -1.406800370163650e-02   -3.459429487124203e-02   -1.309222766500159e-01; -1.053729286157329e-01   -6.404767334767449e-02   -8.828111158028169e-02   +1.710917318354964e-01   +6.799637368306123e-02   +9.782355049139668e-02   -6.856936800089940e-02   +1.422148099595807e-01; +1.622098312131048e-01   +1.993561825543212e-03   +6.882947154096281e-02   -2.099831726978461e-02   +1.900539669114490e-01   +1.118162162201612e-01   -1.778699169036209e-01   -3.342823486144984e-02; -1.370537505492440e-01   +9.198303502377154e-02   -2.001074951570298e-01   +2.043282964947843e-02   -4.094777543805247e-02   +3.036684173628833e-02   +9.615606179516528e-02   +5.281064533663062e-02; +4.351287522302003e-02   -7.420961324688258e-02   -1.799147986146559e-01   +2.013915211572763e-02   +7.606602861965370e-02   +6.260009401632502e-02   -1.325399508806675e-01   +9.295458429131756e-02; -1.951264006450050e-01   -1.317578534243662e-01   +1.082175582122533e-01   +1.388325215622825e-01   +8.206486185051933e-03   -1.398108568051605e-02   +1.267213860057363e-01   +1.845594183434434e-01; -9.519156651772456e-02   -1.539847752817745e-02   +3.553303605703675e-02   -2.734244059210987e-02   -1.223402329363359e-01   +2.302141647467944e-01   +6.190120376666883e-02   -1.686431492102310e-01; -1.652858253589594e-01   +9.437270546969828e-02   +3.252947453454628e-02   +2.797710040739942e-01   -1.762589218983570e-01   -1.810289131241778e-01   +1.047713833952956e-02   +1.702567449842822e-01; +1.141505092056792e-01   +1.002734483947856e-01   -3.495103607485266e-02   -6.399189462852323e-02   -1.159277558232436e-01   +1.754049187217586e-01   -2.719108417577441e-02   +6.411564663233492e-02; -3.391308659635495e-02   +5.195961688124322e-02   -7.891326225222167e-02   +3.760617612712806e-02   -2.628888177888073e-02   +2.295979820515057e-01   -3.113063040662792e-03   -1.224938355222060e-01; +1.963438742578416e-01   -1.431500053081005e-01   +6.650834401663085e-02   +1.135851406902782e-01   -1.918100311074267e-01   +1.174699642457806e-01   -1.429795104454144e-01   +1.400102032617869e-01; -3.696794476219731e-02   -1.526181110969412e-01   +6.841327578795450e-02   -1.029961960886599e-01   +2.566565792057373e-02   +2.152133067895968e-01   -9.748556035046724e-02   +1.073675688710902e-02; -1.944513046066514e-01   +8.471970620675881e-04   -4.363868701061045e-02   -7.243376677717359e-02   -6.373784892227164e-03   +1.262474256693420e-02   +3.519296062880699e-02   -2.765196000346394e-02];
L1I_L2I_iGABA_netcon = [-4.273950916603218e-02   -8.392391476510409e-02   +7.358662870882418e-02   -5.701183535000823e-02   -1.490598623832177e-01   +4.313047904030119e-03   -7.032930185498283e-02   +2.668891027241283e-01   +1.054535939307907e-01   +4.578861555448489e-04   +4.427651865048441e-02   +9.165718256324984e-02   -5.134948580941583e-02   +7.310373784559066e-02   -1.256775475131207e-01   +1.360933607184001e-02; -2.157866601949054e-01   +7.197334131224854e-02   -1.098736866393567e-01   -1.547542928233002e-02   -1.225836131651883e-01   -1.909317565157469e-01   -7.775237127428114e-02   +2.255797292142990e-01   -8.299472047926748e-02   +7.183257155968892e-02   -1.714352120755346e-01   -2.297497439726521e-01   +3.180789948185789e-02   +5.202047489672516e-02   -2.083177674675398e-02   +9.856866190566416e-02; -2.675671042248587e-02   +8.996045309320068e-02   +8.759926470552862e-03   -1.016830101652370e-01   +1.820716474688296e-01   +5.503495651387656e-02   -2.204868573824007e-02   +3.333852563944142e-02   +3.308839010140117e-02   -9.251944777171420e-02   -3.342782933426574e-02   +7.331694330821732e-02   -3.013009758089004e-03   +1.844544823407459e-01   -7.807539309146048e-02   -1.012782150212039e-02; -6.001140875602531e-02   -1.365764385640010e-01   +2.371142652218390e-03   +7.177897149061666e-02   -2.408111703710662e-01   +4.513942109626059e-02   -8.701642107883362e-02   -2.652563602957504e-03   +7.245507808976676e-02   -1.812889520048429e-01   -5.351591701511746e-02   +1.113177113416105e-01   -9.909468956390954e-02   -3.332083035208528e-03   +1.269829679563978e-01   -2.711531944290659e-01; +9.653481005724922e-02   -3.326748046283259e-02   +8.056897370114841e-02   -2.634893559816320e-02   +5.331391415591862e-02   +1.243727737342615e-01   -1.132377132729294e-02   -1.248514176860920e-01   -1.201021790207308e-01   +6.985041908343820e-02   -4.839870642576576e-02   -4.229261802073387e-02   +8.305988536002275e-02   +5.468032769826625e-02   -2.797386503533877e-02   -2.711933999247108e-02; -2.230444307319331e-01   -7.942451877391334e-02   -2.459126439830049e-02   +5.629421726563709e-02   -5.933456253225515e-02   +1.325312464459059e-01   +2.492980676728952e-02   +1.458369066274603e-01   -8.392168035049519e-02   +7.137578586095505e-02   +5.623958228762132e-02   -3.529926639891821e-02   +8.591516054335314e-02   +1.052947348703781e-01   -9.983100686568330e-02   -2.341263661628225e-01; -1.604575034244524e-01   +5.202704129299282e-02   -5.866290795887303e-02   -1.114928385507302e-01   +2.382633817853117e-01   +1.330530351250511e-01   +5.396979337449876e-02   +2.645863152143279e-01   -1.128553630901291e-01   -2.115482400156616e-01   -1.280290779641503e-01   +1.066874221789779e-01   +7.898849994395099e-02   -1.678985736714475e-02   +1.520925021407865e-01   +2.690493257252905e-02; +5.115629193384215e-02   -1.467157097074975e-01   +2.856626312225309e-02   +2.223530014038970e-02   -1.189681464377197e-01   -2.709466694627317e-02   +7.034162993422571e-02   -8.154274906463184e-02   +1.389731663658379e-02   +1.270621456128862e-01   -2.539553986387869e-02   +9.506728808998773e-03   -9.590389446124324e-02   -4.385710087643240e-02   +1.276314788338447e-02   -1.307789081889155e-01];
L2E_L1E_iAMPA_netcon = [-2.152624534588995e-01   +1.143634347239220e-01   -6.860108609109936e-02   +1.459990818623705e-01   +4.141996036878721e-02   -1.935271969902811e-01   +5.233739460877006e-02   +6.795214886404702e-02; +1.806729513018443e-02   -8.522909509296865e-02   -3.917965161196232e-02   +4.177899617627211e-02   -4.220586932833362e-02   -1.152700688959854e-01   +1.102138246650987e-01   +4.611024835293508e-02; +1.975766660450330e-01   -1.478254062306201e-01   -1.310700831456236e-01   +4.591483477915466e-02   -1.226150884310203e-01   -1.255541663301584e-01   +1.459981718289040e-01   +2.500942895705670e-02; +1.088246405018685e-01   +1.641968128690008e-01   +6.462988238580773e-02   -2.307922216381984e-02   -8.987222505704560e-02   +1.745679430306582e-01   -1.111013935457062e-02   +3.656411415178844e-02; +9.418842392083331e-02   +9.154341080628349e-02   +1.620994480016464e-02   -4.909021394224469e-02   -1.607846139175580e-01   -5.870664626439752e-02   +2.144180795821570e-01   -3.098236431078792e-02; +1.415535224928343e-01   -1.569289808607498e-01   +3.062244006854941e-02   -1.323928930957821e-01   -9.467913769244712e-02   -3.977305702994265e-02   -5.103544729798848e-02   +1.798956340783336e-01; -1.973383411708670e-02   -2.807262368267470e-02   -7.360594414078117e-02   -5.620074005396707e-02   +3.878946067511915e-03   -1.064794421049043e-01   -3.387594615429118e-02   +1.969232255858639e-01; +1.727772608469133e-01   +3.920092414158030e-02   +8.390764342394402e-02   +5.004184675878286e-02   +1.557955353272925e-01   -9.256577572874120e-02   +1.498410572660183e-01   +4.040659098851155e-02; +3.684274655482199e-03   -3.339349594935966e-01   -8.668582070423587e-02   +4.141859127703597e-02   +1.492346863448237e-01   +2.374261571140841e-02   +1.086005222230849e-01   -2.299116791404410e-01; +1.274068424215485e-01   -1.903028848778190e-01   -6.126048413735527e-02   -3.004362422419181e-03   +5.528441691051682e-02   -7.481189232100954e-02   +6.302903360962706e-03   -7.112132712652153e-02; +1.535723171057685e-01   +1.044029709864295e-02   -1.554126739983800e-02   -9.067879882118710e-02   +2.275144950690899e-01   -1.351179506966665e-01   -1.577743079236684e-03   +4.582140222179923e-02; -3.276335377913481e-02   -1.705175592836977e-02   -4.962521503213541e-03   -1.382742965835412e-01   -2.367751290092716e-01   +4.743369983422573e-02   -4.058849508858507e-02   -1.571683893491317e-01; +7.898625907756340e-02   +3.039573774286992e-02   -4.431683474287963e-02   -1.853670524505350e-01   -5.164107961315678e-02   -5.928758923859234e-02   -4.798173836402284e-02   +1.712179993326074e-01; -1.469238811506883e-01   +8.153957042594387e-02   -1.272492775714754e-01   -1.217322976588489e-01   +8.113487067363742e-02   -1.055480722999288e-01   +8.484824445021992e-03   -1.346637354722182e-01; +4.235891554374316e-02   +6.551251098468826e-02   +7.573355588226885e-02   +1.075271338842431e-01   +4.968412968561871e-02   -1.219691606057513e-01   -4.099978491785013e-02   -1.261064413745047e-02; -1.877075125909223e-01   -1.222792065795756e-02   -5.488392446899830e-02   +4.895775900565748e-02   -3.385299502085048e-03   +2.233629994580547e-01   +8.912803828575050e-02   -1.518532627387692e-01];
L1E_L2E_iAMPA_netcon = [-9.478878975812616e-02   +8.391922026368255e-02   -1.381052098055351e-01   -4.498723569338423e-02   +5.721125291018980e-02   +1.547568959699107e-01   -7.112895357261947e-02   -7.947539747297017e-02   -1.043701994668313e-01   +1.954889045792245e-02   +2.240161588827423e-01   -9.088921391902582e-02   -2.020543733045834e-02   -5.543059601048706e-02   +8.070609931649599e-02   -1.394207948598303e-01; -4.894573342325991e-02   -2.290054382810706e-02   -6.511189974428250e-02   +1.140881193900195e-01   +1.755151423755600e-01   +2.148425218835098e-02   -3.095724211742439e-03   +1.674965053016374e-01   +1.160792573389647e-01   -9.076272254183580e-02   +1.182180155087382e-02   +5.535714291829491e-02   +3.155653426471563e-02   -8.979912018535041e-02   -1.324121562076274e-01   -1.926984170927271e-01; -8.390471846751713e-02   +4.629939113127324e-02   +1.074109173905672e-01   +9.675484644398914e-03   -1.016284331616810e-01   +6.222274198877166e-02   -3.730333761106847e-02   -1.411107796870106e-02   -2.008564786048681e-01   -9.991495016569781e-02   +1.174855377619128e-01   -7.327250494541784e-02   +1.043817073482025e-03   +2.460001745640527e-01   +4.536980626027599e-03   -1.800009577394908e-01; +1.100472198165978e-01   -4.468917423615788e-02   -6.005276603560436e-02   +1.477627919361291e-01   -3.924988147024633e-02   -4.881507693676771e-02   +2.355719936157999e-02   -2.467703623645442e-01   -1.066592610730529e-02   -1.313932141273185e-01   -7.165769971244712e-02   +1.039207413223011e-01   +2.581321417402535e-02   +2.162015107668670e-02   -1.635049664437760e-01   +3.657001733842736e-02; +2.695636309228033e-01   -1.294062104348100e-01   -7.939906230360758e-03   -2.216680012254625e-02   +5.257948178535657e-04   +6.084686012891825e-04   -1.244599585239506e-01   +3.153882617441638e-02   -5.337033807998343e-04   +5.570576326421273e-03   +1.415542464265557e-01   -1.580592031877631e-01   -3.246570963834673e-02   +2.419423311769227e-02   +1.397359173433511e-01   -1.567386742939665e-01; +1.404183952054471e-01   -3.152480615404004e-02   +8.226540028814168e-02   +1.435229078931472e-01   -1.801198646348895e-02   +1.930232687224165e-01   +2.580804008348535e-02   -6.961454639909642e-02   -2.658644276908753e-01   -6.023070623108787e-02   -2.149018067337087e-01   +8.295776721815815e-02   +1.179473638767403e-01   -2.947201437477183e-03   +1.605175948741663e-01   -1.473909447956716e-03; -1.320994369096407e-01   +6.145801249775400e-02   +1.359885446262664e-01   -4.746823230766525e-03   -6.821434910683620e-02   +7.128248475278477e-02   -1.545766842228236e-01   -1.227757807486845e-01   -3.061843532908985e-02   -1.330915985592599e-01   +1.313345080098844e-01   -2.864307212934045e-02   +2.287344916078710e-02   +1.146579106996809e-01   -3.366491727495440e-02   -8.960484073188515e-03; -1.008528128625954e-01   -1.339468335850768e-01   +4.203460914847956e-02   -1.241350243626318e-02   -4.846477015317437e-02   -9.929813396168490e-02   +1.557409535106832e-02   +2.562589654543935e-02   -6.930259347463005e-02   +4.815365503080470e-02   +1.459116002745008e-01   +1.601175944965371e-01   +1.033213081051321e-01   -1.563236904367558e-01   -2.568337571176402e-02   +1.594911537808282e-01];
L2I_L2E_iAMPA_netcon = [+2.783212746147917e-01   -1.432824817672750e-01   -8.573093105348583e-03   -1.114975891455245e-01   +6.194494620970661e-02   +3.595857183495060e-02   +2.758412175774305e-02   -1.083279994363377e-01; -7.140249676473691e-04   -6.069841377110081e-03   -1.144244006419446e-01   +1.027472627763077e-01   -1.467822197369519e-01   -3.464571989839077e-03   +4.938920287957115e-02   -1.926006585769670e-03; -4.570329680044429e-02   +4.611332743841377e-02   -9.489946780530500e-02   -3.605607175311464e-02   -1.809226020377946e-01   +1.086123434633406e-01   +6.249604466447217e-02   -2.766659038890404e-02; +1.028321358958509e-01   -8.242845297274862e-02   -1.501813555318615e-02   +7.960879075510470e-02   -9.774310127930963e-02   +1.086734561848596e-01   +5.810363795865487e-03   -1.094761220275917e-01; -1.034931864472364e-01   +1.452314653667053e-01   +3.860106029271845e-02   +9.341884111126943e-03   +9.313321000311327e-04   +1.183504091615396e-01   +2.477694108032263e-01   +1.834365285851783e-01; +5.949425424155309e-02   -1.320841197953359e-01   -6.540454587354726e-02   +1.797873727719391e-01   +6.634295102914510e-02   -1.610212830442231e-01   -8.846083650013625e-02   -1.591085106995022e-02; -1.255737126090284e-01   +5.396427257814014e-02   +9.179702039126647e-02   -1.897450484069882e-02   -1.391126605134086e-01   +1.126169364779994e-01   -3.573074466690467e-02   +4.490291820045914e-02; -1.705381149842810e-01   -7.079862348119993e-02   +1.233652283390746e-01   +3.507710582265316e-03   +1.276666170581964e-01   -4.523450683102248e-02   -9.002816253476890e-02   -3.180702344550582e-02];
L2E_L2I_iGABA_netcon = [-3.002109472797948e-02   -8.205016766921480e-02   +4.138892106290325e-02   +1.694965841129246e-01   -6.927508592606711e-02   -5.653556513120812e-02   +6.445741405344141e-02   -1.413891310576031e-02; +1.798367286083919e-01   -1.957117988768965e-01   +1.610386350220613e-01   -3.155495402002721e-02   +9.108333171457401e-02   -6.793694396827477e-02   -2.987352492299957e-02   +1.774870953215587e-01; -2.405413928790182e-01   +2.513566782547171e-01   -6.967929235118707e-03   +8.544922270249110e-02   +1.255736140251500e-01   -1.446606345437973e-01   +1.466948987088860e-01   -1.942551565238380e-02; +1.059844749868927e-01   +2.107147291042442e-02   +1.150985339182582e-01   -1.691225484374542e-01   +1.521562440149092e-02   -1.277068368225529e-01   +5.074353355901846e-02   -3.325561147120262e-02; -1.256895097502901e-01   -1.460521570319950e-01   -1.273857921782000e-01   +3.542499184159704e-02   -8.922838026454390e-03   -3.563929960763964e-02   -1.671784323261333e-02   +5.654905404221103e-02; -1.838016340263631e-02   -1.710812515081904e-01   +7.760417938744153e-02   +3.320039524327930e-02   -1.756834349226406e-02   +7.643788589284126e-02   -6.762867139421323e-02   -2.405546707017373e-03; +8.092823517317030e-02   -1.947883150611482e-03   +1.278385256547775e-01   +1.557132688605796e-01   +7.380749205491655e-02   +1.526500511271039e-01   +1.053972670840902e-01   +7.683193546611804e-02; -8.427023882751641e-02   +2.318687486849935e-01   +1.159689612922686e-02   +4.438931927898732e-02   -1.312225336949963e-01   -6.510087829258590e-02   -8.187022804904572e-02   -3.088673934716218e-03];
L3E_L2E_iAMPA_netcon = [-8.762964477074968e-02   +7.275021803064063e-03   +7.876191900245205e-02   -1.064425981912930e-01   +1.557184048428070e-01   +4.541196112517490e-02   -6.805217740043655e-02   -6.019089287512201e-02   -1.749756087887343e-01   -6.633679699080519e-02   +1.109257252417080e-01   +1.178534779395977e-01; +6.817366644202121e-02   -5.773607502531583e-02   +1.289015753610787e-01   -3.733393749972687e-02   +1.501211034029457e-01   -1.567520090111129e-01   +2.270803985660818e-02   -5.879241242731154e-02   +1.527832899134715e-01   +2.390925681707577e-02   -1.621354477548256e-01   -1.422052085396788e-01; +1.213597404634707e-01   +2.600502118025055e-02   -1.231262009346705e-01   -2.979915015360540e-02   +1.620302928064862e-01   +2.312353927164486e-02   -6.000175563698768e-02   -9.519140200861650e-02   -1.779903098939066e-01   -1.164320766234915e-01   -1.523644711136466e-01   -9.307587088876484e-02; +8.245748583535110e-02   -3.448618319192423e-02   +1.081689374586220e-01   -1.110394159214847e-01   +2.448249336248290e-02   +1.828982364058965e-01   +8.782616587651948e-03   +1.539616718678144e-01   -4.694492928611332e-03   +1.243819734857761e-01   -1.858845271344383e-02   +1.455795515151699e-02; +1.739776831622637e-01   +4.023579158621261e-02   -1.396167173001825e-01   -1.453024100504674e-01   +3.137967801298905e-02   +2.265508254473870e-02   -6.786564761494113e-03   -1.676593467557985e-01   +1.168993914617113e-01   -7.900684197332739e-03   +6.643266437880611e-02   +1.340475942695160e-02; -1.968921086241827e-01   +1.681562483824528e-01   -5.601180323153212e-02   +5.968431195192132e-02   +1.098409507000141e-01   +1.329900196647448e-01   -2.135157533337669e-02   -2.099059327053802e-02   +3.264028595428896e-02   +4.130453317895469e-02   +1.433792578342851e-01   -1.278325178494167e-01; -7.448843574390306e-02   -1.136680689931886e-01   +8.390444597791417e-02   -1.572900120330688e-01   +2.412173666941836e-01   -1.125304811457348e-01   +9.441490040321951e-02   -3.145533720761558e-02   -5.623039508473756e-02   +1.091629368729464e-01   +1.330873477519875e-02   +2.786537145436887e-02; -2.323351319385320e-01   -1.540304776207207e-01   +4.410006404666579e-02   -4.423512752734236e-03   +3.449899547579259e-02   -9.830128892553630e-03   +1.389429102009075e-01   +1.840253557321392e-01   +4.766734784792115e-03   +3.722617039011857e-02   +1.386292439423194e-02   -1.833496791351937e-01];
L3I_L2I_iGABA_netcon = [+1.142326977512427e-01   -7.808825482135229e-02   -2.495672758380171e-02   +2.465463180261893e-03   -9.709397555681329e-02   +5.937545965461215e-02   +8.154371144209438e-02   -5.064350819418444e-02   +5.179883011885043e-02   -9.235322902074652e-02   +9.476853512751024e-02   +1.194646757824145e-02; +1.690805757358672e-01   +1.274819043688734e-01   +5.434870520411456e-02   -1.020525482647859e-01   -2.604164199477381e-02   -8.561691367609653e-02   +5.531992005695862e-02   +1.456512412471310e-01   +6.630198102728321e-02   +2.870374717199749e-02   +1.429331803370540e-01   -1.564083660995969e-02; -1.747538037495637e-01   -1.956807083303377e-01   +4.678045723814720e-02   +1.487332243673649e-01   +1.307618823090854e-01   -2.425765925188803e-03   +1.670678850039728e-01   -8.767787425153059e-02   +3.268770529260576e-02   -1.506366902641591e-01   +1.286432026119663e-01   +1.192572003390488e-01; -1.228571531223155e-01   +1.563951613013333e-01   +2.996754914776029e-02   -5.310377910828477e-02   +6.649925494444255e-02   -7.604652040139062e-02   +1.855336153181593e-01   +1.181466828054499e-01   +7.284273637513602e-02   -1.479726327153036e-01   +5.424271669058684e-02   +6.016557557568825e-02; +6.210340306762351e-02   +2.792385819831457e-02   +1.944210363192016e-01   -3.042297903777744e-02   -6.363324050244551e-02   +1.796929590831025e-01   -1.130473447150470e-01   -2.563275303263150e-03   -1.444600216302637e-01   +1.202829394135467e-01   +3.301180694121924e-03   +7.015049264926181e-02; +1.021310174195234e-01   -1.665069254475381e-01   -2.245550418647000e-01   +4.796527202473296e-02   -1.586127699067450e-01   -1.583470063615564e-01   -5.048714450895687e-02   +5.759457958094010e-02   -1.728474365815672e-01   -1.451549466016221e-01   -1.586515170495517e-03   +1.744407854102800e-01; +3.381881834346280e-02   +1.140154612511682e-01   -8.278050278461650e-02   -3.157414237625119e-02   -1.588841964640285e-01   +1.721231456476806e-02   -1.667295022139161e-01   -9.419359369293712e-02   -2.720455107068167e-02   -9.657413108326136e-02   -1.931783655127929e-01   +6.423111320236145e-02; -2.435533317779721e-02   +9.995043326719255e-02   -2.804448635675534e-02   -7.937983209303262e-02   -3.362651900636216e-02   +8.367326085859977e-02   +2.500684359865486e-02   +1.302712355001855e-01   -1.762935221415389e-01   -1.097741318104357e-01   +1.944036266489131e-01   -5.952247383311342e-03];
L2E_L3E_iAMPA_netcon = [+1.376039625242256e-01   -5.032147279090608e-02   -1.825921490345289e-01   +8.440331991983001e-02   +1.868493917619716e-02   -6.339739931200389e-02   -2.210973108335467e-01   +6.972452746347238e-02; +2.536925093675060e-02   -1.723455121393384e-01   -1.020271076017437e-01   -1.853484444149669e-01   -1.531704515984289e-02   -3.023702468796493e-02   -1.066975128311034e-01   +2.469107949680098e-01; -1.474680382862847e-01   +2.257254463207110e-01   -5.735073076758820e-03   -8.337896746652934e-02   +7.864255739040345e-02   -1.127547748019204e-02   +7.356399213744266e-02   +6.350067525724255e-02; +2.417787363730451e-01   +2.434990556292187e-01   -2.386901774300011e-02   -4.464220811885639e-02   +7.210733661208284e-02   -6.204701556189902e-02   +5.558641649314396e-02   +1.142526046031621e-01; -3.687251415207194e-02   +1.202199273128708e-01   -3.888616118513558e-02   +1.152893116715917e-01   +1.670577392979185e-02   -6.695940176638306e-02   -1.496762525687420e-01   +3.198583725690930e-02; -3.490914038545080e-02   -8.695800598895626e-02   +1.621623913897880e-01   +9.048605331553004e-02   +9.016518807635916e-02   +4.207603452530766e-02   -4.710181449667085e-02   +1.382676604205894e-01; -6.622811780512923e-02   -1.532351891193220e-01   +1.899110385248413e-01   +5.553070036332673e-02   +2.095111159905873e-02   -2.406431379124790e-02   -9.486456360091432e-02   +1.101005117077483e-01; -8.502301889999052e-02   +7.827812435209026e-02   -1.082974902554046e-01   -9.823413662377198e-03   +2.202543716634768e-02   -9.128957200726857e-02   +1.537998437897426e-02   +1.390730514005760e-01; +5.014067345256649e-02   -1.046065205419151e-01   +1.740822930529691e-01   +1.266999390677920e-01   +1.071837915392456e-01   +2.831457711555872e-02   +9.991004576377013e-02   -2.206887593634001e-02; -1.834716734116237e-01   -1.007500805728269e-01   +9.624873456989376e-03   -3.235566811924384e-02   -2.901143240806732e-02   -7.342067995627087e-02   +1.320427430110348e-02   +8.684208891758402e-02; +9.154625751567842e-03   +2.847716958980676e-02   -1.390638714834636e-01   +2.146111569831630e-02   -3.831605262512168e-02   +1.010037519269819e-01   -3.592701740114028e-02   -5.379107302573083e-02; -1.126198596017454e-01   -2.282211168966662e-02   +2.384761862877994e-02   +8.092800626776531e-02   -4.159168594806868e-02   -1.310250929285739e-01   -9.307624469466345e-02   -1.334590794557217e-01];
L2I_L3I_iGABA_netcon = [-5.806715695524214e-02   +5.399638531788593e-02   +1.572185170627522e-01   -1.106998809772070e-01   +7.510084253093928e-04   -1.599871492527125e-02   +8.257858059130789e-02   -3.315597529479768e-02; -6.918588687776109e-02   +1.904439876157796e-02   -3.019296512185946e-02   +6.010766542762808e-02   -7.723646901837905e-02   +1.130420093698254e-02   +2.760848356450293e-01   +3.182974591119346e-04; +1.408962579562969e-01   -1.837424075595084e-02   +9.671945770064663e-03   -1.644558945686450e-01   +4.846101230748736e-03   +7.620564617614148e-03   +8.166749644861748e-03   +1.093886830318688e-01; +4.137691625948511e-02   +1.543105202262259e-01   +6.581053654363320e-02   -5.068909780022922e-02   +5.255770957468751e-02   -1.197447465379413e-01   +1.702739634418220e-01   -1.334741036981126e-01; -9.549242115651574e-02   -4.572993518189925e-02   -1.300588325013941e-01   -7.432220980029482e-02   +7.156338638884072e-02   +8.817900870946141e-02   -5.395195851870201e-02   +2.529494546399839e-02; +2.923227170256579e-02   -3.911131185115777e-02   -2.618746193561987e-02   +1.278021278324726e-02   +9.954719024187471e-02   +1.289400421935787e-01   +1.162598998021023e-01   +8.748145623408428e-02; +9.786306558401053e-02   -2.875382731626394e-03   +6.762816767368297e-02   -9.487916767389419e-02   -3.022763538331336e-03   -9.913675220152952e-03   +1.772422662618248e-02   -1.690651416483693e-02; -3.958017171089866e-02   +1.968043165812793e-01   +6.977068211866166e-02   +1.831297585279804e-02   -8.471080340051040e-02   +4.370083986870260e-02   -1.814529773733366e-01   -9.005849878766377e-02; +1.931343928943050e-01   +9.467247306138274e-02   +1.542178601017623e-02   +1.334569497248119e-01   +5.635377770123058e-02   -5.003414816859895e-02   +1.979151855355827e-01   -1.256187088968990e-01; -9.069021774946503e-03   -6.070217638999277e-02   -5.877910597898350e-02   +9.989347391342690e-02   -7.559291328081458e-02   -1.940803009662845e-01   -1.799453515805287e-02   -6.836802886823142e-03; -1.014196815956582e-01   -1.993563336652836e-02   -1.617418999187319e-02   +2.210811430931278e-02   +1.284430707467764e-01   +8.364051052858004e-02   -8.330516420620453e-02   -1.916570035057436e-02; -7.189766893697391e-02   +1.721165145069321e-01   -1.769591556767855e-03   +1.413731017651029e-01   -5.528758673477045e-02   -2.016858103493295e-02   +3.114984392593125e-02   -5.561048358763591e-02];
L3I_L3E_iAMPA_netcon = [+1.080467853123464e-01   -1.218011296378610e-02   +2.405061651286683e-01   +1.699037396484771e-02   -5.029439209138339e-03   +1.113923886146182e-01   -2.133178846050892e-01   -1.221869994950237e-01   -5.388132448652788e-02   +2.795358642523249e-02   -8.301240667513222e-02   +1.930308310357813e-02; -2.191330860280829e-02   -4.978391561270148e-02   +2.452341362725756e-01   +5.526534284329004e-02   +3.198553609580877e-02   -2.921742588588920e-01   +4.817765201336209e-02   +2.347655295830740e-01   +2.016633765314161e-01   -7.731510234737246e-02   -9.600784650366184e-02   +5.097645003801532e-02; -1.063042282872271e-03   -1.973698178057473e-01   -1.839073966430678e-01   +2.726715537956815e-02   +1.413078073510944e-01   +3.351193360932122e-02   +2.693713404193908e-02   +1.145381110678110e-01   +4.658079326053934e-02   -3.388097832131007e-02   -7.208745806665365e-02   +1.600254702060773e-01; +4.890888208579292e-02   -3.331629014004488e-02   +2.559710312100125e-01   +1.682419037879176e-02   -1.386135001823344e-01   +1.070056467774120e-01   -2.017644885662853e-01   +8.635658182870751e-02   +6.031701826755452e-02   -6.855815218241737e-02   -3.049639263943154e-02   +1.844189849436474e-01; -6.419605458442747e-02   -2.697132170421522e-01   -1.275461988236432e-01   -1.466455297653178e-01   -3.118455009937188e-02   -1.633941223058732e-01   +1.288930717287164e-01   -1.267465845157658e-02   -1.396501663213621e-01   -1.884626975621369e-01   -1.301264243886920e-01   -1.341940533276726e-01; +1.214967991295907e-01   +1.246207003687322e-01   +3.926765799587190e-02   -2.090060000788754e-01   -1.879910891141924e-01   +3.943834412171998e-02   -8.886479403413139e-03   -5.233348706362183e-02   -3.629641283218601e-02   +1.256763738624916e-01   +6.120518483857863e-02   -4.035034609897076e-02; -1.525589677040901e-02   -1.634544278261691e-01   -9.448724664644709e-02   +1.267536531220951e-01   +1.091571120438820e-01   -1.199094280169363e-01   +1.032782253209131e-01   +4.315181062730972e-02   +3.362358355010972e-02   +1.372933370884224e-02   +1.168134260433997e-01   +1.023211813163002e-01; +5.480208996034580e-02   -4.232169922469042e-02   +1.040815691913722e-01   +4.638033759163509e-02   +2.534261347408365e-01   +1.061332752193167e-01   +1.063973624078311e-01   +2.490278258906929e-02   +3.415970812505539e-02   -4.993535565732883e-02   +2.941508713343868e-02   +9.670304992615994e-02; +2.099651330812229e-01   -1.292930421561735e-01   +1.333188359341546e-01   -1.369470997818064e-01   +6.896003911277282e-02   +1.809545229914550e-01   +1.745664468330536e-01   +7.040127292324051e-02   -1.057669706394593e-01   +5.384231195856024e-02   +3.292479796680257e-02   -2.609975925960628e-01; +9.603970518519864e-02   -3.421973306054196e-02   -1.203291800956279e-01   -2.981200035720993e-02   +2.127174259750810e-02   -3.069985339885169e-02   -1.025233567053394e-01   -5.761035242322453e-02   -3.165951874816640e-02   +2.534413797818907e-02   +1.015833392075743e-01   -3.967995765614350e-02; +1.026987665905573e-01   +2.448247750478497e-02   -2.049022171384134e-01   -1.667939129050558e-01   +1.288779494511733e-01   -2.091641836103792e-01   -3.398804967293467e-02   +1.599702318608388e-01   +8.085832082336816e-02   -6.247532644638241e-02   +1.256634056514170e-01   +6.405932416485961e-02; -1.207671602071460e-01   +1.876545404706828e-01   +6.073775772334249e-03   -1.992573885837414e-02   +1.355409066092709e-01   -1.285400959048286e-01   +6.075430826465850e-02   -1.477739762558036e-01   -8.598461640125317e-02   +2.080540970921212e-01   +1.783039305157760e-01   +1.527023932619968e-01];
L3E_L3I_iGABA_netcon = [-3.888696645812686e-02   +1.286286566195063e-02   +1.152241086447336e-01   -8.741659195128305e-02   -1.527334180152466e-01   -1.582149612550772e-01   +8.107597827624009e-02   -1.104270402468060e-01   -8.540989502010243e-02   +2.401009836329892e-02   -3.023186140559066e-02   +9.190062629484225e-02; -7.930012513928369e-02   -4.869226841413086e-02   -9.415551051508327e-02   -1.039034637299644e-01   +2.450195679909659e-01   -5.713287706959820e-02   -2.271425318641086e-02   +2.536267400155058e-02   -5.894625526148278e-02   -1.297324766069875e-01   +2.585632594171943e-01   +5.902299019084999e-02; -1.166813505028807e-01   -5.854646067693901e-03   +9.525061007352238e-02   +3.152492496794853e-02   +6.685675301546881e-02   +5.380385936333575e-02   -1.348126175493517e-03   +1.575971029976993e-02   -6.316305217384767e-02   -1.113750381564197e-01   -9.540950944278120e-02   -2.802242846494121e-02; -5.327240746991464e-02   -7.477394504231981e-02   -8.137083025067704e-02   -3.842941182868687e-02   -7.310123212413501e-02   +2.103478179960629e-01   +1.545849890516797e-02   -4.052676276151437e-02   +4.998146342361053e-02   -2.369177144986432e-02   -1.873364367826710e-01   +1.869753598182854e-02; +4.175352283863716e-02   +1.701043128190740e-03   -4.860449861357903e-03   +1.197720072007157e-01   +7.510866957215032e-02   -1.671097830914374e-02   -3.342298587679156e-02   -1.893944588507906e-01   +2.479937529064870e-03   +4.158626093625177e-02   -1.847276657887634e-01   +2.277777938834655e-01; -7.992162341183394e-02   -4.864556455580193e-02   +1.121567201012232e-01   +6.024064572611552e-03   -3.827100476149999e-02   +6.310175350478769e-02   +1.268430576967940e-02   -8.809179624962683e-02   -1.650107199973715e-01   -5.495944536057094e-02   -9.613437424354640e-02   -2.341280530202648e-02; -1.234205816851146e-01   -7.475783592061681e-03   +6.871746795107515e-02   -1.495460933206599e-01   -1.507533199381903e-01   -1.216850290544412e-01   -5.742910487958369e-02   -1.490637004645530e-02   +1.423597688653899e-02   +2.445083950040515e-01   +2.609037742080984e-02   -4.105253569418472e-02; +6.936377188786266e-02   +4.831719391660132e-02   -9.504973148848186e-02   -1.376208699008373e-01   -8.735609839126211e-03   +6.645433251117223e-03   +3.482487727636428e-02   +6.121398656452520e-02   +4.391057703919014e-02   +9.954517753946736e-02   -8.531470752060588e-02   -8.988052694478972e-02; -7.956225819866555e-02   +2.008413394780952e-01   +8.293717757815970e-02   -1.445064173112638e-01   -2.537750293857766e-01   -2.370040783580220e-01   -1.678382371615013e-01   +1.178332970552805e-01   +9.748949104484277e-02   +1.548116848405471e-01   -2.074273058008669e-04   +6.868638050491804e-02; -7.563670403277464e-02   -1.012530956098940e-02   -2.436307496094277e-02   +2.670015849803528e-02   +1.392390855751162e-01   -7.906439370540198e-02   -2.684007408250022e-02   -4.666228207630170e-02   -9.418671307930632e-03   -5.992090294730731e-02   -2.054556261531663e-02   -1.214277442669912e-01; +1.312634071999248e-01   -1.120660844878972e-02   -2.828623670394466e-03   -6.519820173155267e-03   -2.997427576207374e-03   +1.734519627105502e-01   +2.624093740311024e-02   -4.094529293947335e-02   +8.219740061184011e-02   +5.415963465154216e-02   -1.319771550444313e-01   -3.094062659253838e-02; -1.256564268405522e-02   +1.151594071947519e-01   +1.590997771307026e-01   +5.369052350664836e-02   +1.676269745661223e-01   -2.827275687264655e-02   -9.108847803392914e-03   +9.542777109632006e-02   +4.686903288932721e-02   +1.912311141827327e-01   +1.656504377402982e-01   -5.382990334009766e-02];
L2E_Input1_iAMPA_netcon = [-1.537475998605592e-02   -1.445053348912314e-01   +2.145271594374601e-01   -4.590267975806887e-02   +7.442250041253425e-02   +5.483164865790756e-03   +3.245470757878596e-02   +1.341438368790481e-01];
L2I_Input2_iAMPA_netcon = [-1.106557832763889e-01   +8.763251144999224e-03   -9.928225426361639e-02   -2.162088839196105e-01   +1.368965053122162e-01   -9.634233141488709e-02   +1.969958661576400e-01   -1.594860866742148e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.03*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.15*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.15*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.03*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.15*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.15*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
