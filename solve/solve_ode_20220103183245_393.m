function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+7.125478775457094e-01   +9.491172655468560e-01   +7.002345823038379e-01   +1.637066577510034e-01   +9.212557301498062e-01   +2.101283630202224e-01   +7.430271148661762e-01   +3.048219813662350e-01   +5.374636406814786e-01   +8.363137111102986e-01   +9.714995265666196e-01   +9.696764665055769e-01   +6.980213834332967e-01   +3.720369280099400e-01   +2.958284457254957e-01   +3.817195994706817e-01; +3.488897600519903e-01   +1.240894250819909e-02   +1.397856347849796e-01   +1.714556822326677e-01   +7.736430536843408e-02   +8.133778719860222e-01   +7.981867132993025e-01   +7.555866328246373e-01   +7.909875727315939e-01   +1.875719867043030e-01   +4.762861564813298e-01   +6.642471632752815e-01   +3.689846457659370e-01   +2.767855216630202e-01   +6.852901383327731e-01   +9.608399170897467e-01; +2.019217311212617e-01   +4.762819294435421e-01   +8.346265739345697e-02   +7.113208390754183e-01   +3.147758074405800e-01   +3.839067272959178e-01   +6.596218780177939e-01   +9.561073757855074e-01   +4.866354213973811e-02   +9.269530953560368e-01   +8.735495373962340e-01   +2.028074862081811e-01   +5.448246077196849e-01   +6.997028963106540e-02   +7.775141524381072e-01   +8.132225381109435e-01; +2.572697454924568e-02   +4.896167367027398e-01   +4.327645102478123e-01   +8.422466339382999e-01   +6.351180288966487e-01   +8.658578497768191e-01   +4.409235896717693e-01   +6.191451582250242e-03   +4.636534438345437e-01   +4.208148790055296e-01   +9.418713101546846e-01   +8.989084814108180e-01   +5.136030912781673e-01   +1.539114849751435e-01   +7.167010450117526e-01   +8.936242514521970e-01; +7.640410045568714e-01   +5.179440065405808e-01   +9.025167494389982e-01   +7.998563684153501e-02   +9.075943970578556e-01   +3.197086354181056e-01   +5.792098501200683e-01   +4.028215118764145e-01   +9.418051278850280e-01   +2.982496355340615e-01   +2.397666954706141e-01   +4.822997829869134e-01   +7.686975010020906e-01   +3.652336777823076e-01   +2.742381431892954e-01   +7.049491316310462e-02; +5.739687089436747e-01   +2.873140607787381e-01   +7.237630768487262e-01   +8.367858027934350e-01   +8.007326332931266e-01   +3.829775105575581e-01   +5.189503338316759e-01   +1.560842741971153e-01   +4.734232188977824e-01   +3.520856068554375e-01   +9.216005952716734e-01   +6.657957219404017e-01   +7.571730911866792e-02   +7.134367459683735e-01   +1.829072822724934e-02   +9.031713211091550e-01; +5.824033751208105e-01   +5.635824626393200e-01   +6.849927181896155e-01   +5.484772793647835e-01   +6.458721168913781e-01   +6.452754100131596e-01   +7.277943165356413e-01   +8.276176284984827e-01   +7.791820094952425e-01   +9.764055237014279e-01   +6.339632158694481e-01   +5.251956210331944e-01   +6.776059126832804e-03   +5.376281598804131e-01   +1.590682470270074e-02   +6.713002078292972e-01; +3.884099052494455e-01   +5.153977306807727e-01   +2.053654739583134e-01   +9.660176106967930e-01   +4.415352840324656e-01   +3.895011161103472e-01   +2.196622554556245e-01   +2.840139124722497e-01   +1.120740044742445e-01   +5.345909369389070e-01   +2.894271480398568e-01   +7.053244478778455e-01   +4.077404045815126e-01   +2.345795365712229e-01   +9.324753885190979e-01   +3.455129775556323e-01; +5.561110127005161e-01   +6.731583517613698e-01   +5.258148949387758e-01   +6.729702449412887e-01   +7.496971986890217e-01   +7.429309983456187e-02   +9.989092947609284e-01   +9.800015177244874e-01   +5.185961691271310e-01   +7.931454065662783e-01   +8.484796674439565e-01   +7.190465827978777e-01   +6.609682718385269e-01   +4.719540143636686e-01   +9.359896100251109e-01   +8.428112979384392e-01; +1.870602882951334e-01   +6.162049447944559e-01   +8.256925085547033e-01   +3.362741704699455e-01   +8.328019413415149e-01   +1.679644697660893e-02   +6.221366599619108e-01   +6.260331635021008e-01   +6.407272737575244e-01   +8.000615907850236e-01   +1.629623927992780e-01   +2.926339373962800e-01   +3.753195046384570e-01   +7.205807400288406e-01   +3.749763955974845e-01   +1.961192702494931e-01; +1.202434122807222e-01   +5.671042080355896e-01   +1.801929385284116e-01   +2.177091916209669e-01   +3.451216682667651e-01   +8.742439543328041e-01   +9.877425284128639e-01   +7.481912001289280e-01   +5.778914794523855e-01   +1.399945735617575e-01   +8.251368755967514e-01   +1.141837625408237e-01   +3.955274646031234e-01   +5.202809637696753e-01   +1.031291396265196e-01   +8.451781129521733e-01; +5.387842951108768e-02   +5.061804170290087e-01   +5.148840556588730e-01   +5.704984523051388e-01   +1.489556851185325e-01   +1.584499991962272e-01   +4.937153926079826e-01   +8.828408437715533e-01   +8.382747385060356e-01   +4.573663690230460e-01   +2.161172249815858e-01   +3.295592286276868e-01   +1.371454437431556e-01   +5.168924017023967e-01   +7.242213126345290e-01   +4.260698861073098e-01; +9.386593149215833e-01   +6.636673460087155e-01   +3.565546421451584e-01   +4.276741104199782e-03   +5.030176493380504e-01   +9.203270841974525e-01   +5.238115184013887e-01   +3.312074858091040e-01   +1.151351458984811e-01   +4.540315691693221e-01   +2.697281820691721e-01   +4.636443818243490e-01   +3.387558038874789e-01   +3.903555833844320e-01   +4.542903990168733e-01   +5.598075628998461e-01; +7.441308659240294e-01   +6.382636377183861e-01   +6.505032339616736e-01   +5.931904100453629e-01   +4.143588444107728e-01   +5.629098528767820e-01   +8.567892217983533e-01   +9.524999699773144e-02   +5.077150672108843e-02   +9.611961854409186e-01   +9.022522661281754e-02   +7.175582861589739e-01   +1.233676715894070e-01   +4.835110533509008e-01   +1.421465552218587e-02   +4.466338223105629e-01; +2.391322327537839e-01   +1.417731088136706e-01   +2.797532919824625e-01   +8.960865183616396e-01   +1.746214021389401e-01   +9.218563776467990e-01   +2.528784638949648e-01   +4.469877605887738e-01   +5.234960701350110e-01   +5.081393572249006e-02   +9.179684772253032e-01   +3.996336573171935e-01   +3.672803676907777e-01   +7.434943288214479e-01   +1.171848251077299e-01   +7.623419469309549e-01; +2.016482687768056e-01   +1.797322542043268e-01   +4.334891534692703e-01   +2.583118270226324e-01   +4.950442950095856e-01   +5.972813059062702e-01   +5.788062399930224e-01   +2.359001841107157e-01   +7.037258874111764e-01   +3.718661979824173e-02   +7.303260739044030e-01   +2.396889695824259e-01   +2.464720176893416e-01   +7.066561954541758e-01   +6.595962229076191e-01   +9.769916161821982e-02];
L1E_L1I_iGABA_netcon = [+8.385189629026799e-01   +7.494594148834638e-01   +8.730579907591699e-01   +4.355930488030790e-01   +9.207050953760263e-01   +7.708726362823657e-01   +3.216962887624362e-01   +6.414839620790571e-01   +9.511419364650663e-02   +2.799754479458505e-02   +1.318952761929880e-01   +5.214283517304967e-01   +8.732538140417353e-01   +5.759576910621986e-01   +1.704312100351110e-01   +6.326414249244602e-01; +6.136528904057411e-01   +9.937435339775116e-01   +3.110686832018503e-01   +1.484772598486754e-01   +8.852952115421920e-01   +2.731993993330395e-01   +9.666564915392988e-01   +4.348432763603349e-01   +2.933237403195739e-01   +5.106173093497069e-01   +4.289332103992589e-01   +2.048493839204849e-01   +8.053428689712645e-01   +2.911243562330718e-01   +5.809724762968424e-02   +3.414782811670332e-01; +6.645592227953449e-01   +3.738066501116347e-01   +4.328024049853375e-01   +6.508478562638478e-01   +5.878694175184098e-01   +5.248254023607251e-01   +3.546016659993138e-01   +4.821506441725946e-01   +3.313407037495328e-01   +8.656390112479438e-01   +4.804791749999822e-01   +7.691464762005702e-01   +6.408491766031280e-01   +1.394733485817991e-01   +2.157553873422022e-01   +1.540163536749600e-01; +7.796841897755005e-01   +5.052888581290471e-01   +3.815959374146732e-01   +7.260059093846378e-01   +8.352748799637367e-01   +4.094329747870545e-01   +3.191176399166690e-01   +1.007485551536843e-01   +4.775281875213510e-01   +5.810893430002632e-01   +6.712669350296893e-01   +3.866349001294687e-01   +7.344491149067132e-01   +4.206143149908681e-02   +2.086792768532952e-01   +4.000284168409931e-01; +3.146660321109240e-01   +7.551179248738373e-01   +6.552368100825263e-01   +1.682561884847933e-01   +7.799773162893032e-01   +7.835684823818242e-01   +9.141539746909582e-01   +8.071222268964638e-01   +2.430125418860403e-01   +4.275956519232001e-01   +3.523816339179787e-01   +6.757418368231469e-02   +6.666387171284929e-01   +6.252022837171158e-01   +2.168104478871533e-01   +9.127610342236846e-01; +3.280360557426917e-01   +1.327290579103728e-01   +2.443628372691993e-01   +3.421735101659070e-01   +7.877109281136410e-01   +2.359728771103971e-02   +8.834811452016798e-01   +6.266072180743290e-02   +4.591009365644124e-01   +7.168063051920901e-01   +4.588541742091481e-02   +7.540431449772332e-01   +8.881010601230570e-01   +6.057978396457325e-01   +5.800316189869548e-01   +1.581377090326047e-01; +6.330803032246293e-01   +5.152574677292079e-01   +6.873625990294692e-01   +1.052896736603470e-01   +6.966890542937253e-01   +4.092565816436358e-01   +3.607362698872060e-01   +9.568545154443453e-01   +7.555953917299011e-01   +2.296388716410169e-01   +2.937972089533362e-01   +4.548311346719799e-01   +8.529285290728953e-01   +3.695470541071803e-01   +3.483502746294544e-02   +4.680604712537361e-01; +9.001496396105353e-01   +9.050244091157656e-01   +3.281946275785796e-01   +4.473988880597103e-02   +1.966865360752119e-02   +8.286118621082431e-01   +7.439443248188170e-01   +7.733312410164549e-01   +7.158277066497677e-01   +5.854024238514472e-02   +7.978745584229638e-01   +3.174833865291871e-01   +4.067934955807884e-01   +8.347540306577648e-01   +7.957537136180504e-01   +7.877784586328768e-02; +3.728499258307035e-01   +1.025744658204226e-01   +8.734963845332698e-01   +4.757228944740464e-01   +3.236683618035836e-01   +5.927232646561683e-01   +1.259420149731539e-01   +4.442452786056454e-01   +2.307445851155073e-01   +9.773276525722394e-01   +6.500720166386684e-01   +2.740044123756820e-01   +1.094538202498870e-01   +5.192643307333630e-01   +1.366792073006022e-01   +3.363088191684335e-01; +8.813419730558856e-01   +1.811193240908746e-01   +9.993343596131360e-01   +4.794352720006069e-01   +9.446987449072841e-01   +2.114725260650903e-01   +5.926423113743410e-01   +1.653502058789657e-01   +7.045632542967557e-01   +9.719829057606141e-01   +7.087556784368030e-01   +5.737659548234636e-01   +4.065366551295072e-01   +8.093266448045282e-01   +5.787829204593412e-01   +4.905202093725424e-01; +1.201928716580248e-01   +1.767678070229228e-01   +6.863545377256896e-01   +5.507865509872955e-01   +4.071231701004622e-01   +2.944501562754416e-01   +4.380917046348677e-01   +8.258736663631466e-02   +3.051420551374661e-01   +1.343448534860809e-01   +7.576935815421642e-01   +9.098915766568663e-01   +3.375852546832668e-01   +5.752105573810459e-01   +8.409244141139149e-02   +4.974694062310426e-01; +9.119790366982417e-02   +5.397759280119782e-01   +3.465217232561351e-01   +6.505905282494185e-01   +6.281766359869962e-01   +2.692390033769503e-01   +9.634518145185826e-01   +7.415665848553441e-01   +4.674074420752008e-01   +1.620502732315410e-03   +3.898146903273328e-01   +4.492966631749702e-01   +1.124556072342652e-01   +7.114096764911333e-01   +2.263699794816594e-01   +1.306614276077974e-01; +5.431933730412618e-01   +9.730992503776434e-01   +5.609559030166756e-01   +3.495938385107612e-01   +8.526626291025466e-01   +9.321190627288144e-01   +9.725044947736809e-01   +5.365964271856253e-01   +4.401918131444231e-01   +9.307226180503138e-01   +3.663196252383753e-01   +9.790544316791685e-01   +8.562425622831110e-01   +7.351676761015193e-01   +4.491300260763293e-01   +7.869128388883126e-02; +6.020009124311788e-01   +8.449805755783634e-01   +8.914392013893350e-01   +2.521651984465663e-01   +3.696585564477985e-01   +5.546686546794217e-01   +2.504567992854673e-01   +4.870308599371069e-01   +7.307972326693705e-01   +7.380668255932883e-01   +8.154424523564540e-01   +1.042268342568391e-01   +8.960260121423759e-01   +4.478457341823475e-01   +1.804028259898822e-01   +6.735359601184208e-01; +7.265810778377672e-01   +6.698191650334173e-01   +6.483067705227359e-01   +1.812160099987513e-01   +2.040065987911991e-01   +4.320731379738688e-01   +7.745783671141603e-01   +8.864649937822654e-01   +8.754668151841117e-01   +4.293153862739168e-01   +3.886907217184772e-01   +4.202556790492816e-01   +6.878458752805997e-01   +2.809621143916259e-01   +4.133280770243175e-01   +1.196894315064804e-01; +9.935107352710933e-01   +1.209986274948674e-02   +3.789210361764340e-01   +4.761375742630524e-01   +9.081994458647941e-01   +3.229854279352797e-01   +7.086013190022453e-01   +5.857699577506275e-01   +9.124072097024453e-01   +9.446043777993974e-01   +8.699305353477890e-01   +3.882862646164912e-01   +7.484551906068952e-01   +1.523515426131824e-01   +9.672207291957589e-01   +9.906003781429767e-01];
L2I_L1I_iGABA_netcon = [+5.741247539915842e-01   +5.648743286261100e-01   +1.050710591626439e-01   +4.536401861286325e-01   +7.963619657813892e-01   +9.787036398937415e-01   +2.211435981093047e-01   +7.602999935722852e-01; +5.654061129863948e-01   +9.532930377824060e-01   +1.259530946761045e-01   +5.681115341078401e-01   +5.462934876007366e-01   +4.261227088466363e-01   +6.500410392951819e-02   +4.972072693651233e-01; +6.094286985061469e-01   +1.183791537974886e-02   +4.328375128095556e-01   +8.163520066497661e-01   +2.606628600487793e-01   +3.941854940830151e-01   +8.273169398878014e-01   +8.270831309232722e-01; +4.668815347514109e-01   +1.268105404624148e-01   +9.300761041413254e-01   +3.602854992006236e-01   +7.777378850757183e-01   +4.595391077849624e-01   +4.230097429263584e-02   +9.177191217036590e-01; +4.376986009046329e-01   +8.550480596411050e-01   +1.361152889687581e-01   +2.432989687861563e-01   +7.762937755093935e-01   +1.275568876140096e-01   +9.116023167653367e-01   +7.108736206398569e-01; +6.670456412113382e-02   +2.191291405814006e-01   +8.234167131068149e-01   +7.621053858801922e-01   +1.449501700041217e-01   +4.597219696421786e-01   +4.544051020562163e-01   +8.009839635728513e-01; +6.389863724579481e-01   +7.043708692837856e-01   +9.298321927591873e-01   +2.431218838286129e-03   +8.260254091749123e-01   +2.670437420859558e-01   +2.797889706837797e-01   +9.568444878498410e-01; +4.258699665853744e-01   +7.749218018246927e-01   +5.719244087607955e-01   +2.760548251777686e-01   +6.227162969538917e-01   +1.024376035844370e-01   +7.567012332679953e-01   +9.528526592120803e-01; +7.509802717232672e-01   +4.231680348062820e-01   +4.999693205156850e-01   +3.119656459158111e-02   +4.592111266041171e-01   +6.600799990690844e-01   +9.266572376788674e-01   +2.965649369423848e-01; +3.088757379433609e-01   +7.290727986036863e-01   +9.312143164820414e-01   +6.716611776392862e-01   +4.837432062657566e-01   +9.427285615700494e-01   +1.418412812218036e-01   +3.528617418685721e-01; +5.995483023962301e-01   +4.558950303400265e-01   +8.616828133944937e-01   +9.735463861096080e-01   +2.218996000545748e-01   +7.642127913590774e-01   +9.479740515808703e-01   +5.461667618314114e-01; +3.315870695672215e-01   +8.045428179408515e-01   +2.547774868869307e-01   +9.458322304547820e-01   +8.569208553276649e-01   +4.256298418986472e-02   +3.116350047090521e-01   +2.145390897520016e-01; +6.488242449078492e-01   +4.297935404529336e-01   +4.569117903494024e-01   +4.882422608160129e-02   +8.788228464411102e-01   +2.617424658120072e-01   +2.104159876846515e-01   +7.937555778870881e-02; +6.372103498541040e-03   +1.493005120569282e-01   +7.372698014624766e-01   +2.882888580620498e-01   +8.407302962528053e-01   +6.429710248065300e-01   +4.631875874608688e-01   +5.110837475386295e-01; +1.454686065379266e-01   +8.049832101921115e-01   +7.532016100787633e-01   +4.843287303183893e-01   +4.415791957680560e-01   +9.013123546667123e-02   +5.944464726392166e-01   +2.011473024724336e-01; +2.471717022680258e-01   +3.742006458103750e-01   +2.364314078517034e-01   +8.876220250471809e-01   +5.451102740928502e-01   +7.336969670714755e-02   +5.515829474434855e-01   +1.449178001356008e-01];
L1I_L2I_iGABA_netcon = [+7.084867019448917e-01   +8.684550865787086e-01   +6.151332571856010e-01   +4.844442433087332e-02   +1.447157843215454e-01   +2.341043882056195e-01   +8.408938939767698e-01   +3.690130287179784e-01   +7.098146828133400e-01   +3.879329453952180e-01   +2.443481179295736e-01   +6.714939196915243e-01   +1.620763962057038e-01   +5.727224205032176e-01   +4.273057400071636e-02   +4.521980715893546e-02; +6.045306232967221e-01   +8.031874486536874e-01   +6.154633917548050e-01   +5.533990507467521e-02   +7.475501711065318e-01   +5.525286206353087e-01   +1.990547980143562e-01   +5.595695752465847e-01   +1.888661251501076e-01   +7.248748796167439e-01   +5.099437438506057e-01   +3.361037556792272e-01   +1.084663465217254e-01   +8.120669330607290e-01   +4.352903174288942e-01   +9.233480368738430e-01; +1.628120470160694e-01   +6.219660689505053e-01   +3.081009702048343e-01   +5.989746697301420e-01   +9.541055437850209e-01   +1.126490339956799e-01   +6.178904050798304e-01   +8.325337828162648e-01   +2.299203136697092e-01   +6.333860279908038e-01   +7.349193788644496e-01   +5.501940057714529e-01   +7.430661536660864e-01   +6.762281567301764e-01   +9.260804119697716e-01   +1.769631906452633e-01; +4.814372941063378e-01   +4.749062425690395e-01   +1.324607578285416e-01   +6.587458763419390e-01   +2.654300144875026e-01   +8.230733168526392e-01   +1.599371057599012e-01   +7.155176540112780e-01   +1.000000000000000e+00   +1.015936134955347e-01   +7.805207264340644e-01   +5.373664485484330e-01   +2.156573862542483e-01   +4.430302275882610e-01   +8.834038326793335e-01   +7.423592245020683e-01; +2.908241755218393e-01   +2.093932351842885e-02   +6.045350065108533e-01   +4.864822526824158e-01   +9.176181270075418e-02   +6.565462205127390e-01   +5.851765953287335e-01   +1.151356433083513e-01   +9.011383174474209e-01   +4.940700876550220e-01   +6.828662926252013e-01   +9.051784592207445e-01   +4.882291498375468e-01   +8.901147540222019e-01   +9.571024926900350e-02   +4.729686340700129e-01; +4.029655471118552e-01   +1.197739407388922e-01   +8.932616792344920e-01   +9.802287498421139e-01   +2.326520306777031e-01   +2.347753464710694e-01   +5.445181154079866e-01   +7.388895102271322e-01   +1.404914473944495e-02   +5.558121126811638e-01   +8.159251785154091e-01   +2.817692775584306e-01   +5.007585658074868e-02   +7.871135291408524e-01   +6.818540903111396e-01   +2.504577698552276e-01; +4.896370935964511e-01   +7.213535390609538e-01   +5.640677277553562e-01   +8.677872167298036e-01   +8.913162892925798e-01   +3.031605409255023e-01   +6.859263098194026e-01   +9.232127526057492e-01   +8.334279362808534e-01   +5.210550946838891e-02   +4.207229013434180e-01   +1.406215605942471e-01   +5.781438662211020e-01   +5.885236832078612e-01   +9.595039866118061e-03   +6.655039653829699e-01; +8.611493643821194e-01   +6.707153864254539e-01   +6.341200849125044e-01   +9.574427773927848e-01   +1.970192668097912e-01   +3.277613093136375e-01   +7.007803469597124e-01   +9.194751703625114e-01   +2.527028481225514e-01   +8.109416062894530e-02   +4.962141172853244e-01   +9.568724571797949e-01   +4.959689472159767e-01   +6.202949985898579e-01   +1.231666248169810e-01   +6.100315561761758e-01];
L2E_L1E_iAMPA_netcon = [+3.726478806686736e-01   +5.619650437203313e-01   +2.042694057347668e-01   +5.164667208407935e-01   +2.938515806354475e-01   +6.789352592234582e-02   +2.806382564375451e-01   +2.658702250226876e-01; +4.340354484537928e-01   +1.850140101894054e-01   +1.358734208300620e-01   +6.851262243529530e-01   +6.211276763645279e-01   +5.895419764399783e-01   +9.305300478599025e-01   +9.011729734095874e-01; +7.162709235982109e-01   +6.086415793471968e-01   +8.297879754398282e-02   +2.052599415851698e-01   +8.676754108772861e-01   +7.602882103143088e-02   +7.614351279318302e-01   +1.528399970927682e-01; +1.930554538691941e-01   +7.366321968288220e-01   +9.279285643845306e-02   +9.741523202744417e-01   +8.161010719808791e-01   +4.003977636446823e-01   +2.614105631640914e-01   +5.532277333678161e-01; +4.262432181202832e-02   +8.361758680399078e-01   +5.520014870673868e-01   +3.507680154995310e-01   +2.112282264286207e-01   +5.693376109214320e-02   +2.434253575866199e-01   +4.249320419439492e-01; +3.155620500693116e-01   +2.728901923056367e-01   +7.334264831755954e-01   +1.814294555226061e-01   +7.495464747714392e-01   +1.272547813012359e-01   +1.624744063819599e-01   +5.480687194318775e-01; +7.915433989539363e-01   +6.086103038192660e-01   +5.476868786476714e-01   +2.420482429640663e-01   +1.969943551922884e-01   +2.421745104850100e-01   +2.879424522715998e-01   +7.484652483035515e-01; +4.263505380346199e-02   +5.476433072064592e-01   +4.908363666210901e-02   +2.575419385626610e-01   +5.783570699659116e-01   +9.423339818896211e-01   +5.641992157930902e-01   +1.094011899549469e-02; +2.130963439916644e-01   +2.785111677030878e-01   +6.352263022737377e-01   +2.209655971498736e-01   +8.782513980431318e-01   +2.049017344182452e-01   +3.981849618324129e-01   -5.480941670482203e-04; +2.692744844813820e-01   +3.369558431713153e-01   +9.921990925353215e-01   +3.620046834471212e-02   +7.167795714865922e-01   +3.302417130302955e-01   +9.878610754597437e-01   +2.040508457765521e-02; +7.918534656821117e-01   +5.683834295664201e-01   +9.098692401313292e-01   +3.544525812613499e-01   +6.990927736882451e-01   +8.657740968184447e-01   +5.461644435084467e-01   +3.517043984375405e-01; +9.855707607642172e-01   +7.408877804647481e-01   +7.753071073388279e-01   +8.973968101147241e-01   +4.611612315402028e-01   +9.211186725978966e-01   +9.315676488714669e-01   +4.291370538498882e-01; +9.805860381222466e-02   +7.654270269479647e-01   +1.937043232706863e-01   +1.382545784318761e-01   +5.024116303710138e-01   +1.901857273015016e-02   +9.891710372584513e-01   +5.458269869591684e-01; +1.971093042943982e-01   +4.049140071158103e-01   +3.187818702597469e-02   +9.543104465791862e-01   +8.024405153911076e-01   +3.585469001560802e-01   +8.342629000955433e-01   +4.846219308890240e-01; +1.181285988718227e-01   +1.538255542019148e-01   +3.789630054835213e-01   +9.051784159442847e-01   +9.345275369499578e-01   +5.300997073256347e-01   +1.785447845105404e-01   +9.168851458879842e-01; +6.382926658852993e-01   +2.027072989536469e-01   +5.779547034527193e-01   +4.090342892389043e-01   +7.899746263650130e-01   +4.051640216460355e-01   +3.086742469214423e-01   +4.165216244803498e-01];
L1E_L2E_iAMPA_netcon = [+4.979280422225177e-01   +4.511752065825704e-01   +6.126047800812575e-01   +4.927592572104056e-01   +2.321505492079238e-01   +7.150026899738248e-01   +6.879580304089025e-01   +6.350331830101400e-01   +5.209982188207171e-01   +2.398714988977600e-01   +8.719126394385888e-01   +1.769106486849924e-01   +1.375497114778617e-01   +2.500577561249249e-01   +1.841561287055158e-01   +2.789917435378406e-02; +8.345319127205698e-01   +3.643440388258714e-01   +1.058573425595510e-01   +6.633301445374518e-01   +8.368710432891349e-01   +3.814220250293478e-01   +9.744608295249911e-01   +6.203509578207471e-01   +6.714712015244576e-01   +7.250852862531815e-01   +6.610307088236091e-01   +2.991182866290206e-01   +2.844893295884828e-01   +7.498179842921096e-01   +1.518004577589235e-01   +2.472802109161803e-01; +1.847195205117901e-01   +2.987300223683534e-01   +7.561051718764534e-01   +1.783694561570680e-01   +7.374987633526560e-01   +3.798189859807742e-01   +7.558986809373969e-01   +4.089095667719918e-01   +7.712328873425992e-01   +1.292177704960183e-01   +5.426393761824729e-01   +1.061005303502867e-01   +6.642049058275297e-03   +9.329640338203715e-01   +1.352650482581466e-01   +9.866877284053340e-01; +3.405856902204428e-01   +2.378641859112995e-01   +5.398994092202044e-01   +4.759563096374845e-01   +4.901308780184034e-01   +7.159230961495298e-01   +5.569655132155437e-01   +4.275511387014934e-01   +4.629729457891336e-01   +4.334969164697598e-02   +2.499587190144795e-01   +4.512470690265142e-01   +3.107329185241833e-01   +2.886658182009132e-02   +1.630147202012467e-01   +6.310705051858578e-01; +6.944232035265937e-01   +1.371249864903099e-01   +4.464998868798391e-01   +5.031501734970258e-01   +8.499278566682413e-01   +8.329852891034274e-01   +2.864731861691832e-02   +5.100099023589879e-01   +9.065248602250846e-01   +6.527741279467251e-01   +1.100749555414382e-01   +5.877713257590838e-01   +9.067561894221604e-01   +4.334353997703987e-01   +9.210406891267469e-01   +3.596603388820980e-01; +6.951298324336788e-01   +1.018138454926198e-01   +7.422028562877309e-01   +6.045384165796185e-01   +7.211582836731469e-01   +6.675173739640996e-01   +1.912999439192477e-01   +2.629647403358946e-01   +2.363595978302280e-02   +1.983408197291719e-01   +9.723004384882635e-01   +2.218446545529178e-01   +2.927916213901170e-01   +8.277625641817902e-01   +2.622490362297968e-01   +9.630741756760033e-02; +3.690348265897518e-01   +2.309348349825514e-01   +3.868880175963576e-01   +2.467210118707066e-01   +5.220778694153497e-01   +6.501725009246143e-01   +9.371302961714532e-01   +4.221722169010469e-01   +4.828734459769853e-01   +9.737084818826802e-01   +5.894409604360428e-01   +1.085226896126487e-01   +8.237469912045030e-01   +9.977446562068035e-01   +2.068793078551739e-01   +4.129093014519983e-01; +3.097191977110093e-02   +3.458444237110926e-01   +5.352577691068439e-01   +5.189386864444199e-01   +9.364112968415714e-01   +5.592762713266016e-01   +3.944546730070437e-01   +5.227983310678104e-01   +2.747123620680015e-01   +8.203084352832530e-01   +8.193894208351244e-01   +5.603018339660177e-01   +7.406569821706389e-01   +9.221696566091427e-01   +6.190282277254225e-01   +9.301528039631994e-01];
L2I_L2E_iAMPA_netcon = [+6.729497426990899e-01   +6.096896534138296e-01   +4.104706258386442e-02   +7.981994035671400e-01   +5.194812347012250e-01   +8.235868953878769e-01   +6.480821652984703e-01   +3.895121011077705e-01; +2.487275798901520e-02   +9.448433560241739e-01   +5.421067253454820e-02   +9.349684348415370e-01   +6.555723404657417e-02   +1.105559101803360e-01   +3.573834935844232e-02   +1.719066817746044e-01; +7.378914285416780e-01   +9.625276066984119e-01   +4.059243497845817e-01   +9.402075975642501e-01   +2.887105685625598e-01   +2.373437131752412e-02   +5.641904835094693e-01   +4.444780440140625e-01; +2.172548817433495e-01   +3.681542697272969e-01   +9.819038691313560e-01   +1.400691391525595e-01   +7.135018429488574e-01   +5.897748745989329e-03   +3.056936449398022e-01   +8.770408537868877e-01; +8.572677718473807e-01   +8.014348855125804e-01   +7.120750318293941e-01   +3.237781468295245e-01   +8.857364839772440e-01   +3.343376183297270e-01   +2.609887280066654e-01   +4.052707060045799e-01; +1.595087340039819e-01   +7.249691868671675e-01   +9.867129957105245e-01   +4.293336323216268e-01   +3.638143094900948e-01   +6.651470343424181e-01   +7.203170265209455e-01   +1.634392909313117e-01; +6.739319843160010e-01   +9.527726611787982e-01   +6.463533660928721e-01   +7.049617304039003e-01   +5.672327590786056e-01   +5.930087578771239e-01   +3.107972926438805e-01   +6.639661879558958e-01; +9.366531906115607e-01   +1.397556415129353e-02   +5.047621910756203e-01   +6.177710814871797e-01   +8.784680221000312e-01   +7.606683927236577e-02   +8.999211388289652e-01   +9.314043187625665e-01];
L2E_L2I_iGABA_netcon = [+6.221280567468984e-02   +5.224178843572087e-01   +3.511920049314167e-01   +2.577111226921243e-01   +4.423629884079690e-02   +8.985316253905524e-01   +3.434754594591195e-01   +4.500794713285762e-01; +3.564621723668337e-01   +6.808803714540053e-02   +5.596779517091022e-01   +9.812076676922963e-01   +3.621443287684318e-01   +5.475399903227579e-01   +9.328364956374370e-01   +6.741243517236941e-01; +9.329882084642463e-01   +1.826969080608795e-01   +6.928329777640563e-01   +3.494798533534517e-01   +3.706657887002442e-02   +7.131116667664870e-01   +9.141974241351526e-01   +7.710984879790457e-01; +2.397943488243229e-01   +3.143289323132205e-01   +4.122042376547651e-03   +3.951329369278340e-01   +4.883228027304327e-01   +7.146912167605151e-01   +7.256587423430186e-01   +9.218322888102581e-01; +1.063282116132216e-01   +2.457230592616590e-01   +4.709230018909691e-02   +7.501627809422519e-01   +7.252553150646844e-01   +1.709059172478943e-01   +4.437064734563074e-01   +6.536665186413743e-01; +7.111559934235925e-01   +3.235714191887581e-01   +3.016789199834640e-01   +1.083085407843847e-01   +1.461531570828655e-02   +3.537729913374581e-01   +1.492349252900746e-01   +5.048732823416969e-01; +5.977250096264998e-03   +8.734677374156400e-01   +8.729953413205043e-01   +5.924432713266363e-01   +5.123569733514504e-01   +3.795680383589917e-01   +8.302838337138821e-01   +3.449181907292275e-01; +1.764220181308856e-01   +3.075527709248613e-01   +6.247007840759220e-01   +1.221015757660178e-01   +2.411562193440416e-01   +7.594363552266309e-01   +2.516860736094891e-01   +9.461011232389571e-01];
L3E_L2E_iAMPA_netcon = [+7.918321311844630e-02   +1.614231644843226e-02   +3.697911404826220e-01   +4.941780868682123e-01   +2.256343105634122e-02   +9.609114273971806e-01   +3.576163009622779e-01   +2.136479667945197e-02   +2.053849232511084e-01   +6.918479171952216e-02   +2.449094642839142e-01   +1.000000000000000e+00; +9.517092026175666e-01   +9.800353291036624e-01   +1.160202497182643e-01   +6.465031559497454e-02   +8.074251157911430e-01   +3.906021510306212e-01   +2.286287070924577e-01   +1.263296571856791e-01   +3.539476946397484e-01   +7.428800892678957e-01   +5.372268664561713e-01   +3.408908360680693e-01; +6.652594748628606e-01   +7.202129321601667e-01   +5.105477963416584e-01   +8.696717589318261e-01   +7.974652049467051e-01   +6.645793883829628e-01   +7.250571249704193e-01   +6.637046203146493e-01   +8.896318124890048e-01   +9.914783549809102e-01   +3.337180508439984e-01   +8.266008270090598e-01; +1.693181759542364e-01   +8.742589312270371e-01   +8.214821769985056e-03   +9.991845446311041e-01   +4.198119729344302e-01   +5.849817980116537e-01   +7.724938609160446e-01   +5.093011182991924e-01   +8.184317064255869e-01   +7.667088491665884e-01   +6.687285679730138e-01   +1.108915879214834e-01; +1.980132583596357e-01   +8.173281163147488e-01   +8.719848610042891e-01   +1.188007278655241e-01   +6.310692497673449e-01   +5.362763446298725e-02   +3.404112485805919e-01   +7.879630712744913e-02   +3.177417315212059e-01   +8.872905161073364e-01   +8.785423661219994e-01   +7.794582328736178e-01; +9.899338736524836e-01   +3.332789057249862e-02   +9.093306422129491e-01   +1.061572125528815e-01   +5.665657045424338e-01   +7.235429486190909e-02   +5.705729422148960e-01   +5.381533336049811e-01   +5.977469434396597e-01   +4.330720365265783e-02   +9.824850521053375e-01   +1.521198151135922e-01; +9.288971765962897e-01   +9.428434650504403e-02   +1.111057797542663e-01   +1.495657111539642e-01   +9.016744293436860e-01   +2.302911369911560e-01   +6.374392472117396e-01   +6.827341250881168e-01   +6.993259325424768e-01   +7.962886087761759e-01   +1.401179774973995e-01   +7.320433891509622e-01; +9.780744747577245e-01   +9.154885483001998e-02   +4.582740349237734e-02   +1.279535088602948e-01   +7.499701234230939e-01   +4.135695951594141e-01   +3.711052549330101e-01   +5.910595384319858e-01   +1.802832744790525e-01   +7.103707961167476e-01   +8.804032105298580e-01   +1.162130764285143e-01];
L3I_L2I_iGABA_netcon = [+7.691390805154151e-01   +5.384606412549264e-01   +5.987909574115089e-01   +3.038901655545315e-01   +9.650983511652017e-01   +1.164401302777881e-01   +2.951468085412562e-01   +7.970684913064809e-01   +9.219687761308566e-01   +9.943625128939977e-01   +3.102673776206677e-01   +9.917764623460215e-01; +6.365083638998112e-01   +4.486878123842353e-01   +5.620171658138993e-01   +7.577861077042330e-01   +5.487733508369357e-01   +6.238585866693094e-02   +1.657760533429764e-01   +5.173038471480648e-02   +3.871217936416481e-01   +2.923683410072627e-01   +4.472000259646161e-01   +9.168001645147603e-01; +7.978886256638466e-01   +1.161892751434325e-01   +7.561454855647333e-02   +6.520436574519185e-01   +9.793993493266971e-01   +4.462363408567438e-02   +7.230447871533788e-01   +1.787871859356370e-01   +7.485703204233696e-01   +5.215721360763047e-01   +2.031996694899046e-01   +6.884138056266149e-01; +9.637355822186512e-01   +7.191432524449247e-01   +7.690462461054463e-01   +3.344314531895600e-01   +1.261554421451735e-01   +1.321987596729354e-01   +3.003527765621332e-01   +2.459134989225431e-01   +8.754082477587605e-01   +3.582157982496874e-01   +9.427129136430407e-01   +2.161144421602547e-01; +7.112299356178605e-01   +1.830720127745165e-01   +8.631264121089453e-01   +9.759086360533321e-01   +1.630891917356732e-01   +4.905379336867541e-01   +6.771960340410494e-01   +2.575093495189378e-01   +3.964857980074218e-01   +5.212757875802627e-01   +2.894878997131880e-01   +3.149325937482896e-01; +6.426819277707934e-01   +3.229259102817781e-01   +7.026392423165253e-01   +5.313639433018005e-01   +3.346273454166845e-01   +4.702500756733314e-01   +7.488627766098978e-01   +6.511098472492671e-01   +1.708131744514013e-01   +4.947315486965239e-01   +1.161996801458273e-01   +2.277711260798409e-01; +5.151879670329771e-01   +9.648548637892331e-01   +1.094037665826526e-01   +7.523889010093279e-01   +5.334942273242500e-01   +1.573381014235410e-01   +7.468052940217841e-01   +9.859457754971941e-02   +4.389186479510129e-01   +1.817148122881835e-01   +6.794836194161966e-02   +7.075965871665749e-01; +9.508983876870621e-01   +6.976678676670360e-01   +6.588070267865845e-01   +2.639411830119587e-01   +6.908455253718473e-01   +1.389047606047966e-01   +7.805820100006546e-01   +4.694391166741242e-01   +8.520888562760751e-01   +4.815415855905744e-01   +7.292561822795730e-01   +3.706790187008075e-01];
L2E_L3E_iAMPA_netcon = [+6.579654940731199e-01   +3.852005365730560e-01   +2.330601217908479e-01   +4.646851431748843e-01   +9.048876520533491e-01   +9.531681858595231e-01   +7.683282700503109e-01   +3.571120822446852e-01; +3.812612810047664e-01   +2.181532844429693e-02   +9.119805543274392e-01   +2.882338728838308e-01   +6.834179584006060e-01   +1.973674347938356e-02   +8.969181826578100e-01   +6.611350929446267e-01; +3.039601428835250e-01   +3.308432260053478e-01   +4.852373110758695e-01   +2.747463307254532e-01   +8.447075378189617e-01   +4.989143234597313e-01   +7.926108353540019e-01   +5.918350415316492e-01; +1.567292618792991e-01   +4.895267931969847e-01   +5.900689804465368e-01   +1.445441348964642e-01   +9.613542916985929e-02   +3.347631025427877e-01   +9.494901924824776e-01   +5.282184436352957e-02; +7.738093289743722e-01   +2.623921640042653e-01   +9.537847167078880e-01   +1.464074099896270e-01   +7.377809672328673e-01   +6.688676553988258e-01   +5.371416525619291e-01   +2.104829938251583e-01; +7.110711766721759e-01   +5.280360783518736e-01   +8.027559591634764e-02   +2.665961676618642e-01   +5.469776127826758e-01   +1.655212266784414e-01   +1.625105659866651e-01   +6.025259377780483e-01; +1.719416935461097e-01   +4.148574235388321e-01   +2.219456165422730e-01   +6.064650298739855e-01   +2.550140014215860e-01   +2.248063213759776e-01   +1.360489854797989e-01   +2.692905919940016e-01; +4.515772658004786e-01   -6.642632735150166e-05   +1.596907755031646e-01   +1.032979750412395e-01   +7.158656242249271e-01   +1.145894467718157e-01   +2.713186376803929e-02   +1.126467621271560e-01; +8.388058103822817e-01   +8.925382251050773e-01   +3.930700481096062e-01   +4.878442842276966e-01   +3.608761118296823e-01   +9.884213271697737e-01   +6.850745196013261e-01   +2.176326343821099e-01; +7.031443845041359e-01   +2.400828425369503e-01   +1.844599931321580e-01   +8.979911952010361e-01   +8.455838852928993e-01   +1.399989815211397e-01   +5.857458225614254e-01   +8.781701223990811e-01; +7.652459235555692e-01   +7.993747462468703e-01   +7.616367166251820e-01   +1.894961952265824e-01   +8.195816961231090e-01   +7.669244380693344e-01   +2.943599737979145e-01   +4.616646176044319e-01; +9.790798628950936e-01   +5.814991511161686e-01   +2.300851247349201e-01   +5.425707101081194e-02   +6.158365463659519e-01   +6.279159974280406e-01   +7.459707806536930e-02   +7.313783933842330e-01];
L2I_L3I_iGABA_netcon = [+5.903846233494146e-01   +1.434174338560506e-01   +3.474299926814517e-01   +3.726786754015745e-01   +5.968954076891153e-01   +5.112717911365023e-01   +7.726256894835967e-01   +2.672666009693631e-01; +8.406168369402872e-01   +9.928720654688400e-01   +4.492509033706271e-02   +5.343051922260154e-01   +4.755918128966318e-01   +2.412635065010178e-01   +1.793993462606908e-01   +5.933339185199507e-01; +6.090382797319818e-01   +4.832316589382131e-01   +9.486655087695046e-01   +9.731975516234630e-01   +3.808943929441069e-01   +2.726357139680811e-01   +4.512228281105032e-01   +6.826988464236493e-01; +7.452754040627753e-01   +4.065476398833914e-02   +8.608434870258541e-01   +9.970201041522965e-01   +9.805189002978834e-01   +4.105475563709357e-01   +3.033656152251483e-01   +4.164593234438057e-01; +8.500001352528301e-01   +2.685400834251414e-01   +1.369983194496720e-01   +4.123484366695290e-01   +1.405739370811503e-01   +2.624518442864850e-01   +3.860172837392364e-01   +5.124665160772197e-01; +1.458341546167320e-01   +6.690753325651518e-01   +5.883790063275754e-01   +4.451410605895991e-01   +2.731680767282007e-01   +8.533369711496422e-01   +7.968812035869756e-01   +8.155320251439101e-01; +7.384238928165783e-01   +1.459190057576235e-01   +6.511229791709366e-02   +2.452116615136615e-01   +2.257695307776435e-01   +4.808962119147948e-01   +7.795938936347194e-01   +5.401218366628838e-01; +1.919673969843177e-02   +7.738472367122252e-01   +9.513598684518673e-01   +5.981899382033464e-01   +7.943040914646565e-01   +3.391027988211311e-01   +6.485665260956687e-01   +5.900597660457636e-01; +2.290813639961642e-01   +2.648504431565064e-01   +4.978244551212248e-01   +7.664965081325976e-02   +8.219977136813198e-01   +6.361963553077304e-01   +2.430121653637440e-01   +5.389727106594607e-01; +5.360792157128469e-01   +8.829898850238628e-01   +2.766527881814718e-02   +9.078544917175108e-01   +7.987503373961466e-01   +4.144086111966013e-01   +6.047221660936868e-01   +5.410523492383685e-01; +7.154390208302503e-01   +3.637474435483571e-01   +5.201384523982745e-02   +4.781993012653105e-01   +1.148386592578310e-01   +5.463474660698620e-01   +4.194794142996732e-01   +1.554395798418219e-01; +4.340987173807447e-01   +1.450903449068490e-02   +3.015356660900938e-01   +5.058442686041417e-01   +6.379610031930968e-01   +3.394720415753175e-01   +2.979724922680743e-01   +6.969779954944429e-01];
L3I_L3E_iAMPA_netcon = [+6.083730300689244e-02   +7.759404492980313e-01   +5.526264258340399e-01   +5.717755151272510e-01   +9.139819839533274e-01   +8.303847078531487e-01   +8.462488983969715e-01   +8.607873615020013e-01   +5.273133046937681e-01   +9.928856102027508e-01   +4.828181187985314e-01   +3.488262076988005e-01; +9.249195552723478e-01   +8.357996740355504e-01   +8.472646636857001e-01   +9.348182389472851e-01   +5.918260210407252e-01   +4.010414275497725e-01   +6.300741966855842e-01   +8.546288397983358e-01   +5.646973253508522e-01   +7.020198003931313e-01   +7.415111275815097e-01   +3.946137597065844e-01; +1.843499602378028e-01   +5.924301063435161e-01   +9.695061880171837e-01   +7.814981358403154e-01   +5.748301679344328e-01   +6.960713300622252e-02   +4.421258937334485e-01   +9.500297195914863e-01   +9.833865905104048e-01   +8.420011629494417e-01   +5.930586295568715e-01   +9.880870088707612e-01; +5.416071226701236e-01   +7.621911563864026e-01   +4.639977336892425e-01   +5.961453033191950e-01   +6.529480369805662e-01   +3.773097882333395e-01   +2.310249556315044e-01   +6.986109912038361e-01   +9.626347625940579e-01   +7.335474566605289e-01   +2.545009188533280e-01   +2.925448759370217e-01; +3.997048418456489e-01   +6.645084140065299e-01   +7.693195735770193e-01   +6.368844758030488e-02   +4.275996382829509e-01   +8.573043778176930e-01   +5.188106391389939e-02   +3.576310464589361e-01   +5.574988724803146e-01   +9.960752450145153e-01   +6.112134871870303e-01   +2.298327236142026e-01; +8.996106098610453e-03   +5.860335960046397e-01   +2.536456250550661e-02   +5.396189120039779e-01   +9.399713297504388e-01   +2.564941337602858e-02   +7.031700075016953e-01   +3.759011460326931e-01   +5.241878162419170e-01   +5.073094709841343e-01   +2.317837481331558e-01   +3.259644776075041e-01; +1.064569209168131e-01   +2.473482312572741e-02   +6.744139682489303e-01   +8.600888462962437e-01   +1.008567912299843e-01   +4.217143258312074e-01   +8.490787722767490e-01   +8.477566098992495e-01   +4.722866467421248e-01   +1.920806599525731e-01   +1.963792793717143e-01   +1.670344588044474e-01; +8.515969995909988e-01   +6.844519931826113e-01   +8.425947987970593e-01   +3.387540143911594e-01   +4.079114515701481e-01   +2.521969061275816e-01   +4.064526979913663e-01   +3.858196619289003e-01   +9.006011059304083e-01   +9.530476142830285e-01   +9.013763149578176e-04   +3.785287077010703e-01; +3.338528963542197e-01   +3.251334501836345e-01   +6.914558901606479e-01   +1.786714138334376e-01   +8.922729632548003e-01   +7.049687431903034e-02   +2.902565599445511e-01   +7.736345042615970e-01   +4.799982328759087e-01   +4.526733129570896e-01   +6.515580048450998e-01   +5.294188826506224e-01; +1.463929631122776e-01   +8.085907222397487e-02   +8.993877954150485e-01   +8.773719967210633e-01   +7.357202171916672e-01   +9.143044301265810e-01   +2.584244070890540e-01   +7.779933489812337e-01   +4.887739217786929e-01   +6.050524911273111e-01   +3.997090264503249e-01   +5.950163374856319e-01; +8.009838063658126e-01   +7.441021614920701e-01   +9.592702571863539e-02   +8.429266089233219e-01   +9.581561095883001e-01   +2.657106559769449e-01   +5.110313824807363e-01   +4.302079256948524e-01   +3.126514634289703e-01   +6.442343068770015e-01   +2.713972006058701e-01   +1.706455738339255e-01; +6.517847275235117e-01   +9.664704347981796e-01   +7.895445837120424e-02   +8.283768340545038e-01   +9.755185907628140e-01   +1.075048897868501e-01   +1.174262786425271e-01   +4.846421993988649e-01   +8.512807955468135e-01   +7.615165408575362e-01   +2.628580081145207e-03   +6.784201407846080e-02];
L3E_L3I_iGABA_netcon = [+4.435988749071327e-01   +6.602416787485671e-02   +6.505672274236145e-03   +4.933729998458091e-01   +5.441630368143687e-01   +2.524149558705807e-01   +7.191008382225683e-01   +7.603622206952264e-01   +3.776416990367416e-01   +4.485731308851178e-01   +2.002028883211420e-01   +6.543196748289699e-01; +5.893714439737602e-02   +8.065340961092369e-01   +1.315352778614207e-01   +1.904770560740887e-01   +2.186722956889590e-01   +3.340553510651831e-01   +2.254683763127637e-01   +8.910722750251188e-01   +6.091365256349677e-01   +3.948077465827035e-01   +8.269947052368509e-01   +9.069101643000058e-01; +6.256238545178493e-01   +9.124132668577738e-01   +3.102809253090789e-01   +6.453566881320554e-01   +2.674647917209663e-01   +6.011528205999107e-01   +4.988626097622212e-01   +7.342042991233194e-01   +1.668861562297603e-01   +6.743881189866205e-01   +4.401289867369600e-01   +8.364187026941124e-01; +8.054709309013148e-01   +4.260044495534662e-01   +2.365717499021374e-01   +2.572063735167443e-01   +1.347846047928250e-01   +4.821130557093889e-01   +4.759482040143692e-01   +6.926149504038385e-01   +1.014342930922565e-01   +3.423106069101016e-02   +4.209006510158538e-02   +1.704058279097096e-01; +4.048460102760073e-01   +1.921341950431772e-01   +6.511282198954574e-01   +9.420788664477815e-01   +1.681286537503994e-02   +8.981394379807746e-01   +4.306004787742839e-01   +6.423531921934534e-01   +6.196961758617822e-01   +7.830924907701770e-01   +7.660478034079347e-01   +1.624407757019331e-01; +8.840671549273624e-01   +1.853123198573904e-01   +8.097016891582203e-01   +2.929526042570013e-01   +1.134035216007013e-02   +2.896808689470806e-01   +5.549407061570910e-01   +6.158998291130976e-01   +9.613778079308613e-01   +3.723359531654943e-01   +9.331840554612977e-02   +1.360580444322188e-01; +7.193977910955524e-01   +6.721682756376134e-01   +7.394583267368973e-01   +1.419695424221658e-01   +9.835113650753499e-01   +7.477850498662870e-02   +2.074365490046297e-01   +7.556975762718222e-02   +6.694112333682553e-01   +6.398257391011198e-01   +6.565566238657506e-01   +1.573841881761311e-01; +1.992357572703693e-01   +5.270586255599363e-01   +1.219691188273349e-01   +8.649995594745010e-01   +6.478435797741584e-01   +3.882269438612611e-01   +2.768948735765090e-01   +5.494299683631965e-01   +4.711304762932008e-01   +4.972877844659643e-01   +2.664133350471086e-01   +3.984434016472859e-01; +3.731625035446859e-01   +7.750198426791463e-01   +1.743342610034546e-01   +8.828588907874437e-01   +8.142703811477189e-01   +1.908413186819773e-01   +8.087041377424540e-01   +8.778655237321324e-01   +3.367586881462631e-01   +2.194013208232848e-01   +4.360109623035089e-01   +6.620338546951354e-01; +2.061788325098676e-01   +3.035084035121339e-01   +2.687370391566145e-01   +6.622006533898650e-01   +2.800042253820320e-01   +7.284708587520545e-01   +9.851019957969688e-02   +9.873418092828673e-01   +5.882501662644294e-01   +2.133393477128945e-01   +8.508415186878273e-01   +2.233888773852492e-01; +2.631351793968484e-01   +4.748591547308837e-01   +8.139276527475499e-01   +9.980900042291273e-01   +1.405301463680346e-02   +4.230653116741562e-01   +3.590854561100817e-02   +7.138391348311464e-02   +5.426698820293072e-01   +4.530568058493194e-01   +9.065006060864123e-01   +6.429598542724456e-01; +9.906126664171877e-01   +7.113579234800105e-01   +5.937801994439449e-01   +2.657231646206270e-01   +1.010675813595822e-01   +2.701901956540639e-01   +7.105969563296560e-02   +2.794807356683997e-02   +3.977991409092822e-02   +6.319231816749898e-01   +2.848929288139655e-01   +6.114200461205905e-01];
L2E_Input1_iAMPA_netcon = [+9.996959466417348e-01   +9.913986096973090e-01   +9.962153480046011e-01   +9.923618332597353e-01   +9.899351626088406e-01   +9.988048060092801e-01   +9.869337937278306e-01   +9.993184347982855e-01];
L2I_Input2_iAMPA_netcon = [+9.965300807122337e-01   +9.990490292835009e-01   +9.901866722191869e-01   +9.890185326301083e-01   +9.894023869200669e-01   +9.904963687323598e-01   +9.919568732021985e-01   +9.952593481951725e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last =  11.21 * ones(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))*0.4 + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.5*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.5*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))*0.9 + 0.5*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))*0.4 + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.5*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.5*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))*0.9 + 0.5*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
