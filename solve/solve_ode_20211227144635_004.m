function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+4.988535996304866e-02   -2.252544489101987e-03   -4.826164745913280e-03   +1.122922752546766e-03   -4.457536070424316e-02   -1.858657416037178e-02   -2.422377417297820e-02   -3.923406488429910e-02   +2.418563042100419e-02   -4.254380241878065e-02   +6.540955384620126e-02   +3.820315546001953e-02   +1.968771223214229e-02   -5.921884948193510e-02   -3.330046772621351e-02   -2.249650917579719e-02; -9.823640006727846e-03   +6.353162211838726e-03   +4.197284775557138e-02   +4.918451847349913e-02   +4.628397004916181e-02   +5.545446132980950e-02   +4.820878966606947e-03   +9.428724289657384e-03   +9.938354054787114e-03   -2.002475243337256e-02   +2.118157515754637e-02   +7.524069679192431e-02   -2.849416344773127e-03   -4.130811885179678e-03   +3.465207041601299e-02   -4.082042829257647e-03; +2.923443306950237e-02   -2.301243283734832e-02   -1.719741625713516e-02   +3.210136970738930e-02   +3.353795073985927e-02   +1.265765037910255e-02   -2.579992026985537e-02   -5.563931565866336e-02   -6.574023287982492e-02   +5.263224526978119e-02   +4.874164394444883e-02   -5.119842343017822e-02   +4.007410037223131e-02   -1.467621026704741e-02   +4.316247920143911e-02   +3.252756840668677e-02; +4.183424398703225e-02   -2.296567893708728e-03   -1.307853559937026e-02   +5.103445561894582e-02   +8.041674608662619e-03   -3.946273684608712e-02   -2.552321248832470e-02   +6.256487577800139e-03   +1.411275623931637e-02   -7.250728533845407e-02   +1.850848491115655e-02   +1.790277478513287e-02   +2.630784098093274e-03   +3.432369167960969e-02   -1.757571886779078e-02   +6.859911989795543e-02; +2.455122880200729e-03   +6.414699693465854e-03   -2.366016821934267e-02   -2.219986063105299e-02   -5.881316608917725e-02   +3.125988586635890e-02   +2.755430813238959e-02   +8.400021551719189e-02   +3.360306213212976e-02   +4.985561242943327e-02   -2.615550053789678e-02   -4.749253259117923e-02   +9.106757483699746e-04   -1.970017115547934e-04   -3.324844063802380e-02   -2.677545950562991e-02; -5.090123024343630e-02   -2.867060687097914e-03   +9.348197953344603e-02   -5.165505626481482e-02   +4.642515842493966e-02   +4.143419538913316e-02   +6.336038016505832e-02   -4.789748355023726e-02   -3.185194603088123e-02   -2.107961715100679e-02   +1.108745642734794e-03   -2.081426056787249e-02   +6.236691093038350e-02   +2.004363034314434e-02   -5.406669559496415e-02   -2.478200143529104e-02; -5.874275703333758e-03   +5.024963050085562e-02   -2.144618050930994e-02   -5.917364986187418e-02   -1.411612300655396e-03   -2.103780396041880e-02   -2.486754091725545e-03   -3.270141321212033e-02   -7.514235101347043e-03   -5.788443111997360e-02   -1.965418906180398e-02   +1.390901015537984e-02   +1.177244025709921e-02   -2.734708290271642e-05   -6.750857558696231e-03   +5.915593294543098e-02; +5.751457593050650e-02   +5.566036774594187e-03   +3.211124899613289e-02   -7.305879374381888e-02   -3.463803124738406e-02   +2.776455012450278e-02   +5.316999306864387e-02   +4.509230773089579e-02   -9.380860136191979e-02   -5.409597610445245e-02   +9.056840107504309e-02   -3.444082331577445e-02   +6.696106385175997e-02   +3.277279174680197e-03   +5.913774325272464e-02   -1.159713806952776e-02; -9.187879377023728e-02   +1.793151102889070e-02   +1.321679801388451e-02   -2.642514456748141e-02   -4.642570036842057e-02   +5.967769668836508e-02   -3.161609662179934e-03   -2.587841184906889e-02   -1.013038521304805e-01   -3.298608773553478e-02   +2.285930477210529e-02   +1.239053822678027e-03   +4.831299706912800e-02   +4.100413813873509e-02   -2.380821831465751e-02   +2.807640575350172e-02; -1.166545057908285e-02   -4.452918232108864e-02   -1.270545663172379e-02   +2.160584441248287e-02   +7.377492356325446e-03   +6.692707627960445e-02   +5.363194001516818e-02   -6.366423732089338e-02   +5.468318779924065e-02   -3.768593334789631e-03   -3.129269344096362e-02   -1.587169421105630e-02   +3.867048225666268e-02   +6.660917774196885e-02   -6.138511099138192e-02   +1.829893705652251e-03; +2.878822778355283e-02   +1.940070769136164e-02   -1.612838499676806e-02   +1.519698728863455e-02   +1.149841234859011e-02   +8.290341219593468e-02   +8.909883774901550e-03   +2.635077005157992e-02   +1.984607126267470e-02   +1.641359458889360e-02   +3.503519859539170e-02   +7.456579412403685e-02   -2.263005486283324e-02   -2.919961287752468e-02   -3.696976507079480e-02   -1.519835139203493e-02; -6.534802103324330e-02   -6.505025731488219e-02   -3.861561777575733e-02   +2.430495177268171e-02   -2.757870538702810e-02   -2.844191350002154e-02   +1.631960870174755e-02   +1.867261048833716e-02   -2.264743147207990e-02   +1.856947725243301e-03   +5.351759275816695e-02   -3.160456199671965e-02   -3.838922925061479e-03   +2.990669912639228e-02   +5.746259158074703e-02   -4.170700621467508e-02; +4.474116078262960e-02   -5.606415281134185e-02   +8.472051045241458e-03   +1.259802937947870e-03   +3.005044720769851e-02   -2.812196790011546e-02   -3.695252211455288e-02   +5.453984335733739e-03   +1.118221965301397e-01   -6.097371157233719e-02   -5.623494491399153e-02   +1.944964963336555e-02   +4.207535083178059e-02   +6.515265409066201e-02   +3.136074926076862e-02   +1.814088053620299e-02; +2.134460948920433e-02   +3.666169463671762e-02   +2.451011308059829e-02   -6.683157553910510e-02   +1.973995241895798e-02   -5.447290358370410e-02   -4.008359882971112e-03   +1.087015508616238e-02   -8.165666631186223e-03   +2.409394809406782e-02   -3.843550232855671e-02   -4.612591851394463e-02   +1.552847371381730e-03   -6.841861255754526e-03   +4.916146654905289e-03   -3.819773233641079e-02; -3.602310707568864e-03   -2.266742703771935e-03   +2.536080456919419e-02   +2.109563503369945e-02   +3.383559646186662e-02   -2.582327840875047e-02   -1.842250237720085e-03   -1.715379628264603e-03   -2.894134229190365e-02   +2.465368309998291e-02   +4.971465071219789e-02   +4.050228272757913e-02   -2.980809973394982e-02   -1.260065820290214e-02   -5.293096029482537e-03   -1.103937301868057e-02; -6.572144056138482e-02   +3.652106361553965e-02   +3.710413981412214e-02   -2.825479035563673e-02   -6.189294154440081e-02   -3.317061817755435e-02   -5.574852031408822e-02   -5.969648173662694e-02   +5.815094962680652e-02   +2.875044765269707e-02   +1.265965740215782e-03   +1.099215483840164e-02   -3.257917557268494e-02   -4.353139542515990e-02   -2.810514184544305e-02   -8.951123354659423e-04];
L1E_L1I_iGABA_netcon = [-2.633195800667089e-02   +7.852568254099232e-03   -4.625404147463185e-02   +5.378129237489193e-02   +4.510553187691203e-03   +1.538823054094629e-02   -7.383025390232086e-02   +6.204751666751596e-02   +2.901675767063511e-02   -3.046394820879390e-02   +2.135707819911719e-02   -6.178373894308187e-04   -4.291489087117802e-02   +1.161959984328655e-02   -4.119811221594937e-02   -3.339453333326022e-02; +3.713424061413761e-02   +6.940221468365362e-03   +1.701465919198523e-02   +1.923383637549093e-02   +5.966057752420264e-02   -2.879722191773645e-02   -4.055067180018587e-02   -4.384801306766128e-02   +1.078027573357884e-02   +1.183404887869111e-02   +1.582739480810934e-02   +7.477224596685228e-02   +2.671970878241767e-02   +7.734212511760539e-03   -5.610411019090128e-03   -9.035305017588990e-03; +2.033487472370493e-02   -3.533433634134959e-02   -2.446643669954994e-02   +5.963880379616234e-03   +3.837057337769904e-02   +1.328801063065623e-02   -1.105036734055121e-01   -2.487340266808444e-02   -2.604834460574715e-02   -1.135524384559889e-01   +4.314626778505229e-02   -3.388334322284774e-02   +1.581324998025343e-02   -5.334582059080897e-02   +3.984713679426154e-02   +1.007712533262308e-02; -1.608742572124280e-02   +3.289292888537779e-02   -2.581336037325463e-02   -3.811923026531730e-02   +3.153683520049013e-02   +1.184369301452523e-02   -2.759119523285126e-02   +6.130154322440472e-02   -6.095612709211827e-03   +1.670629395801797e-02   +5.075321844871548e-02   -8.497990514268888e-05   -6.767396178300979e-02   -2.775592666524525e-02   +5.307368673981262e-02   -3.847084032307354e-02; -3.907218185154482e-02   +3.460640432968957e-03   +2.777655249622723e-02   +5.672289580039788e-02   -4.018185025408047e-02   -2.276904979400661e-03   +2.686831487183580e-02   +8.505240741430695e-02   +9.260596487638561e-03   +5.578552779582410e-02   -2.189443972337028e-02   -6.008409025749137e-02   +2.312881422524731e-02   -8.390746694428731e-04   -3.528623408343826e-02   +2.209894823042090e-02; +2.767387913228217e-02   +4.039301339648051e-02   +5.932351817014292e-02   +4.425245256422121e-03   +1.223291996796380e-02   -4.038866024180761e-02   +4.867890838234371e-02   +4.481317455166545e-02   -3.449830560541026e-02   +3.045971995843427e-02   -3.028803175850560e-03   +9.579836756747720e-03   +6.145263497809710e-02   +6.665242741947221e-03   -2.794633451573937e-02   -4.663108924857190e-02; -4.549284439497655e-02   -1.405773648717254e-03   -3.979151011755677e-02   -5.312873744466362e-02   -7.252477722634060e-02   +1.364312590880956e-01   +9.863043653563948e-04   +7.602025012603209e-02   -4.484301206856083e-02   +7.837537121370731e-02   +7.438937100482319e-02   +3.236664945884659e-02   +1.816347088270630e-02   -8.758287482144761e-02   -1.264978047705568e-02   +5.461286362014487e-02; +2.062012445491217e-02   -1.826034508538308e-04   -5.768209317389123e-02   -1.037398027311624e-03   -2.624445226539350e-02   +1.747980462646265e-03   +9.078973004202660e-03   +5.598741740692474e-02   -6.473002182857183e-03   +3.302880809489701e-02   -4.642129691604518e-05   -8.092545134231799e-03   -4.440287653568382e-02   -3.378490163556801e-02   -3.250860308777283e-02   +6.115493125087479e-02; -7.007815581162799e-02   -8.452639810589777e-02   +2.560358146070181e-02   +1.575565586446009e-02   -9.810847456545313e-04   -6.464101471907818e-02   -1.234655490079688e-02   -3.106480549568297e-02   -8.480719070029238e-02   -5.752526062429002e-02   -2.687928468591492e-02   +2.001455349365047e-02   +4.396124370233888e-03   +1.240096243623146e-02   +1.078321942459246e-02   +2.280314593215572e-03; -7.181642743979633e-03   +1.499104642782913e-02   -3.402329339002556e-02   +1.025040123564629e-01   -7.983498900005642e-02   +9.006534958772583e-02   -3.121994836712154e-02   -1.658274705489109e-03   +5.811777487480824e-03   -2.101475301756569e-02   -8.919643240281870e-02   -3.482561220234834e-02   +6.106562324185022e-02   -1.137251757383680e-02   +2.487670640616446e-02   +3.869069775924730e-03; +6.480227589223220e-02   -3.698059027432657e-03   +1.348879515692177e-02   -4.181821534800143e-02   +2.026360732752600e-03   -2.973006647446097e-02   -1.709826275309024e-02   -3.725340737457700e-02   +1.153459165538657e-02   +4.148901203745855e-02   -4.560467831307343e-03   -4.555637934634708e-02   +3.234130617832393e-02   +1.553911088663150e-02   -3.595250141392088e-02   -4.537014515611303e-02; -3.586517504413630e-02   +3.079568834205236e-02   -7.144936342065850e-02   -5.040003508358237e-02   -5.653631434884814e-03   -4.467438691747311e-02   -3.200032571210999e-03   -2.201557749166641e-02   +9.569109388616638e-03   +2.107784137194608e-02   -3.847685945707038e-02   -2.714175178285241e-02   +1.711780032171259e-02   -4.621528119745479e-02   +1.129779090528302e-02   -5.958174169454532e-02; +5.261769247025777e-02   +3.941502021836529e-02   +2.196943933611632e-02   +1.689244411220285e-02   +1.848755549235413e-02   +1.956819586702919e-02   -1.073840324043585e-02   -5.522395695621261e-04   -4.247174095766557e-02   -1.097081953233257e-02   +8.302646668342724e-03   -6.226784183885163e-03   +2.309801423361182e-02   -2.246197546201781e-02   -7.363057440504174e-02   +2.592659007579235e-02; +4.136209428078113e-02   -7.183249025065074e-02   -4.123354860792613e-03   +2.155306032518579e-02   -2.833432001673639e-02   -4.396873845110697e-03   +3.128461635412565e-02   -1.219716403602077e-02   +8.488572913613256e-02   +1.577665763933245e-02   -8.868306733524470e-02   -2.549234960969302e-02   +2.525483709623807e-02   +3.341875329495467e-02   -2.344444302776378e-02   +5.931740674668784e-03; -2.057901191107804e-02   -8.644246228546384e-03   -4.785399002116392e-02   +2.768601864017052e-02   -4.241659046124983e-02   +3.655086278595376e-02   +1.318889232416358e-02   -2.597666235585889e-02   +9.703383069746174e-02   +4.358987463590721e-02   +5.083429065353270e-02   +8.545748522130352e-03   +8.552359142834922e-03   +1.088598739748785e-02   -2.523626256725266e-03   -8.429411341393586e-02; +7.575883752214246e-02   +8.559636756221084e-02   +6.349689040076732e-02   -2.443744767064604e-02   +3.662693616135066e-02   -4.560493982319737e-02   -4.192595463296341e-02   +7.649127517065181e-03   -4.043686699895541e-02   +1.218012528466022e-02   -2.104076003433674e-02   -2.607864146067326e-03   +1.173657348561743e-02   +3.179944830453897e-02   +4.231823972090794e-02   -1.698292980028132e-02];
L2I_L1I_iGABA_netcon = [-8.659377330797476e-02   +2.007806092008129e-02   +3.700080490631249e-02   -3.887218552284814e-02   -9.811081674055701e-02   -1.458378971644168e-02   +1.278181211217032e-02   -9.378344821059611e-03; -3.878471975737190e-02   +1.680611635233433e-02   -4.986772842673473e-02   +3.494478106938507e-02   -1.600503444008378e-03   -9.952515355128854e-03   -4.571393643383373e-03   -6.532553768956187e-03; -1.456780143615125e-02   -4.309277685307755e-02   -6.004046943785801e-02   +3.963061568552112e-03   +4.380545236696317e-02   -3.983433432286196e-02   -2.787499174913905e-02   -4.130879874239884e-02; -6.515698592022660e-02   +5.653465963849116e-02   -6.526423478499453e-02   +9.633245917145537e-02   +5.531173369885604e-02   +8.292045942740599e-03   +3.958589429300506e-02   -3.534512977511734e-02; -3.533410652239981e-02   +2.521990750917074e-02   -2.880136841443389e-02   +1.799221723253817e-02   -2.684846244419369e-03   -8.931227337216961e-02   +4.441879857397998e-02   +1.662866967313104e-02; +3.011074403167057e-02   +9.475803297772083e-02   +1.148235808273314e-02   +1.013556309228388e-02   +1.658236660419516e-02   -2.562923340895498e-02   -8.650688742773270e-03   +1.954159537787900e-02; -4.206930255713974e-02   +2.539155808237272e-02   +3.170273232667272e-02   +2.061105508743022e-02   +2.430170330912154e-02   +4.529056510845230e-02   +1.400721758986570e-02   +1.774839372898605e-02; -1.443116636336316e-02   -2.427090944796683e-02   +4.483529474651388e-03   -5.386670961788522e-02   +2.705694510164650e-02   +1.531148970799846e-02   -4.445901752859891e-03   +6.418761776313613e-03; -2.693914123702258e-02   -4.000921256954147e-02   +9.982529828829219e-03   +3.148541108103427e-02   -2.732338821717097e-02   +4.712675573686062e-02   +8.792754817133380e-02   +1.216416420305598e-02; -5.391357594153505e-02   +4.030691287445808e-02   -2.777066689948125e-02   -5.318323798981098e-03   -3.246667329300222e-03   +1.342721299806108e-02   -6.583752421096889e-03   -5.559526035678767e-02; -5.484901382595383e-02   +3.626557724984485e-02   +8.474890340933253e-04   +4.916982114452337e-02   +9.558430342358138e-03   -6.293643147334545e-02   +5.140300548919711e-02   -4.853946748143401e-03; -3.047509356659495e-02   +1.183871073087374e-02   -4.308700850200313e-02   +1.839795195219034e-02   -8.181493101193441e-03   +4.157438725727279e-02   -1.280695244796561e-02   +8.234482434174885e-04; +2.588365444556488e-02   +7.237045558173033e-02   -1.808560022402395e-03   -4.980222875624427e-03   +2.898945032627729e-02   +7.287574418484738e-02   +1.629779143442287e-03   +1.010860566681824e-02; +1.459109555907812e-02   -2.391365175100856e-02   -2.772521643852930e-02   +1.676798184337649e-02   -8.783757902871801e-04   -3.294914553858432e-02   +2.784729209572911e-02   +1.670349212670811e-02; -6.846211104787676e-03   +2.259570042753582e-02   -2.216321152204736e-02   -1.744455292762491e-02   +1.622293606786242e-02   +3.792934813544525e-02   -3.649557777748834e-02   +2.304147206609700e-02; +5.590870855673544e-03   -4.081291380288107e-04   -5.899362864776705e-03   -3.801037137289447e-02   +1.666062255175850e-02   -3.101508902411794e-02   +1.309429857920766e-02   +1.191286404156609e-02];
L1I_L2I_iGABA_netcon = [-5.621155841636218e-02   +1.162920434386638e-02   +1.065879345144058e-02   -3.937461172071854e-02   -9.699480353607688e-02   +9.835181295386519e-03   +8.780909110619808e-04   -2.281278715095190e-02   +1.611642375908457e-02   +9.093473289072639e-03   +2.212373263839463e-02   +2.153703400687263e-02   -1.396847768683825e-02   +6.745601882569116e-03   -5.765736550400877e-02   -4.357264383685298e-02; -4.907514575662050e-02   +5.103771175045466e-02   +3.841321051771132e-02   +2.943853886352563e-02   -3.478569456940375e-02   -2.193960023278014e-02   -2.408936894384319e-02   +1.427894853002888e-02   +3.559347912580148e-02   +5.976657335272813e-02   +3.537752016886803e-04   -7.275233048199874e-02   +6.904134676170924e-02   +8.799822499678396e-03   -2.960077563876318e-02   +4.086024224651542e-02; -4.280798081927564e-02   -6.814868510286422e-03   -3.425528125079562e-02   -5.295160668946818e-02   +3.143854166281934e-02   +6.837598451001867e-02   -5.993644562070441e-02   -3.592519514798934e-02   +5.395860036168623e-02   -9.993384345068013e-03   -1.439433771221285e-02   +9.700097008547320e-03   -2.675650152764327e-02   +1.095852147180444e-01   -6.051566631160513e-02   +9.233029029654059e-03; +2.254309911404788e-02   +3.487211597755329e-03   +6.979360418218891e-02   +6.269743156909442e-02   -1.526212500470535e-02   +9.900809591485212e-03   -2.485118661550114e-02   +2.111078662599106e-02   -4.479252581780881e-02   +2.886587856805610e-03   -2.723746940339764e-02   +7.654056737328195e-02   +8.835540185250373e-04   -1.852782025918127e-02   +2.826584506706373e-02   -2.666323979127307e-02; -2.788196346454576e-02   -3.385414846340751e-02   +3.992274502369376e-02   -6.930961559509977e-02   +6.544213037495440e-02   +4.283401551270119e-02   +7.789055779736939e-02   -2.387903103969607e-02   +8.973952463062751e-02   +2.685771221095115e-02   +5.779509692658030e-03   -8.793033189036660e-03   -2.341071363996342e-02   +3.007471661636550e-02   -1.771417238415811e-02   -1.003281158246071e-02; +5.436424918509731e-03   +2.484438481358937e-02   -2.447148783155597e-02   -6.117168185483746e-03   -4.867391535235438e-02   +1.669495909267223e-02   +1.836123491332561e-02   +5.311018966999505e-02   +1.778295468870175e-02   -2.597889533377316e-02   +9.086140260854043e-03   +4.017213205498043e-02   +3.447497464070963e-02   -2.317492651846432e-02   -3.570295481162999e-02   -3.607762854981938e-02; -3.264050735915537e-02   +7.881365688555290e-03   +7.052296655827499e-02   -1.925142768972232e-02   +3.811637128181007e-02   +3.011904462360098e-02   +5.583728299198180e-02   +7.533188776950299e-03   -3.796813833120684e-02   -1.396458124420566e-01   +1.180198119177620e-02   +7.170187409921218e-03   +6.999221473378971e-03   +2.801911451081670e-02   -1.220563623933681e-02   +6.173907177157211e-02; +7.706796384176089e-02   -1.025738873799193e-01   +5.905977421453759e-03   +2.808187406380713e-02   -6.119821273321793e-02   -2.795432891882153e-02   -3.654048331827508e-02   +1.921339342434155e-02   +2.035595682196806e-02   +4.848246426652300e-03   +2.286965973929276e-02   -1.565062263702146e-03   -7.304037586445207e-02   -4.885368976919307e-03   -4.207743788772804e-02   -8.798427463897157e-02];
L2E_L1E_iAMPA_netcon = [-5.412495282252497e-02   +4.197434952293454e-02   -7.345810086521849e-03   +2.043731846554047e-02   -1.530451941899546e-02   -4.822863779417046e-02   -7.953988906727143e-03   +1.696308793470408e-02; -2.376353592760880e-04   -2.816036078393816e-02   +2.940332993903122e-03   +5.684539518159538e-03   +1.708758298933081e-02   -2.847083186076284e-03   -2.028328599502808e-02   -5.232996707797925e-02; -9.478729818869084e-03   -7.836789914261824e-02   -2.624857759696654e-02   -3.486480990176413e-03   +1.120015136181258e-02   -1.416649956673506e-02   +6.259564205679913e-02   +2.649274629747471e-02; +2.122830007063584e-02   +2.685721179806554e-02   +6.235338980376155e-02   +5.185102058880356e-03   +3.275225281164611e-02   +2.176392862073373e-02   +5.719764077634659e-02   +5.551754362774650e-02; +3.322730636164235e-02   -1.447969814698744e-02   -2.755802185740630e-02   -2.540100253257988e-02   -3.914798105511762e-02   -1.070311423338880e-02   +5.468230792743285e-03   -2.593551817096785e-02; +5.784772946078236e-02   -6.641353855922073e-02   -8.138242079795958e-03   +5.096801304826371e-02   -9.018819153433562e-02   +1.329421669708323e-02   -2.355917777053002e-02   +9.368000624046197e-02; -4.343638987051249e-02   -1.539992098369546e-02   -5.383942807678737e-02   +4.330209145675663e-02   +6.832644098982352e-03   +2.257298397009383e-02   +3.816513515166838e-02   +2.626656094487940e-03; +5.644417117249782e-02   -1.099756411292375e-02   -2.394674716974900e-02   +9.315297103761312e-03   -2.352438594031234e-02   -1.837807626295381e-02   -2.681895813464577e-02   +7.234250244027310e-02; -1.286041974228352e-02   +2.173959591909225e-02   -1.769836438096554e-02   +6.072517510497807e-02   -4.497299598668535e-02   -3.163762916386477e-02   +5.940213670430781e-02   -3.166297481667022e-02; +4.224876485800615e-02   -4.206621472164082e-02   -8.392061006084708e-03   +3.048305066163237e-02   +9.343862574540149e-03   +8.866286418021500e-03   -2.590303558030371e-02   -1.890927252769109e-02; -4.301189352723580e-02   +8.497124861663256e-03   +3.694935199097360e-02   -1.845338942750743e-02   +6.945183789506579e-02   -7.364420876580249e-03   +1.757021985532599e-02   -2.514331732870561e-02; +2.890180436856979e-03   +4.606193312421139e-03   +2.001763177490758e-03   -8.759576332019195e-02   -9.292266835938532e-03   -4.634639406687669e-02   -7.061047506991992e-02   -4.368803280665065e-02; +3.887155110156380e-02   -5.243486639986743e-03   +9.491691047234241e-04   -1.880491389127262e-02   -2.730939051429030e-02   -2.182233059495808e-02   -1.752756944871012e-02   -3.389150957644391e-02; -1.378439896187885e-02   +4.113598434824676e-02   +1.085568759259551e-02   -3.675406307207950e-02   -2.311937864295140e-02   +7.371232296817994e-03   +3.101658748593136e-02   +1.866147048834094e-02; -1.702829951345596e-02   +2.394828781158729e-02   +4.743843092424397e-02   +5.780212111208639e-03   -5.004387603746170e-03   -1.043137771103870e-02   +1.193711949973749e-02   -7.220625739845939e-03; -9.406290766580772e-02   +4.538868559782753e-02   +1.328789815126517e-02   -2.937080139861494e-02   -7.859472675534347e-03   +9.682941357446899e-03   -4.233561150023474e-02   -1.891486891289532e-02];
L1E_L2E_iAMPA_netcon = [+1.538842518472386e-02   -1.051695640022781e-03   -1.101491690714811e-02   -4.502501490099061e-02   -4.114946116164236e-02   -7.341438854590765e-03   +2.915928649673567e-02   +6.848656055404724e-02   -2.663876196516249e-02   -9.238429735031048e-03   +2.585523876146185e-02   -4.909586417418225e-02   -3.864225629365401e-02   -4.663228535782667e-02   +6.737269189160072e-02   -6.400890998062229e-03; +7.580813964261844e-02   -5.863381387763050e-02   -4.169329008798481e-02   +7.632407844844713e-02   +3.370936423919228e-02   -2.598543045913702e-02   +3.970409185377069e-02   +4.857277142456056e-03   +7.452437887462610e-02   +2.300938489144784e-03   -1.453891451527735e-02   -8.929539074144066e-03   +3.875834256614565e-02   +1.559662498251939e-03   -3.013676418156562e-02   -6.567450498143684e-02; -1.931132077573208e-02   +4.193497262241742e-02   +6.371663572992348e-02   -1.265856161557407e-02   +1.237514117667467e-02   +3.591670060909220e-02   +3.091784030633185e-03   +1.115079974104992e-02   -5.037618768528267e-02   -1.048225539898578e-02   +4.263095417598029e-03   -5.259561923906087e-02   -2.709621307601944e-02   +3.202886371766306e-02   -2.754135247954843e-02   -2.016891949466688e-02; +2.215086520750616e-02   -1.988381265376163e-02   -1.814509492174582e-02   +5.101933510725523e-02   -2.061856768905395e-02   -2.942718194096487e-02   -9.884434039244896e-03   +2.622826406698831e-02   -1.022517745874045e-02   -6.869885610934520e-02   +7.204006473967765e-03   +3.581186365467021e-02   +4.702024186798710e-03   +6.794855536594081e-02   +1.932053643321627e-02   +4.998442946400210e-02; -1.873620372906660e-03   +1.363834839776680e-03   -9.734232269353433e-03   +3.324667305229127e-03   +9.673259607054636e-03   +3.515667964416832e-02   +3.350863301777344e-03   -5.237892568624747e-02   -2.749114364858265e-02   -2.260768102097485e-02   +3.373342394728861e-02   -2.991447558327895e-02   +2.404104846328435e-03   +2.911386380548495e-02   +5.025048161523119e-02   +5.552869073345833e-02; -8.836186283020273e-03   -6.994600388989674e-03   -6.570780321661857e-03   +7.357025759600391e-02   -4.462418235095138e-03   -8.983892870966653e-05   -2.802116318113407e-02   +4.324899653501132e-02   -1.135639597546814e-01   -1.488257110116052e-02   +3.442902107189949e-02   +9.408930830062855e-02   +4.741889786371661e-02   +2.455338851395377e-02   +3.656409346537016e-02   -1.554816076824891e-02; -4.002883594119280e-03   +7.590549215356418e-02   +2.686464122161029e-02   +2.962909279003167e-03   -3.564707491974849e-02   -1.284571748898034e-02   -2.017184284611945e-02   +2.335525425368620e-02   +2.704871375761451e-02   +1.127803397799870e-02   +2.477932913133387e-02   +2.678008792288324e-02   +3.863532196331995e-02   +7.747504230322089e-02   -9.242648094357696e-03   -2.320214614440951e-02; +2.527488960485931e-02   +5.961602083398326e-02   -9.096087002326534e-03   +5.379955885500182e-02   +4.991320462279571e-02   +7.425335160277602e-02   +5.663020574159933e-02   +4.685302465857366e-03   +2.419944080064726e-02   +4.957600176971874e-02   +3.743208208778697e-02   -2.246301646867217e-02   +6.558918879776229e-02   -4.162572999000091e-02   -1.122722416902360e-02   +7.001901215232605e-02];
L2I_L2E_iAMPA_netcon = [+4.314725992346501e-02   -6.650302136118534e-02   -2.523411770438997e-02   +1.553536826377150e-02   +4.817681083946673e-02   +9.949223665804124e-03   +1.942131158778974e-02   -4.569876758194857e-02; -2.946157614328826e-02   -1.905466453627703e-02   -1.007451579110673e-01   +1.303219445060505e-01   -1.089217800459339e-02   +4.221729473590233e-03   -4.629127837170202e-02   +2.863925250366276e-02; -7.744381044697306e-03   -6.854532878609914e-03   +6.660455165858090e-03   +6.276788776216423e-02   -2.060393556012911e-02   +2.878706202450175e-02   +6.646174560395149e-02   -3.281063207171891e-02; +2.944002058397399e-02   -3.443297253246977e-03   +2.308191051771688e-02   +2.446660627324443e-02   -5.414889189211108e-02   +3.816728106420633e-02   -1.398718989634891e-02   -1.969253623536762e-02; +5.626444458305299e-02   +5.369639832875069e-02   +2.231096648806900e-02   +7.351488404648162e-03   -1.965311990119154e-02   +8.175067819450935e-03   +6.234500535725698e-02   +1.842163233113474e-02; -2.818797070426274e-03   -1.332797909298059e-02   -6.008444635210372e-03   +1.418727392421280e-02   +4.973010188322171e-02   -5.586164769008961e-02   -5.971839140965679e-02   +1.081748657325449e-02; +4.008659716913882e-02   -1.535763844126336e-02   +4.005736117652568e-02   -3.222099933361952e-03   -8.048202185193581e-02   +1.558522893932690e-02   -4.814325789985624e-02   -8.145991660362190e-03; -7.142789835550249e-02   -2.435484999542737e-02   +2.273528959651913e-02   +2.164071417435456e-02   +8.010832442886660e-02   +4.074196728592289e-03   -6.217582470264944e-02   +1.990440098564163e-04];
L2E_L2I_iGABA_netcon = [+4.762771910920099e-02   -1.815247879378820e-02   +5.477615349535997e-02   +1.144978404081555e-02   +4.888377910813634e-02   -6.235345913611472e-02   +4.825929245242166e-02   +1.227034248802849e-02; +3.003313712834564e-03   -7.958223607435044e-03   +4.225954602167398e-02   +9.499771859628751e-03   -4.848785770398395e-02   -2.935482438038500e-02   -5.936508413712605e-02   -3.046496791450999e-02; -3.727608417553016e-02   +1.998364744695058e-02   -2.732923538170855e-02   +9.357238599144937e-02   +3.656409735800758e-02   -3.634668621858013e-02   +3.290087870483006e-02   -6.637436373488972e-04; -1.024384508337796e-02   -3.308916497756961e-02   +4.178823081593416e-02   -7.856719876232028e-02   +1.437149014004048e-03   -1.438368228369147e-02   +4.157845068383968e-02   -3.623480541930066e-02; -2.629697190536205e-02   -2.044786815605244e-02   -4.105037432737255e-02   +1.152702804232957e-02   +2.915764707247692e-02   -4.910671548607842e-02   -5.303630497859904e-03   -3.551304819843201e-02; -3.011680761632395e-02   -2.314473739992221e-02   -2.490979520433003e-03   +3.050755434085919e-02   -1.448684816384399e-02   +1.910124743298231e-02   +5.347815719668213e-02   +4.924246249548245e-02; +2.747522510064054e-02   +6.621641877244004e-03   +3.088820166178642e-02   +8.397688011072960e-02   +6.377382596418302e-02   -1.354441944651118e-02   +2.615162941601988e-02   +5.916486912358885e-03; -4.814538326858540e-03   -7.361413665455088e-03   -3.939653162219720e-02   -2.465894530246061e-02   +2.582563013649318e-02   +6.223777369390880e-02   -6.305828402032103e-03   -1.970092585464982e-02];
L3E_L2E_iAMPA_netcon = [-3.543125764618350e-02   +8.708854018949361e-03   -1.668265265937505e-02   -1.527534315733144e-02   +2.346540200279896e-02   -5.773022336987452e-02   -7.981984093996031e-02   +2.727110789527077e-02   -3.257315885920990e-02   +1.565783787277672e-02   -2.199552153994259e-02   -5.486752991254378e-03; -7.887251290538401e-02   -1.445827936321550e-02   -2.369849479404964e-02   +2.335509121263830e-04   +6.437794019812705e-02   -6.599666951589725e-02   +1.143912319983705e-02   -4.297291339207271e-02   +4.923328775738869e-02   -1.088376779410813e-02   +2.451425802852042e-02   +3.000365691491936e-02; -2.652048961093267e-02   -3.367036802073038e-02   -3.492166997062120e-02   -4.891871257201187e-02   -1.675691318072010e-02   +3.511569089745638e-02   +1.670851609299310e-02   -5.529228651797627e-02   +2.127315088014774e-02   +3.115465762944118e-02   -4.889626476581869e-02   +3.858594359681921e-02; -4.290851630847221e-02   -1.748250915127977e-02   -8.861964973771994e-03   +2.867476336228295e-02   -3.251415510296622e-02   -5.013248728282163e-03   +5.075009976010181e-02   +7.390424766255800e-02   +2.817188373222840e-02   +9.158669126926380e-04   -2.184473048526538e-02   -2.901526545219595e-02; +2.947015501609604e-02   +2.598589137389232e-02   -3.449334573112838e-02   -5.372721707558765e-03   -4.518607818535910e-02   -4.124625954494077e-03   +5.184678089922422e-02   -4.476684885454308e-02   -3.343904191829374e-02   +9.236582649396224e-03   -3.518049500604369e-02   -5.214288388236408e-02; -1.309586600564109e-02   -4.514435351696839e-03   +3.357150695760148e-02   +3.388555716042666e-02   -1.130352006277742e-02   +2.863917761028337e-02   +6.721847798467996e-03   +2.197445516424757e-02   +4.970665931054991e-02   +3.742938000293945e-02   +5.225770591065104e-02   -1.980080672722176e-02; +4.801544657308081e-03   +1.321525574824918e-02   -7.520752704996317e-02   -4.317335002080191e-02   +6.375079644221907e-03   +1.443003262282676e-02   -1.925424666415318e-02   -1.387904061464972e-02   +3.083252237188549e-02   +1.572046990455597e-02   -5.235805170670590e-02   +5.518999725279644e-02; -2.439781168736530e-02   +2.516853797561257e-02   -2.093486378272493e-02   +4.314266331547792e-02   +6.211464649693038e-03   -3.472572537020702e-02   +2.170669699596885e-02   +4.336278695997416e-02   +3.657488529738243e-02   -5.359060012326146e-03   +1.012115558943061e-02   -3.252419633131456e-02];
L3I_L2I_iGABA_netcon = [+7.248556041247788e-03   -2.139846355708050e-02   +1.025308498945025e-01   +4.333450702455315e-04   -4.615562097391142e-02   -1.012273636254801e-02   +1.321264748597862e-02   +1.295801279491955e-02   -7.967817741741068e-02   -2.541920314916584e-02   -6.055099207166119e-03   +7.133119095791559e-03; -3.612475669871375e-02   +3.415751554250283e-02   +7.024231901561924e-02   -9.169323283892018e-03   -3.768645353944745e-02   +2.655878017534098e-03   -3.615343415051599e-02   +4.024099163857403e-03   -4.231963963345171e-04   +1.616308090359387e-02   +1.212574312504188e-02   -2.886050379958353e-02; -2.455816092231222e-02   -7.267709474135529e-02   +5.576463629266777e-02   +4.081165036150589e-02   -8.378011410782482e-03   +1.462560489119928e-02   +3.468348338023725e-02   -9.365046511598101e-03   +2.870295780048158e-02   +9.564912282858887e-03   +2.789409736132942e-04   -3.163011785986311e-03; -4.288689177538244e-02   +2.432690336877799e-02   -2.424260958488492e-02   -1.304342458974175e-02   +6.014565555836787e-02   -1.521316345146569e-02   +1.231017206375490e-03   +6.046504888107471e-02   -1.667857349776382e-02   -2.322793544788140e-02   +2.069496159363928e-02   -4.823533661439324e-02; +5.149723888540306e-02   +3.284618331509551e-02   +2.794572406076077e-02   +2.890618327977955e-02   +7.315323840871191e-03   +7.157095777725227e-02   +2.546260821207097e-02   -1.902442697322739e-02   +1.477543940455957e-02   -4.732238554937510e-02   +2.924459770308088e-02   +4.398664613676588e-02; +5.565505808641815e-03   -1.246664126033841e-02   -6.524811782298512e-02   +5.128767332689470e-02   +4.921329202008481e-02   +1.089096972851943e-03   +3.769717561273028e-02   +2.750763929124873e-02   -4.637835147065909e-02   -1.571816175122022e-02   -1.945106355191858e-02   -1.377671987738181e-02; -3.480890207868227e-02   -4.825803040922061e-04   -3.745699414430697e-02   +7.659451285801148e-03   -5.394037524127927e-02   -2.355632827097443e-02   -3.864530905451401e-02   -4.330615794259393e-02   -3.503275622130200e-02   -6.583080941120567e-02   +3.377919780192958e-02   +2.625330986981339e-02; -5.113194593383227e-02   +2.635127510379122e-03   -3.187158973280827e-02   -2.245641706267362e-02   -3.154107309390512e-02   +4.902383335729739e-03   +5.210239272303042e-02   -1.923866401559179e-02   -1.653471216416121e-02   +2.459335100147569e-02   +5.819244500684765e-02   -5.897022828975167e-02];
L2E_L3E_iAMPA_netcon = [-1.809141491299487e-04   -5.776934706762826e-02   -3.590394014783924e-02   -5.937274480422595e-02   -1.398819534920891e-03   +2.390794777150958e-02   -7.011866689765174e-03   -3.480819268302426e-02; +6.787975897820349e-02   -3.837062878681276e-02   +5.962437592915341e-02   +1.292918068188692e-02   -2.922106039295201e-02   -3.187502552973064e-02   -3.181437361243834e-02   +7.557294268126136e-02; -1.670711258900627e-02   +7.049418874089602e-02   +2.903036462997353e-02   +1.090469462958934e-02   +1.220629048167535e-02   -5.844515306822921e-03   +1.202966523674899e-02   +4.542802076444746e-02; +4.039487674596140e-02   +3.359147286959213e-02   -1.556345780153323e-02   +2.109168849933626e-02   +7.831701360629359e-02   -3.988274550562700e-03   +3.628900723248124e-03   +2.167074844003060e-02; -6.849651784303511e-02   +3.885693518486813e-04   -5.798630125973391e-02   -4.246138322680849e-02   +1.317938691664530e-02   +1.678925694359252e-02   -4.071635469158414e-02   +6.157935775963320e-02; +4.053736672798014e-02   -7.310420131975762e-02   +1.468405925833243e-02   +4.524591913907265e-02   +4.113662547235946e-03   -4.346784401517434e-02   -4.148703520568918e-02   +2.023390980608866e-02; +5.698546487722654e-02   -5.614406334567105e-03   +1.923399305194885e-02   +4.547970272264907e-03   +1.990369388712928e-02   +1.235127356222080e-03   -6.234634599945018e-03   +1.440455626994327e-02; +4.238732880027107e-03   -4.917814072043100e-03   +2.162026190480348e-03   +2.996548336064953e-02   +7.468390857588801e-02   +1.157786411908111e-02   -6.074617901245739e-02   -1.990368280747855e-02; +4.209799815316241e-02   -1.398233194471718e-02   -3.525274180438009e-02   +1.386392413323359e-02   +1.267368556568119e-02   +5.336373896534234e-02   +5.761076233767042e-03   -7.387980409151963e-03; +3.536261261199681e-02   -6.410137988511259e-02   -3.905728775710622e-02   +2.591964999579662e-02   -4.626666404377315e-02   -2.626457423933900e-02   -1.551050228226453e-02   +9.905920016532720e-02; +5.741848346899336e-04   +2.198838523563763e-03   -1.382914224833034e-02   -5.375247447701782e-03   +2.864883093053475e-02   +2.522154311937340e-02   -6.361501977816615e-02   -5.697706677700234e-02; -2.935872108913291e-03   +7.445596386340247e-02   -2.036141222871964e-02   +7.074621624853825e-02   -4.342813832249037e-02   -3.202764191198856e-02   +3.621711008263026e-02   -2.007898379334455e-02];
L2I_L3I_iGABA_netcon = [-5.952291552433665e-02   +1.490385762309471e-02   +1.761659536325692e-02   -3.767242304477700e-02   -4.854558889544368e-02   -1.420974070362894e-02   +2.087830146856920e-02   +2.135546789245505e-02; -1.334271797575470e-02   -2.016819752221257e-02   -1.423665606203328e-02   -4.998328773977961e-02   -6.919540350420716e-02   +4.778687298443508e-02   +3.096181149759517e-03   -4.083384949730363e-02; +6.585945135967416e-02   +2.682456010808239e-03   -7.918303798058458e-02   -7.277183937803718e-03   +2.446537991096224e-02   +4.334150011971849e-02   +4.308749900543136e-02   +2.186429363541056e-02; -2.734663925057735e-02   -2.312631628137384e-02   -9.982856668663614e-03   +1.266062628961328e-02   +2.020496707221893e-02   +2.135327984923485e-02   +4.730683780103248e-02   -5.258087690417541e-02; +6.846470644823330e-02   +7.240517265785090e-03   -8.416459700573055e-02   +3.766274474680757e-02   +5.033947556931030e-02   +7.756903888412964e-03   +2.543103918301063e-02   +6.772882397652055e-03; +3.295877323487982e-02   +1.516541176300062e-02   -2.661324336290044e-02   -3.458267114519108e-03   +3.152802192711288e-02   +8.547871012704758e-02   +5.307203318534556e-02   -9.474609545649172e-03; +2.259091266915446e-02   +4.357674224624560e-02   -2.263368042040440e-02   -6.899953861339882e-03   +1.738625708986501e-02   -2.924475667670392e-02   -1.128366437077024e-02   +4.283094232936122e-02; +2.908090946434529e-02   +1.214507922828714e-02   -3.169946238888931e-02   -2.571404869567570e-03   +1.950995314987469e-02   +7.667054212092322e-02   -1.134230926645375e-02   -7.009835849026226e-02; +4.518527004737419e-02   +6.795793785616233e-02   -2.899371140375108e-02   +8.660477496772123e-02   -1.234876617639315e-02   -2.309253459612571e-03   +3.018965947494714e-02   -2.440796174956531e-02; +4.623099763753206e-02   +4.360469417129635e-02   +3.644438243700156e-02   +2.429541432674166e-03   -3.526736477817539e-03   -4.330686922467199e-02   -2.626124976946542e-02   +1.704571883718495e-02; -3.793975153573959e-02   +6.501299368218202e-02   +2.321560053761453e-02   +5.079290573716042e-03   +5.643087764033609e-02   +9.897941371176308e-02   -3.472229287632683e-02   +7.431911393416403e-03; -4.947443043459510e-02   +2.707123303044644e-03   -1.647933122496685e-03   +6.769403017924427e-02   +3.764673975515003e-02   +1.416028194264495e-03   -6.390788591836791e-02   -4.302573596329771e-03];
L3I_L3E_iAMPA_netcon = [+7.267516444529609e-03   +7.408323101145675e-03   +1.142084447717696e-01   +2.104706076601238e-02   +5.995422174160214e-02   +3.886365212700318e-02   -6.021721531875426e-02   +4.858131258609635e-03   +1.252248913112683e-02   -3.097918528829953e-02   +2.815456042476122e-02   -1.674193539707882e-02; -1.827257760043594e-02   -2.610579847206776e-02   -7.855096568789039e-04   +5.518574378498788e-05   +1.152513273370319e-02   -6.457744913441517e-02   +1.802808059490133e-02   +1.617200038071909e-02   +8.367040078036944e-03   +4.816673953821373e-02   -5.191158775253561e-02   +3.266625855649931e-02; +1.434558039019283e-02   +4.997124037439348e-03   -2.733355637537944e-02   +6.092847022748198e-03   -6.056562875635557e-02   +1.577038107115825e-02   +2.088353136544175e-02   +4.060206313069878e-02   -3.706106529249598e-02   +6.003190244037483e-04   -2.448508833393886e-02   +2.485221721943475e-02; +2.099233830060865e-02   +4.435548249106656e-02   +2.730209335826583e-02   -3.080249251188064e-02   -2.825529580559295e-03   +5.763058628735940e-03   +4.909302980311151e-02   -1.917464007684697e-02   +4.860066133585248e-03   -1.411895382912455e-02   -5.965207427051618e-02   +4.325352226199343e-02; +1.861611909297498e-03   -1.022036097522865e-01   -8.657813756481883e-02   +4.083933047297553e-04   -3.632717999821122e-02   -5.688152439384492e-02   -2.739120569791018e-02   +8.798622269124342e-03   -1.129809262309307e-01   -7.465825991654329e-02   -1.804941340478430e-02   +5.763538797756468e-02; -3.694258110455906e-02   -7.887437336101217e-03   +7.266267161047149e-02   +2.192340454276457e-02   -2.073372364084239e-02   +5.171059139489948e-02   -1.594190767716913e-02   +5.777212104827756e-02   -1.602493941859670e-02   +5.559127280709568e-02   +2.461620063872577e-02   +2.387569924077882e-02; +6.562300351872558e-02   -3.076026569310517e-02   -1.142714461930247e-02   +2.462109330635218e-03   +2.625165011953817e-03   -2.445477424265755e-02   +1.708259676273158e-02   +4.542023661449525e-02   +2.528181210091004e-02   -6.365419145206389e-02   -5.790304488913488e-02   +1.839163151114373e-02; -1.795696897454737e-02   +1.336360436609082e-02   +1.915508140895119e-02   -7.359933130820874e-03   +1.159714955249143e-02   +3.390208905717495e-02   -8.789955021018821e-03   +3.929800515762339e-02   -1.796345760559337e-02   -5.127885026881616e-02   +3.591949398385606e-02   -2.665997505616268e-02; +1.785243719176596e-02   -5.556229355738018e-02   +6.071450426811718e-02   -3.420508249020251e-02   -4.170181070987157e-02   -2.987081045729818e-03   -2.860701872883569e-02   +2.852009828360069e-02   -2.722537073955021e-02   +2.753379055522433e-02   -5.904226915533879e-02   -3.863672095623320e-02; +2.365386361519883e-02   +1.032600609082567e-02   -7.547929720903727e-03   +8.114460343942788e-03   -2.515782890439816e-02   -3.687450415320979e-02   -5.120668337793929e-02   -2.526260536807011e-02   -1.586338579639515e-02   +3.845336038942814e-02   +2.901330167153081e-02   +2.480832576478921e-02; +2.009093141652110e-02   +6.868322176851188e-02   -2.180575961473880e-02   -9.263102355288619e-02   +3.838877832515734e-02   -5.823169448367860e-02   +2.911939867739527e-02   +9.444955477443367e-03   -1.768337930893493e-02   -5.058282603147977e-02   +3.805931757658144e-02   +1.723604360281499e-02; -1.427927240987700e-02   +5.189586854385009e-02   +3.578924528839020e-02   +4.027459242140306e-02   +7.421716112865491e-02   +4.653898403486026e-03   +1.644006640892995e-02   -4.396569560091966e-02   -3.926102938606843e-02   +6.739348981892763e-02   +5.157606092315745e-02   +1.028515977518411e-02];
L3E_L3I_iGABA_netcon = [-1.901503345369980e-02   +3.639921736130921e-02   -2.521986636059405e-02   +2.617245466589537e-02   +1.083488760165846e-02   -7.458646220246258e-03   -3.238044682270074e-02   -5.100995577800532e-02   +1.176628375653046e-02   +3.082556945619588e-02   +2.174826783505737e-02   +2.725416212636099e-02; +4.223859363947939e-02   +4.289640280399847e-03   +9.361266639959707e-03   +2.311727842321766e-02   +4.447647861458631e-02   -4.818478425124349e-02   -2.640998211979658e-02   -9.310699112195326e-03   -4.273826387804790e-03   -2.386683145625557e-02   +3.719738182254485e-02   -1.341357264107061e-02; -2.532060388471915e-02   -4.039844506376705e-02   +2.966865218584595e-02   -2.795544932635576e-02   +1.878324261711066e-02   +5.563514255920061e-03   +3.823039424698019e-02   -1.945431739922354e-02   +2.431991596341824e-02   -2.485351521837582e-02   +5.160459800350520e-02   -5.734954769002158e-02; +1.027218915740140e-02   +2.747446250616773e-03   -5.775985572720330e-02   +1.134208201335495e-02   +4.970050012842967e-02   +4.638098819859544e-02   +9.982150358111695e-03   +7.192128078314865e-02   +9.082917932366205e-02   -2.052955572811491e-03   -5.941912492345137e-02   -3.506798168841900e-02; +5.723818831722087e-02   -1.050099831456978e-01   +3.732858428693336e-02   +5.667879708779071e-02   +1.573134935820484e-02   +9.861600725422831e-03   -2.937955615937477e-03   -2.178812061144849e-02   -1.317338514454512e-02   +3.249334811256742e-02   +5.223844933751492e-02   +4.027530788389115e-02; -8.540938984792020e-03   +1.194017208245862e-02   +5.612548838824556e-03   -4.901336579466100e-02   +5.601531711373374e-02   -4.809425798531181e-02   -6.676828931513895e-02   -2.610859371808766e-02   -6.504732803028525e-04   +1.743625330828898e-03   -1.617324777368002e-02   +3.128726860865159e-03; -6.107714663324750e-02   +4.155712185329946e-02   +5.804182734602386e-02   +2.681490161008191e-02   +4.989263203594952e-02   -1.980030904961821e-03   +5.930490204242181e-03   +1.021854693968244e-02   +2.660721965000311e-02   +1.170706466761311e-01   -2.711575144630009e-02   +1.340471540622153e-02; -8.446780291305329e-02   +6.867363443955452e-02   -5.907668645821619e-02   -7.593572683217283e-02   -4.915237210611684e-02   -1.861960681683882e-03   -2.613169359683063e-03   -3.649569328868311e-02   +2.703295103210189e-02   +3.413680436951948e-02   -7.514986795040815e-02   -3.874521110775875e-02; -2.789615243947580e-02   +5.746220248893963e-02   +3.445305270716637e-02   +2.190308697642304e-02   -6.201713460297467e-02   -4.283391581804677e-02   -1.509424431813921e-02   -4.570815454952695e-02   +6.502801283959914e-02   +4.887943281735165e-02   +4.900010657055290e-02   -3.438543451437631e-02; +1.567761821403387e-02   -7.194247859220704e-02   +1.421957063892185e-02   +6.327675238442611e-03   +3.012592275401709e-02   -8.867423009468786e-03   +4.102684102354870e-02   +4.907927371586053e-04   +2.576166352889837e-03   +3.333168482761270e-02   -6.377759919197927e-02   -4.165462199566110e-02; +4.453914016549988e-02   +4.145149159420244e-02   +7.528576535165459e-03   +1.675869169083313e-02   -1.790993722210351e-02   +4.219765080148216e-02   +2.876549351913567e-02   +3.573028957590883e-02   -9.717535223451177e-03   -1.933536335429320e-02   -2.030206847481278e-02   +1.187237351062003e-02; -3.444767038490176e-02   -1.396359974099738e-03   +1.482459491902687e-02   +5.336129217476763e-02   +3.432397531257581e-02   -6.373353564925245e-02   -2.240319011829814e-03   +5.935292567485938e-03   -3.485377416849674e-02   +9.094677232651700e-02   -9.179140219586872e-03   -7.356650469487147e-02];
L2E_Input1_iAMPA_netcon = [-3.299298063055029e-02   +4.968178754176194e-03   +2.942389604768602e-02   -8.659553546018794e-02   -4.303576600981896e-03   -3.707930756862995e-02   -1.565132500298566e-03   +3.357922866905301e-02];
L2I_Input2_iAMPA_netcon = [-4.609792909115611e-02   +3.561102429432933e-02   +3.407183409303955e-02   -7.523704693587094e-02   +6.060210663506281e-02   +5.027939951606076e-02   +1.223593035748456e-02   -5.201038070258920e-02];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.03*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.15*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.15*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.03*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.15*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.15*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
