function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+4.092711943438691e-02   +1.443475787449857e-01   +1.590247198592997e-01   +1.659167065627400e-01   -1.183730187149696e-01   -6.034177098713404e-02   +8.641634719301934e-02   -1.672726001747940e-01   -1.034813537593041e-01   -9.615383649960861e-02   +1.675736103755116e-01   +9.248907854166405e-03   +1.036209800438525e-01   -1.622642931748766e-01   +1.270576494694199e-01   -1.950467648552427e-01; +3.027761061921517e-01   -6.984493338333279e-02   +2.440868406092042e-03   +4.995677322075170e-02   -1.404126891295940e-01   -1.950506115953759e-01   +4.570471855030878e-02   -1.213959772995908e-01   -1.735607931899552e-01   +4.176006926906607e-02   +1.021511594007791e-01   -1.869547160512247e-01   +4.390889123524067e-02   -8.027371715501817e-02   -7.423963079830413e-02   +8.230460671170307e-02; +2.885873042957029e-02   -1.562459487483687e-01   -1.930841399138859e-01   +2.041389548210377e-02   +2.774819983552734e-01   -1.205065652403560e-01   -7.700647965217594e-02   -2.615675601019372e-01   +1.775680185627679e-01   +1.330986332773931e-01   -1.869910423103024e-01   -2.201018827611094e-02   +2.794065581225505e-02   -2.209557911889943e-02   +1.977669239039405e-02   +2.078296471031635e-01; -1.552281547210573e-01   +1.289551528406709e-01   -4.555888598228502e-02   +2.332314770841539e-01   -2.413837172753269e-01   +3.454923596167132e-03   +1.058582808677624e-01   -6.386239881666897e-02   +1.879203494622170e-01   -7.431610490823048e-02   -6.044711826407944e-03   -1.119992107481972e-01   +8.360288672913510e-02   -1.366818312499033e-01   +5.980197775116255e-02   +2.353031742205476e-02; -1.612179367169899e-01   +2.524507551932169e-01   +1.630233700694710e-01   +5.928162333462216e-02   -1.196643838602997e-01   -1.788690224595937e-01   +1.909303812118193e-03   -1.660351802209740e-02   +2.248336774442996e-02   -1.011922850305185e-01   +1.060179442760147e-01   +2.490672745248782e-02   +1.624953698882012e-01   +1.099121325112551e-01   +1.449811394725643e-01   +2.592121944734218e-01; +1.517553701951571e-01   -2.220964431132739e-01   -5.872725914344427e-03   +4.823757185140719e-02   +1.141443063290847e-01   +3.951458668593873e-03   -1.562841917206266e-01   +1.625743580976172e-02   +1.087171850707012e-01   +5.846832459050974e-03   -4.360231345931864e-02   -7.251725669213986e-02   -9.746691767777896e-02   -2.388933507927213e-01   +1.238165335440882e-01   +8.604971673940090e-02; -1.124749768125467e-01   -4.544976357466234e-02   +3.271985305419552e-02   -8.157728267396327e-03   +7.058520273045039e-02   -1.525668975802279e-01   +6.692655839682290e-02   +1.001066836433704e-01   -6.839728686213149e-02   -2.715143069686540e-01   -4.441206707605408e-02   -3.244425284850241e-01   +4.119941361078031e-02   +6.127678577295360e-02   +2.251150028896625e-02   -4.978868135456379e-02; +2.447080992336504e-01   +2.627291111232584e-02   +1.416563298582044e-01   +3.235544722048353e-02   -2.208511609104462e-01   -2.391588424437139e-01   -1.936997822993133e-02   -1.172664964389753e-01   +7.831125240080963e-02   -1.930640028826374e-01   -3.906096894371791e-02   +2.468289083024888e-02   -9.684335575258321e-02   -1.864618395537869e-01   +1.055656311680808e-01   +6.181742654630899e-02; -2.020172822217704e-01   -5.391184546910888e-02   +1.758674188699687e-01   +4.755546118707989e-02   -1.369388776251372e-01   -3.368174870832095e-01   +1.118086542312857e-01   -1.089144979886040e-01   +1.906026735582952e-02   +5.457846679475556e-02   -1.237721201068893e-01   +6.496976843037007e-02   -1.399447520191151e-01   -8.930436107418213e-03   +4.783466129241254e-02   -1.795361459245037e-01; -2.703074524815968e-01   +2.299022162900243e-01   +1.007587206509080e-01   +9.639452857454257e-02   -1.272272715811922e-01   +9.305515383591419e-02   -1.813673733998594e-02   +4.542936982045862e-02   -9.143327189166105e-02   +1.524893724195806e-01   +1.002500376063482e-01   -8.304056507873989e-02   -2.042399235267255e-02   +1.504712178222559e-01   -1.536927297693959e-01   -1.137567991598266e-02; +7.192453623960801e-02   -3.588450645172198e-02   +7.773109927497270e-02   +2.227891957509033e-02   -1.534029351845089e-01   -7.491876210175322e-02   -1.258939173290160e-01   +1.043694445259105e-01   -6.187646644811530e-02   +1.582991566035202e-01   +2.453230843838367e-01   +6.593678171149114e-02   -9.345593502428992e-02   -5.902548568784301e-02   +1.290709537253808e-02   -1.588029120332186e-01; +1.911781740865781e-01   +1.525367560437765e-01   -1.771773391056536e-01   +4.305639551353269e-02   +1.884314700023578e-01   -4.447453293286044e-02   +1.701841813557134e-01   +1.009318834533170e-01   +1.464148415854712e-01   +2.686326714496807e-01   +1.212481304862705e-01   +4.421531864511374e-02   +7.375412827548870e-02   +2.163945569161914e-01   -2.157314679688397e-04   -3.375922604437954e-01; -4.042373318369136e-02   -1.177416818726306e-01   +4.886786378163845e-02   +7.758659783365174e-02   -1.527720884956875e-01   -2.713159077190644e-01   +4.821281038378188e-02   +2.001474906043774e-01   +6.689424464388352e-02   -2.517397630834429e-01   +2.830432096138238e-02   -8.415946328937583e-02   +7.176237556673144e-02   -1.903238879963962e-01   +5.563644107701115e-02   +1.144853247286189e-01; +6.719961736218129e-02   -2.010008508943756e-01   +1.113877454277375e-02   -2.695013773527965e-03   +1.438374037394453e-01   +2.272637128968785e-01   -3.164794182432235e-03   +3.070664997148071e-02   -1.375236619973935e-01   -2.060586668473157e-01   -1.050796063532839e-01   +1.016876365551796e-01   -1.913301259742096e-02   -1.283707994150209e-01   +1.615877638160091e-01   +1.289684316253188e-01; -6.142240929491526e-03   +1.561304564269974e-01   +2.235910530904025e-01   +3.135512929125247e-02   -6.443324781244281e-04   +2.619688168746245e-02   -3.648358241522619e-03   -2.832720577490240e-03   -1.873040744577888e-02   +2.361911734806240e-02   +1.490587595583489e-01   -5.381695783789032e-02   -1.022774823807254e-01   +1.973736462882268e-01   +1.643246706322228e-01   +5.746628232833030e-02; +1.149780128680663e-01   -1.915708628063722e-01   +1.792564997654495e-01   -7.630124452288717e-02   -1.811515466245252e-02   +8.060246304307345e-02   -1.626520413284830e-01   -9.000752252901059e-02   -2.779923591300582e-01   -2.186052403857984e-01   -1.872252414869898e-01   +6.299796764354909e-02   +8.189686508084011e-02   -3.220795676872970e-02   -1.918093027228358e-01   +1.156526169771164e-01];
L1E_L1I_iGABA_netcon = [-1.107436837286800e-01   -6.472340197504228e-02   -2.040419465657844e-01   +2.812927985534633e-01   +3.057241107010202e-02   +1.677027629946971e-01   +4.258613689629861e-02   -1.324167608893536e-01   -9.077956982003554e-02   -1.326198466054224e-01   +5.624929211222746e-02   +1.382215131039511e-01   -2.342621073588130e-01   -8.837416882633042e-02   -2.710740291187254e-01   +5.472347413910535e-02; -3.939009544499102e-02   -1.980595824559445e-01   -6.983035378049873e-02   +2.150893896078825e-01   -2.295935670422384e-02   -2.145604360254483e-01   -1.355739482344554e-01   +1.161528229008110e-01   -1.307147450533607e-01   -7.359908428972947e-02   -1.732736088065180e-01   -2.928638068508031e-02   +2.316687767681330e-01   -7.254842889465614e-02   +2.058930407753315e-02   +3.781235114032695e-02; -5.096869253654910e-02   -8.744729901832414e-02   -4.335661228317904e-02   -3.170958974644881e-01   -1.163361441621372e-01   -3.287748392779420e-02   -6.035451009095340e-02   -1.319352083952800e-01   -3.139406326145135e-02   -1.831570951481312e-01   +2.508829560783096e-01   -5.489834650213030e-02   -1.332289247531343e-01   -2.700111114060284e-02   -3.786656497590534e-02   -5.903012767969324e-02; +7.451880603512094e-03   +7.112239171882863e-02   +9.337167319482585e-02   -1.047057358317915e-01   +2.144235850904668e-01   -2.844645256003159e-01   +2.956995412686789e-01   +1.256291338953693e-01   +1.117429722636017e-03   -7.916773487788530e-02   +1.620312739287943e-01   +4.973657734950197e-02   -1.140851172012049e-02   -1.792090734850898e-02   -1.504569245016024e-02   +3.375131695103925e-02; +2.566890528483324e-02   -6.498942830443891e-02   -3.603971415748873e-02   -8.432074500860756e-02   -1.061957133197110e-01   +7.509276141205728e-03   -2.059773508380580e-02   -6.462752747187099e-02   -1.873773705113185e-03   +1.682723401139128e-01   -3.114874779691365e-01   -3.749330787279208e-01   -2.642306082959119e-01   +1.676270037423740e-01   -1.972954422411510e-01   -1.652071128716686e-01; +1.299343038254862e-01   +5.603533023488113e-02   +8.491493291815320e-02   -1.562614493670909e-01   -6.242956445157538e-02   -2.854718431305443e-01   -4.488169585191328e-02   -1.960786264530747e-01   +2.704326434720480e-01   +3.718929997329780e-02   -1.161886895317908e-01   +1.015978640720274e-01   -3.404368691067877e-02   +1.162179792055827e-01   -2.563387047634770e-01   -2.001728744653313e-01; -9.117420952695021e-02   +1.463710618867126e-01   -3.492180343666940e-02   -5.402040514995272e-02   -2.640933456685360e-02   -2.939626386326434e-01   -2.057552883640226e-01   +5.559786429428877e-02   -2.293876954259115e-01   +5.183505305900502e-02   +2.712725739436816e-01   +5.661802127867411e-03   +7.030397839665822e-02   -1.789730196410957e-01   +8.164964298977435e-02   -4.187247810364027e-02; +2.772061228626991e-01   +7.516767874678329e-03   -5.952739005780370e-04   +9.958811542595855e-02   +1.313307099676584e-02   +6.791366766740006e-02   +9.718804046032023e-02   -2.097431114873595e-01   +1.852856800672662e-01   +1.187210163281290e-01   +1.806358084273994e-01   -1.173559516167188e-01   +6.633426918884435e-03   +2.872386123768364e-01   -1.508547854591754e-01   -1.430204474128539e-01; -2.576582086481373e-01   +2.383539774694805e-02   +2.020207439067678e-02   +1.758133140715364e-01   -5.603173426510503e-02   +4.257395428382880e-02   +7.454412686377376e-02   +5.982190914830590e-02   +2.227436942330673e-01   +7.880114998807104e-02   -2.614291470879315e-01   +1.193813211951094e-01   -9.054655432053856e-02   -2.429236206020733e-01   +8.167271303518983e-02   -4.913718661322557e-02; +1.306925653070325e-01   +5.311534056853102e-02   -6.625186698663559e-02   -2.219840443526934e-01   -1.015185453479202e-01   +2.300576037828823e-01   +3.825945118474204e-02   +4.929738559128245e-02   +4.872705562535012e-02   +1.074038459673421e-01   +7.033834076377149e-02   -2.237367032893385e-01   -1.854465890861667e-01   -7.506194635739644e-02   +4.148497434883221e-03   +1.466956057053667e-01; -1.240492763521149e-01   +1.286813575226117e-01   +2.081504710189630e-01   -3.351909199409547e-02   -3.824653741337205e-02   -1.213933715345127e-01   +8.525200396025728e-02   +9.603470417114011e-02   -1.678606715341589e-01   +1.401049665367856e-01   -1.183846623171533e-01   -7.652535352977760e-02   +3.026845831629179e-01   -1.419933745727779e-02   +1.754120432788581e-01   +1.196057801374658e-01; -3.194385275325534e-01   -1.048094060794168e-02   +1.196272088978072e-01   +2.860999439217142e-01   -7.550661061879788e-02   -1.522506202792129e-02   +1.802038902839175e-01   -7.454357630379634e-02   +1.396538932098779e-01   +1.474288805912114e-01   +2.632935225119976e-01   +1.239497329478678e-01   -9.923574758648611e-02   +1.066553054553871e-02   +1.661349591593360e-01   +3.425882091010558e-01; -1.539073541835941e-02   -2.108778966140430e-01   +2.958486679661355e-02   +1.718815904619875e-01   +2.006077159451489e-04   -1.006473709532894e-01   -1.316632546261200e-01   -1.149730329792911e-02   -1.666155431760288e-01   +1.029156275704748e-01   -2.450451873104253e-01   -1.634390287046281e-02   +5.794348528497471e-02   -1.421408766417732e-01   +1.698069680356885e-01   +1.861058673336477e-01; +3.993365004485689e-03   -6.214984667716719e-03   +2.502744310244613e-01   +1.476474572983735e-01   +3.902366478903262e-02   +2.547029863513990e-01   +5.041525315144158e-02   +1.297384151569449e-01   -1.200172432652645e-01   +2.187261840527475e-02   +1.836172438121117e-01   +6.277436615430002e-02   -1.040159615238048e-02   -2.272367466667218e-01   +1.424979081823808e-01   -5.694272429864099e-02; -1.879925823629996e-01   -9.995838542606705e-02   +2.263474453393394e-01   -2.649755549511874e-01   -8.916773157672327e-02   +5.865426274994018e-02   +2.658152577586504e-01   -3.891741901531447e-02   +1.647928300011229e-01   -1.497292171773911e-01   +1.719171653484931e-01   -7.900292487637953e-02   -8.603949719299497e-02   -4.082832626729595e-02   +2.257576065025382e-01   -1.299085925505896e-01; +1.292300850191339e-01   -7.483175652245330e-02   -1.580415135436145e-01   -8.429680313984846e-02   -4.049694562166030e-02   -7.415835936701139e-02   +2.834873109129502e-01   -1.728516018342818e-01   -5.311018778794886e-02   -1.658025411940443e-01   +6.120246213953565e-02   -9.436971879023079e-03   -8.609817960522703e-02   -4.402349762211831e-02   +1.336890519175103e-01   -1.493682562138428e-01];
L2I_L1I_iGABA_netcon = [+3.756377534663962e-03   +1.786407989723088e-01   -9.301263735850414e-02   -2.232539932322596e-01   -2.074194319617360e-02   -1.356809320224741e-01   -4.976241246460730e-02   +1.366870532737360e-01; +7.009644470153084e-02   -2.543166925913182e-01   -2.490149933847043e-02   +1.206362283245632e-01   -2.675389091433416e-01   +4.120153367058788e-02   +2.786597177755221e-01   +2.802484120507192e-03; +6.450252518640981e-02   +2.936670932998980e-01   +1.599717290541153e-01   -1.510237629140237e-01   +2.976400053169017e-01   +4.905960678331979e-02   -6.546446292096286e-02   +9.387152256625654e-02; +2.601959686942608e-02   -1.057762095694086e-01   +2.708394951363166e-02   -1.589936726155289e-01   +9.981126536908400e-02   +1.512095538383367e-01   -1.721676521077509e-01   -1.284984638782793e-01; -2.715692419919250e-01   -7.842820536007392e-03   -1.419217647881331e-01   -2.896819932592037e-02   -2.690172026103246e-02   -3.782711308080736e-02   -2.399811255488927e-02   +6.008557998049677e-03; -1.653505839143296e-01   -7.984081626791278e-02   +4.275106725645422e-02   +1.890077523041460e-01   +5.850497868156578e-02   -1.327060702661673e-01   +5.897019121919336e-02   -8.184557251144084e-02; -3.000318838036918e-01   +1.346113086157230e-02   +2.898685507703159e-01   -9.256210910915331e-02   -1.530239338837429e-01   +1.390172309762331e-01   +5.583242958512472e-02   +8.737899325225751e-02; +3.764662302312344e-03   -3.437283236194371e-01   -6.467331115274343e-02   +1.054970029893543e-01   +2.808476789640428e-01   +2.791554989724618e-02   -6.494787891570970e-02   -6.669768158522453e-02; +1.824449306127872e-01   +3.326140334862772e-02   -2.289265444551766e-01   -2.374156289616154e-01   +7.626280733636664e-02   +1.614561237196496e-01   -1.086930104370919e-01   +2.393888936763625e-01; +3.717144778407713e-02   +2.069853807375688e-02   -4.088086924033488e-02   -1.303826814413500e-01   -1.025290642458300e-01   -7.165958709499790e-02   +3.184536956341880e-02   +1.091575041887595e-01; +3.238384572767602e-02   -1.373426177347407e-01   -1.132420023015392e-02   -1.050969759757429e-01   +2.332535817236887e-01   -9.352362120484264e-02   +4.285617864820325e-02   +8.470258701733119e-02; -7.201496869881439e-02   +1.610422801968074e-01   +7.186196962032963e-02   +2.249934232864182e-01   +6.260315913605098e-02   -8.208574976785254e-02   -1.350842088974702e-02   -1.713109772515292e-01; -1.972667257889626e-02   +2.545177159196568e-01   +1.814538138916925e-02   +2.180962534930226e-01   +2.131396711064401e-01   +1.391837072269973e-02   -4.381873022927148e-03   -2.214259021899117e-02; +2.313388636720007e-01   -8.535478398805481e-03   -3.477039407676760e-03   +2.256294977056277e-02   +1.986478677642715e-01   -6.032396702041007e-02   -1.482715310001220e-01   -1.819278467010808e-02; +1.703139317147549e-01   +1.553123168010651e-02   -1.718883496710461e-01   -6.583815555925893e-02   -8.338301758891575e-02   -7.794565286725899e-02   -4.674100429892894e-03   -1.618819046747893e-02; +4.068654434768877e-02   -1.573682070718063e-01   +2.035901066272558e-01   -1.650431211370886e-02   +2.086992600956624e-02   +2.558219845673781e-01   +2.212930037504718e-01   +2.749150460383576e-02];
L1I_L2I_iGABA_netcon = [-1.418264621525810e-01   -1.780135332397869e-02   -9.015526847975702e-02   +1.590679844804471e-01   -1.681570131772781e-01   -3.876481947884475e-02   -9.497195788640295e-02   -5.885945693995076e-02   +1.273585379168423e-01   -2.511584294087305e-01   +3.424852188215988e-01   -1.239597662619538e-01   +7.824352540721012e-02   +4.785001020782770e-02   -2.766932114548343e-01   -1.861478043070924e-01; -1.874751042534802e-02   -4.995205384873097e-02   +6.936738951470747e-02   +2.353363578762016e-01   -1.853551769710507e-01   +5.703121486130365e-02   +7.948128395685573e-02   +6.040225089173440e-02   +1.246392194155162e-01   -2.162736655900646e-01   -7.973805107021208e-02   +3.386848911909357e-02   +8.302288965948496e-02   +4.917034966649560e-02   -1.176950301617879e-01   +1.027177491382014e-01; -2.246895560694584e-01   -1.486955856338353e-01   +3.042943631305297e-02   +1.209950718061331e-01   +2.203159385832548e-01   -2.268135178682216e-01   -4.091817621949488e-02   +2.019468253239738e-01   -8.376569111149382e-02   +2.451371821877860e-01   -5.212053808071461e-02   -4.862236924023024e-02   -1.013540161582115e-01   +2.682241110596019e-02   +1.970971220828532e-01   -1.148802657761339e-01; -6.349500270237567e-02   +1.965128445740583e-01   -1.371488524274133e-01   -1.167743286546091e-01   +4.998165779412688e-02   -9.293966067461384e-03   +8.625336630898485e-02   +1.423166578415470e-01   +8.252467183347095e-02   +4.478768000418075e-03   +1.890157685905017e-01   +2.048789603949034e-02   +4.842187293853984e-02   +3.030258852287576e-01   +2.317469306539269e-03   -1.355824487514267e-01; +1.040736208398971e-01   -8.638535036497115e-02   +2.820226715902134e-01   -9.430651444933114e-02   -4.857695792435210e-02   -1.094397029090361e-01   +7.354710479769098e-02   -7.174853562777040e-03   +1.556734976043040e-01   +9.349126365518265e-02   +2.170459491387554e-02   +9.269884176340566e-02   +1.796714216779142e-01   -1.841784055425812e-02   +2.129754075679545e-01   +2.654611866470309e-01; +6.829718618044350e-02   +1.057510524200846e-01   +6.741388571333304e-02   +6.974666443851138e-02   -1.468302344092881e-01   -1.547909740636980e-01   +1.922639106248885e-02   +3.245129425910689e-01   +6.850434468220830e-02   -2.652565067945725e-01   -9.352400135788060e-02   -6.362852933806171e-02   +8.058119945060359e-03   +8.763749990265178e-02   +6.932601600922565e-04   -1.249785241891985e-01; +1.987310486671162e-01   -3.509810390304673e-02   -1.269020604533883e-01   +9.971060706473713e-02   -2.088688801061497e-01   +2.001686381519012e-01   +3.776774999063365e-02   -8.514566894169125e-02   -1.454248713367504e-01   -3.405036053493571e-02   +1.525757832134348e-01   -2.261483959157960e-02   -4.838567259908165e-02   -4.159601540426085e-02   +8.789650516975117e-02   -1.599740354072052e-01; -3.008899599921974e-02   +1.994735881249679e-01   +1.489312327048383e-01   -1.810221700556757e-01   -2.717887058788654e-02   -1.978615091423570e-01   -1.374658202494796e-01   -5.480480539575584e-02   -2.673071765666477e-01   +1.076405506316270e-01   -7.113616693270656e-03   -1.577571497398214e-01   +1.532647329162796e-01   +6.343053160197144e-02   -1.748507744208998e-01   +1.245853384053399e-01];
L2E_L1E_iAMPA_netcon = [+1.708878390722841e-01   -2.183135158999219e-01   -8.706761578976711e-03   +7.633197253012780e-02   -6.131957091921653e-02   -2.482325039852553e-01   +1.126121249023445e-01   -2.930930580165059e-01; +4.399101972379153e-02   -1.905911838697888e-01   -2.655425905283713e-01   +1.356423897796840e-01   +2.654292391533156e-01   +1.457403020464511e-01   -1.375773530453789e-01   -4.194167280426238e-02; +2.559432954003915e-02   +1.355913842824383e-01   -3.021031386425211e-01   -9.226871881619686e-02   -9.785776564054993e-02   -1.132715278268387e-01   -1.867227879760787e-01   -1.662413569632739e-01; +2.042357372105562e-01   -2.346627950268574e-02   +7.988827411095242e-02   -1.122638184070974e-01   +7.653499030977312e-02   -6.971757073882357e-03   -2.195861534154030e-03   +1.612775958456431e-01; +6.157751109623254e-02   -2.885715916846399e-01   +1.305103655515585e-01   +9.067068550803087e-02   +2.869197470490565e-01   -1.478479619926208e-01   +3.273915011128703e-02   -5.778913677913068e-02; -2.416119378429628e-01   +1.084027482946932e-03   -6.917887490698636e-02   +2.474332229985153e-01   +1.188368028098195e-01   +8.566963190882335e-02   +2.298392384008999e-01   +1.769598953891903e-01; +4.332559109793642e-02   -4.335304532679558e-02   -1.668125722966126e-01   -1.763796532158740e-01   +2.569222794319819e-01   +1.651729807143364e-01   -8.366148204573345e-02   +1.055246352174444e-01; +1.357573612369494e-03   +1.790730415038269e-01   +1.010564827015658e-01   -2.031884835416592e-01   -9.482402952291831e-02   -2.199002395086863e-01   -4.687399932917322e-02   +2.012002158574237e-02; -5.030663712434203e-02   -2.845036581613045e-01   +4.817046136877347e-02   +2.113466335074451e-03   +9.717290648549071e-02   -1.558610788335546e-01   -4.781109182373426e-02   +5.573444124155628e-02; +4.202612992107236e-02   +8.517813509686305e-02   -8.854682933769373e-02   +3.558581995248059e-02   -2.502090559086908e-01   +4.074325064503510e-02   -1.230773954082933e-01   -2.228327320931557e-02; -6.102494350689151e-02   +1.525537009463079e-01   +8.554377435295103e-02   -1.933657452090770e-01   +1.505971888820657e-02   +2.005123653780408e-01   +2.332737836339740e-01   +5.450218448079766e-02; -4.117717726327898e-02   -1.981394309931790e-01   -1.093484464753948e-01   -2.760732330717636e-01   -1.677024980735623e-01   +1.012062201901432e-01   +2.035416556389101e-01   +1.352566996391734e-01; +7.636126159028106e-02   +1.124725091259495e-01   -1.210978539604630e-01   +1.155497696293435e-01   +3.138035877952439e-01   +1.558456473356614e-02   +1.878442153101198e-01   -7.923210930122078e-02; +1.289983679866527e-01   -1.121288245461226e-01   -4.557351798434334e-02   +1.932717105572622e-02   -2.303510154086370e-01   -1.503223662823094e-02   -4.833849304867797e-02   +1.003939140085378e-01; -1.009705353786030e-01   -2.666211553364401e-02   -5.651816025259906e-02   +1.176830424025559e-01   -6.712670482424939e-02   -7.485769144702671e-02   -2.918238147065943e-01   +9.421589031319080e-02; -1.431347065398661e-01   +5.572420032889015e-02   +2.883280349263529e-01   +1.646607343351228e-01   -1.531263191783933e-01   -2.119538419350130e-01   +1.515725818267429e-01   -3.081468139432310e-02];
L1E_L2E_iAMPA_netcon = [+5.883461874610221e-02   -6.560555543274232e-02   -2.723964143971855e-01   -1.881061807634047e-01   -1.156016905277796e-01   -2.684249574159346e-01   -8.245381330767233e-03   -1.752069011823532e-01   +1.319757405638480e-01   -3.363765508429920e-03   +4.714265417751196e-02   +9.978467549757196e-02   +2.087545022898766e-01   +1.591777632055328e-01   +3.291271475564020e-02   +1.029277444194241e-02; +7.134253009016878e-02   +2.793793947478570e-01   -7.450463301738081e-02   -6.256337241530611e-02   +1.678611389681207e-01   +1.370451397932234e-01   +7.886696833866601e-02   +1.460573367967758e-01   +1.556286199338011e-01   -9.793953538016271e-02   -7.369195136569853e-02   +2.267513965769032e-01   +2.338920531982332e-01   -3.235497379274689e-01   +8.538984080093642e-02   -1.042625633247748e-01; -7.200363085547899e-02   +9.684640107052106e-02   -3.430264326494892e-03   +1.191092221989263e-01   +1.985401603254409e-01   +1.982860299818740e-01   +2.424842169114826e-02   +5.238839056814441e-02   -5.966012867846389e-02   +5.079555767700456e-02   +4.504260124118002e-02   +1.452291488971590e-01   -2.005269284285524e-01   -9.811285168223893e-02   +2.844997195290083e-01   -2.042846087997719e-01; +1.058589096008010e-01   -1.779358067768123e-01   -1.197783018378819e-01   -3.355518056099101e-01   +6.973370035348957e-02   -1.098965596312061e-01   +1.650081878994382e-01   -1.353884097009204e-01   -1.750575750500827e-01   -2.572025675091191e-01   -1.177013904327882e-01   +1.541531933711826e-01   +3.813272550268393e-02   +7.187096211252011e-02   +2.872497227955036e-02   -1.457608354149716e-01; +2.451246178758975e-01   +2.036601383144232e-01   -2.869162966428597e-01   +3.287775390338439e-01   +1.852000382761521e-01   +1.100545273303633e-01   -1.060324348458773e-01   +1.012839416734698e-01   +2.111062762793504e-02   +5.519380188887570e-03   +1.677950744144067e-01   +1.614141578012996e-01   -1.394171573146696e-02   +9.093402705402640e-02   -1.336673341649990e-01   +1.215794479029936e-01; -4.188393345254623e-02   +1.376109801068629e-02   -1.570833960488791e-01   -6.915574572949627e-02   -1.678183530918096e-01   +4.504702967725774e-03   +1.628801603236754e-01   +7.942924504186516e-02   -2.751209894112191e-01   +2.036483733561794e-02   -4.220664411671593e-02   +7.783048288370412e-02   -2.409226853726907e-01   -9.232570715695357e-02   +1.382319300006166e-01   +8.719594026050437e-02; +1.527621158385240e-01   -1.317618922496681e-01   -3.047982041459832e-02   -2.672488981552854e-01   +1.567282773151667e-01   +7.235125975237305e-02   -1.171324925742446e-01   -2.975637714175085e-01   +1.725112046148069e-01   -1.389209635913651e-01   -1.804159737801671e-01   +7.800274539386498e-02   +2.552207834139628e-02   +9.403029765118118e-02   +9.424859843213659e-02   +2.022791101844486e-01; -2.040528429914058e-01   +9.173260662845852e-02   +1.171242863836904e-01   -3.485247938757572e-02   +6.056995107721429e-02   -2.224820719139259e-01   +3.565153894552878e-02   -2.713447511462574e-01   +2.379551344147682e-01   -1.216733499553191e-01   +8.206506429806111e-02   +8.813889940498344e-02   -9.121087351522489e-02   -2.628797097731206e-01   +3.244840602532861e-01   -1.169008495201046e-01];
L2I_L2E_iAMPA_netcon = [-1.816587985309546e-01   +4.668487421980321e-02   -7.167316363720969e-02   -1.465436075322814e-01   -3.929910063100193e-02   +2.905413102209936e-02   -1.143675807550807e-01   -2.111789850683611e-01; +1.203566282588916e-01   +1.175005017092705e-01   +1.585555548976875e-01   -2.003241734350855e-01   -2.113603273930230e-01   +6.196385121193635e-02   +1.265109944865840e-01   +1.620826531442049e-01; +2.760755599661241e-01   +1.490268575150037e-01   -2.663567003125862e-01   +1.176977185358114e-01   -2.707741018715791e-01   -8.306348566583503e-02   +3.439583742260932e-01   -9.139378109386162e-02; +1.128959998432120e-01   -2.749424497078274e-02   -1.926576128456792e-01   +2.345296695641840e-01   -3.688776188988539e-02   +2.074698926229885e-01   -8.814928702761686e-02   -1.841870197973242e-01; -1.007885746615157e-01   -4.975485160117234e-02   -1.444496603581380e-01   +1.461546368608415e-01   +1.575479919148031e-01   -4.347683071490929e-02   +1.435277636597661e-01   +2.353751863051391e-03; -4.016877703718862e-01   -1.146015058717676e-01   -7.082870946128823e-03   +9.478018838639074e-02   +2.364516973884703e-01   -7.499364122873312e-02   +1.635825446045820e-02   -1.023809247095937e-01; -5.832407029723156e-02   -1.703782845541713e-01   +1.580875222768026e-02   +5.491216705982200e-02   -2.870551977800978e-01   -7.069069917597555e-02   -2.892538617162030e-02   +1.786488740204039e-01; -6.682711080408059e-03   +2.221473748599267e-01   -1.831404341649591e-01   +2.612568719953841e-01   -1.660492782369841e-02   +4.653410222822012e-02   -1.240877916569322e-01   +1.508469743718004e-01];
L2E_L2I_iGABA_netcon = [-1.838474610789382e-01   -4.121711305811469e-02   +1.506627983723502e-01   +4.670858766864958e-02   +5.125771791425953e-02   +1.701552673818828e-01   +1.246276769705921e-02   +2.040397679601319e-01; -2.202584886982419e-01   +1.194614384212576e-01   +1.300663335927861e-01   +1.953651123339976e-01   +1.847887543399785e-01   -6.539130137954952e-02   +2.824084734488365e-02   +1.295486865114246e-02; -7.393466061739366e-02   +2.027456427299577e-01   -2.682264294415849e-01   +9.719917464693011e-02   -1.751478920761273e-01   +1.662407549206929e-01   +1.696023695196373e-01   +7.441051713073213e-02; -9.746975800860097e-02   +3.855668495731285e-02   -2.358980688039541e-01   +4.334560894583904e-03   +1.791288902261955e-01   +2.467056562721326e-01   -3.711307340013211e-01   +1.437142973408567e-01; +2.466135428905078e-01   +2.005276748738701e-01   +1.518793610179609e-01   -1.419596549176793e-01   -1.753297843044682e-01   +1.193189211746504e-01   +2.321905826008603e-01   +4.363037409717622e-02; +1.717174939400905e-01   +8.302370700046766e-02   -1.855280499280323e-01   -8.630339255550665e-02   +1.341717475015697e-01   +6.091340343628645e-02   +2.518168676964760e-01   +1.981511204656817e-01; -1.239973026852829e-01   -2.999009185888851e-01   +1.085707302497254e-01   -4.605762922427353e-02   +1.008117139085315e-01   -1.053051313857305e-01   +1.970750004868579e-02   -2.774375566280931e-01; -4.685606334969876e-02   -6.153897243030422e-03   +8.663823801848243e-02   +2.008687361074164e-01   -1.162829795958036e-01   +1.467981960753417e-01   +3.376377623380646e-03   -2.349993460417768e-02];
L3E_L2E_iAMPA_netcon = [-7.458009437498336e-03   -4.454384999405639e-02   +1.602088814219881e-01   -7.965117498498224e-02   -1.605830598873898e-01   -2.192360134679999e-01   +1.077254333829340e-01   +1.709378085360879e-01   -7.590767127302855e-02   -1.215603071305781e-01   -8.931943989477215e-02   -1.533374820942637e-01; +1.911505044502436e-01   +6.920912689132533e-02   +2.672445176526060e-01   -1.724539749692461e-01   -1.760513141397031e-01   +2.691982570691448e-01   +7.552313201927194e-02   +9.186158507988687e-02   +8.555667366617514e-02   +2.322002755969017e-01   -1.243165988974249e-01   +1.758041602831713e-01; -4.858476504863330e-02   -6.826287799099756e-02   +9.342691806635657e-02   +3.377099421994806e-01   +7.410988628426025e-02   -1.317172616499286e-01   +1.216241776099302e-01   -9.618386636394022e-02   -1.483393140543852e-01   +1.011823019858754e-01   -1.387853044724804e-01   +2.358888923323713e-04; +2.068063240748472e-01   -1.347607116606248e-01   -3.299772461937173e-01   +2.629844084788911e-02   +4.120183314706199e-02   -2.559450398682231e-01   -2.962845011161945e-02   -1.669749914215831e-01   +2.303685002879620e-01   -1.972334645078634e-01   -2.488193528110129e-01   +1.175109653435537e-01; +2.137223504009737e-02   +1.960444883891075e-01   -8.322236885150899e-02   +9.008734351406202e-02   -1.275783840242568e-01   -7.504816544994360e-02   +9.350754476522796e-02   -6.657547467192382e-02   +1.100258982974482e-01   +2.380415670168837e-01   +2.008566048961647e-01   +1.107257506705731e-01; +2.905016328962730e-02   +1.427684137190201e-01   +5.543113507627406e-02   +1.136437697015620e-01   +6.447502324708271e-02   +4.119571822307621e-02   -6.621693052353318e-02   -2.618064638608630e-02   -9.011955185313721e-02   +1.019392738117489e-01   -2.889522632229343e-02   -2.115444367777170e-01; -1.580731411736651e-01   +1.648869814565629e-01   -7.955921830192031e-02   +3.462445562738052e-02   -2.335906134116748e-01   -9.395128833032099e-02   -3.550511963869384e-02   -1.047421815578900e-01   -9.193747697259165e-02   -8.219690473507663e-02   -5.424351403119329e-02   +1.821809889542887e-01; +1.589448880768579e-01   +4.493389700421573e-02   -3.454758095828561e-01   -1.585283438952442e-01   +1.488464235181305e-01   -1.866541970083695e-01   +8.052669367994575e-02   -2.485644926753020e-01   -6.961279910072096e-02   +9.475893471781389e-02   -3.580317353811092e-02   +1.483879780417487e-01];
L3I_L2I_iGABA_netcon = [+2.283185597101018e-01   +3.575722203999161e-02   +7.265478092991715e-02   +2.341183849237949e-02   -3.069360007350107e-01   +2.658357908659812e-02   +1.691357457145887e-01   -9.665681279492756e-02   -9.134888431873719e-02   -1.689218237730710e-01   +2.478812297225271e-01   +5.839767328248087e-02; -7.672860040742546e-02   -2.758085032416101e-01   -1.133068580975968e-02   -6.713012970698869e-02   -1.259943132020440e-01   -1.633985833552512e-01   -2.224488303823738e-01   +6.145054861375265e-02   -1.506103770966985e-01   +8.199253547133596e-02   -1.484439496757919e-01   +1.967397517251617e-01; +2.133005817523135e-01   +7.456573066757864e-02   +2.647894900043903e-02   +2.809881910540201e-01   -7.866026104593568e-02   +2.254391847051674e-01   -2.173132727071085e-01   -2.153397564167717e-01   +1.370584226384796e-01   -4.345731569311068e-02   +8.222400943740135e-02   +1.126494784872466e-01; +2.505978056615206e-01   -2.107807829574785e-01   +2.817490110852392e-02   -6.483645523031681e-02   -1.727360745219995e-01   -4.785727104558955e-02   -3.007577146521355e-01   +3.634748286992535e-02   +5.729683515137450e-02   +1.002513532058110e-01   -9.464708609635920e-02   -3.333711306760172e-01; +8.410490182465566e-02   -4.299977856165486e-02   -4.441987563449919e-02   -1.396689457449874e-01   +1.101733797220433e-01   +1.779412636257973e-02   +1.938969250775394e-01   +8.217448545562629e-02   +3.600186019890143e-01   -3.581022244266985e-02   -2.359190827140765e-01   +1.474536597409807e-01; -8.092636335761839e-02   -2.375049549377471e-01   -2.441070593261267e-03   +2.824369808101852e-02   -1.417852430763639e-01   +1.307489366142247e-01   -4.590716409203206e-02   +9.961311830255321e-02   -2.384544986435554e-01   -7.930432833205324e-02   -1.223088850014176e-01   -4.168861915658387e-02; +6.435680450197558e-02   +6.243978682020341e-02   -3.238707055957583e-03   -2.928541719241951e-02   -3.442030238803447e-02   +3.192274358599206e-02   -1.611740551906077e-01   +1.136494830817872e-01   +1.626804545167084e-01   +2.279253988313881e-01   -2.116263275174130e-01   +8.244396728763088e-02; +1.111197193889493e-01   +4.864765833995259e-02   +5.222571584387992e-02   -2.306972652330064e-02   -1.034263167268946e-01   -6.291218073617835e-02   -4.481556569359458e-03   -3.204824000503192e-02   +3.316509353554170e-02   +2.120493032844293e-01   -1.383287312040626e-01   +1.256191760363357e-01];
L2E_L3E_iAMPA_netcon = [+9.356150839683250e-02   -1.080349594159380e-01   +1.618714934765112e-01   +4.887189363442475e-02   +1.064510064675322e-01   +3.106041634402624e-01   -5.408410643578186e-02   +1.520468259682214e-01; +1.684508790706807e-01   -6.936642058567843e-02   -3.933049468265888e-02   -1.212677554915811e-01   -2.171877722073699e-01   +6.118030303014375e-02   -1.203165670458842e-01   +6.110424935646482e-02; +1.216764159062592e-01   +2.563471859713334e-01   -3.597113885788954e-02   -1.397465338309370e-01   -2.279219581794047e-01   -1.198225237714703e-01   -5.569409644444878e-02   -8.947180737359178e-02; -1.560441672372830e-01   +1.583755196090477e-01   +1.063129026627636e-01   +7.007698554268071e-02   -1.296254904917434e-01   -4.900383720322082e-02   -6.655905258928603e-02   +2.308441862679183e-01; -7.283585908999933e-02   +1.420797349416640e-01   +1.907953394683525e-02   -1.252352649419849e-01   +1.405718829834917e-01   +3.160148770193382e-02   -1.388194534836614e-01   +1.666141893804937e-01; -2.429474271108739e-01   +5.816188179243341e-02   +1.145678538103786e-01   -4.341750538125520e-02   +6.469044495254470e-02   -2.013008848765236e-01   +3.890476546143155e-03   -8.079853027221109e-02; -9.005930833142507e-02   -1.900581812433260e-01   -1.308499500570254e-01   +8.550317870387683e-02   +3.162771620103026e-01   -1.009457406076557e-01   +3.390393860370933e-01   -3.359784334511361e-01; +3.323598378545290e-01   -1.313459113103304e-01   +2.741490066712976e-02   +6.514564276188639e-02   +2.100250418521621e-01   -8.031504539454694e-02   +2.018674979691943e-01   +1.455211476438408e-01; +2.134614531414246e-01   +1.822919027914189e-02   +9.384218012445255e-03   +1.331603824614615e-01   +3.274662330265963e-01   -6.821028680030362e-02   -8.409447727119877e-02   -3.027698953336705e-01; +6.561654040114806e-02   +1.102338763274056e-01   -3.751451773020766e-02   +1.512705036885668e-01   -1.950477694403207e-01   -5.298327403940498e-02   -2.047796311554341e-02   +1.882373602398882e-01; -8.329355495042391e-02   -1.724282568021684e-01   -2.194104026623830e-01   +1.201045864818827e-01   -1.782084385948820e-01   +1.344693072307101e-02   +5.322899213871612e-02   -1.147136774827499e-01; -1.382365190085368e-01   -5.394062872271142e-02   -6.775909071838261e-02   +2.696730702430163e-02   +9.115156178946708e-02   -1.027183651995630e-01   +9.210066950410382e-03   +3.105985678405821e-01];
L2I_L3I_iGABA_netcon = [-2.046132178188903e-01   +1.297955112938520e-02   +3.108182770697905e-02   +3.310651223756317e-01   +1.492540261292258e-01   -1.593173991452511e-01   -1.914303921979370e-01   +2.139628215729230e-02; -1.616401869374802e-01   +1.029125184624820e-01   +6.838791579760226e-02   -1.127141456412413e-01   +1.091967537882687e-01   -9.233890819007598e-02   -7.519692181088539e-02   -2.162535175881979e-01; +2.022751415854496e-01   -1.025518962130240e-01   -1.749089284159464e-01   +1.206212957124403e-01   +3.110447748021718e-02   +8.392130320456638e-02   +1.996938116082460e-01   -4.625740756365315e-02; +5.370446783835136e-02   -1.322003095409994e-01   +2.910210372836104e-02   +1.976291269708222e-01   -1.103428880708918e-01   +1.523507393415332e-01   -1.849349936678736e-01   +1.523369086582716e-01; -1.047598510012891e-01   +9.406010502133756e-02   +5.468384726702756e-02   -3.638661201999088e-02   -8.265293730286025e-02   +8.140397533736160e-02   -6.881312790894324e-02   +3.633465583147125e-02; +1.319311567409051e-02   +1.142567662944899e-01   -5.530914580218763e-02   -1.687354431517311e-01   -1.577777775315735e-01   -1.455359473419794e-01   -2.069827034742804e-01   -1.431904853244316e-01; -1.487555586980454e-01   +1.658316335245322e-01   -1.057528876580104e-01   +7.260428531655030e-02   +2.544954765144417e-01   +4.437351302620328e-02   -5.734005925663693e-02   -1.443244021640036e-01; +1.175597501291566e-01   +1.953496216109823e-01   +2.096788765958623e-02   +1.953519579309355e-01   +1.500727369536623e-01   +1.955606678665456e-01   +1.070045217600530e-01   +2.604556431735933e-03; -9.093473518820752e-02   -2.341207746208668e-01   -1.900315952299462e-01   +7.306365344419266e-02   -8.795262111341196e-02   +2.536602171092135e-01   -1.633566392670656e-01   +2.308099006990790e-01; +1.695103597311348e-01   -5.566680166279696e-03   +1.501752513984783e-01   -9.441212598812908e-02   +1.684245710117748e-01   +1.545710722983692e-01   +3.934306636606808e-03   +2.329868154604380e-01; +1.008685796225483e-01   +1.016917148981096e-01   +1.003714749342902e-01   +4.043663816012659e-02   -1.070222502630340e-01   +1.450685123021372e-01   +1.721965446319148e-01   +9.203020592766510e-02; -1.941714778506264e-01   -7.086882794229102e-02   +1.036529077116900e-02   -1.382516979912853e-01   +1.154438990288600e-01   -5.702787109717483e-02   +3.400508099306960e-01   -2.001657156087608e-02];
L3I_L3E_iAMPA_netcon = [+2.198879514385987e-01   +1.789456106357898e-02   -1.737177094930211e-01   +1.638828691611051e-01   -1.512929943208034e-01   +6.563723017627829e-02   +4.692410114230213e-03   +1.594999906224426e-01   -1.145393994313014e-01   -1.058794878042691e-01   +2.493210439652035e-02   -1.955904619899284e-01; -1.332688255982971e-01   -1.459255134733920e-01   -8.500145585689407e-02   -1.118138476416011e-01   -2.738121430871186e-01   -1.175788585103699e-01   +7.042531060223070e-02   -3.266659109661778e-04   +4.746774673038100e-02   -1.776482637081689e-01   +2.292031719167554e-01   -1.744844035314206e-02; +2.243657712026449e-01   +1.450903057951704e-01   -1.195799095602662e-03   +9.185920545289944e-04   +1.480872550851138e-01   +2.783527195624263e-02   +1.630702775440288e-01   +3.773159162741234e-01   +8.514937609542378e-02   -2.058128641734741e-01   +8.418699110965715e-02   +1.238410474483020e-01; +1.680293328328042e-01   +1.436057661355997e-01   +1.919898891039614e-01   -4.958248392129165e-02   -2.976188170823468e-02   +1.278376674364067e-02   -5.326545572170267e-02   +3.572130937228683e-02   -1.465808074990870e-01   -2.050989698285877e-01   +3.484234629147648e-02   +2.297455677275624e-01; -2.662802839138787e-02   +3.170104996394877e-02   -2.797507485693001e-01   +5.673087169886899e-02   -6.379792966736078e-02   -3.961065112946856e-02   -3.965269528218986e-02   +7.781557216363902e-02   -2.428576457235407e-02   -3.124236249835559e-02   -3.320895975983976e-01   -2.238102879073992e-01; -2.187878985215545e-02   +7.081146020092570e-02   +8.458881343143712e-02   +7.236975545490926e-02   -1.582500316853300e-01   +2.282127521790487e-01   -1.514265949794182e-02   +2.400782158402987e-02   -3.202413047815788e-01   -4.896609244082380e-02   +1.408636912260404e-01   +1.729543438798666e-01; +7.614419944027082e-02   +1.455060471544211e-01   +7.656448661387313e-02   -1.956789235251003e-01   -1.427941332477066e-01   +4.826873095774175e-02   -7.775709194343194e-02   +1.280999396053840e-01   +1.028578592278722e-01   -3.075275847970820e-01   -1.496080434981817e-02   -3.946042221179151e-01; +6.523928447476071e-02   -1.251476733035463e-01   +6.011035043888346e-02   +2.570494309723319e-01   -9.190143501907565e-02   -3.601594168645565e-02   -2.620149158105411e-01   -1.936931760483113e-01   +3.561312420302465e-01   +1.628333748569433e-01   -3.825343671826466e-02   -2.215321777430949e-01; +6.802432904135083e-02   -6.662256165726813e-02   +1.409308029332090e-02   -5.250855793991072e-02   -2.881899789678701e-02   +8.818475361968235e-02   -1.113078574507325e-01   +8.841176275355456e-02   -7.047482604268775e-02   +1.052148095625532e-01   +7.885815203660428e-02   +4.028167296077285e-02; +7.297684973813721e-02   -2.061194120801307e-01   -1.299274553540884e-02   +7.104628189432305e-02   +3.169999966567216e-01   +1.173290932609640e-01   -3.884453343783333e-01   -1.726918854398612e-02   +2.327923059487636e-03   -8.216709154370040e-04   -1.128747034599508e-01   +3.274798354812207e-01; -2.989290916536515e-04   -2.570056256171817e-01   -2.541053466343832e-01   -1.045344947639742e-01   -1.191845501423905e-01   +8.754261210178520e-02   +1.984761352785018e-01   +2.292514903915885e-01   +7.981618134598904e-03   +1.022286645816756e-01   +2.139402072911853e-01   -8.481019979593239e-02; -1.548534040030629e-01   +1.248639489167048e-01   -3.108273342780368e-02   +2.461584487300963e-01   -1.728744487512260e-01   +1.053316479452911e-01   +7.355113328089045e-03   -3.015552913923751e-02   +3.568450390508745e-01   +2.226787845026550e-02   -2.678708793088710e-02   +4.018396784832818e-02];
L3E_L3I_iGABA_netcon = [+1.208659906771146e-02   -7.464402218324842e-02   -2.576360288500709e-02   -1.744156753583303e-01   -1.273421876292044e-01   -2.456962682751286e-01   -1.263080678518359e-01   -1.593643931374171e-01   -5.688260974487672e-02   -2.301478702094254e-01   +2.449293102118355e-01   -1.150638677946471e-01; -1.192733161525252e-01   +3.640809397285888e-03   +5.697976869165670e-02   -2.165715435051499e-02   +2.077172460538694e-02   -1.126621238282169e-01   -1.271132742468312e-01   -1.323942270343797e-01   -1.220509662740143e-01   -2.879986841079374e-01   +1.832531425428203e-01   -3.001725633192245e-01; +4.643102507808523e-02   +1.013106704440151e-01   +1.003017745149478e-01   -2.541484250777858e-01   +1.108359697606588e-01   +2.837488695534660e-01   -5.356334779953374e-02   -2.454375292916597e-01   -2.480886845366028e-01   -1.805216969449621e-01   +3.125380089565815e-01   -8.064399883564637e-02; +3.544985966017802e-01   -9.872905415211640e-02   +3.076159911731419e-01   +3.533492491401749e-02   -3.585734932669014e-02   +1.207878309306288e-02   -1.971591084769720e-02   +8.968071455680852e-03   -1.149286688373250e-01   -5.175517039458350e-02   -1.349336141755438e-01   -1.119472512042457e-01; -2.429193966068042e-01   +3.435039737039063e-03   -8.962993369658920e-02   +4.510179837606100e-02   +1.058935592554825e-01   -7.492608540999755e-02   -1.023232773138277e-01   +1.364881320388279e-01   +2.866506232092773e-01   -1.330821994164912e-02   +1.741699822691742e-01   -4.012084633376280e-02; -8.740721747208378e-02   +2.150761643490822e-01   -2.335217582816725e-01   +2.077501515926714e-01   +5.223599388474782e-02   +3.105953246845244e-01   -1.290310921978763e-01   +2.035566043147103e-01   -8.813429955491153e-02   -1.081697305432495e-01   -3.245413730873839e-02   -7.896113369785478e-02; +1.062731841920824e-01   +2.529654336863459e-02   +2.673557870655419e-01   +7.249136273399029e-02   -8.786807006363540e-02   -3.058019121271110e-01   -1.584412700628299e-01   -9.285726674316204e-02   -2.916302090047611e-01   -2.070206765336318e-02   -1.356043666733808e-01   -3.286838093514131e-02; +3.448219476284761e-02   +9.952162847547026e-02   +6.516776732258076e-03   +1.264671000442647e-01   +7.028563196569734e-02   +5.654923741533148e-02   -1.346645838760544e-02   +9.151984550457472e-02   +7.896339687160783e-02   -2.706982424614854e-02   +2.443415562504391e-01   -3.309575935589326e-02; -2.912473976957269e-02   +3.663115521598312e-02   -1.966549812689475e-01   -2.743971261964032e-01   -6.827237311344962e-02   +1.931058908751452e-01   +2.988533307964952e-01   -1.844750456414871e-01   +8.123509625107991e-02   +2.698231628209278e-02   -1.908509630897775e-01   +2.555387876435025e-02; +3.198141256730969e-01   +1.048295930380672e-01   +8.898449301848613e-02   -3.479174187967336e-02   -2.329439150304997e-01   -1.442361484012920e-01   -1.502287031322759e-02   +1.950555889088433e-01   +5.098913616210330e-02   -4.490725199352199e-03   +7.365336370709526e-02   -6.845305004193267e-02; +1.016524269865322e-01   +4.635124536848001e-03   -1.795658474522131e-01   -4.153651383991289e-02   -5.238836670965804e-03   -1.449158865442636e-01   +1.644704825498270e-01   -1.266492084807646e-01   -2.252530243554476e-01   +2.193780778026075e-01   +3.892268516032114e-02   -2.073096655316981e-01; +1.259732131500678e-01   -2.457946833459376e-01   -1.004467919164214e-02   +1.365993988350836e-01   +1.975715337731607e-02   +2.077015458990910e-01   -2.570303338834002e-01   +1.929869574816701e-01   +3.030845367791065e-01   -2.297270695772959e-01   +2.193255380659139e-01   +2.477417878575718e-01];
L2E_Input1_iAMPA_netcon = [+6.363827384055326e-02   +5.781521305389626e-02   -3.911793430027648e-02   -1.302761329536686e-01   -2.284214255244073e-01   +2.202401841708463e-01   -3.090763564175409e-01   +4.732173437458514e-02];
L2I_Input2_iAMPA_netcon = [+8.333231849996810e-02   -9.897591801802375e-02   -6.076255134375976e-02   +1.703257206102327e-01   +7.735380642948759e-03   +1.614495651821111e-03   -3.124680575441230e-01   +2.316816570024888e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.04*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.9*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.1*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.9*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.1*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.9*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.04*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.9*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.1*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.9*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.1*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.9*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
