function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+1.913854136523356e-01   -1.124416969227709e-01   +7.926219941853125e-01   +2.298696583571363e-01   +2.263907471161298e-01   +6.435345960428799e-01   -4.229763171192032e-01   +4.770169336335658e-01   +3.837902434780859e-01   +9.499764468284013e-01   +2.786523997897487e-01   +7.596654284680765e-02   +3.941096014591716e-01   +3.772713203900245e-01   -9.167431341636031e-02   +1.314985664341173e-01; +8.461863104457323e-02   +2.494604100775431e-01   +4.742757483910996e-02   +9.405718824014242e-01   +1.340134357172281e-01   +1.607932788309825e-01   -1.272383489081870e-01   +5.217894283901655e-01   +6.036169208925546e-01   +4.640551404867989e-01   +7.166478714979831e-01   +5.464197271775496e-01   +3.050685765158780e-01   +5.794293684853101e-01   +2.210246799232469e-01   +8.540875021627753e-02; +8.708036361862816e-01   +1.487669501094651e-01   +6.288273111773156e-02   +8.413805116565172e-02   +2.325306746271947e-01   +1.283339165460196e-01   +8.095400987597451e-01   +4.348773853335706e-01   +3.836669603141362e-01   +5.718947898573846e-01   +4.612878754316245e-01   -9.678606827117600e-02   +1.573895156024135e-01   -1.901381514152971e-01   +2.759924246897013e-01   +2.625450811683726e-01; +4.721498219457318e-01   -1.498971222533492e-01   +1.078001553068863e-01   +3.777505705487322e-01   +8.686663694477424e-02   +7.164296993764284e-02   +8.877736215651465e-01   +7.756900691606755e-01   +4.827288019885491e-01   +9.039193114728120e-02   +4.650746129866789e-01   +6.489167382961388e-01   +3.585357454822644e-01   +4.062675406671260e-01   +2.074800609721294e-01   +5.203687233518833e-01; +7.412875078083281e-01   -3.690425983885096e-02   +7.392113128586195e-01   +8.416354058310920e-01   +1.376373522740879e-01   +4.227083831641056e-01   -7.939738137932845e-02   +6.219717229696003e-01   +2.876994305215722e-01   +5.486969726242602e-01   +6.513826394195886e-01   +6.553499967157710e-02   +2.916301103941332e-01   +3.815231447533421e-01   +4.661428795681426e-01   +2.213507688710508e-01; -3.991420027805773e-02   +6.290098213639324e-01   +3.740565482223681e-01   +1.597481382064694e-01   +9.088730318050935e-01   +2.356382065884092e-01   +9.052549085796840e-01   +2.379068757974581e-01   +2.954678409482712e-01   +2.509264694389104e-01   +5.905063191547122e-01   +1.278035004310025e-01   +5.710689785612666e-01   +3.520783872933418e-01   +1.231152244920800e-01   +3.512728579638915e-02; +5.605648133865807e-01   +4.748417683060276e-01   +4.649181156409332e-01   +1.164815659720293e-01   +3.218678714922239e-01   +3.276486993761307e-01   +1.155782853844166e-01   +1.291626215326296e-01   +6.597652390010611e-01   +4.164226340482275e-01   +1.707595910182149e-01   +3.187829398694316e-01   +1.896540211611580e-01   +4.251711009911047e-01   +5.699108064826742e-01   +4.469562931169853e-01; +3.547606643242791e-01   +5.100423452961442e-01   -7.974474034234796e-03   +8.413200862241356e-01   -5.424790752685059e-02   -1.127345972653587e-01   +5.403802887883411e-01   +4.948167168836671e-01   +6.667200477575727e-01   +5.105137131147761e-01   +2.977889494853757e-01   +5.448664007988728e-01   +1.663998446564012e-01   +1.226809696349925e-01   +5.798995413757182e-01   +5.852333952385523e-01; -8.628898339227037e-02   +7.077359906854129e-01   +5.137492600688966e-03   +3.939188789229548e-01   +2.254432692407066e-01   +5.281397143928090e-01   +4.757737171351978e-01   -4.617209858890446e-02   +1.889204932804908e-01   +4.389172758345602e-01   +8.257193195423388e-01   -2.821582899819204e-01   +4.765296792803788e-01   +4.153152114595723e-01   -2.559245419137586e-02   -7.690186844233976e-02; +1.290246299459556e-01   +2.356069341711610e-01   +5.949795355510584e-01   +5.010146406161515e-01   +6.868612720388311e-01   +3.488034980923821e-01   +5.749018972631577e-01   +5.302263582243426e-01   -1.194548724283031e-02   +1.682913324247489e-01   +2.095625279047886e-01   +4.011873777121360e-01   +8.257332017966076e-01   +5.026238621583004e-02   +3.438413830093457e-01   +6.271578547349856e-01; -6.721554188168222e-02   +7.083419479276880e-01   +3.627394916006412e-01   +2.542577362809622e-01   +7.245660152538944e-01   +7.085102980802852e-01   +6.123668973238371e-01   +6.852880475061653e-02   +4.775972171917863e-01   +5.745114698057299e-01   +3.371193435008177e-01   +3.959573464201480e-01   +1.301352101038492e-01   +5.884267711653638e-01   +5.996276060014800e-01   +4.008367178470443e-01; +6.007803985420297e-01   -5.133824351622365e-03   +1.183372952893514e-01   +1.338087200666952e-01   +3.294887903866759e-01   +7.332501623640515e-01   +1.134969662162441e-01   +3.707620229754385e-01   +1.000000000000000e+00   -4.211025170320584e-01   +1.104779216692068e-01   +4.539590535689406e-01   +8.768761690691386e-02   +3.828906200190335e-01   +1.121239501471138e-01   +4.651938072934331e-01; -3.244575617509573e-01   +3.655745383853211e-01   +6.159322976966310e-01   +6.108429414619533e-01   +8.649532031017452e-01   +6.060223251098544e-01   +2.873031095764929e-01   +5.001064800621097e-01   +9.327980901153270e-01   +5.619132085992807e-01   +2.339107064586727e-01   +5.180711765889627e-02   -1.333620086818289e-01   +2.739512382257234e-01   +2.609700725857501e-01   +1.792593624130634e-01; +4.312367423738343e-01   +4.726494327931159e-01   +5.250237400195360e-01   +1.255670963725999e-02   +2.194299368080769e-01   +6.488878552469768e-01   +2.774107121260478e-01   +4.279490225145207e-01   -4.873745511650107e-02   +1.326177933417672e-01   +6.494014822961957e-01   +6.279091193902436e-01   +6.795383463366047e-01   +2.054826511280903e-01   +3.775720762453859e-01   +1.414933338207252e-01; +6.053998496702733e-01   +4.010884232292787e-04   +5.492054813348267e-01   +7.768345442166363e-01   -2.619864601046876e-02   +2.260767766041643e-01   +5.602667745421276e-01   +7.074811099035481e-02   +5.217620271722108e-02   +1.114374030870411e-01   +2.842537361487738e-01   +4.401550346609198e-01   +6.008875869846010e-01   +3.555456241869084e-01   +4.211359838135356e-01   -1.392831257802710e-01; -1.454612106565999e-01   +3.314195987062041e-01   +5.770732325450251e-01   +6.462203762556258e-01   +8.956077188810148e-01   +5.904990456494129e-01   -1.129384290117614e-01   +8.818294587836278e-01   -1.226595638112163e-01   +5.890688324250909e-01   +4.604031292100768e-01   +3.938129403236036e-01   +2.137074858797026e-01   +7.202112350804477e-01   +7.752841010741656e-01   +4.631774453524224e-02];
L1E_L1I_iGABA_netcon = [+4.602638558661677e-01   +4.832967946868372e-01   +1.481676174624052e-01   +3.029947948849353e-01   +3.296395989604879e-01   -6.909051361958263e-02   +2.856596378393606e-01   +2.855454952739744e-01   +2.706742579151132e-01   -7.759269139463695e-02   +2.982520553979786e-01   +1.300976414034255e-01   +5.309715710101208e-01   -7.195222777372937e-02   -3.285932248004289e-01   +9.879707439661635e-01; -5.132933236063836e-02   +3.565952032338267e-02   +4.135367525607296e-01   -2.299263676025232e-02   +2.500480065183077e-01   +4.694587825722414e-01   +3.967082919493485e-01   +2.075186703820124e-01   +4.201908289206733e-01   +1.171553916491992e-02   +4.079060710461064e-01   -5.657845137909671e-02   +7.715277662941570e-01   +2.911313276157710e-01   -8.791643693288378e-02   -2.482442505988346e-01; +8.811799705758414e-02   +2.841879506996974e-01   +2.307518921574881e-01   +3.835623099086004e-01   +2.794940680586021e-01   +8.235054730435745e-02   +1.890569265856900e-01   -1.412918576328850e-01   +1.400725083535592e-01   +7.929420950404811e-01   +4.434551679618067e-01   +1.509201392995028e-01   +2.831361274443407e-01   -2.056870848534822e-01   +3.288202396899536e-01   +5.626816787127579e-01; +5.328031699439935e-01   +1.736458031827602e-01   -1.149189215850305e-02   +3.041261338722916e-01   -2.604261093911934e-02   -4.791886375054485e-02   +1.479895837472162e-01   -2.556877193948321e-02   +2.107497080671635e-01   +2.244845111019400e-01   -9.379127657458783e-03   +6.198389777144574e-01   -5.788591188122427e-02   +4.228215612634034e-01   +2.730950778074782e-01   +5.092789582042366e-02; +2.052830270345199e-01   +4.285689039983185e-01   +8.027346934967886e-02   +2.089325220496326e-01   +6.252172145268248e-01   -1.836374070192096e-01   +1.227935905194295e-01   +3.134062978538397e-02   +4.149017466934182e-01   +1.884753787897340e-01   +1.553827378480181e-01   +2.919169288675616e-01   +2.064674434681377e-01   -2.964244055341913e-01   +2.413753606410559e-02   +3.737512605057488e-01; -1.451870684571296e-02   +1.556630029091270e-01   +4.218572297088438e-01   +2.796099938595260e-01   +3.374265980985782e-01   +2.511710864555953e-01   +2.116088154664182e-01   +1.847004796659012e-02   +2.844728017914557e-01   +6.729665023204373e-02   +2.163715503741631e-01   +5.165307958705982e-01   +1.280475085065572e-01   -1.800905787298524e-01   +4.638445516895719e-01   +4.644000692854782e-01; +2.215456427173246e-01   +1.196919482130694e-01   -4.889996619798585e-03   +8.449104848146179e-02   +1.869439642983379e-02   +2.816110662521478e-01   -1.293095428653306e-02   +1.308195290312369e-01   +1.686994477146711e-01   -5.832341259337442e-02   +2.783576139028284e-01   +2.146702155005401e-01   +3.546188795420296e-01   -1.465311958694412e-01   +2.812504582078681e-01   +2.388163964079560e-01; +2.867938387584519e-01   +5.611202528640262e-01   -5.247998015135581e-02   +5.191975871759079e-01   +1.490359648323138e-01   -8.895898252591085e-02   +2.141036680653885e-01   +3.686159116237149e-02   +7.711937339067300e-01   +7.180422188189829e-02   +2.984939240014782e-01   -7.243421687758356e-02   +3.295760906312051e-01   +3.795986727098212e-01   +3.999961257000031e-02   +3.390954650023251e-01; +4.799487976790920e-01   +2.429718229511230e-01   +3.283686441296414e-01   +1.460731428969228e-01   +5.586649275596289e-02   +4.979569673522989e-01   +2.278867057628950e-01   +1.686940673278557e-01   +3.214523826193476e-01   +3.352614064984814e-01   +2.436124955593616e-01   +4.870607498584018e-01   -6.058445503145034e-02   -5.157679217690560e-02   +5.634695586225623e-01   +3.399806668858941e-01; +6.730203137688076e-02   +4.523863060367597e-01   -9.156834591718920e-02   +3.191017170975459e-01   +1.469460245729097e-01   +5.405131454105625e-01   +2.972282305710877e-01   +1.554929118492002e-01   +5.145624802456981e-01   -1.104129596709594e-01   -2.160127532915825e-02   +4.989496077563228e-01   +3.753985440132411e-01   +5.424159460829548e-01   +1.099115155117492e-01   +6.468318745525241e-01; +2.160333946168841e-01   +3.314098056938629e-02   +2.355707506069207e-01   +2.568745563653291e-01   +3.282571242904424e-01   +3.439470018429912e-01   +3.762428157544531e-01   +7.229236010782279e-02   +4.946745490168407e-01   +2.064842919548779e-01   +4.422647857803885e-02   +4.205145457440734e-01   +3.434916287796799e-01   +6.791064965678018e-02   +1.591749914731246e-01   +1.089231594273728e-01; +4.924194907179247e-01   +2.840682238169709e-01   +8.233227050506139e-02   -1.537535629508269e-01   +1.032830699689243e-01   +1.512841914149422e-01   +3.251121492991418e-01   +4.504708104193037e-01   -2.085795360940786e-01   +1.400773621094756e-01   +4.348498460263058e-01   +7.040713829047368e-01   -1.750629335727329e-01   +5.544195347455414e-02   +2.457365795682748e-01   +2.887884188586475e-01; +3.986617552074255e-01   +4.335328055216305e-01   +1.030004069490097e-02   +5.732403851973871e-01   +5.296784689315470e-02   +1.836544449658835e-01   +1.669443950151510e-01   +3.050979741621040e-01   +2.413578802682321e-01   -5.091046947855003e-02   +4.124120684396704e-01   +1.763019679064373e-01   +5.763527759063993e-02   +2.428973138064059e-01   +5.944434065028503e-01   +6.840162894814839e-02; +5.094042453917856e-01   +3.640748940850189e-01   +1.885746974825240e-01   +3.314075691923434e-01   +1.666212044363323e-01   +3.527126101167447e-01   +3.639301607447448e-01   +2.609924691828017e-01   +3.989636933561564e-01   +1.107161984409229e-01   +3.178946304320160e-01   -6.106552131366899e-02   +1.772040948033262e-01   -1.661493221379473e-01   +1.813111903274056e-01   +2.579838936631450e-01; +6.277729716660793e-01   +1.479769718762039e-02   +2.918523309494284e-01   +2.434661464036579e-01   -1.714449427852663e-01   +1.254214404236673e-01   +1.859268114814886e-01   +2.997379368111913e-01   +1.554050991506113e-01   +2.655269365967107e-01   +5.768840615131543e-01   +3.118187513726657e-01   +1.128907756497264e-02   -3.960841564755390e-02   +3.327415115533811e-01   +2.408477300089034e-01; +2.854614033516232e-01   +4.103560174893182e-02   +5.131661483732417e-01   +6.844127625574163e-02   +4.400068007143648e-01   +3.963647730323528e-01   +3.029434351272320e-01   +1.954628555659672e-01   -5.081683936484924e-02   +3.746616868069609e-01   +1.754502975606072e-01   +4.784575688785849e-01   +4.378621911740581e-01   +2.069365671353752e-01   +1.126190252690441e-01   +3.374344921344772e-01];
L2I_L1I_iGABA_netcon = [+4.585218739488041e-01   +1.817850861505371e-01   +3.226716250891798e-01   +3.335733138151549e-01   +1.010173321539709e-02   +4.002638974413823e-02   +8.700231446980535e-04   +2.226781069392738e-01; +4.203682709688544e-01   +9.383951856380859e-01   +2.437909076467453e-01   +3.908812116387523e-01   +5.131601775641849e-01   +4.082542581584069e-01   +6.553862724412306e-01   -1.485101086350096e-01; +3.788534284720115e-01   +2.544224755583724e-01   +6.748099238126688e-01   +1.624117707123257e-01   +6.002404307881005e-01   +1.154780511341504e-01   +1.162955681341714e-01   -3.489293415648991e-01; +6.301575960526001e-01   +3.390113494965305e-01   +1.865349491977350e-01   -4.679660134112893e-03   +9.283281662961522e-01   +3.220195051944147e-01   +5.239713265352030e-01   +6.035461609421665e-01; -1.404945483096546e-02   +6.792049840883090e-01   +5.207458133273272e-01   +2.907407331608622e-01   +5.434213597659000e-01   -8.069592026537717e-02   +5.420046627043090e-01   +2.813296445088145e-01; +4.929015421461628e-01   +1.126154407076380e-01   +5.248242101948630e-01   +4.448462013576372e-01   +3.929588902323619e-01   +7.323849084131332e-01   +4.768507569362743e-01   +6.486457357110958e-01; +7.444971870910312e-01   +7.953662349101872e-01   +6.351014520876455e-01   -4.688909473265018e-02   +4.969876393752181e-01   +9.545496596453928e-02   +5.758183391872360e-01   +1.538590069605295e-01; +3.036944453817511e-01   +3.957331499567396e-01   +5.723551857472735e-01   +4.441634891381781e-03   +1.043814146853905e-01   +1.251244951795046e-01   +4.056133214990004e-01   +2.338608220818225e-01; +7.073816989837156e-01   +1.000000000000000e+00   +4.277949055907675e-02   +7.253989800410181e-01   -3.428715907615196e-01   +2.372864945939257e-01   +3.360189708332204e-01   +3.756767098431081e-01; -2.731192383876827e-01   -1.179225789810637e-01   +2.179340870429097e-01   +6.610025927972519e-01   +7.849815961179918e-01   -5.155868355951568e-02   +1.647622159095509e-01   +7.530642787840939e-01; +2.677048933643246e-01   +3.414519256182522e-01   +6.357022251941354e-01   +6.788638449017638e-01   +2.983124246031431e-01   -4.770070230553652e-02   +3.442873310236433e-01   +7.282182509699317e-02; +2.608167958342260e-01   +6.316868666673737e-01   +4.536288497635388e-01   +3.823750097979999e-01   +2.009557719526206e-02   +4.099890116118226e-01   +2.336000014750721e-01   +2.888296272760877e-01; +1.939496639532974e-01   +5.544929013656863e-01   +8.200569224710624e-01   -2.474865506116771e-01   -6.512195478158771e-02   -6.753887561796035e-02   -6.400885301212428e-02   -5.702508256913810e-02; +1.467980374927377e-01   +2.391433651556424e-01   +2.629228009639975e-02   -3.305553112305552e-01   +4.799393899900062e-01   +2.271015945677048e-01   +5.265848673195604e-01   -2.730167928780684e-02; +9.038121599120085e-01   +6.539986649893597e-01   +7.025631320450593e-01   +7.227638260142595e-01   +5.546434973037099e-01   +8.497958843288420e-01   +4.332794668909030e-01   +7.887743348204840e-01; -9.287143984075413e-02   +1.531882899962287e-01   +8.378052637847073e-01   +9.146896878729649e-02   +1.716586869993693e-01   +4.103217262444870e-02   +4.078626435982488e-01   +6.839304978928616e-01];
L1I_L2I_iGABA_netcon = [+3.617699550891904e-01   +6.405132913034169e-01   -2.145222477146180e-02   +7.751094249493750e-01   +3.162559543793140e-01   +1.447988510880847e-01   +6.334361551531122e-01   +4.126024451393618e-01   -3.597927273762918e-01   +6.889202703790316e-01   +3.263410780704991e-01   +3.817919340158370e-02   +3.810954592823952e-01   +2.503162809384251e-01   +2.058842061067027e-01   +3.671290248334137e-01; +8.522772054150732e-02   +3.811573946017056e-01   +6.233280010632795e-02   +2.629743684754339e-01   -2.751380518205531e-01   +4.935917551841035e-01   +7.702777436918398e-01   +5.129490237256912e-02   +5.168861265463921e-01   +4.196464348414107e-01   +3.390579980227117e-01   -4.989984093364958e-02   +2.584408666172557e-01   -1.728300425264687e-01   +6.397490296666981e-02   +5.813671810695001e-01; +2.238210613945796e-01   +2.496303338213530e-01   +4.388742491560303e-01   +2.849151407647626e-01   +2.982157438814895e-01   +4.360785155772025e-01   +3.269680344404243e-01   +6.088062783395538e-01   +8.595112250814974e-02   +2.531793217250679e-01   +1.026278613923835e-01   +3.815091473983280e-01   +4.355300117932778e-01   +4.402319348776481e-01   +4.339096903950915e-01   -1.976182977664398e-02; +2.658025103850801e-01   +3.158844045461294e-01   +1.246166133732695e-01   +1.288366431627563e-01   +6.182693279983118e-01   +2.113133052227694e-01   +5.297604919932981e-01   +6.045968257616388e-01   +6.676347828393935e-02   +4.284332260847711e-01   +1.085799185377133e-01   +1.860725219837873e-01   +5.431870945715784e-01   +1.373889714116143e-01   +3.613867187767243e-01   +9.245943286039722e-02; +2.425685788166160e-01   +1.293012100689009e-01   +3.770319929669320e-01   +3.895468530823583e-01   +3.613998417918519e-01   +8.716205547688926e-01   +5.568617752583578e-01   -5.665198956296686e-02   +4.206646329698850e-01   +1.749005794166066e-01   -1.211829534823566e-02   +9.699792997220508e-02   -1.297535158182433e-01   +3.150044173971365e-01   +4.703938772557819e-01   +7.456509660811774e-01; +2.599493062857713e-01   +4.808200666010308e-01   +1.831384590933202e-01   +8.600694605664496e-01   +3.445706606293384e-01   +5.036767569121746e-01   +4.911731080472954e-01   +2.387984890143313e-01   -1.182205650805584e-02   -1.842143584808853e-01   +3.762739220492798e-01   +1.469152663205164e-01   +4.569322486563888e-01   +5.080831274190931e-01   +3.120228919750739e-01   +2.229770372922264e-01; +5.258799321092270e-01   +6.762277846806901e-01   +2.664393445089986e-01   +4.019070535823263e-01   +4.319355175398062e-01   -7.119759090914450e-02   +6.200312512361923e-01   +4.621957456643071e-02   +1.061431427334895e-01   +5.550667920092929e-01   +3.019374185527122e-01   +2.730491715891212e-01   +7.428343811199332e-02   +2.430190728201488e-01   +1.884735682925419e-01   +5.707266202908737e-01; +4.983959171773805e-01   +3.547884901201397e-01   +1.539869765156659e-01   +3.836501824249727e-01   +3.637871933770703e-01   +6.240328874547388e-01   +3.677966594685662e-01   +1.229003997023899e-01   -1.126874156022200e-01   +2.239587635091309e-01   +7.046160726615385e-01   +4.538060134087114e-01   +5.698778771551180e-01   -1.051367023136770e-01   +3.784641654359553e-01   +9.683457143315331e-02];
L2E_L1E_iAMPA_netcon = [+4.076033388055298e-01   +1.989547372553549e-01   -9.588866533780016e-02   +4.882070198395698e-01   +5.879674277588978e-01   +2.840350060874614e-01   +3.574317908536805e-01   +3.058805069647933e-01; -1.651703486656110e-02   +3.646888808178667e-01   +7.462579196857724e-02   +1.392559334460957e-01   +2.975476304867486e-01   -1.893541216809594e-01   +2.992770777714293e-01   +5.823526810709159e-01; +1.634138903736203e-01   +6.689267225579864e-01   +4.554251499848767e-01   +1.511696068427466e-01   -5.967439115950172e-02   +5.301096382106106e-01   +4.354187845914884e-01   +3.683272535030596e-01; +5.023403185199735e-01   +9.300446490946764e-02   -4.327616676147085e-02   +6.161824743545089e-01   +1.826558089860734e-01   +7.977175899296021e-02   +1.860087478093752e-01   +3.335585352256765e-01; +2.273836215843728e-02   +3.798492921740427e-01   +3.048310880565842e-01   +1.247506834278047e-01   +6.483461822968219e-01   +3.811486484513475e-01   +8.324895269179902e-01   +7.429970306590788e-01; +4.062209819170398e-01   -1.672139282131612e-01   +7.020538384580712e-01   -1.917707813070499e-01   +6.196300930833684e-01   +5.879138754424048e-01   +6.986348212375975e-01   +3.077909066556362e-01; +3.041563301918810e-01   +3.253862669209120e-01   +1.500889176997661e-01   +1.266911666486107e-01   -1.059004602330899e-01   +1.023963736012488e-01   +8.368934548304184e-01   -9.753067505978216e-02; +1.149666616798166e-01   +3.970423770464822e-01   +6.834378971553344e-01   +8.870598749563038e-02   +5.557125716299398e-01   +4.041730148912025e-01   +3.292362102083242e-01   +5.405490898874467e-03; +5.353858406486697e-01   +2.950046964890284e-01   +3.435760001234721e-01   +7.970961137243089e-01   +6.677107966200083e-02   +6.314763904921379e-01   -4.903678852862192e-02   +5.729098502387800e-01; +3.440332123181205e-01   +5.726921973306747e-01   +4.442027656383438e-01   +4.195955679282164e-01   +2.785677068479156e-01   -3.788000678589826e-02   +3.139304528375202e-01   +4.881977680156215e-01; -1.210308290793239e-02   +4.581321025249848e-01   +2.427235573574898e-01   +2.609265722823688e-01   +3.214223805844197e-01   +4.083553546784622e-01   -2.592875858852976e-01   +3.405108736864181e-01; +2.732195537853044e-01   +2.757533714132411e-01   +7.248439307146229e-01   +9.520977077465420e-02   +2.434028470870885e-01   +1.780819132384236e-01   -4.207169069258815e-01   +3.724370488771326e-01; -3.338535987674338e-03   +3.209790871602088e-01   +3.358620614446495e-02   +4.427319072324393e-01   +1.231776017767460e-01   +3.246288462427181e-02   +3.946707600213898e-01   -3.301946437238351e-03; +1.909699882127324e-01   +2.904529332916186e-01   +8.897240851407934e-02   +4.444628443928906e-01   +2.820918740736575e-03   -2.749956846046889e-02   +5.761399819394337e-01   +2.603049639679428e-01; +5.392031061368088e-02   +3.266442632262222e-02   +5.344062846657681e-01   +4.677715620917082e-01   -5.362514244364004e-02   +5.039920188017144e-01   +4.695659132730904e-02   +1.204514001474631e-01; +3.931969261217991e-01   -1.184527159755964e-01   +9.647123040200495e-02   -3.143558887581519e-02   +5.862966813897278e-01   +3.202018280262575e-01   +1.392729809599986e-01   +5.963173670449702e-01];
L1E_L2E_iAMPA_netcon = [+1.503998381592925e-01   +2.580738411250947e-01   +3.787975849086181e-02   +4.389481336555865e-01   +1.413264975352462e-01   +3.417170733840835e-01   +3.722081549423871e-01   +2.982345259253823e-01   +4.170423123028743e-01   +3.476796337525349e-01   +5.074158741187506e-01   +7.385585829038560e-01   +6.674146109365107e-01   +1.887081171555259e-01   -7.982810949807255e-02   +3.692875765968738e-02; +3.719378857825496e-01   -9.893044857912978e-02   +3.074876331263690e-01   +5.230755890805007e-01   +1.523674200419085e-01   +1.165894125835973e-01   +4.736148184000856e-02   +3.250360717118470e-01   +4.234479228024426e-02   +4.809070311688144e-01   +3.207384365522098e-01   +8.371589086844224e-01   +3.545367896135302e-01   +2.677660748397810e-01   +4.446372948846901e-01   +1.401161621915324e-01; +7.606268510783680e-01   +3.945158897445413e-01   +8.583214610422468e-02   +4.023028473055792e-02   +3.734234907182816e-01   +4.149345726861157e-01   +1.743564974495234e-01   +6.808418592191580e-01   +5.190019633469302e-01   +1.528105637071913e-01   +4.746217548916297e-01   +4.051847037150861e-01   -6.464714785483328e-03   +6.247743913776413e-01   +1.066697586428128e-01   -1.409626307339544e-01; +1.995802437477008e-01   -8.276070465574149e-02   +8.982598486968283e-01   +7.688211310306850e-02   +7.713814649535872e-02   +3.157884746957277e-01   +9.966478262838785e-01   -9.068260951309333e-02   +5.483722115540102e-01   +4.545226251398468e-01   +5.805968950587378e-01   +2.751836864614167e-01   +1.029990381012690e-01   +5.149028565112208e-01   +5.170252952695906e-01   -1.880479553520180e-01; +3.641067401338390e-01   +2.725496643127235e-01   +9.532061323123412e-01   +5.096532237017536e-01   +3.700292300413346e-01   +6.450192889799101e-01   +6.249096366301443e-01   +4.303315620886773e-01   +6.777661605975563e-01   +3.245761430357125e-01   -4.594456133985551e-02   -1.349293413260000e-01   +4.236875314404076e-01   +3.642367847988475e-01   +9.569222356168783e-01   +1.947373837102427e-01; +1.783131719981167e-01   +8.224472907883243e-01   +2.909381018979790e-01   +5.506112206087734e-01   +2.300762525893472e-01   -7.226201671250461e-02   +6.624132012928202e-01   +2.338294200885974e-01   +5.539808743905749e-01   +1.966979880315937e-01   +5.946188395319406e-01   +1.946099759702337e-01   +1.225488436087879e-01   +1.908474775704143e-02   +4.633793455680414e-03   +4.718023942847718e-01; +4.846099182081667e-02   +3.450075678799008e-01   +4.400752679763839e-01   +5.744229180601816e-01   +3.120005276902845e-01   +7.104107159608823e-02   +8.807074703130831e-01   +1.995612348891970e-01   +1.560012544042451e-02   +2.354231747190801e-01   -1.513751161329966e-01   -8.991684473791825e-02   -3.441996227389835e-01   +1.919911856170906e-01   +2.409836797310977e-01   +2.626294407350827e-02; +4.082409528102562e-01   +4.445455083023849e-01   +6.222742356605274e-01   +7.422162042606428e-01   +7.772528300628742e-01   +8.731110959849717e-01   +7.683957684173381e-01   +7.996780686700242e-02   -3.902492249041843e-01   +5.205461047535761e-01   +5.498087319269125e-01   +4.391742302011972e-01   +2.173039207836525e-01   -1.066772928258892e-01   +2.918504540503760e-01   +3.108091978707382e-01];
L2I_L2E_iAMPA_netcon = [+5.048816254798097e-01   +7.621191154744874e-01   +3.995189704380600e-01   +3.983462387398156e-01   +5.586650165957398e-02   +8.133107425302551e-01   +2.658979369227317e-01   +4.625535185597591e-01; +6.958492150494261e-01   +5.285963957804223e-02   +6.439470760615531e-01   +5.136260886509484e-01   +5.516127297958097e-01   +2.984952390731961e-01   +3.184381383047376e-01   +3.291244029383752e-01; +4.765332184608880e-01   +5.218650055996875e-01   +3.505587347830791e-01   -1.662435775345206e-01   +1.467362454442399e-01   +4.302066895829905e-01   +3.633457673265149e-01   +2.711369177286000e-01; +3.973698218223220e-01   +3.692289240635321e-01   +1.852956642750027e-01   +8.283233517758668e-01   +3.290785184229666e-01   +6.512464528178168e-02   +4.129553622638877e-01   +2.725063027293949e-01; +5.679704681316587e-01   +2.156761816679827e-01   +4.672098210482388e-01   +5.686208984223398e-01   +5.200345979341916e-01   +4.260424085361704e-01   +7.963272162564123e-01   +2.926719157230486e-01; +3.765329191809170e-01   +4.325225360055271e-01   +7.334414592005034e-02   +5.758076534921903e-01   +1.608343484116528e-01   +4.869294293170628e-01   +3.676616290517822e-01   +3.343747346880722e-01; +5.784018762938182e-01   +3.894381287615127e-02   +2.954306026835289e-02   +7.287960415281876e-01   +5.399015264978470e-01   +2.827176390726523e-01   +1.000000000000000e+00   +1.037411945254194e-01; +8.890957772589039e-01   +1.858590776981699e-01   -1.392783711584116e-01   +3.638826333736763e-01   +2.407500341745952e-01   +4.674511111136125e-01   -2.367025946890833e-01   +5.041160812634449e-01];
L2E_L2I_iGABA_netcon = [+6.429625301163036e-02   +4.232461321950520e-01   +6.171020354408501e-01   +1.103179390632982e-01   -1.391344958904741e-01   +4.741852103867530e-01   +1.281094165639435e-01   +5.233900195997618e-01; +3.537549771411221e-01   +6.954084536926775e-01   +4.171250602255974e-01   +4.745431031003469e-01   +5.445092356573974e-01   +4.901618484997477e-01   -1.193641231987877e-01   +3.653219284638624e-01; +1.453028429902248e-01   +7.539969556176970e-01   -2.782541328447175e-01   +8.771222087518557e-03   +6.653955851358618e-01   +7.599361334718229e-01   +1.894982894791493e-01   +9.137894735349941e-01; -3.924730540904214e-02   +7.206434281224898e-01   +4.003685635797433e-01   +5.193694271183785e-01   +8.987407098098298e-01   +2.862505096046835e-01   -1.611124531808368e-01   +1.068767273144541e-01; +3.931768750078808e-01   -2.225032326312706e-01   +1.317979398367236e-01   +6.717759763257622e-01   +5.000899043052456e-01   +1.929658960413739e-01   +3.877393415607307e-01   -7.253030763011184e-02; +1.515643387387509e-01   +1.674505275370569e-01   +1.671985905954321e-01   +3.784589104698390e-01   +2.973164081404158e-01   -1.084459908412181e-01   +3.819900832068875e-01   +1.840950360121242e-01; +4.577304596284507e-01   +3.866889628756890e-01   -1.977490112334217e-01   +1.889800987629978e-01   -7.414646788031354e-03   -1.020953588645376e-01   +2.719137009213826e-01   +7.346788013590808e-01; +4.536913180815664e-01   +6.290034642880391e-01   +4.873939256121058e-01   -3.766896280014861e-01   +6.042018115352229e-01   +3.600176378336306e-01   +7.285110839296778e-01   +3.889756064415187e-01];
L3E_L2E_iAMPA_netcon = [+4.859256475592540e-01   -1.542685424247619e-01   +1.634988749999026e-01   +3.783867157516980e-01   +4.871251252555354e-01   +1.923033923821883e-01   +2.635435436801497e-01   +6.268384195797150e-01   +2.990949673780886e-01   +7.910340756938007e-03   -3.395340173202682e-02   +5.647493060125026e-01; +3.776493986661893e-01   +7.519197623806716e-01   +2.462497475077606e-01   +1.467923585182218e-02   +1.567868020504403e-01   -2.398252327837596e-01   +4.917022068081117e-02   +1.516147810194473e-01   +1.303194004893066e-01   +1.017624576192815e-01   +3.286265999541567e-01   +2.429373916256772e-01; +1.546536361863993e-01   +5.729659724589663e-02   +6.465270824287821e-01   +1.316289680602127e-01   +8.762703460417847e-01   +4.603700671471190e-01   +5.395307823137510e-01   +5.354270912696559e-01   +6.095271887726681e-01   -1.700849788607803e-01   +1.741491121208841e-01   +6.925689533348189e-01; +1.643715566104053e-01   +2.639783659082768e-01   +3.490342678956435e-01   +2.411587738310478e-01   +4.375510926046676e-01   +1.841034490613049e-01   +2.420121837459171e-01   +3.897238121447529e-01   +4.010658003513049e-01   +5.709826740684805e-01   -7.455723893243835e-02   +4.620761311031726e-02; +6.332609780932581e-01   +3.152888712458359e-01   +2.178642109535594e-01   -4.676817984992884e-02   +6.663944208533181e-01   +3.298824649796324e-01   -9.602758934624769e-02   -1.945542349376397e-02   +4.757504155895370e-01   +4.539041292125517e-01   +6.780751579198400e-01   +4.366886128961333e-01; +3.835685828198422e-01   +5.978016760252083e-01   +8.277953924889818e-01   -1.084276104766175e-01   +4.483026679952667e-01   +8.237150042369887e-01   +4.468246882983657e-01   -1.179204472321174e-01   +7.856591727988040e-02   +5.791339215703073e-01   -4.869699437381927e-02   +2.845799512356514e-01; +3.151732418938972e-01   +2.148883328398386e-01   +7.199928913419430e-01   +1.238313380207326e-01   -1.061070596303365e-02   +4.454607932632489e-01   +2.503205070242900e-01   +4.385706428130266e-01   +5.368847022768392e-01   +3.286559918806878e-01   +3.256816658521688e-02   +2.083185386865151e-01; -1.154525671572754e-01   +5.579567323584259e-01   +2.295749536713222e-01   -2.270161064277246e-01   +4.039218476151022e-01   -4.623063075659849e-02   +2.776276638705391e-01   +1.101924103358222e-01   +6.082297054378603e-01   +5.088985144363672e-01   -9.716627401662097e-02   +2.404102992817207e-01];
L3I_L2I_iGABA_netcon = [+6.848133556732221e-01   +4.235602739411941e-01   +1.858681089593734e-01   +5.775786056732646e-01   -1.258205746004388e-01   +3.481741892247214e-01   +6.597973574164437e-01   +3.651179424164915e-01   +5.780924210996772e-01   -1.184148514066182e-02   +2.718731252420216e-01   +5.118599131353279e-01; +2.286604509601682e-01   +2.834250073276486e-01   +1.480749205702624e-01   +2.042493201844927e-01   +5.886638480769577e-01   +3.770397731668189e-01   +3.190630185497073e-01   -1.451498385437924e-01   +2.366997071501235e-01   +2.993111896427667e-01   +3.814429392438726e-01   -3.129153469049671e-01; +2.851810965857484e-01   +5.120615850493895e-01   +4.226635151886260e-01   +1.754964910749840e-01   -1.083835111128069e-01   -4.332037743265951e-02   +4.803537922432882e-01   +6.443577858659895e-01   -3.460202526725826e-02   +3.454490905075823e-01   -1.416055627011548e-01   +4.777574894146743e-01; +4.969502926337452e-01   +6.065680619508548e-01   +6.865056279069937e-02   -6.888927380975723e-02   +2.014395282121540e-01   +4.174743993034106e-01   +2.083490503364054e-02   +7.150066101007077e-02   +2.571004503354751e-01   +1.358566954656406e-01   +4.344437250660182e-01   +2.188923047804836e-01; +1.321200344881888e-02   +1.151004640096984e-01   +3.009415110521085e-01   +4.861682840317105e-01   +5.137992636715766e-01   +5.346669386839175e-01   +1.405387616870474e-01   +1.000000000000000e+00   +6.215437148995683e-01   +1.335879044477365e-01   +1.983591760984873e-01   +6.679897573514718e-01; -2.154155875402547e-01   +5.477979324149941e-01   +2.933188406875414e-01   +1.991131436085484e-01   +7.907890921407223e-01   -2.753386234982188e-02   +3.499938547247547e-01   +2.928277670905545e-01   +2.662487561900871e-01   +2.745358946493677e-01   +2.962965482912354e-01   +5.797288382325055e-01; +4.381446895500548e-01   +3.042464314642289e-01   +7.763059595011658e-01   +2.130461387297561e-01   -9.028536628647867e-02   +4.838500080290240e-01   +5.969270663156548e-01   -3.827211200846944e-02   -1.065233957432685e-01   +3.863299132822166e-01   +3.524135378435855e-01   +1.836091533945354e-01; -1.170788153486575e-02   +1.564105473234091e-01   +7.886617294169285e-01   +6.407558547624507e-01   -2.384259182632305e-01   +6.096191681729071e-01   +5.094240239301199e-01   +1.194753128213060e-02   +7.109243224733224e-01   +2.776026015252753e-01   +4.720203204667290e-01   +1.300284680914401e-01];
L2E_L3E_iAMPA_netcon = [+5.155154336130451e-01   -1.574409314642475e-01   -8.696947524824483e-02   +2.347307826237250e-01   +8.397577520552285e-02   +1.118808814727349e-01   +1.838568762698579e-01   -2.326479318584535e-01; +2.488256987820009e-01   +2.279607302987181e-01   +2.587556095695316e-01   +4.490253083638616e-02   +5.234605694515848e-01   +1.265893315453811e-01   -3.085545144589518e-01   -2.746597762691712e-01; +6.831588119326477e-01   -7.899992710623109e-02   +5.031420486911655e-01   +7.079347568895448e-01   +1.469814353287655e-01   +2.510590490418168e-01   +1.325519475675178e-01   +5.407307969323886e-01; +1.969813502522547e-01   +3.814139349778804e-01   +3.550500841281429e-01   +9.204008457780652e-01   +7.894933475009832e-01   +4.784387053902968e-01   +6.743144948209262e-02   -1.316819241542486e-01; +1.019316545002217e-01   +2.471172103063412e-01   +3.861104843006757e-01   +8.804405781107574e-01   +8.992660550688109e-01   +1.070120406135690e-01   -3.067352294455890e-02   +3.803772681256204e-01; +3.328578206905435e-01   +5.778256702648628e-01   +8.223423537711808e-01   +6.764350273871057e-01   +5.575215684181122e-01   +3.634947405281705e-01   +6.209575874262174e-01   +2.208146439355512e-01; -1.929673086967976e-01   +2.921110335257673e-01   +8.173325477988289e-01   +5.159867943901315e-01   +1.035215707658735e-01   +5.365249037233999e-02   +3.389858670607088e-02   +3.764822678129022e-01; +3.439201020923369e-01   +5.192644063422185e-01   +4.420385361229701e-01   +2.703492582403366e-01   +4.808520317487687e-01   +3.024875603818413e-01   +5.171169029193765e-01   +8.759894618779671e-01; +7.566600570737139e-01   +2.068036752960811e-01   +3.276586813677288e-01   +1.160583952951990e-01   +3.358666636864001e-01   +1.379026350227433e-01   +6.257439056689638e-01   +3.363967995717434e-02; -1.564457877990253e-01   +3.918961071064438e-01   +2.518847730215790e-01   +6.250682374777519e-01   +1.479152202887583e-01   +3.593305830672316e-02   +5.596551920077620e-01   +3.023540766433257e-01; +4.188643148844473e-01   +1.559404807458101e-03   -2.276742836964768e-01   +5.966462659868833e-01   +6.141395894906957e-01   +5.759102324151822e-01   +2.385539096647955e-01   +4.724777421749903e-01; -1.710340731798631e-01   +8.538005715490345e-01   +7.224102332028038e-01   +4.853111819692691e-01   -1.060245266662970e-01   -1.883160110147041e-01   +7.902119317473738e-02   +5.278714806882722e-01];
L2I_L3I_iGABA_netcon = [-2.430986435262765e-02   +1.626343344874984e-01   +6.128364086032470e-01   +5.349465313297027e-01   -6.875642129164555e-02   +5.201109910320749e-01   +3.660420945185627e-01   -8.709707762103636e-02; -7.847523097074277e-02   +4.110082008826377e-01   -1.211096078962676e-01   -6.730532352421661e-02   +4.590534719574322e-01   +2.497111570805862e-01   +3.299108019267392e-01   +2.027766986806962e-01; +6.215902644452251e-01   +5.393362550673373e-01   +3.713525935758679e-01   +4.829107269372417e-01   +2.987780309701198e-01   +9.756089887936648e-01   +3.571368157578237e-01   +4.756632564958582e-02; +2.801349940005353e-01   +4.090649693654084e-01   +6.682978456983932e-01   -2.492212615906394e-01   +3.632695820847235e-01   +2.579870572728529e-01   +6.254997072853238e-02   +5.955189896076062e-01; +5.942815059174682e-01   +6.570786403492729e-01   +1.331371677083256e-01   +3.336966099285876e-01   +3.277109830714031e-01   +3.893626101169599e-01   +1.661136894911217e-01   -1.845224208508290e-01; +7.585446859637535e-02   +4.605521267428204e-01   +7.735223148454040e-01   -4.169523975405712e-01   +1.071132547699725e-01   +5.124408706139882e-01   +2.490971746252950e-01   -9.983376085389019e-02; +6.874098884201053e-01   +3.682377181984208e-01   +2.862317969345342e-01   +6.484159844259518e-01   +3.795913622932912e-01   +2.858343187564493e-01   +5.449487719446451e-01   +4.425858673185977e-01; -1.205455719334463e-01   +6.060278181768127e-01   -2.099797772822857e-01   -1.246076586771973e-01   +2.900132939396266e-01   +1.916731825512703e-01   +1.319860523878183e-01   +5.536520631432200e-01; -4.243085291956510e-01   +2.892409518226509e-01   +4.210188266520805e-01   +1.008622934254533e-01   +1.564451413760501e-01   +6.172789101483649e-01   +3.429892470102335e-01   +4.700387610288619e-01; +6.227647863105932e-01   -2.603431540915160e-01   +4.095945819929772e-01   -3.444136832357372e-02   +5.390454526273842e-01   +5.100118452459493e-01   -2.699069648251588e-02   +4.895349749465335e-01; +7.288774975229425e-01   +1.453549646250577e-01   +9.049743334893656e-02   -1.193737932132607e-02   +5.033079816290320e-01   -7.318804732097972e-02   +3.192722742369387e-01   +7.769182857007825e-01; -1.307330466534588e-01   +6.259763179468659e-01   -2.050120685973503e-01   +4.194000753196233e-01   +8.653283329473334e-01   +2.271904908321196e-01   +6.958694022663883e-02   +3.975334555418826e-01];
L3I_L3E_iAMPA_netcon = [+5.852182501496008e-01   +6.454315388598146e-01   +1.319724920837853e-01   +5.029688581005322e-01   +1.809667281533665e-01   -1.151881738052722e-01   +1.703272644022482e-01   +1.209258889841056e-01   +1.734924707184826e-02   +3.324511928157510e-01   +5.128025774989924e-02   +4.703959453803192e-01; +3.064112692434965e-01   +4.217253848204181e-01   +3.785620055600158e-01   +5.108532909827895e-01   +1.000000000000000e+00   +2.150890367535255e-01   +1.136009487491082e-01   +4.091720450170687e-01   +6.712773446260443e-01   +3.879577693596095e-01   +2.604246037561431e-02   +2.840395656863435e-01; +3.472628187956489e-01   +6.083361800476889e-01   +9.500981549116910e-01   +3.493189491962337e-01   +5.955076349545139e-01   +3.824940059603509e-01   +4.993313770488381e-01   -9.115083273479277e-02   +4.040221538111483e-01   +6.837892406222258e-01   +8.708202205921242e-02   +6.130295163661942e-01; +3.704081152244004e-01   +4.630515487481718e-01   +2.445306445550914e-01   +2.014681123478928e-02   +2.695168206889815e-01   +5.510943507927607e-01   -2.259792058921062e-01   +1.400519877568324e-01   +1.908135278301578e-01   +2.855415734835949e-01   +3.089380069949264e-01   +2.121947975948257e-01; +3.669277847736515e-01   +1.341802459267035e-01   +6.785353140142660e-01   +8.404430973044085e-03   +2.645270764883139e-01   +2.228871637653058e-01   -2.722111804465258e-01   +2.888152325327826e-01   +6.008888453443352e-01   +6.097176027572081e-01   +5.953792888962811e-01   +4.898201846536623e-02; +8.572603050491951e-03   +2.479844307954934e-01   +4.777936937285950e-01   +9.375529935249394e-02   +1.505064577382747e-01   +1.068949671117661e-01   +5.249948715059102e-01   +2.251851820681845e-01   +2.906883298006131e-01   -1.784117769333224e-01   +3.466067986430469e-01   +2.543381992876453e-01; +1.056089633517568e-02   +1.124484191094035e-01   -1.901553964362249e-01   +2.481552209858094e-01   +4.786350703450536e-01   -1.009817542800922e-02   +3.701847102875929e-01   +2.466153205738956e-01   -2.888980053014656e-01   +2.295190796453013e-01   +3.741126442794303e-01   +2.675343487237009e-01; +3.787906333007469e-01   +4.552071593220482e-01   +3.288665653958679e-01   +4.180216204238375e-01   -7.006023242828213e-02   +5.570269329263209e-01   -2.816097267538701e-02   +4.679677451552238e-01   +5.676660512184142e-02   -1.689600339830874e-01   +5.009859801100665e-04   +3.058271774283867e-01; +1.121687484535929e-01   +7.001295455492644e-01   +7.266951695560277e-02   +6.011307229645227e-01   +2.716033687966564e-01   +5.919494168118964e-01   -5.330437868261671e-02   +6.758478328004772e-01   +5.819989922837091e-01   +5.121208653521538e-01   +5.037370543313321e-01   +6.524404392211464e-01; +8.670232781780117e-01   -1.332059752799406e-01   +7.887688794419744e-01   +2.599579298142296e-01   +4.648898816376180e-01   -1.129530615116980e-01   +4.243717121484891e-01   +2.090535398116631e-01   +2.508412844581719e-01   -7.655149503807797e-02   +6.439976528595078e-01   -4.734575983513364e-02; +8.343173592410894e-02   +3.031543577696640e-01   +5.539399468668411e-01   +3.715512916560589e-01   +5.940216013074952e-01   +1.547919060994933e-01   +2.341403077012252e-01   +4.015150021445654e-01   +7.756288124180947e-01   +2.437792908739866e-01   +3.934976963730822e-01   +6.216639310135916e-01; +1.786061208349423e-01   +3.518910490323861e-02   +4.103455155091195e-01   +4.558522559101690e-01   +4.498336273281074e-02   -2.446105122238648e-01   -7.036730192985703e-02   +3.932838791570686e-01   +7.438195714349197e-01   +4.654652346780724e-02   +4.813899129548035e-01   +1.870062834476706e-01];
L3E_L3I_iGABA_netcon = [+1.131889328405186e-01   +7.137597051453557e-01   +2.945336505860089e-01   +3.723079411510392e-01   +5.768679171231573e-01   -6.099231718170647e-02   -1.875834580478594e-01   +2.493201749249304e-01   -3.044270608471031e-02   +3.749240397224857e-01   +3.215856639445694e-01   +5.826432442467946e-02; +4.145815020764420e-01   +3.181887666838134e-01   +5.731732340738991e-02   -7.114626010802950e-02   +2.910169873776680e-01   +1.456415904143194e-01   +9.594334202431939e-03   +3.051770099012617e-01   -2.118248755454446e-02   +8.383584564522345e-03   +9.022547366117496e-03   +1.347924309273667e-01; +4.095808742249595e-01   -1.019925407777603e-02   -1.375249957947427e-01   +2.494575006321679e-01   +4.119971763596060e-01   +4.261166422479712e-01   +4.372462535041738e-01   +2.940499458815679e-01   -2.159897816925115e-01   +2.832695487683064e-01   -2.022693674082017e-01   -5.136622903120842e-02; +2.535076830978107e-01   +3.470811294665956e-01   +6.272770974660784e-02   +1.078214460234386e-01   +6.421957069418076e-01   +3.631324805809713e-01   -1.742001767127411e-01   +2.387203937940918e-01   +7.725629794612320e-01   +5.074171019222932e-01   +1.892772118324548e-01   +1.976053926174444e-01; +2.352876501969820e-01   +1.141778675946630e-01   +2.378244991173096e-01   +6.689451779323696e-01   +3.970031586453600e-02   +4.369784226073437e-01   -2.714273094121945e-01   +4.939396148738662e-01   +5.157953594658088e-01   +5.145271065176316e-01   +3.394495021612703e-01   +1.804765330663606e-01; +4.303823309831499e-01   +2.216123408310909e-01   -2.047881406805163e-01   -2.171162184087767e-01   +7.044741604698842e-01   +6.639427462272482e-01   +2.609497816617282e-01   +4.113104199573548e-01   +5.068682520989868e-01   +4.450988046966785e-01   +3.037294953210731e-01   -7.493474149754240e-02; +1.258942166149929e-01   +3.257483114718687e-01   +4.748216734317419e-01   +9.811378785204790e-01   +3.090169131384136e-01   +1.075448676892223e-01   +5.483858947590344e-01   +6.100809516595203e-01   +1.735452473537009e-01   +4.480544466432606e-01   +5.384263069963034e-01   +6.465395024410731e-02; +1.174739517865187e-01   +2.768161571539461e-01   +4.929034760126875e-01   +4.949812266308684e-01   +3.994534594710265e-01   +2.600741839013525e-01   +2.402451881877143e-01   +1.806711098125812e-01   +1.718357678012906e-01   +5.102145695071024e-01   +3.151402174962891e-01   +2.446018330063379e-01; +2.492211782194332e-01   +4.983043970019403e-01   +1.281609755978550e-01   +5.997483563106297e-02   +3.706841603607955e-01   +3.330791515220850e-01   +5.091206729018284e-03   +3.172031856891859e-01   +6.508551081179110e-01   +7.039448994783919e-01   +5.219153129043449e-01   +2.622535626795203e-01; -2.314502149739559e-01   +2.224475712252331e-02   +5.901891815462181e-01   +8.337596274784587e-02   -6.579092135587664e-02   +9.935495142342823e-02   +3.175941513703641e-01   +2.828381704208577e-01   +3.717155709650144e-01   +1.285610709517828e-01   +3.055538445846472e-01   +5.233003652411182e-01; +1.391153149003517e-01   +2.554173111118784e-01   +1.904383763381121e-01   -3.739836916644251e-02   +3.745773242631754e-01   +2.072696791369083e-01   +4.152851811345193e-01   +4.313482386558109e-01   +2.315912234153145e-01   +4.580135359645112e-01   +2.380317315482721e-01   +1.262915931222263e-01; +3.549470897584833e-01   +4.346191523478714e-01   -7.025246990668457e-02   +4.979433064634325e-01   +8.209695180290792e-01   +5.520751633145812e-01   +5.746158187934828e-01   +2.481128955714335e-01   +1.370031767089776e-02   +1.339670525123737e-02   +7.797615484290543e-02   -4.385500765986232e-02];
L2E_Input1_iAMPA_netcon = [+5.395610441246692e-01   +6.868381580665847e-01   +8.525428431353942e-01   +8.216705547942467e-01   +8.564649248269063e-01   +8.803979053717290e-01   +7.916798873639908e-01   +9.549241310528838e-01];
L2I_Input2_iAMPA_netcon = [+6.332301538992354e-01   +6.126706430373892e-01   +6.603815348405814e-01   +5.387564183242151e-01   +3.343828446982757e-01   +1.000000000000000e+00   +5.090899454944157e-01   +4.495971774579618e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last =  11.21 * ones(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.2*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.2*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.2*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.2*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.2*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.2*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.2*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.2*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
