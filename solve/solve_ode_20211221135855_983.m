function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-1.889656907660777e-01   +6.787961594728616e-01   -3.934982727004462e-01   -2.681441767916661e-03   +6.771262956763341e-01   +3.203399526187217e-01   +4.903485846707707e-02   +1.985665696427458e-01   -5.663179033449103e-02   -4.026607406802155e-02   -2.260611246961082e-01   +7.123813198885751e-01   -1.249082279241254e-01   +3.521165752536665e-01   -1.295161640438341e-01   +2.133343836745090e-01; -1.613768134020687e-01   +6.842559703833448e-02   +2.771533106081495e-01   +4.593450639712334e-01   -1.103970905932015e-02   +5.286478213280953e-01   +6.805406591667282e-02   +1.687540105733308e-01   +2.904669270730820e-02   -5.296287065455960e-01   +3.842907207028422e-01   +7.506137604885358e-03   -2.626816934026362e-01   +4.647732942438408e-01   -1.107856201101164e-02   +5.513980020725713e-01; +2.256331452073643e-01   -5.778314610936191e-02   +4.393661425139732e-01   +2.537718055234138e-01   -3.986847789160997e-01   -3.714700466205717e-01   +7.152770718922952e-01   -2.676006887445568e-01   -3.307269366488833e-01   -2.489897725934364e-01   +4.267707121960400e-01   +1.726698420693795e-01   -4.452378197363409e-01   +2.844414496238565e-01   +1.427821337505376e-01   +4.262874244944666e-01; +4.535339748660484e-01   +5.801348189777001e-01   -3.190340624111400e-02   -2.409495540755353e-01   +6.054581549663073e-01   +3.070179746460808e-01   +6.868395263503664e-01   -6.613628341559763e-03   +5.870727872491472e-01   -1.720724923480095e-01   +3.281939115594749e-01   -5.835343417952971e-02   +3.574742663991048e-03   +2.133381065641612e-01   -1.049893227500275e-01   +7.091686604992343e-01; +2.340968426911851e-01   +7.647465329861830e-02   +5.391865760947271e-01   +5.188059802248448e-01   -3.726187749199590e-01   -2.069776646129930e-02   -7.715095729243192e-02   -1.779530129496363e-02   +1.433964832088442e-01   +5.420203596143280e-02   +2.748401457253706e-01   +5.950348272770225e-01   +6.156688395621233e-01   +4.223208741917174e-01   +4.654274942192129e-01   -1.383486098395219e-01; -1.612335727855123e-02   +1.399829685461321e-01   -6.041610781376562e-02   -1.718049520723982e-01   -1.007631961802595e-01   +1.505607239327983e-01   +5.583659323393870e-01   +1.579682976330685e-01   -5.548416789209249e-02   +3.628038153758067e-02   +1.397862057403306e-01   +7.851147565889475e-01   +4.036747361170715e-02   +3.186010952543671e-02   +2.904162536253743e-02   +2.859393360741149e-01; -1.438480074222178e-01   +3.837966942021441e-01   +3.651479972520085e-01   -4.170479012226920e-01   -3.316281445463781e-01   -2.027114220371114e-01   +4.970214318220053e-01   +2.090079666876440e-02   -3.109978575639543e-01   +2.924326627080609e-01   -1.717095381821445e-01   -4.046635435204279e-02   +4.910054700591993e-01   +5.048031271463842e-02   +3.843757714292623e-02   -2.613210955684295e-02; +5.236449880612319e-01   -9.240391214594872e-02   +4.399075968382410e-01   +1.958542109237216e-01   +4.501805485629822e-01   +9.145181954494999e-03   -4.327367846209279e-01   -5.413032972155855e-02   +1.185692795324340e-01   -8.795463110174107e-02   +7.101912034474731e-01   +4.535278765329737e-01   -2.764337148745261e-01   +1.707405000625704e-01   +3.773212472842305e-02   +1.931218621898441e-01; +5.535482632508489e-01   +3.413770631589589e-01   +2.473110936981337e-01   +3.498024792387934e-01   +3.033883622502792e-01   -2.260953844806633e-01   +4.922749722894456e-01   -1.125738476159359e-01   +4.287171828019541e-01   +4.328238100699264e-01   +2.179268216302933e-02   +1.558189839843361e-01   +4.985435883500742e-01   +6.609031622947302e-01   +2.862296748451675e-01   +7.531118568225166e-01; +6.035777726550270e-01   +1.443057912835023e-01   -2.077989636555948e-01   -3.235489190172755e-01   +4.686953625956683e-01   +2.350378348225233e-02   -2.175852017764591e-01   +4.279315370870532e-01   +1.223731774043148e-01   +6.263897630453885e-01   +5.329484520646337e-01   +5.657861153330849e-01   -1.275119451504851e-01   +5.378306923620667e-01   +4.580763922957196e-01   +1.737258659335972e-01; +2.106990355025435e-01   +4.202715666815687e-01   +3.662231660955254e-01   -9.538830151775081e-02   -4.565975350028258e-01   +3.146805434294497e-01   +5.851781425452214e-01   -1.993186383646696e-01   -1.165423335425473e-01   +6.435023287277456e-01   +1.398658457482387e-01   +9.253872791437973e-02   +1.331834747961244e-01   +5.385443502225612e-03   +3.785811899581609e-01   +6.180921972541965e-01; +6.051078244110399e-01   -4.968743257962641e-01   +3.448827125750070e-01   -1.311124836743218e-01   +1.844752220001750e-01   +5.919317703916219e-02   -2.518713038162065e-01   +1.421484763955905e-01   -2.894890108084249e-01   -4.867901612711610e-02   +1.754790096495041e-01   +4.574086790048326e-01   -4.830621606972102e-01   -1.334481324953906e-01   +4.056005578559664e-01   +7.129726148765284e-02; +4.134635943296202e-01   +1.149750417492775e-01   +3.882384173133282e-01   -8.450320975570973e-02   +6.380523952140046e-01   -4.418853542360968e-01   +3.178859495765255e-01   +5.164958096829370e-02   +1.504860622994403e-01   +1.282301150858488e-01   -2.352913826733312e-01   -3.041813602503534e-01   -1.214326704184822e-01   +7.952417227083659e-01   -2.788912726247064e-01   +1.365531267055431e-01; +3.672460712108931e-01   -2.044096360008652e-01   +2.515616857931334e-01   +3.354487906814146e-01   +3.401305724464075e-01   +1.071353589124116e-01   +3.205168305589842e-02   +4.342245141241296e-01   +6.015282114988420e-02   +2.431788472878026e-01   +8.835143470291545e-03   +5.021126094955946e-01   -4.356781135019445e-01   +1.656055444766213e-01   +3.856665259888414e-01   -3.621387829715227e-01; -4.588008921512245e-02   +5.818729601551386e-01   -1.294734310272192e-01   +2.242341006416421e-01   +1.008674107498307e-02   +1.098393360710638e-01   -1.142777350351482e-02   +1.665193995426643e-02   +2.094377838192381e-01   +1.397458772888956e-01   -1.972672533276163e-02   +6.964051597113753e-01   +4.398556526908026e-01   +4.481848172654548e-02   +1.171816572719001e-01   -6.461528408538637e-01; +6.222916208961043e-02   +5.049473382019756e-01   -1.475839392162104e-01   +1.639726749969103e-01   +1.089339316232201e-01   +5.483401009322408e-01   +3.946431284355287e-01   +1.361237283203583e-01   -1.781559195329148e-01   -3.385226481019285e-01   +2.111968879167780e-02   +2.628713679959727e-01   +4.064181300326777e-01   -1.004125002538796e-01   -2.171816717363563e-01   +5.402651192184661e-01];
L1E_L1I_iGABA_netcon = [+2.728821812246476e-01   +4.973982885729408e-03   +1.192315029070267e-01   +3.557894467377956e-01   +9.057339708089250e-02   -1.409258180700700e-02   -4.705508943963059e-01   -9.610899371247392e-02   -9.525949073392595e-02   +1.777493694655109e-01   +2.008568308453187e-01   +4.429173821350724e-01   -1.579927427243330e-02   +4.267849758463712e-01   +2.851402035072115e-01   -9.598753395923132e-02; +6.917302414482381e-01   +2.363803185225059e-02   +1.429660211145512e-01   +4.809305430637864e-01   -1.883636125042176e-01   -8.400881087028000e-02   -1.325646089171870e-01   +2.351419493098313e-01   +9.629813524060563e-03   -2.796159965789534e-02   -2.215699338338291e-01   +5.815596457434674e-01   -8.737892552349746e-02   +7.236273897931882e-02   +5.109887442459390e-01   +1.280096146952391e-01; +2.314547064091264e-01   +2.030886794132106e-01   +3.480500068389873e-01   +5.158803117038324e-01   -9.455336286424756e-02   -4.084848037368611e-01   +2.192193465497470e-01   +5.303872773296566e-01   -9.692670292042987e-03   +6.951173395829855e-01   +1.268311002702026e-01   -1.533726360424567e-01   +2.937609882064545e-01   -4.299048642059143e-02   -2.132831070849638e-02   +3.176162961556358e-01; +1.148280445015931e-01   +7.368100777952495e-01   -5.221522883212961e-01   +2.184248530784325e-01   +2.565654732230810e-01   +1.540550991013419e-01   +2.528030694436999e-01   -5.677956660390220e-02   -7.277719330246132e-02   -3.855068780718413e-01   +7.836738452306210e-01   +2.236716940776590e-01   -6.717469934707271e-02   -1.149597252432216e-01   +5.586167531446724e-02   +3.593489515055700e-01; +1.408053805083080e-01   +3.285037762196533e-01   -4.811854050062089e-02   +2.766986854370534e-01   -1.444557722704337e-02   +7.307252022181492e-01   -4.193297815515948e-01   +3.624869376614033e-01   +4.436002480934926e-01   -6.600302931759144e-02   +4.286423459685518e-02   -2.258195993874328e-01   -3.318600676140367e-02   -4.090865905065608e-01   -1.358174823936162e-01   +8.008768127480440e-02; -3.983658812488912e-01   -3.729071506245116e-03   -1.126340847874149e-01   +2.722921032833406e-01   -2.340365315084224e-01   -1.148915924791833e-01   +6.013355300021970e-01   +3.409910398066347e-02   +3.912890448292199e-01   +2.074355035436487e-01   +7.632587645903648e-01   +6.882282195133426e-01   -2.363302481015762e-01   -3.108150209569118e-01   +1.062464790883933e-01   -9.860656088281181e-02; -5.023830185870368e-02   +7.671267304877656e-01   -7.376376890872168e-03   +7.003177814267550e-01   -1.537518896535130e-01   +2.187059043055375e-01   -4.411338294265579e-01   +2.194050783964505e-01   +2.384062948167545e-01   -2.185620092463336e-01   +1.623264624556207e-01   +3.402321034088610e-02   -9.285525300254265e-03   +5.032194150808850e-01   +5.992743163436538e-01   +2.355344719954700e-01; +7.310898377285177e-01   +1.583473002956672e-01   +1.041073081631756e-01   +2.613184105754061e-02   -2.702100919310758e-02   +1.875899517357296e-01   +5.860350065480432e-02   +3.903916123701724e-02   -1.025393954736612e-01   +5.129768282647477e-01   -3.862951807341835e-01   +1.616361799460722e-01   +4.932644596586621e-01   -2.100275674445956e-01   -1.297801122037986e-02   +7.280071120812567e-01; +2.099615935015743e-01   +4.863887132837536e-01   -3.510533462208213e-01   +5.618259830951292e-01   -2.825648080449137e-01   -2.561524065527958e-01   +5.573070147129542e-01   -3.683910317139680e-01   +7.409038573593234e-01   +7.801187189775376e-01   -1.925515642823697e-01   +3.105496389455009e-01   +2.630058978372325e-01   +5.669510385138590e-01   -1.251593767033733e-01   -5.231798840811235e-02; -1.191404228940702e-01   +7.535557764669830e-01   -4.554565535034061e-02   -5.625065265136509e-02   -8.535796542657512e-02   -1.289658794818045e-01   +6.512268844516079e-01   +1.119028072924020e-01   +1.963209274085326e-01   +5.253003172082893e-01   +7.011406408853683e-01   +1.111638907454747e-01   +4.903363172524728e-01   +3.250285828589518e-01   +2.895609025146646e-01   +3.060946343667114e-01; +5.931162353513475e-01   +3.144155625276627e-01   +5.738739087678811e-01   +3.706573144521779e-01   -4.673922497262182e-01   +2.550693654680156e-01   -3.415987726049949e-01   -1.240106315709658e-01   +4.183783101337592e-02   +2.994518182523683e-01   +1.363616722060362e-01   +3.557187701068838e-01   +5.015059563842227e-01   +6.767571304551261e-01   +1.441493071979402e-01   -1.089869707071897e-01; +2.006201207791724e-01   +6.391968248114394e-02   +1.420884582483704e-01   +6.401017291819400e-02   +1.432465741179900e-01   +1.446053932783146e-01   +4.040638586195429e-01   +4.987820227488136e-01   -6.561334231704152e-02   +6.378813872299624e-02   +4.602671224125671e-01   +2.840884694887043e-01   -1.971358071407927e-01   +3.451142210870544e-01   +3.538849719746114e-01   +4.234620816724829e-01; +2.086140681421772e-01   -1.172001989924245e-01   +1.731516778609980e-01   +6.397153156033839e-01   +4.112250115678271e-01   +1.224466038850012e-01   +8.595864510006168e-02   -3.949117225106680e-01   +1.540981158539032e-01   -2.735345422860831e-01   -3.105194830350991e-01   +6.528176615901026e-01   +2.773430953097890e-01   +4.295333107265020e-02   -2.202152881332698e-01   +1.559507314111887e-01; +2.132917414151291e-02   +1.247106850594639e-01   +2.462057472193152e-01   +9.982360165131839e-02   -3.123324007037561e-01   +2.534561146206265e-01   +4.019131582197918e-01   +5.762519784892068e-01   +3.881678771776670e-01   -1.659286496630513e-01   +1.498856926546780e-01   +1.560184121664867e-01   +2.527002281007981e-01   +4.681753438678689e-01   +3.173574904469782e-01   -1.760796627578955e-01; +7.938632262158012e-03   +2.449444414816787e-01   +1.121347497730799e-01   +1.028101592719401e-01   -4.561868557293693e-01   +1.707764716156836e-01   +4.200524160566754e-01   +4.064153742922203e-01   +3.360507028735186e-01   -2.088745459098661e-01   -2.046499471843981e-04   +1.172577185838461e-01   +7.840226116733441e-01   -5.286079799803363e-01   +1.628777787196169e-01   -1.234732349172400e-01; +4.477929703818926e-01   +2.069283151905735e-01   +6.276887524020605e-01   +2.872471326831845e-01   +4.556976377784151e-01   +6.229046577267703e-02   +1.212756807759064e-02   +1.197480745126928e-01   +5.258788727211657e-02   +2.868933973782647e-01   +1.260955598288186e-01   +4.245365613324176e-01   +2.639192657913668e-01   -2.058100823518504e-02   -1.781136457072265e-01   +1.832482873387989e-01];
L2I_L1I_iGABA_netcon = [-7.329136660407409e-02   +5.801778231808653e-01   -1.197486226471126e-02   +1.646744473338118e-01   -3.238839435237140e-01   +4.506641074486224e-02   -2.417127536754440e-01   +4.484595016324127e-02; -2.096711023101593e-01   -1.084633605114696e-01   -2.309434830292964e-02   -4.903468039537810e-02   +3.316275633349824e-01   +5.980579580217855e-01   +4.836630217631289e-01   +2.001329635492386e-01; -1.734243735277773e-02   +1.014398183639427e-01   +4.147507188781600e-01   -1.532167750283955e-01   -9.182372465623484e-02   -1.517464364058183e-01   -4.234816107226632e-02   -2.641685936057595e-01; +6.846566919247098e-01   +2.295949191848692e-01   +4.676341437698486e-01   -4.384033643487217e-02   +3.770550795982333e-01   -5.466758658421447e-02   +2.465214896487549e-01   -2.118995840122487e-01; +1.795321109997314e-01   +4.214543212717718e-01   -2.053985586380680e-01   +2.754052352611938e-01   +4.259076058600619e-01   +3.941846889721223e-01   +5.613910454157586e-03   +4.031524399735728e-01; +2.239382367864371e-02   +8.471662599980165e-02   -2.310407820942538e-01   +7.744028383690141e-02   -2.369017403641220e-01   -3.764775979459762e-01   +2.603198003131586e-01   -3.999871407523458e-01; +1.281727987860912e-01   +1.392784664244333e-01   -4.780845743485638e-01   +3.987767955915641e-01   +4.284749399802277e-02   +5.761746066973774e-01   +4.815468940466445e-01   +1.111706011368554e-01; +1.802564788133351e-01   +2.327073164215189e-01   +1.331445443229472e-01   +1.271164233835391e-01   -9.131998134714306e-02   -1.580778923303210e-01   +2.949106390350801e-01   +3.007130928625155e-01; -6.954801717225334e-02   +2.079183486179118e-01   +2.533172377208048e-01   -9.020035113153116e-02   +2.143082348395769e-02   -3.190292022776748e-02   -1.379101893645769e-01   +4.488163283876331e-01; -1.952979686961250e-01   -2.262988144461401e-01   -1.784884860116677e-01   -2.187815450485151e-01   +3.180740495318474e-01   -4.771455242173545e-02   -1.213152082776858e-01   -3.730965546892908e-01; +4.142508117224838e-01   +8.848598775411154e-02   +2.085382241918660e-01   +7.397051456087136e-01   +3.117129089929886e-01   -1.013254961224858e-01   +3.425624089428941e-01   +1.592641609604175e-01; +2.369047400863020e-01   +4.926885546307129e-01   +1.143698215845952e-01   +1.182080469519994e-01   +2.231698442840920e-02   +8.401765760561593e-02   +3.057243961549382e-01   -7.247447271382898e-02; -3.263008917626321e-01   +4.438040141806432e-01   +3.683700994399343e-01   -8.094187647379773e-02   +4.076366472066821e-01   +2.911102952817547e-01   -3.591737008159395e-01   +2.622205821432934e-01; -1.570797508133450e-02   +3.569704865011355e-01   +3.183010913343428e-01   +1.056263041871543e-01   +1.791374840222812e-01   +2.440587057070155e-02   +3.671950005637221e-01   -5.893033422803964e-02; +2.564798875723132e-01   +4.534000590224185e-01   +4.568283441135408e-01   +2.620558779277766e-01   -1.605833520101151e-01   -2.987131069008844e-01   +1.688742777131727e-01   +2.303619289961930e-01; -8.052111413003286e-02   +2.379121981342397e-01   -1.663071246776447e-01   +2.305572648608878e-01   +3.520986985213668e-01   -5.228622057124849e-02   -3.262745962688928e-01   +1.839984484994579e-01];
L1I_L2I_iGABA_netcon = [+3.504563033442376e-01   -5.348811535701179e-01   +7.874287445191670e-02   +1.806442016684916e-02   +3.421670298461464e-01   -1.568004766601073e-01   -3.400852191127064e-01   +9.880047927662926e-02   +7.187551736481876e-01   +6.470701307664850e-02   +4.393102392014490e-02   +3.736495511036564e-01   +6.551141145159151e-01   +5.444708675445402e-01   +6.192920396036471e-01   +5.008736064163570e-01; +2.687371820943219e-01   -4.524232580671856e-01   -3.746939304772500e-02   +3.467623569674740e-01   +2.856974851867833e-01   -3.080556851288889e-01   +2.997141417610481e-01   -5.567761688966401e-01   -1.794369692265774e-01   +6.182754987921049e-01   +2.083800129781530e-01   +6.305675019396377e-01   +3.383062661457358e-01   +2.910896789156583e-01   +2.293378124705470e-01   +2.439152232376289e-01; -1.083801732518379e-01   -1.648662862872051e-01   -6.379790460108768e-02   -3.610233367836349e-01   +5.771649614397328e-02   +4.895901257596636e-01   +5.864466175700854e-01   +4.062410788453000e-01   -1.075487749801837e-01   -3.796080161861498e-02   +1.375287695673282e-01   +2.005808228216756e-01   +8.168663171183178e-01   -5.982031671171150e-01   +3.193771273760946e-01   -2.149807506791505e-01; +4.669354765921271e-01   -3.283921910628078e-01   +1.064087637958796e-01   -4.111690616169489e-01   +1.820946399582671e-01   +7.759788933169143e-02   +6.550504473863518e-01   +3.561018722486478e-01   +9.082166848247197e-02   +3.177400410390350e-01   +4.595362446976071e-01   +2.035876643221871e-01   +4.381997779211539e-01   +1.137320966412273e-01   +1.944853216802691e-01   -2.565387685066463e-02; -8.076111268779253e-03   +4.137897580435584e-01   +1.363265991990265e-01   +6.128689712436377e-01   -2.553564400710731e-01   -2.708896869534744e-01   +2.222171905813685e-01   +8.384010028702241e-02   -1.786316579080990e-02   -2.434088079421213e-01   -9.697471978351216e-02   +3.477200793085891e-01   -6.376858449663680e-03   +2.490894447807812e-01   -4.131118522292540e-01   -5.765414807631676e-02; -1.298727295661699e-01   +3.158988987705389e-01   -2.468436810924207e-01   +2.955739251575815e-01   +4.890534680357320e-01   +3.272624621801239e-02   +3.394299560788739e-01   -1.834360954925749e-01   +3.354679587868573e-02   -1.715831931985844e-01   +1.491883257905423e-01   +6.184303872203789e-01   +4.488495262689698e-01   +6.879228457491582e-02   -3.224192769845884e-01   -2.079297265606753e-01; +1.300336600508507e-01   +3.773467118735432e-01   +2.845881899212156e-01   -4.618709870149554e-01   +1.283729345792683e-01   +6.417211256799633e-01   +5.859718334176851e-01   +4.295726846046554e-02   -2.288650981181299e-02   +3.117697361041116e-01   -2.732782925843139e-02   +4.514923061600986e-01   +3.430204175865622e-01   +7.643424788124062e-01   +3.087632703564649e-02   +2.404061204397351e-01; -3.616954046670230e-01   +2.298091780811803e-01   -2.977298172936901e-01   +3.182976364279178e-02   +2.996324608243578e-01   +5.218149354994643e-01   +3.099566168306376e-02   +9.914837178487405e-02   +2.549147569546080e-01   +5.823878964596623e-01   +7.436438364355141e-01   +1.913774993946835e-01   -3.511167335358314e-02   +5.535869666692301e-01   +3.605674798380036e-01   +7.137173460520123e-02];
L2E_L1E_iAMPA_netcon = [+2.113211887970523e-01   -2.388692579179630e-02   -3.323565257544203e-01   -5.239868199082581e-02   +1.642306523841406e-01   +5.013612566061307e-02   +3.811521938760373e-01   +2.130410497211012e-01; -1.117843524354942e-01   +9.861330902956889e-02   +1.882047895599949e-01   +2.756941615618799e-01   -1.449093005341867e-01   +1.345727428692188e-01   +6.070060698132546e-01   +1.356043626575441e-01; -1.464073730354169e-02   +1.933128590903955e-01   +2.129301790154899e-02   +1.905640313662320e-01   +6.570667902643763e-01   -7.484811168706768e-02   +3.437269271442007e-01   +2.598777396975531e-01; +5.502920203604649e-01   +1.957331960416986e-01   +4.711591929600354e-01   +1.255319829278566e-01   +5.948520642613289e-01   +6.799249995176042e-01   -4.181629361274122e-01   +1.492165842161743e-01; +2.084333913645460e-01   +3.913551599148155e-02   +3.151946331298074e-01   +4.902385325073924e-01   +5.551770911248600e-01   +4.668517500508267e-01   +6.271986623822083e-01   -4.174181073464310e-02; -3.084562157372755e-01   +1.730687657029053e-01   -1.577631506460697e-01   -2.164874012616594e-01   +1.429327355433155e-01   -2.932726959765062e-01   -5.455312352095373e-02   +1.836576396637360e-01; -9.619176250005346e-02   -2.433109348700763e-02   -1.058986170348886e-01   +3.839104541510053e-01   -3.354152515455143e-01   +5.957931230326942e-02   +1.706405637290751e-01   +1.770583682655262e-02; +2.214037384984788e-02   +2.136896999571321e-01   +3.124637354330215e-01   +2.591612027290940e-01   +2.283838441418062e-01   +3.724195363248268e-01   +5.257739985536976e-01   +1.278341236629730e-01; +3.237516994960843e-01   -2.493530726689467e-01   +3.201249848648039e-01   +6.496640913169985e-01   +5.593141315319466e-01   +3.566078251988187e-01   +1.548716448204997e-01   +1.471848864565487e-01; -2.448900707631128e-01   +3.698436721977191e-01   +2.114919055719290e-02   +3.441410650571669e-01   +2.884328877795513e-01   +3.267388369262502e-01   +2.125024415732576e-01   +2.803348089846237e-01; +9.950549800779225e-02   +2.388902839000335e-01   +4.223493744091820e-01   +7.033573283888792e-01   -8.369613570327902e-02   +1.236290450966453e-01   -1.653690100266641e-01   +2.638248057879280e-01; -4.630826049795137e-01   +2.461343261432021e-01   -4.008490675187196e-01   +9.738740672750730e-02   +4.267398306511720e-01   +5.003756407235060e-01   -6.792733273660589e-04   -8.011952478483683e-02; +2.004724933952683e-01   -1.375084101770644e-01   +3.883946830698854e-01   -3.072499937182621e-01   +5.236487203198290e-02   +3.289124341508528e-01   -2.588125585784207e-01   +2.965467979591179e-01; -1.296318449636503e-01   +2.970263738728300e-01   +3.589117404957541e-01   -4.442763621397883e-02   -1.028274187869665e-01   +2.921004818039027e-02   +7.820470577247500e-01   +1.538862072886216e-01; -6.377659739396481e-02   -5.315322635478974e-02   +1.936213690609496e-02   +5.792465059191986e-01   +5.498918039311155e-01   -3.817288325277921e-01   +2.264734294191426e-01   +1.366869591846179e-01; -2.558354907180663e-01   +1.071200060707703e-01   +2.596497221737641e-01   +4.169534112632315e-01   +3.730194303629187e-01   +2.507541360412532e-01   +2.587015289431263e-01   +2.676711898924958e-01];
L1E_L2E_iAMPA_netcon = [+2.581552726816885e-01   -9.895340631846020e-02   -8.452218624825558e-02   +1.994794784973592e-01   -4.637789265264685e-01   -5.439836485929714e-01   -1.886478392274560e-01   +7.450661366514024e-01   -3.236840932553430e-01   +3.518712023945448e-01   +6.110385830051255e-01   +1.433195931981296e-01   +1.674810036938619e-02   -2.778252892825829e-01   +2.896403793109712e-01   +9.987417648972810e-02; -4.443585799792997e-01   +6.067844950128756e-01   +1.509077757396435e-01   +4.375377237394983e-01   -1.226879823117246e-01   +5.951882647032239e-03   +1.904797060913620e-01   +5.409096962496385e-01   +9.494563536342725e-02   -6.154811737908446e-02   +9.303835795989086e-02   +4.075948002735978e-01   +3.171693198164785e-01   -1.941448803601526e-01   +4.264007264046615e-01   +4.980627718547510e-01; +9.421210062090121e-02   -1.534465572129789e-01   +1.288808407038626e-01   -1.212241134110819e-03   +2.922913129560074e-01   -9.059384892137121e-02   +1.120243924602080e-01   -1.976462094764553e-01   +3.592823103262179e-01   +1.232960746478834e-01   +1.543688451890117e-01   +4.830401035649097e-01   +2.251912143637013e-01   +6.782364161353337e-01   -8.232977001462385e-02   -6.520319842976230e-02; -1.302842655573564e-01   +3.787138486193910e-01   +1.908196378213440e-01   +3.746494983031947e-01   -8.388335544848601e-02   +5.656888294829691e-01   +3.980298670152331e-02   +5.935549558852766e-01   +2.515348916812568e-01   -2.542860265924157e-01   +2.992634388018144e-01   +2.092587927649164e-01   +6.597888386998573e-01   +3.239605535518558e-01   -2.412400531494639e-02   -9.467361787482727e-02; +1.596674369756891e-01   -9.298753640960933e-02   +5.116658761799174e-01   +2.906395678173084e-01   +7.938418078640797e-01   -4.406063349906006e-01   +7.743594470659462e-02   -6.925852058096260e-02   +6.478065744206447e-01   -3.172196179149600e-01   +2.115244888141133e-01   +4.245147616656725e-01   +2.677631120590500e-01   +2.518877513097323e-01   +3.579690344257453e-01   +7.692023749543866e-01; +1.714548958219954e-01   -3.677866931247397e-01   +1.709941851092348e-02   +4.670283636025738e-01   -4.943406425491975e-02   +1.828250518510101e-01   -2.400144791374800e-01   -1.482481290430448e-01   -1.943141860017067e-03   +2.130017911871739e-01   +2.706394912851268e-01   +4.301374674611425e-01   +6.889642228149393e-01   +1.452699968204294e-01   +1.700956148697024e-01   +1.046657191427233e-01; -7.276409933521621e-02   -2.029986677025753e-01   +4.593379023116727e-01   +3.113578772632417e-01   +3.303160071827477e-01   -2.614406968898152e-01   -3.334609884049984e-01   +6.638600144457936e-01   +7.559982573031505e-01   -7.789127798560433e-03   -1.544963415076957e-01   -3.230013648969599e-01   +5.672367637154575e-01   -1.005522550506344e-01   +5.470387289968774e-02   -6.115106280493581e-02; +1.903292644326604e-01   +5.023214105190932e-01   +4.981192022616628e-01   -2.219906476247603e-02   +3.339863248694951e-02   +3.007664620676518e-01   +2.821992883798781e-01   +2.590070605282682e-02   +3.592265818001957e-01   +2.272380296060476e-01   +5.355939157179181e-01   -2.157233620745375e-01   +2.703265519977428e-02   +5.996335009678952e-01   -1.024213097751326e-01   +2.019769893369642e-01];
L2I_L2E_iAMPA_netcon = [-1.240363376650546e-01   -2.654832789078064e-01   -8.228137926579471e-02   +4.758637457228033e-02   +1.459173633659075e-01   +1.228632868747002e-01   -1.930157114564839e-01   +5.462418947890230e-01; -3.155332332836036e-02   +3.243431183664824e-01   +6.416294190357872e-01   +2.311534359364107e-01   +4.003410125677450e-01   +5.575802010553267e-02   +2.553160925798967e-01   +4.746146967261918e-01; +4.003628807675659e-01   +6.989430647720564e-02   -2.324968937043404e-01   +1.993368067461108e-01   +2.785332885993909e-02   +2.852734716639119e-01   +4.037948085814265e-01   +4.663899723727490e-01; +2.109453020155064e-01   -4.303989410578067e-01   +1.163799821955565e-01   +3.867781870981937e-01   +3.781066971583993e-01   -3.510208265800756e-01   -1.925074637424327e-01   +3.579967582440852e-01; +4.178284940256689e-01   -2.287317955061056e-01   -1.381158668361325e-01   +7.617129847076334e-02   +3.298002586399750e-01   -9.520492221061617e-02   -3.232462624970067e-02   +5.671422562802289e-01; +1.736587099728061e-01   -2.049315198178353e-01   -9.107670861382597e-02   -1.732490052240516e-02   -2.920857835764786e-01   -4.802746213881935e-01   -5.452588041227147e-01   +1.800071223036252e-01; +8.413509343607471e-01   +3.117099588804626e-01   +2.255058086910372e-01   +6.707028868690372e-01   +4.958449931296994e-01   +1.068286769558075e-01   -3.311064161926037e-01   +6.992133808252186e-02; +1.281139709317921e-01   +3.481039693569722e-01   -3.869310133370877e-01   +1.380102588000637e-01   -4.312210451168319e-01   +3.379018859254906e-02   +9.321389083401163e-02   +1.337791899482463e-01];
L2E_L2I_iGABA_netcon = [-3.243573106893342e-01   +7.177926764002641e-02   +3.868242856131372e-01   +1.624281776660791e-01   -9.293765613688360e-02   +2.815898998081103e-01   +6.324617494252018e-01   +1.808663983854136e-01; +3.465727694843369e-01   -1.729624773660877e-02   -7.278454003779211e-02   +2.593057017853576e-01   -8.518589185105496e-02   +2.023277832832729e-01   +7.798980629323089e-02   +6.967532736608248e-01; +4.821261861620592e-01   -2.065612566221968e-01   +4.599733738035225e-01   -3.188062376683224e-01   -3.553767793600288e-01   -1.867272184348033e-02   +3.629801811763687e-01   +2.171020715202185e-01; -3.470915116968385e-01   +2.900977991479254e-01   +2.035964663666064e-01   +9.084528248297448e-02   +2.420615260595516e-01   +3.433213516444606e-01   +8.339690326076032e-01   -6.742433548650470e-02; +2.667166748453573e-01   -3.469210514792241e-01   -3.503205666890716e-01   +2.942297959261414e-01   +5.429562413868624e-02   +9.242305680822499e-02   +4.015517255297781e-02   +2.428582669761438e-01; +2.723926317212583e-01   +2.201067803912655e-01   +1.868245288861730e-01   +2.359436575502956e-01   +5.407739200876066e-01   +3.421712698754037e-01   -9.302609043810625e-02   +1.417936101389350e-01; -1.489646101790298e-01   -8.721114103314570e-02   +3.795021157579122e-02   +5.678925095160058e-01   +3.842698082325166e-01   +6.045430197757785e-01   +4.795112814581565e-01   +1.333085013835589e-01; +3.331502428640843e-01   -2.150822258622735e-01   +1.414621645161023e-01   +5.924278129448597e-01   -8.125683601652600e-02   +3.304222001528330e-01   +5.433847510769639e-01   -1.158542184276114e-01];
L3E_L2E_iAMPA_netcon = [-1.832733048372232e-01   -1.528682355044285e-01   +2.041195464406425e-01   +3.911865097460523e-01   -1.770663003547621e-01   -2.336209298159124e-01   +9.894667462882437e-02   +1.736988986561054e-01   +1.678652412712379e-01   +1.665344229990575e-01   +4.665398226245027e-01   -1.314890101771123e-02; -5.744662664875105e-02   +2.289823461895425e-01   +3.074776133932271e-01   +5.000463203179887e-01   -1.192842931072263e-02   +2.840118275735056e-01   +5.609642841018132e-01   +2.702875271167784e-02   +6.359741219738006e-02   -9.040518431322081e-02   +5.476253865934555e-01   +3.604906841054280e-02; -3.339859777635751e-01   -8.296320983572433e-02   +1.749988014569511e-01   +7.281249388768740e-01   -1.311155546968672e-01   -5.624643066335473e-01   +2.883357411641322e-01   +8.648958315906172e-01   +1.628655885713817e-02   +5.809397230435642e-01   +3.553187831619949e-01   +3.304415725764143e-01; +3.922412575569573e-01   +6.887040161774052e-01   -1.809261575281018e-01   +3.341773925679881e-01   +1.228513647938351e-01   +3.145120595882520e-01   -4.086396084394557e-01   +5.994088713376087e-01   -1.957233721465684e-01   +7.375710686919673e-01   +4.202834854118902e-01   -7.915559502052440e-02; +1.956857823571013e-01   +4.582774245584174e-01   -3.182705391347774e-01   -1.703073283414338e-01   -2.478931697525420e-02   +1.426272517918649e-01   +5.799731975767126e-01   -2.699109948676309e-02   +5.917558132531443e-01   -2.562717333092386e-01   -3.943925505535591e-02   -2.391345926575879e-01; -4.539421828599031e-01   +2.655209185628589e-01   +3.929175957676956e-01   +2.055997939311122e-01   +1.151669809386021e-01   +1.199184217894249e-01   +7.563488337553864e-02   +6.696133861690270e-01   -1.914478475942347e-01   +5.128858896016916e-01   +5.687591803219908e-01   -2.864208311952589e-01; -1.749799964993139e-01   +1.229724506242425e-01   +4.333316092846637e-01   +7.606255430776232e-01   +1.073393110479590e-01   -3.880736552924570e-01   +2.977332396459630e-01   -5.354620771239087e-02   +4.473168153436454e-01   +6.737047485315313e-01   -5.985416679489530e-01   +7.618991028297902e-01; +2.924858230815538e-01   +5.200371696986639e-01   +3.795196706601817e-01   +3.118862899524035e-01   -2.687239745294938e-02   -2.724577561508641e-01   +3.843338817680135e-01   +6.422788229568402e-02   +1.012435953673822e-01   +6.609934024855870e-01   -1.093937875739367e-01   +1.955912924766953e-01];
L3I_L2I_iGABA_netcon = [+1.917651486814534e-01   +2.028150862794792e-02   +1.857143734523659e-01   +3.626082023390553e-01   +2.794566453732590e-01   +2.981090681757678e-02   -2.537307032760041e-01   -1.993854746884403e-01   -2.862622110130569e-01   +5.131580069020895e-01   +4.174683670171315e-01   +3.347521369174328e-01; -3.601102574978540e-01   +9.257092782451345e-01   -5.720025465655554e-01   +7.716383597977200e-02   +2.922805847934174e-01   +3.074399617783261e-01   +1.566587098614888e-01   +5.810481951350643e-03   +4.518796839371147e-01   +7.228603815619802e-02   +4.521910584729982e-01   -1.528912198068335e-01; +1.708587764314518e-01   +6.683509263997348e-01   -1.526502954917202e-01   +2.184846266082858e-01   +1.804834299493780e-01   +4.865606627835322e-01   +4.991456305140852e-01   -7.190022324349721e-02   +1.201102731336561e-01   +5.993565987252141e-01   +4.325971410757029e-01   +2.054696180381724e-01; +2.034149250774212e-01   +2.843290852462109e-01   +2.430157151975013e-01   +3.210824644733513e-01   -1.270399632702259e-01   +2.726987831442715e-01   -1.912634234626728e-01   +7.200225156445915e-01   -1.946261875820254e-01   +1.218343426748435e-01   +2.992908367702750e-01   +4.544366846857802e-01; -4.284758795545162e-01   +1.749767439107391e-02   -5.430749978705377e-01   +2.604580706811261e-01   -4.855112504502310e-01   +3.535875731357556e-01   +1.828486453702252e-01   +6.067649843936888e-01   +3.328210293587980e-01   +3.259296966934865e-01   +4.530265454970901e-01   -2.447614369734974e-01; +6.668074194086613e-01   +1.977724586525718e-01   -2.292524898534094e-02   +1.399698310380066e-01   +2.281734632813454e-01   -1.691219738284211e-01   +3.541198613462394e-01   +2.608181068105417e-01   +4.003675965004348e-02   +2.680650769834054e-01   +1.878735630231618e-01   -1.701524961323641e-01; -3.907967467423599e-01   +3.923877849327085e-01   -3.380383108526942e-02   +2.396809681681832e-01   +5.118340018606556e-01   +3.939049556382248e-01   -5.895040860306258e-01   +4.283904876929087e-02   -5.565663940963360e-02   -5.265165727287786e-02   +4.508847616947892e-01   +2.539382074924941e-01; -1.414907485073447e-01   -1.368057867998569e-01   +2.353101760249558e-01   +7.862464075299191e-01   +1.010755461402582e-01   +1.432277287863424e-01   -2.869314853825305e-01   +5.579076641440150e-01   +5.831976009050210e-01   +4.697721102484992e-02   +1.053653170506297e-01   +4.939266482706310e-01];
L2E_L3E_iAMPA_netcon = [+1.947314954654855e-02   -3.300585083349573e-02   +3.971312077834545e-01   +2.875122875814061e-01   +1.825568335114315e-01   +1.334121180668346e-01   +4.893155960003991e-01   -4.210030130784470e-02; -1.657862685999789e-02   +2.550388063855677e-01   -1.932308129246556e-01   +3.559990276938571e-01   -1.171119834538158e-01   +4.977721702443148e-01   +3.973523831316189e-03   +3.593917834052150e-01; +8.322686657362789e-02   +4.762643339698761e-01   +5.032589808253424e-01   -1.083299686114050e-01   -2.145026113518016e-01   +1.819713140388415e-01   +3.332800550916588e-02   +7.174765183016114e-02; +9.516145410917454e-02   +5.027774617761311e-01   +2.838737233823101e-01   +5.674716613878092e-02   +4.423024021492776e-01   +1.924110637512766e-01   +2.500220885783316e-01   +7.687298547464126e-01; +2.352747805153554e-01   -2.131121638545774e-02   +1.899381670211432e-01   +5.636205691176330e-01   +3.073802165998997e-01   -1.371520039507692e-01   +4.824442538887286e-01   +1.873383998301130e-01; -4.008370104863912e-02   +1.930109962695157e-01   +1.221528537445723e-01   +2.974521375516798e-02   -6.987850514089128e-02   +1.393544491292374e-01   +1.246644896359848e-02   -2.071656450928194e-02; -3.618995211147121e-02   +4.859932218978733e-02   +4.033059987235916e-02   +2.369496746579738e-01   +6.885304392051807e-02   +1.645732419030373e-02   -2.914695883526180e-01   -2.637973660880231e-01; +3.483767105246289e-01   +9.527845655681311e-02   +4.559590740778618e-01   +1.894785237981693e-01   +4.287066957943648e-01   +7.306019049316528e-02   -1.665523114433237e-01   +1.962017833677694e-01; -2.325652207407358e-01   +4.008422691092330e-01   -1.413863955213323e-01   +1.272530255411783e-01   +3.431804471984208e-01   +1.456469502126787e-01   -6.663678620202132e-04   +8.011952870618347e-01; +2.385226600044124e-01   +4.135434648416326e-01   +2.551255580050579e-03   +8.579099124952527e-02   +2.097638537046594e-01   +3.351023501478886e-01   -1.651470507479280e-01   +1.640805686334423e-02; +2.743369329551713e-01   -1.457119801290983e-02   -3.534255558681382e-01   +3.081050025691254e-01   -9.546543234554319e-02   +3.385223483554877e-01   +4.037394240120744e-01   -1.281797362575454e-01; +1.420291495433041e-01   +1.309753450404262e-01   +1.076830982886357e-01   +7.955424263482286e-02   +3.777464619227573e-01   +2.592635539824342e-01   +2.995477969496897e-01   -1.449079566812889e-01];
L2I_L3I_iGABA_netcon = [+1.154565119995432e-01   +2.167300671363675e-01   +7.027014580671043e-01   +2.362324004597552e-01   +2.424398718423607e-01   +4.486532451003341e-01   +1.459872050007866e-01   +2.151852208535035e-01; +1.028358308445813e-01   +1.604763525063233e-01   +8.613184191367212e-02   +6.002536390659261e-01   +3.019630071941399e-01   +4.185384009730145e-02   +1.532240355303801e-01   +3.447744263802393e-01; +5.032052902692223e-01   -3.571855535606266e-01   +1.804114757749942e-02   +2.292880206124389e-01   +2.064060480946370e-01   +4.993618007448511e-01   +2.869289559375258e-01   +5.227344458702098e-01; -3.474701847370316e-01   -1.418711721901849e-01   -3.046506581781578e-01   +3.174273063039267e-01   +4.662754724204615e-02   -1.806992162163771e-01   +3.174869667058506e-01   +2.064982631663840e-01; +5.089030709752367e-02   +4.725875813922345e-01   +3.201410728161559e-01   +1.725044935227323e-01   -3.706147600774806e-01   +4.708133692154151e-02   -2.667407611728079e-01   +4.256154063462769e-01; +1.131645385780882e-01   +6.911694181741116e-01   +8.735126444324643e-01   -2.166079999080739e-01   +3.323099955391832e-01   +2.765525581674796e-01   +8.320850275685467e-02   +1.235359566177898e-01; +6.577670135802439e-02   -1.660045643355987e-01   +5.615070589407910e-01   -3.451750218464019e-01   -3.984842640434086e-02   -3.042065545058386e-01   +9.254293051038656e-03   +4.036236919964630e-01; +2.474036080126821e-01   +4.593801662756415e-01   +1.281533463458119e-01   +2.805275087783671e-01   +8.506453123553703e-02   +3.507787410986827e-01   +5.468075599674161e-01   +6.884021183270927e-01; +5.036123347327777e-01   +3.208916716855164e-01   +4.666971361867059e-01   +4.378030807751500e-01   +8.036675120432134e-02   +2.886569352012885e-01   +3.188457695013598e-01   -5.061397899861812e-02; +8.823903392286764e-02   +5.063682800325437e-01   +1.350198712411937e-02   +1.647154421464943e-02   -2.345845300017417e-01   +8.234611835894851e-01   -4.530386895357788e-02   +7.635460020660889e-02; +3.583986090830172e-01   +2.233705645084026e-01   +3.600228700370427e-02   +4.075743690027465e-02   +2.621866622676449e-01   +1.111527074124632e-01   +2.941808928255415e-01   -4.325344936465235e-01; -2.427328294726768e-01   +4.161649017258085e-01   +1.299641015656810e-01   -3.611258968857139e-03   -4.665765897623000e-02   +1.882226236097345e-01   +5.266186761185886e-01   +5.039744697074257e-01];
L3I_L3E_iAMPA_netcon = [+7.943593303122676e-01   +2.627560051231457e-01   -3.247675164145122e-02   +7.958018986654611e-02   +4.482139681066892e-01   +4.655656395489804e-01   +4.723802006733280e-01   -1.121168714061979e-01   -5.809799432789008e-01   +3.858581263502672e-01   +2.781876472747542e-01   -2.144717280029691e-02; +2.109472166709685e-01   +6.974170549235881e-01   -1.725537087052937e-01   +4.030053564819488e-01   +4.107080965696537e-01   +1.676710179251039e-01   +1.506091718556199e-01   -9.628856557799184e-02   +1.278473169347180e-01   +8.328715814968679e-02   -1.568688214141641e-01   +6.360710541395072e-01; +1.822455623346260e-01   +2.676419877188203e-01   +2.846192260395043e-01   -2.296012625904008e-01   +2.909201820726649e-01   +7.209580454818928e-01   +3.096128310922696e-01   -1.670453640774696e-01   +3.139734957951027e-01   +2.372702503997376e-01   -5.420374801572878e-01   +4.669436840214223e-01; +4.794050491616612e-01   +2.157830376858083e-01   +8.920293645598945e-01   +8.424882381661905e-01   +7.982309780150830e-02   +2.928152565192911e-01   +7.243102721767833e-01   +6.334630621016828e-01   +1.297390875656845e-01   +1.318512547983799e-01   +1.244012935801789e-01   +3.246028188886362e-01; +1.874083446003409e-01   +1.872874853737561e-01   -2.158528698836213e-01   +5.981325772986813e-01   -2.326176018380054e-02   +2.099613167271059e-01   -1.520114053393368e-01   +3.201192046855200e-01   +3.682373710085486e-01   +1.972233923690491e-01   +8.314309220333704e-02   -3.126694164155321e-01; +2.214938259098737e-01   -5.077545791543880e-01   +1.897013461157666e-01   +3.628724475004407e-01   +1.801551276451119e-01   -1.614867667714893e-01   +1.929055980023223e-01   +9.113326968238103e-02   +5.408629983546477e-01   +6.288470141506295e-01   -2.294426186109590e-01   +2.081419932594953e-01; +5.424747327199983e-02   +5.858067491720211e-01   +2.364669638065238e-01   +5.621635726636354e-01   -3.944261068998509e-01   +6.404411203188011e-02   +4.865185745845220e-01   -1.903964542482889e-01   +1.561220020597664e-01   +1.460643202451539e-03   -8.518387365333875e-02   -2.866058714892764e-01; +3.856817905597514e-01   +6.312405839793529e-01   -6.030549541017857e-02   -3.306479207619787e-01   -2.186787942779215e-01   -1.815535628397966e-01   -1.552326444316822e-02   -1.318472599652986e-01   +3.291651666864772e-01   +1.681763023728525e-01   +4.252737460102718e-01   +3.208508500401551e-01; +2.650433544619842e-01   +2.567853588970029e-01   +5.093258820978764e-01   -1.505236720244924e-01   +3.948154082451601e-01   -6.054822197801760e-01   +1.369590815978530e-02   -2.616428669930555e-01   -4.562573230145241e-01   +4.705827449071978e-01   -2.023937400908065e-01   +2.981387945721600e-02; +3.566033186871633e-01   -6.947021712653156e-02   +3.034156695655320e-01   +6.048233032083597e-02   +1.860538944224529e-01   -1.761873115511426e-02   +2.542151943956933e-03   +2.174950127151030e-01   -8.197223158174888e-02   +1.948131408866972e-01   -1.328035046314122e-01   +7.043885983682489e-01; -5.725378907215345e-02   +6.898174040743852e-01   +2.001409800508603e-01   +3.472593650123636e-02   +1.852442791678070e-02   +3.049003617586726e-03   +2.103170009052811e-01   +1.332926052041802e-01   +5.780606722280811e-01   +6.597884390270663e-01   +7.550621123308481e-01   +2.219818655113806e-01; -2.614511010605635e-01   +1.155332621702329e-01   +3.377231960657757e-01   -2.700298901769248e-02   +3.752452881626567e-01   +2.038082279250342e-01   +1.016833567495993e-01   +5.464048109782965e-01   +3.077605448232057e-01   +1.767393113645909e-01   +3.504753993439810e-01   -3.102669739882177e-01];
L3E_L3I_iGABA_netcon = [+3.922362053553354e-01   -1.921422358911490e-01   +4.983021280653047e-01   +1.959224785565579e-01   +7.673014469706005e-02   -3.321984765008742e-01   -1.067834255960176e-01   +4.742021098455963e-02   +4.430851512250246e-02   +1.467362320119087e-01   +3.967825977967574e-01   -3.780832697186449e-01; -2.173210514470026e-01   -4.242285280405463e-01   +3.348993734095507e-01   +3.462601708233288e-01   +7.910528368486527e-01   +4.047505444687874e-01   -1.046819521593148e-01   +3.277399313875978e-01   +6.210066050930893e-02   +6.559725314848506e-01   +5.578213975203424e-01   -3.036273625299782e-01; +2.661045736360899e-01   +7.478206474494693e-01   +3.885674217871899e-01   +6.426137490675086e-01   -3.212915859731778e-01   +2.200769065781756e-01   +1.014868509943285e-01   +5.787763049171232e-01   +8.454836718909867e-02   +3.966702540796676e-01   +3.343403272796142e-01   +1.423559305312236e-01; -4.322651587490904e-01   -3.984813972319479e-01   +6.397056817265903e-01   +6.021738549468552e-01   +4.997088841569380e-01   +2.567864329018736e-01   -9.617203135145533e-02   -1.003872827504674e-01   +3.411482395877029e-01   +2.000729789948841e-01   -2.258570978140464e-01   +1.518995776408929e-01; +2.861282754127233e-01   +6.812243152540783e-01   +2.945307687224580e-01   +1.740420782111404e-01   +4.360071821131313e-01   +7.360816584698400e-01   +3.834996388724060e-01   -3.887938677173698e-02   -4.200125448158483e-02   +2.454772845262374e-01   +6.385381294811061e-01   +4.481053194285549e-01; +4.407705775004740e-01   +4.950518549437623e-01   +5.155273573671128e-02   -1.879478467386688e-01   -2.331344335433976e-01   +3.231904838077299e-01   -6.258975866091732e-01   +7.046227305598107e-01   +1.829253305165246e-01   +2.786577225735081e-01   +4.918718682308805e-01   +6.995753800659499e-02; +8.203268760357321e-01   +5.421129017945470e-01   -9.297628196159008e-03   +6.668653227439372e-02   +6.159046721534334e-02   -7.543644217697774e-02   +1.492999905860478e-01   +1.797828825888062e-01   +2.936557188037202e-01   +2.557283876502149e-01   +2.390409444172654e-01   -1.455901144452616e-01; -3.721364071151912e-01   +2.108182563674600e-01   +1.788400715580654e-01   -3.291031352479797e-01   +3.037462239442392e-01   +5.949930627944614e-01   +2.978666538682387e-01   +3.764449000221354e-01   -3.316051401426512e-02   +6.859262975255254e-01   -5.609938395124948e-01   -1.815345230931822e-01; +4.723393623299820e-01   +5.285644078478574e-02   -1.375726503433103e-01   +4.262192743202700e-01   +2.287632237546974e-01   -4.129342741627446e-01   +5.109195137533229e-01   +7.680184218323001e-01   -6.626628296251380e-02   +4.944098866513523e-01   +3.416532381922087e-01   +8.004327392867504e-02; +4.375960331218724e-01   -7.631802558909809e-02   +5.557881921874331e-01   +5.000094123195896e-02   -4.079667842971275e-02   +8.015048965872276e-01   +3.151605386243835e-01   +3.568178734867917e-01   +2.974986590500073e-02   +2.411083190834027e-01   +1.224338493362359e-01   +2.307869777740867e-01; +5.625997896365391e-01   -7.795046111534730e-02   -3.543626780119588e-01   -1.907599097713747e-01   +8.356716708660875e-01   +6.936679308889475e-01   -1.886582499747077e-01   +4.487615396769060e-01   +3.828080227017715e-01   +6.963705342285133e-02   +1.969717986836230e-01   +2.518737974443704e-01; -2.939603242230382e-01   +2.146717846492362e-01   -1.182722987045301e-01   +1.680217511121427e-01   +3.124127821285920e-01   -3.711341636281504e-01   -1.781761542878559e-01   +1.480918385796384e-01   +3.630540032473696e-01   +2.902439627844624e-01   +2.940210247699276e-01   +2.977066056266492e-01];
L2E_Input1_iAMPA_netcon = [+8.342448321725849e-01   +6.289659257360125e-01   -3.303547175253921e-01   -2.455438515106026e-01   +1.949127744961437e-01   +1.807677173194791e-01   +2.554139457276540e-01   +5.747214455092896e-02];
L2I_Input2_iAMPA_netcon = [-7.026549296764932e-02   +2.005758517290299e-02   +3.733780019011130e-01   -1.833082631746148e-01   -4.144964349477306e-01   +1.194127549363616e-01   +1.724915814026988e-01   +8.261445195179046e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.4*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 1.0*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 1.0*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.4*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 1.0*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 1.0*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
