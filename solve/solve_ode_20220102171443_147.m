function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-7.141440828208375e-04   +6.772957716748334e-03   +8.783497738052731e-03   +1.327103630781373e-02   +1.831709923441628e-03   +6.662120412556580e-03   +1.823480461000458e-03   -1.132138733341472e-03   -4.788159796581811e-03   +8.230773498193233e-03   +7.530872958166506e-03   +1.783392134611910e-03   +6.401346202682696e-03   +4.573632903176178e-03   +4.941004406403004e-03   -6.900322890999384e-03; +4.739976424939866e-03   +8.562374706663103e-04   +7.620563229485050e-03   +1.030229700259779e-02   +5.983126496889532e-03   -1.857126074005931e-03   +9.596944188675042e-03   +3.132707219793806e-03   +3.771719250250556e-03   +8.457744629004711e-03   +8.932096595431647e-03   +1.616628798111376e-03   -4.419618324352841e-03   -4.809109623104768e-03   -6.645478146098081e-04   -1.230809648773061e-04; +9.111553819141896e-04   +6.096473748912295e-03   +5.245330231376622e-03   +6.246425047379817e-03   -3.892839683606871e-03   +4.024771165672143e-03   +1.045941620702323e-02   +8.255231609854876e-04   +4.175950036683562e-03   +4.090479344999610e-03   +7.325646606554120e-03   -4.389751553477365e-03   +5.879912392242659e-03   +1.868472135235433e-03   +5.754762308635407e-03   +3.801571834168735e-03; -9.845698187234220e-04   +2.900945322099565e-03   -2.926922411231185e-03   +2.989973904052343e-03   -1.614471077291237e-03   +3.920351628635264e-03   +5.757591172074818e-03   +1.473737213453800e-03   +9.192827150378800e-03   +2.456789345809494e-03   +8.382726686141045e-03   +6.397170575721531e-03   -3.087697090278135e-04   +9.062833976535739e-03   +1.255311046371732e-04   +4.384207309177578e-03; +3.396372233725971e-03   +1.921838098893023e-03   -1.088922838488904e-03   +4.901667696644743e-03   +1.076563271455270e-02   +5.011604308238543e-03   +1.724867626677406e-03   +2.378619332507328e-03   +3.809390493073972e-03   +1.154369614954059e-02   -1.460860198029882e-03   +6.229481810149554e-03   +9.956086161048068e-04   +9.181610386116151e-03   +6.706598014511040e-03   -1.574693561787624e-03; +9.414068788775258e-03   +2.623361880648939e-03   +1.694203152181566e-03   +3.017803432819659e-03   +3.915411169401872e-03   +1.308086580535551e-03   +4.323118036805104e-03   -5.595551717930443e-03   +8.080376379172039e-03   +6.553757161967509e-03   +4.922450383664472e-03   -1.939903134924333e-03   -2.505269918956138e-04   +3.115758935203947e-03   +1.052487404392663e-03   +8.406606401407210e-03; +5.216407645838537e-03   +4.540276494147769e-03   +3.951178119818925e-03   +7.489226621623235e-03   +8.286730285671447e-03   +3.445673984088328e-04   +6.041969820942079e-03   +8.644615957577978e-03   +7.651596297737289e-03   -2.447775661954497e-04   +3.993344899355909e-03   -3.893044542401048e-04   +2.480140986922810e-03   +1.026450293561840e-03   -2.049743897127345e-04   -2.910868127823140e-03; +4.327753836237761e-03   -7.170791715700791e-03   +6.830759956791218e-03   +5.102872684156633e-03   +4.342983719740355e-03   +7.805691312228534e-04   -2.935291204404290e-03   -9.048605470883147e-04   +5.889465056910067e-03   +8.707776061001298e-03   +3.435907453914791e-03   +1.009984873581990e-02   +9.461390360548175e-04   -2.259323772761037e-04   +6.464605238936258e-03   +6.964630099005334e-03; -2.559688746431664e-03   +5.565875443367094e-03   +4.811243386636091e-03   +5.903756793160084e-03   +4.057243133005052e-04   +7.194964203218621e-03   +2.626061683046045e-04   +5.703007512790442e-03   +6.465359993665141e-03   +3.382563021187184e-03   +5.508557309070585e-03   +4.834395887892097e-03   +4.016559854174312e-03   +7.302807834843213e-03   -6.572158320810949e-03   +6.500775993360396e-03; +1.532132910189319e-03   +7.225005489334581e-03   +1.658266518220548e-02   +8.401143105117323e-03   +1.046889680481923e-03   -3.522214371566025e-04   +1.999078558269595e-03   -3.624375007089213e-03   +4.882609530697598e-03   +3.649409821800143e-03   +4.721072624073416e-03   +4.649797498598903e-03   +2.205442446018913e-03   +4.621809175083889e-03   +1.250547079867802e-02   +8.306443375877808e-03; +8.651112170240758e-03   +7.246650615994098e-03   +8.492890902140499e-03   +8.779328906015509e-03   +1.789297508797832e-03   -2.073676089882659e-03   +9.249908976756578e-03   +1.016765149472665e-02   +5.179618761665322e-03   +3.756369499017240e-03   +7.461697983805315e-03   +4.215855199399061e-03   +4.406926311876205e-03   +5.830229768566660e-03   +8.154637876699452e-03   +4.255867337811155e-03; +4.966983819304914e-03   -4.878905281062695e-03   +2.013581592201571e-03   -1.048510835326897e-03   +5.331521253237225e-03   +9.455394522891344e-03   -6.078133941074341e-04   -2.072788583749350e-04   +4.056318435410641e-03   +3.964281613502662e-03   -6.267597401477702e-03   -3.325733636854476e-03   +4.391229691800865e-03   +2.109944583429170e-03   +2.109441125526284e-03   +1.948580713741163e-03; +4.266355962861456e-03   +3.648076194959667e-03   +4.279613201493649e-03   +2.185027330296140e-03   +1.285821362770883e-02   +4.598550426122559e-04   +4.400466548319927e-03   +1.469047172570292e-02   +5.697178293686383e-03   -4.754469186837332e-04   +3.451487144708518e-03   +1.069996315575919e-03   +6.749513517773334e-03   +3.752529896455546e-03   +4.256452564358049e-03   +7.540341273214879e-03; +4.136043847298239e-03   +9.254848740057794e-03   +7.941914824853223e-03   +5.027460646319793e-03   -2.758055795305161e-03   +4.950270525991086e-03   -2.534016250520173e-03   +6.721673107855245e-03   -1.230819316124800e-03   +6.513778579440568e-03   -1.379806834889594e-04   +1.034943030592648e-02   +7.186273855786457e-03   +5.031730915885671e-03   -2.846327435948530e-04   +3.797471343846223e-03; -2.314357213121511e-03   +9.435477439752312e-03   +8.171570147237262e-03   +8.256710119737273e-04   +1.596643141270002e-03   +2.152315425151053e-03   +2.082565382900433e-03   +2.144126033621063e-03   +1.479332184887007e-03   +1.017619633444428e-02   +2.102532839207984e-03   +3.072160026523730e-03   -2.492251176221332e-03   +1.432031681612937e-02   -2.409385189486020e-03   +1.661941297323787e-03; +5.667355189328612e-03   +1.049554520649280e-03   -3.072144001898902e-03   +8.231612869967294e-03   +3.224302557658298e-03   -4.541710859335963e-03   +7.630762270007183e-03   -5.024736346535875e-04   +1.335864283445990e-03   +8.564609526322103e-03   +8.337664799712501e-03   -7.102368301551169e-03   +2.597900925972323e-03   +4.058806121212881e-03   +1.100326956044225e-02   +9.963745661358304e-03];
L1E_L1I_iGABA_netcon = [+4.660522145783745e-03   +8.192569530760054e-03   +3.085294806251916e-03   +5.725055791857821e-03   +5.414437842533303e-03   +4.884575074467687e-03   +8.045646344623956e-03   -4.589236550726157e-03   +3.043410640818992e-03   -2.704433040510120e-03   +3.229800490448711e-03   +4.756717519395113e-03   +9.942058381346859e-03   +1.122709149266410e-02   -9.215405611166592e-04   +6.029932367827054e-03; +2.220430229215089e-03   +1.455424624849489e-03   +7.535581639678841e-03   +6.996820780600451e-03   -1.534134436410148e-03   +1.706051323952328e-03   +4.165777366298849e-04   +8.724367540451793e-03   +5.830129805314757e-03   -7.478188949892519e-03   -3.691216885389551e-03   +9.211829199080722e-03   +3.877123850240394e-04   +3.165528026678462e-03   -2.102716749219173e-03   +4.793865954371131e-03; +6.838189779478301e-03   +9.978490893750483e-03   +3.287557052710146e-03   +2.738425950002047e-03   +3.124904009878336e-04   +3.302070532340943e-03   +5.264950782919121e-04   +1.363267955232220e-03   +4.166499016435803e-03   +4.628715144320747e-03   +6.925269856614488e-03   +5.201315174557179e-03   +7.362095442723063e-03   +8.464575337116868e-03   +3.965501253461688e-03   +7.911160071243473e-03; +1.053416909519549e-03   +4.366983254567720e-03   +1.070987694169359e-02   +1.496305339215186e-03   -4.104326788591360e-03   +6.794012633616456e-03   +5.401980565667232e-03   +7.487905661434579e-03   +8.939016580794133e-03   +6.724083667426397e-03   +1.051121339819164e-02   +2.228897286626916e-03   +4.385728474533542e-03   +4.595979220690611e-03   +3.828518309361101e-05   +7.957793459335184e-03; +3.294535496720869e-03   +9.328454844095843e-03   +5.468538574966340e-03   +6.053122496086551e-03   -1.156174646008472e-03   +6.322861083472085e-03   +5.648556825738099e-03   +7.118562519401676e-03   -1.287308111314302e-03   -1.182974611666701e-03   +6.510453601968181e-03   +1.458926567212637e-03   -5.120808969277004e-05   -3.854219139839671e-03   +3.362126999866271e-03   +5.479324671504297e-03; +7.139210893207877e-03   +5.503202176435973e-03   -4.636628630978368e-03   +8.536287994501013e-03   -3.948602846305444e-03   -3.134577737167889e-03   +1.111376868910394e-02   +4.682661707979258e-03   +5.333303462167341e-03   +1.596435893939325e-03   +1.098022191543026e-02   +1.395780623013030e-03   +5.846465679918722e-03   -2.359513502111535e-03   +5.236165851858613e-05   +5.285894567984746e-04; +5.358846573619942e-03   +1.580463295281640e-03   -7.255212997303324e-05   +5.088898621134389e-03   +6.810137039546085e-03   +5.607890205374614e-03   +6.804157032246457e-03   +6.854301494036459e-03   +4.187428883627098e-03   -1.476722432058936e-03   +7.992905315251203e-03   +1.096621796333072e-02   +5.582517248436699e-03   +5.096861706597481e-03   +3.897303383347533e-03   +1.836572044717469e-03; +4.815973375264766e-03   +1.847173241979668e-03   +9.437716394694923e-04   -1.881971390404417e-03   +5.726139439231179e-03   +2.449108485158933e-03   +1.010614583603191e-02   +9.051649636959229e-03   -7.212678931605116e-03   +2.590815537715037e-03   +3.614650762544645e-03   +4.810988456991619e-03   +2.958279323228972e-03   -1.335952377576059e-03   +5.915058302971423e-03   +7.026493598698558e-03; +5.931021487349382e-03   -3.359053253959958e-03   +1.227374255155292e-04   -5.775276818986846e-03   +6.802126738330448e-03   +8.484503385761299e-03   +1.305102779671285e-02   +9.636823150365329e-03   +3.238787756746755e-03   +5.346449578528086e-03   +8.263642224237876e-03   +3.376176307336119e-03   +6.212486245740552e-03   +7.419555989785622e-03   -1.167206991767361e-03   +5.665685290015688e-03; -2.473236850941684e-03   -7.636701738921265e-04   -5.079274550341827e-03   +6.503548739379001e-03   +4.168254971010634e-03   +1.256686579845348e-02   -1.469882749507425e-03   -3.214207992284036e-05   +7.581867270856823e-03   +8.740506645965079e-03   -1.412896898043189e-04   +1.324091629857629e-02   +9.046227599059334e-03   +4.486343116684407e-03   +9.270873217233961e-03   +6.016616480248356e-03; +9.231730129753622e-03   -4.160241357406304e-03   +3.530874629906198e-03   -3.449666299675294e-04   +6.412815004942105e-03   +1.642613066200534e-03   +9.645430055970818e-03   +1.077986609551558e-02   +2.655771808947914e-03   -1.982436600134885e-03   +5.131441184459852e-03   +4.969920667729773e-03   -4.363426212428371e-04   +7.330033166270469e-03   +2.961962117316590e-03   -2.175247518944143e-04; -6.292704457498100e-04   +7.048537319518954e-03   +1.056179211466241e-02   +2.700749849126744e-03   +1.806441653890411e-03   +1.282057145744986e-03   +1.403038684258197e-03   +3.231990844465013e-03   +5.995618224413529e-03   +1.581741025424456e-03   -3.033940367319070e-03   +2.641637316899505e-03   +3.719318142351467e-03   +4.630905540718086e-03   +5.142354466282753e-03   +1.021732229617422e-03; +8.881352555792787e-03   +2.307799112412929e-03   +7.244826641284311e-03   +1.673559313730604e-04   +5.496256038021783e-03   +1.173214193135288e-03   +5.773549750888540e-03   -3.119793379135192e-03   +5.829760858102788e-03   +2.499763080555572e-03   +1.757192417332386e-03   +6.574474420774137e-03   +6.195403858504148e-03   -8.912686531210975e-05   +3.247750220126439e-03   +5.078005722428584e-03; +1.454109735510875e-04   +1.347640207119833e-03   +8.344757052031470e-04   -5.535140429599378e-03   -2.825846160318405e-03   +9.141157677348487e-03   +1.349800781178936e-02   +6.389020927260539e-03   +5.099018275535077e-03   +8.730213495484624e-03   +7.194463605403200e-03   +1.045952282615718e-02   +1.096793009030848e-02   +8.278042218348197e-03   +6.001068818601764e-03   +2.030403881660560e-05; +4.000120750648894e-03   -1.696642518222248e-03   +1.606671057064167e-03   +8.775495228383161e-03   +5.422479728834196e-03   +4.985767466532350e-03   +9.598080449736014e-04   +4.728820604685681e-05   +1.744671429369443e-03   +4.453726685107998e-03   -2.173160509193868e-03   +1.173760621484790e-02   -4.597227092133350e-04   -4.307474600120033e-04   +3.170552277942084e-03   +7.096359651970424e-03; +3.595020210152043e-03   +1.487095202741715e-03   +1.118451574711274e-03   +1.675237646461001e-03   +7.360666102932861e-03   +7.290707803154022e-03   +2.787581797984763e-03   +5.595220378229774e-03   +7.064663508119370e-03   +4.497249786501084e-03   +3.443098320092238e-04   +5.116280573762060e-03   +7.892352680335345e-03   +7.084432576144162e-03   +5.560670286896758e-03   +1.080000967921215e-02];
L2I_L1I_iGABA_netcon = [+9.078913979542540e-03   +1.988910518772092e-03   -1.070710768574151e-03   +1.249699318269335e-02   +5.789819458308955e-03   +6.734005860244995e-03   +6.468851778512533e-03   +6.774048910429598e-03; +6.220416592895140e-03   -1.804997746568482e-03   +1.662104947240137e-03   +1.853842848323601e-03   +3.202362886532920e-03   -8.220391685250011e-04   +5.091858072808538e-03   -1.775476359779006e-03; +1.189934147235968e-04   +1.938706279036971e-03   -4.481271953819501e-03   +7.829721306529825e-03   +1.122997606863771e-02   +1.462040509933496e-02   +3.513105868925257e-03   +6.973183186941183e-03; -1.190006256045672e-03   +2.997040119221404e-03   +6.924345514832377e-03   +4.789688152686950e-03   +5.406325169208442e-03   +6.015690427362806e-03   +4.877600002627971e-03   +1.034770311337864e-02; -1.923053388374235e-04   +5.324193562708522e-04   +2.889248494898895e-03   +6.272498348593826e-03   +3.517029087669706e-03   +6.597055386074807e-03   +3.729876532270815e-03   +1.406786312317083e-03; +1.294085674552275e-02   -2.448046207737808e-03   +5.080156154876544e-03   +8.392690519654611e-03   +7.335948000423287e-03   +7.013784656312116e-03   -1.058288752329568e-03   +3.909690989608628e-03; -2.372345431903087e-03   +1.335545341431022e-04   -3.053811609587743e-03   +4.321312790932581e-03   +3.603317535372430e-03   +8.881646955367060e-04   +2.753518750147244e-03   +7.984481704003912e-03; +1.021907671542628e-02   +5.815777057821834e-04   +4.097655321228906e-03   +7.603667395444867e-03   -6.075413215899188e-04   +1.185618439678945e-02   +2.390843186348345e-03   -4.167604019386546e-04; +2.153678954161327e-03   +2.592873455501140e-03   +1.451831352412069e-03   +2.531833462366751e-03   +3.432563032734727e-03   -4.103718566557361e-04   +2.510589548675560e-04   +9.208026076474064e-03; +2.792463930418532e-03   +2.603270300323098e-03   -4.324937754837293e-03   +3.717192002824366e-03   -6.929317114035856e-05   -4.465957910148171e-03   +7.458924187704372e-03   -1.345142005407332e-03; -9.048259135787144e-05   +7.901136860931373e-03   +9.060004146492932e-03   +6.079792095668887e-03   +8.378973293034914e-03   +5.848668638427605e-03   +4.365877527560799e-03   +4.394169806461335e-03; +9.256847154828551e-03   +4.809648371092649e-03   +3.972348404697534e-03   +3.432916008949041e-03   +1.231210425584060e-02   +2.259709586514630e-03   +7.365516264345094e-03   +5.594912498107781e-03; -6.962676547743214e-03   +3.962703448750285e-03   +6.972366938814367e-03   -4.672630156402306e-04   +4.463269285436304e-04   +1.245731347032425e-03   +5.885551765368644e-03   +7.324246295631439e-03; +2.204438387187279e-03   -1.820008908222198e-03   +7.893942305447994e-03   +3.389194181450761e-03   +6.450077112249682e-03   -1.918834300785913e-03   +8.527591648653621e-03   +6.469260100136210e-03; +1.754375549712829e-03   +2.094854942696910e-03   -1.502046349414912e-05   +6.722708948172128e-03   +7.865445824497629e-03   -4.006154706123132e-03   +7.355620650325436e-03   +1.271901286898484e-03; +1.071357046270830e-03   +4.378245053809427e-03   +5.558825544157229e-03   +3.567528362656204e-03   +1.048319266391537e-02   -2.286663481335291e-03   +5.841952419866457e-03   +1.737816132848220e-03];
L1I_L2I_iGABA_netcon = [+9.746156473328908e-03   +8.901031082907018e-03   +1.519214580317342e-03   +3.829882904892293e-03   +3.224100960442469e-04   +7.403426776924281e-03   +1.329605365035286e-02   +1.430910996677862e-03   +7.730898298604709e-03   +5.304988556524135e-03   -2.681637039750468e-03   -1.566178051003399e-03   +9.003928896486799e-03   +3.342098377268530e-03   -4.784953371038284e-03   +1.288873080883126e-02; +6.735134342404663e-03   +3.860112950495473e-03   +1.494752558610030e-03   +5.880292134941900e-03   +6.690649777213695e-03   +5.818172033957006e-03   +4.829266233511011e-03   +8.140151013367769e-03   +1.319986427598576e-03   +1.230809239593362e-02   +7.375172310848136e-03   +1.352175059228437e-03   +2.077441889471222e-03   +7.758790131736621e-03   +3.935032293065788e-04   +5.296733685703927e-03; +7.980254947301743e-03   +1.785243242623444e-03   -5.936967889866168e-04   +5.213550764807841e-03   -3.907501094774727e-03   +7.457823306647322e-03   +6.854512806463510e-03   +1.895225963783380e-03   +3.621362936951688e-03   +9.459538210566965e-03   +5.968972927156702e-03   +1.100409169352499e-04   +3.211783693537048e-03   +1.627258626558428e-03   +5.223423922846814e-03   +6.564242177200872e-03; -1.219341477744518e-04   -2.059403576966297e-04   +2.108981372171511e-03   +3.130926742394952e-03   +2.329543321297991e-03   -1.973611344923752e-03   +5.424811158118490e-03   +7.393701016636170e-03   +2.712682100618087e-03   +1.180482747550093e-03   +8.120355897506190e-03   +2.896918541075459e-03   +4.209596430867048e-03   -2.345508314889416e-03   +2.494440254059097e-03   +7.973352700765411e-04; +1.506747675794647e-03   +4.236250478878070e-03   +6.028143889000782e-03   +2.470734421212899e-03   +4.102269691479589e-03   +4.537123776317089e-03   +8.901915206810856e-03   +1.478770408688346e-02   +4.297791712874830e-03   +3.781788864528449e-03   +7.386947480197714e-03   +4.248210396618207e-03   +1.203908202585132e-02   +4.509017505413783e-03   +9.767339706146575e-04   +4.146432421166385e-03; +8.835386863441973e-03   +7.755646443857679e-03   -4.882135550119357e-03   +7.220267089960070e-03   +9.780453205868086e-03   +7.027891971474274e-03   +1.323765431740465e-02   +4.841442610955520e-03   +4.118352767575949e-03   +8.518234752917140e-05   +1.504737341058963e-03   +6.528792428425304e-03   +1.335693567360357e-03   +1.059352476464030e-02   +1.001376331717928e-02   +2.561154058180324e-03; +7.805479776412977e-03   +4.240729113139273e-03   +8.110288247997699e-03   +5.207306413585006e-03   +8.838598972958623e-03   +1.155312652569283e-02   +5.064159730892932e-03   +4.238961331480828e-03   +3.723469495716010e-04   +4.042220723714443e-03   +1.082365346542259e-03   -8.721272152613660e-04   +4.955044176392480e-03   -3.184633126813320e-03   +6.195488920730153e-03   +3.290487836244782e-03; +6.967739904092423e-03   +2.938931500193765e-03   +4.902284908260991e-03   +5.296352725417890e-03   -3.676555237455841e-04   +1.525783894520550e-03   +3.845484915889381e-03   +3.310763412786854e-03   -1.676877296034207e-03   +6.195340719579700e-03   -1.007013632660951e-03   -1.100464890861921e-03   +7.307941457735369e-04   -5.764991795497688e-04   +3.825296981867334e-03   +4.886633174984625e-03];
L2E_L1E_iAMPA_netcon = [+4.291086478700731e-03   +2.172875023321293e-03   +4.604421643259815e-03   +2.937207617923728e-03   -1.299570064975802e-03   -8.853476368634681e-04   +5.349014578356551e-03   +1.650480600370315e-03; +1.068745891826522e-02   +7.564286637840248e-03   +7.893632389407639e-03   +8.226389518126664e-03   +7.575166986728496e-03   -1.854681326294424e-03   +6.288073049063085e-03   +3.079706029910887e-03; +1.403989225436387e-03   +5.412686953914824e-03   +2.447402709901491e-03   +8.118013086114819e-03   -6.827020168426452e-04   +1.021203097020388e-02   +4.353677818492199e-03   +2.276673577891902e-03; -3.788480338581380e-03   +7.201932572479397e-03   +6.237322760831234e-03   +1.004346353555032e-02   +9.790635676626930e-03   +4.016210976258415e-03   +3.305700346776337e-03   +7.527575482111922e-03; -2.689912236104802e-03   +9.139845160756572e-03   +1.128411281134727e-03   -3.512919925060341e-03   +6.404875160140044e-03   +4.103349231476449e-03   +1.184570338949928e-02   +1.292322428124543e-03; +2.110876112422754e-03   +5.717465796275603e-03   +1.154070652875698e-02   +8.205101448686504e-03   +9.429975880644849e-03   -4.474341681462463e-03   +3.596756928270899e-03   +4.359405468854745e-03; +1.257815644466738e-03   +5.766105355014610e-03   -3.850686658952235e-03   +3.864699274337228e-03   +2.136507177388560e-03   +4.162425982595775e-03   -6.214456932313636e-04   +5.381627297690598e-03; -4.697369442347133e-03   -5.391254193044349e-03   +3.056734180842253e-03   +9.944543779381842e-03   +4.898614163590608e-03   +5.501529508696597e-03   +8.105896036465094e-03   +4.713348989522483e-03; +3.863209068547230e-03   +7.896119969072348e-03   -3.600943197219345e-03   +3.514008127679416e-04   -3.297345639977401e-03   +7.799246879584731e-03   +8.183158089537165e-03   +5.649078377818556e-03; +8.098918034381232e-03   -1.850648118057976e-03   +7.230283179276798e-03   +5.953735790079684e-03   +1.339895245551619e-02   -6.572732908281554e-04   -5.155970899034131e-03   +2.867546259433750e-03; +7.096504118503420e-03   +5.194833428927306e-03   -4.555225508039704e-03   +3.952883507500481e-03   +7.322550531587015e-03   +6.003309163681025e-05   +4.460058213546165e-03   +7.415342277095373e-03; -4.601271343992667e-03   +5.085907106892345e-03   +8.621106692185465e-03   +2.143535326638961e-03   +7.086673181901293e-03   -1.088328494937150e-03   +1.138873352482838e-02   +1.787050018976740e-03; +2.406503108273541e-03   +4.474839873100447e-03   +2.134567605186685e-03   +3.019747635415659e-03   +1.657132077217733e-02   +5.296934505928898e-04   +7.040400419888854e-03   +7.722240775857763e-03; +2.670782468982422e-03   +2.900722231679706e-03   +1.923242762829434e-04   +2.749600035396448e-03   +6.123189418296411e-04   +2.797772677739748e-03   +6.414661019189000e-04   +1.230057167015378e-02; +4.518552998486220e-04   +3.476902938007682e-03   +3.641059206726529e-03   +7.417136328249616e-03   +1.619211425071610e-03   +4.150953016523475e-05   +1.058218229849487e-02   -1.019085865578893e-03; +4.939553482655887e-03   +6.280831216914240e-03   -5.313336690082197e-03   +2.577150253058961e-03   -5.230002338949925e-03   +1.264113340500917e-03   +4.268780909011917e-03   +1.154953930057351e-02];
L1E_L2E_iAMPA_netcon = [+2.695981005346255e-05   +2.174439973129262e-03   +3.432412759352093e-03   +7.585330467159586e-03   +1.103404673776122e-02   +1.172306060648905e-02   +5.601101382450553e-03   +9.467481140868407e-03   +9.076616512073407e-04   +1.659020456289122e-03   +3.721984078427584e-03   +8.964715192223781e-04   +3.838635369204071e-03   +6.275383392119247e-03   +1.556220750024115e-03   +7.360083070339545e-03; +3.948583887268634e-03   +9.546599813920311e-03   +6.351037701493288e-03   -1.071303249823719e-04   +3.120794906301444e-03   +8.260850404711806e-03   -3.519180374787611e-04   +1.077731237564170e-03   -3.189608275862132e-03   +5.866185462338394e-03   +2.643639828780683e-03   +4.011314802394023e-04   -2.371497989011067e-03   +4.673679200731674e-03   +4.338380555466131e-03   +2.453324075158097e-03; +3.560616889189205e-03   +4.347888409810831e-03   +7.261887201706205e-03   +1.127227876079250e-02   +1.026411233327922e-02   +3.449788554113951e-03   +1.959491353603109e-03   +6.033339838571344e-04   +2.609389853775792e-03   +5.249948307379404e-03   +1.828387727126176e-04   -3.852025890749871e-03   +6.390949037739946e-03   +1.105644874045780e-03   +9.869179245732860e-03   +2.190199866303265e-03; +7.214984216544945e-03   +4.061004870662602e-04   -1.051947077164769e-03   -7.041440468264969e-04   +4.542768920489036e-03   +8.171323039118175e-03   +8.515368069572173e-03   +3.575504141232964e-03   +3.466291376234586e-03   +9.394170803200120e-03   +5.797833000203713e-03   -3.808512138613421e-04   +7.855866101551591e-03   +3.703898559066346e-03   +8.517537284300469e-03   +7.114710389900977e-03; +2.417104161177166e-03   +3.534527763581537e-03   +5.918976527032033e-03   -6.392791599032358e-04   +2.653746411056335e-03   +4.923169194646391e-03   +6.570767050333134e-03   +3.398036396245827e-03   -7.967461597517113e-04   +2.136430445946107e-03   +2.126356608960072e-03   +1.119579688726324e-02   +1.042255393785292e-03   +3.467386137976684e-04   +1.049506934653195e-02   +5.102003848407973e-04; +6.192564641727375e-03   +1.081489446797914e-02   -1.333930455905962e-03   +9.082234696973760e-03   +1.688933068794547e-02   +7.867840510414302e-03   +3.939758305385363e-03   +7.009590828011758e-03   +2.387082248763535e-03   +8.701386044831891e-04   +5.689718299300973e-03   +6.962826499828775e-03   +8.445929487800069e-03   -1.191273982041650e-04   +4.484509123946574e-03   +7.366345376239464e-03; +3.836129306442304e-03   +3.350128329388978e-03   +6.090353363994039e-03   -2.917734229412587e-03   +1.674872680562119e-03   +2.381584267236756e-03   +6.398913967519305e-03   +9.526295603599655e-03   +5.130606318478529e-03   +4.460437565626215e-03   +1.648395812074519e-03   -2.427764548007522e-03   +6.022930799014852e-03   +3.913847704908297e-03   -8.360916220255663e-04   +5.770381787503558e-03; -1.900849982954155e-03   +3.824588050251283e-03   +6.980251137816237e-03   -6.973045826679040e-04   +9.993580035053396e-04   +7.500385623751537e-03   +7.048328139486141e-04   +1.237080725655554e-02   +3.877426278998009e-03   +3.295112183073922e-03   -3.531075497360092e-03   +8.392432674061732e-03   +7.235838431286897e-03   +3.553934942168742e-03   +1.862695389714307e-03   +3.033362245398580e-03];
L2I_L2E_iAMPA_netcon = [+7.348125805419155e-03   +9.011851694467533e-03   +2.755962740625904e-03   +7.829049448007285e-03   +6.999497880796296e-03   +5.772327110956613e-03   +3.921445865087071e-03   +4.523408659708019e-03; -9.751261154820976e-05   +2.735987159945235e-03   -8.456560898837619e-04   +8.135371916499228e-03   +2.924934890367819e-03   -3.254194759878051e-03   +3.153628067188409e-03   +4.876147290544284e-03; +8.327922862128669e-03   +5.503401232144354e-03   +3.845312478988196e-03   +4.558451147525217e-05   +4.323666255884548e-03   +5.294115612446563e-03   +7.352041190196684e-03   +2.398782264804620e-03; -4.449735202774484e-03   +1.393769477333013e-03   +7.202431151694257e-03   +2.323672991880518e-03   +7.953512232044364e-03   +4.819628017915779e-03   +2.810145225465784e-03   +7.906361535290368e-03; +4.585156441845886e-03   +3.748874485586164e-03   +1.427992367656250e-03   -2.569290478424052e-03   +1.056031861524287e-02   +4.635169387622095e-03   +1.869233067142343e-03   +1.896901967312705e-04; +8.998234978527421e-04   -4.809662633494629e-04   +3.045953592254650e-03   +2.834543168976293e-03   +6.568571447321496e-03   +7.948506032093671e-03   -3.722780834786909e-03   +8.652010669071805e-03; +8.636738929902941e-03   +1.330435982759759e-03   -7.476037934867012e-04   +3.172503116145924e-04   -6.043103687558306e-03   +5.005559366726971e-03   -3.299648345379637e-03   +9.153335614022918e-03; +3.936956523909938e-03   -3.258505182342903e-03   +2.212692449676444e-03   +7.096885275934639e-03   +1.054067809067533e-02   +6.480244767961854e-03   +8.140924980948703e-03   -2.219235936057559e-03];
L2E_L2I_iGABA_netcon = [+5.585331900087843e-03   +2.468449964472800e-03   +1.532569273945339e-03   +2.659641451374459e-03   +1.215862671396638e-02   +1.346537927859323e-03   -6.988176147606350e-04   +5.686665717172103e-03; -3.781334273225333e-03   +4.837012211135072e-03   +4.276354071466856e-03   -1.621119574400905e-03   +6.920299200496905e-03   +7.775895250338430e-03   +8.460802239870542e-03   +9.812647045513896e-05; +1.936211283502435e-03   +1.917540751004308e-03   -8.577024067277348e-04   +6.792925738092994e-03   +7.946364157840556e-03   -2.614361881211481e-03   +7.710827987998082e-03   +1.041497870459486e-02; +1.077619351935861e-02   +1.393626804715262e-03   -2.752016906644866e-03   +5.076733190685887e-03   +1.289534744133934e-03   +5.062285485063147e-03   +4.646796015593228e-03   +6.100402563511440e-04; +1.124607888551550e-03   +2.477333862312903e-03   +6.568680120378452e-03   +5.812374980595397e-03   +2.545674977161024e-03   +3.801432961495399e-03   +7.322059748480989e-03   +1.494107778891798e-03; +6.858834741321479e-03   -3.209263995249254e-03   +6.575978380791634e-03   +8.879629402509959e-03   +7.585029679763426e-03   -1.122596344112253e-03   +6.926886962021015e-03   +7.407573044507810e-03; +5.678458557841425e-03   +5.960342309004492e-03   -5.200521966839876e-03   -3.879512375902566e-03   +3.355434789019769e-03   -2.599956839320646e-03   +1.340104589186197e-03   +4.002646197586268e-03; +8.984310686440134e-03   +5.251569257779310e-03   +2.439902367680322e-03   -4.904754109001919e-03   +2.362921051568188e-03   +8.210361568966058e-03   +4.458384846151355e-03   +7.590685174544975e-03];
L3E_L2E_iAMPA_netcon = [+2.674611104949539e-03   +1.184650790461909e-02   -1.593164945318070e-03   -1.845198771922437e-03   -4.192323599751920e-03   +5.183386032753895e-03   +5.971966734470620e-03   +7.692355150995651e-03   -4.156829141202050e-04   +1.592822953930700e-03   +8.640563440088856e-04   -3.782590580031145e-04; +2.128092838460191e-03   +1.104633309224154e-02   +9.531528391068682e-03   +2.459964819452379e-03   +3.778415621434291e-03   -1.720418927727314e-03   +1.009942903005749e-02   +6.779341580454065e-03   +1.012028255779785e-02   +7.127320107846906e-03   +2.193093458863760e-03   +2.691826039300646e-03; -6.447788353009096e-04   +5.538764820522096e-03   -5.264493126456240e-03   +5.333558519959143e-03   -1.063436072072590e-03   -4.458888250877422e-03   +6.464683022599532e-03   +7.420551558129512e-03   +5.667816725784828e-03   +6.023930327114349e-03   +6.120013068604375e-03   +6.523458202352519e-03; +4.863452901978958e-04   +3.200691234802230e-03   +2.965012534843123e-03   +1.083086624406339e-02   +2.777400224668636e-03   +1.986489905231478e-03   +4.238654612262869e-03   +1.032653289083865e-03   +4.688922739656106e-03   +7.630187117388377e-03   +1.242482048728700e-04   +2.321347187989140e-03; +4.732015516581249e-03   +1.625199754045789e-03   +5.044254215080432e-03   +1.078352966263054e-02   +6.229537471312827e-03   +1.714201374500488e-03   +9.517960243048480e-03   -5.488355828432111e-03   +1.470042639425174e-03   +1.217777186195084e-02   +9.370024659293525e-03   +4.847816104519244e-03; +8.118067641098235e-03   +4.718712603287710e-03   -7.465382934004785e-05   -1.103639372563558e-03   +2.913089120077319e-03   +1.466196457801882e-02   +1.192155631561045e-02   +5.891079960930522e-03   +9.347615833154112e-03   -1.036144051759913e-03   +8.668042121071964e-03   +6.058440543743746e-05; +5.226159141785299e-03   -4.279420879547687e-04   +6.740645538931628e-03   -1.119161509785258e-03   -6.031310498233575e-03   +3.790611497306831e-03   +1.469063719894470e-03   +7.980744561954233e-03   -2.035820607552821e-03   +3.782927297287842e-03   +2.855115214197893e-03   +5.396592997561850e-03; +9.935808636058275e-03   -7.971961847589605e-04   +1.152186256171380e-03   -8.876378898337190e-04   +9.476148089088402e-03   +1.531623833573966e-04   -5.692505892700437e-04   +2.117780857688406e-03   -8.300539538189778e-04   +8.527072578693964e-03   +3.226198001156694e-03   +1.751846011601173e-03];
L3I_L2I_iGABA_netcon = [+4.824588574574481e-03   +6.728183549516169e-03   +1.246244961463007e-02   +7.161746099911507e-03   +7.910418658090508e-03   +1.737989344639634e-03   -8.823612038672121e-04   -5.480991565928660e-03   +4.709636465119188e-03   +5.171818512350593e-03   -6.001321960549952e-03   +1.384426437939672e-02; +4.595547241135246e-03   +5.778631111549894e-03   +7.394471075055631e-03   -1.804530436496601e-03   +8.821838688798593e-03   +6.296171504809695e-03   +3.698061667448779e-03   +2.183225536361781e-03   +7.232524485062578e-03   +4.787467196081210e-03   -2.540201233955977e-03   +6.392020143232925e-04; -5.972145055570951e-04   -2.412716887833928e-03   +9.975443887940739e-03   -2.196952815022386e-03   +2.198785527690601e-04   -5.129321551098900e-03   +2.581829681191751e-03   +5.641673556662216e-04   +1.074764910903393e-02   +8.241890369396162e-04   +3.129527787446870e-03   +4.851779842243910e-03; +1.313429342111320e-02   -5.102869336755735e-04   -1.971060649220887e-03   +6.206861192437438e-03   +4.995662744881821e-03   +6.988385118419886e-03   -4.204988252224209e-03   +2.803832972292611e-03   +5.492895251519653e-03   -1.165774829515365e-03   +8.999207879599742e-03   +1.104393979888787e-02; +1.681472019029432e-03   +4.844459760695790e-03   +6.520826695760903e-04   -4.225308220398120e-03   -1.716075382214542e-03   +1.147786766797005e-02   -3.407209913199279e-03   -5.514380680517181e-04   +8.664664772436780e-03   +1.333629146414362e-02   -5.020325823109564e-03   +1.639658729413360e-03; +1.211996418947701e-04   -1.325254645071305e-03   +7.147495397868260e-03   +1.766310360929561e-04   -2.924322441986714e-04   +4.685214215387357e-03   +5.349482378030004e-03   +4.302074514873500e-03   +8.676849307297732e-04   +3.142196153173897e-03   +3.687815470842312e-03   +1.187735363991129e-03; +4.836884423475621e-03   +5.447935383126969e-03   +5.611593454479116e-03   +7.683567052200324e-03   +3.228541699844532e-03   -2.551627734724872e-04   +3.262583928597322e-03   +7.323326917034491e-03   +2.903718731169026e-03   +7.203336075554043e-03   -2.551231394573669e-03   +7.677458361539024e-04; -2.134504245418154e-03   -6.134103387051492e-04   +2.372654842923450e-04   +6.159051713931656e-03   +3.560568214701148e-03   +2.142393697123359e-03   -8.732029823828203e-04   -2.429461331742993e-04   +1.200128618770577e-02   -3.678437738949542e-04   +3.796894065810596e-03   +3.712506151010640e-03];
L2E_L3E_iAMPA_netcon = [+8.409129665325202e-03   +5.525601324668569e-03   +2.139051205970435e-03   +4.556185884687427e-03   -3.148163812303734e-03   +4.609591531777766e-03   +8.620206411425765e-03   +4.719854834339336e-03; +6.094800325650347e-03   +7.580404044398977e-03   +9.758925049804015e-03   +8.124390843243963e-03   +4.309600345438239e-03   +5.335953268047390e-03   +8.401593421303918e-03   +4.217604808159071e-03; +4.930861055316811e-03   +6.772785820622015e-03   +7.780125698883464e-03   +6.785739933302989e-03   +7.065794953129931e-03   +8.219098795732500e-03   +7.951179505837947e-03   +7.744219548672384e-03; +4.672727269891919e-03   +4.461815128955773e-03   +6.253866220546007e-03   +2.297535120105426e-03   +1.663213418384056e-03   +4.617572234189492e-03   -8.817959407600362e-03   +7.344466034485469e-03; +5.883089607493738e-03   +1.747133878882749e-03   -2.575801678185023e-03   -1.262441958987970e-03   +1.703079113628177e-03   -1.458616760367335e-04   +8.331964456643651e-03   +7.272654308476663e-03; +8.600351634078771e-03   +6.176776789643383e-03   +6.333004186444639e-03   -1.691854376542883e-03   +7.779964271757036e-03   +1.291702760453977e-02   +3.124071692608549e-03   +9.321547759043957e-03; +5.951697712015053e-03   -6.878675842830614e-04   +1.038491645364688e-02   -2.285029875291986e-03   +2.919457072762688e-04   +9.607156340845384e-03   +8.167478043866457e-04   +7.231810164000404e-03; +1.443928638765312e-02   +2.676285863422842e-03   +5.591988407104545e-03   +4.029098291027932e-03   +7.789811578831825e-03   +8.899513341748258e-03   +5.025412381925118e-03   +7.451122029201559e-04; +6.054102241596455e-03   +4.178159417133562e-03   +2.502023512895731e-03   +7.543315818014412e-03   +6.212820839012030e-03   +2.304879966613308e-04   +6.197869966096533e-03   -6.198634045070249e-04; +4.494736333236558e-04   +3.234221092586826e-03   -8.114262647439042e-04   +5.342154333214653e-03   +6.169063238645018e-03   +3.702354159593937e-03   +3.035230344192242e-03   +8.736921223622955e-03; +4.817274698331169e-03   -1.410916617444810e-03   +4.687154882929787e-03   +7.433843711874371e-03   +1.614784265481737e-02   +9.844164835881200e-03   +9.818223329638733e-04   +3.487993437652903e-04; +1.230638619034642e-03   +8.489706260951444e-03   +5.166501122814355e-03   +6.404836390799052e-03   +4.688488859076936e-03   -2.821540728420750e-05   +1.114966388201499e-02   +6.241514763746127e-03];
L2I_L3I_iGABA_netcon = [+1.087997864060433e-02   +6.467708676057554e-03   +5.582229886835990e-03   +5.444886049761619e-03   +6.750274585913874e-03   +7.239105660222070e-03   -1.478226050302209e-03   +4.457718611157321e-03; +2.236887067609472e-03   +7.122428043852231e-04   +1.157329620986890e-02   +2.057676899849222e-03   +3.810264943982384e-03   +6.204728676966741e-03   -2.067428471865765e-03   +6.609518076542111e-03; +4.153646253068205e-03   +7.948785541032604e-03   +1.066076872904561e-03   +5.956329485780842e-04   -5.833036960299764e-04   +2.613021087323089e-03   +6.422093748384114e-03   -2.831483345877030e-03; -2.800341571795047e-03   +1.066304277882673e-02   +1.171048482560414e-03   +5.986765444354139e-04   -5.186003014998158e-03   -3.999756319543811e-03   +4.379695151380579e-03   +7.581463812579158e-03; -1.376094611424004e-03   -1.725912060669302e-03   +3.314810752691811e-04   +1.397098280622328e-03   +8.155806826981988e-03   +7.112797624291898e-03   +3.166257735812356e-03   +6.788584048489384e-04; -4.351991027093747e-03   -1.265197934002135e-03   +6.613579103058946e-03   +7.723169546369060e-03   +3.293335907411602e-03   +3.861518431427850e-04   +7.327627138310084e-04   +8.831661687438444e-03; +1.512540158636371e-03   +2.754060151637474e-04   +1.109423208200598e-02   +6.699347030181700e-03   +5.671655865875741e-03   +1.776921228653232e-03   +3.770311725361376e-04   +6.908119478150811e-03; +3.782472252452129e-03   +1.103450728516019e-02   +6.938120222601767e-03   +1.551405782878536e-03   +2.822389178869057e-03   +8.094346165222971e-03   +4.514870036728600e-03   +7.879894737429674e-04; +9.748122958064575e-03   +3.249896644784780e-03   +1.235323333223293e-02   +2.537088404449437e-03   +2.626508947948158e-03   -2.707198894528137e-03   +6.238321528824800e-04   +3.582885020600206e-03; +7.910999148078130e-03   +5.522604295570558e-03   -2.677844114321132e-03   -1.142304145296167e-03   -1.964110506387136e-03   -5.105785613913495e-03   +4.049541841658601e-03   +1.983348423922872e-03; +4.939790224733540e-03   +5.677571978274250e-03   +8.223886480585307e-04   +4.494793431381536e-03   +2.332687380926654e-03   +4.834982625523342e-03   +8.798806806584892e-03   +2.408991759375437e-03; +9.887313793209671e-04   -3.237859150970425e-03   +1.987273530924735e-03   +4.479148822026865e-03   +2.589657820353586e-03   +9.081227537034421e-03   +1.026122186251166e-02   +2.245959792574801e-03];
L3I_L3E_iAMPA_netcon = [+7.986315203397744e-03   +5.992031961381218e-03   -2.956576106318203e-04   +8.513098661695419e-03   +1.067572991198675e-02   +3.932015985511853e-03   +5.298413382848932e-03   -4.441584713401209e-03   +7.501546850471880e-03   +1.720624729361402e-03   -1.210632465188503e-03   +1.436208813832137e-03; +5.414480848070274e-03   +3.551515852409716e-03   +1.671570558436774e-03   +3.823882757237540e-04   -6.612913147649994e-03   +1.688534165972675e-03   +4.344333716508047e-03   +7.244505473927272e-03   -1.774511426218026e-03   +2.768311652107930e-03   +2.551765022133451e-03   +9.191663963506850e-03; +3.931405664687893e-03   +7.192510680832095e-03   +1.156791056606589e-03   +5.749124794114538e-03   +2.325956218893978e-03   +6.606131702400288e-03   +3.541935178303126e-03   +4.725154252514184e-03   +5.771760983528751e-03   +8.648504216845839e-03   +2.487973231442438e-03   +1.349283318777964e-03; +7.581950458771003e-03   +1.219857637800189e-02   +6.792049291794932e-03   +5.180806724540567e-03   +5.040650964349734e-03   +5.811800433931859e-03   +1.065597258762185e-02   +3.450989462802097e-03   +7.333958646799824e-03   +8.059988873286386e-03   +2.712993747795186e-03   +1.098498225583844e-02; +3.605287966022445e-03   +1.159446745606932e-03   +2.344807713433999e-03   +5.342993412192108e-03   -8.961190489648748e-04   +6.258270520506954e-03   +7.901866002554502e-03   +2.189754610419662e-03   +2.487296713472741e-03   +2.630934251048446e-03   -3.933777272125192e-04   +4.738426080882928e-03; +8.750391578991023e-04   +7.730427298321389e-03   +4.327588881954824e-03   +1.157101837804816e-02   +5.297390502625255e-03   +1.655627469855615e-03   +8.849520513874085e-03   +1.462558356217850e-04   +7.276694200306590e-03   +2.351797056748594e-03   -3.744836827910986e-03   -5.070545640208970e-04; +1.397633794886787e-03   -7.899500023536791e-04   +2.835275660739495e-03   -1.400665071688004e-03   +7.675841295151973e-03   -3.291717680459439e-03   -3.147138592858629e-04   +9.016903123743297e-03   +2.539421716013516e-03   +6.557386715776924e-03   +2.307650093438306e-03   +6.622114611724517e-03; +7.256916463657962e-03   +1.253183668582722e-03   +7.267586737397161e-03   +1.022860264363752e-03   +2.329544358556789e-03   -2.554999360153280e-04   -1.003494103364697e-03   -1.793763665317789e-03   -2.145558021262663e-03   +6.356843724563213e-04   +3.779902860631597e-03   +3.059733710581885e-03; -2.382210340413684e-03   +2.754354283381576e-03   +5.180191653112833e-03   +6.070546190995445e-03   +2.011370185717132e-03   +6.192508923222159e-03   -3.776984492577187e-03   +9.528002536556439e-03   +1.244799615226318e-02   +6.848237741412101e-03   +4.451318870088533e-03   -1.894610270676869e-03; +1.826898024385289e-03   +7.651595666948285e-03   +7.440024779457797e-03   +1.768051359297461e-03   +4.760907760851894e-03   +9.076007908248836e-03   +2.277328264418207e-03   +1.249607149673606e-02   +6.068761959122044e-03   +1.063172163094703e-03   +7.741588062518211e-03   -6.492120519828715e-04; +4.225538111915948e-03   +5.243249233864062e-04   +1.287684625192168e-02   +4.135387099858195e-03   +1.685932964682603e-03   +5.141286670166011e-03   +5.603442667289935e-03   +5.688137121817181e-03   -4.104977339391250e-03   +7.702615988600801e-03   +6.013021694197172e-03   -1.049489588124278e-03; -6.383722314479505e-03   +1.021313744306842e-02   -8.835586997231260e-04   +7.098954089916235e-03   +7.199649597539002e-03   +1.821699195530721e-04   +1.093108217558743e-02   -5.420198059500581e-03   +4.122084887741201e-03   -1.646361077102325e-03   +1.131926447430271e-02   +3.682303909459642e-03];
L3E_L3I_iGABA_netcon = [+9.054765448976074e-04   -1.957008259681033e-03   +1.745728457731996e-03   +7.853452524043413e-03   +5.228970098029634e-03   +1.351976165528717e-02   +3.584417918833215e-03   +3.527199253448216e-03   +5.144551710534392e-03   +4.538461234492671e-03   +6.894345564858257e-03   -3.050001776585448e-04; +9.227769431128484e-03   +6.874568861979357e-03   +2.715205302766921e-03   +1.689221582266845e-03   +4.420428751587986e-03   +4.823270449254270e-03   +3.223128691759048e-03   +5.612150641427812e-03   +4.528033529171176e-03   +3.506275239976521e-03   +1.434105189218338e-03   +5.417470282976322e-03; +3.001507857355932e-03   +6.482228103503559e-03   +6.419221477367163e-03   +2.658035707486612e-03   +1.375660537473859e-03   +8.810436689428637e-03   +5.817071600328245e-03   +3.295471755497538e-03   +5.482591192556927e-03   -2.458380490024343e-04   +4.138167944508584e-03   -3.694535483749468e-03; +1.217599094136158e-03   +4.360628540724576e-03   +1.458130157605512e-04   +9.666873586779102e-03   +5.690195739694285e-03   +1.740228779575122e-03   +6.877872444580865e-04   +1.346195143878131e-03   +9.185568530943355e-03   -2.765648240286460e-03   -3.360005887647889e-03   +6.106102259035447e-03; +2.514605915211644e-03   +5.592329735424946e-03   +1.278215269203421e-02   +2.986592792956065e-03   +3.557847084784307e-03   +4.388153588625116e-03   +9.080716311743188e-03   +1.034181396460686e-02   +7.127520745635205e-03   +1.024660704942636e-02   +1.298784035975477e-02   +3.016609478505260e-03; +7.621551792168498e-04   +4.538549025228618e-03   +9.397616618083374e-03   +4.220338607585669e-03   +2.760967893173935e-03   +1.164338816230147e-02   +2.215209943799819e-03   -6.239331121449219e-03   +5.334552828629606e-03   +2.651441377988973e-03   +4.340583483072415e-03   -1.620346736395650e-03; +3.668915203958751e-03   +6.189367071200273e-03   +1.536483954233838e-03   +6.434195328835096e-03   +3.652079319786740e-03   +7.797779033073724e-03   -1.547756373528779e-03   -1.492182254163303e-03   +3.793292436999442e-03   -1.908464743456968e-03   +1.197652579807272e-03   +8.592147539659095e-03; -2.391288522689850e-03   +3.728615848086171e-03   +6.453019142774742e-03   +8.215062254242860e-03   -1.177747360668489e-03   +3.381354324474725e-03   +1.861963493213851e-03   +7.910571077711392e-04   +5.226087254425973e-03   +8.598511487164541e-03   -2.274529818096035e-03   +7.546845522594154e-03; -7.621882179575718e-04   -2.153173881528984e-03   +7.178270920630765e-03   +3.321445234848361e-03   +6.088456654524221e-03   +4.802377595689807e-03   +1.865894608621061e-03   +9.835833729714095e-03   +2.424116075204150e-03   +5.835563388991543e-03   +3.841477288710477e-03   +7.475069520302053e-03; +8.655340856814639e-03   -2.280210873723795e-03   +5.619512905080259e-03   -9.969011121707687e-04   -4.209221075967330e-03   +7.857101648811423e-03   +7.938862979514648e-03   +1.824368401374136e-03   +9.557959197095173e-03   +1.003220671230383e-02   +4.216779546204207e-03   -4.886882429636488e-03; +3.607005372090530e-03   +1.485795904809618e-03   +1.463158494614491e-03   -1.962304208659769e-03   +7.121565796466047e-03   +1.989078673932352e-03   +1.311580717296534e-02   +8.116970663953547e-04   +1.030061128070945e-02   +6.118631585139814e-03   +2.071535358940557e-03   +4.608059598656560e-03; +1.043616403935504e-02   +4.260750905707600e-03   -2.185238930326453e-04   +2.810924675503602e-03   +1.679147714277022e-03   +4.031088741935735e-03   +1.112982281658276e-02   -2.585570705770416e-03   +1.321863333381828e-02   +2.690930813190698e-03   +2.502814719831250e-03   +3.083501561931579e-03];
L2E_Input1_iAMPA_netcon = [+3.453191041603028e-03   +1.109000370983948e-02   +8.914336469105616e-03   +6.474288149125909e-03   +1.087241959625330e-02   +1.007943507818906e-02   +2.345574295408685e-03   +4.502484626857688e-03];
L2I_Input2_iAMPA_netcon = [+7.352697374132697e-03   +1.113741986914308e-02   +1.047471949052052e-02   +4.856626003117397e-03   +4.337788236316902e-03   +4.187030405649650e-03   +7.558167451020150e-03   +8.701340138864023e-03];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last =  11.21 * ones(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.0*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.2*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.0*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.2*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.0*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.0*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.2*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.0*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.2*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.0*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
