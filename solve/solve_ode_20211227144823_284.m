function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+4.845721873943436e-02   +5.126266299452556e-03   +1.668268695949131e-02   -7.531919619288263e-03   -2.138441417263939e-02   +3.764785739220865e-04   -8.885650976805002e-03   -1.495426973008290e-02   +3.039518894118928e-02   -2.212727046263823e-02   +4.623265824907212e-02   +4.678530605308544e-02   +3.617294983328146e-02   -7.752095119997014e-02   -1.713832747194354e-02   -4.867284795816090e-03; -1.616152498038911e-03   -7.770623549636097e-03   +3.268957209487598e-02   +5.491427119675311e-02   +3.042684602324191e-02   +2.658287374628127e-02   -1.598113711020691e-02   +1.381349986687456e-02   +2.771501408694489e-03   -2.338982212129807e-02   +7.058992553699073e-03   +4.458324301888165e-02   +1.846059354518606e-02   -1.224634721753934e-02   +5.257175937898228e-02   +2.024608059980550e-02; +3.106947308935552e-02   -3.358022705361867e-02   +8.000425906398330e-03   +5.257815815074902e-02   +5.503759257463821e-02   +5.003127496287100e-03   -3.755334081450039e-02   -5.858113236624422e-02   -8.166271204879538e-02   +6.814856666640008e-02   +6.210175725238844e-02   -6.498113862074012e-02   +1.927659534677142e-02   -2.261250344366500e-02   +6.309376697589220e-02   +1.981000984795183e-02; +5.062499733177056e-02   +2.720899701119287e-03   +6.415595675204954e-03   +2.820710036428310e-02   +1.919976798168690e-02   -2.180692962759787e-02   -3.756612585942124e-02   +1.722298624410920e-03   +2.765185709722884e-04   -8.465205285192319e-02   +3.388686941479851e-02   +3.915808410804282e-02   -1.696491977711227e-02   +1.655781629484324e-02   +5.326354940125674e-03   +7.376461141482615e-02; +1.743123443133154e-02   -1.197943350635908e-02   +3.440634120758845e-03   +2.590378393286328e-03   -7.551181886077778e-02   +4.413721218827917e-02   +2.294760493856117e-02   +9.152799492316968e-02   +1.193300980532295e-02   +2.072107451584842e-02   -6.656072762476654e-03   -5.631731734528778e-02   -1.491529890149734e-02   +1.826117212885665e-02   -4.665724688589297e-02   -5.417879528876852e-03; -5.879896690285738e-02   -1.879521170679211e-02   +8.218203700654145e-02   -3.236371447767038e-02   +3.684184304253330e-02   +2.907710202401355e-02   +7.610709047254477e-02   -4.818775820698387e-02   -3.616397625440221e-02   +2.108561366968475e-03   -9.410430748807938e-03   -2.689435442264364e-02   +5.484857659331648e-02   +1.106189186489068e-05   -6.643116712684417e-02   -2.705854333208385e-02; -2.894187563056832e-02   +5.297153353297725e-02   +5.123365730002920e-03   -4.730800085353347e-02   +1.140852250015538e-02   -2.035746262569163e-02   -1.360218597241557e-02   -2.130976751766996e-02   -2.650848912767031e-02   -4.716950183937739e-02   -1.448808364471899e-02   +1.623549435638861e-02   +9.474472298398037e-03   +1.615698727808182e-03   -4.439257887733301e-03   +5.840216327406061e-02; +7.591997451841040e-02   +8.102389431078333e-03   +9.993929581469368e-03   -8.255963319235392e-02   -5.094604168582459e-02   +2.237525148858171e-02   +3.474429434557125e-02   +2.044850248409047e-02   -9.560624323124736e-02   -2.967563810212440e-02   +9.563663663992790e-02   -1.446167036672743e-02   +4.731545926392553e-02   -8.086060978297926e-03   +5.787875898592153e-02   -1.121034701761308e-02; -1.016636935786505e-01   +1.333498311324483e-02   -4.394272882092130e-03   -3.845652101870491e-02   -2.798541847597989e-02   +6.605978577397743e-02   +3.318310590458603e-03   -4.593106129394579e-02   -9.803258045077834e-02   -1.092496052710551e-02   +2.729886462442540e-02   -3.218168551439663e-03   +4.515372250934915e-02   +4.615261647498220e-02   -2.707209414559548e-03   +2.037999821895134e-02; +1.329179641598437e-02   -2.803469962619346e-02   -4.466295065299560e-03   +1.427205677539839e-02   -1.167787279540243e-02   +4.111751627820102e-02   +4.698216853844036e-02   -8.038701805413845e-02   +3.268900903789571e-02   -2.706275238516963e-02   -1.283668629427852e-02   -2.215408175105810e-02   +2.496254506199070e-02   +4.421715651127237e-02   -3.445545071044338e-02   -1.041393447479004e-02; +3.959544710207562e-02   +1.369533621241041e-02   +4.570897002797357e-03   +9.324946030670172e-04   +8.151379841148301e-04   +8.990414006666692e-02   +9.192492323520917e-03   +3.533817228999344e-02   +6.026595273623044e-03   +1.527642578888893e-02   +5.546473315263718e-02   +4.390193594844068e-02   -9.397093472790651e-03   -1.834548684371509e-02   -5.476337201208243e-02   -1.777782711089353e-02; -5.476838693419027e-02   -6.831022660008089e-02   -3.153546468202788e-02   +8.824962557406793e-03   -2.198013313250143e-02   -3.699398393526187e-03   +2.276213181766495e-02   +2.366690969695663e-02   -3.002356211184991e-02   -1.067486269653605e-02   +2.504227872882732e-02   -3.601917001538349e-02   +4.992176290010987e-03   +1.967646648770318e-02   +3.229142607244619e-02   -5.529606155316386e-02; +2.024990221034872e-02   -4.525784816446274e-02   -5.182035789969485e-04   +1.719477980369503e-02   +2.639840921670403e-02   -5.287335697637664e-03   -2.148010075355394e-02   -9.105260692922921e-03   +1.180479989702899e-01   -7.635387116518663e-02   -6.358963430190059e-02   +1.015941886438697e-02   +1.771494414478228e-02   +5.421043278700766e-02   +3.440816710188376e-02   +3.164620063658460e-02; +1.597821125556587e-02   +3.874645420852897e-02   +8.629139297866784e-03   -5.773023945400959e-02   +2.710044780295946e-02   -5.397693199245517e-02   +5.632201545127268e-03   -1.103102194181084e-02   +1.206741873364862e-02   +2.892858659050794e-02   -3.671014049621927e-02   -2.576685594634472e-02   -1.149519246987060e-02   -4.469829926490692e-03   +1.448415993757787e-02   -3.458429328127860e-02; +5.729307649944286e-03   +1.846974579742347e-02   +2.616034648413130e-02   -2.052953025662881e-03   +4.469794801013330e-02   -1.194633306134763e-02   -2.554456512649903e-02   -8.730176409436970e-03   -1.844427416224369e-02   +1.941080908714081e-03   +2.406095977032852e-02   +5.406310492188771e-02   -4.632271226133702e-02   -1.060479508225423e-02   +1.907683565310746e-02   -2.200125764862523e-02; -6.120501509429276e-02   +1.246665797984768e-02   +1.366943311511380e-02   -2.355026273424638e-02   -3.751645984499951e-02   -3.874065026025231e-02   -2.910402132506410e-02   -4.492288552001709e-02   +2.771387786228143e-02   +6.885585258925429e-03   +1.073391752120389e-02   -5.781710358291975e-03   -3.962665803726991e-02   -4.648580781557274e-02   -2.308674185587362e-02   -4.748851637014036e-03];
L1E_L1I_iGABA_netcon = [-2.321645588175875e-02   +1.713893313941453e-02   -5.066387992260585e-02   +6.721888724030420e-02   +2.803951836415846e-02   +2.266761210797211e-02   -6.627680589192272e-02   +7.895632640240437e-02   +2.055710260080098e-02   -3.041440858947491e-02   +1.325425421796671e-02   +1.665687630417464e-04   -1.503506077039388e-02   +9.015686711097731e-03   -1.918371459918856e-02   -6.362990149130391e-03; +3.101826783340045e-02   +2.633614705427902e-02   +2.572530963735439e-02   +2.393936550408366e-03   +5.872351952189138e-02   -3.879033294701263e-02   -2.916856868018301e-02   -3.070536729583608e-02   -1.465295040446554e-02   +1.596569256491970e-02   -5.019878323858085e-04   +7.842302424487213e-02   +2.375721398417995e-02   +2.410863918748682e-02   -1.086401707830661e-02   -1.948606999211489e-02; -7.344069320061979e-04   -5.278757384373299e-02   -3.576399999457314e-02   +2.733454988473986e-02   +4.830283217424167e-02   -2.569001539029938e-03   -1.018613428817569e-01   -9.969412565954995e-04   -1.132253825906156e-02   -1.031378985872432e-01   +2.794741761247214e-02   -9.855881807329114e-03   +2.993826953481300e-02   -2.414475915704139e-02   +1.265988310093471e-02   +3.067700236765698e-02; -3.539974531459912e-02   +4.336650455174607e-02   -3.811782125082319e-02   -1.861373678631114e-02   +2.992092924241546e-02   -9.249675183443504e-03   -4.599445991190156e-02   +4.131529817935120e-02   -1.768605071874390e-02   -6.338276756053928e-03   +2.429630109203254e-02   +2.080792665181646e-02   -6.048194640820783e-02   -4.087196284973871e-02   +2.778359497962524e-02   -1.487449697845134e-02; -3.880474534522754e-02   +3.389606744658592e-05   +4.310934824642450e-02   +5.000282927962289e-02   -2.817017731953139e-02   -1.569018566722247e-02   +2.554979319989797e-03   +9.436897089405774e-02   +8.111919218913369e-04   +4.398428012546363e-02   -3.023136293954053e-02   -4.748824038283368e-02   +3.328985986673172e-02   -1.927626104882178e-02   -1.468189597435750e-02   +4.086876260439930e-02; +3.839137842475835e-02   +3.972783122016409e-02   +5.244060291629335e-02   -5.691695354427926e-03   +5.867836974468602e-03   -3.042475657334295e-02   +4.283025503854404e-02   +1.666543866248267e-02   -8.515826922249694e-03   +3.196787699570728e-02   -1.365674744843137e-02   +2.946639450483333e-02   +5.700786359277214e-02   +2.804528094834319e-02   -4.187498623921146e-02   -3.152487127183354e-02; -5.965029452647737e-02   +1.603417476988912e-02   -3.525354993754857e-02   -3.596774474835510e-02   -7.826015540642052e-02   +1.147477672134804e-01   -1.619579505744967e-02   +6.695348133856298e-02   -3.689242541367602e-02   +9.284688989016882e-02   +5.861430572647299e-02   +2.308746242972592e-02   +4.105592201851769e-02   -5.932541066889337e-02   -3.524127166009088e-02   +3.991467263531587e-02; +4.341448196681652e-02   +2.009023511546049e-02   -6.968822728462165e-02   +1.500284808765394e-02   -2.365992185728119e-02   +2.037475615614934e-03   +7.516972846823439e-03   +2.598267826275836e-02   -1.000206407396352e-02   +4.178177191166922e-02   +2.756348185759107e-03   -2.124221791522874e-02   -5.609047980995339e-02   -2.326214688956027e-02   -5.518631259581165e-03   +4.077348692478303e-02; -6.447354016390691e-02   -6.617090955640666e-02   +8.695854334554651e-04   +1.746543759266759e-02   -1.642875542436611e-02   -5.154126216908839e-02   +2.298816950781419e-03   -3.784313081700724e-02   -7.497813262304433e-02   -2.767845055834324e-02   -4.298958256338703e-02   +2.649089154615775e-02   +7.077604937435194e-03   +2.765029134607077e-02   +2.645292621648124e-03   +2.607241269737895e-02; -1.217715887005869e-02   -7.099203124916865e-03   -8.939193619696910e-03   +1.156915901358851e-01   -6.868921108249859e-02   +1.021540138401609e-01   -4.664667414745628e-02   +1.226581934755254e-02   -1.135678660374440e-02   -1.148551270290848e-02   -9.912617192496186e-02   -4.353217339117235e-02   +4.382255452255208e-02   -3.145827097080858e-02   +4.396299365450733e-02   -1.338433815273410e-02; +5.357499303863335e-02   -3.749198069742733e-03   +3.119145918141468e-02   -3.715867652044594e-02   +1.773690281619737e-02   -5.033168008653069e-02   -9.876886495184013e-03   -1.997869240031326e-02   +3.370931519995759e-02   +4.331684961619191e-02   -6.299679511714245e-03   -2.722676203232544e-02   +2.088072522862073e-02   +9.383659044238629e-03   -1.000173768257216e-02   -6.311408849073676e-02; -3.971607174879532e-02   +4.947812849164415e-02   -7.728604153752318e-02   -4.836839522281605e-02   -1.816117452077449e-02   -6.049406844183577e-02   -1.928145835339416e-02   -8.837883636556392e-03   +3.237440144692431e-02   +7.579733825789366e-03   -1.575264456115263e-02   -1.431051184648465e-02   +2.121779070945487e-02   -4.196351214884968e-02   +9.836217646990882e-03   -3.186336020273357e-02; +6.079698858651596e-02   +5.111890637597204e-02   +2.721673320854909e-02   -8.688780797504543e-03   +1.639258412671753e-02   +3.407448925818100e-02   -2.354563769962330e-02   -2.438327809144011e-02   -5.021949080078741e-02   -8.030748731116208e-03   +1.639231297873278e-02   -2.953742056105469e-02   +8.764719775197084e-03   -9.613374293248321e-03   -8.055397607601576e-02   +3.693457289399364e-02; +3.793373726332539e-02   -5.910196641768061e-02   +1.611463825512624e-02   +1.923231439468707e-02   -1.516547923056403e-02   +4.988293540531760e-03   +1.263716551276973e-02   -1.273626529507047e-02   +8.231614607585627e-02   +2.649500834688792e-02   -8.791855409359485e-02   -1.853286200617577e-03   +3.931358402484094e-02   +2.609700443892430e-02   -1.822458333457168e-02   -6.463075140776799e-03; -3.906551566914364e-02   -2.146024457140436e-02   -5.265005148690297e-02   +3.196401013092575e-02   -4.626147651483886e-02   +1.576315559488367e-02   +1.924661938454069e-02   -4.459413908686240e-04   +8.100079375993277e-02   +3.047007346916280e-02   +3.329556383139234e-02   -1.190325504292563e-02   -3.185197079312314e-03   +1.039230948372943e-02   -5.938000453172840e-04   -7.241268097915936e-02; +5.018757786127025e-02   +7.628239126605803e-02   +6.159313860989515e-02   -1.238879954290843e-02   +2.571731245140181e-02   -4.222136402119963e-02   -4.531918771184629e-02   +1.617793430456972e-02   -4.209168459909420e-02   +1.017137849871538e-02   -1.004652337225635e-02   -7.620519564947428e-03   +3.261008787416459e-02   +2.548689001936325e-02   +1.734493075406302e-02   -1.989105607112623e-02];
L2I_L1I_iGABA_netcon = [-9.259918031406530e-02   +2.348677232201067e-02   +1.526834830664651e-02   -2.064701353587073e-02   -1.033611755984060e-01   -8.667018875488167e-03   +2.742613146425657e-02   +5.835524243123160e-03; -5.536688289885562e-02   +8.587128643014374e-03   -3.844650811576985e-02   +5.508679576686051e-02   +1.188265864762349e-02   +5.653250404011764e-03   +1.094397590439170e-02   -2.640922463199621e-02; -3.627022961414653e-02   -6.064789140162868e-02   -3.818334511031980e-02   +2.703922238322466e-02   +3.344485178493656e-02   -1.203348340887512e-02   -4.892203387532158e-02   -5.079647774006159e-02; -7.836970367415529e-02   +4.770848756563049e-02   -6.939385900803936e-02   +1.093071275970140e-01   +3.427277001262045e-02   +2.155405000864893e-02   +2.537997230671310e-02   -4.398584077164962e-02; -2.875789996470104e-02   +2.674832000697607e-02   -2.226956937831871e-02   +1.675959263305232e-02   +8.826760383759813e-03   -8.547029741501243e-02   +6.467568184898576e-02   -6.695543365681452e-03; +1.891940725441923e-02   +9.738846266557070e-02   +3.908810037884135e-03   +9.722484630603967e-03   -7.934490295444551e-03   -3.001214363394177e-02   -7.353108774396186e-03   +3.881379536827721e-02; -4.130279034026384e-02   +2.093194608379233e-02   +5.015816155274791e-02   +2.364858252949475e-02   +4.181475544410979e-02   +4.632258644714284e-02   +4.490024352820313e-04   +1.033968999191286e-02; -2.136672673338715e-02   -2.655699828433398e-02   -7.338160642925201e-03   -6.042652836665778e-02   +7.170848397877606e-03   +9.843873698642662e-03   +1.229816819778713e-02   +9.640808600460092e-03; -2.625924145895483e-02   -3.456421800943587e-02   +2.908386187603386e-02   +3.327925941476163e-02   -3.586797956741310e-02   +3.332166115291625e-02   +9.156182396127077e-02   +3.346445030353994e-02; -3.367044684914452e-02   +4.039655754137497e-02   -4.142691167627270e-02   -1.759748349094652e-02   -1.440756536037701e-02   +1.431316204593814e-02   -2.209373010636250e-03   -2.915058708826481e-02; -6.683817786196869e-02   +4.427984349439702e-02   +1.444558935511772e-04   +3.072412679447097e-02   +2.199642125042842e-02   -4.398086604706619e-02   +2.191248090063161e-02   +1.163249047503222e-02; -1.714935648633151e-02   +5.336710636606927e-03   -4.518269322318376e-02   -2.450286451138834e-03   +2.573154742268628e-04   +5.880928711036064e-02   -2.460275830824734e-02   -1.329161308184328e-03; +2.076128477914048e-02   +5.995613221110876e-02   -2.111208511149155e-02   -1.371283490550411e-02   +4.907191377055246e-03   +7.814985476023480e-02   +1.175857439575882e-02   -4.665200938004981e-03; +1.043936458383764e-02   +2.152129247468455e-03   -2.273762585786945e-02   +1.325397247759961e-02   +1.207721347687439e-02   -9.849149134184956e-03   +1.725470519127512e-02   +3.540495565364753e-02; +9.893848285500193e-03   +1.642273293821179e-02   -1.827001914090532e-02   +5.203821125315464e-04   -8.264832030990750e-03   +4.000802693043221e-02   -1.929098305419620e-02   +2.749059939839002e-02; +8.769494546631583e-03   +1.459042547948100e-02   -2.663454279906773e-02   -2.569808114902081e-02   +2.896814422432334e-02   -4.935326390419009e-02   -1.197829719066142e-02   -1.009941813679497e-02];
L1I_L2I_iGABA_netcon = [-3.608700156656347e-02   +1.272771845890059e-02   -4.365182294620072e-03   -5.324678508254319e-02   -8.570769419462615e-02   +8.566092357969830e-03   -2.950092111211651e-03   -3.231101940223845e-02   +3.692223232167220e-02   +1.623709058656218e-03   -1.913354336369268e-03   +3.461046648746245e-02   -5.469277250277810e-03   -4.463732584445300e-03   -6.911798066105915e-02   -4.779608587353978e-02; -4.302442136386334e-02   +3.001373539185362e-02   +3.697857950557040e-02   +6.289413672831371e-03   -5.186161614137526e-02   -3.577253178236062e-02   -1.522498938177923e-02   +5.360601941916972e-03   +5.319084946030146e-02   +4.910816602426910e-02   -4.211383981359914e-03   -4.395791069781984e-02   +4.301092335427913e-02   +2.585334611816962e-02   -2.773110939145192e-02   +2.530818377388048e-02; -2.572490989658409e-02   -7.047121892966961e-03   -2.811475150127007e-02   -4.066007666447881e-02   +5.872483634261311e-03   +6.004527760496479e-02   -7.162077710368439e-02   -3.315777078571460e-02   +6.010078253249497e-02   +1.051547489425543e-03   +9.334468634224663e-03   -1.065650962632599e-02   -4.534037735987861e-02   +7.485295861185566e-02   -3.096379915369641e-02   +1.676201711092732e-02; +1.836351474986265e-02   +1.714553761794785e-02   +8.004096016733003e-02   +3.908724700612626e-02   -7.146972109250103e-04   -1.491624442556914e-02   -1.924065540771896e-02   +2.173632456986951e-02   -4.848048963995247e-02   -3.959794752676026e-03   -7.188043410358169e-03   +6.928976046405660e-02   +3.920102208731130e-03   +1.359285032532416e-03   +4.411945552530219e-02   -1.902476804787697e-02; -4.010581746950386e-02   -2.187997758707066e-02   +3.086886579932788e-02   -4.276704232493844e-02   +5.112100434287479e-02   +5.352302447055311e-02   +8.931002808702269e-02   -1.041645119941403e-02   +7.396406735221386e-02   +2.075531355149928e-02   +9.868724872390013e-03   -4.347045233128470e-03   -2.823103299512034e-02   +4.258031912432495e-02   -3.716076930521482e-02   -3.115591224155766e-02; +2.706825947572005e-02   +2.990133287467370e-02   -3.164992754507396e-03   +1.524023023719029e-02   -3.611045491961595e-02   +3.160500406386566e-02   +1.553924405315360e-02   +3.343007660043300e-02   -6.884525863231107e-03   -2.567312965027033e-02   +2.101609788423393e-02   +1.729008217597073e-02   +2.546974554815746e-02   -2.393318156611458e-02   -2.849440680552109e-02   -4.551981246168378e-02; -4.500829354892506e-03   +1.075922608160407e-02   +5.435809281752246e-02   -2.571863047706252e-02   +4.145008842660984e-02   +3.812580471206298e-02   +7.159228422293670e-02   +2.241496280413921e-02   -2.518140334002852e-02   -1.395423540888149e-01   +2.971635885377931e-03   +2.538571795295655e-02   -5.679021082193750e-03   +3.367751084262501e-02   +4.398874010562688e-03   +4.227720110602326e-02; +6.342156599238653e-02   -1.042281844379260e-01   -1.288802463023597e-02   +3.375740555337103e-02   -4.727416284109612e-02   -6.646367043684626e-03   -5.581533701655305e-02   +5.945992225898544e-03   +3.425870208615341e-02   +8.506916004356827e-04   +1.222764416606094e-02   +2.338052825232403e-02   -5.594153596154168e-02   -3.690271403368529e-03   -1.520122098169220e-02   -7.303088779147265e-02];
L2E_L1E_iAMPA_netcon = [-5.564330468072256e-02   +5.711738470971808e-02   +1.613116211408669e-02   -4.774349594495041e-03   +5.885132155545708e-03   -2.709104117941684e-02   -2.578492264567236e-02   +4.781080225909026e-03; +5.624596904116049e-03   -3.169939604962531e-02   -5.574023210644928e-03   +1.976384535652697e-02   +3.690501252335146e-02   -1.888673704442909e-02   -3.684051234809087e-02   -2.380171907329288e-02; +1.260810185231172e-02   -8.183762526767922e-02   -4.201152813571681e-02   -1.566794246652303e-02   +3.227386550575771e-02   -4.577904265775661e-03   +7.856532865261243e-02   +8.362743900072640e-04; +1.410326879368008e-02   +3.643803706145642e-02   +7.663049869995531e-02   +9.217929303406432e-03   +1.446365670096820e-02   +2.538271512051218e-02   +5.792252837318421e-02   +3.747268837635927e-02; +1.223352646337083e-02   -3.469721537131805e-02   -2.502038341144203e-02   -1.188105141982710e-02   -2.927417841997799e-02   +9.823791552686489e-03   -1.087935314024864e-02   -2.913442205026883e-03; +4.800399703076604e-02   -8.269212274072300e-02   +1.720532707797009e-02   +5.570682278362241e-02   -8.390419555652355e-02   +2.994501756421199e-02   -2.026919992330516e-02   +7.063332586639821e-02; -2.423968125519189e-02   -8.250044644955382e-03   -5.461446584116308e-02   +1.411962583513116e-02   -1.223986406146595e-02   +3.340168002496115e-02   +5.501139024260082e-02   +1.509920435555396e-02; +7.321801191117724e-02   -7.762359416236861e-03   -2.296143742867800e-02   +1.688132736523849e-02   +2.607547226669824e-03   -1.884053997635341e-02   -1.595469840858776e-02   +5.095466839212620e-02; -1.118314894789979e-03   +2.588355471425156e-02   -3.418992992766466e-02   +7.745295844225965e-02   -5.131975169568936e-02   -2.554583915096937e-02   +2.881346051574802e-02   -4.729031933715398e-02; +5.165192652614613e-02   -2.342457631856337e-02   +1.118439903915408e-02   +1.021527718370607e-02   -3.261031933885513e-03   +3.202582057277653e-02   -5.411608081394320e-03   +2.515328110487224e-03; -5.473200447818846e-02   -4.994695720073315e-03   +9.635342890257685e-03   -2.927055522983432e-02   +6.310665145889491e-02   -1.918216856027218e-02   +9.074439845815491e-03   -4.752802828938552e-02; +1.889054273055985e-04   +1.470498038744563e-03   +6.297014616441947e-03   -6.275227231619493e-02   -2.181853478967862e-02   -5.213996488611507e-02   -6.174655082880826e-02   -4.144717066698181e-02; +4.100004414478080e-02   -4.371651976362606e-03   +4.969818614524362e-03   -3.323584853319041e-03   -4.086278910056461e-02   -1.001596805250871e-02   -2.836357391038244e-02   -5.121376539718234e-02; +5.642807692447013e-04   +5.414452102461377e-02   -1.468605825458841e-03   -3.897008530353070e-02   -2.788356032907197e-02   -1.515096336003721e-02   +1.416582477897319e-02   +3.496530043136790e-02; -3.439530027684930e-02   +1.439764956572013e-02   +5.265088090966931e-02   -1.486436384776018e-02   -3.559043675192931e-03   -1.472512641686511e-02   +2.550511786403191e-02   +6.280423152454279e-03; -8.840605177831905e-02   +3.410082604286065e-02   +2.146338044485482e-02   -7.969951619439523e-03   +1.417445654847928e-02   +2.310282603129390e-02   -2.616590087012715e-02   -2.877517399458435e-02];
L1E_L2E_iAMPA_netcon = [+1.221262497739356e-02   -7.882852207931760e-03   -1.379119905511860e-02   -5.963473314297543e-02   -5.159648031627598e-02   -2.889901637032851e-02   +9.467105144468888e-03   +5.451244540615231e-02   -3.396029649965074e-02   -3.183074541306745e-02   +4.262651670449445e-02   -5.359868255589503e-02   -1.326961360173468e-02   -2.703567133660787e-02   +5.061928041924014e-02   -7.656701390233698e-03; +5.112771981721853e-02   -3.715454288725325e-02   -6.011358212659666e-02   +7.919474457309776e-02   +1.733732844582171e-02   -9.552450689551861e-03   +2.754720025635571e-02   -2.059760829845667e-02   +4.553858092481462e-02   +2.246894374171028e-02   -3.558634992203839e-02   +4.140069955677096e-04   +4.208376249933847e-02   +1.474974002547550e-02   -4.030487316998783e-02   -3.598856107900049e-02; -2.796770916799227e-02   +2.724262067172493e-02   +6.234527943230315e-02   -2.995138296319173e-02   +2.749182701370851e-03   +3.164043800204398e-02   -1.907532258197128e-02   -9.012497422720417e-03   -4.141581204916236e-02   -6.686716123372656e-03   +2.251950364459809e-02   -3.244609478678810e-02   -3.964373735407960e-02   +3.922213238304725e-02   -2.156723837075360e-02   -9.707005581209009e-03; +8.124608603386456e-03   -1.431293435216512e-02   -3.498254344757638e-02   +5.058677617255831e-02   -1.821877018744561e-02   -3.395199945552352e-02   +8.162214186249267e-03   +1.129767041813015e-02   -2.583613569056754e-02   -8.492319715090010e-02   -4.045412998349597e-03   +3.662757378280920e-02   +6.288651714584860e-03   +8.136951107584686e-02   +1.735856914028923e-02   +6.974343986905224e-02; -9.468786773260429e-04   -7.826083404308515e-03   -1.922586573065441e-02   +7.986287860268995e-03   -1.354462113606007e-02   +5.408641599094660e-02   +5.985473653526724e-03   -3.957015153927652e-02   -4.846822294921905e-02   -4.275734397566098e-02   +5.587290795786581e-03   -2.623051180829457e-03   +6.674564483272878e-03   +1.232009646090902e-02   +6.797840789813885e-02   +3.473604513887460e-02; -2.027618130177437e-02   +1.787856383313776e-02   -4.357200612619778e-03   +5.975534776332908e-02   +5.221567329873494e-03   -3.878724773319651e-03   -1.975289878261409e-02   +2.873846002429228e-02   -9.400800381275033e-02   -3.762950387121365e-03   +1.662773639843391e-02   +7.291287083169723e-02   +2.506489232375111e-02   +9.111255357892343e-03   +4.877372754402398e-02   -1.508735285230026e-02; -8.510947796438018e-03   +6.536032656766660e-02   -1.881981058024437e-04   +4.103602262654315e-03   -4.746316386151317e-02   +1.253428505422451e-02   -2.466364657003892e-02   +3.823587892601989e-02   +2.934668679075016e-03   +2.300819316070261e-02   +3.745864850531758e-02   +8.132334310730311e-03   +1.591381616064572e-02   +5.625456278487705e-02   +1.010239620227914e-02   -3.263629040590587e-02; +3.072691492617720e-02   +3.321414864409186e-02   -2.075699384507615e-03   +4.316174520245964e-02   +6.282426683210166e-02   +9.053366128501850e-02   +3.789045208831902e-02   +8.776785196888806e-03   +3.580458510713404e-03   +6.141326333883442e-02   +5.653188514988659e-02   -5.687604202919902e-04   +8.254024507031534e-02   -3.599083624013011e-02   +9.690130408123851e-03   +5.111691168233586e-02];
L2I_L2E_iAMPA_netcon = [+2.402089492903407e-02   -6.135693272464281e-02   -2.204376933735073e-03   +2.533650871820361e-02   +5.588595548640249e-02   -1.542144873643283e-02   +8.747311876915687e-03   -6.043439755208697e-02; -9.599264171729953e-03   +5.530392714738507e-03   -7.390980433599301e-02   +1.144989824704168e-01   -7.717530568718770e-04   +1.533503961779816e-02   -4.071025518583662e-02   +3.599084177942160e-03; +6.873392026451776e-03   -2.274228208725042e-02   +2.103569545743285e-03   +4.750800715399515e-02   -3.967784506510175e-02   +4.731120835500964e-02   +7.781853980377559e-02   -3.424713428426660e-02; +3.949156052984024e-02   -2.531365340714607e-03   +3.666448853468132e-02   +1.781298685906636e-02   -3.605001258105114e-02   +1.749466418530946e-02   -7.376073339541610e-03   -1.206632815390028e-02; +6.981304642325389e-02   +2.403828433451450e-02   +3.484895278165318e-02   +2.457246866788338e-02   -1.255071526833005e-02   -6.468025303393969e-03   +5.441805259408054e-02   +3.410364587084938e-02; +6.841699020205773e-03   -1.385972710752704e-02   -4.764612787741761e-03   +2.508226403621304e-02   +6.423183775206492e-02   -7.241060721639495e-02   -3.230796408728891e-02   +1.178159408411170e-02; +2.015808715505931e-02   -3.083569452069190e-02   +3.819599484186043e-02   -2.869446649866492e-03   -7.081394536161735e-02   +3.483231750166679e-03   -2.597953415818735e-02   +1.546778772565219e-02; -7.503918112149424e-02   -3.693354076470602e-02   +1.064464293743593e-02   +3.330692842958372e-02   +9.054944560023014e-02   +2.475002300149375e-03   -6.797740734367849e-02   +4.369606267730423e-03];
L2E_L2I_iGABA_netcon = [+3.226933324098510e-02   -9.392580633377539e-03   +6.825856721639120e-02   +4.396448602916179e-03   +2.493476768538478e-02   -5.640494599568002e-02   +4.762896278711046e-02   +2.613656101609897e-02; +1.900216628975057e-02   -1.924580216018100e-02   +6.083984484364758e-02   -1.256168376067678e-02   -4.778522347878967e-02   -2.280773953213035e-02   -5.251263576407584e-02   -3.656279636876919e-02; -5.129496684711539e-02   +3.105218977858382e-02   -2.354501991769765e-02   +9.190228621626306e-02   +2.124542004252424e-02   -1.687465843289979e-02   +8.729848805413682e-03   +1.005398276852326e-02; -2.365399246647649e-02   -1.558419139598262e-02   +4.988708906015861e-02   -7.243634370874483e-02   +1.256561561158934e-02   -3.209385885952797e-02   +2.952439875051172e-02   -3.556103223056021e-02; -1.181342128674992e-02   -9.348907819286597e-03   -3.486975345099772e-02   -1.105730706239009e-02   +4.770603255491676e-02   -6.281299023921819e-02   -1.672994704116521e-02   -4.605123592375653e-02; -1.890266120204391e-02   -1.558944727926230e-02   -2.642558427871595e-02   +4.210089656663696e-02   +6.687641971107385e-03   +1.416724365364997e-02   +4.641602488112374e-02   +4.640347742020890e-02; +1.306602432449295e-02   -6.332312805620091e-03   +4.958883349394712e-03   +8.769375702148834e-02   +3.708898594261595e-02   -2.465613170779746e-02   +4.343850945076067e-02   +1.664489311497794e-02; -2.001475963801772e-02   -2.944852684694577e-02   -4.086611630151000e-02   -3.110204622968320e-02   +4.795384098469199e-02   +5.357059319189567e-02   -1.955318140045014e-02   +4.659722937743225e-03];
L3E_L2E_iAMPA_netcon = [-4.647354393747334e-02   +1.556855585959468e-02   +5.999323137399775e-03   -3.447698481988566e-02   +4.166191307580631e-02   -3.580153474715041e-02   -8.912598983144475e-02   +7.615169265842714e-05   -2.075440183325013e-02   +3.282667026969564e-02   -3.816698886230047e-02   -2.197836174018384e-02; -9.027184119067608e-02   -2.877994432194781e-02   -9.663952200683888e-03   -2.368244455660986e-02   +5.828248838376889e-02   -5.808682317775241e-02   +2.168690630641364e-02   -3.392587016634201e-02   +5.359546832165335e-02   +1.202699512407678e-02   -9.082499101525435e-04   +3.842324533333802e-02; -2.930713098069827e-02   -5.311583702222464e-02   -5.281393450498486e-02   -2.958794312570977e-02   -3.267336257285176e-02   +5.145166029585573e-02   +6.690923570990132e-03   -6.927457936787851e-02   +2.903335878284436e-02   +4.660279318051230e-02   -3.049944420252466e-02   +2.338173426345828e-02; -2.526886367558911e-02   -5.170883572046927e-03   -6.437586753464591e-03   +3.964260280459026e-02   -2.668381373429115e-02   -2.609592996762226e-02   +6.831411069380500e-02   +7.009900518931549e-02   +3.587625591544730e-02   +1.376400864850658e-02   -5.820857088364892e-03   -4.851944296845864e-02; +2.881327986994772e-02   +3.134453157745596e-02   -4.741625722534482e-02   -2.851271148696875e-02   -4.321587024289138e-02   +1.723991643551179e-02   +6.757222103893232e-02   -2.554153725188913e-02   -1.514178876415278e-02   +2.029516949348401e-02   -2.117602284628335e-02   -6.411667704768734e-02; -1.670231926426139e-02   +1.418305493153491e-02   +3.574986881396420e-02   +5.097476564318530e-02   -2.821577589406993e-02   +2.599864724289137e-02   +7.303854098204858e-03   +2.626392164124185e-03   +4.036483389224221e-02   +4.093474424632805e-02   +3.629372422078676e-02   +3.073243698342533e-03; -1.211096657077454e-02   -6.320390677871279e-03   -6.420017807237455e-02   -4.649527228498050e-02   +6.989409874417771e-03   +1.906394817247043e-02   -9.793578469465969e-03   -3.597406575974404e-02   +4.445910855098842e-02   +1.524894210963689e-02   -3.111945304849510e-02   +3.685809704373358e-02; -3.509688602865105e-02   +2.800315258208968e-02   -2.402692798974362e-02   +1.601649683272781e-02   -1.845558100468514e-02   -2.217742597814203e-02   -5.164257032743459e-03   +3.563365743004864e-02   +5.348051909268509e-02   -4.538930631944014e-03   +2.554837321338077e-02   -5.116080301845633e-02];
L3I_L2I_iGABA_netcon = [-5.473631081294836e-03   +4.190352035970731e-03   +1.055768714100800e-01   +1.425629543672277e-02   -4.339998165982410e-02   -1.591970410411985e-02   +2.701112134676551e-03   +9.467491199570155e-03   -4.859399067420801e-02   -3.262002184249251e-03   +6.327590938809655e-03   -6.144641045979299e-03; -2.106341646348827e-02   +4.857776947787584e-02   +5.304708971479150e-02   +1.249988159335649e-04   -5.568696709959280e-02   +5.695641819913521e-03   -2.056378995034479e-02   +2.725017850979831e-03   +1.868658376490475e-02   +2.259169300581846e-03   +2.518938696219464e-02   -4.272460561209533e-02; -3.209562595945015e-03   -8.181149603429377e-02   +4.766280568784685e-02   +3.178230478540460e-02   -3.223976851946448e-02   +2.998103550360403e-02   +5.115743086538969e-02   -3.438611508168642e-03   +1.322056430509167e-02   -3.946484712642705e-03   -7.985444847310733e-03   +4.070880543992739e-03; -1.805266029654614e-02   +1.367452911002907e-02   -1.216144044710952e-02   +6.519645933487285e-03   +6.784139155417818e-02   -2.412416655747723e-02   +1.991107328687657e-02   +3.908156065689924e-02   -2.235597547274109e-03   -9.935940936183761e-03   +1.145551174486182e-02   -5.635496444060788e-02; +2.824380991018286e-02   +1.251603285685242e-02   +6.819301198191477e-03   +5.613933425930709e-03   +2.194033757840732e-02   +5.948299549034342e-02   +2.137484438066426e-02   -2.340825070941322e-02   +3.568658561853211e-02   -6.053634295837248e-02   +3.590184887551056e-02   +2.297316572827579e-02; +7.885103105044929e-04   +7.377172365559530e-03   -4.616061500290360e-02   +4.573775222251644e-02   +5.966920153081541e-02   +2.538300381282629e-02   +2.497804088960622e-02   +1.951575780345190e-02   -4.362550784177076e-02   -3.907104715387820e-02   -1.741403211354738e-02   +2.368430000300537e-03; -2.063260151647782e-02   -3.505162070335744e-04   -4.423731903890774e-02   +2.008065242584451e-02   -3.860392268033534e-02   +1.473024612599967e-03   -5.306071299426879e-02   -2.094496399488574e-02   -3.988223617609549e-02   -6.547637666269769e-02   +2.181172524125356e-02   +7.104016458785167e-04; -2.865821330616287e-02   +9.963815255679116e-04   -2.448431407450107e-02   -2.948516138887142e-02   -5.163194911954297e-02   -1.068877442059242e-02   +3.738993518895718e-02   -4.650134549869992e-03   -1.237737104124357e-02   +4.133749234749418e-02   +4.462057094339017e-02   -6.574519000383201e-02];
L2E_L3E_iAMPA_netcon = [+9.967460347138767e-03   -6.226317042420742e-02   -5.580549801432753e-02   -7.776101792397822e-02   +6.754839931157465e-03   -6.375922351565394e-05   +1.894042824077183e-03   -3.864522741195593e-02; +5.053591293846010e-02   -3.357407772206607e-02   +5.769144767056292e-02   -4.331964433606800e-03   -2.455079626327419e-02   -1.698175780373393e-02   -4.483733558613974e-02   +6.532267793278182e-02; -3.501350704793486e-02   +5.557922819462773e-02   +4.645898080657480e-03   +1.694659775149921e-02   -1.512801247646014e-03   -1.793692538064134e-02   +1.768056536530371e-02   +3.582629628247905e-02; +3.954288674806646e-02   +5.351673506104535e-02   -1.856976377579222e-02   +1.276285550166821e-02   +8.329305270111591e-02   -2.013197796258540e-02   -8.780875484394088e-03   +1.343459558333334e-02; -5.563966058888281e-02   -1.094245273835579e-02   -3.767631104723734e-02   -5.798606570676027e-02   -2.846395962378281e-03   +2.438430494702809e-02   -2.760439065736318e-02   +4.937787674754092e-02; +5.844280314179666e-02   -4.935504587582956e-02   +2.656589321632735e-02   +4.898057943243446e-02   +1.590216246248615e-02   -2.146494437753726e-02   -2.045259442275818e-02   +2.976185977869538e-02; +5.611755088797137e-02   -5.874058062070346e-03   +1.478275647114693e-03   +2.650934126412931e-02   +2.318695933874078e-04   +2.136404296414538e-02   -2.602817298827342e-02   +1.031059764832032e-02; +2.416021878467653e-02   +1.348149515465533e-02   -1.122151054809221e-02   +4.464995176969114e-02   +5.341773403428310e-02   +2.047199752512761e-02   -4.337913846215501e-02   -1.212708479023621e-02; +5.640813443026949e-02   +7.898990149972232e-03   -3.342865725309609e-02   -9.749212220872570e-03   +3.510585793508388e-02   +4.433462144503685e-02   -1.816043559719211e-02   -8.041258080890517e-03; +1.658065449645552e-02   -5.170658256419410e-02   -2.499635426958466e-02   +3.086082843124911e-02   -4.294275764381399e-02   -2.243731475466451e-02   -2.206820304888460e-02   +9.312572756229183e-02; +1.415812731139483e-02   -1.244436947069265e-02   -1.407453245855665e-02   -4.008107453574792e-03   +4.912802120566580e-02   +5.608946458778609e-03   -6.947173393571335e-02   -4.370685070284334e-02; +4.188190482966835e-03   +7.062760412977660e-02   -2.760277316583151e-02   +6.197443463883501e-02   -5.494251578404641e-02   -4.993825059216338e-02   +3.116930469404021e-02   -2.187684270530029e-02];
L2I_L3I_iGABA_netcon = [-7.322900336378177e-02   +3.637561229749385e-02   -8.103555175081260e-03   -1.520647689108980e-02   -6.018924104760712e-02   -5.770098778779520e-03   +3.580574814425143e-02   +1.200063298237956e-02; -1.031340100819905e-02   -3.942611512621918e-02   -1.761890862213447e-02   -6.557801246569729e-02   -4.672274016259245e-02   +6.384690936489958e-02   +1.011432940182017e-02   -3.485331452185789e-02; +4.060998281264279e-02   +2.839274150291911e-03   -8.676949693734351e-02   +1.261182740235256e-02   +3.757353536347669e-02   +6.377038353331335e-02   +4.457009360236344e-02   +1.720839378409725e-02; -2.432944261644820e-02   -3.253562962842533e-03   +9.988540699230882e-03   +3.103423620131891e-02   +1.841012394665674e-02   +1.545659682815109e-02   +4.213990526360709e-02   -2.245120170715615e-02; +3.764685906297430e-02   +1.692647997640719e-02   -7.503741998855598e-02   +4.612599794822157e-02   +2.929939474053515e-02   -8.854686811738541e-03   +1.368934230690895e-02   +2.859043021903816e-02; +3.419989487525476e-02   -5.222492808741845e-03   -2.953575357318507e-02   -5.196095601733303e-03   +1.639304613943453e-02   +6.009781635774862e-02   +2.378709999735878e-02   +9.043202483307684e-03; +1.700947179576087e-02   +3.424932289225660e-02   -2.605556823075157e-02   -4.147986916047340e-03   +1.338084098015207e-02   -1.545599560486600e-02   +1.277342794087270e-02   +2.945143604965837e-02; +4.881539538501566e-02   +1.727375942247883e-02   -4.992482908169472e-02   +2.053956788009840e-02   +2.611609833577136e-02   +5.348109778946084e-02   -6.902601160522805e-04   -5.445800168355577e-02; +5.697517836619372e-02   +6.950254487718684e-02   -1.641265021102053e-02   +8.808680166502356e-02   +5.360552585720210e-03   -1.068093625965973e-02   +3.440033500946967e-03   -4.496745694662729e-02; +2.130345496207905e-02   +5.278382435919558e-02   +3.007449155402007e-02   -1.557989621573038e-02   +2.062807486107345e-02   -3.915925794574558e-02   -2.247744396471737e-03   +2.983328583413154e-02; -2.456246485021007e-02   +7.015575946027526e-02   +1.558866003940613e-02   +1.800013003267701e-02   +4.443927456801963e-02   +8.403981070426449e-02   -1.730888943900224e-02   +8.451255615731504e-04; -5.762696828609808e-02   +9.728602460951625e-03   +3.242660940695931e-03   +7.515949032803611e-02   +4.712492115741738e-02   -1.265995565521915e-02   -6.839379881001198e-02   -3.892929270462098e-03];
L3I_L3E_iAMPA_netcon = [-1.449534538526524e-02   +3.131231800023761e-02   +1.091546474049668e-01   +5.453811118902105e-03   +3.165796363906476e-02   +3.349352180500614e-02   -4.271643475425244e-02   +2.933956109659705e-03   +1.874486739926441e-02   -4.943197332722679e-02   +2.828318473665624e-02   -6.735970096891024e-03; -1.103243959457217e-02   -3.932557180750555e-02   +1.362661378922974e-02   +8.854842037896011e-03   +2.859965698515446e-03   -6.591976322268417e-02   +1.400480066608785e-02   +1.250843031161546e-02   +9.327883459772167e-03   +6.283064131374191e-02   -5.842872860633531e-02   +3.858644803105178e-02; -7.359231888171086e-03   +8.652640147164058e-03   -2.481478424411997e-02   -1.029439931359475e-02   -5.618296040704273e-02   +2.232590682044593e-02   -2.189820492775267e-03   +1.515727859578548e-02   -1.148014906955833e-02   -1.283825925255981e-02   -4.561858197370687e-02   +2.985995274186205e-02; +3.699217106653396e-02   +2.781064039300183e-02   +2.470558998873121e-02   -3.757500665894500e-02   -8.011073232562395e-03   -5.262867819174308e-03   +2.181582697901409e-02   -3.830573820809691e-02   +2.561722385251917e-03   -5.649663570939043e-03   -6.251541474983091e-02   +4.457312416535356e-02; +2.484575407787052e-02   -9.903173234291963e-02   -8.767608329193180e-02   -1.956008617870733e-02   -5.725810226569047e-02   -6.614161421446130e-02   -4.187127935265857e-03   +4.546232867100935e-03   -1.037866623075188e-01   -8.899566051461293e-02   -7.274258336990597e-04   +5.794079941410193e-02; -5.604845200186805e-02   -4.988369151000538e-03   +8.578451695798554e-02   +3.754272527311411e-02   -1.870537740957794e-02   +5.428454382257087e-02   -5.059059537876444e-03   +5.014597934473445e-02   -3.205571808459506e-02   +6.427223764095934e-02   +3.375571316047572e-02   +3.166879910161132e-02; +6.071164474906572e-02   -3.391274364171056e-02   -3.274308919525798e-02   -1.132599778734906e-02   -1.126555144055854e-02   -2.708699135849929e-02   +3.444296522430838e-02   +5.321060985404096e-02   +3.306750472953296e-02   -5.746158784481167e-02   -3.928347814872631e-02   +6.619777696422502e-03; +8.145676675093368e-03   +1.980328835369313e-02   +3.980431542511351e-02   +1.041166613251263e-02   +2.291165330714680e-02   +4.503495823724901e-02   +4.162699468473162e-04   +4.956074524625390e-02   -1.551276351236125e-02   -6.477933429118615e-02   +3.989289415728889e-02   -3.017114697526726e-02; +1.834992230560011e-02   -4.191386235490110e-02   +6.989241101695315e-02   -3.586880709708666e-02   -1.671754252179386e-02   +5.507664751598421e-03   -4.811264354525605e-02   +4.225759611756405e-02   -9.289553251963565e-03   +4.960073516836642e-02   -5.374108354378585e-02   -4.163535687342212e-02; +2.171163702165837e-02   +3.426070241210148e-02   +1.386918058813416e-02   +1.091582145463166e-02   -3.654187835236803e-02   -3.744647713137360e-02   -4.615993062541630e-02   -5.440348543061573e-03   -1.370007246556118e-02   +5.945948599314750e-02   +2.142087942357611e-02   +3.182111679323125e-02; +2.693370601787272e-02   +7.366649030039026e-02   -3.514681500869039e-02   -7.599945552165058e-02   +1.195862867663327e-02   -3.287358647746161e-02   +7.180778559370379e-03   -3.813483713368981e-03   +2.969951751936095e-03   -5.381799046107457e-02   +4.821099797777278e-02   +4.014819835800446e-02; +2.948778984859651e-04   +3.126131771194464e-02   +4.407702565563663e-02   +3.753832723220864e-02   +6.491516923733714e-02   -1.749374486712158e-02   -3.622098742841529e-03   -4.917434030087494e-02   -3.868459525637343e-02   +5.785568392797742e-02   +2.476610406511376e-02   -1.260399189083577e-02];
L3E_L3I_iGABA_netcon = [-3.655028418680692e-02   +5.161108658230636e-02   -3.635803630534279e-02   +2.961487193862366e-03   +1.113980711822662e-02   -3.048003948188520e-02   -3.787182027610395e-02   -2.502879820726771e-02   -6.663131812974546e-03   +4.475892845166364e-02   +8.855384305634380e-03   +4.961082055727921e-03; +5.890103440044910e-02   +1.039826595363309e-02   -6.367410362140037e-03   +4.138940059722233e-02   +3.443413658932130e-02   -5.798341463716310e-02   -3.460204432767521e-03   -7.769933714031050e-03   +3.718317916219240e-03   -2.849597786888719e-02   +4.073413374856200e-02   -2.319352589552480e-02; -2.939348928296623e-02   -3.117168866418906e-02   +1.112678618741073e-02   -1.198225412377643e-02   +2.014560511386186e-02   +1.394588565965104e-02   +3.832380597467858e-02   -3.187846543490607e-02   +2.855419033990797e-02   -2.559682361456075e-02   +3.251001228081778e-02   -6.579766062002269e-02; +3.242313293700696e-02   +2.292625485623404e-02   -4.073800811631571e-02   +2.208823987381613e-02   +5.621138291790012e-02   +6.062501244964312e-02   +3.855283280783976e-03   +5.032880746839110e-02   +7.331357420596088e-02   +1.662184300832449e-02   -7.693317123259795e-02   -1.775085345150868e-02; +4.684200911468636e-02   -1.097164348346386e-01   +1.168051059508884e-02   +6.149221566814123e-02   -1.147586367818042e-03   -3.893993354134194e-03   -1.262735220630436e-02   -3.694543186688533e-02   -4.164975117390590e-03   +9.344980066623074e-03   +3.417496158997373e-02   +4.154836012953481e-02; +1.517477172244149e-02   +3.306206722546561e-02   +1.127068522608243e-02   -3.387976605425105e-02   +3.166137291132791e-02   -2.512899703861242e-02   -3.672717477277834e-02   -1.423791446773973e-02   -2.187136646284921e-02   +1.066139343017753e-02   -3.189482864048618e-02   -1.646132329515770e-02; -4.983122725181539e-02   +4.843673581834809e-02   +4.266649495474593e-02   +3.291662922436810e-02   +4.645519346133042e-02   +3.971492139497108e-03   +2.113104982453391e-02   -5.065474493904459e-03   +3.873859758405322e-03   +9.544264895918081e-02   -9.036254788433269e-03   -5.877748509872377e-03; -6.275467652200280e-02   +4.950969574945766e-02   -4.659496846833826e-02   -7.843121314824121e-02   -2.175127137220937e-02   +8.433038880242761e-03   -1.677496234391049e-02   -2.700780497831129e-02   +3.898954646752516e-03   +3.215269231603823e-02   -8.668385256037728e-02   -4.620719242331892e-02; -4.233134929505774e-03   +5.369650300350007e-02   +2.164431407940284e-02   +1.711180522753888e-02   -6.616837448530445e-02   -2.038755300079664e-02   +1.023378601319225e-02   -3.375252628066754e-02   +6.181189978053929e-02   +3.698925185873188e-02   +2.908177307727674e-02   -1.399808726639733e-02; +2.561976918552795e-02   -5.558866627458715e-02   +1.199571699111160e-03   +5.473456528510383e-03   +1.806886984378789e-02   -2.267052760225479e-02   +4.589453347780548e-02   -1.054540329428633e-02   -4.077248409998046e-03   +9.724420367480720e-03   -5.140347414474732e-02   -5.271139034457005e-02; +3.641194792160855e-02   +6.124766977872811e-02   -3.923880013424577e-03   +2.842010366901811e-02   -3.894626587039965e-02   +4.036331416830485e-02   +2.317374664317266e-02   +2.244360237900839e-02   +1.387609263965827e-02   -3.041639503584524e-02   +4.500668748407696e-03   -1.268689109095263e-02; -2.857093161816661e-02   +1.466993169695179e-02   -2.679431189909912e-03   +4.247953160212371e-02   +4.613210207611540e-02   -5.213924357892517e-02   +1.456215382439475e-02   +4.526942761314732e-03   -2.551378611085309e-02   +6.555760242920407e-02   -9.882881778967853e-04   -8.862196589804633e-02];
L2E_Input1_iAMPA_netcon = [-2.920658667419156e-02   +2.016555229115715e-02   +1.703741248977508e-02   -8.814803060155030e-02   -9.933594241214733e-04   -4.873513874490535e-02   -2.468370709421147e-02   +3.839010134969744e-02];
L2I_Input2_iAMPA_netcon = [-2.525255598983584e-02   +4.504747055181491e-02   +3.909135322007624e-02   -5.788076185796390e-02   +3.472859064473914e-02   +2.353407113151014e-02   +2.748283324568728e-02   -2.421851646916061e-02];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.03*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.15*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.15*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.03*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.15*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.15*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
