function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-4.378479055579770e-01   -1.902486429989873e-01   -3.624144503760655e-01   +8.412193673975740e-02   +1.194975113011534e-01   -7.315970433622100e-01   -1.501682024648475e-01   -7.389070441450098e-02   +9.405730477202265e-02   +1.177118819798391e-01   -4.901271725631623e-03   +3.962675069442874e-02   -6.322819823201122e-03   +4.447733836738357e-01   +2.246408688596993e-01   +4.330936135261960e-01; -1.732257892286426e-01   -2.087074232984461e-01   -6.057078512011198e-02   -1.748300006375955e-01   +1.661020945772147e-01   -9.517944322330696e-02   -2.297906400919127e-01   -3.764966184286468e-01   -2.291819308058646e-01   +3.911002913429485e-01   +3.262291275524103e-01   +3.640226161397267e-01   -1.102452724919699e-01   -6.193496140380453e-01   -3.433504022031809e-02   +2.201544640177914e-01; +4.204144191526562e-01   -1.893475715405964e-01   +1.122642480405340e-01   -5.461526791038138e-01   -3.112499518835234e-01   +3.452681461878550e-01   +7.129166778080644e-03   -6.753724848890592e-02   +1.268026999251231e-01   +1.634665550790913e-01   -1.763782054985391e-01   +4.939891045779746e-02   +3.690546991039870e-01   +1.518776818094084e-01   -7.471985796576357e-01   +3.846711509186081e-01; +3.413188525395702e-01   +4.195572541195747e-02   +1.322989631537440e-01   -7.717686730529889e-01   -4.501853846853018e-01   +9.060322693045317e-02   -2.700986106370965e-02   -7.026319402400551e-02   +1.761667254175409e-01   +6.824485859737657e-02   -3.630568985950564e-01   +4.804119123160505e-01   -2.586562107253313e-01   -1.881390240318339e-01   +1.280911339793764e-01   +1.256774055463546e-01; +5.089151308421362e-01   +1.960769278402216e-01   -3.680565713227993e-01   +3.562234653879908e-01   -4.930175198350297e-01   +2.809489753610561e-01   +3.706807603940411e-01   +2.695349668563983e-01   -1.905960180188782e-01   +2.491456037411369e-03   -6.207606969683380e-01   +1.956422529720617e-01   +5.069006452820685e-02   -1.590830691597857e-01   +5.774951358046262e-01   +3.658227963401564e-02; -2.574341846700556e-01   -8.377218685284790e-02   -5.652546578502654e-01   -3.148086255832239e-02   -2.870140374107453e-01   -2.354056170609355e-01   -7.296283754914713e-02   -3.120450092115369e-01   -1.185805363471572e-01   -3.302581112189685e-01   -3.225294670910455e-01   -5.424595133581571e-01   -3.035251058286899e-01   +3.596894500032789e-01   +3.263180626941352e-01   +2.202984223493857e-01; -3.926315240390466e-01   -1.996129755130308e-01   +1.430007948695755e-01   -7.129734726805838e-02   +4.899560579389235e-02   -2.373276116596987e-01   +1.994832466406524e-01   +1.466232461907384e-01   -5.947677747632043e-01   -4.413419481461173e-01   -6.413399391647708e-01   -5.302202108163661e-02   +4.365531614373309e-02   -9.763419237354690e-02   -2.094499102461563e-01   -1.707286870951392e-01; -5.772186602920736e-02   +1.205392841381161e-01   -8.237810181458549e-02   +4.099635868028918e-01   +6.233969801087787e-02   -2.251614283158445e-01   +2.298514129862458e-02   -5.185240235482396e-01   +7.330854992631206e-02   +7.164023469912013e-02   +2.533172552315601e-01   +9.092853134026348e-02   +3.105102427510803e-02   -3.672007442958174e-01   +4.327038477561111e-01   -2.164514179804649e-01; +1.976524852960631e-01   +4.137081072314746e-01   +4.129986018920032e-01   +2.970417175121552e-01   -1.062598645101601e-01   -5.509114090512024e-01   +3.528248746783160e-01   -6.602943609556178e-01   +3.110992935806320e-01   +4.142782852861605e-01   +4.192466847487094e-01   -5.108460831333557e-01   -1.217617595841310e-01   +3.081821774316801e-01   +1.335328540568912e-01   +7.263559403237377e-01; +3.529778390070421e-01   +2.598385547061529e-01   +3.494957821412544e-02   +2.060557612688078e-01   +1.711272425565070e-01   +3.894367332596726e-01   +6.459140344233438e-02   -4.350048658707089e-01   -5.680727748392991e-02   -2.241103997604665e-01   -7.222734491191810e-02   -3.650516667659893e-01   +7.067822444873290e-02   +1.202528000607382e-02   +2.676175836090676e-01   -4.565537474984554e-01; -7.995942593269290e-01   +4.035217710249029e-02   +1.786401786931898e-01   -2.358969545567031e-01   +7.467701699716681e-02   -2.462681180261700e-01   +1.255099752375254e-01   +4.082995200152609e-01   -2.152825481169660e-02   -3.497793441166855e-01   -1.807890001566395e-01   +1.812511262462878e-01   -3.604361181982520e-03   -5.458436150787700e-02   +2.306644736670848e-01   -4.548376257766076e-02; -2.150263644951884e-01   +4.658632427196541e-01   +3.932119710192044e-01   +2.510818273316582e-01   +7.717910506600474e-01   +1.423379596056197e-01   -4.403703626866018e-01   -2.159134089375795e-01   -2.660929856846574e-01   +1.502876681204808e-01   +2.554582100257206e-01   -8.379588982963727e-02   +3.080754846350118e-01   -4.536530643757597e-01   -1.274455642247211e-01   +5.392275612639162e-01; -5.450515912949839e-01   +4.365696412303650e-03   -6.464541451800927e-02   -3.878201070596057e-01   +2.459976834899333e-01   -6.874787792696969e-01   -1.336449958158442e-01   -2.649190981336733e-01   +6.025164808219505e-01   +4.987094588814192e-01   +2.299172651885420e-01   +3.731845108129423e-01   -1.286730642927777e-01   +2.012194311635573e-01   +6.065284383622249e-02   +2.290397829857778e-01; +2.338863009054396e-01   -3.811093161288468e-01   -2.949023684445121e-01   -1.536444259553064e-01   +6.502671234719246e-01   -4.508910343375013e-01   -5.074511541461274e-02   -9.045528495203273e-01   +1.738004983436054e-01   -1.802917118355271e-01   -2.669700749353238e-02   -5.755416083040802e-01   -3.415167369847170e-01   -6.958683786888932e-02   -3.960340999123954e-01   -3.182749521353153e-01; -1.190525821422266e-01   -3.207390200386992e-02   -4.709391773995237e-01   +1.139705477901606e-01   +1.291839026961165e-01   +7.511308390457164e-02   -1.779083173221855e-01   +1.738159199689061e-01   +8.017021961425201e-02   -2.152844334834370e-01   +1.414235158467718e-01   -3.327177249377052e-01   -3.659194922219524e-01   -5.626833773141647e-01   -5.293379383413592e-01   -8.108949952528374e-02; -1.972284774179899e-02   +4.535059815632007e-02   -3.078476373403508e-01   -4.627580066307102e-02   +1.160508590212352e-01   -3.341218734401034e-01   +1.882804670483621e-01   -5.022996054113845e-01   -9.618081350329563e-02   +3.823941671458422e-01   -9.792408335715522e-02   -3.438167268768758e-01   -5.551295386455525e-03   -2.279398586520364e-01   +2.141726907239141e-01   -1.607513834973248e-01];
L1E_L1I_iGABA_netcon = [-7.239198216596759e-02   -8.288351057611829e-02   +3.242160684610184e-01   -2.545957606378347e-01   +9.870122126062045e-03   +1.461399548870140e-01   +6.664452820803582e-01   -2.735064243212377e-01   +4.049030071115756e-01   +7.978975946822159e-02   -2.437170331293415e-01   -4.350807228733072e-01   +3.324612055560320e-01   +3.752903378976992e-01   +5.059337221834240e-01   -3.022817258760339e-01; +4.330865528286028e-01   +1.872143871409553e-01   -1.701398906967523e-01   +2.482390187767626e-02   +2.312202284278290e-01   -2.572720521572874e-01   -3.909021867117077e-01   +1.509703817480416e-01   -1.980549484711840e-01   -7.488443802365112e-01   -8.975382061336187e-02   -1.370152284371621e-01   +9.805706892302679e-02   -5.416403191995697e-01   +1.823035263256789e-01   +2.338118572775729e-01; -6.464096261255070e-01   +7.484708547242731e-02   +7.409847090496430e-02   -5.686715949569632e-01   +1.884464451271959e-01   +1.652350286595127e-01   -2.337212487867528e-01   +1.120153310819340e-01   +6.661297239330987e-01   -2.314501048316047e-02   +1.805493288555015e-01   -4.179712295818483e-01   -3.247994964895759e-02   -4.451705374849139e-01   -1.490897886554281e-02   -3.027312816469224e-01; +4.970612791140563e-01   -3.318324309204016e-01   +2.573088361515701e-01   +6.312235398483632e-02   +1.642244602075076e-01   -1.396465812875806e-01   -5.275221186770139e-02   +4.614511914145122e-01   -4.494709633441618e-04   -4.101837137827890e-01   +6.500685594805767e-01   -5.404436774285851e-01   +1.280745680165652e-01   -2.077623079695246e-02   -4.760472999792352e-01   -2.534488276741134e-01; -6.403399672590161e-02   +6.073727426418735e-04   -3.320011691581765e-01   -1.109452914806297e-01   -6.394614021570556e-02   -3.126530334719442e-01   -4.641095587035518e-01   -3.482971482638588e-01   +2.903299537003771e-02   -3.805600946050401e-01   +2.400174842329710e-01   +3.163345829583680e-01   +1.578835156243818e-01   +1.888971639387559e-01   -2.946907577197962e-01   +9.173336881938932e-02; -2.435884632697701e-01   -2.327409214367716e-01   -2.120901589532963e-02   +2.723039203594123e-01   +3.312272523060867e-01   +3.534277116410118e-02   -6.090830553152216e-01   +3.800552823668762e-01   +3.133343141785030e-01   -3.556654354337926e-01   +1.646478730651867e-01   +4.228863125107223e-01   +6.622927369349126e-02   -2.085866631166669e-01   +5.926556799652014e-02   +3.097982876088027e-01; -1.633723724314873e-01   +1.672530910613805e-01   -1.612743126611755e-01   +1.617585826515104e-01   +5.628306544083252e-01   -2.413340199144893e-01   +2.507336050967648e-01   +3.327106165805868e-01   -6.045527129080099e-02   +5.362607054156853e-02   -3.387924114861667e-02   -5.674677402887864e-01   +1.256329490566377e-01   +1.014937752567178e-01   -3.834117982181821e-01   +1.145013190435364e-01; +5.545031542581666e-03   +3.841762362376372e-01   +4.949998787160102e-01   -3.961622574094760e-01   -3.820609624414638e-01   -4.549905869040212e-01   +1.293392990513466e-01   -2.378314100587911e-01   -2.392114884556192e-01   +1.859743909278208e-01   +2.230737161895404e-01   +2.607000331661858e-01   +3.928840592337313e-01   +1.890789300959868e-01   +3.889302216056933e-01   -5.248601074218782e-02; +1.305594446139914e-01   +3.226449817629701e-01   -1.561937763337725e-01   -1.008157685813790e-01   +1.752512490328670e-01   -5.432842509696120e-01   -2.331219385782075e-01   -5.246966393248402e-01   +2.795679177516138e-01   +3.525211562787282e-01   +3.334045674901577e-01   -2.254752700615942e-01   +2.150265753656604e-01   +2.047034782526118e-01   +3.361020947223402e-02   +3.965581990988441e-01; -5.461519519060004e-01   -2.086494380281033e-01   +5.503147762810905e-01   -2.179739604329399e-03   -2.022187578627503e-01   +2.598909324056859e-01   +1.262516380455616e-01   +4.539302674756200e-01   -2.411498206092330e-01   +4.712764734520203e-01   -2.851702998840655e-01   +1.865583433860277e-01   -1.499121692726267e-01   +4.141705304952308e-02   -4.391098977175241e-01   -9.249694669729766e-02; +1.867586159677462e-01   +3.450440995146558e-01   +7.130170796041267e-02   -3.558853556386021e-01   -6.741425680970315e-01   -1.046335465879227e-01   -2.771548289562559e-01   +2.745354726013711e-01   +2.092527112855816e-01   +2.883655121763405e-01   +9.326265260155667e-02   -4.031127736572412e-01   +1.716326704537324e-01   -3.529984041295853e-02   +1.048826458509067e-01   -1.531644600472584e-01; +1.674777636858058e-01   +2.039091774959074e-01   +7.410027615049709e-02   +4.677555992717543e-02   -2.270136960334191e-01   -2.378891025360773e-01   +3.617318599852085e-01   -1.236810888824450e-01   +1.587113735593449e-01   +2.651603760120972e-01   +5.690556120047109e-01   -7.506110174022458e-02   -2.123834401002339e-01   +3.115599383563409e-02   -2.753210453108090e-02   +6.775152767962739e-01; -2.144152294934664e-01   +2.802618202392066e-01   +2.896915024534911e-01   -5.333507296835692e-01   -3.762433210669972e-01   -9.562530487321891e-02   -4.488892918272549e-01   +3.343426499279524e-01   -2.843994137230192e-01   -2.842048483001373e-01   +2.031551569127573e-01   +8.019781115790475e-02   -3.282771644214609e-01   -2.464680895833646e-01   -5.338180435262543e-01   -8.038555013285172e-02; -5.359015024840713e-01   +2.506716734648736e-01   -3.009173753955338e-01   -3.534261722803373e-01   -8.954183388229747e-02   +2.413646160537213e-01   -3.887274304436085e-01   +2.889396273793382e-01   -4.049751514901526e-01   +9.871344695457827e-03   +2.078120922634553e-02   +1.373408990336678e-01   +1.609925222072515e-01   +3.698597059604087e-01   -7.744248575331211e-02   -5.210195197508268e-01; +3.663242310533918e-01   +5.951923668930219e-02   -4.602772075172975e-01   -1.044975787820696e-02   +1.331420567585532e-01   -3.293036284889390e-02   -1.565657815051877e-01   -6.348969037250498e-01   +3.561580611855485e-01   -4.583054838908992e-01   +1.633561167808569e-01   +5.149165051572838e-01   +2.111087259609281e-01   +8.718690253332106e-03   +1.167570609378849e-01   +3.339382970610527e-01; -3.284852511511783e-01   -1.533852698333721e-02   +8.945490258539296e-02   -1.957878874823013e-01   -2.765578810072317e-01   +2.615214750711847e-01   +3.094667378730237e-03   +4.962626355604691e-01   +2.943049858875497e-01   -6.563250891151104e-01   +5.103652169111267e-01   -3.001954781355408e-01   +5.691611763930754e-01   -9.419672589192712e-02   -5.508716112261165e-01   +1.944950409546449e-02];
L2I_L1I_iGABA_netcon = [-4.173545992969147e-02   -2.996163647628193e-02   -1.448108001150910e-01   -2.737200432121943e-01   +1.488042191312990e-01   -2.325908029033619e-01   +1.199591571901954e-01   +1.909377141178695e-02; +3.683119153333566e-01   +3.183646392514941e-01   -6.390376838939575e-02   +2.854540203790341e-01   +2.840960136766496e-01   +2.680197644452439e-01   +8.319901166223775e-03   +1.967197575181767e-02; -1.482081223851510e-01   +5.709892618264339e-01   -6.121441098107104e-01   +3.468758472768282e-01   +2.767052212719748e-01   -2.490327947251073e-02   -4.144744621163584e-01   -1.187633899987457e-01; +3.075450988239021e-01   +3.708666134458055e-04   +4.587383123150377e-01   +4.189581270807488e-01   -6.675861275583459e-01   +4.531143302430237e-01   +2.982476231182727e-01   +3.294708208513508e-01; -3.875323587595602e-01   -3.625251685245668e-01   +8.726179898114568e-01   +3.415355419929317e-01   +5.410244362917364e-02   +3.465599577436189e-01   +8.721753532103771e-02   -3.844288946530505e-01; +2.260658372599183e-02   +3.212299351505258e-01   -6.340408537053591e-01   +5.973023372731828e-01   +4.059135170487451e-01   -6.128394064293851e-02   +4.371185541970425e-01   -2.062972117200162e-01; -5.470862214704255e-01   +1.843462997680642e-01   -6.398202153955900e-01   -6.791918266630983e-01   +7.263873566333623e-03   -6.234875477636052e-02   +1.430704690129023e-01   +9.753295077404120e-03; -2.827589916498521e-03   -6.747306113729344e-01   +1.414697906018765e-01   +3.033334415877009e-01   +2.452481944951805e-01   -3.948440736246468e-02   -2.658809627629724e-02   +1.109778784240514e-01; -4.767649916449084e-01   +2.696774648166226e-01   +3.274406748368757e-01   +5.539299803135457e-01   +3.675137205686929e-01   -3.145144609999983e-01   +4.091971814208279e-01   -6.993082779105018e-01; +2.685705190800076e-01   +9.465601826576737e-02   +6.564149225498954e-01   -1.172398575646516e-01   -3.474406259905991e-01   -5.969184999456967e-03   +2.989353589584559e-01   +2.453626811848196e-02; +5.757368999342271e-01   +3.212902180272620e-01   -3.209190465563189e-01   +4.570819332465451e-01   -4.564173094064684e-01   +3.253370964179313e-01   +2.843480013451734e-01   -2.572873661469416e-01; +4.420382252991384e-01   +3.765722639017215e-01   -2.870323181171316e-01   -3.553691999134914e-01   -5.583471831310607e-03   +6.155702193665599e-01   -7.814039543034602e-02   -1.608178517480160e-01; -9.850499090145344e-02   +2.892309750769891e-01   -2.118067948704821e-01   -3.038398042577976e-01   -3.090322953262379e-01   +3.704286657680071e-01   -1.198240168426735e-02   +2.494740219360963e-01; -3.991717707771271e-01   -4.901539420102730e-01   +2.100667052550023e-01   +3.774603950570195e-02   -1.538813965882998e-01   +2.897865196903122e-01   -3.388747425147806e-02   -2.210966537978253e-01; -7.407375129662903e-02   -2.324601497596412e-01   -2.981866456225987e-02   -1.081150834473056e-01   +1.498027985383124e-01   +1.744020133444089e-01   +1.223786362817612e-01   +2.227947840773255e-01; +8.799948799359479e-02   +6.141205281358886e-01   +2.760338009049083e-01   +7.965000937514261e-01   +4.569519310333532e-01   -1.102964918814971e-01   -1.428692123360557e-01   +3.068364170288954e-01];
L1I_L2I_iGABA_netcon = [+2.967209944875881e-01   +6.330297350525980e-01   +4.736014958292780e-02   +4.322530666039658e-01   -2.183469399384683e-01   +4.356101912306755e-01   -2.704816872427963e-01   +5.491666152355026e-01   -1.005350498082495e-02   -5.819275191229338e-01   +5.162644821650783e-01   +5.329410933083865e-01   +1.417728284594906e-02   +1.441124860174042e-01   +8.220367095583576e-01   +5.393524573034335e-01; +4.729557377092083e-02   -1.611409455686322e-01   +3.687702355845938e-01   -2.690816011396304e-01   +4.194278022684050e-01   -6.426406278660143e-01   +1.394565271479698e-01   -6.293212123043120e-01   -1.067170514084864e-01   +5.014607671091558e-02   -1.401568326555839e-01   +5.249150801605748e-01   -6.216175157516802e-01   +4.397981908628874e-01   -4.124600858019163e-01   +1.131828333175583e-01; +3.224094733840948e-01   +4.043032381057780e-01   +2.179728998430396e-01   -6.917392394119570e-01   -5.105079414628364e-01   -6.481794205352456e-01   +1.315350157883199e-03   -5.079244789196080e-01   -2.056656549015248e-01   +6.283751646820911e-01   +2.526469394969350e-02   -3.823273392840101e-01   -1.166716201538383e-01   -5.054285955076931e-01   -1.737837510871430e-02   +1.281429409016673e-01; -7.083553644664366e-02   -1.590347057191343e-01   -5.487522476171681e-01   -4.700522122384566e-01   +3.591984731035534e-02   +2.649121356825933e-01   +5.460645452504902e-02   +5.513477130268754e-01   +1.815563877646849e-01   +3.386061605310232e-02   +9.063951782861425e-02   -1.260444148428619e-01   -2.533786804589028e-01   -2.486739529633639e-01   -1.452712225513547e-01   +3.246453054050969e-01; +1.337111335179870e-01   +3.233846358543638e-03   +3.874911384600341e-01   +3.018848269909923e-01   +6.516791980512308e-01   -5.769529853761567e-01   +6.882798134537926e-02   -1.597207099800805e-01   -5.786393572430901e-02   -2.638280248843518e-01   +3.457803826070259e-02   -5.078749213849670e-02   +2.256539534910617e-01   -3.447851597527891e-01   +2.647261168358879e-01   -8.571156927263156e-01; +4.012899104393363e-01   -2.929582290294516e-01   -1.748186474980270e-01   -6.218341542391924e-01   -1.391092794514623e-01   -1.950295156484325e-01   -2.623668624204989e-01   +3.916519250934818e-01   +3.333678091666856e-01   -4.832411531855122e-01   -1.704950918746154e-01   +1.570371054034730e-01   -4.109679558275295e-01   -4.339303133953535e-01   -2.654656694740140e-02   -1.279012459868994e-01; -5.452230289135902e-01   +1.615971131609300e-01   -6.620895153789799e-03   +5.803061423275180e-01   -2.637957360226921e-01   -5.051577406486392e-01   +1.993955813539461e-02   +6.368440187863839e-01   -5.330162992043689e-01   +2.614113798237184e-01   -2.029381308092888e-01   +1.646928816276688e-01   -1.710435438481527e-01   +4.147742969060348e-01   -7.174692373514963e-01   +1.609525012310198e-01; +3.533258547162979e-02   -3.983225665776059e-01   +6.313654619420908e-01   -1.050661393872798e-01   -2.494633362997945e-01   -4.049262357794401e-01   +1.585437728050632e-01   -3.248687442342305e-01   -3.862303963635985e-01   -3.626304291901102e-01   +2.497200716139075e-01   +5.688756094238476e-02   -1.284663989591399e-01   +1.536842782627701e-01   -3.971942946863048e-01   -1.463469910225479e-01];
L2E_L1E_iAMPA_netcon = [+1.388212280411769e-01   +2.085900084824980e-01   +2.012701200760308e-01   +3.616298023145251e-02   +3.030358064573428e-01   -3.665417152602313e-01   -2.604978997845863e-01   -3.179503752683882e-01; +5.830865385494235e-01   +2.425226706979906e-01   +4.500529272549925e-01   -4.795954656465750e-01   -3.534800486911037e-01   -8.396383074778238e-02   -4.182793766670200e-01   +3.680958551390897e-01; -4.327194868107626e-01   +2.450436381416350e-01   -4.502570684500845e-01   +3.074227990716053e-01   +1.917475250537299e-01   -3.799434163239676e-01   +1.723566934939425e-01   +2.723625445067423e-01; +6.977048009687918e-01   +2.803999800692501e-01   +2.555878172528905e-01   +4.821898504131388e-01   -1.256612645684760e-03   -1.267147734288791e-01   +3.518235839599297e-01   -3.977338389318264e-01; +1.244267636114252e-02   +4.221842815001643e-01   +6.496980523574783e-02   +6.417791246687612e-01   +3.612083017107775e-01   +7.106308233006575e-01   +1.258415583839563e-01   +2.761394896831201e-01; -4.873614091098688e-01   +5.893749431638278e-01   +2.735832389349551e-01   +5.394205936133890e-02   -2.019214888347937e-01   -3.646627145961964e-01   -1.748522219287171e-01   +1.359197058731263e-01; +2.537985206955091e-01   +3.988180562879874e-01   +6.551628206305836e-02   -6.948533567357078e-01   +3.640121340531472e-01   +4.945050927828457e-01   +1.997833087180925e-01   +5.920490955386846e-01; +6.256017082837881e-02   +2.270321259561438e-01   -1.190893355221694e-02   -2.004664770771740e-02   -5.434758043443566e-03   +3.643713599862717e-01   +4.143006931909634e-01   +2.730947060834674e-01; -3.971437391885749e-01   -2.149604413186912e-01   +2.632074555329331e-01   -2.351058172100449e-01   -5.492585746468526e-02   +5.940515746639421e-01   +9.988190158446164e-02   +2.162998869179721e-01; -5.240075589352522e-01   -2.849128487592142e-01   -7.582680349622148e-01   +2.869225657456227e-01   +1.910624613893946e-01   +2.276310241521252e-01   +6.874957585841966e-02   +7.276266902136656e-01; -3.769652103657588e-01   +7.200343008051975e-01   -7.829793176205601e-01   +3.493577604714949e-02   +1.809648674354734e-01   +5.742033189169791e-01   -6.363235529693156e-02   -2.330977735467170e-01; +9.336582524909387e-02   -2.274221755520745e-01   +2.367910464937565e-01   +2.015489993102548e-01   +3.728214671072035e-01   -3.700102355369653e-01   -1.388510556838840e-01   -3.086312169991783e-01; -6.509989472458441e-01   -1.910165000899834e-01   +5.655483572545008e-01   +2.183536745513195e-01   -3.016582757633103e-01   -2.778638138669015e-01   +2.694218379358343e-01   +5.379805239656550e-01; -1.247033680689614e-01   +5.520521414454814e-01   -2.264437258865027e-01   +8.544746218522380e-02   +4.450480951746806e-01   -2.752574701954656e-02   +1.334458305121547e-01   -1.652352961779397e-01; -2.130837931083782e-02   -2.040933490965374e-01   +5.646823938060598e-01   +8.903385511694172e-02   -1.467849203780207e-01   -2.580260065021296e-01   -8.884994146303948e-02   +2.695598010532249e-01; +6.027032608818707e-01   +2.240897750719729e-02   +5.459987012028344e-01   +2.643392807733324e-01   -5.129861215936413e-01   +1.702537917488358e-01   -3.471183611932701e-01   +5.704563319451958e-01];
L1E_L2E_iAMPA_netcon = [-9.105002467131405e-02   -4.218162869996769e-01   +3.974016442696420e-01   -6.260970265591654e-01   -2.254481804710697e-01   +9.786717047391578e-02   +8.371478320298918e-02   -3.967727413129357e-02   +9.231995407890008e-02   +9.260526828731211e-02   -4.498292132286049e-01   +2.229219626470031e-01   -1.485887052190073e-01   -2.687921658933056e-01   -4.492803614750695e-01   +4.244795012556303e-01; +2.096412066679769e-02   -3.096615874155786e-01   +5.300723017797297e-01   +4.853425756688670e-01   +2.611995712262671e-02   -4.153172082081296e-01   -6.514520176404259e-02   +4.428685381101258e-01   -2.872334661817496e-01   +2.779085047987693e-02   +4.996830073078866e-01   +5.496262014191231e-01   -5.012430656705258e-01   -6.869432045754112e-02   -1.405649622817777e-01   +1.850933874929085e-01; +5.275177472618826e-01   +5.130389893961705e-02   +1.624077363267249e-01   +2.927914570363159e-01   +6.501710469962365e-01   -8.663461487626781e-02   +1.407376891005792e-01   +4.124705085889276e-01   -1.858019541295731e-01   +4.999471512207668e-01   +3.041301291846752e-01   +3.071777009997606e-01   +4.134854476650452e-01   +1.111582999266254e-02   -6.760212375425581e-03   +2.454629754186837e-01; -1.267507669200394e-01   -6.047448641034077e-01   -2.240806584839382e-01   +2.227238611570293e-01   -5.681889957220799e-01   -5.684159157293123e-02   +6.880157140919441e-02   -5.434406040105869e-01   -1.848046165424020e-02   +1.267156059569554e-01   -3.259776093882294e-01   -1.996973042866805e-01   +5.331329968714951e-01   +2.995989050144365e-01   +2.737458344302056e-01   -4.411626628837944e-01; -2.472437257718472e-01   -7.863999770629240e-02   -7.845771930465600e-02   -2.763640227705229e-01   -5.540900408770452e-01   +2.112126446538668e-01   -3.087129018138048e-01   +1.037654454525368e-01   -2.740586308258993e-01   +2.486583287796062e-01   -1.018376789161327e-01   -1.419662375931663e-01   +4.557739399479821e-02   +4.150116584501566e-01   +4.015538078629895e-01   +3.052162700266899e-01; -5.046547902289654e-01   +9.278188303040986e-02   -5.008381681161619e-01   -1.253875620959196e-01   -2.066618477646876e-01   +7.402444519356544e-01   +5.696073545831279e-02   -1.721599275728348e-01   -5.143861051447313e-01   +1.195647285123244e-01   -3.364459490186724e-01   -4.100739460359099e-02   +3.499264665208909e-01   -7.986246566726279e-03   +1.065567679462863e-04   -1.195451438014543e-01; +1.816510042176592e-01   -4.387346509308181e-01   -4.284539980297300e-01   -9.082053744852830e-02   +3.299453143009493e-01   -3.436300494766896e-01   -4.119822620711292e-02   -3.474326756787809e-02   -3.333114020414139e-01   +7.182626904098940e-01   +1.374752057502866e-01   +5.645371227234576e-02   -3.344025940358503e-01   -7.644502713896081e-02   +1.961824328659647e-01   +1.894790925426543e-01; -5.404894622852167e-01   +3.883129290508685e-01   +4.030202998469739e-01   -6.991778370255666e-02   +3.106324548454741e-01   +1.568073496739080e-01   +5.946787368049573e-01   +1.446680770735334e-01   -4.377607708190227e-02   -4.436991717464938e-01   -2.597480160691644e-01   -5.320792997059288e-02   -6.892952967805902e-01   -5.953683839215371e-01   -4.209381927986413e-03   -2.538256221127830e-01];
L2I_L2E_iAMPA_netcon = [+3.919581303765454e-01   -2.847276184306604e-01   +2.661001015098137e-01   +8.019473484166834e-02   -3.336580046741098e-01   -3.410723045980314e-01   -5.254373215636805e-01   +2.589108480908956e-02; -3.787422049297377e-01   +4.415079320740473e-01   -4.333550891190993e-01   -1.420682941096226e-01   +3.660527010666196e-01   -6.438561519317545e-01   +6.240558997957381e-01   -1.910695767163509e-01; -2.757061989648760e-01   +1.660059159489747e-01   -3.074394700769067e-01   +5.666860622811336e-02   +7.660638296898179e-01   -4.425254560166328e-01   +2.375266953713418e-01   -2.235289272293268e-01; -2.632311320752141e-01   +3.203348409264331e-01   +2.070649889915577e-01   -2.726853553682518e-01   +3.623741331080054e-01   -4.434617151063212e-01   +3.017352376280096e-01   -2.345883495761649e-01; +1.395099268342241e-01   -2.208229130230649e-01   -3.713909664774137e-01   +2.084764033041829e-01   -8.594852692820582e-01   +3.072966662269691e-01   +2.421424214543240e-01   +2.252079511694158e-01; +4.009216480555070e-01   +8.320131081947146e-02   -5.300796026665399e-01   -5.256454757502597e-01   -2.495562644121099e-01   +1.182235295538332e-02   -3.247715442042626e-01   -2.028105793562639e-01; +5.657789729095425e-01   -5.612709529895631e-02   -6.432845528549140e-02   +5.830193585864516e-01   -6.022818406594594e-01   +1.641663949911924e-02   -2.562012834640741e-01   -3.300804634337309e-03; -4.339868844329625e-01   +2.951042228529852e-01   +3.819774975386391e-02   -4.554222358433394e-02   +2.040721686752593e-01   +3.299444271825094e-01   +1.176558160202547e-01   +6.882177235507332e-02];
L2E_L2I_iGABA_netcon = [+3.093851559993303e-01   -8.580639568816394e-03   +1.255171142929022e-01   +1.201666200052257e-01   +1.583407715237082e-01   -2.321500299023776e-01   +1.426241497752409e-01   +1.016590320321076e-01; +6.484559633195192e-02   +7.078371010316051e-02   -7.998001831894866e-02   +5.697004833909285e-01   -3.586227217107614e-01   +3.462068271842863e-02   +1.492994193554238e-01   -4.543335515654022e-03; +1.020346618425527e-01   -4.655862531207351e-01   +3.631787364467066e-02   -5.084288755984304e-01   +7.649034720539478e-01   +6.758415269954544e-01   -9.384329555208668e-03   +2.548486540356257e-01; -5.492956889671481e-01   +4.749513642896622e-03   -5.129609032503795e-01   +1.184450968605347e-01   -2.856797588408977e-01   +3.303333621242460e-01   -2.167607002102515e-01   -2.835395223154293e-01; -4.011304396229035e-01   -2.161971055513557e-02   +4.292710964629120e-02   -6.968455778842659e-03   +1.903625727780935e-01   -1.780508211132093e-01   -3.715718639615649e-01   -6.454085386497743e-01; +2.820893263090399e-01   +1.700094293304585e-01   +5.188239830423699e-02   -3.976243204576742e-01   +2.306933371057638e-01   +9.201357966310855e-02   +3.585816631215871e-01   -1.563657076346758e-03; -6.974535923921257e-01   -4.189815361624553e-01   -1.618086412986042e-01   +4.960745487557013e-01   -1.067164449625548e-01   +2.998665496760514e-01   -4.521526024871417e-01   -2.565516603075121e-01; +3.577859579293952e-01   -2.465055040706566e-01   -4.819091969205398e-01   +5.908193724547570e-02   +2.615037478299525e-01   +9.918476422063295e-02   -2.992896516011608e-01   -6.752109988524494e-01];
L3E_L2E_iAMPA_netcon = [+8.012848750345293e-01   +1.960192215072526e-01   -9.625287165841906e-02   +1.756085959007495e-01   -2.813490981344005e-01   +2.569900923221011e-01   -2.312461975202508e-01   +3.299895323367315e-02   +1.999211333541779e-01   -6.761339889957950e-02   -5.877480654073708e-02   -1.238977121373948e-01; +2.788841927259055e-01   +1.558274466952917e-01   +2.775024937241230e-02   +1.066522611699779e-01   +4.676758790791360e-01   +2.078991766572403e-01   +1.725506783262216e-01   -1.056667237728456e-01   +5.630468670107420e-01   -6.130502956608595e-02   +3.391034818145219e-01   -4.760748023866039e-02; -1.089749283893111e-01   +2.599607159271872e-01   -2.000193434599002e-01   -5.704398883386345e-01   -2.089578126337087e-01   +4.226154124395879e-01   +4.826030847292915e-01   +4.074723223006437e-01   -1.075192693525318e-01   -3.430715322934998e-01   -3.368618837800329e-02   -3.322181290309202e-01; +2.621519641096086e-01   -1.242859525295190e-01   +3.680958468483370e-02   +1.022523220952642e-02   +2.164497991824644e-01   -2.842389604080350e-01   +2.837491908506129e-01   -4.844530556930547e-01   +5.083534781151960e-01   -2.785868425516106e-01   +2.475660485564093e-01   +9.277362039131395e-02; +4.927140034883794e-01   -2.255083263796156e-02   +8.908304991795279e-02   +2.285201481744069e-02   +5.715411282989278e-01   -2.844906344967928e-02   -3.828194900333691e-01   +6.832725713293117e-03   -3.976415317165787e-02   -4.233468072272328e-01   +4.683263558607256e-01   +1.203969593933790e-01; -2.445209050650259e-01   +2.237927175913829e-01   -2.628445733042588e-01   -4.940302054230762e-01   -1.127450717103190e-01   -1.956527110492697e-01   +1.015269360185524e-01   +2.904640696831199e-01   -2.614362928843228e-01   -5.323034033827195e-02   +1.764608158421898e-01   -3.067853581321484e-01; -1.688231665413356e-01   +1.094161018835620e-01   -4.729899347700744e-01   -4.745841543596792e-01   -2.807734395650055e-01   -2.166716207789282e-02   -5.495456787042794e-01   +3.379105528925188e-01   -1.240825505255879e-01   +3.718365869413054e-01   -2.368503526861474e-01   -4.030198349070852e-01; +2.060467953641988e-02   +4.375165262227815e-01   -2.197047777797038e-01   +3.347061861101361e-01   +1.467792396678461e-01   +4.081938030237154e-01   +1.256508798383962e-01   -1.700896886786716e-01   +3.844691332729167e-01   +7.601985900668768e-01   -5.335375222401961e-01   -4.736292133438768e-01];
L3I_L2I_iGABA_netcon = [-6.199158771007671e-01   -3.605107082972126e-01   +1.448148947189519e-02   +4.573347341133762e-01   +4.207903969790061e-01   -3.474913806114425e-01   -1.746355739070822e-01   +2.952837967527381e-01   -4.729901295062868e-01   +4.109114042985490e-01   +1.936427917641981e-02   +6.059928123649414e-01; +4.133939117982424e-02   +4.377484162497983e-01   +5.452838292049211e-01   +4.764127029659432e-01   -3.117957543503748e-01   -3.730650171034770e-01   -6.499856259253236e-01   +1.431971459228142e-01   +4.247294435183712e-01   -6.101084723329047e-01   -5.142780262022745e-01   +1.855464354082736e-01; +1.280991549150272e-01   -5.599138494317375e-01   +8.159994087709482e-02   +4.639473687475045e-01   -4.392363326852973e-01   -4.543271849584736e-01   +2.286374398233967e-01   -1.194867706416779e-01   -5.314281731071357e-02   -1.147098860634016e-01   -2.224092551810911e-01   -1.161020987983262e-01; +2.532641825886670e-01   +4.980463746135527e-01   -4.558751300484729e-01   -4.690358578118604e-02   +1.878878759806286e-01   -5.687042440463759e-01   +4.065179235308056e-01   +3.118545056924978e-01   -1.152052766189962e-01   +4.029844759899362e-01   +4.643883800600909e-01   -4.936277609679645e-01; +1.429934472058965e-01   +6.491670696896180e-01   -2.611176847319382e-01   -8.811266901793227e-02   -2.386168538866153e-01   +7.146370601281293e-02   +3.432187060518880e-01   +2.985071055127350e-01   -4.318398965072903e-01   +5.913273559590770e-01   -4.506474244062268e-02   -3.326948254823487e-01; -5.409553865382966e-01   +8.407465428619271e-02   +5.944691613121991e-02   +4.623302108439841e-01   +4.860087943832278e-02   -2.489712374052188e-01   +2.527586971964256e-01   -2.184425002236445e-01   +1.684997150583056e-01   +1.676040240707865e-01   +1.809275879282758e-01   -1.518054766927071e-01; +3.774229819784109e-01   +4.918908141146621e-01   +5.270073489553904e-02   +1.061621519670017e-01   -5.354967159045158e-01   +1.300326292009852e-01   +3.392647369086315e-02   -4.127824701437002e-01   -3.485178304048338e-02   +4.294494410966017e-01   +1.096123495982068e-01   +3.411106692011263e-01; +1.619538252321685e-01   -3.698427226995397e-02   +1.089909513555431e-01   -4.786841377779566e-02   +2.172007360408395e-01   -5.879119356722208e-01   -4.071680495351043e-01   -2.968443955729484e-01   -2.042624354134905e-01   -3.287284045786821e-01   -5.191343383120857e-01   -4.771542084964142e-01];
L2E_L3E_iAMPA_netcon = [-3.773482044218661e-01   -1.227311045346895e-01   -3.045924507594223e-01   -2.546379868177855e-01   +3.267483214178082e-01   -4.748113734582913e-01   -3.697264873799350e-01   -2.971255743467714e-01; -2.324419149307097e-02   +1.984970135049798e-01   +1.849522066089148e-01   -1.962675862930344e-01   -5.335534365371355e-01   -6.593913685568810e-02   -3.088068086816416e-01   -1.355535218025372e-02; -3.638745846742171e-01   -3.446239327807017e-01   +3.710104675624032e-01   -4.182730651784133e-01   +2.771815023108402e-02   +1.583254591485617e-01   +5.861231877534566e-01   -7.339185444482449e-02; -4.003087754531318e-02   -4.587634716894656e-01   -1.011665583004253e-01   -7.929502488326765e-02   -2.248907372550601e-01   -2.156017840879456e-01   +6.319685165638441e-01   -8.544267570312057e-02; -1.778510941631997e-01   -4.797082321463714e-02   +1.279755507675301e-01   -1.421238282355393e-01   +1.887328594261816e-01   -5.073165938016529e-01   +5.421183188593929e-02   -9.104267009084219e-01; +2.896028000116079e-01   -1.343209654164850e-01   +1.400023323490915e-01   +6.832668135151002e-01   -5.519721936135464e-01   +1.044860308515392e-01   +8.048104620417545e-02   -7.772375277157917e-02; +2.158965326798534e-01   -1.745344621237520e-01   +3.443819686290179e-01   -4.074015924880098e-01   +2.878495817281274e-01   +4.949504514168154e-01   -2.520724649625856e-01   -3.357775597583635e-01; +1.143577380155094e-01   +4.362414339125332e-01   -1.294042467435669e-02   -7.412652131352823e-02   -2.895770599283078e-01   +6.929762893566711e-01   +2.572478756634486e-01   -5.588378168429678e-03; +9.960428225806379e-02   +2.223243909922817e-01   +1.220814002458806e-02   +6.244073180716793e-01   +3.278660292143102e-01   +6.426548868911609e-02   -1.131051654662103e-01   +2.311096243334173e-01; -3.902740844960071e-01   -4.078460254865133e-01   -2.677455816887628e-01   +3.354732353927987e-01   +1.002811080094416e-03   -7.172004192035573e-02   -2.517416548200463e-01   +4.747859156422389e-01; +2.339557333392498e-01   +2.885328706380020e-01   -5.886099797974081e-02   +1.512436637578137e-01   +3.632804707155992e-01   -3.857127769647777e-02   +6.612288147124223e-02   -3.396276967052133e-01; +7.656482320502978e-03   +3.669937509040271e-02   -7.525430565970247e-01   +2.826249257503987e-01   +6.416868915468030e-02   -2.951380093360203e-01   +4.137369540447170e-01   -3.293052723975601e-01];
L2I_L3I_iGABA_netcon = [-4.004942707629071e-01   -1.770343150121672e-01   +5.654970438553524e-01   +2.943750923564413e-01   -1.450751680654441e-02   +3.561211812361601e-01   -1.217733376548220e-01   +6.753249726312213e-01; +2.461191050216770e-01   -3.016038669332312e-01   +1.350399799933217e-01   +4.261494095958876e-01   +3.702107559338840e-01   -4.949386477401901e-01   +2.264370726015949e-01   -1.411234059673973e-01; -1.163611912262847e-01   -2.704126438092540e-02   -6.376797213457791e-01   -3.730063759967877e-01   +9.905168411088794e-02   -5.215148461176931e-01   +7.172056810607993e-02   -3.645542301728395e-02; -7.232663817290232e-02   +4.212837988578128e-02   -2.412587618306642e-01   +2.581736995345374e-01   -1.338392623114501e-01   -3.024348170038115e-01   -1.155062135237884e-01   -3.206065238961189e-02; -4.369147363738366e-01   -1.115613265832527e-01   -1.535944456498739e-01   +1.466312039406281e-01   -3.170852488608301e-01   +1.676424941480982e-01   +1.912075231124267e-01   -3.920814748273724e-01; -7.826230270922824e-02   +2.001869029830169e-01   +1.370722067058878e-01   +1.152219941812185e-02   -1.854315404033580e-01   +7.388550464527520e-01   -1.189356752706396e-01   +3.199801312985755e-01; +1.370433044473811e-01   +2.805896696793683e-01   -2.505713235645507e-01   +2.038928046579209e-01   -2.298050299972068e-01   +1.353775238799569e-01   -1.377681866610571e-01   +3.140693777624431e-01; -5.933507793462997e-01   -2.934295173571329e-01   +1.314335020376227e-02   -6.071967354154721e-02   -2.004566825238497e-01   -1.207240217422666e-01   -2.281370081254772e-02   +7.870830102169786e-01; -2.728499033759833e-02   +6.248843629948185e-01   -2.254876895554153e-01   -8.007195612867734e-01   +2.827080362829166e-01   +2.744352061114673e-01   +1.371478929857979e-01   -2.455236598289471e-01; +1.138932874877749e-01   +1.664818169373823e-01   -7.627481764467824e-02   -7.181941466858460e-02   -1.557625606711814e-01   +1.262889223898715e-01   +1.831491445628304e-01   +1.314840249361049e-01; +1.074705017516644e-01   -6.992212949378779e-01   -4.096745122955414e-01   +4.679729802764312e-01   -1.785824174302182e-01   +1.414275732087785e-01   +3.661198848107473e-01   +9.105594639449069e-02; -1.125544426297950e-02   -4.251959769667754e-01   -1.771046037714797e-01   -4.590525626763698e-01   -2.988468254739505e-01   -2.296147251716530e-01   -5.038606750469924e-01   +1.184780090664269e-01];
L3I_L3E_iAMPA_netcon = [+3.950869243088451e-01   -1.080992309939800e-01   +2.996964829105654e-01   +6.959606187085267e-02   -2.494954923210661e-01   -9.974449109057981e-03   -2.876378730850601e-01   +2.050010709537952e-01   +7.250250064631129e-01   -3.418988998926042e-01   +1.650679795444130e-01   +1.221264150196076e-01; -2.276925143747895e-01   +2.126848854159853e-01   +5.614995993442325e-02   +7.452635119096812e-01   -1.501115642954076e-01   +1.697999301580388e-02   -5.843414301058319e-01   -6.052333588640139e-02   -3.310684677869535e-01   +1.023928084159611e-01   -1.619590132723284e-01   +9.306465691760014e-02; +6.261971395733573e-01   -2.933057475650618e-01   +4.785368324354931e-01   -2.185247364743557e-01   -4.193464725055037e-01   -4.880589702131732e-03   +2.123787700184420e-01   +2.025664577018829e-01   -1.861710557735177e-01   -4.337002508719096e-01   -5.298531904695094e-02   +8.199740564651142e-02; -9.237111078523076e-02   -3.355211736994806e-02   +4.227620283774178e-01   +1.213831136478266e-01   +4.379994945282586e-03   +1.156093230563667e-01   +3.153020568276988e-01   +1.679574382456454e-01   -2.489208701142891e-01   -2.700294021476402e-01   -4.928046361785047e-01   +2.962848196025504e-01; -1.179267436556778e-01   -5.829148619509202e-02   +1.357873889528522e-01   +3.608378908584081e-01   +4.266951753729935e-02   -6.347046452403067e-01   +1.720983527463193e-01   +1.090733077923626e-01   +1.588554970473122e-01   -1.827533526407474e-01   -5.078612447747319e-02   -1.833430560379430e-01; -1.288861186183322e-01   +3.618245724975188e-02   -2.288511296971036e-01   +4.025321354132978e-02   -3.269949269031435e-01   -6.249210557927368e-02   +5.468399658651955e-01   +1.122967527646207e-02   -4.620835443210302e-01   +2.111770818943470e-01   -3.026800690695069e-01   -3.995313668438253e-01; +1.691262325272492e-01   +2.300926212443287e-01   -1.525367901437601e-01   -1.686616650691018e-01   -8.112180402282128e-02   -1.366984102551288e-01   -1.326297562768372e-01   -3.646551241939308e-02   -3.000525404877510e-01   +1.012951830798751e-01   +8.885583231807870e-02   -5.949777574325957e-01; +1.747042694656852e-01   +2.504593319101998e-01   -3.927846371095776e-01   -5.553494064259588e-01   -4.359169252500633e-02   -1.506875379297022e-01   -7.909086978469493e-02   -1.553375940558601e-01   +3.864516684452603e-01   +1.459376314263564e-01   +6.758671858267621e-01   -8.997738537179942e-01; +1.651120575962381e-01   +1.792414173307560e-02   +5.498980794167831e-01   -2.519767741033694e-01   +2.688097839531635e-01   -3.922751589060131e-01   -5.809144447618625e-03   -3.308198373220351e-01   -7.674267704830821e-02   +1.904113754668564e-02   +3.028632489943868e-02   +2.886043889727756e-01; -1.807398548678490e-01   -3.692052991523853e-01   +4.881141519310639e-01   -9.538387730646702e-02   -2.969373456074647e-01   -1.168758623512176e-01   +2.086353884416390e-01   -2.790180478108962e-01   -9.669389524720064e-02   -2.363831649235578e-01   -1.388462825387758e-02   +2.896283929220385e-01; +5.373906222671081e-01   +4.463797688425064e-01   -1.413673027912613e-01   -4.820039360581323e-01   +2.254531993952859e-01   +1.865161418583488e-01   -1.335112241939382e-02   -1.719866000058292e-01   +4.950272276039189e-01   -4.141534799973232e-01   +1.755936974365815e-01   +8.144709596237013e-02; +1.245146564839756e-01   +3.445585313967216e-02   -6.286742128612120e-02   +3.584770060338164e-01   -1.293726163373840e-01   -1.406195087097603e-01   +2.969006189777228e-01   -2.586440370181388e-01   -3.770918999128535e-01   +2.980654104675791e-01   -2.070694838478295e-01   -1.010055417712910e-01];
L3E_L3I_iGABA_netcon = [-5.358591960949480e-02   +7.150604700899145e-02   -4.427479709617742e-01   +5.213507814262512e-01   +1.995543526795646e-02   +5.860993234317287e-01   -2.212490226122388e-01   -5.426097630457861e-01   +3.636598187558537e-01   +2.568553013017582e-01   -4.091388216058283e-01   +4.988396148296320e-02; -5.762234221104507e-01   -1.628876816034694e-02   -3.055140706732365e-01   +6.477307531088375e-02   +4.673221122158408e-01   +1.879734088497696e-01   -3.495697766391731e-01   -1.237217701342037e-01   -4.044351124189559e-02   -2.278542092642568e-01   +1.695050810894935e-01   -4.309992923287427e-01; -1.766439644978224e-01   +4.778949844817111e-01   -2.598324659803570e-01   +3.575705304238220e-01   -2.602993168684590e-01   +4.491273644517719e-01   +7.538326219310261e-01   -4.767182902791232e-01   +2.508173504445634e-01   +1.172819918891955e-01   -6.010094824262373e-02   +4.447419663484255e-02; +3.372249365039215e-01   -1.736145398109953e-01   -5.815290860987316e-01   +7.211898395621689e-02   +1.549142205617433e-01   -1.263675604314406e-02   +1.710891407779925e-01   -3.032514632454421e-01   +1.815633932317612e-01   -3.175336531606162e-01   -4.251338142764021e-01   +5.375658200040057e-01; +8.216352106085220e-03   +3.244399743806613e-02   +3.041414291923935e-01   +7.005437366826153e-02   -2.535290812258832e-01   +2.437645726353267e-01   +2.738826713675760e-01   +5.676057023767940e-02   +4.265182063481887e-01   +2.406793393152298e-01   -2.863277983929137e-01   +5.849680790230954e-01; -2.977284257877185e-01   +1.792882942462538e-02   -4.614077671335849e-01   +5.768197957584831e-02   -5.035586311623380e-02   -2.135361233890877e-03   -1.002138908253988e-02   -4.689014101422885e-01   -7.490920982277924e-03   -5.770248678546915e-01   -1.126505837571244e-01   +1.530375788524218e-01; +1.365375012711710e-01   +3.518565995631464e-01   +4.292619669550304e-01   +2.950030805429316e-01   +1.267877480401944e-01   -2.068200371359997e-02   -4.333710712155978e-01   +4.964803757363800e-01   +2.875958328616497e-01   -1.776800617286609e-01   -6.514309328311382e-02   -3.372435900755179e-02; +5.057952728388958e-01   -2.726191221211272e-01   +1.155674446398528e-01   +3.848339173790910e-02   +4.489676597569696e-02   -7.551470039791994e-03   -1.119369266510832e-01   +4.673861723564222e-01   +1.619010120702974e-01   -2.583404983383677e-02   -8.567332327734406e-02   -3.167817948296246e-01; -2.981836293090583e-01   +1.284773279359288e-01   +1.415070589132321e-01   -1.594281305433181e-01   -2.511579819044577e-01   +5.074245049434324e-01   -2.361356698212720e-01   +7.779776453562850e-01   +1.917620323308084e-02   -1.624097757401331e-02   -1.918417338225593e-01   +1.189534014397757e-01; -5.392379536027314e-01   +1.962056013064241e-01   +1.596484453166676e-01   +1.451453565397315e-01   +1.040192168299792e-01   +1.040032735702799e-02   -3.800068607091730e-01   -4.537340136477311e-01   -5.115891156050355e-02   -3.343024397667624e-01   -8.614192944218526e-01   -3.602821553718037e-01; -3.362169435775898e-01   -7.401972933846389e-03   +2.784955734085868e-01   +1.936407096767134e-01   -4.043664520714553e-01   +3.316543054863312e-01   +5.851730366940725e-01   -4.664181149607705e-01   -6.567818657126693e-01   +1.058783327259489e-01   -1.858601172588158e-01   +9.229974337988639e-02; -6.189314307236368e-01   -2.129792149647624e-01   +9.102361559448899e-02   -3.972239370337921e-01   +1.288345109389523e-01   -3.206533772470680e-01   +6.989846111415069e-01   -7.640344103663559e-01   +2.947218389024313e-01   +3.822279298491738e-01   -1.215005761209142e-01   +3.295293094415478e-01];
L2E_Input1_iAMPA_netcon = [-3.368434759575706e-01   +5.086340700428944e-01   +1.880213982394682e-01   +3.777357739876338e-01   +3.231163558359789e-01   +4.416829772879046e-02   +6.705548319243157e-02   +6.148589424227369e-01];
L2I_Input2_iAMPA_netcon = [+4.355036343147492e-01   -1.147325295984104e-01   +4.871910972158976e-01   +4.372211292505365e-01   -5.081626489048950e-01   +7.452065192458408e-01   +1.150629746259629e-01   -3.951382652465780e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.4*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 1.0*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 1.0*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.4*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 1.0*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 1.0*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
