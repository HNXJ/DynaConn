function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+5.664171506545754e-03   -6.600319763770078e-02   +4.308141082091555e-02   +7.111010971603377e-03   -7.390877750419270e-02   -6.710011422335266e-03   -1.071414070378865e-02   -8.381604835356521e-02   +2.821797159303138e-02   -1.527375863434495e-03   +1.103514143020436e-02   +5.750548978285458e-02   +7.142800871897408e-02   -5.676134279969434e-02   +1.768125374718973e-02   +2.007903546014874e-02; -9.030840693611167e-03   +3.263389767361893e-02   -2.519493738469378e-02   +4.435273371553709e-02   -2.132943296534190e-02   +7.534894548636212e-02   +1.577746963396320e-02   +2.472683613314652e-02   -5.151493895178298e-02   -2.623423870293366e-02   +2.619624930515769e-02   +4.659805424260322e-02   +3.156024397970958e-02   -2.624121896081633e-02   -3.650024638444333e-02   +1.948530414604669e-02; -2.025477394709597e-02   +4.577185263898321e-03   +4.844968708056604e-02   +4.964731662373324e-02   -1.268707415548338e-02   +1.090972091438238e-02   -5.519727725928495e-02   -2.758821545900230e-02   -1.181603313921204e-01   +4.889166543274445e-02   +6.353314659361645e-02   -1.836434062989783e-02   +8.276124621423037e-02   -5.504667395166858e-02   +6.489878753177036e-02   -3.922807077725935e-03; -3.460386820269250e-02   -2.994596860574789e-02   -1.838334941061780e-02   +4.632188050254604e-02   +2.743918104751549e-02   -3.779055740763967e-02   +7.183077229299645e-03   +1.332017876873775e-02   -6.287903574585262e-02   -1.057796394144701e-01   +2.279894672935581e-02   +4.359463691170158e-02   +4.542330694459813e-02   +2.952368208561418e-02   +3.385011462410234e-02   -2.572762529673259e-03; -3.501004254822421e-02   -4.395992413215629e-02   -2.836687344290135e-02   -1.973849256667714e-02   -7.574699472131408e-02   +2.809821138741545e-02   +4.215074758776183e-02   +5.110494652558899e-02   +5.799850779667754e-03   -1.596944666928209e-02   +9.248491076901039e-03   +2.559386667611910e-02   +4.897570444239883e-02   +1.685884556661211e-02   -2.472676569642142e-02   -3.730937118942016e-02; -8.441111030050442e-02   -8.709367944801351e-03   +5.908525640757079e-02   -8.251069302024343e-02   +2.384626211216551e-02   +4.668726763325309e-02   +2.858877956602464e-02   -2.298901267897623e-02   -2.032296954699213e-02   +2.469331664670153e-02   +1.414301485901826e-02   -4.584242806357393e-03   +6.602211270653245e-02   +1.009131129875505e-02   -6.890198830314848e-02   +5.238239450263399e-02; -3.594774312278799e-03   +2.171824360894515e-02   -5.291675408233258e-02   -6.827004827775972e-02   -6.920293663468573e-03   -4.213416817464211e-02   -2.575514919095468e-02   -9.766588431752342e-03   +2.846569502307526e-02   -5.274506604873020e-02   +4.168927844774493e-02   -2.006276284276599e-02   +7.431045236549122e-02   -2.305460429810445e-02   +6.113937644000571e-02   +5.197649838518625e-02; +2.158363877131953e-03   +8.040136740828804e-02   +1.000925799132552e-01   -8.455737917659732e-02   -8.854833089071862e-02   -1.277404971248186e-02   +7.697532655580816e-02   +8.956935174900295e-02   -8.303683105662639e-02   -3.489829897374322e-02   +7.508770906352498e-02   -3.054354919874782e-02   +4.594312349279134e-02   +2.375866936563204e-03   +3.977359520158390e-02   -6.506670038246511e-02; -8.038410608839033e-02   -4.136553130715986e-02   +3.817558940315168e-02   +3.529689250887879e-02   -3.131566268445875e-02   +7.361920036529802e-02   +8.469634944455032e-03   -1.677937161318809e-02   -9.150720988673197e-02   +3.229205595068645e-02   +5.255634468147938e-02   -4.673661431433703e-02   +8.691431798537534e-02   +7.468191177473554e-02   +4.549791390970646e-03   +3.629991459079167e-02; +6.567465240072096e-02   -3.629862982878167e-02   +2.036747911349939e-02   +6.584536339791058e-02   +3.432966564974308e-02   +1.383052148093041e-02   -3.207191758540880e-02   -4.696572684758303e-02   +3.924556137227232e-02   +1.338650587077999e-02   -3.013270781820922e-02   +4.140050037225167e-02   -2.198378495261891e-02   +3.315052065351316e-02   -6.457727228743460e-02   -5.863549396078237e-02; +4.667434365236882e-02   +5.427035180737605e-02   -2.846665999078284e-02   -3.339029850753090e-02   +2.529297654811178e-02   +1.303564972077716e-01   +2.054899999176671e-02   -9.218326578979495e-03   +5.452346983470697e-02   -2.015737935445558e-02   +3.220970049566858e-03   +1.200843592511303e-02   -5.190063176214357e-02   -7.724695675730686e-02   -7.758774701396183e-02   +1.106211627214911e-03; +5.073532961091500e-03   -4.788722286173992e-02   -4.109642074495803e-02   +1.239741100215625e-02   -1.148136476745519e-02   -5.703502748337053e-02   +5.157371733041761e-02   +3.211298437143834e-02   -4.937686466900797e-02   +4.576517560515488e-02   +1.675254776896326e-02   +1.274079885148753e-02   -1.010661913511466e-02   +3.234036603217609e-02   +7.951091484482078e-02   +2.004840401049291e-02; +7.783942835336784e-03   -8.213508066459417e-02   +4.164698209435080e-02   -7.975656512876706e-03   +7.873228250883057e-03   -1.419348081053445e-02   +3.360386353121113e-03   +1.612713733672604e-02   +4.583893501957576e-02   -2.705350533473981e-02   -1.802451808751400e-02   +9.081270408153602e-02   +3.445899538895936e-02   +9.156833140347978e-02   +1.100430091394063e-02   +4.197463939728856e-03; +5.808965191578914e-02   +2.453471323017822e-02   +1.925369294816279e-02   -1.769364733108022e-02   +5.569378705313463e-02   -3.972470989314393e-02   +4.696614911717174e-02   +3.374355329361806e-02   +1.613853028745665e-02   +1.780939449418230e-02   -4.131550035405818e-02   -2.583916796457631e-02   -3.311620349733704e-02   -6.236661631359484e-02   +2.528264650926432e-02   +4.983139041091229e-03; -7.202810713322330e-02   +3.788403040834434e-02   +3.822342902916571e-02   +4.319578855578626e-02   +6.693830653098529e-02   -3.292367404234401e-02   +6.361945592447019e-03   -6.483350416657558e-03   +8.208688623634875e-03   +1.587088366743051e-02   +4.702016802040934e-02   +2.937101959532452e-02   +2.644812588798111e-02   -2.379258901921789e-02   -3.682517244330637e-02   -9.811644015587234e-02; -3.523580581760036e-02   +2.385300267178226e-02   +4.328917887395658e-02   +9.443734311545899e-03   -9.172444300141350e-02   -9.316458637706363e-03   -1.058159607939861e-02   -1.261053542110130e-01   -1.698033077331598e-02   -1.923418350975858e-02   -2.433733104062655e-02   -1.064668243847568e-02   -3.661639680729180e-02   -1.247573733906661e-02   -3.913479587894723e-02   +2.690192969672641e-02];
L1E_L1I_iGABA_netcon = [-3.621284178354468e-02   +6.131155407501123e-03   -6.613255176212285e-02   +6.193470754294973e-02   +3.583917100453714e-03   -2.109818422622311e-02   -7.107824643281585e-02   +3.668811408852651e-02   +6.025041728835636e-02   +3.160083385248431e-02   +3.240546340085641e-02   -7.290390646255675e-03   +1.057541723744845e-02   +2.952676979725140e-02   -8.366778333734008e-02   -3.568122747098718e-02; +3.744146558819701e-02   -2.439256138851576e-02   -1.449567619660122e-02   +4.123899852223743e-02   +1.100147403251598e-01   -3.443108192600078e-02   -7.413827778234536e-02   -4.301762566655861e-02   +2.036265574327215e-02   -2.957838068633933e-02   -3.441805480185912e-02   +6.292563329892009e-02   +1.707107300304830e-02   -1.648681055828466e-04   -1.522398342644305e-02   -3.928181942416152e-02; +3.151124743891596e-02   +1.280352872579277e-02   -3.995143551592948e-02   +5.424093918368469e-03   -5.657679921744958e-02   -1.597809852369304e-02   -6.364738442645820e-02   +3.047591640924537e-02   -2.627109533013149e-02   -4.947517329333659e-02   +1.721382532254170e-02   -4.338283453662227e-02   -4.139599932930317e-03   -3.364858146272350e-02   +1.104913916909559e-01   +1.471712639163259e-02; -4.377171980151381e-02   +3.836177619100611e-03   +1.143496387878152e-02   -9.754441589826458e-03   +3.915207954050742e-02   -8.395610666960894e-03   +1.414474194093880e-02   -5.012425291979799e-03   -1.653542263965856e-02   +3.416687716902096e-02   +6.944710747302750e-02   +3.542458279688706e-02   -8.569587378367491e-02   -5.938241891970902e-02   +4.328141597457811e-02   -6.274094630856164e-02; -9.773833075436865e-02   +8.437667509001505e-03   -1.109444054081009e-02   +2.946856432571478e-02   -2.300415780185525e-02   +1.100167739290348e-03   +9.821714152734316e-02   +4.964951850935499e-02   +5.897475346155841e-02   +5.776694351714216e-02   +1.862822074946285e-04   -5.027061142861346e-02   +1.836009208475634e-02   +5.438518021641342e-02   +2.091235639863256e-02   +4.463382024542434e-02; +5.166201766526443e-02   +4.004460062839395e-02   +1.731292117682982e-02   -1.261170442410680e-02   +3.232726857717132e-02   -1.533954590742974e-02   +5.431463808795053e-02   -2.097030344541285e-02   -3.573994488864175e-02   -3.498211255432688e-02   -4.735892964611711e-02   +3.434155452536192e-02   +4.643344114857934e-02   +4.339861576196596e-02   +1.392582837447926e-02   -1.879791627831036e-02; +2.522746998672848e-02   +3.330943972080547e-03   -1.010422716965287e-01   +1.592990645677310e-02   -5.377420397963010e-02   +1.593697593189561e-01   +2.741603550981360e-02   +9.183854701083999e-02   +3.076356298418580e-03   +2.779055927967166e-02   +5.516436358865021e-02   -2.288888311791642e-02   +1.899520415336047e-02   -1.055295961597017e-01   -2.802332412957801e-02   +8.102799403898749e-02; +1.643368184047247e-02   +5.024035777323972e-03   -7.221356357050840e-02   +6.660869831468067e-03   -8.253265017126189e-03   -5.544442156144144e-02   -2.569967961183410e-02   +9.142459041655855e-02   -6.856710753971551e-02   -1.929258728594337e-02   -2.763380048661784e-02   -2.285820270888772e-02   -4.133959051161307e-03   -2.128138509334312e-02   +5.171813751724951e-02   +7.862521738792187e-02; -2.297283873842404e-02   -7.169920431429226e-02   +4.641800180368309e-02   +7.661236720873395e-02   +5.834193555511914e-02   -5.207928376782241e-02   +2.987777119921797e-02   -2.981774615908491e-02   -6.250193210818761e-02   -6.884337568161114e-02   -3.265564897564868e-02   +3.110385412712830e-02   -9.849289667391962e-03   +2.890852609383369e-02   +3.558532135639406e-03   +5.850864647793574e-02; -5.883991492123959e-02   +2.464314431046971e-02   -3.307375625727201e-02   +1.338952494026891e-01   -3.729506242519580e-02   +9.996297731559987e-02   -7.458972466757671e-02   +6.751575954183933e-02   -4.657063907469346e-02   -2.855375761783428e-02   -7.659631818534293e-02   +4.101682101780822e-03   -1.735047115772339e-02   +2.966111627081446e-02   +2.635526886171285e-02   -5.144576497723136e-02; -2.889721245078358e-02   -6.459943699367313e-02   +1.913598775488812e-02   -4.057638595986192e-02   -1.786390161557064e-02   -7.891870140345425e-02   -2.503781214086926e-02   -9.252775869902410e-02   -1.206813987138904e-03   -3.216064985370996e-03   -3.382763371149587e-02   -4.574157314912384e-02   +2.477914091387094e-02   +5.539454569420688e-02   -7.064802972057783e-02   -3.951306924827626e-04; -3.845513259833185e-03   +6.627888837861731e-02   -2.004889138119649e-02   -6.181073808304151e-02   +2.622909731731322e-02   -2.805930815309212e-02   -4.663887636917104e-02   -2.077837061550825e-02   +8.548903844675700e-02   +2.918809480528014e-02   -6.112843914753633e-02   -4.922262481547079e-02   +5.748087632265977e-02   -4.910946418837303e-02   -6.077614624413628e-02   -7.159703979561255e-03; +5.461588710428671e-02   +3.266566617458807e-03   +1.240971903023219e-03   +5.589165591732442e-03   +3.275718632056056e-02   +8.431295696714909e-02   -1.366628277649314e-02   +1.345831717492801e-02   -4.496618544359819e-02   -5.115086169553878e-02   -1.186190483257185e-02   +5.411771940885859e-02   -4.581406862216308e-02   -3.726168502185900e-02   -6.241278324009690e-02   +2.284317601120366e-02; +3.696721684478196e-02   -3.878998266627078e-02   -6.576481401687886e-03   -2.127299107216775e-02   -2.418018960910198e-02   +8.318829154171693e-03   +4.742280717356255e-02   -5.030014382266840e-02   +7.205732801704873e-02   +4.264874311117604e-02   -3.182910621679126e-02   +1.814501529075347e-02   -1.445893512377263e-02   +3.512746225454401e-02   +1.406020249742755e-02   +5.224838644280252e-02; -9.463896518189580e-02   -3.029931650669471e-02   -5.575849582955575e-02   -2.470865622287432e-02   +3.623761714490843e-02   +2.062587028672475e-02   +3.465505697972320e-02   -3.054935002710156e-02   +6.804783275685436e-02   +6.356021093442561e-02   +2.520201064912165e-02   -1.594183235278731e-02   +4.884807113447541e-02   -4.114870133369196e-02   +5.968645773116956e-03   -1.120120688424425e-01; +5.518322106116996e-03   +9.797213459337045e-02   +6.200143372777028e-02   -4.806259989284019e-02   +5.296159709197089e-02   -7.909844849076904e-02   -1.138145904631927e-02   +1.707780058631814e-04   -4.911634016781987e-02   +4.867536925909884e-02   -1.477665700914260e-02   -8.423844301455061e-02   +2.934478508251439e-02   +5.429388338333278e-02   -3.225725840520462e-02   -3.424439401369631e-02];
L2I_L1I_iGABA_netcon = [-1.936622710057985e-02   -1.488547304460029e-02   +4.139574142025854e-02   -4.241383648974681e-02   -7.384303017135180e-02   +5.906026282663200e-04   +1.370501395668119e-02   -4.348281791303243e-02; -7.991588593318780e-02   +1.688969182861731e-03   -5.268650072491307e-02   +6.258576481022973e-03   -2.387023153601325e-03   -2.812099257202288e-02   +2.311826467993685e-02   +1.039160431828664e-02; -1.492177572530436e-02   -1.044715648281148e-02   -9.617024051666208e-02   -8.350934943889405e-03   +8.462174684889263e-02   -5.044897890205401e-02   +3.386526680906903e-02   -7.743761655701796e-02; -5.129949955046495e-02   +5.824947058253294e-02   -1.540098744018399e-01   +3.631337022477534e-02   +3.953348687894233e-02   +5.788037861786235e-03   +1.336288472107489e-02   -2.049670998402657e-02; +2.175406412992728e-02   +1.243324701738223e-02   -5.459844417777932e-02   +9.458317732464995e-02   +3.152862379195348e-02   -2.100916748548483e-02   -2.282304649917331e-02   +8.572202110128727e-04; +2.059941356719391e-02   +4.320293980057357e-02   +5.350968859520743e-02   +3.112047460790365e-02   +4.304030756406635e-02   +3.135040046942250e-02   -7.211520799114730e-02   +6.790886619589419e-03; -2.576729808775716e-02   +6.084369252953828e-02   -5.092713661363626e-02   +7.155129980928446e-02   +2.248536062121796e-02   +3.975766590578467e-02   +5.848487779314290e-03   +5.387777124478629e-02; +9.748823523290309e-03   -4.458177326412185e-02   -2.927933299262453e-02   +2.442415385603413e-02   +3.169490353764592e-02   +5.626825738550111e-02   -5.416204438801977e-02   +3.525867984793508e-02; -6.404501194276925e-02   -1.043524564762078e-02   +7.417156303271326e-02   +8.885842917250114e-02   -3.072011843948257e-02   +4.851042263739400e-02   +7.325371327881033e-02   +8.852548250603555e-02; -1.119019901097214e-02   +9.791151442598428e-04   +5.925495862177065e-03   -3.754311497761399e-02   -3.209698259588098e-02   +4.283483753762520e-02   -1.194222299087377e-02   -5.414989714614277e-02; -6.042092462047233e-03   +6.086564185131550e-02   +4.293060248213856e-02   +6.428967445552451e-02   -1.001176926919904e-01   -1.021938180395846e-01   +1.848575743668056e-02   +5.733191453985478e-02; +1.771516552006670e-02   +2.838557263542631e-02   +1.085189946767526e-02   +4.431065778090922e-02   -7.343437335121311e-02   -1.534258524845315e-02   -3.156663437452450e-03   +5.931585254529097e-02; +1.387622633248324e-02   +3.403457260238257e-02   -1.730753288407324e-02   -6.840991808400802e-03   +4.990487519761132e-02   +7.847912944253826e-02   +2.743939027670310e-02   +1.051375068546670e-02; +6.537719125334757e-02   -3.909715690570692e-04   +3.885420234475120e-02   +4.384714662636897e-02   -3.912564553771224e-02   +4.001167978591740e-02   +1.118760731662606e-02   +2.674094077395154e-02; -1.411716478117072e-03   -6.519893528608102e-02   +6.867230446964608e-02   -5.132231133532375e-02   +8.224232252241725e-03   +2.655072213800950e-02   -6.962702293070494e-02   -8.643922149331056e-03; -3.517984874870989e-02   +1.559543594072499e-02   -6.184088591470258e-02   -8.616662553168747e-02   -2.344992342539520e-02   +1.579172975812643e-02   -1.570635506572492e-02   -5.616979077134279e-02];
L1I_L2I_iGABA_netcon = [-6.041074932870277e-02   -1.234424531712412e-02   +8.529162354681822e-03   -7.124050912161500e-03   -9.490602832942412e-02   +1.047006845290160e-02   +9.672837298919178e-03   +6.428511306198130e-02   +2.243935749261849e-02   +4.264541730724113e-03   +5.837978315050962e-04   +2.579656193881199e-02   +1.332056599883440e-03   +2.155993455490115e-02   -2.706642780592819e-02   +2.689221448375890e-02; -9.145636575758752e-02   +4.244981272673729e-02   +1.832041222139966e-02   +4.332985436243975e-02   -2.291128023058817e-02   -5.208813216570103e-02   -2.344883916312703e-02   +5.184965763656160e-02   -7.543515546075831e-03   +6.551832543507083e-02   -6.864049971054985e-02   -8.892774312912072e-02   +4.177221639265891e-02   -1.400244789342731e-02   -1.372618132391079e-02   +3.575977571176007e-02; -2.635870264819030e-02   +5.713369841861011e-03   -6.166295864961947e-02   -5.745403983277456e-02   -2.633503005390455e-02   +6.566039686361244e-02   -4.437823488443814e-03   -1.928867686527969e-02   -9.692332568536624e-04   -5.188618950932399e-02   -4.932885672718829e-02   +1.013210518508818e-01   -1.868027701475848e-02   +3.656938071250625e-02   -2.161374969414774e-02   -4.716309709746188e-02; -2.113826926403334e-02   -5.702101012576427e-02   -1.038639867131736e-02   +1.790798314319140e-02   -5.223462240547645e-02   +3.693941803501022e-02   -5.344559424773423e-02   -1.431307748927250e-02   -7.977875060387360e-02   +1.003845765594807e-02   -4.290947945803872e-02   +2.217818580653664e-02   -3.660839745398636e-02   +4.809542453726225e-03   +3.295887646981209e-02   -9.248171370490514e-02; +3.033641800910354e-02   -6.434352769598915e-02   +2.671920781302221e-02   -5.491225390896512e-02   +9.486320084028080e-02   +7.751106798611065e-02   +5.018526564062657e-02   -6.402073955460011e-02   +5.053741607553090e-02   -1.427863846167104e-02   +1.056832932959117e-03   -3.086015070939670e-02   -5.461319583054718e-03   +7.543844144893691e-02   +5.043962786640591e-02   +1.842940942692835e-02; -7.608292887155343e-02   +1.815547667940012e-02   +2.399001364975374e-02   +3.224366973997483e-02   -1.643212551722274e-02   +7.968113790214454e-02   -1.431535636478283e-02   +1.617119628272679e-02   -1.515039065821776e-02   +2.568828171028831e-02   -3.815499066468404e-03   -7.705882045457886e-03   +8.417321423318138e-03   -4.754430614221070e-03   -2.589045489822729e-02   -1.359588456558433e-01; -4.352955428206368e-03   +3.626990996437995e-02   +2.622822787482808e-02   -7.553020543780244e-02   +1.011862253921954e-01   +1.060217166070543e-01   +7.880737137886180e-03   +4.543714564444268e-02   -4.605572792110638e-02   -1.449884428394171e-01   -3.017601437967604e-02   +5.756969930773733e-02   +7.032256199964651e-02   +4.129273980446650e-02   +1.407133202612473e-03   -3.452016986396893e-04; +5.850039364136665e-02   -8.351633629719819e-02   +8.586722839192288e-04   +3.472888002587213e-02   -3.450091950927181e-02   -7.955668548890013e-02   -4.361243904666703e-03   +2.221632437682869e-02   +3.755809993537699e-02   +3.317216450325541e-02   -2.853046993298693e-02   +2.935651335700775e-02   -4.572446608973624e-02   +1.569030265561600e-04   -2.838053464433900e-02   -7.308833983845613e-02];
L2E_L1E_iAMPA_netcon = [-5.446761980829230e-02   +3.021837338127391e-02   +2.183738620154807e-02   +1.864923029635818e-02   -2.533221182944621e-02   -6.864649201195755e-02   -1.091558346791162e-02   -4.785674770933410e-02; -7.064034973996118e-03   +1.507685285078685e-02   -4.290729467761437e-02   -2.926491466637661e-03   -1.933400678902318e-02   -2.922898290918573e-02   +2.653227131704065e-02   +5.021805733147647e-02; +3.738619411347693e-02   -1.258656181097780e-01   -9.279470201538285e-02   -7.292908704055688e-03   +9.371391339018396e-03   -2.975978364263963e-02   +9.308781896316923e-02   +7.163596919111774e-02; +2.596622699253905e-03   +2.834054811711281e-02   +6.180701554631716e-02   +4.573890299151388e-04   +3.056000939769798e-02   +6.983607696946255e-02   +5.632360953439272e-02   -2.088305141515646e-03; +4.567084900122519e-02   +5.988636997067023e-02   -2.062053672152953e-02   -2.604132113233388e-02   -5.240621156243093e-02   -8.409057624747106e-03   -3.374543565185487e-02   -1.707388327462024e-02; +4.760111233075946e-02   -2.722974755425509e-02   -2.527673780596401e-02   -9.760307151737604e-03   -7.442091318081190e-02   +3.053511822989934e-02   -3.191041809857941e-02   +1.265269454057220e-01; +4.695965508514869e-02   +3.282664254974731e-02   -4.168182953181571e-02   -1.366123594258831e-02   -5.147134340169147e-03   +1.341587848014024e-02   -4.137481226622869e-02   +5.436685692387177e-02; +4.773148881828342e-02   +5.327593384119687e-02   -2.037352776571498e-02   +2.959730294252747e-02   +3.855314335839659e-02   +2.144246165308170e-02   -4.691743947795306e-03   +1.190781434297545e-02; +3.474359629239156e-02   -6.173137888493278e-02   -5.849898788467298e-03   -2.645219326597109e-02   -6.435955807324548e-03   -7.343479791406603e-03   +7.880539090971453e-02   -9.895002459843621e-02; +7.813620814833198e-02   -9.082405392306898e-02   +1.849020155797061e-02   -3.179766386450811e-02   -1.361259778456321e-02   +4.415808819188351e-02   -5.359355029788533e-02   -2.239195300148720e-02; -1.382795185048670e-02   +1.629265219596306e-02   -1.840410393697037e-03   -4.481217475489545e-02   +6.504798722114812e-02   -2.202580344805475e-02   +1.827883065211196e-03   +4.844139406995428e-03; -3.605023033880486e-03   -6.095567616633041e-02   -5.976469448919090e-02   -1.036678844377835e-01   -7.746796645980154e-02   -3.848134119710610e-02   -2.286380427253616e-02   -1.739139080604398e-02; +3.847636727757180e-02   +2.664306764111512e-02   +5.877238480976354e-02   -6.154839521624289e-02   -4.971931990548428e-02   +4.527087122915964e-02   +4.538012295951547e-04   +2.486707061345132e-02; -4.939097016358966e-02   +2.765977304108645e-03   +2.642108165963243e-02   -8.168220568202603e-03   -3.903123523196794e-02   +3.152091084844231e-02   +2.489361478646232e-02   -3.035673345616480e-02; -5.686937749904836e-03   +4.811537938085106e-02   +9.064303427899945e-02   +1.480145060522518e-02   +9.926582406102741e-03   -4.096639328760811e-02   +3.829421904491657e-02   +1.362494864716204e-02; -2.155600112406587e-02   +5.906790002996860e-02   -5.706057064636580e-03   +1.248175982784509e-02   +2.926326138858491e-02   +2.185721798499928e-02   +9.596804177946058e-03   -7.070311810454860e-02];
L1E_L2E_iAMPA_netcon = [+3.176866767959061e-02   -1.156218238099255e-02   -2.145602591623925e-02   +1.229548879285069e-03   -7.210948182881850e-03   +2.105874702201714e-02   +2.078031226996091e-03   +3.262238336978251e-02   -7.889106719389022e-02   +1.388924029822337e-03   +1.152046263662264e-01   -4.102780886609546e-02   -3.440869846204896e-02   -1.699211528369103e-02   +6.502373906150882e-02   -1.560481061967021e-02; -3.207614236173665e-02   -3.164756597046883e-02   -8.208069306559360e-02   +1.170952213600235e-01   +4.460495605171602e-02   +8.408118206210704e-03   +9.214553574022146e-03   +3.873845120876603e-02   +6.583289076172698e-02   -7.027187333424671e-02   -5.536674473801610e-03   -2.725837449273150e-02   -3.613786135066091e-02   -2.403333820662704e-02   -4.142368987232007e-02   -4.884885185878951e-02; -3.146950875501010e-02   +2.201321834827007e-02   +9.063604152185249e-02   -3.173268592753974e-02   -4.266103138365488e-03   +1.134086593292782e-02   -2.183786795685019e-02   -3.336643568474303e-02   -3.468641767570102e-02   -5.123401307945158e-02   +1.825987517284548e-02   -4.896106557692027e-02   -2.165288919341438e-02   +1.005238628661700e-01   +1.918217773198361e-02   -1.569966464879738e-04; -1.503679450865442e-02   -1.379078259379241e-02   -5.496936438808283e-02   +2.838879205710441e-03   +3.377748534724997e-03   -3.253112269140469e-02   -4.880772403673167e-02   -2.989897256453886e-02   +4.866803431084430e-03   -2.821627445629868e-02   +2.536059497470916e-02   -2.087575323896683e-02   +1.734074068849271e-02   +3.859882042321438e-02   -1.626250161887633e-02   +5.108464257328363e-02; +5.921053180799671e-02   -7.807743009947549e-02   +3.884163739591675e-02   -4.730155793912443e-02   +4.595503641712668e-02   +1.880189945759618e-02   -2.179409326491292e-02   +2.998445831222722e-02   +9.082959165670477e-03   -9.788196793270131e-03   +5.429896629312727e-03   -3.551154092901843e-02   -6.601656515723145e-02   -1.215695001635949e-02   +4.361822012214722e-02   +8.294595983739338e-03; +7.986330715669207e-02   -5.243233366079753e-02   +2.668892463474835e-03   +6.119091967047417e-02   -1.331679643193555e-02   +8.444237519913633e-02   +4.142782218206911e-02   +1.554855194980881e-02   -1.323260214603400e-01   -2.365529263944583e-03   -4.200015381963432e-02   +5.403796631435977e-02   +4.044308547470015e-02   +8.382256907072271e-02   +6.592705042528473e-02   +6.318448951728835e-03; -3.359698722626524e-02   +5.144156799574313e-02   +4.381843804800643e-02   -2.537831572371689e-02   -4.468062577975541e-02   +2.440676512580647e-02   -3.366908736498838e-03   +3.255037799275414e-03   +1.461643681969726e-02   +1.999233660539476e-02   +7.597461407973574e-02   -3.575842617597687e-02   +3.152822561914892e-02   +5.916937625864064e-02   -3.019553154700395e-02   -3.541187733305344e-02; -2.571482129391023e-02   -1.256836272741333e-02   +2.198151709992980e-02   +1.153905885075357e-02   +2.204488123714632e-02   +1.261760146382762e-02   +3.612510432938046e-02   -1.803048151807467e-02   +1.437926767501065e-02   +1.676587066443292e-03   +3.987820986754945e-02   +2.650075943007560e-02   +5.372110200715242e-02   -4.806598636120124e-02   -6.953150359696067e-02   +3.503994769667099e-02];
L2I_L2E_iAMPA_netcon = [+5.634328592004979e-02   -7.202677390312590e-02   -8.074483727273769e-03   -5.080944873100000e-02   +5.243255696649671e-02   -6.427883775879870e-03   +1.202254531166533e-02   -8.041567992074429e-02; -3.087917950468060e-02   -6.817274448095381e-02   -9.562501201969964e-02   +1.217286306309243e-01   +2.386337955858100e-02   -2.857322155300491e-02   -6.340929911539775e-02   -1.153733685179871e-02; -2.891095943988684e-02   +4.966471273349507e-02   -6.464351880914790e-02   +4.100495514495213e-02   -5.280236960700482e-02   -1.396878826090593e-02   +5.944415162077024e-02   -1.010364798953586e-01; +8.756434272676050e-02   -2.959430739808151e-02   +3.089670610143825e-02   +7.511748305966423e-02   -8.883432264521668e-02   +7.161076147572251e-02   -1.108123846586033e-02   -4.319894746858591e-02; -2.035865531208130e-02   +6.034767811163837e-02   +1.578889983114779e-02   -1.702309720576681e-02   +3.969115515897285e-02   +6.009586750164975e-02   +9.644370746611770e-02   +9.210897930438762e-02; -5.505371451651545e-02   -2.531846132839264e-02   -1.405454585088190e-03   +3.035381727597695e-02   +6.300769747320364e-02   -3.631731223630197e-02   -1.539021550868823e-01   +3.832377868017135e-03; -8.385521994175598e-03   -1.387071702728816e-02   -4.740234368910389e-02   +1.767027715840384e-03   -6.976446180229279e-02   +5.763846921418798e-02   -6.170685715100759e-02   +4.100286268740822e-02; -6.665197559439286e-03   -2.880366065201921e-02   +5.153380751752948e-02   -4.093965794237663e-02   +4.924303999374201e-02   -3.475068656323452e-03   -3.074013692784980e-02   +2.083047578952821e-03];
L2E_L2I_iGABA_netcon = [+3.498616144823744e-02   -1.177280838476907e-02   +6.216468619918558e-02   -1.834186638183823e-02   +1.671814361329741e-02   -6.063482242532736e-02   +3.233330617752761e-02   +6.635304712863679e-03; +4.973638986565337e-02   -6.228489805623243e-02   +4.511032040809408e-02   +3.643774041371055e-02   +2.421988032842121e-02   -3.441019141779082e-02   -5.778504438033656e-02   +4.080482797456422e-02; -6.852851133185764e-02   +7.689560510444399e-02   -3.418024698003437e-02   +6.427192108208940e-02   +5.333823499540195e-02   -6.812848589010956e-02   +7.828219045780875e-02   -1.146708421176539e-02; +1.204215431161910e-02   +8.656105820306993e-03   +3.895225610854811e-02   -6.417025839730960e-02   +2.333433268683545e-02   -2.700298593784902e-02   +5.431324220451943e-02   +3.869043076715927e-02; -6.993263871550047e-03   -2.907923115189198e-02   -3.073809034033679e-02   -1.881737684032180e-03   -5.364760313755539e-02   -1.869010959751201e-02   +1.046388970783023e-02   -4.783963980933931e-02; +2.196062935324508e-02   -3.037201132936696e-02   +4.934703567541011e-02   +2.707021698862076e-02   -2.559016839511206e-02   +6.176171953985778e-02   -1.286528462993174e-03   +4.234401041704376e-02; +2.717773033066155e-02   -1.431603506698521e-02   +7.583989775752633e-03   +1.088301258823330e-01   +4.227921817044185e-02   +2.733447634764028e-02   +4.400244501900261e-02   +4.636987760754960e-02; -7.072174649631398e-03   +1.038205351538360e-01   -1.566510727122961e-02   +9.298061175838195e-03   -8.222277145554796e-02   -6.427720971258979e-03   -7.010067867828637e-03   +8.303230175556266e-03];
L3E_L2E_iAMPA_netcon = [-3.385399244761279e-02   +2.625864068137515e-03   -1.697082680186360e-02   -5.088808669764836e-03   +3.578752692878978e-02   -1.792694905015583e-02   -3.318893959787837e-02   -4.567599396272863e-02   -9.578100004058950e-03   -1.206185974370900e-02   +5.079187806185981e-02   +2.076834564630508e-02; -9.479181966918335e-02   +2.520310781317540e-02   +9.835957956505770e-04   -2.117204401562173e-02   +8.069862325709523e-02   -5.689447686359321e-02   -4.086070606274840e-02   -2.729034370874926e-02   +3.647654496501142e-02   +2.009623658416351e-02   -6.606253729441590e-03   -4.112425079565395e-02; +3.110009370016066e-02   -7.570685475730800e-02   -1.057521258153169e-01   +4.134979547122025e-02   +8.050896497765743e-02   +6.495390173424015e-02   +1.981689496317002e-02   -9.357615693017209e-02   -4.126340895866291e-02   -5.791756595037297e-02   -7.156865911980606e-02   +7.209485137392426e-03; -4.289024929290349e-04   -6.062988981222306e-02   +2.818191856471190e-02   +3.041584224961409e-02   +1.716686221327684e-02   +8.111407031112798e-02   +2.697243259784788e-02   +7.544206875443660e-02   +1.647034440281050e-02   +6.490311541338857e-02   +3.571959517516998e-02   +4.936151596053803e-02; +7.868587067709443e-02   +5.118787672356016e-02   -3.296260396278680e-02   -1.422004477949858e-03   -2.985956509403165e-02   -5.374778335739107e-02   -1.148370136025245e-02   -2.820896639296838e-03   +9.244669704640211e-03   +8.281893020896468e-02   +1.549098660001365e-02   -2.920172753674093e-02; -6.393362928733937e-02   +2.672277823904957e-02   +3.265883846242142e-02   +3.503755113429621e-02   -7.511462822125408e-03   +6.979096796037115e-02   +2.730745930480956e-02   -7.857309742887028e-03   +1.656740444743827e-02   +4.511833698720211e-02   +9.440275653884524e-02   -2.601048936047415e-03; -5.985941319950308e-02   -5.225079468095299e-02   -2.097864542701543e-02   -6.050469526302316e-02   +8.530702262032341e-03   -3.881817468762991e-02   -2.017313821372338e-03   +1.216024567217821e-02   -3.836752701172735e-02   +5.098728142579820e-02   +2.548969557269310e-03   +4.219081054594320e-02; -6.856430751337973e-02   -1.497906531632138e-02   -7.476352749306638e-02   +5.056129972397067e-02   +1.450171249569530e-02   -6.803874321212615e-02   +3.148376957886507e-02   +1.022187559394156e-01   +1.074371455792737e-02   +1.298862946154313e-02   +3.057992902128861e-02   -1.329578621752538e-01];
L3I_L2I_iGABA_netcon = [-6.539419387189073e-03   -2.361329490607281e-02   +9.144667449342929e-02   -1.624339777098350e-02   -3.923569256138783e-02   +2.443307480880348e-02   +7.592320876505465e-03   +2.119752266992136e-03   -2.078377208745182e-02   -7.190206605607682e-02   +6.762755466353878e-03   -3.170806315679872e-02; +2.617392386282688e-02   +5.952628328073846e-02   +9.892658223035316e-03   -5.798932306676861e-02   +6.573623883152050e-04   +1.956486584146929e-02   -1.396363900107528e-03   -1.657510212684597e-02   +1.530283268346311e-02   +6.161689796587122e-02   +3.204830928553969e-02   -1.193012396149006e-02; -4.079907048087450e-03   -1.224878217518068e-01   +5.941999349343811e-02   +3.807934356688542e-02   +6.952114886743209e-04   +3.974444595000590e-02   +7.992958606811498e-04   -2.207782207203007e-03   +1.464138229969706e-02   -6.081895269221985e-03   +1.539643689177853e-02   +1.341534710713782e-02; +4.333586501099923e-02   +5.139999048572378e-02   +2.060180363229358e-02   -1.030921414910333e-02   +5.625054973987974e-02   -4.700202793474135e-02   +2.627568610588056e-02   +3.728896676689968e-02   -1.204466294379677e-02   -5.822438661368400e-02   +3.476575888154736e-02   -3.613536820277185e-02; +6.915458161954188e-02   +9.741433537242463e-03   +5.092823787519452e-02   +1.201639602394514e-03   +3.014564925170300e-02   +4.999632555399666e-02   -7.398641101000033e-03   +1.139330406519770e-03   -3.713647676559727e-02   -8.071379580207209e-03   +3.046833107490380e-02   +1.718754672117649e-02; -4.616868591883200e-02   -3.519504490240658e-02   -5.496714747672761e-02   -3.640634877431352e-02   -3.650539929819036e-02   -9.993821475620307e-02   +1.265325848197789e-02   +1.228366843750458e-02   -1.054305937858100e-01   +1.251354822669348e-02   -1.908633622245961e-02   +9.429500461607961e-03; +2.917790068760605e-02   -1.082152405126533e-02   -4.049034146508732e-02   +9.390929321074527e-03   -4.628316515477045e-02   -1.317448912862793e-02   -4.977931653579822e-02   -3.960667951550154e-02   -3.418049298132989e-02   -1.830295537749059e-02   -1.063308897929899e-03   +1.244860611152472e-02; -8.315813684053341e-02   +6.467802398120312e-02   +1.127753215825483e-02   +7.061916590257357e-03   +1.045302400953593e-02   +1.725784286602522e-02   +2.374402614594413e-03   +4.872213847310872e-02   -4.931759694025008e-02   -1.916310424584556e-02   +9.308845960196131e-02   +8.479669613646407e-03];
L2E_L3E_iAMPA_netcon = [+4.785249903405987e-02   -2.137962885368950e-02   -7.401542693576474e-02   +1.477600452541184e-02   +2.755793456129488e-02   -2.125122964810149e-03   -4.503592578979971e-02   +1.085230038833531e-02; +1.178291519041147e-01   +1.702846604971770e-02   +2.763283076407968e-02   +1.215311039486902e-02   +1.554656126442077e-02   -6.546158687300899e-02   -5.606100659046936e-02   +1.213437333975429e-01; -1.745972907681661e-02   +4.473771333650903e-02   +3.416648079508053e-02   -2.847193084702132e-02   +3.743041877085601e-02   +3.965442608387614e-03   +1.976374226617005e-02   -1.096306491374042e-02; +1.133643073310223e-01   +7.958139505979983e-02   +3.305782977409973e-03   +4.100707008809815e-02   +6.406542836828508e-02   -3.336492898322329e-02   -1.248247842367365e-03   -1.000929909127200e-02; -6.450200209320300e-02   +2.203555753180321e-02   +2.138033422716483e-03   -3.158493394218154e-02   -1.501438957229930e-02   -1.785766553114563e-02   -1.270002233980176e-01   +2.691937441526893e-03; +2.974980063978283e-02   -6.913918468416766e-02   -1.161214475974800e-02   +7.517012739557596e-02   +1.225650004198562e-02   -2.873008344037222e-02   -5.697084612890509e-02   +2.305828188182276e-02; +1.043351251464629e-02   -2.220606349070876e-02   +5.257631643768548e-02   +5.417690944871219e-02   -3.027405278148824e-02   -1.313755261158046e-02   -3.279319338241006e-02   +1.419921935987031e-02; -5.358692993635703e-02   -1.676557113742270e-02   +1.705495292591121e-02   +4.000922804580939e-02   +6.739953986866785e-02   -1.178348025639513e-02   -1.502470173375542e-02   +1.485915242958857e-02; +2.558593888239175e-02   -4.635076087160080e-02   -1.263366524976012e-02   +1.355003785380161e-02   +3.173718238549902e-02   +4.372137433233626e-02   +1.926744804711972e-02   -2.121478926622386e-02; -3.429116902644393e-02   -4.394182291326276e-02   +2.907538533404793e-02   +1.452322803845199e-03   -2.433589225620180e-02   -3.206368581695360e-02   +4.108072486525853e-03   +6.403220943689870e-02; -3.245299041429971e-02   -1.582374112227522e-02   -4.980902870011548e-02   +2.465382006520888e-02   +2.292932053932715e-02   +1.651029228104041e-02   -3.473248021279816e-02   -2.106812647926485e-02; -2.211698487652128e-02   +4.353832662899778e-02   -2.127842975668795e-02   +4.439694043174901e-02   -3.525161969306956e-02   -4.022126455556578e-02   -2.919315659825452e-03   -1.152567776813600e-01];
L2I_L3I_iGABA_netcon = [-3.435599544229853e-03   +2.766576196529912e-02   +4.159876439896180e-02   -8.073901880166236e-02   -3.105316978268435e-02   +1.940296505691492e-02   +6.102751646401465e-02   +1.477116444435798e-03; -4.248771876745273e-02   +1.052276527677443e-02   -1.046751768185642e-02   +1.408341674695374e-02   -9.252022068204965e-02   -2.357333637490512e-02   +8.982291417943421e-02   -2.493942093776339e-02; +9.423978257997052e-02   +9.418111266270601e-03   -4.156908668389640e-02   -5.705990353398644e-02   -1.178020746405274e-02   +4.740414242854812e-02   +4.020830631815946e-02   +5.429438966840283e-02; -4.740031291572394e-02   +1.543598785188690e-02   -1.050741321176981e-02   -3.031155950904480e-02   +1.144860537232257e-02   -2.776405607266459e-02   +2.461571251917634e-02   -8.657386841781932e-02; -2.585611313998839e-02   +9.802588254543953e-03   -5.943969416436232e-02   +3.291273264023679e-02   +3.597376206121915e-02   +4.995958490369913e-02   +1.006619295335211e-02   +2.569361967783621e-02; +1.872143481941153e-02   -9.182278558436344e-03   -4.087238876235563e-02   -1.480174514612460e-02   +4.548995500105966e-02   +1.291536958318398e-01   +6.261817333354362e-02   -3.489477039367092e-02; -2.073739896426292e-02   +6.969697083345133e-02   +1.496706086069684e-02   -5.074655546246876e-02   +8.534204581473429e-03   -8.163181968644671e-02   -1.897621202983459e-02   -1.602096812073527e-03; -1.897889547973558e-02   +9.685336016695717e-03   -5.667473564295892e-02   +7.651724125843591e-03   -2.223931758592926e-03   +5.684196638144916e-02   -2.223913978373092e-03   -5.908734480476006e-02; +4.272093337563454e-02   +4.363506887895222e-02   -3.592880533005241e-02   +2.705460840146124e-02   +7.976625022162009e-03   -3.020199664719505e-02   +4.379021105650474e-02   -3.109820057211545e-02; -9.073561052563429e-04   -8.147741497140900e-03   -1.297021874821057e-02   +1.559340654225285e-02   +1.932029098806079e-03   -4.928769743356967e-02   -4.751444828246866e-02   +2.254982467692936e-02; -3.985033513080445e-02   +1.969200747582880e-02   +3.514216010293896e-02   +4.943573511010425e-02   +5.278547199144492e-02   +7.207388741766796e-02   +5.838856567140139e-03   +1.638308436962398e-02; -6.119315442239363e-02   +7.857206488330122e-02   +4.519613317401486e-03   +1.084872576981911e-01   +1.288663358787927e-02   -2.652557603117383e-02   -2.290767454644339e-02   -9.902017579053367e-03];
L3I_L3E_iAMPA_netcon = [+8.847811683445281e-02   +5.816793430142426e-03   +1.654580213676617e-01   +6.498194378932147e-02   +2.028556002679942e-02   +4.827899235576338e-02   -1.015886682602077e-01   -2.206201403915404e-03   -5.707053067570925e-02   +5.693968522017744e-02   +1.716297884785616e-02   -4.581496332255656e-03; +2.112228744337953e-03   -5.012819052796311e-02   +7.012660352937189e-02   -1.923901031641748e-02   +2.672624748920113e-03   -1.447177353479161e-01   +5.392676970865143e-02   +6.729137251594752e-02   +3.129864254092982e-02   +7.112240777654100e-02   -4.132679353552973e-02   -6.335452831740564e-04; +2.457380323082213e-02   -1.592975308428307e-02   -6.919936592913295e-02   +1.190616729622398e-02   -2.137420360043289e-02   +3.416668224198137e-03   +1.174803376843251e-02   +8.847474946764888e-02   -1.286820710990224e-02   -6.769335890231794e-02   -5.402440065570089e-04   +4.150343012466226e-02; +2.092982302947757e-02   +3.701134832001820e-02   +8.932878448114037e-03   -3.460264255020667e-02   -2.038338153326056e-02   +8.361619119107572e-04   -1.253372110096566e-02   -1.026797550888463e-02   +3.228675512121635e-02   -1.918296360797552e-02   -5.291674256710353e-02   +6.482745405606913e-02; +5.193294272221306e-02   -1.106723762838937e-01   -3.806278793611099e-02   -8.242050764855693e-02   -7.965621050503944e-03   -2.149643823368258e-02   +4.162744768959306e-02   +5.525052701198193e-02   -7.938306687589206e-02   -4.689226994434618e-02   -2.741757480199276e-02   +1.408237019651659e-02; -1.491628885139453e-02   +3.934997382476445e-03   +5.310233324338120e-02   +4.237414389174434e-03   -1.762630999576098e-02   +5.736493463525584e-02   +1.411283192983040e-02   +8.359670637889529e-03   -4.185053030420191e-02   +3.946457335724943e-02   +5.164577086085823e-02   +1.841794959785504e-02; +6.444482428123961e-02   -1.085670786191350e-02   -4.099743375503932e-02   +5.726073843943402e-02   +1.970361878013288e-02   -1.932335178347432e-02   -1.686087034586711e-03   +3.683811455724911e-02   -2.018115899057522e-03   +1.015159262222882e-02   +9.994682668070146e-03   +4.042682919972677e-02; -4.770972265624028e-02   +5.456198029675447e-03   +9.931074987244440e-02   +9.593921653644843e-03   +5.277043791569576e-02   +2.470711132065471e-02   +1.015703937254711e-05   +6.785081752916555e-02   -1.245751299412854e-02   -1.885779135401105e-02   +5.481805678149456e-02   +1.732050066123076e-02; +2.932717371846371e-02   -2.294125017073008e-02   +9.938433082600916e-02   -1.176909169857177e-01   +1.310748058610978e-02   +1.299807597957329e-02   +5.617390120382735e-03   -2.669190124735345e-02   -5.453761006205823e-02   +1.864937975845967e-02   -3.779300099690200e-02   -6.332019074861796e-02; +5.427802842562623e-04   -5.575418919682679e-02   -5.628224954381796e-02   +8.471184753410652e-02   -3.020685012872463e-02   -4.411549099705003e-02   -1.788461056446662e-02   -1.005710197315920e-02   +2.548743996236069e-02   +4.841502797161509e-02   +6.581429355798266e-02   -1.857114806562958e-02; +3.584744334571497e-02   +7.734563200939620e-02   -1.037794591676120e-01   -8.739568663603357e-02   +8.591825384895867e-02   -6.906514775962498e-02   -6.827060477496689e-02   +1.653021187485306e-02   +1.968200847216725e-02   -5.233540953392711e-02   +7.337760902276833e-02   +7.726642235724131e-02; -6.103231277221692e-02   +1.109430470102635e-01   +2.339751221397456e-02   +3.830007914153031e-02   +7.906583451420240e-02   -9.529115771770433e-02   +4.717490207249762e-02   -1.377469799219711e-02   -4.196626864764098e-02   +1.086319695530533e-01   +3.641596490153110e-02   +2.941537081134252e-02];
L3E_L3I_iGABA_netcon = [-6.968776633791493e-02   +3.219849556554423e-02   +2.728206189473770e-02   -3.542598546175470e-02   -4.155905250049955e-02   -3.355203808296819e-02   +3.185827934522660e-02   -2.199839373241896e-02   -5.579937201552490e-03   -1.643519580941762e-02   -3.667994170197342e-02   +3.906307272119441e-02; +4.215905888752676e-02   +2.138347557144597e-03   +4.722161880487161e-03   +3.572197567712088e-02   +6.395238565337111e-02   +2.523307733961625e-02   +1.709905584152682e-02   -1.267782023259739e-02   -5.870492212161663e-02   -5.199494968498508e-02   +1.290964667788946e-01   -6.810170948068461e-03; +1.802957515369241e-03   +4.155380794800738e-02   +6.169722061992278e-02   +8.098817944238255e-03   +1.048847263316584e-02   -3.005542684092915e-02   +2.500479802862785e-02   -4.394539049297879e-02   -6.729377836042048e-02   -6.585069933672748e-02   +3.019330861730430e-02   -1.948078506540509e-02; -7.882437410294880e-03   -3.109836552396204e-02   -5.003945024617348e-02   -1.501670874873486e-04   +4.475079185642936e-02   +3.023502899840035e-02   +1.599929409026365e-02   +3.683685623799198e-02   +2.944845634454371e-02   -3.613019073888482e-03   -2.247382281898462e-02   +2.304886225499824e-03; +1.141372378579536e-02   -7.959698121616904e-02   -1.222447634491346e-02   +3.887218638950765e-02   +3.127257804340582e-02   +2.226578956829306e-05   +2.113581157822294e-02   -1.011175924453178e-01   +1.204558154391949e-02   +4.211841431196257e-03   +5.291754101822898e-03   +9.049144263902702e-02; +1.684760455360534e-02   -3.407928555509946e-02   +3.158799740674463e-02   -9.185810383200151e-03   +3.756493983352260e-02   -5.592369189692878e-03   -3.509534310405801e-02   -3.043599389566432e-02   -1.342240030779240e-02   +1.200908622672680e-02   -7.257967900208491e-02   -7.763862963470487e-03; -1.091675686362644e-01   -1.290956777920555e-02   +9.017755234439613e-02   -6.092818354591016e-02   -2.096700982461635e-02   -2.734865077284651e-02   -7.306378100023244e-03   -3.828708906173809e-02   +3.874309243382750e-02   +1.352611860012247e-01   -1.718264217948944e-02   -2.596156711848458e-02; -4.356135117099721e-02   +4.139363904865927e-02   -4.753679618844445e-02   -8.393247740040097e-02   -5.580001563517931e-02   +1.251430254802296e-02   -1.566185318010190e-02   +7.646828822688401e-02   +3.283302129491692e-03   +4.028770137939747e-02   -2.300303130705764e-02   +2.966534415973845e-03; -3.402714699402631e-02   +7.570083324214395e-02   +8.351044026294702e-02   -4.250404800622296e-02   -2.619251310520738e-02   -1.178139663321513e-01   -3.347588076638472e-02   +4.244815739808511e-02   +2.796390115575948e-02   +1.608485810642269e-02   +5.454078975541354e-02   -2.170382329921000e-02; -5.918505344516956e-03   -9.067884098287479e-02   +2.571233701790379e-02   -4.481068667076150e-02   +5.298567780116005e-02   -5.238658535673794e-02   +8.297034171323842e-03   -9.786822660568214e-03   +5.624634045835677e-03   -1.702976847682496e-02   +1.427410378052624e-02   -4.527593988330209e-02; +5.140789742668390e-02   +3.266129348090863e-02   -4.019326960335892e-02   +6.689071432446875e-02   -2.488213618003070e-02   +7.478647645064962e-02   +6.806864324758173e-02   -3.890896573681902e-02   +1.996815853217361e-02   -4.699589169142517e-02   -2.776042829128368e-02   +1.733133305460865e-02; -2.462667812290324e-02   +2.949675981506208e-02   +3.249247330432185e-02   +2.378763802007994e-02   +5.292993725740126e-02   -3.826870638838482e-02   -2.718737611871554e-02   +5.140081234913702e-02   +1.970226599951713e-02   +9.126024489548783e-02   -3.776475278252441e-02   -7.609950040898338e-02];
L2E_Input1_iAMPA_netcon = [+3.376585548510753e-02   +1.416432346081483e-02   +4.556324367970383e-02   -7.804263370980970e-02   +8.565905002722158e-03   -2.736227845247020e-02   +7.197605819582384e-02   +3.784711748016843e-02];
L2I_Input2_iAMPA_netcon = [-8.872260424886327e-02   +7.306520690917230e-03   -3.958023805757537e-02   -6.486534468900684e-02   +7.726478244916356e-02   +3.110882487381937e-02   +6.160102373021515e-02   -3.664178032610528e-02];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.03*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.15*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.15*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.03*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.15*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.15*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
