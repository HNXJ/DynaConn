function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-9.277745301038194e-01   +1.808515504612446e-01   -4.369544397228113e-01   -4.985701180079007e-01   -6.950750796703926e-01   -2.708045889711916e-01   +4.900592387059333e-01   +6.776395957401735e-01   -1.133456764913918e-02   +1.635384829424031e-01   +4.451302030575538e-02   +1.975931551027973e-01   -2.637000715439438e-01   +5.542391211376136e-01   +2.908329174635335e-01   -4.333514337008618e-01; -2.497840258715067e-01   -1.462275950745833e-01   +5.266545844671081e-03   +5.427824547882353e-01   +1.124785767700432e-01   -9.175377822411086e-01   -1.913269556671902e-01   +2.206870609581394e-01   -2.600348961352406e-01   -2.051444035557304e-01   -4.204587076599897e-01   -4.822801079458544e-01   -2.319020355523802e-01   +9.096440290853174e-01   -5.862601731415682e-01   +1.479627150084954e-01; +8.602539994707535e-01   +1.880258644587822e-01   +4.651266391885119e-01   +5.202821019227697e-01   -4.263636540751687e-01   -3.092863305731951e-01   -1.326225614957943e-01   -2.477922400609179e-01   -1.777185430176037e-01   +2.291281025996131e-01   -4.283354951515752e-01   -2.603039786728324e-01   -5.542106606381985e-01   -3.229716760818738e-01   -7.710200973397457e-02   -8.132068701269664e-01; +3.273162822999039e-01   +1.011902862922958e-01   +3.344881357677432e-01   -2.668897657963777e-01   +8.565307637621616e-02   +2.451483678213300e-01   -2.895941321718530e-02   +1.096146005180978e-01   +2.510718059361715e-01   +8.447311390264574e-01   +7.146341246001026e-02   -5.322358444052452e-01   +3.377128456329476e-02   -3.534348884350813e-01   +8.412584430861629e-01   -5.222218584811530e-01; +5.366508184224155e-01   -2.430054513021481e-01   +1.049955411506517e-01   +2.703783041338635e-01   -7.143482946697757e-01   -2.823368608448841e-01   +5.187276839910672e-01   -1.630026058923753e-01   +7.776174556452070e-02   -1.286448578012781e-01   -5.963459965632836e-01   +4.006039465132408e-01   -6.449398409545561e-01   +3.924912287770327e-01   -7.499572740725695e-02   -2.400276120871145e-01; -3.174078716962587e-01   +1.596952488848202e-02   -5.857806585073644e-01   +4.600405906609246e-01   +3.032214828991103e-01   -2.775484570152844e-01   -1.856059172598399e-01   +3.922995420792610e-01   -6.698120531002982e-01   -2.667361896006388e-01   -3.445377731933641e-01   +3.836582264749760e-01   -6.799671883184479e-01   +6.732685676303433e-01   +2.474993924242057e-01   +4.128615758612142e-01; +3.962588209918461e-01   -6.790103698034063e-02   +6.578077234651511e-02   +1.155900330338250e-01   -2.417157914362085e-01   -2.603574115147151e-01   -1.203573692277662e-01   +2.099987488352477e-01   +3.459530917517162e-03   +3.760549185750345e-01   +3.946039737543762e-01   -8.638056537470162e-02   +4.166678485226910e-01   -8.636081725669387e-02   +3.903125426971871e-01   +7.803387128478214e-01; -2.548469943213687e-02   -3.300144315644948e-01   +6.470844189924683e-01   +4.300026166755774e-01   -6.898286393596507e-01   +9.915239647060034e-02   -1.764446627190663e-02   -1.373458414639545e-01   -6.399186120579892e-01   -2.939221719828914e-01   +7.180642694200601e-03   -4.689417189827775e-01   +5.087217373629490e-01   -3.466959608722660e-01   -4.011461613780960e-01   +3.883690404553765e-01; +4.538387685229886e-02   -7.772177560306184e-02   +3.472749774158371e-01   +3.318905256943757e-01   +2.430149344796912e-01   -4.902460927929317e-01   +1.829119399940210e-01   -1.013121467722397e-01   +4.512485202042641e-01   +4.478751115270340e-01   -6.941974500154305e-02   +2.174874526617455e-01   +3.553880535776812e-01   +4.516659568946327e-01   -3.119310141440108e-01   +6.216336857486200e-01; -4.812178325953210e-01   +1.596799524341373e-01   -3.371119989180454e-02   +3.191351887921520e-01   -5.443324320626286e-02   +8.020308655865861e-01   -5.245027848383039e-01   +5.705266876343364e-01   +5.127053907956933e-01   -2.790410924916715e-01   +5.817758450664239e-02   +5.713890363004894e-01   +1.533433794175467e-01   +1.985035500147741e-01   +1.782563436939421e-01   +3.192087289869621e-01; -5.246064385517866e-01   -4.515303429378424e-01   +3.830846819460652e-01   -7.543545427652584e-01   +9.690636326274163e-02   -3.333311709300151e-01   +7.025006232810188e-01   -5.738609157685950e-01   -2.232514604729118e-01   -5.290064594019439e-01   +8.124417648590863e-01   +2.227499889364660e-01   +1.465854181570127e-01   -4.854230407583507e-01   -4.030971040299408e-01   -5.555221423292154e-01; -4.730083347150932e-02   +2.721757651080640e-01   +7.086389131268087e-02   -8.229874292632755e-02   -4.682807360826736e-01   +1.301245285133816e-01   +3.229932148277309e-01   -1.718341194831422e-01   +8.567950218645878e-02   +8.441145935540020e-01   +2.724502803284206e-01   -7.133418349771953e-01   +5.966731576393625e-02   +2.638005315720480e-01   -2.578672338514588e-01   -4.665247792302782e-01; +7.057814480706774e-01   +4.309251854432442e-01   -3.082208228258143e-01   -4.661539915879385e-01   -5.551748405025799e-01   -3.938667361859132e-01   +6.703140364843384e-01   -4.131420374948803e-01   -4.062713477277126e-02   +3.411852920409529e-01   -3.249273349948281e-01   -2.339925359718358e-01   -6.075313235260682e-02   +1.475257542746025e-01   -1.247281357871682e-02   -1.390811554850954e-01; +3.143987218316120e-01   -6.450593607909919e-01   -2.444978110320589e-01   -3.880442107848924e-01   -1.226493630157305e-01   -6.988584243923779e-01   -5.335020728197561e-01   -9.199584714057740e-04   -4.485570978040261e-01   -4.723212525266755e-01   -7.399975837612127e-01   -1.708641104767412e-01   -1.845668072938571e-01   +8.837757621184934e-01   +1.189060211429013e-01   +9.693148186683348e-03; +4.972868539288853e-01   +1.571945308861332e-01   +4.884416222946032e-01   +6.339012615897648e-01   -6.085162939090631e-01   -3.578386285469768e-01   -1.840925475267724e-01   +3.029356006450150e-01   -4.086265367778663e-02   -2.215151321263178e-02   +8.549132130754262e-01   -4.062439728615256e-01   +2.811398947369035e-01   +2.587595528855089e-01   -4.222458071727141e-01   +1.677794753901822e-01; -4.470207793068298e-01   -8.051946254423967e-02   -4.773503522694481e-01   +3.558041454670157e-01   +4.457154649141998e-01   +1.270798369989936e-01   -6.923741375058954e-01   -3.404025344906442e-01   +3.447217164607944e-02   -4.566563170378961e-01   +1.113456816475732e-01   +2.121563905401752e-01   +6.135356078873602e-01   +2.927486305755307e-01   -1.410016583716618e-01   -4.254165097536409e-01];
L1E_L1I_iGABA_netcon = [+2.537046468391834e-01   -3.521667942062350e-01   +2.522117121344978e-01   -2.021621904071538e-02   -4.012189184108303e-01   -1.026414718806962e-02   +3.984446067519339e-01   -6.171067433587144e-03   -7.450704978379010e-01   -3.854278282083000e-01   +6.049190250434302e-01   +4.050578160294080e-01   +1.436938171351928e-01   +3.929165854354236e-01   -5.956212435100379e-01   +3.030257410709679e-01; -4.867975824855395e-02   -4.693810837437830e-01   -5.429650042135135e-01   +3.416376257285600e-01   -3.299783756842571e-01   -1.315199766111887e-01   -8.424971042842277e-02   +2.247856481669114e-01   -1.486989620285311e-01   -2.246486043468783e-01   +8.658341764882294e-01   +2.690637026588750e-01   +7.208603372525797e-01   +1.696769501393325e-02   +5.187444112589791e-01   -3.001133765380187e-01; -6.306839334706009e-02   -2.115114556327824e-01   -2.475733894033170e-01   -1.127462268995530e-01   +4.929033803811885e-02   +1.264270182054773e-01   +1.910272190670081e-01   -2.175800456753562e-01   +2.396362756155209e-01   -2.053779778789669e-02   -1.813086911003598e-01   +5.969668371836332e-01   +1.684330809645082e-01   -2.424097290653428e-01   +3.098609007845633e-01   -2.483041474102372e-01; +2.119759238177686e-01   -4.944247121368406e-01   -5.841842797757942e-01   -4.171470268821301e-01   -8.169182100436243e-01   +2.620509227674514e-01   -4.672934658846201e-01   +1.505763460972068e-01   +1.485230980714682e-01   -1.302338901470793e-01   +5.369011942687415e-01   +1.466771833374327e-01   +6.397444503367163e-01   -5.866336365294793e-01   -1.281019623833153e-01   -2.960276830287028e-01; -1.258379844731954e-01   -4.396929238404635e-01   +4.780591731290795e-01   -1.379133944768257e-01   -3.413478072472811e-01   -1.455802197310222e-02   +5.003694275224619e-01   +2.326491605307185e-01   -2.927972388106953e-01   -6.483786056462154e-02   +2.776848123918020e-01   -2.829692670469370e-01   +7.223459268766449e-01   -1.795441052784293e-01   -2.726684263732118e-01   +6.962864053653285e-02; +2.082462538376178e-01   +2.387335353551037e-01   +4.083726649848317e-01   +3.012111214814843e-02   -2.976404658282367e-01   -2.264696627371987e-01   -2.474014812880478e-01   -4.552907039913031e-01   -7.300582703738739e-01   -3.672870457374381e-02   -1.970740225449326e-01   +1.339696973560992e-02   +4.936124140114670e-01   +2.987959983925813e-01   +3.560423613902181e-01   +7.712739487912445e-03; -7.470083230052443e-01   +1.253736030561002e-01   -3.520641954050370e-01   -5.407625740537348e-01   -1.238760986629366e-01   -6.837918682114311e-01   +2.814680971037692e-01   +4.578981549248957e-01   +1.500969590840097e-01   -2.671779486416537e-01   +2.498924125380872e-01   -3.172253850407687e-01   +1.000000000000000e+00   +3.537758109504100e-01   -9.030548801953824e-03   -5.197900798792610e-01; -7.131776230839537e-03   +1.316555901865917e-01   +1.888368653106914e-01   -5.071323806815562e-01   +8.862093369933395e-02   +8.061667422037141e-02   -4.849775858719310e-01   -1.119801775292533e-01   +7.819393677759023e-01   -2.776911229815637e-01   -5.719467101083735e-02   -3.539478886603965e-02   +8.152659505553103e-02   -1.977410960216117e-01   -6.045720060492862e-02   +5.635167445200442e-01; +7.588727475509300e-01   +5.426434546590870e-01   -4.031946508287246e-01   -5.924661402168536e-01   -6.074913469113739e-02   +1.689093606177867e-01   -1.485792016463926e-01   +4.778580399892188e-01   +4.241510303703184e-02   +2.142735191536425e-01   -4.546499550329691e-01   +2.880205996496082e-01   -6.369405778383157e-02   -2.251756244641426e-01   -8.445882283615035e-02   +2.448508027273519e-01; +3.615618798754309e-02   +1.834841479500045e-01   +5.169381719322255e-01   -4.689409703899990e-01   +2.582832100109534e-01   +4.878309111366389e-01   +4.878232787971815e-02   +6.014922994401772e-01   -5.185467327553335e-01   +3.114326662874909e-02   +1.987294346517170e-01   +2.704141372411421e-01   -2.705555199004928e-01   +2.683690157758361e-01   -1.192787414577715e-01   +4.046880208728930e-01; -1.296818472645953e-01   +2.566562142657480e-01   -8.828414622942131e-02   +1.806301870942860e-01   -2.807349957833751e-01   -4.261172171678862e-01   -1.269274988569675e-01   -7.381639430677812e-03   +6.030705863176913e-01   +5.626924326405323e-03   -1.327660393971433e-01   -2.621379495549092e-01   +1.166944731397139e-01   +2.130118852188535e-01   +5.202360801192621e-01   -2.916134056261537e-01; -1.375595244687729e-02   -4.832520329685742e-01   -9.469465403475887e-01   -1.857738014837794e-01   +1.956956954381219e-01   -1.851201536319034e-01   -2.592425506374525e-01   +2.576368383362777e-01   -8.686871724116211e-01   -3.689190949605998e-01   -2.567630024390922e-01   +1.108251538013231e-01   +2.522068031133204e-01   +4.914611682929432e-02   -6.605013909817894e-03   -4.861284958813197e-01; -6.770914135698570e-01   +6.435722481076284e-01   +6.623487463240904e-02   -3.831460337854641e-01   +4.828547608744333e-02   -2.578564613042852e-01   -7.188333644648049e-01   -1.662297555409791e-01   -2.185407866875616e-01   +4.195442266877503e-01   +3.443402245775860e-01   +1.775355204007241e-01   -1.776072733479701e-01   -4.375352734609587e-02   +1.123132348562090e-01   +1.842735241476813e-02; +1.392045468919445e-01   -4.943104337604037e-02   +1.798147548149051e-01   -2.731047465904801e-02   +4.668069056418456e-01   +3.452614393791408e-01   +1.720749313892818e-01   +2.681028086243667e-01   +2.122977590363889e-01   -3.543851003966345e-01   +3.985753418483232e-01   -2.806517230851562e-02   +2.466504250474871e-01   +7.926127845144947e-01   +3.063985500744817e-01   +1.296932313728592e-02; +3.573554253663033e-01   +2.091580710085400e-01   -2.324528294265946e-01   -2.913793774827911e-01   -1.068845328900870e-01   -3.878906676055107e-01   -5.452469097434794e-01   -2.179830963312790e-01   -1.859299466322542e-01   +3.577119984693538e-01   -8.587320340964827e-01   +2.127060176729766e-01   +1.681655188563211e-01   -2.267700235623590e-01   +2.399394574719138e-02   -1.941684853847753e-01; +5.079789392426591e-01   -6.767124051210380e-01   -1.606741294024222e-01   -6.059554052180259e-01   -6.910970369992922e-02   -7.735473675826797e-03   +3.542085848468354e-02   -3.828505772420649e-01   -5.873336179150574e-01   -2.464625781662917e-01   +6.424448343613742e-01   +8.782485092118474e-02   +6.721854474173393e-01   -3.264308857552332e-01   +1.997492352654230e-02   +2.228448767424191e-01];
L2I_L1I_iGABA_netcon = [-5.965154879782829e-02   -2.966673941466724e-01   -2.296392316136173e-01   -3.212793834411578e-01   +5.348574098220037e-01   -3.102447343560919e-03   -3.605145196652572e-01   +2.225094283401645e-01; -9.106877009040158e-02   +4.382527267501479e-01   -4.483176238933654e-01   +1.911636063415398e-01   +5.208077859594830e-01   -9.339119304465206e-02   +1.431569379044119e-02   +5.450217749617783e-01; +3.307734368109885e-01   +8.657755869668561e-02   -5.482945657726580e-01   +2.090851201304187e-01   -2.211139736796729e-01   -5.284638295396675e-01   -4.761561602713089e-01   +6.790828330666048e-01; -1.000000000000000e+00   +9.516542242646305e-01   +1.836089432882795e-01   +3.698012284505554e-01   +2.835086082579729e-01   +1.027258328637459e-01   +1.355779782899397e-01   +1.487719291457353e-01; -1.588403353901393e-01   +4.662444094942825e-01   +6.934875804401909e-01   +2.739653710081079e-01   -4.497985297143394e-01   +5.925517527625271e-01   -8.370538162808948e-02   -5.020964824086117e-01; +4.152747012647678e-01   +8.832942229034081e-02   +8.264594551138930e-02   -2.548740663003693e-02   -5.682948764575002e-01   +5.490462153095670e-01   +8.082836285892107e-02   +1.381014557719430e-01; -3.073085260694666e-01   -1.824015097604764e-01   -5.621093598423205e-01   -7.406708508526512e-01   -4.853215570205514e-03   +4.086020791231777e-02   -7.002330016594341e-02   -4.564059569880589e-01; +7.116584174748304e-01   -5.315719851847116e-01   +5.426188515689486e-02   +7.575219630986300e-01   -6.507883978344634e-01   +1.134335811203946e-01   +3.442575405284471e-01   +3.606005494784723e-01; -3.422541844547614e-02   -1.953083414722661e-01   +1.022271322289304e-01   -3.410046922769563e-01   +1.241558119256041e-02   +4.727826169812824e-01   -4.246673346394293e-02   -1.785818059946626e-01; -2.280072350678156e-01   -3.702982887329004e-01   -2.624645828236855e-01   -2.854075133216240e-01   +5.046510713333777e-02   +2.257778099926284e-01   -6.785264790718304e-01   +4.236338131376019e-01; +6.261936112671346e-01   -3.570411295444228e-01   -4.393530037420021e-01   -1.540090226338665e-01   +3.336196323868195e-01   +1.046223179725800e-01   +1.549716496220755e-01   +7.228773622404497e-01; -9.624391737714588e-02   +1.692756791621886e-01   -1.210464360545450e-02   -1.628743955155587e-01   -2.277759262583840e-01   -4.381413496604107e-01   -2.243453874893471e-01   -5.423388738662140e-01; -4.844720301110645e-01   +3.256010913914361e-01   +3.276981402099010e-01   +1.863203678498670e-01   +4.342246370164676e-01   -2.033528883386497e-01   -5.659429859919226e-02   -6.171899156662455e-01; +8.573008225692616e-03   -5.162496545238274e-01   +5.094836659079599e-02   -9.087674053316423e-02   -1.933977181934444e-01   +2.783994353679469e-01   -2.056937029720410e-01   +3.770928389843344e-02; -6.126139695976868e-02   -9.647044813554058e-02   -6.478271216732007e-01   -2.987031111479704e-01   +5.288031341140544e-01   -2.146389281209383e-01   -7.778657468190900e-03   -6.827230898596491e-01; +9.582012184341654e-02   +1.981212395364621e-01   +2.766501995767461e-01   +3.245352043745444e-01   +6.677206507425501e-02   +1.834052513857335e-01   -1.069861340899875e-01   +4.363189835793351e-01];
L1I_L2I_iGABA_netcon = [-5.127049935277365e-01   -3.812016562770930e-01   +1.133045248715949e-01   -1.582802287513495e-01   -9.982425971784489e-02   -6.906722308409614e-01   -1.302209185999510e-01   +6.406202988718546e-01   -4.218048549782030e-01   -4.885733782180581e-01   +2.966577560539151e-01   -3.220429653758524e-02   +1.186029482338816e-01   -1.307574899192276e-01   +1.090721958728194e-01   -5.782593489035889e-01; -3.452347474645353e-01   -6.254802076914615e-01   +3.079786570374476e-01   -1.646617300532713e-01   +4.128647995188088e-01   +1.320891250585928e-01   +2.767939925968860e-01   -5.694819966065784e-01   +1.060762820555580e-01   +7.301983560710873e-01   -3.303177272388012e-01   +2.157708594805830e-01   +2.114876223915821e-01   -3.111644678887256e-01   -3.006929076152844e-01   -3.767314643032781e-02; +5.364723977438702e-02   -2.714111220064087e-01   -1.808990003412200e-01   -5.734120892217780e-02   -3.320502084186197e-01   +1.653514156155937e-01   +7.714503558389885e-02   -1.138856634523690e-01   -5.083625038752937e-01   +4.609514745074418e-01   +7.568395506429892e-02   -7.231037649816651e-01   -5.318800074515343e-01   +6.828090935210214e-02   -5.871144006113015e-01   -6.615212593093975e-01; +4.324226313935328e-01   -1.818594205778132e-01   +2.831153823924561e-01   -8.411313122000353e-01   +3.706845644567218e-03   -3.460271184063875e-01   -2.679518339159890e-01   +4.443160224583753e-01   -1.995506198758479e-01   +1.405016027795990e-01   +2.194390643831586e-01   +2.284299821942759e-01   -4.162257198894334e-01   -7.108101980255028e-01   -6.992503151615802e-01   -9.958889603465332e-01; +1.401038156065715e-01   +3.734876137639659e-01   -4.214463932419501e-01   +7.157752339306017e-01   +4.253150386844171e-01   -1.325315960917225e-01   +3.448432252581912e-01   -2.252080497891219e-01   -7.398626125148330e-01   -5.995867573704224e-01   -2.169178208770810e-01   +3.920000272903864e-01   -1.231647707593211e-01   -2.640984618727982e-01   -6.185949869783296e-01   +4.126320258270560e-01; -5.266140281548654e-02   +6.283787490008284e-02   +3.500300058001073e-01   -2.928778985907664e-01   -3.953514386837053e-02   -8.404442383856894e-02   +7.181907820494881e-01   +3.359948088021199e-01   +1.737993890377195e-01   +1.000000000000000e+00   -1.113502249214292e-01   -3.221997109410245e-01   -8.279787838852924e-01   +3.883961573505510e-01   +2.907098479872897e-01   +4.995390858688968e-01; -5.911525509418216e-01   +5.937601601956226e-01   -4.004170553927679e-01   +2.654178142211612e-01   -2.568371085187240e-01   -1.563116712797507e-01   -2.104712714486869e-01   +5.916270539791135e-01   -8.335739115790736e-01   +5.308276054494482e-01   +1.511459032313355e-01   -1.879988095963332e-01   +4.288956216165149e-01   +8.046080538657112e-02   +4.157299667661069e-01   -4.515410827819719e-01; -3.420687697479515e-01   +1.544200352610164e-01   +5.796208838496072e-02   -2.917806737246740e-01   +1.982949943022633e-01   +1.438806581778102e-01   +5.580830521398173e-01   +4.811463703337761e-01   +8.781870315151277e-02   +1.748306437108766e-01   +2.879301978975158e-01   -1.763744187315362e-01   +2.592305209198469e-02   +5.988640920467420e-01   -6.729280190715753e-01   +4.048508054835054e-01];
L2E_L1E_iAMPA_netcon = [-4.694021148960989e-01   -2.164714117847692e-01   +5.705241307532358e-01   -3.929933912282032e-01   +4.386228878176449e-01   -6.588908962722488e-01   +3.242664054728804e-01   -8.559218231182310e-02; -4.379681679272746e-01   +2.485411188881464e-01   +2.887624440688982e-01   -8.486794316457584e-01   -1.349817330211224e-02   -1.149988568874947e-01   -2.514326986096646e-01   +5.133287226616402e-01; +7.247503741934977e-02   +5.006849315678847e-01   -4.404588189999759e-01   +2.594720512272055e-01   -3.802296499065585e-02   +3.894547225707008e-01   +4.518898975584697e-02   +4.878102550471936e-01; -9.109765239488100e-02   +1.034647195123624e-01   -2.560616974266267e-01   +1.413292929502593e-01   -1.615738228405570e-01   -1.147552752638568e-01   +2.854995717938839e-01   +2.403967287041853e-01; -1.534808504328756e-01   +3.937990759861529e-01   +5.167476744479792e-01   +5.358674764743537e-01   -2.859378147616968e-01   -3.643266991012838e-03   -3.190069759333973e-01   -3.405673612230783e-01; +3.860489750907087e-01   -5.741165664126854e-01   -1.277473389920043e-01   +8.109369248187299e-01   +6.184401228336619e-01   -4.765716915205687e-01   +3.740728313201288e-01   -2.374479074723224e-01; -4.404340294822224e-01   +5.381371075260893e-01   -1.697434090438018e-01   -4.366106335192601e-01   -5.678090305920368e-01   +5.669150988155550e-01   +2.745685642504732e-01   +5.626311111848327e-01; +3.993620590581891e-02   +2.061326450230925e-01   +1.418353654698386e-02   +4.159228271883996e-01   +4.272178335133586e-01   +3.944014455025365e-01   +5.016774699716339e-01   +2.507546479697362e-01; -1.955350569542951e-01   -2.042191413446285e-01   -6.716876292602174e-02   -9.239148536357129e-01   -3.669385361605152e-01   -5.820857377586641e-01   +4.263944211309427e-01   -3.879049887951121e-01; -7.587802447944564e-01   -2.183254647943633e-01   -5.721950188559816e-01   -7.935890104785413e-02   +4.138426793099588e-01   +3.070751791510783e-01   +6.699834293893721e-02   +1.690308632929848e-01; -5.638736810435997e-02   +4.424851744960144e-01   -3.861972189151889e-01   +2.491049919339701e-01   +6.826842080179366e-02   +3.330506490481291e-01   +6.355437162669673e-01   +5.208445165001758e-02; +1.295964534952432e-01   -3.703423438549085e-02   -1.478556405909132e-01   +7.946108882010837e-01   +4.333563813126976e-01   +5.400135082685770e-01   -4.001744629911386e-01   -2.760416808463199e-01; -9.615885012395053e-01   +1.472131452990144e-01   -9.748981052549626e-03   -2.617036039048384e-01   -8.486046211789016e-01   +6.958539782689813e-01   +5.637787721141996e-01   +1.449024575254877e-01; -4.695513001640614e-01   -7.262194845252350e-02   -9.885254216259892e-02   -5.575473264761450e-01   -9.019752720009533e-01   +3.390569069820362e-02   +3.670194484600338e-01   -5.882317729658875e-04; -6.585500257458538e-01   +3.157528462690627e-01   +7.742085693144539e-02   -4.823401012443300e-01   -2.600779661308042e-01   +6.815017772427466e-01   +1.000000000000000e+00   -3.206784682647377e-01; -5.213977794754156e-03   -1.359143965953725e-01   +5.052129247368717e-01   -9.141198697770770e-01   -5.405990395260108e-01   -9.412408688217914e-02   -2.718818761648294e-01   -8.084698267790851e-01];
L1E_L2E_iAMPA_netcon = [-7.348418293139292e-02   +4.203937141425355e-01   +2.338269081369510e-01   -8.453797784295072e-01   -3.385774533369975e-01   -5.156629240557126e-02   +3.067396062222502e-01   +1.725789720311190e-01   -1.827032791532900e-01   -2.062042643479159e-01   -3.690757051023273e-01   -1.639150860996599e-01   -2.823464532877474e-01   +1.600173800714552e-01   +3.840681084430767e-01   -5.770141197915934e-01; +7.761085938807734e-02   +7.801170555072138e-01   +7.846960878350160e-01   -4.257191934822566e-01   +6.179442108796630e-02   +3.212110262367532e-01   -6.235592920192511e-01   +4.447659104765703e-01   +1.207429726859450e-01   -6.600236798618320e-03   +1.429030840919365e-01   +2.279752564085570e-01   -6.073689308205488e-01   -2.284227330920797e-01   -2.763962697274353e-01   +2.046990538604105e-01; -2.453004425273309e-01   +1.657297279489769e-01   -1.116270626564773e-01   -3.607695314352728e-01   +9.171146252247001e-02   -4.062122469040226e-01   +5.046297419681006e-01   -6.359245275071084e-01   +1.022845945748458e-01   -8.163288244950440e-01   +3.337698434568755e-01   +4.473720572903793e-01   +4.645304951592342e-01   -2.003665503350427e-02   +6.918993993284244e-01   +1.750250710622276e-01; -1.836023864442238e-01   +3.568072276694307e-01   +9.025974549387195e-02   +2.597891070066624e-01   +1.870054980197935e-01   +4.723306272174057e-01   -1.784475518041141e-01   +3.252258278907378e-01   -6.892539200745377e-01   +6.808301771756263e-01   +3.867051474379375e-01   +4.107573411935347e-02   +2.605287203626948e-01   +5.558212610998627e-01   +6.935696385604695e-01   -3.255909771612467e-01; +5.301502238848215e-01   -7.002788661901143e-01   +5.112909029986767e-01   +1.964632786538039e-01   -4.283918343382118e-01   +1.125942601393241e-01   -3.469560608800696e-01   +1.505462854642539e-01   -2.805204180762783e-02   +6.257740399562153e-01   +3.574788457765203e-01   +1.926756817183883e-02   -5.602966048421967e-01   -7.503948776625942e-01   -6.126506973117982e-01   -4.448587564500158e-01; -1.462565526875721e-01   +2.070218650815260e-01   -1.077930396975474e-01   -2.226003498655297e-01   -5.451097137156915e-01   +2.253119014109123e-01   +6.625152432345951e-01   -7.756201094780053e-01   -1.071480742702180e-01   -1.097465932166659e-01   -2.547809558465609e-01   -9.497533681144954e-02   -3.795795086297110e-01   +1.466558100228768e-01   +8.510182939464705e-01   +6.573321094752013e-01; -4.548733278643073e-01   +3.874989054209612e-01   -2.911598647077875e-01   -1.898624961913023e-01   +2.113365979166361e-01   -8.608518460620829e-03   -4.892530634215374e-01   -4.741806868946208e-03   -3.774026932844173e-01   +1.799047902050136e-01   -2.992435401252459e-01   +2.402521707442923e-01   +2.938701263333518e-01   -6.455409020255003e-01   +2.356667704474542e-01   -2.010821448552361e-01; -2.033278508114683e-01   +8.639104377208976e-01   +7.100555758899687e-01   -2.468281989845962e-02   -5.578248084301984e-01   +9.974051138171971e-01   +8.737942678350132e-01   -2.124224746668352e-01   -2.573765881773385e-01   +5.272349806613452e-01   +5.845279765596414e-01   -1.880748517134261e-01   -3.475383146257551e-01   -4.367831533866132e-01   +4.500188004604972e-01   +4.564866204915125e-01];
L2I_L2E_iAMPA_netcon = [+5.075955576773084e-01   -3.512907296854505e-01   -2.265992904393013e-01   -6.064805885959565e-01   -5.024943769361831e-02   -5.735264417009045e-01   -1.000000000000000e+00   +8.770613399635553e-01; +7.673863914654994e-01   -2.756806011472459e-02   -3.474236151223616e-01   +3.616223542412176e-01   +6.301036304789529e-01   -3.194495950649549e-01   -2.660608402527159e-01   -3.290725066868800e-01; +8.158818038274984e-02   +2.477898158262016e-01   -2.955936929247276e-01   -7.715185491985018e-01   +6.376056403552154e-02   +1.055108140640243e-02   +5.374082780528602e-01   -1.757398659923932e-01; -7.457312833105344e-01   +3.675495125196104e-01   -1.659345468899935e-01   -5.395293653694467e-01   -3.445563706562516e-02   -3.635858007493186e-01   -3.038349820341082e-01   +2.029375135965834e-01; +9.015032125491745e-01   +5.245989430315270e-01   +1.983640195847000e-01   +7.145724114768056e-01   +4.114577620379536e-01   +2.907726754470069e-01   +7.108655420859067e-01   +2.848558892515063e-01; -2.508024441055873e-02   +6.796227793389338e-01   +2.551827177715134e-01   +5.045085788556041e-01   +2.986873612458706e-01   +1.252471131524625e-01   +1.704913207228469e-01   -4.071195157049165e-01; +2.334504859569862e-01   +1.444349276750649e-01   -4.036413342122494e-01   +7.472947040916361e-02   +1.051325354312187e-01   +1.196677808678288e-01   -2.070303859693353e-01   +9.473560775267345e-02; -3.936469574724193e-01   -3.988122214918706e-01   -3.578941922710091e-01   -2.766767467761444e-01   +3.907508510937088e-01   +7.054585728601763e-01   +8.066139294621671e-02   -5.780769188190011e-01];
L2E_L2I_iGABA_netcon = [+2.317339595126405e-01   +2.222286047554586e-01   +6.626693427227150e-01   -3.681553266290437e-01   +1.635990719214048e-01   -2.354441045546482e-01   +3.026633982674735e-01   -6.114426218585318e-01; +1.990876303753642e-01   -7.985014130603556e-03   -1.861684808005855e-01   +3.408646668302235e-01   -4.190651650125704e-01   -4.902902323707571e-02   +1.387320292485201e-01   -3.079561928757637e-01; +3.991846467182193e-02   -4.855302563799115e-01   +1.000000000000000e+00   -6.661237155520201e-01   +3.201936991250129e-01   +3.664042702167617e-01   -4.406459177472850e-01   +6.178767030032318e-01; +1.874790236073186e-01   +1.003040359000445e-01   -2.041574297259831e-01   -2.625753769875389e-01   +3.983440012897090e-01   -1.996770679321016e-02   +2.035176488040576e-01   +4.769125509908330e-01; +5.909079955141423e-01   +1.324753145153080e-01   -6.857842714256550e-02   +4.987985526255038e-01   -2.295827932691234e-01   -2.827551148895036e-01   -6.301397830735269e-01   -6.251561255694082e-01; -6.002062528374356e-01   +4.519412286421369e-01   +2.820874388288763e-01   +5.432292020724970e-02   +3.227103433273341e-01   -2.598934665985748e-02   -6.639856552314136e-01   -6.645943185222742e-01; -2.704267930419887e-01   -3.164293826159542e-01   -4.989255380061688e-01   +2.047670041875071e-01   -1.229709413955254e-01   -2.780692105508082e-01   +1.859009640550943e-01   -4.807071804477806e-01; -1.257743310966100e-01   -4.871005571439164e-01   -8.272533025667073e-02   +9.134873651039693e-02   +2.649202947143912e-01   -3.290110323251086e-01   -7.532016271976160e-01   -4.671345747383810e-01];
L3E_L2E_iAMPA_netcon = [+6.475297875841669e-01   +3.570266521764802e-01   +3.833516797138122e-01   +4.734924286387674e-01   +3.597000950414740e-01   -1.283315864303144e-01   +2.647467181753310e-02   -4.672244742844007e-01   +1.382264352967728e-01   +2.630488540704625e-02   -3.114347506847214e-01   -3.602582949357789e-01; +1.876530779589675e-01   -6.489591946148404e-01   -4.632560077534478e-02   -1.132428207608129e-01   -4.952382304218015e-01   +2.901083548176404e-01   +2.281763710298935e-02   -6.664937868642777e-01   +8.091666106244979e-01   -6.136479334298776e-01   -4.731480500734528e-01   -9.841292098080169e-02; +4.574712413484284e-01   +1.476929355677832e-02   -1.140722177178132e-01   -1.084773490294618e-02   +4.226014068357001e-01   +7.340346111488855e-02   +2.570930569884405e-01   +5.690893371226819e-01   -7.385981031974864e-02   -4.150441178439055e-01   +1.065717491080575e-01   -3.482403574590802e-01; +4.176053225979360e-01   -1.000000000000000e+00   -3.194354087940088e-01   +4.505034426977785e-01   +4.029383258400658e-01   -1.716516941426765e-01   +4.562925664654993e-01   +5.337924547516991e-01   -1.040975375957510e-01   +8.166333013240428e-01   -2.546508814251743e-01   +5.471271043382944e-01; +1.545321733826701e-01   +2.607764840398886e-01   +4.441191009044598e-01   +1.397111113070594e-01   +2.363454267368811e-01   +2.272885053400079e-01   -7.425759769018869e-02   -3.076315319584109e-01   -3.674677461314760e-01   -5.378268957255907e-01   +1.034451228903842e-01   -6.557130464464948e-02; -2.373133268385602e-01   +4.792487058459910e-01   -2.279738988118883e-01   -2.168141784603705e-01   +2.827767964505523e-01   +2.891571102787168e-01   +4.542388479527001e-01   +1.483979543924868e-01   -8.086243999600792e-01   -7.529949999953907e-02   -1.990535902667651e-02   -8.878255161123116e-01; +3.734756632125942e-02   +2.423645407359063e-01   +2.725453345968759e-01   -2.555829870992373e-01   -7.488645276084681e-01   +3.599426571318270e-01   -1.785441382482231e-01   +1.822598151795016e-01   -3.278593477142461e-01   +6.470208425265506e-01   +2.608647258385066e-02   -3.799406690224998e-02; -4.456413206777513e-02   +8.218346358365641e-01   -4.100462347349436e-01   -5.670394682530411e-01   +1.951224234769823e-01   +2.858008487440769e-01   -2.113271871761845e-01   +6.380514299365690e-01   +1.246700779451145e-01   +7.455481933175080e-01   -3.161967175702419e-01   -3.948130728924422e-01];
L3I_L2I_iGABA_netcon = [+7.486023338737138e-02   +4.187168638238057e-01   +3.475237287583282e-01   -4.260296473003977e-01   +4.016440152781339e-01   -1.716004054273403e-01   -1.520460830263587e-01   -4.575731841444801e-01   -6.547119791321354e-02   -3.005070281083129e-01   -4.743419723605036e-01   -4.317472964738943e-01; +3.851587626954505e-01   +1.549168033851782e-01   -8.525472697222458e-01   -2.925959978049583e-01   -1.195525648502745e-01   +4.530767202133920e-01   +1.228900775092513e-01   -8.199621524485848e-03   -1.079835780709120e-01   -4.258197467730635e-01   -4.816337753214003e-01   -6.059025932469643e-01; +3.351406032538090e-02   -1.154340338348565e-01   +5.669001821169720e-01   -5.471496739559436e-01   -5.519594718089593e-01   +1.178093767605801e-01   -1.826918880698537e-02   -5.175967924872110e-01   +3.399535551868477e-03   -1.190978241620289e-04   -5.583172224791557e-01   -2.932886367214801e-01; +1.525853401823324e-02   +4.635790831377388e-01   -9.068120419318191e-01   +3.287771603841811e-01   -2.366264780874816e-03   +9.908226666177938e-02   +2.732137089065220e-02   -2.636031072962432e-01   +5.051989245973760e-01   -2.584786275988486e-01   -6.498462826617248e-01   -6.903733051226214e-01; -3.912143858564601e-03   +2.285120968129269e-01   -1.966894128321243e-01   -3.195832323035679e-01   -3.319530769287097e-01   +6.659473603739934e-01   -5.458623748628263e-01   +7.049842866862522e-01   +2.154955132520109e-01   -2.766043442927119e-01   +7.174427872709662e-01   +1.292615296851992e-01; +3.864023870286231e-01   +7.040370818250541e-01   -3.244576422606127e-01   +6.861750219623054e-01   -2.603150345746150e-01   +1.865269779282891e-03   +4.285023339820269e-01   -8.507322145715829e-02   -2.528324060985987e-02   +3.240806980443276e-01   +4.618478487800535e-01   +6.833063638297290e-02; +4.633427633159904e-01   +5.127671716417673e-01   +1.562308852285798e-01   +3.985041299398575e-01   -3.927063782504745e-01   +5.777537922521345e-02   +5.748011604611191e-01   -1.141705797800548e-01   +1.079953653435994e-01   -5.592991382317211e-01   +6.215726111633104e-01   +4.481654497986204e-01; -5.385160321647947e-01   -1.679945054265112e-01   -1.002628388648410e-01   +3.266233902667597e-01   -1.898515850426016e-01   +1.518457181212427e-01   +9.550054322775559e-02   +1.507878508770065e-01   -1.290830908717978e-01   +8.853794342882975e-01   +8.363395973366400e-02   -3.099062964660688e-01];
L2E_L3E_iAMPA_netcon = [+1.719247925403061e-01   -3.158216965527991e-01   -1.000000000000000e+00   +3.480390925150106e-01   +9.123062541171761e-02   -6.694947177591058e-02   -5.738083988611078e-01   -1.850043141803535e-01; +2.555905262385840e-01   +2.554518821810164e-02   +7.616033794850660e-02   -1.804130232496221e-01   -6.958839279918760e-01   -3.571291430023857e-01   +5.579959441084017e-01   +5.221650073604415e-01; -8.351380759512216e-02   -7.205107892991026e-01   -4.205143521110932e-01   +8.848904488909082e-02   -4.352125400642878e-02   +2.068517649158765e-01   +1.632734995889329e-01   +5.416945373511887e-01; +4.848237987233102e-01   +2.981701957605368e-01   -9.043573412721967e-02   +8.678683490509477e-01   -4.147884795545809e-01   +9.262067356032754e-04   +3.821122377450116e-01   +4.756573040160952e-01; +5.232138855589170e-01   +2.499719672726976e-01   -2.211430365971792e-01   +1.230824871788207e-01   -3.804514404458749e-01   -4.015646936228444e-03   +1.479087878636551e-01   -8.699350016874778e-01; -6.381783786446970e-01   +1.512369269201809e-01   +2.021678244778502e-01   +2.530690416578535e-01   -1.663380031667623e-01   +1.689796648080443e-02   +2.279497758781531e-01   -5.052535908458249e-01; +1.316556384064233e-01   +4.388264820117179e-01   -2.472576257508324e-01   -4.175507825983985e-01   +7.623753323399431e-01   +2.136999776407181e-01   -5.627655438815141e-01   -6.976435915038196e-03; -2.525592105336087e-01   -4.177489509550873e-01   -4.641509165428000e-01   -6.046461365874302e-01   +2.326327785652884e-01   +4.348933386475199e-03   -3.026000810764435e-01   +5.171898949512203e-01; +4.054060979713184e-02   +5.509900490058433e-01   +2.046527740996886e-02   +6.022368899790633e-01   -1.617376082854910e-02   -5.805356678845858e-01   +2.358301685454545e-01   +1.197666505074864e-01; +5.732622370326960e-01   -7.428889127361518e-01   -2.449572360639788e-01   +3.836141839969470e-01   -6.037842259927752e-02   +2.656960367401049e-01   +1.893891499657812e-01   -2.870950993120773e-01; -4.463605052315480e-01   -1.129423539368415e-01   +1.301058840579586e-01   +6.099037066253473e-01   +6.730634558534852e-02   -1.031643141542155e-01   +1.780690570810283e-02   +4.246484905624283e-01; +5.455182249467969e-01   +9.398697284604018e-01   +1.824260903274809e-01   +3.430403472461003e-01   -3.580525724302189e-02   -2.310430775125828e-01   -4.070344772187266e-02   -3.154804824939739e-01];
L2I_L3I_iGABA_netcon = [-3.241831054591814e-01   +8.231069498144483e-02   -5.772601640321009e-01   -2.886498364324020e-01   +1.548367835673575e-01   -1.539802644025447e-01   -2.174219031225188e-01   -4.253622264175099e-01; -4.688251057199630e-02   -8.017843710678867e-02   +1.836809227348530e-01   -3.761808690873366e-01   +6.112210053111428e-01   +6.631341501832917e-02   -1.606047912041162e-01   -5.389844031269488e-02; -6.567574469710930e-02   +4.614444125543365e-02   -2.872283104012259e-01   -4.398746574327730e-01   +4.300664033601594e-01   -1.176637508754832e-01   -6.452182800173070e-01   +6.661574373976962e-01; -1.131393598306130e-02   +6.034266255014951e-02   +2.219668564618649e-01   -4.280666792380389e-01   -8.706668293043192e-01   +1.358996390268588e-01   +3.001879754556046e-01   +3.588670205264520e-01; -4.899464708528682e-01   +1.161054824459290e-01   +2.908258897090573e-01   +2.718666226793379e-01   -7.568691969943726e-01   +3.647838740623069e-01   -3.294675023422880e-01   +1.780494282839288e-01; -2.366005581661524e-01   -5.513911970436818e-01   +7.331991003676738e-01   +5.359809961712184e-02   -3.665138450621724e-02   -2.231593398091936e-01   -4.879310537621212e-01   +5.095051454231264e-02; -5.891619353677374e-01   +3.285949685250066e-01   -3.898939573312610e-01   -4.048606098227982e-01   +3.863101083651267e-01   -7.635218054968995e-01   -2.786634897872377e-01   +1.000000000000000e+00; -5.870539152550333e-03   -3.260952888784941e-01   -9.096433650060128e-01   +4.635896983805839e-01   -7.706614218504865e-02   +3.701224330780056e-01   -4.392319989079788e-01   +6.738300331553472e-01; -3.528861172571057e-01   +3.894757860968837e-01   -3.191264271015969e-01   +3.006557407740197e-01   -8.124473849840724e-01   +7.262531312760565e-01   +2.842910733214860e-01   -1.228654571524578e-01; -2.423422857524659e-01   -1.847727659132059e-01   -1.619772415851404e-01   +1.658762079480822e-01   -5.228126761623674e-01   +5.903750107976660e-01   -1.179000766652830e-01   +7.476602317242107e-01; +6.100777254037388e-02   -7.068755956049839e-02   -9.299361408484985e-02   +2.227848726173809e-01   +3.354136266824945e-01   -1.167594078925729e-01   +3.756651700948163e-01   +9.169037583143812e-02; -7.958782187287557e-01   +1.187057635176104e-01   -3.553538910707656e-02   +2.074928594862799e-01   +3.805899503395246e-01   -4.330950934028033e-01   -1.362499134646409e-01   -8.522773404749977e-01];
L3I_L3E_iAMPA_netcon = [-4.710663896811284e-01   +9.363396296938471e-02   +5.185060016874119e-01   -2.104544031256881e-01   -1.665961513389050e-01   +1.814777631462187e-01   +6.988111889693943e-02   +7.425073005973511e-01   -4.622404934755271e-01   -6.242749656681942e-01   +7.394356319175341e-02   +4.061787815593704e-01; -9.627727745345599e-01   +5.857605596794525e-01   -6.264773220136536e-01   -4.205238686937813e-01   -3.156176952362565e-01   +4.179252338241315e-01   +6.323723093966492e-01   +2.775441479599197e-02   -2.467523191134077e-01   -1.453703897428856e-01   -6.129376325131168e-01   +3.323658714413553e-01; +1.555431527849927e-01   -5.549831944467942e-02   +1.000000000000000e+00   -2.315001529714926e-01   -8.269083201710333e-01   +4.253261346024544e-01   -1.512282082620946e-01   +4.684822558635044e-01   +1.668691723569353e-01   -3.516900702212392e-02   -6.927732151207782e-01   -4.566640829323391e-01; +9.514186840988942e-01   +4.928411725081330e-01   +8.609778001481796e-01   +4.342243302841313e-02   -4.502800027642975e-01   +6.861224936476348e-01   -2.534239570502385e-01   -8.046637332710671e-02   +1.103221514696502e-01   -2.849484753104825e-01   +4.925050609130343e-02   +2.739048662100825e-01; +3.412505583866175e-01   -7.463855801823825e-01   +1.116623478938550e-01   +1.953812052670725e-01   -4.568961762054241e-01   +2.374600152497458e-01   -6.548625733993944e-01   -2.207928703529865e-01   +4.224490414302389e-01   +3.404937741861889e-01   -1.923738058864456e-01   -8.510196088603670e-01; -5.991745249177695e-02   -3.574915496806548e-01   +6.320459118755382e-02   +1.537939861856831e-01   +2.458773697657886e-01   +7.303628968106497e-02   +1.366266067183064e-01   -2.977138884911080e-01   -6.838910308096122e-01   -4.846853561816129e-01   -7.312744997594582e-01   +6.505077833404090e-01; +3.085556644450431e-01   -1.131269825197949e-01   +5.269623155267259e-01   -1.127591044074166e-01   -2.847975173159846e-01   +2.202413879015602e-01   -5.573649167858266e-01   +6.878054510667011e-01   -4.676758159325355e-01   +8.422757434685517e-01   -3.769545697816752e-01   -3.533694772377370e-01; +3.099809174846592e-01   +1.164963034395424e-01   +5.323705514872989e-01   +6.233499673488234e-01   -4.915976973232725e-02   +8.193926047179109e-02   -1.184024153391991e-01   -4.505260544499335e-01   -1.141679851298851e-01   +2.516533847239842e-01   +3.381889990905116e-01   -2.587688666682298e-01; -2.161318573375853e-01   -6.329800683111854e-01   -4.580201235200040e-01   -1.260131307171388e-01   -4.876493599889001e-01   -3.309664552318903e-01   +5.367650224834686e-01   +8.924090054734076e-01   +1.408823786092627e-02   +1.469524890043054e-01   -3.236000296359425e-01   +1.905040118578575e-03; -8.822501467814577e-01   -3.590101220795464e-01   +3.185795340318744e-01   +1.470123926461362e-01   +6.542201008919653e-01   +1.250189640255369e-01   -9.166375237882952e-01   -4.833175232166752e-01   +7.103634016470853e-01   -5.691347800600173e-01   +2.305115974035454e-01   -3.171959037505990e-01; -3.577483600795466e-01   +2.007403687203902e-02   -2.450091633810434e-01   -1.578078659772623e-01   +1.634908867388794e-01   +2.464949908474894e-01   -3.875566313776094e-01   -6.074197423358682e-01   +8.175563637360116e-01   -3.211231969281926e-01   +2.278813959844904e-01   +2.189863584912220e-01; +1.377044105508824e-01   -5.922021204662148e-01   +1.194480332175687e-01   -2.880844780959792e-01   +5.569793672227319e-01   +1.796607105975776e-01   +5.476529007825756e-01   -8.360337477282216e-01   -1.360965814834853e-01   +4.249603209673098e-01   +2.914613576533456e-01   +4.080390860219706e-01];
L3E_L3I_iGABA_netcon = [-5.173628931869481e-01   -2.415520260872249e-01   -1.472417769545601e-01   +3.823840731711965e-02   +1.000000000000000e+00   +4.235292992241245e-03   +4.169879404735782e-01   -4.099533370029593e-01   +2.802913590009755e-01   -7.978516396555457e-02   -2.739849371132299e-01   -1.894247481842168e-01; +6.708707874704004e-01   -7.747677019592817e-03   -1.032306127142605e-01   -2.713356153508457e-01   +1.077820626818473e-01   -4.836765489563624e-01   +2.661051287124375e-01   -3.027658110125329e-01   -2.462722242446935e-02   +2.554293938771814e-01   -2.280398834472824e-01   +5.222770877755281e-01; +3.629078668276560e-01   +2.302976710838199e-01   +6.710355015685204e-02   +8.445427463393837e-02   -1.313929622984596e-01   +1.618498227798026e-01   -2.947599741423232e-02   -2.155461090449494e-01   -9.969102225763574e-02   +1.822154127703588e-01   -1.907765856903373e-01   -9.328132107526832e-01; -7.352063871957577e-01   -2.267946589337679e-01   -1.226193034376674e-01   +1.456802944094884e-01   +1.673656536519958e-01   -5.116844226221159e-01   -4.369804878318134e-01   +2.254032481620405e-01   +1.346559695075092e-01   -4.919238137178807e-01   +6.174743545944266e-01   -1.552202618589796e-02; +5.064244313134845e-01   -4.818958725655041e-01   -6.160264001109714e-01   +2.437478695068433e-01   +3.149042453514772e-01   -6.216796592762283e-01   -2.180778173979000e-02   -7.194962913171233e-01   -4.128604289391723e-01   +4.417778294301294e-01   -2.467975740075586e-01   -8.123154065056415e-02; +6.474155553283253e-02   -3.958696031200765e-01   +1.693857549233744e-01   +5.971040942135626e-03   -6.025869533303102e-01   +3.460095534782143e-01   +5.801581225091425e-02   -4.943437249747977e-01   +3.565901608355334e-01   +5.359926876158798e-01   +2.008419707904738e-01   -3.732106078388026e-02; +1.057275953035559e-01   +2.938946505723550e-01   +2.409320629283047e-01   +1.974432758103578e-01   +3.301913042688658e-01   +3.656027074586768e-01   -3.552905618716635e-01   +9.746371037173751e-01   -6.502772869556234e-02   +4.709206724773959e-02   -2.384269174784518e-01   -4.539722187055484e-02; +2.786995582506282e-01   -1.624277294663462e-01   +8.400316218050535e-01   -7.656933622413790e-01   -4.863369817649813e-01   -3.554328118716615e-01   +2.332200211105055e-01   +2.293428827791504e-01   -1.720282433801653e-01   -5.033359684429316e-02   +3.853773354750870e-01   -3.876965641578848e-01; -1.041955987598634e-01   +6.239172347195530e-01   +5.314852364515944e-01   +1.352331964559070e-01   +1.382734528706396e-01   +6.048729113366571e-01   +4.051218583210623e-01   +4.706186348589681e-01   +8.743439234257330e-02   -3.448473820682047e-01   -2.126072264081891e-02   -2.492745944911214e-01; +1.637428007752613e-01   +6.284783113320751e-01   +7.120200006689476e-02   +6.851927626470445e-01   +1.029415160167253e-01   +2.646397387859097e-01   +6.597713308525904e-02   -5.509931197340555e-02   +4.552995457503570e-01   +6.515644341343221e-01   -1.992648113605505e-01   -5.435015817111467e-01; +1.559670501643759e-01   -3.382827042482133e-01   -7.102600948598413e-01   +6.639404117909369e-02   +2.354779508226863e-01   -1.367579157744254e-01   +1.744241870711985e-01   +6.843499889871898e-01   -2.077326822037577e-01   -1.451366183786829e-02   -3.084650090473277e-01   +3.648062131251092e-01; -4.673723685683888e-01   -9.999491637462291e-02   -5.380086580032482e-01   -6.263150683126160e-01   +4.468339941552708e-01   +3.954176311973031e-01   -1.573428221705800e-01   -7.243565376179524e-01   +2.063233489244949e-01   -6.626203881020429e-02   -2.066839469371893e-01   -4.034206377058125e-03];
L2E_Input1_iAMPA_netcon = [+4.952304431885582e-01   +1.188102625725043e-02   +2.763167029162759e-01   +2.151231104919999e-01   -9.497749979692485e-02   +3.587116102511315e-01   +3.978696855749877e-01   -7.634067555008989e-02];
L2I_Input2_iAMPA_netcon = [+2.023026297719158e-01   +9.618379080346391e-01   +9.574729925491964e-01   +8.042563875431370e-01   -4.997568058660141e-01   +5.043351099660123e-01   -1.687846710470749e-01   -5.190534352672068e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.4*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 1.0*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 1.0*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.4*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 1.0*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 1.0*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
