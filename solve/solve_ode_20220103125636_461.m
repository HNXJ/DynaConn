function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+3.484210961628119e-01   +7.529697453081564e-01   +9.055362148678093e-01   +1.937965893057786e-01   +2.295745209368517e-01   +7.159032024289643e-01   -7.946973841353076e-02   +3.898087000445844e-01   +2.687291118333447e-01   +2.527504546802596e-01   +4.055552652785771e-01   +1.616915975957937e-01   +4.929571675426231e-01   +2.709529851352467e-01   +2.421115530306589e-01   +4.408715487941602e-02; +6.731089381968101e-02   +9.473532350295182e-01   +8.291832047711706e-01   +7.630749037191439e-01   +3.240865470491053e-01   +7.250515099648772e-01   +7.278076719270963e-01   +1.280780776143414e-01   +1.320213681079514e-01   +7.517662277243944e-01   +5.514658686420669e-01   +6.212405163888921e-01   +4.436367488643346e-01   +2.403507905034964e-01   +6.557303251820704e-01   +2.275423669388606e-01; +2.382422451931339e-01   +3.194103731327823e-01   +3.791330110770754e-01   +5.453824789719041e-01   +5.839543577838763e-01   +4.004975346253704e-01   -7.273713885330356e-03   +6.707125700531698e-01   +3.085100659585016e-01   +5.007204288546733e-01   +8.272012898497900e-01   +2.397412994573872e-01   +4.360770943853555e-01   +1.941582010029170e-02   +3.556601764635338e-01   +9.446594418620090e-01; +1.965602014239831e-01   +6.536725228392024e-01   +1.005403207089697e-01   +2.685284587561019e-01   +8.558826781857094e-01   +7.740903989850565e-01   +1.825321394220453e-01   +5.722781473819644e-01   +7.747731215886804e-01   +5.415896391540144e-02   +2.028569650142037e-01   +8.783069729340069e-01   +5.299766975125538e-01   +1.678170695860691e-01   +6.035572844691008e-01   +4.659815513987136e-01; +8.194982067922907e-02   +7.449306180500243e-01   +8.196997236322860e-01   +7.553411337893740e-01   +4.984962771834751e-01   +3.279104768837135e-01   +4.889274987672163e-01   +2.730351976909235e-01   +2.890601808342993e-01   +4.656035791608447e-01   +1.959153974635411e-01   +6.651433238886907e-01   +3.682935971403757e-01   +7.831454466109831e-01   +2.235576343835955e-01   +8.768720268497111e-01; +9.843866923863481e-02   +2.000674538353524e-01   +7.143273567130959e-01   +7.469755180941926e-01   +5.782267180551478e-01   +8.695886413658438e-01   +3.082347097225763e-01   +4.185337534503647e-01   +8.613213127336540e-01   +8.841243615149011e-01   +8.649455603200663e-01   +2.076906168466201e-01   +3.936851947453243e-01   +1.651603131629024e-01   +8.439653734312077e-01   +3.635111832019287e-01; +3.083957983831703e-01   +7.227256784899591e-01   +3.353891853781239e-02   +3.715683253902459e-01   +8.141718790292924e-01   +5.293229175568326e-01   +4.527834978538595e-01   +5.840474991525973e-01   +9.040879098700317e-01   +9.316886828880390e-01   +6.570166050090911e-01   +9.510130860769334e-02   +3.518995662279127e-01   +3.764896696984327e-01   +6.650578878723854e-01   +8.831778829238207e-01; +6.876148498012459e-01   +7.178285514533915e-01   +7.449679654741975e-01   +3.283724715592058e-01   +6.439243914436832e-01   +4.854326801023817e-01   +6.865863481796655e-02   +4.199189029126056e-01   +1.000000000000000e+00   +8.719156440293458e-01   -8.262388745142950e-03   +7.435541371042717e-01   +7.977509061084841e-01   +5.630604488144155e-01   +2.836792643967548e-01   +8.166658151651162e-01; +4.859521132197143e-01   +6.077815445964107e-02   +2.466256093285893e-01   +4.254756255680887e-02   +4.538438488425302e-01   +1.371900746371276e-01   +3.462779741753966e-02   +5.623820760912965e-01   +4.813437150888104e-01   +7.310802500116150e-01   +7.537883763897428e-01   +5.360195675223682e-01   +2.807288472192244e-01   +1.400560939061289e-01   +9.745184545664248e-01   +7.432895827467959e-01; +6.677315320082706e-01   +5.129605902756998e-01   +5.332770296885201e-01   +2.586651644925046e-01   +4.533570274523073e-01   +3.711409092932222e-01   +3.146112958686541e-02   +2.539805920052401e-01   +8.054868869972887e-02   +8.096423113482041e-01   +3.965159872433487e-02   +9.506870858773686e-02   +3.300080735373291e-01   +7.235801130164433e-01   +3.167466942808369e-01   +8.008843807657067e-01; +4.140933906885117e-01   +4.684568881633506e-02   -1.668998766549529e-02   +1.646312255764045e-01   +9.168402745051596e-01   +5.907721603115482e-01   +2.591930587849519e-01   +2.047286323655705e-01   +1.992877163686888e-01   +8.430836629111476e-01   +8.921171444769573e-02   +7.548576536785496e-01   +5.009215003843942e-01   +8.335793558111890e-01   +5.042122566909840e-02   +9.546832827754564e-02; +1.652892346819551e-01   +4.492344667556649e-03   +9.362603591784783e-01   +4.835880195118228e-01   +6.597119259211102e-01   +5.283183032572187e-01   +6.998779652291938e-01   +3.966710977135928e-01   +6.307217682544656e-01   +1.247977581919805e-01   +3.276703136393231e-01   +7.738198688921631e-01   +6.261065631405924e-02   +4.916996419955486e-01   +4.063202637165421e-01   +9.300583732347735e-02; +4.416141078143292e-01   +3.233302008612424e-01   +6.353832944373253e-01   +2.539413018246626e-01   +7.557729534060728e-02   +4.804391933553446e-01   +4.390229504862095e-01   +7.214350843201244e-01   +2.721752587513649e-01   +8.871499273168418e-01   +1.444087556474891e-01   +4.134235089099925e-01   +1.840522269432688e-01   +2.268333828382123e-01   +2.907207029662284e-01   +2.287705125173632e-01; +1.220860184985022e-01   +8.873475609635185e-01   +7.524251192965797e-01   +7.042669890593631e-01   +7.714410564168869e-01   +5.440235877814141e-01   +3.014617123111013e-01   +7.658437538523675e-01   +3.544011592389258e-01   +4.437566439740330e-01   +8.930591659980934e-01   +6.289382299474963e-01   +5.621359116094029e-01   +5.277291442778181e-01   +1.386264016214053e-01   +3.746210884612011e-01; +1.296666145983467e-01   +2.151784434359331e-01   +9.057129452222380e-02   +3.944469740215027e-01   +3.912472439610378e-01   +8.332840742052181e-02   +6.525968339308692e-01   +3.061469909171558e-01   +8.358110805817018e-01   +5.253669476923025e-01   +1.050181050938224e-01   +8.240098061754504e-01   +6.611158778994046e-01   +1.562299427070317e-01   +6.943652966250569e-01   +1.180030030423661e-01; +5.447522312778029e-01   +2.524277587406509e-01   +2.836813553782095e-01   +6.216268934082978e-01   +5.035436758018308e-01   +5.813559783740763e-01   +2.451859897076907e-01   +9.819187538001478e-02   +5.598991147331867e-01   +4.733673494130464e-01   -4.601874987810894e-02   +3.966671339721106e-01   +2.023267954365181e-01   +9.024241888348152e-01   +9.038358051793064e-01   -8.740836047371099e-04];
L1E_L1I_iGABA_netcon = [-6.979906779664208e-02   +2.708441217442114e-01   +8.963997348293867e-01   +2.406844714012547e-01   +4.219834739813881e-01   +1.099439108669002e-01   +2.934102328631660e-01   +5.204554698303719e-02   +2.422522002879012e-01   +4.864009350418171e-02   +4.140404931889651e-01   +9.690637656902290e-01   +1.962891821488928e-01   +8.078786759137404e-01   +9.231166085010094e-02   +4.267069184097668e-01; +7.745888090607468e-01   +7.501949558893517e-01   +5.003876498087219e-01   +8.586509357998167e-01   +7.062373483246388e-01   +8.339120369124531e-01   +6.211168306375393e-01   +8.306619631441926e-01   +9.178439248148434e-01   +9.117575455652123e-01   +1.257106247603522e-01   +1.082202113305422e-01   +5.796078875739412e-01   +9.257850022179495e-01   +1.000000000000000e+00   +2.478816176511943e-01; +3.224262437472991e-01   +8.104845471788581e-01   +9.999276412028027e-02   +1.306606345579760e-01   +1.124122148473017e-01   +2.334871969814338e-01   +5.748024521065720e-01   +1.497410566589851e-02   +3.565031057734010e-02   +1.233528984172017e-01   +5.035101760973197e-01   +4.329650090986550e-01   +8.129185898388003e-01   +8.199566161476910e-01   +8.160083968129516e-01   +7.485042050280908e-01; +3.674764091318720e-01   +5.088789375358895e-01   +5.974270326928631e-01   +7.735233098864843e-01   +6.691331775196950e-01   +6.174872938612045e-01   +5.631357659228654e-01   +8.932568850377192e-01   +5.996806227109318e-02   +2.972791313288871e-01   +5.540570295009741e-01   +2.582278467209373e-01   +8.123156671210389e-01   +3.993629008648621e-01   +9.202287660427966e-01   +5.306144818140270e-01; +7.064204666812475e-01   +5.862401213237718e-01   +8.607578110624705e-01   +3.893834534597264e-01   +9.628316401517650e-01   +5.206576878507703e-01   +3.424035173261956e-01   +4.447831214836860e-01   +3.037721404262889e-01   +5.393492791643136e-02   +1.755452114155544e-02   +6.035321972128006e-01   +9.284337584526114e-01   +8.027477805713886e-01   -5.788670010245312e-03   +1.615176497553924e-01; +2.503489586012170e-01   -3.216287510234159e-02   +3.086650774126456e-01   +2.079846438046302e-01   +2.089439307832491e-02   +4.847206550700209e-01   +8.849777857099485e-01   +2.996704927446149e-01   +5.128695069806666e-01   +4.376772328426445e-01   +8.912800015552830e-01   +2.017132449371799e-01   +2.345694584523818e-01   +1.890556197842096e-01   +7.176940921628278e-01   +4.073920597252017e-01; +7.115369856152236e-01   +5.309874747141108e-01   +3.260747588309788e-01   +8.074739218276161e-01   +2.742252399006848e-01   +8.471096832720131e-01   +6.364300227517655e-01   +5.194695194805515e-01   +8.412278944322396e-01   +6.419866436299304e-01   +8.635067705062657e-01   +2.895503065162313e-01   +8.226405372021041e-01   +6.167249516137639e-01   +9.237381132238246e-01   +7.580351959002519e-01; +9.365339052044227e-01   +1.328087683061341e-01   +5.834299071594835e-01   +4.836766573515719e-01   +6.411763041261459e-01   +1.977248744575467e-01   +3.643257491853321e-01   +5.620709361836311e-01   +1.893240907621780e-01   +8.226536026441750e-01   +7.553136120073518e-01   +8.844729787447303e-01   +2.692994926736663e-01   +7.170063173428656e-01   +4.812672245409467e-01   +6.085226903617831e-01; +5.419023566694232e-01   +9.355023601738890e-01   +3.958793896875840e-01   +9.567310882674988e-01   +2.573672844734766e-01   +6.728565211912062e-01   +5.549999909183491e-01   +9.494157202651540e-01   +8.463103583871808e-01   +9.384723065634960e-02   +1.604807179511131e-01   +2.241188973950836e-01   +8.376791558802554e-01   +3.036199089912505e-02   +9.698085225797683e-02   +4.845648485238813e-01; +2.528898719397394e-01   +3.809687056493180e-01   +5.496232682779436e-01   +2.735819552256320e-01   +8.298147457733284e-01   +4.305916710018747e-01   +2.809469165913418e-01   +8.701762587116135e-01   +9.093563508481046e-01   +8.759071732710738e-01   +8.048531821624125e-01   +9.500775241576931e-01   +5.178332692548077e-01   +4.045344187254972e-01   +3.272123375024327e-01   +7.960056265778512e-01; +1.463228213724217e-01   +2.461747218576588e-01   +7.910811133514430e-01   +8.687147031113017e-01   +2.032981499164155e-01   +6.070917348982073e-01   +5.886556220122355e-02   +4.896175543895153e-01   +4.234427877316551e-01   +6.436125108583797e-01   +3.276048864688632e-01   +9.001625691316312e-01   +1.159742862543783e-01   +4.701809278741245e-01   +4.255742732638298e-01   +4.746114086736105e-01; +1.513351499286036e-01   +9.361694405243712e-01   +7.447104910838891e-01   +4.668694775048379e-01   +4.814240640707289e-01   +3.324751774400712e-02   +1.971052425719363e-01   +3.947784851581210e-01   +1.384102335203645e-01   +5.376529971928959e-01   +2.365302674943618e-01   +4.250392394425584e-01   +3.854781371537311e-01   +9.043633340144296e-01   +3.629586136470869e-02   +4.924594296881568e-01; +9.185848257095530e-01   +1.697192021197967e-01   +4.689112141879246e-01   +5.395010675219086e-01   +6.474682952471448e-01   +5.894867264108864e-01   +2.182372832113716e-01   +5.208358374150373e-01   +4.583238781263275e-01   +3.506049386724716e-01   +9.402153638445738e-01   +9.672804055602304e-01   +8.324224006456654e-01   +5.927287447336105e-01   +2.491922438551968e-01   +7.740143050362260e-01; +4.378493049164569e-01   +8.489188104236205e-01   +3.044564427842547e-01   +3.874284900382429e-01   +7.429612728715627e-01   +1.962635753701684e-01   +3.506638866523137e-01   +6.088283071126266e-01   +3.482413033013610e-01   +4.473683183828919e-01   +2.097262883014506e-01   +1.772951252052410e-01   +2.829159938481513e-01   +2.455265242735605e-01   +6.122901457405836e-01   +8.989109546432240e-01; +6.165554615580384e-01   +5.906665013056437e-01   +6.934574644090364e-01   +7.220982833526877e-01   +7.617332887509253e-01   +8.583129482616285e-02   +8.389926826889169e-01   +2.995500377800703e-01   +8.444411798628682e-01   +4.931872094085019e-01   +7.112675975328280e-01   +5.363912453287614e-01   +2.581418408305852e-01   +4.657710489112855e-01   +8.646713799917602e-01   +4.901279342459082e-01; +3.819128014919080e-01   +5.948748094799211e-01   +6.444761553167364e-01   +2.415104229816990e-01   +4.779372443183687e-01   +3.324329566568432e-01   +5.328741209607497e-01   +2.599422109311514e-01   +8.251053032544550e-01   +3.000235707629877e-01   +2.611883828216294e-01   +1.248154930264626e-01   +7.148754666613698e-02   +4.807458387396603e-01   +9.366739866786974e-01   +9.383144299208189e-01];
L2I_L1I_iGABA_netcon = [+6.588750710786800e-01   +4.479879796044826e-01   +7.345839545460133e-01   +5.491374436103829e-01   +9.436359046182571e-01   +6.603134928483722e-01   +9.182035922970071e-01   +5.771522025704540e-02; +5.051855322925221e-01   +9.069885902254281e-02   +2.134616413709686e-01   +9.114261911219610e-01   +1.898737096937756e-01   +8.034032751093241e-02   +8.491347493854758e-01   +6.953960870335906e-01; +9.745609405028137e-01   +5.317305464833180e-01   +6.339649260272485e-01   +6.327460196835090e-01   +8.108364335187500e-01   +7.033696348112005e-01   +3.107126941191958e-01   +2.192131951799355e-01; +3.504344581940085e-01   +1.517702774519414e-01   +8.789637176812066e-01   +3.995582650346363e-01   +7.576028104770505e-01   +3.205231598994925e-01   +8.753042455971048e-01   +2.107611484154895e-01; +7.167793167377088e-01   +4.502155146797574e-01   +6.619345262453168e-01   +2.752538319748967e-01   +9.144243583588643e-01   +3.557437193354233e-01   +5.540892219057429e-01   +2.236160762046191e-01; +5.539125666859117e-01   +5.836829243856029e-01   +7.390638639771698e-01   +1.898394951140654e-01   +1.832409723778778e-01   +8.033278817781568e-01   +9.118125686067370e-01   +5.861777950430049e-01; +8.647529226854430e-01   +4.680551972357677e-01   +2.109764950541143e-01   +2.655614742895918e-01   +7.305658380046887e-01   +1.802712363044790e-01   +6.180925401634855e-01   +3.491639099355198e-01; +9.393939121837650e-01   +4.182433716858623e-01   +6.232311993628297e-01   +9.083889864573488e-01   +1.079477494877015e-01   +4.110240661354756e-01   +4.681269216855853e-01   +2.522328419855487e-01; +7.230720930100342e-01   +1.806891609452654e-01   +4.674881811823135e-01   +2.790782862168032e-02   +7.633314153913990e-01   +3.790646967779758e-01   +7.671525776502616e-01   +7.297021585582898e-01; +4.654504098599585e-01   +8.403978457973634e-01   +6.646789083148481e-01   +8.224602921196792e-01   +3.934011061666057e-01   +8.271446222536282e-01   +8.774177636511431e-01   +2.357160576304385e-01; +5.283631746356149e-01   +5.914372366544259e-01   +4.646058647948560e-01   +3.921707744933254e-01   +6.096870918628244e-02   +8.637437119729219e-01   +6.289577938479137e-01   +4.405096308384564e-01; +1.960755075157212e-02   +3.855798702682018e-01   +3.532500617141903e-01   +4.381945248159588e-01   +3.547789371467441e-01   +5.163724034444548e-01   +2.769261553469823e-01   +5.146792511517478e-01; +3.901444028547522e-01   +1.808628452620811e-01   +6.325291844096662e-01   +7.403547153121065e-01   +2.052361575359796e-01   +6.626793248711875e-01   +3.797460889674996e-01   +7.337370315962004e-01; +4.723522131199500e-01   +4.584857800080598e-01   +6.853227960657802e-01   +3.664944309920166e-01   +8.136977814148869e-01   +4.157847871804626e-01   +3.722070036339032e-01   +3.104116801060313e-01; +5.844917245256279e-01   +1.697198183800918e-01   +2.654032649405923e-01   +2.550387764978695e-01   +5.871491295735290e-01   +5.580040555063184e-01   +3.048381714804306e-01   +6.907554782257227e-01; +7.647235248706137e-01   +7.361590055332697e-02   +7.117671745985068e-01   +2.786931265320128e-01   +3.693640640450098e-01   +6.199516721064432e-01   +1.152725932718032e-01   +2.684462987887843e-01];
L1I_L2I_iGABA_netcon = [+5.117245812069942e-01   +1.898121924262835e-01   +7.724086455039889e-01   +3.004569020431990e-01   +5.496171213572010e-01   +2.695029327645835e-01   +8.728460708837802e-01   +2.212088799928982e-01   +5.682868739203696e-01   +8.675387386730531e-01   +3.776096035796722e-01   +4.102907979632826e-01   -2.539206512396797e-02   +7.366170052292133e-01   +6.242764137320270e-01   +4.782178701694108e-01; +2.739494312490023e-02   +1.246642840094340e-02   +3.068347987154599e-01   +2.685695243320051e-01   +8.681818385551010e-01   +3.383620420772950e-01   +3.588194243790763e-01   +1.205833106866972e-01   +4.487526366023947e-01   +2.621876485763054e-01   +2.997626773467166e-01   +2.720177694331011e-01   +9.338211536486929e-01   +2.032804689734601e-01   +8.087816212740756e-01   +2.407277002327951e-01; +3.991625959898908e-01   +6.461001687986218e-01   +3.322320295065283e-01   +7.059380902564144e-01   +2.501587191810227e-01   +5.386337873396377e-01   +7.522259538258677e-01   +1.023234669481542e-01   +7.450504193023034e-01   +4.827921670331040e-01   +6.047803426478300e-01   +8.361331230076436e-01   +9.579764228803285e-01   +6.688035568415545e-01   +3.505794917917626e-01   +1.594139635154294e-01; +8.324849824561213e-01   +1.015202637369884e-01   +6.573862566618796e-01   +9.125425756524801e-01   +4.727309149574221e-01   +9.029547442545408e-01   +6.444199737897489e-01   +3.993627306683795e-02   +6.817820468515060e-02   +3.218857151147561e-01   +4.302360397067590e-01   +4.683304754205006e-01   +3.619849747122406e-01   +5.138321624076176e-01   +1.605380809169317e-01   +8.410330105606356e-02; +9.589959431575968e-01   +7.622149916064516e-01   +7.204533497269200e-01   +6.468382114356034e-01   +3.106023577731166e-01   +6.519488533827758e-01   +6.760234523920815e-01   +6.000139952440865e-01   +9.873010932222245e-02   +6.746239563782358e-01   +1.979176362877418e-01   +4.456209079618340e-01   +4.548200367389417e-02   +1.884504985251051e-01   +7.219178301587036e-01   +9.549378138493579e-01; +5.672748874622215e-01   +3.978987646539391e-01   +1.223987338795834e-01   +3.584055933986567e-01   +9.345806936365175e-01   +1.439193131932018e-01   +7.249414464493212e-01   +6.104993394027615e-01   +5.381406864542619e-01   +7.068839888079596e-01   +3.514673413886965e-01   +5.216189321883359e-01   +9.062347362648087e-01   +6.272820492935319e-02   +1.984769459000149e-01   +5.606398395936190e-02; +8.304299723040782e-01   +1.409289867712281e-01   +3.832778059165590e-01   +3.138999217085112e-01   +5.597575725932994e-01   +8.627027072890164e-01   +7.757068729333921e-02   +2.109721672554211e-01   +6.970412050363197e-01   +8.807279836819707e-01   +9.055807372657021e-01   +8.552364587314508e-01   +1.227678324269635e-01   +2.736250160880412e-01   +6.384935773233343e-03   +6.118470148039588e-01; +8.940115114465301e-01   +3.872390711905030e-01   +3.940894368098399e-02   +8.875552514361015e-01   +1.769652021988142e-01   +9.580248474579627e-01   +7.783266364705728e-01   +9.727583859158097e-03   +8.095645803008538e-01   +6.125403097315264e-02   +8.960985596599953e-01   -2.691468806350178e-02   +8.260619404508539e-01   +6.464106163834471e-02   +1.000000000000000e+00   +6.772554364390700e-01];
L2E_L1E_iAMPA_netcon = [+2.987517879746946e-01   +9.271955531966740e-01   +6.259181327460088e-01   +5.030880871958453e-02   +3.147131516862691e-01   +3.798721373099810e-01   +9.500941957155534e-02   +6.398314509256734e-01; +2.163279089460784e-01   +1.666370272564950e-01   +7.729224100565226e-01   +8.683050950326052e-01   +3.252302152741242e-01   +5.084755907146271e-01   +2.536322083776880e-01   +1.102948433721884e-01; +4.793992630118969e-01   +9.107519246271444e-01   +8.043233641771729e-01   +4.585640778168998e-02   +6.709311277181303e-01   -1.055033951902678e-02   +4.591464109215766e-01   +8.427281966870822e-01; +4.910640565304359e-01   +6.322059152983787e-01   +6.468261086925675e-02   +5.839776060570878e-01   +3.073825892193849e-01   +5.399673979206243e-01   +1.972899002315377e-01   +4.818292205642070e-01; +9.064746634054740e-01   +7.051027828163210e-01   +7.724921793156271e-01   +5.092770121332342e-01   +7.628732677770633e-01   +3.836951940008192e-01   +4.546401178211028e-01   +4.960453168767139e-01; +4.812989594150943e-01   +7.029977278244857e-01   +3.371389525813659e-02   +5.951847406609522e-01   +6.694577167480509e-01   +8.468312044829613e-01   +3.098339914356861e-01   +5.546987590287070e-02; +4.309548788046650e-01   +3.018687582750009e-01   +2.052154898444830e-01   +4.282516681914099e-01   +4.168666427880504e-01   +2.347842086353236e-01   +6.035182970472032e-01   +2.879311553284889e-01; +7.242451126936582e-01   +1.582997449679197e-01   -6.055436101965142e-02   +9.895873092210830e-01   +5.156095224760530e-01   +3.812848381740419e-01   +5.960611889143060e-01   +6.061221425534995e-01; +7.640891711495041e-01   +6.069036486311087e-01   +6.738489076894673e-01   +1.425911833625947e-01   +4.399295314338316e-01   +2.458316595266175e-01   +5.337408799234955e-02   +9.992128099170440e-01; +5.067450122822385e-03   +1.249977122589723e-01   +1.723931091630526e-01   +1.741562735503144e-01   +1.726756235781058e-01   +5.613455948144886e-01   +8.438898669861752e-01   +8.146530810223935e-01; -1.100991636190298e-02   +2.243989604913943e-01   +5.415470668408230e-01   +4.957409123898743e-01   +1.030703423664091e-01   +4.325199735316851e-01   +1.725585812496206e-01   +7.293690596261162e-01; +3.595455370104012e-01   +5.634530772187373e-01   +6.378232684516235e-01   +5.074292100511474e-01   +7.084782288042599e-01   +2.956070173600636e-01   +6.689399867359500e-01   +4.357921889431673e-01; +6.976287777502840e-01   +7.029423916536491e-01   +6.177915539107005e-01   +2.553570417358341e-01   +1.944965355960108e-01   +1.063786473993772e-01   +4.122285945708886e-02   +5.363482296817383e-01; +7.245871455193537e-01   +8.092218813622899e-01   +5.129064646425508e-02   +9.170270005611645e-01   +4.893051656304612e-01   +8.051856412153224e-01   +2.013913441292997e-02   +2.150514065345672e-01; +9.360421076308503e-01   +2.349589993426084e-01   +4.745851537629038e-01   +5.424937221606519e-01   +3.478800711077651e-01   +2.278693722461631e-01   +5.960927926439039e-01   +3.758371169902231e-01; +8.411088633157876e-01   +6.503985000030564e-01   +7.234880588937660e-01   +3.716643308291725e-01   +5.049679385418748e-01   +8.586101530272537e-01   +7.524983134801148e-01   +1.232588567895959e-01];
L1E_L2E_iAMPA_netcon = [+8.760446140474740e-01   +4.840476572797197e-01   +5.889067992666911e-01   +1.499275172702713e-01   +9.556651280031608e-01   +2.927982151758401e-01   +5.447714678025635e-01   +4.922678017349100e-01   +8.895322340527931e-01   +5.135691713331887e-01   +6.412226509277563e-01   +4.564841941313466e-01   +5.314472037493343e-01   +3.497267708419239e-01   +5.763054961632872e-01   +2.653933403733379e-01; +7.581671178335548e-01   +1.689330984064925e-01   +9.287315101823787e-02   +5.472369991713351e-01   +7.882051192588323e-01   +5.785739396077952e-01   +8.780172918430631e-01   +2.279467308272749e-01   +3.742236060780869e-01   +3.177096833381366e-01   +6.880946898785073e-01   +6.500805150875165e-01   +6.917567588055997e-01   +8.806979152169012e-01   +3.813257017858510e-01   +5.312299976529178e-01; +7.617706714579253e-01   +1.165895115627579e-01   +1.681256092171040e-01   +1.000000000000000e+00   +1.960385502244818e-01   +3.817925329385018e-01   +8.662885450729780e-01   +2.892829766185078e-01   +1.943869534226927e-01   +5.996598972374855e-01   +7.582496374438739e-01   +4.750625942938559e-01   +8.072912460269497e-01   +9.336533822856712e-01   +8.129557974926621e-01   +6.167008514960572e-01; +6.800877485231855e-01   +4.747113838109807e-02   +5.471559100757859e-01   +3.365176370343688e-01   +4.316982265410393e-01   +8.191363076966831e-01   +2.022482178689868e-01   +1.420723268637222e-01   +5.731753419639014e-01   +4.535380453581718e-01   +3.905370833117267e-01   +9.211147691092352e-01   +7.039444856239014e-01   +1.489979824650386e-02   +7.451792836458404e-01   +7.979586301468355e-01; +3.628055838093242e-02   +2.175322387869903e-01   +1.561931128616352e-01   +7.431688377295302e-01   +1.823497649583818e-01   +4.633392661343597e-01   +9.690072661769206e-01   +3.102232419951946e-01   +7.222514299866438e-02   +7.411007650709074e-01   +7.419595135290380e-02   +5.109361862371622e-01   +7.778143161390277e-02   +6.128213649689145e-01   +4.050201605552607e-01   +1.278365610747803e-01; +6.190435922349967e-01   +4.512828233882163e-01   +3.897417724317658e-01   -1.076806894590753e-01   +8.873549180888627e-01   +1.244417357560108e-01   +4.597254698479819e-01   +1.607729343833241e-01   +7.095938827097555e-01   -1.620134170009451e-02   +7.507759428923453e-01   +6.336872422349238e-03   +7.220779247976405e-01   +5.083876182437710e-01   +7.186013264376425e-01   +3.150087852012454e-01; +2.522334277955218e-01   +6.493465690730413e-01   +3.427876117648994e-01   +4.031888300978848e-01   +3.379344696393509e-01   +8.741040357578775e-01   +8.824508540111391e-01   +4.265259375709281e-01   +6.602729125843942e-01   +7.599577526589031e-01   +7.512950116357177e-02   +1.350979413446451e-01   +1.246595861421316e-01   +3.952859857032920e-01   +3.174140303180752e-01   +7.449915848003116e-01; +1.556553354559589e-01   +4.223617598778975e-01   +2.703387093381759e-01   +4.608360463183856e-01   +9.399200019888628e-01   +4.707681591399984e-01   +9.522602465610022e-01   +8.336103608964104e-01   +3.804431566791900e-01   +3.834840382660439e-02   +3.947536698810675e-01   +3.868262320213084e-01   +3.311677659083967e-01   +6.935080228703573e-01   +8.155871229680740e-02   +5.063482691094863e-01];
L2I_L2E_iAMPA_netcon = [+3.381437867670337e-01   +2.731594016188713e-01   +3.363413685328904e-01   +5.906687884322047e-01   +1.721187092612245e-01   +8.172018438644206e-01   +6.848736924356025e-01   +2.523918612860047e-01; +4.814550201907202e-01   +1.692281564375412e-01   +6.709342531993260e-01   +2.725385809678179e-01   +6.726039708640668e-01   +8.064799115077224e-01   +6.378923912428280e-02   +4.751074861695184e-01; +6.522949138046961e-01   -7.569725783836483e-03   +7.060601012451455e-01   +5.896841447387460e-01   +1.413981255857031e-01   +5.920174397571774e-01   +7.444485492405531e-01   +8.681036649096067e-02; +5.073691203261360e-01   +2.659987414899937e-01   +7.234995481103527e-02   +9.445953648919928e-01   +3.644552247199203e-01   +6.317854572782806e-01   +1.000000000000000e+00   +1.689850444325085e-01; +1.555026414600444e-01   +4.446247581980122e-01   +4.545363553775221e-01   +8.292685503336132e-01   +8.573045074291669e-01   +5.622550140575968e-01   +7.337375569528681e-01   +2.569229705948195e-01; +9.025625638291067e-01   +5.201452205932080e-01   +8.786809075542179e-01   +8.950815619403969e-01   +6.672352806628343e-01   +8.515014910236116e-01   +8.557536052782098e-01   +4.944045687862705e-01; +1.277495901967003e-01   +5.656680133121936e-01   +8.862512044454378e-01   +8.656619086495941e-01   +9.908150628659357e-02   +7.432518218031366e-01   +2.535412715007608e-01   +1.285248513287245e-01; +5.829691029887422e-01   +3.925422174076270e-01   +1.522154009037719e-01   +2.756649326281205e-01   +7.346468954944279e-01   +3.997730412903814e-01   +9.688197049918323e-01   +6.088250380990876e-01];
L2E_L2I_iGABA_netcon = [+4.329717833118304e-01   +5.951084264423729e-01   +5.936155671518699e-01   +7.459159443566872e-02   +4.445998615476968e-01   +4.809764918165331e-01   +3.013058219845586e-01   +7.169593523122165e-01; +4.165520746359054e-01   +3.470605494390441e-01   +2.515336037657201e-02   +4.906213697930201e-01   +4.494453745087799e-01   +6.215022247389069e-01   +4.976920219092951e-01   +4.486008806233353e-01; +5.656249290890023e-01   +5.215109189668197e-01   +3.882730479986793e-01   +5.783433534944454e-01   +3.116980057994120e-01   +2.890412733853420e-01   +1.654621680301446e-01   +9.831362874113685e-01; +7.419103273111223e-01   +5.649840497366778e-01   +3.818025378482190e-01   +8.745908107358195e-01   +2.133729942221567e-01   +5.031282434592750e-02   +1.483607476504897e-01   +3.769972149703550e-01; +5.082375074722029e-01   +7.829866969267886e-01   +4.893613936112130e-01   +7.851900350980975e-01   +3.683874602298615e-01   +6.891653846042849e-01   +6.200379956090754e-01   +3.695423294759306e-01; +4.054660645980635e-01   +2.656545194358337e-01   +4.249216307827993e-01   +3.880943244218941e-01   +7.725366064252756e-01   +8.240701982371440e-01   +1.062505877335052e-02   +4.482524386477654e-01; +4.089514572877525e-02   +4.788592188037996e-01   +8.189202076996205e-01   +5.886757555871096e-01   +4.777501450971351e-01   +4.014009246729605e-01   +8.924087017168164e-01   -5.919971579799641e-02; +8.823295201607875e-01   +5.437877469477412e-01   +8.710352056560468e-01   +4.647175753691739e-01   +8.932870399071773e-01   +5.288150168779465e-01   +3.451773538487310e-01   +3.420699864009064e-01];
L3E_L2E_iAMPA_netcon = [+2.723381824896131e-01   +9.036023431242379e-01   +4.657048220179804e-01   +7.796031260054184e-01   +1.649779984601302e-01   +4.091925729495784e-01   +3.716251493406710e-01   +9.704274709138112e-02   +1.562426488599784e-01   +5.558786258887223e-01   +1.505675343025305e-01   +4.816822994259223e-01; +3.055359293126667e-01   +4.745885311368270e-01   +1.524458119590802e-01   +1.815784427983115e-01   +6.074081189524824e-01   +9.114392019017780e-01   +6.847151576664775e-01   +5.556602829884756e-01   +2.446176511320825e-01   +5.175232415795126e-02   +1.141588972997192e-02   +8.195924164553567e-02; +7.970859456227328e-01   +3.580434813359342e-01   +5.421876322549222e-01   +1.433773275854135e-01   +8.725645123115791e-01   +8.938276892741772e-01   +5.347331242360290e-01   +5.994738811265832e-01   +7.400747007334263e-01   +3.725494052575540e-01   +4.128175551911662e-01   +8.909975949086919e-01; +1.712228084644470e-01   +4.877976469441368e-01   +1.796772643818099e-01   +7.998973803320160e-01   +4.906384926806909e-01   +5.779612346654006e-01   +8.910683522376259e-01   +2.984040672461468e-01   +8.376752259212861e-01   +8.332040395715096e-01   +4.628705889199722e-01   +1.809666131427767e-01; +2.231527395032376e-01   +7.641321379360523e-01   +4.192705869653135e-01   +3.011145680382785e-02   +2.271866979472263e-01   +9.739107542532029e-01   -1.147995962454377e-02   +6.596901872774058e-01   +6.931025339055893e-02   +8.668156309396233e-01   +2.750650801498083e-01   +2.324068809344940e-01; +3.489583307485179e-01   +4.200560911704312e-01   +8.383846724186120e-01   +9.958063637780024e-01   +3.953524406606657e-01   +9.241831304686321e-01   +8.970777630669736e-02   +3.731684403541241e-01   +5.079275772520681e-01   +8.384576627605801e-01   +5.833152250682906e-01   +8.849649502389396e-01; +1.840417513700895e-01   +4.719481074815915e-01   +5.627728042540081e-01   +9.804113079474129e-02   +6.229673559347082e-01   +5.082837342305064e-01   +7.926274639699424e-01   +1.254167744368580e-01   +4.387876375239537e-01   +4.387354846357678e-01   +9.815987233812203e-01   +7.375216920485801e-01; +6.064101772123009e-01   +1.089919398973637e-02   +4.023543957334905e-01   +1.599781436970403e-01   +3.942106324958766e-02   +8.831580224868126e-01   +4.192487566460535e-01   +4.418405472804910e-01   +8.577272498640898e-01   +9.970204617008789e-01   +9.686904516569508e-01   +2.993746906408447e-01];
L3I_L2I_iGABA_netcon = [+3.852472676335202e-03   +4.568954042574505e-02   +1.203594827760855e-01   +6.606804771380135e-01   +3.226360085639438e-02   +4.954372612357975e-01   +8.249080801719155e-01   +3.749848980097997e-01   +4.317923069151068e-01   +9.643456612931723e-01   +8.423750644822529e-01   +6.098272224658293e-01; +3.814024397274292e-01   +4.242880317426353e-01   +2.839278413437309e-01   -2.435816698626611e-02   +4.517524344852681e-01   +5.942403468164386e-01   +4.567745474117595e-01   +9.007731992711264e-01   +1.544893466303217e-01   +9.142267007162007e-01   +2.751097155008052e-01   +6.658687110766176e-01; +3.674590994543506e-01   +6.599793988300485e-01   +2.949243759834327e-01   +7.777624393529848e-01   +3.334905834651823e-01   +8.625128950039367e-01   +9.758983757870504e-01   +1.034588555298304e-02   +6.884244284533744e-01   +4.652883907382391e-01   +1.354908462184389e-01   +5.637509785241037e-01; +6.342374282822471e-01   +9.925621412892984e-01   +2.994759909590352e-01   +2.770357065842676e-01   +1.662181347487615e-01   +5.859302292701242e-01   +1.628908886458925e-01   +2.387372721943174e-01   +5.619215119943112e-02   +3.333956237229830e-01   +5.182559013735210e-01   +8.033128765217331e-01; +9.858210294722881e-01   +1.233523894782095e-01   +4.790490377666020e-01   +8.393837272411196e-01   +5.077835351782574e-01   +9.080917343497275e-01   +8.454441449254098e-02   +5.378002555026141e-01   +5.694985362798461e-01   +7.941500104125340e-01   +7.595435756946255e-01   +5.299688743998766e-01; +9.478563202002854e-01   +1.781878338110818e-01   +1.610130899537354e-01   +7.667758811117352e-01   +9.397655618237523e-01   +7.731899971881170e-01   +9.405326632386254e-01   +5.629845114415917e-01   +1.152784708029661e-01   +8.333477819602111e-01   +3.224193790273836e-01   +5.634546100155917e-01; +8.796047865359165e-02   +5.224864658040490e-01   +9.511940992433033e-01   +5.670865668651187e-01   +9.728721837652861e-01   +7.822437653792490e-01   +8.676535224672962e-01   +7.947215411836061e-01   +6.169459888366202e-01   +4.097601935163633e-01   +3.364150127730404e-01   +5.688873309601611e-01; +3.386365121950261e-01   +1.128657317725024e-02   +7.777820264300925e-01   +1.977276897621117e-01   +4.490629782486890e-01   -7.715700371691949e-03   -2.622010646747114e-02   +9.563761843659638e-01   +5.042868110354363e-01   +7.726784564233399e-02   +7.222586835592181e-01   +7.135583321143753e-02];
L2E_L3E_iAMPA_netcon = [+9.237339359325947e-01   +2.424357135137896e-01   +5.794143932917964e-01   +7.140923493244753e-01   -1.286225429696704e-02   +7.257933889605902e-01   +7.976400188035122e-01   +1.070912983793464e-01; +3.208160546464622e-01   +5.518250892300260e-01   +6.803022379125031e-01   +7.072908929279094e-01   +2.625995348787018e-01   +2.005781136941290e-01   +8.034596960037896e-01   +8.608172947821983e-02; +6.245313792144506e-01   +5.109788166845640e-01   +8.766227696970844e-01   +6.116749955159008e-01   +8.918370189583801e-01   +4.440472920572455e-01   +9.786992997184221e-01   +4.436384721506360e-01; +2.317834233780758e-01   +9.175398913439546e-01   +8.521989047696313e-01   +4.067572802068001e-01   +4.238827033567487e-01   +9.764816745874225e-01   +2.656557414369945e-01   +5.007118219173763e-01; +9.450417094231890e-02   +2.017197282776436e-01   +7.225149146815930e-01   -3.335834325589986e-02   +1.887709969965578e-01   +5.290564353038107e-01   +4.528542522314190e-01   +6.457171341716741e-01; +4.167491308009866e-01   +8.029976320764608e-01   +1.645173960566935e-01   +7.728125174559075e-01   +8.952157477754938e-02   -6.088228001285109e-02   +4.989831851508304e-01   +2.907361635962341e-01; +4.827066394353761e-01   +7.568621202860172e-01   +7.884557813716526e-01   +2.663024521591664e-01   +8.286124383781244e-01   +1.946436416764913e-01   +7.423584289884158e-01   +9.275786006252904e-01; +2.070885593468658e-03   +5.304796318777106e-01   +8.973936941768852e-01   +4.730994886869385e-01   +7.310571270058608e-02   +7.349389764834836e-01   +9.836103565650156e-02   +3.089079012937614e-01; +9.640273976773650e-01   +9.020408605372927e-01   +8.631582245761002e-02   +1.602828110373705e-01   +8.532473103451481e-02   +8.728760635650656e-01   +2.716421988254485e-01   +9.274793470789955e-01; +1.314189751065577e-01   +3.900590927606799e-01   +8.042606251412765e-01   +3.197692504343171e-01   +4.358924229839279e-01   +8.719240664876294e-01   +3.504158270821656e-02   +9.162924425561337e-01; +6.840898310219568e-01   +3.676648292461174e-01   +2.802182020289780e-01   +2.556516778115037e-01   +1.781644060967172e-01   +3.196890873647198e-01   +2.112400267718103e-01   +9.803965608884439e-02; +1.257874956981771e-01   +6.272288811177322e-01   +8.238698250773189e-01   +4.242667728569367e-01   +2.101029019155721e-02   +7.407893500757478e-01   +7.725753098154939e-01   +7.876549614323858e-01];
L2I_L3I_iGABA_netcon = [+3.616602666380176e-01   +6.390585323980551e-01   +2.605455589019535e-01   +6.636988357388808e-01   +5.070379092444520e-01   +4.209308203169149e-01   +3.902493445509514e-01   +4.808345429755207e-01; +3.411936281502325e-01   +1.167534180755347e-01   +2.355264132404549e-02   +8.435519565655788e-01   +6.846877232300785e-01   +6.157648681654658e-02   +8.288544202033067e-02   +6.172363902252063e-01; +3.258445096477068e-01   +6.168409026321509e-01   +4.094573241703919e-01   +1.040283870826403e-01   +8.320401668974347e-01   +6.317905694995259e-01   +1.794173909844625e-01   +1.345551158927472e-01; +6.204982085292250e-01   +8.173928777401152e-01   +5.680800973739836e-01   +4.502928209579501e-01   +5.135912918680472e-01   +6.652771251833202e-01   +3.909419217127085e-01   +6.564074771898630e-01; +3.005940532792867e-02   -6.231806407873677e-02   +9.859060433603739e-02   +6.742377766952015e-01   +1.982925464865417e-01   +6.277772870873815e-01   +4.527227536924814e-01   +2.602923964063211e-01; +5.268296814216056e-01   +3.937505237240572e-01   +4.022127630691570e-01   +6.660176576671600e-01   +2.276602936861495e-01   +8.249452983534015e-01   +4.080037042738623e-01   +1.091310724409640e-01; +2.144370662722824e-01   +3.506606920392199e-02   +4.144168569422235e-01   +9.935210586095112e-01   +6.640480628002225e-01   +6.268115084046255e-02   +2.594769504801180e-01   +8.668771497302299e-01; +2.205411215618208e-01   +9.266797636423443e-01   +9.192048500282020e-01   +9.163411982043163e-01   +4.892786451623357e-01   +1.084667494722448e-01   +7.127830347647713e-01   +1.499096966263324e-01; +3.294750978759587e-01   +5.476526733647694e-01   +2.479135763061174e-01   +1.886859597755612e-01   +3.967309375268173e-01   +2.422196598753850e-01   +5.787065264764670e-01   +4.514013964715007e-01; +3.790508179519571e-01   +2.039424004357312e-01   +1.968367473823982e-01   +4.033672946424157e-01   +9.257686526810118e-01   +5.057784571814585e-01   +4.460652725616920e-01   +9.249620016811372e-01; +6.058456269296801e-01   +9.096438860578214e-02   +3.141769213852822e-01   +5.348171665565200e-01   +4.996034811520809e-01   +6.732089825915937e-01   +9.100739712337983e-01   +6.196770568833299e-01; +3.728986421290215e-01   +1.824925858091861e-01   +6.108188012117409e-01   +3.086709114497710e-01   +1.302107623532378e-01   +5.047404797151630e-02   +3.041982196077808e-01   +6.583687400090097e-01];
L3I_L3E_iAMPA_netcon = [+1.365903766518784e-01   +6.759632150321825e-01   +7.405306232205962e-02   +1.773149089256498e-01   +2.706268965617644e-01   +6.088647552961359e-01   +7.602985718840480e-02   +3.389019558109869e-01   +5.261421593851515e-01   +3.479263361798021e-01   +6.401789496776714e-01   +9.103091710238873e-01; +4.110648265250226e-01   +8.439580699323487e-01   +2.610121909377682e-01   +3.389925301736751e-01   +7.292989637118487e-01   +4.459549995081004e-01   +4.153112315972994e-01   +3.853183651042547e-01   +6.466915193382430e-01   +2.802501428871411e-01   +6.896178962141477e-01   +1.824515338715192e-01; +4.832154710666690e-01   +3.629300912337161e-01   +7.834256495784823e-01   +8.724921428282781e-01   +5.722882997561884e-01   +6.199956664632885e-01   +9.855664112380251e-01   +4.306819824491649e-01   +2.220705346372141e-01   +3.312971174814674e-01   +9.589952160303037e-01   +8.429703548863824e-01; +4.870690571719198e-01   +1.276609975426952e-01   +5.317833163884919e-01   +7.343827797328515e-01   +4.357613864863731e-01   +6.039250163250334e-01   +5.547607912272097e-01   +7.079421804112763e-01   +4.965294538821447e-01   +2.093780403587893e-01   +4.307445441797060e-01   +4.944302086319936e-01; +9.264059691325643e-01   +8.329554463882892e-01   +5.833754086520976e-01   +5.261786567985456e-01   +2.741291817408915e-01   +2.885425607919320e-01   +2.772064944920639e-02   +2.269507042265699e-01   -1.195638134594032e-02   +2.641022234164166e-01   +7.285726128191668e-03   +5.488356498131988e-01; +3.860138731482681e-01   +2.043808465122452e-01   +6.578512717461887e-01   +4.585622633857698e-01   +9.636320216148848e-01   +6.393334978475121e-01   +3.026847524197266e-01   +8.255567422032668e-02   +2.054120420949742e-01   +5.955444305243616e-01   +3.253931127050523e-01   +1.135008129079955e-01; +4.638976378637280e-01   +2.378440410275724e-01   +8.489397867282080e-01   +8.721810139871466e-01   +1.285252911151941e-01   +2.873350894090660e-01   +4.071752047370271e-01   +1.557254711051511e-01   +9.120486959018713e-01   +7.012152448051385e-01   +3.141808160364720e-01   +5.960944866642653e-02; +3.944842909022955e-01   +4.069409174807667e-01   +2.962663633388776e-01   +6.099250478389729e-01   +8.475684443343737e-01   +2.616694040807940e-01   +3.911209963537200e-01   +3.100848508175842e-01   +2.932525441461252e-01   +2.693737136566072e-01   +7.067643272893492e-01   +5.800780508147119e-01; +2.974015768874046e-01   +5.089746075529145e-01   +4.002564995809898e-01   +5.742390422369099e-01   +5.747164098115405e-01   -6.060694316255398e-02   +6.188777581165528e-02   +4.105363319687636e-02   +2.993392611727088e-01   +1.916068697876927e-01   +8.696372635379128e-01   +8.985346315686247e-01; +7.165023825501896e-01   +5.567361001116253e-01   +6.054542061619725e-01   +4.361195050327468e-01   +4.656818781096457e-01   +4.315148933640717e-01   -5.966144367912653e-02   +6.634432372800410e-01   +4.086770461347433e-02   +8.886430003164004e-01   +4.563943608519222e-01   +1.155181888052867e-01; +4.484481390203194e-02   +2.853310841519844e-01   +6.350911301274168e-01   +2.724245126765108e-01   +4.412105402875228e-02   +5.340102958016338e-01   +9.403402980679940e-02   +7.630113396637931e-01   +6.935272148277367e-01   +1.453395257807139e-01   +6.690834013189535e-01   +3.232080462703382e-01; +6.343081075141251e-01   +6.800398002031368e-01   +4.058308169203232e-01   +6.182307531806861e-01   +6.726447489134684e-01   +3.661408127461929e-01   +2.816515562847650e-01   +8.047416693021141e-01   +5.968133191058641e-01   +3.935904754239812e-01   +5.190232137589986e-01   +4.223999876482687e-01];
L3E_L3I_iGABA_netcon = [+3.256128689853429e-01   +7.032738672981279e-01   +6.153595087312357e-01   +8.591655051006378e-01   +4.729455228232957e-01   +9.466662776383998e-02   +2.238625415616029e-01   +6.952118769411322e-01   +7.292249400059589e-01   +2.526536236233003e-01   +4.629612597509212e-01   +3.055693964413888e-01; +8.196536703872515e-01   +3.639180593655092e-01   +5.970208217805208e-01   +9.564275713071065e-02   +8.282622165729280e-01   +4.319016297171470e-01   +8.079782086164500e-01   +6.474940539666411e-01   +5.859935801322443e-01   +7.185321745712010e-01   +2.503293984709757e-01   +4.473099506645580e-01; +7.792628576398892e-01   +3.496751834357431e-01   +4.187875413269010e-01   +4.761900711368570e-01   +5.762878189860587e-01   +5.249771108068075e-01   +2.090140203523480e-01   +8.379285729903785e-01   +5.173470598022611e-01   +1.672583949462813e-01   +7.377613130351131e-01   +8.607694274493349e-01; +1.436274611846234e-01   +6.563856659446603e-01   +3.084451362929164e-01   +2.788117162353596e-01   +1.306745318353508e-01   +6.697425494925008e-01   +2.795743365783347e-01   +4.161467124749991e-02   +2.936195753785875e-01   +4.932424749612320e-01   +7.352973185795307e-01   +5.917547159780627e-01; +2.255016144356932e-01   +6.664671387643674e-01   +5.452193458587503e-01   +2.686566398319839e-01   +1.345165862271746e-01   +5.965847997915080e-01   +8.823207027656932e-01   +2.815831160949018e-01   +2.614347805639933e-01   +8.479098190798320e-01   +6.053041150680127e-01   +2.195446135411951e-01; +4.640651369906336e-01   +8.112012433017917e-01   +7.148275487856127e-01   +4.941325238953506e-01   +7.270092320435917e-01   +9.254914409175163e-02   +3.424877270594927e-01   +2.756465848571236e-01   +8.769723676221116e-01   +8.395432194392277e-01   +8.116443483339858e-01   +2.604695672048506e-01; +5.682025766706492e-01   +7.560509530740807e-01   +1.994835810147239e-01   +2.748066315775533e-02   +4.290987972208039e-01   +5.851911707741629e-01   +5.822035059400469e-01   +1.834322392806459e-01   +9.500064449659180e-01   +5.519509701781234e-01   -2.349937281073901e-02   +3.348438655905695e-01; +4.712404382520288e-01   +4.114251919574530e-01   +8.370624591397942e-01   +3.877176753365236e-01   +1.124751568894186e-01   +1.187899627502112e-01   +6.186655341203681e-01   +4.822177728456248e-02   +6.106411905213556e-01   +7.562337820859149e-01   +2.064623844681271e-01   +1.000000000000000e+00; +3.140362970511741e-01   +5.279795926222405e-01   +2.771535791884207e-01   +7.354854146773033e-01   +8.072230545726329e-01   +6.415315404524732e-02   +3.654064989076689e-01   +5.927323500486706e-01   +6.219503051145037e-01   +8.518156409694483e-01   +6.494732234902125e-01   +6.115561882928685e-01; +5.574692180009370e-02   +8.545351995783242e-03   +2.975498698647455e-01   +5.769235493045370e-01   +7.582721631690991e-01   +1.749785968925159e-01   +5.552098520308415e-02   +3.224107639369556e-01   +6.654810566346421e-01   +2.715224761356050e-01   +6.005570810763545e-01   +4.897983239149323e-03; +8.276757879423332e-01   +3.069018215401741e-02   +7.194139489363227e-01   +4.873710095614213e-01   +3.602578619263119e-01   +8.594553792974118e-01   +1.224518403342816e-01   +7.943757107659613e-01   +2.882697665170153e-01   +9.024396913871777e-01   +4.725425603764461e-01   +7.192735454799970e-01; +6.229605639056918e-01   +8.390382595367686e-01   +4.931477943070885e-01   +8.690209158905338e-01   +7.951015977931101e-01   +4.835733814856728e-01   +9.017547290351461e-01   +8.694146152538450e-01   +4.559957417070610e-01   +8.552654563088700e-01   +4.818869617696145e-01   +8.465389427478368e-01];
L2E_Input1_iAMPA_netcon = [+9.471295363851995e-01   +9.631329277196815e-01   +8.955573557182949e-01   +9.541760447238026e-01   +9.019383238657250e-01   +9.976604136810920e-01   +9.059608975087137e-01   +9.447169962746319e-01];
L2I_Input2_iAMPA_netcon = [+9.193714416126672e-01   +9.623318838730552e-01   +9.848940479168404e-01   +8.804715841209495e-01   +9.058271065462360e-01   +9.191555307211630e-01   +9.149156109687390e-01   +9.416626954845471e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last =  11.21 * ones(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))*0.4 + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.5*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.5*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))*0.9 + 0.5*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))*0.4 + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.5*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.5*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))*0.9 + 0.5*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
