function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+2.135943643555895e-01   -1.302209901006664e-01   +4.991903312390795e-01   -1.540953692993868e-01   -9.568862231613239e-02   +2.905708209854389e-01   +6.156610419780113e-02   +3.307147032746393e-01   -9.692443440850582e-02   +2.523754499391316e-01   +9.744302425870684e-02   +1.243131717788419e-01   +2.990295475892248e-01   -1.534224481417268e-01   +3.287433003595042e-01   +5.655097170799183e-01; +5.542753389345145e-02   +8.780534868877003e-02   +5.170954192887446e-01   +4.144093634530416e-02   +4.603839868002169e-01   +1.021175054045953e-01   -6.509646541072553e-02   +1.643133954716579e-02   +2.372882584487723e-01   +2.706521984721524e-01   +3.065977378281362e-01   +8.327598769712420e-02   +2.673684234145297e-01   +6.032632056942736e-02   +2.590534879140864e-01   +1.740068818660309e-01; +1.150672030727872e-01   +6.092964177277617e-01   -1.370503675481796e-01   +7.076575245022751e-02   -1.373237838405867e-01   +3.671484329670585e-01   +3.955615097140933e-01   +3.614650511797927e-03   +3.889543654938783e-02   +2.433240374594117e-01   +3.904930759574515e-01   +2.924481141924678e-01   +4.126408419955030e-01   +4.189452999018720e-02   +4.169628210317106e-01   +3.457625259487003e-01; +3.248449444030659e-01   +2.287239392692409e-01   +4.469749399489818e-01   +5.712969204537229e-02   +5.158412215715001e-02   +2.163573019254642e-01   +4.418945581046386e-02   -5.674218398648760e-02   +8.762638749250894e-02   +3.453184358034991e-01   -1.736442880456563e-01   +2.137222022016668e-01   -2.813615892107092e-01   -2.472715582206497e-02   +3.693651379635493e-01   -4.330451650108287e-01; -6.022169540869534e-02   +1.764407378687324e-01   +2.959839173533938e-01   +3.964472517278392e-01   -1.495995926110850e-01   -1.230022354998580e-01   -1.158431566850049e-01   -7.553590590487233e-02   -2.125316718802459e-01   +9.601975709205288e-02   -1.520557484285012e-01   -1.716460003594752e-01   -1.312652617891416e-01   +3.349804872247027e-01   +2.517337108052556e-02   +2.202100466874078e-01; +2.519676012985192e-01   +3.907315148086198e-01   +3.048053505736057e-01   +8.254593134457625e-02   +3.214378377097364e-01   +2.599189245995140e-01   +4.191376301801499e-01   -7.277970529272035e-02   -2.367336614503076e-01   +3.379944226410420e-02   +4.851179753013753e-01   +1.155809925418752e-01   -3.743663132308838e-01   +2.385518251562040e-01   -1.400094600965004e-01   -7.512782229894786e-02; -1.736465839773759e-01   +5.814260701636650e-02   +4.368447269474596e-02   +3.179864018078558e-01   +2.923825454850421e-01   -5.869424726333587e-02   -6.390794412043511e-02   +3.037643941442349e-01   +5.081413512829906e-01   +3.852684871651702e-01   +2.128602410271955e-01   +1.123810572950259e-01   +2.453090920037923e-01   -2.706620289213252e-01   +1.223354057382974e-01   +4.431218890095277e-01; +6.381546570425473e-01   +1.190201349231222e-03   +1.347376448572215e-01   -2.857291385854750e-02   -2.852960555509014e-01   +5.112160054878971e-01   -1.158747068138878e-01   +2.311811986636890e-01   +3.476007517360538e-01   +3.406684418738147e-01   -6.520321502110893e-02   +4.704360432446786e-02   -1.023807462561324e-01   +1.065413964364641e-01   +1.217811176842559e-01   +1.605621329024319e-01; +1.740890478269183e-01   +2.856537512778733e-01   +1.742374474373043e-01   -2.702884199191119e-02   -1.053057192240716e-01   +2.988379915869550e-02   -1.280197470035404e-01   +1.369475042847963e-02   -2.556861141490966e-01   +2.184579958577144e-01   +1.675154686635610e-01   +3.587631301656220e-02   +2.306884985238196e-01   -3.580817064342231e-01   +4.116410140267827e-02   +2.674888154928733e-01; -3.130284920242795e-01   +1.729534142399013e-02   +8.980417825986127e-02   +2.283969609274851e-01   -1.578051859029475e-01   +3.242393546147361e-01   +3.058102990065335e-01   +3.344640837272769e-01   +7.990212853654977e-02   +7.795144213266511e-02   +3.320215391667938e-02   +3.685074508279731e-01   +7.091624347557522e-02   -2.365387853851486e-03   +2.443450736519125e-02   +1.250834061883670e-02; +1.140034812433677e-02   -1.452886106725343e-01   +6.797950354177171e-02   +5.044165575010517e-01   +2.609705956713033e-01   +2.325989903011014e-01   +4.211417476703468e-01   +3.857952167034903e-02   -1.496226826348074e-01   -1.953723225015704e-01   +2.101844793703603e-01   -6.916780703336163e-02   +9.113610836364042e-02   +1.958079967165418e-01   +4.126781077466986e-01   +2.648833539721202e-01; +4.172372440466499e-01   -4.996917354989175e-02   -2.124559519167527e-02   -1.047829543753256e-02   -1.120518599007960e-01   +1.053447200154317e-01   -1.019899527102687e-02   -5.667141224481809e-02   +2.210813730684856e-01   +2.631188416519303e-02   +2.273384793770685e-01   +8.587507219042635e-02   -6.421137497427079e-03   +6.072539783551185e-02   +3.463501371442096e-02   -5.396997735092915e-02; +1.178797002548009e-01   +5.255848631459333e-02   -6.318241774828891e-02   -1.045463016860180e-01   -4.320572472716575e-02   +1.984411497822604e-01   +7.482293905703338e-02   +2.913613246583962e-01   +1.686544724115880e-01   +1.156627573098430e-01   -1.402594781701506e-01   +1.628771293750446e-01   +5.561827882970230e-02   +5.498542226616689e-01   -3.949947550279326e-02   +3.978850737551383e-01; -5.824459559944141e-02   -1.963081670871955e-01   -9.623152322791539e-02   -2.991178664978668e-02   +2.499479495362449e-01   +8.604846407813868e-02   +6.164735912578347e-02   -1.582318758192804e-01   -7.808405912556654e-02   +1.290105859384229e-01   +3.329937155569865e-01   +2.178764368211543e-01   +4.844640558601185e-01   -2.334711918651269e-02   -2.751581411081277e-01   -2.341960107669631e-01; +4.111851820316815e-01   +3.220397218529668e-02   +1.659773739066140e-01   -2.484470811670850e-02   +2.863523976556644e-01   +4.237098153615315e-01   +2.107172697289485e-01   -2.664243387124512e-01   +2.297484200600210e-01   +1.983343453174317e-02   +9.026161919659663e-02   +3.492276958775427e-01   +3.026161758956478e-01   +2.374597489324735e-01   -2.967490930465931e-01   +3.028002422743602e-01; +3.752271713574412e-02   +3.224305809029667e-01   +3.618668313199880e-01   +3.051943543519595e-01   -3.051283005236642e-02   +3.196370108682630e-01   -1.300987354530706e-01   +2.149663840126463e-01   -1.029016675215300e-01   -3.644605887908857e-01   +2.276647796369461e-01   +1.808825957121246e-01   +4.640567440353811e-01   +4.157963443354201e-01   -2.057213674653119e-01   +1.864519343547055e-02];
L1E_L1I_iGABA_netcon = [+5.192679469038168e-01   -5.810124784650857e-01   -5.082528128058217e-02   +1.267302526369493e-01   +4.298779161473270e-01   +4.378409028277973e-01   -6.103730438102635e-02   -2.912917331816468e-01   -5.709323529760154e-02   -7.244696782563044e-02   +1.106694051006960e-01   +1.807611138203719e-01   +2.856576393703955e-02   +6.619998653977108e-02   -2.275672035818183e-01   +1.575462572833860e-01; +2.816236428238506e-01   +1.616029713703342e-01   +1.012154024040431e-01   +1.898223509321534e-02   +8.388010913043796e-02   +1.210863202489206e-01   +4.745657790652771e-01   +1.210995322815687e-01   +9.647251010948349e-02   +2.297060553289815e-01   -6.843865791262876e-02   +1.471450387269138e-01   +1.722591768306282e-01   -4.434653846165648e-04   +1.128519099594678e-01   +2.002221889928464e-01; -5.237922783826061e-02   +4.801294643685051e-01   +2.754530731531181e-01   +2.315262014820184e-01   -4.300579573914050e-01   +6.823536760043633e-02   +9.623615806763387e-02   +2.257081383675228e-01   +2.984861488829494e-01   +2.621830049914561e-01   +1.746066688378548e-01   -2.107943057923818e-01   -3.951909294966908e-01   -9.526149037137138e-02   -1.093034232462707e-02   +3.190408627213383e-01; +3.694546000783477e-01   +4.908034134388960e-01   -2.035910178537986e-01   +8.412967286985581e-04   -2.245304736942916e-02   -1.482010370157250e-01   -4.256416784301941e-02   +2.138974753521904e-01   +9.112012575213108e-02   +1.398262977588170e-01   +2.323829172791637e-01   +2.267827734941677e-01   +1.367219412999607e-01   -2.972748434674257e-01   -3.269397434803109e-01   -3.405044757886744e-02; +6.365389420125578e-02   +1.250180071380521e-01   +5.596376330214728e-01   +4.351044636231672e-01   +3.426537414330189e-01   +3.575070018964774e-01   +1.511207017823357e-01   -8.272531725867227e-04   +3.648422755653498e-02   +2.717491117708229e-01   +3.240533294524907e-01   -1.123910298502669e-01   +1.860245184314444e-01   -2.016580937573184e-01   -8.725831040645241e-03   -3.914211060511059e-02; -1.820094530657204e-01   -1.502007252167031e-01   +1.166312433904631e-01   +2.622880920430249e-01   +4.289679316333656e-01   +1.936613532082693e-01   +6.627858000608866e-01   +2.242743114988716e-01   +3.427820482016956e-01   +1.764679467110408e-02   +2.441804143639058e-01   +5.261420757417866e-01   -3.630419904740972e-01   -5.546487643050449e-03   -2.309329434078518e-02   -5.849093666487736e-01; +2.088682553478578e-01   -1.764020542627044e-01   +8.840082559038816e-02   -4.658255566419918e-01   +4.328847525881773e-01   +1.164437072885672e-01   +2.195093310715595e-01   +2.551548503858516e-01   +2.237955748062768e-01   +4.678490597460078e-02   +1.776615168367612e-01   -3.539889288258190e-02   -2.602445716203461e-01   +4.377454629348573e-02   -1.950466934918372e-01   +2.183280111083127e-01; -2.406523298415001e-01   +6.322882877700904e-01   -1.589057741567401e-01   -1.025017748952901e-01   -1.085594652338590e-01   +1.957061690147532e-01   +5.248485173116213e-02   +2.521385484182596e-02   -1.370823033756054e-01   -1.185454529069394e-01   +4.194903795098424e-01   +2.564958747871762e-01   -1.928325502409796e-01   -2.777490167823472e-02   +2.896515229207463e-01   -3.341903326275028e-02; +1.034417704657816e-01   +2.039398269582354e-01   +7.869295902366528e-02   +1.030986259119002e-02   +1.238835367753913e-02   -3.997270255346918e-02   +6.671502972126734e-01   -1.628907717392351e-01   +2.736305682821485e-01   +1.389518116933804e-02   -2.649235838621380e-01   -5.472510557371855e-02   -7.211831241700395e-02   +2.945745463693860e-01   -2.014220545080955e-01   +8.862976739454259e-02; +5.346738011815415e-01   +2.709993636096175e-01   -1.356485013203699e-02   +8.293096806532609e-02   +1.155036541367801e-01   +5.286251953957792e-02   +2.072847017454488e-01   +1.711436181797225e-01   +8.062750367717650e-02   +1.288303207633645e-01   -2.932977642454297e-01   +3.921725681131519e-01   -9.910550646513712e-02   +3.776766821284026e-01   +1.564909400604855e-02   +8.084453896924330e-02; -6.089498249768931e-02   +1.191967911125411e-01   +1.161371489311239e-01   +2.360991757380538e-01   +1.069489157335329e-01   -1.596314869474215e-01   +8.514792169464247e-02   -2.900517582734854e-02   +2.484123709958504e-01   +1.674807885081526e-01   +3.514315515695113e-01   +6.026099540666000e-02   +1.909999294553507e-01   -1.578145396584679e-01   +3.167716224408588e-01   +3.106525809679314e-01; -7.017976125457109e-02   +1.058336719088946e-01   +2.209063515317504e-01   +7.197189944611856e-02   +1.089640682605490e-01   +4.943712066778322e-02   +1.418946013753242e-01   +1.046195218491156e-01   -7.129800487897614e-02   -1.525775122838075e-01   +2.332710178479515e-01   +3.491734226386016e-02   +2.668286875947559e-01   -3.626534459924984e-01   +2.025893597022405e-01   +3.880693851629390e-01; +3.506217457916775e-01   -1.191929499787195e-01   +4.980873764417006e-01   +1.728145869284700e-01   +1.064931492231517e-02   +4.673914483799288e-01   +1.402410003130989e-01   -1.049035291013480e-01   +3.119925388248703e-01   +3.106869089981004e-01   -2.700251421126323e-01   +2.735917537020565e-02   +7.175080803843298e-03   +3.205350631725182e-02   +1.324987356292590e-02   -2.387928668124966e-01; -7.277864630737502e-02   -1.566446963685137e-01   +4.550353715257772e-01   +3.750834796693103e-01   +5.005519246386908e-01   -3.368607964262235e-01   -3.697101592643373e-03   -2.337027827797772e-01   -1.094613819181704e-01   +2.225409057623802e-01   +1.400194065407882e-01   +5.333302391517744e-01   +3.273244613150035e-01   +2.502925049918643e-01   +1.059359896047617e-01   +9.999336682962730e-02; +2.365170605848074e-01   +1.529790463720192e-01   +5.138730956677845e-02   +2.383051003757089e-01   +3.704502523802011e-01   -1.881076990349651e-01   +8.483835336931878e-02   -3.955791905263712e-01   +3.311563759287004e-01   -8.350652242258864e-02   -5.148547718380608e-03   +1.757332414555754e-01   -3.679070424971126e-01   +9.238127479017186e-03   +4.010190387704879e-01   +1.958191094380987e-01; -7.458827074946975e-03   +3.924840376330296e-01   +1.462204965237360e-01   -3.113981674360524e-01   +1.899968088932373e-01   +1.401082266484686e-02   +5.772787391124240e-01   +1.912458186630650e-01   -1.010051202546609e-01   +3.325050124625328e-01   +1.496476048912253e-01   +1.321371589590165e-01   +2.109949868339166e-02   +5.038537799786229e-01   -6.514715584697538e-03   +3.548571406888003e-01];
L2I_L1I_iGABA_netcon = [-1.285878159344246e-01   -6.647927305253566e-02   +2.644367725468002e-01   +2.575226995402001e-01   -2.287207711784298e-01   +1.875794771544699e-01   +3.168676643525272e-01   -1.469429809533366e-01; -1.725339202874752e-02   +4.778173496832636e-02   +1.938653818707365e-01   +1.795566932503471e-01   +2.756082357876718e-01   +3.017283050974144e-02   +3.289868896163267e-01   -5.081672522039069e-02; -1.276677610359393e-01   -6.305589755983487e-02   +3.293928516750050e-01   +2.257358235100383e-01   -1.985065415467562e-02   +3.180177235692608e-01   -4.230786963022926e-01   +2.177217665092974e-01; +4.416745480593107e-01   +1.744126176905167e-01   -1.305140686821448e-01   +9.518091343832871e-02   +1.515873418675216e-01   +5.391123801534284e-02   +1.750128285730015e-01   -1.199037698896522e-01; +3.868542245932119e-01   -1.070583441344677e-01   +2.845872445239310e-01   +3.389218895667082e-01   +3.138913405132996e-01   -8.527957962774829e-02   +7.417333416869560e-01   +3.935646332666369e-01; -1.412873905748058e-01   -2.476400528210956e-01   +1.166195519967405e-01   +2.588446443629285e-01   +3.606499191294253e-01   +4.975868748188123e-01   +2.208183951456146e-01   +3.873137845486075e-01; -1.189272005603226e-01   +2.807835654869379e-01   +3.304851886326331e-02   +3.512242847342272e-01   -2.507982395610365e-01   +1.884921013229779e-01   -2.186422299824115e-02   +8.123143958935942e-02; +3.149115593100608e-01   +3.270771805127698e-01   -6.881926830854389e-02   -1.990206130492639e-03   +3.408336101692611e-02   +6.411607390940028e-01   +5.735509993916074e-02   +2.516626343768991e-01; -2.758609047449614e-02   +1.083482523771758e-01   +6.291609758192039e-02   +2.591211383497981e-01   -7.420429506292897e-02   +1.043301846492179e-01   +3.680419223951367e-01   +2.405053770482077e-01; +1.321470741866771e-01   +2.230969000565186e-02   +3.266797716438447e-01   +1.837555964159266e-01   +4.381072048145669e-02   +3.177051744825203e-01   -2.661312770275541e-01   -2.523968973454417e-02; +4.507607355041829e-01   +2.263792120881264e-01   +1.131063468968092e-01   -7.329498477907953e-02   +5.114705131454211e-02   +1.313454165383922e-01   +2.338656419738833e-01   -2.994955441063151e-01; +9.012560803167811e-02   -4.104686137647572e-01   +1.034583730692101e-02   +1.957698371833158e-02   -3.202607528711708e-01   +1.789186065803632e-01   +3.820398543610993e-01   +1.771904155767653e-01; +2.196530512690836e-01   +3.330559991060875e-01   +3.133252479329345e-01   +1.539119489571892e-01   +3.366685918756404e-01   +1.191183737476971e-01   +9.970147085247918e-04   +4.913433120226049e-01; +3.809993839085227e-01   +3.849167906651191e-01   +6.986473494623137e-01   -1.803389065473361e-01   +2.384264759269527e-01   +9.755712545391745e-03   +3.672166297380087e-01   -2.566319264185654e-01; +1.931424559581533e-01   +2.674518249707105e-01   +1.763593090717155e-01   +2.206663914612917e-01   +8.197340021205463e-02   +7.690886880994402e-02   -6.988955017316410e-02   +4.932197986575088e-02; +5.842025967826198e-01   +1.620342974565639e-02   +1.109790017756318e-01   +3.076586663055009e-01   -1.287032841321631e-01   +4.058188881914594e-01   -4.858688538956867e-02   +1.070930684346348e-01];
L1I_L2I_iGABA_netcon = [-1.254097324557344e-01   -3.234795486524709e-01   -4.697820691687425e-01   +2.573326443897926e-01   +1.919957605635069e-01   +2.381938043153282e-01   -3.952976862020884e-01   +3.393274402482903e-01   -1.530869110115266e-01   -4.850381643538738e-01   +4.162448221627483e-02   -2.579671388618798e-01   +8.846790400122019e-03   +2.979155541289373e-01   +2.279698920758421e-01   +2.759791989744433e-02; +1.454068812703029e-01   +1.507412622834787e-01   +2.668164285442262e-01   +1.290941275724444e-01   +3.267714623529444e-01   +2.418558167091739e-01   +1.091991159219397e-01   +4.145500200998773e-01   +2.549367312739611e-01   +1.256876286161573e-01   +1.400875164693182e-01   -6.821076914096671e-02   +1.446720148766944e-01   +4.517055436405211e-02   +1.244039985964550e-01   +2.684828581583105e-01; -1.998182901883111e-03   +2.375256186130966e-01   +3.481417974475383e-02   +1.353891044593661e-01   +3.186618936378077e-02   +1.724246750195518e-01   +1.785707586249580e-01   -9.533869895914016e-02   +5.166947427560491e-02   +2.337303743445490e-01   +3.529385235956258e-02   -7.319028595985949e-02   -1.498642788535877e-01   -2.414493303015990e-01   +1.371885953427870e-01   -4.426676968204819e-01; +2.073393330323423e-01   +1.870307875859528e-01   +4.830593955392045e-01   +4.132540864923052e-01   +1.517777091259404e-01   +2.039087291836355e-01   +4.809253814469819e-01   +4.873004695846951e-01   +1.457342580481885e-01   +6.275242747385708e-02   +5.173217890186035e-02   +8.454991294119560e-02   +4.056454741572967e-01   +8.865869207895434e-02   +2.106356171869421e-01   -5.317438675036205e-02; -7.344974744031921e-02   -1.490231205255807e-03   -6.212631340367457e-02   +3.106432016095398e-01   +4.134643551849345e-01   +2.396023323520123e-01   -5.704877745798442e-02   -3.049712006951145e-02   +2.976396441046741e-01   +4.024222517933057e-01   +1.112525152557872e-01   +9.720798886480154e-02   +2.946602541078399e-01   +5.259626153007599e-02   +2.939491032615686e-01   -2.418101678731809e-01; +1.385247920608589e-01   +3.498284079701099e-01   +3.669430420914101e-01   +3.180585175267677e-01   +1.626752505520275e-01   +1.521715304911264e-01   +2.119130820194865e-01   +4.482537934448558e-01   -5.550595410602599e-01   -1.445664141179825e-01   +1.356796580357232e-01   +2.143109676348109e-02   -1.318716255772043e-01   +2.986665171490888e-01   +3.283987798340572e-01   +3.055351737521873e-02; +4.313596900924238e-01   +5.529450936375490e-01   +2.142502700707237e-01   -2.265371649831778e-02   +3.977206345602469e-01   -1.792842386244806e-02   +1.304973625837187e-01   +2.674240567858067e-01   +4.568435555891646e-01   -1.881961104775060e-01   +1.679286548026461e-01   -6.275686297793619e-02   +1.709570052386774e-01   +1.171550079183792e-01   +2.718547876886745e-01   -6.084846704485839e-02; -2.667366498692594e-01   +1.312116731288940e-01   +4.996507543394852e-01   -2.604770737451249e-01   +3.256553173240905e-01   +1.004644622622267e-01   +2.745935850589856e-02   +5.323713390737624e-03   +1.609345800382457e-02   +4.193607207902088e-02   +1.766206335137973e-01   +2.584298435776797e-01   -1.457367228464381e-02   +3.998970542352057e-03   +5.540991461088260e-01   -1.104793158011712e-01];
L2E_L1E_iAMPA_netcon = [+9.842932499271799e-02   +1.957370009072308e-01   +3.183316290771258e-02   -1.140293361035451e-01   +1.706989623235737e-01   -4.910787413137508e-02   -9.149861976510605e-02   +7.340585793537104e-01; -5.410459609900251e-02   +5.726516896727851e-02   +3.690949781439839e-01   -1.338376714759482e-01   -1.249777895229511e-01   +6.829706746834007e-01   +3.447735737781045e-02   +3.239625411616400e-01; +2.471289651386885e-01   -4.190596026943959e-02   -7.175128308825454e-02   -1.939067611979587e-01   +1.197838675577354e-01   -1.004391981163777e-01   +1.493362272738386e-01   +2.782594881388775e-02; -9.029984313657560e-02   +4.128674829476369e-01   -7.414785677629904e-02   -3.174067984792665e-01   -3.904301222830969e-01   +2.554595731626913e-01   -1.187723323952014e-01   +7.331966230343648e-02; +5.240115792699372e-01   +9.349048134231874e-02   +3.715258175892838e-01   +1.417463391223477e-01   -7.503740744078374e-03   +2.579137024980211e-01   +3.296661322179858e-01   +5.145381138081525e-01; +2.949016885126645e-01   +3.037834813381795e-01   +4.517299654692757e-01   -1.891552359261562e-01   +2.661425515965757e-01   +5.281204447665953e-01   -8.675232663516109e-02   +2.301712779993811e-01; +1.972687553543595e-01   +3.070279682689707e-01   -1.611838543620148e-02   +1.599745233823885e-01   +2.093428090213643e-02   -1.269962567756528e-01   -6.019730562240762e-03   +4.727953847945701e-02; +1.363049055906352e-01   +1.386829630095879e-02   +2.893746913664343e-01   +7.998492743789146e-02   +2.834129778908667e-02   -1.181747348915467e-01   +4.352476762294978e-01   -3.589617546595009e-02; -3.927788519455846e-02   +3.867504484853933e-01   +2.119186664094149e-01   +3.263647626573174e-01   +9.673748813743235e-03   +7.436943283688056e-01   +2.976135315405003e-01   +6.724332183257226e-02; +3.769157710718481e-02   -7.361046478624438e-02   +3.056739563782088e-01   +3.918217136227228e-01   -2.434350377286688e-01   -1.104463861940361e-01   +1.083278811512018e-01   +1.235783195953034e-02; -8.278386128029357e-02   +1.062071487315300e-01   -6.752251972875355e-02   +4.735391167855094e-01   +3.368023901816368e-01   +3.550116742444556e-01   +4.808711318300471e-02   -2.962435935538141e-02; +3.761814502666737e-01   +1.261141794824819e-01   +5.158599607694895e-02   +4.048075389122416e-01   +3.718104081355566e-01   +1.814780418587458e-01   +3.208306832786773e-01   +2.458676099336920e-01; +2.261223805616215e-01   +1.845436195685902e-01   +5.492709031213621e-01   -2.479093196707546e-01   +2.417449573423769e-01   +1.019048741069113e-01   +3.661088862615846e-01   -8.939196070846697e-02; +5.106574351962420e-02   +3.030796077554960e-01   -8.179461821943981e-02   +1.615137337512654e-01   -1.877145212698600e-01   +1.818837418264040e-01   +3.396188250812705e-02   -7.794590747412469e-02; +2.568694236890621e-01   -2.433781182960444e-01   +5.449710375307977e-02   -1.119100476111322e-01   +2.085533404892156e-01   +1.055115003456754e-01   +2.665362556233177e-01   +2.078400772071433e-01; +4.001509942650520e-01   -8.311161932480410e-03   -1.511975135695426e-01   +5.958213479435873e-02   +2.306012621636786e-01   -3.914423933724476e-01   -2.238535571992867e-01   +4.191713250967184e-01];
L1E_L2E_iAMPA_netcon = [+4.499577667872387e-03   +7.001373748949712e-02   +6.171082263902700e-02   -9.302514745357249e-02   +5.390813114359563e-01   -6.786429616862655e-04   +9.055800927199370e-02   +8.643134696551991e-02   +3.520202967078447e-01   +5.090215017244398e-01   +2.992547329137499e-01   +5.596080719852508e-01   +1.777162894231522e-01   -7.311178307522657e-02   -4.887137227319927e-02   -4.024344717764240e-02; +1.548390494520108e-01   +1.214581640283895e-01   +3.215728690064601e-01   -2.526032741231420e-01   +6.889298983955099e-02   +1.549567180429046e-01   +7.910110678812234e-02   -1.085808663792251e-01   -3.728490134755315e-02   +1.235312840086742e-01   -8.150018295198805e-02   +1.022966015515425e-01   +1.782895481961917e-01   +2.740567465024089e-01   +2.456804580185076e-01   +3.761354236020285e-02; +3.146589882215102e-01   +3.125456118908417e-01   +1.685605933909649e-02   +4.307318024236314e-01   +1.577521272335182e-01   +3.162360954690419e-01   +1.698441117967843e-01   -4.352487732308212e-02   -3.627358385322411e-02   -3.305395636397417e-03   +2.051198266491534e-01   +1.322956488102543e-01   +4.598957721800446e-01   +1.714498243655194e-01   +1.128063027488592e-02   +3.668746504942634e-01; -8.234996133671353e-02   -8.145713227410978e-03   +4.401909052008621e-02   +1.304325772148601e-01   +1.734451551991961e-01   +1.586275100831758e-01   +4.889161902493973e-01   +4.851560067641449e-02   -4.975509236715243e-02   +2.144475144683141e-01   +2.034609330637911e-01   +1.906910965311635e-01   +3.307792132063997e-01   -3.065781798571374e-01   +7.986502525514313e-02   +4.123048454576159e-01; +4.003653180008906e-02   +4.010937935858929e-01   +3.685286921515804e-01   +4.764209640819655e-01   +2.463955388955615e-01   +2.906242983360528e-01   +3.585627126400351e-01   +4.368519336223792e-01   -5.226305958445378e-02   -3.574937458622697e-01   +2.740523298942139e-01   +2.745748364506648e-01   +6.390205820939934e-02   +1.740394649842194e-02   -1.754451007432129e-01   +2.520901342854096e-01; +2.981315953983982e-01   +5.987222575504095e-01   +1.912640490776142e-01   +3.072030650578519e-01   +5.307732078832902e-02   -1.646250687934152e-01   +4.822711188442619e-01   +2.012911974943906e-01   +3.782286193464897e-01   +2.434221184578111e-01   +2.654219757263439e-01   +3.868764627710325e-02   +1.021767223469392e-01   +2.623620605822265e-01   +1.631085090614765e-02   +3.221962441226398e-01; -2.815536760495624e-01   +1.514876039559355e-01   +4.260229046429235e-01   +4.050029537266181e-01   +2.736996137075874e-02   -3.301514086371439e-01   +1.832215670792108e-01   +1.140851103904619e-01   +1.272584060670323e-01   -2.461885935244656e-02   -1.077829075690921e-01   -6.402134036294505e-02   -1.573954669251629e-01   +2.671752594322717e-01   -4.048195981709467e-02   +4.020975631011373e-01; -2.115815961931874e-01   +1.159027871255931e-01   +1.291554292228994e-01   -1.845105459851034e-01   +3.786532906372994e-02   +3.711409290726797e-01   +6.266987043869379e-02   +1.159962071967508e-02   +1.308194280287003e-01   +3.604039630986371e-01   +1.787464335449986e-01   +6.215540822737609e-02   +1.230009066463410e-01   +7.997771434782162e-02   +2.122826545900043e-01   -1.394671602327450e-01];
L2I_L2E_iAMPA_netcon = [+2.311881387195617e-01   +1.992637186654012e-02   +5.742102947839354e-01   -1.546583431209690e-01   +1.417255228622937e-01   +1.658892405267779e-01   +2.117509149705536e-01   +6.718313027599702e-02; +2.354942252381430e-01   +1.163574986913747e-01   +1.102009025720540e-01   +9.540883092435412e-02   -5.312870289225495e-03   -9.763934771913137e-02   +1.529059293915005e-01   -2.835965455347276e-02; +3.685256433074606e-01   -1.555632478474961e-01   +7.510560341012829e-03   +3.945759252303904e-02   -2.849622974897594e-01   +6.172074770148017e-01   -1.133038771316654e-01   +5.136420200386285e-01; +1.511288758000063e-01   -1.853275746010593e-01   -4.062482395282905e-01   +1.281647495732222e-01   +2.077987902174499e-01   -3.873856464487994e-01   -6.528943607744114e-02   +9.697021210323370e-02; +5.671295063374551e-02   +3.797954335250047e-01   -1.562302046891740e-01   -8.703651759659209e-02   +2.977443044885996e-01   +3.559270375850861e-01   -2.316313429070978e-01   -2.091713889966818e-03; -9.018646403340294e-02   -1.867797408182028e-01   -1.486918325428894e-01   +2.412865175787329e-01   -9.084728042471595e-02   +2.539467956993914e-01   +1.479139606796723e-01   +1.463742333584984e-01; +3.226269279962228e-01   +4.567642943289656e-02   +2.398343719773007e-01   +4.848969592147348e-02   +3.073144439367755e-02   +3.763674817333836e-01   +1.673653810977827e-01   -6.135879004125498e-02; +3.376119506265127e-01   +2.317180705762076e-01   -2.592216668795047e-01   +3.217448053617478e-01   +9.159119453436980e-02   +2.103882920085024e-01   +1.770370363100747e-01   -1.966055746246300e-02];
L2E_L2I_iGABA_netcon = [+7.304009576671923e-02   -2.970280222167565e-02   +2.309197779231984e-01   +2.580460597442661e-01   -2.249982112406705e-02   +5.586148982066796e-01   +5.003692187945226e-01   +1.753625709396644e-01; +1.094620573192586e-01   +1.233802047282002e-01   +3.375870709643350e-01   +9.162320055977727e-02   +4.991187381157847e-01   +1.378672429257138e-01   +4.059844099199769e-01   -4.452931412311749e-01; -2.665128675103089e-02   -4.788596509669859e-01   +8.456525483389081e-02   -9.601389546074998e-02   -7.820441421729235e-02   -3.058587776050420e-01   +3.810136763041858e-01   +4.249467705103980e-01; +4.870823359406120e-01   +8.824932389723512e-02   +4.330360788995534e-03   -1.185961267640742e-01   +1.047413099850641e-01   +2.008435542402721e-01   +1.350562689693138e-01   +1.010135766496836e-01; -1.886184402617594e-01   +3.329891500628475e-02   +1.416185503799600e-01   -3.349858903070126e-01   +1.345906766580077e-01   -1.175625963893729e-01   +4.836948879413934e-02   +6.164546875580855e-02; -1.717159308965652e-02   -3.114107797470844e-03   +1.754211333120857e-01   +2.468107764688095e-01   +3.213721229152604e-01   +2.794557186114259e-01   +3.982294425656169e-01   -1.147733666902599e-01; +3.554729321297960e-01   -1.922877772096078e-01   +1.828372756120841e-03   -1.080150192766537e-01   +4.191582559459512e-01   +1.553381403659500e-01   +2.153668968637021e-01   +9.990416860464477e-02; -5.476623783774455e-02   +2.151737150596199e-01   -2.747311589376030e-01   +1.689330083246312e-01   +1.778968066396295e-01   +7.711590796350247e-03   -1.297737965221435e-01   +3.217779159746079e-01];
L3E_L2E_iAMPA_netcon = [+2.069947425064980e-01   +2.363598140982537e-01   +6.147374907512433e-01   -3.708777133306647e-01   +2.456988545491575e-01   -4.493450200324615e-02   +1.541687889938228e-01   +6.120003253249365e-02   +4.736984963425397e-01   -1.738718164850005e-01   +1.114559880412376e-01   +1.418454845207575e-01; +3.745732073433390e-01   +8.214146463948768e-02   -8.396500177911778e-02   -3.507195852052963e-02   +2.541891243146675e-01   -6.663066915669658e-02   +2.189199482378480e-01   +1.693880246148656e-01   -1.132076049134835e-01   +1.853242031441473e-01   -1.872265651591283e-01   +2.297937500185450e-01; +1.399292796564342e-01   -8.830995676770420e-02   +2.711053746590045e-01   +9.949416881353368e-03   -1.446003081114765e-01   +3.000875943186250e-01   +1.729758589382734e-01   -4.436694248948785e-02   +3.250189322495728e-01   -5.669116199456835e-02   -5.278580031092234e-03   +7.933565490115049e-03; -1.259886969199461e-01   +1.794388063650600e-01   +1.822468947649629e-01   +3.402742492677368e-01   +2.976162193228312e-01   +3.801906929685885e-01   +1.632084912886294e-01   +4.307999098363786e-01   -1.273803445263227e-02   +2.575488396894185e-01   +5.184261369215382e-02   +3.659240162806921e-01; +1.373123673995170e-01   -5.207972748578552e-02   +2.772290782946226e-01   -2.126392021124788e-01   +3.220388707989069e-01   -3.212792440696154e-01   +4.163672158495391e-02   +2.286034953011642e-01   +3.750668027003631e-01   +1.040094322356057e-02   +3.531081198737572e-01   +2.708242100735440e-01; +3.288517672808705e-01   +2.798339691624832e-01   -2.575913665078505e-01   +1.331403799846998e-01   +3.915004491101499e-01   +2.072772844308909e-01   -1.696112749220360e-02   +1.075640534707530e-01   -7.223221422392696e-02   -2.066701843966501e-01   +1.821669000449851e-02   +4.198910310159894e-01; -1.235894127358497e-01   +4.927252733391421e-01   +1.478723867545328e-01   +2.218880595698126e-01   +2.201032269227370e-01   +1.059107261278176e-01   +4.167082392960362e-01   +2.001876734019029e-01   +6.124157956757235e-01   +1.525721739992209e-01   +4.963371672184262e-02   +8.144611174239774e-02; -3.298594999783749e-01   +1.566461863757492e-02   +1.905826682649128e-01   +9.029123029863353e-02   -8.240940856475260e-02   +3.838296800821895e-01   +4.555596734466315e-01   +4.987446720476105e-01   -9.650415866284921e-02   -3.286790740132502e-01   +7.352044129222808e-02   +4.074838681127788e-01];
L3I_L2I_iGABA_netcon = [-2.801887855121744e-02   +4.710633206171657e-01   +2.230207027804341e-02   +2.331219577103192e-01   +1.440096964149845e-01   +3.404705922499585e-01   +1.263939097115996e-01   +1.468311779599309e-01   +6.492364839544350e-02   +8.982210347651996e-02   +2.772895669925133e-01   +2.294939880475980e-01; -7.840488309009327e-02   -6.868658656923296e-02   -1.188348655565220e-01   +1.370239545009281e-01   +4.460952822224512e-01   +2.822958654320312e-01   +1.803933552073758e-01   -2.747249104743348e-01   +1.160497462737534e-01   -2.669209603655172e-01   +1.385623375491664e-01   +6.010204290647190e-01; +2.057121919717067e-01   +2.804704876175733e-01   +1.352695509393526e-01   +1.754212293086491e-01   -1.193130240261699e-01   +1.915188130686229e-01   +1.828778083543208e-01   +4.300002531345558e-01   +2.802038796348822e-01   +1.335108865000971e-01   -6.724875035851144e-02   +4.808329557644679e-02; -2.929937113976575e-02   -7.038234507407866e-02   +2.390127301652239e-03   +2.967426163535443e-01   -2.427897037095234e-01   +1.217680356051935e-01   +1.255606940223881e-01   +1.329274780860787e-01   +3.487668635383303e-01   +2.906088343669869e-01   +2.234792914566516e-02   +2.790297388415214e-01; +9.410605573304545e-02   +2.382466455977389e-01   -1.911293383520070e-01   +2.409474907385831e-01   -7.237389857416164e-02   +1.155088545647035e-01   +1.938389274971979e-01   -2.674840536555932e-02   +2.178301796568874e-01   +5.932866055553340e-01   +2.994112951536029e-01   -2.728082268432622e-01; +1.828022502067918e-01   -2.586887481850405e-01   +4.571102764635132e-01   -5.942429282762121e-02   -2.378249080104838e-02   -8.916543987963195e-02   +7.567978331445713e-02   +2.921220961064548e-02   +5.661281682076222e-01   -1.991357960197205e-01   +5.237739124153209e-01   +1.928247617004662e-01; +3.215470700623902e-01   -2.019767077198773e-01   +3.331995410061065e-01   -1.974307719577500e-01   +2.290256240418069e-01   -2.864278801027523e-01   +2.876012007140426e-01   +3.746429340771468e-02   +2.704073381126869e-01   +2.932530146209577e-01   +7.846704844533313e-02   +3.783651534560294e-01; +4.065845449910642e-01   +8.763833519209875e-03   +1.509738419029852e-02   -1.280483054023316e-01   +3.259323013595337e-01   +1.068729732883215e-01   +8.791867732847215e-02   +5.300169724059544e-01   -2.339692541154188e-02   +5.231851634671265e-02   -9.721504190346050e-02   -2.275216167875647e-01];
L2E_L3E_iAMPA_netcon = [+3.408511934794850e-01   -6.863964672086921e-03   +5.041222696882841e-01   +7.649126324075950e-02   +1.862555144703588e-01   +1.124262672407439e-01   +2.448326790176675e-01   +1.644027519260116e-01; -2.585003755593154e-01   +9.736563513466051e-02   +3.034982464711240e-02   +5.744548006922349e-01   -4.399812237277527e-01   +1.158515321784274e-01   -2.735602537809842e-02   +4.276984930270123e-01; -4.091094264482814e-02   +2.959871849080303e-01   -7.970844898790720e-02   -3.313384915531230e-02   +8.059615622382788e-02   +4.110774373946458e-02   +4.854743238103931e-01   +1.349140811138409e-01; +1.913493014801431e-01   +2.326847701734058e-01   +1.331362686129205e-01   +4.906439736434396e-01   +1.860643023614124e-01   -2.166859892985639e-01   +1.109826805483907e-01   -7.259607192618868e-02; -4.777626815923212e-02   +1.610422981247256e-01   -7.136580283588326e-02   +2.108188766455549e-01   +5.634165588202336e-01   -3.299158232559850e-02   +2.052282665189881e-01   +3.256216341130184e-01; +4.258978846979214e-01   +1.480245933378290e-01   +2.741622309297642e-01   +2.999720044732089e-01   +2.565752855908743e-01   +9.873873209996670e-02   +3.212016094787769e-01   +1.418497664020929e-01; +4.234346832578652e-01   -1.249497428344146e-01   +1.618544587594131e-01   +2.195418887571995e-01   +4.192740735223536e-01   +1.797370016147902e-02   +1.730592769101475e-01   +2.700749157199374e-01; -1.166641216217814e-02   -1.931415331345809e-01   +1.947584509031782e-01   +3.710965150265833e-01   +3.595447499255987e-01   +3.416261063845992e-01   +3.294272859087334e-02   -2.128215468639972e-01; +1.240615917256230e-02   +3.433110441205784e-01   -3.553946910183584e-03   -2.334879621333049e-01   +2.787984876634160e-01   +1.002151197872900e-02   +1.503450770537065e-02   -6.113329327235394e-02; +3.807933047885083e-01   +9.343136751843545e-02   -1.794571611785017e-01   +1.728753998413971e-01   -1.294983634710265e-01   +8.478628316275889e-02   -1.152484450380260e-02   +3.619667283289915e-01; +2.027084332133268e-01   +2.594887355719782e-01   +1.592220422954992e-01   +2.034027153015225e-01   +7.054605552209582e-02   +6.475475286716504e-01   +5.983147114934777e-02   +3.684040621873046e-02; -8.845472663266210e-02   +1.800125569253483e-02   +2.419691024254238e-01   +7.035791562070952e-02   +2.915881888799644e-02   -1.167569337642865e-03   -5.673328468163749e-01   -6.549612645520560e-02];
L2I_L3I_iGABA_netcon = [+1.452526022982906e-01   +3.838708740348400e-01   +8.656156222691228e-02   +2.534119240278466e-01   +1.926826863686445e-01   -4.046953703711069e-02   +7.540107321619353e-02   +1.521900561043393e-01; +2.218720652303596e-01   +3.398653489558243e-01   +2.165029759860694e-01   -1.516298926504163e-01   +1.463998792438755e-01   +3.029362945649283e-01   +3.244080657664019e-01   +5.810547595193819e-01; +4.210215425151604e-01   -6.905927244160437e-02   +3.311117890071797e-01   +8.979913505060888e-02   +5.457749441380092e-01   +3.504316040245761e-01   +3.776258413827139e-01   -2.452315660870378e-01; +6.950986421417413e-02   +5.285186834889151e-02   +1.435110237798289e-01   -1.126263140998532e-01   +4.437743837477197e-01   +3.783432394265207e-02   +8.636264830731974e-03   +4.954464506860633e-01; +1.798223997916022e-01   -5.372325674733448e-02   -6.071443317426814e-02   +2.924159322924121e-01   +2.706964862242948e-02   +2.333383302677223e-01   -2.109836240279183e-01   +2.131943524780905e-01; +1.643248027723319e-01   +4.019267293316050e-01   +9.215517072066060e-02   +1.203532249492284e-01   +5.327575495859564e-01   +1.897542319325883e-01   +1.224649315781603e-01   +4.011524937650734e-01; +7.904173831135897e-02   +1.447943973156567e-01   +2.201328675092783e-01   +6.395172910592245e-02   +1.498269752526564e-01   -1.054429465899555e-01   -1.420074581269499e-01   +2.070468293381070e-01; -3.330890702763110e-02   +3.774477806193301e-01   +1.137271668637906e-01   +8.818849391177061e-03   +6.343266610402828e-02   +2.862771192358736e-01   +1.872335693123135e-02   -4.456576070852067e-02; -6.212615154843254e-02   -1.563127432751497e-01   +3.818824686672511e-01   +2.946718314104614e-01   +1.893521419614566e-01   +8.601008653431171e-02   +4.695349166161320e-01   -7.177143801429757e-02; +1.674358405230174e-01   +5.136692067143140e-01   +1.176724258027319e-01   +9.845024119008977e-02   +2.270209744234525e-02   +3.509502230975248e-02   +2.309130244664844e-01   +2.864629917128314e-01; +6.417624124693647e-02   -7.059806061203155e-02   +2.918653644993544e-01   -5.420113933796556e-02   +8.574223654896018e-03   +2.986973558358127e-01   +2.936017877326988e-01   +1.180023058770795e-01; +2.399934130171498e-02   +1.818747204913050e-01   -2.058829943502502e-01   +2.631432870008425e-01   +6.154100480940686e-03   +1.798257122942890e-01   +6.017166390148736e-01   +2.232973085538220e-02];
L3I_L3E_iAMPA_netcon = [-6.616904321539055e-02   +9.935466281849831e-02   +8.982989849238646e-02   -2.755180490733285e-02   +4.018604402147121e-01   +2.308266587454650e-01   +1.153189179141924e-01   -8.860092944243174e-02   -2.157631053875208e-02   +2.067102087449565e-01   +6.277255883701530e-02   -5.152905788116349e-03; +5.679289869528502e-01   -1.758723538548574e-01   -9.524865478947334e-02   +3.067605166368458e-01   +4.091470014960685e-01   -1.295588890677530e-01   -6.334366202177678e-03   +3.064641182116737e-01   +8.626248567799531e-02   +1.218495369767148e-01   +1.573865187457130e-01   +1.296458580233378e-01; +2.156635355825908e-01   +3.880634983697442e-02   -1.503178460174803e-01   +4.051870168045368e-01   -3.463679274128970e-01   -1.125189162883257e-01   -5.830795898856771e-01   +1.207255541315219e-01   +3.503848223610335e-01   +6.033603281313797e-03   +1.800118311990272e-01   -2.813273224486059e-02; +3.064779835703529e-01   +4.579100310691022e-01   +2.806607801662597e-01   +4.995419374083747e-01   -3.713879869953609e-01   +1.753367756206287e-01   +3.121015247209551e-01   -9.254107928310386e-02   +1.861300652154969e-01   -5.926582786799475e-02   +3.610260590843586e-01   +8.877695725474367e-02; +4.810551299838005e-01   +2.549764913626074e-01   +2.718085181244880e-01   +1.366972546305110e-01   +1.390444765877268e-01   +2.051076082415562e-01   +6.594578237941753e-01   +4.875141629955490e-03   +1.695068288835493e-01   +5.106365007545757e-01   +1.255658039935433e-01   +2.340682905898566e-01; +1.660670287199844e-01   -1.334488447677044e-01   +2.532570430029951e-01   -3.831214179845563e-02   +2.704193326773144e-01   -3.987542429776056e-02   +4.435329405581642e-02   +2.252125130422066e-01   +3.664359022586574e-01   +3.168696565217269e-01   +1.270982340637381e-01   +9.992740121502182e-02; +3.485740236124843e-01   -3.557185743169246e-01   +3.603912935108282e-01   +3.784022091730919e-01   -2.206479438818093e-02   -1.739028038128361e-01   +3.832165129945382e-01   +3.009352865895854e-01   +5.935514238765306e-01   +2.981014650103389e-01   +1.051676669053601e-01   -3.318699868662479e-01; -2.779368987630471e-01   +3.137259684430715e-02   +2.223706733620489e-01   +1.136289703292013e-01   +5.009830400087083e-02   -5.325248596804816e-02   -7.728919981249469e-02   +3.055978099487322e-01   -1.418921189749403e-01   -1.652231685073793e-01   -4.482418709136261e-02   +3.195304522071802e-01; -1.160003190216810e-01   +3.787410594802054e-01   +2.278539469272537e-01   +6.563431899341707e-02   -1.422267030476824e-01   +4.713170942556159e-02   -9.521348231623900e-02   +6.686979499768751e-02   +8.701677949988318e-02   +5.546850379910719e-01   +1.199707182155313e-01   +2.394209398587346e-01; +2.272000017633800e-01   +4.548357824725723e-01   +3.314673973005264e-01   +3.529900089164421e-01   +4.835876942230167e-02   +1.664013316070547e-02   +2.979437876585118e-01   +1.093502666948605e-01   +2.052225438274028e-01   -2.010773449335179e-01   -8.505552271941530e-02   +3.247997311452378e-01; +3.467287002696209e-01   +4.172184079075281e-01   -1.459263664695372e-01   -1.471787425488948e-01   +4.759595851811221e-01   -1.745627584713763e-01   -1.055585389465021e-01   +2.536835805047079e-01   +2.045162658185038e-01   +1.503586500172171e-01   -1.434425514649720e-02   +7.534444291451989e-02; -1.230583684306262e-01   +4.562740549184967e-01   +2.548220633985517e-01   +2.415194924257593e-01   +9.446622895686595e-02   +1.695168249107036e-01   +3.141898770836313e-02   +3.170880513763763e-01   +7.008851527082133e-02   -1.889687195535720e-01   -1.098003015474753e-01   +1.226192414707087e-01];
L3E_L3I_iGABA_netcon = [-4.482918225596449e-02   +2.756372715252211e-01   +3.226632431776337e-01   -1.755968948576582e-01   -8.018908498826723e-02   +1.729618627859605e-01   -1.511834892523541e-01   +2.178239146575027e-01   +7.695489922479176e-04   +5.663886296994632e-01   -3.866030548599131e-01   +4.315817009102808e-03; +2.060936061498492e-01   +3.244909861035820e-01   +2.345542010856231e-01   +1.588592708736341e-01   -3.795993075074195e-01   -3.791708630476869e-01   -1.494950532784410e-01   +1.262427155585347e-01   +4.811799313033712e-01   +2.575917471019331e-01   +3.757331374529391e-01   +1.359088969374197e-01; +2.626206083243732e-01   -1.550745241132367e-01   -2.294243306709791e-01   +6.556282900077284e-02   +3.034976171101728e-01   +3.667930774363313e-01   +6.492835487180172e-01   -7.033127358363123e-02   +2.382079630577359e-01   -1.383726652491035e-01   +6.952045920916819e-03   +3.591902999430051e-01; -7.141365194083947e-02   +3.142770122630533e-01   +4.843612389742490e-02   +1.688143071347825e-02   -1.145244852791709e-02   -9.620099196241698e-02   -1.131421503369474e-01   +3.860421711924187e-01   +3.292983687300938e-01   +1.598846738257668e-02   +4.632470521162592e-01   -1.817863011763912e-01; -5.030922160307695e-02   +6.607316356121108e-02   +3.922509546808007e-01   -2.117643449086524e-01   -1.208930980517584e-01   -6.207083385926003e-02   +5.095385796383286e-01   +5.589942177367696e-02   -1.181340330470749e-01   +1.582673387406400e-01   +1.875677279091915e-01   -5.024719503381652e-01; +1.831697106097239e-01   +3.823128148023404e-01   +8.371329620625463e-02   +4.423203714832868e-02   +3.423013783846043e-01   +5.411530119615419e-02   -1.500298801349983e-01   -4.177344334903198e-01   -2.138311095738613e-01   +1.029340205941703e-01   +1.751107868149511e-01   +4.397606072735870e-01; +1.621251616471718e-01   +3.683903294339298e-01   -1.207628683113693e-02   -1.717105940688068e-01   +3.812090079883622e-01   +3.009788614766170e-01   +1.080568945900535e-01   +4.120928301456991e-01   -6.823065194487936e-02   +1.403666129041835e-01   -1.728716265129058e-01   +3.090326542139204e-02; +7.102919043732449e-02   -5.130820565524894e-02   +5.373760632474540e-01   -1.787227718208645e-01   +2.402426699706067e-01   +8.353568973081671e-02   -1.991149390496647e-01   +1.491119443251821e-01   +3.440166419095959e-01   +1.684127110731628e-01   -3.780612094659183e-01   +5.670102807649297e-01; -4.379245691001448e-02   +2.260175064715312e-01   +5.718859559221728e-03   +2.146228518794054e-02   +6.161522076160753e-02   -2.914996133266811e-01   +4.239971156063728e-01   +6.263323785202315e-02   +3.591972795689155e-01   +2.191363442529767e-01   +2.440550297456257e-01   +5.167316964069310e-02; +2.149848139355816e-01   -9.921110186188264e-02   +1.853354477607566e-01   +9.469407684836030e-02   +6.757297885826882e-02   +1.832578566982508e-01   +1.290997950226069e-02   +7.962148408141922e-02   -3.457566913021619e-02   -1.502814326757664e-02   -4.113847941504888e-02   -9.354040492367180e-02; -6.461610135274926e-02   +9.157590421995541e-02   +2.087478382008508e-02   +1.291868940765929e-01   +4.166564361236899e-01   +1.270767308151608e-01   +2.683611175713367e-01   +3.385794453359798e-01   +2.742369332824404e-01   +1.778526155927751e-01   +2.104713182424946e-01   +4.419867206147950e-01; +2.688235342372866e-01   +1.088128487650943e-01   -3.638334945156001e-01   +1.936906762692115e-01   +3.790371814340493e-01   +3.879923240147540e-01   -2.332782994080462e-01   +1.131923043984598e-01   +4.381105792521294e-01   +3.295832345495229e-01   -1.374185466373042e-01   -3.109893300477500e-02];
L2E_Input1_iAMPA_netcon = [+2.919076200809401e-01   +8.763306590605949e-02   -2.801936920291878e-01   -1.593765554460659e-02   +9.420696362362886e-02   +3.546409420421596e-01   +1.433306951242554e-01   +2.813372869667357e-01];
L2I_Input2_iAMPA_netcon = [+5.015832458317947e-02   -1.842770838132637e-01   +5.209674778673603e-01   +1.305236297231478e-01   +3.029931483356431e-01   +3.189767911121671e-01   +1.869357852477195e-01   +6.514847865642846e-02];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 60*((exp(-10*((t)-( 50))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 60*((exp(-10*((t)-( 50))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
