function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-4.814663873608790e-01   +3.841952971125295e-01   -4.174125837511026e-01   +2.000005917195922e-01   -7.001445565265838e-01   +2.054444951293456e-01   -1.751867961024451e-01   +5.677469604329821e-01   +1.519191328725006e-01   +3.199278322870163e-01   +4.771937584268988e-01   +6.234911031764397e-01   -4.330447067316373e-01   +7.439099987524083e-01   -4.972109412585331e-01   +1.361238546196631e-01; +7.788714624797879e-01   +4.091078747915266e-01   +3.034465271202355e-01   +6.452564328117314e-01   -3.359126950372942e-02   +1.052590765373730e-01   +5.183171622435461e-01   -4.056556993974134e-02   +2.122403637458888e-01   -7.834090513071600e-01   +7.852603932128379e-01   -5.042803399643113e-01   -3.300231220672268e-01   -3.518028010463335e-01   -7.201164292467888e-02   +4.860109797398161e-02; -5.002071287260077e-01   -2.105229653108144e-01   -3.715341563932717e-01   -3.177167513919292e-01   +6.615679361388368e-01   -4.059072825401138e-01   +5.292893113043046e-01   -4.214051525608010e-01   -8.241379261436015e-01   -7.701158628355154e-01   -3.426287334860478e-02   -1.607584718202793e-01   +1.574938508546066e-01   -3.224083651707171e-01   +7.863027932282447e-03   +4.261450741039672e-01; +7.179985725637072e-01   -6.853365679694017e-01   +5.600581075553760e-01   +3.671829749729220e-01   +9.469233647633322e-02   +6.279079400537324e-01   -4.203298835666204e-01   -1.256281987482682e-01   -5.488484302072312e-01   +2.284150062407834e-01   +4.408163373399286e-01   -7.037661581522058e-01   +1.743747777003837e-01   +4.218573223107858e-03   +1.586750806466610e-01   -8.269547191682743e-01; -2.243644369939924e-01   +5.265999164532367e-01   -3.043445906965080e-01   -1.732151593753282e-01   +2.032036165895060e-01   -1.154858528622445e-01   -5.504952364009904e-01   -8.538896313161879e-01   +4.380828494260879e-01   -3.569412659613164e-01   +4.048817057473726e-01   +4.324422271141185e-01   -2.071426530736984e-01   -1.744442837249791e-01   +4.836940621444772e-01   -1.772669849876019e-01; +1.969431574426410e-01   +6.505546036502689e-02   -9.952423538209841e-01   -5.268974494044333e-01   -5.253451674308429e-01   -4.022246489263840e-01   -4.416966931882683e-01   +2.330558660834705e-02   +4.604660855333997e-02   +2.418224833774836e-01   -2.732027124642669e-01   +2.559413694098869e-01   +8.156534976956642e-01   -2.300309900745929e-01   +7.610791509492142e-01   +4.362108007683936e-01; -6.318062479301280e-01   -2.355182248493159e-01   -9.670345452441481e-01   +3.974224529141354e-01   +1.077628376895695e-01   -7.666668315336259e-01   -3.646557835910194e-01   -4.344339718781115e-02   -7.147799944650657e-01   -2.649029642876769e-01   +5.170621993981237e-01   -1.493045175172940e-01   -2.993141089471622e-01   -3.991859035097320e-01   +7.085982370374242e-01   -8.737961930854070e-02; +6.856536322035296e-01   +5.768866519013496e-01   +4.267163516442842e-01   +2.603830682099223e-01   -6.724852719668867e-01   -5.820271972386899e-01   -5.545059479073942e-02   +5.396574828966069e-01   -5.004889640218110e-01   -2.695228056976560e-01   -6.687257519752102e-02   -4.127629036176908e-02   +4.994819146496140e-01   +4.984362009980606e-01   -3.531878755118327e-01   +4.575599314180086e-01; +1.330330503441927e-01   -3.452770651521790e-01   +3.175881183939427e-02   -7.483098449564147e-01   +3.178341525130111e-01   -2.629051886877480e-01   -1.619218562965853e-01   -1.638854690459380e-01   -2.012948302666575e-01   +4.490327288551488e-01   +2.381425429471301e-01   -4.462716837504181e-01   -3.652218643566170e-01   -3.360883507669894e-01   -5.742997967860707e-01   +1.178005515804853e-01; +4.845581541896631e-01   -4.050878898482555e-02   +1.864415976454310e-01   +1.377692890476852e-01   -7.218002757064175e-01   +3.997652368328983e-01   -9.259602146032425e-01   +3.095180549610499e-02   -2.660856276238688e-01   +4.949378587550748e-02   +4.769386751805879e-01   +5.089672324131082e-01   +2.469953436487365e-01   -2.390661609350621e-01   -3.429278399432312e-01   -5.265206428553887e-02; -1.781786971582951e-01   +7.054456509707545e-01   -3.382393093706254e-01   -6.365626116866380e-01   -8.651844357042214e-01   -3.282050822714317e-01   -5.153910711373255e-02   +5.956316690745429e-01   -5.078705366237866e-01   +5.143607382927574e-01   -4.080685693212188e-02   -4.729292581290797e-01   -1.768840725739918e-01   -6.101698174355685e-01   -8.205132900809198e-01   -1.000000000000000e+00; -5.264187927449011e-01   -4.778995848070590e-01   -8.164949869077924e-02   +2.521126193978455e-01   +5.255702509245559e-01   -1.308944831525319e-01   -5.232896603244496e-01   +4.477811220450071e-01   +7.879865518409113e-01   -1.923417644313966e-01   +1.538527513467932e-01   +5.531737955876601e-01   +2.600139116920470e-01   -1.058966256413334e-01   +5.339807816296219e-01   -1.907232332498220e-01; +8.002102814615882e-01   -2.299675450201709e-01   -4.142352109126604e-01   -9.029117437165010e-01   -2.213685989603668e-01   +3.092612262232205e-01   -6.248700486617433e-01   +2.720241365592495e-01   +4.646643468904638e-02   +7.238930435662525e-01   -4.356177301489718e-01   -3.002473505814597e-01   -4.704878083909914e-01   +2.478557725830668e-01   -2.758228464751969e-01   +6.808846221635425e-01; +4.020689188040529e-01   -3.573149548330323e-01   +4.808753585100921e-01   +1.128092768101147e-02   -3.051709738686865e-01   +3.765415832015128e-01   -2.566347916053711e-01   -3.160856179984628e-01   -3.322997714476212e-01   +3.928949888581597e-01   -3.024078534178711e-01   -2.355948071318693e-01   -2.973987281398630e-02   +6.161383366514540e-01   +5.011944832677400e-01   +5.912169576534614e-02; -1.851900182317414e-01   +6.334518019535043e-01   +3.857405932274627e-01   +6.046025823258460e-01   +6.601526681175730e-01   +5.450470001963659e-01   +2.622544730414459e-01   -6.115225965000612e-01   +2.498693279203533e-01   -2.244349503487585e-01   +6.336020935695186e-02   +2.577813269239544e-01   +2.325494751308428e-02   -4.022381526694707e-01   +1.627125677603104e-01   -1.259921159173266e-01; +1.296310332502124e-02   -2.751455783499664e-01   +7.685773697914334e-01   +2.755182988890626e-01   +5.758737037579701e-01   -3.762029832360704e-01   +3.106577356546926e-01   +1.661063666400228e-01   +5.969437154625946e-01   +5.896369635912069e-01   +8.921982149006853e-01   -2.945949574702052e-02   -6.082882750076213e-02   +5.141580637868822e-01   -3.633619437127620e-01   +3.649521743492762e-01];
L1E_L1I_iGABA_netcon = [+2.994178015998082e-02   +3.917904855692617e-01   +1.130398487711501e-02   -5.788860333014420e-02   -4.232612967560180e-01   +6.913347725593910e-03   -5.599479129771329e-01   -1.776561785170304e-01   -9.110528509535018e-02   +5.352407579601782e-02   -4.493305572622033e-01   -6.997611467547593e-01   +3.024800313270171e-02   -7.315875129528141e-01   +4.903532255231707e-01   -1.813494904603574e-01; +4.488213448161048e-01   +2.170061014280885e-01   -4.729066844371219e-02   +2.759047967518353e-01   +2.327555927763002e-01   -3.899748847845169e-01   +1.187486066900734e-01   -4.074922421136100e-01   -7.495448500693435e-01   -1.904140069975370e-01   +8.775040824465652e-01   -1.148980355841501e-01   -9.208332888936677e-02   -1.583389594071190e-01   -4.490161291586744e-01   +1.742741722310136e-01; -5.453724265609888e-02   +5.090686271567313e-02   -1.548884863729368e-01   -6.343649592204658e-01   +3.949153224456921e-01   +3.109829073325572e-01   +3.145691517168120e-01   +5.832647271018638e-01   +9.678654342706894e-01   +4.185094769050500e-02   +3.172950696955414e-01   -4.461737147060736e-01   -5.292000369743293e-01   +3.199226911490080e-01   +1.395312030381047e-02   -3.628473121596435e-01; +6.227115557250587e-01   -4.084194351731337e-02   -2.916332900074444e-01   -7.881985798129625e-01   +8.162982262926541e-02   +7.622782069166036e-02   +7.379721619234714e-01   +1.835106137336697e-01   -3.790326862233315e-01   -4.259090820682312e-02   +1.134468149173731e-01   +3.788268085757833e-01   -3.577313278008693e-01   +3.767159792603292e-01   -1.580243562738975e-01   +3.657507858033956e-01; -5.925045186917528e-01   -4.155235187223513e-01   +6.202388477133708e-03   +1.777761133184961e-01   +4.046888841310104e-01   +2.158337697893252e-01   +1.382863971753835e-01   +7.408921408536383e-01   +7.172889522498893e-01   -2.535695232191785e-01   +5.232002836768329e-01   -9.257741640282763e-01   -1.639171060474096e-01   -7.377427544009364e-01   +6.440096780611286e-01   +1.547493919072612e-01; +3.119303737922946e-01   +1.327536896299171e-01   -5.458588543330745e-01   -7.346023457783737e-01   -4.269869137398591e-01   +5.962916684811732e-01   +1.306634317191773e-01   -5.755222393333005e-01   +2.400804802086246e-01   -3.561778039027964e-01   +5.619329320222470e-02   +6.780869950876092e-01   -2.618592955705474e-01   -2.582477249630196e-01   +3.781647373414135e-01   +2.111829078198519e-01; -4.292148387202901e-01   +3.681258716306930e-01   -4.142546861775177e-01   +3.024104934010267e-01   -7.465808181655664e-01   +2.553865732632378e-01   +1.214129628795919e-01   -3.935658018497707e-01   -2.082396815584543e-01   -3.798879653059480e-01   -7.831824784745957e-01   +4.286226043653650e-01   -8.038619995957020e-01   -5.854153976783021e-01   +4.850314390620037e-01   +8.106578095538426e-01; +3.626846793228472e-01   +7.028871112403718e-01   -2.121050058959309e-01   -4.149004338380303e-01   +6.674574402638728e-02   +7.231192609310995e-02   -3.867984978858322e-01   +8.638694150735071e-01   -2.683451197481226e-01   -4.548375858164181e-01   -1.450497019652389e-02   -9.465949299116443e-01   +7.133894916453386e-02   -2.799723442848628e-01   -1.313453494801849e-01   +2.957170439840776e-01; -1.334720831641841e-01   -2.028198088142277e-01   -4.813959039618647e-01   +3.171098062100530e-01   -3.035182341541727e-01   -7.031902023884018e-01   -6.434418702791520e-01   -2.835200537152344e-01   -3.440885431231715e-01   -2.414546943506275e-01   +1.806408368582419e-02   +2.850254148942560e-01   +2.618294567191339e-02   +1.638551511380717e-01   -1.891901500737024e-01   -3.127666632887686e-01; -5.375037143651269e-01   -7.723232383201668e-01   +8.247397454742164e-02   -1.366615863237971e-01   +4.706745238275820e-01   +1.860917653073284e-01   +2.137140720601180e-01   -2.101729870577754e-01   -5.348054369449032e-01   +3.579352252493813e-01   +6.941868685506834e-02   +2.439249401478648e-01   -2.867530799620116e-01   -2.957688647895955e-01   +7.810261596555612e-02   -3.899824760820816e-01; -4.183423038568822e-02   -6.826603130664509e-02   +2.891243054382433e-01   +7.653200721919920e-03   +5.046035500770768e-01   +3.550768054632727e-01   -4.814848552073495e-01   +4.476351541064305e-01   +7.283519086880288e-01   -7.969853713218139e-02   -1.298794710651514e-01   -2.061328027725292e-01   -1.161717549652569e-01   +2.181608106856968e-01   -2.092778509861901e-01   -4.941469866664703e-01; +9.033661153470660e-02   +8.532299740427678e-01   +2.055380469841598e-01   -4.319362448155252e-01   -1.782883084876525e-01   -5.373473871051696e-01   -3.363695680894910e-01   +1.457260005065344e-01   -1.530613017615463e-01   +8.057721907210702e-02   -4.137588211444061e-01   +2.250810637396275e-01   -1.952336096549913e-01   -3.501731927943807e-01   -2.053994008398931e-01   -6.376973132164599e-01; -7.835692991297720e-02   -2.042150207683961e-02   +5.838273650727288e-01   +7.964782512851180e-02   +6.526059824225965e-01   +3.171827324707742e-01   -4.966110731664503e-01   +1.104400939393184e-01   +5.854284371904166e-02   +3.954110354708206e-01   +5.762180978013468e-01   +4.216545227817121e-01   -4.419022904267092e-01   +9.546794983751179e-02   +7.902886715556086e-01   +8.536535559977682e-02; -1.868087329360063e-01   +1.449174084624090e-01   -2.378923921583171e-01   +1.059321515294711e-01   -5.380281876271462e-01   -1.149702413090740e-01   +2.260126733155542e-01   +4.215808775186211e-02   -4.601828649706243e-01   +4.955234806494139e-02   -1.511892971877000e-01   -8.178633322681842e-01   -2.866799901397864e-01   +3.377123835707259e-01   -7.642781533155521e-02   -1.130139188529325e-01; +8.205498788146549e-02   +5.400057308860942e-01   -6.484663478614900e-01   +2.462631509771499e-01   -2.274162060244016e-01   -1.087455123313818e-02   -5.250023739499009e-01   -3.546913769059286e-01   +6.583549299928150e-01   +2.726168783994788e-01   -3.604428418501378e-01   +3.332111066909141e-01   +1.957522154468420e-01   -1.165923862445727e-01   -1.155950305979805e-01   -9.426347765078982e-02; +7.075841117724537e-01   +3.672802620637927e-01   +3.405567938803316e-01   +3.352193238079313e-01   +5.004090791941076e-01   -7.260932631681452e-01   -2.735060652249404e-01   +4.445157808067835e-01   -4.533289179505927e-01   +1.942719538009225e-01   -2.041340932340922e-02   +2.331677902084736e-01   +1.000000000000000e+00   -4.985136619867498e-01   -6.301338384694644e-01   -3.776611858487297e-02];
L2I_L1I_iGABA_netcon = [+6.247129332318849e-01   -5.701454282179867e-01   -4.126715944960411e-01   +6.164420659511166e-01   -6.011093069084338e-01   +3.857320718591905e-01   -1.988345175407635e-01   +3.925743188061729e-01; +5.889369090045395e-01   -5.759412956528154e-01   +5.960817116469513e-01   +6.749411248202227e-01   +7.269024714579555e-01   +4.649133810230416e-01   -4.134597659259715e-02   +4.360378619161820e-02; -5.872024864167667e-02   +6.068316249381870e-01   -1.315625032360696e-01   +3.531958544678811e-01   +4.304446116324522e-01   +6.473123522251215e-01   +7.663337739214329e-01   -4.474114017748230e-01; -1.696222096649417e-01   -3.862843435981990e-01   +1.669597762368772e-01   +2.793823684415834e-01   +1.428920773116128e-01   +4.796500647902349e-01   +3.286639124284324e-01   -5.592625636807002e-01; +9.323505491980519e-02   -5.422862161120261e-02   -4.367480239729753e-01   +4.307886380748646e-01   +7.087382853868768e-01   +2.850329632304650e-01   -7.698970057197554e-01   +4.924817352807765e-01; +2.258146663712605e-01   +4.879522916374487e-01   -6.175707961830840e-01   -3.759687867434761e-01   -5.871282760181386e-01   -2.165970499450793e-01   -9.037528584144326e-01   -3.859587433319941e-01; -8.700703795484213e-01   -9.521968557507535e-01   +2.398817408194761e-01   +6.631129109572340e-01   -8.999247117980812e-01   +9.727397667258746e-01   +1.911503419064738e-01   +3.701537117654041e-01; +7.303907737992938e-01   -2.540374286635454e-01   +3.337088504265504e-02   +8.456650666834097e-01   +1.559961802976608e-01   +1.645710857083909e-01   -2.221518034869686e-01   -5.576451702447714e-01; -1.007244002603779e-01   +3.003730119176490e-01   -5.531986006075250e-01   -6.429378732412974e-02   +3.377866385782898e-01   +1.232683181631271e-01   +1.955762270532044e-01   -2.253385542690038e-01; -1.346245637670016e-02   +4.048223061528584e-01   +2.212294125217096e-01   -1.000000000000000e+00   +5.532628057015807e-01   -7.108076957411239e-01   -6.749850847000695e-02   +5.733775313132505e-01; +7.545629930505346e-01   -1.069185978523148e-01   +6.447100960591796e-01   -7.424384077394135e-03   +4.951102671714830e-03   +6.034729451977742e-01   -5.807149414051042e-01   +7.498803951628955e-01; +7.962584512930579e-01   -8.727000041459894e-01   -5.145790395251336e-01   +9.274170563715632e-01   -2.623835156123099e-01   -3.432910735225834e-01   +3.936354843893255e-01   +8.026501246714579e-01; +7.887821283356076e-01   +1.091156646953140e-01   -2.357435360786028e-01   +5.234225925444450e-01   -2.891237146974715e-01   +5.599069025474959e-01   +3.802580625141133e-01   +3.160809190382003e-01; +5.132776016089089e-01   -3.053828620671381e-01   +4.971484534089446e-01   +7.730419818493485e-01   -6.730984825862757e-01   +2.603784350404708e-01   +3.701960794996795e-01   +8.908427112452073e-01; +5.856474203394935e-01   -8.724874651485146e-01   +1.144406882237462e-01   +1.152483177229127e-02   -5.199502440026282e-02   -1.165900846741969e-01   -4.518208242985114e-01   -5.906819031768145e-01; +5.921113158211305e-01   +7.074206662273028e-01   +3.316878129337107e-01   -7.341689202250472e-01   +2.765751954375817e-01   +6.624359614853591e-01   -9.853608325888019e-01   +6.583208106566041e-01];
L1I_L2I_iGABA_netcon = [+3.795420788354574e-01   +1.901921738655487e-01   +4.235630231676722e-01   -4.078961984621813e-01   +2.003884827343320e-01   -3.443555578196627e-01   +1.077581434289000e-01   +3.349175137447975e-01   +1.144159455870992e-01   -2.456965416285375e-01   -3.267837665724829e-01   +5.033955536793185e-01   +7.314203859035381e-02   -2.586737072181524e-01   -4.030683076454433e-02   -2.117715238929234e-02; -3.346082644272437e-01   +1.013939908797631e-01   +1.067503649833556e-02   +1.902693122079168e-01   +1.957919005110535e-01   -5.234319739213352e-01   +4.036673487723881e-02   -2.739517059381074e-01   -6.087536045995467e-01   +3.817038908997216e-01   -6.254854825214682e-01   -8.267032084413573e-02   -9.251040724823481e-02   +5.948878084426694e-01   -9.499851454914236e-02   +4.586168493164810e-01; -2.261811077595130e-01   -8.661369896985562e-02   +1.161163344256149e-01   +4.686048252150924e-01   -1.085580388528583e-01   -2.295662845271238e-02   -4.008717989975027e-01   +4.522074328779774e-01   -2.838390626227155e-01   +1.780303104623953e-01   +3.343845492132049e-01   +3.911832483825895e-01   -9.176824150546264e-01   +7.183143978202017e-02   +3.857604170637865e-02   +2.426043934756355e-01; -6.968137976734123e-01   -2.503065199922561e-01   -3.967029266517073e-01   -6.895257007813378e-01   +1.765805340859175e-01   +6.182694525957351e-01   +5.088510900489864e-01   +8.148791946400219e-02   -3.063336480555003e-01   -1.000000000000000e+00   +9.790835430432482e-02   -6.469279430964572e-01   -6.212631956639181e-01   +8.974034763612642e-03   +1.280468338035551e-02   -8.280040031711038e-01; +9.772489539945094e-01   -2.814306664194279e-01   +3.159824224595415e-01   -2.092189171908127e-01   -7.700262674913851e-01   -5.510371226981736e-02   +4.619103642700613e-01   +1.609547608337527e-01   +2.222136453794152e-01   +1.030883578316945e-01   -1.885578416362231e-02   -3.485620579670724e-01   -6.759698142851308e-01   -3.083042310198885e-01   -3.949361320667172e-01   -2.147005730342592e-01; +3.194894093191567e-01   -2.820202037289742e-03   -6.994689049236915e-01   +4.084236307457045e-01   -4.245073186063301e-01   -2.952996532623171e-01   -4.333264039058191e-01   -4.261629316671300e-01   +3.204263910426404e-01   +4.647175472863669e-01   +4.117272786305969e-01   +1.917932033641115e-01   -1.107104402049798e-01   -1.966634604370009e-01   -7.476365056304525e-02   -3.585651347646662e-01; -4.171957030412826e-01   +3.482213029843894e-01   -1.834798623917815e-02   -1.816455963750686e-01   +3.461539283668633e-01   +2.106617454465207e-01   +7.999305235617861e-02   -1.603987525781155e-01   +6.034015436172619e-01   +3.293260081397019e-01   -3.401333500166041e-01   -2.869490507216403e-01   -1.840021889632408e-01   +2.315251199133086e-01   +3.156873766403123e-02   -2.988640280439823e-01; -5.844198275190120e-01   -2.660550897390884e-01   -6.512292815221508e-01   -7.911508796463997e-02   -1.915355130789475e-01   +9.301845333084077e-01   +5.453289717317952e-03   -9.332632777712649e-02   +7.267459820493647e-01   +2.599394883396076e-01   -6.529671038354433e-01   -4.212695658288349e-01   -1.343233260699035e-02   -4.466530751299768e-01   +1.592209341093365e-01   +3.111831002736081e-01];
L2E_L1E_iAMPA_netcon = [+1.114287847352473e-01   +2.371111432403554e-01   +1.311048710215355e-01   -1.654004796283411e-01   +1.557604692415566e-01   -1.620108322526251e-01   +8.367056076054565e-01   -3.834234056462979e-01; +8.481187258383814e-03   -2.610733375636169e-01   +5.605333878796332e-01   -5.621468615709143e-01   -5.452409827414437e-01   -7.625169354762273e-02   +3.060374395973834e-01   +1.516716069478898e-01; -6.535493996237121e-01   -5.965591027866536e-01   -1.177390757873475e-01   +6.767178590006951e-01   +9.298473964473873e-01   +6.962948650714053e-01   +1.253489910221691e-01   -2.980905622078642e-01; -4.131969765716970e-02   -3.184496712688372e-01   -4.947238465098984e-01   -8.797402398160693e-01   +5.829712111433769e-01   -3.436471805430344e-01   -7.554665999592499e-01   +3.697499607182057e-01; +2.042161362762419e-01   -1.611733916089730e-01   -3.634468504214352e-01   +1.486371989295538e-01   +9.840344795378335e-02   -3.107436494673221e-01   +7.259291987386642e-01   -2.379067980462500e-01; +7.016307187761633e-01   -4.906561919925385e-01   +6.958097782605118e-01   +4.034691568532269e-01   -3.173556499309190e-02   +4.639813383926154e-01   -5.441324941312542e-01   -3.996638633569711e-01; +6.274890656475406e-02   -1.752588967845975e-01   -4.441270616163260e-01   +4.695938215811125e-01   -1.831140869008546e-01   +1.291250060896194e-01   +9.699197654443561e-01   -8.185104069530583e-01; -1.987270710465512e-01   -1.257106116027684e-01   -4.085489510263094e-01   +4.501150700859155e-01   -3.185924791876472e-01   +2.208597996146375e-01   -8.244303322640195e-02   -1.637761835216904e-01; +5.851749720384500e-01   -3.852666961251712e-01   +8.056412500790278e-01   -1.092591219830695e-01   +2.558179088008604e-01   +5.099372489571249e-01   +2.148519018340040e-01   -1.893096117435062e-01; +1.054243939126484e-01   +6.317989415808563e-02   -7.326040199802133e-01   +4.489359430000769e-01   +1.091278157790714e-01   -4.288577283932630e-01   -4.010739297044167e-01   +5.146297405476994e-01; -4.238049271188420e-01   -7.866122253226725e-01   +5.033639194381523e-01   -4.460462434922345e-01   +2.199974287293737e-01   +7.845188045278911e-02   +3.720402035992453e-01   -9.043878033945175e-03; +8.372565300892043e-02   -4.222382810775761e-01   +4.970322326026633e-01   -5.767615890219240e-02   -9.616246873199734e-02   -7.781224122321379e-01   +4.614111378283992e-02   +4.397328425883252e-01; -6.872216105859393e-01   -3.421087752253024e-02   -5.458288756755871e-01   +8.371025106734382e-02   -3.074737946118389e-01   -2.858620654652581e-02   -5.047015649782073e-01   -3.420417525143217e-01; -3.595237556935394e-01   -6.250676187953375e-01   -4.845413897463187e-01   -1.000000000000000e+00   +1.992495664417339e-01   -6.591563351435246e-01   +3.659036556656992e-01   +3.793404570741010e-01; +6.574193048124708e-01   +3.139203991479184e-01   +8.737422200469397e-01   -1.762643706866281e-01   -1.716629569980182e-02   +6.297018351215656e-01   -4.806480135634547e-01   -6.647157230370086e-02; +1.938151400108592e-01   +7.858970776662462e-01   +4.586001522300286e-02   -5.385463015143063e-01   +2.677518859999126e-01   +6.054073010556647e-02   -6.835408048919931e-01   +1.695706400105093e-01];
L1E_L2E_iAMPA_netcon = [+4.625499505947373e-01   +4.422584646964742e-01   +2.462550649278655e-01   +8.558965347193938e-01   +2.500428740344487e-01   -1.949167619262573e-01   +4.999949106992727e-01   -3.456666860330355e-01   +5.986297676549198e-01   +4.231464625356364e-01   -7.264843494383709e-01   +7.831478608311697e-01   -5.007779598912246e-02   +5.077720920010794e-01   -2.872130607149050e-01   -1.870941522873494e-01; -3.486290472892623e-01   -3.515761308446781e-01   -2.851438080142187e-01   -1.140834638188330e-01   -9.322272688965035e-01   -2.636681155809059e-01   -1.434464605195800e-02   -6.112000756198290e-01   +1.812804584798162e-01   +1.297382718602721e-01   -3.382219989018613e-01   -3.056062199650800e-01   +2.007952033404743e-01   +9.106628022001358e-01   +4.186497651841218e-01   -9.180749009393547e-01; +1.038267675538043e-01   +5.539468711824521e-01   -4.417440847302458e-02   -3.783851325156607e-01   -4.175600013711349e-01   +1.543300654532415e-01   -6.197620893167161e-01   +1.488973579669332e-01   -3.832898495800962e-03   +7.804076783756526e-01   -6.295574829746355e-01   +2.525308416911590e-01   +1.000000000000000e+00   +4.193143275980676e-03   +1.736003548146751e-01   +5.596759548440453e-01; -1.078889906034725e-01   +4.910850099973347e-01   -4.080331432801117e-01   +5.995682759179333e-01   -5.387266206438718e-01   +5.750391600761877e-01   +3.802791266877400e-01   +5.554606770826718e-02   -6.782057809412791e-02   -1.134621825917646e-01   -6.065174878337700e-01   +2.387680614642809e-01   +2.803626559139440e-01   -5.831121675127152e-01   +3.083927413165011e-02   -8.809530316634094e-01; +1.016376237429819e-01   +5.154479355361863e-01   -6.006961675491476e-01   +3.091974281625507e-01   +2.506788461234123e-01   +3.332830779011663e-01   +8.829085516458159e-01   +7.561806187487353e-01   +1.515100384150122e-01   +8.895126428325671e-01   +1.509629802034450e-01   -6.150645744046208e-02   -9.388192554857226e-02   -7.158532438691043e-01   +4.647860425743303e-01   +6.428804189687579e-01; +4.913856075959679e-02   -2.357036213180683e-01   +1.332834582934202e-01   -1.001362588707642e-01   -2.367493686905112e-01   +3.579478831178630e-01   -5.576916636449691e-01   -2.284848605628905e-01   -2.895470729964156e-01   +1.670971530878123e-01   +1.875447341118364e-01   -1.689107100120767e-02   +2.885803707852207e-01   -3.195513084001963e-01   -4.334045453647567e-01   +3.443221855329215e-01; -4.273522205152618e-02   +2.900913651656684e-01   -7.055701765615345e-02   -6.328324118081638e-02   +6.971867722225654e-01   -1.423777081343545e-01   -2.276917423334994e-01   +3.588543543260470e-01   -5.294867540257647e-01   -6.217486277737472e-01   +7.721161480672503e-01   +5.789222086178003e-01   -3.977490363807084e-01   +3.645878525137644e-01   +2.602276848033175e-01   -9.126386046901924e-02; -4.465377843469350e-01   -1.847423273798382e-01   -4.147743344642271e-03   +5.352058069478041e-01   +1.599526735894542e-02   +3.996784377758922e-01   +6.685070395695242e-01   +1.298902613213433e-01   +1.129387281242824e-01   +2.989421719645945e-02   +5.126983872693126e-01   -3.457471882502000e-01   -5.603007493677389e-01   +1.718182992672516e-01   -4.322454930879809e-01   -5.791210336273063e-01];
L2I_L2E_iAMPA_netcon = [-1.127538278551817e-01   +7.932380206987771e-01   -8.601780362195887e-01   +4.713459258558850e-01   +1.226011574564032e-02   +1.326526074586564e-01   -2.959508935679929e-01   +1.645608146129740e-01; -2.165492895860743e-01   -9.212133605501692e-01   +4.799918104630399e-01   -3.865276608605677e-01   +4.753703341684629e-01   -2.733445142707797e-01   -3.975483701598173e-01   +3.633091577300898e-01; -3.031215496857450e-01   +5.798022647326559e-01   +1.564357382840637e-02   +1.607439068314450e-01   +6.349659224257556e-01   +5.433161368446288e-01   +3.419324135057988e-01   -4.898138341892570e-01; +2.223934841658042e-01   -5.423248870080501e-01   -1.532319820750394e-01   +2.243183694087397e-01   -2.523397549073874e-01   +2.074188583841174e-02   +4.673638460277268e-01   -5.891423254953032e-02; +1.452277559245567e-01   -1.252911672589395e-01   -6.973807081982196e-01   +3.447695237290129e-01   -1.247435991996413e-01   +2.237820940062841e-01   +3.984229484762082e-01   +4.704514464755468e-01; -2.695162215221268e-01   -4.182438202127798e-01   +2.804375827029829e-01   -5.997312030515068e-02   +4.119291032935625e-01   -2.068342216042790e-01   +1.000000000000000e+00   -2.827211469775977e-01; -2.786175057015967e-01   -3.057546611904844e-02   +1.127499756468810e-01   +2.377353261491733e-01   +2.295728414011040e-01   -2.971952200326071e-01   +4.381714839669331e-01   +2.460297072325684e-01; -2.759115665571167e-01   -8.282598790350286e-01   +6.943783184967176e-01   +1.240368942173495e-01   -1.707533543491133e-01   +3.571301539793222e-01   +5.817918917513833e-01   -3.720667657180026e-01];
L2E_L2I_iGABA_netcon = [+3.452168894519609e-01   -7.680875358162051e-02   -2.951869717479661e-01   +3.931653806698835e-01   -6.494388774061362e-01   -8.944406838020791e-01   -7.793811733461753e-01   +2.967650154674355e-01; +4.559856395863341e-01   -3.135540710117072e-01   -3.478393233277277e-01   +5.474424010044623e-01   +1.021447788535266e-01   +3.149195071088053e-01   +1.089014085279084e-01   -7.145444520412833e-01; +2.949562783386192e-01   -2.174659273799149e-01   +1.461167672208180e-01   -3.581916735359821e-01   +1.362621088892196e-01   -6.876286182633368e-02   +1.000000000000000e+00   +1.200535920243764e-02; -4.475861840436515e-01   +5.185279621934770e-01   +4.500418893287989e-01   -2.214331818150515e-01   +3.696445084624709e-01   -7.695465546149376e-02   -1.593859128170614e-01   -3.021265269686758e-01; +5.399495579742210e-01   +6.939289025749417e-01   +4.968916949706677e-01   +2.837898262775203e-01   +1.229413287048035e-01   +4.989060927642576e-01   -6.863988775441228e-01   -2.770632859454431e-01; +1.550166035148298e-01   +6.465449976174515e-01   -3.326639262083020e-01   -4.575528528284088e-01   +3.397997901020287e-01   -2.314128314008480e-01   -3.798033297525337e-01   -2.382285770152456e-01; -4.435302672825012e-01   -4.760727105175011e-01   +7.284160619943837e-02   +7.648831508448848e-01   +2.878285574097678e-01   -9.226107799719636e-02   -3.354453385620446e-01   +1.996038292535995e-01; -8.107868689951491e-01   -6.889929007589380e-03   +8.638680670347842e-01   +2.925772331964653e-01   +4.125406269767942e-01   +3.587108905088049e-01   +2.400107824764724e-01   -2.638196812286405e-01];
L3E_L2E_iAMPA_netcon = [-4.001940523749837e-01   -1.242113927383621e-01   +4.858685443292857e-01   -7.163594818312543e-01   -1.396651487406630e-02   -8.703990006800238e-02   -2.081574639864930e-01   +4.237105821428938e-01   +5.258678800978070e-02   -2.449698787918908e-01   -4.211909929556282e-01   +5.275205520169848e-01; -6.250001693136209e-01   -1.798978280894761e-01   -6.623146487625745e-01   -2.656593266842338e-01   +2.653389579242124e-01   +1.000000000000000e+00   -7.400080862651622e-01   +3.184034169914726e-02   -8.961886972310470e-03   +2.592516589608580e-01   -6.905916189764584e-01   -2.343088245811803e-01; +1.100284235276155e-01   -2.326012438764716e-01   -8.586576966467496e-01   -7.265880016367615e-01   +2.207256013709495e-01   -4.161887781242676e-01   -3.489613605637428e-01   +6.326335548324196e-01   -9.584572858130361e-02   +6.656991204246393e-01   +7.729249591609384e-02   -8.180037514770622e-01; -3.747108042799021e-01   +1.170248248725458e-01   +5.331193763181791e-01   +2.969130531827083e-01   -2.499968243260788e-02   +5.843681880783951e-01   -5.268371241399854e-01   -6.702448012922837e-01   -7.567526442285735e-01   -2.346767982308469e-01   +3.292697905150436e-03   +5.930989452629591e-01; +4.107912418274443e-01   -5.215709202187276e-01   -5.834018466381632e-01   +2.699549565420551e-01   +1.939292606367360e-01   +3.058959033685895e-01   -8.520823652667122e-01   +4.667763095982468e-01   -3.787214071214221e-01   +5.227325987817306e-01   +2.602406312105710e-01   +6.139324791456812e-01; -2.983763281047854e-01   -1.882047674569886e-01   +5.863564307384571e-01   +1.446621205725390e-01   -5.521967850063814e-02   +5.032716012856835e-01   +4.914402475958086e-01   +5.413225329872839e-01   -5.589435997184075e-01   -7.739792199208380e-01   -1.076174130892252e-01   +8.371239015752496e-01; +4.975847342288618e-02   +2.361523174710885e-01   -8.245819916391277e-01   +7.416579487011220e-01   -2.090315989761205e-02   -4.777889031566669e-01   +4.402364861444991e-01   -7.961355638289953e-01   -1.350692967330711e-02   -7.550027476890220e-03   +9.524287569408445e-01   +2.693721770705819e-01; -1.737186194171117e-02   -3.119919189775044e-01   +2.433432792052912e-01   +8.846557098249025e-02   -1.379974797003366e-01   -5.819486909326534e-02   -2.833082549608042e-01   -2.851481868983566e-01   -6.338812734821593e-01   -3.882423344837149e-01   -5.214025576481230e-01   +7.542971451024675e-01];
L3I_L2I_iGABA_netcon = [-9.862623995123956e-01   -4.247291418441023e-01   -8.037797688508540e-01   -8.148538006917037e-01   -6.052705666096713e-01   -6.980769854675258e-01   +9.675697300581971e-03   +3.713944349376503e-01   -4.803800781693064e-01   +1.025344938212807e-01   +1.528044373526732e-01   -1.735310514889279e-01; +1.687909669065044e-02   -1.262092805889909e-01   +7.402721790043058e-01   +1.203092508734300e-01   -3.617818961186251e-01   +4.412131353632213e-01   -1.595983065867824e-01   -3.170285444542452e-01   -1.472737176740180e-01   +4.248531157836456e-02   -1.826196440146918e-01   -7.964460048103358e-01; -4.066661477290980e-01   +9.593961847420061e-01   +2.706162010136509e-01   -4.357733960038603e-01   +6.138043256652134e-01   -1.953510490725866e-01   -6.459950731915645e-01   -3.394169889402042e-01   +6.055724112704366e-02   +5.555557352857092e-01   +6.397439855163166e-01   +2.762765983737009e-01; -1.000000000000000e+00   +1.115511222959691e-01   -1.097184241210170e-01   -4.835574984282894e-01   +9.500680744735070e-02   -1.414132010177181e-01   -5.058336854429735e-01   +4.834695354346507e-01   -3.262752728612640e-01   -2.546358038871154e-01   -3.461143909181238e-02   +6.006089770579739e-01; -5.900333232336620e-01   -5.664314855825252e-01   -3.879289797490280e-01   +7.633127037686432e-01   -6.079837221808815e-01   -5.785739990546087e-01   -9.933640666574357e-02   +4.394824898670894e-01   -3.999340048732516e-02   -1.735049896932659e-01   +5.272834986538666e-01   -8.883073983183705e-02; -5.230592357977140e-01   +3.649026764492210e-01   -5.486381470606119e-01   +2.773959960123061e-01   -5.656338816861943e-01   +2.575962862730067e-01   +6.196875014877178e-01   +5.263804675814648e-01   +6.789021587338409e-01   +6.723245075038261e-01   -9.249031151131633e-01   +6.041921234806123e-02; -4.882650822965403e-01   +5.326511177660123e-01   -1.539618838346042e-01   +5.121517130755984e-01   -5.833864242701601e-02   -4.449899726282714e-01   -6.704710434907705e-01   -1.199653059618171e-02   +5.720527218561097e-01   +1.738335159268152e-01   -5.316782038624397e-01   +5.249374683558878e-01; +7.620610179660312e-01   +2.389860099223820e-01   +4.227065308851485e-01   -1.909086030378856e-01   +5.371260352321350e-01   +6.111799949855052e-01   +3.961339432254196e-01   +5.139997264602693e-01   -5.029595348068010e-01   -5.329759039338451e-01   +5.189555832987020e-01   -4.147444238356137e-01];
L2E_L3E_iAMPA_netcon = [+6.528890031152986e-01   +4.179956395002147e-01   -4.509942069385010e-01   -4.256019880201678e-01   -1.891492851400426e-01   -4.408137121509658e-01   +4.000474421377525e-01   +3.359095777176870e-01; +4.912563509190362e-02   -2.103743617054487e-01   -3.739627138624038e-01   +1.725566575830157e-02   -7.398438384070778e-01   -3.612345331959956e-01   +4.758808335502479e-01   -4.837263631480258e-01; +1.083746267115072e-02   +3.412373694883095e-01   -3.610016162628738e-01   +1.672056650850907e-01   -4.761750667739824e-03   +1.276056066215622e-02   -6.229959378937835e-01   +1.342973952550231e-01; -3.234610055650925e-02   -2.080249438042541e-01   -7.845025147655601e-01   -2.078582638626727e-01   +1.000000000000000e+00   +2.938568396495197e-01   -3.601579086017295e-01   +5.741053533177917e-02; +6.320951752157339e-01   -2.430618134352796e-01   +2.322200407990856e-01   +1.073579036996685e-01   -2.724982885124931e-01   -3.884151394845904e-01   -1.467259127354567e-01   +2.784371085400370e-01; +1.437102172341751e-01   +6.455627242229560e-01   +7.423638540025100e-01   +6.498562878678465e-01   +4.858391522409795e-01   +1.146240343475398e-01   +3.578081327470450e-01   -2.180117430808031e-01; -3.328072648639752e-02   +4.710717730152301e-01   -1.434457346739206e-01   +1.057372813003762e-01   +7.577928182558973e-02   -1.096862587385926e-01   -4.810080622875848e-01   -5.518009378140369e-03; +3.428106147359061e-01   +5.092300081289359e-01   -5.483389127622067e-01   -1.490052372081654e-01   +2.177815970043174e-02   -5.388819253998111e-01   +1.184053008143139e-01   +4.728112673919143e-01; +2.991213532026176e-01   -8.456076363082229e-01   -7.956441104609611e-01   +5.371540159792017e-02   -6.364676630735672e-01   +6.622903296453051e-01   +2.478322521339439e-02   -3.220828265611640e-01; +5.891073381568788e-01   -4.664531474594568e-02   +3.653823690494084e-01   +9.823051220562856e-02   +4.145294421497887e-02   +5.657462728742766e-01   +2.146011919417005e-01   -4.755055282562164e-01; +1.898680929149629e-01   +2.150841378353686e-01   +5.034605256893160e-02   -2.479106740352036e-01   +1.538102118121340e-01   +3.740622940260548e-01   -1.988268643917497e-01   -8.268245582629029e-01; -3.517533487648121e-01   -5.716723252869027e-01   +1.248918362861326e-02   +2.138464182457527e-01   -5.101457525977149e-01   +2.747961634438088e-01   -5.016874442583843e-01   -1.017677843260564e-01];
L2I_L3I_iGABA_netcon = [-6.268371188752914e-02   -1.590533201720348e-01   +2.100351938112493e-01   -1.000000000000000e+00   +3.313293749065493e-01   -6.389433625072486e-01   -9.740324552488751e-01   +7.596198914252686e-02; -1.098512653230268e-01   +1.214849341195784e-01   +3.741045000667187e-01   +5.524363151690544e-02   -3.515620124779336e-01   +1.508736042576030e-01   -2.964431839814082e-04   +3.870939855746035e-01; +4.978346311554743e-01   -7.405325449278435e-01   +5.715423068526832e-04   +1.469319274481501e-01   -4.975290382578192e-03   +3.031612465960013e-01   +1.858190313614540e-01   +9.154912179392236e-01; +7.900375971155212e-02   -4.483819823195446e-01   +3.410557462905441e-01   -3.418315222105556e-01   -2.378943512110284e-02   +9.839736383530542e-02   +9.571099866864392e-01   -1.878996187050527e-01; +8.075061126398859e-01   +5.544348608833248e-01   +5.265100779126492e-02   +2.886068563568619e-01   +7.169067445998260e-01   -8.418083614232670e-01   -2.070068201177988e-01   -2.785137105173097e-01; -3.262231462997117e-01   +5.368804070485412e-01   +7.492356086413353e-01   -5.335739009564767e-01   -7.065900896186188e-01   -1.069174332298740e-01   +4.364308892983074e-01   -1.670605568575664e-01; -5.520539055178707e-01   +4.023389219426820e-01   -1.697105569945981e-01   +1.150237355866623e-01   +6.530424136590772e-01   -4.499209802641167e-02   -4.055517230788087e-01   -3.152954245021006e-01; -1.122699294789553e-01   +2.458716472253562e-01   +8.134266867442971e-01   +4.039140034953763e-01   +5.695075245540641e-01   -6.297919549040577e-01   -2.569016746981828e-01   -4.951217284617729e-01; -8.979119894117188e-01   +4.854708120363388e-01   -7.573273626397803e-01   +1.022951783645227e-01   +2.732201640007951e-01   +3.146408304646216e-01   -1.742211564150526e-01   -3.537464359646746e-01; +4.646179477397058e-01   -4.663421138695973e-01   -2.035621070323506e-01   -1.950923833040569e-01   +1.934066854013262e-01   -8.998644480786414e-01   -8.265069932985426e-01   +5.417242861576242e-01; +8.445774665539263e-01   -2.596621760970641e-01   +2.013435398465541e-01   -1.272881063284528e-01   +2.079802211072138e-01   -5.382162498574110e-01   -6.787106166369288e-01   +4.254986939051296e-01; +4.401332322719257e-01   -1.451236368504340e-01   -7.442766188928319e-01   +2.244560211992012e-01   -1.312230816158047e-01   -4.105658515045779e-01   -2.335816566619559e-01   +3.150425172128578e-01];
L3I_L3E_iAMPA_netcon = [-3.761975557585585e-01   +1.166986150094612e-01   +1.000000000000000e+00   -2.313113028956804e-01   +4.436942350460927e-01   +7.415915029437246e-01   +4.435455824208394e-02   +1.172993384246873e-02   -1.600871260387264e-01   +4.503219617263503e-01   +2.632726232440027e-01   -2.221487381411075e-01; +7.284685338810918e-01   +5.776891349982191e-01   -3.546367071661745e-02   -8.418090818283891e-01   +2.440984289420860e-01   -1.458124644957484e-01   +2.387578516008650e-01   +2.897815719748658e-01   -9.801700675423566e-01   +1.173904585051020e-01   -5.553912451133155e-01   -7.859104221427959e-01; +5.345393543040056e-01   -3.023343351791260e-01   -2.672859888166343e-02   +6.010677925751278e-01   -5.186686534371278e-01   -9.486216288262095e-01   -5.493363550392877e-03   +1.912337369398323e-01   +2.095449006472089e-01   -5.932293397506444e-01   -6.823491872859795e-01   +4.308552694997385e-01; -1.119418149559328e-02   +3.108029456275994e-01   -1.421959452389420e-01   -8.006113063685893e-01   -6.220289216970412e-01   -5.723300766239073e-01   +3.287490293978380e-01   +3.185749780656824e-01   +2.722961366246432e-01   +5.012047562031519e-01   -7.691123926443436e-01   +6.300268710372828e-01; +5.220827177176990e-01   -7.782517314723567e-01   -1.714126610271795e-02   -3.418169409336622e-01   +6.561462993761971e-01   +6.999383094975300e-01   +2.892707974749605e-01   +1.405966218157046e-01   +7.428015940100394e-01   +6.509759303880263e-01   -2.890674266350636e-01   +2.192883789703908e-01; -7.462794947328552e-01   -7.165315050182411e-01   +3.806391912833099e-02   +4.816760974307743e-02   -3.351086944231454e-01   -1.439500626354964e-01   +5.243728929659142e-01   -9.434352319195342e-02   +4.485934100659664e-02   +8.888887833227567e-02   -4.441949861708562e-01   -5.423629802787272e-02; -3.436973827914407e-01   -4.471725447707760e-02   -1.620637517657926e-01   +1.654633678922509e-01   -3.342680242385808e-01   +1.856365236496939e-01   +7.274900804061850e-01   +4.550780357440660e-01   -7.501588781708808e-01   -3.194615686514482e-01   +2.943368671013128e-01   -2.524637483618362e-01; +3.321422601215216e-01   +1.250595398783082e-01   -6.188614255229307e-01   +3.278998711275725e-01   -6.817736752090879e-01   -3.421191289071746e-01   +8.032712639220819e-01   +3.828693834104819e-01   +6.443502094567957e-01   -4.945059209592808e-01   +8.067254987172293e-01   -1.951168733348194e-01; +5.059102418131338e-02   +4.090516879599254e-01   +3.724820256142347e-01   +3.152645116094728e-01   -2.530691997233780e-01   +6.497004009696831e-01   +4.898828828231376e-01   -8.793858794433610e-01   -5.549304021503131e-01   +3.034432270331147e-01   -6.760051280414288e-02   +8.032146912629018e-01; -2.860721083262746e-01   -6.291161470272461e-01   +4.419334960677685e-01   +4.992808193847504e-01   +1.175109467731433e-01   +4.985048068775171e-01   +7.163644813596207e-02   -1.258276533682295e-01   -4.950580838856299e-01   -3.650688764402507e-01   +5.716966117212994e-01   +1.371100782112784e-02; -5.281563441448717e-01   -6.046283270242538e-01   -1.420774004416892e-01   +2.141011878996462e-01   +1.655791592435367e-01   -3.157446614632729e-01   +3.721587390669367e-01   -3.115944014052077e-01   +1.686079304575817e-01   +1.557542580644498e-01   +1.031780179835043e-01   -4.978101871675907e-02; +2.684793160645655e-01   +7.400645758816120e-01   +4.979314556585192e-01   +6.782264092927532e-01   +1.562533086231561e-01   +4.381754973252416e-01   +4.833302663936589e-01   -2.947096200742105e-01   -6.953310036927994e-01   +4.264800443938577e-02   -5.224812399922877e-01   +7.292133515992555e-01];
L3E_L3I_iGABA_netcon = [+9.588003981085292e-01   -1.440574334465854e-02   +4.204900876492756e-02   -5.906737186149043e-01   -1.538456438455516e-01   +2.677003308831273e-01   +7.981046081513768e-01   +1.000000000000000e+00   -6.573805075761007e-01   -4.302071584035891e-01   -3.717149925754630e-01   -1.121469811524315e-01; -4.784119078068176e-01   -1.154013638847808e-01   +7.500934603844036e-01   +6.568927161104511e-01   -5.228790159215004e-01   +5.982420263946489e-01   -1.244089412309189e-01   -1.113823792299090e-01   -3.103135684795383e-01   +6.573686116610012e-01   +9.186037901698937e-02   -5.542368686389405e-01; -5.354414714468818e-01   +3.759136259872779e-01   +6.820108586202646e-01   +1.852800114706976e-01   -3.842614838911858e-02   +4.937248901818976e-01   +6.835816546532988e-01   -1.231413581820043e-01   +1.490843375393150e-01   +6.012694472483797e-01   -3.304037609369908e-01   -5.218116818115676e-02; -9.875477433244503e-01   +9.836964664321551e-01   +6.157078778504084e-01   +4.497430347868308e-01   -3.119390955800525e-01   +6.881322591064100e-02   -8.269742902520424e-01   -6.103363473314032e-01   +5.842247036903570e-02   +1.093872039849769e-02   -5.105129537403154e-01   -2.287396041389649e-01; +3.759740270922494e-03   +3.009255812565594e-01   -6.769824346876187e-01   +3.981702139834550e-01   -2.708786181844468e-01   -2.717073421605306e-01   +1.477947451734592e-02   -2.603114424129570e-01   -3.122190692597088e-01   -2.287891902016106e-01   +7.590773889090195e-01   -3.445824648870295e-01; +3.180004415642026e-01   +8.278015447110226e-01   -1.904313605714994e-01   -5.500787338669542e-01   +2.862913770893242e-01   +2.966207221293019e-01   +1.886150642341324e-01   +3.377437697768753e-01   +1.676761325752527e-01   +3.739480415546686e-01   -7.156009585205281e-01   +1.339395804014794e-01; +5.176186365107490e-01   -5.092958520150681e-02   +1.155246577764842e-01   -6.104790066068486e-01   +6.424677900074233e-02   -4.862655143303854e-01   -6.882901208165837e-01   +9.985983716788479e-01   +1.310262781094383e-02   +5.777232520527932e-01   +5.019659711284243e-01   +3.267523649995565e-01; +3.838894704535859e-01   -7.447412589114979e-01   -1.292154497028682e-01   +3.500713815381433e-01   +6.419027483021449e-01   +3.632940034770084e-02   +5.388626014376386e-01   -1.572060830832400e-01   -1.334148495590325e-01   +6.329942630894535e-01   -3.090339502879478e-01   +8.844974413924159e-01; -3.461165997195720e-01   -2.635552651366096e-01   +2.510811946174896e-01   +8.238303767389067e-01   -5.898198810305245e-02   -6.003104084481836e-01   +5.546657087657220e-01   +4.695053555382211e-01   -3.922973180227046e-01   -4.270778387038325e-01   -4.149518593567771e-01   -5.779323944617466e-01; +4.536077556152702e-01   +5.228169070953538e-01   +6.233901513271545e-01   +8.164960680092743e-01   +6.694669792026896e-01   +2.164143432530985e-01   -6.346562033434298e-01   -2.820522148038443e-01   +6.834181804707897e-01   +1.497445700447949e-02   -6.958212953541849e-01   -5.286623543253162e-01; -1.016906050195931e-01   +1.490929274974855e-01   +2.422461330250817e-01   -6.598174336009009e-02   -8.408712101199209e-01   +3.535889327104979e-01   +3.652822049183510e-01   +8.383705380392424e-01   -4.501877364293773e-01   +1.505217689092618e-01   +1.920198899353925e-01   -9.643426775654316e-01; +1.579576711766636e-01   +4.546282746379317e-01   -6.601312690530191e-01   -2.773365588589865e-02   -3.297454915023503e-01   -3.727835933737578e-01   +9.310649156292934e-01   -3.599732951165049e-01   +4.510240573419082e-01   -2.212489721843624e-01   +4.531364399589678e-02   -3.937185520180095e-02];
L2E_Input1_iAMPA_netcon = [-3.054319167788471e-01   -3.497185947687694e-01   +4.861274534348098e-01   -3.819671177119863e-01   -7.129938708274983e-01   +7.890704335725471e-01   +6.291310914924957e-01   +8.134421616797408e-01];
L2I_Input2_iAMPA_netcon = [+1.000000000000000e+00   -4.251804348535350e-01   +7.589385465475602e-01   -2.176306479334676e-01   +5.470026117950998e-01   -8.517728984410985e-02   -1.364722305511142e-01   -8.407321011735981e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last =  11.21 * ones(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))*0.4 + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.5*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.5*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))*0.9 + 0.5*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))*0.4 + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.5*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.5*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))*0.9 + 0.5*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
