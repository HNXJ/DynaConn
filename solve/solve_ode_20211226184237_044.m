function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-4.855469968901023e-01   -7.140646833453168e-01   -6.543731972946798e-01   -6.252862663732334e-01   +9.176109484310714e-02   -3.720903153141960e-01   +2.218547353926620e-01   -2.953197263901695e-01   +7.282459906485450e-01   +1.659756559315683e-01   +1.068203538645210e-01   +4.271308167848591e-01   +8.474980846649903e-01   +6.083391764578074e-01   -4.018008087502680e-01   +9.062582985057226e-01; -1.924587011392155e-01   +2.665591097435619e-01   +2.234143385777613e-01   -6.731459180153099e-01   -6.274119643959862e-01   +3.080997239687641e-01   +3.255586630879645e-01   +9.129369887809070e-02   +3.336021451881788e-01   +1.783901070921984e-01   -5.803232045519650e-01   +2.387531755102662e-01   -8.060313417739515e-01   -5.775484308626544e-01   +4.979815463974387e-01   -4.940566351349112e-01; +2.464098894359904e-01   +1.652848538585160e-02   -8.692879995176592e-02   -4.373643468635806e-01   +3.772741638923061e-01   +4.940762839324659e-01   -3.319431921251067e-01   +5.765197855416775e-01   -4.608063747229926e-01   +2.361504074036259e-01   +5.664965129925872e-01   -2.126974209312887e-01   +6.376810968082244e-01   -2.182317520359530e-01   +5.112965004587859e-01   -8.709791560306014e-01; -1.528545254324312e-01   +8.826509347665573e-02   -1.072708767555249e-01   -3.578576204919748e-01   -8.293842985318511e-02   -9.367150075547752e-01   -5.055539332089797e-01   +5.158757015119103e-01   -1.663316101012851e-01   -1.349191075402485e-01   -4.689109074664728e-01   -3.283279506360436e-01   -3.795758181869309e-01   +4.596844035871618e-01   +2.654636796636343e-01   -3.528573421109076e-01; -4.534237209292385e-01   +4.929361715370746e-01   -9.354908483090576e-01   +1.000000000000000e+00   +9.504717004346729e-02   -3.509276066390755e-01   -2.023608546773593e-01   +1.603447504907525e-03   +4.743837096280826e-01   +5.529467443063738e-01   +3.258305627592561e-01   -2.934654674266648e-01   +3.075113067175915e-01   -2.695055914790795e-01   +8.660337920956028e-02   +6.554478742381874e-01; -5.277101653323103e-01   -6.275790043303797e-02   +1.491226746837415e-01   -2.208302004519511e-01   -1.896436164511582e-01   -3.304632541435500e-01   +5.096619681013447e-01   +3.433728037573479e-01   -3.764468857131035e-01   -2.752942662333624e-01   +4.167657162247183e-01   -7.042373381451505e-01   +3.741783006827106e-01   -4.685386344684690e-01   -3.338708492072293e-01   -2.218040206794333e-01; -8.925239830567550e-01   +2.595396482376230e-01   +6.579227873889293e-01   -2.781110908468465e-01   +1.294271943282867e-01   -2.442396317580203e-01   +3.872784519284113e-01   -5.687688456433121e-01   -1.076010819036482e-01   +6.584345270348652e-01   +6.978104567495818e-01   +3.388722697485573e-01   -8.084200094409502e-02   +1.744670465384644e-01   +3.572291788791188e-01   -3.180931331918381e-01; +7.085117549260047e-01   +1.439979311327514e-02   +6.166744164670884e-01   -5.627901880051699e-02   -5.538744855060199e-01   +1.515979255945409e-01   -3.511070549193390e-01   -4.292191642486516e-01   -2.611731208019079e-01   +7.040790547750387e-01   -1.808596072089894e-01   +6.674256261323670e-01   +2.119957215831482e-01   +2.464741377378255e-01   -1.883190700415966e-01   +2.329816083896738e-01; +1.461540918773469e-01   +3.870503610765808e-01   +2.334157032865756e-01   +4.445580597023204e-01   +7.318959872514653e-01   +5.842788142266161e-01   +3.486044538651371e-01   -6.740442862147366e-01   -3.826285139053213e-01   -6.370603277953211e-01   -6.383855643970995e-02   +4.405889894831664e-01   -1.682969890265606e-01   +3.481805449141501e-02   +5.461107115449971e-01   +5.751851040910551e-02; +5.506442444975115e-02   +2.994141713713807e-01   -2.709311047251413e-02   -1.405556326577916e-01   +3.965877646644765e-01   -1.016759632533709e-01   -3.729338082902862e-02   +1.774240402409809e-01   +7.136893378368107e-01   +1.428970933486482e-01   -5.656926514146679e-02   -9.306436410675607e-01   +7.091367619406901e-01   -2.378799612490593e-01   +5.630681961278381e-01   -2.957203831248205e-01; -7.083426882508761e-01   -6.979380554922882e-01   -4.781956467843635e-01   +9.024616255678414e-02   -3.493788553733638e-01   +2.054273677027265e-01   +2.535430680711294e-01   +5.917858573612548e-01   +4.645089497199866e-01   +6.854289683287996e-01   +3.175921503931862e-01   -5.988222445796495e-01   -5.093902105622428e-01   +5.297476745655674e-01   -7.115014729445217e-02   +3.056902260450488e-01; +2.244954968377281e-01   -2.892127853297033e-01   -3.454467519572276e-01   -1.851134320539479e-01   +5.177607809295863e-01   +3.875474442604269e-01   +7.061634531233787e-02   -4.623722312565118e-02   -3.125052317161650e-03   +6.080496597825824e-01   -5.575609418341410e-01   -4.703770732899855e-01   +2.892781531696231e-01   +2.917865430212066e-01   -9.263396160239139e-02   +4.106178637237174e-01; +7.814444371845917e-01   +4.940566667974285e-01   -7.146283312719420e-01   +4.613241466182461e-01   -5.616417261508646e-02   -9.407074019327397e-01   -2.145700004675101e-01   -5.198429858281077e-01   -4.813638214129685e-01   -4.394545169468905e-01   -4.799368517362715e-01   +4.926893433085709e-01   -7.916716843982158e-01   +3.025324200174985e-02   -3.042655875662467e-03   +8.757618238991542e-01; +4.405266259558213e-01   +3.608330550414005e-01   -2.764924129123107e-01   +2.529156168550736e-01   +1.071599317026586e-01   +9.979116760189399e-02   -6.275962197111556e-01   +2.667636741640824e-01   +6.237314903377235e-01   +3.686872235848491e-01   -6.728095363583828e-01   +3.353346316510903e-01   +2.132690206516356e-02   +4.640362997599077e-02   -3.132630758642546e-01   -6.446994518825239e-03; +7.094334318090258e-01   -3.708601185126638e-01   -1.956277075823978e-01   -4.024880939963170e-01   -1.294080901396513e-01   -8.992095158284413e-02   -1.688322880591458e-01   +3.693924056422199e-01   -4.603068428347139e-01   -5.821306888813211e-01   +4.277198389987506e-01   +4.456292030613913e-01   -5.074289664246678e-01   -5.066637845391586e-01   -6.811482582849477e-01   -4.116133477183802e-01; -1.925326628832369e-01   -1.695129954007892e-01   -3.112575666259441e-01   -4.706497457580023e-01   -1.239715576736149e-01   -2.958679567840661e-01   +3.415566248476919e-01   -3.377425417294928e-01   -9.531203929391519e-02   +9.645537794189751e-02   -7.606353186356357e-01   +7.552509407161473e-01   +3.933938892483093e-01   +1.494957637868165e-01   -3.653136006533228e-02   +4.682553375709061e-01];
L1E_L1I_iGABA_netcon = [+6.034895512219644e-02   -6.269850307096083e-01   +5.344032602579504e-01   +6.729511375026718e-01   +4.868202476588145e-01   +6.319496278535190e-01   +8.216944429955921e-01   -4.536722653638320e-01   +2.349778120512125e-01   +4.524141350754421e-01   +1.378373203339137e-01   -5.299647511698681e-01   -5.942021034634211e-01   -5.267442014136571e-01   -3.630198313146508e-01   -2.048087127605835e-01; +1.798783955145123e-01   -2.178947755351767e-02   +1.692310436324354e-01   -9.124195191123496e-01   +1.006205464959241e-01   -5.693608183558296e-01   -4.401987660027163e-01   +7.221906599391369e-01   +3.952061094435077e-01   +4.868911339457468e-01   -1.492592588796316e-01   -4.617625585981865e-01   -5.915506595643412e-01   -4.451529876306968e-01   -5.087249264176565e-01   -1.596315679782010e-01; -3.439678305850401e-01   +5.167374962551826e-01   -6.032366182127303e-01   +7.055629405714833e-01   -5.541017984688468e-01   -7.176110782153514e-03   +8.863752095413601e-03   -7.405345014757972e-01   +5.532909995757295e-01   -9.883524310844098e-01   +4.181423470094638e-01   -5.998715032237796e-02   +4.432124581897567e-03   +5.391983202875664e-01   -3.500186955819326e-01   +2.668288810044253e-01; +7.452418231984762e-01   +7.538458698077939e-01   -6.508306527072831e-01   -5.341195006682772e-01   +3.626208419699888e-02   -6.748846176220129e-01   +6.004080165285319e-01   -4.631657080677241e-01   -7.313402448366969e-01   +3.724509546679365e-01   -3.707629200185849e-01   +6.408782071411762e-02   -3.010493632091304e-01   -7.740387450554885e-01   +5.999258603172873e-01   -4.720552313732958e-01; -2.900939087492224e-01   +2.529587308285910e-01   -3.778071976560209e-01   -7.534718136951861e-02   -6.075112882838567e-02   +7.683148853699587e-01   -2.040183942775499e-01   -5.996602274473000e-01   +3.765395677745318e-01   -8.471474126759705e-01   -3.010473494912453e-01   -2.950720436211778e-01   +1.337983576663954e-01   +5.331011021205383e-01   -6.569770747303975e-01   +6.436999702227680e-01; +1.354045750769325e-01   -3.860078969695987e-01   -4.120683500864580e-01   +1.565970569454331e-01   -7.526308506539824e-01   +5.011103859560219e-01   -2.124390891815907e-02   -8.092675787935486e-01   -1.296689315530222e-01   +2.658506662494029e-01   -8.841671802849191e-01   -1.454497197059640e-01   -3.221979646084410e-01   -4.645333652484729e-01   +8.656810871861165e-01   -2.680347274237841e-02; +6.944889341753927e-01   +2.713561375512961e-01   -1.030901013105038e-01   -5.855892293994457e-02   +6.269676409814383e-01   +9.542238160296100e-01   -5.463829730080894e-02   +6.014616911411234e-02   -8.236807866745451e-01   +6.181406969485753e-01   -2.830786994665331e-01   -4.002807534888715e-01   +6.107753664453686e-02   +7.559228126973673e-01   -1.189988072429686e-01   -3.278073101015836e-01; -5.804387031788596e-01   -3.578539290463830e-01   +3.186343968086973e-01   -3.970154186804412e-01   +8.768193649719204e-01   -5.619032832808292e-01   +6.542995433385379e-02   +3.970944173335863e-01   +1.947503873951477e-01   +6.206552281795658e-02   +4.394466163432939e-01   +4.877516290405506e-01   +4.530513942247172e-01   -2.255874447880424e-02   -2.516287935556143e-02   +5.346453640478531e-01; +4.125669578500795e-01   +1.702893536509821e-01   +5.679171272460057e-01   +5.897682553847591e-01   -4.575487656586127e-01   +3.444286558047817e-01   +6.066357642782499e-02   -2.669269795549858e-01   -5.542455395448146e-02   -7.731460409941933e-02   -6.770473788784670e-01   +5.175590851461363e-02   +1.144644641734535e-03   -5.310629820863559e-01   +2.468694176041541e-01   -4.837207650768200e-01; -4.381960734589140e-01   -5.299399856626639e-01   +8.220214858085353e-01   -8.493470140635940e-01   -4.491593946636183e-01   -2.541047350812518e-01   -9.114573795498589e-01   -7.302751111225869e-01   -5.804256311419964e-01   -5.756312601660646e-01   -3.825973725765632e-01   -1.051147270176044e-01   +6.045705618362518e-01   -2.437577483745013e-01   +4.342938311955097e-01   +1.095534811320855e-01; +5.701118410699089e-01   +3.664621136911847e-01   -3.574430693325630e-01   +2.093507765165786e-02   +4.216020884694239e-02   -3.666184900328667e-01   +6.020942288135476e-01   -4.704092886463962e-01   -4.447655093285529e-01   -2.368312522099944e-02   -3.743251430101809e-01   -9.780307704094526e-02   -5.039660743891566e-01   -5.824880137393218e-01   -3.591091163997990e-01   -7.383887295294034e-01; -6.721168796839713e-01   +3.625780335371345e-01   -9.108288351788901e-01   +7.402430999390521e-01   +7.419645024286923e-01   -3.747398726404621e-01   +6.735890290906473e-01   +4.725622291562647e-02   +4.437279416412485e-01   -3.627240650245716e-01   -8.910762061479005e-01   +4.648726594813477e-01   +7.733926491967993e-01   +4.627088840106282e-02   -6.482076844742208e-01   +1.000000000000000e+00; -4.059676831936682e-01   -8.909573677023887e-02   -8.916896093201282e-01   +2.276993808088442e-01   -1.584291347339963e-01   -3.990222029077897e-01   +2.896972080369424e-01   +8.138969154456044e-02   -1.373336671465526e-01   -2.559250983187839e-01   +5.063835678381595e-01   -5.146459468706543e-01   -4.158640799626269e-01   -2.572030047838294e-01   -4.251255039530274e-01   +1.004118155592162e-01; +3.745709824192928e-01   -1.126165419377115e-01   +6.741181222961432e-01   -7.835695856167322e-01   -4.102314612040711e-01   +6.023120034051899e-01   +2.017301308221552e-01   +2.921493927613351e-02   +1.849504795875676e-01   +4.969719347316949e-01   -8.686430968578384e-01   -3.752925682885113e-01   +3.311917424818631e-01   -1.703476874893017e-02   +3.014318200769896e-02   -3.580319403019140e-01; +1.574051918017751e-01   -2.407789442816022e-01   +3.160566687791566e-01   -7.917720286901336e-01   -3.883489585890522e-01   -8.608740740105325e-01   +4.334538102564785e-02   -7.075069081109423e-01   -1.495207064427275e-01   -2.211647988652077e-01   +4.396183878485085e-01   -1.757600161448280e-01   +3.854083592244075e-01   -7.745005269980808e-01   -3.348370813353941e-01   +7.047004333385797e-01; +2.777556919150579e-01   -3.228898881298277e-01   -9.880346380670156e-01   +1.659701817042427e-01   -8.583147256001847e-01   +6.150158245761075e-01   +3.871940501414735e-01   -5.164646989783092e-01   +4.890285271027553e-01   -1.702954074660310e-01   -2.137983480002434e-02   +4.056270577378864e-01   -5.266506256658217e-01   -2.342361547589132e-01   -7.393050185415745e-01   +8.133639670682100e-01];
L2I_L1I_iGABA_netcon = [-2.543924722440288e-01   -1.506811145388918e-01   -2.802627398555614e-01   +2.063634686340529e-01   +5.445483167410098e-01   +5.091926914082950e-01   -3.350810501883397e-02   -5.915182998228489e-01; +5.656336134871864e-01   -3.473978744474526e-01   +3.644017917942233e-01   +3.370461987385982e-02   +3.491611802561796e-01   -1.573841635300815e-01   -5.354320867778913e-01   +3.037260156061418e-01; +2.754656132528535e-01   +1.530832311785228e-01   +1.642155142919257e-01   -5.442162418758200e-01   +6.390828856061983e-01   -4.631900934667975e-01   +5.469481773535042e-01   -1.431915200892434e-01; -5.635524284157623e-01   -3.256821006219773e-01   +4.805838964894392e-01   +1.497136355435625e-01   +2.989129723682275e-01   -7.315360672139629e-01   +2.516401214854962e-01   -6.799149663526430e-01; -9.319944028378666e-01   +8.429006503392688e-01   +6.393644942776626e-01   +1.406613048222663e-01   -1.000000000000000e+00   +6.945991990469228e-01   -6.059603109793694e-01   -2.402898722269711e-01; -7.095724142468742e-01   +3.131387936269712e-01   +6.227801880994664e-01   +3.040685656829193e-01   -3.670761617319641e-02   -1.576269929314573e-01   +9.554731890359222e-01   +3.926748520300049e-01; +6.703578074398860e-01   -2.037042157345378e-01   -7.187519016857442e-01   -3.547314696420226e-01   +6.579952796776783e-01   +6.663255986022606e-01   -2.850834158747033e-01   -4.952454750577026e-01; -5.253602618249501e-01   +8.111463075774215e-01   +2.860035024105073e-01   +3.341310158837397e-01   -9.581506005771896e-02   +5.733467798323538e-01   -5.336621495164342e-01   +1.385226926573498e-01; +7.880431760735628e-01   -2.940852263864335e-01   +6.688202870160743e-02   -6.838924057243251e-02   +2.553105549845718e-01   -4.682086889778785e-01   +6.019346841807857e-01   +1.522214925806194e-01; +2.751121160820418e-01   +4.436841520327027e-01   -5.690997381111220e-01   -5.235490433477844e-01   +7.686983072448252e-01   -4.479530560979519e-01   +3.860398582925264e-01   -1.795146762365747e-01; -6.286002342844186e-01   -5.212748329202939e-01   +3.731366308799602e-01   -1.566166966240503e-01   -5.486536567223101e-01   +7.896564064836390e-01   +1.724428886043411e-01   +2.920554314538200e-02; +1.630066334809771e-01   -1.859294589188699e-01   +6.171861408075460e-01   +6.627070337292677e-02   +6.522231182127921e-01   +1.803177141003962e-01   +1.603134405892989e-01   +4.958602379988327e-01; +6.654699584746677e-01   +3.662912737466495e-01   +7.889056318715861e-03   -8.668019526786928e-01   +6.285173970588801e-01   -5.159676663191262e-01   -9.455621944787979e-01   +3.894635351421876e-01; +3.678827705471192e-01   +2.985093905109555e-01   -3.330876352264221e-01   -5.935696397490424e-01   +6.826031626968367e-01   -7.059529985363708e-01   -4.583558020079723e-01   -5.289194018932983e-01; -2.845782648701194e-01   -6.787302420654974e-01   +4.583659483923482e-01   -1.467727269296806e-01   +3.422705719473164e-01   +4.701128123504142e-01   +6.907725147349124e-01   +1.246693110267271e-01; +3.127149033631589e-01   +6.295558546892668e-01   -5.018429213129284e-01   -7.364340933159180e-01   +6.950435450773641e-02   +6.345817834347062e-01   -5.473864096723696e-01   -1.673494686092834e-01];
L1I_L2I_iGABA_netcon = [-3.720498331943367e-01   +7.950069914519199e-01   -3.925382792202282e-01   +2.369868725641613e-01   +1.757041374976282e-01   -7.386570041893963e-01   -7.138734311077514e-01   +7.030334754489397e-01   -7.522295106859922e-01   -2.113992477977211e-01   -6.461936387835382e-02   -5.533558724376650e-01   -8.648913694663608e-01   -4.582624554647154e-01   -7.086122714658097e-01   -2.071960624180732e-01; -2.496104138131694e-01   +4.354681315660676e-01   +9.505925789759832e-02   -6.779211147705905e-01   -7.675480343701975e-01   -7.621002731284021e-01   -2.562177661096544e-01   -4.047435132186450e-01   -2.948623620574286e-01   +1.427801567764707e-01   -4.269882368806213e-01   +5.727580878988189e-01   -4.621936423181881e-01   +9.009964111306260e-01   +4.558949041322237e-01   -9.843793368941185e-01; +1.491707464105576e-01   +6.378454993761844e-01   -5.074964993318551e-01   +8.502387582613670e-01   -4.051095218384397e-01   -4.708117759425292e-01   -5.832649349327279e-01   -2.564400529507554e-01   +4.222876575629677e-01   +7.113374819877356e-01   +9.719076985639458e-02   +2.309992485715517e-01   -6.165719501769802e-01   +5.309272720071275e-01   +2.217137147752878e-01   +5.115354966812945e-01; +3.711348892728821e-01   +4.855403537805187e-01   -6.834214593063794e-01   +5.524625288364067e-01   -1.900347374094430e-01   +9.500893814293547e-02   -3.029465340544008e-01   -2.252430460040075e-01   -1.664952709019532e-01   +7.769018919746324e-01   +2.351577705577387e-01   +2.733137866608836e-01   -5.657172300941807e-01   +5.458687784485524e-02   -4.486063981304436e-01   +8.028297198904127e-02; +6.091418982109106e-01   +7.279402719789101e-01   -7.410725832122458e-02   +4.290798579652348e-01   -1.516574354334063e-02   +4.923205054867085e-01   -4.310124692601551e-01   +2.299545893604167e-01   +5.510103482048594e-01   -5.420408456729024e-01   -2.242160564234938e-01   +5.820594322439945e-01   -2.667733256690332e-01   +6.929553673288070e-01   +3.946112684469985e-02   -2.224512578264036e-02; +2.639408864623317e-01   +9.531604397737290e-01   -5.562179071668963e-01   -6.747782167823153e-02   +9.124991676539705e-03   +5.191005544517460e-01   +2.907782084474016e-02   -4.700278816576222e-01   +5.165485000055083e-02   +5.692814940674586e-01   +4.934497207075584e-01   +5.994859447435322e-01   -6.748880045196025e-01   -1.900432826738191e-01   +3.324108685383900e-01   -4.311372679477118e-01; +3.434089737387576e-01   -7.360214857411463e-03   +9.827412622741941e-01   +4.335998071144319e-01   -1.891947693385373e-02   +7.952086328840935e-01   -4.329221159909913e-01   +5.753085596157703e-01   -8.717206034057690e-02   -3.791406048486299e-01   -2.575114403675125e-01   +2.402902037937910e-01   -7.883563940287399e-01   +6.831328256072604e-01   -5.525726459379660e-01   +4.362448622353697e-01; -3.301824563669035e-01   +1.000000000000000e+00   +8.599512874621240e-01   +4.114221586675970e-01   -1.322790145613161e-02   +2.060965033908853e-01   -8.262789779131834e-01   -6.097075646940251e-01   +1.746621690498172e-01   -7.113268230014649e-01   +3.239504708720155e-01   +2.035637358904525e-01   -8.993671055374213e-01   +1.415340360596575e-01   -5.619229217243662e-01   -9.669097493465116e-02];
L2E_L1E_iAMPA_netcon = [+6.764274669743957e-02   -6.428616621368237e-02   -3.132699135050696e-01   +1.121412887885626e-01   +4.449200140751347e-01   +7.315639411628938e-01   +6.222219167715667e-01   +2.986095813210965e-01; -1.000000000000000e+00   -3.780127002272354e-02   +5.226161773462142e-01   -8.372748768221372e-01   +7.464157092282542e-01   -5.654805498372582e-01   +1.261097847220874e-01   -6.766862470249664e-01; +1.026707994657631e-01   +2.072432007237677e-01   +3.327006609739782e-01   +4.121617210878075e-01   +2.597038739361093e-01   -5.404295621781832e-01   -1.274532026082976e-01   -5.798538575632184e-02; +1.748720451183971e-01   +6.979406978600575e-01   -5.063983357705983e-01   -5.019816739105919e-01   +7.265486690434754e-01   -7.860283463309166e-02   -2.186532918634486e-01   +4.886530535645104e-01; +3.626311158795076e-01   -4.212766569119210e-01   -1.526419468738779e-01   +7.393771567184645e-01   +1.747805381085079e-01   +5.938519734637312e-01   -7.322419967180637e-01   -8.914329957930918e-01; -6.119024364840245e-01   -3.054823533484078e-01   +6.733996655153874e-01   +1.866698142251849e-01   +3.577279457717581e-01   +4.426214761776812e-01   -5.199807391960007e-01   -3.741085981951708e-01; -5.278599186402275e-01   +7.693735564602225e-02   +6.633776635109377e-01   -8.154331976246684e-01   +8.647889466219183e-02   +1.289877819014947e-01   -2.091622232609963e-01   -2.194128570745389e-01; -6.635925927887895e-01   -1.223389263980761e-02   +7.496723435339130e-02   +1.136207720947750e-01   +6.305894543260364e-01   +7.574715517178483e-01   +2.426787195520886e-01   +3.936432618359069e-01; -1.516986821406953e-01   +4.492784102365719e-01   +2.500984335427357e-01   +6.973386064340699e-01   +1.767655512282992e-01   +3.294260002710247e-01   -2.551272372174141e-01   -2.233817631663234e-01; -1.043856057912377e-01   +5.750099386854052e-01   -2.220197230574172e-01   +4.793760639505605e-01   +9.158077299447657e-01   -6.253513872518711e-01   -6.213989895852313e-01   -4.841877369253886e-01; +8.053272032930787e-01   +6.126774109292501e-01   +5.138545115112616e-02   +2.977465718951296e-01   +8.628746294273192e-01   +4.822747442140015e-01   +2.666980186457152e-01   +1.212856274314847e-01; +1.423695587264356e-01   +4.159503126935679e-01   +6.001477213319401e-01   -8.033830181654255e-01   +4.264607841167607e-01   +3.704582233669255e-01   +5.291171378427978e-01   +5.638175527125933e-01; -8.471390455729569e-01   -5.494633605610821e-02   -5.016579611743863e-01   -8.641643788045164e-01   -6.543279069438088e-01   +3.098409120010434e-01   +1.520526132937668e-01   +6.595479513164867e-01; -8.621117590103965e-01   -7.174148448166697e-01   +4.968675074937329e-01   -6.592045381825656e-02   -8.536177773817337e-01   -3.560954014908161e-01   -9.492151067589445e-02   -4.257397677520600e-01; -6.676173945454710e-01   +2.290141942417617e-01   +3.303414447370359e-01   -2.092576554713994e-01   +6.249955917546117e-01   -6.458693298296894e-02   +4.238910276116754e-01   -3.179211696907175e-01; -6.563071862922766e-01   +2.512292632315733e-01   -6.442906867899281e-01   -6.515604089307965e-02   +3.513608068599633e-02   -3.189482515327039e-01   -4.279046575988406e-01   -4.556913864454872e-02];
L1E_L2E_iAMPA_netcon = [-4.996262722325179e-01   +2.771301906832759e-01   +6.857318126884834e-01   -3.233439347626531e-01   -2.277858983029559e-01   +6.488649574162603e-01   +4.930777669540925e-01   -3.567586744298542e-04   -6.459162135948772e-01   +3.128749502449206e-01   +8.790029888652893e-01   -5.737512982717153e-01   +4.976939890224680e-01   +3.258015602051509e-01   -3.230187811080676e-01   +7.585875055209771e-01; -6.116860340536379e-01   +6.806629127927059e-01   +2.218524489344049e-01   +5.977503875404641e-01   +7.414527103948340e-02   +3.139625948137731e-01   -5.648324814901520e-01   -8.899112863487462e-01   -7.644357529158708e-01   +4.584825663168972e-01   +8.746744702995077e-02   +1.924282432379386e-01   -2.568411416623003e-01   -3.136934785344840e-01   -5.340295537401991e-01   -8.318879634364307e-02; +2.588512073042792e-01   -7.740701860435899e-01   -1.642679439725660e-01   -5.755550553031191e-01   +3.651302806821143e-01   -6.649059683992911e-01   -7.117910001211045e-01   +2.895885280983396e-01   +7.397941750491451e-01   +3.298862135141497e-01   +4.826366973870482e-01   -3.076340347327520e-01   +1.731822217030576e-01   +2.630306647876156e-01   +9.616760539193423e-01   +6.146907223925300e-01; +1.598965147435473e-02   -2.609672858781961e-01   -1.785197586725384e-01   +1.873357581705231e-01   +3.793062745576329e-01   -5.038697791094415e-01   -1.982210829414458e-01   +2.132476360600398e-01   +1.311871718425067e-01   -3.389430286340805e-01   +4.119284604032555e-02   -6.808792762792075e-01   -4.299292191638227e-01   +3.225028026799590e-01   +2.701126356124803e-01   +5.107182700384461e-01; +4.683933791969275e-01   +4.625476877610624e-01   +2.779731900322496e-02   -2.022946993821969e-01   +4.869671759057666e-02   +7.173711034201369e-01   -6.905956696291629e-01   -2.968998861152696e-01   +8.234336463498783e-01   +5.447143466878333e-01   +5.295255646422893e-01   +3.080448194821707e-02   +4.733226842019233e-01   +8.431648413699212e-01   -1.069792439327381e-01   -7.415632782914468e-02; +5.257071139198392e-01   -3.105012940893573e-01   -4.876052170857420e-01   -4.060716322821222e-01   +5.270557114548893e-02   +1.380076713802962e-01   -6.962195085632051e-01   +1.686952900020214e-01   -7.541828530130937e-02   +2.243791559595011e-01   +8.787338562008816e-02   -4.859717583342010e-01   -2.017544653456944e-01   -5.286424668668699e-01   +1.000000000000000e+00   +1.529066067603607e-01; -2.012896833127698e-01   +2.654157570054531e-01   -2.700077519839355e-01   +4.014805646944681e-01   +4.635517860593841e-02   -1.871183518755060e-01   +3.991867081324072e-01   -1.888365095555152e-01   +5.681559107836821e-01   +4.052800703678356e-01   +3.792276390789726e-01   +6.882251449809662e-01   +2.692032761380337e-01   -6.465042455515772e-02   -3.706923427815211e-01   +1.625017279026779e-01; +5.971098963875534e-01   +3.755598261107593e-01   -4.175011517404424e-01   -5.818001782650080e-01   -6.804562159632739e-01   -1.624213906726865e-01   +5.398071297557699e-01   -1.604447189312570e-01   -4.516430928896694e-01   -4.068567053340753e-01   +5.159212003927753e-01   -2.104664326051036e-01   -2.340358049804082e-01   +1.856644162445751e-01   -5.050302297190908e-01   -5.885728492855481e-01];
L2I_L2E_iAMPA_netcon = [+4.541835904744756e-01   +4.580192372861139e-01   +2.725718429891394e-01   +6.584134556698926e-02   -8.107362265399664e-01   +8.464447624116141e-01   -5.210188088035309e-03   -6.709297573805739e-01; +5.900415475815666e-01   +5.504447041047926e-01   -3.336495080131363e-01   +1.335525375574422e-01   +3.906819645074733e-01   +5.573981271574199e-01   +3.497708003732097e-01   +3.020155702706632e-01; +5.886685383126848e-01   +5.119238112208989e-01   +5.195437152779427e-01   +2.838769964283293e-01   +1.445762257760236e-01   +3.262750355161093e-01   +3.534300448420447e-01   -4.550834251219941e-01; -7.036500128058254e-01   +4.633853546650611e-01   -2.625780464022507e-01   +6.538813166643789e-01   +5.018274120202408e-01   -5.267717687600671e-01   -2.192965945038374e-01   -1.451809564611713e-01; +1.876967717092707e-01   +6.156652411570975e-01   +4.918287313223403e-01   -1.000000000000000e+00   +8.146961222251337e-01   +9.334188508037494e-03   -1.627668688787450e-01   +5.297289559463176e-01; -2.523658326211428e-01   +6.238746302637389e-01   -3.799395245114521e-02   -7.134464056568755e-02   -2.243148666913193e-01   -5.800618536655435e-01   -8.795377990295991e-01   +6.713574226024787e-01; +4.405077156088195e-01   -8.824761645038562e-01   +1.808205955212355e-02   -6.008591086891875e-01   +1.759868035737717e-01   -5.140599033507001e-01   +7.349863697344862e-01   +1.536010575108664e-02; -6.126858223653395e-02   +1.678044320579354e-01   +7.624332792451973e-01   -6.042797100889917e-01   -3.093883469953567e-01   +5.103406587632142e-01   -5.202093906623979e-01   +2.586405635164428e-01];
L2E_L2I_iGABA_netcon = [-8.235708898532919e-01   -2.647633915069926e-01   -7.059827534380031e-01   -5.554447837591659e-01   +2.866465579947503e-01   -5.635114086251182e-01   +4.098197416453176e-01   +7.575781945105577e-01; -4.143270576458136e-01   +4.330888769740999e-02   +7.244929798642381e-02   -4.751905542511635e-01   -1.535349769523423e-01   -1.272302264552719e-01   -4.095671012237089e-01   -5.516493143204064e-01; +7.498842022695690e-02   +7.823614740424720e-01   -5.744089080723744e-01   +7.118924687262174e-01   -2.543565106848905e-02   -4.540975058923549e-01   -5.571585746372254e-02   -5.339412317349370e-01; +4.038035917660188e-01   +3.027608843538439e-02   -7.740565693740468e-01   -8.329685365841000e-01   +6.979900344456927e-01   +6.357866626252014e-01   +4.018697425143926e-01   -6.859418019795206e-01; -4.685021830166368e-01   -4.092442657349478e-01   +3.723094235230074e-01   +4.441204046198050e-02   +6.016912943104847e-01   +6.849796986173144e-01   +2.214809484626140e-02   +5.658670246454720e-01; -6.968894356417971e-01   -6.337860815521357e-01   +1.000000000000000e+00   +2.156147232116721e-01   -2.458530893046853e-01   +3.647662950169794e-01   +8.410616057890055e-01   -4.170559523712793e-01; -2.957100884899865e-01   -6.197512394554143e-01   +3.033728148314229e-01   +7.055505883437991e-01   +3.416277986598588e-01   +4.146390364616542e-01   +3.387329636835061e-01   -6.429263644839837e-01; +5.245470893640228e-01   -1.109110104043630e-01   +3.821869866349624e-02   +2.853360902908037e-01   -9.719796715345751e-02   +2.324811335357095e-01   +2.521243559377657e-01   -9.356192667462673e-02];
L3E_L2E_iAMPA_netcon = [-2.636176956425451e-01   +9.054805084509029e-01   +7.235222830074109e-02   +5.507084728063222e-01   +4.648023764330819e-01   -5.867728431189620e-03   +4.592193948254312e-01   +7.077128567841060e-01   +3.254366376785110e-01   +9.860236270059920e-01   +2.213323739432854e-01   +5.503623622780150e-01; +7.770493394467572e-01   +1.343923035364817e-01   +6.441563151435636e-01   +8.039134513126484e-01   +1.539920594568387e-01   +7.122174397288389e-01   -3.723768705985873e-01   -7.899403888409973e-01   -3.719019878251725e-01   -4.926047229269415e-01   +3.199437715123881e-01   -2.546955853146039e-01; +4.853201532844120e-01   +2.458981531312484e-02   -3.165018393690355e-01   +4.045818116001917e-01   -6.322386222930448e-01   +2.143615373433879e-01   -4.362376002125398e-01   +9.036180597884987e-01   -2.211952591320206e-01   -3.256833014665148e-01   -2.051328682731400e-01   +4.041044331382845e-01; +4.013464656785187e-01   -1.582932390538286e-01   +1.181700984001884e-01   +3.926501164239796e-01   +2.829173159006455e-01   +7.535567368128868e-01   -1.340706819576238e-02   +2.204818764579426e-01   +3.636972297930803e-01   -1.000000000000000e+00   +5.875410924418826e-01   +6.530524146757340e-01; -3.023590067881711e-02   +3.269827949742299e-02   +6.882384393416324e-02   +5.651161222146431e-01   -7.656418469299410e-01   +1.529014540718191e-01   -5.459742209444863e-01   +8.076501348770296e-01   -1.655283754591084e-02   -6.524570365546934e-01   -2.577169837143453e-01   -8.908159558281612e-01; +2.766627169240704e-01   -1.295074571285669e-01   -1.357619578115564e-01   +2.456502048306407e-01   -5.568879834101599e-01   -4.718943844335326e-01   -4.571438549700896e-01   -5.011179279109721e-01   +5.069067502999846e-01   -8.105355614607311e-01   -5.580214162141194e-01   +4.722629245362919e-01; +8.131810512282006e-02   -3.224039044793119e-01   +8.699500829239137e-01   +3.395243293621122e-01   +3.371127346479267e-01   +8.096213192330066e-01   -2.143234360311849e-01   -3.227848862084705e-01   +2.951608516592247e-01   +2.637363074896257e-01   +9.047873967637602e-01   -8.467576941528098e-01; +4.677989074935974e-01   -1.967640239125149e-01   +3.436049829341023e-01   +7.617884683301904e-01   +6.944074519922523e-01   +8.081569812850278e-01   +5.908351628511125e-01   +9.224970152674331e-01   +6.153707727165675e-01   -7.367226746573610e-01   -5.388385432397844e-01   -7.200845709172813e-01];
L3I_L2I_iGABA_netcon = [-4.739467343348807e-01   -7.118570005997369e-01   -2.968385818942628e-01   +5.607289893504927e-02   +8.297129082964726e-02   +1.000000000000000e+00   -1.664991128338451e-01   -4.365687676592211e-01   +3.898234124844047e-01   +2.044711143006689e-01   +1.214881846689590e-01   -6.938606057608598e-01; -9.891793314013853e-02   -4.825483844229532e-03   +5.976769242096929e-01   -5.225746598529020e-01   +3.344107243082174e-01   -5.849039458587930e-03   +8.749042691090463e-02   -5.694887947428775e-01   -8.359401189320316e-02   -5.456008138869769e-01   -4.425215392432450e-01   -5.713902799986420e-01; -4.009794041458487e-01   -6.098964259515823e-01   -6.276421407250210e-01   +5.300878641777312e-01   -1.217955622998989e-01   +1.184542947415981e-01   +5.390324160729764e-01   +7.189070470325023e-01   +6.206421302543899e-02   +4.514968779550513e-01   +6.061346748887242e-01   +3.602622480622116e-01; -5.513137428500144e-01   +7.018255810574715e-01   +5.535482477098221e-01   -5.273757141335410e-01   +5.354243996400165e-01   -2.750523109974603e-01   -3.595015752233696e-01   +7.349972423958701e-02   -1.753247032970222e-01   +2.605935780073427e-01   -8.696899023586570e-01   -1.237704746802680e-01; +3.806784873705638e-02   +2.728585728088432e-01   -3.164016650748734e-01   -6.208833489882353e-01   +6.239799652847543e-01   -5.002021843393910e-01   +7.092620290673241e-01   -4.234104499999335e-01   +2.000025593104058e-01   +1.764616852698870e-01   -4.868883835948757e-01   +1.924385619647265e-01; -2.790600842043768e-01   +1.114551687383906e-01   -2.367472951747486e-02   -6.880548797416567e-01   +5.276567941113667e-01   +7.015329772752394e-01   +4.499689472822520e-01   -2.593323386773491e-01   -5.660358659759362e-01   -5.830466140251924e-01   +2.084708061244206e-01   -1.770345895828984e-01; +6.047611520685160e-03   -2.943448779228335e-01   -5.325268111419569e-01   -4.731780862979788e-01   +6.103563190190581e-01   -2.338577920075277e-01   -7.697778184876209e-01   +5.446656595978072e-01   -4.584433594842959e-01   -1.782256501849285e-01   -7.939261225629527e-01   +3.692427284060139e-01; +4.958582712780675e-01   +5.092900858319988e-01   +2.559254738884788e-01   +2.682153572663396e-01   +3.144209299264907e-01   +1.978186133052921e-01   +5.924170132728039e-01   -4.921061734115418e-01   -2.886309032688518e-01   -3.376093700085604e-01   +5.657042665894988e-01   -7.024898929393308e-01];
L2E_L3E_iAMPA_netcon = [+5.960740173603721e-01   -3.964299963298036e-01   -8.582263741251646e-01   -5.336979090437975e-01   -7.134252147065470e-01   +4.980570835732270e-01   +4.555204529040582e-01   -1.967441387294738e-02; -8.209712854854808e-01   +1.267180460278917e-01   +2.823760728770714e-01   +1.249562750036999e-01   +7.571748343628276e-01   -1.350702090534288e-01   -3.611993209406566e-01   -5.913884624887806e-01; +5.995261261957855e-01   +4.327365447559339e-01   -7.742221838401998e-01   -7.571862623781693e-01   +3.547874908865093e-02   +3.240793338960122e-01   +1.985229672891152e-01   -1.029458553838122e-01; -4.268552718095898e-01   -1.944870306967086e-01   -1.374811886917307e-01   -2.879054805875499e-01   -5.641707593663963e-01   +2.143816289295039e-01   +4.251338973340240e-01   -3.636453716939066e-02; +6.571123919130336e-01   +2.185745971315093e-01   +9.060739956436598e-01   +2.983355745176804e-01   +6.370049105744668e-01   +4.757681290463819e-01   +1.000000000000000e+00   +1.459968301849979e-01; +2.525718199345758e-03   +9.172517739667670e-01   -1.451280201960250e-01   -8.463494498471699e-01   +8.499763482063266e-01   +1.428330089222700e-01   +2.437747386325917e-01   +4.198713616837412e-01; -7.692630076013438e-01   -6.582367875924953e-01   +3.741731740244184e-01   -5.825956442077768e-01   -4.469196158125592e-01   +2.587439417823066e-01   -7.733506625568343e-01   -5.357486510176601e-01; +8.527901445354078e-01   -7.650772134236071e-01   +7.004689771568753e-02   +2.354657539056407e-02   +7.959350338701615e-02   +1.466197159983541e-01   -3.232811228396665e-02   -2.601295826712763e-01; +4.120775224155156e-01   +7.077926169248967e-01   -7.194282172993688e-01   -4.742024855048719e-01   +4.230725140478541e-01   +6.857783431736769e-01   +3.619847455269574e-01   +6.304588072171342e-01; -4.742381934970609e-01   +2.923018046871006e-01   -4.568642238880164e-01   +7.811807389036590e-01   -3.913763891808230e-01   +8.314536613333061e-01   +4.359243676034453e-01   -6.798010428959909e-01; +2.879071553412460e-01   -2.582545535579286e-01   +4.791885827268441e-01   +6.021991002881466e-01   -5.858832848058345e-01   +7.102601859996098e-01   -2.593245576278814e-02   -6.114055181384467e-03; +3.238458682151984e-01   -7.899643437509077e-01   +2.972813588743271e-01   +5.554539806829525e-01   -3.577723820212852e-01   +4.019104023308385e-01   -6.927651434760206e-01   -3.604545797203704e-01];
L2I_L3I_iGABA_netcon = [-8.078909508790791e-01   -6.833186893628630e-01   +3.664005926488610e-01   +4.947467558042243e-01   -2.940628872490362e-01   +1.160181814655835e-02   -1.639577975847737e-01   -2.453849810079192e-02; +5.943088186289018e-01   +8.900088157016013e-01   +3.906205382732746e-01   -3.488058262329809e-01   +4.631718570812775e-01   +3.024643572501526e-01   +5.345338172539356e-01   +1.447623422335918e-01; +2.236180685364342e-01   +3.720937836329464e-01   +5.782864208096612e-01   -7.726567070637199e-01   -3.381582138548296e-01   -1.217439031578842e-01   +4.855827966172581e-01   -2.081957239817722e-01; +4.077338059696259e-01   -6.447555198259139e-01   -7.496946566269911e-01   -6.995531370594026e-01   +6.217759144581034e-01   +2.235749592794208e-01   -5.929770481805673e-01   -4.780594727311369e-01; +5.417944859786519e-01   -3.987194358314232e-01   -4.946151764559746e-01   -3.751397609075508e-01   +5.993950013444144e-01   -6.852479402437691e-01   +7.256252267776794e-01   +7.878521054527896e-01; +4.553022395183848e-01   +1.757578630991597e-01   +2.351415905169517e-02   +8.008076232240788e-01   +5.964582774429042e-01   -3.091897825330015e-01   -7.703524109575280e-01   -3.904693554031468e-01; -4.358539384414140e-01   +3.719744645431321e-02   +5.549161307453194e-02   -6.082712282532104e-01   -6.064468901593681e-01   -8.167165294909756e-01   +2.616911841113429e-01   -3.681682602088366e-01; +7.498301226731803e-02   -1.780686837733133e-01   -2.774307556110266e-01   -1.080137028118433e-01   -2.930628428553633e-01   -6.095077064932475e-01   +3.410480629575529e-01   +1.000000000000000e+00; +4.444045507554307e-01   -4.162050046905827e-01   +8.512402320124204e-01   -1.841513902608337e-01   -1.824381134697353e-01   +1.687391447135194e-01   -8.826960505370970e-01   -1.909509119613778e-01; +8.976891154485096e-01   -1.749406471925461e-01   -8.785946163267703e-01   -3.027824694575031e-01   +5.462226349308209e-02   -4.195508909779885e-01   -7.762398162645493e-01   +1.800711044902768e-01; +7.817876800950848e-01   -8.579104525254553e-01   -8.321796529553918e-01   -3.897331114550395e-01   -3.954498259449852e-02   -7.424532386359132e-01   -3.494321195079121e-01   +3.973575845121624e-01; +5.597248877409327e-01   +6.161578628822847e-02   -4.594345510640640e-01   +6.654100482986690e-01   -2.479835245953975e-01   -6.667326521887076e-02   -7.448535531974875e-01   +9.244114299266475e-01];
L3I_L3E_iAMPA_netcon = [-5.552107128262004e-01   -7.997541083336218e-01   -8.700478312649440e-02   -7.176497580094986e-01   +1.599005788969725e-01   +6.865444631292221e-01   -2.305040556422525e-01   +6.017648406434729e-01   -5.326428285099801e-01   +2.168291004932511e-01   -5.267253543225459e-01   -7.395353615206975e-01; -2.223445411964358e-01   +1.004325385051531e-02   +2.130089750037675e-01   +5.762628163671519e-01   +9.382475816397225e-02   +5.296175159787720e-01   -7.578042365995410e-02   +1.194296052543543e-01   -6.321304696818824e-01   +3.916326021184273e-01   +1.947978812360332e-01   +2.674890615103389e-01; -9.056470830943156e-01   -5.200111096974153e-01   -5.852327921445561e-01   +1.973241003476521e-01   -2.683524637431005e-01   -2.289983429443550e-01   -7.688010734183323e-01   +6.859695543802308e-02   -7.289576210630946e-01   -5.641941890679193e-01   +1.030686592858525e-01   +4.277867452644362e-01; +1.455486257564080e-01   +5.043511007750980e-02   +2.007876309190452e-01   -3.014477078384565e-01   +5.319145684264892e-01   -3.317493260764214e-02   +1.526493566587382e-01   -7.359267054041620e-02   +6.273112999391668e-01   -6.745010897990231e-01   +1.278700771021537e-01   +1.608479983853064e-01; -6.984465787565018e-01   -6.416762867543754e-01   +4.299223618849402e-01   -7.920907550358964e-01   +1.911864952514871e-01   -8.245607382317200e-01   -2.962640802256509e-01   -4.574271961250467e-01   +6.781888425497223e-01   -1.862273006677194e-01   +1.096450375686732e-01   -5.280997550717091e-01; -2.204964485207174e-01   -6.411620359201032e-01   +2.707837634965494e-01   -3.220744784462947e-01   +2.090202238429521e-01   -5.571645457300402e-01   -2.075210083489729e-01   -6.373525105273313e-01   +1.000000000000000e+00   -9.048443685819750e-01   -6.614574716995315e-02   -5.513589369471004e-01; +6.124335768282738e-01   -8.999500546053133e-01   +8.250738309027524e-02   -1.066563830955886e-01   -2.680688787588370e-01   +7.296910102868093e-01   -4.840075842468995e-01   +9.156578277188383e-01   -4.115334744956570e-01   +4.943302630790517e-01   -2.337652876954784e-01   -2.214832429205104e-01; -6.505367834391944e-01   -1.382382113771752e-01   +7.895487995911626e-01   +2.863433608283330e-01   -8.853783236418607e-02   -3.251898283718959e-01   +3.756587367792604e-01   -2.976083617503651e-01   -8.018798863564542e-01   -5.352100142562939e-03   +3.417985508134198e-01   +4.279707278173842e-01; +2.672308800511799e-01   +8.386333139953458e-01   +2.107924985318761e-01   -4.581182399412730e-01   +1.834289400159664e-01   +7.442038356862466e-01   +3.561378232547661e-02   +4.266974894038099e-02   +9.300893013945072e-02   -7.821954113556420e-01   +4.579216936652077e-01   +2.676697692319763e-01; +3.424894346532444e-03   -4.127172054436288e-01   -3.023612316210701e-02   -5.792734849826823e-01   -3.344582960026792e-01   +7.332430488394334e-01   -6.658553702830102e-01   +9.068673372886472e-02   -8.911100996987725e-01   -9.416276162225540e-02   -8.304050549920872e-01   -3.802941648496742e-01; +2.528149728275875e-01   -7.995950903280198e-02   +7.542297992547460e-01   +3.965432421298701e-01   +3.042483789230878e-01   +4.912065707615123e-01   +2.054772284496498e-01   +1.987311545541338e-01   +6.923748187882139e-01   -5.652048507885358e-01   -3.709680560294155e-01   +4.449234813542085e-01; -5.437623642234507e-01   -6.158831173438589e-01   -1.981808301654059e-01   +3.952157619294356e-01   +3.319758659160362e-01   +3.211412629490026e-01   +5.825894781170746e-01   +6.753927439133427e-01   +7.393099064216091e-01   -5.200915562008894e-01   -3.530645692784843e-01   -9.242190813258941e-01];
L3E_L3I_iGABA_netcon = [-6.363103433688621e-01   -2.639475765496899e-01   +4.818922522603135e-01   +7.228440804558867e-01   -7.456893544434826e-01   +3.234392886421038e-01   -1.954088656799976e-01   +9.984440351603735e-01   -7.415011460503346e-01   -4.322370315634685e-01   +1.162170866644246e-01   -2.066672884965457e-01; +6.217417544670870e-01   -1.047594835491314e-02   +3.697066106100662e-01   -8.613967038365195e-01   -1.821542067927174e-01   -6.218143328577659e-01   +1.699067023580113e-01   +3.952306941411609e-01   +1.937995259847356e-01   -5.592819644338761e-01   -5.642891622897459e-01   -4.398540863896142e-01; -7.676760994951577e-01   +3.113775513062440e-01   -6.385603909143059e-03   +6.840066968820167e-01   -1.235175515246187e-01   -7.253517547552293e-01   -6.548461233995256e-01   +5.827207059658190e-01   +2.183006685762431e-01   -2.748470512702595e-01   -2.439383159363578e-01   -7.408192459009434e-01; -4.434789401146711e-01   -3.825522733286119e-01   -5.045922929141273e-01   -9.568106748997782e-01   +4.306832390988253e-01   -4.914624221408624e-01   -6.815069603919442e-01   +8.523256195592185e-01   -6.726364637487838e-01   -3.983952727018499e-01   -7.707237415232452e-01   -4.765429237142524e-01; -2.674422237384887e-01   -6.208989582397952e-01   +3.754304571284286e-02   -3.558028660897088e-01   +1.363066071563283e-01   -6.068675893802528e-01   -1.289976154782596e-01   +4.383610445027030e-01   +5.579210881361593e-02   +1.890114019521564e-01   +7.031166985358836e-02   +6.824128052754042e-01; -5.408183789976521e-01   +6.658617981333741e-01   +7.965939483542801e-01   +2.848692254800059e-01   +7.209429083133283e-01   +1.479148092190130e-01   +6.125154800548355e-01   +3.117872607540225e-01   -4.105913378928902e-01   +6.083836209127914e-03   +1.715956803669967e-02   +2.494501212208322e-01; -7.537585391527323e-01   +6.145093144913279e-02   +1.306979486170393e-01   -3.649930263132545e-01   +4.290586038394111e-01   +2.474021470857962e-01   +5.349362469849388e-01   -4.200288347859099e-01   +7.695860548447865e-02   +5.793960404232141e-01   -6.865783135678656e-01   +5.217163540188433e-01; -3.291953696659221e-01   +1.079851063348579e-01   -3.752155142932368e-01   +7.605201722830223e-01   +3.955084174334387e-01   -2.216410250239757e-01   +2.688137999046748e-01   +5.122796219916214e-01   -6.352279211270367e-01   +5.889633096730432e-01   +4.345752961911932e-01   +4.120327547966721e-04; +2.190738755127731e-01   -2.070194503775186e-01   -7.330907971888965e-03   -3.023529240730104e-01   +1.363219992179737e-01   -7.866730564857477e-01   -2.462265996462217e-01   -4.367581724751656e-01   -5.437997151829007e-01   +2.445250052185133e-01   +4.825316092036250e-01   +3.722894500601113e-01; +5.148524367947085e-01   -2.262970184838627e-02   +1.731763999731935e-01   -4.021768384388733e-01   -4.663172848112522e-01   +5.556936799592672e-01   +2.328800582095798e-01   -2.553719322941091e-01   -2.926603484295780e-01   +2.600328855370283e-01   +6.596630053296986e-01   -4.935566880919115e-01; -8.840221278592088e-01   +4.681058942683259e-01   -1.000000000000000e+00   +7.297520106673108e-01   -4.548856781281665e-01   -2.838955625515072e-01   +5.506185141359500e-01   +4.031963873558351e-01   +5.471208681954780e-01   +7.919231361739376e-01   -5.475935968674842e-01   +5.152585545440059e-01; -1.943152775090432e-01   +2.871536946092200e-02   -5.013777414735955e-01   +7.813933777031040e-02   -6.575835276786902e-01   +1.048824470489846e-01   -6.632672656115010e-01   -2.633212352934256e-02   -3.590044329911470e-01   -7.003832068874772e-01   +5.771877153789529e-01   -6.898271878327696e-01];
L2E_Input1_iAMPA_netcon = [+7.922737414768422e-01   -5.240415967278467e-01   -1.508514860007854e-02   +3.863232506038276e-02   +9.982225305318444e-02   +7.919248165008457e-01   +3.158599416339838e-02   -1.000000000000000e+00];
L2I_Input2_iAMPA_netcon = [+5.101751536286538e-01   +8.620899069064794e-01   -1.000000000000000e+00   -2.187014181703857e-01   -1.968931734365278e-01   +9.664824649156044e-01   +7.037524912651052e-01   +2.711433304360050e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.04*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.9*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.1*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.9*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.1*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.9*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.04*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.9*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.1*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.9*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.1*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.9*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
