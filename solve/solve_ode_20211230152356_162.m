function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+4.669176289986218e-01   +1.352082123984278e-01   +1.647178767296577e-01   +4.551778590239739e-01   +2.995841642179622e-02   +1.703985469764772e-01   +3.429068370128877e-01   +4.828875931897889e-01   +2.037192670158529e-01   +2.551059229290782e-01   +2.196290216090664e-01   +9.720990065406196e-02   +4.545253340397287e-01   +1.118641536279393e-01   +2.519204278177102e-01   +2.425109121733936e-01; +1.866130573986857e-01   +3.044053189857092e-01   +3.588029980136196e-01   +5.157021295035221e-01   +2.973272237275917e-01   +4.816791206124799e-02   +2.771109017164881e-01   +2.398336911078818e-01   +1.442263165459332e-01   +5.477377228871930e-02   +4.319297459046617e-01   +3.848019805395153e-01   +1.061689613320151e-02   +1.302472807110878e-01   +3.566257337910348e-01   +2.027298535359607e-01; +3.184427997729165e-01   +7.268637983807655e-02   +1.019145581897149e-01   +2.757885523951974e-01   +2.593271025929409e-01   +1.222466831415382e-01   +3.345425950665518e-01   +5.048179962135474e-01   +1.683743159479427e-01   +4.934425099327988e-01   +1.353913925606626e-01   -4.698353320115014e-02   +2.569335439934654e-01   +4.840505217928967e-01   +6.782983844218270e-02   +1.010121377423482e-02; +1.460107433105738e-01   +5.067099469041105e-01   +1.103219755244755e-01   -2.964217006079840e-02   +8.109121300229780e-02   +4.240937105328549e-01   +3.394812383617113e-01   +2.873952092729268e-01   +3.658203591110235e-01   +4.380694973475345e-01   +1.020126986550271e-01   +7.356443900124511e-02   +5.646569423951510e-02   +4.368490806824859e-02   +3.649655562548875e-01   -3.322688292373581e-03; -5.674898442173387e-03   -8.950505898230050e-03   +2.873983662129166e-01   +3.620739637731699e-01   +2.374567688030002e-01   +1.091901111279109e-01   +2.439710608650723e-01   +1.467036572441254e-01   +2.877850950976869e-01   +3.545361339713056e-01   +2.818787518028015e-01   +1.073076682747991e-01   +1.959774041302796e-01   +3.107864401428693e-01   +2.603924877334369e-01   +8.102226479798109e-02; +1.332453314060836e-01   +4.325533878052055e-01   +4.187722018976239e-01   +9.669859185015428e-02   +4.943680780854146e-01   +1.617485313577384e-01   +2.050932730971366e-01   +2.865366567305153e-01   +4.694997575256722e-01   +4.020110242827557e-01   +3.230292307262091e-01   +2.865877975452501e-01   +4.729965127248826e-01   +2.301224597840467e-01   +5.007776382300411e-01   +4.986472167580891e-01; +4.311447327657532e-01   +2.611510706579500e-01   +7.338928106013845e-02   +1.032015633833100e-01   +4.925889322421070e-01   +2.963294477020920e-02   +2.060665279621263e-01   +2.944404904271338e-01   +8.975330239518044e-02   +1.846175345468687e-01   +2.125386601087313e-01   +3.274558343575920e-01   +7.594417754036931e-02   +4.669467055485088e-01   +2.563323511344319e-01   +4.647591259685132e-01; +3.379322123152289e-01   +2.067520263045746e-01   +3.466194866066820e-01   +2.848586360286547e-01   +3.786701509184390e-01   +2.486822423976989e-01   +4.617750838613543e-01   +1.318889283372256e-01   +1.553328222225265e-01   +2.298265604168766e-01   -3.222799676240401e-02   +1.475801897465846e-01   +2.298093483499193e-01   +2.528266499955928e-01   +7.819307918650174e-02   +2.154076029768051e-01; +3.471148612612122e-01   +3.559816502598688e-01   +1.374052080775847e-01   +3.973019821633111e-01   +1.484296192254077e-01   +1.482095311462938e-01   +5.157156069132642e-01   +3.276324466867889e-01   +4.566507139762686e-01   +3.710394690540039e-01   +3.420355999247450e-01   +3.004029479665673e-01   +4.981147909741252e-01   +3.581147181570568e-01   +4.358766888226511e-01   +4.895286944731402e-01; +3.143827525463070e-01   +1.134448514031781e-02   -2.735525796911441e-02   +3.042817506253700e-01   +1.906601029985317e-01   +2.080451337605923e-01   -1.946164811838407e-03   +2.241337380222701e-01   +3.554679648769896e-01   +4.515781900791174e-01   +6.326579822752899e-02   +2.431402465366028e-01   +3.980695157169220e-01   +1.159261152855245e-01   +3.606564726431936e-02   +3.301627541428492e-01; +1.488147749298180e-01   +1.227343644910846e-01   +1.051930741492848e-01   +1.911767749106674e-01   +3.477637206458133e-01   +2.748827366224656e-01   -4.482955419715469e-02   +2.105472763114803e-01   +1.208089459438667e-01   +4.855344145849227e-01   +3.816683434498674e-01   +1.282420445250296e-01   +2.838910129806907e-01   +3.422972513439638e-01   +3.882206250924557e-01   +1.239532242223420e-01; +2.628243902747164e-01   +2.298104195438145e-01   +9.360888670209998e-02   +4.996931144697918e-01   +1.954932502386169e-01   +4.259072822634208e-01   +3.506860317397518e-01   +5.045123514349913e-01   +4.995053088566501e-02   +8.189655862495741e-02   -2.939233057072857e-02   +2.548071566538653e-01   +4.608199118240064e-01   +3.905657432445947e-01   +4.479528021480001e-02   +1.585735062917743e-01; +1.811615463417106e-03   +2.883223581875540e-01   +2.649787725430950e-01   +1.685591301317046e-01   +3.061586708967877e-01   +3.244133071784367e-01   +4.167379936196530e-01   +1.788855503716096e-01   +2.555637308128166e-01   +3.213850376009615e-01   +4.483185279495736e-01   +2.574456586443834e-01   +1.656727045559552e-01   +4.620823952074029e-01   +3.303413244527371e-01   +1.726077630916054e-01; +2.116888184901085e-01   +2.198738344272890e-02   +1.567700104324924e-01   +1.872307815835073e-01   +2.938875417569694e-01   +4.502494786130045e-01   +5.204009037160594e-01   +2.415191017187484e-01   +1.397208519630218e-01   +3.699829701320439e-01   +6.252718046724333e-02   +4.870348315482148e-01   +2.245126773660383e-01   +3.302934783350196e-02   +2.497386065361074e-01   +3.408721723679103e-02; +5.247591028514194e-01   +2.408773659427446e-01   +3.888472499727720e-01   +2.805844748840770e-01   +5.013305126322424e-01   +2.217593579466632e-01   +1.650538561062187e-01   +2.027824881756275e-01   +5.513663771336937e-01   +3.901957309303701e-01   +3.346562174191346e-01   +3.515945890192876e-01   +7.661597643730103e-02   +3.504155706168829e-01   +5.405802150005902e-01   +2.609511645226280e-01; +3.678128489443784e-01   +1.253313117286111e-01   +4.127009270885184e-01   +1.949379615910894e-01   +3.252791706458254e-01   +1.107266458752509e-01   +4.047015863810856e-01   +2.108488075596943e-01   +4.684278752837680e-02   -2.149167927862264e-02   -8.459167042459716e-03   +5.307252442181300e-02   +5.162894859821963e-01   +1.277918991341548e-01   +3.188598558140082e-01   +3.791438485822980e-01];
L1E_L1I_iGABA_netcon = [+2.346072900982094e-01   +2.829931314210137e-01   +4.843399592186939e-01   +1.686951866025519e-01   +1.872821352521885e-02   +1.800941961755233e-01   +3.753285269725437e-01   +5.764338358684425e-01   +2.830284520588441e-01   +2.052758893115354e-01   +4.291895276218444e-01   +2.214842105992317e-01   +2.283411810917202e-01   +1.766623756252625e-01   +9.220301536554711e-03   +2.539823586842329e-01; +2.407402576968972e-01   +5.339891480603874e-01   +2.377475185048488e-01   +1.328246146012687e-01   +3.918706713059212e-01   +2.767073525923394e-01   +5.069906861403868e-01   +4.362518496144913e-01   +4.417315425937735e-01   -6.829766757972349e-03   +4.406535796470520e-02   +1.988295806050103e-01   +3.672827054784232e-01   +3.425812142392808e-01   +1.287349267315524e-01   +9.682105714378045e-02; +3.104690192998698e-01   +1.794973268771850e-02   +2.363676344166212e-01   +5.018651138032040e-01   +4.952680317423661e-02   +1.102797202478278e-01   +1.914987736011856e-01   +1.093259842813300e-01   +1.892183887642124e-01   +2.862268462528907e-01   +2.566137565212852e-01   +2.033667631178718e-01   +1.080269030957963e-01   +2.752870668743967e-01   +6.453503839947922e-02   +1.814585929188540e-01; +1.543189664373619e-01   +1.473059049180712e-01   +4.366046765196380e-01   +3.406060117324317e-01   +1.274161306138007e-01   +3.767949994679176e-01   +5.093096606086300e-01   +5.760782809647096e-01   +9.176364705109871e-02   +2.453524242377011e-01   +3.676055235820101e-01   +5.251540307414265e-01   +3.245470605472624e-03   +3.355261522531061e-01   +4.224741698384124e-01   +3.878330203864981e-01; +1.788190488124014e-01   +6.925583168456645e-02   +4.623039213782233e-01   +3.074155320053434e-01   +5.416328801956455e-02   +2.992429539749590e-01   +5.336746222732505e-01   +3.837983779274878e-02   +2.315366645819857e-01   +2.626737024994386e-01   +7.844679083970124e-02   +1.767562951867528e-01   +2.809771621208055e-01   +1.656121005967815e-01   +2.291941768326392e-01   +4.828986803410960e-01; +4.099771300309717e-01   +3.440676393331485e-01   +3.599074048751624e-01   +3.703464958515399e-01   +1.262883106527803e-01   +5.471330232728605e-01   +3.745797366071683e-01   -2.415216986026584e-02   +2.943167391466617e-01   +3.320124685495181e-01   +5.873496900763914e-02   +3.736139290226452e-02   +3.734534938312091e-01   +2.854812262810080e-01   +3.298587156923900e-01   +2.378771560129370e-02; +1.085750348903628e-01   +1.470434412354827e-01   +5.863274969478304e-02   +2.519193830530257e-01   +2.099032089889691e-01   +3.308174241297093e-01   +3.109012247094902e-01   +3.593259201320892e-01   +1.896312558396026e-01   +3.243756451153059e-01   +3.130807033819811e-01   +4.145930984388196e-01   +2.862317992631290e-01   +3.547244345128681e-01   +2.068559256268069e-01   +2.103064197072388e-01; +4.168678378265202e-01   +1.061585663421429e-01   +7.043954179792232e-02   +2.147581522027645e-01   +2.362368139518924e-02   +1.208327749556228e-01   +2.764759240413280e-01   +1.593002067505694e-01   +3.807977967377333e-01   +4.551110646514434e-01   +2.675313023272642e-01   +1.355331330402051e-01   +1.963832083852876e-01   +3.575779571739230e-01   +2.502923788750920e-01   +1.295694960614564e-01; +1.537215970388721e-01   +5.670334695848842e-02   +3.908925159062385e-01   +3.109560114166112e-01   +2.060736976729104e-01   +1.343501617795007e-01   +3.314572559354811e-01   +4.411420853976153e-01   +4.268577255829802e-01   +1.696044239959872e-01   +2.809234448738842e-01   +2.452911903461978e-01   +1.101954909608646e-01   +6.258471463956328e-02   +2.301661040007278e-01   +1.900658396895220e-01; +4.338358003670698e-01   +4.067505596459124e-01   +3.338139229908254e-01   +5.014513159168346e-01   +1.371545069106334e-01   +4.247993753473563e-01   +1.600241025298437e-01   +3.224078224353570e-01   +5.143341661571341e-01   +1.812792709042714e-01   +2.299343330773448e-01   +1.387246608586458e-01   +1.886255689097285e-01   +5.204845445891859e-01   +4.664224408182905e-01   +1.580783446781268e-01; +4.713694630913001e-01   +4.027454027422862e-01   +4.545671428693466e-01   +1.620903712063903e-01   +4.714465068393098e-01   +1.440403977391838e-01   +1.442401528902956e-01   +4.159040905563967e-01   +4.356876181147395e-02   +1.432520404272493e-01   +1.766607771681247e-01   -2.783184518827984e-02   +1.563858457129780e-01   +3.144540730540595e-01   +2.352982977612072e-01   +5.072857975399841e-02; +4.052992976023034e-01   +1.028491856613543e-01   +3.791522479690957e-01   +4.630531203024121e-01   +1.676732173194498e-01   +8.379376320381213e-02   -3.036992910314461e-03   +4.770848125520605e-01   +2.760005142773918e-01   +4.388608908013176e-01   +4.381299752923692e-01   +3.785468180053657e-01   +1.259568469604904e-01   +4.922027295211702e-01   +4.430192350733213e-01   +1.312603577819813e-01; +3.643106726040183e-01   +1.936178240214595e-01   +2.078959420250953e-01   +4.901930888845703e-01   +3.637088400433388e-01   +3.024718656769032e-01   +3.646976925232909e-01   +1.393401729688507e-01   +5.446546782925218e-01   +2.829897286126862e-01   +3.842316022206005e-01   +4.163718431758636e-01   -2.201119913345131e-02   +8.039074117470335e-02   +1.215064222924903e-01   +4.614568021556787e-01; +2.547510135407696e-01   +2.869538962222859e-02   +7.677894334046978e-02   +6.924331352169419e-02   +1.840236820907975e-01   +9.894712194145084e-03   +2.542914961336000e-01   +4.653229203251131e-01   +4.580465296376857e-01   +5.671169036018314e-02   +2.766737910131972e-01   +1.261642125566454e-01   +4.720944436591872e-01   +4.318111870359144e-01   +3.469162792002972e-01   +1.485711177258092e-02; +4.980635165843680e-01   +3.435013830440781e-01   +5.581127459636913e-01   +1.627194142928395e-01   +3.445472142641653e-01   +2.400804290054389e-01   +4.969702068076347e-01   +2.510020706859737e-01   +2.816578641187268e-01   +2.941415232299875e-01   +5.901275328622631e-02   +1.428981843819799e-02   +1.834632644662405e-02   +8.569553012200790e-02   +3.930136900233437e-01   +2.738924102290740e-01; -5.663799480311876e-03   +2.065748185015847e-01   +3.272249235474917e-01   +2.880163058764295e-01   +3.511129712416343e-01   +4.493164163376986e-01   +4.322333427328822e-01   +1.138337992842932e-01   +5.240314061594271e-01   +8.111495502251169e-03   +4.793870480728578e-01   +4.604109601190992e-01   +2.391971983942006e-01   +5.064122133108584e-01   +8.880674116918673e-02   +2.152799046705285e-01];
L2I_L1I_iGABA_netcon = [+1.004170450355757e-01   +4.267537686995912e-01   +1.420415249245943e-01   +3.136266652127975e-02   +2.600812709981095e-01   +2.140562092008545e-01   -1.132615776223954e-02   +3.679865897744600e-01; +2.124794660913783e-01   +1.689727421820878e-01   +4.432790974264577e-01   +1.573677505039733e-01   +1.027080529944683e-01   +3.694063345935535e-01   +4.768097732307921e-01   +1.890793465993779e-01; +2.739624243393789e-02   +1.357405757471013e-01   +2.805204241639314e-01   +4.757027877075691e-01   +2.769466505409006e-02   +4.684183787817198e-02   +2.079401338002065e-01   -2.797209806790912e-02; +2.810937490359379e-01   +1.652424977119113e-02   +8.617491207281984e-02   +5.320494427118053e-01   +1.337431323102875e-01   +1.887306840175784e-01   +1.042448485006900e-01   +2.957852900660462e-01; +4.151706768082964e-01   +1.659746644707886e-01   +1.618042430357660e-01   +2.763732809878784e-01   +5.037441000227723e-01   +3.408378846435440e-01   +4.090972228396482e-01   +4.509504464611502e-01; +4.810024750118560e-01   +4.938583198613958e-02   +4.340258410793321e-02   +4.541366939387411e-02   +4.491817544255763e-01   +1.682917840876538e-01   +1.743929214406035e-01   +3.148352670460734e-01; +2.620985724841871e-01   +9.559669896576714e-03   +3.841834629577251e-01   +1.711034988745433e-01   +1.429540769906606e-01   +8.945920334717650e-02   +3.635241205374262e-01   +2.981797118079598e-01; +1.530571269791599e-01   +1.407489061183631e-01   +5.255525444047238e-01   +9.089049438820676e-02   +1.236929021564157e-01   +6.688301948389390e-02   +1.987786372022889e-01   +2.185104736718934e-01; +5.020309863847503e-01   +2.773586877445713e-01   +3.116745695631552e-01   -9.726707105790919e-03   +3.164965867296166e-01   +4.614109759960350e-01   +3.258493962010719e-01   +6.021608946418791e-02; +1.306850982549993e-01   +1.911445353213732e-01   +4.110891250005988e-01   +1.533851196669144e-01   +3.300245295385993e-01   +2.902096109692551e-01   +1.884846102509227e-01   -3.379242818054732e-02; +3.239618216516592e-01   +4.764460768841457e-01   +1.221065838702448e-01   +4.461543339224945e-01   +1.054505295851793e-01   +2.828389200959877e-01   +4.624161301114405e-01   +4.908257065156215e-01; +4.203610630683488e-01   +5.395732600772454e-01   +8.068813800910644e-02   +3.802398013459909e-01   +4.330138878863510e-01   +2.243497854636547e-01   +1.044107530804663e-01   +3.916564929765541e-01; +3.448455587833443e-01   +4.970356068090848e-01   +4.668751335549172e-01   +4.305947117013250e-01   +3.522461531230975e-01   +1.461073814457118e-01   -2.779461235891773e-02   +2.757386856955976e-01; +4.380996141090956e-01   +4.356101066523897e-01   +4.603018596486307e-01   +3.923750363265074e-01   +3.909241642686256e-01   +4.379371221849150e-01   +9.941348926657748e-02   +1.905738433741682e-01; +2.230066391197995e-01   +1.985912099389448e-01   +3.228291175094181e-01   +2.387009096909023e-01   +5.123792925521620e-02   +1.476167042670332e-01   +2.564766382706648e-01   +2.905530355398471e-01; +5.077404426209479e-02   +4.036066306325766e-01   +2.020951314152375e-01   +4.824993592027819e-01   +4.161423118541777e-01   +4.362635971631078e-02   +4.304345970414968e-01   +1.071130058265508e-01];
L1I_L2I_iGABA_netcon = [+9.146697578817760e-02   +4.522242783922867e-01   +1.263687278080092e-01   +3.316445834972021e-01   +4.470440935332473e-01   +1.277942718916721e-02   +2.641460147025788e-01   +1.751011166506699e-01   +1.748003206816635e-01   +5.797451743392804e-02   +2.052897689750016e-01   +2.776823883695234e-01   +2.663518575389811e-01   +2.463314978245005e-01   +4.231591343005191e-01   +2.772405746109086e-01; +2.169625870334342e-01   +4.504891433053730e-01   +1.586294227563625e-01   +7.185849434720602e-02   +5.171518612437462e-01   +3.523614548138083e-01   +4.016318492501034e-01   +4.869753074407478e-01   +1.904110204382891e-01   +1.072602878518643e-01   +4.173364068534977e-01   +2.762171775484146e-01   +1.874314751155472e-01   +1.857122016978243e-01   +2.957143828385232e-01   +4.340136958212503e-01; +1.592207482688592e-01   +1.225684158973366e-01   +3.468561858348997e-01   +4.236783278669607e-01   +2.200097721386469e-01   -5.884014919811754e-03   +2.647049789521448e-02   +4.374182293470227e-02   +2.317264092326307e-01   +1.575698974453313e-01   +3.275876175658969e-01   +3.142793848221994e-01   +2.819020941298568e-01   +4.142779947417888e-02   +1.559830929820271e-01   +4.200715542630919e-01; +2.628943041537745e-01   +3.854377220304942e-01   +3.465913478475797e-01   +2.043695096476016e-01   +6.662995646145094e-03   +2.899180098527223e-01   +1.837063651440963e-01   +5.332395880543005e-01   +1.565883627172560e-01   +3.534450765323137e-01   +1.991411545768656e-01   +2.306162387230100e-01   +7.359129041980675e-02   +4.151409974039288e-01   +3.057414858264604e-01   +2.309036253570886e-01; +1.117316552305757e-01   +1.255263078837409e-02   +4.927891534045737e-01   -2.295233900195137e-02   +4.185842714514314e-01   +4.952498730382156e-01   +1.222469388842387e-01   +2.337629801000130e-01   +2.648114895545701e-01   +1.447074592082460e-01   +3.809196728480658e-01   +1.945597768470389e-02   +4.389464588354221e-01   +2.756601772665384e-01   +2.801862121071111e-01   +2.691321307656570e-01; +1.158089896362896e-01   +3.142577436889581e-01   +7.817137229289273e-02   +4.931980009780461e-01   -7.341604568654767e-03   +5.236261114447209e-01   +4.073995418306729e-01   +7.926499748513792e-02   +2.027616088383666e-01   +6.055237698829787e-02   +4.939033381288941e-01   +2.001876361882030e-01   +2.454899045264949e-01   +2.823615112203676e-01   +1.321187946734483e-01   +3.489392561112688e-01; +8.951457438769155e-02   +2.808420591268314e-02   +2.848256860308732e-01   -3.655143197717317e-02   +2.230608527674161e-01   +7.112994695188496e-02   +4.629817194128187e-01   +3.447825061260598e-01   +4.175533153280889e-01   +3.213208528559516e-01   +1.471852290798068e-01   +2.811926935272723e-01   +1.973255486508887e-01   +1.864848868374745e-01   +5.158393820364997e-01   +4.568260418067093e-01; +2.083176020059175e-01   +1.595512323281350e-01   +4.922538409702170e-01   +6.085373344622066e-02   +2.770608275169192e-01   +2.783742630847461e-01   +1.170051172126581e-01   +4.313765228544063e-01   +5.011228936246362e-01   +1.908017271873222e-01   +2.946570667543275e-01   +1.339328652453041e-01   +2.573323908341270e-01   +2.446876227646563e-01   +3.434711067840456e-01   +2.708614082648749e-01];
L2E_L1E_iAMPA_netcon = [+3.957465521144049e-01   +2.440926179581118e-01   +7.501590817213775e-02   +3.534241523611152e-01   +3.044863865221596e-02   -1.432130622069170e-02   +2.623828215767912e-01   +2.455637055845054e-01; +4.119423838142385e-01   +9.835569399461782e-03   +3.948354462723525e-01   +1.758426974340768e-01   +4.134965324509980e-02   +1.667041965986928e-01   +1.668688621121000e-02   +5.644064256819314e-02; +1.476754303035841e-01   +4.405668231450314e-01   +4.258973368102712e-01   +3.412521098677223e-01   +5.120684829699590e-01   +1.275859328897612e-01   +2.240699275285159e-01   +2.261821459902938e-01; +1.783922682261305e-01   +4.676191145950405e-01   +3.903063219234424e-01   +7.057311352997603e-02   +1.271443220898356e-01   +5.084707982565040e-01   +4.104840583562244e-02   +1.487082195714817e-01; +1.424040869682589e-01   +2.544371253585656e-01   +2.694326826259115e-01   +4.642281858583570e-01   +4.544779137690987e-01   +5.040832500182639e-01   +8.951728260497241e-02   +7.832550301565007e-02; +2.190678861895483e-01   +1.396445131110370e-01   +5.308208399253915e-01   +1.555943271896743e-01   +3.364390878177556e-01   +3.128631719317108e-01   +3.346454812745588e-02   +7.336554154321571e-02; +1.907959861672519e-02   +4.112429632318538e-01   +3.256755538924729e-01   +4.594743530875449e-01   +1.174307567967714e-01   +1.506162018844084e-01   +4.299983183517365e-02   +2.055155652823144e-01; +8.862544232477253e-02   +1.851898798962880e-01   +3.193234946584418e-01   +1.072414332774622e-02   +2.102398403773804e-01   +3.846256708287717e-01   +5.885289557940231e-02   +9.788974976530099e-02; +4.396755309406753e-01   +2.766737323721200e-01   +2.903036981594788e-01   +4.197858121159023e-01   +4.498587760613404e-01   +1.449895577193145e-01   +9.838073490019780e-02   +4.909566535682316e-01; +2.240967980231473e-01   +1.175649327173425e-01   +5.868174948804619e-02   +3.221627706397445e-01   +2.233017127208350e-02   +4.725736394956785e-01   +4.421928500048808e-01   +3.598763104743941e-01; +1.931267153752472e-01   +1.466719350653163e-02   +7.299496226093051e-02   +6.137376472341272e-02   +3.498604440974188e-01   +1.114733673629146e-01   +1.976094131513597e-01   +1.440331674124080e-01; +1.747335144884676e-01   +8.893120996692425e-02   +2.198209971881231e-01   +3.351336795970873e-02   +1.147018947776341e-01   +5.092462777028155e-01   +3.040603599982803e-01   +5.247879556763220e-02; +4.586168173975811e-01   +4.485559653076387e-01   +1.400563819611230e-01   +1.426960913483366e-01   +1.385895578350967e-01   +3.141234652224044e-01   +1.832093140701316e-01   +5.588734305692808e-01; +1.543683313684532e-01   +3.395120317605013e-01   +3.368507739138859e-01   +3.509961506784635e-03   +1.197767171064799e-01   +1.527626297644279e-01   +2.453312777602651e-01   -2.090318860306553e-02; +4.676047727564128e-01   +4.628813034952161e-01   +1.948170163794182e-01   +1.335797506944694e-01   +1.525231852695212e-01   +1.608361907812538e-01   -5.973841998855441e-02   +4.452567388382562e-01; +4.804617528398987e-01   -6.310231062172028e-02   +2.446986282084060e-01   +2.640428493339578e-01   +4.148335088321342e-01   +3.247886780711035e-01   +2.317215742355906e-01   +5.273239109878953e-01];
L1E_L2E_iAMPA_netcon = [+2.895415419404851e-01   +2.041843903093623e-01   +2.802083989908494e-01   +1.862723048600901e-01   +5.611415149045892e-03   +2.249844485591092e-01   +2.433434260281101e-01   +3.608854958657023e-02   +8.773865540614342e-02   +4.717854449797337e-01   +5.069256494819984e-01   +4.324876354550451e-01   +3.708361464336939e-01   +4.520268353615903e-01   +1.347646552016375e-01   +3.830934763748454e-02; +4.758051648856538e-01   +9.848315396897034e-02   +1.496886874515286e-02   +3.291105548426164e-01   +2.707406692661909e-01   +3.357693483133722e-02   +2.541308981819612e-01   +1.856743916837443e-01   +4.210829608509444e-01   +3.538862602431753e-01   +3.013920750267203e-01   +4.058827676677675e-01   +5.362355847860199e-02   +4.402783957986821e-01   +1.349102747959056e-01   +3.669003813476538e-01; +2.050974469216698e-01   +3.110519710964056e-01   +1.420750868197047e-01   +5.387544137209696e-02   +4.000822235417508e-01   +1.742781931158603e-01   +4.073167289018516e-01   +1.612838885528350e-01   +8.573184225069438e-02   +4.898354892780620e-01   +4.549745582625829e-01   +1.227607482801128e-01   +4.664845142836695e-02   +3.304410128688081e-01   +2.114296895138789e-01   +3.207652125980912e-01; +4.312788880994524e-01   +5.558690060738820e-01   +9.326372635518501e-02   +2.280915805612618e-01   +1.622046456647135e-01   +2.159173230564850e-01   +2.824674885784019e-01   +7.178413950286716e-02   +3.001421511632597e-01   +4.367730709331332e-01   +3.057046031535345e-01   +4.089298076342845e-01   +4.424353855059157e-01   +2.947571505395555e-01   -3.598847001360712e-02   +1.930646247313386e-01; +7.403985873798823e-03   +1.633447140917873e-01   +4.084122730443439e-02   +3.406850481199015e-01   +4.488303094119821e-01   +5.281964580423304e-01   +4.094740697409417e-01   +2.490235948919396e-01   +1.535083738411864e-01   +4.839997021861334e-01   +3.642339746825682e-01   +2.919068741797959e-01   +3.690944632590907e-01   +3.008773107296366e-01   +2.573994854511909e-03   +4.196562716050302e-01; +2.784172156233660e-01   +3.352086929733210e-01   +5.179518992956590e-01   +4.128383988907109e-01   +3.435483599179622e-01   +4.254548139320462e-02   +3.216391102759497e-01   +9.356688616962615e-02   +2.683500334384672e-01   +4.183970827427493e-01   +2.976400402558591e-01   +3.132566095429988e-01   +4.536606949788682e-01   +9.664828990074810e-02   +1.765784244631810e-01   +3.591851469497372e-01; +3.242975468835191e-01   +3.332996822306150e-01   +4.393928753518070e-01   +3.617547729753883e-01   +2.228693631781073e-01   +1.697152517680679e-01   +2.088237082619736e-01   +1.711080856288061e-01   +6.769235003240894e-02   +2.443076095790884e-01   +5.880904643899869e-02   +3.804267315999483e-01   +3.042700654785222e-01   +5.727072556917764e-01   +1.593509839938043e-01   +1.281345396270621e-01; +3.378915700485600e-01   +4.983614972888858e-01   +3.763625903806023e-01   +1.794346069727179e-01   +2.239942764071667e-02   -1.658748771253481e-02   +4.037841496589483e-01   +1.498197832960328e-01   +3.581288590675011e-01   +4.449623608849952e-01   +2.870490812772665e-01   +2.679402372558252e-01   +4.982639055276844e-01   +8.686616360337260e-02   +2.040007354347198e-01   +3.007750787654782e-01];
L2I_L2E_iAMPA_netcon = [+1.609384556832804e-01   +4.105518833525491e-01   +9.076242653952359e-02   +1.957227055562326e-01   +1.255506052906763e-01   +1.492603496688555e-01   +3.032820387047289e-02   +2.753959497823414e-01; +3.543075176405776e-01   +5.909021110008321e-01   +2.369370014731377e-02   +5.345500882291245e-01   +3.647962828437200e-01   +2.725959328702094e-01   +4.797614622633508e-01   +3.068814798887337e-01; +1.850003978283159e-01   +3.262148159306471e-01   +7.683571361337142e-02   +2.732500908812794e-01   +1.077420607497444e-01   +4.159348994900464e-02   +4.404497840392288e-02   +3.121904069390501e-01; +5.274056322450239e-01   +2.245248411297147e-02   +2.423911858565586e-01   +2.675410900670320e-01   +4.691314486826985e-01   +1.660157215155643e-01   +6.793230686498411e-02   +4.566366669241627e-01; +9.084372898656791e-02   +5.287791739621235e-01   +7.532626818908487e-02   +3.867897493437459e-01   +9.375752100535495e-02   +3.303409388957392e-01   +2.812607098541232e-01   +4.137042028500764e-01; +3.299104782110003e-01   +2.366296097289739e-01   +3.559503158305685e-01   +2.734470933329298e-01   +3.994667022499559e-01   +4.859408257166219e-01   +3.123890368311307e-01   +1.983319220303603e-01; +4.244203419514931e-01   +3.809257092310248e-01   +3.274344807398252e-01   -3.095650319686247e-02   +2.779804341723391e-01   +3.169915581214932e-01   +1.484658197177833e-01   +4.508548352244433e-01; +1.327578272818611e-01   +9.765108109662356e-02   +4.964803568215919e-01   +3.380949569256895e-01   +1.391925734727226e-01   +3.441978565725926e-01   +6.085901458519587e-02   +2.715694885208398e-02];
L2E_L2I_iGABA_netcon = [+4.388530665809379e-02   +4.793517409839946e-01   +3.574536501703960e-01   +2.834065538836004e-01   +2.241420405216408e-01   +3.259135689677784e-01   +1.240006515703526e-01   +3.132949429753973e-01; +1.736366500304919e-03   +1.130300425327840e-01   +4.684389676356993e-01   -1.824857717369435e-02   +9.389699152123578e-02   +3.382508301440321e-01   +3.935260791700581e-01   +2.445790450928368e-01; +2.813139365640926e-01   +2.635292296434742e-01   +4.270036707836286e-01   +2.516682581010449e-01   +3.412802140130554e-02   +1.096930875337047e-01   +2.922695453898366e-01   +2.066194312631506e-01; +4.168906873197026e-01   +3.267313051314071e-01   +2.222474192217908e-01   +4.712401664574178e-01   +1.035524436348453e-01   +2.332634301244437e-01   +1.080837950007366e-01   +2.686976429595284e-01; +2.351030822014475e-01   +4.036113388920364e-01   +4.345717832029677e-01   +7.298572591102054e-02   +2.303225165542624e-02   +2.538018681465762e-01   +4.457156244160750e-01   +4.042456079064651e-01; +1.573384241660215e-01   +3.326755032452095e-01   +4.617342564729547e-01   +6.991194272213423e-02   +7.942434018870238e-02   +3.139994951683850e-01   +3.511802420076793e-01   +1.060030708481405e-01; +3.660773857359230e-02   +1.543199998746410e-01   +4.212684638748878e-01   +3.744470326662696e-01   +1.201066071168756e-01   +4.211689804271950e-01   +2.764852878130841e-01   +5.428782699247791e-01; +4.176160187619916e-01   +4.933435273968811e-01   +2.427136674133699e-01   +3.980668719536368e-01   +1.377448278896613e-01   +1.277489069390546e-01   +7.621041170478791e-02   -4.863750292054292e-02];
L3E_L2E_iAMPA_netcon = [+2.355740397093439e-01   +1.822279528763666e-01   +1.229968892742319e-01   +1.835561144706223e-01   +1.574374569802819e-01   +2.608151228018108e-02   +6.016736432181626e-02   +1.123029500755983e-01   +1.810505549414561e-01   +1.371164406363933e-01   +5.056312894412894e-01   +3.424910163418936e-01; +1.705821995422648e-01   -3.010606226040602e-03   +4.019510650239125e-01   +2.872335447460804e-01   +4.957769089071389e-02   +4.114961311102329e-01   +2.152915060323390e-01   +9.682261118398654e-02   +3.124770363600596e-01   +3.736327078990754e-01   +1.043073564384953e-01   +4.877027242839420e-02; +5.049254992053989e-01   +1.045521307991950e-01   +1.861062929999064e-01   +3.912363808512579e-01   +5.270929322547124e-01   +9.642490715415415e-02   +3.075962354586185e-01   +2.670320310421097e-01   +3.316055439167812e-01   +1.675806013672587e-01   +3.438380179025500e-01   +2.015050537793383e-01; +3.511425758853357e-01   +1.437616630692448e-01   +2.234552940391747e-01   +4.268007678864217e-01   +1.496828488094399e-01   +5.592714250354487e-02   +3.951245229159614e-01   +1.193345751274724e-01   +1.588887139422822e-01   +1.093538487247772e-01   +2.246094298434550e-01   +3.961124714148041e-01; +3.765341012597944e-01   +6.146655763595395e-02   +3.320395845040452e-01   +7.511700133028087e-02   +1.064506094856577e-01   +1.310479063856085e-01   +3.189747348363213e-01   +3.829448973942951e-01   +3.792785440810692e-01   +1.474060698437248e-01   +3.660108556616283e-01   +4.760836870826693e-01; +2.418619443261424e-01   +9.009704223624854e-02   +1.203798312673438e-01   -4.934599833458617e-02   +8.213374924754627e-02   +2.485156331623126e-01   +3.095298857272779e-01   +9.065008822680276e-02   +3.445559930924054e-01   +4.032674309349707e-01   +3.812141921825224e-01   +6.949496791077668e-02; +5.575295000255626e-01   +3.775849743734503e-01   +1.311952414826430e-01   +6.832308087735002e-02   +4.756816115415803e-01   +1.687024769025796e-01   +2.770419103066119e-01   +1.122925993695164e-01   +4.706061436355342e-02   +1.180938765348049e-01   +1.380572862527844e-01   +3.441159272294360e-01; +7.900076419612963e-02   +3.952077571495612e-01   +3.840971942902727e-01   +1.046042447796187e-01   +4.164676128500820e-01   +8.327127510251493e-02   +3.599750843033023e-01   +2.331083257833932e-01   +1.583905821499508e-01   +2.044924134443277e-01   +1.458446948334708e-01   +3.652054358481457e-01];
L3I_L2I_iGABA_netcon = [+1.451090944138032e-01   +1.394292924328711e-01   +4.637329948628855e-01   +1.684596015707909e-01   +3.821368746934756e-01   +4.122445508742241e-01   +2.800541226049346e-01   +3.881139780406364e-01   +1.569231696887790e-01   +1.585696109827407e-01   +2.351003809647638e-01   +3.871073940427950e-01; +4.724523849035706e-01   +1.284506448576566e-01   +2.747001140773644e-01   +2.073890965232589e-01   +4.815704086020525e-01   +2.713065316057995e-01   +2.220718681168050e-01   +3.909667207488367e-01   +4.913104826518360e-01   +2.233917274364761e-01   +4.012509967577785e-01   +4.420015261757398e-01; +1.140025108627318e-01   +2.900059764432070e-01   +2.626026283494834e-01   +3.938477965377118e-01   +3.407622779308920e-01   +3.239514684919736e-01   +4.142660100935208e-01   +3.414430518778267e-01   +5.039567611967379e-01   +3.851025120956276e-01   +1.217808204015440e-01   +5.192052352026881e-01; +3.677610062527187e-01   +1.776061048514867e-01   +2.531086204346024e-01   +3.257050154942681e-01   +4.489972490176737e-01   -7.906316687186363e-03   +7.893558267455535e-02   +8.169418604685655e-02   +1.030311634834897e-01   +2.025748545860777e-02   +1.661639430258818e-01   +2.440579364104311e-01; +3.430954531915448e-01   +5.331880454399996e-01   +1.038843428607342e-01   +4.273443043168123e-01   +3.859909636191101e-01   +2.829083915964464e-01   +8.689844946883994e-02   +2.666313670482983e-01   +1.944150701639263e-01   +3.385880952505970e-01   +2.618220019210477e-01   +3.884379953707522e-01; +2.884783633539281e-01   +4.520526729573280e-01   +2.332336840980812e-01   +3.607879316458398e-01   -2.780471495453313e-02   +1.625290628897015e-01   +2.570985031165804e-01   +2.788754717828275e-01   +3.391852172733015e-01   +7.705829536491886e-02   +1.595669592432659e-02   +4.652767070658914e-01; +5.772816867990280e-02   +1.532361319413703e-01   +3.243132653706848e-01   +4.337769605093885e-01   +4.031740962053887e-01   +1.336745256900939e-01   +3.784852771733008e-01   +3.573239032092735e-01   +3.445391003798836e-01   +2.698529815617016e-01   +1.271740942212020e-01   +1.904916419885463e-01; +2.451727313599836e-01   +2.295889406092305e-01   +1.150157200345495e-01   +1.948595081041271e-01   +4.204885369584667e-01   +4.736989397396629e-01   +2.008058036085173e-01   -1.030204267549925e-02   +7.491184920369118e-02   +1.646513393621049e-01   +1.409836074025435e-01   +4.332915770575786e-01];
L2E_L3E_iAMPA_netcon = [+4.391060971807270e-01   +2.754672474727813e-01   +6.454341928753193e-02   +5.222352078895244e-01   +2.299540058822476e-01   +4.239739950540916e-02   +2.292187908441397e-01   +2.487505776780192e-01; +4.952334096499887e-01   +2.985791071025070e-01   +2.277707427412441e-01   +9.727065353266270e-04   +4.085053397439267e-01   +3.544710525153216e-01   +2.161028992078341e-01   +1.548131492852974e-01; +2.097449313029618e-01   +9.606320672089923e-02   +9.293725116975741e-02   +2.894704803088404e-01   +4.098551404867647e-01   +3.112343243728247e-01   -1.269166829825101e-02   +3.663176185602219e-01; +2.666466888878587e-01   +3.536915360690918e-01   +9.398153374682151e-02   +9.411503181943911e-03   +1.411586853262213e-01   +1.800156509740008e-01   +5.019544532312270e-02   +3.172299516367870e-01; +3.370077000793518e-01   +4.590226359624495e-01   +6.212512935722048e-02   +4.319030099495472e-01   +1.727503254438223e-01   +3.327972835696161e-02   +4.664074488951475e-01   +4.690127480628584e-01; +3.999634158256044e-01   +2.883658539753063e-01   +2.826646789322247e-01   +1.262143948659487e-01   +4.324163227277693e-01   +1.159901398899509e-01   +4.008488746567481e-01   +4.798334759991192e-01; +2.737016624142259e-01   +4.658102346617955e-01   +3.468987327362177e-01   +1.273013821378163e-01   +4.430826395083251e-02   +2.638729515915092e-01   +6.214899442846628e-02   +4.335067782813822e-01; +2.131209088883702e-01   +2.192278787523919e-01   +4.066345703156604e-01   +2.176177419502851e-01   +2.099889729105112e-01   +1.291920463332221e-01   +1.875774153689212e-01   +3.713661270863164e-01; +3.773817284087451e-01   +8.082489442118886e-02   +2.150795897887874e-01   +1.868067808564196e-01   +2.980595325448980e-02   +3.360340926640210e-01   -6.424601597891458e-03   +2.636771137195689e-01; +2.740989273911143e-01   +3.596231692128855e-01   +4.352304202213787e-01   +1.244232526127252e-01   -1.070883440832393e-04   +2.047500634738215e-01   +3.837753689837660e-01   +1.503160482319085e-01; +1.507258532680786e-01   +3.606680910303225e-01   +2.658433874389239e-02   +2.154709871484196e-01   +4.991513651392032e-02   +2.996497874496055e-01   +5.132262264385121e-01   +3.474793578558051e-01; +2.006171383104195e-01   +1.059681804043821e-01   +3.898493838928415e-01   +2.401394745342239e-01   +4.500333431907655e-01   +4.706244080863522e-01   +3.280398994590980e-02   +1.894860186261578e-01];
L2I_L3I_iGABA_netcon = [+1.946077357480238e-01   +4.737517903684765e-01   +3.045183217881101e-01   +3.550491106940826e-01   +3.902244696656023e-01   +2.867202253571547e-01   +4.055845751703155e-01   +3.047292138714667e-01; +2.960890396612668e-01   +1.111145841554296e-01   +2.244219174706567e-01   +9.274880898176108e-02   +1.521380395491021e-01   +2.584892145164713e-01   +3.757809718545401e-01   +5.173869995125494e-01; +2.295341576586745e-02   +5.209820525322501e-01   +4.322324328956446e-01   +9.690857274348608e-02   +2.858353859698278e-01   +1.206637864810207e-01   +4.564122310095145e-01   +5.230138151540373e-01; +3.995022450551963e-01   +9.565246040509232e-02   +1.862365902259321e-01   +1.188220055135110e-01   +2.148195372020926e-01   +2.507273350847614e-01   +7.175969253657268e-02   +2.028971970024088e-01; +5.389650479513062e-01   +1.040577648057561e-01   +1.317734662921198e-01   +2.117851553768826e-01   +2.345036380604724e-01   +4.648903817349911e-01   +2.642702576971014e-01   +4.891883790175980e-01; +2.674825512065277e-01   +4.011628564308697e-01   -6.940635019395552e-02   +3.760695091140944e-01   +4.258183513754910e-01   +2.446464980920289e-01   +2.902121498072839e-01   -9.608464309239312e-03; +3.846283669872909e-01   -2.276943391075212e-02   +4.494962435101743e-01   +5.223699815971338e-01   +7.156866230627287e-02   -3.202891696014405e-02   +1.124335783383177e-01   +7.762871240768474e-02; +4.995876863136716e-01   +3.292376132431374e-01   +3.721482118414337e-01   +9.358162845949400e-02   +4.730136014074027e-02   +1.883372361249312e-01   +4.571466178841138e-01   +3.175880854613797e-01; +4.713694140970062e-01   +3.380559751367187e-01   +2.365772557340056e-02   +4.713190417090209e-01   +3.736563005418731e-01   +3.142135736899892e-01   +3.088960377931319e-01   +1.990004735912551e-01; +1.797048971957150e-01   +3.734294652827490e-01   +2.244755267871140e-01   +5.035594953131091e-01   +4.466570172351055e-01   +2.826332179945212e-01   +5.577080097106188e-02   +4.329187853087516e-01; +5.375456526315816e-01   +2.628560938747565e-01   +3.053265700783769e-01   +3.953151402676716e-01   +3.611384399214468e-01   +1.612628830465174e-01   +3.157946036790441e-01   -1.957113254838665e-02; +4.565575889194270e-01   +3.896516231079148e-01   +4.163414308939818e-01   +5.204051771074396e-01   +4.525586224750995e-01   +4.577284440576079e-01   +2.179684424229570e-01   +3.968354805465210e-01];
L3I_L3E_iAMPA_netcon = [+4.028294214874304e-01   +3.105968127044234e-01   +6.618865193565523e-02   +1.613477719966932e-02   +2.473483973983983e-01   +2.818913012219917e-01   +4.538666472513228e-01   +4.433693837521704e-01   +6.137760462520815e-02   +3.390064976780897e-01   +4.649050620817114e-01   +3.428601909838243e-01; +2.256123499512182e-01   +1.903289568808814e-01   +4.853438587527697e-01   +1.766472492079849e-01   +7.173475406232122e-02   +3.080120909929526e-01   +7.045600661571806e-02   -4.493683362195691e-02   +1.782494497045980e-01   +3.130194432678841e-01   +1.754089274276754e-01   +2.755133739404814e-01; +2.063735258788018e-01   +2.874794301878383e-01   +4.560542452677170e-01   +2.490013709935921e-01   +2.327804735805961e-01   +4.877186583615249e-01   +3.853534403384787e-01   +1.557512149258332e-01   +2.330607814967353e-01   +3.297789719113486e-01   +4.110764627410037e-01   +8.845294775662413e-02; +2.440640643006822e-01   +3.359001430455321e-01   +2.279642773681454e-01   +3.657723849130069e-02   +2.474162931769920e-01   +1.796569475020348e-01   +4.442431577302433e-01   +5.466194628382702e-01   +3.831748437740363e-01   +2.643627554507448e-01   +2.949396142321963e-01   +4.892209805235308e-01; +3.408176572530169e-01   +2.261194346805454e-01   +2.124806731950636e-01   +4.090499982030886e-01   +4.228967713086243e-01   +1.742606470843846e-01   +3.494347708584328e-01   +4.691054702587569e-01   +6.947693303989270e-02   -5.750082234601390e-02   +1.098359324332070e-02   +2.448757562568034e-01; +4.353496517804502e-01   +2.847584376598866e-01   +1.046821455224235e-01   +4.591511299504542e-01   +1.517825617499808e-01   +4.069467493851969e-02   +4.318605996844466e-01   +2.378726986152731e-01   +2.458156862546415e-01   +4.683386260364827e-02   +2.371682652770857e-02   +2.057421922249790e-01; +1.653666851502130e-01   +1.956099144765505e-01   +6.656797917311655e-02   +3.401878898515219e-01   +2.695850388391962e-01   +1.148468783000259e-01   +1.312104577660264e-01   +4.091572511868925e-01   +1.724998019990047e-01   +5.126931411202340e-01   +3.926238630106015e-01   +1.423722411423602e-01; +4.427220119643137e-01   +9.442528182814099e-02   +3.962661076793486e-01   +1.234901583802582e-01   +2.466334509397253e-01   +2.428967922828224e-01   +4.351344504377639e-01   +3.163309058620912e-01   +5.394397291881553e-01   -9.399622035157863e-03   +9.551829045989807e-02   +1.399900844867301e-01; +3.814212706589376e-01   +3.336979542226437e-01   +1.585882862077418e-01   +4.427646732111132e-01   +5.512893605606649e-01   +2.094052020304353e-01   +4.292749703396980e-02   +4.068739906196749e-01   +2.611182286255753e-01   +4.709788674068959e-01   +1.230827857003665e-01   +1.012529412585589e-01; +2.473535942453070e-01   +3.637486445648503e-01   +4.324750634532247e-01   +3.630637718352723e-01   +2.094471731413958e-01   +5.708461919550806e-02   +2.816957705919398e-01   +3.945686412207112e-01   +2.551689936433374e-01   +3.664766094996153e-01   +4.662065335067586e-01   +3.730969199477497e-01; +3.864586684505568e-01   +3.105407835795322e-01   +2.376514100809195e-01   +2.382016851196884e-02   +4.436917240897053e-01   +1.911339564407072e-01   +1.657487637174981e-01   +1.954906790113893e-01   +4.461484324307289e-01   +2.305649588713566e-01   +3.792158263102241e-01   +4.146339713725976e-01; +3.068638371552557e-01   +3.509337962108869e-01   +1.013423335844081e-01   +2.714528310590125e-01   +4.253046173583545e-01   +4.612384905980044e-01   +4.274984787220814e-01   +3.849245475668016e-01   +1.750546665946550e-01   +4.528480728721342e-01   +4.942565100741383e-01   +4.462533590675644e-02];
L3E_L3I_iGABA_netcon = [+4.533612002620414e-01   +4.155414382550289e-01   +4.088649166538519e-01   +1.575425936494693e-01   +5.216769879540475e-01   +3.893066540858325e-01   +2.030481546271150e-01   +3.270019897132251e-01   +2.757210064496137e-01   +1.852514465255306e-01   +2.983548340193997e-01   +3.460778991094666e-01; +2.907135844702610e-01   +1.800404749669251e-01   +1.672476950896611e-01   +5.243035209732551e-01   +1.986347974529449e-01   +1.872518827068029e-01   +3.553330550642994e-01   +1.613340897309826e-01   +1.379571391696807e-01   +4.264909007013690e-01   +8.421366812264791e-02   +2.075457223958674e-01; +2.698893686552459e-01   +4.655638601420456e-01   +4.606081644867900e-01   +1.209324273491338e-01   +2.552497819407972e-01   +3.606874368948860e-01   +2.178948253452161e-01   +2.537736895230644e-01   +3.711846493744998e-01   +2.908456443228930e-01   +1.449389761466837e-01   +2.358757663683709e-01; +5.241849483077402e-02   +6.067759859846771e-02   +5.820747812258037e-02   +2.031159216820637e-01   +4.202961956888436e-01   +1.752094852844218e-01   +2.219971963761688e-01   +4.088493867567113e-01   +2.004134882896135e-01   +3.509937027612984e-01   +1.845348083767215e-01   +7.257962446820306e-02; +1.976878324524693e-01   +2.255813739254491e-01   +7.187391088650671e-02   -1.589271506614885e-02   +7.573350575822799e-02   +1.158198294983340e-01   +1.750857720033397e-01   +4.485890688768346e-01   +1.155193972957061e-01   +1.837849280967943e-01   +6.660638924221098e-02   +4.645417264447437e-01; +7.842904827861184e-02   +4.914917215953350e-01   +4.191026754032782e-01   +4.972790238174661e-02   +1.360487170709669e-01   +3.730941273222429e-01   +2.181602292581887e-01   +1.001429683257738e-01   +2.494702900353254e-01   +4.763614511519421e-01   +3.864705491947433e-01   +4.362589890749223e-01; +4.159841406855068e-02   +2.430003097697570e-02   +1.080209940948709e-01   +3.711439163110160e-01   +1.190753606968526e-01   +2.063908983622763e-01   +2.876947668835026e-01   +3.651751108307056e-01   +3.486587314053400e-01   +4.017121812587471e-01   +2.843376620446142e-01   -1.003466278088677e-02; +2.287132461945353e-01   +3.496257467455111e-01   +1.385362889929996e-01   +4.324728914300343e-01   +3.254914081717045e-01   +3.157747512135608e-01   +4.512747862481149e-01   +1.878267986476861e-01   +1.953163043666900e-01   +2.306143301025149e-01   +3.430862353781579e-01   +1.341331826964390e-02; +2.770943000889917e-01   +1.685457899142714e-01   +6.542088363834876e-02   +3.423860884014480e-01   +2.133118156215138e-01   +3.218365919757431e-02   +4.000505363068498e-01   +1.562719217404993e-01   +3.864948837068332e-01   +4.329920247887014e-01   +1.208757610596789e-01   +3.094927902077366e-01; +1.040659758716181e-01   +1.717346899138050e-01   +3.693604029495002e-01   +1.018677733544127e-01   +2.912407422941291e-01   +1.258785318691152e-01   +6.638051411417281e-02   +2.840528320584501e-01   +2.085000927756471e-01   +3.472434164685312e-01   +3.411822183406922e-01   +3.574216731300741e-01; +1.563992180680379e-01   +3.600774156578259e-01   +3.035977013810663e-01   +3.965010887981796e-01   +3.640432472149625e-01   +2.828489170730002e-01   +3.812318853117248e-01   +5.338774499701771e-02   +1.966393153638303e-01   +4.122693231345095e-02   +5.232676658178812e-01   +3.701155004790851e-01; +2.468827436148233e-01   +3.817312633662499e-01   +2.005560712631381e-01   +4.634090616244546e-02   +4.683797500179931e-01   +3.521299482268107e-01   +4.285601066682589e-01   +3.913590992758788e-01   +3.657147086089485e-01   +4.727117531120534e-01   +2.136878768721711e-01   +2.759976099085619e-01];
L2E_Input1_iAMPA_netcon = [+1.241309657066976e-01   +2.393811834541894e-01   +3.183412873015505e-01   +4.097152555040944e-01   +3.568212853441628e-01   +1.046189482095689e-01   +4.230821758389139e-01   +7.067993813872216e-02];
L2I_Input2_iAMPA_netcon = [+3.965084267370469e-01   +3.614224749199736e-01   +5.450522408907220e-02   +5.562296406241418e-01   +1.567013339220448e-01   +5.306223712667861e-01   +2.934430308987545e-01   +5.238970218287894e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.6*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.4*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.6*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.4*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.6*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.6*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.4*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.6*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.4*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.6*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
