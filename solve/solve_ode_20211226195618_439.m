function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+5.108497500592727e-03   -1.450901016047010e-01   +2.579737911766293e-01   +2.944440713885250e-02   +6.081403539833066e-01   +1.325630392819009e-01   -2.212910399089848e-01   +1.667603880057766e-01   -1.559237200470803e-01   -1.320201424178386e-01   +2.427213504098485e-01   +4.656499556337401e-02   +3.220619181213069e-01   -2.684002262333003e-01   +1.505356417970784e-01   +4.076195947613998e-01; +3.770606602455460e-01   +2.114100796401786e-01   +5.569232776068153e-01   -1.115922592912535e-01   +2.545547240322949e-01   +1.830729264577374e-02   +1.049584542405848e-01   +3.401960812460310e-01   -2.443083166435933e-01   +5.434956340804670e-01   +5.576810664868961e-01   +4.067496677455689e-01   -2.191905472772638e-01   -2.452685775864566e-01   -4.137071208267381e-01   +5.687265109344464e-01; +6.009717620544826e-01   +1.408390121713071e-02   +7.887497117286161e-01   -5.732316767735757e-02   +7.117040733393485e-01   +4.867811879298023e-03   +3.228401198428694e-01   +3.388123507109243e-01   +3.711544155662008e-02   +5.276880220833691e-01   +2.515492932407665e-01   +4.329702166272464e-01   -2.606456793955502e-02   +4.818506142367432e-01   +5.857664495877078e-01   -1.228842080415945e-01; +4.417900487334413e-01   +3.236712830177909e-01   +6.004449615015278e-02   +6.019223475223934e-01   +3.136911926694507e-01   -1.154850900128510e-01   +3.169492455318271e-01   +1.530918599730213e-01   +6.511708590830392e-01   +5.409446203823977e-01   +1.050954144922662e-01   +4.570260259706327e-02   +2.797342125428712e-01   -7.014846022712985e-02   +4.823036064819003e-01   +2.794247788456879e-01; +1.819802099447590e-01   +3.963179710416074e-01   +4.980313435672138e-01   +8.498479256236718e-02   +3.483845807356963e-01   +2.869323738812986e-01   +2.744409856700548e-01   +4.555810529859488e-01   +5.525072401432425e-01   +2.760359723744574e-01   +1.400180079186664e-01   +9.513985873803543e-02   +3.016566712846744e-01   +4.068283132389036e-01   -3.194339859221842e-01   +2.232120074314518e-01; +1.564401745449781e-01   +1.527518504386390e-01   +2.356175542085180e-01   +6.719392452492424e-01   +2.466764018339807e-01   +1.175075792575411e-01   +4.838348194323049e-01   +6.817034323579871e-01   -1.148233104812503e-01   -2.291601490571069e-01   -1.560117636753940e-01   +4.821337828276039e-01   +3.666740308407540e-01   +3.226011801607319e-01   +4.810774352255107e-01   +8.898238365430100e-02; +1.437796400888501e-01   +2.492822128869940e-01   +1.720902564232176e-01   -5.857061872375814e-02   -3.119168395418344e-01   +5.859272117939158e-01   -1.897803437580387e-01   -6.485258996111093e-02   -3.834619551548761e-01   +2.509681964822039e-01   -6.927829049745288e-03   +2.207168609609632e-01   +6.699246492790467e-01   -2.623006076605212e-01   +3.039377749152547e-01   -1.037243472902869e-01; +2.149775162274644e-01   -4.026789240856469e-01   +4.346250140984750e-01   +1.288589410421165e-01   -1.041911359992265e-01   -2.144635672484198e-01   -2.286481245311078e-01   +5.286369835504322e-01   +1.424109177829580e-01   +2.476952885702237e-01   -7.393016001107887e-02   +5.362056743737840e-01   +2.109872018638503e-01   +9.780626211925054e-03   +6.992311427290149e-03   -2.324975963112166e-01; +4.354810831689223e-01   -3.778685592622011e-03   +2.235870160153377e-01   +4.054640518566888e-01   -1.365307078438720e-01   +1.582015717979090e-01   +4.475363281393073e-01   +6.956092259691440e-02   -9.631437310949331e-02   +5.728447210845733e-01   +5.953087868273204e-01   +2.464374335755000e-01   +3.576366318279876e-01   +4.508778773698400e-01   +1.896247128182761e-02   +3.078936752978867e-02; +6.205205202073732e-01   -3.644878428750462e-02   -1.127280024267639e-01   +8.624563000869846e-02   +3.284544873666840e-01   -1.656590176423503e-02   -1.227184057164051e-01   -1.829263560918229e-01   -1.523267701223980e-01   +3.691376343605696e-04   +1.524038492684526e-01   +4.814430894131119e-01   -2.102909907792757e-02   +1.929711817248883e-01   +4.061280911138845e-01   +3.562539139545194e-01; -2.681458332488920e-01   +3.507152609338596e-01   -3.632569886694258e-01   -2.850468480481143e-01   +2.932512388157156e-01   +3.484608008022533e-02   +3.204971553155932e-01   +2.931427857599462e-01   +5.907202673307611e-01   +2.142214854111953e-02   +3.196044429622203e-01   +2.929594666980137e-01   +3.291927122602860e-01   +8.860830887962620e-02   +2.362213735050888e-01   -2.071756385030772e-01; +8.565815772806173e-02   +2.339668212916506e-01   -3.232184982974694e-02   +3.480616091183473e-01   +1.964078343712292e-01   +3.697557384620083e-01   +4.715226374333014e-01   +2.972322328430716e-01   -4.587071272377589e-02   +2.467626839615387e-01   +1.427320926596943e-01   +2.337623207643862e-01   +2.547462603857237e-01   -1.126360406270273e-01   +2.351646396168602e-01   +4.207356623217056e-01; +3.887756672303981e-01   +4.715946852781557e-01   +3.282582486725927e-01   +4.509695650287565e-01   -3.025076567363226e-01   -1.600573837400741e-01   +2.622644536029710e-01   +1.591263335793978e-01   +5.787589012004648e-01   +1.430133871350180e-02   -2.927519976684727e-01   +3.891153378456348e-01   +3.245730266465572e-01   +1.192854585415121e-01   +3.251136801778166e-01   +1.242763044019857e-02; +6.203336023681632e-01   +2.934564707380272e-02   +5.415897179081062e-01   +3.577578745696162e-01   +4.642029382323887e-03   +1.605060879507411e-01   +1.284282745541807e-02   +1.326749434213456e-01   -1.316248176199155e-01   +1.803548990084948e-01   -2.926078304136710e-01   +4.644349162333933e-01   +2.473982466159590e-01   +2.913050012754897e-01   -6.152720735515710e-02   -3.867312579768989e-01; -2.832910145116993e-01   +1.725969665385788e-01   +3.975141002602467e-02   -1.874319465144807e-01   +4.538718468822079e-01   +4.500444690746437e-01   +3.761746524592510e-01   +2.835445474487619e-01   +3.927500474909054e-01   +2.070959299567481e-01   +1.625972652357910e-01   +1.689088598350024e-01   +6.460629950197947e-01   +2.336329290761247e-01   -2.690340761203336e-02   -2.737093388052463e-01; +5.550449572165083e-01   -7.530334676619213e-02   -5.784904625151541e-02   -1.860818000723224e-01   -6.655313725858482e-02   -1.196642910974892e-01   +5.577122765974079e-01   -1.780818058021049e-01   +5.838647836572958e-01   -1.622813110074680e-01   +1.110918977587123e-01   +3.312988458016295e-01   +1.642335824269820e-01   +4.260050962544464e-01   +6.639035930599491e-02   +5.208038801141418e-01];
L1E_L1I_iGABA_netcon = [+3.418652063627639e-01   +2.987425490628946e-01   +3.023611553648535e-01   +3.191944998675829e-01   -3.565510333083725e-01   -4.417868305609635e-02   -1.015803513881823e-01   +1.265946387154297e-01   +5.835967160034596e-01   -4.475363675877825e-02   +4.129130212073520e-01   -7.245559295627205e-02   +3.555797872276264e-01   +2.311008527979265e-01   +4.717669943658754e-01   +1.903984699663284e-01; +5.768662958162728e-01   +1.511911040163400e-01   +4.235715972537344e-01   -1.760559428102511e-01   -3.749460627219331e-01   -4.416085609506959e-02   +2.022000131729168e-01   +4.972594374850230e-02   +2.617290446949203e-01   +5.334201367814346e-01   +3.875717980763470e-01   +3.224418764072077e-01   +2.255613134932829e-01   +3.075551482488578e-01   +6.510469383117772e-01   +2.442643048437336e-01; -6.008853029353455e-02   +6.434404900949314e-01   +1.134836879460645e-01   +4.217399711885589e-03   +4.896596834018055e-01   -9.310919674761803e-02   +1.719588985012241e-01   +2.802655343155360e-01   -2.895731491799491e-01   +3.368691770124598e-01   +9.512198821126794e-02   +9.926465892204069e-02   -1.695995003259746e-01   +3.765475695170312e-02   +2.620637882976593e-01   +4.862520472330117e-01; +4.854618822106290e-01   +4.141364368307316e-01   +2.403373071297950e-01   -2.853972902782492e-02   -7.729650697944113e-02   +3.259269936186429e-01   +2.213294351274230e-01   +4.306244231303919e-01   -4.120591213256323e-01   +5.770187884540789e-02   +1.542682360417172e-01   +2.759870580159118e-02   +6.011713152218974e-01   -1.893102914477995e-01   +5.722358740130756e-01   -4.873303420875130e-02; +4.871162403433404e-01   -4.223367046691168e-02   +2.045194376348132e-01   +5.258773533189138e-01   +6.819299962487597e-01   +3.593235511459989e-01   -1.636143657135308e-02   +4.762071539038072e-01   +1.745688337867138e-01   +5.401830411408357e-01   +1.519169823493196e-01   +1.632877717255322e-01   -2.593412850742182e-01   +6.682055952213614e-02   +2.340030466194491e-01   +2.437897136171023e-01; +8.235230214470091e-03   +3.283861967199011e-01   +1.677832074506553e-01   +1.838809383263876e-01   +6.231547187044231e-01   +2.136263534768260e-01   +3.901747622531053e-01   +2.161520269785507e-01   +3.316560905515930e-01   +5.247756354986691e-02   +3.270349230165179e-01   +3.420410510977006e-01   -3.730120860248163e-01   +3.063053400495877e-01   +2.599606729757488e-01   +1.085846505259158e-01; +2.842652572205045e-01   +2.136858985953328e-01   +5.357762706465570e-01   +5.224056375972984e-01   +1.541319000224163e-01   +4.027921867648915e-01   +6.899426799344642e-01   +1.706278586286495e-01   +4.912824597327059e-01   -7.726588758893030e-02   -1.200297840677250e-01   +2.747832358725298e-01   +1.548064699729147e-01   +4.036446883527184e-01   +1.481789500797126e-02   +5.964828349265296e-01; +4.218611107506500e-01   +1.532555325365098e-01   +7.342450582888382e-01   +5.898579478067876e-01   +5.576723623005550e-02   +3.451354479909768e-01   -6.234363115923813e-02   +8.547951703023582e-03   -3.947466549270845e-02   +9.535890267749320e-02   -1.518966812018597e-01   +4.652735874482586e-01   +2.856868815785318e-01   +8.091778667862963e-01   +1.090571345173823e-01   +3.787995591766944e-01; +4.445428424753300e-01   +6.147218239237678e-01   -3.481113321723547e-01   -1.121449543911434e-01   +1.164842910904424e-01   -3.162913147240513e-01   -1.001903152304063e-01   -1.667785115707073e-01   -3.702494288312663e-02   +4.652074241512895e-01   +3.523596425516097e-01   +2.465097794679152e-01   +3.628845187635705e-01   +1.666167586492835e-01   +2.453306428441072e-01   +2.108727145725612e-01; -3.979497632497981e-01   -1.321041415374267e-01   +3.254095803685590e-01   -9.045463787530482e-02   -3.480226319394052e-01   +7.311183408374279e-01   +8.890216034512283e-01   +4.621452299873348e-01   +3.055508698743568e-01   -1.664680031701645e-01   +6.049902040321655e-01   -1.851598197854637e-01   -3.240046450694099e-02   +6.027848320668567e-02   +4.523786397227535e-01   +1.733454707760489e-01; +6.648703032667161e-01   +2.724483399422780e-01   +1.083265344719710e-01   +2.736041364559440e-01   +3.430496508707077e-02   +1.736378601528436e-01   +3.694419412010246e-01   -6.449860158475350e-02   +4.644839069381347e-01   +1.682717392433168e-01   +3.830656783983992e-01   +4.525105330716292e-01   -1.677899769647575e-01   +2.402763537478530e-01   +7.025006305812084e-02   -1.671578487744057e-01; +3.160674305395865e-01   -2.843485254618800e-01   +3.513217224203197e-01   +3.593249463949730e-01   +1.789038268487277e-01   +5.378372564173941e-01   +9.035462969109603e-02   +6.587562460973844e-01   -6.349110038359983e-02   +6.384422983722315e-01   +4.748292518356704e-01   +5.628958753512977e-01   -5.564641927812058e-02   +2.360476532353764e-01   +4.356162275093751e-01   +3.054150927645448e-01; +1.224331751525204e-02   -2.892066052811995e-01   +3.404328710772082e-01   +1.696461249543951e-01   +3.792526212726487e-01   +3.002648256685984e-01   +1.814248615252104e-01   -4.681440100982627e-02   +3.555764489355914e-01   -7.411616517958199e-02   +2.425582042254372e-01   -1.032572423289017e-01   -2.265699701354086e-01   -1.486123985806768e-01   +4.784402863050243e-01   +3.501014983700928e-01; +2.599046132551635e-01   -2.185449122280817e-01   +3.690156334603579e-01   +2.034306607058273e-01   +5.597452468891386e-01   +1.331701983912275e-01   -2.704206747339688e-01   +5.789542935112177e-03   +7.737689817790623e-01   +7.994277407939179e-02   -8.770309032564905e-02   +2.775874464884353e-01   -7.374567111653463e-02   +4.483906824598053e-01   +1.154626937290162e-01   +1.896472441865847e-01; +2.091358615312013e-01   +4.958062549618801e-01   +4.921336505369245e-02   +1.375015507070593e-01   +1.433038147818838e-01   -1.054786976097077e-01   +4.756276935624095e-01   -4.457489636309986e-01   -2.750132168592009e-01   +2.105704656187661e-02   +7.016338791987017e-02   +3.074278999510492e-01   +3.914140670825730e-01   -1.590097288375943e-01   +4.582044847575487e-01   +3.730893640053986e-01; +1.115739213247211e-01   +2.299455431839927e-01   +2.253664921602289e-01   +5.124167427332345e-01   -3.231331879300815e-01   +2.090314703126493e-01   +1.742288958328950e-01   +1.642979558546151e-01   -4.642139572602762e-02   +5.875641678865154e-01   +3.742725498829568e-01   -3.048580164345166e-02   +1.494741351416532e-01   +3.711783054972906e-01   -1.462695159121135e-01   +1.752304825407032e-01];
L2I_L1I_iGABA_netcon = [+6.401381198523411e-01   -1.946018501256737e-01   +4.472396880003423e-01   +4.617273710286642e-01   +3.394609751502971e-01   +5.982704225040434e-01   +2.180460717326358e-01   +4.195919181141043e-01; -1.317081673177417e-01   +4.023638298039961e-01   -1.192041032319792e-01   +1.137487943247477e-01   -6.093718133932338e-02   +6.398702724269398e-01   +1.734909216517503e-01   +2.761822757744183e-01; +3.659774542254980e-01   +4.039197859050142e-01   +5.874357062505203e-02   +2.620124782347437e-01   +1.137896672526818e-01   +9.854993003341281e-02   -2.095360067205102e-01   +3.822074972599313e-01; +2.222888943865369e-01   +4.384011507180983e-01   -3.042041149613548e-01   +5.179841741153126e-01   -9.409881420177810e-02   +4.532578098682994e-01   +4.256668945400653e-01   +9.440631703267754e-02; +1.611544860692560e-02   +5.061880056335087e-01   -2.803932529929211e-01   +4.972262702022778e-01   +6.207269129670985e-01   -3.080070108152053e-02   +1.267473192724311e-01   +4.215832497766517e-01; -3.667867968119398e-02   -6.731073901406186e-02   +3.439786346850288e-01   +4.940225196109556e-01   +7.757105475229660e-02   -2.768050659598270e-01   -8.486479515712014e-02   +2.085004448246568e-01; +1.471694306343015e-01   +7.293051145052383e-01   +1.586467655184456e-02   -1.068490728937409e-01   +3.857476973248819e-01   +2.227035533254805e-01   +1.574756459570671e-01   +2.002968802008849e-01; -1.341794152455963e-01   +1.086432901577699e-01   -2.269821983495846e-01   -9.542862337167889e-02   +7.519994962854548e-02   +2.561700572758119e-01   -3.323501134967673e-01   -8.331369118747081e-02; +5.029062368592052e-02   -2.508921152769577e-01   +4.552084737884302e-02   -1.184877103900720e-01   +2.175506096806590e-01   +5.013859478689600e-01   -6.258617036662945e-02   +4.723425259613995e-01; -1.585095671865870e-01   -2.961286835097796e-01   -5.732586632247771e-02   +3.136765239677192e-02   +1.824384712640743e-01   +4.719500696801147e-01   +1.047997770853662e-01   +2.238456138457004e-02; +5.895381620364297e-01   +9.785873616877244e-04   +2.922455013758751e-01   -5.183385953930523e-02   +3.315257199915212e-01   +3.716806632053093e-01   -1.306071275317053e-02   +3.089854303163355e-01; +1.153867672518778e-01   +1.154163174076201e-01   +1.213576704299555e-01   +5.052002826773889e-01   +7.155553845908642e-02   +3.947712834581074e-01   +1.530067237109906e-01   +4.765292322680373e-01; +4.849916479405836e-02   +2.631405404815969e-01   -8.469902749130592e-02   -3.031757568799920e-03   +1.287945706807673e-01   +6.563858237906945e-01   +2.494908704880210e-01   +1.054735600812651e-01; -2.318495501947470e-01   +4.563407728185249e-01   -1.034271306584517e-02   -2.874313752424034e-01   -1.593922551144555e-01   +4.033355402185637e-01   -1.917391259008828e-01   -2.394391843564164e-01; +2.758773472842686e-01   +2.238204654921370e-01   -2.452219870417999e-01   +2.647941015893193e-01   -1.558796575534158e-01   +1.447051935446493e-01   +2.171027544095165e-01   +9.326047415965888e-02; +3.596613460749611e-01   +3.375434313375112e-01   +1.978072210957239e-01   +3.933694974934384e-01   -1.498650916738717e-01   -9.422281043076555e-02   -3.698244340964313e-02   -1.253821409655502e-01];
L1I_L2I_iGABA_netcon = [-1.060678074954621e-02   -1.484534746190114e-01   -5.378387901567028e-03   +3.801862952564806e-01   -2.297780754237422e-01   -1.144193896545255e-01   -7.483680358178768e-02   -4.327228617398426e-01   +1.267955049188303e-01   -8.163533482767416e-02   -1.599404051798766e-01   +6.926477730436228e-02   +7.148229713758001e-01   +2.557310130232297e-01   -3.466553224548732e-02   -2.904586919098368e-02; +3.601588479336177e-01   +2.077205268855516e-01   +7.399124677122226e-03   +1.036687225924919e-01   -4.856851259873802e-01   -1.544604355591061e-01   +9.712675801573867e-03   +5.163695437055700e-01   +1.697848252733821e-01   +1.531083725429049e-01   +1.582310416090631e-01   +5.155825401185448e-01   +2.326272009502710e-01   +2.073084340114880e-01   -7.348502550921965e-02   +2.388301420703331e-01; +4.443165369330171e-01   +6.087326652993099e-01   +2.419168341087743e-01   -1.995058684402493e-01   +3.554173607579971e-01   +2.878773337760717e-01   -7.354722221966062e-02   -1.643930534848516e-01   +7.417733110182873e-03   +3.926916101751042e-01   -4.355767717324279e-01   +1.471569309914681e-01   +5.331893740010921e-02   -2.432467520457433e-01   +4.331889203109471e-01   +3.700796742954987e-01; -4.815702508470438e-02   +7.904915367297322e-01   +4.170838991836707e-01   -7.595186408853016e-02   +3.478973314426119e-01   +2.946943728146111e-01   -2.167193388165500e-01   -8.242814900430939e-03   +3.359097379211978e-01   +7.752580001178384e-01   +3.518956694067293e-01   -1.301851934839891e-01   +3.387611326772213e-01   +4.953464541328256e-01   +3.431734312827348e-01   +1.890531299006759e-01; -1.236396740041349e-01   +2.770850721149681e-02   +4.984446855754456e-01   +2.241863937153618e-02   +1.051524083320779e-01   +1.072606730688789e-01   +1.493877348045514e-03   -2.716226572207923e-01   -1.858358254067817e-01   -2.081543226248145e-01   +8.451555988504512e-01   -7.412789011701859e-02   -8.508207032336465e-02   +5.200895380698246e-01   +2.328270809640511e-01   +1.515399865109840e-01; -4.412355363934500e-01   -2.134447026050945e-01   +3.733482851457832e-01   +1.517654407710788e-01   +4.863762687461485e-01   +3.614913867493294e-01   +1.025974964263427e-01   -1.621304334141113e-02   +1.901005085223518e-01   -2.193423944607657e-01   +2.457720075963502e-01   +6.594870467176843e-01   +6.405812325888065e-01   +1.362707716584816e-01   +4.424959589614708e-02   -1.559949552950935e-01; -2.659356289373350e-01   +3.914499533948581e-01   -2.680271609266815e-01   +1.165750682394037e-01   +6.178547829796965e-01   +7.833152413545912e-01   -1.363229331910341e-01   -1.173391033118174e-01   +1.695839126194363e-01   -1.034211161558141e-01   -6.472952401839938e-02   +2.863149259899933e-01   +2.728513279272415e-01   -9.750502934169873e-02   +3.212502496614760e-01   -1.016884781216653e-01; -2.356884527801321e-01   +5.531606234347699e-01   +1.685233081308723e-01   +6.239366147787879e-01   +5.458713057482346e-01   +6.014266913813707e-02   +8.422324044140041e-02   +5.285702072085559e-01   +4.463619787235297e-01   +1.809055880515617e-01   +7.248825807428187e-01   +3.399149594041356e-01   -4.731340423918755e-01   -2.561256966292484e-01   +8.373662647312106e-01   +2.753429124332582e-01];
L2E_L1E_iAMPA_netcon = [+3.423261205285364e-01   -5.485647350114142e-03   +6.389685782388819e-01   -2.213169237306585e-01   +1.952240672372859e-01   +5.584320266320943e-01   -1.723646552337368e-01   +4.587460380969922e-02; +2.077432804853447e-01   +4.222184875255116e-01   +8.354983427237922e-03   -3.849778875294818e-01   +1.594252507791993e-01   +1.830208656641837e-01   -1.791767263116769e-01   +1.160584737364420e-01; +3.189257746108934e-01   +6.713022203461265e-01   +4.756848388739355e-01   +2.608679885935255e-01   +2.725929858515705e-01   +3.625981617365133e-01   +5.234929630076115e-01   +3.408492744020896e-01; +7.465038259369876e-01   +9.727670239403755e-02   -1.255925269003441e-01   +2.346904472048524e-01   -1.065886053785497e-01   +5.740983943994045e-01   -2.634599677612350e-01   -2.944540230516257e-01; +6.526781429231232e-01   +5.279257175720300e-01   +6.310616882630221e-02   +3.539047828277395e-01   +1.184926031056368e-01   -1.396075096758242e-02   +8.503783829609815e-02   +6.696109853967401e-01; -5.452624087088043e-02   -8.367357363689151e-02   +5.897505359510409e-02   -1.078336463388728e-01   +1.439545046244428e-01   +7.720671119771066e-02   +4.225625084120535e-01   -3.924163027719508e-01; +2.447582664327289e-01   +3.567437387643064e-01   +6.622808110944216e-01   +6.159116535146902e-01   -1.004279234893321e-01   -1.351308173868518e-02   +9.439089204565682e-02   +3.440476262627920e-01; +2.285192528284443e-01   +7.041284745028183e-01   +4.388063637863956e-01   +2.632247694335860e-02   +4.662091047725069e-01   +1.714564946406189e-02   -1.414244133314956e-01   +5.528822803963837e-02; +4.817461925303594e-01   +2.457933009493428e-01   +1.060873342408077e-01   +1.714694391520679e-01   +3.220498912364393e-01   +2.047369711508080e-01   +1.470193053556702e-01   +2.120284764086423e-01; -1.505249586816211e-01   +4.297974452336460e-01   +3.040207596990986e-01   -1.881822049952769e-02   +5.568309416318711e-01   +4.459788703514248e-01   +5.848596031433044e-01   +2.304226966643863e-01; -2.024553762119408e-03   +4.969693029620612e-02   -7.172792574187871e-02   -8.977323480686261e-02   -2.473130971536092e-01   +3.088412487069578e-01   +3.391807854151738e-01   +1.099051664149278e-01; +1.581094750883085e-01   -1.565992925061944e-01   +4.107907884781473e-01   -1.293105284544367e-01   +1.515369210923732e-01   -1.508694605887652e-01   +2.194673540851720e-01   +1.570442765705597e-01; -2.757750410591093e-01   +3.995913784723844e-01   +3.502194129191900e-01   +3.869804796785341e-01   +3.473794707301017e-01   +4.838821122535760e-01   -5.218446277292937e-02   +6.429224225794139e-02; +2.435447394926082e-01   +3.509703845862767e-01   -3.578190280591990e-01   +1.511803977709046e-01   -3.236694245676974e-01   +3.129611544342459e-01   +3.048686987459893e-01   +4.414719218963489e-02; +2.070694603092857e-01   +2.221598550367261e-02   +1.327687033921048e-01   +3.194525343546585e-01   +6.000119618124579e-02   +2.690988398728056e-01   +7.534151406989664e-01   +3.439767049431076e-01; +2.769932258457229e-01   +6.445007910327580e-02   +1.348409947893244e-01   +6.401725127621537e-01   +4.305212780657672e-01   +3.805438913031691e-01   -6.801152001228639e-02   +5.937519807969899e-02];
L1E_L2E_iAMPA_netcon = [+6.233591378674810e-01   +3.540847837027170e-01   +5.796204757586653e-01   +1.302623567292445e-01   -1.957792341023460e-01   +1.394927776488185e-01   +5.685647653452851e-01   +5.220722906704476e-01   +2.195138988713261e-01   +2.835145386960388e-01   +6.000708904819879e-02   +4.212086376501820e-01   +6.413325933432197e-01   +1.481360529070932e-01   +7.823295893704310e-02   -2.418389800971933e-01; +1.050627577908887e-01   +1.792982079032102e-01   +3.414898368820051e-01   +4.214459234838878e-01   -1.188691714358679e-01   +2.073331703677366e-01   +5.882506590515580e-01   -2.988312664900151e-01   +2.726733873903345e-02   +5.550361736602223e-01   -4.172182289357650e-02   +5.677008700145389e-01   +3.519551673031595e-01   +4.845244010290176e-02   +3.356057377102220e-01   -1.844589147748532e-01; -3.907555699046251e-01   -2.307612121789820e-01   -4.300529872294492e-02   +7.154030006316166e-02   +6.183902460170154e-01   +3.860505342484813e-01   -3.315143311219741e-02   +1.846124659605748e-01   -1.477010297035391e-02   +8.838688154256652e-02   -1.630250112037799e-01   -1.260831519096264e-01   +3.128271234464035e-01   -2.551018800082410e-01   +5.022462855167023e-01   +1.375420233448868e-01; +2.529678897563723e-01   -3.248102066302846e-02   +1.428923821315654e-01   -4.781655236587801e-02   -1.804877759092066e-01   +4.842663806893053e-01   -3.324643015110683e-01   +9.793785508784580e-02   +3.939099595091970e-01   +8.599367506791600e-02   +2.504604130504894e-01   +3.368081432232303e-01   -1.116719891717856e-01   +1.106031395665870e-01   +3.596178573049925e-01   +7.738929247026144e-02; +4.251339926164687e-01   +8.340170901240234e-01   +4.045188313780007e-01   -9.187298786531573e-03   +3.978841775730746e-01   +1.905289149579736e-01   +2.021373608823294e-01   +5.422104126849087e-02   +1.530431664886787e-03   +2.168070742653714e-01   +9.801880773979547e-02   +1.922003636218918e-01   -1.870576273148329e-01   +2.602733303140738e-01   +5.320560516632992e-01   +5.251971553094315e-01; +4.582343067367172e-01   +5.299120565603622e-02   +6.274500635214574e-02   +3.840195060263467e-01   +2.557730696397407e-01   +3.437150934963247e-01   +6.809263683758365e-03   +4.722168808094587e-01   +4.641285142488717e-01   +2.160039890726156e-01   +3.600568581196317e-01   -7.198102199248042e-02   +4.950708393410633e-01   +3.037172879569918e-01   -3.933224693744811e-02   +2.390583546413312e-01; +4.350221727876594e-01   +2.038218423209615e-01   +2.264855755650058e-01   -3.987405734626714e-02   -1.825043244328645e-01   +7.535736343978200e-02   +7.078683948043682e-02   -5.964070067737515e-02   +9.002957862051189e-02   -2.105648433221714e-03   -4.403778606953143e-01   +3.386216556371368e-01   +5.061558926313199e-01   +1.968589186639561e-01   +3.638679517494515e-01   +4.719575397671345e-01; +1.049836686315586e-03   -1.893533109387890e-03   +4.255246656239999e-01   -1.205629529824763e-01   -2.007340818786973e-02   +1.869164348522745e-04   +4.282154716475950e-02   +4.882381169141922e-01   -2.541755786500501e-02   +1.323625686922396e-01   +5.762285191793332e-01   +2.663003354548776e-03   -3.433989064647472e-01   +2.586652675134722e-01   -5.417773409629265e-01   +3.403296645257257e-01];
L2I_L2E_iAMPA_netcon = [+4.902338039817116e-01   +1.168756768290793e-01   +2.075148347306163e-01   +4.700061238624111e-01   +4.411381249902129e-01   +7.328175594884948e-01   -1.985483772706888e-01   +6.737827602566973e-01; +3.345131259621803e-02   +6.145663062742077e-01   +7.119975367545039e-02   -1.889875857946317e-01   +3.478844743806471e-01   +3.945159607934567e-01   -2.706277751426633e-01   +4.584843867853565e-01; +3.846176302053899e-01   -5.286587776868967e-02   -1.793680942573934e-01   -4.135979529354725e-01   -3.659025214513626e-01   +2.130125679138540e-01   +2.236565938869281e-01   -2.929932557998116e-02; +8.984785668476314e-02   -5.342659831190241e-03   +4.653900427918827e-01   +3.875275765974759e-01   +1.404564022393016e-01   +3.277429851523058e-01   +2.902214788783787e-01   -2.791374642167580e-01; -1.101987236721270e-01   +4.976933228114850e-01   +3.043506468245566e-01   +1.555582827035829e-03   +1.327378060798185e-01   +6.061560885224047e-01   +5.856138809416698e-01   +3.002720834009714e-01; -1.665879969568185e-01   +4.960142388594376e-01   +1.663107440578999e-01   +2.413562429943292e-01   -2.039697315572039e-01   +4.121281327197401e-01   +6.506470239358483e-01   +2.040888022145645e-01; -7.669971511558300e-02   -2.394017991811373e-01   +2.495568939841288e-01   +3.096747459307784e-01   +1.987225577394762e-01   +4.388963780211483e-01   -2.654979898055294e-01   -1.537005844279124e-01; +1.315425391256291e-01   +2.342018082237846e-01   +4.657880029507875e-01   +3.911873301212878e-01   +6.424306749897445e-01   +3.913231062051264e-01   -8.399456552442255e-02   +2.621024369635106e-01];
L2E_L2I_iGABA_netcon = [+4.048602115573036e-01   +4.892236254704657e-01   +3.959880939326902e-01   +2.239637133775578e-01   +3.133838605846664e-01   +3.423561683155435e-01   +5.381911673180957e-01   +2.663473190422495e-01; +3.662359343316024e-01   +3.224897714793146e-02   +6.317349146135874e-01   -2.150387682060188e-01   +6.057318416679071e-01   -2.925041983034418e-01   +1.626644655285732e-01   +6.061423082085259e-01; +1.245109576428471e-01   -1.902131354792757e-01   +2.023060845871699e-01   +5.931285125021603e-01   -8.470622369065139e-02   +9.494310285528498e-01   +3.159106173160845e-01   -9.546095301805929e-02; +3.253413797026818e-01   +1.039171145839051e-01   +1.382652129075372e-01   +6.022517761879639e-01   +3.501049381927805e-01   -1.075643357368125e-01   -1.630644846309199e-01   +3.508457493789723e-01; +2.429125944300040e-01   -3.359277674801192e-01   +5.462165534914885e-01   +6.325055903005341e-01   +1.433065364849810e-02   +4.402191871125020e-01   +3.297991070192128e-01   +2.646941203426132e-01; +1.940045385378282e-01   -2.923609778356505e-01   +1.891562687020468e-01   +7.055167797675566e-01   -1.207270654099203e-01   +5.060400454503144e-02   -9.506787679454501e-02   +3.354089949855386e-01; +2.116843581804517e-01   +2.319454507758365e-01   +1.343980247338376e-01   +8.762128455724860e-02   +6.310267952352591e-02   +4.131693948954506e-01   +1.060920724363227e-01   +9.773886686996100e-02; +7.795484089546874e-01   +1.224509686791146e-01   +3.224823803559540e-01   +6.076230553431432e-01   +4.881569226608817e-01   +5.592977124856202e-02   -2.126036313587563e-01   +5.601080645769195e-01];
L3E_L2E_iAMPA_netcon = [+2.357227722457514e-01   -7.887864364975981e-03   +4.714815390158031e-01   -1.313001144707040e-01   +5.031527834307183e-01   +6.979739956723321e-01   +2.672842495056473e-01   +9.506930516145222e-01   +2.692288930657252e-01   +1.425176243487658e-01   +4.715800657961242e-01   +7.211393497856803e-01; +2.866807790639735e-01   +2.628237568988443e-01   +4.896388862748472e-01   +7.344215413466531e-01   +4.969947354542903e-02   +2.513336211021465e-01   -1.894596467190075e-01   +1.154227741467481e-01   -3.138870526076565e-01   +4.650329268080051e-01   +4.202110851976122e-01   -3.108020278329135e-02; +7.092181071795214e-02   +2.911990675717699e-01   +1.795575892359380e-01   -5.090151046914604e-01   -2.817341052081028e-01   -9.728651009957384e-02   +5.120191572602294e-01   +4.040424329568603e-01   +4.416991427452328e-02   -3.630485480783670e-01   +1.837671883518570e-01   -2.658905567799555e-02; +6.321259431731980e-01   -5.591727011988823e-02   +4.594080859990967e-01   -1.039771227559189e-01   -2.163070221710086e-01   +5.026386367934017e-01   -5.346517939514931e-01   +2.325152510406226e-01   +2.470049091847487e-01   +2.555795615600325e-01   +2.604847047587468e-01   +2.255421208002416e-01; +3.787725610056310e-01   +5.352539000199572e-01   +2.480909093098244e-01   +4.537912087385704e-02   +2.096728415477409e-01   +4.007032942370123e-01   +2.475475899923639e-01   +2.480675889584978e-01   -2.037458553386396e-01   +2.247740307596352e-01   +8.318160679060585e-02   +5.821648622663441e-01; +3.316708975765840e-01   +1.888752315637318e-01   +6.145772458957857e-01   +3.993230909233740e-01   +2.075356083104734e-01   +5.700047189627804e-01   +3.057076931909854e-01   +1.397166410301471e-01   -8.240562517801461e-03   +1.359742106186603e-01   +1.089537337598853e-01   -4.712354565548307e-02; +7.181796134687850e-01   +6.687469191376064e-02   -2.227968244170723e-01   +2.569338156925611e-01   +6.162121830825469e-01   +5.360458907737381e-02   +5.133777182028481e-01   +6.821242495584425e-01   +1.391014512297068e-01   +5.704364446366759e-01   +3.303875664712929e-01   +3.088652757298844e-01; -1.858441907377744e-01   +3.229564139612664e-01   +2.540642881416133e-02   -1.332090774554779e-01   -1.915285740857529e-01   -3.751181434683490e-02   +1.123021359966921e-01   -1.573960612041972e-01   -7.601207391059392e-02   +5.008074943564265e-01   +1.340254710990331e-01   +6.645074849146168e-01];
L3I_L2I_iGABA_netcon = [+5.256457817581009e-01   +7.839520438632384e-01   +1.197544338785922e-02   +1.106549054178998e-01   -4.596210262511559e-02   +3.129942825535101e-01   -5.966345891431600e-02   +5.501678493666046e-02   +5.094608794174476e-01   -2.726395680428701e-02   -1.137098461501814e-01   +3.030132021631181e-01; -4.262169174423652e-02   +1.971637264590422e-01   +4.187928146798053e-03   +1.871901230786178e-01   -1.148910320582169e-01   -1.061672670972600e-01   -1.420195363990082e-01   +4.947920135038558e-02   +4.015082024292713e-01   +3.623587550416254e-01   -2.075798404300222e-03   +8.712000097552736e-01; +4.903851843409034e-01   -7.341651195689120e-02   +3.708495981834681e-01   -1.365692687411969e-01   +1.506056675130602e-01   +2.277292834853052e-01   +1.780633752128223e-01   +5.780932382261557e-01   +2.512829630990618e-01   +1.008185968623471e-01   +1.585682448703161e-01   +6.140429450297519e-02; +1.913942033885262e-01   +2.453279562943664e-01   +3.285872771451277e-01   -9.919266991756420e-02   +3.548104820338210e-01   +6.810313980093586e-01   +1.659988559401009e-01   +1.978288545367935e-01   -1.060106285516403e-01   +6.474150054364588e-01   +4.711190197593867e-01   +2.455672883469870e-01; +2.189551820102371e-01   +7.515871562179479e-01   +4.383826857077432e-01   +2.860896183447625e-02   +1.981193304026260e-01   +7.056090448973068e-02   -7.035906220762239e-02   -2.972438318558511e-01   +2.916278054221889e-01   +3.355731138475790e-01   -1.091820040950924e-01   +2.098023429817631e-01; +9.137148207566226e-02   +4.830353651868119e-01   +8.940868331960022e-02   -3.764514020005411e-02   +5.761117770904556e-01   +5.374811160798159e-01   +6.503041209613758e-03   -2.488773016882712e-01   +1.256176757562956e-01   +3.337440038212989e-01   +1.921716890095134e-01   +3.720064721697665e-01; +4.240705912200818e-01   +1.947725052328875e-01   +4.865904368395031e-01   -2.816605003167908e-01   +2.256027695931708e-01   +6.190309870625907e-01   +5.221098810927374e-01   +4.330944966607009e-01   +4.983189664457019e-01   +3.841559745951093e-01   +7.557190081618753e-02   +7.882383283033745e-02; +2.609744860336770e-01   +5.365559713402412e-03   -1.438323765098087e-01   +4.420233402715336e-01   -1.891579363059834e-01   +2.695950384938959e-01   -1.366410230423757e-01   -1.119171648027095e-01   -1.431057243327540e-01   -1.448467196655845e-01   +5.447913256240020e-01   +2.181336444851578e-01];
L2E_L3E_iAMPA_netcon = [+2.341693308011830e-01   +4.597176611573931e-01   +8.579054083863864e-01   +2.773804059715641e-01   +5.947868443356568e-01   +6.076945129337954e-01   -3.084024053440252e-01   +2.151066864039219e-01; +2.919258026576693e-01   +2.996722952132052e-01   +5.637140510083236e-01   +1.680692016731883e-01   -1.163488914441531e-01   -7.084601741308826e-02   +2.609657234750373e-01   +3.168062544730106e-01; +1.423567916518130e-01   +1.428661417389907e-01   +3.088603861724023e-01   +2.316792714741145e-01   +3.435483432715670e-01   -4.333758814166690e-01   +8.867939130343389e-02   +2.432230566939411e-01; +5.497637104052947e-01   +5.737893871707604e-01   -1.210248872471903e-01   +5.310236398935362e-01   +1.711513343061896e-01   +6.532299276250355e-01   +1.173329721841803e-01   +2.314765960483646e-01; +4.924133460593388e-01   +1.085979750527086e-01   +4.344134902997474e-01   -3.675837566975920e-01   -1.879284464030681e-01   +4.894770779438840e-01   -5.769628013334849e-02   -2.395139869708293e-01; +6.127525825640748e-01   +5.032269844233941e-01   +4.014361967677018e-01   +5.519079521143910e-01   +3.971528322852712e-01   +1.574020553365849e-01   -1.102087035577506e-01   +2.524967782430800e-01; +3.912408832892209e-01   +4.005037258888837e-01   -1.443149266337835e-01   +7.943563742954413e-02   +5.267120665767979e-01   -1.088725362100969e-02   -1.649217188469136e-01   +1.361196125237884e-01; +1.792921114666548e-01   +1.388831269804109e-01   -2.431653240358398e-01   +1.848425548941168e-01   -3.990524150193703e-02   +2.116393089158275e-01   +3.453513138777288e-02   +6.689391809472980e-01; +1.252432356712329e-01   +4.009392022844775e-02   +3.515261339866593e-01   +4.541283662519457e-01   -1.853882516098403e-01   -4.234336210057774e-02   +3.230344839009096e-01   +2.688681026643335e-01; +4.931986138951270e-01   +3.035086244355479e-01   +4.701707869809614e-01   +1.739623131475593e-01   +3.019606908996151e-01   +5.252679347381933e-02   +1.294263218323967e-01   +4.308886239786006e-01; -3.310894173204969e-01   +3.329246088382011e-01   +1.792946487208324e-01   +4.181752458641771e-01   +2.154131795958462e-01   -6.662516939762950e-02   +7.974303286105988e-03   +2.672690486677737e-01; +4.089275635301935e-01   -4.959031655068873e-02   -5.465720214277468e-02   +5.985415188282666e-01   +2.201139590840900e-01   +3.260482701110654e-01   +2.122434933189231e-01   -8.435052651656158e-02];
L2I_L3I_iGABA_netcon = [-1.997305774336378e-01   +3.214724775588862e-02   +3.018114622795698e-01   +3.643083497672975e-01   +4.891320068496792e-01   +6.537725179794418e-01   -3.997048366957762e-02   -2.426100615445924e-01; +4.317028710448013e-02   +2.985338441493186e-01   -3.373677461043181e-01   -3.810383452563668e-01   +9.224686236400770e-03   +3.953077251275302e-01   +3.574340992670801e-01   +1.236726393694199e-01; +3.029636342702424e-01   -3.265408566378045e-01   -1.195351133468767e-01   +4.673484433080384e-01   +3.933597967157351e-01   -2.138910955226082e-01   +2.472885949566870e-01   +5.310648088428954e-01; +4.408272480534439e-01   +5.175211288647892e-01   +2.295940297610273e-01   +2.829049940232552e-01   +5.497108462440288e-01   +5.300454442615281e-01   +5.374725597421168e-01   +1.748060504171404e-01; -4.550822662952812e-02   +2.879459095073383e-01   -2.727701929335931e-01   +2.547091153408839e-01   -2.752579656999297e-01   -2.131053422616042e-01   -5.824330821132470e-02   -4.233503760723781e-01; -9.041103406879630e-02   +1.127318908414871e-01   +5.881455330123805e-02   +3.062885043455102e-01   +3.957489724979411e-02   +1.525006037886250e-01   +1.061365932212174e-01   +8.616693742613028e-02; -2.026754156073473e-01   +5.850648735238653e-01   -6.412840410393741e-02   +4.454574746794026e-01   -4.300912337412708e-01   +4.255508044478279e-01   +5.271953896831789e-01   -7.531115017392784e-02; +1.306197788212553e-01   +4.439893036365448e-02   -1.027565180117345e-01   -2.537722033939013e-01   +4.881834990880709e-01   +5.023207578493916e-01   +1.700897717670886e-01   +4.763080174231998e-01; -2.112227913953945e-01   +1.957458507876414e-01   -1.146765405181775e-01   -1.958155402477561e-01   +6.197674313018020e-01   +4.070233369555517e-01   +2.124549035499588e-01   -2.299225507241271e-01; +1.345426802543762e-01   +5.735583118052855e-01   -3.248091437708701e-01   +8.758092593454728e-02   +1.254807093137749e-01   +2.101311081084849e-01   +9.688557335226944e-02   +5.996204913495680e-01; -2.848516901678523e-02   +8.304869262964093e-01   +1.786219703985042e-01   +2.751979988481579e-01   -3.488984246587190e-01   -4.890696451541621e-01   +9.251045401412633e-02   +2.720026305789544e-02; +1.771530038247922e-01   +7.280217314216905e-02   +1.399460266593285e-01   +2.890298857081712e-01   -3.043331924824853e-01   +5.096240639351369e-01   +1.579689207063861e-02   -9.978709126498295e-02];
L3I_L3E_iAMPA_netcon = [+1.948425234473270e-01   -4.639672921321957e-01   +2.689119081859881e-01   +5.799674277375330e-01   +2.565666590848464e-03   +4.811814111236976e-01   +2.627512958265312e-01   -1.388176588508948e-01   +2.109807150197923e-02   +3.522032524116836e-01   +1.964138207079790e-01   -6.777490553887611e-02; -9.892807691792348e-02   -2.829026920507338e-01   +1.582871883486803e-01   +1.600280758076570e-01   +3.217880190953682e-01   -5.439209548889894e-02   -2.176317894636570e-04   +1.239933397592526e-01   +4.957192594439692e-01   +2.358796283467336e-01   -1.905640129920784e-01   +5.587254767410688e-01; +3.766506651490588e-01   +1.230563696042694e-01   -1.079489490634028e-01   -3.414703172361817e-01   -1.236638934517740e-01   +2.236103257194474e-01   +3.822985225565945e-01   +5.556384228816776e-01   +4.892233911403083e-01   +2.219076484647562e-01   +4.018722641272526e-01   +3.803350068783613e-01; -3.054956517158109e-01   +7.015822756377739e-01   +1.239621405157469e-01   -1.900294579495853e-01   -7.940801868944818e-02   +8.996396678442792e-03   -1.945705174726348e-01   +2.587962953181778e-01   +1.786862920668694e-01   -1.464251072586301e-01   +5.205627709230010e-01   +2.892180044760259e-01; +3.885119722898187e-01   +2.647656962933141e-01   +7.170223355652756e-01   -3.735941677800711e-01   +8.418635299748394e-01   -3.065005082496011e-02   +6.823881262361432e-01   -1.123217575229827e-01   +7.566518800506701e-01   -1.345695485016437e-01   +3.524954563785879e-01   -1.109336432646365e-01; +2.148190674289875e-01   +1.755698980157418e-01   +7.077606072299971e-01   -1.345784943129661e-01   -2.267407635878360e-02   -1.047276250199395e-01   +4.123393407134489e-01   -2.059203177580647e-02   +6.733457061240791e-01   +4.867028501475684e-01   +1.668087492032412e-01   +5.958147460754080e-01; -1.031073816488466e-01   +6.487707034076015e-02   +4.699317585445790e-01   +3.630428120293233e-02   -1.198047521660925e-01   -3.138728246310266e-02   +4.744396496698274e-01   -2.581665760165737e-01   +5.502929281300445e-01   +2.391609662465056e-01   +2.008989860354649e-01   +4.370802297402072e-01; -2.459962499975096e-02   +4.679208903519084e-01   +3.955455398101343e-01   +2.794508895028948e-01   -7.985365014866214e-02   +1.037737153090718e-02   +7.023766539191068e-01   +7.216313608534418e-01   +4.452080058825894e-01   +4.222328546948256e-01   -1.191870320885402e-01   +6.648178085550253e-01; -1.260662335202022e-01   -1.245293160572461e-02   -2.305265926852494e-01   +5.296306351789283e-01   +1.402255639107555e-01   +3.414866569984715e-01   +6.146973560887510e-01   +4.320085443031721e-01   +2.429307864725578e-01   +5.124156924718036e-01   +5.369170416574842e-02   +3.987478231469934e-01; +3.384926057216673e-01   +8.148183506117486e-02   +1.783824615919953e-01   +1.684958265086364e-01   +2.599244965485016e-01   +7.269900311943466e-01   +1.470139799926239e-01   +4.593337756093423e-01   +3.616811484255569e-01   +4.293798747026616e-02   +3.314003988841548e-01   -1.076795205112252e-03; +2.449991828589697e-01   +2.433908468771467e-01   +4.680616773165709e-01   +3.629279594260988e-01   +2.637696320643992e-01   +3.134658146039166e-01   +2.047662458102847e-01   +2.392699997433313e-01   -1.290937698254657e-02   +1.555704782006881e-01   +4.254304545915780e-02   -3.856846299513875e-02; +1.344656106239891e-01   +1.729125685273630e-01   +5.437217021888896e-01   +1.698901566054724e-01   +1.591967306443760e-01   +1.196533905868707e-01   +1.577939585564356e-01   +2.399345460011373e-01   +2.311546210232774e-01   -1.977367456973991e-01   +1.878683069057829e-02   -6.811033339874295e-02];
L3E_L3I_iGABA_netcon = [+9.033578989037455e-02   +4.397377472816655e-01   +5.135515620674138e-01   +4.184563666560878e-01   -3.849291496751585e-01   +8.161470577222349e-01   +4.308921563702740e-01   +2.827063298033546e-01   +4.550169635457122e-01   +3.428250543314131e-01   +6.929034828600200e-02   +7.034918594970141e-01; +2.879738611284804e-02   -5.749929568590995e-02   -1.301959798145939e-01   +2.832133879248220e-01   +5.364394177974102e-02   -1.724388857401855e-01   -1.174357827023239e-01   +3.202677245652759e-01   +4.671136553560569e-01   +4.677172274244340e-01   +1.890871802834921e-01   +4.949037444000860e-01; +9.529972670377887e-02   +4.550905610743455e-01   +2.217176289258999e-01   +2.807216582272351e-01   -4.268650196133428e-02   +7.754308583697456e-01   +5.077704245127811e-02   -8.923243192788433e-02   +2.455876238129308e-01   -4.077176344215250e-02   +1.940720084242644e-01   +2.166303631807819e-01; -1.192985567615603e-01   +9.673902836087078e-02   +5.066368239640238e-01   +7.024850869078694e-02   -1.347620031082620e-01   +2.341135643942665e-01   +2.242726954890463e-01   +3.901925468104086e-01   +5.320430573189237e-01   -5.040498220609630e-01   +2.907529480771096e-01   +1.132859309883076e-01; +6.660719738787055e-02   -3.060445990523384e-01   +1.381197978970121e-02   -2.480947121804478e-01   -1.352678344234612e-01   -3.768638691895487e-01   -1.117486060298959e-01   +6.267108446734633e-01   -1.317139089059240e-01   +5.118857994316959e-01   -4.227449403833401e-01   +4.686446241702061e-01; +1.026513764099306e-01   +5.865498767514046e-01   +5.769533236149660e-01   -4.167444852969282e-02   -1.520862286298014e-01   +8.707576080784313e-02   -2.064199465032227e-01   -2.579390158080948e-01   +1.055441798872471e-01   -1.957048348253793e-01   +4.020384406600595e-01   -1.479473001523441e-01; +5.435834946608656e-02   +3.199830251906908e-01   +8.281699729442471e-02   -7.350658203159080e-02   +5.416676803304079e-01   +5.929878821357325e-02   +1.332134886592333e-01   +4.672858727376533e-01   +5.365539394813585e-01   +5.805209558523428e-04   +7.263459310530617e-01   -1.357655698592451e-01; -1.884886674302514e-01   +2.762551928859404e-01   +6.581461926074652e-01   +6.429828987019559e-01   +1.960185217656290e-01   -4.166108964963111e-01   +2.921211096927954e-01   -4.716153169578252e-02   +2.370376461915979e-01   +2.353778994424225e-01   +1.159882012802838e-01   +7.214855660505394e-01; -2.879186750618997e-01   +2.288601477928914e-01   -1.730676879718723e-01   -2.462389375406188e-02   +1.313894650261232e-01   +1.309823815509736e-01   +1.027059330893915e-01   -1.829029517680308e-01   +3.291122610769116e-01   +1.655829633248770e-01   +4.673703621838282e-01   +7.009366762763816e-01; +6.819303151249172e-01   +8.808822549894910e-02   +6.095465376229251e-01   +5.999591090551265e-01   +1.178079882015992e-01   +9.571246727537827e-02   -1.121807402294516e-01   -3.212707065692856e-01   -4.097000958416308e-02   +4.847647549239214e-01   +5.713856992868860e-03   +5.510620699687168e-01; +5.647175325668840e-01   -9.493876223257017e-02   +2.388266117964620e-01   +3.919793923478710e-01   +1.091151474081705e-01   +8.490749348089068e-01   +3.210372799744513e-01   -2.075001605114055e-01   +1.251819984430061e-01   +3.473191061340470e-01   -2.041818544406704e-01   -9.837011493070338e-02; -2.373558433560554e-01   +3.248845570125956e-01   -6.467944726849939e-02   +4.202827037327928e-01   +1.403736260365144e-01   +2.938611986754921e-01   +5.398234832874890e-02   +4.721952360691190e-01   +4.403264645145412e-01   +6.158307595827297e-01   +2.187736870442219e-01   +3.487001415060616e-01];
L2E_Input1_iAMPA_netcon = [-2.523040451707889e-01   -7.816111561010147e-02   +1.424514530724906e-01   +9.373282156169392e-02   +3.530943473828472e-01   +2.994319684003796e-01   +5.257659840906759e-01   +3.041431452145801e-01];
L2I_Input2_iAMPA_netcon = [+3.782644333876048e-01   +2.666609854874475e-01   +4.366954401377675e-01   +3.664731795747583e-02   +1.575868284164655e-01   +1.088737319746351e-01   +1.356440840148384e-01   +7.442459447668452e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.03*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.15*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.15*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.03*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.15*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.15*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
