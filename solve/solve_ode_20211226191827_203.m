function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+2.264501366855873e-02   +4.216955419185468e-02   -2.915050563116882e-01   +3.345156988053740e-01   -3.188966654921663e-02   -1.490306631617459e-01   -3.155781930666224e-01   -2.463839842780208e-01   -1.219321300599846e-01   -7.855916263448634e-02   +1.703469499711507e-01   -7.830957950124959e-02   -2.214809650188663e-01   -3.082342743165358e-01   -8.980006945992375e-02   -8.004919826489217e-02; +7.200110973840027e-02   -2.330154867711801e-01   -4.995744392758979e-02   +4.196158052381895e-01   -1.639214164882742e-01   -6.040819832789299e-02   -9.933018125818445e-02   +1.989255643621849e-01   -2.699812023317347e-01   +2.577130456744724e-01   -4.104245622175882e-02   +1.792839440736020e-01   +7.334351770404719e-02   +1.093017208320466e-01   +3.848987458397174e-02   -1.449939297965238e-01; -2.866989629072823e-01   -9.961984763458029e-02   -1.738164577328732e-01   -2.566788396964180e-01   +2.187803188413145e-02   +2.625797234008319e-01   +2.828153363680377e-01   -2.173773594191035e-01   -2.657986968271873e-02   +8.420603552021697e-02   -1.581671243118024e-02   -6.253253749992913e-02   +1.371153563353021e-01   +8.140529218901411e-02   +1.979961796883335e-01   -2.194430645772795e-01; -3.763659946983789e-01   -1.057687698342917e-01   -2.410483356173568e-01   +4.377565958824228e-02   +2.694844046978739e-01   +1.605967675980965e-01   +2.010995894260370e-01   -3.051031030051624e-03   +2.387107831247345e-02   +1.103251393369896e-01   -2.939941393417930e-02   -1.850354910963454e-01   +1.464134618863661e-01   -2.542765851439343e-01   +2.098949113277623e-01   +2.155671947923849e-01; -3.476618506589761e-01   -2.158054749867685e-01   -6.152975061084094e-03   +1.262092219152368e-01   -5.927162372715145e-02   +1.360114129033252e-01   -2.576402093158784e-01   -5.368021048416392e-02   -3.497499164106307e-01   -7.790404459787591e-02   -7.370978394420739e-02   -9.551752625953103e-02   -8.972617200593436e-02   +3.377956340722571e-02   +2.596114621991776e-01   +3.994653899607321e-01; +1.553077492706279e-01   -1.966089057371767e-01   +2.334006498984416e-01   +8.963013083032700e-02   -2.945052630938719e-01   +1.683945965347425e-01   -1.937210042092852e-02   -5.392598305766307e-02   +1.566209501108866e-01   -1.509135623552608e-01   -1.787720767635071e-01   +1.065584327321306e-01   -1.403939194193467e-01   +1.703622629282512e-01   +2.819581410627475e-01   +3.520174933609356e-01; +3.203879109436156e-02   -2.503432633270087e-01   +8.464165092820311e-02   +3.764941436037172e-01   -2.799085862796491e-01   -2.531501903906639e-01   -9.882239741557958e-02   -1.816413036465744e-01   +9.628543527499450e-02   -4.080014598265200e-02   +1.645368939022742e-01   +1.524402056682682e-02   -2.271237083310079e-01   -8.324959843487106e-02   +3.867243397350817e-01   -1.696333472023742e-02; -2.287493019083382e-01   +9.412265838874734e-02   +2.244376953173783e-01   -1.797319904168512e-01   +4.737880451005834e-02   -4.147615592286771e-01   +1.382304992393477e-02   -3.252310297636682e-01   +1.042305952864201e-01   +8.214520830148654e-03   -1.555579858266510e-01   -1.976186142270277e-02   -9.917049821610138e-02   +7.916007000070976e-02   -2.832896613684888e-01   +1.330143950701468e-01; -1.847527079740676e-01   +3.947401506348456e-01   +9.327913512718873e-02   -3.938241413770379e-01   -1.862720965829176e-01   -1.440913021323304e-01   -1.838244389162821e-01   +2.452947594357689e-02   -1.065970131142268e-01   +1.005525402917683e-01   -1.620586455107155e-01   +3.531426458034687e-01   +1.457384031579244e-01   +4.781489543135180e-02   -1.510326817533166e-01   +2.464682840962802e-01; -2.884737482184108e-02   +2.101161766679556e-01   +8.804507392981670e-02   -1.026630877896035e-01   +1.947143949487595e-01   +1.520599396386484e-02   -3.629251992050724e-02   -2.725521825031594e-01   -1.626642494537188e-02   -2.791099449809399e-01   -2.876347733951555e-02   -1.781360873234804e-01   -4.192215882473973e-01   -3.211889972125211e-01   -1.941739501755382e-01   -4.998515826608163e-02; -1.980839007557111e-01   +2.168154792601625e-01   -3.340506811242190e-01   -2.007849798663043e-01   -3.691778958764078e-02   -1.218864172673616e-01   +2.945572715078295e-01   +1.358461523845084e-03   +1.339578285011173e-02   -1.685543183543481e-01   -1.918674072812985e-01   +9.470373799867762e-02   +4.026800418957188e-01   -1.453459429162386e-01   +8.250751740098418e-02   +3.398788043185733e-01; +2.312405397725908e-01   -1.317818280868511e-01   +3.053740071372451e-01   -4.289509948512648e-01   +3.892408493740241e-01   +2.388454329241428e-01   -1.052265189524267e-01   +2.029987996235364e-01   +5.676658899360693e-02   +2.309802203461213e-01   +3.342609743733819e-01   -4.773897690964083e-01   -1.954488724079116e-01   +3.190483240049114e-01   -2.576854223236600e-01   -1.805625415003548e-01; +3.128165624796959e-01   -4.109065047818076e-01   +9.380446391568244e-02   -5.551133270597142e-03   -7.242625637742475e-02   +4.248390086305598e-02   -9.323139653243420e-02   -2.791916824104224e-01   +2.972815206707455e-02   -4.515829591480301e-01   +1.352244953130928e-01   -4.026324622866356e-02   +8.895699159078541e-02   +1.611726193878514e-01   -1.741526111259672e-01   +2.825430601544823e-01; +6.943781688620856e-02   -2.421192159555205e-02   -2.377846978457546e-02   +3.077177069827066e-01   -6.518153043900436e-02   -7.207202565359519e-03   -1.042848710003728e-02   -7.778176644496219e-02   +9.621808101414497e-02   -3.970941408118908e-02   -4.147999707287533e-01   -1.757524351760451e-01   -1.625152612134908e-01   -2.526931859795217e-01   +3.951345291481578e-02   -2.987633421014148e-01; +2.914811325539740e-01   -7.554659242429712e-02   +1.273126231612172e-01   +1.543066856221363e-01   +3.572656221438108e-01   +2.078515674387313e-01   -6.543015783473123e-02   +3.019479611431507e-01   -1.053506881607996e-01   -2.574696798596574e-01   -1.753829120528277e-01   +3.079900479102562e-01   +1.308943355092126e-01   -6.732297914036423e-02   -8.809474644392155e-02   -2.734375970622713e-01; +1.290569139479684e-01   -6.174811634035908e-02   -8.051005743059067e-02   +3.787234258205527e-02   +6.750230570567103e-02   +2.504420807097809e-01   +1.159277038069118e-01   -3.095299619007164e-02   -2.118886287539992e-01   -1.683107266648569e-01   +2.586939516771809e-01   +3.699118519738328e-01   -1.023544219166712e-01   +1.821089813629986e-01   +4.172420170546426e-01   +1.170437418249271e-01];
L1E_L1I_iGABA_netcon = [+4.211370867310916e-02   +1.094400153966351e-01   -1.646863851643385e-01   +1.348145577584035e-01   -5.064775314233698e-02   +2.328039103840277e-01   +8.844447461194896e-02   +1.556331612355195e-01   -1.608358644644286e-01   -5.837722894049561e-02   +6.084466038629568e-02   +1.866298311366827e-01   +1.201864866518998e-01   +5.458765651474723e-02   +9.763280932185708e-02   -1.842846525823878e-01; +1.311194449624395e-01   +2.718297087947009e-01   +1.513315666119613e-01   -2.576594652364508e-01   -2.250698712418252e-01   +4.023992547473593e-02   -1.171525556531090e-01   -1.265900839088785e-01   +8.552295941180812e-02   -2.838676660099363e-01   -3.020611287672074e-02   -1.413654560780359e-01   +6.566500209564120e-02   -2.710013659056179e-01   -1.440091606892173e-01   -2.527667244455165e-01; -3.585549141490996e-02   +4.041859962243198e-01   -5.684131471378887e-02   +1.218183607440016e-01   +4.598353796192566e-01   -1.804436823361180e-02   -2.041768406782371e-03   -3.245819460096799e-01   -2.173410864799253e-01   -1.577282005762260e-01   -2.446827861025984e-01   -1.487959052253210e-01   -7.844963284506368e-02   -1.353137099992881e-01   -1.052010625943702e-01   +1.887384780289371e-01; +2.876934993596424e-01   -2.488697635847925e-01   -8.592818871818249e-02   -1.495826606147811e-01   +1.021681249454367e-01   +1.433671466989926e-01   -1.470784289762575e-01   +4.676814867847340e-02   +4.351524632618130e-02   +2.349036175337814e-01   -2.745251609794774e-03   -3.138179330561923e-01   +7.471884437947783e-02   -1.459046803462767e-01   +3.267685754779745e-01   -1.574388365303486e-01; +2.134927481091561e-01   +1.353148156939552e-01   -3.707533862789112e-01   +2.325765384980715e-01   +1.771572587996181e-01   -2.711586111770359e-01   -1.613510057505115e-01   -1.387778807433823e-01   +1.791561351594001e-01   -1.801243479913325e-01   -4.111918368990727e-01   -1.280889580975917e-01   -9.603250062864431e-02   +7.732981484426291e-02   +2.567043375690417e-01   -1.095717206845316e-01; +3.146847948753967e-01   -2.392512708370236e-01   +2.687151642868447e-01   +2.551884258851372e-01   -1.610997175008441e-01   -2.070583089137253e-01   +1.609504862235077e-01   -1.190279347701883e-01   -2.586169984967623e-02   +6.796158756644739e-02   -2.573878621907770e-01   +2.441798560652346e-01   +7.235251496565676e-03   +2.230582892216241e-01   +1.226438164279127e-02   -1.020364191165592e-01; +1.276838757515313e-02   -2.953549692084895e-01   -1.909499252220742e-02   -4.862154400805742e-01   +1.923205988173064e-01   +1.201449450940170e-01   -1.157934859789340e-01   +3.813625248563201e-01   -2.263883142942676e-02   +1.364718728948802e-02   -1.928832118836173e-01   +1.853557643785464e-01   +2.876050908924436e-01   +6.683882695642498e-02   -2.699711783993685e-01   -5.567210922369170e-02; +3.739098148998936e-01   -5.378704010851879e-01   +1.288604924548492e-04   +3.410684440927412e-01   -3.438312230159174e-01   +4.955390954131814e-01   +2.699507545401450e-02   +3.481349195476142e-02   +1.784533643471416e-01   +1.680419575780970e-01   +3.699026900863511e-01   +1.736510856957435e-01   -3.583960304468753e-01   +2.730585764510370e-01   +7.132568250826282e-02   +7.905787618812421e-02; -2.050011039872222e-01   +3.471406605301982e-01   +1.416650556476846e-01   +1.597471675622174e-01   -2.593408696215493e-01   +1.576385690992194e-01   +1.282427795649965e-04   +9.883594545713059e-02   +9.969241995124363e-02   +9.858490906346626e-02   -2.628517823101836e-01   +2.023244147132949e-02   +1.979198035645376e-01   -7.085461387122696e-02   +2.513685480777629e-01   +4.280819663349149e-01; +2.624330330856259e-02   +1.076230561299531e-01   -2.805617008098278e-01   -3.929640389521576e-01   +1.155012274916273e-01   +4.026456719589040e-01   -2.521319568810625e-01   +8.406583033530815e-02   -1.017931029190713e-01   -2.254301432398960e-01   -2.653815315481823e-01   -5.235579279654554e-04   -2.300673021418486e-01   +1.216632420714798e-01   -5.267416608021098e-02   +4.735688584930457e-01; +3.608335089641603e-01   +3.927956081923996e-01   -1.701083599255040e-01   +7.674949912111259e-02   +2.664479269421850e-01   -4.231203522736694e-01   -1.347677232151707e-01   -5.450568082285238e-02   +8.503897082245158e-02   -2.183951892412635e-01   -1.518833249193508e-01   +3.144150027354652e-01   -3.691478972933500e-01   +9.832236172371239e-02   +1.505684314358730e-01   -1.945304447129701e-01; -1.914938465941841e-01   -1.009428030267382e-01   +1.811192692219349e-01   -2.400154040071441e-02   -9.213828461412220e-02   +1.009148974096818e-01   +1.988984817036802e-01   +2.405805013141787e-01   +2.223914081534719e-01   +2.637192612808027e-01   +1.928388486838983e-01   +2.782333119732505e-02   +1.351626423819952e-01   +1.242166719576160e-01   +1.928957813673009e-01   -2.465954533703225e-01; -2.368689048652949e-01   -1.096151027909211e-01   +3.222568186111082e-01   +1.162605187252657e-01   -2.436551580520444e-01   -1.380548098999825e-01   +5.681819883813790e-02   +3.928992911690812e-01   -1.700318356217853e-01   -1.909401619608408e-01   +9.902568644453302e-02   +2.737897785240875e-01   +3.145711741865020e-01   +9.469522929133223e-02   +1.990261986162698e-02   +3.002781529339946e-02; +2.632422270537904e-02   -1.661516402944874e-02   -1.924957227195855e-01   +7.421342109887868e-02   -1.568650091377904e-02   +3.531298239352759e-01   -3.308301701689163e-01   +4.256559760855204e-01   -9.836938941278060e-02   -1.375666624601146e-03   +2.867033015683473e-01   +5.840000565581424e-02   -2.192998095577149e-02   +4.025149932275681e-01   +1.552402147609062e-01   +7.752430295772622e-02; -6.729776802635379e-02   +4.668594040967429e-01   -2.271709817972710e-01   -3.671140718727698e-01   +1.436597678789880e-02   +1.597618157429358e-01   -2.897074427054712e-01   -1.727990116337678e-01   +1.159438804811359e-01   +1.396067131852542e-01   +2.189393245630550e-02   -4.649174798486777e-01   +3.505518310195893e-01   -1.571699213208810e-01   +2.330625988197977e-01   +4.125842986521481e-01; +2.653933079993938e-01   +2.050713661926247e-01   +3.178347269199723e-01   -2.002191636995595e-01   +2.984939957439217e-02   +5.286240564439847e-02   +2.819575783670868e-01   +1.177108475759313e-01   -1.111506225284309e-01   -1.082370226903206e-01   -2.374577234761487e-01   -6.822252536927925e-02   -1.689904003584613e-01   -2.273182678625867e-01   +1.068078192271632e-01   +6.432508416415625e-02];
L2I_L1I_iGABA_netcon = [-1.549746661231914e-02   +3.262070278764609e-01   -9.817569419168187e-02   +5.342350381046990e-02   +2.663150184524442e-02   +1.873652938706135e-01   -1.489685315439838e-01   -8.168046363745339e-02; -1.718120622309180e-01   +1.284629481565785e-01   +2.787108445905595e-02   +1.470251697619001e-01   -1.695860528611635e-01   -2.157654135181993e-01   -2.475097920369723e-01   +1.265079822737744e-01; -3.688948869736047e-02   +2.897721053750030e-01   -6.379752156573706e-02   -1.045268179177009e-01   +1.310377565640333e-01   +1.289086540096135e-01   -4.832277615850987e-02   -9.603812754086333e-02; -2.448681733939892e-01   -2.758021165208372e-01   +2.198030173121020e-01   -1.387902584585080e-02   +4.304010468719919e-01   -3.838518832172586e-01   +2.390998747217199e-01   -1.192114069489651e-01; +3.267407783297563e-02   -9.229179604296363e-02   -7.516810538719973e-02   +3.851365943157085e-01   +1.625414546173072e-01   +1.106703767132965e-02   +9.760615314018826e-02   +2.355672583581512e-01; -1.599648606242078e-01   -4.865932789940804e-02   -1.279729767615110e-01   -2.634001167954099e-01   +5.985332398312513e-03   +1.093541041235836e-01   -2.623498107394974e-01   -2.915671026679261e-01; -6.541231610778582e-03   -1.740791329142130e-01   +6.416034889169592e-02   -9.909031095825716e-02   +1.300142032159469e-01   +7.075122740459738e-04   +7.000077163447173e-03   -6.113681457583287e-02; +1.399765881912261e-01   +4.759893654286962e-02   -1.196639968524576e-01   +2.207187892128958e-01   -1.291819485999390e-01   +3.646326222163089e-01   +3.020718959991582e-01   +8.741658137650557e-02; -2.874910815661814e-01   +3.384494518867007e-01   +8.930160311920902e-02   -1.280184911659496e-01   +4.014582108028530e-01   +1.380007819929979e-01   -3.165121750733616e-01   -9.201067722212718e-02; +1.108772598518525e-01   +2.255320716707843e-01   -1.740961586484312e-01   +8.233947996779835e-02   -3.861209254886808e-02   -2.220053392096087e-02   -5.146091408530881e-01   -1.086356389422034e-01; +8.222505549654799e-03   -4.677540007460548e-01   +1.416678356156540e-01   +1.011985427503688e-01   -7.453794026603736e-02   +7.554849876577452e-02   -3.202542062955850e-01   -3.148118120052189e-02; +1.221108122187936e-01   +7.740908108442471e-02   +3.182778397525363e-02   +1.541654759815856e-01   +2.604128560778672e-01   -1.093215212643838e-01   -8.845642922111657e-02   +1.503379154702806e-01; -7.360118456540629e-02   +1.687058977008892e-01   -3.263533661505656e-02   +3.177797305584852e-01   +5.037344302531756e-03   -1.444810597512516e-01   +1.155138119366161e-01   -2.604618298839390e-01; -2.218096247834033e-01   +2.933257674521723e-01   -2.101149464309202e-01   -1.257740907289580e-01   +9.245151154738823e-02   +9.185262382668979e-02   +1.746949122794689e-01   -1.506716027202226e-01; -2.009619086724750e-01   -3.303357423728598e-01   -2.490823769746479e-01   -1.070021489197084e-01   +1.656035390798567e-02   +2.416262657453517e-01   +9.153214248616146e-02   +2.225453201416956e-01; -1.811559485356464e-01   +2.286324806400099e-01   +1.085965736898667e-01   +3.618328025167739e-02   -2.718763932083323e-02   +2.715200630822975e-02   -7.369157448188685e-02   -1.517187840280854e-02];
L1I_L2I_iGABA_netcon = [-3.681234088927428e-02   -1.990174489308943e-01   +1.757506784087611e-01   -3.537776904409345e-01   +6.691108842198859e-02   +3.388557819136665e-01   -4.473605301004132e-01   +8.827375176745071e-02   -1.680944595538855e-01   -3.985772524879673e-01   -1.111261673311234e-01   -3.635703002292422e-01   -2.053375031291361e-01   +4.582699093425456e-01   +2.096089808331804e-01   -6.938814349437597e-02; +2.118238448371831e-01   -2.520288605817554e-01   +1.710260205852293e-02   -3.994221013607424e-01   -1.282334014484241e-01   -5.196415182222081e-02   -3.463797781046608e-01   +3.155294829550996e-01   +1.981648720197204e-01   +4.507031212119744e-02   +2.288707875664310e-01   -3.182375601067283e-01   -5.251343391569146e-02   +3.709876015622372e-01   -1.783704809023061e-01   +2.130653059126594e-02; -1.084054318743877e-01   -1.649391738665675e-01   +2.095878948154319e-01   +7.987304525722015e-02   +1.350492135018703e-01   -1.739417481714073e-01   -2.769702842947480e-01   +2.813972920545249e-01   -1.577921654498341e-01   +7.986148383498867e-02   +3.003662177285182e-02   -1.425031142300495e-01   -1.358348985440770e-01   +1.878451165423722e-01   -9.759406402198205e-02   -2.710093221071068e-01; -9.414191425644963e-02   -8.037198079687624e-02   -2.764314673529072e-02   -9.427112914277330e-02   -1.308843156110964e-01   -1.114116422501729e-01   +3.336694417694542e-01   +6.110798279669249e-02   -6.379858019731593e-03   -1.679986353781454e-01   -9.920474750482983e-02   -1.540454937229081e-01   -2.385398720441141e-02   +1.496009163313022e-03   -1.037185499958613e-01   +1.268584156367858e-01; +2.459782035459931e-01   -3.007407136137466e-01   +8.107401481561327e-02   -2.307961073862369e-01   +1.384932318477544e-01   -1.460098737373024e-01   -2.707141525609415e-02   +9.954643134103491e-03   -4.377212154009523e-01   -5.769462270781650e-03   -2.881233663301849e-01   -2.000329896237838e-01   +2.124053446286001e-01   -3.890993976096420e-01   +5.751017412150793e-02   +7.182680458850021e-02; +1.843093564477678e-01   +3.211115973093004e-01   -1.728003283800430e-01   -9.805524422604001e-02   +1.539215224518432e-01   +4.868732112976136e-02   +1.284954631173614e-01   -1.686613425418012e-01   -8.403446336596088e-02   -1.796528214566951e-01   -1.207438675587885e-01   -1.614948125285297e-01   +2.944858980430686e-01   -1.378281533739220e-01   -1.486500421273511e-03   -2.750231717033823e-01; -4.850174450036532e-02   -3.509538434700269e-01   -1.941510297818784e-01   +3.016247134318620e-01   -2.183164846887355e-01   -7.850020319624249e-02   -3.286681547254114e-01   -1.630719253744386e-01   +1.127146023075030e-02   +1.183011302885736e-01   -2.480738412347251e-01   +9.384766905645296e-02   +2.233086181220293e-01   +3.432713222139407e-01   -1.505883431504536e-01   -2.182292908824723e-01; -1.732172912903738e-01   -3.293328642841253e-01   +1.273238373714250e-01   -2.749093462995630e-02   -1.901100489220459e-01   -9.862051761158239e-02   -5.160990119765496e-02   -1.326415185835352e-01   -3.632844994724319e-02   +2.044590004222933e-01   -8.560677414593987e-02   -3.756992109826577e-01   -3.413497682049829e-02   -2.563863300969187e-01   -2.008062826318776e-01   +1.853847257114256e-01];
L2E_L1E_iAMPA_netcon = [-5.497558871404457e-02   +2.461798586208945e-01   +3.808039573178382e-02   -2.014930459835731e-01   +1.451639670813671e-01   -2.207683175908621e-01   +6.667302890941465e-02   -3.078261504976804e-01; +1.623007366365129e-01   -8.545065423119359e-02   -6.990112754756818e-02   +1.376893498150002e-01   +2.257308641169778e-02   -1.054039263166330e-01   +5.669991647091126e-02   -3.794448361506091e-01; +1.696714206672519e-01   +2.422627399971316e-01   -1.863480134594669e-01   -1.337635859941681e-01   +2.372529322409420e-02   +2.540091689815727e-03   -2.491816797793343e-02   +1.817266049106873e-01; -1.393290940165199e-01   +1.814781359707696e-01   +2.658751072136772e-01   -1.818966756086486e-02   -1.263387221448327e-01   -3.719611149797679e-01   +1.819983890238842e-01   +6.502748984877771e-02; +1.000625122272912e-02   +2.411249365977196e-01   +1.879417614455843e-01   +6.118262050094757e-02   -4.078403911044979e-02   -1.398797239111743e-01   -3.254769908658310e-01   +1.779669344102716e-01; +1.897062079518193e-01   +2.719742489975607e-01   +2.223181473548842e-01   +2.567759634287839e-01   -2.414665273710401e-01   +3.873168684540077e-01   +2.600244040646892e-01   +1.495827548155864e-01; -1.925690519908620e-02   -1.666261119980655e-01   -4.256706365117278e-02   +2.087294425341797e-01   +2.940796430711307e-01   -1.012175426842004e-01   +7.170136186662909e-02   -4.553797919323764e-01; +1.699409678077524e-01   +7.091834197468343e-02   -1.012862654586492e-01   -2.577088834297927e-01   +1.412780456699911e-01   +8.441336274653916e-02   -1.418437550359141e-01   -1.237226407325806e-01; -1.496561243168914e-01   -4.077685853773096e-02   +2.070047063385870e-01   -1.268119110030467e-01   +3.365639588301954e-01   -3.193770052727576e-02   +2.419611878775121e-01   -2.056974120866879e-01; -1.423816914865050e-01   -1.072547083033905e-01   +3.666431406093463e-01   +1.902312028018671e-01   +1.205842552290407e-01   -9.800529272493788e-02   -3.085796319356321e-01   +3.108196053083350e-01; +1.284304469905033e-01   +3.027933775460399e-01   -4.091904854592283e-02   +3.515998207212234e-02   +4.615012469538969e-02   +1.509133972346508e-01   +1.743591151154743e-01   +8.389957672229732e-02; +2.027026617026975e-01   -1.256837721161640e-01   -2.358374970550829e-01   -1.590434412016814e-01   +5.491193132348564e-02   +1.884150842364606e-01   -3.971811492724563e-01   +3.937605589784280e-01; +2.677007763298803e-02   +4.028148064187224e-02   -2.384114584340030e-01   +5.610763024001090e-02   +1.827683522132943e-01   -2.810872070485496e-01   +1.370284061925740e-01   +9.566595054523017e-02; +2.771019602961833e-01   -5.791524395926795e-02   -6.809440943165332e-02   +1.960509599355990e-01   +9.737916950376038e-02   +1.472934876902920e-01   -1.921828827264112e-01   -2.528328767815282e-01; +2.515832930670747e-01   +5.345548204059609e-02   +3.679853890928137e-01   +9.185145964372712e-02   +3.029900193098452e-02   +8.989705507479984e-02   +1.501343275011980e-01   -1.301312425845419e-01; -2.382098249370420e-01   -1.587190053559692e-01   -7.481459630405715e-02   -1.865930266015540e-01   -1.784333959727878e-01   -2.567887265493438e-01   +8.302459651147132e-02   -5.969798673110270e-02];
L1E_L2E_iAMPA_netcon = [-1.371911968120858e-01   -2.119863130787817e-01   +6.581553556470222e-02   +2.320432530921695e-01   -3.043938067757448e-01   +4.036115844660686e-02   +1.369066307534964e-01   +6.582019102490429e-02   +3.602693761874130e-02   +1.769725466471718e-01   -1.766962231899200e-01   -2.631561351965580e-01   -1.290850724469348e-01   +1.483966564550479e-01   +7.645389588666000e-02   -2.168039528092589e-01; +2.920499070916633e-02   -3.329639345537825e-01   +2.175895276179175e-01   +2.059272849285945e-01   -3.683562236056430e-02   +7.355846374674292e-02   -1.245126408747423e-01   +2.449607051096019e-02   -2.165493762463978e-01   -9.371386691027864e-03   +8.193753735994833e-02   -8.570550758303855e-02   -1.835326593161962e-01   +2.177908406001590e-01   +8.339189550953230e-02   -2.305132692930551e-01; -6.410938634776325e-02   +1.585112836024290e-02   +3.721509770544048e-01   -3.580746594402582e-01   -1.048887662602735e-01   -4.129930226580300e-02   +4.395793317698174e-02   +4.051621824619610e-01   +1.307232874337841e-02   -2.649455263021465e-01   +8.243645913267252e-02   +5.130036293465932e-02   +1.485495516486345e-01   -8.164992786228076e-02   +8.638825737628109e-02   -7.275510350006464e-03; +1.111164423803229e-01   -3.483546720223128e-02   +1.124901003376119e-01   -1.890304006868712e-01   +3.442615091171650e-01   +8.707502529378658e-03   -7.974406977845426e-02   +1.552824707620155e-01   +1.385427539314593e-01   -1.066273290029328e-01   -4.124906387442577e-01   +2.212739757116264e-01   +7.945170357362646e-02   +2.835956275956912e-01   +1.925168232673795e-01   +4.711721984701178e-02; +8.242964545481901e-03   -3.562148547349565e-01   +1.166014088720592e-01   -6.755862729919297e-02   +4.942011849883315e-02   +2.832218109195285e-01   -7.337505538269802e-02   +4.274146578850163e-01   +3.938197800426246e-01   -5.989527655282975e-02   +8.971629704112188e-02   +6.910136000870178e-03   +1.990438860426844e-01   -2.930950936106058e-02   +5.749642563567188e-02   +2.824028848064877e-01; +1.162453736260336e-01   -1.910842449873328e-01   +2.342187136654736e-01   +1.874972587019773e-01   +2.011704420467721e-01   -3.137005578377444e-02   -2.395584244265292e-01   +1.942356639527401e-01   -5.588860421219360e-02   -8.889106156612583e-02   +1.893447958572357e-02   +2.078269803713454e-01   +2.273556657654461e-01   +9.127806781499737e-02   +1.528494316078880e-01   -2.452422997457961e-01; -1.169108964890322e-01   -6.989595124304179e-02   +6.478800976549938e-02   -5.037563796707954e-02   +1.267172181710444e-01   -1.642996091228342e-01   -9.208410097730582e-02   -2.909531630778295e-02   +1.081489684252170e-01   -1.915111725445640e-01   +1.139141254589679e-02   +2.937281419155878e-01   -2.838863090843772e-01   -3.884295077728738e-01   +3.665033438231952e-01   +2.868274918867324e-01; -7.719352471608293e-02   -3.510626047728274e-01   -2.331159293971846e-01   +2.848833488316157e-01   +3.994806137247647e-03   +3.266384764725466e-01   -3.047281782045851e-01   +5.344238968716495e-01   +1.296973912518070e-01   -3.122918161710562e-01   -9.916231387431319e-03   +1.335139468409084e-01   -7.526333411287414e-02   -2.092599173551850e-01   -2.013428802699258e-01   -4.061248013196488e-01];
L2I_L2E_iAMPA_netcon = [+1.276073047862493e-01   +1.879863940085560e-01   -3.830808112009931e-02   +3.830508957187369e-01   +3.269269490107117e-02   -1.722689375381873e-01   -1.492410906171653e-01   +3.395331925282971e-01; +6.300441414146520e-02   +2.261079192627635e-01   +2.672412334507075e-01   +1.921893426504897e-01   +4.416218382596780e-02   +1.667716381059739e-01   -9.182494888356002e-02   +5.408593740580531e-03; +1.924307485236168e-01   -8.358517822680238e-02   -4.131648336396753e-01   -2.607084024954980e-01   +1.159526617032047e-01   -5.901193684779152e-02   +1.048764187802508e-01   +2.176771536080721e-01; -3.729941148556336e-02   -6.980392311001647e-02   -1.154919033157467e-01   -6.971954832233443e-02   +1.694942166686201e-01   +2.873600462190882e-01   -1.267136922422254e-01   -2.279392219069726e-03; -3.759755533823856e-01   +7.166052030903695e-02   -1.225249924509516e-01   -2.104006244809135e-01   -1.035935715989640e-01   +1.336845267603497e-01   -1.635905254043684e-01   -1.202814839970851e-01; +2.099249237561102e-01   +2.046301629846703e-02   -1.283496755418246e-01   -1.457587036473929e-01   +1.162251957951209e-01   +5.959581099431386e-02   +7.784471276166692e-02   -4.220243364512710e-03; -2.283113732225218e-01   +7.296270592086369e-02   +2.204493102585953e-01   -9.786503734587919e-02   +1.990032102066592e-01   -5.891358343197621e-02   -1.668600804772499e-01   +4.296547923556455e-02; -4.254599652615284e-01   -1.550190851134449e-01   -1.600760118603125e-01   +3.126126632663440e-01   +5.921736155913765e-02   -2.587481019975846e-01   -1.571208383325892e-01   +2.204796134244220e-01];
L2E_L2I_iGABA_netcon = [-4.146173423056758e-01   +4.079260569331966e-02   -2.333343565057927e-02   +3.406443088206775e-02   +3.893017928310595e-01   +2.294607455798128e-02   -1.374348956406082e-01   +1.720520507269678e-01; +2.021587731295053e-01   +1.718589090220834e-01   +1.515242526749686e-02   -5.787411184740873e-02   -8.864782410171036e-02   +2.672238686163838e-01   +8.631389808249289e-02   -8.955794885815281e-02; +2.157228101524592e-01   +4.306546384266152e-02   -1.401229033824261e-01   +7.485724048788860e-02   +1.634761020215366e-01   -1.862116476140485e-01   -1.968344620193901e-01   +3.518029837777218e-01; +2.849815974126911e-01   -9.828701789646541e-02   -2.318350206070255e-01   +1.953677675972051e-02   -9.622225515658060e-02   -2.612714465942012e-01   +5.616487499202323e-02   -6.390808201681239e-02; +9.011927791620487e-03   +2.636865236317495e-01   -2.484537591586377e-01   +2.452810936432084e-01   -2.609298631700022e-02   +2.882094580484415e-01   +1.501211544544034e-01   +1.371867641901839e-01; -9.280784989259178e-02   +3.150829663726967e-01   -1.569083199118284e-01   -5.201558373603504e-03   -2.455498990866061e-01   +1.760642705411314e-01   +2.701930441046668e-01   +9.498469072185672e-02; +4.650205060139688e-02   -3.138809303454685e-01   +3.532786221436905e-01   +1.183403183723901e-01   +2.696814471548364e-01   +3.833602220250365e-03   +1.439071195195923e-01   -1.648937333244981e-01; +2.407086229108509e-02   -4.515118799360085e-02   +2.830655340913355e-01   +1.768040810947995e-01   +2.612720330697501e-01   +1.767857910164168e-01   -9.181553693926517e-02   -3.220098523819354e-03];
L3E_L2E_iAMPA_netcon = [-5.911356021514569e-02   +1.838541176433766e-01   -2.299663510381614e-02   +2.590977781824942e-01   +2.262916774332782e-01   +2.494518619432198e-01   -3.633805974026175e-02   -2.563420675712093e-01   -1.102992422464225e-01   -1.598901978711194e-02   +3.343742502610034e-01   +2.092408744697673e-01; +3.268351374737919e-02   +1.088021249867950e-01   -1.120399330114664e-01   +5.757746449917486e-03   +2.442769883730750e-01   -1.858216496807490e-01   -9.597206465980242e-02   +3.198045017197144e-01   -1.890739421699101e-01   +5.840984232159460e-02   -2.729428130489424e-01   +2.591366806422532e-01; +1.695988689549849e-01   +1.005621204224337e-01   +4.778455909741082e-01   +8.597672032471984e-03   +5.929135533747948e-02   +2.313688281106437e-01   -1.710609547222328e-01   +2.384298621436025e-01   +2.708654815245311e-01   +5.849128409866148e-02   -1.038952910600834e-01   +1.808531967505073e-01; +2.269450705032400e-01   -1.823538107885514e-01   -2.953613364772600e-01   -9.381515657195119e-02   -6.128171334648300e-02   +9.360311264054999e-02   +2.795648494460662e-01   -1.695783188453620e-02   +1.546466557323768e-01   -1.292631009378791e-02   +1.919953925243056e-01   -7.081793544307005e-03; -4.446275048708510e-02   +1.339176795289573e-01   +3.958347650033490e-02   -2.309045927352260e-02   +1.240909266203091e-01   -5.928063203300921e-02   -3.118778226857130e-02   -8.168689420594114e-02   -2.064197836532821e-01   +2.091891385465469e-01   -6.147188564800199e-02   -9.789989874607831e-02; +5.624264222306001e-02   -1.491698454128569e-01   -3.244341631316131e-01   +1.211938743754389e-01   +1.301841648082249e-01   +2.270562406795362e-01   +6.666677855737832e-02   +4.799622362377498e-02   +2.532937599002241e-02   +2.119399220687313e-01   +1.783939639392435e-01   +2.810855133794116e-02; -1.907936393428643e-01   -2.119393559387339e-02   +2.936657735340618e-01   +2.977176350534816e-01   -6.140340603721595e-03   -2.313706036198190e-01   -3.569953973241380e-01   -5.111960418679387e-02   +1.348412779408416e-01   -4.208347713858592e-01   -2.858220581952284e-02   -1.028817386993371e-01; -3.119896807892433e-01   +5.251824459888520e-02   +6.700177288870049e-02   +1.130541714722177e-02   +1.556808840587885e-01   +6.809016142726868e-02   -2.780490208919039e-01   +1.090859322977207e-01   +3.345297372967189e-01   -1.629460385329841e-01   -1.776585504520444e-01   -4.940200190795453e-02];
L3I_L2I_iGABA_netcon = [-5.793332298770743e-02   +1.753756275404790e-01   -3.011200300837299e-01   -2.092843567655673e-01   +9.948662436968472e-03   +3.018425657051370e-01   +1.005933557716364e-01   -1.151989557574306e-01   +5.259607208582345e-02   -3.459398062595745e-01   +1.307615836481264e-01   -6.199666224666328e-03; -2.070046399383998e-02   +2.474186645148292e-01   -1.097593501306723e-01   -2.898120408661367e-01   +1.851150201845430e-01   +2.003383798304495e-02   -1.044765237750993e-01   -9.276215870125082e-02   +8.136186566582154e-02   -4.993787092415371e-02   -2.064434133565387e-01   -2.004481999755971e-01; -7.149880165089077e-03   +4.557712283915404e-02   +3.943088899992424e-01   -2.063953571412680e-01   -2.023748572032874e-01   -8.887631730769577e-02   +3.501012748066948e-01   +3.728923523058488e-01   +2.053746346535590e-01   -7.963196037659198e-02   -1.816362300352247e-01   -1.017701641523550e-02; -2.075774241260420e-01   +5.489058529353808e-02   +7.154841330274229e-02   -2.205037902660127e-01   +2.289278679877523e-01   +1.756149225544078e-02   +4.175424644592247e-02   +1.146611032266284e-02   -1.015484078535179e-01   +1.223571815568100e-01   -3.681714857291688e-01   -1.239731367488089e-01; -3.840680752487904e-02   +3.874341108066841e-01   -8.137679662484038e-02   +2.438976539245860e-01   +1.352637280281399e-01   +1.578619721235637e-02   +2.084308459525875e-01   +3.165674105808873e-01   +2.710837574260923e-01   -1.966994248684110e-02   -2.890567120326668e-02   +1.714514314517497e-01; +8.899156408573750e-03   +2.715203754244016e-01   -8.287933903312178e-02   -1.999503459041157e-01   +5.072621416415780e-02   -9.401063620862210e-02   -7.389754090732911e-02   +3.304379906207935e-01   +3.469404423351749e-01   -2.483458247027428e-01   +4.975278513484147e-02   +2.340412406869039e-01; +1.607985026944962e-01   -1.587684173069624e-01   -4.148058175580228e-02   -1.729005843343679e-01   -1.153307188302961e-01   +1.153228146094143e-01   -6.741515819489596e-02   +3.067803190537204e-01   -3.310207340392361e-01   +1.865534078174402e-01   -3.258381355822654e-01   +1.578629378747889e-01; -1.994918770626006e-01   -2.399254409421316e-01   -1.086790683272016e-01   -2.808026231613469e-01   -9.822922031714139e-02   -4.850192681335645e-02   -2.569097032656677e-01   -3.160642284059966e-01   +2.309891438732952e-01   -4.367177829888651e-02   -5.987254267153874e-02   -2.123541734148168e-01];
L2E_L3E_iAMPA_netcon = [-1.820888618806599e-01   +3.900084025901905e-02   +2.515479289279439e-01   -3.347014178321244e-01   -1.234669694807188e-01   -1.608499232992081e-01   +2.347621641958869e-01   -4.754895144936211e-01; +4.046926836792636e-01   -3.022551157999473e-01   -1.085975674332454e-01   +7.131616742266145e-02   +1.844426347819272e-01   -1.313772729510859e-01   +7.545679349059109e-02   +2.904562183081889e-01; -1.896094508001965e-01   -1.020961151587779e-01   +2.410537459545743e-01   -4.691883139335495e-02   +9.786587894312018e-02   -1.054776287558043e-01   -1.661058372761602e-01   +2.880992710152321e-01; +1.411972965064179e-03   +8.836384011552810e-02   -1.468456191261359e-01   +2.529481805616433e-01   -1.042227488215138e-01   -3.123899417891554e-01   +8.681292926235507e-02   +1.829142267094080e-02; -2.771121155444004e-02   -1.172697480936173e-01   +4.648424142230299e-02   -3.570655988281168e-02   -1.552161279526144e-02   -3.284791472444233e-01   -1.607394185680875e-01   -2.802513466840648e-01; -4.471328360182768e-02   +1.240224093504511e-01   -2.682543301450320e-01   -5.062129933412321e-02   +9.297470462037402e-02   -1.843856772631397e-01   -2.410410940901422e-01   -4.473659472799418e-01; +4.004334162765385e-01   +4.052410922389892e-01   +6.591172554455796e-02   +1.167401220448593e-01   -4.348401189332167e-02   +1.440758118858292e-01   -2.208210160086872e-01   +2.342419468069639e-01; -5.608138789758041e-02   +7.749839645180057e-02   -2.163740755964835e-02   -3.745900301470072e-01   +1.862004093413447e-01   +1.432959508115347e-01   +1.025732709468068e-01   -7.231607474786739e-02; +3.033298093235917e-01   -2.464318850524190e-01   +8.803852875586957e-02   -1.176949341360263e-01   +1.167746256887034e-01   +5.716414293094505e-02   +9.366886233975528e-02   -6.087278449001697e-02; -9.980611285867219e-03   -1.021275016979055e-01   +9.622874000863438e-02   -1.173340056726251e-01   +3.122525472265700e-01   -2.956174727006950e-01   -1.084915447371467e-01   -1.294074928299264e-01; -6.989984619583042e-05   -2.722170289534868e-01   -2.047639477053625e-01   +1.554985249762193e-01   -1.888094771947523e-01   +2.998417320122532e-01   -5.618663962521420e-02   -9.481219124589380e-02; -1.227477814686254e-02   +1.266906167248708e-01   -1.488440313940955e-01   -1.252624519371333e-01   +1.343459663853222e-01   -4.092680276502086e-01   -2.806909190140207e-01   -2.276921922142359e-01];
L2I_L3I_iGABA_netcon = [-2.230670462950731e-01   +2.344103429419674e-02   +3.343027673377771e-01   -2.308278309831397e-01   +1.707137508148085e-01   +1.269911985523816e-01   -1.421867982834964e-01   -1.021399179683302e-01; -2.497639959523781e-01   -3.650158887369322e-01   -2.165393171558226e-01   -2.939089180379553e-02   -1.856054977815296e-01   +4.764450504862199e-01   -2.525897943226209e-01   -1.850265661309085e-01; +2.715560307949383e-01   +2.366698876447983e-01   -1.153881661225766e-01   +1.904819010807579e-05   +3.867104625215378e-01   +9.739502998253716e-02   -7.280648664935326e-02   +2.076370092328638e-01; -2.335189784209492e-01   -5.351037070308670e-02   +2.771731417874911e-01   +2.495918279113249e-01   -1.134776244029538e-01   -3.721430468272571e-01   +2.026615617086207e-01   +2.210424840381927e-01; +2.425489016936938e-01   +1.857907307814612e-01   +3.408930067997605e-01   -1.201469765614561e-01   +7.410456376379701e-02   +3.129976797905403e-02   +1.442850722000094e-01   -1.804816283401469e-01; -5.338595186353740e-02   -3.269125308950317e-01   -7.085063056880340e-02   +1.456875278944575e-01   -2.716162884619763e-01   +3.083272370899641e-01   -1.884071658725241e-01   +3.519370233998004e-01; +3.379564330302017e-01   +2.522409100222693e-01   +1.538925485425905e-01   -1.626181017452965e-01   +1.834875362444889e-01   -6.515556548195223e-02   +3.205578348069253e-01   -1.325831297053843e-01; +2.177786750009341e-01   -9.648569932745904e-03   -3.871200703345651e-02   -6.621294840456278e-02   -1.535387012419775e-01   -5.155665577353361e-02   +4.011390186805094e-01   -1.879657648156705e-01; -9.456046611802174e-02   -3.795964315829382e-01   -3.314988785448607e-02   +2.314946410298606e-01   -8.137360654601850e-02   +7.545182246864414e-02   +1.807455526497612e-01   -2.482394443599388e-01; +1.385473977834288e-01   -2.794783201816460e-01   -1.112357367189677e-01   +1.927599752294931e-01   -2.083140068973311e-01   -1.388061489973873e-02   +7.323983982094492e-02   -5.392039067451082e-02; -4.721842796827690e-01   -2.308524557506342e-01   -6.361524082928489e-02   -2.090329627214771e-02   -2.929247224046240e-01   -7.913806983683380e-02   +5.781217507122145e-02   +1.350309687848599e-01; +2.815671792850883e-01   +2.893405078595670e-01   +2.313110579897550e-01   +3.879686474044271e-02   +2.529900304634724e-01   +1.783672900380594e-01   +4.575673285067113e-01   +1.397196620825563e-01];
L3I_L3E_iAMPA_netcon = [-1.718762058713622e-01   +1.903486233419525e-01   +3.183254547275499e-03   +1.251358229657036e-01   -1.255397056609653e-01   -1.327092781430913e-01   -2.861532117715504e-01   +1.363527352655599e-01   -1.004570332001114e-01   -7.492932272192135e-02   +6.192545802626834e-02   -1.946115650378472e-02; -1.677628236343777e-01   -2.137174011037721e-01   +1.267104717052846e-01   +5.623249072532242e-02   -8.567010115412860e-02   +3.541893590325221e-01   +5.448884243063712e-02   +1.650236719933294e-01   +2.603269983633620e-01   +4.550479702588708e-01   +1.159238676892759e-01   +8.838545370650933e-02; +4.269011988845788e-02   +8.709878627862702e-02   -2.659927411329298e-02   +4.676745416941432e-02   -6.363123308952345e-02   -1.635195878257238e-02   -9.026351420838581e-02   +5.684919243935357e-02   -2.383044234802797e-01   +9.199168286812089e-03   -5.546373894828653e-02   +1.676274468104633e-01; -7.204406195903941e-02   +2.588492472551840e-01   -2.560541112079032e-01   -8.140254699066471e-02   -2.089709266457214e-01   +1.272011815279038e-01   +1.590225348628201e-01   -4.425186477377839e-01   +3.318393831094519e-01   -4.298439471217392e-01   -4.381561588762065e-02   -2.577485443856655e-01; -3.957706210345004e-01   +7.741477493925425e-02   -6.285590301145420e-02   +3.634428224804401e-01   +3.215026153060075e-01   -2.665577934226367e-01   +3.110926410546654e-01   +2.798961682675609e-01   +1.255775308657978e-01   -1.508633934421044e-01   +2.696231240443118e-01   +1.244652228448620e-01; -2.886508041454982e-02   +1.956827620189970e-01   -2.291343959372509e-01   +3.749916801294504e-01   -2.240495365665554e-01   +8.081328190367118e-02   +1.490538500138099e-01   -1.043228353587575e-01   -1.404397248011225e-01   -4.158074991520763e-01   -1.267870309834395e-01   -2.388608247422166e-02; +2.463740375471189e-01   -1.602098634869961e-01   +1.779815317886636e-01   +3.257529070829588e-01   -8.219533454728029e-02   -3.440779271723056e-01   -2.700181597579917e-01   -2.278567459689820e-01   -2.745897588077770e-01   +2.309591796380643e-01   -1.473382830550678e-01   -4.130690257489849e-01; +2.538104981360405e-02   -3.651799779099828e-02   +5.332566093212969e-02   -1.934055847060562e-02   -2.613405230452349e-01   +1.584362328386578e-01   +1.920230544716080e-01   +2.358782987215710e-01   -1.182110411198904e-01   -4.679324705772241e-02   -3.294252591271215e-01   -5.172910773195186e-02; +1.956667316012462e-02   +3.265404095055879e-02   +2.460907558975730e-01   +2.124744523099892e-01   -1.029141442362039e-01   +1.843449230201367e-01   +2.520435921778902e-01   -2.177377827045144e-01   -3.484231255107123e-01   +1.259098872230225e-01   -4.459728784193405e-02   -1.252982156208473e-01; +2.405158568127929e-01   +1.085165408679840e-01   +1.654848714182103e-01   +3.690286668258033e-02   -8.671354627673745e-02   -2.406269456150965e-01   +2.687817498355654e-01   -4.922754104748656e-03   +1.517953838483414e-01   -3.259268721147400e-02   -4.362157518223060e-02   -9.167638259800492e-02; +8.320920994168071e-02   -1.960972684854132e-01   -2.979940273410451e-01   +5.441704152667667e-02   -8.011536370065679e-02   -1.478500263935044e-01   +3.020282700778729e-01   +8.729901728682804e-02   +1.516768002037870e-01   -3.663886225849861e-01   +4.578504945259333e-02   +3.566175243139072e-02; -2.270711067927446e-01   +1.791683204261601e-01   -2.388752624515131e-01   +1.324385152084363e-01   -2.339338284600774e-01   -1.839308129127198e-02   +3.046004402139180e-01   +2.770221229803421e-01   -1.372394687656152e-01   -3.482842347276841e-01   -1.171831374611961e-01   -2.729142115444592e-01];
L3E_L3I_iGABA_netcon = [-1.746750339470905e-02   -3.333116785398059e-01   +2.138339901793398e-01   +1.767449223613811e-01   +1.027824955823524e-01   -5.541485093378619e-02   -2.853378428713645e-01   +5.659922705832678e-02   -2.619525094748114e-01   -9.460865639491244e-02   +7.802855280528737e-02   +1.742478424580469e-01; +4.022971530666281e-01   -3.295864510898356e-01   +3.965579936218667e-01   +3.046825659330578e-02   -8.943662696857217e-02   +1.222002777285221e-01   +2.501171694930442e-01   +2.403416852059080e-01   -1.657756955938402e-01   -8.694820404364284e-02   +2.019646850042609e-01   +2.215133985282027e-01; -8.847120450829937e-02   +1.461314868258779e-01   -6.935416837936190e-02   +1.249839955344802e-01   +2.256148534344773e-02   -4.481054879551177e-01   +2.837890025576760e-01   +2.925695301808086e-01   +1.541933554715975e-01   -1.947034075176960e-02   +5.483277302009271e-02   -1.478420318476725e-01; -2.805700093052964e-01   -1.758749198748769e-01   +1.240238741451287e-01   +3.761534201343472e-02   -2.152706265662246e-01   +1.532586784083264e-01   -2.514786353335925e-01   +2.136256600879257e-01   +1.746295418849216e-01   +3.592570161810059e-01   +3.041804157854452e-01   -1.907294030718986e-01; +2.706297483445925e-01   +6.888523459895507e-02   -8.138861664309266e-02   -2.254531470741826e-01   +3.669029985898734e-01   -1.029773032688292e-01   -7.986233868992468e-02   +3.351318201344327e-01   +1.905364331512027e-01   -1.875948959289929e-01   -4.050153463846625e-01   -1.963484953211545e-01; -1.923429680541808e-01   +2.640295375738845e-01   -5.040719846511166e-02   -1.329585174120674e-01   +6.343803519923720e-02   +5.006316253817491e-01   -2.499575897269155e-01   -2.585611783778677e-02   +9.678586456637739e-02   +2.962170954409496e-02   +1.889071745190945e-01   -1.073996045191362e-01; -2.860508943463517e-01   +1.580598986566075e-02   +3.023462119062786e-01   -9.433136721353255e-02   -7.637924275283282e-02   -2.144673671581871e-01   -2.144614233766064e-01   +3.186241645794273e-01   +3.836771296324530e-01   +1.389956516157297e-01   +3.214475653124529e-01   +1.348746467257585e-01; -8.435944433728859e-02   +4.895440855647373e-02   -6.639714686518737e-02   -3.109317274164483e-03   -1.926772144596953e-02   -3.247131132734170e-01   -9.663001822257780e-03   -2.548283173049506e-01   -2.335359059141063e-01   +5.760797518402465e-02   +7.790633954582256e-02   +3.752858270042536e-02; -1.990005409590240e-01   -2.368795342318371e-01   -1.894557485146588e-02   -1.401932720570143e-01   +3.094172403505535e-01   -2.165814409746001e-01   +3.965643215022220e-01   +1.471111117234132e-01   +1.860829982383619e-01   +3.104100735300599e-01   +3.560912764795209e-02   +2.794205497987020e-01; +5.267595113746334e-02   -1.176870596910415e-01   +1.903629472893300e-01   -1.763356570988292e-01   -1.191605713482589e-01   -1.905112038344885e-01   +3.205423714762830e-02   +2.716511337134671e-02   +1.879010309168258e-01   +2.369120444245351e-01   -2.831300661549110e-01   +3.501759737745178e-01; +1.144087238754544e-02   +1.170631194220588e-01   -1.087448608515024e-01   +1.742285023689757e-01   -3.995842793276997e-01   -5.390732281053404e-02   +1.820758474828058e-02   +2.134038955465889e-01   -1.776406272024819e-03   -2.770951624207609e-01   -1.893941378533537e-01   +3.308347522671745e-01; +2.272794576176313e-01   -2.020262970279464e-02   +1.843449735794103e-01   -7.506324137317083e-03   -2.722871353247229e-01   +3.606526986153508e-01   -1.850464929313442e-01   +1.077669540891485e-02   +2.240898234424060e-01   +1.411724477887678e-01   +8.117431958881342e-02   +3.225124251811345e-01];
L2E_Input1_iAMPA_netcon = [+1.509871582009369e-01   +1.097597771771514e-01   +1.594251330643111e-01   -1.485190818587825e-01   +2.093958586298763e-01   +2.628656587507629e-01   -1.548347229766975e-01   -1.546758321571032e-02];
L2I_Input2_iAMPA_netcon = [+1.412151418642699e-01   +1.164771041879406e-01   +1.288593736652190e-01   -1.756348843381542e-01   -4.218618747847190e-02   +2.630755488746352e-01   +2.123200669879922e-01   -2.496692073284031e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.04*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.9*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.1*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.9*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.1*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.9*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.04*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.9*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.1*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.9*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.1*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.9*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
