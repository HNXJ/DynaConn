function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+6.998177821449518e-01   -2.447257916086181e-01   +4.869841007597314e-01   -1.354384164214234e-01   +7.811405034544930e-01   -1.917297400254691e-01   -2.990015688636267e-01   +1.335562316644515e-01   +5.193408979247660e-01   +6.764973982835057e-02   +3.067855736964135e-01   -3.327901178564998e-01   -4.016678744244979e-01   -8.546373641371192e-01   -2.585410032289041e-01   -4.186802816041870e-01; -2.614722127474228e-02   +2.222251049337715e-01   +1.781523412274874e-01   -2.948801710558908e-01   -1.213777180535051e-01   -3.737004574111535e-01   -8.355374690976421e-02   +1.094352058819299e-01   +7.144144416967252e-01   -1.787905579663970e-01   +4.991700707496060e-01   +1.845315843638397e-01   +2.142198642892951e-01   +3.571951740048321e-01   +7.181844419138962e-01   -3.158788889971922e-01; +4.877522141289958e-01   +6.644079176846438e-01   -7.656728622056533e-02   -3.985908437044499e-01   -1.265036336198324e-01   +5.093992142626291e-01   +1.621488450441298e-01   -1.576967174715863e-02   +2.312805657158218e-02   +3.189373866782448e-01   -5.525568833702370e-02   -6.381728541814765e-01   +7.034380707616203e-02   -7.657336826796325e-01   -4.016594590703580e-02   -4.317129832148344e-01; +1.729594767495429e-02   -1.742994046634769e-01   +2.969262595245751e-01   +4.121725468105882e-01   -1.996538832747164e-01   -4.243333938708719e-01   +2.779085956746863e-03   -1.097906441188224e-01   +4.150484366982794e-01   +1.278714513002333e-01   -3.663303906183963e-01   +6.426159040129970e-01   +2.610325787482416e-01   +5.240118966530519e-01   +1.766757680287635e-01   +5.879311333771906e-01; +6.559047162358042e-01   +2.647572871325644e-01   -9.387922952624440e-02   +3.082544481997629e-02   +1.666681676312419e-01   +4.061883180476759e-01   -3.281602612478202e-01   +3.129414995007663e-01   +7.620199308471541e-01   -4.044334386439071e-01   +4.360386684656750e-01   +1.739316683723294e-01   -1.666765343796541e-01   +1.461285501788342e-01   +5.067277848729536e-01   -4.434341230548544e-01; -5.391433065095874e-01   +5.126082823811666e-01   -7.693596345723183e-03   +1.324723832222867e-01   +9.125770922062265e-02   -6.378308803481929e-01   +1.166353088818375e-01   -3.819659899599295e-01   -2.602362714065305e-01   +3.323399874681102e-01   -3.755447219630330e-01   -2.446071464809917e-01   +2.427430125524893e-01   +3.913797963773485e-01   +1.064292499238298e-01   -5.075413168786448e-02; -5.574402559558689e-01   +6.284888171384455e-01   -4.734436166772401e-01   +1.182361726689802e-01   +1.906209755920458e-01   +1.078510088964286e-01   +1.276033453083873e-01   +7.429515371352842e-01   +8.935490258138362e-02   -3.091256444768913e-01   +4.749625028179952e-01   +3.833395903562082e-01   -7.105842212174489e-01   -3.932418556381327e-01   -5.738799265612226e-01   +2.497924262317745e-01; +4.213477381267384e-01   -3.124441299603957e-01   +2.568088544086803e-01   +1.381943409443320e-01   -3.626361599275176e-01   -3.730005097556768e-01   +7.963783676720848e-02   -8.068693376626135e-01   -6.945858445485172e-02   +1.670978482423310e-01   -2.105197572751278e-01   -5.941387185789178e-01   +3.523652742780564e-01   -5.144214851846507e-01   -2.437821261861232e-01   +1.385646798877122e-01; +5.184810982398758e-01   -4.032595242041701e-01   +3.629691779652520e-01   -6.668316655204379e-02   -2.134225606387242e-01   -2.446686256016450e-01   +8.764649234312277e-02   +1.863387214881033e-01   +4.318859894242922e-01   +5.515034792892144e-02   +1.440516663578160e-01   +2.695472409913339e-01   -1.213859113381396e-01   -2.698188490841775e-01   -1.209253428591168e-01   -3.301886634374100e-01; -3.646893342802602e-01   +4.210480112276240e-01   -2.678004166528318e-02   +2.913684928443746e-01   +3.428383936890094e-01   -8.975703716545000e-02   -3.234268942084422e-01   -3.251326033679596e-01   +1.150309526960384e-01   -3.334896027580739e-02   +2.184701258372256e-01   -3.674788206659247e-01   +2.142473463222929e-01   -4.895397372383385e-01   -1.003799224064163e-01   +7.698494633553284e-02; +1.336426848131502e-01   -3.951509239985360e-01   -2.049166377953379e-01   -5.144578378576143e-02   +4.483463209517443e-01   +5.521633467999354e-01   +1.849603505882020e-01   -5.345937129271361e-02   +7.505574319413075e-02   +5.283126405003969e-01   +5.018496392273041e-02   +8.761442565338692e-02   +4.180135906076993e-01   -3.999783240203671e-01   -6.618235350075361e-01   +6.063334058928553e-01; -1.548843309552778e-01   -4.944789121476257e-01   -1.428214932198871e-02   -2.802075959541772e-01   +2.902010076725722e-01   +1.414602576720375e-02   -2.910076607913854e-01   -1.339655612426644e-01   +2.173023731745190e-01   -4.638835678438294e-01   +6.363487685710617e-01   -3.602991258505928e-02   -2.407958694988101e-01   +4.201733563747226e-01   -4.173712713679978e-02   +8.359166178907843e-02; +2.410991218024888e-01   -3.395777635409243e-01   -3.077216703688400e-01   +1.169875468494705e-01   -1.317866622494385e-01   +1.340584901991325e-01   -3.967056204111684e-01   +2.864652823258254e-01   +3.832517559671005e-01   -7.192045105557533e-01   -2.745534049937347e-01   -2.719420824732413e-01   +2.193092425087393e-01   -1.255401128622914e-01   +1.226321664759515e-01   -1.025680566684723e-01; -4.252188276942213e-01   -4.717522119422997e-01   +6.571911214270516e-01   -2.574643972595558e-01   -5.289938901193884e-01   +2.672721673669853e-01   +4.027473140601520e-01   +5.086391135686844e-01   -1.617505820489978e-01   -1.098150987207428e-01   +6.139219643580478e-02   +5.254000568331261e-01   -2.269638012117047e-01   -3.256394289620605e-01   -4.799926293258281e-01   +2.520326158607293e-01; -1.531923664443283e-01   -3.487250631575550e-01   +1.437574559146031e-01   -7.153695262083525e-02   -1.934830587853777e-02   +3.187185197705420e-01   +7.186530483991778e-01   -9.384074057769026e-02   -1.409448235943117e-02   -1.286907483726689e-01   +6.105541840432854e-01   -5.024088007597556e-01   +5.732649341679591e-01   +6.225501707083658e-01   -1.486562546927576e-01   +8.429269653426676e-01; -4.494278155112825e-01   +3.704463667195604e-01   +1.339072213482756e-01   -2.767812941486739e-01   +2.599113125411159e-01   +2.989488172346524e-01   +2.831077613945788e-01   -2.677363766151363e-01   -2.255202542305565e-01   -2.285118169720744e-01   +3.704235434554084e-02   +3.127918658475212e-02   -4.108515011208239e-01   +6.026291950618482e-01   +3.142019481096719e-01   +2.223374782988889e-02];
L1E_L1I_iGABA_netcon = [+2.656045427985834e-02   -5.090390902707598e-01   -3.420082648384229e-01   +2.179376166380232e-01   -2.983843661040239e-01   +7.129340184753661e-01   -2.298458794516940e-01   +1.685991333416766e-01   +2.557265994418737e-01   +2.293368345162091e-01   -1.782553423518206e-01   +2.683442411708088e-01   -2.227966180525126e-01   -2.370325100346704e-01   +1.866371850838733e-02   -3.013371889852550e-02; +3.339284776107082e-01   -4.365350092456893e-01   +6.649312754344294e-02   +3.925272928741400e-01   -2.676572130830558e-01   -5.400133811335778e-03   +7.874241531462607e-02   -2.044893179599309e-02   -4.675719612601378e-01   +4.136727334239750e-01   -3.716586312228640e-01   -3.840736583094755e-01   +2.105622594822621e-01   -1.783670952328841e-01   -1.922922549751519e-01   -5.229962769670391e-01; +1.098135117183188e-02   +1.270248465413714e-01   +2.796006125797846e-01   -3.566910593327361e-01   +3.422088332601041e-01   -1.784114402944125e-01   -2.238940293128291e-01   -1.651101482440192e-01   -1.961905557476089e-01   +7.262437732283469e-01   +2.413587766349946e-01   -4.231211714202373e-01   +5.398621651486435e-01   +5.400010411353953e-01   +3.214437645164288e-01   -1.286049304021262e-01; +6.225877808241359e-01   -1.821627060963000e-01   +2.297812659535366e-01   +4.403242867599856e-01   +3.339168962968619e-01   -1.403444094545889e-03   -3.392572705239456e-01   -2.534063365111274e-01   -4.061323687611887e-01   -7.077013343869178e-01   -9.847759180013210e-02   -9.680627013409947e-02   +7.357558264257859e-02   -1.903523438993193e-01   +2.509485871416979e-01   +1.396106357785055e-02; -2.047875379643289e-01   +4.209099235581025e-01   -6.053757172748739e-01   -2.640628728505455e-01   -7.044877171713998e-02   -8.019854934977517e-01   +5.189051759510150e-01   -1.028951108584038e-01   +1.645805630343695e-02   +5.978543013116536e-02   -2.713254150719425e-01   +4.195845843180525e-01   -5.535884568632343e-01   +1.274918263682386e-01   +7.354662488491173e-01   -5.580958463237788e-01; +1.530276948316557e-01   +4.050395510430876e-01   +1.079440792211090e-01   -5.753528532521345e-01   +1.234386335346798e-01   +2.602644651269485e-01   +2.941071981961472e-01   +2.359629135498986e-01   +6.281609798104876e-01   +2.360922261198865e-01   +2.260207044962704e-01   +3.027615201334943e-01   +9.261821048029920e-02   -1.113314001210022e-03   +2.010859776143991e-01   +5.695020376509725e-02; +1.110174257904035e-01   -2.487913857570647e-01   +1.982762752823184e-01   +1.759951035103837e-01   -1.854604416356639e-01   -6.499143630614679e-01   -4.270913013478441e-01   +5.793709217852635e-01   -5.714302843742277e-01   +4.225534726411220e-01   -3.481406810793806e-02   +4.730344482270053e-02   +3.033384203691464e-01   -5.586787943290901e-01   +3.185841822578959e-02   +3.530504084487154e-01; -3.673627003477969e-01   -1.941868762433722e-01   +6.015544547284618e-02   +2.136901059081027e-01   -4.760101640956761e-01   -1.559772462759168e-01   +4.362523974087754e-01   +2.021250982720723e-01   -3.677938603301948e-01   -5.165632142033522e-01   +7.262831536904887e-01   +4.399641818902156e-02   +3.319394040673689e-01   +3.065756819455858e-01   +3.216060797613757e-01   +5.004562237879221e-01; +7.354215932896584e-01   -3.099334036041873e-01   -4.400648249298792e-01   +4.780373596239713e-01   +1.446279960530992e-02   +3.200231003761422e-01   +1.517783006732271e-01   -6.230945110247847e-02   -2.675307597888347e-01   +1.551157323457493e-01   -2.218774891774994e-01   -1.877728665184131e-01   -1.857400431161139e-01   +4.064491473065152e-01   +2.859753066533380e-01   -8.405254265352720e-02; -4.321145863480617e-01   +1.007764417529049e-01   +2.391341541958795e-01   +2.961513266776470e-01   -1.154888781880784e-01   -1.365240259392783e-01   +5.503885719365416e-01   -6.441228716206487e-01   -6.729960754529005e-01   +2.933699777664712e-01   -1.001957676876893e-01   -2.910990199376093e-01   -4.291512649245898e-01   +6.496270461613169e-01   -7.843100938422892e-02   -5.683212641289332e-01; +6.197905194408214e-02   +3.497736600853185e-01   -3.420248501778210e-01   -1.296918684372288e-01   -4.384490323515391e-01   +5.047761024879942e-01   +9.199892024867032e-02   -2.106747547319170e-01   +4.077965022723170e-01   -1.524944266449949e-01   +4.135165997084324e-01   +6.400144356323433e-01   +3.728143281910036e-01   +1.035726764239145e-02   -3.636971402198270e-01   -3.275141754323664e-01; -2.274061482117460e-01   -3.872541763407834e-01   -9.267123161321428e-02   -6.272528798972407e-01   +4.007144579083598e-02   -3.126083740421442e-01   +6.027629132991825e-02   +5.776894294240127e-02   -5.297519649563198e-01   +1.170217654211382e-01   -1.454107224998410e-01   -4.144822309179854e-01   +5.486225291244652e-01   +5.736585275603888e-01   +3.689112861718283e-02   +1.203610238172477e-01; +2.010535978108218e-01   +1.677291443163544e-01   -1.550535100069845e-01   -5.688959037584831e-01   -4.179124165657402e-02   -1.594803447886447e-01   -2.808368117943383e-01   -2.632652901809082e-01   -1.132824620433417e-01   +1.325540176538889e-01   +1.865537128305780e-01   +2.331182721776118e-02   -1.861857541305366e-01   -1.864038603455880e-01   -7.183068854172755e-01   -3.426531959190097e-02; -5.756459480231246e-01   +1.890450258997894e-01   +4.016039599869429e-01   +2.956309470506883e-02   +2.288711242430415e-01   +4.659815523207211e-01   +2.243168047257774e-01   -4.340539596121534e-01   +1.408445786581014e-02   +9.162742924102177e-02   -3.138666928346108e-02   +2.061905144941356e-01   -6.761223294956178e-02   -1.374067819574008e-02   -1.834531225406762e-01   -5.440496615643696e-01; +4.896850114971443e-01   -5.817280933343355e-02   -4.474510497235975e-01   -2.304732379593148e-01   -1.562268753777686e-01   -5.193890658766381e-03   +3.237700248351845e-01   +2.730427034578763e-01   -4.312041027603047e-02   +1.900195585291521e-01   -6.290904755567907e-02   -1.753687064875915e-01   +4.462881429410479e-01   -1.908159134963958e-01   +1.499218416137188e-01   -1.560915624266134e-01; -9.223151214842365e-02   +3.604428100179654e-01   +4.469443398352572e-01   +3.816201752241762e-01   +2.341320439950245e-01   -4.055725953875695e-01   +1.694494012731694e-01   -1.422695402527163e-01   -3.159472319782893e-01   +1.995035118474791e-01   -3.416291700476426e-01   -1.587379751744407e-01   -4.520913723379284e-01   +4.375886231261165e-01   -3.263998450670828e-01   -2.878066139523405e-01];
L2I_L1I_iGABA_netcon = [-4.294774769954883e-01   -3.316639912174846e-01   -3.685832127599487e-01   -2.012413246604474e-01   +5.146511316443272e-01   -4.787874240518520e-01   +6.261924352999981e-02   -4.460265233560666e-01; +2.822298298227638e-01   -2.470811207592331e-01   +2.221788146561723e-01   -1.147804697904614e-01   -5.125067896518003e-01   +2.108053319919175e-01   +3.785055318674200e-01   +4.617603121895644e-01; +4.820316665873720e-02   +6.031235831044153e-01   +3.042056326977157e-01   +7.013494490541480e-01   +2.460928370189025e-01   +1.972856662692123e-01   +1.898847621216161e-01   -3.591448133063614e-01; +8.261786209330257e-02   +2.239891330902083e-02   +3.700407703561387e-01   +6.921576257998174e-02   +5.020704391702413e-01   -1.480915676368709e-01   -1.773399592016935e-01   -5.350497352722318e-01; -3.783302253739309e-01   -6.534509595006428e-02   +1.418229378838805e-01   -6.381949919391580e-02   +8.351292262615156e-02   -3.640324310054057e-01   +1.276410620961209e-01   +8.979255653965532e-02; -7.077726392731173e-03   -8.177601143936812e-01   -4.568097775851612e-01   -2.349092478436038e-03   -9.359256681934407e-02   -1.453088770047382e-01   -1.956724129905542e-01   -3.320524620106086e-01; +2.826244799802204e-01   -5.876970772458499e-01   +8.379829530579201e-02   -1.050301271360910e-01   -1.982414025039313e-01   +3.191252439414916e-02   +4.967604718771760e-01   +1.385348090640785e-01; +1.558600283534672e-01   +2.409504576706493e-02   +6.969421776108394e-01   -3.193553052085524e-01   +2.620984880628546e-01   +2.014974662472740e-02   -6.883611277757026e-02   +6.146860972849930e-02; +7.076435448863784e-02   -5.546640249739244e-02   -3.032833234861469e-01   +1.858253319802153e-01   -4.820726153467789e-02   +4.168748509037755e-01   -7.573173564044661e-02   +2.639843560208399e-02; +4.163967841522232e-01   -8.903875905864581e-02   -1.111315200079551e-01   +9.779348597249937e-03   -2.430968333044894e-01   -6.629288570226098e-02   -2.449540559441703e-01   -7.645614656334251e-03; -2.872946322356986e-01   -6.429974708328574e-01   -1.060999798162236e-01   +9.659592505200931e-03   -1.659176583337111e-01   +1.514988051359028e-01   -3.718960056710112e-01   -1.145867889226802e-01; -2.051636010750924e-01   +3.335410131448185e-02   +1.635374834632172e-02   +5.918037869527028e-02   -3.526688493209504e-01   +8.533629523790612e-02   -8.570583971372631e-02   +2.410068108988593e-01; +3.684499230102775e-01   -4.745764592196396e-02   -6.686283945232704e-01   -1.923976979126965e-01   -1.552083925897784e-01   +1.897385913550454e-01   -3.732117018495970e-01   -4.626890067197378e-01; -3.007822711315666e-01   +4.461644167416586e-01   -9.743410991711177e-02   +6.772215455081951e-02   +3.692257354224713e-01   -5.520490820376309e-01   +9.971073681201437e-02   -3.287471377342220e-02; +4.014984183149575e-04   +2.810121716409761e-01   -6.160851563860681e-02   +1.696873674129871e-01   +1.166245550543332e-01   -2.704061347628845e-01   +3.525652337817506e-02   -5.651374376955749e-01; -4.497399698288158e-01   -4.605363319819953e-01   -1.448901569867822e-02   -7.070186109353907e-03   -2.040908428395346e-01   -2.581589464095201e-01   -7.545657865515873e-02   +4.493955711186536e-01];
L1I_L2I_iGABA_netcon = [-1.547856978376003e-01   -2.917871884139654e-01   -6.694437331225151e-01   -6.276354365405376e-01   -1.528341809067512e-01   -8.827364741393230e-02   +3.932957728946737e-01   -3.660330125104109e-01   -2.414121418673238e-01   +4.623063981086368e-01   +1.645418779632700e-01   -5.116120228508829e-01   +1.030989299678256e-01   +4.488831287792444e-01   +3.186342733371845e-01   +1.208398023238132e-01; +1.079549597740697e-01   +1.003377548746825e-03   +6.885069150314264e-01   -1.089575007983837e-01   +3.568053037504270e-01   +1.510732228832786e-01   -4.089660988129293e-01   +2.254858670397011e-01   -8.227960364784719e-01   +5.907267382977255e-03   +6.564222172236959e-01   -4.104172895578696e-01   -3.789059686433384e-01   +4.821696008601303e-02   -2.786858549196025e-01   -9.210657142453459e-02; -2.387657052442416e-01   +7.972010447343826e-01   -2.046497760030332e-01   +7.474370382222384e-01   +2.661783252610818e-01   +5.094359081857427e-01   -1.152744474316987e-01   -8.822891632081276e-01   -4.871428279292392e-01   +2.962382575039492e-01   +6.900773811290645e-01   -1.727694135009216e-01   -2.625582462324816e-02   +5.030114670745640e-01   -3.256024812923503e-01   +4.542274874489606e-01; +2.735985527826043e-02   -3.439813221423493e-01   +1.370846772258417e-01   +7.682736498961501e-02   +1.450213134319953e-01   +1.413351430992251e-01   -1.829118661664480e-01   -2.560153752029636e-01   +4.567570441044127e-01   -3.920664293861004e-02   +6.621230428141167e-02   -2.933202028181500e-01   +6.588039561091394e-01   -4.095385103208694e-01   +3.871525477175755e-01   +5.768129363532648e-01; -3.474007117177869e-01   +7.916945989496689e-01   +4.406315698668356e-02   -4.274740500233828e-01   +4.984793335008323e-01   -6.792145361876346e-01   +2.234961363828354e-01   +1.660578455022956e-01   -3.111907710220382e-01   -4.921997144363036e-02   -1.401544056951613e-01   +4.949412954206949e-01   +1.984779504614008e-01   +4.004990288262993e-01   +3.794230567599251e-01   -1.051322373404898e-01; +3.559901422441633e-01   +2.071388428044221e-01   -4.552383709089045e-01   +1.537840806211987e-01   -3.639225456596778e-01   -2.436110253367740e-01   -2.506787731356930e-02   -3.539680699765933e-02   +3.626785074859666e-01   -2.305740916335420e-01   -3.265500665166936e-01   +4.375209319724062e-01   +6.500485219949111e-01   +2.301441316515430e-01   -4.113300160572005e-01   -1.709828595132492e-01; -4.437382906839035e-01   +8.462235239097174e-01   -5.384656848371207e-02   +1.003808604559977e-01   -4.546666252863290e-01   +2.886097366337606e-01   +3.390396538442787e-03   -4.223213242977608e-01   +1.041346321732173e-01   +7.621532375530492e-01   -2.403527490681411e-01   +2.636122429346405e-01   +4.522318880477763e-01   +1.668644772293718e-01   +2.714365038246692e-01   +2.669216950383907e-02; +2.517752655236375e-01   -1.525183862584473e-01   -3.366274658183242e-01   -2.390505097139751e-01   +5.266143893172613e-02   -3.054547203119742e-02   +7.212233892091258e-02   -9.993783037826148e-02   +4.225420242004546e-01   +2.543882390328255e-01   +3.594991518113357e-01   -4.019843173984254e-01   +6.889322730009473e-02   -2.266711396949910e-01   +8.488630695140923e-01   -5.709630217988276e-02];
L2E_L1E_iAMPA_netcon = [+4.344364022416324e-02   -2.465107492209040e-01   +1.275736386206587e-01   -3.541817493785371e-01   +3.044674806790568e-01   -3.907492222485011e-01   +3.405378362100004e-01   +7.166902864157865e-01; -4.272821138239942e-01   -7.087021091556424e-02   +4.120388761889947e-01   +3.066632989456914e-01   -5.411862414109930e-02   +3.090370763996725e-01   +1.401695639084000e-02   +2.876081782381193e-01; +3.104117382483445e-01   +2.468137422730115e-01   -1.695820920540998e-01   +3.284263021113736e-01   -3.954945718293627e-01   -3.262986247707069e-01   -2.580133769129260e-01   -2.989395764847481e-01; +5.597906165525957e-01   -4.012381279629427e-01   -3.173852690402640e-01   +2.967375766625938e-01   +2.675960168497577e-01   +2.569261683895575e-01   +3.491275893235349e-01   -4.134402751895712e-01; +3.437862031313726e-01   +8.863683800372441e-02   +1.508732542851860e-01   -3.936247461383649e-01   -8.743172704484603e-02   +4.799350178024336e-01   +4.339657972494668e-02   -1.044509700728108e-01; +5.623669382573917e-01   -4.424835970962443e-02   -8.313271962723184e-02   -1.671596576179827e-01   -3.642992515070579e-01   +4.399191017057116e-02   +4.316199718408208e-02   +6.037714534942799e-01; -3.298088803276498e-01   -2.271983689509038e-01   -2.137210819067265e-01   +1.116923223874322e-01   +1.896615441029535e-01   +2.104362246944580e-01   -3.187517244577434e-01   -3.784845334028507e-01; +7.165194600749509e-01   +5.054672385813519e-01   -2.689968293555773e-01   -1.621960580597369e-01   +2.860944457785634e-01   -7.166231786119814e-01   -2.636833306410510e-01   +1.494609409803753e-01; +7.428989943127475e-01   -4.194201008967652e-01   +4.781383530455752e-01   -6.725206850812883e-02   +4.015676953131447e-01   +2.511881551502106e-01   +3.795783659877425e-01   -1.127155537055454e-01; -3.852111665256406e-01   -2.715872784856595e-02   -3.170244429119733e-01   +5.689714541617639e-01   +1.417465339308484e-01   +1.367003975385714e-01   -3.694315687744643e-03   -4.210749292363256e-01; +1.870754669314503e-02   +7.640125522106503e-02   -5.653665702094315e-01   +9.802877436345503e-03   -4.125717584398166e-01   -5.294986362466888e-01   +2.919682159035016e-01   -2.554412673903646e-01; -6.618156799515890e-02   +4.824220052838758e-01   +1.094875020637130e-01   -7.105836338589802e-01   -4.252342852961574e-01   -4.649447972861802e-01   -2.339503539312627e-01   -6.852844249432796e-01; -4.714621326889883e-01   +3.011253084776361e-01   +4.988595273722995e-01   -3.927778335700620e-01   -3.556269447510801e-01   +3.057170034947932e-01   -3.147439076852004e-01   +6.199269771350223e-02; -3.332904951924358e-01   +5.832654234739099e-01   -1.405767854137995e-01   -6.773869537333780e-03   -1.791476149637180e-01   +1.643501712558846e-01   +3.795590407882791e-01   -3.975226244982021e-02; +3.222467105131249e-01   +4.057129393586878e-03   +3.365939339873738e-01   -1.378597750195988e-01   +1.967603146859641e-01   -5.252258798133492e-01   +5.698574022002469e-02   +9.896840547179146e-02; +5.031975819606485e-01   +2.162310292928399e-01   -5.968681344276614e-02   -6.743785299108018e-03   +5.078385839951336e-01   -1.975323551969414e-01   +3.670529616160796e-01   +2.558516810171079e-01];
L1E_L2E_iAMPA_netcon = [+6.156063230683573e-03   +8.971411377800850e-02   +5.752474239496898e-01   -1.919708817930801e-01   -1.225179871976154e-01   +9.391459530252472e-03   -4.379998074903799e-02   -3.757911482213862e-01   +2.250978508693249e-01   +6.054742889853462e-01   +9.235842202121589e-02   -2.548867160405229e-01   -7.031057310858890e-02   -4.880276398586706e-01   +2.528663863904081e-01   -1.338275963952600e-01; -7.054524799885645e-01   +1.362698577180796e-01   -1.524287926190849e-01   -5.316889100886333e-01   +1.315951150787297e-01   +6.041302919415944e-01   -5.101946319228616e-01   +1.755448482884763e-01   +3.627134357861441e-01   +5.180385053407308e-01   +2.898857640642147e-01   -2.918905049326427e-01   +3.006424410496764e-02   +2.724289258771792e-01   -1.787771824416950e-01   -9.570682451932462e-01; -3.724841413136168e-02   -6.973130589603388e-03   -7.350690421758883e-01   -4.693577627742216e-01   +5.306738796733940e-01   -4.168223412862625e-01   +1.837913468919826e-01   -8.073191096930819e-02   +6.500459977025197e-03   -1.335949456574733e-01   -3.106543845270846e-01   -1.929930987434081e-01   -1.043070868456219e-01   +5.124433502064702e-01   -7.670731340498145e-01   +2.608912435746189e-01; -1.250279457476205e-01   +4.800897963294498e-01   +6.334088845666321e-01   -1.145818199198516e-01   -2.009771098369079e-01   +4.219800972105091e-01   +4.381617591539044e-01   -3.996228625191672e-01   -1.284473849130794e-01   +4.152066317582785e-01   +3.714568303331105e-03   -6.051846076572881e-01   +6.934180912497356e-01   -1.578734073148575e-01   -5.478716062756189e-01   +2.260901269170052e-01; -2.420140672466679e-01   +1.039382684558341e-01   +5.976617297335201e-01   -1.995066848046870e-01   +4.478626020205730e-01   -2.660867982458880e-01   +4.125563858778655e-01   -3.649743779581634e-01   +1.323802318821289e-01   -5.108810512442541e-01   +2.235906724633317e-01   -2.916237398399993e-01   +1.978731149757884e-01   -4.700693506367805e-01   +1.349231288183121e-01   -2.850116446249117e-01; +3.570530701104667e-02   +3.227535250257948e-01   -9.662431852002402e-02   -4.620434892328260e-01   +1.399909592566515e-01   -1.392847894713166e-01   +7.701288538842971e-03   +1.185183885287001e-01   +2.384669219606859e-01   -3.359240687176032e-01   +7.354059302482414e-02   -2.443131231890547e-01   -2.107717836813290e-01   +2.887690811371764e-01   -2.572190103107343e-02   +1.722496943457333e-01; +4.521808006381399e-01   -4.629421570904262e-01   +8.948961295950937e-01   +5.256568623073163e-01   -6.748089980441543e-02   +9.200687213440145e-02   -2.038284325574090e-01   -2.172333537482912e-01   -2.618295425036504e-01   -3.559899682695487e-01   -2.936743440336240e-01   -3.378134950072532e-01   -3.180696397148190e-01   +7.541498094335456e-01   -1.686151650742515e-01   +1.572578117604915e-01; +7.506557221084370e-02   -1.618782162535535e-01   +5.405420393963982e-01   -1.694652492780794e-01   +3.623661076722440e-01   +5.138557000578583e-01   -2.358391960831940e-01   +1.085038403456420e-01   +6.580988007724234e-01   -2.432718848384482e-01   +1.218552960693689e-02   -2.211604828986352e-01   +1.822661212352548e-01   -5.769974462907934e-01   +2.444172086251201e-01   +4.535017380661758e-01];
L2I_L2E_iAMPA_netcon = [+8.271324998547452e-02   -5.436290845077059e-01   -6.391005421554432e-01   +6.561335258625875e-02   -2.697303080282676e-02   +5.133084998096720e-01   +2.349072725837813e-01   -7.060480247520953e-02; +3.234297371475812e-02   -1.215871035786076e-01   +3.440082537575768e-01   -6.424502031560514e-01   -5.449183795785391e-01   -3.424346627963819e-01   -2.382969597618453e-01   +2.343420058330647e-01; +4.879878101807109e-02   +2.304433874085987e-02   -3.764989160147949e-01   -3.845490020129997e-01   +3.670835634556474e-03   +5.408423320183666e-01   +3.510364523788900e-01   +1.596036476993178e-01; +3.023005672384698e-01   +1.041019171492210e-01   +8.420110759900401e-03   -4.330689036265218e-01   -4.510364529651087e-01   +6.638519674444959e-01   +2.045578938345881e-01   +3.041837620630811e-02; +3.271380950873746e-01   +5.613503804799501e-01   -2.988805685079559e-01   -8.690817758644248e-02   -1.792097477602839e-04   -2.563257458035044e-01   +1.725450242586446e-02   +6.144575695778487e-02; -4.242270268367317e-01   +9.819156722543644e-02   -2.268344546051919e-01   -6.652132625699905e-01   -1.717195325180999e-01   -1.174036368669478e-01   +3.722913110450811e-01   -2.572936973105569e-01; +4.907700186884553e-02   -3.732107740259071e-01   -6.456393114384817e-02   +2.115480322126451e-02   +7.383338452172475e-01   +3.839602258955292e-01   +2.221958059924145e-02   -5.852377007264413e-01; -4.888166810888509e-01   +5.310591796189975e-02   +9.477884058380903e-04   +1.642348372076712e-01   -2.970942967153244e-01   +5.329039441181926e-01   +3.151349422226668e-02   +7.037952121712282e-02];
L2E_L2I_iGABA_netcon = [-2.139505976414679e-01   -7.092740836772640e-01   +4.369769959029272e-02   +7.531669260255667e-01   +1.449314116821005e-01   +5.213275921602116e-02   -8.287557558021131e-01   +8.138646507954486e-02; +4.148823017913352e-01   +3.589129785958409e-01   -1.637328432448752e-01   +5.254262434315510e-01   -4.491760687958584e-01   +2.679026899130179e-01   +2.646040474908333e-01   -7.868492663667856e-02; +1.939991678324899e-01   -1.147150828545079e-01   +1.767175992611039e-01   +3.770476869129245e-01   -5.766259636371091e-01   -4.853373111653239e-01   +4.908999672570231e-01   +2.865515547827776e-01; +7.515367227770431e-02   +1.325288060615680e-01   -2.250896285406637e-02   -5.487969012778582e-01   +2.936816013554465e-01   -8.414949454459325e-02   +9.946834521938309e-02   -5.666455177642127e-01; +2.675880598258236e-01   +2.468815417815544e-01   -9.061624442715921e-02   +1.535188585108404e-01   -6.946042943115686e-02   +2.461387570561568e-01   +4.058304817524708e-01   +1.697384547944766e-01; +2.469197132577903e-01   +4.512078381852325e-01   +7.452905004343174e-02   -5.656603311643130e-01   -3.354299435475307e-01   -5.991995616468224e-03   -2.671349429848994e-01   -5.860015984796527e-01; -3.071579858116719e-01   -2.899906583391585e-01   +2.793911475816516e-01   +7.579218248833408e-01   +4.834621327531461e-01   -8.272499647939317e-02   -1.514767191717548e-01   +4.653029419899608e-02; +3.504897560231817e-01   +6.744114860608891e-02   -3.178856332335292e-01   +5.327172532379891e-01   -1.521320284667874e-02   -4.213392867472616e-01   +1.555277276667697e-01   -1.884178638161649e-03];
L3E_L2E_iAMPA_netcon = [+2.123992105781893e-01   +6.604968037789760e-01   -7.426560551917403e-01   +3.781605316898528e-01   +4.319748547531838e-03   +1.513401904908837e-01   +3.215756604059232e-02   -3.923956836189779e-02   +1.702364887938314e-01   +2.309851774939163e-01   -4.692395100311623e-01   -5.279346515805609e-01; +5.659696799886851e-01   +5.230304293754885e-02   +3.188392011599507e-01   +2.228937562443347e-01   -4.002644281964008e-01   -3.040085447120557e-01   -1.509468108247963e-01   +9.381566684444947e-02   +2.943623695189486e-01   +8.906473185159426e-02   -7.176946469365488e-01   -4.176999970549402e-01; -6.874737381100918e-02   -2.201336892674186e-01   -2.811010408603803e-01   -2.904025028377090e-01   +2.425485508178843e-01   +4.182346983532472e-01   -2.200497501585747e-01   -5.709847194104337e-01   +2.751362053247670e-01   -1.613175062006128e-01   -4.012074871881481e-01   -1.850198957417930e-01; +2.058782067351892e-01   -2.566358505613435e-01   -3.917921094387129e-01   -1.844070032436446e-02   -2.129058360696896e-01   +9.725881632887291e-02   +5.949960452657466e-02   -1.429227624963284e-01   -8.451018794990395e-02   +8.198661054286077e-01   +1.374573441401255e-01   -6.048832699734372e-02; +2.671909190686518e-01   +5.227466186520252e-02   +6.400346413372071e-01   +3.366463503354130e-01   -8.625960619156441e-01   -4.399921317323470e-01   -3.853290510624217e-01   -6.809511044843675e-01   -8.420021137825302e-02   +1.111751248979546e-01   +4.318827297114337e-02   +4.168008457721182e-01; +4.753498677600444e-01   +2.032217090983665e-01   +5.078152479043391e-03   +4.456984446829786e-01   +3.624171045524358e-03   +4.521144234361760e-01   +4.702491714279927e-02   +1.850234250571977e-01   +2.649619444595792e-01   -2.742626403697538e-01   +6.028249811843029e-01   -6.448413392008260e-01; +3.301779648141199e-01   +2.431212336060472e-01   -4.280609292667369e-01   -6.243297472383353e-01   +3.804739962805512e-01   +2.703627011361561e-01   -7.195391328925399e-01   +5.240343096782870e-01   +1.205811136631311e-01   -9.530736812571620e-02   -2.228818920300404e-01   -2.836177411270814e-02; +3.092819712925823e-01   +8.405620283674556e-02   -4.451642316363590e-01   -3.256952025694831e-01   +3.227279610063828e-01   -2.966360384525488e-02   +6.483892291841720e-02   -1.456838346430600e-01   +2.000019329043381e-01   -6.912886359858990e-02   -5.343290928203552e-01   +4.861409782408497e-01];
L3I_L2I_iGABA_netcon = [-1.562865188915418e-01   +3.684754963569824e-01   +8.016110504655829e-01   -5.640352383000873e-01   +5.407010136689671e-01   +2.450985309333636e-01   +3.474813773972522e-01   +1.407027693210385e-01   +9.147794677869728e-02   +7.879062922686278e-02   -5.876226546374155e-02   -1.118609367833751e-02; -6.309416848088452e-01   -2.359521895537532e-01   -1.929332516060498e-01   -8.025865447875169e-02   -1.115573364205436e-01   +3.810441815049082e-03   +4.458678485093568e-01   +1.473332450175795e-01   -4.842954266849342e-01   -2.795397243133676e-01   +2.670770691081894e-01   -6.309295854040468e-02; -1.243310741801700e-01   +2.661864451004759e-01   +6.662519538139331e-01   +4.144626572200991e-01   +1.835393217153290e-01   -2.688960958847563e-01   +1.251191298325429e-01   +2.407341657283444e-01   -2.767375257791590e-01   -1.209816886459919e-01   +6.031140449289814e-01   +6.421026311035990e-01; +9.932774309325017e-02   +9.305000868354485e-02   -1.251537850912592e-01   +4.212993161643036e-01   +1.144326075196979e-01   -1.973729946527700e-01   +3.803716314002680e-01   -1.196314904321481e-02   +1.628991920108888e-01   -6.655525071609122e-01   +2.596635398316133e-01   -6.345791332943563e-01; -1.176515993505365e-01   -2.389271731395049e-01   +1.070222735430396e-01   +9.875384675486487e-04   +4.255851931926048e-01   -4.163146989000855e-01   -2.067458193484361e-01   -3.000801120553794e-01   -4.844182353722321e-01   +3.174058325015360e-02   +3.534187947724575e-02   +3.792288903932928e-02; -1.747164942133625e-01   +2.257304471470143e-01   -4.232298917534718e-01   -2.486093109450802e-01   -6.080942560143078e-01   +2.412003993782669e-01   +1.682145778837957e-01   +1.048814964001993e-01   -6.244514355066870e-01   -3.728106699518529e-01   -4.434250579024605e-01   -2.541161115660063e-01; -3.312237686003598e-01   -2.108969684769831e-01   -4.359368629387080e-01   +1.043675214451210e-01   -2.677186400168886e-01   -5.066600173729630e-01   -2.487726971221912e-01   -3.624120627377668e-01   +4.855098229597943e-02   +1.243733936479719e-01   -1.685252363128124e-01   -1.169142187551312e-01; -3.346190947911907e-01   +1.235534432734682e-01   +3.922870571041813e-01   -6.229989338459194e-02   +4.943641331307921e-01   +1.791506576856411e-01   -1.137698032751523e-01   +1.303643235722816e-01   +3.593525744196818e-01   -8.326912770289119e-02   -4.232665702604081e-02   +1.066187722588703e-01];
L2E_L3E_iAMPA_netcon = [+4.267453706929977e-02   -2.237126718554090e-01   -1.670430118445921e-01   +6.107494540617658e-01   -6.465046136861115e-01   -7.154061188496214e-01   -2.533821121134622e-03   +2.167638590092369e-01; +2.801183728145596e-01   -2.025263376818571e-02   -8.417134267968110e-01   +4.627063167534949e-01   -5.223259535465385e-01   -3.915294710332002e-01   -1.932325935265579e-01   -1.035202613001595e-01; +7.159634475271189e-01   -2.073437971326334e-01   +5.075978769212853e-01   +8.130410142821176e-03   +1.129338886936386e-01   -5.777268868557210e-01   -8.824674880318030e-02   -3.618828980710998e-01; -2.464084087955822e-01   -4.309307448362498e-01   +7.149938102100531e-02   -1.768313289804299e-02   -4.474671308859787e-01   -6.367831533736685e-01   -3.782757023902773e-02   +5.323106908830111e-02; +5.972616339502395e-01   +2.027163939322606e-01   +3.436452396724228e-01   -4.284082052747595e-01   -7.780825328553745e-03   +1.379823431574049e-01   -5.978838600158038e-01   +2.464206797110790e-01; +5.675079315013155e-01   -5.071776355075228e-01   +5.929808237464484e-01   -3.303215249277828e-01   +1.901600747197869e-02   +8.980640153741209e-01   -6.612532408325819e-02   +3.166534280569216e-01; -5.733323863113549e-01   +2.987743719006711e-01   +1.153637985163152e-01   -1.065935486376753e-02   -1.681952592942159e-01   -4.701596843407717e-01   -3.296539436562060e-01   -4.236618926747911e-01; +1.459565554108708e-01   +2.154624091920782e-01   -5.021240155697371e-01   +5.228588361880696e-02   -1.812325713521398e-01   -8.575868794766381e-02   -1.798944649387155e-01   -3.384791351101271e-01; +3.785343867794282e-02   +4.202951766832800e-01   +6.680048586250114e-01   -7.949024671307933e-02   -7.422905764373083e-01   -3.519026882876218e-01   -8.610387154748058e-01   -8.115992455822094e-02; -4.091848645996400e-01   +6.623674566805303e-02   +1.500174896036712e-01   -5.224756331093211e-01   -5.192537192395156e-01   -2.612252048092795e-02   +4.463932070525881e-01   -1.878489272807024e-01; +1.180880039903137e-01   -6.884598811854066e-01   +7.358041771406182e-02   +6.517927620771582e-01   -5.259095823319383e-01   -1.438882632394679e-01   +3.333948983939929e-01   -2.573954337132240e-01; -8.069113128645860e-01   +5.724021123270432e-01   +6.840392370687523e-02   -1.061465793251084e-02   +2.159111401021279e-01   -4.249504263952323e-01   -5.874119058848171e-01   -1.298309156771562e-01];
L2I_L3I_iGABA_netcon = [-3.158394551093822e-01   -4.149284798150865e-01   -3.486877904552689e-01   -2.076952325575080e-01   -6.610054485597191e-01   -8.214603299610347e-02   -2.127396832533193e-01   +7.810032661810842e-02; -3.440040078533002e-02   -5.229064567127563e-02   +5.902398869308269e-01   +8.594383057977097e-01   -1.837900171632523e-01   -4.739430015236771e-01   -2.169747665649646e-01   +1.064634014690942e-01; -6.560698924784868e-02   +8.034186901607339e-01   +2.228701853761075e-01   +2.838111445398772e-02   +3.317418851297349e-01   -9.979957739306614e-03   +4.323091843793208e-01   +2.402496397542129e-01; +6.393173324503413e-01   -1.224763614066026e-01   -1.214913365650412e-01   -4.759379484480838e-03   -1.301120831808805e-02   +2.335091706593205e-01   -1.485827692977156e-01   -2.346046344225988e-01; -2.301460831789266e-01   +9.244372150596263e-02   +7.146751390658973e-01   +4.225858083086339e-01   +2.406376810013303e-02   -1.306263479130967e-01   -2.515437370701301e-01   -6.140605148869370e-01; -5.187535039754737e-01   -5.500794215445746e-02   -1.499361397581169e-01   -2.360583923832338e-01   +2.233987415051497e-01   -7.034687879909146e-01   -1.311358756356049e-01   -3.122593939699172e-01; +5.532146980850314e-01   +4.627445659366075e-01   +4.029613413660892e-01   -5.594710752202517e-02   -8.133305858376647e-02   +2.670720335042537e-01   -4.357828992654470e-01   +6.249503874542912e-01; +8.233169752520852e-01   -5.704884824967373e-01   +7.326041213881207e-02   +5.081209117801474e-02   +1.401625854561396e-01   +1.449746188408524e-01   -3.356366315086282e-02   +1.245263105465764e-01; -2.215074333220765e-02   +3.867483082126079e-01   +1.615011582034629e-01   +4.790488274467742e-01   +3.974144318349236e-01   +1.385091162955874e-01   -8.288451243906619e-02   -1.893166569971697e-01; -2.826096904257578e-01   +1.183877507260489e-01   +1.827920765417758e-01   -7.513939098159981e-01   -5.401005355393388e-01   +2.851666330804494e-01   -2.250317125745480e-02   -2.237769767462488e-01; +5.026909055933462e-01   -2.283197640005269e-01   +2.887750766808710e-01   +1.471441321161401e-01   +3.944321992178099e-01   -4.631451907178265e-01   -2.939385520647655e-01   +2.226372791906969e-01; +4.412575190357877e-02   -1.795708888736002e-01   +3.132476096911342e-01   -2.362009368888064e-01   -2.102678023309934e-01   +1.782484908252656e-01   +7.694791829175813e-01   +2.441359056140541e-01];
L3I_L3E_iAMPA_netcon = [+9.962209781476314e-02   +7.920737008177400e-03   +3.521790318619409e-01   -4.827237041232535e-01   -1.618562600122636e-02   -4.709737342517035e-01   +2.857012796777231e-01   +2.094332735987449e-01   -3.865664354782379e-01   +3.832930195236628e-02   -4.649770473780678e-01   -4.437634220140182e-02; +9.047541448694364e-02   +4.889131681484304e-02   -1.360498037737079e-01   +1.937328570552738e-01   -4.054742566854186e-01   -7.006541987581256e-01   +3.689892894888560e-01   -2.160456761118858e-01   +2.155300627484889e-01   -3.405166518846203e-01   -2.793685899065357e-01   +5.414408377961206e-02; +2.327905982230538e-01   +2.342791591952244e-02   -4.784560362372298e-01   -3.866121422021109e-01   -3.251668960149048e-01   +4.344869847114867e-01   +3.237729988253737e-01   +9.605028984873712e-02   -8.996593063927505e-01   -2.457724932517449e-01   -2.044246592349218e-01   -5.136169838635943e-02; +1.784158650257913e-01   -4.164435210347266e-01   +5.104104506140158e-01   +3.511608049830988e-01   -2.838327037967500e-02   +4.965263353042541e-01   +1.320052315795242e-01   -6.448959392515179e-01   -2.540093532386409e-02   +1.138262743545737e-01   -3.698236858138960e-02   +3.324795470634729e-01; -3.078760452577098e-01   +1.596322141687597e-01   +1.615721915435701e-01   +2.153040441599558e-01   -4.966865666824645e-01   +3.508273488324065e-01   -2.302483906083146e-01   +6.892132563495100e-01   +2.901864620949626e-01   -1.201781520179812e-01   +1.218217389598968e-01   -5.473465905466334e-01; +7.378273840964445e-01   -6.717540256257427e-02   +6.949499943629666e-01   -1.357335079860042e-01   +2.372327083126009e-01   +2.476669897739462e-01   +3.296890725839230e-01   -1.753590769230764e-01   +1.299362012579490e-02   -3.752724227704015e-01   +5.030854385934291e-01   -5.286620609011259e-01; +2.215379876536422e-01   +7.082757427737266e-02   -2.857814030070130e-02   +5.381095955881756e-01   +3.674287824207264e-01   -5.648805490523172e-02   +3.765743925257640e-01   -2.195827977736122e-01   +3.443144438870266e-01   +1.478243122237705e-01   -4.540554644046765e-02   +2.088064557729113e-01; -3.444554184319115e-01   +2.300475519710548e-01   -6.660189471732920e-01   -3.637673824349101e-01   +1.890839177365584e-01   -4.193354712772379e-01   +1.039310070683246e-02   -6.285859345671316e-01   +2.051063756875802e-01   +2.716036756967721e-02   +6.213258763280108e-01   +2.003424797841777e-01; +1.632408339235595e-01   +2.938648992333106e-01   +7.453386727373758e-02   -1.250739326012923e-01   +4.344849718118318e-01   -1.318696523449276e-01   +1.003614647326056e-01   -1.804434536843928e-01   -1.396247380729516e-01   -5.142638259784186e-01   +4.051331064169132e-01   +6.880029167648793e-03; -1.807723292646031e-01   -1.524057016534558e-02   -5.341757966459065e-01   +2.584902313390399e-01   -3.341941317413377e-01   +1.288412855460736e-02   -2.074632479078612e-01   +5.516071870917231e-01   -4.667593248072264e-01   -1.192546250646936e-01   +3.161444242278168e-01   +1.662851675239245e-01; +4.414053827872699e-02   -2.296978141757038e-01   -6.923437152479651e-01   +8.027455164799321e-02   -6.082204681139480e-01   -7.392294100670545e-02   +6.309681351425339e-02   +3.346350854929512e-01   +2.911449239584737e-01   -5.521326788996263e-02   +4.690791423116635e-02   -6.964450861442928e-03; +1.212138269687248e-01   +4.496588666278362e-02   -4.423467230146291e-01   +1.431672475186110e-01   +5.776177572956817e-01   +4.559772042333331e-01   -2.473184033026840e-02   +1.754834114015116e-02   +3.906389261941889e-01   +1.421462539048899e-01   -6.155315830644717e-02   -4.480502413801718e-02];
L3E_L3I_iGABA_netcon = [+2.443078878816859e-01   -3.289118198786619e-01   -1.188970923030624e-02   -9.943734306421552e-02   +1.482018698731966e-02   -3.144544898207502e-01   +2.042383112432277e-01   -4.530150605520413e-01   -9.717016116514662e-02   -2.384046474538942e-01   -4.987109894464145e-02   +3.899438856511990e-01; +5.583900057665927e-01   -1.653961157102577e-01   -1.333787353577627e-01   +4.868412432731458e-01   -1.993186810798096e-01   -1.043114347111534e-01   +2.352036040978522e-01   -1.346666966676872e-01   +5.731030995855003e-01   +1.468048417492975e-01   +7.067143350256734e-02   +5.440855027471168e-01; -3.216304142101546e-01   +3.423248235051357e-01   +3.828027921893545e-01   -4.037955995155528e-01   +3.209105819904949e-01   -2.392512327864226e-01   +1.464907099522758e-02   -3.593662210649039e-01   -3.825982451728546e-01   +2.150341612491596e-01   +9.106529210378959e-02   -4.358741333711142e-01; +1.112838971131874e-02   +1.637675726537672e-01   +2.835232155597583e-01   -1.715784834859272e-01   +2.132314053090545e-01   -1.524289303897086e-02   -3.779446035065540e-01   -5.307972203508371e-01   -5.327838343007588e-01   -4.935012673720764e-02   -1.694723395858519e-01   -6.192827654725763e-02; -4.588094654756851e-01   -1.393670631430747e-01   +5.676615121285823e-02   -2.837698647108250e-01   -3.215120451540254e-02   -4.052322951134171e-01   -3.393495395005319e-01   -2.353145933283101e-01   -6.051968541333011e-04   +2.646449176889054e-01   -7.967108116266465e-02   +3.810592184077077e-02; +2.704021270996226e-01   +7.077015007639845e-02   -1.122776477059198e-01   -5.137886656487880e-01   +1.907200993741184e-01   -1.581133891266154e-01   +6.349229066286906e-01   +3.736673840745171e-02   +1.581256370985707e-01   -4.698698408106682e-01   -4.642736435104332e-01   +4.260300502198209e-01; +1.520808760427839e-01   -1.893350330362641e-01   -3.357322979851054e-03   -1.974263948198902e-01   -5.424401356869750e-02   +1.001711903039633e-01   -2.325315066509185e-01   -3.796876721462478e-01   +1.820651713638126e-01   -1.188216853472204e-01   -4.907715521514363e-01   -1.134966690733009e-01; -1.517855381339859e-01   +6.550340621859179e-01   +4.082546939205064e-02   -2.552938987438273e-02   -2.970234762787404e-01   -6.869523085662064e-01   +4.989525574259562e-01   +2.911537933768216e-01   -1.465370466742978e-01   +5.258152604979272e-01   -1.222990449331605e-01   -3.735947419050181e-01; -1.948724610652189e-01   -2.156890662682369e-01   -3.964090886362927e-01   -1.447461316596844e-01   +4.068954117593794e-01   +4.889330971197824e-01   +4.709847266063189e-01   +3.574033909152392e-02   +2.021052205746117e-01   +2.285840692789796e-01   -3.280097791237549e-01   +1.136262743488556e-01; -2.763488920959895e-02   -3.756076168811498e-02   -3.235333833243842e-01   +3.548333367929335e-01   +2.141384481698730e-01   -3.217173077093417e-01   -3.484656459829913e-01   +3.321568795884827e-02   +4.625475211336738e-01   -5.577426295782167e-02   -2.464180080422022e-01   -3.855093965690514e-01; +9.475114556575982e-01   -6.040506680141592e-01   -3.192857586436174e-01   +3.350182495819823e-01   -8.788295421704231e-02   -1.391298780846800e-01   -3.863612827879916e-01   +3.642437222357674e-01   +5.646332343536670e-01   -1.100937337963959e-01   +6.484106730810194e-03   +1.993287932312278e-01; +2.681910579379320e-01   -4.712571115273188e-01   +1.784546173538403e-01   -1.451383993612894e-01   -3.410748547279616e-01   +1.602080406187395e-01   +7.162379690135476e-02   +1.006244262329731e-01   +1.685580343941066e-01   -1.053100285870147e-01   -3.904724492975925e-01   +3.648468268974435e-01];
L2E_Input1_iAMPA_netcon = [+4.854120247290131e-01   -3.960279930306924e-02   -1.133374383945401e-01   -8.711092542974952e-02   -1.299716057558354e-01   +2.715445108169349e-01   -4.748244685840489e-01   +7.563286239811500e-01];
L2I_Input2_iAMPA_netcon = [-4.168058886458624e-01   +1.521635708056802e-01   +5.407407670447729e-02   +5.181364949303686e-01   -3.161981626781807e-01   +2.038623153293340e-01   +1.849067438742979e-01   +6.107713986516401e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.4*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 1.0*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 1.0*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.4*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 1.0*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 1.0*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
