function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-5.427476320501435e-01   +5.357159075953216e-01   -3.595836228187113e-01   -6.227480123720486e-01   -2.483764221964365e-01   +1.282319442339055e-01   +1.274561535976818e-01   -6.921914091733258e-02   -3.217813606088597e-01   +2.726897343233003e-02   -7.751197059034399e-01   -4.152712310960099e-01   +9.600681463698824e-02   -2.098582131460261e-01   +5.463671541372306e-01   -1.372603133331853e-01; +2.006147043551292e-01   +5.034780382483531e-01   -1.922516906675661e-01   +6.448700722282780e-01   -6.421286202413314e-01   -4.940387311509964e-01   +6.601211201648722e-01   -5.819542333136989e-01   +2.403718006870587e-02   +3.636208933850386e-01   +5.532175997386566e-01   -1.292979674022653e-01   -1.262294805059588e-01   +4.474460166229242e-01   +6.716508059956758e-02   +7.393247061166700e-01; +3.723542996140428e-01   +8.486934493591818e-02   +3.109080530858391e-01   +3.256701620334999e-01   -7.701089131665483e-01   +3.015078974085729e-01   -8.208532831300180e-02   -7.875865792360535e-01   +1.250124095562591e-01   -7.381879842334511e-01   -9.433819835003787e-02   +2.256394789812290e-01   -1.525395385311610e-01   -3.322372699359846e-01   +1.286824543493422e-01   -4.603938325482366e-01; +1.588707982253131e-01   +5.588757320655270e-01   -4.175098587294945e-02   +1.392719420590792e-01   +1.118604801420019e-01   -6.200508156749814e-02   -4.065767746302923e-01   +4.121703664974566e-02   -9.267548821598459e-02   +7.241029307561240e-01   +2.919345438617144e-01   +1.979433903059615e-02   -9.057537063844020e-01   +1.911419667613223e-01   -6.478039270153248e-02   -7.601101694491819e-01; +3.104166243579821e-01   -1.999535219819911e-01   +2.145507897848925e-01   +7.053887105579314e-01   -1.283104445345255e-01   -8.925785333287773e-01   +1.124555016892377e-01   +1.908929975148607e-01   -5.540234257545592e-01   +9.808812894162339e-02   -4.529652453326704e-01   -1.935440954326147e-01   +3.508217758146988e-01   +7.993477304078990e-01   -3.507070186518408e-01   -2.607748185145990e-01; -2.530223204086084e-01   -1.880357900435757e-01   +1.384989443463755e-01   -2.580547987227509e-01   -3.723399417851337e-01   +2.638400463995116e-01   +3.691322680033395e-01   +2.566595768449399e-01   -6.772580885158525e-01   +8.050714885215667e-01   -7.672136875183586e-01   -4.126886515124107e-01   +1.612146793768407e-01   +1.000000000000000e+00   +7.645537260480499e-01   -8.928777404320637e-02; -4.255094998195526e-01   -4.004467713190637e-01   -8.944413697345917e-02   +7.410235434935471e-02   -6.335196584827949e-01   -6.154403035345329e-01   +6.639631538945300e-01   -4.362314164566200e-01   -2.377639197310462e-01   -3.775913866612958e-01   -8.460109457807161e-01   +2.939403766545378e-02   +1.523478199812590e-01   -3.032562007593703e-01   +3.295700406074770e-01   +6.809485421714363e-01; -8.187871762833900e-01   -1.817474329221262e-01   -4.213081369744784e-01   +3.642368529119617e-01   -7.395705086559268e-01   +2.268681362059014e-01   +3.297794931196730e-01   +6.106951174049901e-01   +1.324486442836726e-01   +9.910868433277239e-01   +1.873688850511841e-01   -4.838603032451024e-01   -8.817715488978277e-02   -3.537139320768183e-01   -1.629909786071535e-01   -2.838015181320696e-01; +4.979027998488370e-02   -2.919882830709334e-01   -3.007210240557988e-01   -3.357670150563202e-04   -3.656177104285649e-01   -2.378925048265960e-01   +4.234004368177998e-01   -1.117450974514607e-01   +3.606139785609960e-01   +8.629672702395950e-01   +3.608190901417170e-01   -8.138029223063512e-02   -2.018232250289555e-01   +8.216294996162740e-01   +6.682952442694813e-01   -5.521982746597022e-01; +4.888837974113918e-01   +3.539948390297711e-01   -1.947410681649113e-01   -2.319100287677470e-01   -4.511858922639529e-01   +3.955600556668048e-01   +2.280522738459054e-01   +4.634549725969576e-01   -5.189460908976906e-01   -1.314667778115095e-01   +5.411164822199824e-01   -9.164333857798027e-01   -1.627579306547816e-01   +1.333283487045187e-01   -1.971094043544652e-01   -7.671418662300741e-01; +4.534473063106071e-01   -5.806018106067243e-01   -4.429645067303345e-01   -8.460553598041551e-01   -4.374732206775307e-02   -6.227875284275803e-01   +4.030593674648461e-01   -4.429351537641305e-01   -2.416312543335914e-01   +1.448700776406039e-01   +3.417439329307884e-01   +2.857209235044739e-01   -4.231835051537414e-01   -2.347687032421048e-01   +1.295199121713749e-01   -3.583534888804513e-02; -7.313146733040783e-01   -5.955543050265091e-01   +4.448186267301270e-01   +6.690939198309476e-01   +1.075797500483630e-01   +4.316540223049988e-02   -2.413063317186840e-01   -3.789179430464697e-02   +1.510605389444882e-01   +4.139655934130903e-01   +7.756995402612608e-02   -4.527900408917465e-01   -5.634607693098576e-01   -2.971738811157151e-01   +2.174125553250246e-01   -6.614097787351475e-01; +7.255379243195210e-01   +5.882584376298774e-01   -6.279455743110516e-01   -7.143600913533367e-01   -9.217447208899185e-01   -3.856078172714303e-01   +5.534007248103289e-01   -7.754293697421188e-01   -3.961618574170174e-01   +4.318980951094135e-01   -7.850458047834169e-01   +2.692040674521553e-01   +2.716980695648442e-01   +4.613707650162127e-01   +1.804130993356929e-01   +5.782595070622147e-01; +3.515053715746610e-01   +1.791932104675492e-01   +1.132252524287488e-01   -5.581753168683651e-01   +5.183060860834424e-01   -6.207564619763831e-01   -2.451886298767039e-01   +7.817604989052829e-01   -1.625260094358971e-01   -2.924085649574278e-01   -8.199053815948250e-01   -4.428351729673912e-01   -7.822138485587810e-01   +3.056728906391842e-01   +7.128348153148044e-01   +4.933347889993029e-01; -7.733272196394315e-02   +8.158989241642547e-01   +6.992500317440794e-01   +4.810405512465686e-01   -1.731972268304191e-01   -2.451580697866594e-01   -5.488885340861833e-01   -3.130960940372511e-01   -4.172698592790640e-01   +2.694839530452635e-01   +1.828634899717991e-01   -3.320021835075743e-02   +5.577411701398757e-01   +2.359913432979546e-01   +3.316106802175750e-01   -4.272998357548006e-01; -7.000086830873709e-01   +5.382678430261858e-01   +9.324771649665049e-01   +5.445818195819692e-01   +6.493872488251526e-01   +4.331867212175446e-01   -2.287821178357593e-01   -3.692164867003433e-02   -1.083771396726064e-01   +3.054535266292339e-01   +4.898021777892991e-01   -5.314302318120034e-02   +2.587250709934428e-01   +3.017873822453470e-01   -1.637131366820497e-01   -4.130829916940946e-01];
L1E_L1I_iGABA_netcon = [-7.113469443836549e-01   -3.207078628321068e-01   +4.111975729596256e-01   +2.629273429719343e-01   +2.580986530439505e-01   -4.656670262424867e-01   +1.885690997337202e-02   +2.648658246590049e-02   -7.228474288073987e-01   -2.320541106311083e-01   +2.183410881305537e-01   +7.050852885218560e-01   -2.261013243733952e-01   -7.446281287626915e-01   -5.780405446249334e-01   +7.393898072716836e-01; +6.581497903461544e-01   +3.863602796275372e-01   -8.205828875997703e-02   +4.872544165124634e-01   -2.963554393307498e-01   -8.323269777086705e-01   +2.779122241542200e-01   +4.718406260172318e-04   +2.614992500024249e-01   +6.818414579214016e-01   +3.616854019726238e-01   +2.635463380287128e-01   +2.819348433086016e-01   +3.130334400139941e-01   +3.336117298855513e-01   +5.390566002996022e-01; -7.153284565199078e-01   +1.356991570931546e-01   +2.330741911479294e-01   -8.193471202802100e-01   +9.647843703164555e-01   +2.143527419114531e-01   +9.823920699846947e-01   +4.745167421217861e-01   +5.936082668233384e-01   -5.898247014845033e-01   -4.986071040615629e-01   -4.628150282360842e-02   -4.214750378825750e-01   -6.539251095696025e-01   +5.203415756016748e-01   +1.843177710696905e-02; +6.734462446119711e-01   -5.870536337922406e-01   -4.209482218190178e-01   -6.992155460706433e-01   -4.303287576403810e-01   -3.333870314453256e-01   -4.153434851047293e-01   +8.667539603614722e-01   +4.185023045608949e-01   -1.958483747947808e-01   +7.560055481062945e-02   +6.922391316236080e-01   -4.544630270099276e-01   +6.187091306019319e-02   -7.695502599213619e-01   -7.732821577363339e-01; +1.312915034067623e-01   -5.648253552890939e-01   -2.622452487859948e-01   +9.132450793346288e-01   -5.816311955219361e-01   -7.908820035968257e-02   +3.918187635009659e-01   -3.014525246516382e-01   -6.648553913662509e-01   -3.068872628995446e-01   +5.333015694655082e-02   -2.952945198347018e-01   +7.305776413162636e-01   -6.000122976247748e-01   -6.440156829061670e-01   -4.652656592649317e-01; -5.273064485526237e-01   +3.006748266471158e-01   +2.334180196857644e-02   -4.617255411502523e-01   -3.113850538175375e-01   +4.771406527186551e-01   -2.372597517490541e-01   +3.929955989547771e-01   -3.415715997149647e-01   -3.558311351465623e-01   +4.927383991767079e-01   -2.518795912117068e-01   +3.198363366101892e-01   +8.875639571216204e-01   +1.476977702507070e-02   -2.460290440146442e-02; +4.302694971059504e-01   -3.236522069657545e-01   -4.229721671201805e-01   -9.091739536171692e-01   -2.337028762760832e-01   -3.994654067200212e-01   -1.768452086734210e-01   -1.824505934121388e-01   +9.194398885434092e-02   +3.238878749040797e-01   -1.005322250882174e-01   +4.451763119653100e-01   +8.729418828703793e-01   +6.569648788636877e-01   +5.326937827029741e-01   +2.737699527340065e-01; +1.601509087759242e-01   +5.457283240772118e-01   +6.028852681291619e-01   -3.722258867432715e-01   -8.158596942595183e-01   +2.784065120886847e-01   -3.128447236453619e-01   +3.501277786623484e-04   +5.606507019589388e-01   +8.236519524421353e-01   -8.544557908847911e-01   +2.137272300824813e-01   +2.484097257041884e-01   -3.305857885155108e-01   -4.572631160851107e-02   +2.769655116245924e-01; +6.512737622236908e-01   -4.534908467456601e-01   -3.304493338794415e-01   -8.372821973028730e-01   -4.049423738937524e-01   +4.339552247837977e-01   +3.575403463197076e-01   +4.874341468457737e-01   +1.034566246606477e-01   +1.667056226821010e-01   -1.850646531264853e-01   +7.247140660215641e-01   +1.801760643036251e-01   -4.718288846251532e-01   +7.803404494060305e-01   -1.506422905829831e-01; +5.009868752881197e-01   -7.108581843544005e-02   +9.199397276975629e-01   +5.118492857197787e-01   +5.409351827426649e-01   +6.549228076788968e-01   -4.552667452805863e-01   -2.253472112704484e-01   +7.955540658336657e-01   -5.174824464711325e-01   -4.593497350733031e-01   +2.342473472033145e-01   -1.540884712221539e-01   +4.365322147921972e-01   -1.930603336207563e-02   +7.163132971957449e-01; -3.598376644480305e-01   +8.301709973249538e-01   -3.176470838607057e-01   +5.453354384363956e-01   -3.487731583068473e-01   +2.044773302928396e-02   +8.127304849781755e-01   +6.338109895724394e-01   +1.043302678866412e-01   +8.247884690609733e-01   +3.072772832946707e-01   -5.372577579754421e-01   +3.997724426778994e-01   +3.470632891896588e-01   +5.930728229865485e-01   -8.051696751415049e-01; +1.768992471375758e-01   -3.554623516724282e-01   -9.002541830536904e-01   +3.842845406391679e-01   -7.916892447232513e-01   +2.407787591132250e-01   -1.265700757834226e-01   +4.637129752046024e-01   -4.392043318204475e-01   -6.179136472090035e-01   -6.519537076557234e-01   +5.387014397069104e-01   +3.629716973596122e-01   +6.358221881144611e-01   -7.181439310326555e-02   -6.433454475987106e-01; -4.068409022384792e-01   +9.321167747333160e-01   +4.989109155887432e-01   +2.894965929198329e-01   -7.875191849647925e-01   -5.933184513356352e-01   +7.030694493188565e-01   -4.644782481262435e-01   -2.890619061609211e-01   +3.453137003311477e-01   +3.274021688387605e-03   -6.687195038375917e-01   +1.023643027734415e-01   +3.152146487580741e-01   +4.809150588572834e-01   +1.489347939947956e-01; -7.353647731715370e-01   -2.208457807103421e-01   -3.642196871847345e-01   -2.735463117339073e-01   -4.621835085667915e-01   +3.660335575931338e-01   -1.030240128504003e-01   +5.529281309876518e-01   +4.939589639798767e-01   -8.220621499934042e-01   +7.151213059706973e-01   +6.934402925475179e-04   +1.167653051809038e-01   +3.856683529655267e-01   +2.349204607229603e-02   +1.000000000000000e+00; +9.297644514286999e-01   +5.277642352600050e-01   +7.542905338868714e-01   -2.147149396636201e-01   -2.630584494265829e-01   -6.378410428961510e-01   -1.468959062010003e-01   -5.235565744771935e-01   +2.329650866686654e-01   +3.613070222754333e-01   -7.225064247586492e-01   -2.569434043674379e-01   -1.566204443217743e-01   -7.727481092794596e-02   +6.956720246152632e-01   -4.895773035863260e-01; +5.219346100436200e-01   -1.470764214754811e-01   +2.563761406891934e-02   -6.957845605733717e-01   -2.307087428630702e-02   +7.913037709277380e-01   +4.265644935712570e-02   -9.242071166931409e-01   +4.222885805257494e-01   -4.731240265433217e-01   +1.778575545850334e-01   -1.041465948445902e-01   +2.899579600967622e-01   +6.723763492755419e-02   -2.301832988634089e-01   -1.352317806834615e-02];
L2I_L1I_iGABA_netcon = [-3.915911622340607e-01   -6.709098540737970e-01   -2.918365304085021e-01   -9.031044873464931e-01   +2.600384245950463e-01   -2.931106655969530e-01   +8.044012745277805e-02   +3.268517146478425e-01; +9.168636238060314e-01   +4.592961356965804e-01   -1.054012404004169e-01   +3.831680329880729e-01   +3.925065968373218e-01   +7.308787665424787e-01   -4.876883640722592e-01   +5.882555210019138e-01; +5.761312304296755e-01   -9.017831060362648e-01   -6.544946488012542e-01   +3.660556840563394e-01   -5.151359537857809e-01   -8.134636463336625e-01   -8.295558813025041e-01   +7.314917594829682e-01; -6.633331317929920e-01   +5.277815579818528e-01   +1.902414609820069e-01   +4.021162314924719e-01   -3.543483500105126e-01   -2.807204450548993e-02   -2.709987064502155e-01   +4.183140515249477e-01; -3.852739771506999e-01   +2.381957989721362e-01   +5.759206662185054e-01   -3.382090806707075e-01   -2.663651333744177e-01   +5.020543718261548e-01   -5.310618797542224e-01   +1.548177127783297e-01; +3.141011135464883e-01   +2.177333298422680e-01   -4.858783733702590e-01   -6.963655627487068e-01   +1.704846844752884e-01   -2.906633944768782e-01   -7.914033192319090e-01   +7.649580287257983e-01; +8.495792674903296e-01   +3.792982959239267e-01   -1.385732635620542e-01   -5.041101813892401e-01   +3.925779230002798e-01   +5.124883137189072e-01   +2.509919214392163e-01   -7.424150857472455e-01; +2.733499233247925e-01   -3.316741020962701e-01   +1.252784304005583e-01   +5.240832549937264e-01   -2.787250372345240e-01   +3.883404865992579e-01   +6.103855209393637e-01   -1.058230172369355e-01; -6.498811892339040e-01   -7.937191379830334e-01   +4.217984833445404e-01   -3.924002927495550e-01   +9.410056643900293e-01   +1.612130455240283e-01   -1.309327220827380e-01   -7.380588911943115e-01; -4.876782467059100e-01   -2.766778657325720e-01   +5.731388348232977e-01   -2.124763797517701e-01   -5.731893725096104e-01   +7.767188354155264e-01   -5.905432734397764e-01   +5.591859037259442e-01; +3.995033617716331e-01   -3.771609657297213e-01   -3.828553552487479e-02   +2.427802376846367e-01   -4.239071694329803e-01   -4.546074969219597e-01   -1.920018349378289e-01   +1.801453697596826e-01; +6.266398491969760e-01   +4.192448924106255e-01   +6.557832968424606e-01   +5.896180887905852e-01   +4.474836724209251e-01   -3.426649418941617e-01   +5.604691654566737e-01   -1.540688679361154e-01; -7.416267893706030e-01   +3.278569557026916e-01   -5.890787061026918e-01   +1.742787019729176e-01   -4.748872651207088e-01   +6.973915185090974e-01   -1.000000000000000e+00   -5.444869649689110e-01; +7.637970834575074e-02   -3.966977073278035e-01   -1.183738024009819e-01   +6.450620939005062e-01   +5.497433560576670e-02   +4.799703078065876e-02   -2.211949555562703e-01   +1.184089162273017e-01; -4.199745524045144e-01   +9.647225113528128e-02   -5.804294702515215e-01   -6.496690181490875e-01   +6.827457863688876e-01   +2.655524234824141e-01   -4.196931559005960e-01   -7.074493002104656e-01; +7.241397098758839e-01   +6.536779286624201e-01   -4.843570262049887e-01   +6.159797721326487e-01   +4.602519041070469e-01   +2.243611769085274e-01   +2.318083483496371e-01   +4.433591830315692e-01];
L1I_L2I_iGABA_netcon = [+6.272233020847259e-01   -6.663426752660553e-01   -1.340165130336693e-01   -1.546199668019543e-01   +3.270755405937965e-01   +4.452618670424547e-02   +9.868284542171556e-02   +1.137337541670059e-01   +3.862574771679497e-01   +4.570268077768527e-01   -2.956979974008977e-01   -6.301806259085347e-01   +3.890089712611138e-01   -8.971475710197871e-01   +4.401026412524194e-01   -2.943477766978952e-01; -3.084695897826414e-01   +4.554479950598867e-01   -3.430109722756538e-01   -4.808287282868258e-01   +3.293010366108949e-01   +4.785264445752909e-01   +3.774060723664840e-01   +2.178360458464112e-01   -2.899763895794725e-01   +1.613962129903851e-01   -1.335634288942112e-02   +3.274206298429057e-02   +2.338801928774534e-01   -3.950992214563814e-01   -6.564821870988745e-01   -2.758476495378284e-01; -5.470816683088807e-01   +7.441588457888807e-01   -5.935801446292031e-01   -1.198582075707548e-01   +4.904399435770916e-01   +3.598967924699794e-01   -3.683618205271409e-01   -5.694204161004492e-01   +8.539644030303924e-02   +7.557347159029421e-01   +4.475509800532370e-01   -4.019393926075910e-02   +2.175514054702354e-01   +2.652486485289197e-01   +3.369535079351489e-01   -1.019479305600452e-01; -3.223310091471225e-01   -1.401861539875765e-01   +4.251480777024028e-01   -4.566142387137582e-01   +2.310931936320736e-01   +1.605694501470432e-01   +3.724018622583173e-02   -4.368643878283867e-01   -1.274707706419854e-01   -5.265191970730599e-01   +4.862709890202715e-01   +5.964558112943965e-01   +7.175730588519151e-01   -1.000000000000000e+00   +2.110640659758088e-01   -8.129426731343358e-01; +4.942158795943402e-01   +5.479985820731029e-03   +1.700401342309414e-01   +4.981604089277455e-01   -2.336950972500036e-02   +1.824086208453666e-01   +2.350881360928744e-01   -5.796712994671417e-01   -6.912939145584310e-01   -7.453870428041576e-01   -4.552522935192568e-01   +4.583966145223405e-01   +4.057500686881336e-02   -7.811248747997435e-01   +4.552716447380895e-02   +2.333125460559888e-02; +1.116196720778233e-01   +4.657776646110846e-02   +3.294863665054791e-01   +2.274680653310686e-01   +1.028607798598513e-01   +1.772993327043874e-01   +6.603992063888205e-01   -5.174410633148194e-01   -1.287914248784471e-01   +9.476577007121278e-01   +1.377388092594914e-01   +6.380370975352689e-01   -8.264151741320058e-01   -1.787311191575235e-01   -1.096829655337803e-01   -5.118899148202856e-01; +9.184226227476840e-02   +1.396457233387132e-01   +4.665325265363474e-01   -5.281929619328101e-01   +2.996209902214712e-01   +5.598441214421296e-01   -3.271216287665619e-01   +5.896839496628343e-01   -5.895119147176078e-01   +7.607435412806860e-01   +1.161625758004965e-01   +1.846441780031199e-01   -2.026801647669296e-01   +3.581416938819892e-01   +5.416834606568681e-01   +1.335576282258180e-01; -4.385842961133550e-01   -1.766725821363763e-01   +3.108342955362142e-01   -2.967894620274328e-01   +5.669117682744733e-01   -4.378208388797963e-01   -1.293175008476577e-01   +1.808248858762453e-02   +1.331757859322700e-01   +2.988247067018228e-01   -6.908539284157967e-01   +2.235619057933701e-01   +5.064117940751005e-02   +2.595611183192693e-01   +5.718940004359787e-01   -5.387489138240257e-01];
L2E_L1E_iAMPA_netcon = [-8.524435676023365e-01   -3.638608888193741e-01   -2.533985682876260e-01   +5.658168785092115e-01   +2.950825523406492e-01   -5.268563503471875e-01   +2.147984977388912e-01   +6.019180373262304e-01; +2.461137071191442e-01   +6.566375381271796e-01   -4.138308604687375e-01   -1.000000000000000e+00   +1.638707840338061e-01   -2.542730023474584e-02   -7.904230831031496e-01   +5.686752528874595e-01; -3.107076092348878e-01   +7.241961755190564e-01   +3.054411813719994e-01   -1.288687134224129e-01   -1.528574509620241e-02   +4.151008519320670e-01   +9.292799201382279e-01   +3.899894394392374e-01; -5.265603991059132e-02   +2.360524176927395e-01   +2.369111335781928e-01   +3.996757436474885e-01   +6.300377440816224e-01   +1.274536177675699e-02   -2.618086498843427e-01   +6.519621005594180e-02; -2.586869530045724e-01   +2.364268258606228e-01   +5.699369623536253e-01   +2.570946184693222e-01   -1.254042805486343e-01   -3.675700983502743e-01   +4.558860781200065e-01   -1.029592753933370e-01; +1.393917838108860e-01   -6.613655195656810e-01   -1.336115507445980e-01   +4.615375580781922e-01   -1.283038357415879e-01   -1.720207905238337e-01   +5.425403766952640e-01   +1.978031639088162e-01; -3.418434127711765e-01   +3.309321681053624e-01   -3.169311552570801e-01   -3.358743976204888e-01   -2.061969569365125e-01   +6.956836529953936e-01   -4.407200187986239e-01   +1.666721085819862e-01; -2.120211749405824e-01   -6.820994944000441e-02   -2.962496200841285e-01   +4.160072974066022e-01   -3.342390898127696e-01   -4.398815244669027e-01   +4.440577604178701e-01   -1.145450462127198e-01; -2.918980479663546e-01   -3.303524301873622e-02   +5.713677490009290e-01   -5.938573284900840e-01   -2.423788943708200e-01   -1.150181654562706e-01   +3.835683933859858e-01   +2.544685008477355e-03; -1.169243923263557e-01   -3.532074831523619e-01   -9.443966599811842e-01   +2.919684467416653e-01   +5.144772704441205e-01   +2.390544157637855e-01   +1.738754091885825e-01   -2.842206709842510e-01; +9.242071311243644e-02   +4.538689178293850e-01   +2.234135683200116e-01   -2.274281673811322e-01   +5.829661688011258e-01   +2.871398168354160e-01   -3.770428255456361e-01   -6.704504505221963e-01; +7.170393689528007e-01   +3.621877683454766e-01   -3.058809952170794e-01   +5.308838221778726e-01   +3.384263193457351e-01   -3.628318401472808e-01   -2.680945507615329e-01   -4.881038233202172e-01; -7.771298739298977e-01   +1.411948217982246e-01   +5.728418734758521e-01   -7.419564140020098e-01   -3.620654058316550e-01   +6.231704739336746e-01   +4.053856733700549e-01   +3.307397161646304e-01; +6.505176037386190e-01   -2.184541857664408e-01   +4.388592151479288e-01   -7.120932936813926e-01   -4.215177126664231e-01   +1.613628691762634e-01   -3.754467287845070e-01   +6.402156049639494e-01; +5.357599415931110e-01   -6.056876527922496e-01   -5.269733067375063e-01   -1.484692670263394e-01   +5.361783862879607e-01   +3.205655983622631e-01   +2.758345041549440e-01   -4.842327457948380e-01; +1.192107786957320e-01   -5.614374748629199e-02   +8.559105513231323e-01   -8.319278516787797e-01   -3.730896958935138e-01   +1.738828640222733e-01   -2.120023177852640e-01   -4.009875663446830e-01];
L1E_L2E_iAMPA_netcon = [-3.111694040327298e-01   +5.408003151097842e-01   -5.069662515117038e-01   +1.755434658953316e-01   -7.955095659070593e-01   -6.364360751641082e-01   -5.242133747570812e-01   +7.721232683020848e-01   -2.928865709311873e-01   +5.449901132817072e-04   -5.197302890721873e-01   -1.317476353062718e-01   -4.421302972524427e-01   -1.355875078263147e-01   +6.829370256903208e-01   +4.919957539399939e-01; -5.469315631592492e-02   +4.914028075787235e-01   +8.308572653255517e-01   -1.629828070076961e-01   -4.017652292306759e-01   +2.678913448533064e-01   -6.888943473560032e-01   +2.442068844201528e-01   -5.616264676469038e-01   -6.847605852975188e-01   +5.020144062642948e-02   +2.441853935891804e-02   -2.597022973224286e-01   -8.861104818552180e-01   +4.967796572509289e-02   -6.772736305139256e-02; +3.162629766719022e-01   +9.677198890479071e-01   -4.164819088404735e-01   -2.660334516299857e-01   -7.301868554123156e-01   -5.728505782404198e-01   -2.319686542894978e-01   +3.241429733971850e-02   -5.178372261753394e-01   -9.785441765499059e-02   +6.175020124423006e-01   -6.943150216652122e-02   -5.687802203136865e-02   +8.600152511168435e-02   +7.427023945133682e-01   -6.387991119276633e-01; -6.077702961579966e-01   +2.952025618712085e-01   +3.921461591833921e-01   +4.383811357104878e-01   +4.909911721733355e-01   -4.874873809671513e-01   -4.512544456309569e-01   -2.852830853480035e-01   +3.914328116199490e-01   +2.333816240966742e-01   +4.102106959170586e-01   +1.000000000000000e+00   +7.956409710149196e-01   +5.652680260475165e-01   +4.606408399378401e-02   -4.074073538763883e-01; +6.369837610410938e-01   -5.748394282948124e-01   -2.852097035314629e-01   -4.328595390864791e-01   +2.165850045553775e-01   -5.390776593914584e-01   +3.534884280671218e-02   +3.347473875101171e-01   +5.361323957454002e-01   +2.369131603424854e-02   +4.187425389475198e-01   -2.498500469676889e-01   -5.986995344136005e-01   -8.808503632020739e-02   +9.902816244642727e-02   -2.673282120217375e-01; +3.770072205290875e-01   -2.022767294626458e-01   -4.887131605180219e-02   +9.961831594016629e-01   -4.429930681770752e-01   +1.395548533440216e-01   +2.869651766726477e-01   -3.914254528003099e-01   -1.969237794399231e-01   +2.398832526635951e-01   +3.988396024733424e-01   -2.774818003740711e-01   +6.450206918149967e-01   +2.908407883500100e-01   +3.705602312849848e-01   +6.477067196531495e-01; +4.965535903626861e-01   +2.669751623136651e-02   -6.137864594761885e-01   -5.116028987992658e-01   -3.223600448796647e-01   +5.579126427833107e-01   -5.724747910634144e-01   -5.883007115904070e-01   -6.405566673829181e-01   -9.115619436056714e-02   +4.039798846777767e-03   -3.215514309714529e-01   -4.191843871346062e-01   -2.001772593311674e-01   +4.982745541385997e-02   +4.600283644967061e-01; -5.803813484810513e-01   +2.951421100738058e-01   +1.903400914359113e-01   -5.760838049316604e-02   -7.267688556822147e-01   +7.914965161504404e-01   +5.680931673711880e-01   -4.212584428599114e-01   -5.275240926681865e-01   +2.448726419707520e-01   +1.021735366647215e-01   -1.744377226650499e-01   +4.731169508795157e-01   -2.354992902005390e-01   +3.431003389535892e-01   -7.548608164488481e-02];
L2I_L2E_iAMPA_netcon = [+2.590998098604521e-01   -2.346455400507881e-01   -7.259979408368468e-01   +5.741199497850188e-01   -5.558696597013976e-01   -2.625345671106147e-01   -9.272356944771275e-02   +9.525159630839251e-02; +3.018232063361791e-01   +4.090416620896618e-01   -1.000000000000000e+00   +5.661305204395909e-01   -4.256613038335145e-01   +4.697972757729359e-01   +1.444516124308474e-01   +6.218557219317572e-01; +5.633546563906050e-01   -1.664410506209017e-01   -2.249600911603714e-01   -5.449607136747047e-01   +2.253379947390760e-01   -1.649807518694764e-01   +1.073091496699407e-01   -3.961843363018618e-01; +2.982724525842214e-01   +9.100157348884840e-01   -5.912190553970629e-01   -4.376177856507433e-01   -9.033500805455374e-03   -4.035273774363707e-01   +6.879837928701354e-02   +6.443474663537051e-01; +4.870015171742903e-01   +3.027696861558694e-01   -4.224808895154001e-01   +8.919219815918965e-01   +8.105485541025345e-01   -1.022250271740288e-01   +4.915083381494571e-01   -5.673975234931925e-01; -6.463875764438578e-01   +3.569796009984383e-01   +2.759423334586880e-01   -5.970809635797165e-01   -7.603523509866107e-01   +6.976657910860786e-01   +4.411356609824132e-02   -9.440131552906472e-01; +2.011250874879687e-01   -3.915480749525997e-01   +2.358668732278416e-01   +9.118595326167408e-01   -9.022060126717159e-01   +6.756102260117337e-01   +4.849216064138249e-01   +2.002421904516839e-01; +7.610434606100615e-01   -9.044375414170146e-01   -2.277702656327331e-01   +3.134153726690814e-01   -8.645874174750483e-02   -3.244053711399654e-01   -7.826851332222836e-01   -1.163459144824849e-01];
L2E_L2I_iGABA_netcon = [-5.149100971791771e-02   -8.069288055898520e-01   +5.078915793271678e-01   -3.730695144430437e-01   -2.668697574011857e-02   +3.712795005899444e-01   +4.419106655395805e-01   +2.249460777753072e-01; +3.587515557732406e-02   +7.188136390678259e-01   -1.085163102118888e-01   -3.723026667495706e-01   -4.900629542254145e-01   +4.872222682748470e-01   +1.231863948121759e-01   +2.405860448272202e-02; +7.721631352188322e-01   -4.237531461445377e-01   +9.674935090016576e-01   -4.768940573967547e-01   -7.878739479045707e-02   -2.596495763387551e-01   +2.828265073889127e-01   +1.979328604788876e-01; -4.540150433788308e-01   -3.902058788972674e-01   -3.730627073194892e-02   -7.610808020164592e-01   +2.056695491832334e-01   -8.299069258639992e-01   -5.707724941272683e-01   -2.168907301158103e-04; +3.043597817779828e-01   +2.798566000072475e-01   -1.403409389847066e-01   +3.435085851994673e-01   -7.934618495337158e-01   -5.630453220388049e-01   -2.671058816971609e-01   -2.393995505491539e-02; -8.517319776786347e-02   +1.380512670913504e-01   +3.654945316709335e-01   +1.000000000000000e+00   +8.743673138912532e-01   -2.853141318400734e-01   -5.787282626222824e-01   -4.739412171363998e-01; -7.214120299087986e-01   +6.165062874152157e-01   -3.849187560539222e-01   +2.127130192658695e-02   -4.896956227960790e-01   -6.345744987171912e-01   +6.973097224182850e-01   -9.246181705072005e-02; -5.375124634805162e-01   -5.443332807523872e-01   -3.316329011873709e-02   +1.000523433943482e-01   +2.570729648597530e-01   -2.147696328583620e-01   +9.850394375596071e-02   +5.054911196523641e-02];
L3E_L2E_iAMPA_netcon = [-2.925998589325745e-01   +2.724448109686181e-01   +5.996388025669192e-02   +4.498158111688335e-01   -1.647140521885124e-01   -5.367011963291125e-01   -3.895619918132560e-01   +3.200012101511232e-01   -1.036107528289852e-01   +1.984060321450218e-01   -5.843440096779765e-01   +7.851525922752257e-02; +2.771254406077958e-01   +1.033161187556384e-02   +2.819630815884721e-01   -8.964957105100643e-02   +5.023633777829254e-01   -1.042150479945812e-01   -9.909718797893222e-02   -3.030571985963364e-01   +8.543544042184606e-02   -4.067745394895633e-01   +4.833884099729548e-02   -3.723392384383575e-02; +6.504026369829545e-01   -5.090284742989387e-01   -9.729776395856903e-02   -3.412092265380751e-01   +5.506091022582261e-01   -1.329426472664973e-01   +5.542507573018636e-02   +6.628570843639643e-01   -1.684848631217271e-01   +2.154501750284776e-01   +8.734415751192151e-02   -8.002853814889264e-01; +3.153699395237690e-01   -5.699562970410043e-01   -3.899423825948760e-01   +3.751617084389244e-01   -2.573555247713270e-01   -4.129226040887249e-01   -4.396640361558886e-01   +2.525475334427333e-01   -4.549997709284118e-01   -2.076205385039399e-01   -1.915942682688368e-01   -2.745893435832138e-01; -1.130359368249131e-01   +5.537054623625262e-01   +4.048115876041114e-01   -1.336666484908495e-01   -4.567187914988903e-01   +3.753200063643392e-02   +6.949685353004257e-01   +1.555792208810552e-01   -2.583796434656849e-01   -1.865282999634984e-01   -1.625054662453089e-01   -3.483107548754149e-01; +6.738803116821144e-01   +5.765751704203056e-01   -1.040788612017018e-02   -2.189194625921071e-01   +6.074094185498590e-01   +3.049682869312598e-01   -1.580635442102898e-01   -2.777475012008865e-01   +1.255662616515356e-01   -2.842784399121960e-01   +5.506773938932030e-01   -8.171648153558574e-01; -1.392778380230229e-01   -4.087579987674478e-01   +3.810590076704682e-01   -5.977761917640503e-01   +1.114796303897281e-01   -3.401390942471373e-01   +3.059867368804008e-01   -4.864597878916165e-01   +1.004539135072254e-01   -4.858179532269908e-01   +3.174011313464828e-01   +1.000000000000000e+00; +1.319248662506360e-01   +1.806046376975409e-01   +5.774996952612423e-01   -5.578862698538034e-01   -1.149424545965061e-01   +2.856123980785911e-02   +5.189281273443421e-01   +3.836131830561470e-03   -1.553518548239843e-01   -6.113643618961347e-01   -1.382927346538131e-01   +2.874849368147412e-01];
L3I_L2I_iGABA_netcon = [-5.685901662148219e-01   -2.308845881331544e-01   -3.585724918162846e-01   +2.544278835771764e-01   +6.287449275484381e-01   +9.561292615876674e-01   -2.934397844181879e-01   -1.059482331358441e-02   +2.038058452250589e-01   -4.460461903271586e-01   +7.772700373790579e-02   +6.713949404670773e-01; +1.996280011852495e-01   -3.294119166661166e-02   -4.177447693544353e-01   -6.017615471351487e-01   +4.158105911997771e-01   +1.183505042011117e-01   +9.064448628110078e-02   +8.124263136488147e-01   -4.650293885562833e-01   +2.535100222447143e-01   +2.029222025443394e-01   -1.610952707167138e-01; +3.456543361067361e-01   -2.814369549597786e-01   -8.223058937130491e-02   +2.500917814510114e-02   -7.719659091677182e-01   +1.045281898600011e-01   -2.690953209697665e-01   -1.282159994650669e-01   +1.481450059575285e-01   +3.201347121657628e-01   -1.225382386298178e-01   +5.257521466721125e-01; +5.800932171668615e-01   +3.346694689541865e-01   +3.159898329359999e-02   -5.429474263676832e-02   -5.069189055280876e-01   -6.783716537315968e-01   -1.696900580078231e-01   -5.578765735936762e-01   -2.232557820870464e-01   -1.439966873437532e-01   -4.665723251245485e-01   +5.661148820236128e-01; +4.065423572943203e-02   -2.232740876362183e-01   +4.684553329721872e-01   -3.710689296842191e-01   +9.855888562109419e-02   +3.538873114578863e-01   +5.732499829305499e-01   -2.962605913101939e-01   -2.895789672531220e-01   -1.957967644448334e-01   +6.284986070682382e-01   +8.514062812596029e-01; +2.895135589427897e-01   +8.000467627055828e-01   -1.165924822302380e-01   +2.474336246220512e-01   +3.609282674122058e-02   +1.000000000000000e+00   +4.906445595389084e-01   +4.905135786843418e-01   -2.294065453298971e-02   -3.014765171694855e-01   +2.731645968878371e-01   +3.696264650305609e-01; -5.214010893180622e-01   +5.122469189813336e-01   -9.859320628719928e-02   +2.011499762413266e-01   +5.471541639018445e-01   -3.741994008109354e-01   +5.007519846345287e-01   +4.769726699350100e-01   -2.463791853777269e-01   +7.654546209800721e-02   +5.328904937360267e-02   -5.245570374819723e-02; -4.387770865086142e-01   +7.061018113139651e-01   +4.448925495576561e-01   +2.828859599823189e-01   -4.867167451165995e-01   -2.257693385918765e-01   -1.147074249934151e-01   -1.835485265576209e-01   -7.393468539407083e-02   +6.703628115323755e-01   +7.971261268347348e-01   -1.558649682722341e-01];
L2E_L3E_iAMPA_netcon = [+3.263577079873113e-01   +3.503463847931712e-01   -5.817246910545313e-01   +3.728163701280824e-01   +4.318072323334496e-01   +2.544401071693952e-01   +1.896699236705933e-01   +7.526270418965102e-02; +3.812892788870605e-01   +3.865861400139746e-01   +6.049008122301909e-01   -1.105188183373684e-01   -5.828522117470142e-01   +4.468675494879016e-01   +5.671664184758981e-01   +1.474459408711795e-01; +5.451038985505523e-02   -3.308771925018024e-01   -5.803021806941434e-01   +4.537769515079245e-01   +9.880801968419674e-02   -1.650583083562508e-01   +5.007575733849312e-01   -2.739640778064538e-01; +1.660295192067108e-01   +8.097050967821044e-01   +5.470182904081752e-01   +4.908773828121210e-01   -4.917389557023337e-01   +7.188045567405044e-01   +4.466063954411820e-01   +2.083674183051312e-01; +6.895181727913018e-01   +6.469475053824023e-01   -2.586507190665598e-02   -2.601202654890398e-01   +3.431510496634261e-01   -4.887999880164677e-01   +4.289049271923101e-02   -7.699501532048589e-01; +1.561085285345706e-01   -1.463294965404390e-01   +4.712570816174356e-01   +5.348126883110446e-01   +2.050739618901810e-02   -3.456243740662302e-02   +1.108514628111264e-01   -3.273307245678272e-02; +7.066630694492574e-01   +3.217135991277262e-01   +5.672460749672695e-01   -1.701622394958616e-01   +6.304796100969057e-01   +2.748586804970380e-01   -1.083453700807073e-01   -3.530088324921637e-01; +2.684484179616061e-01   +4.086812689666386e-01   -2.068601503306276e-01   -3.819877680229796e-01   +4.044443245646193e-01   -5.114325656677041e-02   -3.707873720232008e-02   +7.149478932412024e-01; +1.000000000000000e+00   +8.651712180113111e-02   +2.716973615783367e-01   -8.829311157485225e-01   -9.895724415592824e-02   -6.495411280015320e-01   -2.536897675931850e-01   -3.337323922738569e-01; +4.430211426099817e-01   -2.781734632516829e-01   -2.592627456396427e-01   +5.939970402361888e-02   +1.109739489774340e-01   +2.059649222137432e-01   -4.454321845451709e-01   +7.916660240362445e-01; +4.319821624488641e-01   +3.520526147775712e-01   +5.950405154015482e-02   -9.443886559051630e-02   +3.301623560109387e-01   -7.245466291052290e-01   -2.620004143358652e-01   -4.572487572448642e-01; -1.034752661855955e-01   +8.292891517687639e-01   +6.431228727805280e-01   +1.539781813431472e-01   +4.108872125160569e-03   +5.013846083540751e-01   +7.111678792334331e-02   -3.107837814669966e-01];
L2I_L3I_iGABA_netcon = [-2.230348133027034e-02   +1.000000000000000e+00   -2.194061402975789e-01   -5.827905961951087e-02   +3.726753855995208e-01   +1.380224963788831e-01   +2.670112960995167e-01   +4.184954410341730e-01; -3.486256185914681e-01   +5.351318934635793e-01   -1.447587432217623e-01   -3.450292460491931e-01   +6.677983151838695e-01   +6.158159251791491e-01   +1.261143438479658e-01   +1.802813627009936e-01; -5.249625146620833e-01   +4.821630148546726e-02   -1.662148698897058e-01   -5.986197478012336e-01   +1.049111944021364e-01   +4.975210527539924e-01   -7.101562909387559e-01   -7.176204600435854e-03; -3.128025440312167e-01   +5.213701216309361e-01   +1.667795472354441e-01   +3.230801517044312e-01   +1.287280725980295e-01   +3.637848081954818e-01   -5.161875383425100e-01   -3.808822424245717e-01; -2.910410567189586e-01   -1.412291839801995e-01   -5.840786001007715e-02   -3.910562374326038e-01   -5.766294058310657e-01   +1.880747281817560e-01   +5.598087292125475e-01   +1.589003784455695e-01; -6.037409193339333e-01   -3.020093873347500e-01   +2.723425469616255e-01   +6.333536906343473e-01   -6.389880724030005e-01   +5.562425902499697e-03   -2.126247603860595e-01   +4.529184578649137e-01; +1.806249985138890e-01   -4.663156576975694e-01   -4.090787997246620e-01   +2.490510123704081e-02   +3.320290415519005e-01   -3.242557054988712e-01   +3.399457688002893e-01   -1.950193261156408e-02; -1.421951733387871e-01   -4.597791048280392e-01   -6.422687335669058e-01   +5.278072154707451e-01   +6.161038222781677e-01   +5.894641186198062e-01   +6.163622488639602e-01   -1.377149202094584e-01; +1.381548151873055e-01   +2.168106559150305e-01   +2.536769540404875e-02   -7.884711681400823e-02   -5.446474999557734e-01   -1.206470888891667e-01   +2.163720191938194e-01   -3.624538772159281e-01; -4.819286926788692e-01   +5.910873743522442e-01   +3.503352812035413e-01   -1.430443354043406e-01   -5.144448468048564e-01   +1.602134568115902e-01   -2.296926174085294e-02   +5.796212759621915e-02; -3.074620049335985e-01   -4.480540864622072e-01   +5.411302899007028e-01   -4.023063744053819e-01   -3.623609232148682e-02   +7.578404260195809e-01   -2.429348817419133e-01   -5.013280496689605e-02; -7.852607394693469e-01   +4.955929143092809e-01   +2.793864989171270e-02   -4.869770094081186e-01   -1.044916664168846e-01   -6.615115530324664e-01   -1.014097536526691e-01   -4.126209711653115e-01];
L3I_L3E_iAMPA_netcon = [+5.276409145322529e-01   +5.046376945285878e-01   +2.253534929271205e-01   -5.293712551729476e-01   +6.844867724783383e-03   +6.363144609972972e-01   +4.147105996468224e-02   +9.724897618317369e-02   -2.154071436595222e-01   +1.763248529227641e-01   -2.226105101383045e-01   -1.456186335003709e-01; -6.917376277690491e-01   -1.397572872680772e-01   -8.319409597711633e-01   -3.242792883500261e-01   -2.065502771490105e-01   -5.143312208442321e-01   +2.200332374888836e-01   +7.922911441936696e-01   -4.357169385659101e-01   +6.552780606684690e-02   -5.081852257652766e-01   +3.200452486565458e-01; +4.947043869091532e-01   -1.527719678521906e-01   +9.924134774255442e-01   +5.207483807914456e-01   -1.245231517072143e-01   -8.783191864295797e-01   -1.003572168118947e-01   +7.023454725800066e-01   +3.828853621152185e-01   +1.216898531139121e-02   -5.173832915798839e-02   +7.685229888579323e-02; +7.982899153776452e-01   -5.216376541991598e-01   +8.423987141430286e-01   -8.898276567704617e-01   +5.179542838707597e-02   +4.134158728364881e-02   -5.714060500186813e-03   +4.070839432967945e-01   -4.230414809539355e-01   -5.200461735970843e-01   +2.672184516388273e-01   +3.437571316150256e-01; -3.584012977498335e-02   -3.433521446350672e-01   -3.654317002788872e-01   +7.142588760730619e-01   +4.212005396898390e-02   +1.271349737489065e-01   -5.925655261781664e-01   -3.692959941537154e-01   +2.661453368317467e-01   +6.148856530996147e-01   +4.689621276940759e-01   -1.682618845596997e-01; +5.936245242643559e-01   -6.739559308617594e-01   -2.027729072229816e-01   -4.713690129404867e-01   -3.015569730711905e-01   -1.673460546129219e-02   +4.651457686618851e-01   +1.098640587606267e-01   -4.734684866341534e-01   +3.956553664965533e-01   -4.101439797946067e-02   +1.570680156214251e-01; +3.606328790867230e-02   +7.711437973125052e-01   +6.136407729015734e-01   -1.102840727778641e-01   +4.227343584919556e-01   -5.609540464608843e-01   -4.454066579183993e-01   +4.786442687757028e-02   -3.795150075785256e-02   +3.676826738482764e-01   +6.941020606259697e-01   +2.538189159412916e-01; -4.629664647052415e-01   +5.035860366875980e-01   +2.540102604251763e-01   -6.073399147355041e-01   +1.317435006847862e-01   -4.926465431749614e-01   -3.621039382446153e-01   -3.540788792796879e-01   +2.813875987084053e-02   +6.155528090368143e-01   -7.028143157917678e-01   -4.319746898050690e-03; +9.264167654804610e-01   -4.979459226088374e-01   -8.029280650384247e-01   +1.320937048868892e-01   -3.347142090149566e-01   -6.391863753114743e-01   +6.665299981705036e-01   +8.324517904522829e-01   +1.437006607049940e-01   -1.000000000000000e+00   +3.758397828214388e-02   +6.111287830514718e-01; -1.008734114946774e-01   +2.279317613398123e-01   +2.755428345862163e-01   +5.085856383954516e-01   -2.769156364529934e-01   -2.619901125888413e-01   -2.951664390918052e-01   +1.130573671154142e-01   +6.597407168808406e-01   +6.980285690733534e-02   +4.510750214376706e-01   -5.393695383542902e-01; -3.739842924926949e-01   +1.326033700280980e-01   +4.473382835877874e-01   -4.586262263139165e-01   -3.334711582048618e-01   +4.091574733688060e-01   -8.708735831232108e-01   -2.738672525938451e-01   +1.647966451039436e-01   +3.305119080859820e-01   -5.589367415512523e-01   +6.691858143425830e-01; -4.037947864766196e-01   -3.739398656052612e-01   -2.223529857891287e-02   +1.098428727877690e-01   +2.111257649519860e-01   +3.898157860276198e-01   +1.509603931433637e-01   -4.463376943129055e-01   -7.869621954510263e-01   +6.434838545635446e-01   -4.568932643459827e-01   +7.155114677164744e-01];
L3E_L3I_iGABA_netcon = [-6.331714595984276e-01   -6.285135264658800e-01   +4.985353307685018e-01   +1.874861300468358e-01   +1.000000000000000e+00   -3.867975733208923e-01   -4.509727740394681e-01   -5.180538918988609e-01   +8.653398670854155e-01   -4.465900884534802e-01   -4.534245289891730e-01   -1.210415818151259e-01; +1.521726602897988e-01   -6.307237647708778e-01   +1.595776616907209e-01   -6.807965608314771e-02   +2.866017884446116e-01   -2.975770570802670e-01   -7.453203114302914e-02   +2.353765565583318e-01   -1.241018799251427e-01   -4.960601390585627e-01   -1.986561323735472e-01   +7.226063655824586e-01; +4.147336576580785e-01   +4.590596126740848e-01   +8.115029775397820e-01   -5.841434840468906e-01   -3.351626504199312e-01   -7.734010473171736e-02   -4.643978987926875e-01   +2.249523987899293e-01   +2.587506971471432e-01   -4.534576142965208e-01   -4.067307595836182e-01   -4.616240016855107e-01; -7.210337195680727e-01   +6.395358159534617e-01   +6.552713313104155e-01   -3.829846119642418e-01   -2.939742508571299e-01   -2.993731150347868e-01   -5.178452681223107e-01   +6.360303822111175e-01   -2.084787664203042e-01   -3.619829533903145e-01   -6.397508131040150e-02   -9.135987152183427e-03; +1.973183051122950e-02   -1.360841026096450e-01   +1.907209788986379e-01   +7.494093748444383e-01   +2.480900616082790e-01   -1.234352113634087e-01   -2.221339670578615e-01   -5.880717869011413e-01   +3.617848581850661e-01   +4.672008438200888e-01   -4.270232644396909e-02   +1.988328670290132e-02; -1.943250290285677e-01   +3.498086667605274e-02   +2.456565849113228e-01   +1.807671513090211e-01   -2.426258992568225e-01   -6.160144130499984e-01   -4.597331313291271e-02   -1.470395638391896e-01   -5.576189510781210e-01   +4.440637478298619e-01   +4.918718577701642e-01   -1.118304416998845e-02; -8.461432847737635e-02   +4.450405895541173e-01   -2.420142376570439e-01   -4.751760644348924e-01   -6.057730876436962e-03   -3.862525138636315e-01   +4.069282339271592e-01   +9.395096200121273e-01   -4.610898783238174e-01   -2.750214673541609e-01   +2.106053164690747e-01   +3.214010520930293e-01; +3.679046909356277e-01   -2.133094744991682e-01   +3.902032579664177e-01   -2.622660169250853e-01   +7.165912184651378e-02   +2.148932547330287e-01   -7.244143286400295e-02   -1.341341244657567e-01   -4.944605814744834e-01   +5.895324941166925e-01   +2.961094272042208e-01   +3.975774167833125e-02; +1.960803426177345e-01   +9.110876155746177e-02   -6.500130480114374e-01   +6.186604997349187e-01   +7.288802847154942e-01   +7.587906913878822e-02   -7.111387853511135e-02   +4.183505958404996e-01   +9.143755992336053e-02   -2.358410456262143e-01   -2.700146255917558e-01   -2.562251313724136e-02; -2.148319086610820e-01   +4.852027851785991e-01   -2.623034565155967e-01   +2.570514472754989e-01   +3.125371269393248e-02   +5.024830655653846e-01   -3.530830812615797e-01   -1.560316866839380e-01   +2.892264112253649e-01   -3.406285836515648e-01   +2.698809175166656e-01   -8.468992761163951e-01; +1.168837836768203e-01   -2.205732684820235e-01   +2.051599027608451e-01   -4.516710701280504e-01   -2.083193355147242e-01   -1.929849004261741e-01   -5.312943199998359e-02   +8.028296603192578e-01   +2.910702676012740e-01   +1.182672931747421e-01   -4.504069423874290e-02   +6.399093357277725e-01; +4.051829821038960e-01   +6.790982206015937e-01   -1.153952818555947e-01   +6.489656479876748e-01   +6.161100771163026e-02   -1.374251799145025e-02   -4.119088463613338e-01   +4.073104943187290e-01   +6.729998178920436e-01   +9.404428496487068e-01   -1.955241666257297e-01   +1.241869568432708e-01];
L2E_Input1_iAMPA_netcon = [+4.285247875288851e-01   -8.678887120478272e-01   -6.042384859245178e-01   +9.319301436219896e-01   -7.538586592290007e-01   +6.463042471955895e-01   +5.335758976352218e-01   -7.199917870609693e-01];
L2I_Input2_iAMPA_netcon = [-3.592612859777927e-01   +4.141670426118903e-01   +5.036143112825354e-01   -3.500392243553774e-01   -2.365673881814633e-01   +8.839251652224321e-01   +4.922492341307096e-01   +8.216539852791656e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.4*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 1.0*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 1.0*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.4*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 1.0*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 1.0*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
