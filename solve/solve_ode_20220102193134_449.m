function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+2.043742250378469e-01   -1.663729159325912e-01   +8.009694555085966e-01   +2.762545373664349e-01   +2.286477782313232e-01   +6.489393802052082e-01   -4.440695979257628e-01   +5.066908760071669e-01   +4.210613128205802e-01   +9.219787333064453e-01   +2.545485358738924e-01   +5.025060951691564e-02   +3.636911541966708e-01   +3.951506513566515e-01   -4.769173697489701e-02   +9.171755288405475e-02; +9.014503623955392e-02   +2.315871992799976e-01   +1.041363741216415e-01   +9.081491640787251e-01   +1.476397054400720e-01   +1.327631169848899e-01   -8.504167988109312e-02   +5.584457320644926e-01   +6.066126049997227e-01   +4.678041806045803e-01   +7.551556685617188e-01   +5.451230116982684e-01   +3.328201002239555e-01   +5.882056382429330e-01   +2.267112976974523e-01   +1.346947016714811e-01; +9.151839165920508e-01   +1.396378738352765e-01   +3.417601006030797e-02   +1.081543510014407e-01   +2.895440596698171e-01   +1.085930380843421e-01   +8.624707655079468e-01   +4.163064972145564e-01   +3.624247871243370e-01   +5.334058572890661e-01   +4.494562664891470e-01   -1.147231145203682e-01   +1.285242158598445e-01   -2.336631205922632e-01   +3.190801141713505e-01   +3.246920594401734e-01; +4.596166343073412e-01   -1.586300024372354e-01   +1.474010931323268e-01   +3.393327788496127e-01   +1.024368443044183e-01   +7.611927779476839e-02   +9.255274232200967e-01   +8.102356693993572e-01   +5.449836499637161e-01   +1.301615849537308e-01   +4.651842839442119e-01   +6.396903825179479e-01   +3.608087304687478e-01   +4.706499871553449e-01   +1.671003920537288e-01   +5.191775205771867e-01; +7.545822911594374e-01   -4.576564655522564e-02   +7.492637251365778e-01   +8.139746554689589e-01   +1.702557480936758e-01   +4.029668116414710e-01   -8.012397926624507e-02   +6.230073143454551e-01   +3.075190952295193e-01   +5.197285863165164e-01   +6.807453990379146e-01   +9.036859961206015e-02   +3.015728238480573e-01   +3.669868369970769e-01   +5.327320325621068e-01   +2.528902120957543e-01; -2.026971280596061e-02   +6.709968047812683e-01   +3.580082338847373e-01   +1.584848135561377e-01   +9.055860535886295e-01   +2.959383862582940e-01   +9.360859518659108e-01   +1.909314759320789e-01   +3.554894144875005e-01   +2.641689226786216e-01   +5.835479177395546e-01   +1.402401322825183e-01   +5.590486983100552e-01   +3.442570029703854e-01   +1.209741372158489e-01   +2.168531781719924e-02; +5.784811801804421e-01   +4.796677546454113e-01   +4.656279359730250e-01   +1.341593164653216e-01   +3.292501057616725e-01   +3.482251649579717e-01   +7.127539080521209e-02   +8.601847896426740e-02   +6.817082624814298e-01   +4.831382282144457e-01   +1.293236245503477e-01   +3.841425110908734e-01   +1.805185648527075e-01   +4.482565953139933e-01   +5.917183383262073e-01   +4.785401695945756e-01; +3.747934227640441e-01   +5.197510273703344e-01   -6.546228467181390e-04   +8.639827734127670e-01   +2.350023976799823e-03   -1.081156638239308e-01   +5.817055384102167e-01   +4.908192467076014e-01   +6.849229647335461e-01   +4.983373014312060e-01   +2.928397986422493e-01   +6.013243298097244e-01   +2.131994622903546e-01   +1.523121501183675e-01   +6.472761234318428e-01   +6.409472733613980e-01; -1.099344842934413e-01   +7.487986511398317e-01   -1.467250769314799e-02   +4.404616549122714e-01   +2.403528162463430e-01   +5.952014453645028e-01   +5.141306904800598e-01   -1.240549829234058e-02   +2.276672435978759e-01   +4.513438842959150e-01   +8.115038721814118e-01   -2.993823496954280e-01   +4.487964273724441e-01   +4.452013851062718e-01   -5.377780631613525e-02   -1.251637945643559e-01; +1.155940637626067e-01   +2.097762417964564e-01   +6.237845231892587e-01   +5.533984320797922e-01   +6.929445419745436e-01   +4.128995325871506e-01   +5.550671896287788e-01   +5.253849438274866e-01   -5.908724657544545e-02   +2.132422888662550e-01   +2.713177733735944e-01   +3.538355170438825e-01   +8.007400439338804e-01   +1.955239491437194e-03   +3.102892095005049e-01   +6.424134959622094e-01; -2.832376104629088e-02   +7.722624496151113e-01   +3.587631777439096e-01   +2.227888863758791e-01   +6.968625138112744e-01   +6.703559885587014e-01   +5.718915043655705e-01   +9.287202107691665e-02   +4.410203461375083e-01   +5.711295856617129e-01   +2.877621001379340e-01   +4.096447884485834e-01   +9.772358805484264e-02   +5.862467447951653e-01   +5.919567512632626e-01   +3.696633222264215e-01; +5.661840586577412e-01   +3.935208712404832e-02   +9.934022733283907e-02   +1.762575479592213e-01   +3.107066454442742e-01   +7.155264562835868e-01   +1.565838176606320e-01   +3.782201601666798e-01   +1.000000000000000e+00   -4.315868827820870e-01   +6.187909788227796e-02   +4.246455156316463e-01   +9.341275781364940e-02   +3.541497196651650e-01   +7.413333991772550e-02   +4.992419809062502e-01; -3.676922666306717e-01   +3.273556554064549e-01   +6.878138357060268e-01   +5.673247656068688e-01   +8.504740956897964e-01   +6.183512302370611e-01   +3.002071386359467e-01   +5.578975959532788e-01   +9.699917943273362e-01   +5.945056724905183e-01   +2.791721304499119e-01   +8.951864887636508e-02   -7.853863007918585e-02   +3.126142981941971e-01   +3.058680624073950e-01   +2.074831407879385e-01; +4.011391239524531e-01   +4.539943364716549e-01   +5.324835723346248e-01   -2.728130929711094e-02   +1.841628176290638e-01   +6.127925430867278e-01   +2.979155419369717e-01   +4.533957022513510e-01   -9.877971138864855e-03   +1.257325497912072e-01   +6.376046826996195e-01   +6.005261638592795e-01   +7.203338714689413e-01   +2.651811692507343e-01   +3.744397724626445e-01   +1.654028119286331e-01; +5.617721191461795e-01   -2.933970200899674e-02   +6.034516916987498e-01   +8.127536211477517e-01   +1.636092702276452e-02   +2.165188458777907e-01   +5.525217144589646e-01   +5.637593494913625e-02   +5.608731465310037e-02   +8.036894930042170e-02   +2.784724863753172e-01   +5.078194259241960e-01   +6.404056904370010e-01   +3.393805868260029e-01   +4.887096016344322e-01   -1.116814910977542e-01; -1.882837636989322e-01   +3.442376357147662e-01   +6.056838984224636e-01   +7.099963668388369e-01   +8.632736663750852e-01   +5.688388459612741e-01   -1.458490381823722e-01   +9.449506790380936e-01   -1.162251095254656e-01   +6.315666620868172e-01   +4.193734137757900e-01   +4.432060877809581e-01   +2.231568718623396e-01   +7.442951555791850e-01   +7.378717156880797e-01   +7.378249475143511e-02];
L1E_L1I_iGABA_netcon = [+4.697384225876665e-01   +5.049170336698229e-01   +2.034658831777981e-01   +3.141464832897353e-01   +3.321904587044596e-01   -1.042512336735171e-01   +3.243095505218124e-01   +3.135922851466444e-01   +2.218364899184160e-01   -1.144185616267575e-01   +2.666704780056362e-01   +1.714276230101801e-01   +5.713855523371716e-01   -2.761481826795486e-02   -2.898803122679668e-01   +1.000000000000000e+00; +3.789950066737951e-03   +2.823157584914760e-02   +3.953902530071741e-01   -3.907601563628315e-02   +2.091354394388912e-01   +4.907649085606322e-01   +3.794500794471907e-01   +2.015841744772121e-01   +3.762903808281814e-01   -3.434192308163250e-03   +3.499258694926302e-01   -8.909436526158786e-03   +7.252599451658787e-01   +3.131417335574559e-01   -1.072227163125120e-01   -2.829449428832367e-01; +1.001089115538620e-01   +2.407834844376209e-01   +2.275426853372381e-01   +3.710572199684463e-01   +2.439960237738092e-01   +6.188432696480792e-02   +2.049686441728471e-01   -1.132775896881260e-01   +1.190720916106029e-01   +7.808021618268134e-01   +4.098183109115354e-01   +2.050883803936246e-01   +2.275048195468765e-01   -1.773924833130759e-01   +3.269577764540926e-01   +6.079946299992520e-01; +5.803515283832097e-01   +2.140516409525245e-01   +4.018266182178231e-02   +3.529713337634117e-01   -1.072913269081869e-02   -7.476077065186221e-02   +1.344205483627639e-01   -1.353479702993012e-02   +2.115659708746824e-01   +2.197391491761793e-01   +4.499958265766663e-02   +6.486198293415286e-01   -2.326622691165789e-02   +4.360490476077108e-01   +2.691476893226255e-01   +9.325631706713748e-02; +1.589424035061167e-01   +4.560771061576691e-01   +5.238129297788737e-02   +1.873426774548818e-01   +5.960142909849472e-01   -1.356596662836445e-01   +1.302889049313699e-01   -1.739270238944779e-02   +4.150266874697344e-01   +1.383759061904902e-01   +1.184515421427472e-01   +3.330287195063298e-01   +2.305369190374810e-01   -2.453502293993632e-01   +1.649916025833537e-02   +3.650571444614676e-01; +1.633232393165917e-03   +1.890901372417255e-01   +4.606510801783667e-01   +2.811620451866258e-01   +3.704951424191553e-01   +2.801064606615675e-01   +1.798360985090855e-01   +3.580759586420582e-02   +2.344146878997850e-01   +1.389400412764851e-02   +2.561030577309270e-01   +4.765252295077657e-01   +1.394661616554931e-01   -1.375735948605848e-01   +4.334691244525446e-01   +4.499616587646967e-01; +2.335439664059134e-01   +1.518204441030364e-01   +2.324413362572813e-02   +1.162580805930213e-01   +1.781124820513460e-02   +2.408570647758468e-01   +3.132952679680738e-02   +1.104910826082472e-01   +1.306033201850162e-01   -8.163034599605816e-02   +2.438556949789614e-01   +2.126820520865745e-01   +3.505854749421317e-01   -1.622310633937022e-01   +2.770061347130923e-01   +2.305378258559729e-01; +3.207392216128992e-01   +5.696300005398349e-01   -9.495575019926933e-03   +5.078273361552905e-01   +1.466957255770986e-01   -1.214172302335321e-01   +1.997665500073634e-01   +5.485649327401266e-02   +7.628629467190730e-01   +3.581509186673255e-02   +2.868526494139152e-01   -5.439405990664017e-02   +3.527609805669675e-01   +3.516942740030937e-01   +1.576945575291294e-02   +3.935206756043243e-01; +4.256341829774273e-01   +2.099153819724734e-01   +3.269824166606926e-01   +1.103850067312852e-01   +4.283067723583489e-02   +4.917851725947886e-01   +2.704406921886593e-01   +2.031180773573878e-01   +3.070505529774639e-01   +2.902601031750194e-01   +2.289703413731079e-01   +4.411927273738960e-01   -3.276267241640499e-02   -6.674029925857677e-02   +5.063866166331455e-01   +3.010309754400798e-01; +6.176348327825211e-02   +4.591345768644582e-01   -5.446226770987544e-02   +3.202038728099119e-01   +1.886842901168975e-01   +5.267887569303427e-01   +2.489486298807661e-01   +2.032259726322492e-01   +4.969972491720396e-01   -1.232653261942187e-01   -2.312859044754431e-02   +5.561631958892014e-01   +3.658431786756257e-01   +5.681789644921474e-01   +1.353131231203350e-01   +6.306420862573723e-01; +2.091794212711828e-01   +4.071019060772464e-04   +1.922802856107373e-01   +2.613870818982787e-01   +3.783879757923082e-01   +3.222999236236138e-01   +3.325330696703649e-01   +2.351602543977543e-02   +4.841843745555002e-01   +2.642119960634388e-01   +5.393667371598694e-02   +4.000205980989334e-01   +3.654448700929044e-01   +3.407270238342665e-02   +2.019558583779014e-01   +5.880032533766626e-02; +4.932278497728368e-01   +2.594729242137661e-01   +5.145319176382371e-02   -1.736829300066431e-01   +1.446691432588971e-01   +2.071263759438826e-01   +3.767884998642994e-01   +4.188004032004969e-01   -1.711411081738615e-01   +1.166438008721163e-01   +3.803567607929307e-01   +7.463959893274559e-01   -1.352743423296496e-01   +1.037158101473832e-01   +2.277159665993905e-01   +3.214002702531147e-01; +4.545040611834477e-01   +4.409702410796587e-01   +2.652342688461800e-02   +6.123686073803013e-01   +8.052137002672488e-02   +1.253497312699088e-01   +2.005550947956134e-01   +3.337736928275132e-01   +2.288123012026248e-01   -1.032611358181576e-01   +3.697840849531900e-01   +1.425698804349489e-01   +6.895956932676946e-02   +2.193869776108514e-01   +5.667347473876320e-01   +1.016868052323845e-01; +5.096229674220748e-01   +3.735393895239543e-01   +2.246635079042993e-01   +2.936107495619709e-01   +1.279232208486754e-01   +3.684333607059024e-01   +4.089372335019337e-01   +2.070602943785824e-01   +4.455960600014566e-01   +6.282178586805261e-02   +2.999527469376604e-01   -7.870621272914355e-02   +1.820148653722439e-01   -1.109346091012210e-01   +2.056382372202976e-01   +2.187949677570880e-01; +5.786438192275606e-01   +4.964766294334250e-02   +2.819394429378344e-01   +2.187230108060351e-01   -1.221175874435038e-01   +1.310496089611405e-01   +1.688195394419355e-01   +2.807093496251313e-01   +1.699683931173460e-01   +2.850391412730364e-01   +5.493097089808483e-01   +2.867443408064769e-01   -1.178355734790443e-02   -8.367346401739058e-02   +3.334204281553930e-01   +2.880661704340715e-01; +2.713977715643505e-01   +4.137769285423430e-02   +5.040260885866326e-01   +4.450790755726901e-02   +3.823302249924753e-01   +4.285180613870678e-01   +3.278227428047010e-01   +1.994445433186120e-01   -6.924025403156121e-02   +3.346102557533963e-01   +1.218213938865586e-01   +4.351947084407226e-01   +4.330747482916414e-01   +2.242764143353433e-01   +8.021921535861541e-02   +2.853707819351702e-01];
L2I_L1I_iGABA_netcon = [+4.347993550505435e-01   +1.490773957561130e-01   +3.543511223060022e-01   +3.495270056491259e-01   -1.585488078207029e-02   -1.638514442956172e-02   +2.972458793665453e-02   +2.080359289362637e-01; +4.626981067053390e-01   +1.000000000000000e+00   +2.743812152515579e-01   +4.567662980710360e-01   +5.852974528504391e-01   +3.982241663938359e-01   +6.380281673793120e-01   -1.460492267948421e-01; +3.386554001705619e-01   +3.213152489613000e-01   +7.367514656741951e-01   +1.338477608179197e-01   +6.040849210450421e-01   +7.696749158602235e-02   +8.431579973868851e-02   -3.305091246873630e-01; +6.961147354777760e-01   +3.200047340594542e-01   +1.533921180649312e-01   -4.459546633701597e-02   +9.181931757722256e-01   +3.765046406898072e-01   +5.188022715343973e-01   +6.173316092712180e-01; +3.726887278987639e-02   +7.577639141438767e-01   +5.989856531798842e-01   +2.933168827989261e-01   +5.938022182324402e-01   -1.076151067478979e-01   +5.472733502857750e-01   +2.441834576533598e-01; +5.304737998053868e-01   +1.464517301868449e-01   +5.032459892714843e-01   +5.003521997686413e-01   +3.683041063925403e-01   +7.248102601652554e-01   +4.962952364667113e-01   +7.171461535664186e-01; +8.091150061845985e-01   +8.675167169660274e-01   +6.075881758862113e-01   -1.206815498946929e-02   +4.887295432446443e-01   +1.044422750633115e-01   +6.330994399713461e-01   +1.285518326825449e-01; +3.140510899973832e-01   +3.566409271795288e-01   +5.408474336600003e-01   +2.197703920982742e-02   +1.303812052187879e-01   +1.527369524548448e-01   +3.843647208413714e-01   +2.701126924081132e-01; +6.862062278550598e-01   +9.957291271434361e-01   +2.441803969611224e-02   +7.767839562082823e-01   -3.135614466454411e-01   +2.081332393188505e-01   +3.446812787466508e-01   +3.543763302597177e-01; -2.594709389281369e-01   -7.982359877978340e-02   +2.124553185886027e-01   +6.977268992605756e-01   +8.231357121528639e-01   -2.771157316903311e-02   +2.127385212015427e-01   +7.542338861718190e-01; +2.326112961536240e-01   +3.620927841553844e-01   +6.955372530898055e-01   +7.154496952486359e-01   +3.686034468741144e-01   -7.831647574450021e-02   +3.642519283284592e-01   +5.816312965496496e-02; +2.299655068599982e-01   +6.069117460815886e-01   +4.702895527511925e-01   +4.270008630405318e-01   +2.493407493639000e-02   +4.698419388573480e-01   +2.660226482331516e-01   +3.344680745390671e-01; +1.667234704302404e-01   +5.307571320687724e-01   +8.816037716897116e-01   -2.010369562250858e-01   -1.086746287695281e-01   -6.008207972221895e-02   -8.874171630724666e-02   -3.931155977154944e-03; +1.596767780531090e-01   +2.454468070041359e-01   -3.374613030331816e-03   -3.694341708111920e-01   +4.974966948294735e-01   +1.884040691398248e-01   +5.556890414824711e-01   +1.576722089099787e-02; +9.002981221447559e-01   +6.811249316937785e-01   +7.217286705198152e-01   +8.102805728922611e-01   +6.301383086731812e-01   +8.476386050416059e-01   +4.683298136929672e-01   +8.386907831037368e-01; -1.037452985443310e-01   +1.943940208655205e-01   +8.162884392600849e-01   +9.831888839194276e-02   +2.042207301513276e-01   +1.007073063500872e-01   +4.484248727260537e-01   +7.350466900653325e-01];
L1I_L2I_iGABA_netcon = [+3.183414842882590e-01   +6.277539561715995e-01   -1.322961518334803e-03   +7.664447174741986e-01   +2.624161893737067e-01   +1.315933303295567e-01   +5.796404318414730e-01   +4.260633824836381e-01   -3.414299493833868e-01   +7.345644394794925e-01   +2.791086389103468e-01   +6.084152630459275e-02   +3.229066458984001e-01   +2.474246922809250e-01   +2.284189992200759e-01   +3.836429123781004e-01; +1.056015097357897e-01   +4.264592823669335e-01   +3.283745543119089e-02   +2.676721219231433e-01   -2.241772865263146e-01   +5.154869518586903e-01   +8.036360106257381e-01   +9.873097070359420e-02   +5.030559782832733e-01   +4.531693474568309e-01   +3.398644268590948e-01   -9.356246110853310e-02   +3.099422768423802e-01   -2.194779239219574e-01   +7.277395552834749e-02   +5.425788970506684e-01; +2.583224104312193e-01   +2.954190801729367e-01   +4.763952105792085e-01   +2.514428548630516e-01   +2.843748617604248e-01   +4.458425562819600e-01   +3.184592819158348e-01   +5.557783057240367e-01   +1.416761150865898e-01   +2.354432548497117e-01   +1.458087364283902e-01   +4.174816616397261e-01   +4.508274192670971e-01   +4.884706802652218e-01   +4.553144488183207e-01   +1.722239229507358e-03; +2.573550379497805e-01   +3.269512690884804e-01   +1.826489612648911e-01   +1.033474252131231e-01   +6.004125002675015e-01   +2.178957842549250e-01   +5.312748927979782e-01   +5.840014900075443e-01   +8.843877170277673e-02   +4.843763308813517e-01   +1.136988546990726e-01   +1.785414656437940e-01   +5.435337590486233e-01   +8.519418530558129e-02   +3.262372182762371e-01   +8.438677902589933e-02; +2.014976946998631e-01   +1.105396733481505e-01   +4.286405739744544e-01   +4.449185949901434e-01   +3.424915770679129e-01   +8.479830644498902e-01   +5.799811111365127e-01   -5.992784476969610e-02   +3.869069576521873e-01   +1.432704207768265e-01   -4.386615796696075e-02   +6.003682785306559e-02   -1.467681210071556e-01   +3.289708110625633e-01   +5.069023966415031e-01   +7.679581620245495e-01; +2.994605193032459e-01   +4.573853776236927e-01   +1.492809415047212e-01   +8.429474813594567e-01   +3.065098195871275e-01   +5.307834251574586e-01   +4.934226982459988e-01   +2.542599694838198e-01   -6.623598902089296e-02   -1.337367857704786e-01   +3.915965412634789e-01   +2.009068638091822e-01   +4.342816165155097e-01   +5.640898894836590e-01   +3.122694862212586e-01   +2.691810139493968e-01; +5.521643927610849e-01   +7.321048071654493e-01   +2.833787752859011e-01   +4.016783904080643e-01   +4.163407430072859e-01   -2.359840121370099e-02   +6.569891310157683e-01   +6.859852976378658e-04   +6.642277315370126e-02   +5.462925315166023e-01   +3.335514095961685e-01   +2.956647987773367e-01   +5.157818535642459e-02   +2.447894445759667e-01   +1.809793346828113e-01   +5.189421100550375e-01; +4.550093869313472e-01   +3.412065320742389e-01   +1.351660837114404e-01   +4.172536646175535e-01   +3.797571370448340e-01   +6.409157588173099e-01   +3.334560057373758e-01   +7.601769667320989e-02   -6.267341790352463e-02   +2.605175845088524e-01   +7.594454477121122e-01   +4.418369435500104e-01   +5.198492618488737e-01   -1.503335228969498e-01   +4.308000469300488e-01   +1.155699796235360e-01];
L2E_L1E_iAMPA_netcon = [+4.055855432423446e-01   +2.214031474607521e-01   -1.086693942092385e-01   +4.756218077744683e-01   +5.593946824790310e-01   +3.119702111255088e-01   +3.621899181922146e-01   +3.241424061293504e-01; -1.541702491279481e-03   +3.774691565632097e-01   +3.386285218511070e-02   +1.356182593707449e-01   +2.453130303829965e-01   -1.781534656587506e-01   +3.341216631315735e-01   +5.530783204139553e-01; +1.601156103049474e-01   +6.496786501906517e-01   +4.981866975632694e-01   +1.207474774263323e-01   -1.046954439924280e-01   +4.771952193855159e-01   +4.492445348007130e-01   +4.027457372129999e-01; +4.957461484401777e-01   +8.145550980179440e-02   -5.461593051364044e-02   +5.748901249049543e-01   +1.755131760741063e-01   +5.548065237531379e-02   +1.627794023155595e-01   +3.247033156283015e-01; +3.619400568076489e-02   +3.923503135541763e-01   +3.187969158008256e-01   +1.055119491838121e-01   +6.491365413592639e-01   +4.021528789810303e-01   +8.792228004158144e-01   +7.760419051818154e-01; +3.843872564814095e-01   -1.161191749018534e-01   +7.145152838066762e-01   -1.910950188216309e-01   +5.957068578348571e-01   +5.423450013211596e-01   +7.546882624685947e-01   +3.625090483883564e-01; +2.740734584146898e-01   +2.806632886746122e-01   +1.639618139939412e-01   +1.597930045883087e-01   -1.464185548562455e-01   +1.180798554057914e-01   +7.947348441658484e-01   -4.213994966397125e-02; +1.393135281701804e-01   +4.246185911350848e-01   +7.127069356865762e-01   +4.707868729802388e-02   +5.148290382727136e-01   +3.866758522518030e-01   +3.797201105895758e-01   -3.373667871056144e-02; +5.389772196512221e-01   +2.446684250653344e-01   +3.899105504844099e-01   +8.024557090519014e-01   +8.611872227761169e-02   +6.076613360837474e-01   -7.043438540554077e-02   +5.493844935562606e-01; +3.225919458204676e-01   +5.693022015213692e-01   +4.524617400881345e-01   +4.219648512168517e-01   +3.004119422565914e-01   -4.875910412958046e-02   +2.643105324713356e-01   +4.866347214409819e-01; -4.350495766655268e-02   +5.091042160725011e-01   +2.844309688003593e-01   +2.326673186510158e-01   +3.643446138444082e-01   +3.543402630127804e-01   -2.112081650822198e-01   +3.872992769185962e-01; +2.569953959547025e-01   +2.348531013298733e-01   +6.665234992968457e-01   +7.998042340772987e-02   +2.937612011161219e-01   +2.338904313076484e-01   -4.664101991872361e-01   +3.416753298227559e-01; +2.750909596877557e-02   +3.255888226645843e-01   +3.716801082904214e-02   +4.072850381517666e-01   +1.490030819596901e-01   -2.479186564299231e-02   +4.235950579143355e-01   -8.029082390236753e-03; +1.590765902087807e-01   +2.441380878138761e-01   +5.912662952157100e-02   +4.244214368950799e-01   +3.537447486442269e-02   -7.147206099770699e-02   +5.266069041799192e-01   +2.182588985743958e-01; +2.751333560250839e-02   -2.054076850892705e-02   +5.907478319324934e-01   +4.805886796900958e-01   -1.058440133356611e-02   +5.244308757644915e-01   +4.051162914403264e-02   +8.250269468121020e-02; +3.931956643637192e-01   -1.607186063476337e-01   +1.244156092034757e-01   -5.146075599673700e-03   +5.651124127857652e-01   +3.418340098918476e-01   +1.272037550938910e-01   +5.838742384929559e-01];
L1E_L2E_iAMPA_netcon = [+1.565119247844409e-01   +2.006315124390393e-01   +2.272955867492927e-02   +3.900499943682392e-01   +9.813604886114483e-02   +2.919589487273258e-01   +3.398769536267651e-01   +2.554814004061040e-01   +4.134059417525953e-01   +3.248958494818995e-01   +5.183239197614425e-01   +7.503039838978942e-01   +6.397503147351401e-01   +2.302473692156459e-01   -1.336114241765454e-01   +7.746964834095969e-02; +3.503129966796415e-01   -5.875284804521151e-02   +2.863023082280227e-01   +4.764845001138900e-01   +2.100493607077921e-01   +7.854953450030726e-02   +1.658170540375661e-03   +3.064429508648163e-01   +3.912333597787310e-03   +4.515435893145778e-01   +3.746952881286914e-01   +7.825370595002867e-01   +3.993150705467435e-01   +2.129594356320403e-01   +4.804943680456408e-01   +1.454436414558792e-01; +8.013035748420175e-01   +3.523526093740012e-01   +1.197037839754336e-01   -9.611535267648644e-03   +3.268271661115414e-01   +4.539428097133602e-01   +1.737302135411675e-01   +6.281329256678460e-01   +5.372692927604332e-01   +1.402192657595952e-01   +4.781781089904737e-01   +4.569973103362625e-01   +2.778890175474618e-02   +6.068695813080562e-01   +1.535941580427678e-01   -1.119888965070640e-01; +1.580743977216011e-01   -3.499716885108893e-02   +8.782503277397536e-01   +1.006230814197992e-01   +1.304257920920780e-01   +2.764986319706015e-01   +9.863887577896395e-01   -6.422313427739733e-02   +5.060209438300760e-01   +4.633005553245305e-01   +5.745677321750549e-01   +2.519753040128088e-01   +1.481125936143418e-01   +4.648891202296953e-01   +4.988603522411237e-01   -1.759795741596674e-01; +3.405354324381878e-01   +2.343956773549852e-01   +9.464648327233008e-01   +5.278176586621802e-01   +3.140190721064905e-01   +6.671670534235763e-01   +6.131553188981788e-01   +4.046394653074204e-01   +6.881485805140897e-01   +3.484908099505309e-01   -3.618830016872848e-02   -1.196762708454062e-01   +4.429550954803564e-01   +3.899666431517564e-01   +9.311444674328433e-01   +1.486121747779335e-01; +2.026212154217513e-01   +8.022228810937927e-01   +2.624755523224920e-01   +5.937448969144182e-01   +2.573471826478927e-01   -5.004961516040043e-02   +7.165791379304443e-01   +1.850474600451157e-01   +5.173052706012828e-01   +2.542394653690631e-01   +6.321809469757395e-01   +2.003408818373257e-01   +8.872778146314811e-02   +1.530400683635284e-02   -3.320441055226120e-02   +4.664832509010111e-01; -4.326474997136023e-03   +2.996207359158048e-01   +4.554083553693818e-01   +6.183499165923284e-01   +3.312804979515783e-01   +8.901052637846243e-02   +9.221207288056920e-01   +2.040080430811740e-01   -3.118194760596700e-02   +1.964867144313950e-01   -1.062144233915288e-01   -6.859106043715930e-02   -3.283937153165866e-01   +2.488890761915597e-01   +2.610910021091294e-01   +3.785503648386600e-02; +4.335911510723268e-01   +4.178017455700059e-01   +6.706070492324803e-01   +7.938275523995532e-01   +7.589739196859103e-01   +8.560851515326269e-01   +7.871667696402562e-01   +1.370010910443919e-01   -4.308200203542031e-01   +5.220473982290700e-01   +5.598420364684744e-01   +4.096179717979669e-01   +2.704109849130544e-01   -1.312919423468550e-01   +3.063262541883338e-01   +2.667073545686610e-01];
L2I_L2E_iAMPA_netcon = [+4.841829198799349e-01   +7.857288866223736e-01   +4.690551195754048e-01   +3.709200676314555e-01   +2.661356976587060e-02   +7.865125460119773e-01   +3.010305472551139e-01   +4.870305188995690e-01; +7.556352732357499e-01   +7.408479319615285e-02   +6.462029886221109e-01   +5.523968509091813e-01   +6.205673129739564e-01   +2.920555813829695e-01   +3.645733921038892e-01   +2.978161942063012e-01; +5.260332141796981e-01   +5.112256690457264e-01   +3.790753704192531e-01   -1.170907838767029e-01   +1.506945894924537e-01   +4.703086805144062e-01   +4.183499470165380e-01   +2.770309589431088e-01; +4.557569502895066e-01   +3.494465615054072e-01   +1.377146432424845e-01   +8.600175410792772e-01   +3.290005395944999e-01   +8.681731277547573e-02   +3.968828079906214e-01   +2.667446994911248e-01; +5.838272914516527e-01   +2.629712407760271e-01   +4.359849052445212e-01   +6.027909125675908e-01   +5.378846329830512e-01   +4.922481579658580e-01   +8.194408101986054e-01   +3.564294440703563e-01; +4.134328615427026e-01   +4.568979139137227e-01   +1.150405399058095e-01   +6.390188978980178e-01   +1.506648803557420e-01   +4.542001813474686e-01   +4.157991868563285e-01   +3.668328126234994e-01; +5.777833332735048e-01   +1.869317841942703e-02   +1.189306080158325e-02   +7.079576913092216e-01   +5.555462917133539e-01   +2.557064510164416e-01   +1.000000000000000e+00   +1.556972786643951e-01; +9.349426448119982e-01   +2.239526737250493e-01   -1.252070846403112e-01   +4.327791448872720e-01   +2.594508951714909e-01   +4.280721861932843e-01   -1.876809612598789e-01   +5.034502262348011e-01];
L2E_L2I_iGABA_netcon = [+1.128559421623677e-01   +3.767987109358364e-01   +5.747542342710098e-01   +1.380556752967436e-01   -1.381185950081247e-01   +4.725177937224450e-01   +9.222047943788936e-02   +5.219545812751198e-01; +3.664374155753803e-01   +6.744246860997978e-01   +4.677701993710743e-01   +4.450815940370805e-01   +5.798704076656676e-01   +4.682031094434532e-01   -7.930697765143618e-02   +3.782794179514486e-01; +1.445895218166438e-01   +7.373221525551645e-01   -2.622942882250698e-01   +3.383345485601712e-02   +6.896260101619089e-01   +7.467563023760599e-01   +1.694115817813156e-01   +8.976342808461495e-01; -9.653672877027453e-05   +7.467581848498468e-01   +4.296542347267122e-01   +5.325076385502119e-01   +9.272417418144440e-01   +3.187811615524120e-01   -1.888613736913408e-01   +1.318733898735400e-01; +3.454681246300165e-01   -1.763790328042812e-01   +1.482000407505446e-01   +6.717933251297379e-01   +4.728120240256069e-01   +2.284164562239025e-01   +3.383737136886197e-01   -2.837041891599691e-02; +1.354028656734564e-01   +1.102857754037056e-01   +1.231910524283384e-01   +3.257814698059200e-01   +3.145080430189388e-01   -1.368420529273083e-01   +3.814465085635159e-01   +1.783493753271791e-01; +4.985061511371331e-01   +3.978942676236215e-01   -2.015767632886113e-01   +2.315691202318311e-01   -1.457853513212104e-02   -9.765409230423074e-02   +3.203411373176819e-01   +7.641102003010766e-01; +4.164003689844111e-01   +6.577935446850499e-01   +4.617271335039807e-01   -3.500217543910260e-01   +5.811538380267349e-01   +3.967389088961675e-01   +6.972906320942872e-01   +4.463448824296284e-01];
L3E_L2E_iAMPA_netcon = [+4.675596071318597e-01   -1.330037633594171e-01   +1.846933639499790e-01   +4.141341448459957e-01   +4.322467043421898e-01   +1.833909859370125e-01   +2.855706420938414e-01   +6.060408234706913e-01   +3.179654117618634e-01   +4.502016563305251e-02   -2.930888081600136e-02   +5.164160395707147e-01; +3.944252997109025e-01   +7.745397801342171e-01   +2.935219183208929e-01   -2.618440322829249e-03   +1.114083079725841e-01   -2.062673938906779e-01   +2.748422907633144e-02   +1.252260344356226e-01   +1.215742445222374e-01   +7.451713371116660e-02   +2.744923378356474e-01   +2.588161356002699e-01; +1.546325898393618e-01   +4.972743554281894e-02   +6.822623675570605e-01   +1.794205466113987e-01   +8.502729630552730e-01   +5.138979859026028e-01   +4.814096057798475e-01   +5.166139765974640e-01   +5.759892658788283e-01   -1.617288503747479e-01   +2.234434629717787e-01   +6.858769325501424e-01; +2.195910245586644e-01   +3.120309779003020e-01   +3.181712593811182e-01   +2.041130353885245e-01   +4.418859217082357e-01   +2.259906586269059e-01   +2.083009343579214e-01   +3.900531184947115e-01   +4.242496717758426e-01   +5.679508649675407e-01   -5.866748964670161e-02   +9.837536531776581e-02; +5.846903182464270e-01   +3.593663634915318e-01   +2.175505164019216e-01   -2.703362102869534e-02   +6.417098704378076e-01   +3.600095477968567e-01   -1.125007641478715e-01   +1.751559821872853e-02   +4.582551070862180e-01   +4.849736546372739e-01   +7.175386349313809e-01   +4.250044337163446e-01; +3.379814552065943e-01   +5.590756959608826e-01   +8.297586915970323e-01   -6.267686409641157e-02   +4.126252572207972e-01   +8.697259782425237e-01   +5.047453518414704e-01   -7.834742285437887e-02   +7.067732053237741e-02   +5.313973912890579e-01   -3.132080932472903e-02   +2.911296523914022e-01; +2.765633756814554e-01   +2.118486653075116e-01   +6.747293153301722e-01   +1.681213071372125e-01   -2.485386742165090e-02   +4.607171204683723e-01   +2.940488138041021e-01   +4.671519230421775e-01   +5.648614284523467e-01   +3.186828489509134e-01   +8.042106909030632e-02   +1.945034678990819e-01; -8.157782667117008e-02   +5.499321852407694e-01   +2.695331165215223e-01   -2.814318306166250e-01   +3.595779352174241e-01   -1.883471975701451e-02   +2.712661405234386e-01   +1.239695541282972e-01   +6.659000028378621e-01   +5.127568969935159e-01   -8.526688488128786e-02   +2.749051704613149e-01];
L3I_L2I_iGABA_netcon = [+6.438020826105131e-01   +4.704045704172237e-01   +1.810243050320674e-01   +5.783067450576882e-01   -8.466150122884702e-02   +3.568175091643245e-01   +6.115363743964445e-01   +3.558499111030926e-01   +5.975312852205287e-01   +2.071284138051743e-02   +2.696448753889490e-01   +5.448655874273084e-01; +2.531001334371176e-01   +2.312330949880855e-01   +1.938804480507660e-01   +2.531090873613962e-01   +5.512497224843130e-01   +4.043752647756225e-01   +3.435301661104915e-01   -1.192824787039854e-01   +2.455586400087806e-01   +2.643090671439984e-01   +3.712463691015843e-01   -2.860795147681713e-01; +2.309219691455218e-01   +5.305076287396784e-01   +4.816467164924659e-01   +2.296097724460770e-01   -9.739331083344215e-02   -2.944663377901352e-02   +4.789309494690540e-01   +6.778363485501339e-01   +1.491538043148314e-02   +3.500416906664880e-01   -9.216409516845596e-02   +4.376582003493491e-01; +4.693549376946284e-01   +6.415610509603272e-01   +1.242261143315998e-01   -1.245972102657952e-02   +2.338461990875223e-01   +4.233148649952977e-01   +2.814202516309526e-03   +6.373979084640292e-02   +2.686628442483671e-01   +8.279975680047019e-02   +4.805553076769732e-01   +2.659247084233779e-01; +4.185911147096622e-03   +8.099446462312652e-02   +3.404969793411700e-01   +4.375689572428172e-01   +5.157748253064743e-01   +5.668446750139199e-01   +1.375850617363967e-01   +1.000000000000000e+00   +6.600365510893517e-01   +1.255138458524255e-01   +1.963854796965971e-01   +6.290293042584376e-01; -2.025051678242145e-01   +5.495144283755673e-01   +3.177535556907677e-01   +2.002093711773102e-01   +7.747584349625601e-01   -6.484250757525138e-02   +3.826011093185374e-01   +2.874954534261223e-01   +2.506123140289108e-01   +2.679420566019177e-01   +3.069528498785202e-01   +5.669159979504307e-01; +4.082147277232080e-01   +3.537812069669094e-01   +7.716197179925340e-01   +2.365030194286276e-01   -1.411869224546794e-01   +5.083294862429319e-01   +6.217486708684663e-01   +4.761417114474833e-03   -7.413674413414126e-02   +4.150117919471186e-01   +2.962729504015754e-01   +2.045912581365157e-01; +1.212842031530194e-03   +1.253940963617164e-01   +7.869960137110654e-01   +6.456447411485342e-01   -2.048849910399930e-01   +6.112114973800865e-01   +5.268497618503758e-01   -2.606431780017775e-02   +6.608359319207329e-01   +3.025417846403798e-01   +5.308416154430795e-01   +8.892887488852025e-02];
L2E_L3E_iAMPA_netcon = [+5.617822104173005e-01   -1.345120703534463e-01   -9.706030065053843e-02   +2.923425109852902e-01   +5.809544593931543e-02   +9.624123473215780e-02   +2.381404685793683e-01   -2.662613395454926e-01; +2.266712513445603e-01   +2.674230417759381e-01   +2.205444789599395e-01   +7.364587057734556e-02   +5.045725788852933e-01   +1.231736545075136e-01   -2.939259879119162e-01   -2.364705094304851e-01; +6.744399969774977e-01   -3.093535209692524e-02   +4.950619840509575e-01   +7.487914140606401e-01   +1.362896251158360e-01   +2.298727937716946e-01   +1.714180215053103e-01   +5.372192526640371e-01; +1.521555681006412e-01   +3.661837441958513e-01   +4.026433325371548e-01   +9.247687333420862e-01   +7.609183264379448e-01   +4.397862625301021e-01   +1.007170676449654e-01   -1.090609961052898e-01; +1.375886657516886e-01   +2.212261106442509e-01   +3.601693471200541e-01   +8.301666053235892e-01   +8.782001603235275e-01   +1.358529402359133e-01   -2.510107544914009e-02   +3.726961113419397e-01; +3.417320512218753e-01   +6.303505867887180e-01   +8.660301950345362e-01   +7.161301297998648e-01   +5.666676032945743e-01   +4.139324923663464e-01   +6.410432660566573e-01   +2.429603495492614e-01; -2.115997840000454e-01   +2.677768409793990e-01   +7.934593417635656e-01   +5.107654483422078e-01   +8.329697311215445e-02   +7.899711447208135e-03   +6.843186060174762e-02   +3.434317277741950e-01; +3.804505430319596e-01   +5.151088558571342e-01   +3.878535136455202e-01   +3.137782415183457e-01   +4.375713960028718e-01   +3.081170941825218e-01   +5.135854410093422e-01   +8.588969628112031e-01; +7.726005193067548e-01   +2.207180306883881e-01   +3.144727829326264e-01   +7.701439834577876e-02   +3.223589916417868e-01   +1.244438838876545e-01   +6.208385577212101e-01   +3.448942810890707e-02; -1.864479313203151e-01   +3.336496794377417e-01   +2.212632876085674e-01   +5.829761651184170e-01   +1.209061098744933e-01   -1.241047774539618e-02   +5.744205709893530e-01   +3.474533251290965e-01; +4.245101786425602e-01   -3.950550510559507e-02   -2.359732990146809e-01   +6.003367980466432e-01   +6.041899110286253e-01   +5.568797827314914e-01   +2.694952363823448e-01   +4.365724841847247e-01; -1.155497117191128e-01   +8.804589881891285e-01   +7.628362745894074e-01   +4.462938595049425e-01   -1.094172766727150e-01   -2.060814543176808e-01   +9.986284444755524e-02   +5.798183916019922e-01];
L2I_L3I_iGABA_netcon = [-4.000484450217217e-02   +1.562115552675402e-01   +6.486967692968114e-01   +4.881371732491436e-01   -1.213652080104837e-01   +4.931024902255264e-01   +4.035088100719862e-01   -6.329985796686785e-02; -7.323969052023963e-02   +3.821483801235949e-01   -7.444901944728187e-02   -7.004151103562181e-02   +4.192258894587650e-01   +3.039698136269019e-01   +3.674519297870114e-01   +1.887900120960012e-01; +6.300415721375675e-01   +5.222792600034085e-01   +3.537412795812165e-01   +5.325547428824380e-01   +2.992812259246550e-01   +1.000000000000000e+00   +3.895331575611072e-01   +8.467664404437673e-02; +2.673755163586104e-01   +3.748676186337639e-01   +7.232255981453046e-01   -1.928068246425055e-01   +3.105797585318192e-01   +2.561282321441681e-01   +1.008753323503160e-01   +5.875187749743414e-01; +5.649302471135643e-01   +7.150356920111872e-01   +8.223269378417658e-02   +2.997080711274245e-01   +3.629391869036797e-01   +4.061004460032965e-01   +2.215520335058935e-01   -2.311588738964371e-01; +1.246450565151744e-01   +4.493587710276764e-01   +7.273020418399635e-01   -4.474228167412198e-01   +5.097458369986109e-02   +5.352463890084538e-01   +2.654384962407205e-01   -1.239148658902405e-01; +6.482940201442762e-01   +4.103646087332211e-01   +2.560789206736840e-01   +6.812073441920767e-01   +4.016590738576818e-01   +3.326825492192397e-01   +5.580043896737686e-01   +4.910251539440203e-01; -1.475494860632253e-01   +6.150692712503849e-01   -1.682756302804525e-01   -1.060517148066059e-01   +3.369335127549697e-01   +1.543064015861851e-01   +1.619749530523820e-01   +5.559076164999327e-01; -4.279496212510618e-01   +3.142834132433522e-01   +4.283562340812502e-01   +5.988978031118780e-02   +1.300424142220451e-01   +5.914838936693320e-01   +3.495333600048646e-01   +4.210668488970721e-01; +5.727153580784859e-01   -2.917057609917742e-01   +3.602474469358590e-01   +2.190422472200829e-04   +5.482833533671482e-01   +5.017933301422688e-01   -6.490003582324767e-02   +5.011935433435739e-01; +7.055678823841401e-01   +2.032520815923349e-01   +1.313443955530492e-01   -5.865156293324088e-03   +5.461639207691983e-01   -5.389576705922734e-02   +2.913884732702264e-01   +7.318104464687608e-01; -9.105826516187597e-02   +6.624033746035332e-01   -1.627639300261134e-01   +3.759742768236803e-01   +8.496347702380536e-01   +1.851977357528910e-01   +4.103059276708376e-02   +3.777453105735389e-01];
L3I_L3E_iAMPA_netcon = [+6.243352680418890e-01   +6.015810454086755e-01   +8.707069007315041e-02   +5.441407888984909e-01   +1.402316324558128e-01   -1.727503806928104e-01   +2.079809816218288e-01   +6.503330978137925e-02   +2.704771859066950e-02   +3.678032682579309e-01   +9.684441525796385e-02   +4.327166250023832e-01; +3.380040975208941e-01   +3.921921420109925e-01   +4.127182339383546e-01   +4.706134907987228e-01   +1.000000000000000e+00   +1.849619090476680e-01   +8.050358104360890e-02   +4.237757592554299e-01   +6.576377397054439e-01   +3.837937688865273e-01   +8.164923057516413e-02   +3.375802315102229e-01; +3.359885040275701e-01   +5.814380071427925e-01   +9.431151946490450e-01   +3.808665817584280e-01   +6.100639255461289e-01   +3.301441749211605e-01   +4.862254554857903e-01   -9.846903401896517e-02   +4.264281563957124e-01   +7.221808755547942e-01   +1.006898983145330e-01   +6.211987652603030e-01; +3.836090542888728e-01   +4.120146376516245e-01   +2.345205517822874e-01   +5.159971531668721e-02   +2.136228257119222e-01   +5.017111556531016e-01   -1.748613160249407e-01   +9.917672949596004e-02   +1.889377221258828e-01   +2.969165062565192e-01   +2.899131050733175e-01   +1.737409778758918e-01; +3.850099722699949e-01   +1.653076813287520e-01   +6.244812223487298e-01   +3.769361452961079e-02   +2.378308878082212e-01   +2.416062578780854e-01   -2.383112201818380e-01   +3.336679427065574e-01   +5.966668778014704e-01   +6.023271882908094e-01   +5.748053511365956e-01   +4.633401782212099e-02; +6.740879232741522e-03   +2.652976876990158e-01   +4.570752198290402e-01   +4.269167507557153e-02   +1.668445283954039e-01   +7.117122137593222e-02   +5.084021038283834e-01   +2.091062890067652e-01   +2.989312966795165e-01   -1.699628052394983e-01   +3.287075266900029e-01   +2.464136815857174e-01; +5.962590558272921e-02   +9.765193826116757e-02   -2.482188408665612e-01   +2.409871514382454e-01   +4.573378541729767e-01   +1.331169825240766e-02   +3.523940304899004e-01   +2.748399146614062e-01   -2.401382791623574e-01   +2.667859156952255e-01   +3.623429079911328e-01   +2.804385086079644e-01; +3.710350065286733e-01   +4.173462016671273e-01   +3.222905440328573e-01   +4.641730789235355e-01   -9.650919581870777e-02   +5.699591003768805e-01   -5.884687390593011e-02   +4.584777806370300e-01   +9.212442247759840e-03   -1.946409786001035e-01   -3.731587370114949e-02   +2.831050326797047e-01; +1.382849667125071e-01   +7.255843675696483e-01   +9.462621561663558e-02   +5.781062992617446e-01   +2.601332710828911e-01   +5.514752977701745e-01   -6.964554850213932e-02   +6.217973392231843e-01   +6.269815482910314e-01   +5.540724010617362e-01   +4.518207423268421e-01   +7.085368636051758e-01; +8.416531651132173e-01   -9.218941714397340e-02   +7.651256793570413e-01   +2.113424015870820e-01   +4.588575320780732e-01   -1.521337071434489e-01   +3.993534425429278e-01   +2.058088002584391e-01   +2.513937151791648e-01   -9.454319468731988e-02   +6.961484300781660e-01   +8.385777828248248e-03; +1.180421173040571e-01   +3.566085076667289e-01   +5.171608713202785e-01   +3.612216998407278e-01   +6.249529299077743e-01   +1.197045488203537e-01   +2.366182039642191e-01   +4.429124923333704e-01   +7.471044561670911e-01   +2.596204855521930e-01   +4.274506910175996e-01   +5.911783590721497e-01; +2.221391248058915e-01   -1.228100824714450e-02   +4.614068812183913e-01   +4.949166963868787e-01   +1.757804303799160e-02   -2.040539680911000e-01   -5.800420872130830e-02   +3.514242865029031e-01   +6.909986858392207e-01   -1.451176325931958e-03   +4.444439779553488e-01   +2.092465604604762e-01];
L3E_L3I_iGABA_netcon = [+7.031170344597772e-02   +7.116700225761493e-01   +2.403203192497434e-01   +3.429380331051584e-01   +5.431097277982361e-01   -4.867774925084613e-02   -1.644672007466219e-01   +2.856013587284633e-01   -4.460596177422561e-02   +3.651377758297358e-01   +3.394791528610971e-01   +1.899453998189658e-02; +4.336074869139054e-01   +2.944851472486982e-01   +4.917666703108808e-02   -9.131070853786458e-02   +2.951656597384499e-01   +1.564249287321628e-01   -1.050323645815443e-02   +3.079905280935861e-01   +2.458577821530043e-02   -1.869168370865991e-02   +3.161336743825608e-02   +1.071861585324803e-01; +4.354664908418777e-01   -8.764560490565482e-03   -1.369520815985465e-01   +2.115234947015177e-01   +4.501163077293187e-01   +4.046938529011859e-01   +3.922487787523640e-01   +2.648022874667825e-01   -2.145219852436570e-01   +2.816593145896321e-01   -2.239128645279172e-01   -1.022083001206601e-01; +3.089964175708234e-01   +3.327284933938937e-01   +6.789191600530878e-02   +1.494404408924867e-01   +5.917093678282171e-01   +3.204803729828792e-01   -1.697229972542595e-01   +1.984955928304746e-01   +7.352083685219901e-01   +4.596324285650816e-01   +1.939439734924691e-01   +2.528945189370121e-01; +2.795018337016860e-01   +9.588742123490737e-02   +2.401422832704981e-01   +6.551235077836794e-01   +5.746592062415510e-02   +4.256496775119177e-01   -2.854750007035720e-01   +4.808103660044368e-01   +4.588910307502382e-01   +5.054415540213425e-01   +2.929639656214849e-01   +1.571052994469041e-01; +3.952535414187154e-01   +1.770306278869017e-01   -2.497849763486272e-01   -2.607539009137392e-01   +6.613722318251762e-01   +7.200031075365552e-01   +2.411510482002935e-01   +4.129064848180508e-01   +5.553019149659553e-01   +4.603371384374320e-01   +3.467167084851334e-01   -3.388743446198459e-02; +8.042120134300081e-02   +3.375619273894962e-01   +4.566164652244495e-01   +1.000000000000000e+00   +3.204662156156896e-01   +6.649349873669945e-02   +5.192418257231837e-01   +6.239638632065659e-01   +1.917686512623738e-01   +4.528300890812093e-01   +5.658436669938492e-01   +8.025371053680092e-02; +1.361437390160978e-01   +2.479757018916825e-01   +4.505512894082967e-01   +4.940306204555961e-01   +4.315382486230134e-01   +2.915686999267732e-01   +2.662106840083038e-01   +1.800593259223254e-01   +2.047606801867191e-01   +4.731829192342588e-01   +3.310724258163005e-01   +2.770179258652199e-01; +2.111588764127762e-01   +4.986632435592748e-01   +1.097316855295416e-01   +1.090269811633929e-01   +3.851991365438322e-01   +2.831337825610634e-01   +5.256544304020713e-02   +2.703773001302641e-01   +6.174496622013885e-01   +6.890087098319011e-01   +5.160471976818293e-01   +3.073834422660356e-01; -2.539301231683564e-01   +6.904938150871663e-02   +5.619605847772118e-01   +1.386186796908806e-01   -3.861877958453254e-02   +1.559968600763849e-01   +3.373332855715121e-01   +2.443473098955643e-01   +3.151566550782256e-01   +1.662432874197420e-01   +3.077155575969004e-01   +5.484018599007552e-01; +1.523365432655669e-01   +2.616558830054643e-01   +1.740218165110409e-01   -3.251107907656166e-02   +3.654959964065595e-01   +2.304753942768125e-01   +3.823853887659948e-01   +3.883377841821759e-01   +2.050928287092278e-01   +4.919834667054049e-01   +2.238819223075005e-01   +1.294492211645073e-01; +3.247294374649581e-01   +4.249720282492233e-01   -2.880401038046747e-02   +5.205337477826635e-01   +7.940259751763763e-01   +6.088902314924488e-01   +5.468715462829505e-01   +1.963566268181621e-01   -4.319125493668656e-03   +2.761564841930910e-02   +4.564875368021967e-02   -3.745595233254537e-02];
L2E_Input1_iAMPA_netcon = [+5.191699563885993e-01   +7.149299238455906e-01   +9.054872760807438e-01   +8.434381170602662e-01   +8.737592273480471e-01   +9.108054662088568e-01   +7.343749609970173e-01   +9.960819721896796e-01];
L2I_Input2_iAMPA_netcon = [+6.739503493774494e-01   +6.073368608216825e-01   +6.286389089817290e-01   +5.164993346654323e-01   +3.803152097569869e-01   +1.000000000000000e+00   +5.100217348551829e-01   +5.117209747272824e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.2*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.2*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.2*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.2*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.2*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.2*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.2*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.2*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
