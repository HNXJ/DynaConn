function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+7.140966490555265e-01   +9.462044821637747e-01   +6.984714497536185e-01   +1.547255439415294e-01   +9.216850756201367e-01   +2.198440509996959e-01   +7.406769454037333e-01   +3.026847871208308e-01   +5.330685165648623e-01   +8.290973967525984e-01   +9.684316279224606e-01   +9.642515118313044e-01   +6.961664905496960e-01   +3.715663093193398e-01   +2.974635736701028e-01   +3.778931524345950e-01; +3.457467257906379e-01   +1.327226729889305e-02   +1.414721938426133e-01   +1.761569505954878e-01   +7.089379609108344e-02   +8.076083443278724e-01   +7.945223523507545e-01   +7.590722385327423e-01   +7.845738939253638e-01   +1.811469601172447e-01   +4.661730361356883e-01   +6.557526357407478e-01   +3.762258735984770e-01   +2.754981346227505e-01   +6.850142864336498e-01   +9.534508473437152e-01; +2.078529293932786e-01   +4.678256942629589e-01   +8.344466882549166e-02   +7.030817503331133e-01   +3.135239193069095e-01   +3.816183053374268e-01   +6.634575267968194e-01   +9.532604525674347e-01   +4.868993229947753e-02   +9.262722859201136e-01   +8.693909730779559e-01   +2.093067655631614e-01   +5.416449906795084e-01   +7.516976621193620e-02   +7.728965711575067e-01   +8.117887538083451e-01; +2.467970853811797e-02   +4.895451450592346e-01   +4.328252540208942e-01   +8.322569214684022e-01   +6.283147182860468e-01   +8.564591298991151e-01   +4.411898839947961e-01   +8.468433407480809e-03   +4.621426688278496e-01   +4.206336868994431e-01   +9.464658143499436e-01   +8.972454624582119e-01   +5.183468313954515e-01   +1.507577126754134e-01   +7.205859025432769e-01   +8.920683857822167e-01; +7.659838123469823e-01   +5.158208118241000e-01   +8.949734242135197e-01   +8.151940015452125e-02   +9.057782650077819e-01   +3.230724014323150e-01   +5.753250502469935e-01   +4.068266699366453e-01   +9.377761039394855e-01   +3.002406835245836e-01   +2.322263035972116e-01   +4.879530430772503e-01   +7.639152251031535e-01   +3.650322674192958e-01   +2.781675210359107e-01   +6.871922263731642e-02; +5.710357950750863e-01   +2.869995009823365e-01   +7.320282502605550e-01   +8.346487041513114e-01   +7.967088246341616e-01   +3.790346172189504e-01   +5.183836171722600e-01   +1.519458712588233e-01   +4.733471668635226e-01   +3.486286357218382e-01   +9.180095120480256e-01   +6.621647686239798e-01   +8.016501338583858e-02   +7.173373815819275e-01   +1.398470468621676e-02   +9.023104041902364e-01; +5.765055274426870e-01   +5.647595974683585e-01   +6.804953880818391e-01   +5.414742839609404e-01   +6.429768150821576e-01   +6.368216140930260e-01   +7.249136307920203e-01   +8.216079598338045e-01   +7.785761750396925e-01   +9.714387926138928e-01   +6.345886627640406e-01   +5.261361056113528e-01   +5.057418721521838e-03   +5.319446866713933e-01   +1.501469272739215e-02   +6.675538462438287e-01; +3.902432887534277e-01   +5.098891489005907e-01   +2.017301529161372e-01   +9.623562119689635e-01   +4.402968793320815e-01   +3.871945121169580e-01   +2.226050902064388e-01   +2.877495776446264e-01   +1.094703958260250e-01   +5.306378146680764e-01   +2.848183993204328e-01   +7.089295197411976e-01   +4.006475524424664e-01   +2.322822956642011e-01   +9.365863612831546e-01   +3.468930965577337e-01; +5.566436759684487e-01   +6.783548751676161e-01   +5.297975164433848e-01   +6.774945134203969e-01   +7.484550602883437e-01   +6.735072323704484e-02   +9.978259922823646e-01   +9.779984546051054e-01   +5.217985236420861e-01   +7.899836361383094e-01   +8.555673670441755e-01   +7.185172974080619e-01   +6.627476317961511e-01   +4.707534363860653e-01   +9.339744685300250e-01   +8.368577610079289e-01; +1.830931875439938e-01   +6.157002673146309e-01   +8.304700404514428e-01   +3.363427846418450e-01   +8.253474218714340e-01   +1.726985386081191e-02   +6.196937542281815e-01   +6.258140675864585e-01   +6.358910544834374e-01   +7.945790597681878e-01   +1.659002935398979e-01   +2.942712347350060e-01   +3.683952516904206e-01   +7.169304741415853e-01   +3.739044486151408e-01   +1.989420877803933e-01; +1.183688314643450e-01   +5.653542941218834e-01   +1.752610839906621e-01   +2.207052863756261e-01   +3.413844845962620e-01   +8.791900944252119e-01   +9.800575856274711e-01   +7.433190054147524e-01   +5.784751892076450e-01   +1.443953310211147e-01   +8.275564376069349e-01   +1.169322419560822e-01   +3.925689902323255e-01   +5.141756020604762e-01   +1.087207798820440e-01   +8.413400020157280e-01; +5.907102198399237e-02   +5.049992604022685e-01   +5.179272768867396e-01   +5.684942722446511e-01   +1.391866216700344e-01   +1.577308397261188e-01   +4.958537854050312e-01   +8.722141999723030e-01   +8.355322601594369e-01   +4.567148628160932e-01   +2.169931172462460e-01   +3.250070662660209e-01   +1.345588470193181e-01   +5.133379320297971e-01   +7.195590622974590e-01   +4.244274360284860e-01; +9.328129087262702e-01   +6.677066863244431e-01   +3.564301035557768e-01   +2.517155708006127e-04   +5.042611916270505e-01   +9.137628366148317e-01   +5.224397236411538e-01   +3.293938339366352e-01   +1.153731182308791e-01   +4.584038990751733e-01   +2.675926586201477e-01   +4.572072132403320e-01   +3.382356825763522e-01   +3.858872079068681e-01   +4.489667150325666e-01   +5.583644555727585e-01; +7.455282456747322e-01   +6.332469267778901e-01   +6.456407494132973e-01   +5.887874905925398e-01   +4.139072787580337e-01   +5.564628879767600e-01   +8.540114015230373e-01   +9.849683814908004e-02   +5.136486273885754e-02   +9.545373140047582e-01   +8.665338375167952e-02   +7.164825464464760e-01   +1.229934414417128e-01   +4.785683365241369e-01   +1.268151684887720e-02   +4.475600116175262e-01; +2.434380591665260e-01   +1.443631439379479e-01   +2.816023215173915e-01   +8.909977324495016e-01   +1.717396070155216e-01   +9.223617948299803e-01   +2.537394243391804e-01   +4.503627253311421e-01   +5.177974507669680e-01   +5.305284833651239e-02   +9.166037072639580e-01   +4.054144933620310e-01   +3.684585442010175e-01   +7.396482477097438e-01   +1.240238881201007e-01   +7.601513413872314e-01; +2.043565514083145e-01   +1.786945416686686e-01   +4.368281759618758e-01   +2.546078013779255e-01   +4.944702705785515e-01   +5.975648233058006e-01   +5.822964506158586e-01   +2.396487999609597e-01   +6.967664510506515e-01   +3.603800365483460e-02   +7.259937505229879e-01   +2.421378424556827e-01   +2.504759187866276e-01   +7.012992121703502e-01   +6.589559935555007e-01   +9.538094487369134e-02];
L1E_L1I_iGABA_netcon = [+8.434519058764617e-01   +7.521184455569869e-01   +8.744789162105874e-01   +4.357801084983507e-01   +9.180826858589670e-01   +7.793682416084530e-01   +3.219230006045133e-01   +6.411255854028773e-01   +9.418088663639961e-02   +2.630984070076175e-02   +1.292729224871490e-01   +5.198149796391762e-01   +8.695607987702071e-01   +5.759892275320407e-01   +1.659464688080714e-01   +6.274932979628580e-01; +6.210147458636126e-01   +9.953305293274405e-01   +3.092470944340497e-01   +1.473910562952059e-01   +8.830779049966049e-01   +2.731415684192589e-01   +9.629513986146944e-01   +4.295248753250012e-01   +2.929706558615152e-01   +5.140350042319822e-01   +4.244226933607549e-01   +2.042197156882568e-01   +8.026057318273748e-01   +2.883653350109092e-01   +5.472790059034170e-02   +3.366810040235428e-01; +6.711658985025918e-01   +3.711101118662645e-01   +4.330063986354462e-01   +6.543821378735921e-01   +5.856411126273561e-01   +5.267994425618511e-01   +3.522948158570313e-01   +4.782551091448696e-01   +3.266934035261920e-01   +8.626029008586390e-01   +4.810788178223384e-01   +7.751873399374597e-01   +6.464348164097576e-01   +1.318504582190881e-01   +2.116254723032939e-01   +1.567446723588899e-01; +7.820585796860556e-01   +5.031353278907759e-01   +3.818178738371015e-01   +7.213030075650945e-01   +8.356047882884928e-01   +4.030474451465337e-01   +3.202526723054668e-01   +9.989109279037857e-02   +4.830134121370691e-01   +5.818541672008934e-01   +6.739712040063657e-01   +3.911064304241348e-01   +7.345849303717922e-01   +5.028661682558350e-02   +2.041495182008948e-01   +4.018772104823389e-01; +3.091938059523140e-01   +7.580764841792087e-01   +6.568731391362806e-01   +1.619366164786578e-01   +7.759231651416820e-01   +7.794184268349706e-01   +9.089400752918396e-01   +8.064670130872211e-01   +2.414864583083631e-01   +4.219645150570289e-01   +3.570432985524593e-01   +6.676992942394083e-02   +6.668015391714193e-01   +6.238033531883633e-01   +2.179817654392011e-01   +9.128574028088711e-01; +3.295721296086216e-01   +1.267386721776385e-01   +2.374282680779763e-01   +3.429797520376025e-01   +7.855846191360248e-01   +2.570842855035634e-02   +8.854240229204183e-01   +6.491561362709314e-02   +4.539185614078915e-01   +7.134949800135989e-01   +4.947696138251002e-02   +7.561904475720060e-01   +8.810166684371934e-01   +6.051105528519120e-01   +5.783215096942499e-01   +1.489606458975756e-01; +6.338548431526541e-01   +5.182305088821024e-01   +6.860761740035825e-01   +1.061227184581594e-01   +7.011152369910337e-01   +4.114149939495032e-01   +3.529876073805270e-01   +9.546584196559595e-01   +7.585069060812535e-01   +2.336327622481170e-01   +2.905080655374991e-01   +4.533334900024836e-01   +8.528935711474454e-01   +3.713547952607232e-01   +3.356752353715812e-02   +4.641877198838090e-01; +9.021670731547656e-01   +9.059085067083594e-01   +3.265002181772653e-01   +4.129175517326032e-02   +1.814788277631777e-02   +8.262440699598534e-01   +7.502396933556880e-01   +7.737702018253683e-01   +7.179281344027990e-01   +5.951673771218859e-02   +7.943452627751144e-01   +3.196563862273971e-01   +4.035698827025685e-01   +8.316357618374813e-01   +7.952827678800362e-01   +7.789683206335510e-02; +3.716129565297535e-01   +9.902460546413266e-02   +8.805410749114133e-01   +4.784160964107796e-01   +3.304475831217661e-01   +5.928704717143662e-01   +1.266968834193738e-01   +4.405521383257574e-01   +2.383460560873703e-01   +9.765470342173267e-01   +6.515327327246602e-01   +2.773389978297622e-01   +1.051096902199414e-01   +5.199974670643406e-01   +1.349961467762791e-01   +3.424031008776209e-01; +8.816258337986371e-01   +1.789731899317109e-01   +9.989932753319377e-01   +4.773719413733259e-01   +9.473541563126885e-01   +2.128944084954168e-01   +5.993462565051978e-01   +1.655004070345412e-01   +6.988889549144691e-01   +9.694379349108699e-01   +7.095222465372247e-01   +5.842752655921876e-01   +4.036940169973670e-01   +8.009437963486677e-01   +5.826786570032064e-01   +4.956490346675270e-01; +1.242781266812636e-01   +1.730253538080355e-01   +6.811393720753198e-01   +5.458785956415155e-01   +3.988145152340180e-01   +2.967837055217826e-01   +4.366496985295484e-01   +8.094532363298156e-02   +3.059661125808593e-01   +1.369034653256860e-01   +7.648003743096197e-01   +9.118543487047720e-01   +3.406312626904778e-01   +5.701010843417230e-01   +8.576903543504774e-02   +4.897486630891528e-01; +8.821319650294571e-02   +5.342930619428594e-01   +3.449968772016022e-01   +6.521936925129102e-01   +6.316721848836796e-01   +2.683519007127432e-01   +9.588161843412745e-01   +7.420510757637699e-01   +4.693727861792563e-01   +1.184498955051493e-04   +3.845004224132964e-01   +4.513785718837990e-01   +1.145425683110367e-01   +7.146787652413380e-01   +2.284576217327917e-01   +1.274235833342783e-01; +5.461268218256633e-01   +9.794275990882640e-01   +5.607885812896496e-01   +3.487952793511992e-01   +8.593775397735274e-01   +9.285379732461426e-01   +9.645689716064956e-01   +5.440586468497787e-01   +4.443214366716079e-01   +9.362821938348065e-01   +3.616671817275928e-01   +9.805936015990827e-01   +8.522641079578835e-01   +7.331340950756844e-01   +4.525011078312540e-01   +8.552466872411897e-02; +6.104407544632822e-01   +8.432129704517096e-01   +8.905680672313629e-01   +2.563228696784386e-01   +3.768699668687103e-01   +5.531125445392601e-01   +2.423098634680004e-01   +4.856276517362091e-01   +7.340943826437081e-01   +7.405265446005677e-01   +8.105542764106839e-01   +1.108169984586337e-01   +8.917438982745461e-01   +4.547693831445088e-01   +1.795001252837760e-01   +6.736860683395933e-01; +7.276208517141259e-01   +6.727890398187814e-01   +6.465785129263557e-01   +1.763661944868830e-01   +2.044142826303849e-01   +4.331566609589190e-01   +7.704532561568116e-01   +8.954802531815989e-01   +8.755428152513334e-01   +4.333246678545379e-01   +3.850549358952837e-01   +4.160178326124243e-01   +6.858170298529119e-01   +2.829404786623956e-01   +4.151106899334388e-01   +1.219558569745855e-01; +9.911955522189428e-01   +8.453977472828377e-03   +3.770149144966644e-01   +4.778729652518417e-01   +9.117635556002788e-01   +3.282432590591091e-01   +7.125476451825252e-01   +5.829972359079412e-01   +9.129920864006722e-01   +9.437008824518142e-01   +8.714018703172599e-01   +3.828460838931417e-01   +7.424600307444099e-01   +1.518101651199353e-01   +9.653206323894858e-01   +9.894454353902690e-01];
L2I_L1I_iGABA_netcon = [+5.746892156622365e-01   +5.645756233481904e-01   +1.083912384151383e-01   +4.594665729804102e-01   +7.965497787005453e-01   +9.785125748551289e-01   +2.238417591160382e-01   +7.586793958652303e-01; +5.580735124621858e-01   +9.529218776892044e-01   +1.192017243576501e-01   +5.677817390737975e-01   +5.420783139626483e-01   +4.227664443390781e-01   +6.583975097056810e-02   +5.061125715099538e-01; +6.111416150330471e-01   +9.041304197726760e-03   +4.336391026878214e-01   +8.178206491619227e-01   +2.570775944128246e-01   +3.932645911000569e-01   +8.354415024152531e-01   +8.277756816202060e-01; +4.668497173587212e-01   +1.265092152558872e-01   +9.327415543382721e-01   +3.548062828875335e-01   +7.817562231118254e-01   +4.605663979469929e-01   +4.134182040082948e-02   +9.276135272922765e-01; +4.344324459276105e-01   +8.531394643644795e-01   +1.401090785453732e-01   +2.485110259281455e-01   +7.787551479347747e-01   +1.208713057837912e-01   +9.096347538471738e-01   +7.104237425613564e-01; +6.296930989911591e-02   +2.179365303852296e-01   +8.263747347852481e-01   +7.710607085341328e-01   +1.444181856512140e-01   +4.548761254518227e-01   +4.502920847651874e-01   +7.977313746106011e-01; +6.465001464870976e-01   +7.098617530730510e-01   +9.326765073625506e-01   +2.263429333943152e-03   +8.230861964369065e-01   +2.656098541743805e-01   +2.852462968783033e-01   +9.578833269578880e-01; +4.258972175441387e-01   +7.745881395888526e-01   +5.730031393598775e-01   +2.761815436082479e-01   +6.231407938040012e-01   +9.289989915388412e-02   +7.548059662016599e-01   +9.512005577330070e-01; +7.561601721853208e-01   +4.210294414286395e-01   +4.986288610568130e-01   +2.360272017374965e-02   +4.574293434248391e-01   +6.619967508646450e-01   +9.265370757525903e-01   +2.955808692189977e-01; +3.069715174718670e-01   +7.252625366926229e-01   +9.310947526421189e-01   +6.700068776785917e-01   +4.842130421691290e-01   +9.453201163987581e-01   +1.415276024553698e-01   +3.520964409277517e-01; +5.983197894215001e-01   +4.579912645606981e-01   +8.619559451588445e-01   +9.673671960157901e-01   +2.194146436286442e-01   +7.647986678976657e-01   +9.558665013633078e-01   +5.411471477149582e-01; +3.345914464893261e-01   +8.046335539314897e-01   +2.532117396552126e-01   +9.452438970456503e-01   +8.577813443190682e-01   +4.282505931201094e-02   +3.038622944935007e-01   +2.135083378783910e-01; +6.434228065729892e-01   +4.277503118575183e-01   +4.588824389297195e-01   +4.727315948850708e-02   +8.800140658308681e-01   +2.618320278084620e-01   +2.094289476243525e-01   +8.110823601935084e-02; +1.474780063751333e-03   +1.486201926816021e-01   +7.404119216437686e-01   +2.864493630738204e-01   +8.455132145299598e-01   +6.346934137416750e-01   +4.641983446944212e-01   +5.066807458436596e-01; +1.445278948343496e-01   +8.047220788976818e-01   +7.522896433942284e-01   +4.872035735839971e-01   +4.428478843429554e-01   +8.992621395815284e-02   +5.971473990903028e-01   +1.950654669492531e-01; +2.477268575115164e-01   +3.816809709745693e-01   +2.306461804374460e-01   +8.867432399074043e-01   +5.432564494542805e-01   +7.470702660322526e-02   +5.524554498010075e-01   +1.447969696669856e-01];
L1I_L2I_iGABA_netcon = [+6.985362940657236e-01   +8.674862567292362e-01   +6.136632678749515e-01   +5.480097837493433e-02   +1.428988983694635e-01   +2.349535393458941e-01   +8.386479142981196e-01   +3.708507521440385e-01   +7.062965502871195e-01   +3.843077581219335e-01   +2.390261407438765e-01   +6.665845052207235e-01   +1.674883818937524e-01   +5.700183380983960e-01   +4.398530101564225e-02   +4.935049929692485e-02; +5.974844617276427e-01   +7.979532064554304e-01   +6.107089153827426e-01   +5.745915444901160e-02   +7.446229771766771e-01   +5.564221377442067e-01   +1.975998386510849e-01   +5.592647085449649e-01   +1.870557951565680e-01   +7.198892456672614e-01   +5.129840465751149e-01   +3.297948620107822e-01   +1.157724898786124e-01   +8.093613102171463e-01   +4.422837370476690e-01   +9.212849595465329e-01; +1.625937510288465e-01   +6.273387143728438e-01   +3.136114598396347e-01   +5.972238567457975e-01   +9.510411938740935e-01   +1.137353052398018e-01   +6.171448212705771e-01   +8.301179697185046e-01   +2.308832393984514e-01   +6.411167478234315e-01   +7.321221101196054e-01   +5.515737825996181e-01   +7.366569865737885e-01   +6.735050000665987e-01   +9.169255928655415e-01   +1.738168578404664e-01; +4.826698672494412e-01   +4.719350061065152e-01   +1.421273056718068e-01   +6.571273946581779e-01   +2.658238075989673e-01   +8.185593012096148e-01   +1.546858921106631e-01   +7.077256616315523e-01   +9.984102656535475e-01   +1.008134430394225e-01   +7.713160302129949e-01   +5.322142737560582e-01   +2.108345555615915e-01   +4.437672404706190e-01   +8.842704256955491e-01   +7.438062622918605e-01; +2.857918037903910e-01   +1.966139177208860e-02   +6.047762501759522e-01   +4.795935970929456e-01   +9.532384230554503e-02   +6.504988510247411e-01   +5.836573695548071e-01   +1.157388001734549e-01   +9.051785522046006e-01   +4.920206946066794e-01   +6.765614855743352e-01   +9.016598374217426e-01   +4.839966447047135e-01   +8.936844198705639e-01   +9.259145790031748e-02   +4.757721892628278e-01; +4.032800891175108e-01   +1.177173745356052e-01   +8.900863729385510e-01   +9.787372235453262e-01   +2.307415113579518e-01   +2.374983341675816e-01   +5.452279964752474e-01   +7.401259924733538e-01   +1.157018986991804e-02   +5.624566406115761e-01   +8.129030370463579e-01   +2.842369353860533e-01   +5.077814769803770e-02   +7.835300089375965e-01   +6.755014903186920e-01   +2.464267883085142e-01; +4.905689598009126e-01   +7.193116462797258e-01   +5.624818454473165e-01   +8.635696723314205e-01   +8.959271771639445e-01   +3.016874412900196e-01   +6.819534312836649e-01   +9.242311454291401e-01   +8.343783869772446e-01   +5.610554371930908e-02   +4.184612044021348e-01   +1.393043161891029e-01   +5.712699784670914e-01   +5.818120306633573e-01   +9.377342480323098e-03   +6.629303834992020e-01; +8.621634132375193e-01   +6.824488034211657e-01   +6.328920765535548e-01   +9.539228295766964e-01   +1.994179085098479e-01   +3.304618412905070e-01   +6.987005469618708e-01   +9.231710678131680e-01   +2.523044463910832e-01   +8.965780585547563e-02   +4.977640641968371e-01   +9.572314251408492e-01   +4.913550187215580e-01   +6.162365630542492e-01   +1.208461431024202e-01   +6.089146802895047e-01];
L2E_L1E_iAMPA_netcon = [+3.677963468434978e-01   +5.624389263691855e-01   +2.006186784114799e-01   +5.147429755316331e-01   +2.898763090400890e-01   +7.476158789418738e-02   +2.782122690794678e-01   +2.665119006419664e-01; +4.375061319491500e-01   +1.928001917164440e-01   +1.371118882599986e-01   +6.851662227482866e-01   +6.200273993874040e-01   +5.941909505708806e-01   +9.286317417816317e-01   +9.045559409409499e-01; +7.179991811723788e-01   +6.136222615688439e-01   +8.188782437000793e-02   +2.072717617807033e-01   +8.628132320651399e-01   +7.673422533767602e-02   +7.637838363415381e-01   +1.595487102970767e-01; +1.914608324978455e-01   +7.404907746121119e-01   +9.118017648626425e-02   +9.718650442225134e-01   +8.208537821831150e-01   +3.973208421023220e-01   +2.628704564148717e-01   +5.541668424153863e-01; +4.042336614479620e-02   +8.319827187040866e-01   +5.518080341957929e-01   +3.507161902117391e-01   +2.060594030673424e-01   +5.971200360105292e-02   +2.425426777061681e-01   +4.228996842711530e-01; +3.150958348019063e-01   +2.776694609558714e-01   +7.316135468503615e-01   +1.842002902276075e-01   +7.507541245961684e-01   +1.288437177549725e-01   +1.656755889349332e-01   +5.476089918527393e-01; +7.898909774826509e-01   +6.079738793887752e-01   +5.440197331469490e-01   +2.383700463136998e-01   +1.988147407515991e-01   +2.441624644714306e-01   +2.877375776362726e-01   +7.545227764680644e-01; +4.746276577434313e-02   +5.475236907488473e-01   +5.498775559741498e-02   +2.543453012853245e-01   +5.776745890964891e-01   +9.435307890909107e-01   +5.642837298927830e-01   +1.331739866860946e-02; +2.158608584139526e-01   +2.745528179247668e-01   +6.329143783336078e-01   +2.223911990395645e-01   +8.767182074247438e-01   +2.033847355120997e-01   +4.047756754225409e-01   -8.342321022657156e-04; +2.740110678894890e-01   +3.401942576629964e-01   +9.945863238471347e-01   +3.573864325984417e-02   +7.139797550858891e-01   +3.271069916777354e-01   +9.862254587257328e-01   +2.130680258703212e-02; +7.892766920598006e-01   +5.666093616775602e-01   +9.149251018400617e-01   +3.565017057638204e-01   +7.004903916739937e-01   +8.665291960205678e-01   +5.445448352845061e-01   +3.592748403381578e-01; +9.905140219887670e-01   +7.435739300664063e-01   +7.684184452553015e-01   +8.990690561755065e-01   +4.678189804929853e-01   +9.228109352359017e-01   +9.286701928805026e-01   +4.262186503431412e-01; +9.466329692363830e-02   +7.716740679537094e-01   +1.917901763811558e-01   +1.396423273382094e-01   +5.046524831730143e-01   +2.329383805092650e-02   +9.918092385758256e-01   +5.453238277269601e-01; +1.958175774993650e-01   +3.983940779474410e-01   +3.227415383497369e-02   +9.553177450896966e-01   +7.968096629472421e-01   +3.642532952593895e-01   +8.355820403226150e-01   +4.925601674656407e-01; +1.165640435984140e-01   +1.488200852212732e-01   +3.736067274506005e-01   +9.021247466629702e-01   +9.397668695016596e-01   +5.279162723852934e-01   +1.804602106867359e-01   +9.206944632956389e-01; +6.475165657905627e-01   +2.080926187503547e-01   +5.751429592915910e-01   +4.098267877458026e-01   +7.819897553839701e-01   +4.064347801680697e-01   +3.137288117862742e-01   +4.160830036061345e-01];
L1E_L2E_iAMPA_netcon = [+4.968922450864470e-01   +4.499278737376822e-01   +6.163860406573083e-01   +4.906342250703702e-01   +2.302426682792345e-01   +7.217370262014056e-01   +6.943560406325662e-01   +6.326647654981105e-01   +5.226153801499781e-01   +2.407359447715697e-01   +8.770877718471055e-01   +1.742325543985025e-01   +1.372472886014858e-01   +2.432762301709434e-01   +1.835652533885951e-01   +2.337619524879231e-02; +8.380436557403615e-01   +3.693219166923017e-01   +1.031095698636572e-01   +6.616644556685268e-01   +8.361109746966540e-01   +3.808161633593966e-01   +9.800688599480499e-01   +6.265668179371945e-01   +6.727498351876452e-01   +7.290564935982510e-01   +6.584806312179542e-01   +3.028204564092105e-01   +2.828504133302060e-01   +7.484236310143276e-01   +1.462954482377415e-01   +2.512618218943883e-01; +1.850667173556900e-01   +3.003096949072382e-01   +7.521221869661938e-01   +1.782918609752372e-01   +7.344042926206451e-01   +3.841551455609057e-01   +7.502795191519980e-01   +4.075158492760283e-01   +7.771470105651352e-01   +1.360956125493033e-01   +5.376942885618167e-01   +1.092117879904848e-01   +6.910399788281558e-03   +9.366931851968812e-01   +1.324636266347647e-01   +9.891130372346290e-01; +3.366553305012386e-01   +2.329988449365242e-01   +5.368326612911581e-01   +4.785298840798954e-01   +4.893689104416199e-01   +7.154720477316816e-01   +5.529675326873638e-01   +4.252962709708091e-01   +4.634295906593089e-01   +4.080240154045309e-02   +2.521531566626968e-01   +4.511543930042675e-01   +3.058155752718024e-01   +2.966993626301932e-02   +1.720517112602739e-01   +6.293442076299448e-01; +6.929564178842174e-01   +1.371012953665667e-01   +4.439506537478694e-01   +4.990556023658239e-01   +8.486522414596077e-01   +8.387453070267556e-01   +2.935159833170174e-02   +5.101448285232306e-01   +9.076846043871014e-01   +6.501033286704406e-01   +1.054244450809590e-01   +5.842747492159838e-01   +9.048155187837453e-01   +4.351642097969899e-01   +9.225436458510693e-01   +3.582240968613451e-01; +6.926186897498101e-01   +9.982161897366494e-02   +7.435002421268536e-01   +6.006558031768466e-01   +7.148193808339248e-01   +6.680615634160160e-01   +1.951875869211608e-01   +2.595048851846676e-01   +2.541464518650198e-02   +2.001196642523313e-01   +9.714832515996751e-01   +2.247816665713615e-01   +2.939664265213635e-01   +8.314831851892088e-01   +2.591954475345638e-01   +9.401516637092083e-02; +3.678946750719005e-01   +2.269359249395205e-01   +3.875403333411154e-01   +2.406017314193597e-01   +5.222370989126249e-01   +6.506416860887273e-01   +9.417217834033370e-01   +4.231027845173796e-01   +4.804118394054238e-01   +9.731889897504764e-01   +5.972033444258903e-01   +1.106474544286657e-01   +8.332997238954473e-01   +9.993506563700888e-01   +2.057395783246642e-01   +4.091177386964545e-01; +3.418942495577246e-02   +3.463528570149099e-01   +5.262354085572278e-01   +5.173080706801216e-01   +9.376734833092097e-01   +5.639680191554673e-01   +3.971574797792868e-01   +5.231997859703543e-01   +2.712465880496663e-01   +8.207771804374986e-01   +8.191957328192062e-01   +5.611938066821913e-01   +7.455526769281561e-01   +9.203379600380356e-01   +6.136249143098383e-01   +9.311035068701617e-01];
L2I_L2E_iAMPA_netcon = [+6.777113044516134e-01   +6.143690766157081e-01   +4.200014797731537e-02   +7.927012277460369e-01   +5.237500682219114e-01   +8.259761600623035e-01   +6.440740830495476e-01   +3.863643480517233e-01; +2.304968675597451e-02   +9.451684593625006e-01   +5.471575823831933e-02   +9.300915421816054e-01   +5.354934351289883e-02   +1.081263994879276e-01   +3.979229794038158e-02   +1.672209474264918e-01; +7.341956337246690e-01   +9.643877788424817e-01   +4.014630913957921e-01   +9.365487915747772e-01   +2.873821094809162e-01   +2.310078892832974e-02   +5.679790847407392e-01   +4.441478886446744e-01; +2.138498393081404e-01   +3.694742018974132e-01   +9.839766735162275e-01   +1.463146277010613e-01   +7.095548927912124e-01   +1.237938024708141e-02   +3.047465595567865e-01   +8.732046507106066e-01; +8.608616561902125e-01   +7.951712511046801e-01   +7.122840179951737e-01   +3.198169532269085e-01   +8.783083438035693e-01   +3.363917118201859e-01   +2.608755354353983e-01   +4.116613787531800e-01; +1.569261714942018e-01   +7.287060327011589e-01   +9.888529497927063e-01   +4.286281039783660e-01   +3.656552993917337e-01   +6.639635677707814e-01   +7.218104966943255e-01   +1.626549535298071e-01; +6.685992618026639e-01   +9.539172493358317e-01   +6.457591662426998e-01   +7.020234695457374e-01   +5.605335631781792e-01   +5.951780243194732e-01   +3.054558416045528e-01   +6.619388837904421e-01; +9.353450089365978e-01   +1.100675575082424e-02   +5.019657270760198e-01   +6.145671105669210e-01   +8.840330334729719e-01   +8.004362080520890e-02   +8.955829156081706e-01   +9.250792683540850e-01];
L2E_L2I_iGABA_netcon = [+5.989907711407841e-02   +5.201260177526895e-01   +3.521779895344601e-01   +2.617492458732092e-01   +4.227042244035245e-02   +8.905216253812837e-01   +3.443484189636686e-01   +4.514448577475467e-01; +3.539047088361488e-01   +6.961822448813668e-02   +5.570762794923528e-01   +9.842959287401836e-01   +3.607556410741080e-01   +5.403196021681383e-01   +9.351794690415629e-01   +6.712715440928143e-01; +9.329163517291286e-01   +1.844238574252621e-01   +6.918640117209783e-01   +3.492590286732254e-01   +3.593146521131906e-02   +7.170613820214318e-01   +9.184714864502779e-01   +7.691071625023359e-01; +2.412067891123293e-01   +3.168244735514341e-01   -6.008896304430205e-03   +4.021838527722688e-01   +4.862454197089064e-01   +7.098927352622160e-01   +7.248014898744880e-01   +9.270134823832307e-01; +1.027210422160890e-01   +2.439924442488333e-01   +4.846006525716447e-02   +7.524549648647642e-01   +7.227994469930357e-01   +1.689490666658028e-01   +4.429751059884953e-01   +6.582923792680697e-01; +7.161672083220071e-01   +3.219044880888649e-01   +3.086224949309466e-01   +1.014605626895938e-01   +1.431567291661454e-02   +3.514522723530074e-01   +1.517389868150113e-01   +5.016108780767697e-01; +5.603394968383595e-03   +8.794733222975332e-01   +8.689044934003280e-01   +5.905236696856967e-01   +5.171724439918077e-01   +3.794220563033880e-01   +8.317391525550496e-01   +3.424723416788858e-01; +1.854302256280594e-01   +3.012743165337090e-01   +6.276121507430162e-01   +1.225544933887789e-01   +2.394946769374650e-01   +7.580962581336436e-01   +2.571092151698433e-01   +9.462547493268573e-01];
L3E_L2E_iAMPA_netcon = [+7.906975139995975e-02   +1.614338866578893e-02   +3.679295974430303e-01   +4.969190951428030e-01   +1.847898870294789e-02   +9.553204761924742e-01   +3.599806359318424e-01   +1.397287292754454e-02   +2.039772931550171e-01   +6.230442510697234e-02   +2.433277180079317e-01   +9.989486093417271e-01; +9.515647508148725e-01   +9.770149627496169e-01   +1.155233689636878e-01   +6.525741476538281e-02   +8.063200701023132e-01   +3.872430512701076e-01   +2.241574341002386e-01   +1.220448189879643e-01   +3.555927773835605e-01   +7.417887713542186e-01   +5.331846910329793e-01   +3.446143180971721e-01; +6.630146392620868e-01   +7.246908874456335e-01   +5.145342801714615e-01   +8.619750289850321e-01   +7.921111504069926e-01   +6.643046546277901e-01   +7.246928437963017e-01   +6.696317043203510e-01   +8.880167792579738e-01   +9.904074235659144e-01   +3.327625617491227e-01   +8.224992093706379e-01; +1.683118936567763e-01   +8.716721575476173e-01   +6.821699347333781e-03   +9.966274330484682e-01   +4.231710718167733e-01   +5.846775472046000e-01   +7.724690991904973e-01   +5.084039654374601e-01   +8.091103826805705e-01   +7.673652263965891e-01   +6.744518769553204e-01   +1.095823940674545e-01; +1.967832461869745e-01   +8.144664532771756e-01   +8.689093459329860e-01   +1.224124930809796e-01   +6.305176090047040e-01   +5.925437202730716e-02   +3.425013817566693e-01   +7.042450898321082e-02   +3.194101992525153e-01   +8.814582955238598e-01   +8.752822988663560e-01   +7.733549184218899e-01; +9.950425754938438e-01   +3.065716446148995e-02   +9.044535692868094e-01   +9.986964715977575e-02   +5.683895180302124e-01   +7.633256012348567e-02   +5.770148094449723e-01   +5.357317069341304e-01   +6.000485934535312e-01   +3.613550242985920e-02   +9.826430455368592e-01   +1.505459504019840e-01; +9.253322475673490e-01   +9.626940325495836e-02   +1.132842005845150e-01   +1.487119801421565e-01   +8.961293689888435e-01   +2.273850917814144e-01   +6.429458084394133e-01   +6.779543298109679e-01   +6.986474675268968e-01   +7.936230933866999e-01   +1.454504773386973e-01   +7.318878147571827e-01; +9.820869454030386e-01   +8.549549492328826e-02   +4.413035784358249e-02   +1.289839865040524e-01   +7.487828154903929e-01   +4.200630366271460e-01   +3.657202940213949e-01   +5.879694947266871e-01   +1.784280547135485e-01   +7.064249356491201e-01   +8.768372927571790e-01   +1.093442400696980e-01];
L3I_L2I_iGABA_netcon = [+7.675537284630104e-01   +5.359099791283011e-01   +5.973300600820491e-01   +3.048970251865936e-01   +9.665655532567408e-01   +1.151820064889096e-01   +2.984694848089744e-01   +7.959844732420303e-01   +9.140091718502371e-01   +9.948535075001637e-01   +3.095520301682603e-01   +9.962707786520028e-01; +6.371909044189039e-01   +4.529350809184248e-01   +5.624650295429178e-01   +7.623532831235214e-01   +5.445468534624021e-01   +6.977814691826256e-02   +1.683726075031816e-01   +5.251941767621576e-02   +3.859455617475392e-01   +2.872790331792713e-01   +4.427268756689737e-01   +9.149233907118139e-01; +7.963599432405661e-01   +1.144165031247979e-01   +6.825558372321891e-02   +6.474632214030459e-01   +9.816203436694211e-01   +5.106923494706843e-02   +7.241562531839520e-01   +1.817210633122989e-01   +7.499641551157692e-01   +5.160302689360373e-01   +2.084813868171858e-01   +6.914769947974959e-01; +9.600412995635870e-01   +7.203498638353019e-01   +7.683016718749454e-01   +3.314146771785016e-01   +1.245774098735725e-01   +1.299512093602254e-01   +2.984067317934180e-01   +2.465703731474701e-01   +8.790062194621490e-01   +3.592822539928369e-01   +9.411946559908906e-01   +2.214929804430233e-01; +7.164372591312127e-01   +1.860894264272034e-01   +8.679700795759369e-01   +9.708700802369156e-01   +1.682985453845265e-01   +4.916782377461537e-01   +6.777607438455787e-01   +2.617923127167380e-01   +3.922438985231717e-01   +5.171522138824167e-01   +2.897512371917462e-01   +3.149303342560013e-01; +6.436522039308610e-01   +3.248073551718223e-01   +7.083933291318061e-01   +5.318093838510976e-01   +3.344604945161153e-01   +4.677037027960982e-01   +7.459643689984730e-01   +6.473065892766711e-01   +1.680932471284741e-01   +5.008222688910080e-01   +1.227611837728306e-01   +2.370801678034250e-01; +5.122310658671594e-01   +9.669505286705325e-01   +1.079247273747029e-01   +7.516719291078950e-01   +5.310165525981813e-01   +1.585291369738263e-01   +7.458910836384847e-01   +9.828678350054856e-02   +4.367185906775125e-01   +1.879640846574805e-01   +6.929833037369315e-02   +7.076845247579747e-01; +9.521807963748582e-01   +7.010484834958304e-01   +6.661653701844491e-01   +2.696113740622039e-01   +6.924156789580393e-01   +1.377578551319669e-01   +7.846629226838088e-01   +4.686515478402096e-01   +8.576910217045424e-01   +4.775242462773328e-01   +7.294314525526548e-01   +3.756776399605614e-01];
L2E_L3E_iAMPA_netcon = [+6.570636726755344e-01   +3.865459995886619e-01   +2.348689255934085e-01   +4.642253199314333e-01   +9.045840190932654e-01   +9.501993135507762e-01   +7.620237774123203e-01   +3.546082667508396e-01; +3.839139267775019e-01   +2.322576984777102e-02   +9.050875612681620e-01   +2.832903163561139e-01   +6.790956474482840e-01   +2.574181874478186e-02   +9.035942271759275e-01   +6.637651210224083e-01; +3.077254590395126e-01   +3.292472665543277e-01   +4.872921283235912e-01   +2.761348646537893e-01   +8.429146530455193e-01   +5.016981741952359e-01   +7.966962216465094e-01   +5.921839298690652e-01; +1.577338068054653e-01   +4.850875706696774e-01   +5.955195042876072e-01   +1.428204895519113e-01   +9.485531588405172e-02   +3.395692883244668e-01   +9.564050074309897e-01   +5.385673419035576e-02; +7.772524144204018e-01   +2.625583090345657e-01   +9.555246827485852e-01   +1.399429147986837e-01   +7.350630321320277e-01   +6.727665555372788e-01   +5.349731904637739e-01   +2.163753861510598e-01; +7.092267074994598e-01   +5.259209553905070e-01   +8.494857407045588e-02   +2.647348292906282e-01   +5.437051380602587e-01   +1.673228135738813e-01   +1.634945647973312e-01   +6.013463472188064e-01; +1.731334434227238e-01   +4.163925121058644e-01   +2.216177492958411e-01   +6.112747885688830e-01   +2.567172496705097e-01   +2.263273306834937e-01   +1.344067651053013e-01   +2.693866979170103e-01; +4.481806672370032e-01   -4.436774835440773e-03   +1.524009292257999e-01   +1.061743089619865e-01   +7.147263702000912e-01   +1.179196221965406e-01   +3.361626217702300e-02   +1.099095931280120e-01; +8.380099281323807e-01   +8.937506325520128e-01   +3.899938044218110e-01   +4.845576453342150e-01   +3.603955510186347e-01   +9.935024347054551e-01   +6.812067432032367e-01   +2.112093854667507e-01; +6.981376750656920e-01   +2.399321830920533e-01   +1.853027916214774e-01   +8.937344943231904e-01   +8.536599892924071e-01   +1.400757607826583e-01   +5.865682234260701e-01   +8.733387532051380e-01; +7.659882744606247e-01   +7.916216105602193e-01   +7.634337646995235e-01   +1.886154045770668e-01   +8.193960359777249e-01   +7.694809869955621e-01   +2.986065568099347e-01   +4.587524948505249e-01; +9.808874150581866e-01   +5.779604285895634e-01   +2.279862763027586e-01   +5.219990017430269e-02   +6.103341827594029e-01   +6.342349949657059e-01   +7.398556606046015e-02   +7.266039397814803e-01];
L2I_L3I_iGABA_netcon = [+5.893195125918530e-01   +1.469677843268483e-01   +3.443585291904904e-01   +3.693110489327340e-01   +5.992412087596124e-01   +5.072389125443307e-01   +7.726735425036492e-01   +2.647466007967542e-01; +8.459129202105339e-01   +9.898724647921762e-01   +4.588663092934805e-02   +5.374850855504474e-01   +4.787378728662592e-01   +2.370490352082586e-01   +1.786579785120238e-01   +5.852424723136594e-01; +6.043627248210597e-01   +4.805703565444600e-01   +9.417901143381484e-01   +9.742533925428249e-01   +3.767451137860406e-01   +2.720780717369623e-01   +4.536793849000618e-01   +6.792566848901389e-01; +7.447062446503883e-01   +3.605805063661085e-02   +8.660817158142499e-01   +9.961435196059049e-01   +9.783451166170032e-01   +4.054239814714179e-01   +3.056906899104908e-01   +4.154096881957382e-01; +8.498134610092476e-01   +2.698552559087254e-01   +1.340056146607459e-01   +4.142211425572710e-01   +1.386392597530629e-01   +2.605999507394820e-01   +3.881214975062935e-01   +5.110182028878457e-01; +1.462876883526540e-01   +6.759090220292120e-01   +5.898848266685983e-01   +4.508184081046012e-01   +2.712573354268899e-01   +8.544269966715888e-01   +8.032494962925900e-01   +8.144205929126918e-01; +7.420521071362852e-01   +1.464953802029666e-01   +6.246603396785629e-02   +2.549805722992823e-01   +2.257245391868014e-01   +4.787930809605714e-01   +7.777525178641470e-01   +5.442206976846972e-01; +1.711861005582641e-02   +7.736110800426849e-01   +9.466036894212083e-01   +6.010762699237855e-01   +7.919685793426058e-01   +3.413811071098507e-01   +6.463650166054278e-01   +5.894886656635702e-01; +2.279993789473364e-01   +2.670594775371607e-01   +4.970451381397983e-01   +7.769448351249336e-02   +8.177823424337498e-01   +6.394068598845786e-01   +2.422368761969267e-01   +5.351326951215198e-01; +5.380398498483119e-01   +8.806987019159045e-01   +2.621063911468459e-02   +9.121324735277176e-01   +7.922427501102212e-01   +4.159373340522599e-01   +6.082967059219081e-01   +5.411449633067309e-01; +7.199873685362800e-01   +3.687391415018708e-01   +5.707421003049691e-02   +4.729250227340721e-01   +1.133655918947624e-01   +5.441147088468600e-01   +4.190515589912936e-01   +1.508253928199937e-01; +4.340152473720104e-01   +9.926192243154270e-03   +3.011314541992395e-01   +5.076715330961942e-01   +6.324933559460478e-01   +3.401207299232902e-01   +2.938785830414701e-01   +7.039324421496902e-01];
L3I_L3E_iAMPA_netcon = [+6.348971152702786e-02   +7.732044434668218e-01   +5.545282746642646e-01   +5.733570362024323e-01   +9.203491281342954e-01   +8.351898942129335e-01   +8.496915983096548e-01   +8.630731656390421e-01   +5.335007304299058e-01   +9.879494480132146e-01   +4.817343347680202e-01   +3.500776650821164e-01; +9.223433027853171e-01   +8.383729025096339e-01   +8.441455730498972e-01   +9.355691148108379e-01   +5.929565074165767e-01   +3.926091964557237e-01   +6.283261525463493e-01   +8.563292964165641e-01   +5.675477065425679e-01   +7.012921919621449e-01   +7.398469459727490e-01   +3.996962087869892e-01; +1.804631789034923e-01   +5.929281536706515e-01   +9.697505618048876e-01   +7.790814959942379e-01   +5.759738983681433e-01   +7.068728228182138e-02   +4.444257476788481e-01   +9.493028671640809e-01   +9.800033757910074e-01   +8.440585227850819e-01   +5.948311908110229e-01   +9.876000092683129e-01; +5.429808516970893e-01   +7.669190851876245e-01   +4.658485826762979e-01   +5.960630895954521e-01   +6.584958650224263e-01   +3.736991416304049e-01   +2.345912992719757e-01   +6.943637732804016e-01   +9.680620152018135e-01   +7.381964346286951e-01   +2.631703266944821e-01   +2.977182874853148e-01; +3.976932730671362e-01   +6.584274949812980e-01   +7.763868002700060e-01   +5.840256842732811e-02   +4.357582144231841e-01   +8.491871240623882e-01   +5.109139916042371e-02   +3.627637996238239e-01   +5.600891095995850e-01   +9.959061872891277e-01   +6.071970064902971e-01   +2.246675102746348e-01; +8.993981466648079e-03   +5.891548125852391e-01   +2.192175254676614e-02   +5.438839191008912e-01   +9.351490540013927e-01   +2.516353910569226e-02   +7.125647049640198e-01   +3.730782571491156e-01   +5.321321664283002e-01   +5.072799577409550e-01   +2.322304559632928e-01   +3.303543322543546e-01; +1.027379926107456e-01   +2.614674816832777e-02   +6.776714697975039e-01   +8.647048880796288e-01   +1.028070602709296e-01   +4.209086194692504e-01   +8.480304467721776e-01   +8.417413445245165e-01   +4.791185234827229e-01   +1.895023709653604e-01   +1.947805881326121e-01   +1.649215643963665e-01; +8.562324937239543e-01   +6.926297749402518e-01   +8.351943113792507e-01   +3.387689816834593e-01   +4.090632962598045e-01   +2.539574001759096e-01   +4.052440331194390e-01   +3.844484921102395e-01   +9.014780076192156e-01   +9.592172193193189e-01   +1.643685083033519e-03   +3.838896351448147e-01; +3.375958707807049e-01   +3.275102469087972e-01   +6.844099566842166e-01   +1.786363073003499e-01   +8.926051744851605e-01   +7.433991107624634e-02   +2.870760433162059e-01   +7.704576315230112e-01   +4.821423757655435e-01   +4.516606216413676e-01   +6.462713653451835e-01   +5.262155853472046e-01; +1.495183546113692e-01   +7.607305758504862e-02   +8.958052586495469e-01   +8.809983476987768e-01   +7.387166141094128e-01   +9.204468518548661e-01   +2.625752686394368e-01   +7.733484565702102e-01   +4.866030121609378e-01   +6.055566290661456e-01   +4.001859846364197e-01   +5.954587202038203e-01; +8.077280681979341e-01   +7.443727392413892e-01   +9.530264561815258e-02   +8.417987162429791e-01   +9.583970317468500e-01   +2.685336132162857e-01   +5.052545328930960e-01   +4.332071917256665e-01   +3.138852027937004e-01   +6.448929228294833e-01   +2.718760630694357e-01   +1.695554376025745e-01; +6.550278684754951e-01   +9.652140148279358e-01   +7.025538006912024e-02   +8.340872045956186e-01   +9.697569486355969e-01   +1.008811741693817e-01   +1.169330728734134e-01   +4.874340932752985e-01   +8.588517027907167e-01   +7.661611290151009e-01   +3.529689563330240e-03   +7.273894512076169e-02];
L3E_L3I_iGABA_netcon = [+4.371500709307350e-01   +7.142610179615376e-02   +6.003244479490554e-03   +4.952129016951375e-01   +5.436311238816093e-01   +2.522993832380028e-01   +7.184786732237362e-01   +7.613506548700522e-01   +3.786176134771660e-01   +4.487086716138043e-01   +2.004162039395528e-01   +6.496621883434407e-01; +5.743196259305069e-02   +8.074212875721289e-01   +1.322770637106883e-01   +1.930678681553792e-01   +2.114169656580888e-01   +3.341218275756732e-01   +2.226310378416701e-01   +8.892075807634018e-01   +6.106222440299058e-01   +3.943939646094375e-01   +8.283981115134478e-01   +8.993199128689224e-01; +6.262284386681451e-01   +9.088629638291879e-01   +3.086031649941972e-01   +6.422831364581327e-01   +2.700528067115974e-01   +5.912303901523872e-01   +4.982237428459268e-01   +7.314352404469229e-01   +1.677874574229802e-01   +6.686252820522361e-01   +4.471476696579034e-01   +8.387371001304454e-01; +7.990444598748958e-01   +4.260279035734191e-01   +2.386763666794410e-01   +2.554941454835386e-01   +1.322657143388365e-01   +4.819752495856244e-01   +4.756145433017778e-01   +6.977188594936209e-01   +1.053540481209120e-01   +3.344143020019098e-02   +4.176953916522647e-02   +1.702268622639447e-01; +4.006249699205753e-01   +1.837035812446038e-01   +6.489507457085218e-01   +9.487733861760428e-01   +1.598657512847979e-02   +8.979616211808069e-01   +4.310487833134510e-01   +6.460712582775928e-01   +6.257501258899035e-01   +7.870073071198749e-01   +7.690298777918654e-01   +1.609680758285412e-01; +8.834014139016972e-01   +1.830358819423858e-01   +8.075604466090707e-01   +2.873557276897202e-01   +1.518257364133346e-02   +2.949325429112144e-01   +5.564729682262397e-01   +6.197130853506783e-01   +9.519305494282239e-01   +3.786661390723873e-01   +9.786731794552424e-02   +1.356123576920210e-01; +7.228024468046043e-01   +6.724315313814903e-01   +7.410658648825803e-01   +1.491551972397969e-01   +9.790173430942521e-01   +7.883988704462383e-02   +2.068703401778392e-01   +7.842931344944562e-02   +6.651280683214251e-01   +6.517328750652120e-01   +6.524002580381753e-01   +1.589565532034280e-01; +1.973775193636695e-01   +5.246134945416131e-01   +1.223509917842507e-01   +8.704656357973302e-01   +6.474684710618013e-01   +3.919675055491991e-01   +2.765725820474415e-01   +5.487597855235578e-01   +4.723889102621285e-01   +4.973896381086096e-01   +2.707055243362814e-01   +3.944343660953771e-01; +3.745514033163618e-01   +7.766227725475928e-01   +1.720921791825932e-01   +8.867732815251460e-01   +8.160228677950845e-01   +1.988668528841864e-01   +8.126108208702609e-01   +8.843033840730854e-01   +3.401424524851678e-01   +2.126339831883034e-01   +4.369541491984030e-01   +6.670611903406687e-01; +2.126171049974021e-01   +2.995184613371514e-01   +2.736816778493821e-01   +6.683992604745566e-01   +2.761732030809506e-01   +7.224535466302113e-01   +9.555004508868366e-02   +9.874404392113615e-01   +5.909642054955724e-01   +2.162009296081970e-01   +8.490252833536308e-01   +2.228714685347817e-01; +2.593549318212276e-01   +4.738704160556010e-01   +8.145801332669161e-01   +9.977418420868955e-01   +1.481931293459536e-02   +4.217695332995778e-01   +3.345682229630954e-02   +7.126822036829956e-02   +5.464972426749161e-01   +4.515357776754050e-01   +9.028214695550553e-01   +6.434935418696810e-01; +9.921675112454081e-01   +7.073141620149717e-01   +5.916449445177527e-01   +2.675238946257198e-01   +1.015078633622545e-01   +2.683838140814538e-01   +6.443801436291306e-02   +3.290044122151391e-02   +3.863362412418098e-02   +6.296860785675613e-01   +2.852628400050435e-01   +6.123511720856996e-01];
L2E_Input1_iAMPA_netcon = [+9.923129355887143e-01   +9.893459881668366e-01   +9.997252250405337e-01   +9.876676655174197e-01   +9.850849321251279e-01   +9.999623291666963e-01   +9.837151129444731e-01   +9.975843608041187e-01];
L2I_Input2_iAMPA_netcon = [+9.916059091329853e-01   +9.991353701950607e-01   +9.847654718255352e-01   +9.955004597594606e-01   +9.885616461677473e-01   +9.893380268986212e-01   +9.959207212024337e-01   +9.967892670748481e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last =  11.21 * ones(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))*0.4 + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.5*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.5*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))*0.9 + 0.5*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))*0.4 + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.5*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.5*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))*0.9 + 0.5*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
