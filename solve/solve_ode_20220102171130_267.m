function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-3.741344896542195e-04   +8.225166648848137e-03   +9.705029318108717e-03   +1.760717905632172e-02   +2.851476887644928e-04   +1.302367850940290e-02   +4.011760020036254e-03   -3.626309373833156e-03   -9.956831817926250e-04   +1.124493547658400e-02   +7.246116730352036e-03   +5.441351907488976e-03   +1.025779386017601e-02   +7.476977824081244e-03   +4.559690952496786e-03   -7.704307152601776e-03; +6.688900523673791e-03   -3.701056855298675e-03   +9.887958109097894e-03   +1.287730578435199e-02   +2.148634032094860e-03   -3.726235426950977e-03   +9.258532086251006e-03   +5.821231794408720e-03   +7.477026779854978e-03   +1.201351253919828e-02   +8.266921081985557e-03   +3.245892160515958e-03   -3.388290098982628e-03   -4.260636588469898e-03   +3.499376352795859e-03   -9.389075291854397e-04; +4.786092122647714e-03   +6.546777389817847e-03   +9.005108919646697e-03   +1.162566059022417e-02   -7.176546349668125e-03   +6.082379959878184e-03   +1.167959235670688e-02   +3.614451022686883e-03   +4.551507814446519e-03   +5.223903526230653e-03   +1.092545122459792e-02   +2.829015230199142e-04   +5.105377377415878e-03   +6.002710345426312e-03   +1.057102907429786e-02   +6.439162371310970e-03; -2.039524632253336e-04   -3.770246411786628e-04   +5.097570338781958e-04   +3.007153059017041e-03   -8.223819576971765e-04   +5.980814800163949e-03   +6.814276895752773e-03   +3.840499596151433e-03   +8.988431466141446e-03   +6.743858504118493e-04   +1.356071015661430e-02   +1.127017431663695e-02   +6.839888074390443e-03   +1.229986509103658e-02   +6.895029474226623e-03   +1.950242401742003e-03; +1.704900228437541e-03   +7.472649771865273e-03   +1.826992191489921e-04   +8.333179367145734e-03   +1.131458269926048e-02   +1.048550635918625e-02   +9.332162475968811e-04   +4.047787971813476e-03   +6.643556712957977e-03   +1.343434034849233e-02   +4.031868805195477e-04   +5.327928885957909e-03   -5.071470898468295e-04   +1.297468503757779e-02   +9.533481275904672e-03   -5.672746731699542e-03; +1.004438524630890e-02   +4.312415778185561e-03   +7.819672088708122e-03   +7.587719807666549e-04   +7.488031979631736e-03   +7.574323347301831e-03   +8.953255243695652e-03   -4.345658575379148e-03   +4.047511582009212e-03   +7.887701428285635e-03   +1.029652034904630e-02   +2.135397852164381e-03   +4.844627172914405e-03   +2.694180045634559e-03   +2.231230985994080e-03   +8.438651441551218e-03; +2.588920787112516e-03   +5.615023966232496e-03   +9.606688634483817e-03   +8.256427903448155e-03   +1.369196886398449e-02   +1.006067726468708e-03   +6.311321736862325e-03   +1.523515399445147e-02   +1.773181787920218e-02   +3.065925845303908e-03   +5.443382798248343e-03   +4.015762402695230e-03   +3.490666428541653e-03   +8.366752204609165e-03   -7.088578444203396e-04   -5.671094062418326e-03; +8.148799479142358e-03   -3.979335552551868e-03   +1.174216256355596e-02   +1.062022428296696e-02   +6.232586315696846e-03   -3.298147454212141e-03   -4.648572239902194e-03   -2.677441089071685e-03   +1.020006005366981e-02   +1.085676780292274e-02   +4.207180286664892e-03   +1.072753653455399e-02   -1.675688614525017e-03   +1.145235660006456e-03   +5.606665682995940e-03   +9.968293723433514e-03; -2.654220524337049e-04   +4.320506757890853e-03   +3.214044611899911e-03   +9.015136470790747e-03   -5.521933793265236e-06   +9.160322368388580e-03   +2.357815597463176e-03   +6.693300100565730e-03   +5.979813789567627e-03   +1.112264296698612e-02   +4.000847130010644e-03   +7.539934360621770e-03   +7.631251618047045e-03   +9.658827498213979e-03   -4.656507219149889e-03   +4.629270891378641e-03; -1.374363726886975e-04   +6.228196441095200e-03   +1.784623466028672e-02   +8.874372376457235e-03   +4.130271618601250e-03   +3.818328707657019e-03   +8.077560954309277e-04   -2.253372316138910e-03   +5.990267776638322e-03   -3.025249111423482e-05   +4.372765847712045e-03   +1.466785124685207e-03   +6.271560463764188e-03   +4.902458972219741e-03   +1.676648769177224e-02   +8.419158759294091e-03; +9.577848854234142e-03   +6.425363356526707e-03   +1.047719107247031e-02   +8.289893786389432e-03   +4.470755938552277e-03   +3.838652286669960e-03   +5.200143372392314e-03   +1.116481726068050e-02   +3.397413779049254e-04   +5.583291512813573e-03   +1.031976205044624e-02   +6.772990109923761e-03   +7.783478074176927e-03   +1.140489900022349e-03   +1.181593615298878e-02   +7.403159066377729e-03; +5.222488783374284e-03   -6.811436914614415e-04   +4.982286705287052e-03   +2.187312600419791e-03   +6.086044293861288e-03   +1.131394438964419e-02   -7.695380444981657e-04   +8.690632974714244e-03   +6.841901007299808e-03   +9.552723146463694e-04   -3.614513590449699e-03   +1.894638442593891e-03   +8.875427898007377e-03   +3.801651513454094e-03   +4.722400809367533e-03   +8.914029158026913e-03; +5.405653587489729e-03   +7.773365710914762e-03   +1.234242912183746e-02   -1.434874839033185e-04   +1.578142626528468e-02   +5.496907214183769e-03   +1.250410182093075e-02   +1.621627536080070e-02   +6.474476523627111e-03   -1.765662793610473e-04   -3.570056457013933e-04   +6.215839091518337e-03   +1.020134717298555e-02   +1.204778748967727e-02   +1.047188627791630e-02   +8.165546966280524e-03; +8.583664451566705e-03   +1.027319699552091e-02   +6.285837771027895e-03   +8.927091656946938e-03   -2.266244456280275e-03   +2.650543703059056e-03   +1.007114875774075e-03   +5.778781316221698e-03   -3.498258439282120e-04   +4.494812652358656e-03   +2.115139741579088e-05   +1.140133291570262e-02   +7.096257883520520e-03   +1.004671906866780e-02   -1.814462755850669e-03   +2.129811201271006e-03; -5.912502465074242e-03   +1.292385229100806e-02   +1.059721755354531e-02   +2.357472583058245e-03   +2.854959810479310e-03   +1.761204710214845e-03   -6.722074363722536e-05   +2.927733564053292e-03   +5.022160729675739e-03   +1.352255254319982e-02   +5.260008480035223e-03   +8.835589136080529e-05   -2.203263283660659e-03   +1.528228718197330e-02   -1.234681125411093e-03   +3.742594478548121e-03; +5.181147717856570e-03   +8.810708795938140e-03   -4.411882146845643e-03   +1.319397182766627e-02   +1.897930647864870e-03   -2.425986289071822e-03   +5.152629296092915e-03   -1.712890239619049e-03   -1.984289764273517e-03   +1.631348643224204e-02   +7.825853877094639e-03   -4.341489090070380e-03   +9.334501010814355e-03   +9.223752010612674e-03   +1.107826895273877e-02   +1.290067309912076e-02];
L1E_L1I_iGABA_netcon = [+4.972457424167687e-03   +1.078241776503571e-02   +1.080806077517100e-03   +8.522748123601445e-03   +9.001744651328795e-03   +6.749834062434634e-03   +7.014046793377378e-03   -3.450898774409127e-03   -2.582530490448411e-04   -2.567543309396250e-03   +1.058320465045339e-03   +2.903199276846850e-03   +6.283887709768296e-03   +1.544072249407056e-02   -1.368103426138283e-03   +5.153331800659808e-03; +4.096757806253329e-03   +5.774587766374390e-03   +6.269010330165456e-03   +8.853890892738180e-03   +1.079047294921136e-03   +5.893437504774435e-03   -2.537063678025135e-03   +1.143575984373688e-02   +8.966924933551942e-03   -3.228943525058987e-03   -3.919843625966895e-03   +9.131739106282042e-03   -5.390546796024786e-04   +4.411418149810400e-03   +3.274661619773900e-03   +8.413197905669308e-03; +6.230390350967831e-03   +1.461641816334507e-02   +6.007145620417754e-03   +5.694057197436873e-03   +2.367643999290480e-03   +8.487389626275594e-03   +5.196308408900162e-03   +7.374458155932143e-03   +1.096779177657375e-02   +1.257827277037979e-02   +6.868630176440028e-03   +2.786499716952867e-03   +1.032718220373403e-02   +8.832338261500067e-03   +1.493204319434690e-03   +9.335852282994411e-03; +1.251132305671816e-03   +3.584871786927790e-03   +9.720452937696843e-03   +6.324902506611564e-03   -3.622368468686726e-03   +9.383944864356333e-03   +6.162262035529172e-03   +1.122598256172439e-02   +8.775241936201605e-03   +5.470416726424569e-03   +9.843245064319729e-03   +5.115053785494225e-03   +1.183148861345162e-03   +4.450959133219645e-03   +6.407967288878466e-03   +5.980513702697504e-03; +5.251130699041241e-03   +1.104200519481762e-02   +8.390701114263249e-03   +3.540692650948426e-03   +2.576872659395399e-03   +1.022232226935555e-02   +1.000153908464916e-02   +8.922036288405797e-03   -3.238672414663123e-03   +3.762502670655446e-03   +6.317315571228853e-03   +7.381243664239839e-03   +1.895637713081663e-03   +3.599381786630449e-04   +2.771052965081750e-03   +3.139899899186950e-03; +1.331361353813163e-02   +6.566966554670724e-03   -2.135339304119215e-04   +1.253480040242068e-02   +1.086879684890790e-04   -3.496730666910659e-03   +1.397186367990654e-02   +4.027418769384157e-03   +9.659922345770721e-03   +3.008125264276405e-03   +8.857470194804838e-03   +2.583766201320813e-03   +6.861162261355557e-03   -4.579853819128463e-03   +2.497548417163052e-03   -5.266321813976917e-03; +1.082743994961952e-02   +3.617362101034737e-03   -1.958659424282813e-03   +5.856601054826629e-03   +5.910919061453508e-03   +8.079613756178513e-03   +1.073377954546222e-02   +5.422296978377601e-03   +7.162244674729862e-03   +4.411023841303929e-04   +1.579760609454372e-02   +1.704517975852006e-02   +1.363997601340768e-02   +6.034204953417608e-03   +3.091257891452866e-03   +6.499093011473533e-03; +5.194458154188735e-03   +2.637951341193961e-03   -5.571838438004895e-04   +3.180057609990044e-03   +7.623840456146624e-03   +4.509117756960947e-03   +1.448695864996353e-02   +5.474319622760791e-03   -2.467712205410897e-03   +4.628814430655209e-03   +4.113149963695181e-03   +1.127432515221534e-02   +5.968983040435284e-04   +5.141038090694700e-03   +2.178452147730664e-03   +2.730884784254289e-03; +1.953065240126002e-03   +4.052731202167656e-04   +5.952502680086074e-03   -5.175202976347749e-03   +6.271106215340642e-03   +9.442814424782547e-03   +1.483908895332408e-02   +1.236391884275411e-02   +1.807550615501344e-03   +5.291766192582125e-03   +1.296275815441136e-02   +3.863867328363904e-03   +1.149180786356770e-02   +1.205546184101158e-02   +5.612915743410832e-03   +7.936907938644374e-03; +2.330934804089307e-04   +3.696586921483687e-03   -5.719080645199626e-03   +9.353496553811926e-03   +3.126010861372797e-03   +1.479849589538047e-02   +2.601375989908111e-03   +2.158040550803401e-03   +1.416598363963707e-02   +1.061843338931072e-02   -2.996601571089353e-03   +1.507152544363743e-02   +9.939544553094603e-03   +6.164848629342149e-03   +1.078183137618465e-02   +4.987691013615411e-03; +1.505653792774697e-02   -1.944067159186210e-03   +2.355309501255492e-03   +2.199134222532358e-03   +1.354099562319367e-02   +2.308414455826089e-03   +9.494815259970764e-03   +1.251866748447219e-02   +6.349155830024759e-03   +1.167569622262149e-03   +5.784298542921502e-03   +6.388043755397435e-03   +6.001225325137680e-03   +1.884838708265264e-02   +9.050993768391365e-03   +2.144746517850173e-03; +4.439017920439397e-03   +8.675988612643824e-03   +9.843287229700133e-03   +5.833551066614152e-03   +1.086584260026689e-02   +6.534082170477485e-03   +4.976347755040291e-03   +2.448822292033126e-03   +5.484153046364772e-03   +4.420696940135092e-03   -2.899137346859750e-03   +1.050686617994803e-02   +1.976874537371193e-03   +6.723293778608216e-03   +5.422836089791256e-03   +3.979731179731206e-03; +1.402546332018694e-02   +4.782114630550059e-03   +1.425618718428596e-02   -5.734946212833630e-03   +2.537519304951471e-03   +5.991283725690550e-03   +4.693975019334563e-03   -1.416550628177129e-03   +1.244651141911492e-02   +5.909491376513712e-03   +6.638324774486564e-03   +1.036056846499163e-02   +1.351841633187208e-02   +4.168058898856948e-03   +2.557441201527813e-03   +4.240551968946974e-03; +1.019535603892308e-03   +3.513435034815675e-03   -4.443703582682628e-03   -3.297601568526064e-03   +3.032222254288780e-03   +8.408896074369798e-03   +1.507544833272314e-02   +9.043983592537797e-03   +1.892896667778512e-03   +7.668819812428007e-03   +8.035394713350089e-03   +1.062567719779197e-02   +9.146344910875896e-03   +1.454841079235458e-02   +8.687764608476553e-03   +3.709641194188740e-03; +4.560219805622307e-03   -4.636427445900227e-04   +4.516843553292271e-03   +1.577549760787164e-02   +4.808779071642192e-03   +3.724085476058508e-03   +3.415373564577520e-03   +8.549579990967384e-04   +2.587442552094402e-03   +4.956726559409610e-03   +4.328712633253884e-03   +1.001138076237027e-02   +1.128406741245276e-03   +7.394114645053135e-04   +5.982466343586795e-04   +5.467334091625359e-03; +8.630865718200278e-03   +2.605690221339572e-03   +2.996565670903928e-03   +8.268129668801942e-03   +1.225684427868384e-02   +7.653839411127555e-03   +6.184961518965219e-03   +8.181759809079005e-03   +1.186187887124186e-02   +1.948933657907716e-04   +3.177868751919074e-04   +7.193823223838592e-03   +8.495495477518029e-03   +5.271586559369601e-03   +7.885940593634237e-03   +9.764322348321371e-03];
L2I_L1I_iGABA_netcon = [+1.090403793683717e-02   -1.008921403402216e-03   -9.522687896801379e-04   +1.567103766769732e-02   +9.768040855781208e-03   +9.253491136246701e-03   +3.645100107982479e-03   +1.180237599776505e-02; +1.018467870029150e-02   +3.439540885444764e-03   +2.622458310901595e-03   +7.651519759575603e-03   +6.007295501026898e-03   +5.721255292798300e-03   +8.547000513715196e-03   -5.300619207988337e-03; +3.606724142410165e-03   +2.581644070652017e-03   -1.899789628821275e-03   +1.037874832517425e-02   +1.789078851170253e-02   +1.572075833822968e-02   +6.100826682498634e-03   +1.105770711261037e-02; +5.695663489883916e-03   +1.037867408277644e-02   +1.075552650046924e-02   +1.091712471185551e-02   +1.102711427095322e-02   +6.066480306454124e-03   +5.706055537578567e-03   +1.355180584106510e-02; +7.981083547773464e-03   +1.667048238680682e-03   +7.767155320458693e-03   +8.385273640479040e-03   +6.594904209600252e-03   +1.097670063179105e-02   +3.317868163342974e-03   +7.702429793881402e-03; +1.446353033776191e-02   +4.211063992469589e-03   +1.844022159073722e-03   +1.134513277779740e-02   +9.816994608766994e-03   +9.386463595842456e-03   -3.528455453797989e-03   +6.275173525401428e-03; -5.057317422920529e-03   -1.802978838067598e-05   +2.481719651480392e-03   +6.670999390438242e-03   +9.453094190075388e-03   +2.267183841403409e-04   +3.957191450408876e-03   +1.406609133251661e-02; +8.555673314636797e-03   +3.907024727880564e-03   +8.790308907319426e-03   +7.733421252285974e-03   -1.046072258118091e-03   +1.142420721668937e-02   +8.071086746832892e-03   +2.962463946806372e-03; +3.301523033955625e-03   +2.627036842830101e-03   +3.992379664606456e-03   +4.863246526294823e-03   +2.026619991137991e-03   +1.186795292256506e-03   +4.895629130206004e-03   +9.427644492651179e-03; -2.235689543744132e-03   +2.893314209827162e-03   -3.874796611465416e-03   +3.250977878841173e-03   +3.461957068164052e-03   -1.305406903102183e-03   +1.213132866798892e-02   +4.203780248967138e-03; +2.215332010444156e-03   +1.311934147156842e-02   +1.214947282276220e-02   +6.384801031519867e-03   +1.462914457782376e-02   +6.933460931920239e-03   +4.648598773491460e-03   +4.923600733894646e-03; +1.059438855298763e-02   +5.723104766731827e-03   +4.508745790684298e-03   +3.712272449084256e-03   +1.398704019713105e-02   +6.224098957508490e-03   +1.104100581722603e-02   +5.796829406781984e-03; -5.446815086084213e-03   +1.121477832745428e-02   +4.546658256454373e-03   +3.233778930798741e-04   +5.696435985627161e-03   +2.659916175879706e-03   +1.317755632286540e-02   +8.843655924597181e-03; +1.073186968422850e-02   +2.145148664155618e-03   +1.434845291119145e-02   +3.082282439114889e-03   +4.519326647006220e-03   -1.830959520966822e-03   +1.163607363623203e-02   +3.785363610189312e-03; +8.099360584562789e-03   +3.864920290242457e-03   -2.195677391910582e-03   +1.451536714351973e-02   +1.246637376878226e-02   -2.544296537179730e-03   +9.406118058328023e-03   +1.118533645511298e-02; -1.777068286556656e-04   +5.651738161337469e-03   +6.654772875278529e-03   +3.027955800420580e-03   +1.211240580874730e-02   -3.239358205697011e-03   +5.434820448767755e-03   +8.791486666403201e-03];
L1I_L2I_iGABA_netcon = [+1.194514741486439e-02   +1.354620781784136e-02   -9.764142962131403e-04   +2.431988596971954e-03   -4.973180892142346e-04   +9.172414065306909e-03   +1.531632998268348e-02   +6.954405046984969e-03   +1.418792264223289e-02   +1.174756919399250e-02   -6.097325983440072e-03   -1.471738532714813e-03   +6.322707378818153e-03   +4.851432929605319e-03   -1.575613072886425e-03   +1.322492273087254e-02; +9.667304714792477e-03   +5.316787626515836e-03   -7.481717348115720e-04   +7.738798297766342e-03   +1.089333277004369e-02   +6.156489437999622e-03   +6.197431709898965e-03   +1.048248569951878e-02   +5.244202471352473e-03   +1.837156208033421e-02   +9.183373546922381e-03   +1.186151316853829e-03   +2.273468210664506e-03   +6.339887407027439e-03   -1.709840763615060e-03   +1.023597915518351e-02; +7.818526037001105e-03   +9.123381147861084e-03   +2.613562535363414e-03   +8.794639334933489e-03   -2.467109298890478e-03   +8.429465546595301e-03   +3.064738358691194e-03   +4.762103026326246e-03   +4.305648012927838e-03   +1.125830647463867e-02   +9.747254851231596e-03   +8.945038794304229e-04   +4.075961209065749e-03   +4.238498555108172e-03   +6.870394705812955e-03   +4.815865717628629e-03; +2.415862014467589e-03   +3.418743462846879e-03   +4.867534638627915e-03   +7.351216689795577e-03   -2.601926946762760e-03   -3.393028529034436e-03   +7.583792076994096e-03   +8.996760812893533e-03   +1.619930551418484e-03   +5.502149228735985e-03   +4.356364846849742e-03   +3.319045558509044e-03   +2.569256446571540e-03   -2.007231593708172e-03   +9.002507418884163e-03   +2.634953678726024e-03; +3.439644082566732e-03   +1.231686213060072e-02   +1.120231162809169e-02   +6.216489434941112e-03   +8.883626162993308e-03   +1.063818873124816e-02   +1.518060072418448e-02   +1.888707110994176e-02   +4.665694041764738e-03   +5.149259099823555e-03   +6.634733459676453e-03   +5.778945403142152e-03   +1.070459164573762e-02   +7.390066473762948e-03   +3.491892464389192e-03   +8.315193269099566e-03; +7.884853972470764e-03   +5.839018760184202e-03   -9.773390439123664e-04   +1.278048714700060e-02   +8.139700851091981e-03   +9.211639638583140e-03   +1.490981936315086e-02   +9.072904449532179e-03   +1.322130676218309e-02   +6.308628349087130e-03   +8.087198838121458e-03   +9.209405039445413e-03   +3.292033930412433e-04   +1.209279278821858e-02   +1.203842280334973e-02   +1.048450570048224e-02; +1.290595278139431e-02   -1.020292838659202e-03   +8.729940759914843e-03   +9.836222484126019e-03   +7.439831232941023e-03   +1.338943024458802e-02   +9.876767056621136e-03   +3.107580766604856e-03   -2.435339196562528e-04   +8.489682748248496e-03   +2.739507970916398e-03   +4.228721480909626e-03   +1.063740948514153e-02   +1.133987409439117e-03   +1.166582755877944e-02   +4.210603739181213e-03; +8.846094282032776e-03   +4.358112233644849e-03   +4.673318036801737e-03   +6.568204296193307e-03   +1.858220170099695e-03   +7.344697159072485e-03   +8.197882572024039e-03   +1.084433986360469e-02   +3.349437339097605e-03   +9.619425908371013e-03   +2.978977232282987e-03   +2.995707263006229e-03   +3.197378660634721e-03   +3.414699264474038e-03   +7.956696965244163e-03   +6.612746403971935e-03];
L2E_L1E_iAMPA_netcon = [+1.035136958875108e-02   -6.221824755264869e-04   -2.730047064812743e-03   +4.104055600944429e-03   -4.928897733964325e-03   -9.919749793820859e-04   +1.144742375218731e-02   +2.229873581606006e-03; +9.418201870775652e-03   +8.190295079446115e-03   +8.040665585538592e-03   +7.528587963697717e-03   +1.504277003570068e-02   +2.965170071750170e-03   +1.156033326915896e-02   +7.275018199218095e-03; -1.918841900454649e-03   +3.649866834062967e-04   +5.093735440915861e-03   +8.689153033045077e-03   +3.835315625278525e-03   +1.292684186972782e-02   +2.566203121734833e-03   +4.536055078622966e-03; -3.335791876569718e-03   +7.419254993745834e-03   +2.424807583936307e-03   +1.495311820602603e-02   +1.518020935633328e-02   +6.243600793876619e-03   +9.583851086828400e-03   +9.945480648123768e-03; -3.536261089264669e-04   +1.523299152578509e-02   -2.136313935747826e-03   -3.354751204679853e-03   +8.166266186577361e-03   +1.033578514288986e-02   +1.453588679541103e-02   +6.011199063944295e-03; +4.564680664802778e-03   +4.103893954003294e-03   +1.654236701175212e-02   +1.127970279494079e-02   +8.868414313744553e-03   -2.710737744851421e-03   +5.400669744514365e-03   +8.858567667552990e-03; +5.856392288516086e-03   +7.178691518324136e-03   -2.121788825595822e-03   -1.106794248188117e-03   +6.151943086713279e-03   +4.242128145828374e-03   +1.387833374259398e-03   +6.032178641664971e-03; +1.104345200165186e-03   -5.286077979961029e-03   +2.766374245441056e-03   +1.461713026280906e-02   +4.001579952024390e-03   +1.116707201881006e-02   +1.412254514160992e-02   +1.015011571681796e-02; +7.005072405225540e-03   +1.292710953642374e-02   -1.262597506485752e-03   +2.721113255472749e-03   +3.354178614661345e-03   +1.154617670529971e-02   +1.139508015532380e-02   +6.998778504177154e-03; +9.105927404128324e-03   +7.220303910959603e-04   +9.828003194456625e-03   +1.028648475713686e-02   +1.881077686904683e-02   +2.499040343149504e-03   -3.063815931435959e-03   +6.233606615470266e-03; +1.268790619511767e-02   +6.421433529069593e-03   -5.779805851834425e-03   +5.897657721519208e-03   +5.883811112622404e-03   -2.033643395665979e-03   +9.762592507632183e-03   +1.344794106268250e-02; -2.857850516383564e-03   +8.397891112097359e-03   +9.459956601370985e-03   +2.461773320357497e-03   +9.549391759426153e-03   -5.501614069038745e-03   +1.492850647039782e-02   +3.508210066426515e-03; +5.053640331815335e-03   +4.146049935254999e-03   -3.399749925776659e-03   +3.906428845236332e-03   +1.745410121346893e-02   -2.225958730849353e-03   +8.949362638803514e-03   +9.185932432212605e-03; +2.445557100016925e-03   +2.622938358646229e-03   +4.776645822974403e-03   +8.025277875274794e-03   +3.120456476461895e-03   +2.746951449462840e-03   +4.191353081592693e-03   +1.641088834086650e-02; +4.544788369519433e-03   +4.570216678550259e-03   +3.976714314699063e-03   +1.017888492412811e-02   +2.340587377123648e-03   -1.388260527128947e-04   +8.161879771704125e-03   +7.250257920467238e-04; +6.476849436015788e-03   +8.441066060690054e-03   -9.806913704572123e-04   +6.080167890314842e-03   -7.373397041421438e-03   +5.186551236048008e-03   +5.210970395326000e-03   +1.129930621670470e-02];
L1E_L2E_iAMPA_netcon = [+3.266131702809641e-03   -1.346856310359633e-03   +7.308783431173268e-03   +1.323387202710516e-02   +1.386859586940129e-02   +1.558287656390226e-02   +5.595918550686207e-03   +1.242012675470529e-02   +5.500209757960096e-03   +3.286887945174856e-03   +4.245036352788977e-03   -2.074186707542642e-03   +6.827306968730890e-03   +1.146803392757046e-02   +7.166939053511699e-03   +6.226422699972904e-03; +2.282371123621501e-03   +1.123018204638812e-02   +6.268957987738245e-03   +1.709349250388267e-03   -2.987617654076039e-04   +1.425211294710256e-02   +2.559304104668162e-03   +4.380712970664368e-03   +3.017335579094426e-04   +6.666007334466610e-03   +6.895981595734775e-03   +7.360622008869425e-03   -3.837735831475212e-04   +3.454598561626654e-03   +5.010800195708221e-03   +1.724383604596088e-04; +6.334963169178149e-03   +1.026948049421547e-02   +1.290952752938472e-02   +1.596870352438134e-02   +1.638167362992782e-02   +5.159569839104340e-03   +8.726263868377816e-03   -2.527832989776692e-03   +7.458044984834151e-03   +3.312209228044509e-03   -9.500548713244719e-04   -1.933474323763666e-03   +5.043087356474337e-03   +5.206581547909706e-03   +1.230178598704597e-02   -2.263277697462699e-03; +9.506344089337782e-03   -2.282438066193232e-03   -1.869860637951722e-03   +2.376912986501249e-03   +6.370980875486612e-03   +4.315020886456859e-03   +1.106131946761374e-02   +3.840267481708916e-03   +7.392545495525737e-03   +1.240854097493830e-02   +2.435731775143770e-03   +6.941167172669687e-03   +1.237294466737363e-02   +1.065830522943754e-03   +1.420121147014280e-02   +8.246591436397423e-03; +6.609284925402659e-03   +7.629206898734837e-03   +7.029074216613730e-03   +2.018097287140171e-03   -2.081223471697635e-04   +6.606657344040654e-03   +7.156712971686121e-03   +6.207154021725912e-03   +1.720425797665977e-03   +5.771238083495808e-03   -8.762928144899649e-04   +1.369335979335499e-02   +8.320253317835036e-03   +4.730086484413060e-03   +1.652344114698331e-02   -1.842356960939273e-04; +5.130349266630032e-03   +9.661168310944875e-03   -9.510070275671506e-04   +9.783843341147163e-03   +1.724820989091079e-02   +1.353711033814524e-02   +4.569404950641830e-03   +8.547163686560291e-03   +4.461983245147278e-03   +4.879052642914990e-03   +4.789386459087250e-03   +1.719683620178219e-02   +1.055892752603510e-02   +2.420806217752829e-03   +1.613355084153089e-03   +1.333869844747409e-02; +4.327739954110942e-03   +4.259536245562353e-04   +1.426408411718565e-02   +2.411219217344608e-04   +4.698247355526258e-03   +4.625148832748715e-03   +9.579404972733102e-03   +1.585851873347152e-02   +5.397239786309792e-03   +1.048984658475590e-02   +2.073268032821736e-03   -7.279267729837967e-03   +5.846069395638307e-03   +5.073310642388772e-03   -3.871268782626749e-03   +3.941925511334721e-03; -3.012865434171768e-03   +6.552848060347108e-03   +7.706185680072511e-03   -1.653322527390275e-03   -1.350517750124719e-04   +1.514018019932725e-02   +4.915669479014411e-03   +1.395378540737595e-02   +1.290166970586528e-02   +5.361033490273340e-03   -1.741367606224260e-03   +1.088818467881259e-02   +9.137122033395655e-03   +8.582819039286640e-03   +2.400746158963529e-03   +9.055476377634398e-04];
L2I_L2E_iAMPA_netcon = [+6.977138885075750e-03   +7.331672864445556e-03   +1.029943219199701e-02   +8.560076970894209e-03   +9.995706629163624e-03   +7.053276023499594e-03   +7.870601519661161e-03   +6.745452046993870e-03; +2.088058820543144e-04   +2.165975652968539e-03   +4.205810727420071e-03   +1.122642690486148e-02   +4.815244264421847e-03   +5.082734802246632e-03   +5.703044373331914e-03   +5.409636991712530e-03; +1.180881399967098e-02   +1.169147908608563e-02   +7.343770337518534e-03   +6.988853808585016e-03   +7.452647125374670e-03   +7.101094608843950e-03   +8.658044508944243e-03   +1.034542354036741e-02; -2.359227357635813e-03   +3.119159804032691e-03   +8.605322407928051e-03   +4.694406298402006e-03   +1.162774254263554e-02   +3.498540670129429e-03   -5.183799348817048e-04   +1.057770858125273e-02; +7.082776813089013e-03   +9.175830947711332e-03   -9.671532091458917e-04   -2.936673143426054e-03   +1.171263609099764e-02   +1.032467674104627e-02   +2.165324653810388e-03   +4.479248966669838e-03; +6.773596674530846e-03   +8.847467951986049e-04   +7.135034814666235e-03   +6.787715021722582e-03   +8.235142975710512e-03   +7.418180522997459e-03   -6.786769329572923e-03   +1.295703445547248e-02; +1.427889135766886e-02   +1.614588466128924e-03   -5.027847204467083e-03   +1.691523237644684e-03   -6.735221124186123e-03   +6.725602394733765e-03   -2.079788690314930e-03   +7.774801980072736e-03; +9.185305891113847e-03   -2.260128066736981e-03   -2.495340295618617e-03   +4.478925498462932e-03   +1.292830908593066e-02   +4.205161439639638e-03   +5.891117386714826e-03   +1.193690699918776e-03];
L2E_L2I_iGABA_netcon = [+9.795188659334039e-03   +3.945337583485508e-03   +8.232265859248756e-03   +1.079659840540214e-03   +1.603199527620785e-02   +4.613954234105360e-03   +5.085175506502448e-03   +7.981979348821376e-03; +1.487730708559234e-03   +6.904868047954460e-03   +8.367905510361612e-03   +2.718231401358192e-03   +9.650687990237994e-03   +9.924329544021592e-03   +1.181784185865039e-02   -1.048059277699339e-03; +4.289427670973050e-03   +9.279286669706553e-04   +3.303595744204720e-03   +1.042463586705424e-02   +4.989708430333677e-03   -2.392817992517525e-03   +1.170280861332015e-02   +1.000818479977397e-02; +1.160874602828434e-02   +4.077526088180162e-03   +4.215883041119956e-03   +1.359946732089884e-02   +6.872501696613717e-03   +9.007749139713195e-03   +7.342519949513500e-03   +6.231620392306063e-03; +4.929174163711702e-03   +4.795688754493295e-03   +1.113593018419132e-02   +1.208764632986621e-02   +4.912307875161052e-03   +2.350207962524525e-03   +8.265951924642075e-03   -2.585695246119751e-03; +1.214145187492618e-02   -5.430588905167288e-03   +8.541948601589603e-03   +1.277780911443692e-02   +1.492587455139601e-02   +4.006502549696133e-03   +9.804194541018434e-03   +6.841742367183029e-03; +2.486529093039611e-03   +1.682504911629192e-02   -1.731303672236808e-03   -1.058453824599549e-02   +6.577899276933991e-03   +2.267991960009765e-03   +8.506060742230110e-03   +1.978920712058094e-03; +1.355063812279399e-02   -9.156696009896112e-05   +4.768928350744141e-03   -5.218375054750129e-03   +6.055503501903833e-03   +1.228586274165917e-02   +1.239972138799843e-02   +9.265737764307405e-03];
L3E_L2E_iAMPA_netcon = [+7.363707727144293e-03   +1.267493689382456e-02   +4.037262408092051e-04   -8.559742020572959e-04   -8.307115551994532e-03   +1.280653782774296e-02   +2.524111470432820e-03   +1.064741894800161e-02   -3.512840721846683e-04   +3.665997588730679e-03   +9.242518188023151e-04   -3.811157960054270e-03; +9.911919103958607e-03   +1.355628617212714e-02   +6.099243156977492e-03   +1.033236103931248e-02   +5.378169541451063e-03   +1.655770902365959e-03   +9.184597530933321e-03   +1.386910883492350e-02   +1.193283909566139e-02   +1.011413606897629e-02   +5.568592952646894e-03   +1.183643860868096e-03; -1.452846376942742e-03   +9.576565535267740e-03   -1.477975143538157e-03   +6.990835954128499e-03   -3.837417561151111e-03   -5.709223745898957e-03   +3.823933009050828e-03   +1.363440609704785e-02   +8.666270757071604e-03   +8.199289004099672e-03   +8.675091219954256e-03   +1.521452561454719e-02; +5.380911157733423e-03   -8.410582830405231e-05   +6.026173275450041e-03   +1.547429055665786e-02   +5.350859961740112e-03   -1.369910464025872e-03   +9.539935053441457e-03   +9.250404343695113e-04   +7.146649628082129e-03   +7.598418415064707e-03   +5.381289330483586e-03   +6.007183274066148e-03; +8.514513342743158e-03   +4.041513923172238e-03   +6.996220614953865e-03   +1.724068104148032e-02   +7.539247193535349e-03   +3.053296096027816e-03   +1.043100965157565e-02   -3.723437157602599e-03   +3.018082599890019e-03   +1.245352712730529e-02   +1.161239191463201e-02   +1.974318865579925e-03; +7.465347824404564e-03   +2.813395662055914e-03   +3.260067858056976e-03   +4.287914669318021e-03   +2.963600200742496e-03   +1.834779261453920e-02   +1.351267556102521e-02   +8.541800744339967e-03   +8.023104390343452e-03   -3.583858509246626e-04   +1.421673076213504e-02   +2.981576691429164e-03; +6.694853742593949e-03   +8.376751787465197e-04   +1.119201526937694e-02   +1.070813900081325e-03   -5.571056942489669e-03   +3.834853396114683e-03   +9.657588005508324e-04   +8.129217281835717e-03   +5.975663868198549e-03   +3.998820583609320e-03   +4.885204293340146e-05   +8.358683511310434e-03; +9.756862846161025e-03   +5.346828472037374e-04   +2.510678427659141e-03   +4.161598024315078e-03   +1.074304267427663e-02   +3.177344413299562e-03   +1.986490903306899e-03   +6.351263844472902e-04   +3.099682925668221e-03   +1.381755172876152e-02   +4.175715107074669e-04   +7.537595555189235e-04];
L3I_L2I_iGABA_netcon = [+6.837851022048445e-03   +7.793054191990598e-03   +9.192139324682460e-03   +1.039551272544301e-02   +1.151939948619116e-02   +7.658934847422433e-03   +2.144976793724004e-03   -6.046593914818999e-03   +1.055591933716568e-02   +1.246745010006801e-02   -6.301731405129409e-03   +1.661631565239439e-02; +1.082785993304774e-02   +1.255788150122567e-02   +1.146370619590437e-02   +2.086825520944758e-04   +7.218613170985741e-03   +1.354241604651373e-02   +4.839143656636491e-03   +3.626094502453804e-03   +1.070857426569693e-02   +9.298920526202764e-03   -3.224278525305407e-04   +4.047745021357081e-04; -2.241170950962682e-03   +2.131931838371365e-03   +8.661724277647016e-03   -8.679587243933973e-04   +7.776574611310667e-03   -3.460802183053102e-03   +1.106235619186419e-02   +6.181071607661088e-03   +1.078015714906530e-02   -4.576044173224623e-03   +7.585326438040194e-03   +4.054484485733242e-03; +1.576741750591778e-02   -4.588543918936914e-04   -1.929994245627245e-03   +8.793661429036270e-03   +7.847070990180383e-03   +1.289544809452206e-02   -5.041218500301068e-03   +7.509178950650642e-03   +1.049001707484040e-02   +5.482371046550752e-03   +7.672992148763552e-03   +1.200151065573763e-02; +5.355013212820831e-03   +1.398604094407669e-02   +1.199303413286297e-04   -2.120005903999256e-03   +3.078322857744737e-03   +1.310800059832514e-02   -5.230232141900574e-04   -1.704211267206874e-03   +1.107162784297589e-02   +1.310526342227675e-02   -5.422881905136237e-03   +5.414988512936008e-03; +1.143646989330556e-04   +5.268455749788271e-03   +4.688342601764079e-03   +6.251943379015767e-04   +4.455087819405811e-03   +8.801521903728959e-03   +7.152252769570037e-03   +4.088145884365798e-03   +3.120791924157201e-03   +4.353555341014066e-03   +6.836201393390670e-03   +4.273798606078976e-04; +8.837355390232338e-03   +8.946246815258851e-03   +6.386972931001872e-03   +1.188026939180375e-02   +4.469547915547473e-03   +2.783065559891535e-03   +3.978850301365139e-03   +7.553144606607868e-03   +1.239203010441286e-02   +8.033305525929969e-03   +9.288396204441122e-04   +6.599585572798399e-04; +4.481796343119101e-03   +3.922796259971092e-03   +2.373399547891783e-03   +1.036422028232049e-02   +7.713234597785641e-03   +3.265618666683461e-03   -2.125264371390179e-04   +1.183904151247258e-03   +1.391457600690199e-02   +6.544023706752005e-03   +2.568018351270719e-03   +8.209480298236965e-03];
L2E_L3E_iAMPA_netcon = [+1.217302460252452e-02   +1.343284492829518e-02   +8.227477483885783e-03   +1.216858880753601e-02   -1.122152787847776e-03   +5.514652181388604e-03   +1.207462038490577e-02   +1.316309614789934e-02; +8.552871504429363e-03   +1.284949146712705e-02   +9.256829315016963e-03   +7.873233675186901e-03   +5.222770948504988e-03   +6.331955910334957e-03   +1.183399485689021e-02   +8.976344768643662e-03; +9.287249194207429e-03   +6.695745944602805e-03   +1.755833470851889e-02   +1.166991178038915e-02   +9.610832648142087e-03   +9.179292368775393e-03   +7.568446363422316e-03   +5.630576391703125e-03; +2.732690516072258e-03   +6.989405290270789e-03   +1.170029352522526e-02   -2.481824513088693e-03   +3.572808032286360e-03   +6.290222356010211e-03   -3.668798935807186e-03   +4.630989552813630e-03; +8.855943219406649e-03   +3.281110576798767e-03   -2.731177042304222e-03   -1.789421765741548e-03   +2.878845316244823e-03   -1.330399285608145e-03   +9.831648253608632e-03   +9.071688312077072e-03; +7.921678037087928e-03   +1.148942880273284e-02   +6.057707703072332e-03   +2.617183181918812e-03   +1.343343651155521e-02   +1.782495176710845e-02   +5.869856725020291e-03   +1.195776615803390e-02; +3.445501183518322e-03   +1.937925045027569e-03   +1.041399745089108e-02   +1.280518720056199e-03   +4.926160621379174e-03   +1.169470832902167e-02   +4.671846914781414e-03   +5.778356927261977e-03; +1.716083768001815e-02   +6.068235900992256e-03   +1.089699408962980e-02   +1.144320983486956e-02   +9.486742458367992e-03   +1.417602851624630e-02   +8.910878075857234e-03   +5.796635611743145e-04; +4.405152965689178e-03   +1.816299977930822e-03   +7.963201801063493e-03   +1.158212265115277e-02   +6.630480274877870e-03   +3.212538352158335e-03   +1.164249689089665e-02   +2.510258471078793e-03; -3.458159281222523e-03   +5.940463833539560e-03   +3.371948919352621e-03   +1.177096715719089e-02   +1.091368753503251e-02   +3.611251698814883e-03   +2.748498134546762e-03   +9.519122458905913e-03; +7.336406475090402e-03   +4.170547289451617e-03   +6.884703223843606e-03   +8.943585775140850e-03   +1.873788910554982e-02   +1.230952197621858e-02   +5.057776733476043e-03   +3.213404608264508e-03; +2.594637906698524e-03   +9.405152022310280e-03   +6.419494211708728e-03   +1.139717076070594e-02   +1.122077095431134e-02   -6.023572329877821e-04   +1.415498739660790e-02   +1.199322881277028e-02];
L2I_L3I_iGABA_netcon = [+1.506705220081396e-02   +9.878190792287009e-03   +1.247449324822919e-03   +7.555711269884176e-03   +1.056676054236364e-02   +1.122577651247382e-02   -2.326711407310503e-03   +6.784104897981770e-03; +3.754104186783557e-03   +8.043936987048502e-03   +1.533559152292922e-02   -4.775527425190940e-05   +8.860173802882162e-03   +8.349557878587432e-03   +2.435231271167887e-03   +9.673847191631352e-03; +6.795768897005824e-03   +1.221932834291148e-02   +8.317286125202135e-03   +5.433886288304430e-03   -1.152994697239899e-03   +4.841667191900554e-03   +7.713960459061755e-03   -4.156191739070401e-04; -1.897515682474351e-03   +1.185063160353827e-02   +1.814410169588079e-03   +3.301003874244817e-03   -4.627177681221993e-03   -3.288973015787770e-03   +7.450118444694360e-03   +1.038625252959181e-02; +3.062623614736147e-03   +4.664737934277213e-03   +3.052852618434734e-03   +5.215944889357491e-03   +1.039620564551991e-02   +2.572286698995879e-03   +2.186112325177009e-03   +5.617669727791229e-04; -4.003113468101441e-03   -1.318042376007196e-03   +1.232395399439396e-02   +6.760685221410640e-03   +4.574972605204604e-03   +4.290476423827867e-03   +6.448665021117893e-03   +1.173213809375559e-02; +1.790606355544800e-03   +6.456356316035858e-03   +1.149728491574070e-02   +1.093939519718660e-02   +5.351315579768853e-03   -2.007236480301450e-05   +9.844443042594168e-04   +1.277129326610528e-02; +2.771243043205463e-05   +1.736907236237802e-02   +2.779727418151865e-03   +6.780494007679180e-03   +6.238921443990408e-03   +9.481494375754386e-03   +8.241397779540034e-03   +4.567921267963588e-03; +1.109375031123109e-02   +1.006150534229968e-02   +1.753138316311858e-02   +5.863615252769070e-03   +6.118447509158338e-03   -2.023560450162064e-03   +2.885810838584015e-03   +6.208733393791017e-03; +1.106395484119472e-02   +1.145553086446159e-02   -3.967184669861925e-04   +2.530674500498365e-03   -1.896148601047684e-03   -6.910954526523606e-03   +5.374235829498038e-03   +2.625681944275314e-03; +9.067724257625984e-03   +1.515140789271984e-02   +1.921613146890003e-03   +5.100536415795233e-03   +5.794024844385754e-03   +6.053091510808908e-03   +7.653411270585466e-03   +5.327154551424624e-04; +7.016528730680670e-03   -2.731787341310187e-03   +6.878429637626141e-04   +2.895864097505977e-03   -9.196262042130430e-05   +1.236028370477136e-02   +7.858130224138539e-03   +4.091297862290295e-03];
L3I_L3E_iAMPA_netcon = [+8.813870505496970e-03   +8.837144429887579e-03   +8.645290525218468e-03   +1.224523782769735e-02   +1.417975792924043e-02   +7.799545486175782e-03   +7.266850578962869e-03   -2.439347864388868e-03   +5.310176357245924e-03   +7.603047170505489e-04   +1.553995840959875e-03   +3.504729355961784e-03; +7.614554697587482e-03   +8.476500175945374e-03   +1.125286939501907e-03   +4.456277402407164e-03   -4.589405944215605e-03   +7.663301822399811e-03   +9.225762395347944e-03   +3.520330132673983e-03   +6.250367872120861e-04   +5.161938913952350e-03   +1.156025873053691e-02   +1.092140861291328e-02; +2.358025884493052e-03   +1.030563185815876e-02   -1.896860229938407e-03   +1.379680565392655e-02   +2.755350179182946e-03   +1.079166000122530e-02   +7.863179549162430e-03   +6.623742230376374e-03   +7.209514707585650e-03   +1.081392042165827e-02   +4.569922312040659e-03   +9.819709184395179e-03; +1.303505535314164e-02   +1.248517950888459e-02   +8.442713343043329e-03   +6.697044746266506e-03   +4.762687527662261e-03   +8.038163012962842e-03   +1.789466828813627e-02   +5.841243096172518e-03   +1.220227518621743e-02   +1.734937217999903e-02   +1.200771978757850e-02   +9.303681941340873e-03; -1.152075505286895e-04   +3.900114945157720e-03   +1.947117065068167e-03   +1.137724745609068e-02   +4.822805952212734e-03   +4.895937587517968e-03   +1.256316848398669e-02   +3.271742034158093e-04   +7.236616755723138e-03   +5.376468240890538e-03   +1.452592124138602e-03   +6.952712376155908e-03; +2.359075092526715e-04   +7.689545945339771e-03   +1.167433687199688e-02   +1.093340390366930e-02   +1.176595343289125e-02   +3.424883853760490e-03   +1.287981286821216e-02   -1.264935708293377e-03   +7.586584084392455e-03   +2.954103655298666e-03   -1.988495703087352e-03   +6.355113094815801e-03; +6.253012294177573e-03   -4.279933932158922e-04   +6.235730998736570e-03   +2.055605685169189e-04   +7.849202445284633e-03   -3.415639753573194e-03   +2.542856935284292e-03   +8.208863217431009e-03   +5.072075415886584e-03   +1.511651159469860e-02   +8.084804951534498e-04   +1.081327546573040e-02; +7.299915399853397e-03   +3.897763821583613e-03   +1.159750398245763e-02   +6.841137936144628e-03   +8.311688754350606e-03   +2.650755146567537e-03   +7.856263571217432e-05   +3.519437850330200e-03   +3.936867776349630e-03   +1.888409743255963e-03   +2.590881657361627e-03   +1.116959177518916e-02; +4.498856715021964e-03   +9.376731029354815e-03   +6.560475887213126e-03   +7.781664505462127e-03   +5.410905961259154e-03   +1.208287228622277e-02   +6.222264924571176e-04   +1.357531071054051e-02   +1.351873451090773e-02   +1.217505460707951e-02   +7.125757526967298e-03   -4.669466350245388e-04; +7.765034834283610e-03   +1.159626421779346e-02   +1.297399051484264e-02   +6.110190830577535e-03   +1.293405510252184e-02   +1.052886683700712e-02   +3.485572009643308e-03   +1.712269959597896e-02   +5.520510997728567e-03   +1.181949373610435e-03   +7.214433989803005e-03   +6.832852810635800e-04; +5.801320845133476e-03   +3.130520455120682e-03   +1.615030711367491e-02   +9.426765711339710e-03   -4.533025277961801e-03   +1.018791999759190e-02   +5.280847087444882e-03   +6.757317520700105e-03   -5.083057952054476e-04   +9.731167004357198e-03   +3.560544877861698e-03   -2.239538826330932e-04; -4.172372787738746e-04   +8.615595933602654e-03   +2.441901030514945e-03   +9.923349278558194e-03   +3.048019836247441e-03   +3.071849211306901e-03   +1.952492199382496e-02   -4.181853526374464e-03   +2.290354373823300e-03   -2.332789974863265e-03   +1.365085611332404e-02   +4.509178930734662e-03];
L3E_L3I_iGABA_netcon = [+2.575706832622627e-04   +2.958048694382659e-03   +3.878359120016374e-03   +1.454241242306307e-02   +1.038527323749140e-02   +1.424793961296475e-02   +4.148594793072129e-03   +5.926266398964439e-03   +8.783224224813828e-03   +9.782085664949871e-03   +6.051870547022335e-03   -4.044102774430360e-03; +1.090213562959167e-02   +8.227813737129481e-03   +6.462147444881818e-03   +1.539937519335255e-03   +7.779193791929617e-03   +1.036492662999030e-02   +2.601076217268850e-03   +7.092554604858642e-03   +8.131952037267584e-03   +1.219333961800574e-02   +2.255542417775496e-03   +2.684486580631022e-03; +2.125583894618464e-03   +7.166212237159099e-03   +1.027651428324018e-02   +4.742698676409188e-03   -2.206926348596186e-03   +8.658147091879382e-03   +8.551466631582468e-03   +1.219106249980134e-02   +4.435336782610907e-03   +1.741826025348790e-03   +5.172234464257583e-03   +6.563984010704094e-04; +3.304752044301197e-03   +2.762040534324528e-03   +1.076846361130635e-03   +1.144315197827187e-02   +1.106050842428520e-02   +1.062119448358450e-03   +2.243388268890856e-03   +2.972538601490447e-03   +1.042773052954635e-02   +2.747487388667648e-03   -4.889025507672243e-03   +8.455384733772935e-03; -2.019119495301919e-03   +1.344674077033353e-02   +1.640851247424088e-02   +7.441578576217172e-03   +4.560712617314897e-03   +8.652130354413029e-03   +1.082207460714466e-02   +1.432382830547022e-02   +9.231321372715682e-03   +1.403742082686847e-02   +1.410071090080283e-02   +7.649299304382197e-04; +6.108598262861215e-03   +3.597915697584182e-03   +1.779941467639929e-02   +8.770942796094942e-03   -1.391928957824390e-03   +1.492140204995853e-02   -8.257769122920271e-04   -5.569629192833828e-03   +1.177872640580887e-02   +6.668933561061288e-03   +1.588548916967703e-03   -3.696368325126917e-03; +2.942798669518430e-03   +6.040549954626174e-03   +2.108612729324950e-03   +8.158382879909377e-03   +7.201211679040726e-03   +1.051102323831586e-02   +3.275172492263170e-03   -4.208873111033792e-04   +7.192775413355676e-03   -6.221037724351937e-04   +1.369773620988012e-03   +8.737117402354121e-03; +4.231989359497941e-03   +6.262035453352736e-03   +7.162121846120939e-03   +1.189029170346631e-02   +2.873886193941276e-03   +1.423067269596374e-02   +6.832647281836112e-03   +3.261720408337559e-03   +1.372805833650874e-02   +1.281085077879409e-02   +5.824574198116674e-04   +9.565401438103471e-03; +2.894807331272444e-03   +1.749819849344221e-05   +1.177727310820280e-02   +2.431559193420697e-03   +1.386403377954150e-02   +7.857046909393385e-03   +5.439269442197902e-03   +1.956537734797186e-02   +7.524162661885561e-04   +4.738527767919518e-03   +4.744466233413336e-03   +7.252191336951925e-03; +9.751548484135984e-03   +8.386857095906584e-04   +8.978972320260077e-03   -3.364510005003795e-03   -7.004207802071296e-04   +1.418264351228710e-02   +8.630659853012600e-03   +1.305016165859382e-03   +9.961102030777574e-03   +1.175590594170494e-02   +5.251023714041433e-03   -4.184671208497416e-03; +3.017487774890470e-03   +8.575468435605684e-04   -2.639633086524861e-03   +4.260499658451866e-03   +9.073548485681621e-03   +2.555847913089991e-03   +1.537373292040475e-02   +8.569181615370951e-03   +1.064970342573670e-02   +6.736398727386262e-03   -4.487630086433223e-03   +9.431765406547473e-03; +9.559767826260588e-03   +5.392095946578588e-03   +6.331881235149566e-03   +3.961015429711430e-03   -1.623023660523657e-03   +4.920003556357955e-03   +1.610991411490063e-02   -5.528074962460453e-03   +1.368165556626043e-02   +9.346447039517796e-03   +3.065822785744155e-03   +5.279547577337459e-03];
L2E_Input1_iAMPA_netcon = [+8.374563301793325e-03   +1.125719922372982e-02   +9.154185186376243e-03   +1.170843817397083e-02   +1.924541793688214e-02   +1.445472429814806e-02   +1.023943320324421e-02   +5.302990999263776e-03];
L2I_Input2_iAMPA_netcon = [+6.997280007228801e-03   +1.237857652482316e-02   +1.190162998435973e-02   +8.785700582038527e-03   +4.666070357478050e-03   +1.120395684615711e-02   +1.238799806591791e-02   +1.380769839239446e-02];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.0*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.2*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.0*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.2*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.0*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.0*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.2*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.0*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.2*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.0*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
