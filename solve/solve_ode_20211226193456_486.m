function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+7.766815383210256e-01   +7.663153583210454e-01   +3.406113483275334e-01   +2.654797942500762e-01   +4.879815437622232e-02   +2.065823876278343e-01   +3.874030868152080e-01   -7.950375405039865e-02   +6.609733238413182e-01   +4.039262153173075e-01   +6.133739399403402e-01   +4.448288761628472e-01   +3.843374003894637e-01   +8.263374640463640e-01   +1.923645470953178e-01   +2.685774151768943e-01; -1.815814167816286e-01   +4.492268019399392e-01   +1.482446372468003e-01   +8.178562550983325e-02   +2.774401316761723e-01   +1.491188282033657e-01   +7.365888689471785e-01   +7.266771628479922e-01   +5.520778038366129e-01   +4.733229101680280e-01   +2.795487087699339e-01   +6.488205489237150e-01   -1.904164438322869e-01   +8.465494176505846e-02   +5.777929131690065e-01   +6.979435419857453e-01; +3.603159670464818e-01   +2.286313478842044e-01   -6.553084428465876e-02   -6.079386245514534e-02   +2.819912279718723e-01   +6.757018744299772e-01   +4.333396585151260e-02   +2.987561875922662e-01   +2.615975578130164e-01   +3.497747762101024e-01   +2.743183454103857e-01   +1.624339967832892e-01   +8.595483172177709e-02   +1.607385171626687e-01   +4.087774356293681e-01   +6.918220297082344e-01; +4.881737969199008e-01   +4.819264306492283e-01   +7.069746793228206e-02   +5.489699515341776e-01   +4.298064901248673e-01   +1.016267991236079e-01   +8.179453225195608e-02   -1.620613232629998e-01   +5.884708467598750e-01   +1.751828636057617e-01   -1.206231926558099e-01   -2.207708779817704e-01   +4.016715682125016e-01   +2.112015483102838e-01   +5.533589970100304e-01   +4.202508437854044e-01; +2.023969088406268e-01   +3.522330175058030e-01   +4.837277196646509e-01   +9.053706805286227e-02   +9.712543891884223e-03   +1.702853585782134e-01   +2.869678599822277e-01   -9.283741567036979e-02   +6.538074017527353e-01   +2.853890225361362e-01   +4.208137025254302e-02   +1.185826704365943e-01   +1.317387608450929e-01   +4.812702026319398e-01   +4.659453647641881e-01   +4.545566954127727e-01; -1.625256532004855e-02   +7.792597058536460e-01   +5.566981179459796e-02   +3.457811807467793e-01   +1.529190148474909e-01   +6.556037824778347e-01   +2.433817869660881e-01   +2.695003066095786e-01   -2.260233473001249e-01   -1.007186792431899e-01   +1.836551289724733e-01   +4.706903516262989e-01   -2.512663311431028e-01   +2.274843572684666e-02   +3.395514660398812e-01   +4.233812052099241e-01; +5.240459206478904e-01   +1.575830664920692e-01   +3.324095930449968e-01   +4.880245317123309e-02   +1.058994619830475e-01   +3.034146520903603e-01   +3.532855394104150e-03   -1.444886248987824e-01   +6.382227206030959e-01   +4.246146286762957e-01   -1.517186863382325e-01   +2.388373472201406e-01   +2.314180551757399e-01   +3.001215159817838e-01   +3.599840509538446e-01   +3.654604194328365e-01; +7.458090102528036e-01   +2.212203367156780e-01   +2.988265444799530e-01   +6.176133974483407e-01   +5.802508915290531e-01   -4.862463653444153e-02   +2.814383559010732e-01   +6.246798208621943e-01   +5.158236457101936e-01   +1.118701810448597e-02   +5.991580528430234e-01   +2.517167376166568e-01   +4.002791052054879e-01   +4.924663969182246e-01   -2.822889020713910e-02   +2.663519203953127e-01; +4.409501333232645e-01   +6.747852444413542e-01   +3.594843846649364e-01   +1.995503442278160e-02   +1.900144342861712e-01   +2.370604190965185e-01   +1.173570971290598e-01   +5.887102386563337e-01   +4.316220423163082e-01   +4.183471243742020e-01   -2.921359546789044e-01   +3.722021286078683e-01   +8.177912931530293e-02   +9.675256541232002e-02   -5.176546603900780e-02   +1.899545714648725e-01; +1.866208089241227e-01   +3.867281417335349e-01   +5.239563834379741e-01   +5.162236146147913e-01   +5.221545405999166e-01   +3.371880779979293e-01   +1.875491334858514e-01   -7.153795637135328e-03   +1.997240948356797e-01   +4.284929172262110e-01   +1.431948664391242e-01   +5.795375128157710e-01   +3.697959535718387e-01   +4.567466428186411e-03   +2.522331331713423e-01   +4.303899768620986e-01; +4.715462848311920e-01   +4.745821563451031e-01   +4.502058560962954e-01   +9.945732741707819e-02   +8.271878249423653e-02   +8.667344582502123e-02   +3.776767086328146e-01   -1.676657876655055e-01   +4.220647931408005e-01   +2.786944687708055e-01   +5.175948476699876e-01   +1.293975399612291e-01   -1.019068098562542e-02   +6.233408150207901e-01   +5.809483076325106e-01   +6.880232261670483e-01; +2.669745419201983e-01   +4.278799214786336e-01   -2.527974284369919e-01   +2.172607512872338e-01   -1.586376078960540e-01   +6.180050039771851e-01   +4.659051936607504e-01   +4.022289379397052e-01   +5.737507127095550e-01   +7.927773466011270e-03   +7.894087592836780e-01   +4.644447772454360e-01   -3.648971443101125e-02   +5.427679449082712e-01   +4.222504600431947e-01   +6.635413374357592e-02; +7.770059217124327e-01   +2.773265584529715e-02   -4.041694924494696e-02   -5.395699062076531e-02   +1.455162587215881e-01   +7.650366586142179e-01   +5.152226477507461e-01   +3.925896126949738e-01   +1.793690022347858e-01   +4.897441271316095e-01   +6.702486516256276e-01   +3.866227967162936e-01   +3.185937200656394e-01   +5.765591311561145e-02   +2.305823794739952e-01   -9.719081308382733e-02; +3.751491755737846e-01   +2.024570288265737e-01   +1.687224205096651e-01   +1.660201225774171e-01   +4.954968077039103e-01   +7.262784765473933e-01   +3.086016640723908e-01   +6.837989853455722e-01   +6.487945861971548e-01   +3.056214932611163e-01   +2.054134561541160e-01   +2.842636526831364e-01   +9.065872762185766e-02   -1.616555977084196e-02   +6.455071527660227e-01   -1.526023103470758e-02; +7.093563288829954e-01   +7.661747725063706e-01   -1.453557506247733e-01   +1.983881052037839e-01   +3.351320202654305e-01   +3.865927938519442e-02   +1.543287499699602e-01   +4.510348985518663e-01   +4.822964145568880e-01   +9.267527073528923e-01   -2.336437029454794e-02   +5.084207398536972e-01   +3.998153889793837e-01   +1.357117275576193e-02   +1.516068086630347e-01   +7.606526371501147e-02; +1.315643990485980e-01   -5.180981872752152e-02   +3.748433763168567e-01   +1.461317880372774e-01   +4.277415388857844e-01   -1.683822485740432e-01   +4.235160392100539e-01   +3.241620923036365e-01   +5.622648184489966e-01   +2.057205319185835e-01   +3.769769003077209e-02   +3.880979858813844e-01   +3.906087875872190e-01   +1.262037247948103e-01   +1.825692121710580e-01   +2.844667462932003e-01];
L1E_L1I_iGABA_netcon = [+6.309864369477655e-01   +2.681210479996701e-01   +7.125334142172328e-01   +3.646551779352376e-01   +5.699158370703013e-02   +1.231930938720957e-01   +3.519219423962030e-01   +4.605903967353832e-01   +2.055521796225529e-01   +3.421725946928054e-01   +9.297208387035524e-02   +5.109767062984061e-01   +4.433008523308807e-01   +2.441728115045583e-02   +2.245301239938734e-01   +4.955173967172094e-01; +7.661670386880065e-03   +2.180808446867943e-02   +4.350976489736211e-01   +2.841097577326414e-01   +4.276602902823595e-01   +1.585235046315897e-01   -5.184885794182635e-02   +1.564817759206907e-01   +2.617293055341867e-01   +3.269765774369526e-01   +2.955146425834717e-01   -1.229074228954680e-01   +6.433884433431654e-01   +2.424995848973766e-03   +3.156711280122488e-01   +2.963416204047463e-01; +8.328643217000408e-01   +1.470505234358758e-01   -8.391469722369665e-02   +5.402841989395296e-02   +3.414979989395502e-01   +2.355639829202734e-01   +4.933815949628272e-01   +1.718614599359003e-01   +1.473544463487960e-01   +2.645237392530236e-01   +5.460522104782357e-01   +4.248729609718177e-02   +3.758838013574659e-02   +6.290322576629099e-01   +2.958053414578575e-01   +3.966672316405648e-02; +4.374035438148601e-01   +2.094706116919702e-01   -4.860279943832951e-03   +2.700667644806769e-01   +6.370970551034025e-01   +8.224272253422360e-02   +4.650760204898147e-01   -8.676557475136321e-03   +1.163217414807876e-01   -1.605458825252407e-02   +4.016312277415724e-01   +5.976697759896475e-01   +9.263626345904102e-02   +4.230847631464795e-01   +4.128623391110727e-01   +3.221968450583827e-01; +2.425854227325389e-01   -5.224534682835111e-03   +6.268541236840007e-01   +5.337913363944423e-01   +3.184452160810275e-01   +3.990362443451158e-01   +2.548194241900692e-01   +5.943975596673357e-02   +3.105127432067676e-01   +5.069210227435126e-01   +7.856968197188851e-01   +4.065062140384486e-01   +3.041988459568888e-01   +4.356527111677599e-01   +5.495771131154080e-01   +9.034348019112397e-02; +4.670250372050166e-02   +4.847503270341478e-01   +5.076500693465917e-01   -3.906365716693728e-01   +2.455474701578165e-01   +5.249297426233092e-01   +2.099977179824707e-01   -6.423523506648018e-02   +6.667611439515801e-02   +1.848883090374301e-02   +3.284491774287687e-01   +5.667270746728817e-01   +2.538954074007267e-01   +1.851456468160844e-01   +5.238737760364295e-01   +3.930776299921033e-01; +1.694771196869441e-01   +4.684558078801191e-01   -2.800889344816332e-02   +4.039778000432001e-01   -1.861958051533188e-01   +2.554514432920397e-01   +5.331539526363984e-01   +8.225615013565535e-02   -3.449042040517551e-01   +8.455313595002228e-02   +1.872367402051610e-02   +8.384370995220630e-03   +3.179702757063258e-01   +3.496015472977088e-01   +2.724337413476188e-02   -1.914440713833250e-01; +3.384292801389673e-01   +3.651837580282682e-01   +2.620807730086716e-01   +6.161932996084630e-01   +2.075081151957063e-01   +2.708877908682841e-01   +1.115636204418365e-01   +8.155642382144720e-01   +5.743913685689522e-01   +2.081037079916819e-01   +7.963794214994955e-01   +3.133884197434169e-01   +8.559155166833887e-02   +2.280056634468160e-01   -1.651825681125833e-01   +3.269631042831608e-01; +4.168716230919177e-01   +2.080121176275453e-01   +1.261773209930650e-03   +4.627988480893561e-01   +3.219520137528731e-01   +4.372411104699053e-01   +6.678518445793934e-02   +3.155426345177096e-01   +8.248613358563976e-01   +6.048175868694361e-01   -9.238633112701761e-02   +1.894044762552281e-01   +3.005572310159107e-01   -2.324021590926883e-01   -1.822852394845214e-01   +4.086463889572218e-01; +1.985565449352490e-01   +2.773551375956815e-01   -6.851546199785320e-02   +2.961831788280030e-01   +3.517487085722534e-01   +5.660059712191601e-01   -1.805979038219867e-01   +3.663687915071616e-01   -1.087314175973073e-01   +6.380316498133083e-01   +5.733621412953984e-01   -5.186950696837096e-02   +1.670925938737217e-03   +1.308986498451433e-01   +7.606277206200380e-01   +5.296456479350128e-01; -9.189440033383747e-03   -1.401792287385754e-01   +1.821455236711809e-01   -3.098124478510829e-01   +3.655861330516665e-01   -1.632735062352314e-01   +9.370920654449597e-01   +5.189455352258612e-01   +1.192586597539282e-01   +1.428766495854074e-01   +6.719814038061557e-01   +2.008326053536574e-01   +3.884363890650101e-01   +2.477602492087081e-01   -1.590688681988889e-01   +4.022768995066665e-01; +4.023170529867473e-01   +1.472644501178638e-01   +1.794111657974551e-03   +2.806522978955313e-01   +1.106320566515796e-01   +4.691511295979087e-01   +4.265401494176312e-01   +3.063789158491050e-01   +6.591647436926809e-01   -1.027605403549555e-01   +5.084553761803799e-01   -3.621475242034845e-02   -1.175736257140046e-02   +2.676131823831532e-01   +1.844971210069171e-01   +3.842481666055621e-01; +2.541480432222568e-02   +7.910641733738044e-02   +4.947708831675108e-01   +5.227090703258657e-01   +2.934178334023470e-01   +3.673096535481500e-01   +2.817608707724908e-01   +1.459395295182803e-01   +2.097056426790035e-01   +4.424861918681109e-01   +5.763771622627356e-01   +2.857837140283845e-01   +2.391468357584042e-01   +5.027656402988635e-01   +2.412822258370894e-01   +4.131507452421904e-01; +3.545686623181671e-01   +3.116858813048540e-01   +2.634423182433663e-01   -6.949385414502240e-04   +7.462715893936334e-01   +3.252548929504536e-01   +5.189296242795995e-01   +9.737581910076942e-01   +5.463496020194611e-01   +5.799312788473280e-01   +1.177699208305098e-01   +3.966788159618326e-01   +2.590338497020436e-01   -2.898837535476509e-02   +9.008848694980764e-02   -1.912794047866759e-01; +6.526520504650613e-02   +3.659794267875109e-01   +3.588929004558583e-01   +5.405008915784124e-01   +1.769682382121252e-01   +6.316777946213153e-02   +2.228755504379903e-01   +1.701356501918587e-01   +1.737981701891907e-01   +4.288476002050053e-01   +4.068943438913143e-01   +2.767504854396703e-01   +3.120084180735631e-01   -2.681789843881478e-02   +3.531460537538097e-01   +3.780169130577551e-01; +2.382285464419505e-01   +1.345143765637355e-02   +2.002453187986531e-01   +1.047029596768465e-02   +3.940679223714201e-01   +2.996359984171290e-01   +6.041404048721251e-01   +2.228814577471158e-01   +4.243038785446288e-01   +4.905067898981882e-01   -1.187289621925730e-02   +5.628952455153271e-01   +7.454342405587850e-01   +2.558630304698175e-01   +3.206197665041388e-01   -8.339434694141501e-03];
L2I_L1I_iGABA_netcon = [+4.068746867080603e-01   +1.964591303443621e-01   +3.177493598334584e-01   +8.142684368767243e-01   +4.005585725336714e-01   +6.793331876258366e-02   +1.782268498575784e-01   +2.396009632745703e-01; +2.639746525069858e-01   +3.151415104127033e-01   +2.425316259949715e-01   +5.822371833506564e-02   +4.021598137216454e-01   +4.901000702827264e-01   +3.237664227846404e-02   +1.501184362763684e-01; +6.265750512439168e-01   +2.217921206637434e-01   +1.385525976068127e-01   +2.848129609457288e-01   +8.802881467690598e-01   +2.205046131467956e-01   -1.877231223168367e-01   +5.827699068023108e-01; +7.443811014009842e-02   +2.977665464953194e-01   +7.346927384573491e-01   +3.701677166993926e-03   +4.055248095762194e-01   +6.285736181767660e-01   +7.186378919100209e-02   +9.056933212666504e-02; +6.303455515218864e-01   +4.036033149071156e-01   +6.069789787935077e-01   -4.119694769686879e-01   +6.785423991867756e-01   +4.522662710120428e-01   -1.906163875754018e-01   +8.304588067830678e-01; +6.365311522076160e-01   +1.010816238543011e-01   +5.473783922501828e-01   +3.942062106526849e-01   +6.105539473510325e-01   +1.923894653747530e-01   +9.627447799692765e-02   +7.609319792866701e-01; +2.776995458946043e-01   +4.692990798176175e-01   -8.327418713318949e-03   +4.620648373601739e-01   +3.910378732548789e-01   +1.850077793826612e-01   +3.913395898931324e-02   +5.031318486866544e-01; -2.743872283997208e-01   +4.926178698160342e-01   +2.096393983026031e-01   +1.485310136524862e-02   +3.781810857140425e-01   -2.072704094366545e-01   +3.637843244188989e-01   +2.909309044062348e-01; +6.689178482411349e-01   +6.909944640861641e-01   -2.476812106144869e-01   +2.974475214683004e-01   -4.420093727696636e-02   +2.045893635401474e-01   +2.248588499297872e-01   +6.054559605323813e-01; +1.893743164320603e-01   +2.744939064955059e-01   -7.196694723269079e-02   -1.719541564620926e-01   -3.488761170452038e-01   +8.486445917476303e-01   -4.306976022718267e-02   +2.599992780773083e-02; +4.237569072015209e-01   +5.329979568551568e-01   +9.623568453716733e-01   +3.912819215616815e-01   -4.173404752512973e-02   +1.812427577007888e-01   +2.622497336913989e-01   +3.978320227535370e-01; +9.739502815396102e-02   -2.147412277397079e-01   +1.683917675402999e-01   +7.397150696763924e-01   +5.317082298503401e-02   +4.185072700156345e-01   -7.759855163604787e-02   +7.433997760946405e-01; +6.203352701628364e-01   +5.782429381541124e-01   +4.160193422449671e-01   +9.230618025593867e-02   +5.982235382393555e-01   +4.245291190487117e-01   +1.761535319950872e-01   +4.070830323606660e-01; +2.095282060843911e-01   +5.374275433109699e-01   +8.726522291930373e-02   +4.812039712340131e-01   +1.493214817444107e-01   +2.714426157874004e-01   +5.716071015485210e-01   -1.136609434415403e-01; +6.400752358141475e-01   +2.910101628231617e-01   +5.785671916295484e-02   +8.767545090923179e-01   +4.007931225715450e-01   +6.191133497260524e-01   +3.552264553923859e-01   +5.041786200969484e-01; +2.203707936174352e-01   +3.649136218849297e-02   +1.017331971412813e-01   +3.473865347938539e-01   +1.399590815128355e-01   +1.075529309199171e-01   -1.521419269584545e-01   +1.292165839216934e-01];
L1I_L2I_iGABA_netcon = [+6.371407839496536e-02   +1.893645444189063e-01   +2.688431585649914e-01   +4.437897951377159e-02   +1.386274150825928e-03   +8.227069576596635e-01   +1.936167437433919e-01   +3.155852842737855e-01   +2.997130925894960e-01   +8.337223692788134e-01   +2.726371313201100e-01   +9.067777654675727e-02   +5.549969687051268e-01   -1.070500106292923e-01   +4.204080794120713e-02   +4.259524483069317e-01; +3.728728535316229e-01   +6.407164776020560e-01   +6.304924093983937e-02   +6.917636251649011e-01   +1.440965475261748e-01   +2.772808289823416e-01   +5.369872561710891e-01   +3.000210434754003e-01   +8.765776443930207e-02   +5.972968852267366e-01   -1.011598638847602e-01   +4.193496176816102e-01   +2.405234801267057e-01   +2.984326609301988e-01   -3.478321920023651e-01   +2.302178166219233e-01; +4.667172104427154e-01   -1.334184826371205e-01   +1.558016940105506e-01   -9.234476763985848e-02   +6.532603760942129e-01   +4.374766216152920e-02   +1.323814721374390e-01   +2.328632221566475e-01   +3.959191593739945e-01   +5.655663092036154e-01   +7.504241620868908e-01   -2.589892487109037e-01   +1.394263952518588e-01   +4.478060137971274e-01   +1.800321726038042e-01   +3.564520746068578e-01; +4.777504634647628e-01   +2.676758192927883e-01   +2.886640289147019e-01   -6.498843961345649e-02   -1.376277871812185e-01   +6.387282943337889e-01   +4.311061464958710e-01   +2.135795002911399e-01   +3.502559435874676e-01   +4.300048612569772e-01   +3.456884761578600e-01   +6.044092253849009e-01   +3.625178617102383e-01   +1.825785764320614e-02   +2.357089350499755e-01   -1.624090508291399e-01; +6.198582641711264e-01   +3.866634493761985e-01   +3.575939036720731e-01   +4.805948017506878e-01   +4.043442059836190e-01   +3.175922252307467e-01   +1.767858809031091e-01   +4.067696882178023e-02   +6.638354392589205e-01   +2.084544185866953e-01   +5.590725877000355e-01   -3.564269029426134e-01   +1.389042503406784e-01   +3.954539587284531e-01   -1.187286028493951e-01   +6.347334130109921e-01; +7.928785921768177e-01   -2.213741787795026e-01   +3.817694519437962e-01   +7.088855778801753e-02   +4.151452527251065e-01   +1.612314092944677e-01   +4.603744894671011e-01   +3.333328218441781e-01   +5.020826476061102e-01   -8.062088601967513e-03   +2.736426305853016e-01   -2.172117052101144e-02   +2.196272142459871e-01   +7.227882761100642e-01   +5.425879528496232e-02   +2.578999573497702e-01; -1.163998175352996e-01   +5.696047419070422e-02   +1.550843721512631e-01   +4.880745083151282e-01   +4.297496362714945e-01   +2.608352434758301e-01   +5.338228898226631e-01   +3.010499621554450e-01   -9.570694339220735e-02   +1.073523908315891e-01   +6.859292438169190e-02   +3.844302892256617e-01   -3.381044476529356e-01   +3.405123709897909e-01   +3.741746821531836e-01   +4.361824511320714e-01; +5.188822534215169e-02   +3.443070032934514e-01   +5.618940528467362e-01   +5.768496452654078e-01   +3.659801056063734e-01   -5.109609751390311e-02   +6.165959526334834e-01   +1.036110810246578e-01   +5.015444633672277e-01   +1.821708071652824e-01   -1.477818648838339e-02   +2.422608085803217e-01   +3.851667709225442e-01   +2.462771248286011e-01   +7.567317636794444e-01   +7.192101804879221e-01];
L2E_L1E_iAMPA_netcon = [+2.272072986809669e-01   +1.155133514039541e-01   +8.231705029989569e-01   +1.231974873496221e-01   +5.858649614533455e-01   +5.731174279336442e-01   +4.913314756121266e-01   -7.593742234927732e-02; +3.822717751122306e-01   +2.987730028271008e-01   +5.944749692640439e-01   +5.217087348639476e-01   +6.789396003350977e-01   +9.037664227495976e-02   +1.216258633000038e-01   +6.655672043515354e-01; +7.974256273086026e-01   +7.668841076039045e-01   +4.280241638961797e-01   +1.772154490583899e-01   +4.154972901445689e-01   +5.545220876531590e-01   +6.320508441604912e-01   +3.021231818520079e-01; +5.083673822170319e-01   +3.310926437764202e-01   +3.679073071496511e-01   +4.661790046287708e-01   +6.904931398702890e-01   +2.750483230075965e-01   -2.394881141676644e-01   +5.643278870365864e-01; -3.194882035697526e-02   +8.090368632741971e-01   +1.788347499224541e-02   +4.691529117590895e-02   +1.842917953623457e-01   +1.486766648665892e-01   +2.732278481126260e-01   +4.377637993273099e-01; +7.445573464135318e-01   +2.375752722752304e-01   +5.933260023234035e-01   +7.993780145064303e-02   +1.089283538291217e-01   -1.324863959272679e-01   +4.147752918245768e-01   +7.390946943881378e-01; +3.387621754329574e-02   -2.093287203340781e-02   +5.808448637383596e-01   +7.663333782510415e-01   +6.142247407807144e-01   +5.889427676392114e-02   +5.018081955121065e-02   +2.265312741146434e-01; +3.993319753497968e-01   +3.747256581413254e-01   +2.683977085689001e-01   -2.535383097469194e-01   -1.242363701200887e-01   +5.989319652417717e-01   +4.884529923156875e-01   +3.236616805385589e-03; +3.148041868228231e-01   -5.160261213855041e-02   +2.230747717180884e-01   +7.114375868376033e-02   +4.594963813833047e-01   +3.062639230121572e-01   +1.935865068810632e-01   +4.441936130905356e-01; -1.397581958486832e-01   -2.949842626858217e-01   +3.742627036899830e-01   +6.694887245358607e-01   +4.896281804783572e-01   +3.139660645331013e-01   -3.393112814011771e-01   +5.247245002342013e-01; +1.112694579481343e-01   +6.262776143758796e-01   +3.118744001218103e-01   +6.438169983425824e-01   +1.685716723318105e-01   +4.644955026546085e-01   +3.763751070215008e-01   +4.915965566352857e-01; +2.981277445181630e-01   +4.369083229073726e-01   +3.662673123991193e-01   +1.609308952400364e-01   +2.935817923274242e-01   +2.668115038185687e-01   +2.600126931712663e-01   +3.146193612147880e-03; -2.712417751785307e-01   +9.034225377556604e-01   +5.147013409858344e-01   +5.979426461595343e-01   +3.077159660886882e-01   +6.221535873527351e-01   -9.176837767458315e-02   +3.183695370813213e-01; +2.131602915949133e-01   +6.448031503321128e-01   -4.630432567700399e-02   +6.131155765109363e-01   +5.949586547501702e-01   +4.455892844775645e-01   +8.564388015412090e-02   +2.394765335170269e-01; +2.579110064138882e-02   +6.094358757587043e-01   +1.809997251906507e-01   +5.912296976094031e-01   -2.785096522636434e-01   +1.682496341987768e-01   -3.980377196380841e-01   -3.810920974344774e-01; +4.420428282205022e-01   +1.575653452399599e-01   +5.771633032064191e-01   -2.831064705416250e-01   +4.994294102699043e-01   -4.976845299619528e-02   +5.151490593802912e-01   +4.619514015040482e-01];
L1E_L2E_iAMPA_netcon = [+4.251023672315476e-01   +6.674310583508469e-01   +8.867775748088433e-01   -8.139748007851021e-03   +6.587792967326016e-01   +1.485908937174547e-01   +4.872799316999981e-01   +7.301797273197488e-01   +6.383755117430322e-02   +2.013670433141532e-01   +5.456268050936393e-01   +8.462602546188416e-01   +3.295762056150963e-01   -6.334706429831111e-03   +2.829170220103017e-01   +3.671397651919834e-01; +6.919155894725144e-01   +6.063109163195922e-01   +5.054282594490537e-01   -2.752021014965340e-02   -3.374116311548909e-01   +1.048007020102731e-01   +1.769485308974117e-02   +1.209607589079345e-01   +2.910183749368305e-01   +9.060747229194389e-01   +2.856929266525405e-01   +8.641819460425799e-01   -1.917110422673774e-01   +5.838781326019444e-01   +2.722960141662198e-01   +3.496488991338850e-02; +3.270787697018498e-01   +6.390472912148009e-01   +2.191307059667690e-01   -9.881514595699907e-02   +9.528594356979601e-02   +3.937622753489514e-01   +1.240812129887891e-01   +5.929408031432499e-01   +1.915101517571945e-01   +5.765037265742385e-01   -1.568529873385247e-01   +2.182528208055062e-01   +2.426948197300163e-01   +1.935438027504220e-01   +7.727907427915599e-01   -1.077928496682482e-01; +4.205629835285599e-01   +2.677088850582943e-01   +2.914812797842170e-01   +1.043168673506489e-02   +3.942728834691153e-02   +2.232330908620029e-01   +5.925859289459697e-01   +4.188807012064359e-01   +1.981832147066893e-01   +9.062653245321910e-01   +3.371215174159161e-01   +1.222833276472017e-02   +4.765027975843928e-01   +3.235167336473823e-01   +2.176500664425269e-01   +2.384638590698676e-01; -2.727895315326495e-03   +6.727061787220368e-02   +6.077225892526311e-01   +1.561135288709822e-02   +5.674874781133422e-01   +3.772809945038524e-01   +4.894667356204040e-01   +1.580238392714964e-01   +2.216624333520631e-01   +5.225183826932673e-01   +3.244905241438019e-01   +2.443008969656267e-01   +2.360343323676603e-01   +1.350168164414217e-01   +4.874147269787988e-01   +3.879525993672935e-01; +2.440275241645644e-01   +3.658851105792705e-01   +5.601423758419816e-01   +1.585880156272917e-01   +4.444230306990999e-01   +1.438686583510720e-02   +3.270648267317217e-02   +3.682130463918817e-01   +1.573950514702129e-01   +3.101737506331429e-01   +7.633974164270306e-01   +3.599538806190117e-01   +4.737043271287414e-01   +4.223133344469538e-01   +7.591476433702726e-01   +1.538935049420039e-01; +4.757225514242437e-01   +3.896622756466715e-01   +4.568701017266929e-02   +3.136844155281832e-01   -3.047355979364567e-01   -2.408306755801140e-02   +4.926061886830575e-01   +5.958925521243119e-02   +7.508047853716880e-01   +4.823253674481957e-01   +5.103952427948660e-01   +4.785048325518686e-02   -3.033408418736477e-03   +5.959918284588833e-01   +4.000806903526062e-01   -1.458998108416009e-01; +5.628244408014703e-02   +5.610023018871716e-01   -4.319912366834422e-02   -1.475922636427473e-02   -2.374148471197706e-01   -1.970856802906310e-01   +7.228759306288708e-01   +1.771783781070743e-01   +1.114531335658015e-01   +2.868833096019560e-01   +7.383508292326608e-01   -7.507750344803056e-02   +1.238314751770026e-01   +3.515134406316376e-01   +6.025124565945437e-01   +5.704206679968863e-01];
L2I_L2E_iAMPA_netcon = [+9.975677793542717e-02   +5.743229127610650e-02   +3.457792178883808e-01   +2.297038577184708e-02   +3.480805127072007e-01   +1.910356507278346e-02   +4.443245331403893e-01   +2.451934195218195e-01; +1.142787128987896e-01   +1.983156770741923e-01   +8.329470521093238e-02   -1.050818012090563e-01   +1.960175057341067e-01   +6.447157427682659e-02   -1.173895877133608e-01   +2.724328508266174e-01; +7.086596056701538e-01   +3.200377354838652e-02   +4.956749394533161e-01   -7.087700200922697e-03   +5.016370035968636e-01   +5.164878954822137e-01   +2.000186702055740e-02   +2.009810750985129e-02; +6.980590211347075e-01   +1.935023624717571e-01   +1.588056826559648e-01   +1.513901136000091e-01   -2.599966114135827e-01   +1.196855075541952e-01   +1.941468994238789e-01   +1.975482806748505e-01; +3.241445260569060e-01   +9.143421925953037e-02   +1.042296646748005e-01   +7.911607665883353e-01   +4.552575838573790e-01   +3.053164183294040e-01   +8.531085265278450e-01   +4.804132299402842e-01; +7.300026591673681e-02   +8.404521216198782e-02   +1.889059160399598e-01   +5.645295118868154e-01   +1.199574273516930e-01   +5.004971636021052e-01   +3.357351212550584e-01   +4.888656830393397e-01; -1.801537927248485e-01   +3.443994831610549e-01   +4.239802059678166e-01   +2.534895394984747e-01   +3.550104315010128e-01   +2.937071419604228e-01   -2.187905563296194e-02   +1.174999370839622e-01; -8.001902072632786e-02   +2.579475942858605e-01   +7.729415708994131e-02   +3.799818257005915e-01   +3.679340280645335e-02   +5.848693000657361e-01   +3.197042975340794e-01   +1.298658902864477e-01];
L2E_L2I_iGABA_netcon = [+3.846092055579344e-01   -2.378006400627874e-02   +3.581242716236022e-01   +2.960918322146299e-01   +3.415911674340248e-01   +3.358362573838254e-01   +2.542564133415014e-01   +5.245810069085247e-01; +5.270658159060109e-01   +8.649841973082231e-02   +2.895658763076381e-01   +6.750326376131156e-01   +4.423426930998356e-01   +6.394403497799535e-01   +1.489311166268966e-01   +1.473388565472530e-01; +5.178975004379905e-01   -1.651204420684069e-01   +3.913963625024983e-01   -1.577450529763542e-01   +7.835626499869240e-01   +3.797053226163629e-01   +4.267660857503194e-01   +3.455493053333686e-01; +4.988042238639785e-01   +7.785967225336623e-01   +4.208510074919478e-01   -1.909877332670615e-01   +2.328824459067477e-01   +4.408091772772883e-01   +1.938035654891901e-01   +4.408861869485413e-01; +2.465461266666651e-01   +7.732406781965252e-01   +3.567732545713649e-01   +2.541147532923429e-01   +3.161047623826228e-01   +4.507572835287261e-01   +1.530760571153670e-01   +1.247013325624657e-01; +7.538647519079469e-01   +4.229260822165205e-01   +5.804733932755803e-01   +3.334666588845774e-01   +5.268792453370444e-01   +3.555934182227133e-03   +1.320588826958247e-01   +3.335737921870860e-01; +5.361836597521387e-01   +6.345014980127397e-01   +4.416318617127366e-02   +2.946748451572967e-01   +6.401556921380530e-01   +6.537996830864218e-02   +1.714553805551670e-01   -1.054686084346637e-01; +2.323701190545552e-01   +4.676103706898228e-01   +5.393010065576856e-01   -1.380966026398664e-01   +2.130761965823458e-02   +2.297759879593246e-01   +5.101894184249399e-01   +3.339425189054271e-01];
L3E_L2E_iAMPA_netcon = [+1.235687134447017e-01   +5.533518920681356e-01   -2.101293891892253e-02   +1.757669545279674e-01   +6.069787951081469e-01   +2.912901950790406e-01   +2.376928774429492e-01   +1.465308328802943e-01   +1.195541286672065e-01   +5.518485814189764e-02   +7.134477396146319e-01   +3.869357464338126e-01; +3.553934066605036e-01   +5.558691121873481e-01   -1.327794309668804e-01   +4.871621911681719e-01   +4.627592655802476e-01   +4.881639799534788e-01   +1.426290343857037e-01   +1.563826934551527e-01   +3.654246434153902e-01   +5.656099825504874e-01   +5.411884619457996e-01   +3.987750255184607e-01; +2.916952285183486e-01   +7.290348130793598e-01   -8.013076462818958e-02   +4.475316489121069e-01   +5.450659555491084e-01   -1.633485690649454e-01   +1.860414551967286e-01   -9.267021136962367e-02   +3.740281279349677e-01   +6.105831194837223e-01   +1.840660485798501e-01   +3.395202017052919e-01; +2.345592598512488e-01   +3.068797154228815e-01   +4.253657085418986e-01   +3.283049546148448e-01   +3.472848724489226e-01   +4.238217337733908e-01   +4.316660967732192e-01   +6.611654570662852e-01   +4.843282365014834e-01   +4.899359815933400e-01   +1.100070744056755e-01   +2.948894712543225e-01; +2.334880120893378e-01   +2.706000997389637e-01   +2.736770353779457e-01   +4.585275261663355e-01   +3.280311040275454e-01   +9.314251712212958e-01   +5.638965584436867e-01   +4.219952610429612e-01   +4.690571029614717e-01   +5.017170192293670e-01   +7.442806680289049e-01   +5.820776478123948e-01; +3.017209820689875e-01   +2.731452699041145e-01   -1.344299228704905e-01   +5.686367691652836e-02   -1.560165316696917e-01   -1.667184276017492e-01   +2.840777763416697e-01   -5.065672730300588e-02   +9.115692654271379e-02   +2.334266853883424e-01   -1.215212724403483e-01   -3.751231341136698e-01; +3.879455684737159e-01   +2.941196302912619e-03   -1.549470197542814e-01   +5.649289840548923e-01   +4.065870178759862e-01   +1.890589881668971e-01   +5.504018154896276e-01   +2.154795350768808e-01   +2.416352542851953e-01   +7.482001057319670e-01   -2.645224205559585e-01   -1.848154981182099e-02; +4.580548623762243e-01   +6.699346033360580e-01   +6.790203083085263e-01   +5.912812450442291e-01   +2.618077135154577e-01   +3.340138217338151e-02   +2.498549460359735e-01   -1.389796233628883e-01   +6.116303646455004e-01   +2.377967629510095e-01   +4.567916955341401e-01   +5.776917643904362e-01];
L3I_L2I_iGABA_netcon = [+2.020529761900822e-01   +2.460797636550154e-01   +7.949772326675580e-01   +3.843624627767230e-01   +2.034366000889150e-01   +3.234289456944215e-01   -2.040755619980630e-01   +1.706793914664571e-01   +7.517984944877651e-01   +3.998493675930298e-01   +4.887070694204038e-01   -8.372183252815690e-02; +5.340957505210735e-01   +3.180760734432568e-01   +1.574175272849021e-01   +1.222922220585025e-01   +6.673681849546361e-01   +4.825705255565098e-01   +4.725689323132461e-01   +3.437132236502775e-01   -1.338861833503305e-02   +4.244884226773653e-01   +2.078153922543130e-01   +1.303549266537664e-01; +5.919004094364493e-01   -1.217298248073911e-02   +1.091583194724633e-01   +4.338491976055416e-01   -9.330391848157493e-02   -2.086232776775354e-01   +5.453151697489810e-01   +1.481425929596989e-01   +1.891802065756344e-01   -2.082432422547012e-01   +6.734442411566249e-02   +7.699778684819861e-01; +3.495940890650878e-01   +3.665002685449594e-01   +2.569391386598583e-01   +5.322889770141476e-02   +2.702609771165310e-01   -2.704629901382289e-01   +5.928593601230211e-01   +7.335871675685126e-01   +1.727977752640004e-01   +4.511869514940927e-01   +3.384753929870958e-01   +3.186900336929712e-01; +2.721665412997429e-01   +6.584143973965431e-01   +4.994193595979975e-01   +2.290939500852929e-01   +3.328268862719987e-01   +8.074445241260331e-03   +6.795813628448202e-01   -1.354621713056454e-01   +3.014666870102781e-01   -3.162001353640254e-02   +5.470646953933013e-01   +6.306441836999068e-01; +5.944150604346328e-01   +5.935705740194361e-01   +4.971850199549911e-01   -1.726973972657045e-02   +4.124343315508985e-01   +3.635197434542183e-01   +4.558895627284196e-01   +3.021411310389582e-01   +4.063720648174100e-01   +5.601491914468619e-01   +5.340310742329335e-01   +7.386194434192382e-01; +4.603716555464091e-02   +2.335140847224730e-01   +2.663771136739213e-01   +8.181606120395275e-02   +4.195271291187175e-01   -2.455525649970071e-01   +7.062041095157437e-01   -1.631663907190039e-01   +8.086351664937960e-01   +3.762738975746861e-01   +3.798014211819052e-01   +4.887430552695942e-01; +3.582599120149524e-01   +5.388262724942047e-01   +2.509390296468016e-01   +5.606148366938853e-01   -7.828427887666527e-02   +3.499696501040299e-01   -1.714999718521203e-01   +2.112299717516178e-01   -2.432438852844118e-01   +2.422056062782403e-01   -1.708645731887004e-01   +1.217821701734960e-01];
L2E_L3E_iAMPA_netcon = [-2.358927436055173e-02   +2.595311799167145e-01   -1.371401239492143e-03   +1.784362008058773e-01   +2.090521515478312e-01   +1.863218768402739e-01   +3.937843662968220e-01   +7.572182225925638e-01; -9.302758339760438e-02   +1.548432458594509e-01   +1.894168963664867e-01   +7.566890184407414e-02   +6.941711452822020e-01   +2.748508478913836e-01   +7.023316384776757e-02   -2.365009919319101e-02; +1.463797931220474e-01   +7.665166620249267e-01   +4.320714806372158e-01   +1.506836415142517e-01   +6.155632011836605e-01   +2.095089003465463e-01   +6.924761677563763e-01   +3.793643709324082e-01; +4.350589407814580e-01   +6.201099281679813e-01   +2.339574686226955e-01   +3.834959581976618e-01   +4.039675754850550e-01   +3.423152220419640e-01   -1.430827542997852e-01   +2.804799182019583e-01; +6.065990301830477e-01   +4.103585128491084e-02   +6.294978061041465e-01   +4.634624422851474e-01   +8.000749917847148e-01   +5.140072431557263e-01   +5.913410887994144e-01   +2.508582589804176e-01; -1.372826042396247e-01   +1.668627843953243e-01   -1.188355061474064e-02   +2.581506662304436e-01   +3.085849874385700e-01   +1.247558025638322e-01   +7.683422766196130e-02   +7.474117905827238e-01; -2.418715124145968e-02   -6.842187885769521e-02   +2.012729101127601e-01   +1.174632544457351e-01   +2.062629399460203e-01   +6.679152766399452e-01   +1.031686054682468e-02   +6.879368376935860e-01; +5.075512926512991e-01   +5.090655742852184e-01   +9.432188304238023e-01   +6.018332587787303e-01   +4.100126400473525e-01   +3.774723720151200e-01   +8.923875775891026e-01   -1.820029699103972e-01; +5.752881106738634e-01   +2.186215997090184e-01   +4.804861445878446e-01   +3.079510726381305e-01   -1.260108836772804e-01   -3.308887478025096e-01   +3.524932225639062e-01   +5.870384973135480e-01; +4.214103387243959e-01   +7.878138122038973e-01   +2.694461979120718e-01   +2.842412022308644e-01   +2.014938068206689e-01   +4.917299905978733e-01   +2.955520844901428e-01   +2.295672412241133e-01; +3.288106581118001e-02   +2.173877063689291e-01   +3.763330509427055e-01   +2.055829264198782e-02   +1.529363482550112e-01   +2.830323056863045e-01   +4.760264424780979e-02   +7.385382914514054e-01; +5.055099724485134e-01   +4.716538842593614e-01   +7.771296670838981e-01   +3.344494770112411e-01   +3.055600624638197e-01   +2.022711690430006e-01   -1.817768809394581e-01   -1.288316657491215e-01];
L2I_L3I_iGABA_netcon = [+6.848487364557813e-01   +4.546798271925975e-01   +5.368526648962215e-01   +5.348041325492500e-02   +5.100195747624099e-01   +4.236702183686853e-01   +4.705947674795964e-01   -6.882113358125616e-02; -1.478390606039749e-01   +4.447276248837287e-02   +7.105715008436490e-01   +4.764632525715744e-01   +2.465512217177564e-01   +1.819458252317105e-01   +2.975559854682396e-01   +8.568972869861471e-01; +3.376243279085329e-01   +1.730581751942981e-01   -9.864965280867177e-02   +2.545048568394422e-01   +2.295932927113402e-01   +2.289542693908717e-01   +2.623447348357675e-01   -4.204304176081354e-01; +2.279385415635355e-01   +2.565090100254343e-01   +3.073273928536929e-01   -5.107725327790241e-02   +3.214174138080452e-01   +2.784030478015139e-01   +1.467104880629774e-01   +2.355022635275499e-01; +4.871853610636312e-01   +2.161703890214194e-01   +3.864269445213928e-01   +4.206892219085088e-01   +1.744287622386914e-01   +2.320637088758487e-02   +5.162237891073600e-01   +2.985149756387742e-01; +2.698942921136191e-01   +3.938426089083414e-01   +2.554924397913250e-02   -1.287299863674945e-01   +3.268721713093031e-02   +6.354851060015854e-01   +3.922232136020708e-01   +3.703403682650714e-01; +9.006032779365973e-02   +2.964203578898364e-01   +5.238371164476153e-01   +1.218578843523269e-01   +8.675448961050629e-02   -2.469279060311197e-01   +9.588849572778112e-02   +4.656926927020770e-01; +2.260703868974109e-01   +7.075167273664413e-01   +6.144525012925436e-01   +3.380080765031870e-01   +5.613842203840147e-01   +3.518289582268544e-02   +1.759398055347687e-01   +6.748141813567926e-01; +2.127180741827900e-02   +5.451346305226896e-01   +2.584130534450579e-01   +1.107861944094463e-01   -6.014078724861527e-02   +3.723465059645427e-01   +4.865561085507109e-01   +2.981530786087663e-01; +1.194033517829415e-01   -1.494402833424233e-01   +8.609404972340845e-02   +8.553740773883256e-01   +1.831998466071081e-01   +6.813905252037874e-01   +2.694150748701087e-01   +1.609030572256385e-01; +4.092880756707799e-02   +6.113533311050696e-01   +4.307460417126573e-01   +8.224880753698739e-02   +8.511363259027800e-01   +1.205959626647404e-02   +5.508268889264953e-01   +6.519969076356852e-01; -5.065262305847557e-02   +6.646386831899982e-01   +3.386077172277939e-01   +3.527250515250293e-01   +3.733017981647521e-01   +2.473586851003606e-01   +4.400710778658499e-01   +8.896190135975229e-02];
L3I_L3E_iAMPA_netcon = [+6.833210597099298e-01   +2.565686863819571e-01   +6.330857931547729e-02   +5.844069495433227e-02   +2.647738431314077e-01   +4.901163362781739e-01   +3.023992861477417e-01   +3.822514877599255e-01   +1.688985681566058e-04   +5.015841044176819e-01   +1.745358953386151e-01   +4.875932885603574e-01; +2.086868023560796e-01   +4.137305649463197e-01   +4.332696566150660e-01   +8.450601825225577e-01   -1.076071365872077e-01   +7.616399815981172e-01   +3.870410650441883e-01   +3.469099330793330e-01   +1.200544902586536e-01   +5.326227766085445e-01   -9.731278761114645e-02   +9.597748397188398e-01; +3.660471210595990e-01   +1.197625314250549e-01   +1.521569399205761e-01   +3.886844080554994e-01   +2.332355624277214e-01   -2.843092424087538e-01   +2.991018859356108e-01   +1.756000238309389e-01   +5.395908548153862e-01   +4.765493742907395e-01   +3.385436081705064e-01   +2.717314749724383e-01; -2.822829792697251e-01   +2.268782914703486e-01   -7.063547236862684e-02   +3.115095274953169e-01   +6.899243276968097e-01   +9.676834190093606e-02   +2.991643046035624e-01   +5.156876770370833e-01   +6.420020342230486e-01   +6.261007270907841e-01   +3.887663642708905e-01   +2.296986801074347e-03; +1.251627104907835e-01   -3.357393385459771e-02   -3.781551690158678e-01   +3.166609031691536e-01   +1.559837535501696e-01   +6.255473333444366e-01   +3.510686676091168e-01   +2.939917657964590e-01   +3.699878477401517e-01   +5.060031442802209e-01   +4.908639772982291e-01   -1.279211840591340e-01; -1.451579569621231e-01   +2.746502146070452e-01   +3.998191372983254e-01   +2.479273321701954e-01   -3.745307667257219e-02   +5.175362782451971e-01   +3.068784796141165e-01   +8.069012611742936e-01   +3.503476091838381e-01   +3.155444597645415e-01   +4.888178202939147e-01   -9.566156001368398e-03; +1.657075933347020e-01   +4.887026447849925e-01   +5.736890947649458e-01   +2.360979255696656e-01   +1.472316356938742e-01   +7.037786012627359e-01   +2.312801317679660e-01   +5.783528851107095e-01   -7.043896099518016e-02   +7.475153402640260e-01   +4.544470255300866e-01   +5.510465800199382e-01; +1.541080439605308e-01   +2.626700131886098e-01   +2.511619953100037e-01   +4.681510230965198e-01   +4.680900973266108e-01   +5.096025563524847e-01   +1.838866223894892e-01   +6.659725766680517e-01   +4.960092157601709e-01   +6.387386341930682e-01   +6.140226634498962e-01   +4.877961255417634e-02; +3.539717530832543e-01   +6.708177284421858e-01   +8.053768623138775e-01   +7.682837258207971e-02   -4.395783459217655e-02   +1.441556712965542e-01   +1.887372313689550e-01   +2.209347092385022e-01   +4.793654468083551e-01   +1.747193649745668e-01   +1.319362988516786e-01   +5.942610157958232e-01; +4.152797857545533e-01   +4.495336613166909e-01   +3.511590564586675e-02   +4.322823006106607e-01   +3.340752236176568e-01   +2.391916544787105e-02   +6.163759130091290e-01   +4.757728981728324e-02   -1.019791431332337e-02   +4.574410613207080e-01   +3.614386147692632e-02   +5.358434756411299e-01; +7.219001199780258e-01   +6.530513590616719e-01   +2.972963933568756e-01   +5.331427484555591e-01   +8.840527750377469e-03   -3.317374301140558e-01   +9.409040348423320e-02   +2.693206630396753e-01   +7.120413436331902e-02   +4.497118364877741e-01   +3.119842591151530e-01   -5.326871546677361e-02; +4.402865894045503e-01   +2.217835028584810e-01   +6.189864484706760e-01   +1.385105480793159e-01   +5.625677692962683e-01   +1.269488963160119e-01   +2.512435170766957e-01   +7.965661424136272e-01   +2.028961702588543e-01   +5.678182515210516e-01   +1.018279534926667e-01   +7.701060358217329e-01];
L3E_L3I_iGABA_netcon = [+5.067808036354885e-01   +8.252594540412764e-02   +1.871352715197514e-01   +7.697374368362537e-01   +4.335925090770039e-01   +2.847566983908498e-01   +3.130044224633503e-01   +3.512299868673136e-01   +7.600772703808895e-02   +2.836908890310054e-02   +2.475287804360951e-02   -5.402035663717680e-02; +3.089264255872678e-01   +5.719920809341611e-01   +4.095871506816068e-01   +7.904725003294844e-01   +1.562088728466254e-01   +4.303070485119659e-01   +7.612535473548268e-01   +2.573232237736153e-01   +1.671901518407117e-01   +4.847375327994550e-01   -6.732690815261380e-02   +2.064523538336349e-01; +1.394814467853047e-01   +5.723492904466142e-01   +5.540812066762555e-01   +4.686365781464547e-01   +6.103534926722108e-01   +5.660647782431593e-02   +4.954474258302061e-02   +3.177093539379951e-01   -6.316030963005148e-03   +1.588512332066257e-01   +1.821511010458857e-01   +4.178855104376409e-01; +9.011878827043788e-01   +2.487726990684872e-01   +9.321196955018402e-02   +5.358704399780886e-01   -1.681136913439824e-02   +4.119755658248469e-01   +4.365898575193011e-01   +2.062489904315407e-01   +1.415309357491560e-01   +3.257340121200517e-01   +1.304633151483768e-01   +1.260153248062103e-01; -8.951819821146323e-02   +5.844937303976189e-01   +5.700724163842017e-01   +4.506101856775524e-01   +3.114706665597866e-01   +3.287096174321570e-01   +2.406725975859487e-01   +4.471859234314637e-01   -6.221495439483481e-02   +2.138681173381607e-01   +2.739604207076997e-01   +4.122116925198500e-01; +9.092018744933444e-02   -2.266165657580390e-01   +4.122846544329564e-01   +2.918167997796308e-01   +5.628812504498312e-01   +1.203650961534298e-01   +1.005965275473898e-01   -1.063979432261906e-01   +1.182069094891433e-01   -1.404565799402704e-02   +6.385370600987469e-03   +4.215284879753433e-01; +1.355805413541325e-01   +5.091429441783373e-01   -1.427086227269688e-01   +3.302358041194079e-01   -1.467372156172257e-01   +2.453851828054128e-01   +5.392927626391302e-01   -6.763879632943864e-03   +3.692517448502839e-01   +6.574369286792002e-01   +1.540871074758617e-01   -1.470746985565497e-01; +5.469610381560837e-01   +1.876371426876440e-02   +1.153947111329809e-01   +4.849488567080666e-01   +4.824175557817060e-01   +5.386852108136878e-01   -7.240895098591715e-03   +6.230131291232683e-01   +5.451473221725373e-01   -1.325067789973451e-01   +5.801955625746180e-01   +3.673181468555484e-02; -1.812692388383450e-01   +4.626446008776485e-01   +4.306949935582093e-01   +5.142607943864220e-01   +4.952149936467016e-01   +3.684219960235713e-01   +4.081248970180226e-01   +2.963439606292982e-01   +3.046822046818198e-02   +7.955313050789082e-01   +1.432980551185192e-01   +2.581281783975685e-01; +1.814351029326877e-01   +4.914392858513659e-01   +4.396046415880878e-01   +3.512033488932504e-01   -3.572698584614506e-02   +4.755966605809087e-01   -1.826988425463777e-01   +3.162922851747374e-02   +4.703735358004824e-01   +5.429854228358630e-01   +2.712307704168165e-01   -1.813468383325856e-01; +4.019551824505828e-01   +6.607070609709238e-01   +2.681524623399814e-02   +6.818992390839251e-01   -8.951101076477058e-02   +3.382788386186129e-01   +1.054559424410758e-01   +3.836164186650663e-01   +1.457766703952271e-01   +5.062387326630796e-01   +1.994829024201207e-01   +2.074378478197520e-01; +1.191661445684126e-01   +4.594336125114474e-01   +1.101398128792114e-01   +3.250909567824922e-01   +5.920937643902698e-01   +1.998745533126758e-01   +9.984019803827821e-02   +3.334691674029633e-01   -3.574777884044918e-02   -2.514126042964208e-02   +1.973705553506244e-01   -7.866394307480734e-02];
L2E_Input1_iAMPA_netcon = [+3.530771492403624e-01   +2.572355931610706e-01   +5.761227196860866e-01   +2.179027686853283e-01   +2.261250260927458e-01   +1.807983856401643e-02   -3.272916527549342e-01   +8.773228774911286e-01];
L2I_Input2_iAMPA_netcon = [-2.834203298678734e-01   +6.922107754476782e-01   +1.942402202895546e-01   +6.062139328698081e-02   +3.891709390922533e-01   +2.557257706695811e-01   +3.191852021689477e-01   +5.685569630692549e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.04*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.5*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.1*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.5*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.1*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.5*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.04*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.5*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.1*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.5*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.1*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.5*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
