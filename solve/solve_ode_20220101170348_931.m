function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-7.361463712636045e-02   -6.795224613917157e-02   +2.763054284256515e-01   -2.006771492700835e-01   +2.837418245399614e-01   -1.450539573140134e-02   -1.963457435517120e-01   +3.740676141314105e-01   -2.120309407210758e-01   +1.790505821026435e-01   +1.905754300475532e-02   +1.510710730612869e-01   +2.655546923244402e-01   +2.485050691331447e-01   +1.529379159279996e-01   +2.888090167491083e-01; +3.684687580117973e-01   -4.116003842945344e-01   +2.902181480773266e-01   -2.850900265691165e-01   +3.555896839031482e-01   -4.192440946707978e-01   -1.770390907572933e-01   -3.511309471493987e-01   -8.867159384311038e-02   -4.376618049621026e-02   -7.417399701774918e-02   -1.851968988004382e-03   +3.050368735838912e-01   -2.908674691576646e-01   +2.072573253234083e-01   +4.947715484586587e-01; -6.138770996508330e-02   +4.595031865130442e-01   -4.480378585890621e-01   +1.340561883564686e-01   -2.150588572262775e-01   +1.486645966077295e-01   +3.172310143782710e-02   -1.046830773377464e-01   +3.860921893605717e-01   +1.404972595086743e-01   +7.748290584973264e-02   +2.062123683496697e-02   +3.830060221641552e-01   +2.065274208002429e-02   +6.751947161126446e-01   +3.921442564715383e-01; +1.563360609623876e-01   +1.540548778076693e-01   +5.642865110212658e-01   -1.428869219409276e-02   -1.959278562342856e-01   -1.190803593686025e-02   +3.898591089366865e-01   +6.287671194760086e-02   -3.029228084744849e-01   +1.351077636932767e-01   +1.858745206372937e-01   +4.361236841672866e-01   -5.664419799989961e-01   +1.657556287477459e-01   +2.420178407656750e-01   -2.352691193827003e-01; -1.881633923473544e-01   -2.243739006680872e-01   +4.787457629107226e-01   +1.941406609914060e-01   +8.970557727412759e-03   -7.502496284087425e-02   -1.494685459411392e-01   +1.221321522706630e-01   -2.767267732663625e-02   +3.772879083834301e-01   +1.561298498677373e-01   -3.822146821861103e-01   -1.113582729392043e-01   +3.322426967273261e-01   -3.592698277819843e-01   +2.197579566443363e-01; +6.750514039079568e-02   +5.691662828475161e-01   +1.810456824859218e-01   +2.981778527826199e-01   +3.592316793653236e-02   +3.184726751596794e-01   +4.840381058900555e-01   -2.263288855175790e-01   -4.526548145268660e-01   -3.430688510348784e-01   +1.502864485913933e-01   -9.451660261893538e-02   -3.031155977239962e-01   +6.489726789485190e-01   -3.332314875874867e-01   +3.365727390093790e-01; +1.752747505395602e-01   -1.479040077122462e-03   -1.151205261447225e-01   +4.577187054252358e-01   +2.589262007885659e-01   +6.061143015262896e-02   +1.869508544406636e-01   +3.077126799135770e-01   +3.210973402520924e-01   +3.921317485135424e-01   -1.771339237324844e-01   +1.558871791389967e-01   +3.233755739097739e-01   -3.758436876580726e-01   -8.864935117746051e-02   -9.712993844552986e-03; +2.446591079562369e-01   +3.137780766563104e-01   +2.855466256129475e-01   +3.848419275656283e-01   -5.835138107538848e-01   +4.719668110185086e-01   +1.653009825738769e-01   -3.659134534053159e-02   -2.894236453164596e-02   +5.117948765892468e-01   -1.527536986104007e-01   -4.449325501062389e-01   -1.728232349271522e-01   -2.455296793890328e-01   +5.866705837849678e-02   +3.219384510124452e-01; +2.152020777980886e-01   +2.249703524014662e-01   +4.439580692654093e-01   -1.518063420081402e-01   +2.552165462087109e-01   -7.756041675953534e-02   -1.903949123128925e-01   +1.960041231314468e-01   +1.008582167723254e-01   +2.072300563854848e-01   +2.165754518842100e-03   +5.072141527922366e-02   +1.809119324958905e-01   -3.906289507470282e-01   +3.790856785054136e-01   -1.055814110734076e-01; -2.433945539326795e-01   -8.264365078752479e-02   +2.472370633618569e-01   +1.835763869422049e-01   -1.793330803654501e-01   -2.684626571636373e-03   +4.651273801984376e-01   +1.734139950209693e-01   +9.094849426378057e-02   +5.661261796813888e-02   +1.410590371982826e-01   +1.836428952874518e-01   -4.284568130531964e-01   -2.813986270874290e-01   -3.273366484046961e-02   -4.365987702691840e-01; +3.825035065456289e-02   -3.408296729492557e-01   +1.564107721138769e-01   +4.832541077157606e-01   -7.974464528940181e-02   +2.771683826182882e-01   +5.050265633746203e-01   +8.561022917287958e-02   +3.805031482128292e-01   -2.685911151247382e-01   +7.669430402895254e-02   +1.134393822642984e-01   +5.577100326305870e-02   +1.389652367874121e-01   +4.451588642336166e-01   -2.449619922169982e-01; +2.731808954135888e-01   +2.495371224637089e-01   +1.047414473742404e-01   +3.494574389081671e-01   +2.666398221573980e-01   +1.423671414927668e-01   -6.003477838154082e-02   -3.692908255400917e-01   -4.193464977462903e-02   +1.333430187798219e-01   +5.827043005563615e-01   +4.332045547002481e-01   -2.504006359443482e-01   +3.045883023182671e-01   +4.823972038924847e-01   +1.874061968889587e-01; +8.242963291723621e-02   -1.147145450188977e-01   -6.617885163920303e-02   +8.253286858611311e-02   -2.948898585495584e-01   +2.476707077445612e-01   -1.394483553953914e-02   +3.743132950546801e-01   +2.016143367761096e-01   +8.314808884468831e-02   -2.043245750385809e-01   +7.965410849095984e-02   +5.517532457229282e-02   -4.980664264371872e-02   +1.107189081739522e-01   +3.547874926751242e-01; -2.386742789607308e-01   -3.402519354990907e-01   +3.272532143369323e-01   -2.121853247254072e-01   -2.065668461515494e-01   -7.508382427431828e-02   -3.141810264800889e-01   +6.179371110325020e-02   -1.858131742059619e-01   -4.824927626429429e-03   +3.418296160521265e-01   +2.123133200500344e-01   +5.626285171261394e-01   +4.105540208313731e-02   -5.084122440637168e-01   -2.190123390040229e-01; -9.165518804970629e-03   +6.332410685061428e-02   +2.932577861918721e-01   +3.558005441363717e-02   +2.220828999299556e-01   +1.088061795611902e-01   -1.310712349939255e-01   +9.646970778307806e-02   +4.680733675738277e-01   -3.203386499437727e-01   +9.791294948394781e-02   +2.348442679579862e-01   +4.230168427191260e-01   -1.022645515389129e-01   +1.090030026624769e-01   +5.282989114542689e-01; +1.154580535985589e-01   +2.037220115726064e-01   +2.050627166892041e-01   +3.111211478554671e-01   +3.797162103462666e-01   +8.112997875356368e-02   -7.294769071746887e-02   -4.933016924617617e-02   +7.264262649998299e-03   -3.865681332361424e-01   -1.350232790894357e-02   -7.074418453050335e-02   +3.391674414250592e-01   +4.154169254874419e-01   -2.201167967259081e-01   +1.072366935788407e-02];
L1E_L1I_iGABA_netcon = [+3.182337720548276e-01   -5.481529668025181e-01   +2.323303148852097e-01   -1.282221007828821e-01   +1.167534509345060e-01   +2.365300981739496e-02   +3.608222845291643e-01   -4.595497970479507e-01   -1.746780038079566e-01   +1.272264365952241e-01   -3.793486288621066e-01   -2.204117491619600e-02   -9.782462758916519e-02   +2.834747473294805e-01   -5.097118048597090e-01   +3.609652986321285e-01; -2.111140428403998e-01   +2.408081638550760e-01   -4.300363819027989e-02   +3.620085581624213e-01   +2.959577219478364e-01   +7.789475147869396e-02   +5.189591118082837e-01   +4.716809421552101e-02   +4.002635137917824e-01   +3.782363172234204e-01   -1.954640716061926e-01   +3.685583584481717e-01   +2.849552306273871e-02   +3.446718823405371e-01   -5.355544614590445e-02   -2.692343173202898e-01; +8.178776429697124e-02   +4.039934521307382e-01   +1.697168149515853e-01   -5.718057108321044e-02   -5.771830670667207e-02   +9.064926266251080e-02   +4.061937201532508e-01   -3.025523234077787e-01   +1.999159213386064e-01   +7.541907861226395e-02   +1.132286496668407e-01   -1.522838908448448e-02   +7.367357916430972e-02   -1.003285155159853e-02   -2.911098200840769e-01   +1.913301169101938e-02; -1.144898181117255e-01   -9.714353343579044e-02   -4.046597837863060e-01   +1.498039054608037e-01   -1.243788583297078e-01   -2.144006087303579e-01   +1.026700873813705e-02   -1.195064955867410e-01   +1.122424683447108e-01   +3.216128307759969e-01   +3.622445884564393e-01   +4.393981946621380e-01   -5.984141247479489e-02   -3.603505163227999e-01   -1.079381685009916e-01   +6.416296308327668e-02; -2.958113376377109e-01   -2.520639793934438e-01   -2.835194274294361e-02   +1.669837654529521e-02   +2.251506887531169e-01   +1.599289616193914e-01   +3.767147806645094e-01   -5.258187103337603e-02   -9.766263623822977e-02   +2.484196206636585e-01   -2.571417825826966e-02   -2.503247181131901e-01   +3.363621735891891e-01   -2.992190641009176e-01   +2.184286737038840e-02   -1.972472796418787e-01; -6.262839702505055e-02   +3.120753878428367e-02   +8.969414175151007e-02   +1.084735442960585e-01   +6.183968749447941e-01   +3.280897303245841e-01   +6.100315033492834e-02   +4.493818914397584e-01   -1.455286413554385e-01   +2.361586611528121e-01   +2.028202075807880e-01   +6.491879094999986e-02   +1.651473321404159e-02   +3.797124614167736e-02   +3.222293585606617e-01   -3.127866021463551e-01; +4.397349717330252e-01   -1.101293646684368e-01   -4.913052106580955e-02   -3.732157974969431e-01   +6.214248764183140e-01   +5.159035375100257e-01   +3.540051916891432e-01   +2.225247781974625e-01   +3.480010478650577e-01   +3.412998553409817e-01   -3.278922372088818e-01   -3.935413928126226e-02   -2.658019432068972e-01   -2.123664162183649e-01   -5.463775404240739e-02   +3.198169180400083e-01; -1.160235852710492e-01   +6.243119662356038e-01   -3.867054022716199e-01   +2.553246706083099e-01   -1.107356696212623e-01   +1.138815385139223e-01   -7.164261305460734e-02   -2.056413909780213e-01   -2.263269441687138e-01   +1.254679395892856e-01   +2.084803602593911e-01   +5.410445705123019e-01   -1.431157885093846e-01   -4.937938642802033e-01   -3.311200267943929e-02   +1.656248579771869e-01; -1.947455868338205e-01   -5.469838588238587e-02   +2.696950157135188e-01   -3.376480238801168e-01   +8.284823238896985e-02   +3.714523090856875e-01   +8.864058854014105e-01   -2.769995915092890e-02   +7.783741792097269e-02   -1.986014423450956e-01   -2.586019696095381e-01   +3.931416901174219e-01   -2.070019594422637e-01   +1.171767640917090e-01   -2.546790716226109e-01   +3.630890743867693e-01; +3.337698750676682e-01   +5.788534157613504e-02   -3.615692194886967e-01   +2.813438588109631e-01   -5.738547714199992e-02   +1.291254384346496e-01   +4.732960177124794e-01   +3.180716364795001e-01   +1.545165529186265e-01   -3.644727001904872e-01   -1.805286525660800e-01   +2.165003811653767e-01   +8.454402036145063e-02   +5.227581530720238e-01   +1.605716690354369e-02   -5.867327770924276e-02; -3.491965974795569e-01   +4.411949863377573e-01   -1.099475450661726e-01   +2.201133677150538e-02   +3.682405112559147e-01   -4.454503144919196e-01   -2.592420513483451e-01   +2.689108177732658e-01   +5.058450535604535e-01   +4.130284939360460e-01   +2.398019700868047e-01   -1.767958581150533e-01   +2.708457116602978e-01   +2.857148766648701e-02   +6.497486318800241e-01   +3.896643983478344e-01; -2.683413713949093e-01   +1.566567514501585e-01   +2.352054733419614e-01   +2.954373613218980e-01   +2.013649412900812e-01   +2.222804990970009e-01   +1.572025692775296e-01   -3.593346694569836e-01   +1.673771810200477e-01   -2.056846144174561e-01   +1.311061816198856e-01   +3.550196350480524e-01   +5.315781667895123e-01   -4.353651914645043e-01   +1.306727548448653e-01   +1.615434039073513e-01; -2.355229336262296e-01   +1.101625794877138e-01   +6.349951770098725e-01   +2.463956084481287e-01   +3.199761174904833e-01   +9.996917412889440e-02   -2.336598757441489e-01   +7.933393674131928e-02   +1.347493753031905e-01   -1.590262381599557e-01   -1.419334591086990e-01   -2.635902239013737e-01   +2.709950567358102e-02   +3.656952281345854e-01   +1.216278963845959e-01   -2.492004081701902e-01; -7.588992677679146e-02   -3.340667244267321e-01   +4.895847399654347e-01   +3.453357717693160e-01   +3.603874674567318e-01   -1.032277180096821e-01   +1.221120198023550e-01   -1.823948588593955e-01   +5.585547442652522e-03   +2.158122557816762e-01   -1.928547080541448e-01   +2.312799354676276e-01   +2.911363395209213e-01   +1.049553124607993e-01   -3.241405351284493e-01   -7.359072810221531e-02; +2.044821177458467e-02   +3.217925436157092e-01   -9.525329293383746e-02   +3.059884955030674e-01   +2.492976709276431e-01   -2.609683710121687e-01   +3.516535019589116e-01   -2.340303686050434e-01   +2.269130742454553e-01   -7.659229947024263e-02   +2.307368705787036e-01   -5.618082049094392e-03   -1.993302056667740e-01   -6.092192351836620e-02   +4.974692315734948e-01   -6.652143255090889e-02; -9.872333923079836e-02   -7.619652258612154e-02   -3.834183961663984e-01   -6.093744804182749e-02   +4.144067298288476e-01   -2.838448216532159e-01   -1.005854893936734e-01   +1.924677742875494e-01   -2.589751683821820e-02   -9.490873024022847e-02   +3.701387774091260e-01   +2.864062508470272e-01   +4.064959239525331e-02   -1.799090267317476e-01   +3.512434309652018e-02   +2.626230356360469e-01];
L2I_L1I_iGABA_netcon = [+3.585239245806878e-01   -2.369243278551514e-01   +5.406659735706586e-02   -1.349064658217111e-01   +2.886062787330672e-01   -2.276740776668200e-01   +4.426915334421198e-01   -4.231292554704379e-01; -8.734106880155532e-02   -2.060056771799381e-01   +4.934225891855604e-01   -1.266272861885638e-01   +3.622519565804938e-01   +2.511282124412069e-01   +1.865870651698085e-01   +3.050243770344753e-02; -2.545623000735634e-01   +3.495971358245266e-01   +2.564055304633895e-01   +3.007426400370189e-01   -1.278183625200916e-01   -1.152062178950642e-01   -5.393405303392377e-01   -1.012301226436928e-01; +5.042849356241464e-01   +1.324760062736469e-01   -7.478587650723797e-02   +1.474487945384532e-02   +4.140993418725254e-01   -1.689291942119094e-01   +9.748597204636172e-02   -1.405725011293013e-01; +3.084104541363687e-01   +2.649233037911506e-01   +2.666566858147118e-01   +5.131162125710836e-01   +4.091986527663739e-01   -1.979144064017847e-02   +6.491065177207382e-01   -2.071781144335955e-02; +3.828689465719236e-01   -1.636236372521709e-01   -4.095417645000533e-02   +4.859451333585437e-01   -4.003550132446745e-02   +2.020955377313521e-01   +3.727412087889158e-01   +1.731702036132467e-01; -4.014567917509462e-02   +5.823007727184240e-01   +9.409851662419311e-03   +4.166154510722529e-02   -1.375151884320015e-01   +4.573903026144685e-01   -1.604036198785909e-01   +1.179682730149428e-01; -3.055233257284227e-01   +2.466469377009377e-01   -1.708107287928323e-01   -5.997883360225142e-02   +1.857909550485650e-01   +6.941798872927130e-01   +2.979441012818660e-01   +2.184675410196153e-01; -3.487606690691469e-02   -2.554669399547963e-01   +1.063927005532580e-01   -8.575110891184036e-02   +6.314146447603845e-02   +1.797817845949721e-01   -1.247984461830442e-01   -1.012605676461835e-01; -2.904539842943454e-01   +2.272999238189567e-01   +6.017434943650566e-01   +7.161225672309457e-02   -2.463810041065566e-01   +3.903180274365187e-01   -3.735098665237473e-01   -3.230734900159318e-01; +5.910486273094857e-02   +4.201096766513147e-01   +5.739940768507572e-03   -2.100225652648096e-01   +2.826638053920065e-01   -3.331175314244510e-01   +1.696958445006856e-01   -3.596361209086086e-01; +8.315092747655572e-02   -4.399541718116110e-01   +2.316862515443541e-01   +1.178456135847491e-01   -5.229106208337990e-01   +3.732555772719695e-01   +4.815291752678990e-01   +5.921752681875751e-02; -1.609243727672247e-01   +3.473997738446349e-01   -2.887430410880533e-02   +1.243892223147173e-02   +4.931128262622264e-01   +3.047010495072886e-01   -1.551242314804789e-01   +2.479160714896985e-01; +3.625001333030574e-01   +6.041375365420570e-01   +3.410481334101967e-01   -5.586490169029686e-01   +2.568906106606498e-01   -2.466171315710336e-03   +6.637679782594637e-01   -4.969382904017595e-01; +6.800843191863407e-02   +3.662748910645977e-02   +2.883905582507439e-01   +2.222831826245739e-01   -2.035995357743308e-01   -1.234092780644968e-01   +3.391302250519764e-01   -3.792303892903203e-01; +6.393904000716674e-01   +3.907704285619175e-01   -7.124497474099645e-02   +5.456553063652014e-02   -5.943479203200978e-02   +7.326381393619725e-01   -4.310161836799489e-02   -2.776192985329519e-01];
L1I_L2I_iGABA_netcon = [-1.942278623013987e-01   -4.632396751457313e-01   -2.301142881408574e-01   +3.621190029242747e-01   +2.084895023177326e-01   -1.019062075916764e-02   -4.566582949336705e-01   +6.060818001384889e-01   -9.718306347854073e-02   +1.001147442123589e-02   +8.794151468358241e-02   -3.088368768845288e-01   -1.102814793983323e-01   +3.323666315914118e-01   +8.917795968156610e-02   +7.733585544703007e-02; +1.087426514233632e-02   -7.075151769516508e-03   -2.502658675911648e-02   +3.264477477273273e-01   +3.317006545604919e-01   -4.219569222419953e-02   +2.564035723065341e-01   +3.083120284782521e-01   +1.228256580879928e-01   +1.908835366709964e-02   +2.880068213787583e-01   -4.207502851399662e-01   -7.463072600634951e-02   -2.992419149798839e-02   +2.306570206080146e-01   -6.286742642895682e-02; -1.234102605060902e-01   +3.986566230291300e-02   +1.804864308314942e-01   -2.584872714759961e-01   +1.982080913028844e-01   +2.640249709557971e-01   +5.162026357615646e-01   +9.472455548035622e-02   -1.147733270747373e-01   +1.559581697218793e-01   -1.631380435959851e-01   -2.191545928176779e-02   -3.871288226133156e-02   -1.084012760023912e-01   -1.271210518728777e-02   -6.297427424078850e-01; -2.248759421155726e-01   +2.892541819679817e-01   +1.861379070858596e-01   +3.245588477653580e-01   +1.515966530885955e-01   +4.976258803173232e-01   +3.569098733237696e-01   +4.092824167403143e-01   -3.277058877704194e-01   +7.610341766336290e-02   +2.127691137714764e-01   -1.566540322299534e-01   +5.915411379213391e-01   +5.152863441828331e-03   +6.141905088038924e-02   +3.661885045250086e-01; -2.690345381648404e-01   -1.483310502764316e-01   +1.221455562780550e-01   +5.569381664027526e-01   +5.170884093079303e-01   +2.440574273763944e-01   -2.681307182115673e-02   +1.231751301265339e-01   +5.255321041007015e-01   +1.485921880261656e-01   -5.194707258096734e-02   +5.470894258360576e-02   -1.248899454497247e-01   -2.452303090814830e-01   +6.904368649147516e-01   +2.980001364707962e-02; +5.224880676502502e-02   -2.788602200933820e-02   +5.746948134076185e-02   +4.740460520413939e-01   -8.364590671481600e-02   +1.195954169855652e-01   +3.104459658948031e-02   +1.528296631466315e-01   -7.865403713155132e-01   -1.479995760325220e-01   +1.091168444351515e-02   +1.405468204602819e-01   +9.455510946869350e-02   -2.382313504897029e-01   +4.916857501582204e-01   +1.739360537068330e-02; +1.367671705406351e-01   +8.896467934728676e-01   +2.596016653337047e-02   -3.196792314361986e-01   +3.498069573117795e-01   +3.515454727839094e-01   +4.213864480815662e-01   +4.307162840815840e-01   +3.099406404076799e-01   +3.673492142764939e-01   +3.994891224157613e-01   +4.087843122089083e-01   -1.109838899832455e-01   -2.145281683228888e-01   +2.294891810790908e-01   +6.777719006916563e-02; +3.763812014681737e-02   +1.056272501796182e-02   +2.837095057862045e-01   -2.615731219189341e-02   +1.987362924645001e-01   -1.233219796184457e-01   -4.609096773462878e-01   +2.970955240510409e-01   -1.797611754291592e-01   +1.615899946975003e-01   +2.250041381936626e-01   +2.524999438937868e-01   -1.070960962824529e-01   -2.632280208905611e-01   +6.356832986638222e-01   -1.431521588512921e-01];
L2E_L1E_iAMPA_netcon = [+9.406899192111685e-02   +2.868320131460648e-01   -4.745573984205844e-01   +4.481693488832568e-01   -9.155014411322934e-02   +2.068002285286980e-01   +6.414708996644211e-02   +6.240429416341708e-01; -1.414660526248877e-02   -3.132333413397105e-01   +3.286871793905917e-01   -9.501088778533183e-02   -2.364128648209462e-02   +4.589118906774297e-01   -2.693876054422781e-01   +2.637204791496374e-01; -2.640197155123987e-01   +2.025270506253470e-01   -5.692535517278553e-02   +1.239639497239492e-01   +1.647022713690236e-01   +1.043801857571655e-02   -2.558794222812598e-02   -3.623640735503936e-02; -1.073683351676190e-01   +5.615025171000788e-01   +1.485447919184285e-01   -2.505833397714786e-01   -9.905973713525543e-02   -1.249764262752938e-01   +1.430261558778870e-01   -1.230558828454941e-01; +8.321414930698350e-01   +4.520126403441447e-01   +6.681488647881356e-02   +9.978324611794265e-02   +3.250967963761267e-02   +2.515228621232554e-01   +5.880288305236329e-01   +4.443410149987968e-01; +2.630793083864539e-01   -1.699589530550921e-02   +5.086437860899812e-01   -4.719005957259252e-01   +6.209623915102179e-02   +3.257485935561519e-01   +2.113882760312792e-01   -2.001337104708355e-01; +3.522391191462570e-01   +2.235478557408128e-01   +1.737203288029319e-01   +1.348243550658497e-01   +2.308394792554477e-02   -2.232373636236615e-02   +1.897214980656291e-01   +8.543873572390752e-02; -6.282847318759904e-02   +1.178268940529829e-01   +1.214011742385054e-01   -9.614244519858867e-02   +8.584956545265976e-02   -1.824423919441287e-02   +7.738603636785876e-01   +3.296194197482082e-01; -3.920055001987450e-01   -1.862892011613819e-01   +7.351390222930497e-02   -1.147775581149096e-02   -1.674696965489976e-02   +6.162262196105024e-01   +2.826966261338983e-01   -4.204682898277837e-02; +3.477920557587936e-01   -1.223789776183223e-01   +5.786442227014961e-01   +2.519663443567289e-02   -3.252057601206421e-01   +1.630836219147719e-01   +5.454814629861009e-02   +1.372303737573956e-02; -1.655098983395538e-01   -9.703498730890481e-02   +1.027841915863347e-01   +5.384587648391786e-01   +3.933156067440783e-01   +2.161014206189733e-01   +2.689315370151836e-01   -3.642987435675993e-01; +1.104723418652878e-01   +2.998126789372675e-01   -1.971145702279909e-01   +4.106200589033336e-01   +4.943393154355252e-01   -4.936823072172704e-02   +3.506392537958775e-01   +1.981472395614872e-01; +4.547724859384719e-01   -2.131204986545079e-01   -1.647709468295546e-01   -2.493846624076542e-01   +2.015678657220974e-01   -2.155978702163829e-01   -1.428965386894901e-01   -4.367792414403376e-01; +2.397308261596002e-01   -2.478861497715169e-01   -4.256355606045308e-01   +4.591795018508406e-01   -9.566544025530208e-02   +4.122593004852649e-01   +2.242243107886681e-01   +7.795935734400238e-02; +3.965757689213387e-02   -4.502627064253263e-01   +1.550545975095491e-01   -2.182417576586195e-01   +3.362909510634743e-02   -9.099138621245731e-02   -1.407356854143074e-01   +2.343800820490776e-01; +2.553550777699838e-01   -1.048395924971794e-01   +4.197527126013819e-02   -6.838345780754958e-02   +3.154049211743137e-01   +1.381021194739686e-01   -3.739731753924112e-01   +1.297388966022076e-01];
L1E_L2E_iAMPA_netcon = [+2.685182951939574e-01   +3.619628880335662e-01   +1.299092922141330e-01   -4.036892180055585e-01   +1.846931331766553e-01   +2.405216902719478e-01   +2.536893036727564e-01   -1.094859842602911e-01   +9.676984522862787e-03   +3.527773305972580e-01   +1.523133193431500e-01   +4.935755596914274e-01   +1.598704416734160e-01   +1.826305161357557e-01   -2.183247451204797e-01   +6.551066961194491e-02; +1.012355783326111e-01   +2.561529565468380e-01   +5.431670674038568e-01   -9.886591156591140e-02   -1.607831304708508e-02   -2.198685236419344e-01   -3.284161286617058e-01   -4.496731522968711e-01   -9.158021110086105e-02   +8.051684796521091e-02   +1.488489463806750e-01   -8.419396604086209e-02   +1.103867201645363e-01   +4.870039510523795e-01   -1.555618112936583e-02   +2.736569781459830e-01; +9.994783675419018e-02   +8.121307890614578e-02   +4.394692112821720e-01   +1.210043725272346e-01   -2.788655129389794e-01   +4.361335176568991e-01   +1.577294243932612e-01   -7.967403391130118e-02   +2.125000847935389e-01   +3.574861679221766e-01   +1.725179717370544e-01   -1.968923256781474e-02   -3.685089170816169e-02   +1.878611960235255e-02   +2.388050640438039e-03   +1.886081986507358e-01; +1.157426006403259e-02   +1.507077125081638e-02   -1.709319830384981e-01   +2.570811940420577e-01   +1.477393578589919e-01   +1.627874008619641e-03   +3.996579449561981e-01   +3.474097902000700e-01   -2.318830597547899e-01   -2.605620742893047e-01   -1.771790474692431e-02   -8.078755958030305e-02   -1.627931567016937e-01   -4.246956261379886e-01   +4.519341079194698e-01   +1.065443561673676e-01; -1.843550922300688e-01   +3.005419616801898e-01   +1.955170995929911e-01   +5.235993184008934e-01   +5.215227543145541e-01   +3.108608170322489e-01   +5.088423019374837e-02   -1.190949788050657e-01   -1.410348443511248e-01   -4.602888815770792e-01   -1.981175506854034e-01   +3.286543667280201e-02   +3.192119689441296e-01   -3.181735837474287e-01   -4.683545473826558e-01   -1.450845071952018e-01; +2.966408400458029e-01   +6.901597897250189e-02   +4.560416488395403e-01   +4.981001109596531e-01   -4.381531048955447e-01   -6.630449084559156e-02   +1.536216653348470e-02   +2.529365172888476e-01   -2.337506707579878e-01   +1.275191523245319e-01   +1.715471313803534e-01   -3.553104460603851e-02   +4.694880354088281e-01   -6.358358847592108e-02   +4.067081300820385e-01   -2.267761950498695e-01; +3.398393199142010e-01   +1.633701368917953e-01   +5.149359434321956e-01   +5.431893154774039e-01   +2.522968561695832e-01   -3.670080735893883e-01   -1.114831881414450e-01   +2.137435247583637e-01   -3.149493598570128e-01   -3.732977813962854e-01   -2.454311717156510e-01   -2.615747125600131e-02   -9.842397965229256e-02   +2.028620785864702e-02   +1.327788377158699e-01   +3.403934253430175e-01; -1.095753016376844e-01   -2.933495794253849e-01   +2.055131702556110e-01   +1.384978474065938e-01   +1.381282865955724e-01   +3.900645333674139e-01   -3.087948416093339e-01   +5.426437534345359e-02   +3.442167626592002e-01   +3.193383923960935e-02   +1.315417408166228e-01   +1.439419912866492e-01   +4.613311516040889e-01   +3.408661828176044e-01   +3.614142748420105e-01   -2.728379157082332e-01];
L2I_L2E_iAMPA_netcon = [-2.738370238387484e-02   -2.213842102431302e-01   +2.520746168761910e-01   +1.098719891782394e-01   +3.267239510585450e-01   +1.389972076836858e-01   -1.631082549696988e-01   +2.604766270254865e-01; +1.707635079759337e-01   +2.999399494464603e-01   +1.078087131316472e-01   +1.149813108102885e-01   -2.212069796961566e-01   -3.831366669541553e-01   +3.405295086351481e-01   -1.040425819873861e-01; +2.733952983138838e-01   -3.639248542609357e-02   +3.557819734109454e-01   +1.077738119982979e-01   -2.237670600220693e-02   +6.467758803212672e-01   -4.185432842179058e-01   +6.054453693096727e-01; +1.456912300701788e-01   -1.815395669155526e-01   -2.539375053841408e-01   +2.194035702947261e-01   +2.042387259858874e-01   -3.292209255053894e-01   -4.941016445463993e-01   +1.540116561053117e-01; -1.919031280299969e-01   +4.676587210548618e-01   +2.414847718921980e-01   +1.944006775767270e-01   +5.129740751067443e-01   +3.001221963971509e-01   -3.387595981226275e-01   +1.204746364471471e-01; -1.740416633937190e-01   -1.851567189070256e-01   +8.062044466927465e-02   +4.511829840138611e-01   -2.561919362532630e-01   +1.099925824522562e-01   +1.064284974498758e-03   +2.358279112332198e-01; -1.545388523433960e-02   +1.607959718650638e-01   +3.198564190914490e-01   +1.677392167086793e-01   +2.224220739110195e-01   +3.501118676921255e-01   +7.589804366984214e-02   -2.031093265449507e-01; +2.157499694174120e-01   +1.916913394819303e-01   -1.981384508433487e-01   +3.190595106254328e-01   +1.068705407283337e-01   -1.808743062269317e-01   +1.869349139517609e-01   +1.213867564317916e-01];
L2E_L2I_iGABA_netcon = [-1.820373511920049e-01   -2.384589194985021e-02   -5.659783040868262e-02   +5.645103691559005e-01   +1.783429041802898e-01   +1.870381279857741e-01   +2.938604201343408e-01   -2.931720376816760e-01; -4.372567569605321e-01   +3.287183611444705e-01   -2.158748011406240e-01   +1.097327241221744e-01   +7.223901030056060e-01   +3.548317653195132e-01   +1.940964632345807e-01   -6.079308987558794e-01; -3.034664694887071e-03   -5.639248790892228e-01   +2.868362939755911e-01   -4.414234974121162e-03   -2.323750383382697e-01   +3.172596773360134e-02   +2.614013910656070e-01   +2.120471731216808e-01; +1.226651261941261e-01   +1.397177856788567e-01   +1.597695864672025e-01   +2.550617482264800e-01   +1.404374201993016e-01   +7.933828008836497e-02   -1.056238322354700e-01   -3.768240115436544e-02; -2.019625544016274e-01   +2.534033548230050e-01   +3.320210958101477e-01   -2.973743950005605e-01   +4.172935132036511e-01   +1.350453144322908e-01   +4.335077774165648e-01   -2.264704113490988e-02; +3.058457036140396e-01   +5.744448697998708e-02   +1.347477778130697e-01   +4.290502576538893e-01   +3.426395494019554e-01   +2.723126071030352e-01   +2.870245315803261e-01   -2.280308805953260e-01; +6.580320157417649e-02   -3.388677482583651e-01   -1.873016321473817e-01   -4.254692039671552e-01   +7.821864884997841e-01   +1.286577469143182e-01   -1.226693712390208e-01   -1.349595252809940e-01; +3.155621519397863e-01   -1.597444028701180e-01   -2.353478026944341e-01   -9.729647930935653e-02   +3.693923641447411e-01   +1.870366870932082e-03   +8.133978208072029e-02   +1.908356048633800e-02];
L3E_L2E_iAMPA_netcon = [+2.971974390780315e-01   +4.886752940731602e-01   +3.047396404697142e-01   +1.971372486056519e-01   -5.276818894567819e-02   +2.077620866840665e-01   +1.620277814211026e-01   +3.154116368359711e-02   +4.270841380120123e-01   -3.629588142540364e-01   -2.823938864509309e-01   +1.150275937696122e-01; +1.488755654963259e-02   +2.502903045477577e-01   -1.146753179914307e-01   +4.689863764239317e-02   -2.645591712269818e-02   -8.059473274258858e-02   +1.815522814224997e-01   -1.529865306326113e-01   +2.842443213484975e-01   +4.514301715249645e-01   -1.777389944641779e-01   +1.770990248129469e-01; +2.166147330590485e-01   -1.988677129441800e-01   +2.540056875779906e-01   -5.010817807372063e-02   +4.380842627372107e-01   +1.927553442168903e-01   +1.779385100142578e-01   -1.232795306025199e-01   +1.045311645326367e-01   +8.983591870099870e-02   +1.277845751555754e-01   +8.980352488965677e-02; +5.649606662018772e-02   +1.319719123726190e-01   +1.215609397930237e-01   +2.458139094973960e-01   +2.540793417293747e-01   +6.392927301693491e-01   -1.435980387242367e-01   +2.759222456388907e-01   +3.709585647670006e-01   +1.121110528251361e-01   -6.726198326907001e-02   +9.017433679529355e-02; -2.170469680932240e-01   -2.084421542695108e-01   +2.851530589718947e-01   -4.652649262800628e-01   +3.848421350803398e-03   -4.564009343750313e-01   +2.329922331860192e-01   +3.383014691795467e-01   +2.519594529806032e-01   -3.160801059383053e-02   +9.347215602260753e-02   +1.428501318580886e-01; +1.175240436332209e-01   -7.580086173404069e-03   +1.130475003525135e-01   +4.843591179148806e-01   +2.449621702135668e-01   +4.762119274442900e-02   -2.579837356643327e-03   -3.884877596770908e-02   +2.272912093460928e-02   +1.536424931729738e-01   +1.028606279840747e-01   +3.045323022004412e-02; +4.086436022136649e-01   +7.914922573987736e-01   +6.022399022741370e-02   +3.412410827306916e-01   +3.678413161638935e-01   +3.215838031848942e-01   +2.991295088536425e-01   -1.927616421080122e-01   +3.825908001133206e-01   +2.155811081820601e-01   -1.341207156225249e-02   +2.754745405742155e-01; -5.780254870487409e-01   -7.091725334551649e-02   -1.158331362470194e-01   +1.600333825362660e-01   -1.555685127236717e-01   -3.141953435716589e-02   +3.959475972986628e-01   +4.216353196877922e-01   +1.910673294742598e-01   -2.292567426594945e-01   +1.579873057535550e-01   -9.073814066608094e-02];
L3I_L2I_iGABA_netcon = [+1.516882278018810e-01   +4.842510987054121e-01   +8.538080352905485e-02   +2.487236820828561e-01   +2.359680372156202e-01   +8.127936886614395e-04   +3.391415866217531e-01   -2.429080419567594e-01   -7.325744437041881e-02   -3.364313802874233e-01   +3.184152958463397e-01   +4.061236082624681e-01; -3.692068576536165e-01   +2.746490153747284e-01   +1.347321464305996e-01   +2.665363433236096e-01   +1.147275101078849e-01   -2.799196095046020e-01   +2.088025389696010e-01   -3.841193395155699e-01   +1.887507972945639e-01   +3.316193408044988e-01   +4.671522133267144e-01   +2.305707093629022e-01; +2.024141690114788e-01   -3.056925382775161e-02   +1.037568138473011e-01   +4.390161266884886e-02   -3.337909767113967e-01   -3.344911847540550e-01   +1.196807792839468e-01   +1.493593976543673e-01   +2.856313053153651e-01   -3.465019434204065e-01   -3.700550589238754e-01   +6.729467990162055e-02; +1.273895850299392e-01   +2.540390765000836e-02   -1.286910478116502e-01   +3.322412338061819e-01   -2.592550982662514e-01   +2.455546828265289e-01   +2.464113922100880e-01   +2.492727436519246e-01   +1.985078461979066e-01   +3.522434777921744e-01   -2.587343198020488e-01   +3.415945988291845e-01; -1.052103186150913e-01   +5.419084935865760e-01   -2.773521076979666e-01   +3.125040588780886e-01   +1.759093945229595e-02   +3.154358672438990e-01   -2.479184328942194e-01   +9.079290164049944e-02   -4.813352993907727e-03   +4.570139212152986e-01   +6.189725416155935e-01   +1.361904507484945e-01; +1.686555128458232e-01   +2.933105839081855e-01   +3.865005205307372e-01   -2.138298715045157e-01   -2.201510588440309e-01   -3.479547785563724e-01   -1.349584416408828e-01   -1.927982599371103e-01   +5.118066575391647e-01   -1.984587588680446e-01   +5.187581271172351e-02   +1.657504369339802e-01; +1.696395985148605e-01   -2.196755129254425e-01   +6.086942092512736e-02   -1.779111886283519e-01   +4.095623464302177e-01   -2.606817708943622e-01   -2.500344159629808e-02   +1.218505900496208e-01   -3.032404794656305e-01   -1.514745175837627e-01   +4.100697444076543e-01   +3.388626453459850e-01; +4.234919888014510e-01   +3.462953601770004e-01   +1.779893772476854e-02   -2.442999899680766e-01   +3.629049984978237e-01   +8.364379869557884e-02   -3.743385779085363e-01   +4.390072751341186e-01   -2.676139825384557e-01   -3.937944050604520e-01   +3.017112793546770e-01   +1.786158980412797e-01];
L2E_L3E_iAMPA_netcon = [+2.049883470864946e-01   -2.702094969792532e-01   +2.874857275603297e-01   -3.174195785868439e-01   -2.297346222995147e-01   -4.220728356057197e-01   +2.243962763878258e-01   +4.532295832399099e-01; -3.927096222978561e-01   +3.358485798618038e-01   -1.519072954475562e-02   +2.091959137441880e-01   -2.407834181393285e-01   +1.114555845347648e-01   -3.846328759388414e-01   +1.735059357616192e-01; -1.132272297896096e-01   +4.338872051459595e-01   -2.098163906198677e-01   -1.734169324771578e-03   -1.127065438795980e-01   -2.666049876568500e-01   +4.375839723742924e-01   -1.279704477539519e-02; -8.966155732753704e-02   +3.406490945531504e-01   +3.814492067551734e-01   +2.790490187090258e-01   -2.510955871052749e-01   +1.159992112283550e-01   +1.835874465836532e-01   -1.278166847630815e-01; -4.884869912361350e-02   +4.824866083091833e-02   -8.294413549067928e-02   +5.213509928140069e-01   +3.042347634679520e-01   +1.503728145398958e-01   +4.847854747976139e-02   +1.480562196093584e-01; +4.966940281545637e-01   +2.776346768115929e-02   +4.859478589147429e-01   -9.048494620693456e-02   +1.954570736170541e-02   +1.249241714386584e-01   +9.106187971876489e-02   +3.430652274418797e-01; -1.683854282515183e-01   -3.024528412090075e-01   +2.367676537292444e-01   +2.531275311752748e-03   +2.794651541513298e-01   +1.205126381154180e-01   +1.591753759213307e-01   -1.184913479909404e-01; +2.899475564544399e-02   +9.045513519998048e-02   +3.203641035589041e-01   +3.283934598810093e-01   +4.561277477454069e-01   +2.333075921210321e-01   -1.452014989518441e-03   -1.949634923737234e-01; +6.766490743202140e-02   -3.084876677260595e-03   -5.390922515165528e-03   -3.352496668706457e-02   -2.353773969838463e-02   +3.502617779051349e-01   -1.533422152106163e-01   +9.227726675604564e-03; +2.849709324449419e-01   +3.657881979952331e-01   -4.973775990624463e-01   +4.318246299767186e-01   -3.886396786138905e-01   +6.742187218755882e-02   -6.445412452975274e-02   +1.797991395244951e-01; +5.185074517125597e-01   +1.273084179814332e-01   +5.988648185709064e-02   +5.552348390312629e-01   +1.701982215339814e-01   +1.892263153997105e-01   -8.869847853479221e-02   +6.750554531199060e-02; -2.255945163957008e-01   -9.837565562524656e-02   +3.433349241890261e-01   -7.593397993188478e-03   +1.185082025858138e-01   +4.439742394114053e-01   -2.782359391548645e-01   -4.305593713959168e-01];
L2I_L3I_iGABA_netcon = [+3.431006625683880e-04   +1.339962337783793e-02   -1.420459392305442e-01   +1.581291389103435e-01   -1.363307184965796e-01   -1.954661854938304e-01   -2.540372374399771e-01   +1.080608610040944e-02; -2.360391319402758e-02   +3.059104642220671e-01   +1.861222804900027e-01   +5.433539697488071e-02   -1.354401015629797e-01   +5.982710980008632e-01   +4.774174615626678e-01   +2.593293070816489e-01; +2.936386552604309e-01   +3.042292965773858e-01   -5.576770000701586e-02   +2.407029370478200e-01   -7.265527910197947e-02   +4.426367634036812e-01   -9.846448688533524e-02   +6.406122067365851e-02; +1.992940981325567e-02   +3.518520428676506e-01   +2.634921290738133e-01   +7.970115308659194e-02   +3.121213515557933e-01   +1.803815081909919e-02   -4.170620515805277e-01   -1.032474009861713e-01; -4.892724039605995e-02   +2.004487052701991e-01   +3.837192646980087e-01   +2.695524557798304e-01   +7.298058320434533e-02   +5.148376632793833e-02   -3.383499246284815e-01   -3.313619843467177e-01; +2.734867732602702e-01   +9.533218919821565e-02   +7.175754601458881e-02   +1.138458036812016e-01   +4.419552245247602e-01   +1.638296375809409e-01   +4.076680866036225e-02   +4.711532825321474e-03; +7.933497612369084e-02   +4.562763175177381e-01   +8.734083992004590e-02   -3.837767832495481e-01   +3.376531905310710e-01   -1.259556264828777e-01   -2.192057902411129e-01   +2.885047418063277e-01; +2.447817339237519e-01   -1.388356831557093e-01   -4.427212722803859e-01   -5.729829086138855e-02   -5.199871663257121e-03   +1.342623244951026e-01   -8.575328790376702e-03   -3.205491166238521e-01; +3.641947177490112e-03   -1.524443453449142e-01   +1.970990342434818e-01   +6.355668204637139e-01   +2.819136553387088e-02   +4.453797321114572e-01   +1.127440166608322e-01   +1.208649755230276e-01; +4.627216281065161e-03   +6.428643916929269e-01   -1.897351628409543e-01   +3.946074146809184e-01   -3.179400466597168e-01   +4.192240844269686e-01   +2.556011711486621e-01   -3.551280877528176e-02; -1.904439769829246e-01   -3.960621537022218e-01   -4.077183331204635e-02   +7.655876016224020e-02   -1.208920117212400e-01   +1.127502444124232e-01   +5.084809214494026e-01   -3.226291330067482e-01; -3.248346334090548e-01   +6.017933451465654e-02   +3.006720975372255e-02   +2.027043051105211e-01   +3.081667500521595e-01   +6.314467941017319e-01   +4.003837410437734e-01   -1.071782747657419e-01];
L3I_L3E_iAMPA_netcon = [-8.521372287789861e-02   +1.086590419615968e-01   +2.596045030578534e-01   -2.331899660098508e-01   +5.973719221512283e-01   -2.789834755708372e-01   +1.655812875009262e-01   -2.045002146417145e-01   +1.168982112051787e-01   +2.454367651107716e-01   +9.719738991409746e-02   -8.757589551226176e-02; +4.565682130879355e-01   +1.625866446239619e-01   +2.690333687988651e-01   +4.970567517756398e-01   +3.179264388186461e-01   -3.513056868146722e-01   -3.394261602162157e-01   +5.353133575953106e-01   +4.945934142783364e-01   +2.596134700091137e-01   +2.892804669923585e-01   +2.195355609555489e-01; +1.168639870382118e-01   +5.386860167628407e-01   -4.788391234623127e-01   +8.090515653589289e-02   -1.790379369583745e-01   +1.342509695456541e-01   -6.849935371792262e-02   -3.000807162292968e-01   +2.641038896081992e-01   -1.927576997226244e-01   +6.968928738736477e-02   +2.419417775899163e-01; +3.191941530803025e-01   +3.430725845241452e-01   +4.666614898236776e-01   -8.208421442465308e-03   +1.148955741838560e-01   +4.091639131035473e-01   +2.534787935871791e-01   -9.284350315721424e-02   +1.986520349200538e-01   -2.007903582498499e-01   +4.086236144652388e-01   +7.327334552855033e-02; +1.890707251606619e-01   +1.387482116952919e-01   +5.118154691134246e-01   -3.548441456898055e-01   -2.062609859998171e-02   +1.710306150376776e-01   +7.051709873003420e-01   -2.278400205811338e-01   +3.622805227560095e-01   +1.922598904896825e-01   +1.558895062073813e-01   +6.777202279511951e-02; -2.701076069702298e-01   +1.413999443619540e-01   -3.349684302249782e-01   -2.313113230393860e-01   -1.067621970854113e-01   -2.435285263478790e-01   -1.709257462767680e-01   +3.258661376220863e-01   +2.589457430302289e-01   +1.112315816214583e-01   +3.654044515450041e-01   +3.598124742337881e-02; +3.767415861396910e-01   -1.239599458668103e-01   +3.616221173267669e-01   +6.460359442663274e-01   -2.374838309726278e-01   -2.806313084579869e-01   -1.516147870291540e-01   +1.713848434692358e-01   +7.157895211596893e-01   +2.543381344757222e-01   -1.434166177829674e-01   -4.002819263359124e-01; +1.788608268567132e-01   -3.204144356318971e-01   +2.863860085343075e-01   -1.915668977444688e-01   +3.967819063051981e-02   +2.016189224166856e-02   -3.903598388775538e-01   +2.757199254005940e-01   -1.253498918113196e-01   -9.186677736843368e-02   -2.117038339650377e-01   +5.429054941880093e-01; -8.573693120018407e-02   +2.744793646411744e-01   +2.261955108552061e-01   +2.910239185009057e-01   -2.976530928496770e-01   +3.552444077901599e-01   -8.217459732662138e-02   +1.852659496057296e-01   +1.076083305127768e-01   +7.845449471877286e-01   +4.502054267029962e-01   +8.907109634572423e-02; +1.750538137590227e-01   -5.461945295249335e-03   +6.356331003483773e-02   +1.601404575488473e-01   +5.185619108217521e-02   +9.208157027376207e-02   +2.569438376111563e-01   -3.124773149635819e-01   +4.426066240314780e-01   +6.091968086898729e-02   -2.034465510851433e-01   +3.649957692647504e-01; +3.117383689460421e-01   +7.150146828755759e-01   -4.235751304677092e-01   -6.159559948037664e-02   +2.262273542226126e-01   -5.609355855938083e-01   -2.873975158471612e-02   +9.530568378667817e-02   +9.344531899197067e-02   +4.305425393900031e-01   +4.923602229728302e-02   -3.513024535698865e-01; +3.215197469102438e-01   +2.480220386285243e-01   -2.463956649532534e-01   +3.167352300805311e-01   +1.616585773833862e-03   +9.160046363114940e-02   +3.011975079892835e-01   -6.380052584541779e-02   -2.255722865756976e-01   -7.558725132035825e-02   +1.065621403586739e-01   +9.898017159088318e-02];
L3E_L3I_iGABA_netcon = [+3.339794504263783e-01   +4.369607563187248e-01   -4.041579741891618e-03   -1.679730478921470e-01   +1.895633109502209e-02   -3.045624233147285e-01   -4.574298494043860e-02   +3.762718173615469e-01   -1.418902721686121e-01   +4.275814127259135e-01   -7.138696935961528e-01   +3.577750951647539e-01; +1.381319291744465e-01   +5.587618275246534e-02   +2.732976361865845e-01   +1.794207907890160e-01   -5.649754652946830e-01   -1.941402598605132e-01   -3.277184227844234e-01   -1.133591909494971e-01   +1.354805890622503e-01   +8.823856040530881e-02   -1.708528493994679e-02   +1.362900768634223e-02; +2.072936467581334e-01   +1.507664908200892e-01   -8.539270717010601e-02   +4.369663538608010e-01   -9.687527640957685e-02   +1.693504094796320e-01   +2.824917297730487e-01   -3.586334555104758e-01   +2.210217095166395e-02   +2.172738432520081e-02   -1.510166082799437e-01   +4.188321110875611e-01; +8.062533646269052e-02   +3.133391689789210e-01   +2.849067248634508e-02   +2.200665222059410e-01   -2.605433338953706e-01   +2.710170630604894e-01   -4.265236144872220e-01   -1.320363027075745e-01   +2.348582194111364e-01   -3.548536844678285e-02   +2.887011800995425e-01   +3.785515481009305e-02; +2.023216865621578e-01   +4.692944132043050e-02   +5.727716795232253e-01   -2.981480659717016e-01   -1.406373838506431e-01   -1.570049235726701e-01   +3.752060831891897e-01   +1.890913022413503e-01   -2.078891778178152e-01   +4.976529006288172e-03   +2.672676161033324e-01   -1.656740151842980e-01; -2.704051466006659e-02   +5.683013026486922e-01   +7.829017291839373e-02   +3.233733973171848e-01   +1.495027523679673e-01   -2.337954304935679e-01   -3.084988358513676e-01   -1.224375195638616e-01   +2.389906978979046e-01   +2.357186644546211e-01   +4.712667481679617e-02   +2.848983703751273e-01; +2.662336279744874e-01   +1.932167896716522e-01   +2.597017359944310e-01   -3.282499760478124e-01   +2.777137501353015e-01   +5.097160353311020e-02   +6.157279226002030e-02   +2.026420321581021e-01   +2.130663224288410e-01   +2.353860344125659e-01   -2.384340516565834e-01   -3.936348886779920e-01; -5.229755327692085e-02   -1.515170534387140e-01   +6.675610023435591e-01   -5.052705770367467e-01   +2.709598215617857e-01   +1.222962926478440e-01   +8.128410791679017e-02   +1.691085059516485e-02   +8.646176482385312e-02   +1.442380156015447e-01   -4.715552170314344e-01   +1.787406098923471e-01; +1.874158174934099e-01   +2.317828269086903e-01   -3.967424568756633e-02   +1.877003917981194e-01   +9.707004933598273e-03   -3.441806997029737e-01   -2.204941058710798e-01   +3.152575046070455e-02   +3.991584361880688e-01   -3.153316145002624e-03   -3.411985151988949e-02   +8.406081574931151e-02; +3.983097014671861e-01   -3.144782978297191e-01   +2.683674163430960e-01   +1.545158105568440e-01   +2.216714959915640e-01   +6.987769160097292e-02   +1.012678884931054e-01   +2.594661609072148e-01   -4.514581439967493e-01   -9.005797952568645e-02   +1.069876013346444e-01   -7.622111149183375e-04; +1.916877051477875e-01   +2.021458954020639e-01   +3.395918798594166e-01   +3.109251490884644e-01   -5.222856038722581e-02   +1.394757766728753e-01   +2.715203044128204e-01   +1.946878770810226e-01   +1.044287770300311e-01   +5.795584554770748e-02   +2.373779812104329e-01   -1.942411922429307e-01; +4.137020788380395e-01   -1.791628345470919e-01   -4.826358113700248e-01   +3.168861853743666e-01   +6.024365767222150e-01   -1.161158242562379e-01   +1.486773014999883e-01   -6.887112404885268e-02   -1.164136905973688e-01   +2.037017687403400e-01   -5.399324607424404e-01   -1.043678246077386e-01];
L2E_Input1_iAMPA_netcon = [+7.284226701660129e-02   -1.060288795827716e-01   +1.204613056853148e-01   +2.362234662884180e-02   -1.480060712240744e-01   +1.748620631801481e-01   -1.374883013304257e-01   +1.684777903264065e-01];
L2I_Input2_iAMPA_netcon = [+2.947880470402857e-01   -2.075278723145916e-01   +1.622882417127255e-01   +1.935875348734306e-01   -2.297369639127578e-01   +4.288858542836302e-02   +5.510162973731119e-01   +3.753063593237633e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last =  33.63 * ones(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = -60*((exp(-10*((t)-( 50))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 60*((exp(-10*((t)-( 50))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
