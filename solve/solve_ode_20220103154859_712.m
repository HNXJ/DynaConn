function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+4.461913588022318e-01   +2.838778430802425e-01   +5.636744359947518e-01   -1.686098649653809e-01   +3.992529081871732e-01   +6.960640426037188e-01   +6.407328884388247e-01   +5.596020784328085e-03   -1.173836177114708e-01   +6.049275907859689e-02   +4.888644461843780e-01   +2.637638484358899e-01   +5.758091727551313e-01   +4.228325688637328e-01   +5.441032914427706e-01   +3.044809311202875e-01; +4.362927051856761e-01   +2.907409904452060e-01   +1.758958763460133e-01   +6.380442982714383e-01   +4.444049097755919e-01   +1.385805813667747e-01   +2.760243082317305e-01   +3.543565389233759e-01   -2.767235204434663e-01   +3.450315280395636e-01   +5.058968795069265e-01   +5.448984789153155e-01   +6.407308527829320e-01   +4.560135385909109e-01   +7.357420058159541e-01   +4.184061908658985e-01; +2.036670511249467e-01   +1.241746142319424e-01   +4.991401267889963e-01   +6.167569786004642e-01   +5.419524925818405e-01   +2.082719004048957e-01   +2.414064076647106e-01   +2.973607507440617e-01   +1.284988278940409e-01   +3.272854977666258e-02   +3.065636826913566e-01   +8.537439273326969e-01   -1.285573881067708e-01   +2.449314410180894e-01   +4.100081831966494e-01   +4.185566368404023e-01; +1.197180333909720e-01   +4.692313705251727e-01   +7.111907019471780e-01   +6.928491201322576e-01   +7.021264968309705e-02   +6.501872863364100e-01   +9.009910649852264e-01   +3.453644263127538e-01   +7.296149882475789e-01   +6.252030473659466e-01   -1.031673613097464e-01   +3.628031574550244e-01   +5.253590171681131e-01   +4.160917360869257e-01   -7.252495363876124e-02   +1.190624344429990e-01; -1.019175519165453e-01   +2.258692808421074e-01   +5.331696427441784e-02   +4.739955829185997e-01   +9.581901264893168e-02   +2.359762008470149e-01   +4.618816377634568e-01   +4.464596908829916e-01   +7.209827159333059e-01   +3.969385966296043e-02   +6.820913514662039e-01   +4.356304005060180e-01   -1.046081287113605e-01   +6.913618631039731e-01   +3.161890793270710e-01   +2.753617232777825e-02; +6.275550325181616e-01   +7.645418437594546e-01   +4.600342406400913e-01   +3.770147361619057e-01   +2.757833013270880e-02   +6.772498949951675e-01   +3.416628815332378e-01   +3.692904129234526e-01   +4.055263720201253e-02   +8.305802976970658e-01   +2.530623811544458e-01   +3.041215025722225e-01   +6.891327179127702e-01   +6.657588928818006e-01   +6.741401871841658e-01   +1.096176600723313e-01; +7.167259323747589e-01   +4.315804815158803e-01   +4.897390679841312e-01   +4.012278632659996e-01   +3.643878463994611e-01   +2.147464435536250e-01   +3.116196005588758e-01   +1.344371851932884e-01   +3.441018343211649e-01   -1.641598194725441e-01   +2.793920047255627e-01   +5.881641172204291e-01   +3.609065561803043e-01   +3.357471934319792e-01   +4.606683579771779e-01   +2.220738071690554e-01; +4.862173501519181e-01   +1.793336119098215e-01   -1.919109648528388e-01   +1.686913056248228e-01   +5.893174146542339e-01   +1.433256790251824e-01   +2.610523379147100e-01   +3.957667928279281e-01   +1.510664263602828e-01   +2.923238298786024e-01   +2.566031959386553e-01   +4.010696810261974e-01   -7.670512069345706e-02   +5.939128520449146e-01   +9.008649195865465e-02   -1.289536079334166e-02; +4.988741687984087e-01   +2.383406698397902e-01   +4.996901806702598e-01   +3.159034180337699e-01   +6.062880555366893e-01   +4.087415245245567e-01   -8.910821053566513e-02   -6.876528749521731e-02   +1.923382953944214e-01   +2.976136651567558e-01   +5.054483012675539e-01   +5.076371323489035e-01   +2.922395921153977e-01   +5.391399625064913e-01   +2.065052216956170e-01   +2.198147193419967e-01; -1.788841044899749e-01   +5.788562297362982e-01   +4.218491005171196e-01   +8.036640310631010e-02   +4.716022030453342e-01   +5.896213477164011e-01   +4.146473035599314e-01   +1.767658213867495e-01   +3.453066481891192e-01   -9.001001807911219e-02   +3.222203986688728e-01   +6.249040291284407e-01   +2.892546499162819e-01   +5.218661940330437e-02   +4.891931153704104e-01   +1.319388137255992e-01; +2.182080762141989e-01   -3.133918001781982e-01   +4.672240045884220e-01   +5.355460240045750e-01   +2.990058310239823e-01   +4.229803818997449e-01   +6.453398365080673e-01   +1.585786878959803e-01   +8.794559260440639e-01   +2.795320874247166e-02   +3.625048490691571e-01   +3.521203878121993e-01   +8.177036240027138e-02   -9.218399349199954e-02   +7.674407917846245e-01   +4.164665527395225e-02; +4.400702911256295e-02   +8.055042629212424e-03   +1.761671209549649e-01   +3.445811638675568e-01   +1.929267948350233e-01   +5.906825810289760e-01   +3.212545039600804e-01   +5.260152703532637e-01   +4.987519389621894e-01   +4.024130991226300e-01   +2.472034819493288e-01   +5.511190488017933e-01   +3.459267176219167e-01   +9.914359609300365e-02   +4.973067258088862e-01   +5.597107179823694e-01; -6.588971747846370e-02   +7.291241542842104e-02   +3.207522256742474e-01   +3.743725833654702e-01   +4.712667068880062e-02   +5.934952812393358e-01   +4.866274383871410e-01   +3.893210504986144e-01   +8.678709399103309e-01   +6.172123641851348e-01   +2.915618349956400e-01   +6.754258214050378e-01   +5.172830687531502e-01   +5.971012927538503e-01   +1.000000000000000e+00   +5.269760646074586e-01; -6.589704999083287e-02   +6.183906328143165e-01   +7.075722420973979e-01   +6.151672426176624e-02   -5.478235849224771e-02   +4.811508638414175e-01   +6.485749579666285e-01   +2.248464792577668e-01   +3.834821444010214e-01   +4.665290453717567e-01   +3.084260544735083e-01   +3.162675568240887e-01   +5.964847439828365e-01   +3.723108936635080e-01   +1.642437906938293e-02   +2.954796283794310e-01; -3.247793311937395e-02   +2.434354616564893e-01   +5.791911625468052e-01   +2.168455173559632e-01   +1.557436506733964e-01   +2.417098164138260e-01   +7.205114415735495e-01   +6.070009901621534e-01   +1.200407523837709e-01   +3.280032656648562e-01   +3.908666612282070e-02   -4.836851649939840e-02   +1.637871143546284e-01   +1.205461663807437e-01   +5.470403064445335e-01   +8.253973861562777e-02; +3.352198693682450e-01   +3.286509738308393e-01   +5.656347659841396e-01   +5.747457904732947e-01   +4.036837100965164e-01   +3.497728801691275e-01   +2.283027251845116e-01   +6.346003029898820e-01   +2.919066171797300e-01   +3.624501974619531e-01   -2.009061310473453e-01   +3.659721652082052e-01   +2.857698984986774e-01   +4.939313494334649e-01   +5.692531618523646e-01   +6.904854819949925e-01];
L1E_L1I_iGABA_netcon = [+5.201259174318417e-01   +8.459499870739515e-02   +2.985628747786401e-01   +4.777750977064774e-01   +5.555455916349201e-01   +1.330844448918756e-01   +3.644792201943745e-02   +3.982786341501567e-01   +6.950164382777838e-01   +1.234183641924358e-01   +7.661485506114908e-01   +5.338178472133441e-01   +1.288747568537494e-01   +5.838069257954074e-01   +4.168812617476630e-01   +2.434356258710193e-01; +4.067093763111865e-01   +1.924858018941140e-01   +5.378958585267161e-01   +4.859592347064338e-01   +2.645782259546244e-01   +1.266142589063813e-01   +3.790795466749161e-01   +1.594051786904595e-01   +3.692009038640895e-01   +3.027930557220703e-01   -1.769886024662684e-01   +3.344050681845580e-01   +1.007137250917259e-01   -7.362265866290085e-02   +4.787926066116543e-01   +1.764688418639991e-01; +3.551057511172557e-01   +2.282922480409974e-02   +2.323943305100376e-01   +5.429891168254284e-01   +2.471478743423786e-01   +2.527029354112803e-01   +2.129626294303062e-01   +4.161172897562863e-01   +2.703227814541388e-01   +1.101959624363629e-01   +2.857459736912417e-01   +2.659862489516409e-01   +7.923473469461257e-01   +4.680870822450845e-01   -5.611658893955526e-02   +5.059701855389542e-01; -7.530467210358918e-02   +6.891026465824177e-01   +5.117897639648148e-01   +4.495109627181076e-02   +4.093123383127357e-01   +5.323109777251678e-01   +2.377095135748682e-01   +1.858378567816695e-01   +1.731398759794178e-01   -5.184537433459681e-02   +9.086209589141299e-02   +3.678021592371758e-01   -1.616987002427070e-01   +5.100656367668990e-01   +2.674926873864108e-01   +3.714187879404168e-01; +6.291675914079156e-02   -3.959330172999182e-02   -3.038191478524326e-02   +2.566637622588783e-01   +3.502857001157419e-02   +6.520805226425246e-01   -2.010716678717191e-01   -1.696734812530030e-01   +2.381499407819132e-01   +3.697546447943363e-01   +2.817525165556316e-01   +7.110848913682781e-01   +1.723193817911161e-01   -1.057312979993886e-01   +5.987490663043645e-01   +9.691798371307806e-01; +5.660892613170709e-01   +7.447558246391896e-03   +1.387831224023429e-02   +4.687154265849504e-01   -2.067943495764510e-02   +4.241550503002866e-01   +1.710449737308399e-01   +8.269585977781222e-01   +2.045027948554086e-01   +8.425496452085440e-01   +7.221969966324193e-01   +5.687115564014842e-01   +2.375691625137785e-01   +1.755508379188432e-01   +1.717820559667377e-03   +3.672931052838114e-01; +3.757945278870309e-01   +6.279794348328607e-02   -6.086961169269853e-02   +8.626992797532426e-03   +5.559700147409389e-01   +3.021312313875831e-01   +5.554140907318411e-01   +2.581846869224519e-01   +4.299143271791598e-01   +5.631672450855049e-01   -4.289925985710331e-02   +7.066957482278946e-01   +9.233822650155724e-02   +3.323339232603399e-01   +3.295487844909160e-02   +2.191676866480492e-01; +4.518552840831256e-01   -4.874821953763776e-02   +6.312655834412439e-01   +7.124337326876634e-01   -5.104750466594066e-02   +5.776316663300707e-01   +9.704427038242006e-02   +5.927890856949876e-01   +4.823458846652317e-01   +2.401000145637169e-01   -1.704191877539007e-02   +6.187637148614596e-01   +5.684833684781324e-01   +6.088955964082701e-02   -3.018634832592133e-01   +1.799687121193451e-01; +1.581936922734949e-01   +4.639068362058977e-01   +4.516244606055285e-01   -2.463724789412829e-02   +4.836411960667151e-01   +1.731342245593133e-01   +4.565884865865777e-01   +4.294805106447521e-01   -5.503222684763196e-02   +6.997001755583573e-01   -1.191938819112518e-02   +3.558357801496690e-01   +6.830876666623974e-02   +2.723808730197649e-01   -1.631271965396910e-01   +3.009489891480540e-01; +2.759826557045353e-01   +3.285893045985834e-01   -1.576361557455762e-01   +1.866334708518617e-02   +6.380503787600343e-01   -1.472699628506424e-01   +2.776057667734800e-01   +9.465563940411572e-01   +2.059166821884332e-01   +4.649387233004615e-01   +6.156112361568516e-02   +3.997124244396563e-01   +3.297666295208376e-01   +5.428173995323693e-02   +4.723001407112574e-01   +7.597839927936354e-01; +6.077877957023792e-01   +2.441639660564986e-01   +5.913314146833019e-01   +5.906218997676353e-01   +6.191296562818289e-01   +3.771459079685627e-01   +4.619366836311277e-02   +1.223988745964280e-01   +6.184470307465129e-01   -3.674096553786002e-02   +3.663357725353728e-01   +5.060830233766050e-01   -9.905419911918151e-03   +6.075689178471668e-01   +1.166360158125121e-01   +3.982860503692326e-01; -3.920402128972899e-02   +2.518495232195304e-01   +1.586181108931921e-01   +8.857140839994586e-01   -2.947486197601973e-01   +4.806307012650630e-01   +1.837225683450683e-01   +4.732460315689977e-01   +8.075238813611139e-01   +2.511058288483785e-01   +5.226542973986393e-01   +8.117911340916883e-01   +2.507635494503572e-01   +3.414382377382834e-01   +1.927856427179126e-01   +9.757359731496069e-02; +9.788414219463501e-02   +5.569484863179066e-01   -3.660805791970466e-02   +5.948481020126528e-01   +1.260205483909496e-01   +5.280975340546641e-01   +4.386461900851422e-01   +3.092532471766838e-01   +5.381862721931225e-01   +6.916140704760129e-01   +1.482983588519892e-01   +2.991958259471172e-01   +1.875553209241057e-01   +1.044767108659789e-01   -8.614792764394452e-02   +5.822173203853656e-01; +5.611357599906099e-01   -2.779160652047774e-02   +5.816627735177271e-01   +6.382868960171176e-01   +3.096975054933492e-01   +4.706992418504906e-02   +4.973166828597784e-01   +1.524577399139547e-03   +4.273175432068713e-01   -1.377284915237854e-01   +5.955320607972764e-01   +8.210993471851187e-01   +3.661152108168925e-01   +4.506246795995790e-01   -3.824348925645991e-02   +3.807159916206196e-01; +5.618203598373728e-02   +1.475988649522209e-01   +1.150927237381649e-01   +1.128188483898749e-02   +5.275406626890483e-01   +2.713063263946964e-01   +6.152532059610502e-01   +5.964077331962859e-01   +7.645873986059161e-01   +4.325832933013978e-01   +2.409417348546153e-01   +1.677123136549519e-01   +2.564051520769917e-01   +1.189039265146257e-01   +3.240096498744787e-01   +1.996629376879987e-01; +6.433687590253292e-01   -7.288721911659289e-02   +7.168446453165412e-01   +5.317729676349004e-02   +2.268043604949093e-01   +5.541368261343930e-01   +6.527828010159690e-01   +7.303358414041861e-02   +3.806958488166405e-01   +7.267991963389053e-01   +6.118358092637854e-01   +1.593578888900823e-01   +6.861646984294651e-01   +4.254122135240046e-02   -9.017957130296522e-02   -4.202917694785212e-02];
L2I_L1I_iGABA_netcon = [+1.210389077244537e-02   +5.934172139848161e-01   +6.359560007481088e-01   -1.458065749557184e-01   +4.769195186484511e-01   +2.043374507987516e-01   +1.828495191334709e-01   +4.193686164765222e-01; +1.253475940766675e-01   +5.781214577219980e-01   +3.133755056728856e-01   +2.070740659320607e-01   +5.617240872145753e-01   +1.130957221103950e-01   +3.657921428969650e-01   +1.000000000000000e+00; +2.723988653122132e-01   +1.572819391440542e-01   +4.383660618363325e-01   +7.603816149692331e-01   +3.950189267391994e-01   +3.365506131901305e-01   -3.339262168752271e-02   -5.827703569689743e-02; +5.015541772233092e-01   +1.476748233642027e-01   +5.825897540843380e-01   +8.536391081398629e-01   +2.929124439093423e-01   +1.932027216550424e-01   +4.479358956424168e-01   -3.198256598347800e-02; +9.137851142790983e-01   -9.378759392565626e-03   +2.558763170769767e-01   +6.085254296074067e-02   +6.870162460142974e-01   +2.036997164657002e-01   +8.238899859393202e-01   +5.226983648383180e-02; +4.194056905863547e-01   +6.570015648664864e-01   +6.870941678964781e-01   +6.464992380678274e-01   +7.812667017483302e-01   +7.058319332699650e-01   +5.589039569244989e-01   +6.063028329313552e-01; +5.718450256759446e-01   +5.458555632911534e-01   +4.468726209760445e-01   +6.469214535319506e-02   +7.285560775710228e-01   +4.560217056693229e-01   -2.535053590362343e-01   +5.400358597772115e-01; +7.277648497215193e-01   +2.845347876276398e-01   -2.756712433896669e-01   +5.650888530003410e-01   +5.096015812151380e-01   +6.312306590294583e-01   +7.729147400075699e-01   +1.796965511387057e-01; -4.096742658954879e-02   +4.261938061110112e-01   -2.148784807381677e-02   +1.808673111774738e-01   +5.070189967766588e-01   +7.990275083286776e-01   +3.349172826344602e-01   +5.401064449712083e-02; +6.914790315275987e-01   +7.978293208236376e-01   +5.024580955547655e-01   +4.416051242734410e-01   +3.353660487641626e-01   +2.465589776905706e-01   +5.835645014594923e-01   +3.343521906649579e-01; +5.199787368567182e-01   -9.730301310710042e-02   +7.182806203699217e-01   +5.454770617322997e-01   +1.011464074329897e-01   +2.457830468435319e-01   +4.612084435238495e-01   +2.019825974595997e-01; +4.177735237299637e-01   +1.502634150849579e-02   +3.515994169850371e-01   +5.279542377789763e-01   +2.432596726737578e-01   +5.397837564789455e-01   +8.515025247011350e-02   -2.624040170127733e-02; +8.461610876873610e-01   +9.230739295638150e-01   +3.329607559869526e-01   +2.926509492154001e-01   +3.756630598681706e-01   +1.108098256314057e-01   +2.539650105144322e-01   +7.163371504002199e-01; +2.116871916558292e-01   +8.789759918721511e-01   +1.478488973815064e-01   -2.477598886129286e-01   +5.259604505909492e-01   +6.935010703947069e-01   +6.144292510325181e-01   +4.999955873559639e-01; +2.992438372671460e-01   +3.363498130424180e-01   +3.450452163115647e-01   +4.028803468189459e-01   +4.875565237709610e-01   +2.216631642554120e-01   -2.573336689566900e-01   +7.129545840925111e-01; +7.058246942104000e-02   +2.881611794227476e-01   -1.844060886195731e-01   -1.757840003064237e-02   +4.533995957243175e-01   +4.751360006015947e-01   +9.718807864884385e-02   +3.508642949485482e-01];
L1I_L2I_iGABA_netcon = [-2.374387273662729e-01   +6.432901697915706e-01   +2.463328585359955e-01   +7.452877406533270e-02   +9.328690072847833e-01   +6.873262314848115e-01   -2.171288791589143e-01   +1.874147439197591e-01   +5.009185853745008e-01   +5.384431032494117e-01   +6.248684602710466e-01   +5.723257703431186e-01   -1.965041207209433e-01   +4.895149152981582e-01   +2.093638924291589e-01   +6.983748598314159e-01; +6.254952870107423e-01   +8.495590096641463e-01   +5.387027855931000e-01   +5.416336828025839e-02   +1.634920023301177e-01   +7.976631938487744e-03   +1.779419284362517e-01   -1.164930217771158e-01   +2.008316726042960e-01   -8.844263659073229e-02   +2.275380279812418e-01   +6.768966174074455e-02   +5.796333641394975e-01   +3.240907174841807e-01   +9.907920581368201e-01   -2.664993953468510e-01; +5.230660663923926e-01   +4.081537514736380e-01   +7.788074574358257e-01   +1.349151712566439e-01   +5.933710511214454e-02   -7.796655470395746e-02   +6.318808041561389e-01   +1.285682850098469e-01   -8.513319399301625e-02   +7.572381912565437e-01   +6.629119284690244e-02   +1.915887984399597e-01   +4.390473556224208e-01   +4.771204219796554e-01   +9.156086331268744e-02   +3.214564537364712e-01; +4.918655879923316e-01   +3.840450589071158e-01   +2.681719021262486e-01   +3.802355976760592e-01   +8.555965500029332e-01   +2.696621874005427e-01   +1.526952112975595e-01   +1.526088168628465e-01   +5.537594709157669e-01   +3.788333620772467e-01   +1.906322272699646e-01   +9.127680047430722e-02   +2.998486390505760e-01   -6.780856442987301e-02   -1.013355920012667e-01   +3.621920548877832e-01; +4.708619272565632e-01   +6.563614901924896e-01   -1.633575559030746e-01   +7.094104111249918e-01   +4.097964566110325e-01   +2.949239918819497e-01   +4.485188049193899e-01   -1.562277196457594e-01   +4.548355554271120e-01   +4.114796153452568e-01   +8.099842538009827e-01   +7.888377687328477e-01   +6.391532494323862e-01   -2.649916254991503e-01   +5.109193563762308e-01   +3.242356554285556e-01; +2.265317461439349e-01   -6.189171978076064e-02   +3.114441144777551e-01   -3.562262464038524e-02   +2.415180157244228e-01   +4.138060416610692e-01   +6.764866686786806e-01   +4.467041515607739e-01   +4.496482027143920e-01   +4.528529545125042e-01   +5.328986205786274e-01   +4.452348131838492e-01   +4.315243675056821e-01   -4.300457072268858e-03   +4.211219867496526e-01   +6.419828050301428e-01; +1.574883528846410e-01   -6.609006885990559e-02   +3.905976273746538e-01   +4.329457579201820e-01   +4.354116021091028e-01   +5.796020946805305e-01   +1.226359145678809e-01   +1.458398940753722e-01   +5.506677276454210e-02   +3.406591017051463e-01   +1.280454000164282e-01   +9.544286667798721e-02   +1.739667250951386e-01   +2.133871563821433e-01   +5.373844101025406e-01   +5.153174369384703e-02; +5.336259984121479e-01   +9.033997759477176e-01   +3.228622437648356e-01   +2.101500320948526e-01   +6.791816635231245e-01   +3.868137861295232e-01   -1.443037737987780e-01   +2.786881366039027e-01   +2.061070164931802e-01   +4.463130553826962e-01   +1.991745782868585e-01   +9.181159726681516e-01   +6.015148123401400e-01   +6.555424180595076e-01   +4.948676345849154e-02   +4.455992670268399e-01];
L2E_L1E_iAMPA_netcon = [+1.232481808653392e-01   +3.458439948169981e-01   +6.757896026327898e-01   +3.195126428861204e-01   +3.704503931369167e-01   +7.095909998504826e-01   +1.770319994150111e-01   -6.765201669543736e-02; +3.238990422925200e-02   +3.701598206935131e-01   +1.577182138998480e-01   -6.666913701441865e-02   +2.856080699555626e-01   +1.129208817366031e-01   +5.328376271991991e-01   +5.420251716721577e-02; +9.177100216082441e-02   +3.045514151006404e-01   +6.518028811411808e-01   +5.040021149382217e-01   +9.182876000740825e-02   +6.620034953723700e-01   +9.856665738523300e-02   +7.430715342726257e-01; -2.533820884971862e-01   +5.026895645237413e-01   +9.062349400702271e-01   +2.711761328202970e-01   +2.434038041947295e-01   +5.424516862356915e-01   +1.193832404417221e-01   +5.270186468769436e-02; +8.494600185305702e-01   +7.643540302845700e-02   +2.620580020643701e-01   +8.198060743166904e-01   +1.199193280787115e-01   +6.256557978535737e-01   +5.865542758174804e-01   +6.507428842970105e-01; +5.951761819111786e-01   +1.109327424045277e-01   +5.744527386759688e-01   +6.375800391766551e-01   +3.801441323280840e-01   +8.726943049409566e-01   +7.548782279497569e-01   +6.584110007275238e-01; +6.435032449477788e-01   +5.291858808914590e-01   +7.667810859938418e-01   +2.687531354835467e-01   -7.239320708552488e-03   -2.092510181012918e-01   +2.328803612917658e-01   +6.583577003809155e-01; +4.583473859643029e-01   +7.215072132368163e-01   +7.497840543064491e-01   +4.399890032456817e-01   +1.840244059567617e-01   +8.849276077426833e-01   +3.849198598215913e-01   +4.555830325161834e-01; +5.290559335735305e-02   +3.312642692319274e-01   +5.284102619596379e-01   +5.336747195954856e-01   -1.447598756539170e-01   +3.523991833912029e-01   +2.500653555910414e-01   +6.103708547979538e-01; +3.278879198435853e-01   +2.957466570093410e-01   +5.760434380352550e-01   +1.506090806840662e-01   +3.602191306677214e-01   +4.196735229010565e-01   +1.955102181023125e-01   +5.826203963046761e-01; +3.253249561310668e-01   +7.803374182367601e-01   +4.308784171590643e-01   -2.793296933993203e-01   +4.050274381776309e-01   +6.888484709707906e-01   -3.660047365820002e-01   -3.095360966280072e-01; +4.860735902066923e-03   +4.431455821511812e-01   +4.690784910463332e-01   -9.236659155219133e-02   +3.230369293545202e-01   -7.149012087629444e-02   +7.115218530703922e-01   +1.898340964935398e-01; +2.607152047827267e-01   +5.638822641938026e-01   +7.843646538137466e-01   -2.567930768042273e-01   +4.028926193194133e-01   +4.080974834081811e-01   -2.433488287892249e-01   +6.631218200830902e-01; +6.159097857986907e-02   -4.009682531812909e-01   +1.118700185806639e-01   +3.583027401316060e-01   +5.615027861547921e-01   +5.894717717128130e-01   +6.161440744791977e-02   +1.949951475395187e-01; +3.474599205898412e-01   +3.902979561466752e-01   +1.376757124869037e-01   +2.878579746230479e-01   +3.440588871659506e-01   +1.395019233192722e-01   +4.748375742943882e-01   +4.526097843650732e-01; +3.716414370606343e-01   +7.293129498162541e-01   +7.302356303589304e-02   +9.610256621921889e-02   -8.363819892045958e-02   +2.905384833861595e-01   +3.137682539975560e-01   +3.590149031220462e-01];
L1E_L2E_iAMPA_netcon = [+5.346325391735272e-01   +3.179502079069546e-01   +2.447368160757526e-01   +8.465552528212126e-01   +6.413646278774446e-01   -1.305062025967528e-01   +4.745663294841675e-01   +7.339101548170253e-01   +1.850597692846159e-01   +2.655646042289164e-01   +3.805400693854075e-01   +1.000000000000000e+00   -6.630397556659183e-02   +5.115593039614419e-02   +6.711711722830920e-01   +1.688447464335078e-01; +3.207688099739313e-01   -4.441537791765238e-03   +3.787102260419786e-01   +4.279586659038243e-01   +2.425853073086400e-01   +1.145716533376536e-01   +1.392780744618632e-01   -2.965884774094083e-02   +6.564530418192744e-01   +8.738636361053363e-01   +4.890214868429861e-01   +5.711468024674544e-02   +6.958735365270978e-01   +8.723035464291541e-01   +5.326798819191161e-01   +5.991492082497512e-01; +3.037807493886425e-01   +7.281138305226095e-01   +1.602553181528750e-01   +3.267164663236258e-02   +4.822133376611923e-01   -4.508830391886016e-02   +6.033964643419337e-01   +5.315915737268191e-01   +6.389672129687091e-01   +1.459853658318390e-01   +6.836503543996763e-01   +1.062658457424039e-01   +3.385277744345672e-01   +2.225772963324738e-01   +6.359433830884673e-03   +3.288164096654475e-01; +5.510770876846642e-01   +1.562456883113678e-02   +3.602973283893499e-01   +3.544819314511560e-01   +1.116951473902659e-01   +1.385868635328699e-01   -4.221488420673355e-02   +5.099444283312300e-02   +7.358875199629223e-01   +4.605821266471227e-01   +4.179935043720749e-01   +2.069422074126736e-01   +3.941886211890424e-01   +5.214329310506334e-01   +6.924392340327261e-01   +2.750794397064434e-01; +3.578929088424833e-01   +2.082992079794949e-01   +1.401750904075110e-01   +3.269048685933810e-01   +3.431522573090471e-01   +6.850095094440235e-01   +2.087891888127984e-01   +3.482662714576781e-01   +3.173408793469536e-01   +1.355673727450153e-01   +3.108602000964189e-01   -2.839909215114059e-03   +1.607687456347002e-01   +4.397485026547982e-01   -1.651805617237536e-01   +5.705899876905789e-01; +6.381411534384337e-01   -1.215645913559715e-01   +4.025201891947193e-01   +3.711053260856804e-01   +1.208704417041511e-01   +1.103029816371404e-01   +5.271578195490332e-01   +1.683127765752211e-01   +5.649119640622854e-01   +1.019023363288596e-01   +3.007693709019342e-01   +6.427505734763214e-01   -1.785083478754327e-01   +3.726988241785499e-03   +2.267366584384918e-01   +3.742799072935683e-01; +4.742457295412437e-01   +2.006079199366301e-01   +2.819958873588954e-01   +1.695358224538625e-01   +9.605693638637912e-01   +4.960007201881222e-01   +4.709344993812524e-02   +5.389416491470197e-01   +5.336401509568802e-01   +7.126354957584130e-01   +4.316851981474272e-01   +3.434910023749149e-01   +1.711776071136640e-01   +3.482744892910489e-01   +5.109967001778776e-01   -6.789380244849549e-02; +2.842609151055042e-01   +2.684334982626281e-01   +8.550308388499497e-01   +3.331705019438894e-02   +7.902530799664904e-01   +2.604848804787795e-01   +4.591616943150071e-01   +1.435926245412031e-01   +1.503530006016113e-01   +5.970428000192806e-01   +4.350634854539613e-01   +2.134701305838365e-01   +7.295252785482972e-01   +6.062040004522612e-01   +5.843685053946648e-01   +3.687502801048051e-01];
L2I_L2E_iAMPA_netcon = [+5.451833838945915e-01   +1.000000000000000e+00   +2.772996656152144e-01   +5.501022127153333e-01   +7.374347367636934e-01   +5.575020338056021e-01   +7.089374454450258e-01   +3.094809050931915e-01; +9.220712313581295e-01   +1.096317847391907e-01   +2.741894545559972e-01   +1.361014865231692e-01   +5.942824046919829e-01   +2.968947470763004e-01   +1.615511495942306e-01   +7.093520654864148e-01; +6.950096467827048e-01   +4.346038239443551e-01   +7.244638643552291e-01   +2.446873446157254e-01   +3.721735002057366e-01   +2.252931288298936e-01   -4.533374920538820e-02   +7.400811457919751e-01; +2.707924394700407e-01   +5.969249764187657e-01   +3.904958596736331e-01   +3.266555994098764e-01   +5.911105084285149e-01   +8.022851437471555e-02   +7.832725510520880e-02   +4.069800410147302e-01; +5.333269404062134e-01   +5.048676873326846e-01   +7.881473726159317e-01   -1.962538443627905e-02   +7.078678551154775e-01   -8.031245736613642e-02   +1.347584060221948e-01   +3.668541371821372e-01; +1.108417058998213e-01   +1.721058773007617e-01   +4.881860866944603e-01   -3.939939619080062e-03   +6.245498368896271e-01   +5.685408100472999e-01   -1.020700937229393e-01   +3.533085833535628e-01; +4.352796961542545e-01   +2.742483635882542e-01   +6.281396215049401e-01   +3.421336919208227e-01   +5.727678358779294e-02   +8.620644102930253e-02   +3.186347301081195e-01   +6.404935196358250e-01; +5.437797855336313e-01   +5.988688426017773e-01   +3.165897566781796e-02   +5.854626236242766e-01   +3.127484770279588e-02   +7.304292860390564e-01   +1.142960200763420e-01   +4.428363303330111e-01];
L2E_L2I_iGABA_netcon = [+3.259299116647851e-01   +1.887203111724187e-01   -2.983408402333318e-01   +8.353625827576653e-01   +4.689581879292725e-01   +4.501539183619920e-01   +4.565954550226201e-01   +9.352307425542317e-02; +4.360742885157416e-01   +7.127502359253992e-01   +1.166516528208666e-01   +1.353263297819559e-01   +4.891351990770434e-01   +4.134267716853633e-01   -2.822883692480399e-02   +5.606419613717268e-01; +3.457291827109072e-01   -7.056199091722533e-02   +2.569671416795486e-01   +4.115863452640767e-01   +1.184251072988944e-01   +1.467078815866811e-01   +1.177021103336480e-01   +4.056615114607667e-01; -2.817492031276036e-02   +3.135022725153372e-01   -5.602602883414512e-02   +6.640588659673611e-01   +3.765763703197227e-01   +4.410376746834352e-01   +6.377278390512505e-01   +7.453922579490366e-01; +3.133677272254782e-01   +3.252981868937741e-01   +3.429468912791837e-01   +2.821889735019119e-01   -6.428170303814830e-02   +3.345136813904156e-01   +1.385633022469855e-01   -1.959252756156579e-01; +5.511272936706744e-01   +7.314885141402918e-01   +9.770125564743761e-01   +1.000000000000000e+00   +6.156019922640743e-01   +3.019906509318063e-01   -6.974069893514750e-02   +5.019913866172133e-01; +3.126327066282163e-01   +1.961951598227382e-01   -2.553741948758388e-02   +2.234526085894621e-02   +3.456956916730096e-01   -1.553640009470396e-01   +9.006247688200625e-02   +4.529264344784993e-01; -2.535065314823127e-01   +3.751056132686863e-01   +4.269357356187849e-01   +2.734998688924896e-01   +5.823772458313251e-01   +3.525975296883431e-01   +6.022581225922641e-01   +5.726850956687749e-01];
L3E_L2E_iAMPA_netcon = [+9.280478580851359e-02   +3.722961757559016e-01   +5.205724288004024e-01   +9.294877391325589e-02   +1.295215474013871e-01   +6.715467421634196e-01   +6.400873319770272e-01   +4.154572931188905e-01   +5.420981972364302e-01   -1.281930730482212e-01   +3.464676770482210e-01   -6.623487721755192e-02; -2.683084782671794e-01   +6.188961221827757e-01   -2.693426513835545e-01   +1.060768618019565e-01   +3.354130059523965e-01   +5.492865912176715e-02   +3.275668873479057e-01   +3.356427994019608e-01   +3.973044241003179e-01   -1.221276082537216e-02   -1.610918215116786e-01   +2.797529830282856e-01; +2.879362336234079e-01   -5.026336270676050e-02   +2.398721352441441e-01   +3.513824777782791e-01   +2.522389451976066e-01   +6.222261903743107e-01   +3.907167209187247e-01   +5.791779181009822e-01   -1.256359215133949e-02   +3.815432173978583e-01   +2.485717299803355e-01   +7.053177822992168e-01; +6.121838342933033e-01   +4.098756161032301e-01   +5.376754158378778e-01   +3.819150647117256e-01   +3.301733734043538e-01   +9.596799463912659e-01   +3.053466302665477e-01   +1.790437155530614e-01   +3.368706059314481e-01   -4.736311234203709e-01   +4.863470026025887e-01   +9.887693588163553e-01; +3.191436800183859e-01   +4.478281895139716e-01   +2.994595000688326e-01   +2.813195140868023e-01   +2.023793065399636e-01   +4.270968607453235e-01   +1.862625560272272e-01   +8.442968018908914e-01   +7.896534843316486e-01   +2.630988582462784e-01   +4.938440486379277e-01   +2.322416934777143e-01; +1.598226405788401e-01   -2.335972951434333e-02   +6.589620362967898e-01   -1.651704802076037e-01   +2.517161908550098e-01   +4.635259862373144e-01   +3.913069726663047e-01   +3.678985354859436e-01   +2.995080244551817e-01   +3.646660467004312e-01   +1.849082789968056e-01   +5.267745264081276e-02; +5.914981700883230e-02   +1.319732489339073e-01   +1.343137902842224e-01   +3.778431740744346e-01   +8.427982242720510e-01   +5.944178259986007e-01   +7.942083364450396e-01   +6.180151683226559e-01   +5.776227379386289e-01   +3.667757629756146e-01   +2.288601326449243e-01   +6.772638498500946e-01; +2.955838476972719e-01   +6.435375204445146e-02   +5.425777712500431e-01   +5.558436537701559e-01   +4.161557063219629e-01   +6.531819115678505e-01   +4.728468520494540e-01   +2.434775943738983e-01   +5.465537166649596e-01   +1.426975016675782e-01   +2.796168959584999e-02   +1.092062507211180e-01];
L3I_L2I_iGABA_netcon = [+6.524190302222177e-01   -4.531426903403897e-02   +2.265699670723119e-01   +8.067960889184550e-01   +6.012470800513980e-01   -2.380413627648819e-01   +1.375293171851688e-01   +4.665919467379888e-01   +1.467414723122939e-01   -1.042345317540932e-01   +1.024724651722278e-01   +4.472480230898327e-01; +6.629667146658020e-01   -3.619766184654742e-01   +2.492270164883306e-01   +3.695666188185549e-01   +7.529758304195699e-01   +5.296360093953651e-01   +3.891029739380673e-01   +5.012734362007553e-01   +1.242564250723162e-01   +4.653945633125122e-01   +3.644926161331233e-01   +3.418599136937105e-01; +4.972562267303333e-01   -7.160223249700111e-03   +3.924973470959087e-01   -2.898155096735867e-01   +4.076770734311105e-01   +2.644275480584530e-01   +5.361970447462731e-01   +1.023908048437091e-01   +4.366163609859717e-01   +6.113678570361605e-01   +2.800102850885409e-01   +1.000000000000000e+00; +5.234402046488837e-01   +3.782777953057588e-01   +6.763889753619123e-01   +7.467594198765367e-01   +3.820957691461006e-01   -2.734481974489533e-01   +7.227193563869919e-01   +2.384221937921287e-01   +6.001143066221557e-01   -4.622095300054235e-02   +2.987015930958937e-02   +3.744711642033936e-01; +4.510543554363952e-01   +4.493002008838965e-01   +5.612544830719933e-01   +9.610826870417788e-02   +4.698472907652556e-01   +6.848313778607781e-01   +5.732010477042344e-01   -6.197972278198511e-04   +2.390193495449116e-01   +3.898331814892139e-01   +7.830308986877348e-01   +1.706763972966891e-01; +5.089612972317049e-01   +2.221125560039719e-01   +4.975240739944908e-01   +8.816133386844213e-01   +7.026127627818994e-01   -2.347144621573551e-01   +2.564471335594229e-01   -4.251702236539853e-02   +3.363430790188603e-01   +2.150000208843122e-01   +1.217148525665741e-01   +1.535293771279200e-02; +5.442383216964720e-01   +4.085940383051601e-01   +6.707665898446629e-01   +5.201119814159953e-02   +1.964477693622031e-01   +3.061512845050721e-01   +8.712087438385151e-02   +5.435617189755090e-01   +1.991228087477127e-01   +9.071575949684058e-01   +3.250492437533716e-01   +5.928656340750449e-01; +1.764939690322599e-01   -8.474307450870838e-02   +3.591530309492010e-01   +4.318302114681687e-01   -1.892138361191522e-01   +6.445341653289914e-02   +2.716190885691913e-01   -2.036532845257505e-01   +3.310516330387910e-01   +5.904120015003818e-01   +3.704367490504050e-01   +5.163323392336309e-01];
L2E_L3E_iAMPA_netcon = [+9.044341749933643e-02   +9.258807205933375e-01   +6.116809912646923e-01   +7.373012540612406e-01   +1.152965589553425e-01   -1.693334372515519e-01   -1.172038382961929e-01   +3.510987767212751e-01; +2.142654788306856e-01   +4.684961508350245e-01   +4.254908818194453e-01   +2.815257962416490e-01   -7.015240979155747e-02   +8.153201588719602e-02   +3.125383644594805e-01   +4.553819850464090e-01; +6.165116416438855e-02   -4.985695089758164e-02   +6.280410228396373e-01   +8.211889080972314e-01   +5.897137749093108e-01   +3.190021884376087e-01   +7.465495830891923e-02   +3.693633506395985e-01; +3.160088674538024e-01   +4.504993071502499e-01   +1.237888458316727e-01   +7.631094445059349e-01   +5.350129998305057e-01   +5.216786498291794e-01   +3.055820662863613e-01   +9.609839140667266e-02; +4.782480985685625e-01   +7.473079706831492e-01   +5.079582670546501e-01   +9.475192028353779e-01   +4.709632081082258e-01   +3.706953231638424e-01   +7.629142355305218e-02   +8.287488476106244e-01; +8.618262241395258e-01   +5.167039979656015e-01   +2.552448455399670e-01   +5.295074606671217e-02   +5.702778529001983e-01   +4.376843482926558e-01   +5.732305369413644e-01   +5.620846359438322e-01; -8.487385673711173e-02   +4.518713212699336e-01   +6.884696664000099e-02   -4.126166499168855e-01   +1.054367512837740e-01   +1.217331603531028e-01   +1.164343301390199e-01   +3.375037804371653e-01; +8.233646828672833e-01   +1.678566579242828e-01   +6.736604109923967e-01   +6.391156958814603e-02   +1.366199202847783e-01   +3.683805100034662e-01   +3.972197313747278e-01   -1.459119981189124e-01; +1.232758192638155e-01   +4.994686510392199e-01   +3.174810720302473e-01   +3.230896161369964e-02   +2.908216288705400e-01   +1.678326314497025e-01   +4.020035543823844e-01   +4.694316361204216e-01; +1.934814878615067e-01   +4.746920331779432e-01   +4.250729231042372e-01   +1.678368594586763e-01   +5.975044974339451e-01   +4.173902913113660e-01   +6.483674425503377e-01   +3.890357021693186e-01; +4.883154668235291e-01   +6.639500712556654e-01   +7.040277785079628e-01   +3.151368950273846e-01   +1.248313496203573e-01   -1.981492665186171e-01   +7.266323995257228e-01   +5.313428791088755e-02; +6.525187068344036e-01   +4.683734066661441e-01   +3.762430755199451e-01   +6.825788335153558e-01   +3.096073135811013e-01   +5.072039623860261e-01   +2.744608698324993e-01   +4.661810567228026e-01];
L2I_L3I_iGABA_netcon = [+4.190608547115894e-01   +3.091858533650526e-01   +6.699720861750265e-01   +4.697470464447958e-01   +4.399814855390071e-01   +4.705139180643230e-01   -4.706635028613767e-02   +4.505583683543000e-01; +2.133583590099785e-01   +8.583876998036673e-02   +6.532155774291172e-01   +3.640540363216314e-01   +3.449313591693039e-01   +2.675524169199149e-01   +1.000000000000000e+00   +6.241024719456190e-01; +3.336310753080095e-02   +4.340885775519288e-01   -4.934583412823346e-02   +2.679247916946629e-01   +1.416697108689503e-01   +7.442667721197325e-01   +3.160893755013174e-01   +4.124577353558908e-01; +2.801545577722921e-01   +2.198260467896878e-01   -3.116179999719092e-01   +2.407823992097561e-01   +6.751749158595589e-01   +1.337864322535944e-01   -2.803033368322417e-02   +3.741584031641139e-01; +6.398575106171792e-01   +2.096049195832796e-01   +5.612535810826522e-01   +6.670738715181596e-01   +3.514798190440717e-01   +6.117868666436308e-01   +2.936230149958130e-02   +1.405299391361904e-01; -3.751574526979830e-01   -9.188336495762978e-02   +4.745035401337788e-01   +4.247007394702060e-01   +6.347381374239562e-01   +4.708775051536989e-01   +5.879167895821780e-01   +2.920375237867325e-01; +5.945485043263312e-02   +4.643686570565627e-01   +2.253843679157819e-01   +4.241886185556607e-01   +2.422446922652065e-01   +5.467429715715106e-01   +4.059586890637069e-01   +9.519829730374916e-01; +4.255468853756117e-01   +5.651542134452996e-01   +1.979212447384843e-01   +1.490543684214158e-01   -3.245896018162631e-01   +1.581817562765421e-01   +2.595730782842465e-01   -8.028841162088175e-03; +5.021479443677734e-01   +1.067842582432481e-01   -7.906560731624299e-02   +8.417047586118981e-02   +4.002653994122665e-01   +2.019074888325025e-01   +2.686732940793946e-01   +3.997286104743688e-01; +1.169155914584720e-01   -4.878783917594053e-01   +5.328465142236356e-01   +4.976160749290962e-01   +8.296710821575196e-01   +5.313167629119804e-01   +4.937701830015170e-01   +1.516340290862753e-01; +3.659356760188929e-01   +2.687627234856168e-01   +6.438303673127410e-01   -1.688910088480684e-01   +5.636622577393011e-01   +2.917529498187692e-01   +3.878278255990321e-01   +2.189288375815680e-01; +6.767213175721847e-01   +1.940159465145889e-01   +1.391260805885867e-02   -1.799572564085883e-01   +3.843966695268023e-01   +8.019690219712539e-01   +7.034963587400102e-02   +7.404143521931740e-02];
L3I_L3E_iAMPA_netcon = [+6.082048479640610e-02   +3.097507233676036e-01   +3.809301326833813e-01   +8.276746738987392e-01   +5.250245990768775e-01   +3.301398922943557e-01   +3.200341700764678e-01   +7.053433748297190e-02   -1.806210936021387e-01   -7.461034624061764e-02   +2.570060436814467e-01   -3.665466865675426e-01; +2.038284394273067e-01   +3.406564697702629e-01   +1.441589098464384e-01   +3.950002778135849e-01   +2.826850247547040e-01   +2.179723507370634e-01   +4.074931628708955e-01   +9.069518782766302e-02   +1.562913770013843e-01   +3.998123344425076e-01   +4.230183654147556e-01   +6.523992957640492e-01; +1.272711269596408e-02   +7.365472997487894e-01   +4.267366569757775e-01   +1.397716698817662e-01   +4.256172978373944e-03   +4.462011303119709e-01   +1.496472182454640e-01   +2.055125971286122e-01   +4.120075458524280e-01   -3.650142575681574e-01   +5.636589548687641e-01   +2.646970160157676e-01; +2.167488883284169e-01   -4.742182446644227e-02   +3.092076433358600e-01   +1.190571357639748e-01   +6.866761066468529e-01   +7.994426699857886e-02   +5.737374972559658e-02   +1.171424592620320e-01   +3.799462404231279e-01   +5.759924054474499e-01   +2.886830313812911e-01   +8.142657455916044e-02; +1.219910604532178e-01   +7.269661289956723e-01   +1.827415995985502e-01   +2.896259355786869e-01   +4.502852420837857e-01   +4.228776950267153e-01   +2.499203932030889e-01   +1.389593101341266e-01   +5.294212320062592e-01   +2.847995338585496e-01   +3.060506665356907e-01   +1.100319024062401e-01; +7.147981097676877e-02   +2.707606546737074e-01   +8.069825794308458e-01   +4.380121768244914e-02   +2.998341614375659e-01   +1.951136245763722e-01   +2.201592804903747e-01   -1.800712906015775e-01   +7.087134167870953e-01   -1.670113546530952e-01   +3.368331431316669e-01   +7.458671962067254e-01; -4.573765694498587e-02   +6.082299496657344e-01   -2.497495886989392e-02   +4.314672244460024e-01   +3.978902844061593e-01   +4.171850345645371e-01   +1.601880096094486e-01   +2.522000316330092e-01   +7.666589485391945e-01   +6.734006187878172e-01   +2.167360257637218e-01   +5.911905314358449e-01; +5.863627058648126e-02   +6.137754990093752e-01   +5.144771866685381e-01   +5.851289673533157e-01   +9.905507124306654e-01   +8.982678552958843e-02   +9.738293277843442e-01   +1.269669227911399e-01   +1.000000000000000e+00   +4.747038804617499e-01   +5.409964734317445e-01   +3.967003535927180e-01; +3.219333468431226e-01   -9.953276503110561e-02   +3.798145588999446e-02   +5.375278529434412e-01   +6.445807181525949e-01   -2.048971618404434e-01   -7.467916445967501e-02   +4.485735416141143e-01   +4.310516462793502e-01   +9.207026234392254e-01   +4.124502001791647e-01   +2.169758437543667e-01; +5.149201690128682e-01   +2.388563477132427e-01   +4.789699053703419e-01   +4.164615974405153e-01   +7.753589222085587e-02   +2.724793976793824e-01   +6.128142179208943e-01   +5.772641762927893e-01   +3.097943246841880e-01   -1.388645017782926e-02   +1.399334917786938e-01   +4.853142452348432e-01; +2.203983167316557e-01   +7.511551041999242e-01   +2.768979942744772e-01   +4.758472928748516e-01   +6.428527729019418e-01   +1.891358937860546e-01   +4.326936163474700e-01   +8.262784406057482e-01   +2.778940524307517e-01   +3.517908752729467e-01   -2.273350768972598e-02   +7.611969707119077e-01; +2.160919785222195e-01   -9.593891750138181e-02   +3.083282252783703e-01   +6.148650750950119e-01   +7.986031664033585e-01   +2.361974901139346e-01   +1.705018701161960e-01   +3.418721111020686e-01   +7.686856240919379e-01   +4.108537326217436e-01   +3.526752566237747e-01   +3.625415400545879e-01];
L3E_L3I_iGABA_netcon = [+1.744648466166332e-01   +2.981719977328529e-01   +6.260380416971359e-01   +5.154513169287416e-01   +6.628811234671524e-01   +5.889669025749067e-01   +5.197232379294907e-01   +5.667476425669569e-01   +8.416600820057565e-01   +1.923561898046655e-01   +7.026168736553737e-02   +3.572084819078167e-01; +8.751721605493823e-01   +6.598540786488460e-01   +4.175388907139499e-01   +7.558192323793268e-01   +3.738886340895337e-01   +7.471839303012226e-02   +5.766820130198089e-01   +3.217826336827137e-01   +3.454861781066052e-01   +4.891512178904656e-01   +3.544767814019205e-01   +3.008899266831724e-01; +2.021799839801966e-01   +9.828544483068078e-01   +3.120294738472730e-01   +6.283712848910208e-01   +1.887016183609053e-01   +2.929658797185484e-01   -1.583648682099095e-02   +2.608078053483216e-01   +2.598083114679490e-01   +1.254092633449713e-01   +1.815435229260109e-01   +2.921650181952846e-02; +2.859560301584736e-01   +2.860593934771406e-01   +6.732714140845136e-01   +4.454539652471226e-02   +1.273329448284225e-01   +6.170443807109977e-02   +8.358345597351680e-01   +3.245215247165569e-01   +2.511459707179468e-01   +5.465497139518406e-01   +2.314133778673981e-01   -5.451801102267857e-02; +6.419705297356241e-01   +4.254579125012022e-01   +8.210891365270020e-01   +2.007766762266084e-01   +5.786121104725582e-01   +7.190633080608743e-01   +5.409790905686365e-01   +8.453201066627134e-01   +2.391913603241812e-01   +6.526099520953884e-01   +6.240057182834349e-01   +3.778852117192064e-01; +6.828359003223700e-01   +7.413722409472894e-01   +2.450391561112289e-01   +5.951128267804829e-01   +2.466868602255867e-01   +6.887890279375872e-01   +5.184510355794965e-02   +8.373337153649540e-01   +2.613351590019054e-01   +6.666924710189700e-01   +3.473290353027047e-02   +2.311212877764292e-01; +5.653132841112588e-01   +7.286909020653007e-01   +8.960493390049656e-02   +7.301890648440487e-01   -1.231350314904985e-02   +4.629177821648781e-01   +4.002428077049448e-01   +1.676559888684602e-01   +1.604129702530716e-02   +2.478349103124211e-01   +7.482290654025936e-01   +4.284175895492205e-01; +5.520598434204049e-01   +1.588132063651097e-04   +4.586042817601252e-01   +3.187277765684920e-01   +8.382682398685193e-01   +1.646063391773048e-03   -2.798250425004603e-02   +2.549126375118324e-01   +4.205790055118128e-01   +5.572501753815615e-01   -2.202470362000025e-01   +2.944802798223825e-01; +6.670253845959762e-01   +3.155425114583735e-01   +4.047781382225406e-01   +4.182600323033755e-01   +2.970916539247695e-01   +1.893172446503272e-01   -3.691831546183184e-01   +7.441518610944339e-01   -1.344795154681007e-01   +5.063938312100157e-02   +9.021210104459578e-01   -2.924612738790283e-01; +2.659405423179511e-01   +3.830302625488450e-01   +1.440237126211091e-01   +3.647688209564205e-01   -9.181966750034978e-02   +7.753526778429517e-01   -8.686576185420419e-02   +5.235054505669376e-01   +1.881893660743409e-01   +3.210223196752566e-01   -1.241208603068357e-01   +4.368002573529301e-02; +7.126270834833474e-01   +1.689113334335700e-01   +8.296685584096167e-01   +1.991539897732910e-01   +1.078316781976084e-01   +4.770471850540713e-01   +5.841568710762032e-01   +2.479452121060992e-01   +3.130165836820241e-01   +1.755300908206406e-01   +3.981606954894228e-01   +4.972371575594295e-01; -1.293003277292953e-01   +7.577981921489119e-02   +3.436823759522030e-01   -1.514045628939482e-02   -2.079816202491632e-02   +4.352769658047647e-01   +7.537542161813715e-01   +6.547368787867239e-01   +1.146924870945140e-01   +1.871011577862857e-01   +1.192784205582383e-01   +3.238559010441990e-01];
L2E_Input1_iAMPA_netcon = [+9.171467330655977e-01   +5.878455622184975e-01   +5.969042831834500e-01   +1.000000000000000e+00   +8.400611482547703e-01   +8.948749986033585e-01   +9.589847621868148e-01   +7.621781670581160e-01];
L2I_Input2_iAMPA_netcon = [+8.873838751136247e-01   +7.718409381962670e-01   +6.521595286385831e-01   +6.150936098666375e-01   +7.301708867679124e-01   +6.346698111700869e-01   +9.657529265117328e-01   +8.083907695202254e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last =  11.21 * ones(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))*0.4 + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.5*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.5*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))*0.9 + 0.5*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))*0.4 + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.5*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.5*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))*0.9 + 0.5*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
