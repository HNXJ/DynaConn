function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+1.490239088244520e-01   -1.664399815704564e-01   +6.567590007018350e-01   +3.762078630155793e-01   +2.425449040089168e-01   +7.787302199932853e-01   -2.446878200031819e-01   +3.463933277504005e-01   +2.632021246494742e-01   +8.317081905785483e-01   +3.374285430766202e-01   +3.492046682428135e-01   +6.270752017121312e-02   +1.390065819859539e-01   -1.521278157200373e-01   +2.363828812157076e-03; -4.204245528802150e-03   +1.055329481176445e-01   -7.401800922930019e-02   +9.562487812754927e-01   -5.505520470173304e-02   +3.003088834156060e-01   -8.099193942423609e-02   +5.050838145361328e-01   +6.482174363976262e-01   +2.095274585820160e-01   +7.108381565833296e-01   +7.050133011320845e-01   +2.412614917866294e-01   +4.010459336562796e-01   +1.631358694390134e-01   -6.214228437474766e-02; +9.013468458844095e-01   +2.766603629642813e-01   +5.748223889647121e-02   +7.424208469266755e-02   +2.761682101575792e-01   +3.800425990218195e-01   +6.004535086868984e-01   +2.116807753858333e-01   +1.919376855991420e-01   +5.271791404044855e-01   +5.080126195489093e-01   +4.082829981737966e-02   +3.659311875892790e-01   -1.942684114674054e-01   -1.635920429898777e-02   +2.058743573130771e-01; +1.593915125039242e-01   -3.292385105282213e-01   +5.907021643936679e-02   +3.609640713307577e-01   +4.063222849004122e-02   -2.331779403959601e-03   +9.205228422046441e-01   +8.768661787431012e-01   +3.510513741254041e-01   -1.338925753255561e-01   +2.364836393255833e-01   +7.376832636042319e-01   +1.653660944879909e-01   +6.193117727176146e-01   -6.160346251147429e-02   +6.769637088255358e-01; +8.069845619666064e-01   +2.319706060195392e-01   +7.157514583146630e-01   +6.809479040967612e-01   +1.292256032547421e-01   +4.479585447792859e-01   -2.461620078515309e-01   +5.462689683152230e-01   +1.802696141260328e-01   +3.482100426721630e-01   +3.665342810903150e-01   -1.116193864268844e-01   +1.717348835922991e-01   +4.084169482849580e-01   +4.057716514690377e-01   +2.451040646043333e-01; -1.451730475947879e-01   +6.608617671290230e-01   +3.093289978769360e-01   +1.295079883775922e-01   +7.325910316128179e-01   +3.301371623906694e-01   +8.784028846719991e-01   +1.942641168741693e-01   +3.375735788903083e-01   +4.818883633786693e-01   +3.674414864196903e-01   +4.344892128135294e-02   +5.788338172234400e-01   +3.417128085153355e-01   +6.841995701724196e-04   +9.021689397938018e-02; +4.629356192010164e-01   +5.600637685174696e-01   +2.848020078923008e-01   -1.094924086140707e-01   +2.489768438149427e-01   +2.974786962828709e-01   +1.503028454118109e-01   +9.002377665676915e-02   +6.330066776092905e-01   +4.744781033576138e-01   -3.750011013631881e-02   +3.846498201429339e-01   +2.803432493927274e-01   +3.525482259206204e-01   +4.413412056099553e-01   +4.352353950190630e-01; +3.667191079480518e-01   +5.795768495768399e-01   -5.179321279485830e-02   +9.372356752635035e-01   +8.493043731413678e-02   +1.786129871891506e-01   +4.834598810642968e-01   +8.430017255837515e-01   +9.262849015776871e-01   +6.535592280413373e-01   +3.201292096520743e-01   +7.135376017781787e-01   +1.797882494432497e-01   +3.387380132556692e-01   +1.996991234631324e-01   +4.472674183214029e-01; -9.547378139048095e-02   +5.969139351354371e-01   -3.786171596996148e-01   +3.813686977308922e-01   +7.602997616694800e-03   +4.991759582465309e-01   +2.731947453913636e-01   -2.273723983075122e-01   +2.673316962192743e-01   +5.988267402975818e-01   +7.220144767358472e-01   -3.846033579062131e-01   +6.252793678439028e-01   +4.520469592379579e-01   -8.808614723324744e-02   +9.187066016474649e-02; +5.335256423557159e-02   +2.321834949060634e-01   +5.125601608330856e-01   +6.240947945166943e-01   +6.327542829958551e-01   +2.455741288635776e-01   +4.513790040221189e-01   +2.400656699568605e-01   +9.103305605045038e-02   -6.841719062323559e-02   -2.149985684049179e-03   +2.747510037931092e-01   +7.148436446140152e-01   +3.390788470583499e-02   +1.771028753374804e-01   +5.257341847424484e-01; -5.262223821599589e-02   +9.039736691678862e-01   +3.964734345962889e-01   +2.029896218662292e-01   +6.763464239120761e-01   +8.831701866273666e-01   +8.131677553754627e-01   +2.351530979475242e-01   +1.608377576612156e-01   +6.903359120244401e-01   +5.673829380112892e-02   +4.509186341186143e-01   -1.930729190461309e-01   +4.980368126311960e-01   +7.198471958785175e-01   +2.961673730818941e-01; +7.159878263408685e-01   +1.168723317150433e-01   -2.153523479819019e-02   +7.387826017374538e-02   +4.264562222206321e-01   +4.279371878433564e-01   -3.430120562369096e-02   +3.779609743026940e-01   +8.336462990990908e-01   -3.879453910520851e-01   +1.062131173273528e-01   +4.233137239092459e-01   +4.542548941713456e-01   +4.681188750708208e-01   -9.125086432401841e-03   +2.947493970221182e-01; -1.155152876688724e-01   +7.123864823966912e-01   +6.450725275316245e-01   +5.760215711627231e-01   +6.204219413682440e-01   +5.898228304770696e-01   +2.707124089033315e-01   +5.665278379771099e-01   +9.062931143523778e-01   +4.969994243367131e-01   +1.560908623200536e-01   +3.131320422166837e-02   -3.148119647085739e-01   +1.884216948510272e-01   +7.239103723290860e-02   +8.174792096510243e-02; +2.206927851537873e-01   +6.471915431568436e-01   +4.350641468602362e-01   -2.718829882560213e-01   +2.112014326838564e-01   +6.588442370292671e-01   +1.402361309140052e-01   +3.288567604839005e-01   -1.612551436940789e-01   +5.640055832800016e-02   +9.135733009504750e-01   +5.797527568455630e-01   +6.524246892690185e-01   +4.940209525589698e-01   +3.713967710818217e-01   +4.305359458875723e-01; +4.830134549645910e-01   +8.774057464617298e-02   +6.084693832423875e-01   +7.800115291216048e-01   -1.487439267773900e-03   +7.602500365082036e-02   +5.611633093030520e-01   -8.352459015324401e-02   -2.008861200523786e-01   +2.499531725018923e-01   +3.594247605656506e-01   +3.445406092506192e-01   +4.051410674516404e-01   +2.625161921559687e-01   +2.642927676670813e-01   -1.297981490142227e-01; -1.370237594221171e-01   +5.149115033673841e-01   +1.016891097756771e-01   +6.574792136770428e-01   +9.751494455950270e-01   +8.088155441040583e-01   -9.829808213846110e-02   +8.156350293129695e-01   -5.905614527438158e-02   +6.508946767460196e-01   +6.116108530923302e-01   +3.279331914648258e-01   +9.886231866270619e-02   +7.749157225176615e-01   +5.730191242219709e-01   +3.601322036231154e-02];
L1E_L1I_iGABA_netcon = [+3.542098622832205e-01   +3.381834949021515e-01   +2.292631995523288e-01   +3.596719008992001e-02   +3.999865796026282e-01   -2.281281060439655e-01   +3.568079304465049e-01   +1.870800849375551e-01   +1.599510097229018e-01   +5.204646352930024e-02   +3.568028163598721e-01   +1.100644906394532e-01   +5.333063734072254e-01   -3.283047004390667e-01   -1.629265102876738e-01   +8.690811383377423e-01; -1.374160022472380e-01   -1.956795485247509e-01   +2.596704397178587e-01   -8.317836129019161e-02   +1.211478177455439e-01   +1.585850933125866e-01   +3.859059417604465e-01   +1.411890800030922e-01   +6.771321709692982e-01   +1.159925459988984e-01   +5.431237427681720e-01   +2.229403982387081e-01   +6.076180810936991e-01   +7.098591458190373e-02   -1.080512029857270e-01   -1.841611403337288e-01; +9.234932805211990e-02   +9.816673929199141e-02   +1.382839949209385e-01   +5.338150091976791e-01   +3.614763277952444e-01   -8.170470451963385e-02   -1.768385498010317e-03   +1.460966827595952e-01   +1.888395877629948e-01   +1.000000000000000e+00   +2.127872921760009e-01   +2.077331982363907e-01   +1.133154215098191e-01   -3.030579692530982e-01   +1.777454911701944e-01   +5.868520830642950e-01; +3.891997603016464e-01   -1.431214498257603e-01   +4.877975275755640e-03   +2.914737140030648e-01   -7.902390381854443e-02   -9.008618699198799e-02   +1.152258926498446e-01   -9.691506642243639e-02   -6.257754345904842e-02   -2.234971049429588e-02   -1.501550793466064e-02   +3.820820329489985e-01   +4.328193007978169e-02   +3.640235945471634e-01   +2.930813471746173e-01   +1.253810505925166e-01; +2.373709669809587e-01   +2.165928411378246e-01   +4.638516914337387e-02   +1.043723415432528e-01   +4.861839536379319e-01   -4.702585425379265e-01   +3.352997447042483e-01   -1.111841527725887e-01   +2.253465346073811e-01   +2.031912477960086e-01   -1.995065672410358e-01   +4.659679544282274e-01   +3.596755814025221e-01   -1.864298901949262e-01   -8.596720855897654e-03   +4.708030297189010e-01; +1.212606252526483e-01   +1.328357667626554e-01   +3.527776302348060e-01   +6.278661143093461e-02   +6.635390607183200e-02   +5.003552540502125e-01   +1.140099191262760e-01   -1.417242324739184e-01   -4.685402799976488e-03   +2.211136989682681e-01   -1.521136424395533e-02   +1.678543920239401e-01   -8.965818164294911e-02   -1.399871603068492e-01   +6.181800909784286e-01   +4.719821216687461e-01; +4.943417536265871e-03   +8.067413525110508e-02   -8.481758958823375e-02   +1.506681771339675e-02   +1.106288361941808e-01   +3.030868572811756e-01   +6.445513713306393e-02   -1.540833963315739e-01   -2.662144202380682e-02   -6.063105300177240e-03   +3.661786330835032e-01   +8.583391650605534e-03   +4.763649233888226e-01   -3.307774591234103e-01   +5.763799931270569e-01   -4.581951243746336e-02; +3.010774346446045e-01   +4.870082570417825e-01   -6.823698772854701e-02   +2.733878957478886e-01   -4.574848692136925e-02   -2.279722767747791e-01   +5.573409570816121e-01   +4.827441869140275e-02   +5.067627642151822e-01   -2.534162787800836e-01   +2.171364227588434e-01   -1.360856508400533e-01   +2.610317207214766e-01   +2.204327824954633e-01   -3.526508506238844e-02   +8.589057342170418e-02; +4.782961882336072e-01   +4.731620682461419e-01   +4.853453206728051e-01   +6.446971252498379e-02   +1.236006846445793e-01   +5.497461195814153e-01   +2.091133930585217e-01   +6.970167674169302e-02   +4.152898638989302e-01   +2.876593782749872e-01   +1.726014220540704e-01   +1.777135944854382e-01   +5.118849613850283e-02   -4.797807251494995e-02   +6.449994148923299e-01   +3.171142904659424e-01; +3.303112665128388e-01   +5.102420108364624e-01   -1.167735402657071e-01   +3.912288040086629e-01   +9.022205876975656e-02   +3.168474535389350e-01   +9.401280401450243e-02   +5.262765168606796e-02   +2.895455611878392e-01   +1.382027065872539e-01   -3.710227428566535e-02   +2.865003816395584e-01   +1.614201880350923e-01   +4.741975242243304e-01   +1.536308718385787e-01   +3.866816512001380e-01; +1.494638210891804e-01   +2.038163741860904e-01   +4.839686714382324e-01   +4.206111506259685e-02   +3.459189831180422e-01   +2.638776370232422e-01   +2.519767355751538e-01   -5.831869277991278e-02   +3.721763509395792e-01   +1.478131636648305e-01   -6.091846530649524e-02   +4.840216862955359e-01   +4.918261951861602e-01   +1.052096129582769e-01   +1.554219313025752e-01   +2.328032447477590e-01; +3.137706619844407e-01   +1.280717856524841e-01   +1.457073340625955e-01   -1.743882945392190e-01   +3.320248399982105e-02   +3.344248403888517e-01   +1.717651670274262e-01   +5.192018293858675e-01   -1.487481002052481e-01   +3.231000912085785e-01   +4.443451966065903e-01   +5.314291182713091e-01   -1.945899316289582e-01   +3.054114993567454e-01   +6.933184217993860e-02   +3.293896570843942e-01; +3.208485867432056e-01   +2.138307015809510e-01   -1.940967438905817e-01   +7.792382359585580e-01   +5.753753030298226e-02   +1.347262595972556e-01   +1.123345489406163e-01   +4.173109367589106e-01   +1.022894635163119e-01   -1.752223185313515e-01   +2.583455846764098e-01   +3.137779423169463e-01   +2.176013700570218e-01   +3.292337617539929e-01   +4.443153261710840e-01   +5.266321351564562e-02; +2.760004059227110e-01   -5.174768398954733e-03   +3.401150842583551e-01   +5.294439266711692e-01   +2.913062362153443e-01   +1.018225839820544e-01   +2.771743150665883e-01   +2.316072615854203e-01   +1.575869371692349e-01   -8.566591712344630e-02   +2.208831293251064e-01   -2.554729764079582e-01   -1.046993720732817e-01   +2.625339590663581e-02   +2.945355616016709e-01   +7.479545676938668e-02; +3.923133076487528e-01   +6.767466953682626e-04   +2.615697254202478e-02   +3.462603176313912e-02   -4.864393502138775e-02   +1.653521709575972e-01   +8.617347014870366e-02   -7.288074962511940e-02   +3.813864789863234e-01   +2.694859820877997e-01   +5.535337424039870e-01   +3.745145654481922e-01   +9.186345782490485e-02   -2.985401351415454e-01   +2.748301252000550e-01   +2.479127312691923e-01; +3.547429588019364e-01   +4.191512411984503e-02   +3.981145953732382e-01   -7.817087342895908e-02   +4.323879672145164e-01   +2.997485348828107e-01   -3.158925255218769e-02   +3.073522110083555e-01   -1.812923477852648e-01   +1.560897844463851e-01   +2.635667447743540e-01   +3.176822793697768e-01   +4.055794683204213e-01   +3.098247801812351e-01   -1.142352993782727e-01   +5.037035599062364e-01];
L2I_L1I_iGABA_netcon = [+3.188083987752023e-01   +4.521048345783985e-03   +1.652160877421601e-01   +5.134772865205347e-01   +4.737857045067649e-03   -8.071809820875320e-02   +1.773891437107035e-01   +1.149712270174160e-01; +4.479102998311651e-01   +6.434677518733677e-01   +7.412625842662107e-02   +3.387719915373229e-01   +5.114213866240954e-01   +2.186246250932763e-01   +3.582397912745393e-01   -1.110115673269022e-01; +3.508672483767044e-01   +2.915820745980217e-02   +6.005673999858971e-01   +3.795713062164415e-02   +6.305948079565791e-01   +1.723294300570133e-01   +1.433257686082231e-01   -2.887337827892058e-01; +6.566838984461333e-01   +2.836290145475414e-01   +5.077929716033786e-01   +1.475828324605934e-01   +8.729815944763654e-01   +3.657055715599556e-01   +7.234337230806795e-01   +4.769457818223426e-01; +8.909189663758521e-02   +5.470120423632197e-01   +2.695872679196120e-01   +2.295794484789555e-01   +3.765878950978823e-01   -5.342291281300364e-02   +2.959867735904106e-01   +1.067729787482398e-01; +3.527673845974256e-01   +1.225956875469151e-02   +4.477142945276750e-01   +3.321079760161774e-01   +3.259153966415834e-01   +5.103124173308138e-01   +1.876306301842191e-01   +5.092788471054830e-01; +6.645223576684444e-01   +5.905443710997262e-01   +4.520513471619826e-01   +1.971209218841187e-01   +3.832388573684125e-01   +1.944647525146704e-01   +4.886436049676636e-01   +1.614615055655495e-01; +3.200587698942576e-01   +4.271757972627792e-01   +4.616164710467589e-01   +1.033423139525429e-01   +1.754658688176630e-01   +1.458331251629850e-01   +1.247794799085492e-01   +3.765208088299107e-01; +5.231229699004957e-01   +9.346569626506498e-01   -1.832099238018753e-01   +7.697567106613533e-01   -1.115944005172604e-01   +3.420358157189144e-01   +1.231962102601445e-01   +3.448304313212916e-01; -9.980641978072403e-02   -1.606099965916579e-01   +1.728650633242922e-01   +4.742852586599881e-01   +6.882413256063743e-01   -5.288045599276693e-02   -6.223940800027104e-03   +8.380039208358232e-01; +2.117158551939991e-01   +1.003001548356611e-01   +4.119540123537090e-01   +5.340852210426232e-01   +1.097555308498203e-01   -1.270273574226119e-01   +2.873907465727371e-01   +1.846553977432359e-01; +7.157552553837894e-02   +5.162667503998812e-01   +2.151061598370730e-01   +3.723940372263221e-01   -1.817805488810553e-02   +3.560214648579103e-01   +2.505748432111981e-01   +2.956248259264672e-01; +2.017582793910191e-01   +4.830356666200408e-01   +8.517125258097303e-01   -6.533391003727296e-02   +9.393268440617608e-03   +1.309120198879342e-01   -2.543422769831531e-01   -5.431565830019365e-02; +1.581563504560890e-01   -2.307613476596511e-02   +1.515706474091956e-01   -6.660490663882893e-02   +4.651429540553128e-01   +1.561644149679189e-01   +3.679903711208790e-01   +2.855462653008727e-01; +4.719735732548400e-01   +4.552792780347248e-01   +4.166058649258270e-01   +7.924865899777322e-01   +1.788946655858412e-01   +9.375423960262615e-01   +5.122709764840271e-01   +6.763965988456421e-01; -1.739652112047171e-01   +4.736447446956355e-02   +5.798592476503446e-01   -1.493735224353206e-02   +1.032077064224114e-01   +1.035743162306816e-01   +1.287491979943245e-01   +6.654314449469784e-01];
L1I_L2I_iGABA_netcon = [+3.442674659868437e-01   +3.377597094570950e-01   +3.011201358789276e-02   +3.730668730985855e-01   +1.131331476743131e-01   +1.111164344494669e-01   +1.994733968497382e-01   +4.559785984541356e-01   -3.267491465124946e-01   +5.275538592249155e-01   +8.270611368157695e-02   +1.537003135570197e-01   +5.666707304351118e-01   +1.805299250943432e-01   +1.964230149296255e-01   +3.032247089570588e-01; +2.330217850237654e-01   +6.756405418442427e-02   -2.973409412270013e-02   +3.185914408999372e-01   -3.162579428600135e-01   +2.812934213276058e-01   +6.151131161907494e-01   +1.017791289907267e-01   +4.410312707337833e-01   +5.502929136196780e-01   +1.896619677401418e-01   -2.754372658990158e-01   +9.129493853165978e-03   -5.258730144887469e-01   +1.690393626527043e-01   +5.271226300618211e-01; +1.280084304697276e-01   +1.022727410189770e-01   +3.468095709747850e-01   +2.164283004607497e-01   +2.841729175087313e-01   +3.675133006267396e-01   +5.482855286563957e-01   +3.991851693386484e-01   -2.094788100700383e-01   +3.831576415216073e-01   -3.597289854138584e-02   +3.539765603835344e-01   +5.119976312905867e-01   +5.133564686417995e-01   +5.565709045978757e-01   +1.291352950588048e-01; +5.358009848416907e-01   +1.789622203541476e-01   +2.347122325314558e-01   +5.666021346636962e-02   +6.248621966040063e-01   +1.477763521918471e-01   +4.806297228632254e-01   +5.941978920992081e-01   -3.477733049947795e-02   +4.918825953082757e-01   +3.765994284735074e-01   +4.481038874893992e-01   +3.806339550834821e-01   +5.877701850022347e-02   +4.756083523705560e-01   +1.836957111854144e-01; +3.591688358266496e-04   +2.424316129420680e-01   +1.063422424168387e-01   +2.191425957175256e-01   +3.635064848748570e-02   +1.000000000000000e+00   +3.873266901476357e-01   -1.096109324444906e-01   +4.957440771833066e-01   +2.964889797692526e-01   +8.696204077924978e-02   +1.210968567224678e-01   -1.089947441301995e-01   +3.524941756855620e-01   +2.128403073064050e-01   +6.097681860052472e-01; +1.856213743380031e-01   +2.676494387148077e-01   +4.871604478797967e-02   +7.662822442544132e-01   +3.164966271783694e-02   +5.149698771255375e-01   +5.049174068682470e-01   +2.874696784405675e-01   +5.906834031727246e-02   -2.451276769598549e-01   +4.759245662660352e-01   +1.525690811772710e-02   +6.566900463653262e-01   +5.261429634254199e-01   +5.103513914089277e-01   +1.249073546501764e-01; +4.386362203331918e-01   +7.671760983451529e-01   +3.556972672595651e-03   +5.805689017088087e-01   +3.948254394607792e-01   -6.197303646918711e-02   +5.463219351874714e-01   -6.543566072361809e-02   +5.406423286727335e-02   +4.491741575377988e-01   +2.463944095931793e-01   +2.620148472436384e-01   +6.515135841743071e-02   +2.868034145991130e-01   +1.847615854156801e-01   +3.528645230638920e-01; +5.094289625633943e-01   +3.313531552983904e-01   +2.951930481323075e-01   +2.992094421456044e-01   +5.522562046985321e-02   +5.557995031463520e-01   +4.719087698645621e-01   +2.397717848094495e-01   -5.125152604360469e-03   +1.818595542834463e-01   +7.766364760512801e-01   +3.876765623706399e-01   +3.629307327604925e-01   +1.534976564444704e-01   +2.823513001966266e-01   +1.001830275794718e-01];
L2E_L1E_iAMPA_netcon = [+4.008949385430512e-01   +1.107521358547187e-01   +7.556598680261650e-02   +2.424991031176822e-01   +5.778054259317987e-01   +4.728418241707166e-01   +1.531560115953479e-01   +7.266370125362914e-02; -1.077043879647679e-01   +5.996473434830139e-01   -1.074997873443199e-01   -1.903009650183249e-02   +3.862621364636925e-01   -6.306478755923338e-02   +4.047173690603424e-01   +5.474231755472517e-01; +6.543820905783904e-02   +6.647111316821580e-01   +4.997308370119497e-01   +1.379599316904188e-01   +2.300769404585449e-01   +3.506172581348597e-01   +5.453922650443873e-01   +8.581586995166184e-02; +5.839820122366928e-01   +2.709409839017514e-01   -2.461083952791866e-01   +3.823057502332690e-01   +3.381043752183746e-01   +1.153432505919842e-01   +1.289733208749557e-01   -2.475554916366951e-02; -1.387363233872522e-01   +4.966833882342391e-01   +4.373112124651216e-01   +1.955519238825191e-01   +5.412593723723811e-01   +2.009397123315632e-02   +5.622341258482351e-01   +6.730700194934358e-01; +3.881061204818080e-01   -3.180588959708939e-01   +5.083320689572952e-01   +1.014911954280579e-02   +4.246680516220621e-01   +7.115382460491093e-01   +5.553669347045982e-01   +1.507272993754422e-01; +1.045937204882500e-01   +3.016907781300716e-01   -1.426831019839420e-02   +5.007968544361056e-01   -8.437320773622975e-02   +4.177408984184485e-01   +1.000000000000000e+00   +1.341331772372521e-01; +1.178044386403406e-02   +5.008920429341769e-01   +6.973066816506276e-01   +6.946850925532516e-02   +6.836148969200135e-01   +3.152859599027416e-01   +2.304484711377537e-01   +6.930212621498172e-02; +7.126154649468721e-01   +6.063106964836533e-02   +2.066473029593334e-01   +8.465764932503514e-01   +1.145192867498561e-01   +6.738118614183187e-01   +1.488661254003494e-01   +2.348661083556009e-01; +3.563731322305311e-01   +6.736706374783877e-01   +2.126005911712635e-01   +4.765154433411433e-01   +8.742117959400934e-02   +6.565597658171224e-02   +2.838441434933690e-01   +2.763190905218613e-01; -1.561682811399047e-02   +4.705561589078028e-01   +2.706528028315066e-01   +9.283314331871764e-02   -5.222737168878760e-02   +2.045854653749356e-01   -9.488180946093000e-02   +3.109152353305994e-01; +2.098038422024757e-01   +1.675810142014680e-01   +7.828447457673886e-01   +1.080406315573747e-01   +8.788171803102413e-02   +3.261031042591453e-01   -2.564935099649263e-01   +1.433928129639555e-01; +8.094837545425161e-04   +4.347228566119204e-01   +1.445222063394114e-01   +2.310777306560196e-01   +2.725050836298484e-01   -2.589419093269690e-02   +4.890850098418635e-01   +5.627808251603468e-02; +3.519087757219580e-01   +2.922815665128629e-01   +5.516087344799571e-04   +3.862821101063974e-01   +2.004371078152684e-01   -1.059025625445028e-01   +3.658495808239363e-01   +1.720235588100074e-01; -1.190040546369633e-02   -2.619294515538323e-01   +1.281655394023711e-01   +3.722182628836068e-01   +1.311476205111621e-01   +4.299451930675008e-01   -1.163411430436679e-01   -5.281396777543351e-02; +3.360638757846512e-01   +3.046757222549575e-02   +1.544579576351129e-02   +6.532069336065457e-02   +5.479366590295619e-01   +3.985860780526679e-01   +2.839465354286140e-01   +7.462046179950742e-01];
L1E_L2E_iAMPA_netcon = [+2.174446036328494e-01   +2.890421973030684e-01   +2.866662760013913e-02   +2.077185996602540e-01   +2.340687416933801e-01   +4.343094580036011e-01   +2.192534145152310e-01   +3.217183220730927e-02   +2.770371194309039e-01   +2.385835764341322e-01   +2.711937050706396e-01   +5.623837310932415e-01   +4.180231443488084e-01   +3.252334145342158e-02   -1.826690243471071e-01   +3.862326101922384e-02; +3.692883588663761e-01   -2.781345278191545e-01   +3.856204222921525e-01   +2.600567795573060e-01   +1.726960879103853e-01   +2.746643807499672e-02   +1.157564265039764e-01   +1.159958346571006e-01   +1.478650212110904e-01   +2.955469159571402e-01   +4.449002163735778e-02   +4.637924941694226e-01   +3.462054439728215e-01   +1.988529238221200e-01   +5.753964829020316e-01   -1.482647266413306e-03; +6.124460633197034e-01   +4.799574707752256e-02   +3.829754929075464e-02   +3.376160854196446e-03   +1.541952717624648e-01   +4.194963443695234e-01   +4.043668334763951e-01   +4.415365999502345e-01   +4.392125370316654e-01   +1.665151986244920e-03   +3.377713437533171e-01   +3.797374280024989e-01   +9.148728170012455e-02   +3.100026595004712e-01   +9.299847203602367e-02   -3.613832108460902e-02; +3.602384843286306e-01   +1.486588328483481e-01   +6.097943228355813e-01   +2.319968612780355e-01   -1.222916785868462e-02   +3.746043009617906e-01   +1.000000000000000e+00   +1.031569761501981e-01   +2.239955159743923e-01   +3.408651480100157e-01   +4.616253778571549e-01   -1.004015211257498e-01   +6.714211615379601e-02   +3.440807725556259e-01   +5.002107536674829e-01   -5.568247903214311e-03; +2.097728730925249e-01   -6.033862097517004e-02   +7.924030788545824e-01   +2.088173103344027e-01   +4.045121010083250e-01   +3.214934021127468e-01   +6.642083044654230e-01   +2.445601543048588e-01   +3.707504256245691e-01   +1.351842044275596e-01   +1.673608253119027e-01   -3.450472806103583e-01   +4.018404019368689e-01   +2.056430893251327e-01   +9.109264308258141e-01   +1.511190494167102e-01; +2.694635478396231e-01   +6.372057942259584e-01   +5.260713177262292e-01   +4.980681065287705e-01   +2.830174051350463e-01   +4.205013088089550e-04   +4.906116208361080e-01   +4.321858406126517e-01   +4.980397513292038e-01   +1.831130814278023e-01   +4.556382312736643e-01   +3.493271514461379e-03   +1.690628868676001e-02   -3.113059628701351e-01   -1.004387611205140e-01   +4.987189046030196e-01; +7.369865156153911e-02   -1.534779366023284e-02   +2.257388454822691e-01   +4.262744831286838e-01   +2.127370239231423e-01   +7.254907567187976e-02   +6.151969060630296e-01   +2.563723383243402e-01   -2.164762187391056e-01   +1.939206970324846e-01   +8.844903859782510e-02   -2.827698954553710e-01   -2.163520120854193e-01   +9.999244499774836e-02   +3.479156526535599e-01   +1.761030990008037e-01; +3.615526839066834e-01   +4.034650815875966e-02   +2.749753280435305e-01   +5.316461902665326e-01   +4.674012011071257e-01   +7.502270317263720e-01   +6.656837232527637e-01   +1.068915377963575e-01   +2.491432446253961e-02   +6.426626180605459e-01   +3.017274568200677e-01   +3.673031762678652e-01   -1.260016903007227e-03   +1.007488816546247e-01   +2.391714315424003e-01   +1.162656939444136e-01];
L2I_L2E_iAMPA_netcon = [+4.779180179762703e-01   +4.417763419256620e-01   +5.736492399494824e-01   +3.659815171204944e-01   +9.541139225732395e-02   +5.033890433914124e-01   +4.208389310953231e-01   +4.482638348076070e-01; +6.077388460495710e-01   +8.817458175272873e-02   +5.710156404140413e-01   +5.329101349693229e-01   +2.973049902826817e-01   +1.313491054270244e-01   +8.595773336046864e-02   +1.939429162645813e-01; +1.557919781304761e-01   +5.772608124491885e-01   +2.706218835493595e-01   -1.474780533934295e-01   -2.403763700903344e-02   +1.911067217392609e-01   +3.604491182535096e-01   +1.971988275391565e-02; +1.481476238543884e-01   +2.992431052717646e-01   +1.004346954386641e-01   +5.478375226635025e-01   +3.778201872203446e-01   -9.269024873644566e-02   +1.798163467101833e-01   +1.559965926257703e-01; +3.914804433702142e-01   +1.582898132944997e-01   +9.171097696519372e-02   +4.740827104236601e-01   +2.171545227639798e-01   +1.522851721857862e-01   +6.358658807538017e-01   +8.553072953680804e-02; +1.644538292299504e-01   +2.888663160511672e-01   +2.469638511236378e-01   +4.617540159824729e-01   -1.178021471020599e-03   +3.035915945541812e-01   +1.457251956359087e-01   +2.911426750062878e-01; +1.474512064710276e-01   +5.502744606700348e-02   +1.409627591716037e-01   +4.777990950072215e-01   +3.646613385812851e-01   +1.224571666751447e-01   +9.203430292448700e-01   +7.132514095438969e-02; +5.080699206844714e-01   +1.410111525369320e-02   -3.060858906440155e-01   +3.472903964418414e-01   +2.641706679835532e-01   +1.926779515176670e-01   -2.251239802990060e-01   +4.298136737957021e-01];
L2E_L2I_iGABA_netcon = [+1.157248324195445e-02   +5.247355798983075e-01   +3.430594271405271e-01   +1.246623120112262e-01   -5.884480838532517e-02   +2.586710134654615e-01   +1.740908822968261e-01   +4.474465273687076e-01; +2.113157539575425e-01   +3.920862027365691e-01   +3.540851012818643e-01   +4.243570772118109e-01   +3.018423068939995e-01   +3.735662107179916e-01   -3.340268830492011e-01   +1.897228206006918e-01; +8.633319243219294e-02   +6.445499538889540e-01   -6.256065151312640e-02   -5.598801859998431e-02   +3.925020649549988e-01   +6.865424986466498e-01   +1.225830125088041e-02   +1.000000000000000e+00; -1.650871394009714e-01   +2.229456536650549e-01   +1.299038372934873e-01   +5.509525430140290e-01   +5.985443733977082e-01   +3.381492347114792e-02   -2.015456602098813e-01   -5.120592499977117e-02; +1.763333173815461e-01   -1.649851217129174e-01   -7.756760648865228e-02   +5.739843921177791e-01   +6.961021307779306e-01   +3.438696802135116e-01   +9.517314905403088e-02   +1.963257629399652e-01; +2.184535622181119e-01   +1.785064449676004e-01   +1.931650906706744e-01   +2.751624958803122e-01   +3.204861253825513e-01   +3.539844949136155e-02   +1.781334712692215e-01   +1.281799319683866e-01; +4.146718559854107e-01   +3.113281286585832e-01   -1.158780648217596e-01   +1.938199083124967e-01   -8.587353076199716e-02   -9.148094541718314e-02   +1.428731212318964e-01   +9.241427039553624e-01; +2.680557131582712e-01   +6.028707067125307e-01   +6.036721518374100e-01   -2.416322349242868e-01   +3.179821826884772e-01   +1.156940038127512e-01   +4.430088654780187e-01   +4.752776434769377e-01];
L3E_L2E_iAMPA_netcon = [+5.382952370419448e-01   -2.303018625499318e-01   +1.822844782027188e-01   +2.833774782982188e-01   +6.941729532594945e-01   +2.238867816611801e-01   +4.081343485477934e-01   +4.155907881280434e-01   +1.963520800928975e-01   +1.066047934815778e-01   -4.030521029674545e-02   +2.974837495285974e-01; +2.169743622621095e-01   +8.912466216907771e-01   +3.293379500352936e-01   +2.977430619034449e-01   +1.970832444579158e-01   -4.556200662138713e-01   +6.735371763398912e-02   +2.310196642377100e-01   -5.127177887893220e-02   +4.005887590554766e-02   +1.537761463881666e-01   +4.168598735838363e-01; -1.055633510382075e-01   -1.140475885356682e-01   +3.022737554035326e-01   +3.440740628860932e-01   +8.523801410683229e-01   +3.281715365221303e-01   +4.454429057777667e-01   +3.359160185972613e-01   +4.659175100217323e-01   -2.316476638855058e-01   +3.032739164395504e-01   +7.070622244256276e-01; +1.538649024628013e-01   +2.837948568524860e-01   +2.837013457879742e-01   +6.415923143934529e-02   +5.418440680844274e-01   +1.549642361288337e-01   +3.175991416125811e-01   +1.804918382784191e-01   +4.061892369757606e-01   +8.184305281369441e-01   +1.339340816604916e-01   +2.189435029823748e-01; +6.165028469087287e-01   +6.870354614673402e-02   +4.604206400206113e-01   -1.262603010867198e-01   +9.117601952281361e-01   +3.516610189467990e-01   +1.259981210267841e-01   +1.184516798982554e-01   +2.894138759693925e-01   +4.422197712068667e-01   +6.836384127832473e-01   +4.687322796483987e-01; +6.966436193179334e-01   +6.300569526835724e-01   +4.761304836156294e-01   -1.003090106333577e-01   +4.288032805198956e-01   +9.443845550357495e-01   +4.689682941332226e-01   -7.814615065768873e-02   +9.994703804005198e-02   +6.543976510229422e-01   -1.290847892940653e-01   +4.388772724343274e-01; +3.653519910538642e-01   +1.039510988301500e-01   +7.341545776629026e-01   +2.452645909944551e-01   +2.489868813806961e-01   +3.587168025501836e-01   +1.276446837133784e-01   +5.342031409459516e-01   +5.370782950699916e-01   +5.627554501362444e-01   -1.332893207828568e-01   +3.038735105881679e-01; -5.164372435651107e-02   +7.769322181629326e-01   +5.830252560226881e-01   -4.281358235997948e-01   +7.450117898759999e-01   -1.953159769860073e-02   -5.457217353664830e-02   +1.319536720791170e-01   +5.727207261818643e-01   +5.955780305991343e-01   +1.594066216963585e-01   +1.650017869876929e-01];
L3I_L2I_iGABA_netcon = [+5.885353505640056e-01   +6.323459425284662e-01   +3.272552363062384e-01   +3.312299676246475e-01   -1.384523574395225e-01   +2.119043632693198e-01   +5.146866592709756e-01   +5.011388770062521e-01   +8.959723648545601e-01   +3.175799440471296e-01   +3.018105965414403e-01   +5.195248888715174e-01; +2.471729146040033e-01   +2.269450436611153e-01   +1.082752301637466e-01   +3.288936595702845e-01   +7.080694625192920e-01   +3.143439502157220e-01   +4.503498722726242e-01   +7.850069646267796e-02   +1.772842909506011e-01   +1.943351241156954e-01   +4.317527274334212e-01   -3.587513895207915e-01; -3.035282256744612e-03   +6.487848510830397e-01   +4.689150779745631e-01   -4.960728396436544e-02   +5.564049838480879e-02   +4.709601921410115e-02   +5.564814415501420e-01   +7.567694137499313e-01   +3.181498007286055e-01   +3.350654683426266e-01   -7.149857728175198e-02   +8.763450640431932e-01; +5.658640112246504e-01   +4.942627693283545e-01   +3.457033821335951e-01   -6.533751591006409e-02   +2.272879233630878e-01   +3.839699733668028e-01   +6.774317396646608e-02   +1.947755056281131e-01   +2.062528878139195e-01   +2.911483677688422e-01   +5.502852412568419e-01   +3.370307582613615e-01; +1.128046789954214e-01   +4.943792866655918e-01   +2.081573978447726e-01   +6.915549629788907e-01   +5.835303624439052e-01   +3.770271429840139e-01   -4.980019467929502e-02   +8.980661146978831e-01   +7.979649341551677e-01   +5.112207235049952e-02   +1.383920514399901e-01   +5.987423302654077e-01; -5.366847700143873e-02   +5.266811551597652e-01   +1.002535905113225e-01   +5.925394354832669e-01   +7.809714333321098e-01   +3.150386257570819e-01   +2.920533974605581e-01   +2.501898158027180e-01   +3.855161376170489e-01   +1.770549357693610e-01   +3.978471801709316e-01   +4.401482434056661e-01; +4.664094304961362e-01   +2.964895910201829e-01   +6.867187511571368e-01   +1.184410408756480e-01   +8.561893606017665e-02   +5.927326240091686e-01   +5.038103507174848e-01   -3.799686885853139e-02   -2.461036280654457e-01   +4.949066695794309e-01   +7.006002858051370e-01   +3.325747863925209e-01; +5.887045775470624e-02   +3.233393948138414e-01   +6.478118518438554e-01   +6.612066288813889e-01   -3.307025105979854e-01   +5.337668074269661e-01   +6.800449390258616e-01   +2.834122773079894e-01   +7.751121475122051e-01   +2.718040295110498e-01   +6.804237998404271e-01   +3.702103026512606e-01];
L2E_L3E_iAMPA_netcon = [+4.678871173795236e-01   +1.859210607262410e-01   -4.573496499075439e-02   -8.779914186859542e-03   +5.057426605028099e-02   -1.145328437619045e-01   +2.859901521571683e-01   -5.054786479487204e-02; +3.094875107499124e-01   +1.782786888335999e-01   +4.179762910899357e-01   +2.788188019686744e-01   +4.809213860355011e-01   -1.773076018097857e-01   -3.080384011168696e-01   -4.036668522698053e-01; +6.299564857203171e-01   -1.968226346212477e-01   +3.376076365926706e-01   +4.927788406035560e-01   +8.244709324393157e-02   +4.065719782913170e-02   +2.878062160595691e-01   +3.511678449650938e-01; +1.592827863417491e-01   +9.275772867886736e-02   +5.337481494855862e-01   +8.505257867668675e-01   +7.527811635620725e-01   +5.592766180297043e-01   +1.311787527593054e-02   +2.085973122363610e-02; +9.897313209504187e-02   +4.161280978055086e-01   +2.254073064166526e-01   +6.905238663454474e-01   +8.841342450856510e-01   -2.442881641717844e-02   -5.255801207365414e-02   +1.522500786158494e-01; +4.102982912795189e-01   +6.672279085013703e-01   +7.225152404235987e-01   +6.552329684700335e-01   +5.946414101182436e-01   +2.032054872119858e-01   +4.758647631296584e-01   -5.437117090132496e-02; +7.304307306419580e-02   +3.444790173760792e-01   +7.681955810773994e-01   +1.497359779092250e-01   +5.458650597641850e-03   -1.497691912832336e-02   -1.300151392500762e-02   +4.141582609741737e-01; +2.923128212128496e-01   +3.836895942300914e-01   +2.915000250772648e-01   +8.708677980211400e-02   +1.660230784489077e-01   +1.499673136549620e-01   +4.621319779116879e-01   +9.711643126153992e-01; +6.384636344803228e-01   +2.844678527647843e-01   +2.490131246300971e-01   +1.173753697271332e-01   +3.905582791187044e-01   +6.297300657888642e-03   +5.193951408215967e-01   -2.210201680685073e-01; -9.039216303897672e-02   +2.939023372098505e-01   +2.608351896230957e-01   +3.696791821990165e-01   +3.683690780967641e-02   -6.587279123126075e-02   +5.912001961288283e-01   +8.739723459360398e-02; +2.987059650644825e-01   +3.777674913287715e-02   -1.471585574106734e-01   +6.280991329427221e-01   +3.894210082916321e-01   +3.984556417250084e-01   +3.020828228814745e-01   +5.923656732290756e-01; +6.125235833476340e-02   +7.940881082617295e-01   +6.766036565721321e-01   +4.580483251681635e-01   +5.519317549742408e-02   +5.476571399621707e-02   -4.342915860208155e-02   +4.642795102824342e-01];
L2I_L3I_iGABA_netcon = [-3.937201448885017e-01   +1.812805235694232e-01   +6.282917226703658e-01   +4.393172816454087e-01   -1.915807562087044e-01   +4.733536496036876e-01   +1.217637075390129e-01   -4.042390177195332e-01; +1.678535846991520e-01   +4.096558321165619e-01   +1.951437120690601e-01   +2.731637744793174e-01   +3.789055860110418e-01   +2.340949442155796e-01   +2.757369441481889e-01   +1.427629610850910e-01; +6.740394735434180e-01   +5.738950916936559e-01   +1.621818790711236e-01   +5.556156512375954e-01   +5.209377526027200e-02   +1.000000000000000e+00   +3.714501162889945e-01   -1.018918199331930e-01; +1.495587799753735e-03   +2.516212846047076e-01   +6.724797742728725e-01   -7.599323925953347e-02   +2.936891201592398e-01   +3.737849295006590e-01   +9.296676843801040e-03   +3.941242295419544e-01; +6.405714837432709e-01   +3.182558874956174e-01   +5.629281233764125e-02   +5.015641809678119e-01   +2.709300265455038e-02   +2.495641262160674e-01   +1.417326022726965e-01   +7.645119945164638e-02; -7.448030852119637e-02   +3.034937690915295e-01   +5.692650635085650e-01   -2.598780673069654e-01   +2.854998665426093e-01   +6.332107774842355e-01   -1.103116688509764e-01   -1.596514625474493e-01; +5.619396024503573e-01   +2.404927718735195e-01   +3.538603558642865e-01   +3.392343555356629e-01   +9.359588321744806e-02   +4.939769553349997e-01   +6.461653296687148e-01   +1.937949160369599e-01; -1.893813011969828e-01   +6.050512792040910e-01   -4.220529896089593e-02   +8.547776734725922e-02   +1.203946894830095e-01   +1.121224377297130e-01   -5.091329654997464e-02   +5.777088137126517e-01; -5.742390026774636e-01   +5.826656219403100e-01   +4.680802462707699e-01   -9.047297779005682e-02   +6.892742073047646e-02   +4.095875126625895e-01   +3.346681717368027e-01   +3.246208666248633e-01; +4.570475689434310e-01   -1.843810456595522e-01   +3.433490481818795e-01   +7.673147336230803e-02   +4.185027346994984e-01   +5.963073142819538e-01   +3.658815355263838e-02   +5.224250746635887e-01; +7.895651109519947e-01   +4.827859966396792e-02   -1.437054153330203e-01   +4.832674352952604e-03   +4.898005146960940e-01   -9.837642451161427e-02   +3.461118929546592e-01   +8.475713230547596e-01; -2.652792325272372e-01   +4.549304115405633e-01   -2.299003647293303e-01   +5.721795549433278e-01   +8.505353395230716e-01   +3.599074143459280e-01   +3.489227915592424e-02   +4.134851173837981e-01];
L3I_L3E_iAMPA_netcon = [+5.397158858282802e-01   +2.182989009590705e-01   +3.054268690995121e-03   +4.132816774596806e-01   +4.416732022631290e-01   +4.148826003325919e-02   +2.612842576511373e-01   +7.135284840241490e-02   -2.623092990383494e-01   +3.181528093012829e-01   -1.453365456556632e-01   +6.792712208587275e-01; +2.836720044352107e-01   +9.737352290889610e-02   +2.243986428528073e-01   +5.965576876458887e-01   +6.817612785017457e-01   +8.429949527875602e-02   +1.534294654791536e-01   +3.585443178390150e-01   +4.022526893200144e-01   +4.457682745930795e-01   -9.907523542409301e-02   +1.458391812651412e-01; +4.345847443154259e-01   +4.706081232723411e-01   +6.864135966492128e-01   +4.670220575135441e-01   +7.870150685581678e-01   +4.714084558397466e-01   +6.727092061434075e-01   -3.643794415208004e-01   +4.396170243502561e-01   +5.515781712549706e-01   +1.956161189624859e-01   +5.058398888855731e-01; +3.110978672486737e-01   +5.693092680046972e-01   +5.689726977109043e-01   -4.841274905423951e-02   +2.429378937604569e-01   +8.088134357195839e-01   -3.485800545598303e-01   +4.811461830903699e-01   +3.520035322292905e-01   +2.093347280158173e-01   +1.260318977962923e-01   +2.515152139235184e-01; +7.125411523674584e-02   +8.461031617090217e-02   +7.857849960410036e-01   -1.411115832356701e-02   +3.704085221656803e-01   +1.855658012011671e-01   -8.271704873970932e-02   +4.584485822576263e-01   +5.886917915453937e-01   +5.837382013801772e-01   +4.152746464887790e-01   +2.174198738732633e-01; -6.814475193297413e-02   +1.615788305251615e-01   +3.020156033026360e-01   +8.181108639520558e-02   +1.045406684617445e-01   -7.308590774973808e-02   +4.881653881646148e-01   +2.496310395164833e-01   +1.557866815698190e-01   +3.225151510945513e-02   +2.518958193414029e-01   +4.017871929324542e-01; -1.169949169585525e-01   +5.434316353080069e-02   -2.443138707222198e-01   +9.585906463920697e-02   +4.751628625071031e-01   -8.606661104694847e-02   +5.177347263740815e-01   +5.478117382097636e-01   -1.546824037783593e-01   +2.374350195548627e-01   +4.239639079622314e-01   +1.309186697041800e-01; +1.395419291804151e-01   +3.544543633806209e-01   +2.734202375127278e-01   +1.448899274764097e-01   -1.721576863985763e-01   +2.741891466894008e-01   +9.075854749544388e-02   +5.104958214002214e-01   +3.441634840743823e-01   -2.831405972459554e-01   +4.028142178911976e-02   +4.395218294589872e-01; +1.990989307896079e-01   +6.082654451817070e-01   -1.227332427624364e-01   +2.045048520774745e-01   +2.228947141381708e-01   +8.928281259382594e-01   +1.244482842234664e-01   +5.907592373047439e-01   +3.321367655234478e-01   +5.105595618081411e-01   +7.671087905879364e-01   +6.460558254576042e-01; +7.121454452319821e-01   -4.256411420976879e-01   +7.066224101176444e-01   +3.090947511311359e-01   +2.376882817100689e-01   -3.602840262426798e-01   +4.199561334895938e-01   +1.688410404885679e-01   +3.268212212055188e-01   -9.423224901867927e-02   +1.000000000000000e+00   +8.225937415449912e-02; -2.235635519851873e-01   +2.421300083557908e-01   +5.782153757276989e-01   +5.620882137445613e-01   +5.913949706150206e-01   +7.323414363249808e-02   +4.010961322099468e-01   +5.098334253714637e-01   +8.174025237333400e-01   +9.674746991637650e-03   +2.012177465825231e-01   +6.143725533253378e-01; -1.929911859086878e-02   +9.360344388457818e-02   +2.329693543242499e-01   +2.070089633426682e-01   -1.997991522730188e-01   -1.302332438896659e-01   -1.136870550201434e-01   +2.792348933111803e-01   +8.708043394465843e-01   +5.192703813706653e-02   +1.475021909446063e-01   +1.333497586926984e-01];
L3E_L3I_iGABA_netcon = [-8.236490945142642e-02   +4.317558405044197e-01   +9.131276697799859e-02   +5.587713693745573e-01   +3.758592169826029e-01   +1.409363918907534e-01   -4.571856352384256e-02   +8.685005177652647e-02   +7.623814117891828e-03   +4.527249712263533e-01   +5.042636974122743e-01   +2.030866332863810e-01; +3.677678206621121e-01   +2.113755358462882e-01   +7.395635461339643e-02   -1.013679804563225e-01   +2.487558389950413e-01   +1.200852255318221e-01   +1.006994323109130e-01   +4.306503112930445e-01   -2.325358097413702e-01   +5.504786471585266e-02   -9.961554434012660e-03   +7.175257977469673e-02; +2.920522862861073e-01   +1.382237232237582e-01   -1.738669691934407e-01   +6.694041874162408e-02   +2.642522941710779e-01   +3.817482883902328e-01   +3.743078863648397e-01   +1.449130817462309e-01   -1.683004305709334e-01   +4.009919133064209e-01   -2.244602720077904e-01   -1.957141297410114e-01; +2.221869079020252e-01   +3.596007567115640e-01   -1.885401687798245e-01   +1.274708064318237e-01   +7.415281931368698e-01   +1.056058503359990e-01   -1.379665184136910e-01   +8.098848404099421e-02   +7.661542169507031e-01   +5.562624259235873e-01   +3.054157293547871e-01   +2.250388081406451e-01; +3.533117632391485e-01   +8.451927267739283e-02   +1.272512711191732e-01   +5.402722386273436e-01   +8.258023783736812e-02   +2.310579750346454e-01   -2.530464536572296e-01   +5.288708783651280e-01   +2.317434377168288e-01   +5.961848927844875e-01   +3.506046114302406e-01   +3.482686644819702e-01; +3.034660746531954e-01   -2.185671700083253e-02   -3.030913242764059e-02   +3.497218486428312e-02   +3.453898976738112e-01   +1.965791905939372e-01   +1.213084845871999e-01   +2.384793452925473e-01   +5.281782134085611e-01   +3.825255693311307e-01   +2.821394624391507e-01   -8.508742399736177e-02; -1.621052135889992e-01   +3.189245319308129e-01   +6.860145101784573e-01   +9.573975061105997e-01   +3.415831713642723e-01   +1.227212833486618e-01   +5.352355394515093e-01   +4.945363672798694e-01   +7.568899581642469e-02   +3.946030200888288e-01   +4.488368901177474e-01   -1.249363957917156e-01; +1.653226972412460e-01   +2.130330143724580e-01   +5.097579161711153e-01   +6.904889054828946e-02   +1.480267303371810e-01   +2.369331151608609e-01   +3.259245343203725e-01   +4.537831277890362e-01   -8.596223097933106e-03   +1.994844593613285e-01   +3.373183295357368e-01   +3.366234655937573e-01; +9.233421650345597e-02   +2.525026868336493e-01   +9.998591188043676e-02   -6.692922542808427e-02   +1.003873639707520e-01   +1.491820325980204e-01   -2.516597221039527e-01   +1.582888923866239e-01   +6.195119642869540e-01   +6.077030709088980e-01   +4.088295140143015e-01   +4.404821598367142e-01; -7.970806060168044e-02   +2.493522128721488e-01   +2.478267579503024e-01   +2.161151844901530e-01   -2.622885508093011e-01   +1.368304075648676e-01   +3.945455488285092e-01   +2.827908438282817e-03   +1.808035243980654e-01   -9.080605255642820e-03   +2.831943523903021e-01   +2.756094249331162e-01; -2.561461975542042e-01   +1.908628853429501e-01   +3.249532451748912e-01   -5.267532140158721e-02   +3.667092435498699e-01   -4.944287338963055e-02   +4.578776461999194e-01   +1.870301759816487e-01   +1.531779313574973e-01   +2.432103249143414e-01   +2.086109645673919e-01   +1.756364766044463e-01; +1.662113732208030e-01   +3.936336443502513e-01   -5.210762402142706e-02   +2.186715223086844e-01   +7.007630756510879e-01   +5.160018995355388e-01   +6.161914058585671e-01   +1.111601272517701e-01   +1.636015022970178e-01   -1.456035402507077e-01   +2.881509905166160e-01   -6.650974949003420e-02];
L2E_Input1_iAMPA_netcon = [+4.031303437183593e-01   +7.586753519746867e-01   +8.393005511126279e-01   +9.589049284895881e-01   +7.587809538511751e-01   +8.658348250098482e-01   +6.099407915545065e-01   +8.616620079481273e-01];
L2I_Input2_iAMPA_netcon = [+6.657886431334262e-01   +6.128020063867888e-01   +8.223134591734022e-01   +7.397714372089539e-01   +1.874515453308916e-01   +9.599721943968029e-01   +3.277073663391695e-01   +1.241044746768463e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last =  11.21 * ones(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.2*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.2*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.2*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.2*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.2*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.2*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.2*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.2*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
