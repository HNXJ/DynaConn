function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+5.271927827216905e-03   +6.672826839375298e-02   +1.212282719330696e-01   +9.386617552242790e-02   +8.445024166370434e-02   +1.347357285810330e-01   +6.681976275011550e-02   +2.587490890098566e-02   +3.096801394081713e-02   +5.814166185245789e-02   +8.250699134712942e-02   +3.246040113062586e-02   +5.625886065454937e-02   +9.117183326080142e-02   +6.228445143658966e-02   +1.155809728066398e-02; +4.900752544491434e-02   +6.479302333314529e-03   +7.155582918799865e-02   +8.418299023911133e-02   +3.622693559681791e-02   +4.283562043931361e-02   +1.248862719577918e-01   +1.332806493127379e-01   +9.002742811302765e-02   +2.888151501074616e-02   +1.383721508952236e-01   +2.926714559810871e-02   +2.862950820161720e-02   -1.142273005537107e-03   +7.586149147815682e-02   +4.835963518711331e-03; +9.042570301315955e-02   +9.333176713893780e-02   +1.209716340424998e-01   +6.578246829476514e-02   +1.244678550509714e-02   +1.157579052511447e-01   +1.196114329710250e-01   +5.941491274115814e-02   +5.930996141296702e-02   +5.152149041516094e-02   +6.425585046076090e-02   +2.508664898349958e-02   +7.668411754601196e-03   +2.462925583349412e-02   +1.183149208029608e-01   +8.010108092306491e-02; -1.677780158086031e-03   +5.380211881384263e-03   +6.447058520375884e-02   +8.824071485023549e-02   +2.754863397069007e-02   +1.028743826764085e-01   +6.344162133741085e-02   +1.313056053009788e-01   +6.062833578030583e-02   +3.895503777074148e-02   +1.190526250936065e-01   +1.216393631487890e-01   +1.632577526102592e-02   +1.267157586819024e-01   +3.227026137413155e-02   +4.630420946480139e-02; +6.672357719034147e-02   +8.754405172418531e-02   +8.542601876138491e-02   +9.666505273823142e-02   +5.372338429110583e-02   +1.160987568522739e-01   +6.830587084670608e-02   +3.421666046530211e-02   +7.125121914949271e-02   +1.140338459605365e-01   +4.714080924679818e-02   +9.154665625485724e-02   +3.647850110233045e-02   +3.830596018456855e-02   +1.267051496048252e-01   +1.950336720605522e-02; +6.968736445306192e-02   +2.088444861745873e-02   +1.131491477618186e-01   +2.458490295827363e-02   +8.217385411162346e-02   +4.123970814811065e-02   +5.708551679742659e-02   +2.630091767339709e-02   +6.628354644616202e-02   +6.255735434744630e-02   +9.252022564895998e-02   +3.478850449348166e-02   +6.454628570754040e-02   +7.321758067832929e-02   +6.472128935539606e-02   +9.687724379275807e-02; +4.289958650313046e-02   +9.228392038037417e-02   +1.250489893106033e-01   +8.829259229213506e-02   +5.372814909801223e-02   +8.367916733458573e-02   +5.481921393955202e-02   +1.132908180959083e-01   +1.311364013640921e-01   +4.999579437327620e-02   +2.218855331431110e-02   +2.479125423349436e-02   +6.000701098596600e-02   +1.271975469857113e-01   +8.168619250453523e-03   +3.007897496646206e-02; +7.338585559057099e-02   +4.870377607623102e-02   +9.894940338246956e-02   +8.748133636038923e-02   +8.118111591587351e-02   +2.142091541952021e-02   +5.847850093592918e-03   +6.086250850579534e-02   +1.018274346653974e-01   +8.679172467621926e-02   +3.871812988840589e-02   +1.011667454533266e-01   +3.667060778780253e-02   +1.352362334541530e-02   +9.362231161145876e-02   +8.584947711351888e-02; +2.818089835572682e-03   +8.879698157758366e-02   +9.052793173891048e-02   +8.994198158494532e-02   +1.168193385424229e-02   +1.185524063602935e-01   +5.781571138315972e-02   +6.189594376938858e-02   +6.808957302560360e-02   +6.738860809691773e-02   +2.756792308188323e-02   +1.228655818594941e-01   -4.500901304054824e-03   +9.929794856488629e-02   +4.881481097059857e-02   +6.616034614331853e-02; +9.681175817725381e-02   +1.801626496445737e-02   +1.216495166261926e-01   +1.070741523723295e-01   +8.429318350902586e-02   +2.776638166383436e-02   +1.143991087265792e-02   +6.217115421987762e-03   +9.992023417751859e-02   +5.529200618816360e-02   +1.498121143217134e-02   +7.380917987661494e-02   +1.131074981328939e-01   +3.149139938342583e-02   +1.192734501872957e-01   +8.505908886090384e-02; +5.533611380863326e-02   +6.759005375414705e-02   +6.918471282988881e-02   +1.041416770618481e-01   +1.201378414073288e-01   +2.652681467375386e-02   +8.243457801671793e-02   +7.902987323676332e-02   +3.693078426036915e-02   +3.927467878728121e-02   +9.644537536045646e-02   +1.285244567142407e-01   +1.866401587135042e-02   +9.576798916141488e-02   +1.064367121645784e-01   +2.870874459014093e-02; +7.142268644497830e-02   +3.817322874775458e-02   +1.265227429614062e-02   +3.313647886996627e-03   +1.284397864601038e-01   +1.208998609208389e-01   +1.005290967820561e-02   +9.636488612606242e-02   +9.537482990404428e-02   +4.414784714892714e-02   +1.834719754542960e-02   +7.629224185681112e-04   +1.213426334341689e-01   +1.190320188877853e-02   +6.927267640296582e-02   +5.794167981098020e-02; +8.928770015093795e-02   +9.939679569610016e-02   +1.144276148281701e-01   +2.213776398968795e-02   +9.017714436938473e-02   +9.529407572972280e-02   +9.528737112146163e-02   +8.574063601894517e-02   +1.192365076131271e-01   +6.221064603108585e-02   +5.096070207023625e-02   +1.249925328859707e-01   +1.144651107140595e-01   +9.342400515100781e-02   +6.722424742893116e-02   +1.223699683070051e-01; +1.155956858264479e-01   +9.083220482894731e-02   +3.943809724048046e-02   +8.083824785019146e-02   +1.701464363521570e-02   +3.687234789372240e-02   +1.175522326094930e-02   +3.510120705472336e-02   +4.608132156650473e-02   +9.428637349398955e-02   +2.972513344310629e-02   +1.109726760451550e-01   +7.905178995631323e-02   +8.964408620139698e-02   +5.231606445154371e-02   +4.482375509572261e-02; +2.416199636516450e-03   +7.612320719212474e-02   +1.172302468779594e-01   +7.359994206944113e-02   +3.824527248761337e-02   +2.304472238641153e-02   +3.813092675866044e-02   +5.377189475873312e-02   +3.270061850974383e-02   +1.332390829856012e-01   +4.290929873615207e-02   +1.230584148138475e-02   +2.256455332015983e-02   +9.981407628000262e-02   +6.839252747701849e-03   +9.158897261683176e-02; +1.028650700907860e-01   +4.817571845209262e-02   +2.438353608577670e-02   +1.285193060093092e-01   +1.514474602023818e-02   +2.006722537692299e-02   +1.199581343577314e-01   +2.352588867900789e-02   +7.845724947855388e-02   +1.072627102349228e-01   +9.067805859869152e-02   +2.544983054958518e-02   +1.005391700281713e-01   +1.062201980991285e-01   +1.257054381170919e-01   +1.166644645654715e-01];
L1E_L1I_iGABA_netcon = [+6.666419704053704e-02   +8.248946315864715e-02   +7.906526020918963e-03   +4.143728433737224e-02   +1.133903117863992e-01   +5.549095683691580e-02   +5.057499429866589e-02   +3.059129775107649e-02   +1.566558123797403e-02   +4.825360889545267e-02   +4.610987840543482e-02   +7.911352174946401e-02   +3.862657637754481e-02   +1.194629136836560e-01   +2.868341139026595e-02   +6.440383118778482e-02; +1.285254637107182e-02   +1.234940038474212e-01   +6.811020751630298e-02   +1.152808496454401e-01   +6.406681945256616e-02   +5.842023446053194e-02   +2.557613416818283e-02   +6.893381800775597e-02   +6.898612032233171e-02   +2.014514013658858e-02   +2.556819964270804e-02   +9.806868546726717e-02   +6.059545703885366e-02   +9.595913525163575e-02   +6.771018538817625e-02   +9.365643853954253e-02; +8.757865949001176e-02   +1.358681363452107e-01   +1.081966299767494e-01   +8.875599859772751e-02   +1.441586336485405e-02   +7.677893777683163e-02   +9.218549274952291e-02   +1.191059486310758e-01   +1.169515425260232e-01   +1.346222633970477e-01   +9.144365729666436e-02   +7.088615412150645e-02   +1.284122038279450e-01   +1.116043939545503e-01   +6.184389227379714e-02   +8.035771879324848e-02; +1.003605278907988e-02   +2.079831214852609e-02   +1.189516460331442e-01   +9.052766677054170e-03   +2.531974479908173e-02   +9.389384736839254e-02   +9.962144452533402e-02   +7.304690572856354e-02   +6.938289027125072e-02   +1.307242110364484e-01   +8.711900105809524e-02   +1.225367151671441e-02   +5.118626110924113e-02   +2.636772992397863e-02   +1.031326093793901e-02   +1.350329507496650e-01; +5.719144850851835e-04   +1.174323016647424e-01   +6.282279282326657e-02   +1.420991597637067e-02   +5.334328457251639e-02   +1.164019216806085e-01   +9.710919047957070e-02   +5.854783139847018e-02   +6.325477727998490e-04   +2.304336941978364e-02   +9.362438122315195e-02   +2.002884092380847e-02   +1.147645214121561e-01   +5.887325183567619e-02   +8.732380921716014e-02   +6.906664683075682e-02; +1.097796206599195e-01   +1.241996710709629e-01   +1.933550850926134e-02   +9.559638540357111e-02   +4.959175326615386e-02   -6.764603098587557e-03   +9.198780763170951e-02   +3.886633973595023e-02   +1.163099692365338e-01   +2.259059685213794e-02   +1.228527067908175e-01   +2.194356736126830e-02   +5.025660681776700e-02   +1.426436628677491e-02   +7.642715199589355e-02   +1.457399738139090e-02; +6.628048402934783e-02   +2.903366347040862e-02   +1.886914008149387e-02   +3.550589330615124e-02   +2.343028279883928e-02   +5.085135939438911e-02   +4.116692801812500e-02   +6.914866397238781e-02   +1.202409674762239e-01   +2.077040689325122e-02   +1.020245631410147e-01   +1.380338459083101e-01   +1.352158427179784e-01   +6.482616534348890e-02   +7.225131773688877e-02   +4.282766715220191e-02; +3.992281982864996e-02   +3.008336283426975e-02   +3.873819695435698e-03   +2.053902659620285e-02   +9.265861750567110e-02   +7.087392303963877e-02   +6.879576874655077e-02   +8.369143094896742e-02   +2.840489381148086e-02   +5.815822286093125e-02   +1.181896997115436e-01   +1.297719679655792e-01   +7.170537659334107e-02   +6.165920989322432e-02   +1.951673269636821e-02   +9.880857735029984e-02; +4.462586139485018e-02   +8.306401885885639e-02   +3.729635802267206e-02   -2.359828988737306e-04   +2.085994059729091e-02   +9.195649862771269e-02   +1.077343849512125e-01   +1.168264725401855e-01   +4.341548638989783e-02   +1.789768062323463e-02   +9.964707233237052e-02   +5.356566381593893e-02   +1.174827277831019e-01   +1.303689662937393e-01   +7.951803840997632e-02   +1.192476808463993e-02; +6.075225704784265e-03   +5.666503460005941e-02   +2.461595351761810e-02   +7.469764121552783e-02   +5.036882081748550e-02   +1.092552760054189e-01   +4.075583597333075e-02   +3.231290617970162e-02   +1.243892895591337e-01   +1.056384165979831e-01   +3.096955240062342e-02   +8.272268967008320e-02   +1.013612595025247e-01   +2.607372658832505e-02   +9.899531774272527e-02   +2.858944990996734e-02; +1.193521893537814e-01   +1.333462220386432e-02   +4.510845298226400e-02   +5.255001461121143e-02   +7.661528922040964e-02   +9.080803268792455e-02   +5.791063961274344e-02   +1.355276746727681e-01   +4.795793028348929e-02   +5.084310045130628e-02   +7.619632124123095e-02   +6.617659849265514e-02   +2.965643334176092e-02   +1.292235460964811e-01   +1.143646533260966e-01   +4.451317416379563e-02; +2.222674497294582e-02   +1.220432317808674e-01   +7.283657815240495e-02   +1.246728056049165e-01   +1.311212846833122e-01   +9.018694264155747e-02   +7.132017071420911e-02   +2.126003857786542e-02   +9.651177901342708e-02   +6.659632166831440e-02   +4.585125116349181e-02   +1.094870723289127e-01   +9.635663992305481e-02   +6.693952174844657e-02   +1.075050764515950e-01   +3.086500636580291e-02; +9.182316823046628e-02   +1.032721830032308e-02   +7.666584754044023e-02   +1.638927972328940e-02   +7.470262648333473e-02   +7.593370025234684e-02   +7.981210950723298e-02   +3.213981597934788e-02   +1.025513502542786e-01   +1.137660397191553e-01   +2.923345581681054e-02   +1.053843437815965e-01   +1.309689698156698e-01   +8.430968640387559e-02   +4.874300410626196e-02   +1.343859430736882e-02; +3.481028569800321e-02   +3.735691361880071e-02   +3.722795017071794e-02   +1.251001143861680e-02   +3.176701927626507e-02   +1.165450934671460e-01   +1.298512388484165e-01   +9.725511376121143e-02   +6.339286690437235e-02   +8.266377318863619e-02   +1.342609675523171e-01   +1.009287511700905e-01   +8.732200233397049e-02   +1.137653027298251e-01   +8.770191824795204e-02   +1.008977000026947e-01; +6.103808570929792e-02   +2.792425524146890e-02   +6.086414903817911e-02   +1.130488010072125e-01   +7.871343333771878e-02   +7.171835612000947e-02   +1.647746666828975e-02   +4.763645215794812e-02   +1.826743781988362e-02   +7.248629727346997e-02   +3.710613644990225e-02   +5.981330263325967e-02   +4.637111501364221e-02   +3.119110243036735e-02   +1.737638173247467e-02   +3.619523927781938e-02; +5.754130080019895e-02   +6.362610706570761e-03   +2.353399275392833e-02   +1.259780375395221e-01   +1.314967815605739e-01   +1.118937989779006e-02   +2.581191479727541e-02   +1.146077467442037e-01   +1.091770451756943e-01   +1.910514117471039e-02   +3.775168964360279e-03   +8.718630573288844e-02   +8.703536296789738e-02   +6.838943556160201e-02   +5.445935897277532e-02   +6.332691866071778e-02];
L2I_L1I_iGABA_netcon = [+1.345293486308808e-01   +6.385689577027165e-02   +4.125122919712050e-02   +1.154159147959906e-01   +1.290972359250091e-01   +1.256027499419137e-01   +4.811801387515702e-02   +1.012320457603660e-01; +1.109450760337005e-01   +1.108779623787585e-01   +9.724000399144529e-02   +3.906310293017014e-02   +5.587394600875738e-02   +8.716865899789528e-02   +1.204910201714527e-01   +3.426107711439258e-02; +2.615810854258363e-02   +3.087608015649056e-02   +3.590164703864712e-02   +3.448111099171718e-03   +1.051396845565552e-01   +1.330527100148681e-01   +1.414792358249522e-02   +8.333257424370331e-02; +5.165438107198632e-02   +1.070560986432676e-01   +9.637376821908494e-02   +8.796891403980681e-02   +8.333283661236741e-02   +8.124399676308765e-02   +6.893963055904580e-02   +1.084790833514856e-01; +4.655523351267861e-02   +1.924462356149541e-02   +8.526149354728282e-02   +7.861242923126104e-02   +6.165059094134304e-02   +9.981502035241821e-02   +6.629445649822045e-02   +7.566204053477457e-02; +1.074462461229584e-01   +9.363672166554304e-02   +1.232442442431865e-01   +6.349221529802029e-02   +3.679077235381934e-02   +9.208661674782267e-02   +4.920051030269149e-03   +9.809248382461543e-02; +1.483555706535099e-02   +5.537425216504154e-02   +5.389627045467250e-02   +3.518315177580710e-02   +9.741154665643954e-02   +3.672054005763805e-02   +3.029064640406356e-02   +9.343314040121614e-02; +8.140217618541624e-02   +4.676675645726803e-02   +1.107561747485485e-01   +5.826997172582150e-02   +4.323447580082010e-02   +9.992368385234977e-02   +6.226748151825174e-02   +4.634253240373979e-02; +5.747515012489266e-02   +8.843258854020991e-02   +2.574546174303092e-02   +2.834745233981560e-02   +3.958768632111495e-02   +1.983488938363521e-02   +5.704698718672060e-02   +1.319563366323440e-01; +7.699558518192630e-02   +9.062078332461834e-02   +2.880748718771910e-02   +6.968291060379235e-02   +8.445423010945415e-03   +9.190750054448243e-02   +1.187930025080994e-01   +9.220717050633889e-02; +7.179533847890414e-02   +1.027841288658689e-01   +1.139961773225932e-01   +4.594155820896292e-02   +9.422417341145199e-02   +1.266897128058164e-01   +2.599621095666214e-02   +3.326365715211350e-02; +1.095533549977892e-01   +6.645751718252574e-02   +8.338332721853726e-02   +5.612002764636635e-02   +1.273978146464361e-01   +3.402420620913642e-02   +8.214423214959667e-02   +5.151672939097717e-02; +4.510510709433938e-02   +1.327404187927828e-01   +1.216354343145998e-01   +2.417439864040363e-02   +7.569801960071022e-02   +4.582332350801557e-02   +4.379748839392692e-02   +7.389295667327046e-02; +1.007727526825227e-01   +3.378201550516950e-02   +1.317173313312178e-01   +6.876623011535307e-02   +1.117999333413434e-01   +2.619204962235646e-02   +1.310032275394414e-01   +3.722726807769920e-02; +1.338178890788609e-01   +2.627798484007293e-02   +3.811890419714293e-02   +1.214478953448931e-01   +9.169765438992862e-02   +1.522801239361739e-02   +5.182249731152754e-02   +9.188834857438147e-02; +2.603601832577117e-02   +9.407182299218307e-02   +9.262731897347030e-02   +8.892754348795791e-02   +1.147913107569844e-01   +1.670458541409194e-02   +1.340148487745972e-01   +4.383209935207930e-02];
L1I_L2I_iGABA_netcon = [+8.088184582470652e-02   +8.968154227285977e-02   +3.489370945189302e-02   +1.160862759293695e-02   +7.294674081702363e-02   +4.735035431088218e-02   +1.288934810718568e-01   +9.348092050955502e-02   +5.312733035512254e-02   +1.048623938350778e-01   +2.231694137260808e-02   +3.831418738716144e-02   +1.391652200753732e-02   +1.334326492928187e-03   +2.760500798325531e-02   +1.075759815043584e-01; +1.089150512171031e-01   +8.616482869980378e-02   +5.723816544691489e-02   +6.552602717308018e-02   +1.278934728706897e-01   +6.471808764244223e-02   +8.555448803817363e-02   +1.275789089201717e-01   +6.403916323557485e-02   +1.307710953262841e-01   +8.705771702559761e-02   +5.003391416326382e-02   +6.984800623013027e-02   +9.933668791231948e-03   +1.413012767042942e-04   +1.216097215793950e-01; +1.188641930800497e-01   +7.537315422316904e-02   +2.559789628866116e-02   +1.081035456520857e-01   +4.389825262778511e-02   +1.145050923538061e-01   +9.968094270524544e-02   +9.390947499178025e-02   +5.178655016823047e-02   +4.896611510148020e-02   +8.906312722721850e-02   +5.868273911973667e-02   +4.738714080429241e-02   +2.026727373821423e-02   +7.818912641117308e-02   +1.758169509765688e-02; +5.445920259538022e-02   +4.782674987229132e-03   +8.060413721440766e-02   +1.148960256023918e-01   +1.551012959883875e-02   +1.682848484710451e-03   +5.107412451903021e-02   +4.232940181219372e-02   +1.037163224167369e-02   +9.011858830558300e-02   +7.521107958944007e-02   +6.399332921158390e-02   +3.396322023895127e-02   +6.524444676392523e-03   +1.071892236528248e-01   +7.411734567256563e-02; +1.269457024539258e-02   +1.139506592486471e-01   +1.049717918579876e-01   +8.930172355795213e-02   +8.117560585362472e-02   +6.775896218927291e-02   +8.177700559018840e-02   +1.147225727932284e-01   +7.806647808016755e-02   +6.864816458873546e-03   +4.360420461439819e-02   +1.769896775257603e-03   +3.516636898819285e-02   +1.146559286979279e-01   +2.492704074542844e-02   +6.784012309502394e-02; +8.623519588761193e-02   +9.732579475345615e-02   +1.607099046637086e-02   +1.224020295234073e-01   +8.045183985039889e-02   +1.256481955470258e-01   +9.432020953765537e-02   +1.109672213396165e-01   +7.433777809329804e-02   +7.577220910938905e-02   +1.374376457311166e-01   +1.068525194339103e-01   +2.253282821343097e-02   +1.201419273883422e-01   +9.576291166216210e-02   +1.252217242236524e-01; +1.037129113548873e-01   +1.410017567813215e-02   +1.201826931367315e-01   +1.368248767001616e-01   +5.495998590116143e-02   +1.326091407090440e-01   +6.756109262586815e-02   +6.801462287737219e-02   +3.798739248328206e-03   +8.028320100656788e-02   +4.458961601223239e-02   +4.611180355835191e-02   +1.030383760762993e-01   +5.341191261023425e-02   +1.138188115324220e-01   +7.981252630448780e-02; +9.457079473640663e-02   +8.446450119972785e-03   +1.196726893367123e-01   +9.455424168250090e-02   +9.715417366212876e-03   +1.063461780676267e-01   +8.024442471863752e-02   +1.055486298279007e-01   +4.816676240127621e-02   +1.196017394449769e-01   +3.388343703686759e-02   +6.617081676328769e-02   +6.582457593241993e-02   +5.626532306983339e-03   +1.208071743157231e-01   -1.522642114357017e-03];
L2E_L1E_iAMPA_netcon = [+1.118035053468899e-01   +3.709590682929140e-02   +1.704465982352702e-02   +1.339798917931902e-01   +7.102980223197561e-04   +6.158154404733843e-02   +8.850129575656469e-02   +1.103251445156272e-02; +1.284961167139406e-01   +1.173987726011692e-01   +7.732763163093663e-02   +5.484815083315979e-02   +6.771484749519509e-02   +2.491159164362776e-02   +1.268876054420113e-01   +5.694306784989556e-02; +1.189748587871641e-02   +2.159540885257361e-02   +4.051809459096783e-02   +2.179790047688862e-02   +8.325402218382093e-02   +1.110408092962055e-01   +4.665232100501524e-02   +4.530113835422384e-02; +3.699689172398927e-02   +1.010345233589401e-01   +2.293396393972634e-02   +8.977616900597138e-02   +1.053405873319085e-01   +4.134458540745195e-02   +1.199403447803287e-01   +1.169364140192476e-01; +2.374411279079568e-02   +1.366220024870072e-01   +1.916506060738217e-02   +6.829246378008135e-03   +1.242104081736237e-01   +1.286759183290071e-01   +9.117580386108314e-02   +5.415387042078493e-02; +9.477720147971970e-02   +6.932141837310903e-02   +1.228251975410631e-01   +1.027287190516527e-01   +9.008911605555803e-02   +3.311528076242933e-02   +1.078833339450868e-01   +9.050217780484580e-02; +1.062124664584324e-02   +4.184021022509007e-02   +3.076975558149507e-02   +5.732724685862686e-02   +1.232050732595590e-01   +6.374452525753821e-02   +2.100591492498323e-02   +4.546855456848468e-02; +6.300781545651419e-03   +1.944544645492465e-02   +7.116275893058885e-02   +9.218574061276308e-02   +4.719101605697191e-02   +1.251795994996903e-01   +1.256159833336776e-01   +1.281772213183999e-01; +4.831553890079521e-02   +1.194471448561818e-01   +3.330758717038874e-03   +3.737587238075096e-02   +2.236288643313068e-02   +1.339005800709520e-01   +8.023565212787837e-02   +8.150009945053162e-03; +3.694207751982373e-02   +3.887849951852938e-02   +1.135657050916235e-01   +5.472766999888054e-02   +1.126252532835992e-01   +1.085721893603251e-02   +1.720155501107562e-02   +1.278334073660434e-01; +7.664119554750559e-02   +5.976549524215467e-02   +2.192346748376939e-02   +8.120743203081440e-02   +5.338788736388700e-02   +5.348857165029967e-02   +7.954870592352120e-02   +1.171813213518521e-01; +3.278319396049780e-02   +6.241372352958531e-02   +1.092962663504949e-01   +9.802614752818431e-02   +8.956912336858720e-02   +2.436911194244373e-02   +1.357576264156652e-01   +3.505556445456878e-02; +7.469356960335304e-02   +1.168050589554569e-01   +3.308165373531629e-02   +1.184377041321937e-02   +1.297185500531494e-01   +9.516377926028685e-02   +5.599277009272983e-02   +1.123902030463368e-01; +5.294016722329026e-02   +5.080820547064549e-03   +1.494814280087714e-02   +9.354349671119447e-02   +7.510257087691225e-03   +3.804124674551016e-02   +1.026822615996906e-02   +1.044371649160617e-01; +3.816915086121148e-02   +2.320432036706044e-02   +1.156677236432670e-02   +1.076024544252433e-01   +1.232159808066970e-02   +9.409664561694491e-03   +5.686252141407375e-02   +2.784482990735968e-02; +1.616256443669770e-02   +6.001927940073077e-02   +1.105335201285182e-02   +7.139266287896899e-02   +3.040809138774309e-02   +7.423528358730769e-02   +1.424964048193838e-02   +1.116499878138437e-01];
L1E_L2E_iAMPA_netcon = [+4.831170434558964e-02   +2.450112402327076e-02   +1.302881146432201e-01   +1.260109673840050e-01   +3.849451255216936e-02   +1.311737889034928e-01   +6.521550113067352e-02   +1.287810014260941e-01   +2.133288418583248e-02   +8.665364030433483e-02   +8.142098619306369e-02   +9.962809724852797e-02   +5.144856471024035e-02   +8.968759607402942e-02   +7.143238650743042e-02   +6.551183565397667e-02; +5.003378115043989e-02   +7.299841933490817e-02   +2.538962620101864e-02   +9.170874546421511e-03   +9.977727004343719e-03   +8.961107143916294e-02   +6.532013851655682e-03   +4.277088674292438e-02   +3.362531707069732e-02   +4.431117815110969e-02   +3.118947322520720e-02   +1.305573829589086e-01   +1.816740078016778e-02   +3.169728623043632e-02   +7.865719985850439e-02   +3.667799816994580e-02; +4.766323424377338e-02   +7.892979536526144e-02   +1.205742013858732e-01   +1.215277819521955e-01   +1.222189514945192e-01   +1.812487442111087e-02   +3.905773407405623e-02   +8.023592699896363e-03   +6.023032197538200e-02   +8.252074880608522e-02   +4.446072706293846e-02   +9.671929811814015e-03   +9.353957112371333e-02   +8.105454411085415e-02   +1.132358876466959e-01   +1.056371959392826e-02; +9.917675696904682e-02   +3.210284615762616e-03   +2.537982248394920e-02   +2.842475725223085e-02   +9.369294692819537e-02   +4.386408060796661e-02   +1.283932773447344e-01   +1.194418228783261e-01   +1.030220316143486e-01   +1.027010710031214e-01   +6.252761814531760e-02   +7.548493258964310e-02   +1.273808605161608e-01   +4.441000396058658e-02   +1.196541025627961e-01   +1.278619142561452e-01; +2.347410758107722e-02   +1.226336058098606e-01   +1.165799332735957e-01   +7.147999972614264e-03   +2.672279892740983e-02   +1.068015727242123e-01   +1.179532937150431e-01   +1.762985619490758e-02   +7.900335604112690e-02   +5.680189859795109e-02   +7.657343422327460e-02   +1.031557351020242e-01   +3.291190832567595e-02   +7.607195470806898e-02   +1.363921356319320e-01   +5.052775169344368e-03; +9.308719025990087e-03   +1.202374460650328e-01   +4.112138220982044e-02   +1.116153911975561e-01   +1.361926170855010e-01   +1.168317996189641e-01   +6.910731675174712e-02   +1.219186454617546e-01   +4.566865850591020e-02   +5.761864658092832e-02   +1.174844102361364e-01   +1.237224687025420e-01   +1.097050361132500e-01   +8.093671958310952e-02   +2.439454487325984e-02   +7.734778071246701e-02; +4.282028124574281e-02   +2.543766127122352e-02   +7.770941835373554e-02   +3.626993617720882e-03   +5.169993246177056e-02   +6.952843914478124e-02   +1.025029554039308e-01   +7.895465443411058e-02   +7.595520254996829e-02   +1.102067793758952e-01   +8.917586203500646e-02   +1.979720778962853e-02   +5.408849453120078e-02   +7.868384437031656e-02   +3.038903349698295e-02   +4.209955247267073e-02; +9.866221404927794e-03   +7.259908310764618e-02   +6.309544535563646e-02   +5.315297773480375e-02   +9.983621491517669e-02   +1.310382192042504e-01   +1.318213762549296e-01   +8.866240664993061e-02   +1.197411665311976e-01   +5.617375738977022e-02   +4.691834600546932e-02   +1.291362076591908e-01   +9.199617275141456e-02   +1.224763620837316e-01   +4.212459048382047e-02   +1.249056478718649e-02];
L2I_L2E_iAMPA_netcon = [+8.936164036502181e-02   +3.646455581424366e-02   +1.170379197585965e-01   +6.084333040762749e-02   +1.030947551222097e-01   +6.284541510336234e-03   +4.406649779043012e-03   +1.229933417870684e-01; +2.447271694508820e-02   +1.871649839034775e-02   +2.377905423489930e-02   +1.101793086858535e-01   +1.100713653894440e-01   +4.810603610251654e-02   +9.578163905887999e-02   +6.666917355954217e-02; +1.123631459212882e-01   +1.038901152483719e-01   +1.135613905359177e-01   +9.788025771874877e-02   +7.206996842474370e-02   +7.178270126645316e-02   +6.624585716191850e-02   +9.880975058594126e-02; +5.023536970869449e-02   +2.277538000983440e-02   +1.221426637551996e-01   +6.196576558726149e-02   +1.331608074122360e-01   +2.471465723809427e-02   +6.258957404848331e-02   +1.125113749051858e-01; +9.038001686317346e-02   +1.135669842992140e-01   +8.395498319771903e-02   +8.365011159368896e-02   +1.233683094746231e-01   +1.013661728006298e-01   +6.013016684450215e-02   +9.903675721422979e-02; +8.278174244689103e-02   +5.980395851899866e-03   +1.149106874839061e-01   +1.017518189813978e-01   +7.622386385629802e-02   +2.864660433109922e-02   +1.484942409758866e-02   +9.832633266037316e-02; +1.320393486371845e-01   +6.645787179776218e-02   +2.247821875643491e-02   +3.353253393346944e-03   +1.898548446385851e-02   +3.077426935210306e-02   +2.686526543315433e-02   +2.854276534928798e-02; +1.274732838260333e-01   +4.135990709957650e-02   +7.708145303747863e-02   +6.253348754084492e-02   +1.143035176644721e-01   +3.587758848626690e-02   +1.672144610661900e-02   +6.580489079840926e-03];
L2E_L2I_iGABA_netcon = [+1.237794941643097e-01   +2.783074256197477e-02   +2.794864203885785e-02   +2.130530144914448e-02   +8.755167853734702e-02   +4.875846200102195e-02   +1.120584018615692e-01   +1.290484983738542e-01; +3.184354279245070e-02   +5.327303125515515e-02   +1.970803211654328e-02   +1.437904846796209e-03   +1.370762505891805e-01   +9.387240263895311e-02   +1.031439293722526e-01   +1.368066744944253e-02; +8.691150687292312e-02   +5.037801901050545e-02   +7.348466385605162e-02   +9.725090959926474e-03   +5.301990091128664e-02   +1.136413684635381e-02   +1.261679688109097e-01   +1.150597396424370e-01; +1.119683954815323e-01   +6.684204391464528e-03   +3.572408978805660e-02   +9.647244571697847e-02   +1.199008653977198e-01   +8.910379466712182e-02   +5.947251463768766e-02   +8.691597095119820e-02; +1.939089562827725e-02   +1.212401233484814e-01   +5.073445464143088e-03   +1.074646189326800e-01   +4.410596388904140e-02   +4.823058811598491e-02   +5.897611473342584e-03   +3.443880558839497e-02; +1.035549859407244e-01   +4.670337746561012e-03   +7.283842850321388e-02   +1.057666899340485e-01   +1.167382210339541e-01   +3.351367186400048e-02   +1.235065782107678e-01   +9.739134253004714e-02; +2.177552494963134e-02   +1.343485039577358e-01   +3.648614758680476e-02   +3.033986178526682e-03   +1.011819704065910e-01   +7.036626766960519e-02   +8.021766137618262e-02   +8.262887216424858e-02; +1.150026933242256e-01   +4.470354063240681e-02   +6.567756971997514e-02   +3.284732963565698e-02   +6.363729688895171e-02   +1.041885519899208e-01   +1.278721784778986e-01   +8.394654840663590e-02];
L3E_L2E_iAMPA_netcon = [+4.380351271435805e-02   +9.161350421686194e-02   +1.539652655366125e-02   +1.141302738171317e-02   -9.668802476138301e-04   +1.337898715970042e-01   +5.608417920619736e-02   +1.186222560401470e-01   +1.511073623706459e-02   +3.458412362005804e-02   +3.878970426860860e-02   +1.105257600850165e-02; +3.791559790489083e-02   +1.238349686615899e-01   +3.886475484547527e-02   +4.751060488025276e-02   +6.764145719854163e-02   +7.090014431813652e-02   +1.199859568634115e-01   +1.317054092511584e-01   +7.886705594261514e-02   +1.270504393653164e-01   +4.194015859000134e-02   +3.490090845470586e-02; +1.040319264999825e-02   +1.061548042992357e-01   +1.467547342653426e-02   +1.009786614729261e-01   +5.079621567793122e-04   +2.561239367818248e-03   +7.072241254274221e-02   +1.324790909926697e-01   +8.327342333535981e-02   +8.140801977389880e-02   +3.323192085832877e-02   +9.078840782492210e-02; +9.816677764012379e-03   +2.353296065794080e-02   +1.113983851031536e-01   +3.453150406180507e-02   +3.732227892688148e-02   -4.044083537581033e-03   +4.548428565879983e-02   +1.261014090606635e-02   +2.532723321948818e-02   +4.704914249504916e-02   +2.466094033623023e-02   +4.166496890181057e-02; +1.222389845871485e-01   +5.075560701938663e-02   +4.604615905531898e-02   +1.285322666587405e-01   +9.475848146625124e-02   +5.101450421631543e-02   +1.333416176218630e-01   +2.516175139499805e-02   +1.134730755320228e-01   +6.441842932298966e-02   +9.496419362694566e-02   +4.768573260714770e-02; +1.183368195521231e-01   +7.859475967075812e-02   +1.300751482773330e-02   +6.106988688703759e-02   +8.224695536049596e-02   +1.340128873556899e-01   +1.258267669600493e-01   +4.501124714169000e-02   +6.810905659659429e-02   -3.744056693099376e-03   +9.033754742512937e-02   +3.238491927899725e-02; +8.696872595570695e-02   +6.649403532095520e-02   +8.834835479156780e-02   +3.406397578199639e-02   +4.454603834143404e-03   +5.027583351207933e-02   +1.607927925708192e-03   +4.642047035383771e-02   +4.521321868394015e-02   +1.678253724783652e-02   +1.262383562854726e-03   +6.292801755050621e-02; +1.139879707774194e-01   +1.483376358030750e-02   -5.298966573991762e-03   +3.603065171465561e-02   +7.176782255908222e-02   +1.601279411030459e-02   +4.568963235573777e-03   +5.994595261964985e-02   +6.706145254371389e-02   +1.132408340923036e-01   +1.460444432333310e-02   +8.025685378449042e-02];
L3I_L2I_iGABA_netcon = [+1.300444544940160e-01   +6.792481601291873e-02   +8.502151975717473e-02   +4.093445627916477e-02   +1.280770147171705e-01   +5.843020686424864e-02   +8.568009367005894e-03   +4.484447281626742e-03   +1.171496790861400e-01   +6.376323706212532e-02   +1.211362262959461e-02   +1.027063937895000e-01; +1.230252837254484e-01   +1.299840285102270e-01   +1.170926401450647e-01   +2.111522997781243e-02   +6.443605502980167e-02   +1.105277796268947e-01   +7.897216647977937e-03   +2.644284533485344e-02   +6.411108077859191e-02   +9.431975910689588e-02   +1.543200367921497e-02   +8.811345798562867e-02; +1.146139498095132e-02   +1.149023651532305e-01   +1.259990392670153e-01   +4.429104058704152e-03   +9.293151053950406e-02   +2.348999548290197e-03   +8.497417478480922e-02   +1.282379926737801e-01   +9.367923695510399e-02   +1.741707502022950e-03   +8.968922739722880e-02   +1.871050834643002e-02; +1.310532315912888e-01   +2.266975016461387e-03   +6.597425922322920e-03   +8.863151410961484e-02   +1.152272792513661e-01   +7.470254394789506e-02   +2.297078221918138e-03   +7.205402801953084e-03   +1.201656174336985e-01   +1.089254151664523e-01   +1.348871537206685e-01   +6.836409460253312e-02; +2.666927066090639e-02   +1.320576625141100e-01   +5.568436032062486e-02   +5.548762935793802e-02   +7.669810716354723e-02   +1.242787697441670e-01   +5.116194773915236e-02   +1.963409661990048e-02   +1.318824644480406e-01   +6.890531510949362e-02   +2.870096664284765e-02   +2.470304473011789e-02; +3.766907314527986e-03   +9.068415348595786e-02   +2.620257894768126e-02   -2.291796850663993e-03   +2.077374743607715e-02   +8.867273912724172e-02   +9.589956542881478e-02   +3.109716962147856e-02   +5.804215035898989e-03   +1.012871940568568e-01   +1.177467815846667e-01   +5.969285869241333e-03; +8.370983080165893e-02   +1.215891187811455e-01   +7.625724387236915e-02   +9.025775169470486e-02   +6.020233358175921e-02   +3.606157850483593e-02   +9.220778950948041e-02   +6.293954243698976e-03   +1.172847525740857e-01   +4.940801807999767e-02   +6.703099536646910e-02   +9.850033796114201e-02; +6.810092497642947e-02   +2.430479343202365e-02   +4.666177182948226e-02   +8.287599618176134e-02   +4.773766708947671e-02   +1.482350527013421e-02   +3.497056498518929e-02   +3.209940337886659e-02   +7.815786064058342e-02   +1.289323744320718e-01   +3.808684442994752e-02   +3.736498559449202e-02];
L2E_L3E_iAMPA_netcon = [+8.831691449753584e-02   +9.058125626042725e-02   +3.256605278308097e-02   +1.103732452425975e-01   +1.233125126723549e-02   +6.906584397328258e-02   +9.466543561631074e-02   +1.293112654427225e-01; +7.554923280446681e-02   +9.834069645530212e-02   +1.033269572859261e-01   +1.057669841251932e-01   +5.637733132043962e-03   +7.439601749941287e-02   +1.121216573503210e-01   +9.102764276684265e-02; +1.078134544374853e-01   +1.196324623722919e-01   +1.145952297535104e-01   +1.235737297495564e-01   +7.595917173248178e-02   +8.837003471391072e-02   +1.195681012598756e-01   +7.865445264552551e-02; +4.900787422229124e-02   +1.310107562134236e-01   +1.129482294179125e-01   +8.448459316704691e-02   +6.461567865086212e-02   +7.301399462194932e-02   +3.459180792703223e-02   +2.050618718948661e-02; +1.496836848036508e-02   +7.059329909348143e-02   +3.758260504587054e-02   +9.250365710340320e-03   +2.151642063499315e-02   +7.045993836159190e-02   +1.183543759079360e-01   +1.037787956318851e-01; +6.360817907112161e-02   +1.349116357492953e-01   +1.218900257684535e-01   +7.486331398679977e-02   +7.099309072341631e-02   +1.303534085328291e-01   +1.007101679883498e-01   +1.301218606269356e-01; +6.737798372258465e-02   +1.108366583965749e-02   +6.773785088614302e-02   +4.290733264422661e-03   +4.826811076518083e-02   +1.097495429906943e-01   +4.438728165210374e-02   +1.031993071059529e-01; +1.253378854416985e-01   +9.397362045364274e-02   +6.388101894042551e-02   +1.039287414037326e-01   +4.825462959568919e-02   +1.021753353078735e-01   +6.789538310742110e-02   +5.168909507415378e-02; +6.621699190472194e-02   +7.249123416186092e-02   +1.225499660439311e-01   +8.222723383062566e-02   +8.001746493844519e-02   +4.739803072779090e-02   +7.754567728242187e-02   +9.173906714897422e-02; +3.384574838048231e-02   +2.037903482493681e-02   +1.053664128010509e-01   +1.161369690250278e-01   +1.253281059819272e-01   -2.842893021235744e-04   +1.763429317304330e-02   +8.535150380391901e-02; +8.216513989265500e-02   +4.055196219947214e-02   +1.007342379796339e-01   +1.087332115090388e-01   +1.251743476026356e-01   +1.351965861011492e-01   +3.360396638663916e-02   +4.733793478136700e-02; +1.513228965546664e-02   +7.777066578109797e-02   +5.918383082690123e-02   +1.222916656708339e-01   +6.260962912375796e-02   +2.920270887397481e-02   +8.383708858998194e-02   +1.161143579218968e-01];
L2I_L3I_iGABA_netcon = [+1.264442843238490e-01   +5.698123105481995e-02   +3.669636297985086e-02   +9.252485388721539e-02   +1.016487676202945e-01   +1.117996235903578e-01   +4.296532043207686e-03   +6.615410052864795e-02; +7.435527932152590e-02   +6.260980120501325e-02   +9.455642953249431e-02   +2.299216155346987e-02   +1.199999126104355e-01   +1.147102119582889e-01   +6.047214938353370e-02   +3.761082328827594e-02; +1.052132079691936e-01   +9.959104035399846e-02   +1.289801948858899e-01   +7.942744750211299e-02   +4.710877868568869e-02   +8.430128676660714e-02   +5.900757112262633e-02   +1.783447235508962e-02; +2.702219402572621e-02   +1.104277205582905e-01   +2.582588145670809e-02   +6.473316994816819e-02   +8.260088979875154e-03   +4.550695686074765e-02   +5.694106047359422e-02   +1.361284702022278e-01; +4.239230559652614e-02   +5.176337987694170e-02   +6.889574734354488e-02   +6.201872728606564e-02   +5.008307495735487e-02   +8.606529193255792e-02   +1.200941411805849e-02   +2.144324424816007e-02; +1.514562770984816e-03   +3.451079852573798e-02   +5.272462813167915e-02   +2.077600587723501e-02   +4.561555846538993e-02   +5.185810069620370e-02   +7.264260058594844e-02   +9.810162272731271e-02; +4.609583528222101e-02   +6.435216109175355e-02   +1.303703265500214e-01   +8.888187012230518e-02   +9.995375211622960e-02   +4.180294698874691e-02   +4.486872493050686e-02   +4.512102364720084e-02; +3.479502226972405e-03   +1.376121708565512e-01   +4.317788459169640e-02   +1.211922303149198e-01   -2.636776268984102e-03   +1.033309823693045e-01   +7.395450934844941e-02   +1.080273405742905e-01; +1.157985467354078e-01   +4.173855529180907e-02   +1.155942331382045e-01   +9.425827153628878e-03   +6.952359015084797e-02   +4.055183836755109e-02   +5.824095437499514e-02   +5.755453087869817e-02; +9.984828248852008e-02   +7.176605249557932e-02   +3.040327722015693e-02   +6.975395989607605e-02   +8.139421809200205e-02   +4.741379339195904e-02   +2.522626363218472e-02   +4.388772363372438e-02; +9.858115127251295e-02   +1.292740151564828e-01   +7.628159740434420e-02   +8.968733110904518e-02   +4.440506697880162e-02   +5.310834204046352e-02   +1.204370671227593e-01   +1.772718124316973e-02; +1.015857970647904e-01   -6.632655745300516e-04   +4.877568918804032e-02   +2.083326897663141e-02   +1.970767170774644e-02   +1.328560904835663e-01   +6.821700119294731e-02   +7.454637587836802e-02];
L3I_L3E_iAMPA_netcon = [+6.214763546090606e-02   +1.330966950970773e-01   +3.266205479276954e-02   +8.297107377437019e-02   +1.017492625970950e-01   +4.441623031850340e-02   +4.131539507955496e-02   +3.443935799782206e-02   +4.605312888308932e-02   +3.994749130165835e-02   +3.492655232069001e-02   +7.417652691919581e-03; +5.189722446806405e-02   +1.146675056594884e-01   +3.085557662269925e-02   +1.608319897543178e-02   +1.381069609267649e-02   +7.751817189300403e-02   +7.273016839044433e-02   +7.338613011650205e-02   +2.371331477508378e-02   +6.229823951557979e-02   +9.676664858742061e-02   +7.353117559055652e-02; +4.232148362154688e-03   +7.808969795667006e-02   +6.533606691905136e-02   +8.023537657580908e-02   +6.980885004070871e-02   +5.773774109086241e-02   +7.009062988391611e-02   +6.406349503601043e-02   +5.173268619153559e-02   +7.561071057650832e-02   +5.969299864773654e-02   +7.141575520032743e-02; +5.286393008748362e-02   +9.852525463038310e-02   +8.869735074844516e-02   +6.253624162391033e-02   +5.773836684447495e-02   +1.204431569426442e-01   +1.026816420496472e-01   +1.942864984735984e-02   +1.276048640490564e-01   +1.193625456838957e-01   +2.411029977321001e-02   +9.983940925623429e-02; +1.621252517696760e-02   +4.959826252457353e-02   +6.436630722239297e-03   +1.113600461421784e-01   +1.027186972859030e-01   +7.612401149357562e-02   +1.301410669223371e-01   +6.332648530661377e-03   +1.277893036836350e-01   +7.681966612815254e-02   +4.688392555214101e-02   +1.542236399562878e-02; +4.940308647371338e-02   +8.274040313679690e-02   +1.121592522246234e-01   +5.636504835900575e-02   +1.303856578864290e-01   +1.576237878885222e-03   +1.166974389688060e-01   +3.955521610117340e-02   +9.029729190201159e-02   +4.294247068162998e-03   +4.651506284976943e-02   +2.289623833069025e-02; +1.065599473516739e-01   +5.199021733526740e-02   +5.311239028295974e-02   +3.713201759452108e-02   +9.133111801466332e-02   +2.356279756011162e-02   +7.358565566375085e-02   +1.233548473536123e-01   +1.090878594588081e-01   +1.300218923154193e-01   +7.354166457905667e-02   +9.529669423511827e-02; +9.889156659827343e-02   +2.493629473518148e-02   +9.794079603021592e-02   +8.572714702086431e-02   +1.374046556774396e-01   +7.816310748670754e-02   +1.065914540281912e-02   +6.707775552422512e-02   +6.285017460378944e-02   +4.253572866069331e-02   +2.879735148951210e-02   +1.266355556589109e-01; +1.497656242516093e-02   +1.160503186660552e-01   +9.794013032554533e-02   +1.062975527692348e-01   +5.084479212437306e-02   +1.023734684217687e-01   +2.105863730525909e-02   +1.035262527298639e-01   +1.126055796241713e-01   +6.116626186212584e-02   +2.929650901617476e-02   +2.521882521097755e-02; +1.212283019424160e-01   +1.129457561820849e-01   +5.823690704959827e-02   +2.666850062123050e-02   +7.567251445738560e-02   +1.061735458403819e-01   +7.302515970529090e-02   +1.197589254619580e-01   +9.552771971743448e-02   +4.988732662018149e-02   +1.169003488318651e-01   +2.994864278033829e-02; +5.681386641511846e-02   +4.745534052817969e-02   +1.358080730793140e-01   +1.268403754875355e-01   +3.621773358277993e-03   +8.098384534738141e-02   +8.232090636572603e-03   +3.216222513255521e-02   +9.337984382526102e-03   +1.299769366997006e-01   +1.010159592972611e-01   +5.430267532679449e-02; +9.529427273883432e-03   +2.303964935416016e-02   +6.427011003122882e-03   +5.939190220722488e-02   +6.263736557071381e-02   +3.368628938765674e-02   +1.078842947411803e-01   +2.607141095582377e-02   +4.293244146484813e-02   +3.325925583075692e-02   +1.054709775727577e-01   +4.139799827927405e-02];
L3E_L3I_iGABA_netcon = [+2.272662092630881e-02   +5.986444133466252e-02   +4.391773419710956e-02   +1.244279495575921e-01   +1.084973996718246e-01   +7.259983850040394e-02   +4.906881011049420e-02   +1.045204590811827e-01   +8.148533986159549e-02   +9.809087313180324e-02   +8.269869392056269e-02   +3.977809020743324e-02; +1.078510623713324e-01   +8.581839602446696e-02   +4.252978863754988e-02   +4.652127359313462e-03   +5.047730058330407e-02   +1.005479572095248e-01   +9.144213328425151e-02   +1.323164289107126e-01   +1.119626740923621e-01   +5.733385979342230e-02   +2.168374681075504e-02   -1.440937845948654e-04; +8.122366805581120e-02   +1.325346727547508e-01   +1.296215055330594e-01   +1.094082941066829e-01   +5.177553487029328e-03   +1.021104177775600e-01   +8.273449457548757e-02   +9.477843169594245e-02   +5.610107161918208e-02   +5.642975620916181e-02   +3.316265563241728e-02   +1.902600120451156e-02; +5.981345890747174e-02   +7.242197754533995e-05   +2.535323384527102e-02   +9.594131484499126e-02   +9.458913623696466e-02   +3.998579409893030e-02   +5.727088432831696e-02   +4.994538985770370e-02   +1.341022536252555e-01   +6.410693379639844e-02   +5.079044475276141e-03   +8.621843126236468e-02; +5.768510143396909e-02   +5.878857138067718e-02   +1.400348453179938e-01   +2.985405636050108e-02   +6.835526762520898e-02   +1.039054687622584e-01   +1.338954965911012e-01   +1.307721898036533e-01   +3.683945265494289e-02   +8.182910166987772e-02   +1.164857485269451e-01   +3.344743315118939e-03; +8.864093498388247e-02   +6.507627184984201e-02   +1.149802835534810e-01   +7.809375744337201e-03   +6.322054805585179e-03   +1.333901682650565e-01   +9.393324042351143e-03   +3.614519319089835e-03   +1.072088860793737e-01   +7.992286934821818e-02   +3.106735819279451e-02   +2.905969948403877e-02; +7.413186010060384e-02   +4.956145272917478e-02   +6.874474414138844e-02   +7.521409426106478e-02   +9.087112099204925e-02   +6.628251183682314e-02   +4.462672051613589e-02   +1.191595948527102e-03   +4.921996439094471e-02   +2.111015291218242e-02   +4.101282942411260e-02   +9.479939611269732e-02; +3.911282550392191e-02   +1.858515931444830e-02   +1.724307054053451e-02   +1.259347164378115e-01   +6.201984939613878e-02   +1.058914629287605e-01   +6.836901488170442e-02   +1.065974997591909e-01   +1.062850648866147e-01   +1.140763647365200e-01   +2.244891367592096e-02   +8.227307094315561e-02; +3.540107518237517e-02   +2.201747269063714e-02   +1.073512215777731e-01   +4.196856925044803e-03   +1.302149469744872e-01   +1.235653259304431e-01   +2.250256657627464e-02   +1.033427479619674e-01   +2.756432684679917e-02   +4.854484545569525e-02   +6.012322640110524e-02   +7.789682663891381e-02; +1.073871045206615e-01   +4.440810726275407e-02   +1.148111500517405e-01   +4.507942719783477e-02   +5.432663189822980e-02   +1.294106861988846e-01   +1.004517351480597e-01   +8.004129031528688e-02   +1.254565853931034e-01   +1.294964986787095e-01   +2.232318287670563e-02   +5.002177128170070e-03; +7.381508826665205e-02   +1.705583833747665e-02   +2.401775391663047e-02   +2.962689032837207e-02   +1.019298254711396e-01   +7.253280301163961e-02   +1.222611047262352e-01   +8.611076871906286e-02   +7.681894307879937e-02   +2.710464555512662e-02   +1.306655966574057e-02   +1.062879737291625e-01; +8.832598772895534e-02   +7.119378506086449e-02   +1.322670843568190e-01   +9.304775954020078e-02   +4.947647163179841e-03   +6.316132979301950e-02   +1.297249683235598e-01   +7.914280873619763e-03   +1.001839580189354e-01   +5.219612092674008e-02   +6.744507036522607e-02   +5.369812966353565e-02];
L2E_Input1_iAMPA_netcon = [+1.326831255007999e-01   +1.339710800560502e-01   +1.359025343343317e-01   +1.346779574773188e-01   +1.363953454804030e-01   +1.436047723788605e-01   +1.398891135099206e-01   +1.352220805015124e-01];
L2I_Input2_iAMPA_netcon = [+1.372759184665095e-01   +1.422463697891666e-01   +1.351789151784459e-01   +1.332240234621639e-01   +1.329948858453508e-01   +1.332704798627364e-01   +1.353808777520504e-01   +1.332802792485847e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last =  11.21 * ones(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.0*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.2*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.0*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.2*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.0*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.0*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.2*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.0*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.2*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.0*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
