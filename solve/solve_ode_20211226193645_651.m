function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+6.495841312084947e-01   +7.624741041553511e-01   -9.887049678323762e-02   +1.410596158656650e-01   +1.685926125076695e-01   +1.000274268572052e-01   +1.221888075058998e-01   +3.198166368455940e-01   +3.494741252162409e-02   -8.128201899930032e-02   +2.551086857502844e-01   +5.675232280344439e-02   -1.562207165368360e-01   +7.280099549333863e-01   -1.840544936970862e-01   -1.411297521060667e-01; -7.528836863542317e-02   +3.816512246869880e-01   -1.777933395754025e-01   +2.615110541418682e-01   +3.295654070645013e-01   +4.471360658812957e-02   +5.845073272281722e-01   +2.289251969548825e-01   +7.624957683233478e-01   -9.927638333048733e-02   +3.384589414414805e-01   +6.627641954872243e-01   -2.357941373762125e-01   +3.955461542254652e-01   +2.638985704725630e-01   +5.328851197871362e-01; -1.280295192923031e-02   +2.152701180308619e-01   -3.552327020378580e-01   -4.927316621168983e-02   +2.264324942483344e-01   +2.319887140287877e-01   -2.698287944491833e-01   -5.339898480721839e-02   +5.521043571112587e-01   +2.782037389730310e-01   +4.443862637707986e-01   -2.319555779339356e-01   +4.307770983952887e-01   +6.635251195257635e-02   +6.656485641374007e-01   +6.408275539580777e-01; +3.032186053502502e-01   +3.624251114031725e-01   +1.741200855216149e-01   +1.874353345171831e-01   +2.460314669742006e-01   +6.977489876445116e-02   -3.598850056775195e-01   +1.327363643981790e-01   +2.600952145645697e-01   +3.705940874430243e-01   -3.273340291639037e-01   -5.565719519590614e-01   +1.439766965957726e-01   +3.097136089213237e-02   +1.406907775588600e-01   -3.350941332038399e-02; +2.171616878529454e-01   -1.600556319823117e-01   +2.961123725706449e-03   -9.863248669335452e-02   +2.478147087635668e-01   -1.007732006529901e-01   +8.574714358188923e-02   -5.237351871839373e-03   +6.830409450357204e-01   +4.894561123103932e-01   -8.293337376308914e-02   +2.912430849478065e-01   +4.206609016355861e-01   +2.457901063142278e-01   +6.691730487423415e-01   +1.065322786656929e-01; +2.981865382350060e-01   +2.319936519168447e-01   +3.040264219686852e-01   -1.205064691392451e-01   -1.123490561621018e-01   +1.755534203476429e-01   +4.111582473136882e-01   -2.160351383913417e-01   +1.752855458973137e-01   -4.421122826942537e-01   +3.122256793767377e-01   +1.179618561600677e-01   +1.587058589430480e-01   -2.033323229179657e-01   -4.316203096699459e-02   +7.800146080702616e-02; +4.158019649236239e-01   +2.262230323186473e-01   +4.145910646699522e-01   +3.646732972270662e-01   +2.613518440088584e-01   -3.124721221107865e-02   -3.304813649334722e-01   -3.050828622146397e-01   +2.602651025537235e-01   +6.316804337498900e-01   -4.172471857349399e-01   -6.756285218432118e-02   +3.888828569811503e-01   +4.484711260657926e-01   +2.058256161197677e-01   +1.897639582364169e-02; +4.457571423829415e-01   +9.040920636386524e-02   -8.135766058013072e-02   +4.397210560060679e-01   +6.369098095162655e-01   +3.523098269774028e-01   -1.508534808070555e-01   +8.053773813869474e-01   +5.293667437952499e-01   -2.135960773333483e-01   +5.629646554112157e-01   -1.287938890973909e-01   +3.394408275969187e-01   +2.531063117616597e-01   +1.960601550729924e-01   +3.314422566407840e-01; +3.858055527114778e-01   +4.587026894499425e-01   +3.768168688652307e-01   +3.608162000519102e-01   +3.038238414750351e-01   +5.234043437240254e-01   -2.615722628352432e-01   +3.723174727107614e-01   +4.935605017094842e-01   +5.438368121943269e-01   +9.328548822239122e-02   +3.935340044877888e-01   -1.853259454586924e-01   +3.722005227464917e-01   +8.428050958788598e-02   +4.629317421476821e-01; +6.577215330754450e-02   +2.817477495783722e-01   +1.090401554893784e-01   +3.540328518348386e-01   +6.174855218052707e-01   +3.561673248910381e-01   +5.378790765916115e-01   -1.677340152978130e-01   +3.398698626743490e-01   +3.948207704928439e-01   +3.797113164088944e-01   +3.031283256004949e-01   +5.586989008162517e-01   +3.510779280952165e-01   +1.117152719568318e-01   -2.649081094435135e-02; +1.288802194033887e-01   +3.025440711146308e-01   +5.311751435965577e-01   -4.710074786041329e-02   +2.354250962261911e-01   -2.415264355483591e-01   +6.461377115532535e-02   -3.082291737257140e-01   +5.779971595749950e-01   +2.941492787696052e-01   +2.226019611576732e-01   -1.277089405258715e-01   -3.499072503619513e-02   +6.591017233466414e-01   +5.904378577976341e-01   +5.672024669621620e-01; +3.376617509097021e-01   +6.018673460988961e-01   -4.336372600106517e-01   +5.653769981809502e-01   +8.268254628771302e-03   +2.904282848361844e-01   +6.357413096150778e-01   -9.742953933578941e-02   +8.211712086713580e-02   +3.236575831620780e-01   +6.261258141649384e-01   +4.392424203974803e-01   +4.611265779983605e-02   -4.897118961182390e-02   +6.229219178322249e-01   +4.368147891552228e-01; +3.213065125888763e-01   +3.092844282242451e-01   +1.179965327148123e-01   -3.311160570237477e-01   +4.860344417229213e-01   +5.190606918028795e-01   +2.193234244404246e-01   -3.233280272808170e-02   +1.097000361155075e-01   +4.080823348836717e-01   +8.881658038776097e-02   +5.817835006438504e-01   +3.379797442089664e-01   -4.892795346262452e-02   -1.115833606110544e-01   +1.113224187332895e-01; +3.707505065717540e-01   +1.112958706028969e-01   +4.722036935209699e-01   +5.105072235802917e-01   +2.819890639910007e-01   +1.330626286076688e-01   +4.958232711145170e-01   +2.884318268003787e-01   +4.602496488609301e-01   +4.987432391215170e-01   -2.168358584660329e-01   +1.872752890949055e-01   +3.937334930722138e-02   -5.561183987437171e-02   +4.668001726317843e-01   -2.361371282806862e-01; +6.470729730187870e-01   +7.198422826571018e-01   +1.639559939809724e-01   +3.003259044307569e-02   +1.333082777037695e-01   -1.575005428856631e-01   +2.096502167228263e-01   -5.228424384426517e-02   +6.596171136859006e-01   +5.910459610433288e-01   +2.999065082885878e-01   -2.223120624625990e-02   +6.881223100299808e-02   -2.168200401488300e-01   -1.743009918328385e-01   -2.332611882727807e-01; +3.739992841239534e-01   -2.318936556923808e-01   +4.332288051582533e-01   +6.567445780211241e-03   +1.118349899457124e-01   -9.238674203669542e-03   +4.989792423078325e-01   +1.700326839106162e-01   +1.703287642425522e-01   +4.397207133721533e-01   +2.557042946076964e-01   +1.632226161767456e-01   +4.078114950433707e-01   +1.629167040498748e-01   +2.289595906565059e-01   +4.946497192479123e-01];
L1E_L1I_iGABA_netcon = [+2.661172248169593e-01   -9.648382260443464e-02   +2.913178298915600e-01   -9.868023559402722e-03   -2.517985848591340e-01   -2.139911652303939e-01   +3.836530640311016e-01   +6.348534981307463e-01   +4.432107864271805e-01   +3.203131581524853e-01   +2.159812983971899e-01   +7.203927932772487e-01   -2.445981783299739e-02   -1.817051001396466e-01   +1.198460084269062e-02   +1.455600759087454e-01; -1.851964633617390e-01   +3.784183955535251e-01   +1.262860619091662e-01   -2.034329371006177e-01   +3.070737176509379e-01   +1.371224700654358e-01   +3.308757882883182e-01   -1.747927765795356e-01   +5.392333505743443e-01   -4.509898303457094e-02   -9.102535207086518e-02   +1.527027044834937e-01   +4.132795473112147e-01   -1.436424249207088e-01   -1.505139560028207e-01   +4.907318208133638e-01; +7.863470434705345e-01   -3.029442796159169e-01   +4.599210276761846e-02   +1.580914980515102e-01   +5.783234183821393e-01   +1.501172594365799e-01   +3.395833408479279e-02   +3.620509623487310e-01   +2.673160499392509e-02   -1.761477520050554e-01   +4.794965338486352e-01   -2.349325391668736e-02   +1.107877314349010e-01   +6.865886585560488e-01   +3.365002093947739e-02   +4.064471272039478e-01; +3.045261266904991e-01   +7.042087521186072e-02   +9.896135367355531e-02   +5.118324774464327e-01   +2.960573098687656e-01   +3.321373017756954e-01   +5.833449064500960e-01   -1.695642782567508e-01   +2.673677543886265e-01   +9.661283299636944e-02   +4.393091018878580e-01   +1.562988422883629e-01   -1.164269009047107e-01   +5.675228401988301e-01   +1.123256333975575e-01   +4.790188145827039e-01; +4.036623485101700e-01   +2.802288486635165e-01   +1.253621924417102e-01   +1.414503091919674e-01   +5.498051961259651e-01   +5.774999449482251e-01   +1.530254646965545e-01   +1.067038193096556e-01   +4.142463435818309e-01   +8.229480835560402e-02   +1.636592666542701e-01   +6.413890354277162e-01   +2.993385670003691e-01   +6.965246598029454e-01   -4.831439814409927e-02   +4.371380871894107e-02; +1.870494231902108e-01   -6.006244686957013e-02   +3.579322522964723e-01   -1.786855160799499e-01   +7.783827280241913e-02   +4.731374047698679e-01   +2.543186174038597e-01   -1.592760701981433e-01   +1.760755670678487e-01   -3.261191319106173e-01   +2.652770692889772e-02   +5.495403910862302e-01   +1.729512365706305e-01   +2.440467477618201e-01   +6.898593644253579e-01   +4.637302279722991e-01; +2.327567563120725e-01   +5.071822343731807e-01   -9.208945648181940e-02   +5.079383352457105e-01   -7.873171191995663e-02   +2.648332633186041e-01   +2.728555638279133e-01   -2.250380608600978e-01   +4.880672464923985e-02   +2.479703015386537e-01   -5.768954645985264e-02   -1.950926780167122e-01   -1.457580623129678e-01   -9.756432862969855e-02   +1.171552224737730e-01   +2.807532484957439e-01; +3.360477283660877e-01   +5.148176032818437e-01   +2.890609045055682e-01   +2.665217079346948e-01   +6.631282035249024e-02   +3.179805132864420e-01   +2.843121425067384e-01   +5.052745116741141e-01   +1.504493680542431e-01   +3.141033356202848e-01   +7.364980469621925e-01   +9.535450723899674e-02   +2.709780079259292e-03   -1.682233242510459e-01   -3.481838093065209e-02   -1.723136977775498e-01; +4.595975830076099e-01   +4.044833540634973e-01   +2.279964832066101e-01   +2.985783582030594e-01   +1.917816133903911e-01   +6.022508265161227e-01   -1.225359624705051e-01   -1.966417441415084e-01   +6.285936916563366e-01   +4.268715941345490e-01   -3.718720575488402e-01   -3.106404011722355e-02   -1.937118570631104e-01   -4.895720262499709e-01   -2.402388812191065e-01   +6.787511871171595e-01; +1.086954417972445e-01   +2.289676510040381e-01   -2.807638864730314e-01   -3.797136836062592e-02   +1.511922559462429e-01   +4.854627943567358e-01   -1.790264895993718e-01   +4.151524853873500e-01   -1.806770268460248e-01   +2.923813761937104e-01   +3.081007580613261e-01   +3.028436483428479e-01   +2.280263629074108e-01   -1.129489099226968e-01   +5.087337847165404e-01   +5.644289034211500e-01; +2.031268887472884e-01   -1.223887178629767e-01   +2.209639613364377e-01   -4.930022451067136e-01   +2.756386021980691e-01   -3.798090648256865e-01   +8.187266481868305e-01   +8.084796769171393e-02   +1.215100297049479e-01   +3.372588052442742e-01   +1.244007112013882e-01   +4.192410856287283e-01   +3.656464306385699e-01   +2.091317833715897e-01   -4.981246115870742e-01   -8.574802761068179e-02; +4.343563973223789e-01   +3.555092293947318e-01   -2.353647095531242e-02   +6.963140493363949e-02   -2.805100922773889e-01   +6.988228035136225e-01   -9.413791129677407e-02   +1.408227518816806e-01   +1.194184312191490e-01   -3.904717595344304e-01   +1.477886551468333e-01   -2.491292320332638e-01   +2.443956654463038e-01   +3.846201674286334e-01   +2.441342612913212e-01   +2.183946257119609e-01; -1.126024995655868e-01   +3.548860615312738e-01   +6.454894088151875e-02   +4.408085960495008e-01   +4.830635660198229e-01   +4.757317969289565e-01   +4.425316891664675e-01   +2.166732231080964e-01   +2.513191571951782e-01   +5.510859118148248e-01   +7.626943805489803e-01   +3.000006759053118e-01   -8.984276570976696e-03   +4.531840968672746e-02   +1.999870203429484e-01   -6.073615525065884e-03; +4.755249198860328e-01   +2.052977131103734e-01   -1.112231303050170e-01   -2.839841947287853e-01   +6.843015187323582e-01   -1.322134642206071e-02   +3.060306124643106e-01   +4.267503881041775e-01   +6.731959153397582e-01   +6.194316700268927e-01   +2.265756018761848e-01   +3.493457663354373e-01   +2.536768070954573e-01   +1.949468143715477e-01   -2.322836519005378e-01   +1.435583553038016e-01; -2.489329540373768e-01   +2.220956155315185e-01   +6.123435763362695e-02   +2.751503136271276e-01   -1.459950440390014e-01   +4.140388263010826e-01   -1.902428213079335e-01   +1.778210614971154e-01   -2.155816833440214e-01   -3.371399245808246e-02   -5.384006081511838e-02   +3.237513018747440e-01   -1.296592947304714e-01   -3.113906045927836e-01   +5.477997331095161e-01   +2.269575282773897e-02; +3.874054696769862e-01   -1.898332391393463e-02   +3.323959589783728e-01   -1.330353444087711e-01   +5.136714201028418e-01   +5.874377523879698e-01   +1.173611995125896e-01   -2.106067693551967e-01   +2.249013218258956e-01   +7.705377554491982e-02   -1.733500167711430e-01   -1.367639718929692e-02   +5.451507998879239e-01   +4.004914549147095e-01   -7.650117962955549e-02   +2.179606709921195e-02];
L2I_L1I_iGABA_netcon = [+3.584657823774731e-01   +2.254250780704680e-01   +2.784060775549622e-01   +4.499469978811598e-01   +2.559584981085888e-01   +5.171090726412255e-02   -6.099539332756190e-02   +2.152493888097048e-01; -7.265757177528026e-02   +1.342786393580866e-01   -1.565577179013381e-01   -1.571093646888815e-02   +1.734336650398556e-01   +5.431549945088996e-01   -1.318465309268530e-01   +4.353501449915766e-01; +4.563714014781476e-01   -6.567533356972499e-02   +4.572896370052256e-01   +3.080798142653045e-01   +7.703437465349174e-01   +6.018785015691028e-02   -7.131701254348956e-02   +5.578302694640687e-01; +3.499979557902501e-01   +4.477894690308906e-01   +1.578012611442270e-01   -7.286142671411400e-02   +1.104407020366813e-01   +3.317203793309241e-01   -7.020584525404425e-02   -2.761775188058007e-01; -3.037776345937071e-02   +3.363786767158070e-01   +1.795376885272782e-01   +9.306054880603176e-02   +2.559557991342259e-01   +4.105218475400553e-01   -7.309126034640051e-02   +7.886921806472338e-01; +3.277483945431184e-01   -1.223971148853535e-01   +2.773009365020219e-01   +3.408615736187323e-01   +3.153536530512129e-01   +3.386110734037928e-02   -2.521602828044863e-01   +5.420696876887815e-01; +2.233679535141057e-01   +5.551498886623836e-01   +3.880645716750547e-02   +3.728693345946022e-01   +1.015102732063002e-01   -1.546435471787810e-01   +2.471508310786554e-01   +4.772682766073698e-01; -3.140934852298050e-03   +2.522233125332342e-01   -4.728340347442193e-02   +3.687248595501595e-01   -5.125357988909990e-02   -1.052906846618538e-01   +1.681453804771205e-02   -1.551818780768034e-01; +6.979006107306918e-01   +6.792829452735027e-01   -2.296624159308100e-02   +1.390420043254435e-01   -2.860708503389529e-01   +1.821328748309988e-01   +2.229521859938433e-01   +3.959717510054626e-01; -1.895098898512562e-01   +2.388311543374914e-01   -2.278362566872207e-01   -1.045812575753442e-01   -1.591003902898463e-01   +3.677964443216342e-01   +5.633553792717668e-02   -2.907968074732661e-01; +4.700796175056929e-01   +3.973295948616948e-01   +7.054582670632191e-01   +1.196735889096323e-01   -8.701203452205833e-02   -2.383505205201494e-01   +8.485580994559992e-02   -4.783475752943467e-02; +3.574011103418504e-01   -1.006383289637396e-01   -4.439693379585491e-02   +6.522122133444812e-01   +3.112947399436574e-01   +3.726134552938749e-01   -4.339825565967914e-01   +2.695115500976525e-01; +3.501918742079771e-01   +4.988032120193729e-01   +6.000415336977934e-01   +1.000851959837138e-01   +1.008843473543090e-01   +3.031596684589662e-01   -8.793854367351385e-02   +4.001000940894285e-01; +3.936656987921934e-01   +5.583453129564581e-01   -6.788318832079000e-02   +7.518222758103940e-02   -2.244888312712902e-01   +5.133288980297048e-01   +3.115296411793227e-01   +1.221545205284664e-01; +7.955101173533685e-01   +1.061349725026590e-01   -3.515866095133498e-03   +5.429288459490061e-01   +4.592388387066176e-01   +2.730931691001349e-01   +3.984027320488505e-01   +7.064830229274937e-01; +3.991496153261013e-01   +9.576318770851380e-03   +2.358906737304965e-01   -2.016760777486637e-02   +2.067177388951786e-01   +1.659051029036222e-01   +2.190348783154991e-01   -1.015601504129845e-01];
L1I_L2I_iGABA_netcon = [+3.282591868468867e-01   +1.801516241600213e-01   +4.046417402539573e-01   +2.377394862785297e-01   -3.690804516474593e-02   +8.531901488229265e-01   +4.748649270230630e-01   -1.147726430141632e-01   +1.126131012649275e-01   +7.303383325179630e-01   +1.348653847505477e-01   -1.877347086223456e-01   +2.404676493885283e-02   -3.067981219058297e-01   +3.746315917705205e-02   +6.372570108160441e-01; +1.023320899313651e-02   +3.514938348200236e-02   +1.146823406650050e-01   +4.631384540987939e-01   +9.821244807437637e-02   -4.419056844931629e-02   -2.834345800649557e-02   +5.090077593881913e-01   +1.643520038412399e-01   +4.897329348399234e-01   +1.825435215775536e-01   +5.382518389547678e-01   +1.133020889962862e-01   -1.700984153811006e-01   -1.887813149592014e-01   +2.973973995757712e-01; +4.088719134680281e-01   -3.480561457285818e-01   -7.007928965579130e-02   +5.830593027867706e-02   +4.750808286455128e-01   +2.205914554086179e-01   +2.111704375710223e-01   +2.434519959293421e-01   +4.942417902130613e-01   +4.095916751314170e-01   +6.685965883411321e-01   +1.511473889440729e-01   +8.447942126857613e-02   +1.137324429615949e-02   -1.921141225520504e-01   -8.777947716722712e-02; +5.171955041017279e-01   +3.772003753590383e-01   +1.785489464370315e-01   -2.381722883091671e-02   -2.182005882418736e-04   +5.947427696570028e-01   +3.030249873335724e-01   +5.014003722722987e-01   +3.011771725699457e-01   +2.261560122562666e-01   +3.943717786996447e-01   +5.739580833914438e-01   +2.857254055974711e-01   +1.142813204039134e-01   +1.148781457298492e-02   -1.384669597607939e-01; +7.387887411092209e-01   +1.173397631553285e-01   +4.494570952688655e-01   +6.295899718153759e-01   +2.838350993753530e-01   +5.690228311322643e-01   -1.872343207942451e-01   -2.471195317040513e-01   +8.376701183485524e-02   -7.939123701667350e-02   +7.186924482591053e-01   -5.386575701763415e-01   +4.272328235540307e-01   -9.309524425079799e-02   +1.028950953534660e-01   +6.494123460280352e-01; +7.930465668845305e-01   +4.483632677578384e-02   +5.109384708080313e-01   -2.207528871223940e-01   +1.453962996413971e-01   +4.306750845581959e-01   +9.274644369399393e-02   -8.830866985622809e-02   +6.457948439164153e-01   -3.405634530171042e-01   +1.773770538385641e-02   +1.383781919566167e-01   +2.369716352477607e-01   +7.418408120586680e-01   +2.045475618173017e-01   +1.680549275725634e-01; -1.412814764777448e-01   -1.616684391704578e-01   +4.373659543979337e-01   +1.746506734903194e-01   +3.396073550221245e-01   +5.400842446567107e-02   +2.678049412070835e-01   -9.179006631193626e-02   +2.671196211661024e-01   +3.503094926329837e-02   +6.877294708690604e-02   -1.299142031507183e-01   -4.816711549064611e-01   +6.072724487195140e-01   +1.776730725317958e-01   +6.331764586208761e-01; -5.603396967794237e-03   +3.549122808272258e-01   +1.781763161922161e-01   +4.983249703897722e-01   +3.285540223763760e-01   -3.759886707126149e-01   +9.766273490123412e-02   -1.200237527690481e-01   +1.664495327985020e-01   +4.642334032768104e-01   -3.597720048264790e-01   +2.659553184591321e-01   +4.928494886702866e-01   +4.681397686375213e-01   +7.129941175448347e-01   +4.164096583336165e-01];
L2E_L1E_iAMPA_netcon = [+4.465732429201824e-01   -2.476516812278726e-01   +4.179646596864269e-01   -2.451252825554342e-01   +2.483722475159111e-02   +3.229963491024544e-01   -4.358378153557169e-02   +2.577471912666827e-01; +4.348028177941224e-01   -1.468230167932949e-01   +1.172847619728993e-01   +4.018142241868527e-01   +4.682593977287233e-01   -4.313551799901427e-02   -1.528796740923972e-02   +3.433287304280555e-01; +6.407188596903384e-01   +7.722856245806125e-01   +5.325603317216274e-02   +4.063350975417296e-03   -3.967759151224448e-02   +6.514881406826867e-01   +2.146189274348158e-01   -3.009498268627614e-02; +4.823607118547832e-01   +2.005467080976071e-01   +3.262945075693077e-01   +2.227877249431737e-01   +3.699088189114239e-01   +3.273415147442634e-01   -3.851456374190669e-01   +2.636059670248432e-01; -1.655163436625720e-01   +8.815533851803289e-01   +2.865958944823986e-01   +2.218991872212754e-01   +1.207069783469565e-01   +4.486597847319095e-01   +2.942907369154158e-01   +1.659284630568798e-01; +8.049032091828812e-02   +8.330435884116920e-02   +4.089120233505051e-01   -1.771470713422120e-01   +1.289373746465735e-01   -3.220924275052158e-01   +6.438051886350682e-01   +7.706114274018545e-01; -1.216736508397374e-01   +2.104691217209885e-01   +1.681512174300066e-01   +4.867308792704322e-01   +6.975318510375977e-01   -3.333628314934140e-01   -1.914181457705350e-02   +2.829418881074791e-01; -1.038856215998274e-02   +5.040041817929759e-01   +1.441999625028295e-02   -5.348965031141196e-01   +2.614108056504363e-01   +1.954426085699670e-01   +4.725242360124303e-01   -3.011816208512896e-01; +1.124110555319586e-01   -3.886170935748776e-01   -1.711475113796869e-01   -7.621246208189110e-03   +4.240231952334262e-01   +2.156892010794516e-01   -1.490599690647434e-01   +6.122296827713862e-01; -2.821702185894899e-01   -1.405678051373090e-01   +4.406811091498674e-01   +6.557712786737325e-01   +4.554215106620106e-01   +4.760972823531764e-01   -1.400318587126406e-02   +2.858564292795560e-01; +2.545079327032053e-01   +3.011134295676864e-01   -1.867845270824982e-01   +7.965817966416477e-02   -1.807378399257534e-01   +2.439024875780352e-01   +4.641258209073010e-02   +4.972703431205547e-01; +5.121383516508887e-02   +2.683897755997161e-01   -9.189058890562327e-02   +3.536614470888508e-01   +3.704865940467266e-01   +4.801711874149907e-01   +1.431833292300637e-01   +2.178543079015778e-01; -2.899959792099966e-01   +4.338975350989047e-01   +2.861847525751944e-01   +4.060814758269324e-01   -4.472821613830127e-02   +6.798757371362196e-01   +9.023959595218889e-02   +3.603518743262329e-01; +4.322580354552199e-01   +2.453721527615771e-01   -3.719296308674533e-01   +5.109368866200310e-01   +5.958011288257176e-02   +2.829365439222445e-01   -7.077143307236540e-02   +4.107363729102134e-01; -1.681174061422148e-01   +2.132736413758853e-01   -6.701397423494440e-02   +4.374972324832954e-01   -6.339090744524076e-02   +8.800534120333985e-02   -5.999467301593340e-01   -3.932368727682292e-01; +6.205342723522579e-01   +3.573374020048109e-01   +2.078958753924125e-01   -1.860984918449103e-01   +4.879467569417378e-02   -3.881616785208118e-02   +5.217528022989332e-01   +1.809040626242916e-01];
L1E_L2E_iAMPA_netcon = [+1.928802289704395e-01   +7.029906484016025e-01   +3.077908459952989e-01   -2.749437966258003e-01   +5.062407416735566e-01   +2.286283264554984e-02   +5.604101512654938e-02   +2.902454960067838e-01   +1.602282149501804e-01   +8.678225277252510e-03   +3.808437312100238e-02   +8.246127424929943e-01   +3.177524185760542e-01   +1.231276061998243e-01   +4.650250544612523e-01   +3.587396911793779e-01; +2.824664216128142e-02   +6.874308796546146e-01   +6.307471270237766e-01   +8.705766670664568e-02   -2.254930488913688e-01   -4.129405250183701e-02   +3.626428987536640e-01   -8.482549264742188e-02   +2.798574185514519e-03   +3.095446067593017e-01   +7.787856710082455e-02   +7.902710983143069e-01   -9.831141429609283e-02   +4.054091914432228e-01   +3.065623646665168e-01   +4.041737814433179e-01; +7.467445923506122e-03   +2.784457901499728e-01   +4.089764312164752e-01   +1.828171806692050e-01   +1.498649226203221e-01   +1.216478697884587e-01   +1.721738159391697e-01   +6.329240557191662e-01   -1.464339514877288e-01   +1.283732928382395e-01   -3.863233529127255e-01   +4.740991981906725e-02   +1.773654595950155e-01   +4.069179125379017e-01   +3.593512369545894e-01   -1.721513160911729e-01; +5.093534780615159e-01   +2.596550672401761e-01   +4.223231937537059e-01   +2.930597314961030e-02   -2.083096821189519e-01   +5.016078778615638e-01   +7.006546087662786e-01   +5.377544821283107e-01   +4.799962735778032e-01   +6.615615763496000e-01   +5.219788132320766e-01   -2.588849536337855e-01   +5.852880141442784e-01   +5.966676579036941e-01   +2.293946560439226e-01   -2.004040482897346e-01; +9.657624976906387e-02   -1.040947518470764e-01   +5.659088565258338e-01   -1.275149732824279e-01   +2.287522205781697e-01   +7.779195223035809e-02   +6.953591673825787e-01   -1.385594866092749e-01   -1.453844929603620e-01   +5.658846145019654e-01   +7.187373772129804e-02   -1.908815445900135e-01   -1.079958103333928e-01   -7.985458488814152e-02   +7.264079355970037e-01   -8.027819375242651e-02; +1.225576220919447e-02   +2.520787432238614e-01   +2.767370715523771e-01   +4.395485691540241e-02   -9.201061924512088e-03   +3.129630003175379e-01   -1.765742077431112e-01   +3.972880923249574e-01   +2.258791273059955e-01   +4.988026391891521e-01   +6.086044666021101e-01   -8.222184561698903e-03   +4.436057021476549e-01   +3.068657927115155e-01   +7.331136699654894e-01   +1.442892198810488e-01; -2.597697012847605e-02   -1.113688078403617e-01   -7.034875291617587e-03   +4.922340987671882e-01   -1.813630346988027e-01   -3.494414421537994e-01   -4.945970174062742e-02   +1.733340598200223e-01   +5.404186943144417e-01   +1.302350827851371e-01   +3.953143474158454e-01   -9.283648366001042e-02   +1.849309644068473e-01   +1.405810756579818e-01   +2.672568208372141e-01   -1.411843418102826e-02; -8.058810148886036e-02   +4.902941257564208e-02   +3.539375669903699e-01   -1.927618186846076e-01   -2.294310791169569e-01   +2.460479570590211e-01   +3.812502137564640e-01   +1.250560212436564e-01   +1.115808982951917e-01   +4.663416516522892e-02   +7.263283852170709e-01   +2.526967387662020e-01   -3.324440264482559e-01   +5.623903901798755e-01   +2.303619449803078e-01   +6.628537576148017e-01];
L2I_L2E_iAMPA_netcon = [+5.587204373638958e-03   -1.226329406555631e-01   +7.012501962680798e-02   -8.564435244966899e-02   +4.370374813374390e-01   +2.323490887864939e-02   +4.208944036057426e-01   -8.011697246124200e-02; +7.011016140033015e-02   +1.110137779199681e-01   -1.450781515863499e-02   +6.226825324827372e-02   -8.744602650345720e-02   +9.084123921718290e-02   +4.595287985474657e-02   +3.049524578258570e-01; +5.315893199116507e-01   -2.471071638666714e-02   +4.556985825740594e-01   -1.201480162354227e-01   +3.483416127988758e-01   +5.895079119669198e-01   -1.156866435773729e-01   +3.434790284852736e-01; +5.862188852382968e-01   +2.823226858051521e-01   +3.640397892068036e-01   +8.157346703975049e-02   +1.052687035803457e-01   +1.916071542602639e-01   +3.038447758063786e-01   -1.619966181955643e-01; +5.396897146410924e-01   +3.236757949273452e-01   +7.018257251514878e-03   +2.617761913149450e-01   +6.092975348430008e-03   +2.585854179478869e-01   +5.416851846704562e-01   +2.039143460681008e-01; -1.211637428885749e-01   +2.032558140088798e-01   +1.862688740275142e-01   +3.747677587786900e-01   +1.387519630146136e-01   +4.787029784525382e-01   +2.763654019294360e-01   +2.735950119557665e-01; -1.455662101125903e-01   +6.447812549038203e-01   +4.514166842721780e-01   -1.130955349156232e-01   +3.509117476449021e-01   -7.649563999678888e-02   -3.547802864962199e-01   +1.327831493822341e-01; +2.635109582954920e-01   +7.568449001136930e-02   +4.137289297737823e-01   +3.595040781990613e-01   +4.142334643415166e-01   +4.222791382443912e-01   +4.963082333614623e-01   +2.743138382271091e-01];
L2E_L2I_iGABA_netcon = [+1.819735366827209e-01   -2.651967305496162e-01   +3.824329725119759e-01   +5.899091314769748e-01   +1.532801321832841e-01   +1.281517266499320e-01   +5.428993073778651e-02   +5.971765258258959e-01; +5.458289447982818e-01   +3.354685524421925e-02   +2.465885170887442e-01   +7.167165697557937e-01   +1.735110725740144e-01   +3.066229601146342e-02   -5.187008850373648e-02   +1.976652316155325e-01; +3.606461485577293e-01   -4.350374876687474e-01   +4.027268796871247e-01   -2.734881435065898e-01   +3.118941678821153e-01   +3.154493144931498e-01   +5.606482882467096e-01   -6.655793209543903e-02; +5.154780763799354e-01   +3.022460793983678e-01   +5.670621844233119e-01   -5.543303782131836e-01   +2.541559802259920e-01   +6.137380759508431e-01   +3.014857886867039e-01   +1.857366727943849e-01; +5.351465099959465e-01   +7.613951359766744e-01   +3.093619601722391e-01   -6.795703635958472e-02   +4.940755469233615e-01   +3.375081800082482e-01   -2.288063239303955e-01   -4.569723692309431e-02; +3.307673264546105e-01   -1.282718884280235e-01   +5.345937753585621e-01   -3.437482952645976e-02   +5.047045616561926e-01   +2.280301096853953e-01   +4.914531170246608e-01   +4.820702945785643e-01; +3.637005898797075e-01   +6.752470133008888e-01   -3.492361988819302e-01   +2.668363175137301e-01   +3.870548108714669e-01   +3.173963326697715e-01   +4.114353313836706e-01   -2.836785300370502e-01; -1.144801071897463e-01   +5.887078285736358e-01   +3.527965421883281e-01   -1.096495862979810e-01   +2.569477956502190e-01   -2.196406296693793e-01   +2.345508638830179e-01   +4.643792070401643e-01];
L3E_L2E_iAMPA_netcon = [+6.899692408525936e-02   +3.027483791354184e-01   -3.106191468640137e-01   +3.768006057167584e-01   +6.820925304129853e-01   +4.903180706508685e-01   +1.439868078558857e-01   +2.834599285961524e-01   +1.397748891437897e-01   -1.104546231136826e-01   +7.417247726190003e-01   +3.397295917042367e-01; +5.486166153126680e-01   +6.961955090241831e-01   -3.408403643471211e-03   +1.410854287444535e-01   +4.149206435135331e-01   +3.321685344503709e-01   -1.333264359225649e-01   +1.553792461199355e-01   +1.883343791055416e-01   +5.552160982398411e-01   +1.324629458128768e-01   +8.572147242666608e-02; -9.942621850656116e-02   +7.717510132927585e-01   +1.836233891236448e-01   +4.665241242985763e-02   +6.582370031352398e-01   -1.016544550515518e-01   -3.519181504311741e-04   +5.233389517649251e-02   +2.582221042088590e-01   +4.834638402933084e-01   +5.294729594182068e-01   -2.789101964385129e-02; +1.114974164731265e-01   -2.392233192570867e-02   +2.799879778569405e-01   +2.432649620759671e-01   +4.275287872687937e-01   -3.173176814620499e-02   +5.298785464377510e-01   +3.514302571057659e-01   +7.181731824477640e-01   -4.446829245959577e-02   +2.396108024572000e-01   +3.632411873680174e-01; +2.060336090186796e-01   -9.922605277835023e-02   -1.640319968332944e-01   +5.304672418828928e-01   +3.772500600760433e-01   +9.017508495743893e-01   +6.281079799480662e-01   -8.451570789033669e-02   +4.547946089686696e-01   +1.009215397074525e-02   +6.816094681114098e-01   +4.004219222385212e-01; +1.718211189012254e-01   +4.194745589296710e-01   +1.576327075081926e-01   -1.488664314960581e-01   -4.450438509345054e-01   -1.246513999061845e-01   +3.578358745237835e-01   +7.616789520568912e-02   +4.442528557260109e-02   +5.382837125406781e-01   -3.652194265224472e-01   -4.012738167749527e-01; +2.848473308156038e-01   -1.620731819799128e-01   -6.559291625351919e-02   +3.482517792276122e-01   +2.686137855899617e-01   +4.432109949087604e-02   +6.204413200792597e-01   -1.790417921512110e-01   +2.638042665528493e-01   +1.960502991482451e-01   -3.470849491291971e-01   -4.031273244757743e-01; +8.130582497017580e-02   +4.891395493592870e-01   +5.032571160856647e-01   +6.814094910544395e-01   +3.565493311143964e-01   -1.588454801643581e-01   +4.657297142399537e-01   -3.320534464887588e-01   +4.599509035933232e-01   +2.377474092998697e-01   +4.055170863496723e-01   +3.177748609291762e-01];
L3I_L2I_iGABA_netcon = [+2.400111553115811e-01   -1.859679348013155e-01   +2.147969766883802e-01   +2.955997862439139e-01   -1.914989289157643e-02   +5.487503904148989e-01   -1.826034727210209e-02   +1.486904571290074e-01   +6.139173193887354e-01   +2.941205277022149e-01   +1.607472734630035e-01   +3.272802243841076e-01; +6.813943875015948e-01   -2.766679655238274e-03   +2.732957368072587e-01   +4.600509967797410e-01   +7.675859797587835e-01   +3.685798403098085e-01   +6.360819354027122e-02   -1.715276336880206e-02   +8.781382494136664e-02   +2.462988114722507e-01   +2.382926839264651e-01   +6.297902858899782e-02; +6.986767257648656e-01   +1.355634786092774e-01   -9.430779115231357e-02   +2.906242655059477e-02   +1.120218118310219e-02   -1.102963178297914e-01   +8.711629205226862e-02   +3.044049317726444e-01   +4.170540729355700e-01   -3.583404711000223e-01   +3.476992235672066e-01   +6.446706943475029e-01; +1.723325749279293e-01   -7.209858568502109e-02   +1.324272356702450e-01   -2.063211234567114e-01   +1.615509779745342e-01   -2.289156420439835e-01   +6.032351632718330e-01   +2.671545264235970e-01   +2.385564767415780e-01   -1.155166825207192e-01   +1.450869498477548e-01   +1.954015835533110e-01; +5.214193058817163e-01   +7.981945483883388e-01   +2.527748496188931e-01   +9.710503783169233e-02   +6.523703176628202e-02   +2.183239673496491e-01   +4.636771647570478e-01   +8.636757984303629e-02   +2.619906413367658e-02   +2.568983847161084e-01   +2.611486608649630e-01   +8.379946883181408e-01; +4.092039656535670e-01   +3.496791686497938e-01   +3.956911372294677e-01   +1.808460754793668e-01   -7.022395645605534e-02   +4.627053136937376e-01   +6.780546144684725e-01   +2.622100110660031e-02   +2.528338787520770e-01   +2.521827616875013e-01   -8.617122125506582e-03   +3.088368218261279e-01; +2.724509363984490e-01   +3.837824442829885e-01   -2.819520919047852e-02   +2.639373813308916e-01   +2.439846127914130e-02   -3.517738691777554e-01   +3.633525941616486e-01   -4.014104238801827e-01   +9.184688941240355e-01   -6.522198621739983e-02   +3.228277953526416e-01   +6.140864295101709e-01; +3.030737894804211e-01   +2.676631530058364e-01   +2.529980209622824e-01   +4.946800422260376e-01   -6.504497692807816e-02   +2.391848411814439e-01   -5.261750039251103e-01   -9.941827784673044e-02   +2.130469585968808e-01   +3.563982262096959e-01   -2.562158309449385e-01   -1.560811095694574e-01];
L2E_L3E_iAMPA_netcon = [+1.999874105458142e-01   +6.393837090749360e-02   +4.357878319110569e-01   -1.773546377567290e-01   +9.151225387631159e-02   -1.736678493776479e-01   +4.862916222291350e-01   +4.129019589864158e-01; -2.122817057671544e-01   +2.409738819274483e-02   +2.570520033501790e-01   -7.902676198102966e-02   +8.296057485067484e-01   -3.796402069955238e-02   +1.489817038231967e-03   -2.082903214540198e-01; +2.512126184639341e-02   +5.288883899137802e-01   +1.154866263517295e-01   -1.478363745751530e-01   +5.606674884498519e-01   +2.594092102042190e-01   +7.190753701988172e-01   +4.447126750033291e-01; +5.329390720497315e-02   +1.860674999480837e-01   -2.310869049128869e-01   +1.262305797443549e-01   +1.214759768766557e-01   +2.939236261013984e-01   +1.030450508371718e-01   +3.125026700874234e-01; +7.021092602344614e-01   +3.623694603813150e-01   +7.148280317381438e-01   +1.848115802636873e-01   +6.199408170373735e-01   +2.599309597510169e-01   +1.198352023198481e-01   +4.608318700214639e-01; -3.865923035241225e-01   -2.051513200496142e-01   +2.817384730103884e-01   +3.204425180211573e-01   +2.597332128132276e-01   +2.696829886203093e-01   +1.664524510800644e-01   +4.464599693074598e-01; +2.790169781503483e-02   +2.233747880441947e-01   +6.608414945234962e-02   +1.096854538460804e-01   +1.244031018449477e-01   +4.862359311930300e-01   +2.066500369180335e-01   +3.434918760858389e-01; +5.499943129764380e-01   +6.136771193545209e-01   +9.114250269196937e-01   +6.880093949905025e-01   -6.292085088521027e-02   -1.030763103780720e-01   +8.363313364736248e-01   -1.697947172634493e-01; +1.939932237537654e-01   +4.333785729798935e-01   +3.724897398115897e-01   +4.835140654921025e-01   +2.555302740677485e-01   -1.516681584327335e-01   -1.062880501996761e-01   +3.527669489012918e-01; +7.106979564939125e-02   +6.643231202320465e-01   +4.973371444864028e-02   -2.118811617754942e-01   -1.953058707508671e-01   +2.433596008708480e-01   +2.252440297603843e-01   +4.836365777298316e-01; +1.860679100340332e-01   -1.149785273298957e-01   +4.690738867283037e-01   -2.612230545208427e-01   +7.351705672636029e-02   +3.307497234869818e-01   -4.076929808105006e-02   +8.691585875041357e-01; +4.606719140383811e-01   +5.250044367282923e-01   +8.720401264933662e-01   -3.016490766314145e-02   +8.462455520115948e-02   +2.651054834706860e-01   +9.867467992255198e-02   +1.300240790106102e-01];
L2I_L3I_iGABA_netcon = [+5.685050251328263e-01   +4.645894777451975e-01   +2.682056176938609e-01   -2.184665910774783e-01   +5.689901416872802e-01   +3.460978520247087e-01   +2.362548627647380e-01   -4.648235460359480e-01; -3.339922600515494e-01   +7.113818932613039e-02   +6.126115241208017e-01   +2.187352920050871e-01   +4.431821179222290e-01   +3.101747201136832e-01   +1.457472315735847e-01   +6.863677893261042e-01; +2.951304039756611e-01   -1.305730703631828e-01   +4.230073268880026e-02   +3.954405781246371e-01   +3.912926717336014e-01   +5.376865512407691e-01   +5.545693560187631e-01   -2.838961771900459e-01; -1.211636089164475e-01   -2.289087135259038e-02   +4.118718965623652e-01   +3.132902133489645e-01   +2.217063429184783e-01   -1.411009036012195e-01   +7.511871775506922e-02   +4.245481207150022e-01; +2.324734676693205e-01   +4.113302083487910e-02   +3.147343573520890e-01   +3.735160016913134e-01   +2.384144685904957e-01   -1.197756740365333e-01   +4.481621822172293e-01   -1.379573367528742e-01; +8.306465937807848e-02   +5.001134670542882e-01   -7.616588023763085e-02   -3.452095212215304e-01   -1.178146096344156e-02   +1.696789018706461e-01   +1.394504441351060e-01   +6.520051278216462e-01; +2.764889654281046e-01   +3.055981214532938e-01   +7.588851437116717e-02   +3.110361296874964e-02   -1.351240131309683e-01   -9.691033304457419e-03   +2.905793656485814e-01   +1.057718919561017e-01; -4.170021761116191e-02   +1.452548464350687e-01   +4.392831945126143e-01   -1.578071060524475e-01   +7.014327533804460e-01   +2.082317978823015e-01   +3.954806185779762e-01   +1.482608668894409e-01; -3.406259768911968e-01   +1.551011237338898e-01   +1.853099441654656e-01   +1.653977788558189e-01   -8.746174628689729e-02   +5.875387832808677e-01   +5.113604573468278e-01   +2.512543448453139e-01; +6.540617885004148e-02   -2.189972385995524e-01   +1.742797824638692e-01   +1.665893829568263e-01   +2.744928987720139e-01   +5.363288994384321e-01   +5.766513691403019e-03   -5.762828836481131e-02; +4.451545934913008e-01   -2.119713872005324e-03   +3.310616993828039e-01   -3.340192775036103e-01   +8.523600891641354e-01   -2.887993876464365e-01   +5.031735080395959e-01   +8.343882006723315e-01; -4.903087143842235e-02   +2.063967646520788e-01   +4.335423160416392e-01   +8.835081011899863e-02   -8.503828786618689e-02   -1.511811524336974e-01   -7.559324564138853e-02   +2.797416648756697e-01];
L3I_L3E_iAMPA_netcon = [+4.075160632158520e-01   +2.414177300540092e-01   -1.672894187126046e-01   +1.841966400212563e-01   +4.287948940679620e-01   -3.568883595735650e-03   -1.696810362463641e-01   -1.003669105061776e-01   +6.821253821932030e-02   +2.459335291083620e-01   -6.457453790193274e-03   +6.432308217881633e-01; -1.384891534498961e-01   -6.326031865637399e-02   +3.796183390279250e-01   +2.231525312140375e-01   -2.880872338766574e-01   +6.191706531104788e-01   +2.922295954907053e-01   +2.808737356967886e-01   -2.095311215978095e-01   +1.678368715049233e-02   +2.930571093097439e-01   +6.774348814113454e-01; +4.778004808003626e-01   -2.829501412823103e-01   -3.495160814491763e-02   +7.974811992065062e-02   +1.324497448090259e-01   -1.112352312470781e-01   -1.227329289967999e-02   -1.565595873757231e-01   +3.109808679021607e-01   +3.238575945296333e-01   +4.389567883911422e-01   +1.402235702689892e-01; -4.737240691953186e-01   +4.452818865268500e-01   -2.670287227274017e-01   +3.362705673347324e-01   +6.903094421062916e-01   +2.741293935052017e-03   +1.011817792575531e-01   +5.661634325056943e-01   +2.502996830961972e-01   -1.518828358717300e-02   +3.526382184839993e-01   +3.496524700667077e-01; -2.265327519310253e-01   +2.680488300652921e-01   -5.484305373476295e-01   +4.459247590906894e-01   +4.628412745096643e-02   +7.070751367472402e-01   +1.512345314536494e-01   -3.865166262704114e-02   -8.104490717810403e-02   +2.780857806853450e-01   +1.472237497036813e-01   -1.206047165127354e-01; +2.507543287880286e-01   +2.771034591880729e-01   -1.148853958888534e-01   -2.520779693632624e-02   +1.955727547429604e-01   +5.249085237246565e-01   +2.115313376728570e-01   +6.767530810438732e-01   +3.780067150400664e-01   +3.471756471852248e-01   +2.969716964446568e-01   +1.375029856853610e-01; -2.441831877022381e-01   -1.187960117509085e-02   +4.114600636268236e-01   +1.814386440914220e-01   +1.845052356466562e-01   +4.038540158860739e-01   -5.642993882986580e-02   +5.402643896455900e-02   +2.339292915096913e-01   +7.629629218001881e-01   +5.934769406078392e-01   +2.604394892645512e-01; -2.823083912424398e-02   +4.452354802520737e-01   +1.560950733452033e-01   +5.433594716767782e-01   +8.501233225722665e-02   +5.630735483356437e-01   +9.095051765170534e-02   +2.776823191472380e-01   +2.539328146437528e-01   +1.761319818700290e-01   +3.277641207370661e-01   +3.866609875210505e-02; +1.235387515300687e-01   +7.330867770345049e-01   +7.306734034527322e-01   -2.089630770858527e-01   -7.815710202300721e-02   +3.831687251374580e-01   +2.653511486411071e-01   +5.568464410380827e-02   +6.631450755405841e-01   -5.726785759193706e-02   +2.222508546297056e-01   +1.013509239342391e-01; -6.048183065216051e-02   +1.919342871867161e-01   +1.825250608073293e-01   -4.413771686501655e-02   +3.823193324142541e-01   -9.035078523666981e-02   +3.837122895588521e-01   +1.535133805095321e-01   +3.232825039313472e-01   -6.821543980219724e-03   +3.442450009876329e-01   +7.158134288591922e-01; +4.113838267891716e-01   +3.106873550164118e-01   +3.679224228264155e-01   +5.261702277703193e-01   +2.086439278292483e-01   -4.304078304339393e-01   +2.980371088122642e-02   +2.404664933762199e-01   +1.326398750600553e-01   +6.207125356768297e-01   +3.109206434895626e-01   -2.188403710388157e-01; +2.531908190717216e-01   +4.386664612942169e-01   +3.940355643543773e-01   +8.729733347926819e-02   +4.994006093075837e-01   +2.217950932901029e-01   +2.434258609298946e-01   +3.524209926092299e-01   +5.017829760362100e-02   +1.599461986148115e-01   +9.998875343926833e-02   +6.894605626167489e-01];
L3E_L3I_iGABA_netcon = [+4.759499497855077e-01   +1.204320406251641e-01   +1.473189741751274e-01   +2.252152126094825e-01   +4.904609135345808e-02   +4.771262455618563e-01   +2.896989760895973e-01   -1.243172791035391e-01   -2.157761456571078e-01   +2.598715519734766e-01   -3.202878014674949e-01   -3.967099908949759e-01; +3.618086736247929e-01   +4.909416253415785e-01   +1.130885248466398e-01   +3.426658024004556e-01   +1.401554667788094e-01   +5.769376677618860e-01   +8.292762783472164e-01   -3.181086674236833e-02   -5.105665028502426e-02   +3.465280141267287e-01   -2.690696975479570e-01   +2.715987050648787e-01; +8.315951501916456e-02   +1.029181493361071e-01   +5.115661399775739e-02   -1.055629305386931e-01   +4.674764896166810e-01   -2.553116278267634e-01   +1.418104124867570e-01   +4.280346981876274e-01   -3.608535710862852e-01   -1.881777463829008e-01   +7.962518016474579e-02   +5.090795735441207e-01; +7.760546061411084e-01   +1.518397614725264e-02   +2.815809581823216e-01   +6.923465744963817e-02   +1.351041669027695e-02   +5.211746225349900e-01   -1.279743103943898e-02   +4.163229668919957e-01   +2.230155629389697e-01   +1.192147008952229e-01   +9.015240423816642e-02   -1.675090380207854e-01; +2.445718361214794e-01   +4.378002192429580e-01   +6.596191338188312e-01   +9.317338603390660e-02   +4.397980248920517e-01   +4.610820400570709e-01   -1.623663633346154e-01   +2.240557288031557e-01   +3.003346006311816e-02   +2.485835636334555e-01   +4.262639500641173e-01   +4.431685364964277e-01; +2.267630674019503e-01   -8.414234719880356e-02   +3.093910130529239e-01   +1.612840744819901e-01   +1.000199735690038e-01   -6.819478886559120e-02   +4.064745785739902e-01   +2.810287756088637e-01   +3.763718762936994e-01   -2.412380707059204e-01   +3.852153030530360e-01   +3.386357718088716e-01; +1.088989360078629e-01   +6.310917899360360e-01   -4.258095065570477e-02   +4.902562636903254e-01   +2.517359101355121e-01   +1.365212035211634e-01   -1.175785895130760e-02   -2.243230196576702e-01   +3.612694800595945e-01   +5.333729432256121e-01   -2.965226220513804e-01   -2.224996488312000e-01; +5.073353520808517e-01   -3.870447626296433e-02   -2.968448085774882e-01   -2.607823928935693e-02   +1.918748427595353e-01   +6.989567381128692e-01   +1.103458398638146e-01   +3.442261569173624e-01   -1.741686855760727e-02   +4.230838904973298e-02   +1.651226895009395e-01   -3.794552657139186e-01; -2.514182020379808e-01   +5.241342901137667e-01   +4.825006128737632e-01   +6.255238306878697e-01   +5.987324879766154e-01   -1.841644163571492e-01   +1.010416975702689e-01   +1.017257153819844e-01   +2.247049865883155e-01   +8.270613142091355e-01   +1.439053725938866e-01   +2.018724935646400e-01; +2.923911162898696e-01   +5.976049253573547e-01   +3.112819204095424e-01   +2.917422553512157e-01   -1.094816048674545e-01   +1.393564468503885e-01   +1.644282435429785e-01   -1.342587315164144e-01   +4.657135319951899e-01   +2.440447949404354e-01   +4.886608577192994e-01   +6.105376084213604e-02; +4.279916412303539e-01   +3.193862540704470e-01   +4.259537269931163e-01   +7.605265621122669e-01   -2.251108796866424e-01   +3.473514736935319e-01   +2.035300389720086e-01   -1.910197197767379e-01   +6.473339113780688e-03   +5.230132199761195e-02   +3.229258087713474e-01   +2.117188308491413e-01; +8.242594880418334e-02   +4.878989987692114e-01   +5.914181962475063e-02   +5.375547650509037e-01   +3.348290853080069e-01   +5.394304976493463e-01   -1.361060191378715e-01   +1.944104188254834e-01   -1.923075052352141e-01   +2.473865015216250e-01   +4.265441277197495e-01   +1.866505332100802e-01];
L2E_Input1_iAMPA_netcon = [+4.302620452620020e-01   +9.339887999849190e-02   +1.631408997730482e-01   -5.076706778236806e-02   +2.158753806977154e-01   -3.161879060338329e-01   -1.987279340166404e-01   +2.609614428491596e-01];
L2I_Input2_iAMPA_netcon = [+1.090253941720099e-01   +2.766704307568829e-01   -1.329514539321273e-01   +1.435268141014353e-02   +5.741390937661264e-01   -1.902718218320809e-02   +2.634393151823374e-01   +5.538675480514534e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.04*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.5*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.1*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.5*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.1*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.5*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.04*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.5*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.1*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.5*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.1*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.5*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
