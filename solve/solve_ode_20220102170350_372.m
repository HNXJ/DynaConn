function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-1.049107231110278e-03   +1.733931741295542e-02   +2.825935317548433e-02   +2.606332372767273e-02   +2.541514020082997e-02   +3.776693003473772e-02   +1.347452348497773e-02   +9.082512828463660e-03   +7.234863384169251e-03   +1.356031079558467e-02   +2.014863028302535e-02   +1.204821278548204e-02   +1.916294570283792e-02   +2.729598980951753e-02   +1.596660126339399e-02   -5.049411379790687e-04; +1.701016142121848e-02   +2.235218170286329e-04   +1.678670730098333e-02   +2.498641462542403e-02   +6.727353462657692e-03   +9.989692245508518e-03   +3.508797140841294e-02   +3.360829625920690e-02   +2.832334852306476e-02   +1.164839849824981e-02   +3.490740723876598e-02   +5.960970843343035e-03   +7.015559378731548e-04   -4.576114460379642e-03   +1.472533183001296e-02   -1.851752124998754e-04; +1.846972876640469e-02   +2.228823423090797e-02   +2.705815058641749e-02   +2.098561284370937e-02   +9.203065508640177e-04   +3.642145153619344e-02   +2.740332532375686e-02   +1.719653959427521e-02   +1.214570652848120e-02   +9.686352055010040e-03   +1.855585891254955e-02   +6.556535906797750e-03   +6.772362504146394e-03   +6.692220353696947e-03   +2.820756895506835e-02   +2.115590210173134e-02; -1.166105467514305e-03   -1.815186438134485e-03   +1.352522410453354e-02   +2.418542992426711e-02   +5.735480481831466e-03   +2.294094340258402e-02   +1.838528119855769e-02   +2.991552930252736e-02   +1.619157621497316e-02   +6.508240906951014e-03   +3.214915169765939e-02   +2.781023069084872e-02   +1.005434400480587e-02   +3.130945371901515e-02   +1.307200570024069e-02   +7.983016035292377e-03; +1.796778958760461e-02   +1.632829208527177e-02   +2.362852300221813e-02   +2.526238359442987e-02   +1.707208047182427e-02   +3.256580917223004e-02   +1.379534978264227e-02   +9.207625438386460e-03   +2.344890813642202e-02   +3.815112512085451e-02   +1.779585501815129e-02   +2.247668004865461e-02   +8.489756761192690e-03   +8.849162991912509e-03   +3.521122269788196e-02   +5.109733012825660e-03; +1.830830553256774e-02   +1.172675133812948e-03   +2.891996195733443e-02   +3.374404032329191e-03   +1.750339268000178e-02   +1.179795272367410e-02   +1.384241444263256e-02   +9.889829582807411e-03   +1.800138461200968e-02   +2.126740352096940e-02   +2.851633611584282e-02   +1.073923795870104e-02   +1.680715692558131e-02   +1.208132884130278e-02   +1.772003492476956e-02   +2.460602021495087e-02; +8.988033605164134e-03   +2.372975622055235e-02   +2.980558429405417e-02   +2.557164601046837e-02   +2.063281191457875e-02   +1.756248565231692e-02   +1.103542185723684e-02   +3.133087357070288e-02   +3.146262485011413e-02   +8.084619490581514e-03   +1.401519665099467e-03   +1.035054432588689e-02   +1.422252628447024e-02   +2.786070284800301e-02   +2.918623351613680e-03   +6.614970167889153e-03; +2.358763212909797e-02   +1.398483913885649e-02   +2.724770463734410e-02   +2.704900164404155e-02   +1.927967010140727e-02   +1.667349915496741e-03   +2.366178989955117e-03   +1.577788762311826e-02   +2.607484227851220e-02   +2.308613175243496e-02   +8.019023810832984e-03   +2.225275782876000e-02   +1.263355102628818e-02   +4.659086682736848e-03   +2.428570956840874e-02   +2.371762331077683e-02; +4.254732411915705e-03   +2.367917053782490e-02   +1.720974135644220e-02   +2.476001877226020e-02   +3.580751041954261e-03   +2.996437010882855e-02   +1.304023804345326e-02   +1.456769638676141e-02   +1.436433019124910e-02   +1.427770077764183e-02   +1.126767009330809e-02   +2.916693987980217e-02   +2.950262055467634e-03   +2.614910585654406e-02   +8.935343329391075e-03   +1.228321714487320e-02; +1.655055863666354e-02   +7.130487650265667e-03   +3.179385724078081e-02   +2.574569155303023e-02   +2.023413422837122e-02   +1.066134570330450e-02   +5.774986072665593e-04   +4.569963861309240e-03   +2.353480836083820e-02   +1.511907164853787e-02   +6.622946035994561e-03   +2.391799394023965e-02   +2.967781555973557e-02   +1.620661861872169e-02   +3.511013598869549e-02   +2.085692038047634e-02; +1.114841491894976e-02   +1.362083800497248e-02   +1.866357008388355e-02   +3.039042818622957e-02   +2.581159813142083e-02   +4.739434066477349e-03   +2.150590709944965e-02   +2.746716805780459e-02   +6.307743192144727e-03   +1.017754185943973e-02   +2.338746257120654e-02   +3.126580366111324e-02   +3.832940687392006e-03   +1.625438562008413e-02   +2.784058910369850e-02   +1.191821577072039e-02; +2.229684425469447e-02   +9.570468238765331e-03   +3.104032653973256e-03   -1.686869825364052e-03   +2.595698994672930e-02   +3.434326378050648e-02   +6.277721927352947e-04   +2.529041728527667e-02   +2.337709562311564e-02   +9.690725050921381e-03   +2.536411347138394e-03   -2.080285808644328e-03   +3.320545840064570e-02   +7.069868760365264e-03   +2.048489190785245e-02   +1.775933610617654e-02; +2.561082215432525e-02   +2.319260993472126e-02   +2.193739845764389e-02   +9.890908008555147e-03   +2.726178399234048e-02   +1.550709872806696e-02   +2.550439421047253e-02   +2.435492026451368e-02   +2.841301500614165e-02   +1.556121969665288e-02   +1.002996606308169e-02   +3.317422937005456e-02   +2.442731284853283e-02   +1.929071621455292e-02   +1.811205604000040e-02   +3.169736763711647e-02; +2.890657730622565e-02   +2.774755260432937e-02   +1.183475201047069e-02   +1.904799908360332e-02   +3.463528842017712e-03   +1.039140438459776e-02   +4.621791166975932e-03   +6.718022850557484e-03   +4.334250209362711e-03   +2.890182390025248e-02   +5.124553980678028e-03   +3.454881206076325e-02   +2.239634890967289e-02   +1.870208591163557e-02   +1.497515087034815e-02   +1.364718094621254e-02; +4.142670977288363e-04   +2.052522049013668e-02   +3.218869277224256e-02   +1.681792511220965e-02   +1.601604377173637e-02   +7.458448828956240e-03   +7.473972544920347e-03   +2.180352558922885e-02   +9.197198839973580e-03   +3.290064621609564e-02   +1.623051385953140e-02   +5.649472417059742e-03   +1.029065467285982e-03   +3.045115287554881e-02   -3.853154004980902e-03   +1.877645764711208e-02; +2.960547002901157e-02   +8.971523293232359e-03   +9.704699476243443e-03   +3.533692885532896e-02   +1.770475701628835e-03   +2.804949951887317e-03   +2.410056402549795e-02   +4.263513640502825e-03   +1.423510061907226e-02   +3.364546508605538e-02   +2.454864879369587e-02   +4.933003020271201e-03   +2.829186580104171e-02   +2.819626683267919e-02   +3.290526751311198e-02   +2.873062258609931e-02];
L1E_L1I_iGABA_netcon = [+1.554113884399832e-02   +2.619960577611814e-02   +9.231103936318398e-04   +1.377486788871391e-02   +2.926088400741829e-02   +1.082753668502072e-02   +1.798747078021935e-02   +1.237149869727452e-02   +5.686083232801638e-03   +1.203175471278371e-02   +9.201696340033889e-03   +1.540914265327327e-02   +1.096817053020172e-02   +3.162587063850152e-02   +3.118308095721816e-03   +1.167119434294496e-02; +7.514234680449780e-03   +2.350087304463499e-02   +1.752188959770818e-02   +3.070954349948993e-02   +1.396175508213405e-02   +2.011892030678744e-02   +4.813135235828169e-03   +2.227327082287510e-02   +1.938472776848858e-02   +3.288130909821864e-03   +7.505640515410051e-03   +2.942803817177730e-02   +8.206667723932342e-03   +2.146546637307646e-02   +1.696924280310460e-02   +2.881084099452252e-02; +1.753024643451321e-02   +3.794533310405910e-02   +2.832093069220968e-02   +2.319250826637810e-02   +1.771837832014552e-03   +1.620077806702551e-02   +2.315446502001272e-02   +2.496418541599480e-02   +3.082647096437816e-02   +3.102546878168118e-02   +1.892423760448175e-02   +2.075380133478024e-02   +3.616891402477244e-02   +2.372365015004927e-02   +1.468125761743868e-02   +2.162344170130087e-02; +4.395455473237076e-04   +6.375817428119135e-03   +3.167552787965675e-02   +4.447838794672592e-03   -1.799917707539814e-03   +1.975962731154825e-02   +2.554377537327591e-02   +1.301746990305567e-02   +1.372852195652096e-02   +3.150062110771858e-02   +2.035094434299593e-02   +1.518187241682130e-03   +1.803474824622665e-02   +1.113833514290182e-02   +4.813916474200516e-03   +2.933196903159048e-02; +1.401988331241567e-03   +3.252195521065207e-02   +1.344476452513676e-02   +2.484020066905133e-03   +1.780574466217278e-02   +2.505669570837141e-02   +2.100720990925593e-02   +1.466285109065445e-02   +2.570537394313222e-03   +4.873693405436157e-03   +2.962873014367706e-02   +3.957926183545352e-03   +2.549871007219848e-02   +1.671423009200630e-02   +2.093456039205131e-02   +1.403405251320117e-02; +2.843334240661958e-02   +2.859020652125762e-02   +4.003281625238659e-03   +2.452182833692567e-02   +1.009229587340302e-02   -8.777761842586273e-04   +2.577786464055645e-02   +1.056798845552887e-02   +2.622230487165379e-02   +4.352975443499196e-03   +2.501052284004712e-02   +5.530349877004041e-03   +1.551724227204104e-02   +7.642556701785144e-04   +2.268228605760988e-02   +5.624026587026713e-03; +1.976707423548724e-02   +9.181066495733633e-03   +6.589038114519082e-03   +1.014065945624405e-02   +7.297391742826137e-03   +1.376692664952844e-02   +1.019412708158158e-02   +1.437598816320611e-02   +3.338042290574518e-02   +9.659201387767326e-03   +3.262157735877728e-02   +3.363690667202125e-02   +4.343880320147402e-02   +2.577941162748112e-02   +1.917773053369829e-02   +9.130875319779892e-03; +9.572513328317555e-03   +6.266003460949554e-03   +1.463406394400785e-03   +5.447602352232457e-03   +1.983739191215279e-02   +1.520476922612154e-02   +1.811418697894697e-02   +1.945841825856245e-02   +8.372508730916061e-03   +1.232985399398092e-02   +2.723864408634117e-02   +4.045281230006126e-02   +1.616045805925923e-02   +1.785627502441520e-02   +2.886583198537985e-03   +2.594912961848088e-02; +1.141564088383255e-02   +1.720460821157484e-02   +8.813874554078774e-03   -5.358644160620712e-03   +1.164901867111869e-02   +2.248575248727534e-02   +3.307418631094476e-02   +3.401682528258781e-02   +1.435616815392475e-02   +2.205576027454714e-03   +2.540876006783100e-02   +1.421700695162105e-02   +3.090280290918546e-02   +3.406781022929868e-02   +1.648534848307872e-02   +8.617588783606394e-03; +2.869637524704433e-03   +1.103705911250411e-02   +3.010130141165210e-03   +2.034080373762510e-02   +1.086293270210989e-02   +2.575448405518522e-02   +1.433928994502634e-02   +5.635306557465594e-03   +3.217750177068346e-02   +2.958888535837667e-02   +5.166648280902008e-03   +2.059388519721400e-02   +3.189520783606752e-02   +1.126684474367810e-02   +2.021204040709033e-02   +1.351854595635052e-02; +3.259134420403360e-02   +1.596328293352638e-03   +9.103198736136202e-03   +1.469143611484096e-02   +2.309786418723011e-02   +1.849826678077755e-02   +1.919342459826504e-02   +3.360652258330239e-02   +1.227498595086898e-02   +1.072978822690202e-02   +2.118746627630372e-02   +1.823384704369943e-02   +6.543106361812506e-03   +3.148725360751090e-02   +2.762083432134125e-02   +8.394112024383270e-03; +1.168287762623560e-02   +3.416724877487706e-02   +2.121114528472312e-02   +3.075901761735861e-02   +3.519680029537379e-02   +2.343128503693449e-02   +1.635579889752477e-02   +2.554253246407380e-03   +2.369025602289151e-02   +1.685339865347681e-02   +2.605354570246082e-03   +2.838219043256260e-02   +2.083717726042281e-02   +2.235570169887886e-02   +2.204795703390865e-02   +5.513042651253393e-03; +2.786994480869990e-02   +5.769629423821805e-03   +2.179497532261310e-02   +1.422542580870389e-03   +1.576084670385338e-02   +2.262923253952617e-02   +1.717944432831314e-02   +8.565238161894594e-03   +2.914604733024723e-02   +2.894307783982531e-02   +1.088804532937193e-02   +2.226509063034916e-02   +3.795247637739450e-02   +2.220528228562644e-02   +1.019566423748838e-02   +4.877357721888242e-03; +1.059040163399087e-02   +6.129824945261975e-03   +1.742586045692686e-03   +1.317888359522474e-03   +5.494426743970234e-03   +3.017566996844589e-02   +3.407409067534636e-02   +2.744716528658501e-02   +1.023993011835369e-02   +2.191251723100392e-02   +2.585097445358438e-02   +2.325346922255916e-02   +2.302473263904506e-02   +3.024289348123496e-02   +2.501955484533379e-02   +2.547002525424028e-02; +1.928383026873353e-02   +7.273263909510502e-03   +1.730847451299910e-02   +2.514684376091056e-02   +1.642129906431114e-02   +1.535502334927244e-02   +5.530384919531850e-03   +1.219345595504983e-02   +8.169837509735116e-03   +2.309852092976466e-02   +9.650660608706610e-03   +1.538106755823392e-02   +1.077081342191953e-02   +4.605508769555253e-03   +4.577235907283411e-03   +1.356175410104238e-02; +1.477793245037632e-02   +5.195374001975644e-03   +8.632490257015672e-03   +2.855142210921379e-02   +3.231396739299913e-02   +6.918451519281555e-03   +1.021265756297785e-02   +2.732590552766512e-02   +2.772825137994226e-02   +3.552419351597652e-03   +6.758526978362404e-05   +1.595433795700918e-02   +2.483524685389745e-02   +1.863719002648121e-02   +1.608734661508143e-02   +1.820299082288870e-02];
L2I_L1I_iGABA_netcon = [+3.586888513518521e-02   +1.176047613045633e-02   +1.021628921216538e-02   +3.265416652870722e-02   +3.681773473617590e-02   +2.845996080793444e-02   +1.366417024026381e-02   +2.638907700693292e-02; +2.895838970424167e-02   +3.033040866552817e-02   +2.064328717360521e-02   +1.259474866483550e-02   +1.898865724222095e-02   +2.520059483504868e-02   +2.841133109706210e-02   +8.494678314553106e-03; +5.857582613144669e-03   +1.040824889597585e-02   +7.102912301466232e-03   +3.902179448310925e-03   +2.996590559817084e-02   +3.625867246466780e-02   +6.554581839028557e-03   +2.092115553703821e-02; +8.789010354670447e-03   +2.981481625371018e-02   +2.249898694307242e-02   +2.529413537548622e-02   +2.002991657579133e-02   +1.640158814393432e-02   +1.371749640945614e-02   +3.139624491090648e-02; +6.772187289225916e-03   +5.675004069322186e-03   +2.395653848106912e-02   +1.964090635595550e-02   +1.494290508137342e-02   +2.953834400282744e-02   +1.780080735771410e-02   +2.624066629482301e-02; +2.618519784425546e-02   +2.246334653337542e-02   +3.037630861825327e-02   +2.009726433437268e-02   +1.335660398961560e-02   +2.245400126749358e-02   +1.952581960615495e-03   +2.563442389114957e-02; +1.414184612171589e-03   +1.121001889558548e-02   +1.520114670489266e-02   +1.267529637225411e-02   +2.572916039162541e-02   +1.037128558892255e-02   +9.350253448508379e-03   +2.703996489341134e-02; +1.881322272730570e-02   +1.617650687032531e-02   +2.863144846283740e-02   +1.452490823338203e-02   +1.060668181715231e-02   +2.632897426301010e-02   +1.930534180404609e-02   +9.527676257151715e-03; +1.781531018964342e-02   +1.934895621697747e-02   +1.141558777894167e-02   +8.720351162709822e-03   +1.141985343773778e-02   +4.123393887894524e-03   +1.293633736503844e-02   +3.486083876767180e-02; +1.371392719400534e-02   +2.081453038219072e-02   -7.274753245874516e-05   +1.449084027683582e-02   +8.470702941574912e-03   +2.367948067264073e-02   +3.009937303840780e-02   +2.297678723220101e-02; +1.163332828912439e-02   +2.978156915755828e-02   +2.965357356036743e-02   +1.382719494222897e-02   +2.493937843367577e-02   +2.898823520225217e-02   +7.249932218433511e-03   +1.432435221230010e-02; +3.160913559220214e-02   +1.420317548650160e-02   +2.412383807847610e-02   +1.313511201180663e-02   +3.055955272934834e-02   +9.324804836426157e-03   +2.221726345787700e-02   +8.078352620208252e-03; +9.227458774622069e-03   +3.240609155222365e-02   +3.173347097739278e-02   +3.513206465762249e-03   +1.920477111221085e-02   +1.077811042357872e-02   +1.293698616170951e-02   +2.306522382163182e-02; +2.924123192408684e-02   +8.266707710809517e-03   +3.470311408649020e-02   +1.895134806561591e-02   +2.783057109891252e-02   +9.736647432270573e-03   +2.948590303749445e-02   +1.005877614749676e-02; +3.592465283848396e-02   +1.335300148029483e-02   +8.770048351876024e-03   +3.773658535005017e-02   +2.480719288030534e-02   +3.807902041463192e-03   +1.432872695015212e-02   +2.552203201136369e-02; +6.938336970302186e-03   +2.674091925066764e-02   +2.066825659123820e-02   +2.287187033519079e-02   +2.782380493914433e-02   -6.490087031004295e-04   +3.139407225763160e-02   +1.368067155144974e-02];
L1I_L2I_iGABA_netcon = [+2.161940973536473e-02   +2.218194778615236e-02   +2.729728996661114e-03   +2.247819701554612e-03   +1.582814201525521e-02   +1.386245962112240e-02   +3.477628482842234e-02   +2.361746480931785e-02   +1.173259213473650e-02   +3.269870684158021e-02   +4.985833493294814e-03   +8.081983602425027e-03   +2.888724082217693e-03   -5.628750882081758e-04   +7.440585141670375e-03   +3.205196657888931e-02; +3.178776265997624e-02   +2.156989694392379e-02   +1.644819949396122e-02   +1.479309674160312e-02   +2.968075631023871e-02   +1.978156924151489e-02   +1.530170756984532e-02   +3.511417317043606e-02   +1.882702151798851e-02   +3.453819706363194e-02   +2.289064787394134e-02   +1.253345652164401e-02   +1.885783738532655e-02   +3.581188566102705e-03   +5.223238325435484e-03   +2.931529027613471e-02; +2.817316444267454e-02   +1.943689564564318e-02   +6.552853566451527e-03   +2.677159109938205e-02   +1.450903796284594e-02   +3.164930138733642e-02   +2.141689306624937e-02   +2.210707687304090e-02   +1.418082548060308e-02   +2.159085483925975e-02   +2.015148575863162e-02   +1.693061268954518e-02   +1.818819512469412e-02   +3.497887640816808e-03   +2.196057608249644e-02   +4.400349548147795e-03; +1.658727702794067e-02   +1.585479098949655e-03   +2.404392132546875e-02   +3.076085127157604e-02   +5.853354864660335e-03   +4.332854862967626e-03   +1.433632904842080e-02   +1.005480847903459e-02   +3.611658408692652e-03   +2.295431635217028e-02   +1.373065567540972e-02   +1.004531847247234e-02   +1.009504823591246e-02   -1.243434988731127e-03   +2.473459681978703e-02   +1.834027272099583e-02; +5.939564197149425e-03   +3.073563118923121e-02   +2.908229973164112e-02   +2.287347666152426e-02   +2.407751130293440e-02   +2.438550785993356e-02   +2.011248181879441e-02   +3.541420541987231e-02   +1.607687575251114e-02   +6.557611518120699e-03   +1.103744187946529e-02   +4.222182164482014e-04   +9.567276241175159e-03   +3.344358846117847e-02   +7.625477758710992e-03   +2.171854477832942e-02; +2.341835475310422e-02   +2.429058447445678e-02   +2.738156631479841e-03   +3.310869630961252e-02   +1.887400839986660e-02   +3.448001190969190e-02   +2.827029233548592e-02   +3.252790591329633e-02   +2.469968046858871e-02   +2.110060693886841e-02   +2.978654199830596e-02   +2.369958518917896e-02   +5.206510810136337e-03   +3.169072667153344e-02   +2.530782370469815e-02   +2.972407829621762e-02; +3.391125691730291e-02   +7.454894795344760e-03   +2.655415170986401e-02   +3.384686222972189e-02   +1.497316769843051e-02   +3.732672864852236e-02   +1.844400120913156e-02   +1.493772256460764e-02   -3.647028043461083e-03   +2.272913845548333e-02   +1.454096960603747e-02   +7.732969838770862e-03   +2.624795106178873e-02   +1.393469945371626e-02   +3.201067341668052e-02   +2.083642372770510e-02; +2.584447434213118e-02   +2.549979459738777e-03   +3.021986625498098e-02   +2.413483592913883e-02   +3.539066376212474e-03   +2.920159192902462e-02   +2.540655761293262e-02   +2.729161136701236e-02   +1.537618352045120e-02   +2.860824685644630e-02   +7.808685647454425e-03   +1.402115353299377e-02   +1.700412443162552e-02   -3.001599580922923e-03   +3.254976000236310e-02   -6.807545293323428e-04];
L2E_L1E_iAMPA_netcon = [+2.903539341144007e-02   +9.610429286543955e-03   +7.257486849102294e-03   +3.817048051983083e-02   -1.636378180446473e-04   +1.240483050644291e-02   +2.723993730201803e-02   +5.641814480876313e-03; +2.589756866208758e-02   +3.421786751506919e-02   +2.010817710605230e-02   +1.208953537484762e-02   +2.144618093555868e-02   +1.265952211525559e-02   +3.314141879853512e-02   +1.737904834105896e-02; -3.851543381438042e-03   +2.586635151998887e-03   +5.741768856929236e-03   +8.535245098524618e-03   +2.254979979092788e-02   +3.429522382192892e-02   +1.495531497656740e-02   +7.247223200928435e-03; +8.435703757167293e-03   +2.785984455951440e-02   +1.177375605730956e-02   +2.325575557239144e-02   +2.982152283182773e-02   +9.859394794796261e-03   +2.542406412347643e-02   +3.361203049329304e-02; +8.830182686740176e-03   +3.549573101741776e-02   +1.976491141288396e-03   -5.349514876894527e-03   +2.945983992240186e-02   +3.488743735990803e-02   +2.480299733779665e-02   +1.259617475200468e-02; +2.392532840748259e-02   +1.529839303587947e-02   +3.006213072088737e-02   +2.587645274251428e-02   +1.942734363587366e-02   +6.906627722826335e-03   +1.937987208096645e-02   +2.579289865038806e-02; +6.826650779643013e-03   +1.137074199389042e-02   +4.590525029518925e-03   +1.282139135031144e-02   +2.631207946867416e-02   +1.233938158181875e-02   +3.526857324618617e-03   +1.109306535018052e-02; +7.465542423711315e-03   +3.517566233020312e-03   +1.589254188082372e-02   +2.396993527676553e-02   +1.342821836742847e-02   +3.522536062405715e-02   +2.856997048786851e-02   +2.540043220996452e-02; +1.122934416588236e-02   +3.036567077674961e-02   +1.828533226869807e-03   +7.751413996848850e-03   +4.963792530413663e-03   +3.607387600615886e-02   +1.107412534688691e-02   +8.224935522319690e-03; +8.384381599865088e-03   +6.393191358776726e-03   +3.355477160544799e-02   +1.579813713426571e-02   +3.526911210493833e-02   +1.596049692124340e-03   +9.348079572532426e-03   +2.506560095851970e-02; +2.335938001290735e-02   +1.247650523593114e-02   +3.807781757316311e-04   +2.077575059631347e-02   +1.472512057951956e-02   +7.405496921408747e-03   +2.455797656076462e-02   +2.608003410472005e-02; +8.427717718209368e-03   +1.320914306918218e-02   +3.010146102855824e-02   +1.968691308404895e-02   +2.032590695461859e-02   +7.138760096598229e-03   +2.892271914808425e-02   -1.939211315536197e-04; +1.851749768658861e-02   +2.355569149865794e-02   +2.222072482741526e-03   +4.041711093061989e-03   +3.351006970262540e-02   +2.103374308642237e-02   +1.683050275795881e-02   +3.278604811587852e-02; +1.515219246840323e-02   +2.015638253194296e-03   +4.684020432351135e-04   +3.012710579027594e-02   +5.381055495614510e-03   +6.017195673143685e-03   +2.286595826201010e-03   +2.958166240561907e-02; +9.026868641771747e-03   +8.991051288638920e-03   +6.251477289033990e-05   +3.341738206677419e-02   +6.164125104011237e-03   +3.468928398025682e-03   +1.479755386439590e-02   +3.168993539667988e-03; +9.176349828183598e-03   +1.780322672798916e-02   +1.339537589939898e-03   +1.751993638007628e-02   +3.479673101682334e-03   +2.171022756387842e-02   +1.196960882060239e-03   +3.109310528214547e-02];
L1E_L2E_iAMPA_netcon = [+3.028679242923741e-03   +7.160086474650605e-03   +3.275589286432114e-02   +3.038382087955819e-02   +1.498467653731740e-02   +3.269325408639623e-02   +1.800587625716291e-02   +3.932619304078810e-02   +5.104902412133891e-03   +1.741494742873920e-02   +1.957952571361237e-02   +2.247076029398741e-02   +1.374352682954648e-02   +2.284203965299814e-02   +2.373874469777727e-02   +2.026178405755221e-02; +1.282203952305722e-02   +2.477792222463522e-02   +2.647411833200846e-04   +1.199225837898590e-02   +2.789989282385261e-03   +2.642376215956620e-02   +4.159258014366890e-03   +5.463496149271508e-03   +7.763038275158681e-03   +1.095903413072710e-02   +1.124232210618009e-02   +3.424240585879761e-02   +1.994095201913873e-03   +8.249098983167589e-03   +1.612771912953934e-02   +1.177991700532143e-02; +1.158180453498496e-02   +1.998117152656581e-02   +3.149917991644722e-02   +2.618733603537931e-02   +3.300785562543569e-02   +8.249021800231590e-03   +1.530887840971275e-02   -3.053947949512851e-03   +1.592376033797593e-02   +2.257673037328811e-02   +1.052638156716879e-02   +4.624372688709329e-03   +2.173475722054561e-02   +2.049540674319526e-02   +3.177506729791725e-02   -2.034781944551514e-03; +2.411230955151053e-02   -1.633817626088377e-03   +2.217187676891741e-03   +7.265542345585879e-03   +2.842308947570965e-02   +1.155389269719923e-02   +3.062499824807683e-02   +3.548982041944920e-02   +2.788558058014717e-02   +2.496055458372362e-02   +8.995921558999524e-03   +1.711631994728950e-02   +3.513875759992779e-02   +1.222180145758864e-02   +3.510427359345405e-02   +3.191819683153605e-02; +3.234085346937125e-03   +4.102227586994316e-02   +2.307074771072959e-02   -3.800400935265573e-03   +8.628437334643134e-03   +2.505288828011774e-02   +2.877273899720696e-02   +4.361810242819637e-03   +2.348684941150116e-02   +1.206588164744743e-02   +1.598230540323424e-02   +2.756039527180182e-02   +6.229818664192933e-03   +1.793532775697976e-02   +3.248209428384211e-02   +1.432189778398839e-03; -7.645551195677314e-04   +2.780542685217399e-02   +1.201038087474263e-02   +3.253076726644492e-02   +3.381356535185159e-02   +3.032767627693372e-02   +1.424302955045739e-02   +2.866487689645467e-02   +1.403829541447917e-02   +1.446058657622701e-02   +2.725157766727304e-02   +3.360505817641120e-02   +2.942210937224946e-02   +2.145754802186867e-02   +7.565385180456809e-03   +1.852391847479811e-02; +6.969689885182428e-03   +7.271324740778684e-03   +2.346047245098452e-02   +7.948163791185969e-03   +1.092562991401783e-02   +1.845633810608933e-02   +2.179016459307307e-02   +2.239899320244892e-02   +1.972997124892591e-02   +2.838783211376155e-02   +2.601517961517507e-02   +3.386155933714911e-03   +1.176493649358323e-02   +2.443881246413309e-02   +9.485498645426985e-03   +1.099718506214767e-02; +3.946906340452100e-03   +1.624892138722157e-02   +1.907043344995203e-02   +1.555923481363336e-02   +2.276428127532271e-02   +3.542591647495887e-02   +2.932978767509473e-02   +2.059270142081742e-02   +3.059600810000195e-02   +1.626236670557304e-02   +1.148263581042693e-02   +3.591503533213772e-02   +2.891801123087107e-02   +2.425840336985760e-02   +1.038417244474369e-02   +8.133501497579798e-03];
L2I_L2E_iAMPA_netcon = [+2.155204978785513e-02   +1.287125883603743e-02   +2.809798096566909e-02   +1.942161992074415e-02   +3.075223041218419e-02   +3.932904764337196e-03   -5.276271510160159e-04   +2.887320619375548e-02; +3.971184547071790e-03   +2.721626253959140e-03   +6.101829235502679e-03   +2.802891899764917e-02   +2.586091370958772e-02   +1.475755271229426e-02   +2.835780218294399e-02   +1.971889418029219e-02; +2.719132058028004e-02   +2.649553719599717e-02   +2.884347839647511e-02   +2.149202332829811e-02   +2.023478399742476e-02   +1.731912060060773e-02   +1.273425429657814e-02   +2.352879815146543e-02; +1.106151695916887e-02   +1.140067891674859e-02   +3.284649269138129e-02   +1.309669001201424e-02   +3.455890651503798e-02   +3.851066086606379e-03   +5.711052482070679e-03   +2.933795662357716e-02; +2.115679929651221e-02   +2.977285575609696e-02   +1.236392885197956e-02   +2.070281878361725e-02   +2.881912611593660e-02   +2.233496102168125e-02   +1.552011859832672e-02   +2.488368680670895e-02; +2.487638632079984e-02   -1.849701445321091e-03   +3.166476682511194e-02   +2.863509688220357e-02   +1.901210711949505e-02   +8.318149274735859e-03   +3.532105713454994e-03   +2.890112037223453e-02; +3.285385978574153e-02   +1.504220343929937e-02   -3.043702930071318e-03   -1.784918008560308e-03   +7.665939061855488e-03   +8.438813552128357e-03   +6.977933634074797e-03   +9.304479539028163e-03; +3.023939501966252e-02   +5.508457941033896e-03   +1.429419884024724e-02   +1.795867993756462e-02   +2.740597501291883e-02   +1.092974480657440e-02   +6.414746739052049e-03   +8.184344282318042e-03];
L2E_L2I_iGABA_netcon = [+3.373945149958025e-02   +5.613695659831937e-03   +5.766547244895746e-03   +5.219691800961396e-03   +3.023971219028359e-02   +1.398583980639918e-02   +2.175830480091181e-02   +3.400488573222781e-02; +1.165562304266853e-02   +1.639493156784693e-02   +6.062214611764505e-03   -1.640842136450305e-03   +3.461744742852604e-02   +2.776787235032289e-02   +2.728051683736218e-02   +6.248898017687876e-04; +1.790273004208921e-02   +9.640436607516203e-03   +1.680929867714245e-02   +1.898458892592977e-03   +1.224704445909565e-02   -2.523503064795625e-03   +3.694982406205415e-02   +2.763736705636860e-02; +2.504940936873386e-02   -1.889460852232478e-03   +4.649552304652491e-03   +2.493736664114854e-02   +2.905345626788735e-02   +2.973024093294142e-02   +1.312484032526651e-02   +1.883288306543444e-02; +4.557817030357224e-03   +2.494678160937573e-02   +3.593395790367373e-03   +2.487081544583435e-02   +1.263154981359471e-02   +1.158961143489968e-02   +1.644148289596197e-03   +7.995208306844600e-03; +2.180831714581489e-02   -9.318848733576720e-03   +2.180171729450920e-02   +3.074490031053900e-02   +2.802759108969129e-02   +1.362572470045452e-02   +3.466836535362023e-02   +2.822710954466380e-02; +4.115284021382737e-03   +3.800513271800510e-02   +1.050148593165785e-02   -3.163531648260370e-03   +2.844779197347525e-02   +1.037647705122484e-02   +1.472813344089087e-02   +1.683611945121926e-02; +2.891064651097403e-02   +1.011408274997481e-02   +1.838884829608615e-02   +1.042737631032134e-02   +1.397191716315880e-02   +2.464294836502373e-02   +3.000202931811746e-02   +2.543164662541140e-02];
L3E_L2E_iAMPA_netcon = [+1.642696872855170e-02   +2.327848275456456e-02   +4.431014656454167e-03   -2.227350780638212e-03   -1.494494130047159e-03   +3.555271151338805e-02   +1.448991248531726e-02   +2.945481183350633e-02   +1.464243588228288e-03   +6.555017447257967e-03   +1.473182629283437e-02   +3.112315608265913e-03; +8.484874351461013e-03   +3.174544250762042e-02   +1.362343316447320e-02   +1.691874423962354e-02   +2.167216881355338e-02   +1.807259343114687e-02   +2.812777186825352e-02   +2.847936856153355e-02   +2.167285226911353e-02   +3.260864912813353e-02   +1.297640479757848e-02   +8.206352061755393e-03; +4.064099052121258e-03   +3.141277852554484e-02   +1.651015714652247e-03   +2.912740834360776e-02   -1.500326440748779e-04   -2.080645202621952e-05   +1.853908224765903e-02   +3.177012248353737e-02   +1.814498024655795e-02   +1.586109756364025e-02   +8.194290997523057e-03   +1.933785060276947e-02; +7.059740929297592e-04   +1.341960731220338e-02   +2.684604839061546e-02   +1.515418728025188e-02   +5.657419846671328e-03   +2.299217692564837e-03   +1.155341476288358e-02   -4.476434538528652e-04   +4.348779466641049e-03   +1.388730696119903e-02   +7.577055590907602e-03   +1.526201341149480e-02; +3.023374899710264e-02   +9.732656629050812e-03   +1.114972909352282e-02   +3.135097622848989e-02   +2.501799843291073e-02   +1.240566470617515e-02   +2.894754753887505e-02   +5.417707387224869e-03   +2.899824490561287e-02   +1.794029831908651e-02   +2.769558070589750e-02   +1.258835458610692e-02; +2.740798407638406e-02   +2.181418995949617e-02   +4.623033123752300e-03   +1.455767511020567e-02   +1.593092033862704e-02   +3.471930789528157e-02   +3.709135615461159e-02   +1.165487968608977e-02   +1.876539594358924e-02   -5.753935756120363e-05   +2.102618756372214e-02   +1.595820337135509e-03; +2.451748753556827e-02   +1.085414562133939e-02   +1.540158673532981e-02   +8.095051165880144e-03   -2.462801778384074e-03   +1.867163089362202e-02   +3.216665759822825e-03   +1.918252631865677e-02   +9.988605259686614e-03   +1.539097929242277e-03   +1.412851583354271e-03   +1.626571682292293e-02; +2.672764193811182e-02   +4.213313044336003e-03   -1.856047664577378e-03   +1.246927397832172e-02   +1.411110991610176e-02   +3.643694251760944e-03   +5.194852863100730e-03   +1.122666775336080e-02   +1.551781091997029e-02   +2.961001333820219e-02   +2.063632248110266e-03   +2.122775497056897e-02];
L3I_L2I_iGABA_netcon = [+3.629799724675779e-02   +1.976652748754401e-02   +2.082782220402708e-02   +1.691827998072259e-02   +3.224757360964708e-02   +1.896829054596210e-02   +4.966108631647898e-03   -3.178980793763093e-04   +3.318112600494336e-02   +1.540790513206478e-02   +5.851352789575223e-03   +2.879017813408070e-02; +2.759828938519550e-02   +3.902850660947972e-02   +3.051476033333806e-02   +8.769866521158581e-03   +1.397593477583722e-02   +2.407736090987106e-02   +1.123793353908057e-03   +2.945793026135417e-03   +2.235332392280960e-02   +2.263089437962731e-02   +1.793156659870365e-03   +2.549203449562580e-02; +2.540116351698002e-03   +2.566366610692188e-02   +3.237212015634360e-02   +4.324176585239067e-03   +2.678252033201354e-02   -2.809902028303917e-03   +2.612540263768372e-02   +3.390939706620299e-02   +2.216087439707613e-02   +1.160033453954191e-03   +1.862493768754375e-02   +2.380044942346349e-03; +3.267204817578826e-02   +2.047332831696549e-03   -3.627335186347777e-03   +2.672390261096140e-02   +2.998120614347206e-02   +1.614870390189625e-02   +1.086898396423178e-03   +3.331357884058488e-03   +3.610800530400116e-02   +2.371709662802573e-02   +3.202773166576109e-02   +2.319722268301819e-02; +1.080408965826831e-02   +3.852693750187149e-02   +8.491426711319642e-03   +1.378629218581879e-02   +2.024278560643057e-02   +3.490749584183666e-02   +1.115668547960047e-02   +2.084505535507375e-03   +2.885014375562251e-02   +2.356905938868517e-02   +4.426934711981527e-03   +1.096656223739533e-02; +1.835428120261589e-03   +2.424657116475728e-02   +1.140014271527027e-02   +4.774799360816647e-04   +2.615619387137971e-03   +2.136537290712939e-02   +2.664069882603681e-02   +1.760015776946615e-03   +1.598606544358617e-03   +2.378047407257890e-02   +2.366584304634217e-02   +7.044826988338468e-03; +2.206988192017070e-02   +2.874287035265786e-02   +2.191312141540500e-02   +2.635321934562186e-02   +1.790958275539244e-02   +7.155697141064856e-03   +1.804936981192830e-02   +3.798803923658273e-03   +2.952578204933871e-02   +1.203092454545080e-02   +1.829658049269942e-02   +2.314278280421495e-02; +1.665007618116125e-02   +8.914557875670923e-04   +1.198350412178467e-02   +1.744553296916967e-02   +1.398519432575996e-02   +1.198115607590510e-04   +6.035974515829597e-03   +6.546220581087026e-03   +1.977850051268583e-02   +3.018040988639633e-02   +7.803791904251444e-03   +1.252812277211755e-02];
L2E_L3E_iAMPA_netcon = [+2.444544208702759e-02   +1.752269224006965e-02   +1.052207464661569e-02   +2.772981564369328e-02   +8.832532528770859e-04   +2.374152961735435e-02   +2.783176581784825e-02   +3.407385885275042e-02; +2.116808681689191e-02   +2.635852449059388e-02   +2.508399120604661e-02   +2.079259232995086e-02   +2.270153551264607e-04   +2.131630112169642e-02   +3.278877615504620e-02   +2.194532142473762e-02; +2.611239284833430e-02   +3.027676260355876e-02   +3.376590453305241e-02   +2.975280136394829e-02   +2.743380809279523e-02   +2.879326557264717e-02   +2.542742687663983e-02   +2.347835507669617e-02; +1.435031220741586e-02   +3.189395451356227e-02   +3.040290900061136e-02   +1.832706023107387e-02   +1.523191201420101e-02   +1.703762221125084e-02   +9.498147887543613e-03   +4.778709721466414e-03; +4.428861982648954e-03   +1.982820584430557e-02   +7.307292590205875e-03   +3.429285167759137e-03   +6.874077594975618e-03   +1.649389240388562e-02   +3.123403254586996e-02   +2.975351819060355e-02; +1.820182009932973e-02   +3.469969684176692e-02   +2.887260711438366e-02   +2.036571239270148e-02   +1.812216234605980e-02   +3.355211706505606e-02   +1.867847663247260e-02   +3.027374590990829e-02; +1.494488632261596e-02   +3.042463403349138e-03   +1.763861616627388e-02   +5.563479421144235e-03   +1.135565358103001e-02   +3.453162166952033e-02   +5.738752987316326e-03   +2.088220032808134e-02; +2.926389728374736e-02   +2.176757256116836e-02   +1.902528892826780e-02   +3.048793457077105e-02   +1.363694214738771e-02   +2.643244526484256e-02   +2.056791511198588e-02   +1.544388984611262e-02; +1.139221654159092e-02   +1.964867015225921e-02   +3.538565509003882e-02   +1.983983686486501e-02   +1.975491019469846e-02   +6.894320269898530e-03   +2.423967160057788e-02   +2.195117540096405e-02; +1.070531120377518e-02   +8.400361721097954e-03   +2.682814436009349e-02   +3.033596471367846e-02   +3.784453104299242e-02   +2.814983694359236e-03   +2.104591286022528e-03   +2.338393449453377e-02; +1.680085885009892e-02   +1.027108644260877e-02   +2.669425979923063e-02   +2.457542101204363e-02   +3.460936607660913e-02   +3.771744170392838e-02   +9.481830832241262e-03   +1.281842030803909e-02; +3.112612231584890e-03   +2.292648657204625e-02   +1.218400287700091e-02   +2.508574902472521e-02   +1.618410645543481e-02   +4.759464048396127e-03   +2.688485435843560e-02   +3.117781959528506e-02];
L2I_L3I_iGABA_netcon = [+3.164207917580564e-02   +1.420438258275135e-02   +8.992875645263916e-03   +1.776730764896135e-02   +3.087392242418477e-02   +2.933547871288904e-02   -4.477187761095620e-03   +1.458845919782210e-02; +1.661541897049826e-02   +1.658182595885297e-02   +2.514206944939541e-02   +6.077767549638272e-03   +2.624180850996478e-02   +2.648926273761711e-02   +1.680702565167249e-02   +1.377492283011359e-02; +2.524898516106151e-02   +2.658956856039282e-02   +3.093441582379543e-02   +2.403232148438416e-02   +1.753073753587994e-02   +1.997484315214501e-02   +1.594738384227659e-02   -8.565853485272734e-04; +6.424719817544607e-03   +2.918778268040658e-02   +2.580922673527906e-03   +1.361629505331356e-02   +1.696758540393582e-03   +1.129469146660964e-02   +1.563590040910823e-02   +3.295329296542598e-02; +1.459240720498170e-02   +1.531063835397127e-02   +1.927234665473572e-02   +1.405005227556767e-02   +1.496864855865581e-02   +1.839024700073594e-02   +9.344156407166660e-04   +8.079242438511909e-03; -1.787491752562018e-03   +6.415643059177916e-03   +1.509992691758686e-02   +5.607635808338330e-03   +1.322023571680170e-02   +1.749071016172337e-02   +1.065705585077168e-02   +2.690096497253676e-02; +1.062285918047418e-02   +1.408143966898047e-02   +3.132462023980090e-02   +2.492097940856871e-02   +2.884310151784894e-02   +7.312295419719583e-03   +1.484879513037427e-02   +1.253319163850425e-02; -1.847231614377540e-03   +3.428972979415240e-02   +7.711548478634405e-03   +2.614682762378856e-02   +6.584791102280615e-03   +2.996724212568520e-02   +2.329096163808116e-02   +2.254852615209700e-02; +2.424603634860623e-02   +1.250995326540359e-02   +3.061718826016837e-02   +2.607830654882382e-03   +1.540287328496973e-02   +5.718314630303611e-03   +8.387457036302432e-03   +1.686880499276892e-02; +2.578665044417977e-02   +1.746941698276834e-02   +3.758137396351834e-03   +1.579925977938073e-02   +1.541492979020374e-02   +4.509000653009660e-03   +5.905395302598648e-03   +9.994809767209269e-03; +2.673158654198131e-02   +3.430525007581047e-02   +2.118330176273561e-02   +2.363718068751052e-02   +9.773635068187944e-03   +1.358392411181756e-02   +3.015438402121347e-02   +9.495534579751334e-03; +2.265744964082753e-02   -6.390757244465348e-03   +1.240715002406261e-02   +6.484637789172597e-03   +7.565896757758869e-03   +3.260029313747987e-02   +2.276308442071856e-02   +2.437674466738365e-02];
L3I_L3E_iAMPA_netcon = [+1.567768647379904e-02   +3.445138870546589e-02   +7.151748144649986e-03   +2.055201907710621e-02   +2.620371150159645e-02   +1.948962960794341e-02   +1.268652544078800e-02   +3.561766934117031e-03   +1.681523478888763e-02   +1.456165543220821e-02   +9.290722564573585e-03   +5.291956089388708e-03; +1.392759343307322e-02   +2.762059186076974e-02   +1.052261087474780e-02   +3.848102011386596e-03   -4.188768954877905e-04   +1.844123514598597e-02   +2.475547113445569e-02   +1.216571325772745e-02   +1.120956611425559e-02   +1.654065507956316e-02   +2.583483525347166e-02   +2.175746141822831e-02; +3.163025708389372e-03   +1.657005240577441e-02   +1.131836319004631e-02   +2.179553186678663e-02   +1.965197080737597e-02   +1.699071485228408e-02   +1.872205108353702e-02   +9.740712233107804e-03   +1.429602284711162e-02   +1.737218281070210e-02   +1.255052485742222e-02   +2.123095796533522e-02; +1.862022915943447e-02   +2.778701788876275e-02   +2.016976340744191e-02   +1.429543474193225e-02   +2.319923386959052e-02   +2.655371791399589e-02   +2.816131972877981e-02   +5.170522426572333e-03   +3.110644439645167e-02   +3.258055582563896e-02   +1.412811661987299e-02   +2.063896228802434e-02; +2.693103994642004e-03   +1.393519107242967e-02   +4.404784926023243e-03   +2.599283574868624e-02   +2.788714233517947e-02   +1.705692843176284e-02   +3.284725679777501e-02   -2.656385931872031e-03   +2.931140648865957e-02   +1.613377043500991e-02   +1.086220548215083e-02   +1.142052440744766e-03; +9.275218603318338e-03   +1.762661063742975e-02   +3.163066336528970e-02   +2.052520871752192e-02   +3.207427081547559e-02   +3.430222884253105e-03   +2.565169281902457e-02   +1.085045218442559e-02   +2.444662625888862e-02   +1.176500100708183e-03   +6.239366185821858e-03   +4.664915674300394e-03; +3.002988683323870e-02   +1.315499529735317e-02   +9.310388084942346e-03   +1.421955842963932e-02   +1.505187735436878e-02   +9.863177086998598e-03   +1.618291435059893e-02   +3.270231865358603e-02   +3.157614581874450e-02   +3.930048041582327e-02   +1.378664407535918e-02   +2.775036225714701e-02; +2.886014541713697e-02   +3.886125737259877e-03   +2.532513925698485e-02   +2.239380386248303e-02   +3.697786226967265e-02   +2.258433119389876e-02   -3.006339970025490e-03   +2.256878751733677e-02   +1.990592679456260e-02   +9.024587009047961e-03   +9.656907578499867e-03   +3.609762822220440e-02; +4.342858776078097e-03   +3.184900798147438e-02   +2.218423082229462e-02   +2.074108340604005e-02   +1.516272088503553e-02   +2.474945209880678e-02   +1.049198994408723e-02   +3.009028331866111e-02   +2.360437524204406e-02   +1.294754072097913e-02   +1.374142522157771e-02   +8.526037402030937e-03; +2.846213515098771e-02   +3.086572238994929e-02   +1.827368509346873e-02   +6.114889781435300e-03   +2.003046281684927e-02   +2.920460050501183e-02   +2.163316930202959e-02   +3.223377119633630e-02   +2.768058508991681e-02   +1.196007549350280e-02   +2.838389310051933e-02   +7.746629872573346e-03; +1.403076544174289e-02   +1.673239511870734e-02   +3.461352296755763e-02   +3.214319755269679e-02   +1.746239627420862e-03   +2.052473474837714e-02   +8.754562467530261e-04   +4.690980970901596e-03   +2.286047920951162e-04   +3.106879705120990e-02   +2.127464489146019e-02   +1.049622303391666e-02; +4.274504341393046e-04   +9.409809197487544e-03   +4.437753711807187e-03   +2.230167856395376e-02   +1.555634556050027e-02   +1.374152256582354e-02   +2.784369570892585e-02   +4.175907666283476e-03   +1.027643798684810e-02   +5.175851066265752e-03   +2.585511317394158e-02   +1.333183497693289e-02];
L3E_L3I_iGABA_netcon = [-4.710185529355780e-03   +1.781051561593011e-02   +1.263915730975975e-02   +3.871164657495123e-02   +2.463737026775946e-02   +2.279237953532094e-02   +1.545874876964200e-02   +2.288079515033909e-02   +1.885593307000516e-02   +2.742853764504828e-02   +1.839454984976303e-02   +7.094610948596168e-03; +2.749298358920164e-02   +2.452176713468431e-02   +1.196541924757527e-02   +1.602232732183463e-03   +1.073129367380046e-02   +2.463501764231951e-02   +2.210215776559789e-02   +3.826945522626410e-02   +2.829059724554332e-02   +1.732438563434096e-02   +7.414634667246376e-03   -1.627966371663802e-03; +1.755874064468040e-02   +3.331043217891370e-02   +2.687381932484889e-02   +3.101823776462269e-02   +1.739916388457393e-03   +2.404160822817065e-02   +2.285263712512174e-02   +2.536195629230646e-02   +1.149796263529638e-02   +1.436178524737492e-02   +1.169301144606495e-02   -1.310558982042258e-03; +1.193129953836820e-02   -1.514823827697498e-03   +4.782174111258968e-03   +2.750658202636476e-02   +2.423420502163942e-02   +9.833088408649762e-03   +6.879554678950826e-03   +1.661411439812465e-02   +3.345638667401298e-02   +9.042895426915828e-03   +1.452681845221921e-03   +2.168857811884973e-02; +1.273542822248750e-02   +1.317145497117960e-02   +3.907530753956415e-02   +6.579835546602395e-03   +1.432163260685177e-02   +2.724849442737187e-02   +3.348513023683325e-02   +2.999162491578566e-02   +1.221570504687323e-02   +2.323651950549752e-02   +3.417601652557144e-02   +2.383188362145685e-03; +2.446241841559307e-02   +1.087494405952093e-02   +2.532259203710279e-02   +5.470680964776440e-03   +8.085237058355671e-03   +3.710866130491592e-02   +4.399044455606347e-03   -7.828964168418523e-03   +2.738448440618989e-02   +2.486401209455230e-02   +7.443315463192263e-03   +1.810030773812815e-03; +1.998603561369257e-02   +1.417474546847030e-02   +1.840693880548286e-02   +2.060536877065392e-02   +1.921106838120264e-02   +1.324889518660450e-02   +9.773515471871280e-03   +2.749551267997958e-03   +1.906767949877166e-02   +3.742654281885965e-03   +9.293999583923906e-03   +2.087033663702590e-02; +5.647315121527338e-03   +4.986548508306250e-03   +6.285109811114879e-03   +3.280137469005995e-02   +1.091941138231386e-02   +2.535134144423145e-02   +1.549598105346948e-02   +2.445580177163828e-02   +2.611157980985667e-02   +2.974610497657017e-02   +9.561893631844280e-03   +1.974483203567429e-02; +1.200757479910110e-02   +2.625983287493499e-03   +3.178711941122435e-02   -3.941280086789953e-04   +3.671711953973989e-02   +2.899390311013669e-02   +9.177688139531161e-03   +2.549477636320470e-02   +4.998850394324125e-03   +6.345407587696914e-03   +1.392523508732996e-02   +1.993183848179570e-02; +3.019699415851641e-02   +1.007902811222430e-02   +3.201022941295579e-02   +8.356613165239711e-03   +7.284641273279399e-03   +4.004047795272999e-02   +1.982631158751057e-02   +1.879570993329806e-02   +3.488941448168223e-02   +3.169464990607282e-02   +8.636940059447460e-03   -2.652322149964411e-03; +1.590828390396673e-02   +3.038152754539266e-03   +1.067756091086088e-02   +3.044160506489921e-03   +1.807194925937637e-02   +1.864590846935876e-02   +3.406154619120932e-02   +2.713522579293168e-02   +2.088615562324822e-02   +5.449665997530486e-03   +7.804138770111974e-04   +2.669715080528355e-02; +2.245533929381597e-02   +1.991130124997895e-02   +3.432142595692254e-02   +2.436758584646172e-02   +7.280824393695682e-03   +1.095129470511252e-02   +3.359106909839695e-02   +3.211470917816553e-03   +2.750277338397623e-02   +1.612529475201317e-02   +1.817804690138069e-02   +1.242711386907096e-02];
L2E_Input1_iAMPA_netcon = [+3.556433285559650e-02   +3.260717902232184e-02   +2.784951729896590e-02   +3.474333168426016e-02   +4.126306123516616e-02   +3.819834655862307e-02   +3.545639249973874e-02   +2.845780644186989e-02];
L2I_Input2_iAMPA_netcon = [+3.004409250627876e-02   +3.560017585412973e-02   +3.885670205577352e-02   +2.964270526917833e-02   +2.939949972021365e-02   +3.899223557987466e-02   +3.604628880034545e-02   +2.994799002631187e-02];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last =  11.21 * ones(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.0*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.2*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.0*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.2*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.0*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.0*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.2*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.0*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.2*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.0*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
