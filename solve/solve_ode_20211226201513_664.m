function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+5.842543348460211e-02   +3.036781099822812e-01   -9.080873824331287e-03   +2.162544806886360e-01   +5.975206515920306e-02   -1.749948325886131e-01   +2.442485271633449e-01   +1.354396980174207e-01   +6.431171725235507e-02   -2.330272950337521e-01   -2.492290252741665e-01   +2.543118549556993e-01   +1.047186313039758e-01   +1.445880319009188e-02   +1.486932813501229e-01   +1.089798474997267e-01; -3.648274414903710e-02   -1.581356971146784e-01   -2.909110208150745e-02   +1.380850065992716e-01   +1.302089166367041e-01   -3.749215346304943e-02   -1.042237801560379e-01   +1.027852064850359e-01   +2.347134963861318e-01   +6.269842647368998e-02   +2.930310492289794e-01   +3.353824543230252e-01   -1.693174390040538e-01   -6.939484566582817e-02   -4.378661687015336e-01   +1.155971261706334e-01; -6.994208009688779e-02   -2.837021677210763e-02   -7.359961258935407e-02   +3.873490228733126e-01   -4.754682718871819e-01   -2.215200540931875e-02   +3.934306994596260e-01   +1.270617419202142e-01   -3.956489549019271e-02   +2.170149283714177e-01   +1.124833577297169e-01   -2.185526118799469e-01   -6.179202358844674e-02   +1.508886080285228e-01   +1.784222457875571e-01   -7.009221799739601e-02; +2.473032430769934e-01   -9.882857821310517e-02   +1.632267697099688e-01   -8.816572975418693e-02   -1.724326054376139e-01   -1.388585787783414e-01   -1.507449792346242e-01   +3.702038527189284e-01   +6.863488410550844e-03   -5.732637728731943e-01   +4.318307628675190e-02   +2.366012220555189e-01   -3.790733021159479e-01   +5.317117856268785e-01   +5.731424807106554e-02   +1.472581965448595e-01; +1.519246530613745e-01   -5.041250291707432e-03   -8.235026583862656e-02   -6.222807209953402e-01   -2.788067182912782e-02   -4.195156689295140e-01   +2.876930026258500e-01   +8.065824775731656e-02   -3.589709096269337e-01   +2.034597079274062e-01   +2.327584153850519e-01   +4.715501954137425e-01   +1.795725589436890e-01   +9.557377660886804e-02   +2.609551749689751e-01   -3.051872210391701e-01; +1.668375720606123e-01   -1.933467465968246e-01   +9.640379791394128e-02   +3.995273514961087e-02   +5.006339000370993e-01   +1.085561296920848e-01   -9.366961971080021e-02   -4.655980684309704e-02   +7.986621826696365e-02   +6.498672116334120e-03   +2.429969122615131e-01   +7.648396602558756e-02   -2.972291080795376e-01   +3.543181062450734e-01   -5.988855957019810e-01   -2.685536354267990e-01; +2.654493827273689e-01   -4.540768683276092e-02   -1.862772779428603e-01   -6.430270990982326e-02   +2.372199052132001e-01   +7.558886274002069e-02   +3.359537726761092e-02   -4.612716427106524e-02   -1.330250579138286e-01   -3.881801596033340e-01   +5.877512757803843e-02   +6.246350707469922e-02   +1.037935850584284e-01   +1.237465861352848e-01   +1.409236565969273e-01   +2.860629974465851e-01; -2.739856362207456e-01   +1.557411451210210e-01   -1.733008970330328e-02   +2.916204596430707e-01   +2.284831877319368e-01   -9.061349437741370e-02   -4.690713004787825e-01   +2.338111237162024e-01   -6.916922402463539e-02   +5.579263948398649e-02   -2.071607749368851e-01   -9.038957343084314e-02   +3.515780963302266e-01   -5.422102418902603e-01   +1.735977385690515e-01   +3.080269927123708e-01; +7.295138244177114e-02   -2.329705440550861e-03   -1.122347850605366e-01   -1.965097848323120e-01   -1.860113084785122e-01   +2.894438971628860e-01   +5.427669749514897e-02   +6.240524550371562e-02   -4.523248013728801e-01   -3.626062997917515e-01   +1.576329067559627e-01   -4.236588181906326e-02   +3.645515513654393e-01   -5.484093599542565e-01   -4.067295624252967e-02   -2.758252793965351e-01; +1.148081794963644e-01   +2.967456398472808e-01   +6.557586636877938e-02   +1.840740143736341e-01   -2.434852037176173e-01   -7.237935955166643e-01   +2.186189743779629e-02   +2.409958483658307e-01   +1.339432196237629e-01   -1.352950963383563e-01   +3.967122557290722e-01   -2.460986865032338e-01   -1.330572680788668e-01   +4.185092926679216e-01   +1.030926403308387e-01   +2.736456980810151e-02; +4.386015113952910e-01   +2.088999484269462e-01   -4.413803089823792e-01   -2.918040856339273e-01   -2.910236706292432e-01   +3.351673146524521e-03   -1.453237298754135e-01   +2.821687943083354e-02   +8.528783744380125e-03   -4.214695557501433e-01   +2.312463989708533e-01   -2.871811144574712e-01   +1.790924996457816e-01   -7.492384010126971e-02   -2.638124865690218e-01   -2.521853824428765e-01; +2.261399060663129e-01   +7.294357387934775e-02   +4.422100702762919e-01   +2.006596360358009e-01   -2.856185436860931e-02   +7.673504308609413e-03   -4.075846833648140e-01   -3.231079124973071e-01   +1.742396059192398e-01   -4.910961415130782e-02   -2.278229700579894e-01   -3.902493221929115e-01   -2.173133765733640e-01   -5.983467344506493e-02   -1.965744033714420e-01   -2.611232274108162e-01; +2.065169907339192e-01   +1.541459737965288e-01   -6.674317163561123e-02   -2.135423351564428e-01   -9.019597750812400e-02   -1.664848570437857e-01   +3.237283543272711e-01   +1.825585348196899e-01   -2.432787412087714e-01   +5.212023539239793e-01   +2.005399460166248e-01   -2.578515763532490e-01   +2.393072103663155e-01   +1.445711870614212e-01   -1.459426311170322e-01   -2.396680844513595e-01; +9.353885472445395e-03   -2.237270876410673e-02   +1.544248515888442e-01   -2.392830100927216e-01   +2.953892171733485e-02   -3.935506668843542e-01   -3.924619964040424e-01   -5.964534024397192e-02   -1.352662595854067e-01   +1.981309395901350e-01   +1.681264607706825e-01   -8.582741776179754e-02   -1.111082637672704e-01   +2.296246703315355e-01   -7.507735992630193e-02   +1.588579428449404e-01; +1.717432273618693e-01   +9.530610116870733e-02   +7.451302943123878e-02   +2.717777317645556e-01   -1.916291201676872e-01   -8.833430410986082e-02   -1.435502946696847e-01   +1.130984393629767e-01   +1.467204674708827e-01   -7.361540300679402e-02   +1.782732744880668e-01   +8.594042262438359e-02   -4.702929490231347e-01   +8.594980033081900e-03   +2.557099804282922e-01   +2.186772825578545e-01; +5.246845322460287e-01   +2.732792462839848e-01   +3.985081284881896e-01   +5.449662504566863e-01   -1.644654438888046e-01   +2.400100220884641e-02   -4.545174753700701e-01   -6.010728412945829e-01   +6.966733977376721e-02   -2.317198106546530e-01   -1.906591199220453e-01   +4.202260232793631e-03   +3.006794581010107e-01   +5.353449067594350e-02   +3.474181718004778e-01   -2.977288338319958e-01];
L1E_L1I_iGABA_netcon = [+1.628724353217763e-01   -2.481245354097528e-02   -2.676995071631215e-01   -1.410183422293902e-01   +1.484706662732052e-01   -5.370896054562524e-01   +3.103185852976563e-01   +1.063617213858121e-01   +2.955756747300613e-01   -6.471343883702665e-02   -3.961485353020480e-01   -3.665632949403208e-01   -1.747310326999908e-01   -2.578741249255285e-01   +2.212887402439736e-01   +3.027396987004535e-02; -1.898439061645417e-01   -3.003008920049346e-01   -1.782611447968157e-01   +3.286859601368938e-01   +6.146850891346611e-02   -4.980695006318162e-02   +1.504311342839303e-02   +1.953996741740247e-01   +1.028230907806292e-01   -1.190326137688796e-02   -5.309835064422980e-02   +8.457036250687029e-02   -2.701579709875506e-01   -6.081738259541422e-01   -4.787652189225770e-01   +1.268300613882070e-03; -1.684185673106262e-01   +1.057525855774965e-01   +1.152349005705324e-01   +1.443959153231410e-01   +1.462888500966442e-01   -5.714206820298381e-03   -1.629263637967697e-01   +1.230636903293209e-01   +7.228482624599408e-03   -9.008571072681568e-02   +1.642958164861022e-01   +1.036527623153757e-01   -2.688003733102055e-01   -1.399238932554749e-01   +1.028446704261049e-01   +6.387188094616947e-01; +1.254432757668842e-01   -1.805126940577836e-02   -2.698334206001265e-01   +4.381451294738837e-01   -7.621305064534910e-02   -4.480645608155395e-02   -2.130099489645800e-01   -1.012098746019645e-01   +1.955376942188861e-01   -3.611933128107350e-02   -9.958325947004673e-02   +4.705263678100650e-01   +1.026347750640928e-01   +1.132460791573514e-02   +2.188774312451354e-01   -9.740181556126264e-02; +1.680025345013424e-01   -1.492880446537844e-01   -2.558220645818273e-02   +8.957623293231129e-02   +1.113983192345291e-01   +7.217853336109399e-02   +2.548787342915582e-01   -2.125642353318463e-01   -6.933737319724026e-02   +1.367305667459877e-01   -3.348834113131163e-01   -1.645038489934043e-01   -3.527185159859737e-02   +7.303516782982597e-02   +2.705956744310779e-02   +7.933080818051032e-03; -5.270383318526625e-02   +2.313048505439811e-01   +9.871956721419543e-02   +3.604156700715317e-01   -3.429147621836575e-01   -8.213319765360504e-02   -1.378136498156958e-01   -7.620389738609207e-03   -8.723505017409289e-02   +7.539158384011216e-02   +1.493293057802424e-01   -3.854144584759805e-01   +3.053275449339077e-01   +2.057181263017561e-04   +1.806963642144715e-01   -2.231003988675401e-01; -8.684745037366534e-03   -4.222891831869666e-01   -1.716926203173997e-01   +3.952282219192914e-01   -3.695377076325630e-01   -2.945018819573000e-02   -1.658350011655823e-01   +1.125119154904770e-01   -2.008229448961673e-01   +3.346353300459425e-01   -3.446204028662334e-02   +5.741361624319635e-02   +4.770251479234509e-01   +5.339293598699413e-02   -1.687308324783042e-01   -3.676451838187325e-01; -6.218616424629673e-01   -3.027558177739396e-01   +3.633441420543987e-02   +2.146369733168537e-01   +3.474804679264791e-01   -1.507570152589544e-02   -4.218772421943625e-01   -3.078623477804411e-01   +1.362316711080887e-01   -1.793783248693215e-01   +1.931952389512107e-01   +1.657324398079895e-01   +1.773278142184940e-01   -1.945519132481479e-01   +9.485925220973662e-03   +3.275278315321155e-01; -1.498783958989025e-01   -5.015656738695357e-02   +1.999211552337948e-01   -2.893077460162375e-01   +2.455660290926005e-01   -1.348808032615725e-02   +1.192543159818683e-01   +2.251590014484551e-01   -3.040752952960471e-02   -1.455802654043614e-01   +1.341122629092173e-01   -2.565384406389388e-01   +9.579298010501222e-02   -2.072425330201817e-01   +3.759833386658588e-02   -3.306840165093544e-01; -2.831164306454060e-01   -1.617671029176758e-01   +1.184347685086253e-01   +1.924087752798784e-02   +2.311750361352508e-01   -1.742941439207000e-01   -1.501636566042445e-01   +1.596354746856160e-01   -6.762856891016941e-02   +2.159457279087862e-01   -9.685022103646482e-02   +2.749232827426463e-01   -7.196061511490054e-02   -2.090423227727270e-01   +2.403845491401623e-01   +1.852527210696806e-01; +6.413845015103652e-02   -3.265875013430518e-02   -1.397498673272829e-01   +2.047095551485262e-01   +8.199902294993980e-02   +1.303008332395450e-01   -1.373369923768689e-01   +4.443400714507356e-01   +1.445777846376596e-01   -2.127405702671661e-01   -1.365193063109854e-01   +3.419792021377728e-01   -2.270516741215493e-01   -4.070345576876589e-02   +6.874571253157491e-03   -7.321611356338290e-02; +4.584837709924738e-01   -2.505848067868318e-01   -5.625662255291398e-02   -5.836080493293699e-02   +2.353793946900414e-01   +3.248638483742650e-01   +1.856690368235578e-02   +1.079461718398648e-01   +1.359320764101636e-02   +1.063271192415435e-01   +3.714138172061451e-01   +2.320146657147443e-01   -3.246241700041727e-01   +1.898654207511050e-02   -5.874402955104641e-01   -1.936811768143772e-01; -7.485049083847697e-02   -4.734826728322653e-02   -1.343646224031591e-01   +2.265305659538267e-01   +3.594086946335511e-01   -6.580939932988135e-02   +1.916857658216795e-01   -1.160573390559613e-01   -1.896919040699357e-01   -2.767028458534645e-01   -2.361925018923015e-02   +2.140323679968398e-01   -9.904827638813449e-02   +3.481837511584947e-02   -1.397371179510384e-01   +2.367825687425864e-01; -9.910433552663171e-02   +3.990996406972505e-02   -3.580939530528390e-01   +5.223726976995416e-01   +2.182836396660872e-01   +2.175621939631147e-01   -2.783251721026995e-01   +3.556092471217620e-01   -2.784689225555566e-01   +3.963225147156346e-01   -4.550912204131776e-01   +1.586561916229820e-01   +1.268803447219928e-02   -4.922996643682357e-01   +7.758576612929521e-02   -1.571206540395158e-01; +6.653301803818046e-02   -2.554589064426862e-01   +2.258998251612552e-01   -7.986693723776836e-02   -7.207176579393368e-02   +9.972521730578898e-02   +4.051446754646271e-01   -5.454602719774180e-01   +4.888633201696013e-01   +6.054901829579126e-02   -2.246254683953002e-01   +4.307995632260274e-01   +3.864053676791823e-02   -1.755864420258285e-01   +8.662666986275824e-02   +2.822486818378318e-01; +7.424860426579943e-02   -1.957310507520637e-01   +9.677021472554481e-02   -3.671265419196099e-01   +1.409154079609608e-01   +8.702837692489793e-02   +1.292928396632006e-01   -1.880438453488090e-01   -2.553268396390874e-01   +2.378876853691919e-01   +2.461463087880885e-01   -2.845044007282815e-01   -6.712065647419904e-02   +3.062546587709464e-02   +2.097223346316275e-01   -2.706110268534364e-01];
L2I_L1I_iGABA_netcon = [+6.861419824879016e-01   +6.485323780245580e-02   +7.880025276165248e-02   -1.136892191431219e-01   -1.984087476541886e-01   -3.285670890984339e-01   +2.251716515855616e-01   -1.473569029030464e-01; +1.068923229734201e-01   +1.560999577826613e-01   -5.387825258065297e-01   -3.061574949049951e-01   -1.564986528816901e-01   +6.851773772941488e-02   +1.624314046581293e-01   +5.044254430631549e-02; -5.506431053038970e-01   +1.328884116881085e-01   -1.747424364195528e-01   -1.106902297021918e-01   -5.123559574644976e-01   +2.248913564867616e-01   +3.494312851944006e-02   +4.340775597335403e-01; +4.507936655622854e-01   -2.002341144517923e-01   -2.990934619550125e-01   +6.196069341531754e-02   -1.911926216710682e-01   +2.892382168111844e-01   -5.052042086527876e-02   -1.304484981422744e-01; +1.044425348165143e-01   +3.623599417442153e-01   -1.212639235012777e-01   +2.364123613625614e-01   -2.123968784786569e-01   -2.882436587475857e-01   +2.915301271837302e-01   +1.972974183114450e-01; +2.124276957120919e-01   -2.304399336718208e-01   +2.200152472597794e-01   -1.911340832941390e-02   +4.716441912125393e-01   -2.276594877114645e-01   +2.012994994480698e-01   +1.096034394917538e-01; -5.754893428471747e-02   -4.738943861516505e-01   -1.244754732410527e-02   -3.912557089294852e-02   +2.615669422346614e-01   -2.413195540615515e-01   +8.000142771240934e-03   +1.912023839491801e-01; -1.745898118286527e-01   +3.809717602512614e-01   -1.760980141341544e-01   -2.363356681176217e-01   -4.755522922391810e-02   +1.331528684968789e-01   -3.450128461142830e-01   +2.336020953119487e-02; -8.293624218795106e-02   -1.801005352772159e-01   +3.146228209986775e-01   +1.100566342962820e-01   -3.315556309641301e-01   +1.539260234396289e-01   +1.699669389683723e-01   +3.683527653469131e-01; +1.596193679275894e-01   +3.330729043745068e-01   +2.099271136693935e-01   -3.277098523690316e-02   -8.050524014923224e-02   -3.249113856356458e-01   -2.423617092668885e-01   +2.532853616556472e-01; -3.914645234916467e-01   -1.840951748423012e-01   +1.695641892973317e-01   +3.070421905375347e-01   -1.302261328714215e-01   -3.253402478677171e-01   -3.295396290686163e-01   -4.214067235196909e-01; +3.394660395123532e-01   +1.947736382113381e-01   +1.197509533445800e-01   +7.495531639418358e-02   -2.275319282467680e-01   -2.847738218281718e-01   -3.753997971852274e-03   -1.050057723345266e-01; -2.110091166392990e-01   +5.630642628424776e-02   +3.222148701254618e-01   -9.459540870849495e-02   -1.193471520114915e-01   +2.776025342536373e-02   +2.411016449061803e-01   +1.265217463643292e-01; +2.517962860509135e-01   -1.558389440141619e-01   -9.812951440745241e-02   -2.839461583223784e-01   -1.501479595358622e-01   -7.049528124577666e-01   +1.649243405749843e-01   -6.526825268700562e-02; +2.236745297884184e-01   +2.778057974194291e-01   -2.070958922546349e-01   +4.494043429203420e-01   +2.571507253052835e-01   -1.780882262851706e-02   -3.200188267004986e-02   +1.463378536578823e-01; -3.654327446484689e-01   +3.496151453624469e-01   +1.330459382001914e-02   +2.075239325457512e-02   +2.984982102470016e-01   +9.713263547162927e-02   -1.242351184058098e-01   +4.389458358770219e-01];
L1I_L2I_iGABA_netcon = [-6.696291834349030e-02   -7.462777591557052e-02   -1.130618159174742e-01   -2.738479037814363e-02   +2.364423793777364e-01   +1.496172138626048e-01   -1.900469402761837e-01   +8.650837672053713e-04   -2.468047119970599e-01   +2.515586914299008e-01   -9.870263668292545e-02   -4.442873557284222e-01   -2.299350570954808e-01   -9.175983162545170e-03   -3.547664297354403e-01   +3.956899963731256e-02; -3.057430884195100e-02   +6.051811699219828e-02   +3.224143778047992e-01   +2.744911661537691e-01   -9.778628736440070e-02   -2.283835070849218e-01   -7.703211813108536e-02   +5.523147610639834e-02   -1.416830408537110e-01   +2.425224997176179e-01   +1.360659898687694e-01   -8.013011431818212e-02   +2.481921703759318e-01   +1.672490017379639e-01   +1.378630105211695e-01   -2.315795319522290e-02; -4.777390759101033e-01   +2.795476635234866e-01   +2.088211522842496e-01   +2.227351906912503e-01   +8.973098103652102e-02   +2.205836038794701e-02   +1.254035185998533e-01   +2.079464721686707e-01   +9.507120295540394e-02   -8.807935432157184e-02   -2.019297579536879e-01   -8.662103705003077e-02   -3.089326188507885e-02   -2.473835822388681e-01   -3.946033556947692e-01   +4.168214440366622e-03; -1.019652497220219e-01   -3.228505130660946e-01   -1.959487417302883e-02   -2.737615084961923e-01   +1.498510015440125e-01   +8.614155202987334e-02   -2.504948590610785e-01   +2.004236614604501e-01   -3.041048725029066e-01   -7.873084995002767e-02   +5.769398097278979e-02   -4.574651862590642e-02   +3.360138640864513e-04   +1.173420251485392e-01   +1.251899597433263e-01   +2.456181473803480e-01; +1.326857156778191e-01   +5.834381955324319e-01   +1.205169689844086e-01   +2.428051513644804e-01   +4.211540211152439e-01   -6.707819284169056e-02   -2.301329111592460e-01   +8.633354671508231e-02   -3.863728775320294e-02   -9.394897430239857e-03   -2.533423787673021e-01   -2.345331537088007e-01   -2.094730318730994e-01   -8.001384791463395e-04   +5.938966215042001e-01   -1.325230245564843e-01; -4.319697127630764e-01   +4.458722972301300e-01   +1.170175950915281e-02   +1.428556097737562e-01   +3.805004191690757e-02   +2.526340301598929e-01   +2.467711665434766e-02   +3.639078398528079e-01   +2.939424105614368e-01   -2.470737002147740e-01   +3.068493157524682e-01   +6.604679482450163e-02   -2.432742712793911e-01   -6.569687387520638e-02   +5.757101760530180e-01   -2.162321127413936e-01; +2.082918266982119e-01   +2.829996205590790e-01   -8.249368283901985e-02   -4.406459709114713e-01   +1.943069918436792e-01   +1.097139177140877e-01   -1.125774746882903e-01   -1.278241498844747e-01   +4.517963101915133e-01   -1.226644436623820e-01   -1.124438311981547e-02   +2.434468623530644e-01   +9.547612974739797e-02   -3.234840337798372e-01   +3.832315314152484e-02   -3.250391556545484e-01; -1.351280352720872e-01   +1.350427613514462e-01   -3.745536194616899e-01   +1.564332282848404e-01   +7.795298327925304e-04   -1.684825957230950e-01   +6.318172545786351e-01   +3.229081807397374e-01   -4.072820193707051e-01   +1.432147597216781e-01   +2.165402222992052e-03   -1.375473039972198e-01   -4.215155252453183e-01   +6.890351790437559e-01   -9.003990973410249e-02   +8.806174377394946e-02];
L2E_L1E_iAMPA_netcon = [-1.344730300452698e-02   -2.253900808764714e-01   -1.715031159781754e-01   +3.238694741269413e-01   +1.064524142415713e-01   -9.609967646436895e-02   +8.474940136400315e-03   -3.303799290910395e-01; -7.180678454410701e-02   -3.423869973250689e-01   +1.137289042708966e-01   -1.477715698242010e-01   +5.535256240125006e-03   +7.869303587350426e-02   -3.871155447052860e-01   +1.705545909661151e-01; +1.602347093905790e-01   -1.415315125551700e-01   -1.125711236897771e-01   -2.311257475685843e-01   -1.437433709062479e-01   -1.991953619839004e-01   -1.088763850162606e-01   +1.828548686941156e-01; -2.290808120702459e-01   +7.117858669793753e-03   +8.903037006423895e-02   -2.050255938677050e-01   -4.326070412170308e-01   -6.970212336193048e-02   -7.849392271425845e-02   +2.448279013887684e-01; +2.927632408759249e-01   -5.323336869559375e-01   +1.515552081810298e-01   +2.945401086652205e-01   +1.817464915752440e-01   -3.092368693659191e-01   +3.103505159451602e-01   -2.873255326121800e-01; -2.840560916604966e-01   -2.153419590751633e-01   +5.078489179169282e-02   +3.121655564636465e-01   -5.479906313246546e-03   -2.214678929535218e-01   -1.798443452806649e-01   +2.731309661929068e-02; +7.886144890686073e-02   +2.482206965926646e-01   -3.984072157504740e-01   -9.944066708667398e-02   -6.793133363240200e-02   +8.681714551441030e-02   -3.265215094799568e-01   -2.975818530207558e-02; -1.094114064170910e-01   -7.993343590025387e-02   -7.349430628730752e-03   -1.656163320597568e-01   -1.955350297325948e-01   -2.077469691489310e-02   +2.986273499496335e-02   -5.287287675509997e-02; +6.363004684767998e-02   -3.271664764797161e-01   -2.075010874513288e-01   +8.930108520709273e-02   +3.144292249428882e-02   -1.137531102655737e-01   +2.535991888976150e-02   +1.111684389102178e-01; +2.149764703311821e-01   -5.627381493936250e-02   -2.798261954262726e-01   -2.689509396611376e-01   +3.863020329707263e-01   +4.352360009411927e-01   +3.554399454407035e-01   +1.871287525820512e-01; +4.241262978927612e-02   -4.529242836200769e-01   +3.931393916856446e-01   +1.322329518976662e-02   +3.187088591025508e-01   +9.643422041707914e-02   -1.757170879218127e-01   +6.140465677774204e-02; +3.343467549998776e-01   +2.913831545020247e-01   +1.014060312522796e-01   -1.904059385718161e-01   -3.628194102546339e-02   +1.671456906716909e-01   -3.356305002773518e-02   -3.972659864883443e-01; +3.645479578084862e-01   -3.597662401032967e-01   +1.930920151950642e-01   +3.132776070967634e-01   -3.145697915980771e-01   -8.237786793839225e-02   +7.613650875507147e-02   -1.030444871529365e-01; +2.858201294397474e-01   -2.082685622617088e-01   +1.720493253882108e-01   +1.669179212403876e-02   +1.487492864654458e-01   +2.796771365311396e-02   -4.327668881667475e-01   +1.059558138628710e-01; -1.959993429327014e-01   +2.772032147460930e-01   +1.833811529610891e-01   +4.752409851667582e-01   +1.057020063318786e-01   +1.238642289668838e-01   +2.348375408788732e-02   +2.328012318959551e-01; +3.420059077076614e-01   -2.013015195233724e-01   +1.488387026460117e-01   +9.008915555258984e-03   -6.680100363274538e-01   -1.881494907574610e-02   +3.411001578002999e-01   +4.190305482603222e-01];
L1E_L2E_iAMPA_netcon = [+2.099864462258469e-01   -2.735856873049547e-01   -1.810784982794295e-01   +1.467108773680891e-01   +3.678333892343778e-01   +4.694101243166660e-03   +2.307521982248976e-02   +4.695510400297376e-01   +2.140665979808656e-01   +1.658360771149874e-01   -2.292242200045381e-01   -2.906268660069910e-02   +4.055747736611937e-01   -7.902625132400476e-02   +1.239417654722747e-01   -1.381353968800425e-01; -2.464544744186233e-01   +2.504005905613493e-02   +2.130550625809421e-01   -3.544264149334955e-01   +1.462395572617508e-01   +6.693708622337495e-02   +1.398095964162810e-01   -2.577605552170900e-02   -4.506109146345044e-02   -1.937999641123157e-01   -3.117533014398544e-01   +1.064734174384835e-01   +1.074408614678973e-03   -2.058553090127992e-01   +1.577104341342109e-01   +1.362961849347043e-01; -3.949941842940918e-01   +2.688767309256828e-01   -4.968411910460017e-01   -2.522499791128922e-01   +3.626782488995727e-01   +2.876558359809877e-01   +2.741419757774230e-01   +1.241367146007730e-01   -5.632428701639212e-02   +4.598935120831242e-01   +3.375488242559483e-01   +4.948485305625100e-02   -2.055136748305071e-01   -3.726804133268223e-01   +1.288283697308731e-01   +9.292756716485953e-03; -7.005112810793380e-02   -2.477168003969485e-01   -8.943366526912994e-03   -3.567919591637723e-01   +1.008858584477856e-01   +2.291911104211657e-01   +2.433322914544964e-01   -1.391762787302084e-01   -3.188007362359266e-01   +2.232303714881312e-03   -1.030822490362716e-01   -1.779967198902631e-01   -1.135388965196674e-01   -3.195454109141661e-01   -1.353619743459204e-01   +8.113766349182816e-03; +4.534598140772572e-02   -1.096336328150031e-01   +4.961858978563272e-01   +3.197578830957967e-01   -4.406529813083901e-01   -2.629543022046404e-01   +3.449880655792605e-02   -2.341031636143645e-01   -2.058875940382682e-01   +2.547691271366118e-01   -1.710973736210183e-01   -9.522866726868319e-02   +1.122992941828963e-01   +1.836986740854157e-01   -1.308562761889264e-01   -6.676651482536528e-02; -6.378509717498655e-02   +2.326617827080332e-01   +5.721481895821819e-02   +3.674153624651677e-01   -3.671183330475143e-01   -4.898292270645625e-02   -3.302816627218947e-01   -4.921098818060015e-01   +1.648958008047710e-01   +1.340211405437627e-02   -3.028972007066619e-01   -4.475925326459061e-01   -1.643059867365597e-01   -1.532898016638722e-01   -5.406277465589841e-02   -1.627934362493692e-02; -2.282316676876784e-01   +3.798115639154256e-01   +3.527667842643993e-01   -1.351935654487408e-01   +3.202033106997882e-01   +3.077254398316799e-01   -2.893723473205624e-01   +9.210359949929432e-02   +3.081029091461576e-01   -1.230216546667884e-02   +1.724390876186097e-01   +3.440082891443185e-01   -3.273294673601135e-01   -1.691888656191044e-02   +3.566706103458590e-01   +1.480208819138850e-01; +3.227178102086175e-01   -3.536021157490926e-02   -4.527362917229866e-02   +1.299400698986125e-01   +4.748480415791344e-01   -1.892681868195822e-01   -1.948150505578370e-01   +1.397187713480143e-01   +3.576836180119896e-01   +3.277913899327899e-01   +3.672698945231624e-02   +3.441741564028697e-02   +2.413468358356488e-02   -1.690398198319565e-01   -8.543540396122216e-02   -2.723092080558917e-01];
L2I_L2E_iAMPA_netcon = [-2.235673463729124e-02   +3.151173654503243e-01   -4.913268422500491e-02   -9.671080292426151e-02   -2.165876793344970e-01   +2.723620886820148e-01   -1.916166809079149e-02   +2.475012582917642e-01; +2.897734265985722e-01   +2.286193461812643e-01   -1.403508606651948e-01   +2.405530680184021e-01   -2.564239367695702e-01   +3.857775564175936e-02   -1.241740100845938e-01   -3.203432450395950e-01; +1.307754187341202e-01   -2.563877301317823e-01   -1.802116892894962e-01   -3.295883182173971e-01   -4.069640699948770e-01   -2.931620196873037e-01   -4.338658315371799e-02   +2.438204980299612e-01; +2.973422402651142e-01   +3.009956784547646e-01   -4.404175853757285e-01   +2.180673760265897e-01   +3.715551808256264e-02   -1.731250033708359e-03   -3.472509790256795e-02   -6.051005685944308e-01; -1.613526898486208e-01   +5.330909174681048e-02   +2.532580826711054e-01   +2.042126962869437e-02   -4.879103319287759e-03   -3.287030430436569e-01   -4.366867546883722e-02   +5.618529343864853e-02; +3.295866840851313e-01   +2.319056680323089e-01   -2.408133404103240e-01   +2.757745751199023e-01   -1.369516751312408e-01   -1.912348537976026e-01   +1.456316632453293e-01   -3.546803131396015e-01; +1.281543374458717e-01   +1.259509321881515e-01   +4.104606796383720e-01   -4.573988152539784e-01   -4.677121014374073e-01   -3.951138401443243e-01   +3.836882922886542e-02   -1.496486283386131e-01; +1.393090869265741e-02   +2.965290243654243e-01   -1.747275567859663e-01   -7.915614223449280e-02   +1.383897567827728e-01   +2.458159239267319e-01   +2.862984675303140e-01   -4.105532773357894e-01];
L2E_L2I_iGABA_netcon = [+1.901284864927719e-01   +1.217659368131130e-01   -1.740858659841187e-01   -2.963233094608597e-01   +4.809960326375473e-01   -8.735131482126041e-03   +2.066233659624426e-01   -7.147101893392739e-02; -1.133578779094565e-01   -4.637329683452813e-01   +4.571622460809512e-01   +1.633828304928963e-01   +2.235163485661136e-01   -8.407094201813320e-02   +3.738181413965181e-01   -3.744906058895671e-01; +4.355948288802790e-02   +1.603584129361480e-01   -1.468865768464323e-01   -7.783138882753306e-02   +4.765319127612166e-02   +6.220313368682664e-01   -1.322871418658967e-01   +2.138477810270202e-01; -6.395296111425418e-02   -1.019063226661871e-01   -3.801092904630644e-01   +3.219708073255823e-01   +1.112005072441897e-01   -1.331414319611789e-01   +4.444528991276187e-02   +2.259295101222389e-01; +3.392167203145197e-01   -2.236249739656448e-01   -3.189250674003818e-01   -3.402820594759431e-01   -2.039732708543642e-01   -1.106316600591842e-01   +1.645509456180818e-01   +2.613994325573453e-01; -2.718997234373449e-01   +1.594763594018052e-01   +1.398321890215637e-01   +1.167700106229164e-01   +1.346264308617870e-01   +2.784727756109214e-01   +6.066934630330044e-02   -3.970265911975789e-01; -8.095081290768789e-02   +2.432467443550208e-01   +4.346680459491030e-01   +2.281410251557410e-01   -5.207347869712389e-02   -1.644461371109735e-01   -4.916314462399823e-02   +1.369805137523765e-01; +2.468833003084513e-01   -2.509024194976577e-01   +1.680842184472093e-01   +2.648882931849947e-02   -1.668593010893544e-01   +1.355876742418574e-01   -9.207274270507600e-02   +2.763048161094293e-01];
L3E_L2E_iAMPA_netcon = [-8.506861088036280e-02   +7.512544253879708e-02   -1.783690475361342e-01   -3.011499039336472e-01   +8.135929000460687e-02   -4.247928034312044e-02   +4.020716456818385e-01   -1.498571814082873e-01   -6.167316554172686e-03   +1.562373779583182e-01   -3.253859311460383e-01   +4.999651271819046e-02; +1.198903184395740e-01   -5.769586676677853e-02   +3.268781479129840e-01   +8.475347118412292e-02   -1.179366732475675e-01   +4.042256290583970e-02   +6.810217761314055e-02   +4.046906479218092e-02   +1.505063455023289e-02   -1.890217699030655e-01   -3.855246908142793e-01   +1.134939528619586e-01; -3.039837256625445e-01   -1.233323049126650e-01   +2.903128029917272e-01   -1.580840706776286e-01   +1.771250538980633e-01   +4.911112833659072e-02   +2.227489478029503e-01   +4.690404115820882e-01   -7.245656749064289e-02   +1.799595701638784e-01   -3.095231638298477e-01   -2.829483377643928e-01; -2.128183161362563e-01   -8.164309840324857e-02   +4.352620970171772e-01   +8.155602502009812e-02   +3.574609746542315e-02   -1.262485877083516e-01   +2.860796985529286e-01   +4.544208482915715e-01   -9.529862252600174e-02   -3.307660671673967e-01   -2.682585125051475e-01   +4.828073782240076e-02; -2.423431853160170e-01   +1.204091371062688e-01   -7.453547226264126e-02   +1.301968107568055e-02   -2.246993607118358e-01   -9.938107107507738e-02   -7.629275139189562e-02   -2.683178010820412e-01   +2.202890786136047e-01   -3.109313425538961e-01   -1.119105483006071e-01   -2.968742052004025e-01; -2.282150656533283e-01   -1.089245079985074e-01   -1.077920693842495e-01   +2.494968057555647e-01   -1.601695338728022e-01   +1.946925614722876e-01   +3.836389597660497e-01   -2.854416251322605e-01   -5.428743230731142e-02   -2.255028053513312e-01   +5.966758436222910e-02   -6.435078090273803e-02; +1.183427438419744e-01   -1.237929165993072e-01   +4.419151910409319e-01   -4.453172987209392e-01   +2.491113837100305e-01   +7.403427768079018e-02   +1.795333935538689e-01   +3.536121139627426e-01   +1.484001757195304e-01   +2.476694296816656e-01   +2.123450839478777e-01   +3.499997981075792e-02; +1.215971939841897e-01   +4.339579458115972e-01   +5.397937894478548e-01   -1.138821752730037e-01   +4.660270937092688e-01   -1.364893198596130e-01   +1.082747000503104e-01   +6.353968330486433e-01   +2.188166023211348e-01   +1.695542017199812e-01   -1.336850028945794e-01   -2.418776985110135e-01];
L3I_L2I_iGABA_netcon = [+2.144009415731773e-01   +5.505013119231326e-01   -1.009139168613968e-01   +4.100189508161135e-01   -2.193769244515217e-01   -2.539119868207899e-01   -5.639822568387376e-01   -1.564258523151825e-01   -7.416567711600253e-02   +2.327898490858667e-01   -5.206289317885767e-02   +2.995000440970863e-02; -8.779750359063791e-02   +1.545648577947696e-01   +3.078554315033633e-01   +1.781460045457624e-02   +1.719496733822982e-01   +1.553969245105861e-01   +1.224243483284826e-01   +1.139804679218932e-01   -3.218967370523967e-01   -1.326896304584652e-01   +5.236197682779650e-02   +4.538213254471071e-01; +8.024514143305377e-02   -2.486128096197438e-01   -3.900558515084318e-02   -1.085137031441590e-01   +8.657096239827980e-03   +7.122571276014106e-02   -1.774188723658958e-01   -2.386563701995164e-01   +1.666304229552992e-02   -3.085502956710014e-01   -2.215602188955458e-01   +4.474703900615363e-01; +1.635323464788122e-01   -2.054765150970020e-01   -2.285666532768810e-01   -2.151063844808997e-01   +3.840232524672986e-01   -1.425510337877797e-02   -1.917229296209957e-01   -1.647523097715580e-02   +3.823605370598253e-01   +4.534988190056950e-02   +4.983355722535275e-01   -1.333558555347526e-01; +6.114761014427345e-01   -1.732326562548647e-01   -1.424114699287888e-01   +2.882001315639861e-01   -1.368617946517187e-01   +2.998507507207501e-02   +5.455005723765352e-03   -1.552753896580170e-01   -3.091042445815210e-01   +1.320289552188806e-01   -1.526978052168113e-02   -3.069715139108738e-01; +2.164870563366945e-01   +3.229871934249917e-01   +2.715726544946237e-02   -1.562814939058159e-01   +1.032841129869427e-01   -2.690270356075383e-01   -1.197079021776358e-01   -1.713999377831069e-01   -1.944265090747210e-01   +1.891069371054468e-02   -2.534752704334350e-01   -2.170151578837638e-01; -4.497653844284249e-02   +2.887287888752356e-01   +6.603136473835094e-01   -3.906013900637051e-01   -2.644513596888748e-01   -6.695010891956113e-02   +5.180107329841815e-01   -7.906489149727029e-02   +7.774982417362608e-02   -1.566829946360212e-01   +2.358338094275704e-01   +1.839023266773806e-02; +5.194693089960102e-02   -2.134235517005724e-01   -1.593820588445964e-01   +4.384034002483919e-01   +2.244875864193795e-01   -5.244807704268392e-02   +4.151887774401775e-01   -4.238951828595002e-01   -3.219579938742309e-01   -8.629227782536436e-02   -3.650909216861087e-01   -8.525041307454170e-02];
L2E_L3E_iAMPA_netcon = [+1.595910633457084e-02   +2.626969012526148e-02   -2.843200396622109e-02   +2.377745004934869e-01   +3.572256728824961e-01   +5.570332258297547e-01   -3.418526426116570e-01   -1.726624502886867e-01; -2.117892164091580e-01   -2.486193435859681e-01   +4.431834137903364e-01   +2.951625807115078e-01   +2.891427940248714e-02   +2.720500205490497e-01   +2.822714267458224e-01   -1.241648542106776e-01; -4.474453547471647e-01   +3.603890298315390e-02   -4.557901694762291e-01   -8.810005297597075e-03   +9.453371187227975e-02   -2.807187568529276e-02   -2.922690590606815e-02   +2.733995512576451e-01; +2.513116430327429e-01   -1.590747550510732e-01   -6.812913038844766e-02   +3.252894536616628e-01   -1.592311341428363e-01   -1.851223921291182e-01   -3.918744229511797e-01   +3.545028390912899e-01; -2.115421536099573e-01   +3.865775524901808e-02   -3.187531261510255e-01   +7.488660119988293e-02   -1.669097498477237e-01   -1.746793073844452e-01   +3.119165519625142e-01   -9.088188797151756e-02; -1.789027489355673e-01   -4.074276363919471e-01   +7.697521415942733e-02   +2.850802455267113e-01   +4.360588007984260e-01   -1.316236004645938e-01   +4.511629052514751e-01   +2.404409638313601e-02; -2.799098888665864e-02   +5.295327822803333e-02   +2.435325517528335e-01   -1.858392553800012e-01   +4.070733386295720e-01   -2.728346273068910e-01   +2.610025391579973e-02   -2.168040570248739e-01; +7.353681801456630e-02   +7.443277589285867e-02   +1.903133132478661e-01   -1.083786428985472e-01   +9.390703647323470e-02   -3.597546037879648e-02   -4.864937788351834e-01   -1.729584858995749e-01; +3.132464748629051e-01   -3.289204731213408e-01   -6.742890963437906e-02   -4.792187206557511e-02   +2.348771556783938e-01   +1.846566803405050e-01   -6.047001360690677e-01   -3.004795411614136e-01; +7.532700996452983e-02   +5.971571652879268e-02   +1.036655477435097e-01   +2.287093542104598e-01   -1.857080208583259e-01   +2.107134323839050e-01   +1.200888267156579e-01   +5.179272848162740e-01; +1.874585412475856e-01   -8.859439813091313e-03   +9.133070632862712e-02   +4.998024422223524e-02   +2.337922417348847e-01   -1.944431209726049e-01   +2.521993361791940e-01   +8.911998216648595e-02; -1.257701623715725e-01   +3.042056931979314e-02   -9.199193882819839e-02   +3.776329557666100e-01   -5.384149513436131e-02   -2.920917008291202e-01   -3.762130903764244e-01   +2.303417609589206e-01];
L2I_L3I_iGABA_netcon = [-4.126545013686512e-01   +2.632989236718742e-01   +1.494173590726366e-02   +2.240649523082004e-02   -3.062123389800314e-01   -1.333973957100663e-01   +1.468708270531648e-01   +2.012478506598580e-01; -3.474028830953088e-01   -4.928936228587291e-01   -4.034308306353718e-02   -1.593086243409196e-01   +3.915166775282325e-02   +1.747021163158119e-02   +1.868805728391977e-01   +1.732110557968848e-01; -2.914369983684567e-01   +1.171030998417585e-01   +1.525470790470198e-01   +3.330845761645178e-01   +1.181227863119183e-01   +4.503689451619277e-01   +9.656005197500771e-02   +2.273712049201300e-01; -5.672050634911002e-01   -3.255943752096921e-02   +1.988818583588911e-01   +6.257504174509654e-02   +1.940385621685827e-01   +3.036416370331768e-02   +5.260828084424632e-01   +4.475849844493825e-02; -2.155789366155793e-01   +8.361133814562813e-02   +3.491284112213039e-01   -1.575152732419015e-01   -1.389408099561455e-01   -2.457769398621174e-01   -2.162784674921188e-01   -8.065395569187486e-02; +1.695686446536501e-02   -1.591231248199778e-01   -2.180479424486540e-01   +1.010472110635585e-01   -2.032289176750776e-01   +2.851002034807731e-01   -3.371773066939280e-01   +1.264900172823167e-01; -1.824653854038140e-01   -1.839276123511402e-01   +2.445060906305333e-01   +6.122157595746505e-02   -5.135510661639137e-01   +7.489729290900007e-02   +1.918555694417330e-01   -1.302385133873974e-01; -9.976137111793153e-02   -8.118507390568494e-02   -1.029099425234088e-01   +1.396365930199399e-01   -4.887960528714163e-01   -2.031023284503510e-01   -4.558828247336806e-01   +4.685538005476561e-01; +3.456052936739437e-01   +1.707949589928290e-01   +2.378190801399336e-01   -2.557627698485738e-01   +1.010158895279085e-01   -1.238677065689845e-01   -2.853820367763673e-01   +6.656862422879337e-02; +8.897538910837917e-02   +3.259392785621233e-01   -3.759009456297706e-01   +1.657562465468908e-01   -4.394644470696260e-02   +1.122935643525894e-02   -3.323806251872886e-01   -2.070824560065021e-01; +8.873940157140398e-02   +1.262489943559983e-01   +6.555344328634883e-01   +5.111672152727655e-01   -1.720921417446515e-01   -2.771323095624947e-01   -2.390821305956228e-01   +6.939937680917446e-02; -1.751961337079057e-01   +4.148446573133694e-01   +3.495619885063949e-01   +4.051763515768804e-02   -2.038076936602846e-01   +9.772094154463770e-02   -3.351410491122076e-01   +2.172499931485739e-02];
L3I_L3E_iAMPA_netcon = [+1.634327311743468e-01   -1.829558418715254e-01   -8.510621661121152e-02   +6.107405400163233e-01   -1.839242011160818e-01   -4.036025370415058e-01   +2.158031356449392e-01   -3.138016878965652e-01   -2.510080515860730e-01   -6.603869598407669e-03   +2.200871519678058e-01   +5.777994829148173e-02; -4.557842458400507e-02   +1.826540717419768e-01   -1.674020247321661e-01   -7.921705184517468e-02   -1.686830982206133e-01   +3.806162430902162e-01   -2.289297097269162e-01   -8.142288155787991e-05   +2.795800426225949e-01   -4.463283813904599e-01   +1.075465227341853e-02   -1.435391988500331e-01; +1.706499287857264e-01   +8.658265888992965e-02   +3.278285822148624e-01   -7.547251565506548e-02   +9.337551612963779e-02   +3.311535651730547e-01   +4.568194382229360e-01   +4.274546353246791e-02   +7.839849370993163e-02   +5.243381771713568e-02   -2.775557461294564e-01   -1.220998857767133e-01; +3.673330528908486e-01   +3.230194162436936e-02   -3.735529166544126e-01   +1.575210470995683e-02   +3.274985273006685e-01   -1.124161185360223e-01   -2.423547116852359e-01   +1.254423380597358e-01   -1.127204481201163e-01   +5.365024854985168e-02   -1.688767719734034e-01   -4.944646296368252e-01; -3.012022802166938e-01   +2.695878130798330e-01   -2.686606780047219e-01   -1.002163961638396e-02   +3.399389015927899e-01   -2.444298100402389e-02   -6.451111405253775e-02   -6.444476539159787e-02   -2.257650537495576e-03   +1.266300201026664e-01   -1.666468019032551e-01   -1.925698828908191e-01; +1.853087399177390e-01   +1.890738290051248e-01   +9.260391198455377e-02   -8.466821484005771e-02   -1.996785553748989e-01   -1.551481392715639e-01   +1.538765382681982e-01   -1.950296051410444e-01   -2.550238297370583e-01   +4.808731030554911e-01   -3.334360201636289e-01   +1.244646221758086e-01; +3.545205114576346e-01   -3.390941060221072e-01   -4.482265679835761e-01   +5.863538754575215e-01   +7.034577049706014e-02   +8.533136675403549e-02   -2.418715631618920e-01   -3.457541001946369e-01   +6.708313486404405e-02   +1.448373081977445e-01   +6.224960890850814e-02   -1.922460284892797e-01; -7.470230785230421e-02   +1.108934827078056e-01   +1.439312778158607e-02   +1.599383770758148e-01   -1.628787197792006e-01   +3.564957944444498e-01   +1.183243772816082e-01   +3.708253660920901e-01   +3.176886226515092e-01   +2.319071436997729e-01   -6.961896000749873e-02   +1.348369045348165e-01; +2.481868842825588e-01   -1.309284717349296e-01   +4.346380218956619e-01   +5.646136210086583e-02   +8.500793474077173e-04   -6.823003927490442e-02   +2.320205353749354e-01   +2.023592048900467e-01   -1.667304945739574e-01   -2.350176963468265e-01   +6.735656351957914e-02   -5.284839772163508e-01; +8.087406011846904e-02   -1.305552928622594e-01   -9.003555860794765e-02   -3.712263109212362e-02   +1.175852864328961e-01   +1.818074062201995e-01   +2.321260916911522e-01   +3.269859721526991e-01   -1.653349681348889e-01   -3.030404780002900e-01   -1.040154342645101e-01   -4.884870907645335e-02; +4.766121370155910e-02   -3.256485547625028e-01   +3.250850190986535e-03   +7.690377332749400e-02   +1.837602123175761e-01   +2.486206303002115e-01   -4.504313311573321e-01   -3.890850138676369e-02   -1.076754667140987e-01   +1.497488011250865e-01   +7.201053111243483e-02   -5.235710152159448e-02; +7.726464626080817e-02   +3.214904111203098e-01   +2.064645834350533e-01   +3.450616276629684e-02   +5.252776966151224e-02   -5.306609184433260e-01   -1.092000955573453e-01   +3.304003966469714e-01   -1.971268409301145e-01   -2.230728756201307e-01   -1.673656970426646e-02   -1.402073586614042e-02];
L3E_L3I_iGABA_netcon = [+9.069595272419267e-02   -2.478807278206639e-01   -7.134003366693423e-02   -9.854146512044426e-02   +9.283927707508741e-02   -1.761038096044560e-02   +3.955887941448447e-01   +5.869260420258637e-02   +2.021372345726711e-01   +8.459383192429198e-02   +2.979545116471963e-01   +6.544102387402326e-02; +2.422319874672100e-01   -3.606239319667519e-01   -1.442990986488743e-01   -2.885350761128527e-01   -6.806581496065303e-02   +2.292335719868776e-01   +1.822184212308017e-01   +7.318322131516093e-02   -1.431476282609574e-02   +2.674018040074697e-01   +1.588764357309655e-01   -1.124909793544980e-01; +1.896041528467278e-01   +6.086339549140637e-02   -2.573621589526123e-01   +2.002961790733972e-01   +6.935905683159813e-02   -5.267005341716603e-01   -1.412774997162231e-01   +5.083059626888498e-01   +1.258601677997656e-01   -8.590227235579626e-02   -2.010482088089403e-01   -6.300051453586887e-01; +1.215206106116625e-01   -4.069563236582859e-01   -2.079102473859752e-01   +9.264127272168526e-02   -1.412606291807497e-01   -1.743728252024394e-01   -4.523289410240484e-02   -2.775415260390346e-01   +1.683166829960779e-01   -6.799447298568156e-03   +1.811924246288354e-01   +2.255151763559556e-01; +8.498311437661554e-02   +1.908500540600748e-01   -2.895717451436228e-01   -7.941097851597589e-02   -5.554520166787424e-01   +3.527918887825440e-01   +1.003018568563831e-01   -7.504916942730283e-02   +2.468903281125185e-01   -4.525743567713402e-01   +2.262361778924567e-01   -1.635026586427852e-01; -5.064250521483882e-02   +1.949504481956530e-01   -4.793608272200479e-02   +3.299144421157745e-01   +2.861173697470231e-01   +3.391993592542726e-02   +6.541108499543563e-03   +1.035159788353273e-01   -2.107875830463593e-01   -1.451264003617801e-01   +3.969140803074332e-02   +2.745097292458853e-01; -3.654559807284872e-01   -3.378883081132253e-01   -2.168352785705392e-01   -3.571591237799566e-01   -2.895133539266156e-02   -5.817983616682409e-02   +1.296817375416990e-01   -3.983392328089824e-01   -2.959115605272671e-01   +6.356111783005947e-01   -6.874832105482793e-02   +6.789937753726265e-02; -3.114425892120344e-01   +1.255846291973901e-01   -1.877795912109876e-01   +5.552252038713820e-02   -3.764518258821593e-01   -2.430139003183382e-02   -7.547410052953438e-02   -3.444330709364644e-02   +1.635505322037136e-01   -3.790319305491454e-01   -1.574938469848412e-01   -9.095174621132750e-02; -1.160481906002800e-01   -4.419538346755832e-01   -2.162103442991832e-01   +1.574734534325886e-01   +8.516604248512818e-02   -3.502084356199432e-01   +1.038953568188158e-01   +3.876142172289506e-01   -1.425607460716269e-01   -5.816447901482368e-02   +4.202033479181638e-01   -2.463419239584137e-01; -2.746981097695571e-01   +1.661076721453316e-01   +3.415141451457759e-01   +7.594071494727131e-02   +7.144535897561222e-02   -3.942393502861996e-01   -2.454869833533029e-01   -4.234728304070771e-02   +2.624159287540421e-01   +6.940415928681684e-02   +3.819716866180647e-01   +2.477800480998363e-02; -1.216975770754242e-01   -3.196729531380492e-01   +2.670105621551235e-01   -2.963113093772555e-01   -1.981527242445603e-01   +6.481099145019746e-02   +2.155387158270781e-01   +8.233421256072307e-03   +1.046510985248565e-01   +1.358249342038674e-02   +9.953145787701148e-02   +1.352347276176566e-01; +8.327238752116790e-02   +1.032261804705119e-01   -4.444949722368402e-01   +3.124505609191638e-01   -2.210170190531520e-01   +1.402956831426180e-01   -5.468042598756301e-03   -2.467307956800223e-01   +2.771045128573411e-01   +2.479668481085113e-01   +5.454761908587683e-01   +2.725658755118592e-01];
L2E_Input1_iAMPA_netcon = [-2.986613234601573e-02   -4.756613413533152e-01   -1.766905349994768e-01   +4.811960402707852e-01   +1.902075489192506e-01   -3.461896263807177e-01   +1.617012399970954e-01   +4.029149014906744e-01];
L2I_Input2_iAMPA_netcon = [-3.609759101908445e-01   -2.727797493570239e-01   +2.257887524545406e-01   +2.641424776830887e-01   +2.089020393174295e-01   +4.224604398366498e-01   -2.242910948831052e-01   +2.956760960196363e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.03*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.15*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.15*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.03*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.15*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.15*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
