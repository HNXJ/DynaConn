function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+3.618163592924754e-01   +7.905011040798009e-01   +9.263755107961732e-01   +1.939698670263130e-01   +2.316692301343232e-01   +7.565313891849434e-01   -3.108060126433849e-02   +4.472604002475921e-01   +3.384838852988129e-01   +2.212458811002896e-01   +3.851365096381140e-01   +1.805008152402465e-01   +5.001378473823005e-01   +2.728531613716210e-01   +2.413672333259593e-01   +1.715452655756491e-02; +1.158483857201898e-01   +9.937665442630690e-01   +8.860992642623050e-01   +7.804762150971090e-01   +3.623216830735546e-01   +7.254254024806666e-01   +7.290781237160220e-01   +1.439311262876668e-01   +8.069238245984933e-02   +7.603060133606532e-01   +5.697381109642632e-01   +6.678574080028591e-01   +5.327100854370340e-01   +2.730834399261290e-01   +7.071590778533373e-01   +2.742003151150254e-01; +2.770800847660458e-01   +3.634031168142475e-01   +4.020506808243003e-01   +5.969462847673461e-01   +5.276064673812091e-01   +4.647090702398380e-01   +4.144995371505083e-02   +6.975616406729719e-01   +3.486355046804606e-01   +5.324387901635176e-01   +8.860148281687416e-01   +2.314817197253948e-01   +4.976677782228605e-01   +3.156069558864110e-03   +3.966859133005330e-01   +9.491369301787159e-01; +2.469869805278461e-01   +6.152729243604299e-01   +1.163594858641117e-01   +2.386910240799824e-01   +9.282045013992340e-01   +8.398641219408010e-01   +2.498988673974832e-01   +5.964957609525937e-01   +7.527370117163973e-01   +2.406637092443033e-02   +2.060082840493942e-01   +8.882359415663753e-01   +5.718797437999128e-01   +1.616136284362361e-01   +6.482588865121255e-01   +4.731399813971404e-01; +8.530902851840155e-02   +7.518827944912120e-01   +8.831801172768247e-01   +8.089386409956741e-01   +5.416532011293552e-01   +3.481148284708884e-01   +4.766281459012018e-01   +2.415555589035487e-01   +2.981404659619155e-01   +5.184331342991433e-01   +2.412075380582314e-01   +6.290748131858311e-01   +3.993013835744854e-01   +8.269518344947187e-01   +2.215795005060640e-01   +9.114150868183700e-01; +1.158527858066583e-01   +2.238151830880657e-01   +7.885651420807041e-01   +8.134278035741559e-01   +6.428322451750182e-01   +9.075441647152119e-01   +3.485144750354153e-01   +4.050971570810718e-01   +8.275583024056116e-01   +8.948214371988933e-01   +8.881952232291160e-01   +2.268024611950279e-01   +3.916894946966106e-01   +1.327130117356788e-01   +9.147069240452492e-01   +3.760390304461739e-01; +2.910910190226095e-01   +8.067690877222254e-01   +5.564042515918564e-02   +3.801688408012877e-01   +8.891219290367181e-01   +5.746557354221621e-01   +4.877077078165311e-01   +6.313003252463568e-01   +8.935142218185272e-01   +9.537036449860671e-01   +6.981024915788411e-01   +6.470410736157002e-02   +3.881113235813756e-01   +3.752678085443470e-01   +7.201122313517528e-01   +9.186030333672831e-01; +6.872095602872090e-01   +7.699995068642057e-01   +7.807718064475337e-01   +3.671095216834709e-01   +6.224599533907779e-01   +4.579300503862246e-01   +5.306309827471221e-02   +3.935362749797964e-01   +1.000000000000000e+00   +8.917280945899427e-01   +1.934883436997163e-02   +7.405832308190196e-01   +8.520700980667485e-01   +6.033862382399462e-01   +3.040642102687314e-01   +8.837392623034289e-01; +5.208046271871778e-01   +5.051797654905894e-02   +2.912334412522605e-01   +4.180608800842101e-02   +5.161131196527388e-01   +1.078914002818949e-01   +1.305062514059708e-02   +5.894892857023905e-01   +4.958136207072936e-01   +8.236292615983452e-01   +7.626076849677318e-01   +5.483778394748843e-01   +3.557854818166665e-01   +1.928574795379818e-01   +9.951066659875520e-01   +7.381481670962781e-01; +7.243599019429702e-01   +4.895837958720106e-01   +5.652477188182886e-01   +2.705092114378452e-01   +4.382762319891904e-01   +3.689353110011361e-01   +9.223963899796954e-02   +2.653983906885337e-01   +6.428340718144718e-02   +8.533678773783990e-01   +6.663109553023670e-02   +8.775663239883323e-02   +3.107362759566001e-01   +7.713666110487429e-01   +2.672260579965526e-01   +8.913404424555745e-01; +4.860925233766275e-01   +1.669740093433094e-02   -2.404790298977030e-03   +1.353080155760823e-01   +9.446224633615815e-01   +5.806911182203972e-01   +2.710825322308568e-01   +2.146774958245029e-01   +2.132661044947209e-01   +9.015923248580786e-01   +9.735725314456872e-02   +7.916179780678066e-01   +5.551214961085409e-01   +8.942319003803373e-01   +4.201467510144057e-02   +1.250307288879051e-01; +1.349659624734383e-01   +1.106840903160620e-02   +9.424323975597363e-01   +5.081834693405248e-01   +6.396554992479850e-01   +5.635049555544002e-01   +7.168421136602074e-01   +3.867483762446851e-01   +6.009250448236426e-01   +1.388458478225911e-01   +3.540220849462634e-01   +8.227676716029720e-01   +8.451013208937092e-02   +4.755974680402529e-01   +4.021395400963451e-01   +1.029592567451131e-01; +4.910446640269516e-01   +3.516293984385263e-01   +6.684299974300422e-01   +2.804471503973957e-01   +1.542924909281105e-02   +4.847102308946191e-01   +4.741798731577279e-01   +7.761942554596560e-01   +2.378892329061230e-01   +9.338697111537080e-01   +1.491525522958815e-01   +4.588474303214559e-01   +2.495947475290129e-01   +1.982599569438639e-01   +3.590952897583665e-01   +2.153536521702067e-01; +1.101028365934317e-01   +8.873705978850474e-01   +7.895309802805438e-01   +7.718678141536058e-01   +7.865068426001429e-01   +5.705672580586528e-01   +3.251035972546111e-01   +8.192677644352073e-01   +3.734490876790116e-01   +3.989673472110240e-01   +9.122662053897764e-01   +6.206602752140106e-01   +6.269292129722054e-01   +5.291615640793158e-01   +1.179125942192317e-01   +3.501452638115422e-01; +1.394751319750792e-01   +2.698157697987955e-01   +7.139037544796474e-02   +3.928405955426125e-01   +4.351642185429803e-01   +1.149539630114208e-01   +6.535716967029013e-01   +2.943440463462877e-01   +8.670045887962722e-01   +5.405923200587170e-01   +9.003885649126854e-02   +8.800848043034890e-01   +6.469409203800139e-01   +2.108948954489681e-01   +7.080582678061836e-01   +1.415422560100181e-01; +5.688320839264794e-01   +2.861976672179115e-01   +2.953155061956816e-01   +6.554574130263584e-01   +5.499877051849532e-01   +6.612733436797160e-01   +2.431220001148229e-01   +1.006524985796927e-01   +5.702157020772500e-01   +4.531106885842618e-01   +1.850100290267282e-02   +4.259364262710284e-01   +1.934543363772599e-01   +9.636201404507627e-01   +9.228755827008334e-01   +2.367096058002958e-02];
L1E_L1I_iGABA_netcon = [-1.393114370905326e-02   +2.922212167869048e-01   +9.197367409707502e-01   +2.873188002754229e-01   +4.168889913294344e-01   +1.233513142693311e-01   +2.846330430950172e-01   +3.617830609287162e-02   +2.207811405485424e-01   +6.401413715183794e-02   +4.653819998728635e-01   +9.686437639467773e-01   +1.686723493298250e-01   +8.459673670015037e-01   +1.052255846323074e-01   +4.351011168372256e-01; +7.458751174578175e-01   +7.950988330206968e-01   +5.210728050643132e-01   +8.686176203464129e-01   +7.636263196917933e-01   +8.671464184013664e-01   +6.416593928174635e-01   +8.823724102207248e-01   +9.673049520586486e-01   +9.463582826270313e-01   +1.360254067354131e-01   +1.108441134432760e-01   +6.226506338056562e-01   +9.590772257065273e-01   +9.974784043518912e-01   +3.028849945050500e-01; +3.405705146284223e-01   +8.297549166872074e-01   +1.071272461085356e-01   +8.472930888463848e-02   +1.177878572926846e-01   +2.339996569430589e-01   +5.953777580462151e-01   -2.193101879209643e-02   +8.561946658399422e-02   +1.053389894877586e-01   +5.287722567744277e-01   +4.243921400485654e-01   +8.402342705524598e-01   +8.109946551467231e-01   +7.981025082036323e-01   +7.383793966144360e-01; +3.625695644854504e-01   +5.109497995462933e-01   +6.317329447517429e-01   +7.674617019218672e-01   +6.589995637712331e-01   +6.517966395566429e-01   +6.067758895768858e-01   +8.728696069471599e-01   +6.995153204635197e-02   +3.281891001887957e-01   +5.313778065456397e-01   +2.142721660233508e-01   +8.026308031667416e-01   +4.411950701583995e-01   +9.205519933560993e-01   +5.355620895186193e-01; +7.632493816054453e-01   +6.118594289215059e-01   +8.374491433767348e-01   +3.548508203158358e-01   +9.871009121215715e-01   +5.352320717522892e-01   +3.365109769500063e-01   +4.695382858254633e-01   +2.839863748946617e-01   +1.033931685095217e-01   +5.301551208036388e-02   +5.710198414017810e-01   +9.255898665024709e-01   +7.733398338007127e-01   -2.258112141188091e-03   +1.815104350842494e-01; +2.636417362310569e-01   +9.587693443925557e-03   +2.577917461351771e-01   +1.576357847708927e-01   -9.174211015367971e-03   +4.371490195851994e-01   +9.256535837489984e-01   +3.159957203409017e-01   +5.506336652189844e-01   +3.920768289920099e-01   +9.113955340192808e-01   +2.004382810857097e-01   +2.827447786874880e-01   +2.359662433697813e-01   +7.328266080517351e-01   +4.209907259543257e-01; +6.710534239607980e-01   +5.483501832626173e-01   +3.353895120952137e-01   +8.005554080940842e-01   +2.860493211949873e-01   +8.720690938078186e-01   +6.751562987699130e-01   +5.346926792532596e-01   +8.535250835258471e-01   +6.336397062770951e-01   +9.140872929460394e-01   +3.221421836466429e-01   +7.986932977155017e-01   +6.177496341096487e-01   +9.505517896440698e-01   +7.987606962633820e-01; +9.886449799050208e-01   +1.460959155538711e-01   +5.535044358631347e-01   +5.017016894532420e-01   +6.383075016314858e-01   +2.120063989548665e-01   +3.342895750943136e-01   +5.834315056690956e-01   +2.076122040753821e-01   +8.049405771576108e-01   +7.698491143066314e-01   +9.350687982548117e-01   +3.027921631009921e-01   +7.816372054838979e-01   +4.767534450085579e-01   +5.817041667874797e-01; +5.409303902423940e-01   +9.914922480231763e-01   +3.815301289352805e-01   +9.569246574997518e-01   +2.232357639296015e-01   +7.027061284327727e-01   +6.130337495079233e-01   +9.875275831476593e-01   +8.426190821169121e-01   +1.236518436598399e-01   +2.107726022481151e-01   +2.146887654678744e-01   +8.833132351460572e-01   -1.049089957539993e-02   +7.183617645917566e-02   +4.514561067196188e-01; +2.659660123337677e-01   +3.876269487166878e-01   +5.354168680626100e-01   +3.148928786591976e-01   +8.073370358168149e-01   +3.954474595785606e-01   +3.297176113223680e-01   +8.580112842472255e-01   +9.150552380356298e-01   +9.005044584864109e-01   +8.191132092618927e-01   +9.220530364456605e-01   +4.865454521368361e-01   +3.927166699236629e-01   +3.479504294005382e-01   +8.546675558421667e-01; +1.230344990209353e-01   +2.154186175734631e-01   +7.978980618446585e-01   +9.219861142621520e-01   +1.436513271905699e-01   +6.344829708817672e-01   +7.625711133294709e-02   +4.569228529653795e-01   +3.847919203442551e-01   +6.962128935531602e-01   +3.183862613859738e-01   +8.931450923435791e-01   +8.010086692245762e-02   +4.949989659966333e-01   +4.630153626606517e-01   +4.956447886902659e-01; +1.421320448238171e-01   +9.319396261943992e-01   +7.538255150824740e-01   +4.876576502686559e-01   +4.857151022946907e-01   +6.615142578316366e-02   +1.620855181957877e-01   +3.351028920581277e-01   +1.255507598686316e-01   +5.525571060779393e-01   +2.861431679907847e-01   +4.329273314681612e-01   +3.810098129802207e-01   +8.845930980945325e-01   +3.245759291336753e-02   +4.986328752794422e-01; +9.057263635321329e-01   +1.446086679535221e-01   +4.843554833616115e-01   +5.538975514095293e-01   +6.634890565779539e-01   +5.925216678642208e-01   +1.941816858631881e-01   +5.572314111603417e-01   +5.289402164975198e-01   +3.239034045583252e-01   +9.396882288591891e-01   +9.670192965671132e-01   +8.727148466980194e-01   +5.895979986750619e-01   +2.769028587319597e-01   +7.953867394515999e-01; +4.188315061294952e-01   +8.490147588209761e-01   +2.923166513388410e-01   +3.857322772445953e-01   +7.348125307444530e-01   +1.856903406041679e-01   +3.837615277361813e-01   +6.279093265337421e-01   +3.355590078816089e-01   +4.713160672489317e-01   +1.853559252386238e-01   +1.415134290457180e-01   +2.949910760850949e-01   +2.412926528863366e-01   +5.892341545845279e-01   +9.138712351316283e-01; +6.193733340004028e-01   +5.942278783636813e-01   +6.447708952530884e-01   +7.151842930480085e-01   +8.152191989994015e-01   +4.747485261474009e-02   +8.461966130033932e-01   +3.409909717912414e-01   +8.238444403464409e-01   +4.697130926891938e-01   +6.787333786333926e-01   +5.630237203138579e-01   +2.459444881503254e-01   +4.885099492762761e-01   +9.044150920307489e-01   +4.786860183962827e-01; +4.158033921162853e-01   +6.088425675914764e-01   +6.107011881815051e-01   +2.886959181211176e-01   +4.817608214283073e-01   +2.992510625701162e-01   +5.759115645725297e-01   +2.573412254613019e-01   +8.619670456369400e-01   +2.778690783381033e-01   +2.450917156461214e-01   +1.291657346299067e-01   +7.221826842361397e-02   +4.912814716080104e-01   +9.162778201338834e-01   +9.490032343174689e-01];
L2I_L1I_iGABA_netcon = [+6.874077973714344e-01   +5.197693533402491e-01   +7.347815074198002e-01   +5.501119768085359e-01   +9.601620920296188e-01   +7.325524738732013e-01   +9.260352490364278e-01   +6.291544544282993e-03; +5.423547375709015e-01   +8.791704817003507e-02   +1.832373653150454e-01   +8.817577094493638e-01   +2.013588477291969e-01   +5.899056246544284e-02   +8.963222062250089e-01   +7.674265816213101e-01; +1.000000000000000e+00   +5.218210992428891e-01   +6.745938447674500e-01   +6.741766132537819e-01   +8.369981828085418e-01   +7.578889825829491e-01   +2.771531744336641e-01   +2.031034465023422e-01; +3.927184558736631e-01   +1.710048798601837e-01   +9.328699633146499e-01   +4.358362729600200e-01   +7.955406140536901e-01   +3.682337389636107e-01   +8.977178394323813e-01   +1.932938526164644e-01; +7.538806046174731e-01   +5.081612404171491e-01   +6.477475312739396e-01   +2.605915529158637e-01   +9.314626823946764e-01   +4.164047381299151e-01   +6.008876651027553e-01   +2.106969308633136e-01; +5.664700521278599e-01   +5.859650104832486e-01   +7.785133127187955e-01   +2.303373804857916e-01   +1.880322528222795e-01   +8.107897929052295e-01   +9.836013563825053e-01   +5.991693693068193e-01; +9.242866622711512e-01   +4.667953060940898e-01   +2.248954086239393e-01   +2.850328083001321e-01   +7.788257483360510e-01   +1.882433309860897e-01   +6.495196362982909e-01   +3.598021905010323e-01; +9.950415502374994e-01   +3.833459914292662e-01   +6.893516688449302e-01   +9.557158348869297e-01   +1.343820495422107e-01   +4.674964877817100e-01   +4.544995367833957e-01   +2.788983170903639e-01; +7.795270946910167e-01   +1.890517714608825e-01   +4.727886247929363e-01   +1.764276838160509e-02   +8.315872621967827e-01   +3.668329265242943e-01   +8.027551268578658e-01   +7.518657255793738e-01; +4.284217790476529e-01   +9.286091991189017e-01   +7.132628529212782e-01   +8.475778243299599e-01   +4.088061414570341e-01   +8.234038872445610e-01   +9.417237029338611e-01   +3.059288298778465e-01; +5.009030725957839e-01   +6.156476162063313e-01   +5.123447210720737e-01   +4.161547313881619e-01   +2.722924892118266e-02   +9.269897611367052e-01   +6.905053289835321e-01   +4.647592151961364e-01; -3.374283075906028e-03   +4.236721248351711e-01   +3.852237875886390e-01   +4.151180453766063e-01   +4.007214812908825e-01   +5.656077444627753e-01   +2.920501177712784e-01   +5.720261260497868e-01; +4.301398444683095e-01   +1.575122517510942e-01   +6.638322437385562e-01   +7.786364934415246e-01   +2.155209868582625e-01   +6.340450816353927e-01   +4.112773362307356e-01   +7.638628096749092e-01; +4.682000188052296e-01   +4.527266808350462e-01   +7.394123174459979e-01   +3.782789877654241e-01   +9.392886572686500e-01   +4.223468880275414e-01   +3.689775094855293e-01   +3.283693173954548e-01; +6.440225620067266e-01   +1.659093826774409e-01   +3.316450340298579e-01   +2.725738651810994e-01   +5.957388643649414e-01   +6.151844831193733e-01   +3.734821897082503e-01   +7.415958759352009e-01; +8.033125303184417e-01   +4.520413231220773e-02   +7.404747532671062e-01   +2.778053124654190e-01   +4.334316746860852e-01   +6.620657845868960e-01   +1.191829607459849e-01   +3.295597513172359e-01];
L1I_L2I_iGABA_netcon = [+5.484807387425277e-01   +1.965681620787670e-01   +7.738286578090888e-01   +2.829210793168619e-01   +6.077758240555310e-01   +2.812146519541460e-01   +8.881927002414942e-01   +2.404239981545321e-01   +5.932335115447885e-01   +9.149039604704547e-01   +4.347274752835453e-01   +4.449923062368171e-01   -1.131162134249026e-02   +7.477417759098599e-01   +6.289811334647226e-01   +5.003061580183098e-01; +5.049814680636024e-02   +5.863762986710813e-02   +3.655874259337137e-01   +3.152929299130933e-01   +9.247162118778068e-01   +3.557579480434568e-01   +3.386962621697833e-01   +1.316847254294023e-01   +4.608544766943521e-01   +2.210520134843111e-01   +3.157946963846264e-01   +2.882009936887398e-01   +9.360065013440638e-01   +1.786562664352097e-01   +8.607945992384252e-01   +2.506869615886137e-01; +3.747594595622761e-01   +6.484768703013657e-01   +3.805621484362956e-01   +7.328609425987298e-01   +2.359973060815772e-01   +5.148013180757199e-01   +7.740939541338339e-01   +9.124457101872560e-02   +7.756020634440707e-01   +4.885782196403695e-01   +6.167952843698054e-01   +8.365250894387528e-01   +9.785811544377379e-01   +6.624199552718877e-01   +3.243637835194813e-01   +1.206329716430234e-01; +8.371784147245137e-01   +1.319638451969256e-01   +6.175749312075510e-01   +9.504803513052800e-01   +5.008419956727429e-01   +9.038690785420797e-01   +6.306320593618181e-01   +6.241805762299650e-02   +4.983731950764687e-02   +3.365476636192269e-01   +4.346004144528340e-01   +5.096266155010969e-01   +3.205398432002898e-01   +5.127356053355877e-01   +1.977102100463176e-01   +1.079136677367191e-01; +9.850158761917511e-01   +7.937196764830488e-01   +7.464114664339160e-01   +7.032119085478580e-01   +2.895306437688648e-01   +6.626217525081425e-01   +6.750443492090905e-01   +6.637844975236791e-01   +8.949531402433321e-02   +6.923927899376838e-01   +1.756191506721675e-01   +4.039819643167243e-01   +4.323675427727377e-02   +2.188336835422232e-01   +7.279335483003024e-01   +9.628149210047975e-01; +5.512079782374920e-01   +3.962633328803544e-01   +1.262297599839576e-01   +3.519418413637435e-01   +9.696798466598938e-01   +1.332541595582976e-01   +6.846598531247828e-01   +6.791004360717180e-01   +5.714475899056679e-01   +7.525656232399559e-01   +3.468642859386034e-01   +4.943319814699295e-01   +8.759680664910809e-01   +7.094900057657287e-02   +2.064798897671740e-01   +8.431361082718951e-02; +8.102972084324266e-01   +7.854341253327882e-02   +4.159113233025614e-01   +3.250027349124499e-01   +5.509666529703362e-01   +9.305727575265276e-01   +7.684599113864268e-02   +2.410808866668170e-01   +7.505249083855912e-01   +9.255731470693518e-01   +8.955097224490203e-01   +8.951923543871985e-01   +1.572752037783655e-01   +3.023817163162255e-01   -2.574875082782742e-03   +6.350347727356949e-01; +8.792316621791391e-01   +3.634479926744966e-01   -2.958795919732454e-02   +8.990567193824940e-01   +1.735762339090099e-01   +1.000000000000000e+00   +8.087771895595390e-01   -1.766169430375047e-02   +8.040093424106493e-01   +4.252685915482579e-02   +9.188538490713202e-01   -9.539107608209746e-03   +8.353567522589329e-01   +8.320896442114455e-02   +9.637606904042730e-01   +6.925828767648523e-01];
L2E_L1E_iAMPA_netcon = [+2.671596425798811e-01   +9.181753199548240e-01   +6.787495081192506e-01   +5.119551527782629e-02   +3.184437702982608e-01   +3.990422358789821e-01   +8.286237062956960e-02   +6.301195433031908e-01; +2.797345951707157e-01   +1.770721044546436e-01   +7.723793116254845e-01   +9.044735024992429e-01   +3.471350558887939e-01   +5.657870395387280e-01   +2.763341497749859e-01   +1.199742484379511e-01; +5.177281496351780e-01   +9.021352661724438e-01   +7.699170709291784e-01   +1.018196940428582e-02   +6.603994725994562e-01   +6.272476487601833e-03   +4.329534157291618e-01   +8.460208973192176e-01; +5.295630074655430e-01   +6.088130812204100e-01   +4.905514974524509e-02   +5.840996925067523e-01   +2.794485129691705e-01   +4.841419851735357e-01   +2.286582847150972e-01   +4.456818264244256e-01; +8.587820806694775e-01   +7.330973080149993e-01   +7.866048303649429e-01   +5.345924692852589e-01   +7.734991022730489e-01   +3.627468313365170e-01   +4.844835392887896e-01   +4.879225440669048e-01; +4.833185970707154e-01   +6.811523202135078e-01   +4.593142011918327e-02   +5.976220964714045e-01   +6.641840738790904e-01   +8.610619462800441e-01   +2.507411404116682e-01   +4.020782841954367e-02; +4.884259654673133e-01   +3.213738618209848e-01   +2.497420592543870e-01   +4.061023476627854e-01   +3.956046480691462e-01   +2.760870090437321e-01   +5.493352796694619e-01   +3.009199047321000e-01; +7.202215314778371e-01   +1.578288462248726e-01   +1.302047846564757e-02   +9.353504654872092e-01   +5.011667551466722e-01   +3.528764896983865e-01   +5.536542970919770e-01   +6.021368582988117e-01; +7.677387381034007e-01   +6.277009411203228e-01   +6.413740638040797e-01   +1.266617418107264e-01   +3.755256987323249e-01   +2.340334799232128e-01   +7.534898726785069e-02   +1.000000000000000e+00; -2.227903492717737e-02   +1.400249283174579e-01   +1.281538235759279e-01   +1.801517838367317e-01   +2.086582020077799e-01   +5.701951413889007e-01   +8.812501445991946e-01   +8.266439900172576e-01; +1.578636504298542e-02   +2.407120255880054e-01   +5.980277709917471e-01   +5.080091196551938e-01   +1.514037345199150e-01   +4.333029686848379e-01   +1.613778862651765e-01   +7.195270913401103e-01; +3.773252372488790e-01   +5.331639428028524e-01   +6.008033095359554e-01   +5.374613631027899e-01   +7.064296470651572e-01   +3.109914662724254e-01   +6.303270497874471e-01   +4.682928706036157e-01; +6.730179524555757e-01   +7.166913737248609e-01   +6.500178761263684e-01   +2.643364428011747e-01   +1.931954367594263e-01   +8.287913435600963e-02   +1.072797579875172e-01   +5.561343410994246e-01; +7.294568019995159e-01   +8.032991411948371e-01   +7.386863048456102e-02   +9.017104148585621e-01   +4.654471263345740e-01   +8.498051201171446e-01   +5.679955543364869e-02   +2.258822947401692e-01; +9.504341346910622e-01   +2.007240551037622e-01   +3.991998406978557e-01   +5.553879328134350e-01   +3.679037210188994e-01   +2.483281893433385e-01   +5.962326582196334e-01   +3.793070790306642e-01; +8.465737808261292e-01   +6.055980132684866e-01   +7.153663325242632e-01   +3.449088198840375e-01   +4.669234757628754e-01   +8.949416541567369e-01   +7.282660786664966e-01   +9.183882492552468e-02];
L1E_L2E_iAMPA_netcon = [+8.563565513075566e-01   +4.404969398249275e-01   +5.919765761580473e-01   +1.271540704820745e-01   +9.342925297398139e-01   +3.019088562984324e-01   +5.614537878004509e-01   +5.196621254431868e-01   +9.612199470844576e-01   +5.524944721153304e-01   +6.645731490066750e-01   +5.112182751398312e-01   +5.205130036314006e-01   +3.641197924716665e-01   +5.348844474262194e-01   +2.093502245095057e-01; +7.666503560484244e-01   +2.189657279295204e-01   +1.098008747867937e-01   +5.837247234600641e-01   +8.300919910412506e-01   +6.256408541305595e-01   +8.900211996724456e-01   +2.374897249601730e-01   +3.394268273751254e-01   +3.402351490994838e-01   +7.533510003923110e-01   +6.689789783961086e-01   +7.049628790545102e-01   +8.972327471130295e-01   +4.142861347869575e-01   +5.467988053453535e-01; +7.884081197187718e-01   +9.072772909423839e-02   +1.202121155113476e-01   +9.750977553515113e-01   +2.656151393016438e-01   +3.549891334698136e-01   +9.331909007632599e-01   +3.136048399169338e-01   +1.796090687643188e-01   +6.084749078133261e-01   +8.428088239471028e-01   +4.792867284674827e-01   +8.678809489744154e-01   +9.870612859887375e-01   +8.556379674201008e-01   +6.518680264443015e-01; +7.294033789850956e-01   +8.435072338314524e-02   +5.240723259221116e-01   +3.890618821903862e-01   +4.233148388417721e-01   +8.566647938349370e-01   +2.019027295196696e-01   +1.331330213643186e-01   +6.165629444776477e-01   +4.312358179487567e-01   +3.624455066259459e-01   +9.357138871209029e-01   +7.427278387349415e-01   +5.810933806739028e-02   +7.449013753212994e-01   +7.933014283018598e-01; +3.269483150289148e-02   +2.534531003827699e-01   +1.747656017649379e-01   +7.570372129679148e-01   +2.115430330247626e-01   +4.920730342230495e-01   +9.976478364856478e-01   +3.013941543328383e-01   +1.020899899594437e-01   +7.769739419162439e-01   +6.895420681506145e-02   +5.755283824878860e-01   +9.471135724550793e-02   +6.406153302035665e-01   +3.862210857283961e-01   +1.104565132147319e-01; +6.566663356924320e-01   +4.289895409465848e-01   +3.975740622952354e-01   -6.766161444861679e-02   +9.095712189508562e-01   +9.819663418752927e-02   +4.569215964459561e-01   +2.151408654116326e-01   +7.556819621012333e-01   -3.048900650307004e-04   +7.571696347199939e-01   +4.120363957950660e-02   +7.497069056883482e-01   +5.103883635887186e-01   +7.071507413942550e-01   +3.433197779683396e-01; +2.821369904301915e-01   +6.661663155591259e-01   +3.807174953086465e-01   +3.874626646395412e-01   +3.451492178939092e-01   +8.885387756349246e-01   +9.230009634299611e-01   +4.326423668611972e-01   +6.780891442102731e-01   +7.700450973325225e-01   +6.408682222888586e-02   +1.346417249144938e-01   +1.018222911415875e-01   +3.527254787129052e-01   +3.425379790465345e-01   +7.921721087790938e-01; +1.601869368469932e-01   +4.563338114046342e-01   +3.036359946403465e-01   +4.395444869120968e-01   +9.498360916483946e-01   +5.020385463448583e-01   +9.687137684523903e-01   +9.008804640456941e-01   +3.736352268531531e-01   +5.829965098855289e-02   +3.690667734537751e-01   +3.454896970975149e-01   +3.338901912749615e-01   +7.678582837605006e-01   +8.092086829386880e-02   +5.390647523620776e-01];
L2I_L2E_iAMPA_netcon = [+3.579359448110676e-01   +2.637313122602098e-01   +4.013925920294441e-01   +5.667708249507102e-01   +1.706683232392321e-01   +8.806866181474950e-01   +6.757756214086105e-01   +2.755325593501489e-01; +5.226999841555130e-01   +2.226209772278826e-01   +6.482368745339844e-01   +2.424933666788080e-01   +6.720924646554471e-01   +8.064739646465744e-01   +6.246253243914574e-02   +5.195017444878507e-01; +6.291349638601194e-01   +7.748583108229902e-03   +7.057418727549495e-01   +6.125794976085633e-01   +1.560224950728220e-01   +5.711284884686678e-01   +8.045819041738067e-01   +7.225059831789456e-02; +4.925318254432753e-01   +2.997381900149357e-01   +5.476775982454860e-02   +9.593677751230065e-01   +3.728002752529698e-01   +6.126444715372444e-01   +9.766376723359973e-01   +2.267358941366368e-01; +1.601435331228910e-01   +4.225906853999854e-01   +4.030192804932857e-01   +8.294611253017674e-01   +8.345073351492742e-01   +5.816612981188285e-01   +6.949060773524608e-01   +2.889354974356312e-01; +9.185402285820790e-01   +5.056168580085590e-01   +9.123141687535545e-01   +8.567554770847663e-01   +7.148301585869241e-01   +8.498188978440552e-01   +8.701936290323568e-01   +5.096783338333378e-01; +1.176369716211446e-01   +5.662559012338753e-01   +9.261563563126938e-01   +9.118747737857158e-01   +9.999810088703533e-02   +7.311440241092435e-01   +2.363102223292657e-01   +1.121227003710951e-01; +5.480623879510044e-01   +3.816781664127212e-01   +2.007204354172744e-01   +2.812880468594159e-01   +7.576361690952226e-01   +4.088133038535939e-01   +9.756365964797118e-01   +6.141172270118354e-01];
L2E_L2I_iGABA_netcon = [+4.579237427235661e-01   +6.068638100961030e-01   +6.574771695376794e-01   +9.010058120954648e-02   +4.879152781268088e-01   +4.968568750979311e-01   +2.918777308959057e-01   +7.344580155537695e-01; +4.300145152423177e-01   +3.526368118315665e-01   +1.200177059235964e-03   +4.986318380268506e-01   +4.881764066249805e-01   +5.995464156074932e-01   +4.857089830370758e-01   +4.688973370619768e-01; +5.905957755219688e-01   +5.323901722589922e-01   +4.081426724504515e-01   +5.535186425165310e-01   +3.214986690605284e-01   +2.681824527237806e-01   +2.025134696790669e-01   +1.000000000000000e+00; +7.295718054249265e-01   +5.597135604535788e-01   +3.935678782792123e-01   +8.383171573910040e-01   +2.340960346572981e-01   +8.545793783991960e-02   +1.676360048729377e-01   +4.322262748192697e-01; +5.207010492895029e-01   +7.622812055448380e-01   +5.189484957895448e-01   +8.043367598080664e-01   +4.081766191567968e-01   +7.283242276241439e-01   +6.740352379059924e-01   +3.134497488755707e-01; +3.934775100021023e-01   +2.535885474238655e-01   +4.678513056383827e-01   +3.657600577487771e-01   +7.982776514122258e-01   +8.666471878883663e-01   +2.519162365393578e-02   +4.344769632688596e-01; +5.078896646148662e-03   +4.500612812764858e-01   +8.598245815731391e-01   +5.813787868531646e-01   +4.865892104941863e-01   +3.901310037261528e-01   +9.343839864509507e-01   -4.390014497235811e-02; +8.944373438835626e-01   +5.268804334388107e-01   +8.915848885652236e-01   +4.929087696687709e-01   +8.998160843034024e-01   +5.477833464008387e-01   +3.490960631479107e-01   +3.277128861216907e-01];
L3E_L2E_iAMPA_netcon = [+2.389344536233329e-01   +9.369877512160928e-01   +4.799978846871347e-01   +7.915947809218092e-01   +1.750332167646228e-01   +4.282660088130578e-01   +4.034780104505412e-01   +1.160189600993210e-01   +1.127141836714423e-01   +5.361065259815430e-01   +1.618306692694734e-01   +4.566883180771206e-01; +2.552042818135187e-01   +4.794367671048428e-01   +1.796077696726666e-01   +2.416155674562202e-01   +6.311303906925444e-01   +9.347316372223478e-01   +7.394003313440498e-01   +6.236234221593137e-01   +2.585657887034291e-01   +4.858915671169722e-02   +2.916415445963815e-03   +7.065335855019376e-02; +7.981796870328666e-01   +3.644717247683258e-01   +5.536526803443574e-01   +1.215173796845099e-01   +8.828949381978139e-01   +8.690413967938496e-01   +5.262719028577372e-01   +6.920633443693878e-01   +6.978246427353622e-01   +3.897688417733347e-01   +4.133725633313803e-01   +9.433009422182272e-01; +1.888015279061869e-01   +4.641275294777493e-01   +1.982149512715205e-01   +8.343580579713832e-01   +5.186920546845072e-01   +5.727895345628302e-01   +8.798203150807382e-01   +2.758677138061566e-01   +8.423167779641852e-01   +8.264142548416776e-01   +4.881041070564784e-01   +2.370408360313626e-01; +2.192817820691586e-01   +8.194064677927514e-01   +4.372018654110238e-01   +5.465581908027473e-02   +2.012115684794880e-01   +9.881860130989638e-01   -1.955369301020225e-02   +6.775382459373016e-01   +7.126187371710288e-02   +8.382560042917713e-01   +2.804823859154864e-01   +2.337337512076122e-01; +3.801110519718635e-01   +3.657015412005583e-01   +8.739339544905492e-01   +9.834984605149896e-01   +3.802960075145086e-01   +9.553840130752190e-01   +1.046311950640090e-01   +3.917259165714944e-01   +5.044913488187942e-01   +8.131669952850542e-01   +6.256178279431404e-01   +8.874396621484982e-01; +1.385706955334936e-01   +4.818241570665744e-01   +6.092164510287088e-01   +1.134008660610216e-01   +6.494021873111743e-01   +4.932613098560020e-01   +7.862214980424833e-01   +1.236372061839823e-01   +4.894408894508716e-01   +3.843880261749804e-01   +9.990190022527990e-01   +7.684920558330030e-01; +6.106526593555320e-01   +4.470816601656602e-02   +3.832584938104773e-01   +1.776823173257475e-01   +3.621248721650448e-02   +9.236137947904279e-01   +3.924159384348038e-01   +4.769613357136699e-01   +9.042335352636509e-01   +9.917487216059561e-01   +9.446111751467742e-01   +3.580682458032285e-01];
L3I_L2I_iGABA_netcon = [+7.556796836852412e-03   +3.820881202891470e-02   +6.020324900571134e-02   +6.523013127407880e-01   +6.877677283937529e-02   +4.903572291645383e-01   +8.215474263733400e-01   +3.870658292848422e-01   +4.054070737999656e-01   +9.710145969247479e-01   +8.744701809612806e-01   +6.219581702766445e-01; +3.607733649715050e-01   +4.317342772603027e-01   +3.124167534793363e-01   -3.865956958489906e-03   +4.622739166019578e-01   +6.147665053622361e-01   +4.502567629873452e-01   +9.042803661541109e-01   +1.089607121927598e-01   +9.169444336321134e-01   +2.986590583017550e-01   +6.440206798022198e-01; +3.412129211293953e-01   +6.910228001933986e-01   +3.034772463585925e-01   +7.920620335720011e-01   +3.548293858060960e-01   +8.413271836749172e-01   +9.419135899350080e-01   +2.865846165236221e-02   +6.593214528532412e-01   +5.129177910842194e-01   +1.499732822520602e-01   +5.838179748469013e-01; +6.394096839379843e-01   +9.654583991743543e-01   +3.553821190269173e-01   +2.633913672079788e-01   +1.613701850722810e-01   +5.854708220156233e-01   +1.765622462445635e-01   +2.857462723952141e-01   +7.077983341329938e-02   +3.333080482600994e-01   +4.993767851143927e-01   +8.126271713863794e-01; +9.644213159208899e-01   +1.315493514057514e-01   +4.944412792325423e-01   +8.317016746993119e-01   +5.007177213373789e-01   +8.931459966233691e-01   +9.574567485812528e-02   +5.690508638507099e-01   +6.033617475450030e-01   +7.952438481319479e-01   +7.612466103223375e-01   +5.414437442342058e-01; +9.133005387948634e-01   +1.838282346316706e-01   +1.171767379451550e-01   +7.632169582177633e-01   +9.135528046802144e-01   +7.456764088958328e-01   +8.944136517606189e-01   +5.587278299054652e-01   +1.410582647049543e-01   +8.504512695078401e-01   +3.569838765271785e-01   +6.144491618166227e-01; +1.143854897186616e-01   +5.558339348049205e-01   +9.592446301874397e-01   +5.624649823940240e-01   +9.511135594128194e-01   +8.320896481898087e-01   +8.103461094172087e-01   +8.000700784761650e-01   +6.030988011917040e-01   +3.683326220281972e-01   +3.127417685653233e-01   +5.604787148278521e-01; +3.095312325142252e-01   +2.504914379613118e-02   +7.599373070692642e-01   +1.800443715423660e-01   +4.358178291301860e-01   +4.083834021027297e-02   -4.364318268279088e-02   +9.885281220700683e-01   +4.595017333409515e-01   +1.054352946458609e-01   +7.082842864967044e-01   +7.780313305978198e-02];
L2E_L3E_iAMPA_netcon = [+9.033257779462033e-01   +2.821836145261088e-01   +5.469424475433071e-01   +6.949233239390138e-01   +3.609150338781084e-02   +7.272954127607777e-01   +7.551860543979764e-01   +6.100337643739877e-02; +3.173852042231697e-01   +5.907153771767301e-01   +6.775063946650048e-01   +7.310144985813919e-01   +2.390828191785736e-01   +2.160904153498718e-01   +8.363182565942704e-01   +7.058159768603249e-02; +6.099869312057760e-01   +5.425589127123616e-01   +8.870415507372793e-01   +6.303203541247802e-01   +8.992360555321596e-01   +4.604051599876786e-01   +9.748434565415551e-01   +4.639583281861359e-01; +1.820824787318733e-01   +9.146064004365301e-01   +8.853372070738446e-01   +4.328289001264713e-01   +3.710457445795485e-01   +9.541479502083192e-01   +2.766131047546815e-01   +5.059706821925364e-01; +7.502782321711775e-02   +2.043102206842172e-01   +6.695222496742175e-01   -2.310946227184872e-02   +1.642338788698619e-01   +5.414237424827008e-01   +4.960079353965804e-01   +6.591124198214493e-01; +4.036973439374248e-01   +7.701244908012566e-01   +1.728578122170307e-01   +7.790372055198697e-01   +2.924939659150687e-02   -1.062146448208997e-03   +4.871658300217607e-01   +2.993119386289932e-01; +4.606836099450684e-01   +7.778952327094858e-01   +7.855629280051565e-01   +2.564249518469354e-01   +8.440585109934453e-01   +1.935203251490702e-01   +6.947526310355170e-01   +9.414506424610836e-01; +2.897458281899388e-02   +5.952996932236162e-01   +8.920389954172805e-01   +4.634700504133900e-01   +1.184289799077181e-01   +7.434690766045303e-01   +1.194707801753982e-01   +3.649671565626653e-01; +1.000000000000000e+00   +9.181732177977597e-01   +6.860847701598928e-02   +1.405661471770418e-01   +1.234332475103839e-01   +8.901017285691883e-01   +2.908959274734827e-01   +9.347777442797282e-01; +1.765539505287783e-01   +3.554453842664034e-01   +7.961071269898167e-01   +3.782013961498721e-01   +4.021036894254134e-01   +9.100737271263570e-01   +5.032809056897810e-02   +9.608915566037778e-01; +6.571513710103953e-01   +3.929903089679535e-01   +2.456013692862709e-01   +2.177935993958516e-01   +1.101113984688211e-01   +3.368818605685724e-01   +2.160472423583972e-01   +9.090341618158722e-02; +9.534800426725346e-02   +6.338255483072543e-01   +8.090512465531312e-01   +4.138808349769240e-01   +4.544380053689163e-02   +7.427400672220005e-01   +7.895845264906043e-01   +7.570545221061229e-01];
L2I_L3I_iGABA_netcon = [+3.877700341517441e-01   +6.279536357647131e-01   +2.705364444912960e-01   +6.710883127625368e-01   +5.290073375703785e-01   +4.302477907261145e-01   +4.140715246604487e-01   +4.859890069639480e-01; +3.802310476281521e-01   +1.178816908346266e-01   +8.037963851544677e-03   +8.551615320112798e-01   +7.140255272391001e-01   +4.122290039515152e-02   +9.871732922505178e-02   +6.287594347917701e-01; +3.681459910928279e-01   +6.527117385240706e-01   +3.996965563693091e-01   +1.097992015722377e-01   +8.172732459628435e-01   +6.071685013365075e-01   +1.734099301248029e-01   +8.901370278819327e-02; +6.311429466534128e-01   +8.823974829384710e-01   +6.141500795201500e-01   +4.834380526017181e-01   +5.462671412016630e-01   +6.718491407586822e-01   +4.483250484745689e-01   +7.155777402671994e-01; -4.840243282463985e-03   -3.574438321826155e-02   +1.395246254417827e-01   +6.782559372018908e-01   +2.169958573063629e-01   +6.980535416689376e-01   +4.775233444120424e-01   +3.070314418001316e-01; +5.236116170874754e-01   +4.343870829848062e-01   +4.510724025747092e-01   +7.080832471234552e-01   +2.914235719263524e-01   +8.743361615607783e-01   +3.852740747115946e-01   +1.298407330762358e-01; +2.997042991223478e-01   +1.383860076146965e-02   +4.660560880080984e-01   +9.920482889311686e-01   +6.109200817981123e-01   +1.000925484218502e-01   +2.803650564986639e-01   +8.451583958215073e-01; +2.358915369170152e-01   +9.448912449179935e-01   +9.237776106819887e-01   +9.598119828483996e-01   +5.085890117405346e-01   +1.185269411835822e-01   +7.818537779449702e-01   +1.456853253615469e-01; +3.364469246244542e-01   +5.623973886337281e-01   +2.926486661926654e-01   +2.028652741751836e-01   +3.528573705478905e-01   +2.521800962923260e-01   +6.017239590734706e-01   +4.966732604122818e-01; +4.358707197504781e-01   +2.063446787780883e-01   +1.957915647407964e-01   +3.835414321415319e-01   +9.493937424311196e-01   +5.151887247709419e-01   +4.788577064688817e-01   +9.548476819684047e-01; +6.161219967408605e-01   +1.035617476964988e-01   +3.168810360387637e-01   +5.934046025538747e-01   +5.096944645615690e-01   +7.612466598488042e-01   +9.424441058099097e-01   +6.358292459061766e-01; +3.865625098972449e-01   +2.264317363777069e-01   +6.131260911332033e-01   +2.685760256176592e-01   +1.428619420965605e-01   +1.626915467372348e-02   +2.926156463864490e-01   +7.077543322163048e-01];
L3I_L3E_iAMPA_netcon = [+1.147843258996679e-01   +6.875299938029931e-01   +1.016682855584451e-01   +2.052276054067732e-01   +3.119098111730272e-01   +6.365916611363300e-01   +8.425170553217239e-02   +3.346180670480829e-01   +5.237289226449118e-01   +3.320583297025695e-01   +6.122276239817661e-01   +9.036386054332716e-01; +3.595762630425471e-01   +8.451617970690528e-01   +2.599505080317209e-01   +3.659105440981981e-01   +8.072006647054500e-01   +3.829605232180512e-01   +3.676387929510608e-01   +3.907101470486521e-01   +6.310475516432320e-01   +2.633580464021354e-01   +7.121921841796691e-01   +2.182960397373058e-01; +4.807312105297721e-01   +3.876093783907276e-01   +7.925270795001770e-01   +8.925499412566292e-01   +6.087381730047020e-01   +5.811899174783272e-01   +1.000000000000000e+00   +4.362151818706242e-01   +2.111984487822728e-01   +3.107803044392509e-01   +9.301149913329744e-01   +8.538622592914277e-01; +4.929621414415091e-01   +9.906085256663476e-02   +5.693913312652054e-01   +7.448811184775704e-01   +4.509572105100561e-01   +5.909266459864065e-01   +5.979891333567705e-01   +6.924388167301697e-01   +5.356782227687285e-01   +1.988437489745484e-01   +4.212747683278881e-01   +4.745634476040672e-01; +9.402207654939809e-01   +8.106910190234489e-01   +5.995359891476083e-01   +4.875250751477173e-01   +2.548978695760964e-01   +3.500176034352150e-01   +2.650426008385067e-02   +2.124874685857611e-01   -2.729204069002537e-03   +2.506994706056960e-01   +5.878346616794354e-02   +4.945795388289914e-01; +3.917632869914239e-01   +1.830196470845985e-01   +6.349029520474025e-01   +4.451694241562593e-01   +9.659936247503846e-01   +6.062257055635880e-01   +3.085708967026251e-01   +9.449449657177007e-02   +1.766039882518782e-01   +5.614106147089289e-01   +3.145591259825514e-01   +7.202557212404601e-02; +4.975670147470388e-01   +2.091769484999237e-01   +8.290162885994220e-01   +8.823443294938713e-01   +1.264380164495341e-01   +3.053447107594810e-01   +3.957021517638917e-01   +1.193372258282064e-01   +9.257472857533298e-01   +7.166600228593915e-01   +2.851094640040301e-01   +2.965367680316895e-02; +3.778235766371777e-01   +4.173821447823837e-01   +2.514579969329854e-01   +6.075689517718985e-01   +8.496355874701350e-01   +2.574089747672960e-01   +4.062583002667566e-01   +3.018379194488311e-01   +3.340560954236327e-01   +2.766193471408991e-01   +6.976222886223588e-01   +5.709553689966036e-01; +3.257844322301332e-01   +5.326258204716801e-01   +3.650022175948723e-01   +5.783193517747481e-01   +5.566248004063493e-01   -1.513628804630244e-02   +1.067830621875586e-01   +5.927560896810772e-02   +3.387488606731789e-01   +2.392397802655250e-01   +8.986046775536576e-01   +8.889957054964500e-01; +7.466568261728628e-01   +6.143128261602337e-01   +5.619040523524981e-01   +4.013854511816024e-01   +4.185054625929037e-01   +4.164745077520236e-01   -3.633859470753800e-02   +6.518616724513226e-01   +4.309712090292502e-02   +9.306222615930607e-01   +4.755789272920810e-01   +1.606862171060195e-01; +8.987037112322736e-02   +2.601693600263084e-01   +6.484704215390216e-01   +2.375327765286978e-01   +7.684967950262728e-02   +5.180476748328759e-01   +9.149853936413134e-02   +7.469719593238453e-01   +7.533963418558408e-01   +1.558672797792496e-01   +6.873590832432273e-01   +2.677917285977993e-01; +5.929254862961031e-01   +6.303256934858734e-01   +3.874060399290348e-01   +6.081781853346383e-01   +6.861212758290116e-01   +4.275974061385872e-01   +3.370921974214928e-01   +7.933331681400303e-01   +6.227820600872986e-01   +4.097160938637068e-01   +5.033303699998134e-01   +4.084559990866704e-01];
L3E_L3I_iGABA_netcon = [+3.173331960214201e-01   +7.174719043529474e-01   +7.115421854405044e-01   +8.840440955049966e-01   +4.634500615882221e-01   +1.038324708236749e-01   +2.464784056114313e-01   +7.194458876915395e-01   +8.051542699828771e-01   +2.498748260168871e-01   +4.957449011656144e-01   +2.798893080067485e-01; +8.639808936040937e-01   +3.762338658172586e-01   +6.301283011498519e-01   +5.012969383945610e-02   +8.954091270138780e-01   +3.964940259343331e-01   +8.360255658612427e-01   +7.180168735073611e-01   +6.212263750932848e-01   +7.526776908506134e-01   +2.486307698764873e-01   +4.909447614609152e-01; +8.363996607114330e-01   +3.306849893615286e-01   +4.033669163859002e-01   +4.591907534189897e-01   +5.635276668561143e-01   +5.571466446292694e-01   +2.469562304694201e-01   +8.501646259417551e-01   +5.764025535813343e-01   +1.300379927723260e-01   +7.581182721894494e-01   +8.618374365549708e-01; +1.463080336307044e-01   +6.706934196824302e-01   +3.147965594890677e-01   +3.017419804588123e-01   +1.076898845886420e-01   +6.769117283426406e-01   +2.761856790625292e-01   +9.988202881716210e-02   +2.887435442063016e-01   +5.234987441427696e-01   +7.525761117313486e-01   +5.572467363417383e-01; +2.193327510489403e-01   +7.139204609541963e-01   +6.016355398719111e-01   +2.804012138647017e-01   +1.224264231316888e-01   +5.822949494943480e-01   +9.151183617725130e-01   +2.836520326688970e-01   +2.927972361865986e-01   +8.423432080211166e-01   +6.307479891531922e-01   +1.997069532290315e-01; +4.477474199884441e-01   +8.219830016500652e-01   +7.577644963091377e-01   +5.222673885553241e-01   +7.714914567157900e-01   +9.948795045679579e-02   +3.917119244008517e-01   +3.084694747807615e-01   +8.432098293881971e-01   +8.515967343733261e-01   +8.304038131622258e-01   +2.814197312141496e-01; +5.338818796770335e-01   +8.036576109474592e-01   +2.075944397480325e-01   +1.922408896585538e-02   +4.262235138831635e-01   +6.464305161336865e-01   +6.275687344959330e-01   +2.075692700957936e-01   +9.549971385347196e-01   +6.135729976893041e-01   -9.886762145270685e-03   +3.712722711303181e-01; +4.691181744862271e-01   +4.291177472764530e-01   +8.656651357210768e-01   +3.803924319690697e-01   +7.691593574443373e-02   +1.075668595722185e-01   +5.867776596683187e-01   +4.109431540835735e-02   +6.210492261884459e-01   +8.227192532131674e-01   +1.940419210389608e-01   +9.966429929565919e-01; +3.123197966304797e-01   +5.749810043814323e-01   +2.537176370155448e-01   +7.188419788278965e-01   +8.848602585696127e-01   +3.411394660883681e-02   +3.774446666456058e-01   +5.649640939832171e-01   +5.989744703475590e-01   +9.194822216106716e-01   +7.158387015709107e-01   +6.303404719209330e-01; +8.490336579416953e-02   -6.182135959683469e-03   +3.712863109936598e-01   +5.806855987135596e-01   +7.729531622447725e-01   +2.088712761920096e-01   +3.330884546178312e-03   +3.460307374131489e-01   +6.900403051512675e-01   +2.953967483354465e-01   +6.249620281140348e-01   +5.021865648716482e-02; +8.892170684001297e-01   +7.437800656564637e-02   +7.109020689066163e-01   +5.015721503619180e-01   +4.295965206282729e-01   +8.681385085345906e-01   +9.176064803397149e-02   +8.177743865531237e-01   +3.329663109183273e-01   +9.625004062019068e-01   +4.790011703822407e-01   +7.420524909593399e-01; +6.500419532581687e-01   +8.357732028001302e-01   +5.257116894606323e-01   +9.022245455336525e-01   +8.452678072852821e-01   +4.898399250337401e-01   +9.553536485112297e-01   +8.830529643512250e-01   +4.611732518778701e-01   +9.126380584406026e-01   +5.331051858957304e-01   +9.081532658681825e-01];
L2E_Input1_iAMPA_netcon = [+9.801757410224504e-01   +9.736704382834648e-01   +9.232274887336628e-01   +9.841453813909733e-01   +9.316182281632276e-01   +1.000000000000000e+00   +9.471831246101339e-01   +9.566874503624151e-01];
L2I_Input2_iAMPA_netcon = [+9.525475026419375e-01   +9.660470467885827e-01   +1.000000000000000e+00   +8.933072072109520e-01   +9.466601241560574e-01   +9.529813466278606e-01   +9.475151900597119e-01   +9.526413446476334e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last =  11.21 * ones(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))*0.4 + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.5*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.5*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))*0.9 + 0.5*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))*0.4 + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.5*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.5*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))*0.9 + 0.5*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
