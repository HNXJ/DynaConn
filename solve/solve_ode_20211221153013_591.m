function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+7.324311777109908e-01   -3.892148679509640e-02   +1.230955458059897e-01   -5.935494657896553e-02   +9.090385569239054e-01   -1.698167572834929e-01   +4.368368795497369e-02   -2.001819461849275e-01   -4.569033551086106e-01   +1.478199106205102e-01   -2.547171536546155e-01   -4.590436521570336e-01   +1.232328311517671e-01   -8.552765068942081e-02   -3.298588750705966e-01   -7.110664086327231e-01; -4.338003659523820e-02   +4.028959197331347e-01   -5.564017509628575e-01   +5.114859534889454e-01   +2.509513936013202e-01   +9.332071072671633e-02   +4.098551531656836e-01   +1.253780163176959e-01   +2.731289483766915e-01   -4.110206656984817e-01   +4.378655686803440e-01   +9.186423279386003e-01   +1.856926799086482e-01   +2.702387231501582e-01   +4.291836311984073e-01   -7.192907124498275e-02; -1.510658271006253e-01   -1.803798901299673e-01   +3.501367587375022e-01   +1.567075277834001e-01   -4.084481259723780e-01   +1.260825794670729e-01   -2.935423583572278e-01   +5.516805459239222e-02   +2.451332638695593e-01   +5.912896947049290e-01   +9.512201817381217e-01   -6.451336138890909e-01   -1.807996519600562e-01   +1.258678640632917e-01   +2.093632635041020e-01   -5.312216337248412e-02; +9.189470087794477e-02   -1.115594041393591e-01   -3.461975652515012e-01   -6.232439831076407e-01   -4.603349601854018e-01   -2.237085525533989e-02   -4.114405456393209e-01   -3.238835457822909e-01   +4.812800932171599e-01   +1.002177956680974e-02   +2.089964597064760e-01   +3.824354115254955e-01   +1.945105373720596e-02   -2.996005159896645e-01   -7.856775285845746e-02   +6.696698561517129e-01; +5.872249543684962e-01   -6.195345576907532e-02   -1.525779327241372e-01   -3.108097076595506e-02   +6.931210152305710e-02   +1.547703351418494e-01   +4.838331516959523e-01   +2.101081832891147e-01   +6.590078258005018e-01   -6.854492121886674e-01   -5.204023610265744e-01   -1.687899417547949e-01   +3.483951772000873e-01   -1.812683942962890e-01   +4.931996912607157e-01   +2.452658592440949e-02; +4.560286575400286e-01   -1.020278276501554e-01   +1.629299239643023e-01   -6.143843856925691e-01   +1.641931925260652e-01   -2.139541856705596e-01   +3.193843639525213e-01   -7.556357289258622e-01   -2.610504142467256e-01   -2.793325789773264e-01   -3.137270948280972e-02   +8.092181812002227e-01   +2.246036961633282e-02   +1.704737111122961e-01   +2.322104693045415e-01   +6.248750256478192e-01; +1.422053220827044e-01   -2.338581696224154e-01   +9.192857139191849e-03   +6.945972698865067e-01   -1.713609578834094e-01   +5.647429686674100e-01   +2.083596773719912e-01   +9.222678552890488e-01   +5.605286915747820e-01   +2.527545184899359e-01   +2.567319853738891e-01   -4.406375596486133e-01   -2.130708781977742e-01   -7.572295770265451e-01   -5.090231796532012e-01   -3.131807937424497e-01; +3.105461095762090e-01   +6.259790258729626e-03   -5.698818129915010e-01   +1.710037264716789e-01   -3.695074208340683e-01   -8.694294114924812e-01   -2.949868567647314e-01   -4.185734147785626e-01   +1.041197353401087e-01   -6.105694566452294e-01   -1.532619166925137e-01   +4.669725065095309e-03   +6.677731030787463e-01   +4.572240352070006e-01   -3.744075094044828e-01   +4.403576988315760e-02; +5.711516570931381e-02   -3.050261066116156e-01   +5.277235352033842e-01   -9.590810036406990e-02   +3.268535154019278e-01   +2.011809921308823e-01   -6.062532370447462e-01   -5.755390571232678e-02   -1.365342288323324e-01   +6.039690717818863e-02   -9.368297789548443e-01   -6.078082719267440e-01   -2.546281745689815e-01   +1.884031038063954e-01   +5.237999879179501e-01   -1.859953127355206e-01; -1.639417203693906e-01   +2.349411876392143e-01   +2.129075491760379e-01   -5.188815270356120e-02   +2.395246757780387e-01   -3.418898976956474e-01   +1.098951516070713e-01   +1.831187279103386e-01   +1.623100181023710e-01   -3.006763876134074e-01   +5.653784580166098e-01   -3.222669839409785e-01   -1.510372634361544e-01   -4.801135822062325e-01   -3.620407225357076e-02   +4.021303131680937e-02; +7.109994940645040e-01   +4.488663525763890e-02   +4.882638499961731e-01   +3.250980209951270e-01   +3.437261495067012e-01   +7.123369492228101e-01   -2.491179660693655e-01   +5.945693753880352e-01   +6.642425797636241e-02   +5.378472500219293e-01   +3.889593910191425e-01   +8.654073662053404e-01   +1.188852452787658e-01   -7.293525986814428e-01   -5.231344584269477e-01   -1.870129365281869e-01; -1.211735078206878e-01   +9.556785539464419e-01   -6.799051101947228e-01   +1.645495734391752e-01   +3.470875079669738e-01   -4.902265359877748e-01   -4.350264848832802e-01   +4.024933597096308e-02   -2.527766324625803e-01   +3.177812415390933e-03   +3.208200613277775e-01   +5.871755854359003e-01   -4.446832157845209e-01   -2.001510102641766e-01   -1.441803615261640e-01   +1.780089139339681e-01; +4.272211098053672e-01   +5.417715656725952e-01   -7.119878313139974e-02   -7.061423787525061e-01   +2.415910165792273e-01   +4.179400583561321e-01   -2.356533319746694e-01   +6.137269840388547e-02   -1.588104350046093e-01   -4.486987310269909e-01   -3.890399170338497e-01   +2.828028045418206e-01   +7.216491305829535e-01   -2.418194430703162e-01   +3.118237862880143e-01   +4.544297330810299e-01; -2.096126486716668e-01   -5.987505368317534e-01   +2.300870968320446e-01   -1.168298077786111e-01   -2.640524431534123e-01   +4.065770995064794e-01   -3.177111984792836e-01   +1.876069182493319e-01   +1.573186441799453e-01   +1.690916144982048e-01   +7.568550813960433e-01   +3.875385876870696e-01   -2.448944105673351e-01   +3.997106446240783e-01   -1.000000000000000e+00   -8.411315854529002e-03; -3.240806046564977e-01   +2.855365452270389e-01   -4.337607816993887e-01   +4.406852143545066e-01   -4.140534813441349e-01   -1.444026315814369e-01   +1.849295106442992e-01   -1.080952220932225e-01   -4.221033546547748e-01   -1.743681208610210e-02   +2.534066164440025e-01   -6.163697350085703e-02   +1.756086654730502e-01   -3.979524901131792e-01   +2.619209991380952e-01   +6.930967966328229e-01; +1.140032780018953e-01   -1.977165207629845e-01   -2.556554056031090e-01   +3.735380800127184e-01   -3.992489618393615e-01   -6.636563690257006e-01   -4.674160094135030e-02   -7.380000041007178e-01   -5.668953755648897e-01   +3.083542568924159e-01   +3.912783315904741e-02   +1.574060161751758e-01   +5.850620461294018e-01   -3.432570367903391e-01   -1.371056094569928e-01   +2.793763987229861e-02];
L1E_L1I_iGABA_netcon = [-1.351590188586692e-02   +2.816754432477530e-02   -4.456424273271717e-01   +1.307843031615069e-01   +7.349866724254311e-01   -5.014936247718364e-02   -1.648533049794110e-01   -7.732065173965599e-02   +1.748063642981467e-01   +5.251561367841605e-01   +7.044526720110753e-02   +9.419840393073442e-03   +4.610289149577428e-01   -2.910218092777284e-02   +3.542603396639534e-01   +6.501958411960529e-01; +3.268072709415183e-01   +7.270820314803227e-02   +2.479739722349155e-01   -2.139858952004417e-01   -9.821814420576759e-01   -3.147669220105240e-01   +2.220283692139237e-01   -4.038413254307841e-01   +7.748894517479948e-02   +7.565046396692962e-02   -7.883728281397780e-01   +6.881409254847676e-01   +3.647074837863578e-01   -4.405682569837654e-01   +2.847265424136662e-01   +1.603139825477621e-01; -2.967261169531386e-01   +3.278892217833492e-01   +8.746544231016841e-03   -6.565479609023541e-01   +1.187886348827892e-01   -3.294149066486908e-01   -1.520774405095471e-01   +2.440558849736146e-01   +9.726916287770179e-02   -9.251941089135317e-02   -7.624763178099481e-02   -5.582048734470914e-01   +3.072380255602664e-01   +3.050543995099882e-01   -7.772478294990564e-01   +1.752588733200730e-01; +4.189586901930779e-01   -6.533407187637397e-01   +2.592461789031857e-01   -7.717872036595930e-02   +2.351485673222558e-01   -6.961511895735654e-01   +1.981447542665097e-01   +1.462195949991859e-01   +4.763312966341644e-02   -2.910440725893993e-01   +1.596018477161741e-01   -1.815168056316590e-01   -3.221480715758291e-01   -7.418384574229413e-01   -1.672618396846594e-01   -3.515784855014941e-01; +1.147657756571966e-01   -2.849344118259830e-01   +3.779311205103391e-02   +4.415798002598694e-01   -2.417710098668799e-01   -1.935491186265763e-01   +5.890537347005730e-01   +1.070897449127046e-01   +7.981862866912897e-03   -4.590666179335151e-01   -3.384967642442666e-02   +3.582891970206511e-01   +3.973142675396645e-02   -3.515954582701356e-01   +1.889777512937433e-01   +1.118593850481923e-01; +2.528818538515350e-01   -2.665510864721689e-02   +7.730532253132394e-01   -2.780444793551913e-02   -5.860470249542016e-02   -2.253752936385764e-01   +2.463806489602987e-01   +2.330441019096472e-01   +3.055273045575449e-01   +3.015422545776617e-01   +3.461286843254325e-01   +9.935004681111212e-02   -6.177313244329610e-01   +1.018915839375539e-01   +5.847578041984783e-01   -5.315774296761875e-01; +1.240046164202768e-01   +1.249713483060021e-01   +8.167210563715694e-01   -4.206434389054773e-01   -5.156261228711556e-01   -3.587241992611332e-01   -1.319381409106671e-01   +4.354464895820717e-01   -9.334437824661689e-02   +2.619785679575737e-01   -3.916804488860925e-01   +1.557070690589848e-01   +6.121885686402766e-01   -2.161252432488708e-01   +3.842166834766230e-01   +3.480577535039316e-01; -6.716072758695797e-01   +2.448240682974585e-01   -2.766411278404811e-01   +3.391911974193556e-01   -5.987968009292854e-01   +4.150847773609510e-01   +6.767724232037929e-01   -7.418745496755446e-01   +1.109532200531651e-01   -3.582518120652679e-01   +4.664358797880960e-01   +2.421825177113319e-01   -1.309801558144059e-01   -1.929614187181620e-01   -1.395746689378439e-01   +1.986089731081780e-01; -2.060647602013179e-01   +4.076736630834320e-02   -6.837607745433275e-01   +1.339623601215089e-01   -2.224400829363246e-01   +6.518410854854855e-01   -7.001277376226356e-01   +1.469103900751653e-01   +2.571042719062091e-01   +5.365927158932012e-01   -4.680008719395155e-01   -2.021966221553235e-01   +6.703984880145414e-02   -5.119118319645357e-01   -2.830384693427374e-01   +1.254773637666015e-01; +9.868798144081921e-02   -8.266123039230952e-02   +1.918309087987376e-02   +1.439649843586670e-01   +3.061964001805631e-01   +1.572990023854928e-01   +1.334496406014439e-01   -3.655308022428463e-01   -3.343476078018186e-01   +2.062287151953725e-02   +3.857836793467857e-01   -1.932026640095025e-01   -3.302591480636471e-01   -4.600294465302516e-01   -8.283007488186578e-02   -1.264081109601008e-01; -9.653219186269585e-01   +5.051884503203266e-01   -9.917670911971115e-02   +6.320181449714845e-01   -1.683362437776195e-01   +2.941983383395407e-01   -3.284871576886870e-01   -5.141832722879833e-01   +3.048965810873850e-01   -4.370346298811374e-01   +2.572916518850706e-01   +6.763144685541119e-01   -5.398507639159993e-01   +1.466925828393204e-01   -3.890339183765566e-01   -7.431504992916481e-01; -6.616476797580807e-02   +3.936416718357470e-01   -4.935063798544680e-02   +1.231940093530218e-01   -4.573775716787477e-01   -7.498058397167990e-01   +2.161324844090694e-01   +9.745793364951599e-02   -5.359711131186172e-01   -6.747370814493088e-01   -2.531440533748562e-01   -4.838677164128327e-01   +5.419494117158622e-01   +1.685203564405306e-01   -1.408444158705356e-01   -3.716344509483165e-01; +3.444439026970950e-02   +2.213894698004850e-01   -1.223422079525219e-01   -3.540090728471284e-01   -9.454082372957359e-02   -1.682456000642178e-01   -1.281195185484852e-01   +4.361964345974353e-01   +3.136158937155144e-02   +3.210046337749030e-01   -4.382803774408289e-01   -7.246866172057771e-01   +5.022184231835547e-01   +2.380924378806591e-01   -5.244182910025879e-01   -1.686318202611538e-01; +3.741865587822384e-01   -3.086429346408726e-01   -3.147238157081616e-02   +5.193978946223404e-01   +4.112519288855343e-01   -3.820744891411141e-01   -4.536115970284041e-01   +2.878245970614194e-01   +6.031113086950829e-01   -1.717609463174529e-01   -1.507633758028847e-01   +1.391228310728064e-01   -3.440868336047737e-01   -3.609092962383709e-02   +3.581365006234155e-01   -4.088921582642343e-01; +4.554299289709768e-01   +4.358208106320072e-01   +8.245312105861412e-02   -2.580782219518163e-01   +3.373602533751542e-01   +1.786996355466139e-01   +3.211790540609369e-01   +2.108803502786162e-01   +3.586671550108732e-01   +8.121008683827593e-03   -4.173765183438067e-01   +2.654439927203588e-01   -4.413472445774111e-01   -8.965534032571029e-01   +6.871911259914122e-01   +2.866268227244408e-01; +4.804541259867591e-01   +2.718792974448720e-01   +1.000000000000000e+00   +2.226387430096713e-01   +4.037433147843439e-01   +1.144592174703430e-01   +4.709230418767881e-01   -6.455151306734683e-01   -4.215529879326534e-02   +7.482255141236492e-01   +1.274561497441163e-01   -1.360263032688770e-01   +1.139026318328061e-01   -2.134719338920300e-01   -3.430615796750133e-01   -3.142359735396335e-02];
L2I_L1I_iGABA_netcon = [-3.960040786403462e-01   +3.191622240319413e-01   +3.134557382847087e-01   +3.701968438244710e-01   +5.539153782712936e-01   +3.378563799844694e-01   -2.519474874886620e-01   -6.295345294646125e-01; -2.032054114283979e-01   -2.348184862963632e-01   -1.369023416503299e-01   -7.900113845654547e-02   -7.014500742111455e-01   +2.093617644074060e-01   +1.649829329792049e-01   +4.221825670153425e-01; +4.054773202382819e-01   -1.997234978459966e-01   -2.761521300947630e-01   +5.736564567618455e-01   -2.317929492451037e-01   +1.938514140722613e-01   +5.799503381431826e-01   -5.873728600466389e-02; +6.227267855473931e-01   -3.881533812447900e-01   -1.863151000352632e-01   +1.728696074217179e-01   -1.297044786763049e-01   +4.797062436874551e-01   +2.045669554126945e-01   -7.242575805330129e-01; +4.208463672174026e-03   +2.861492244799103e-01   -1.412952208568344e-01   +4.926146555909375e-01   +3.719932677835766e-01   -1.532206220230606e-01   +1.499958862536548e-01   +1.367023405759315e-01; +8.812504992025605e-02   -5.889120506304873e-01   -2.142409294949255e-01   +5.726686168274234e-01   +7.270865328705652e-01   -6.681068223030279e-01   -2.965137315025771e-01   -8.135372566645191e-01; +2.848981439596383e-02   -4.734326375055961e-01   -1.408070428217067e-01   -3.161801999626138e-01   +2.730200584184835e-01   -6.218564183127673e-01   -9.843850186830481e-02   -4.109895786812534e-01; -6.866126153720201e-01   +4.407085448435769e-01   +4.830374520399546e-01   -9.788667794100955e-02   -8.070010503102233e-02   -1.372781600393941e-01   +5.768612455915595e-01   +2.605892949077275e-02; -3.534812742363685e-01   +3.567738134083729e-01   -1.126467377589483e-01   -4.489764270277955e-02   +1.484682632564866e-01   -5.733462551303970e-02   +7.224188956209516e-01   +1.058309114867657e-01; -1.151038476730121e-01   +5.156990834830518e-03   +3.976227067230003e-01   +2.260934930137739e-01   -3.368623294558164e-01   -1.879890695334050e-01   +4.154784249990940e-01   +4.620322066925354e-01; -3.228301003752492e-01   -1.633196316964320e-01   -1.082723598701550e-01   +2.876320038773894e-01   +3.535262893618989e-01   -1.944074412006338e-01   -4.896578335930791e-02   -2.691096206561959e-01; -6.441117842103277e-01   +1.295105251870413e-01   +1.477514253324983e-01   -5.886452794423573e-01   +1.555783440070077e-01   +4.834550496799944e-02   +4.465831386386309e-01   -1.187918074273272e-01; -3.976889126803187e-01   +6.571725744898592e-02   -1.000000000000000e+00   -1.370505744267765e-01   +1.007087395635494e-01   +1.854098991897703e-01   -7.606777292586293e-01   -6.325838016496997e-01; +3.734399360610972e-01   +1.910047386485939e-02   +2.339025793887076e-01   +3.939674334065312e-01   +1.053699766250099e-01   -4.155370729136144e-01   +3.771447496184966e-01   +3.095729392389495e-01; +2.012090160009781e-02   -1.909315771338498e-02   -4.359248073007375e-01   -1.007145271765081e-01   -1.399191394926884e-01   +7.936133744210325e-01   -7.093805996996363e-01   -3.946501630066930e-01; -3.353571236458174e-01   -4.306864586653507e-01   +1.437797673531943e-01   -2.822551348736269e-01   -8.520619313624589e-02   +1.387070240176587e-01   +4.622361974398084e-01   -4.240123503964526e-01];
L1I_L2I_iGABA_netcon = [-2.533041225836676e-01   -3.697859587270437e-01   +1.532119192333299e-01   -3.336202845769118e-01   -2.613356531810466e-01   +9.209873015774338e-02   +4.207629181164985e-01   +1.000000000000000e+00   +2.543223172693065e-01   +8.972249664560606e-01   +8.016724991693799e-01   +1.474248542012770e-01   +2.885782475704265e-01   -4.314706945387536e-02   +2.726175435780218e-01   -3.089013379028443e-01; -8.577208054255231e-02   -4.944889822906359e-01   +2.043478233962112e-01   -4.536926852951495e-01   -1.981385751326358e-01   +4.014866870645482e-01   -1.761619528120292e-02   +1.894301144531976e-01   -3.000991183892091e-01   +5.876060157580910e-01   +5.934328444344421e-01   -2.509457488281349e-01   +1.576572162077703e-01   +6.610201151165664e-02   +2.472829130587327e-01   -5.487256912481273e-02; +3.267810722909811e-01   +4.893801601905163e-01   -3.418221099041435e-01   +8.634916024889600e-02   -2.770014518251404e-01   -1.394806645190060e-01   -4.639002252349901e-01   +4.013853819609526e-02   +2.973567245009181e-01   -3.084241384379665e-01   +5.427657863839156e-01   +5.150658988671842e-01   -4.180787116264914e-01   -1.824417630765948e-01   -5.566192207777590e-01   +5.940272026961663e-01; -5.287564716018149e-03   +8.803457113568067e-02   -1.855562323161889e-01   +3.204796734486464e-01   +3.818248061358195e-01   +4.779695399815139e-01   +2.710191856936123e-01   -4.334016559916818e-03   +4.555125812001893e-01   -4.992568879409763e-01   +2.164108644695941e-01   +5.837535578051978e-01   +5.291707786086970e-01   -4.223998794621572e-01   +7.846742068490538e-01   +4.074904221637782e-01; -2.320720363929154e-01   +3.911469092030441e-01   -5.398891162070594e-01   +2.995244651511925e-01   -1.786982352308309e-01   +1.510673984868873e-01   -5.799061133190332e-01   -2.635596895722346e-01   -4.362491336100829e-01   -2.367164812261233e-01   +6.181321801477496e-01   -8.813202843631734e-02   -2.142144069263368e-01   +4.575329405222129e-01   -4.758991683103009e-02   -2.836316467118922e-01; +1.052235327900188e-01   +2.572159875011766e-01   -2.663003251183972e-01   +1.921408172782569e-01   -1.128845352677551e-01   -3.711488735675773e-01   +6.680259480745507e-01   -1.862608212815118e-02   -2.221049537383309e-01   +2.461612523949982e-01   -2.428002583976409e-01   -5.005881358258389e-01   +2.629504940972367e-01   +5.367664830926855e-01   +2.304709013513899e-01   +6.427414974634432e-02; -1.108563665934153e-01   +6.807272363426879e-01   +2.606959493842868e-01   +2.545942215217826e-01   +1.127448590163841e-01   +1.567621694690363e-01   +1.611693171009788e-01   +4.559597404490758e-01   -6.521647893586894e-01   +5.177043409001375e-01   +2.337502377781525e-01   +4.576583927850872e-01   -1.640744370075671e-01   -3.441241601802064e-02   -5.428188429161640e-01   +7.214493955185395e-01; -4.176034647343976e-02   -6.941929798788257e-01   +6.941292155760033e-02   -3.292028808444405e-01   +3.625563453910803e-02   +7.105203624886286e-01   +2.886321714280635e-01   -2.580364610291123e-01   +4.488029501775175e-01   -5.491291197835615e-01   +1.218220869195075e-01   -3.554684802134295e-01   +3.789222473624794e-01   +3.560791169851404e-02   +2.515396150749154e-01   +1.810808771592689e-02];
L2E_L1E_iAMPA_netcon = [-4.296573889245256e-01   +1.252885458654845e-01   -5.398276744708991e-01   +1.895206852039720e-01   -3.942827558655786e-01   -1.773479105564326e-01   +8.795927862815968e-01   +4.931845523759488e-01; -5.601952799163590e-01   +2.495844767463303e-01   +1.060304998584328e-01   -1.640829921475370e-01   -3.860973791952855e-01   -4.004229164564953e-02   +3.185055938585766e-01   +2.842800328937110e-01; -3.714286107602086e-01   -5.155992476524621e-01   -1.356328557400540e-01   +1.439731798815932e-01   -3.108081806251732e-01   +2.098004587498631e-01   +4.221149878874799e-01   -1.803178055027998e-01; +3.078049205484588e-01   -2.958528041341860e-01   -1.036260729110761e-02   +6.003000357301834e-01   -2.503329376485972e-01   -2.360059440846092e-01   +3.416399824239755e-01   -5.510043017003327e-01; +3.024007914726023e-01   +2.639348854572182e-01   +3.117824559879017e-01   -1.947222829630474e-01   +9.474281851460176e-02   -3.260377574757428e-01   -2.000758741860053e-01   -2.103651502562039e-01; +1.151209884257431e-01   +1.280334107419405e-01   -1.556756757853946e-01   -7.396383031380095e-01   -8.506068416086563e-01   +4.250581030701388e-02   -5.287334173502017e-02   -1.365855062727794e-01; -4.097287184811841e-01   -2.535548183068730e-01   +4.519859475385845e-01   +4.382654204996922e-01   +3.528943676235645e-01   -7.158420090511496e-01   +3.024840083236398e-01   -5.096681795413088e-01; +2.956165609180859e-01   -1.225811460463779e-01   -2.091249159212827e-01   +5.698413161512959e-02   +4.493998524362470e-01   -4.134269652634328e-01   -5.909675700971369e-01   +4.271747447278517e-01; -2.869319107123251e-02   +7.251331213915618e-02   +6.124870671509629e-01   +2.687841308461447e-01   -9.273089652384883e-02   +2.354892155465705e-01   +9.309835410985838e-02   -4.381523359919405e-01; -2.206922783519350e-01   -4.163098411234218e-01   -1.604505681473473e-01   -1.063350589297466e-01   +2.469755199234024e-02   +5.860203546287688e-01   +7.477700467364648e-02   +3.543325585564896e-01; -4.081041403156422e-01   +1.486087803973602e-01   -7.132674111775686e-01   -5.503563674514859e-01   +1.874739124939547e-01   +3.005653289855594e-01   +7.642536199044090e-01   +1.874295457322033e-01; +1.752448332411353e-01   -6.853695561100684e-02   -1.624411860055354e-01   -2.631649747064290e-01   +3.387750114058332e-01   -3.767188711575309e-01   -1.054979095759826e-02   -4.836257874527128e-01; +1.184477859028822e-02   -4.502015270313989e-01   +3.294405752089365e-01   -7.614535651667951e-01   -3.653421582249107e-01   -1.913595795991171e-01   -4.661580635329031e-01   +4.055929602799542e-01; -9.513401592759052e-02   +1.000000000000000e+00   -2.681750026248628e-01   +2.581255305018419e-01   +3.801124364355720e-01   -1.105699898894538e-01   +3.808765156245169e-01   +3.007093992593028e-01; -3.202277251587116e-01   +3.742942552234529e-01   +1.306286234669417e-02   +3.451823429238094e-03   +3.129566119857035e-01   -3.396745878759844e-01   +5.928947977772431e-01   -2.805307328375807e-01; +5.058738639759614e-02   +3.551979311000267e-01   +1.487530678845190e-01   +3.508800333534769e-02   +2.495094825366578e-01   -3.313012847720603e-01   +6.871869161832332e-01   +5.386070993970210e-01];
L1E_L2E_iAMPA_netcon = [+4.234351964008718e-01   -1.150570523973570e-01   +4.220428053284067e-01   +3.954537459873885e-01   -2.133442911477955e-01   +9.171527161043636e-02   +1.955008489993202e-01   +3.281837896848926e-01   +5.543422220525209e-01   -5.569464669005942e-01   +3.217022423228869e-01   -7.729500676160159e-01   -1.340751652670943e-02   +2.061512273384846e-01   -3.245197945990526e-01   +6.786848231799290e-01; +5.668436218195710e-02   +3.440163588399249e-01   +7.807978051365391e-01   +6.055295837146361e-01   -4.810525939998401e-01   +2.865530337611633e-01   +9.837879833580904e-02   +3.021700708919072e-02   -3.303543810732872e-01   +6.293880511523335e-01   +1.931584441836924e-01   -5.278009349122865e-01   -3.336681186415604e-01   -4.966855299730212e-01   +4.369172409260551e-02   -7.663235179877450e-01; +9.950730700866826e-02   -1.702897422550028e-01   +2.047848662155957e-01   +2.865947011799085e-01   +7.475972596839963e-01   +1.306206533277776e-01   +1.000000000000000e+00   -1.425226015617275e-01   -7.335083937848380e-02   -3.702542458869589e-01   -3.652189294009130e-01   +5.749380886908095e-02   +3.427403299063497e-02   -4.204629116679107e-02   -3.208323311657529e-01   -5.935975193764138e-01; +3.240293719866358e-01   +7.083771237608109e-01   +9.161750356125240e-01   +3.612484335233578e-01   +1.115550557377141e-01   -7.490005962075361e-02   -9.360214094363339e-01   -9.931304790976849e-01   -4.568758203150584e-02   -3.811908091742494e-01   +9.750394457816371e-03   -9.538410726511023e-01   -3.313512532173871e-01   +5.226492985789295e-01   +9.578227480256972e-02   -3.062906073796236e-01; +1.061682722350071e-01   +3.696598493677011e-02   -7.408543403921883e-01   -5.578281946446525e-01   -1.517158068863802e-01   -5.921208742073684e-01   -5.248260232879378e-01   +3.613823180643009e-01   +3.424756501987588e-01   -1.773714039617076e-01   +9.324504801636475e-02   +3.458034419002587e-01   -8.083954740801512e-02   -5.574757979715634e-01   +4.527858505230684e-01   -6.834913390574784e-01; -4.989457215266725e-01   +1.663331001843869e-01   -1.632664848719048e-01   -1.232020277465765e-01   +4.390193825743839e-01   +4.003369786703755e-01   -6.150816814218103e-01   +4.664293441471759e-01   -5.027982559494816e-01   -4.138128729805707e-01   +7.968580385323707e-01   +4.615376658375790e-01   +7.981916238426773e-01   +2.813520157492161e-02   +3.487859033591771e-01   +6.530858066914590e-02; +1.812486687557155e-01   -1.793328733272538e-01   +6.984248733620713e-01   -2.049324015210174e-01   -4.867972199419151e-01   +2.148114046733744e-02   -2.272435383249058e-01   -6.159701762791805e-01   +8.075725594933957e-02   +1.141333179776953e-01   -2.139977458745440e-02   -3.821353935489292e-01   +3.026433038295258e-01   +3.772866279198951e-01   -1.932615204444448e-01   +1.721424554314922e-01; +3.490454315119026e-01   +2.411569724548484e-01   +5.491307857109620e-01   -4.826574551924047e-01   +8.327461652641864e-01   +5.190509779735758e-01   -2.382008771706877e-01   +3.103235142865969e-02   -3.181683037774202e-02   +8.156993671828940e-01   -2.535721456305406e-01   +2.909774402278171e-01   -4.336238759324335e-01   -4.575804019619410e-02   +1.825071774463809e-01   +8.059029210898322e-01];
L2I_L2E_iAMPA_netcon = [+1.449483176285359e-01   +1.233999080788390e-01   +3.280600319011169e-01   -8.333166376981517e-02   -4.098225823177136e-01   -1.858376369185483e-01   +3.581207519752689e-01   +1.525617104113046e-01; +5.694097183116309e-01   -3.386674920092757e-01   -4.080283932785960e-01   -5.453283083377606e-01   -6.643686393167877e-01   +5.898665678221795e-01   -2.033028741520214e-02   +4.687124296435806e-01; -4.927286639588495e-02   -7.038521869777724e-01   -1.206007791398002e-01   +5.917722428607721e-01   -3.558816158557671e-01   +2.724668820212437e-01   +1.063260547187507e-01   -9.370158193830096e-02; -5.681081609821593e-01   +6.532975124875489e-01   -1.909677690420413e-01   -2.988843090216070e-01   +1.391869169354988e-01   -4.678162665354325e-01   -9.871139542438809e-02   +3.511788807595144e-01; +1.242267939652750e-02   +1.776684552379453e-01   -5.396290642901417e-01   -1.427356431405956e-01   -3.540565015688047e-01   +1.154240099534509e-01   -7.396624477381231e-01   -7.018469697029102e-02; -4.576480723160585e-01   +8.914943643389837e-01   +1.209726193277271e-02   -8.821575946340943e-02   +5.984112736201589e-03   -5.216925663039618e-01   +5.927753471826017e-01   -1.569250493853807e-02; +8.783692023983318e-03   -3.675952638341697e-01   -5.169368321503516e-01   +5.507192450038740e-01   +1.000000000000000e+00   +9.135150436717560e-01   -5.154625883320492e-01   -1.316486190268383e-01; -5.739110236088110e-01   +3.953689056229281e-01   -3.368376979473677e-01   -2.403706356000877e-02   -5.985992346084660e-01   +3.472790603407987e-01   +3.981392218603885e-01   -2.867268956908197e-01];
L2E_L2I_iGABA_netcon = [-1.969668361573612e-02   -2.714615885037595e-01   +9.367617020699197e-02   +5.344849416118359e-01   -4.397974265222101e-01   +5.471987711802773e-01   -9.371066809943932e-01   +1.737115627018829e-01; +1.000000000000000e+00   +1.853458492728658e-02   -2.507026890279000e-01   +1.869296881347906e-01   +3.019660252078517e-01   -2.090466152761437e-01   +5.093671044008889e-01   -2.732212249273681e-03; +2.830392707549758e-03   -3.839896753741349e-02   +5.035926316996942e-02   +8.224666262674956e-01   +4.760779794896471e-01   -2.530177562361691e-01   +7.067337456364334e-01   +3.738940264061847e-01; +3.700559449222722e-02   +2.286448038239407e-01   -2.626053752237046e-01   -3.067644810063377e-01   -4.029312802386617e-01   +3.677059150366661e-01   -1.660634496314599e-01   -2.910256322994321e-01; +7.377611306955575e-02   +8.186822097271469e-01   +6.192524805457212e-02   +2.392173717131870e-01   +7.769108894265551e-01   -2.001422001667713e-01   -3.184599404478420e-01   +4.243718033616612e-01; +4.741159462142007e-01   -3.771074905534046e-01   +6.292828589677220e-01   -4.674293357865706e-01   -1.678241267663642e-01   +5.966576144563194e-01   +7.017035859924306e-02   -2.891977687952214e-01; -1.194196019079846e-01   -9.879849629687468e-03   -4.341331125054318e-02   +6.143839279914688e-01   +6.640119428107044e-01   -3.707099909178078e-01   -5.719807237763029e-01   -7.159142236803685e-01; +3.013025676378990e-01   +6.040894969825056e-01   +2.104392142138286e-01   +1.042921624752204e-01   -5.849193248202474e-01   +9.265543590354171e-01   -1.411272712110872e-02   +9.447401761798556e-02];
L3E_L2E_iAMPA_netcon = [+4.999039662164985e-01   -3.953735665802065e-01   -8.991570354192309e-02   -9.715251443975981e-02   +4.474117567205384e-01   +2.423556236642281e-01   +2.701992238195849e-01   +4.038384618742421e-01   +4.349065787336250e-02   -1.750673952411397e-01   -6.280045380401272e-01   +7.593781958874487e-01; -3.580430612599851e-01   -5.861446111450037e-01   +2.556337058771992e-01   -1.794567695389772e-01   +6.748815235717795e-02   +1.518242174413262e-01   +7.093826671533420e-01   -2.769267357329515e-01   -6.878053510127957e-01   +7.545968683404344e-01   +3.512706781815809e-01   +9.390791322246543e-02; +6.090920174283962e-02   -2.286150879734618e-01   +1.756711774488731e-01   +4.931817019988035e-01   +3.721749031415066e-01   +5.109146383114280e-01   -2.678713194757153e-01   -7.375519642525202e-01   +7.519214909033184e-01   +3.681033448520209e-03   +1.961685066141721e-01   -5.002781566067115e-02; -1.534882036996315e-02   -5.548916786783817e-01   +2.964984622448901e-01   -4.027664555354057e-01   +2.085901093335919e-01   +1.380843906943341e-01   -5.626970189048305e-01   -1.361946089384892e-02   +5.108963413976051e-03   +8.199238901188540e-01   +2.248692762935302e-02   -2.141773092913742e-01; +1.797107605684231e-01   -2.259207133396805e-01   +1.576422797417714e-01   +5.559739256575456e-03   -2.997596126926407e-01   +1.885594208573363e-01   +3.949148524568818e-02   -1.768627808075924e-01   -5.296550588640452e-01   +3.223047251865190e-02   +6.352321844521930e-01   -3.825165739766848e-01; +5.558019266896842e-01   -1.539966826092599e-01   +4.148100130998653e-01   -1.381376754545187e-01   -4.451535510932540e-01   +6.458072329892676e-01   -5.728588391835038e-01   -6.997328434241006e-01   -3.749770535878189e-02   -3.493557701540667e-01   -3.803000242294316e-01   -5.764013428632747e-01; +3.038597374168924e-01   -9.489857304377752e-02   -8.594459576714923e-02   +2.615150375777223e-01   +4.084905739468685e-01   +3.508522847325106e-01   -9.029769153896268e-01   -6.131916309449043e-01   -7.339665900212532e-01   +2.102751202014462e-01   +2.002961252289770e-01   +1.000000000000000e+00; -5.170309153264709e-02   +3.984352504217393e-01   +7.157664419090543e-02   -1.758947074558267e-01   +7.661745506761561e-01   -8.791811790850458e-01   +5.641882031440882e-01   -5.927985655038007e-01   +7.902638182706236e-01   +4.265984126262308e-01   +3.947840783353738e-01   -7.655585867936576e-02];
L3I_L2I_iGABA_netcon = [-2.901327809757386e-01   -2.787133761885607e-01   +1.088337604813500e-01   -4.796136540561812e-02   -1.098251621584129e-01   -5.765052033665150e-01   -1.998502431690862e-01   +2.656204241846026e-01   -3.065048881657394e-01   -8.410423283138459e-02   -3.627642080263016e-01   +4.577044507840068e-01; +2.622482747463399e-02   +3.392090782009164e-01   +3.462485866852582e-01   +5.164824476188369e-01   -1.989043199586903e-01   -7.787831002731957e-01   +9.916096390061491e-02   -2.068910638229148e-02   -1.020164343088586e-01   +1.552671127514100e-01   +4.554290214447101e-01   -4.850412354586491e-02; +5.384647583455974e-01   -6.583276169876826e-01   +6.413559817524337e-01   +8.446697162144210e-01   +2.442543274928120e-01   +6.431179875052050e-02   +6.022861649431014e-01   +2.743920983781322e-01   -2.902408948495216e-01   +2.767285054223529e-01   +8.471630105396362e-01   -2.458449258354748e-01; -6.179991243361861e-02   -5.298919687879287e-02   -4.382449145177591e-01   +4.903110927771147e-01   -2.063576268737141e-01   -7.506934710285067e-01   +3.699612719359524e-01   +7.524083260149251e-01   +5.822903373849340e-01   -1.000000000000000e+00   +2.698499580829178e-01   -7.949911024105987e-01; +1.395178164406255e-01   -6.633950832173476e-01   -1.561133766580219e-01   +6.855089206620556e-02   -4.372096501034099e-01   -3.403661562646994e-01   -5.387356571866906e-01   +5.014051176246131e-02   -8.391685538084761e-01   +6.341341844181779e-02   +2.462828876477649e-01   +3.543033538752257e-01; +3.935462536909360e-01   -2.168897154109742e-01   +3.234549736623227e-02   -5.948770115431853e-01   +8.072731332214798e-02   -9.951860392027625e-01   +4.713692653337131e-01   +1.048412747364469e-01   -1.126100688425216e-01   +3.344143744287414e-01   -3.445085450215379e-01   +2.367504462506397e-01; -1.350758389049467e-03   -6.238409485028186e-01   -7.415288277907758e-02   -5.813235509976987e-01   +2.295641475939948e-01   -6.118348307947715e-04   -3.613583748956469e-01   -3.478604959358386e-01   +1.035314342287918e-01   +5.311665854060346e-01   -7.000640701778520e-01   +3.888560505303898e-01; +3.270291764517398e-01   +3.926445014812199e-01   +2.807276623298301e-01   -2.285480455898720e-01   -6.635211494054412e-01   -5.222233917683812e-01   -1.936455223206111e-01   +2.197009017664555e-01   +4.502903490821258e-01   -9.992846301636892e-02   +1.446140336188498e-01   -1.935471879994045e-01];
L2E_L3E_iAMPA_netcon = [+4.793705517591167e-02   -2.040990515324790e-01   -5.238308130254534e-01   +4.845328741768694e-01   -7.221334494652818e-01   -1.067837115004776e-01   +2.151101954808076e-01   +3.313850724889648e-01; +2.499794351393114e-01   +4.439954386521384e-01   +6.291146083621030e-02   +3.769622803442642e-01   +1.795475437346898e-01   -6.341685273378057e-01   +3.811247947740783e-01   -5.881899105829819e-02; +6.551685532176221e-01   -3.439082709465311e-01   +3.996949590897744e-02   -2.843588227792875e-01   +3.250251253884335e-01   -7.188440958235657e-01   -1.237704716067956e-01   +3.442940894943886e-01; -8.120904488450408e-02   +8.138469136937935e-01   +3.785705031290107e-01   -4.150309651794328e-01   -6.800173650885305e-01   -1.188951322646899e-02   -7.706898378974920e-01   -3.161300075655293e-01; +8.048854380407189e-01   +4.096634700777247e-01   +9.876911668951268e-01   -1.000000000000000e+00   -1.297354726904366e-02   -1.007360511452076e-01   -9.494297781907869e-01   +9.430819354326833e-01; +4.783340878057682e-01   +6.087939047921635e-02   +3.748440437134932e-01   -9.012252078672345e-01   -5.333953163208416e-01   +3.046240535448874e-01   +2.364925535075383e-01   +3.216197037420639e-01; -7.654788249679013e-01   -3.472216907124743e-01   -2.911214227929954e-01   +1.374259654507541e-01   +3.401915904570312e-01   -3.035646427331032e-01   +4.235907136972363e-01   -1.385969194507384e-01; +2.416535366703662e-02   +2.585360536827500e-01   -1.908746791629987e-02   +4.102876751786572e-01   +6.747025666662813e-01   -4.491983941054337e-01   -2.402087285126707e-01   -5.302428895672879e-01; +5.215094230003007e-01   +6.227997913883847e-01   +9.573094176064798e-01   -3.219629526833672e-01   -6.629033848772294e-01   +7.108425084459559e-02   -9.306570617701679e-01   +7.098302690732869e-01; -4.495871081882338e-01   +7.383176734432849e-01   +4.744922924020410e-01   -7.807665099278701e-01   +6.563506457550550e-01   +1.717624704152467e-02   +8.720120688300214e-01   +1.672076097766446e-01; -8.427468307159408e-01   +3.296237456188761e-01   +1.272707789659893e-01   -8.433046991477120e-01   -2.192957600994434e-01   +4.775469835335678e-01   +3.434348218993559e-01   +7.355310745942080e-02; -2.357929853724023e-01   +3.573626778077778e-01   +4.753392336868141e-01   -3.417364183376814e-01   -1.471858870157325e-01   +4.023008752741086e-01   +2.694603795548375e-01   +5.401266733033963e-02];
L2I_L3I_iGABA_netcon = [+2.252055288837427e-01   +1.403188679591868e-01   -6.333529159776070e-02   +2.707047654620692e-01   +2.500508071236030e-01   -5.033510534340494e-03   -1.978376797939212e-01   -3.270634007406489e-02; -3.996792897712371e-01   -1.438773976098322e-01   -2.655977782146220e-01   +6.468638483672725e-01   -1.488664724169487e-01   +8.580957138629385e-02   -1.001611072618492e-01   -4.203750994210341e-01; +2.892149060296885e-01   +5.942425001820224e-01   +3.980881654187136e-01   +4.479698470386136e-01   +2.177118260209329e-01   -8.043744122153617e-01   +1.542900203406539e-01   -7.035810261708711e-01; +3.277916138675252e-02   -1.444935459040833e-01   +1.870224719980981e-01   -5.112537988930939e-01   +2.097801913034098e-01   -4.683562300161175e-01   -2.268858861419804e-01   +4.865484087425724e-01; -2.861618589628130e-01   -3.310998442199660e-01   +3.085161822684704e-01   -7.695823260646452e-02   -3.854980931458735e-01   +1.012626791830483e-01   -2.074727442875597e-01   -2.812121276229160e-01; -1.784721476751323e-01   -2.288715999190931e-01   -3.173503138929790e-01   +1.172975246073622e-01   -3.201714064513153e-01   -8.548237986228809e-01   -3.574039621593945e-01   -1.191551515139127e-01; +6.522909921401766e-01   +6.991699751463522e-01   -8.485128350495239e-02   +4.618154963572175e-01   +8.469976013814270e-02   +8.110866476081852e-01   +2.030503844022004e-01   -1.992374739534333e-01; +5.854987960816402e-01   -9.751680295686507e-02   +1.041677532838738e-01   -3.247057337094700e-01   +5.190150369316680e-01   +4.348263895038467e-01   -2.617311241618985e-01   -1.985576079800642e-02; -7.566335690604595e-03   -7.883024283395092e-02   -8.537083006538057e-01   -4.989383911081287e-01   -2.217816450064506e-01   -1.949528881674110e-01   -6.619732848369168e-01   +4.410425240011679e-01; -7.019303597973194e-01   -1.268303164673112e-01   -6.043257196810284e-01   -4.230811276584145e-01   -1.307991026005168e-01   -2.031405415431868e-01   +6.087202430237301e-01   +4.140092345817725e-01; +1.241381181412801e-01   -9.920720619924452e-02   +2.030316673592002e-01   -4.823441428695394e-01   +1.000000000000000e+00   +3.293691673643615e-01   +2.339592655154217e-01   -5.860389663407980e-01; -2.553139510715404e-01   -1.324831522387499e-01   -2.953115761217839e-02   +4.663690958276166e-02   +6.130329127087605e-01   +5.683398616685328e-02   +5.455213104910152e-01   -1.054046973113187e-01];
L3I_L3E_iAMPA_netcon = [-9.148518914612425e-02   -2.898499608278816e-01   -1.000000000000000e+00   +1.134397221718573e-02   -9.119178672633175e-01   -5.487419608706487e-01   +2.867210202888825e-01   -4.398560051986642e-01   -3.649492348374416e-01   -4.190039138929909e-01   -1.036128092487389e-01   +2.456709575412997e-01; -7.030687667540225e-02   +6.333337206957751e-01   +7.421997701452761e-02   +3.062136793431421e-02   -2.779277703112330e-01   -7.879656213946126e-01   +5.573946446760859e-01   -3.970215601256417e-01   -2.815523753297361e-02   -6.902892543335153e-01   -2.792043725221094e-01   +7.451768434622268e-01; +1.028273236445183e-01   -1.935241468802825e-01   -7.843678695299576e-01   +2.532756895674174e-01   +1.591389676406188e-01   -8.272972508275531e-02   +4.539309968501866e-01   +4.728675133447759e-01   -5.326715991812789e-02   -4.296443976281069e-02   -2.450727005005475e-01   +8.516200731775420e-01; +2.265606815521385e-01   -3.222083078284325e-01   +5.813251181148699e-01   -7.737092537165263e-02   +2.261192869459004e-01   +6.470452346501241e-01   -6.060939214187193e-01   -4.731279114329455e-01   +2.870852141622053e-01   +4.881693772208860e-01   +1.462425483570310e-01   -3.647046644735333e-02; +1.784284838310592e-01   +1.959818619635897e-01   -1.564958942801993e-01   -1.169682721601253e-01   -4.370006635141470e-01   +8.673730598837494e-02   +5.026909781099916e-01   +6.130951356392060e-01   -4.739786894403647e-01   -3.839937760256414e-01   -3.016480316983730e-01   -5.490324034648978e-02; +1.487924415875189e-01   +3.798800072965111e-01   +3.821199387562759e-01   -6.459251530565863e-01   +4.559853186891935e-01   +1.174060371551052e-02   +4.061148175826285e-01   -2.856168350137429e-01   +1.462925505719673e-01   +6.314177377992415e-01   -1.037763190117053e-01   +5.056295372428592e-02; -7.765626140847117e-03   -2.103324396661879e-01   +8.689142249423851e-01   -3.553924785451651e-01   +8.247713717368889e-01   -3.001719603151830e-01   +6.739098987905797e-01   -1.897599781918400e-01   +4.420220068412522e-01   -1.078180482917476e-02   +2.094238710595389e-01   -7.405428045515201e-01; -7.176291582857508e-01   -8.397290530530449e-02   +3.564070353523349e-02   +2.346882325321409e-01   -6.289658900068347e-02   +1.708436526837783e-01   -4.611286457362518e-01   -1.946339386417082e-01   -2.479926337318813e-01   +5.829010934596507e-01   -1.691780193208264e-01   -3.768948831944934e-02; +2.167068854549516e-01   +2.587983448990554e-01   +8.806836252499658e-01   -4.654873225819129e-01   +4.121958079593599e-01   -3.352445534525696e-01   -4.330338203012600e-01   -2.603115364860398e-01   -9.792623001183319e-01   +1.640616277906374e-01   +9.316678323878652e-01   +3.074904874214024e-01; -6.835640925538662e-02   +8.979867914301953e-02   +3.412019335362269e-02   -1.409668780473938e-01   +1.572399842007394e-01   +1.619273496331630e-01   -7.783820290601984e-01   +9.064367562742014e-02   -4.160741281386975e-01   -3.196998040128792e-01   -9.054203218670351e-01   -3.234986646959729e-01; +4.848718531117209e-01   +6.632983005070776e-02   -1.189936558900893e-01   -2.113803596253177e-01   -3.536552265249327e-01   -8.403083153838039e-01   +6.273438036502447e-01   -2.865958007119331e-01   +3.840182468515594e-01   +1.386858179707286e-01   -8.115992533042371e-02   -1.182279013466272e-01; +3.336541606383072e-01   +5.403160212636865e-01   -2.001240991608413e-01   -7.117145427854931e-01   +7.526721183187267e-01   +6.088407281879897e-01   +5.834041263984618e-02   +4.694435784203069e-01   +1.449114462849116e-01   -1.193628055661842e-01   +5.123346098362901e-01   -4.666173184804491e-01];
L3E_L3I_iGABA_netcon = [+7.113612250407008e-01   -5.387945087756372e-02   +7.339141599667670e-01   +3.016959803951873e-02   -1.216087087640084e-01   +1.689840556891263e-01   -4.908526868301009e-01   -3.820716958936824e-01   -4.789643083443336e-01   +1.492293940047645e-01   -8.572559003833596e-01   -3.548215339887426e-01; -2.262917795846858e-01   -2.361715379378936e-01   -5.718424397604659e-02   +9.129904509072744e-01   -7.199604805178077e-01   +3.193598178817580e-01   -6.010338864475028e-02   +3.554826391194906e-01   -5.521978323503864e-01   -1.299574835146548e-01   -5.145324845350157e-02   -2.934386227823843e-01; -5.717128850748097e-01   -4.206136922402751e-02   +7.140362889007856e-01   +5.162352507634753e-01   -4.482518545225909e-01   +8.955381292684164e-02   +2.346892322000762e-01   -1.428695488420163e-01   -5.208328606615934e-01   +9.726787317567738e-02   -8.751593804757360e-02   +3.253564426382929e-01; -6.580332144546949e-02   -1.251405079862264e-01   -5.420086801778544e-02   -1.769094965645517e-01   +4.125952428619898e-01   +9.652644638147031e-01   +1.113026536325586e-01   -6.466629136044012e-01   -1.132239324315393e-01   -2.440912251722316e-01   +6.379098801735078e-01   +4.103820299857348e-01; -9.516837027964826e-01   +8.206586916922006e-01   -4.048353671355720e-01   -8.845230101299947e-02   -6.702598317852184e-01   -8.219125811453403e-01   +4.641770634803546e-01   -3.135565703429522e-01   -2.617288311073499e-03   -1.593007156558303e-01   -6.735942666417268e-02   -1.978747303213510e-01; +3.310553997558375e-02   +6.087724144669137e-01   +2.457412387896660e-02   -4.109545228774824e-01   -2.918071178405762e-01   +2.505274486946635e-01   -1.432498182802062e-01   -4.638134264552820e-02   +8.788039475345023e-02   -3.199012875821702e-01   +4.112960623323929e-01   +3.687403034584796e-01; -6.203384010351879e-02   -5.474420516387498e-01   -1.031067738317367e-01   -1.118522939968238e-01   -3.486067460693949e-01   -3.692333513593443e-01   -4.099389915431932e-01   -7.137348179665435e-01   -2.067855963045914e-01   +1.582127030660018e-01   -2.103398306793239e-01   +1.958624994112259e-01; +1.402438503003842e-01   +5.103195401336607e-01   +3.343469280814478e-01   -2.843580743077305e-01   +5.391090080640977e-02   +8.861665173575237e-03   +8.991977599020177e-01   -6.544458257054366e-01   +2.974685796639490e-01   -2.805578373909447e-01   -4.087672827967733e-01   +7.051906839793405e-01; -6.627979811342237e-02   +4.001391257041562e-02   -2.644918370738474e-01   -2.234736656168196e-01   +1.366584490913215e-01   +5.652604413650406e-01   +4.946079951324167e-01   -4.332136144524656e-01   -3.825308384436985e-01   +9.659605216742920e-02   -2.150581785209644e-01   +3.857932483626383e-01; +6.305185879508349e-02   +4.444888525646374e-01   -1.508456504871948e-01   +7.251548434117119e-01   -3.338686527417014e-01   -2.974176842062616e-01   +3.951500059194265e-02   -1.265505562514154e-01   +6.290250637087043e-01   -4.305658137143422e-01   -4.288117622251600e-01   -3.977682722162064e-01; +1.000000000000000e+00   -1.730037773206905e-02   +6.311156672449711e-01   -3.890131720477446e-01   +3.865974784730529e-02   -6.439499870645175e-02   +3.755377973464871e-01   +2.408905621361028e-02   +5.826329398216026e-01   +3.206281997144637e-01   -5.149780024197493e-01   +5.219720480190949e-01; -4.885174999973554e-01   -8.450963825885718e-01   +5.054135284846394e-01   +1.720671072953021e-01   -8.137083692916662e-02   -3.487234975931897e-01   +8.866894741250070e-01   -2.616802058511200e-01   -4.129925163203031e-01   -9.065855052716498e-02   +2.591534727610610e-01   +2.628273059651795e-01];
L2E_Input1_iAMPA_netcon = [+6.473569522736859e-01   -5.802565474822799e-01   +4.902182035708814e-01   +7.313664032793186e-02   +4.209447794362478e-01   +7.663621503668012e-01   -4.013498321644632e-01   +5.403408086225028e-01];
L2I_Input2_iAMPA_netcon = [-5.955408813482673e-01   +2.030178138538148e-01   -1.278459741115381e-01   -5.701913349360694e-01   -7.050305208479837e-01   -1.000000000000000e+00   +1.169958608020122e-01   +8.629092198916903e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.4*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 1.0*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 1.0*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.4*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 1.0*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 1.0*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
