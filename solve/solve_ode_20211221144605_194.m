function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-4.952409008101499e-01   +2.960360511186245e-01   -2.612227870534593e-02   -1.439219160946507e-02   -3.046637416317532e-02   +2.054423186350431e-01   -1.199450720290337e-01   -6.596489690850449e-02   +4.725148936483109e-01   +1.766194520601335e-01   -1.151923660759358e-01   -4.422962424759709e-01   +2.437903666369295e-01   +1.816979264310300e-01   -2.577982503890488e-01   +8.177557488032122e-02; -7.457830733289731e-01   +2.703772694519923e-01   +1.519376952054169e-01   +4.874599178253479e-02   -1.578507823695696e-01   +3.350680667288673e-01   -7.762343624960694e-02   -4.861736341731589e-02   +1.285436615996553e-01   +5.645139843650577e-01   +3.325994540801334e-01   +2.486055359528932e-01   +4.169391018277734e-01   -2.257447949589462e-01   +2.973989279274373e-02   +2.032368900790913e-01; -2.481090406913512e-01   -3.552992217923715e-01   -2.713556934457581e-01   -4.587645532402309e-01   -4.728231346352232e-01   -8.979700327367074e-02   -1.834606155321984e-01   -3.864586974047901e-01   -3.423739444608147e-02   -5.668420218430410e-01   -1.048677613822776e-01   -2.938826130521138e-01   +1.866597084502751e-02   -3.929831908966229e-02   +1.886963392759748e-01   +2.318873134493422e-01; +8.024670331419748e-02   +4.503104067972106e-01   +4.088671723168850e-01   -2.554771677771065e-01   -5.635659499177896e-01   -9.121745434439493e-02   -4.457385495096134e-01   -4.154533944028131e-02   +2.912497053608956e-01   +8.469341187813914e-02   -4.429347231222509e-01   -7.668969603599887e-02   -6.538124807976265e-01   -1.845305262020288e-01   +3.045536065435033e-01   -1.073008300248500e-01; +5.082302077117434e-01   +4.038760712501834e-01   -6.907682458073172e-02   +1.598289511812526e-01   -2.542363704990322e-01   -3.691681899783672e-01   -2.536399398985700e-01   +3.928844748683628e-01   -2.494884478649643e-01   +2.956419970210655e-01   -4.129601028217071e-01   +4.739890343302943e-01   +5.367188793680963e-01   +1.779751604696422e-01   -6.589660973698028e-02   -1.963268887102452e-01; +3.012471988318629e-01   -8.845345502423917e-02   -2.886474518863014e-01   -3.238965723966099e-02   -4.608175401806410e-01   -3.723548723615402e-02   -3.901354482105562e-01   +4.780192117351829e-01   -1.300465088354660e-01   +6.162775964769923e-01   -2.661138927499094e-01   -2.220805603297067e-01   -2.503078823264986e-01   +5.186369734121278e-01   +1.546779279657330e-01   +2.831930153565923e-01; +1.153441859479320e-01   -1.010831113565838e-01   -1.423879913926093e-01   -1.445119358879472e-01   +6.129821281486816e-02   +9.162466191706123e-02   +2.386679198655387e-01   -2.325793159115728e-01   +4.560443746819405e-01   +4.799063715085023e-01   -8.454130854570469e-01   +2.739988343574926e-01   +2.238325912358680e-01   -2.467311676435283e-01   -2.520760421393681e-01   +5.215266489546339e-01; -2.059051015708041e-01   +1.056283244373030e-01   +1.317309076606208e-01   +1.616793834441345e-01   -5.320365747125299e-01   -9.022966831381363e-02   -1.382238866708638e-01   +2.218199657120191e-01   +3.683720736240473e-01   +7.257982739678552e-01   +2.034027222625301e-01   +2.030828840182638e-01   -2.298566102971280e-01   +1.513617764760963e-01   +9.214482049213345e-02   +2.372545113285232e-01; +1.313786017969949e-01   +3.110955532925022e-01   -1.100595732457488e-01   +2.303414967452363e-01   +1.548817739779391e-02   +2.816176504949800e-01   +1.532778302151095e-01   -1.596699694989853e-01   -1.328752451741489e-01   +2.918932789412854e-01   -1.293087344854485e-01   -6.751047755997959e-01   +4.338214365612647e-01   +2.841906603920855e-01   +3.097119724495069e-01   -1.226209313493831e-01; +1.193494380767448e-01   -1.944619916291384e-01   -4.506347420623505e-01   -6.947417395997377e-02   +5.922704557663140e-02   +3.581521167032227e-01   +2.403258474174159e-01   -3.600187654762001e-01   +5.869847679484069e-02   -5.085354204755497e-01   -5.119934779429887e-02   -3.598397503002109e-01   -2.485853963677724e-01   -2.166757482874774e-01   -2.948882261634525e-02   -2.463217934019186e-01; -1.704977013017119e-01   +5.002839625039335e-03   +6.193514769356780e-02   -3.327358939774376e-01   -2.061210640759846e-01   +9.892393380794542e-02   -1.395682728005401e-03   -4.418189135759226e-01   +1.540316217042171e-01   +5.293694261905113e-01   +4.092578733245915e-02   +3.971041448195643e-02   -1.433778289312041e-01   -5.766635848809480e-02   +1.350676538390453e-01   +3.248939266426271e-01; -6.316182247255846e-01   -2.858847986136306e-01   -2.204542617924678e-01   +2.770089465820508e-02   -4.895148803125164e-01   -3.898709426777697e-02   +5.491782619880595e-01   +3.413704699822509e-01   -2.177491925122435e-01   +6.505021467300688e-01   +2.201018816826634e-01   -3.638246367884322e-01   -2.128478982340505e-02   -1.446797550142344e-01   +4.949946583865453e-01   -2.003754474443747e-01; +3.520994518530512e-01   +3.676127025813746e-01   +9.700265486846742e-02   -5.212762906732417e-02   -3.304488917852790e-01   -1.088664552277971e-01   +1.226570880217314e-01   -3.746533275932646e-01   +2.258682757388587e-01   -1.259548247028833e-01   -6.172747324991059e-01   +1.448375237106366e-01   -3.645796775408333e-01   -1.158660949205952e-01   +4.558527057217980e-01   -1.731954776619155e-01; -3.132681748692173e-01   +1.268609094496928e-01   -1.234075084398279e-01   +4.816791188211955e-02   +5.215058331821656e-02   -7.505217559579773e-02   +9.608605509615036e-02   +1.539230529591439e-01   +1.068656312035646e-01   -2.145864595634417e-02   -1.649287564439050e-01   -2.225176469266023e-01   -9.961714637054118e-02   +3.783080900594696e-02   +2.155615341701270e-01   +1.039707904887009e-01; +8.913264906747020e-02   +2.830209901979601e-01   +3.940231167480494e-02   -9.781943812558863e-03   +2.458257691578730e-01   +1.074929733666754e-01   +1.768746951792784e-01   +5.068959147079195e-01   +2.158050239033792e-01   +1.841959203604640e-01   -2.277773938028842e-01   -2.178138769637835e-01   +2.837384187171377e-01   -3.760885047785951e-01   +8.841798307623920e-02   -6.095435638486160e-02; +2.218137589218451e-02   -2.468224704243861e-01   +6.286847167958267e-01   -1.164244574398264e-01   +1.789388966307242e-01   -1.856362010482880e-01   -1.126089247540764e-01   -4.132803936778356e-01   +9.332617046636611e-02   -4.784620889391504e-01   +1.940719923436637e-01   +5.025284916955380e-01   -3.314295461569312e-01   -5.122450979353480e-01   +1.217305070635869e-01   +2.501595780641593e-01];
L1E_L1I_iGABA_netcon = [-1.851998717597039e-02   -2.733040630055122e-01   +6.820275514127931e-02   -6.832644476607731e-02   -4.732851760757356e-02   -3.583221692346726e-01   -1.856890402404738e-01   +3.314250161514058e-01   -1.417916614645169e-02   +2.683937217910035e-01   -1.017069123455006e-01   +2.249147081903403e-01   +2.369591681392872e-01   -5.454835530368991e-02   -2.362740898437733e-01   +6.437713651624817e-02; +4.505796612410805e-01   -1.613510090351606e-01   +2.797787831436532e-01   +5.302985708536495e-01   +8.460866863736637e-02   -2.206658720526959e-01   -2.147809944676581e-01   -1.156191459791355e-02   -6.153773891605227e-02   +2.619174157899670e-01   -1.672143255055327e-01   -3.703904316871311e-01   +4.556138753066045e-01   +2.910478359564004e-01   +2.673194543873708e-02   +4.865861047103764e-01; -3.024213119623570e-01   -1.845856165548329e-01   -9.255193422881688e-02   -4.468908304102775e-01   +4.191373368414362e-01   +3.342910161549404e-01   +4.988795806139407e-01   +1.126688598809529e-01   +3.020922917835203e-01   -1.762620855799069e-02   +8.358479907696814e-02   +3.417405602889559e-01   -3.633144482072819e-01   -2.285380977665191e-01   +2.455736130990001e-01   +3.287715133481388e-01; +5.775455720501297e-01   -2.048911215215013e-01   -4.139186448120511e-01   -2.406040524735771e-02   -5.661405716095690e-01   +3.616902340428031e-01   +1.030796738338220e-01   +3.881439885771876e-01   -2.312277891515618e-01   +6.706327067730310e-02   +5.147151328315883e-02   +9.421775433780818e-02   +1.141414773771901e-01   +5.485825000854850e-01   -9.255810564619106e-02   -5.571454061999854e-01; +3.699232856381439e-01   -1.486631373030937e-01   -4.505749113089040e-01   +3.955843503413029e-01   -1.565814715372709e-01   -2.250091505588484e-01   -2.556046403165305e-01   -3.184661235585138e-02   -3.319093381794428e-01   +3.361531572883832e-01   -9.332840740249264e-02   -3.715448826092423e-01   +1.185539438130826e-01   +4.910260776596340e-02   -2.499586567344370e-01   -3.550502132000299e-01; -6.678725366417183e-02   +2.440892847017562e-01   +3.874851907922797e-02   -3.603320204700444e-01   +3.162458405833425e-01   +2.052227716742029e-01   -2.795424854375538e-02   -1.487420451616616e-01   -6.113802108410335e-02   -2.010694498454746e-01   -1.371752388168109e-01   -5.929610052942920e-01   +3.936365104018703e-01   +6.182999607580779e-01   -4.087209198324971e-01   +1.901033864130749e-01; -1.467940805418537e-02   -6.893274202950735e-01   +6.430463021803988e-02   -3.694415444355967e-01   -4.411363525752893e-02   -1.550690281208148e-01   +3.272506812150714e-01   -2.067354696976515e-01   -5.301648129846865e-02   -1.398550234984683e-01   +1.189030310426170e-01   -3.222728851168815e-01   +4.177068648923957e-01   +1.834837523502635e-01   +4.750616733232932e-01   +4.807152724912765e-01; -2.216798896067616e-01   -1.271188552504461e-01   +1.620524361750628e-01   +1.206371448575983e-01   -2.054804000013142e-01   -4.086647930021642e-01   -1.197123271284478e-02   +5.973264673129534e-01   -9.868374903894417e-04   +4.895180682239942e-01   -2.940459176841911e-01   +2.566746934410783e-01   +1.533935634274559e-01   -1.145062176832295e-01   -1.412923098549837e-01   -2.493279146816955e-03; +8.057878058550041e-01   +1.390340531058872e-01   -5.750730089964082e-01   -4.020548902208090e-01   +2.295764383873849e-01   +2.890721929223600e-02   +1.671111634033169e-01   -3.131664945716863e-01   +3.027943708770444e-01   -3.235001451169765e-01   -3.496369510466131e-01   +5.950370978356101e-01   +1.143180164387029e-01   +1.774558973245783e-01   +5.299035861668770e-01   -1.409443431922093e-01; -3.101970509367957e-01   +1.476799476169743e-03   +5.232250088287854e-01   +1.763494304534989e-01   +7.099192850828073e-02   +7.148154348585576e-01   -2.910724142582630e-01   +1.118243809606703e-01   +1.264051510615116e-01   -8.203397096513737e-02   -8.358300959988854e-02   -1.259203810817696e-01   +4.515238441234462e-01   +7.366003436152822e-02   -2.346193805109525e-01   +1.245774553212685e-01; -2.107191111924314e-01   +4.413084064698080e-01   +8.349659807365670e-02   -9.540834455857933e-02   -2.003052885514937e-01   +2.730962100497785e-01   +5.441496529924337e-01   +2.945869258205158e-01   +7.142893240820868e-02   +1.883773937629455e-01   +3.666765861188365e-01   -1.098506834875183e-01   +4.355605361480319e-01   -4.537116893736308e-01   +2.961990116818639e-01   -1.825096501352691e-01; +6.653054257240915e-01   -8.794891727906180e-02   -3.505121475418230e-01   +2.140036444456129e-01   -1.191446933514443e-01   -1.530903492118738e-02   -1.015062903447863e-01   +3.734550270910612e-01   -3.401077317186157e-02   -1.124553265004750e-01   -2.750359300902084e-01   -1.268988225739083e-01   -1.879201205438780e-01   +2.072716705981110e-01   +2.908437037567137e-01   -2.620364303118503e-01; +1.217896994928096e-01   +3.538534457541044e-01   -1.802964242301845e-01   -2.405988751749702e-03   -4.077688197598087e-01   -3.110026096973436e-01   +5.866267916485561e-02   -3.023218516596027e-02   +1.473425388953305e-01   +2.141997619373123e-01   +2.726714336009008e-01   -3.959093569855174e-01   -6.003919694530196e-02   -9.164260739359147e-02   -3.201468089079369e-01   +1.544510860800828e-01; -2.185319973050450e-01   +3.072941649410473e-01   +1.194045065355677e-01   -1.393652287771342e-01   -1.115344068257542e-01   -1.720080670017589e-01   -3.118595352791974e-01   -8.969475948728164e-02   -4.967042281097957e-02   -4.190825213784193e-01   +2.377337908376657e-01   -2.382482147596020e-01   +1.482636768206414e-01   -4.092483444703493e-01   -2.341156638272000e-01   +6.366900817202040e-01; +4.539290813872295e-01   -1.276928605873325e-01   +5.731302455094987e-02   +3.403786529311594e-01   -1.562974318260807e-01   -3.579636122020972e-01   +9.875194760392703e-02   +1.694051441944014e-01   +3.229127863419369e-02   -4.051537772903648e-01   -8.396843898436676e-02   -3.078731804593987e-01   -4.631744006135513e-01   -1.958321926028046e-01   +1.379420721463158e-01   -2.491954026227551e-01; -1.620789414017356e-01   +3.365563926420360e-01   +4.362221692607365e-01   -1.992159891709900e-01   -2.263785529469749e-01   +3.861805856247101e-01   +6.513974022390774e-01   -4.085985348634791e-01   +1.331899635955354e-02   +1.491784764937279e-01   -1.422617706883577e-01   +2.829349928182543e-01   +7.438266207060623e-02   -2.073463566504691e-01   -3.757595886331880e-01   +3.507503660515644e-01];
L2I_L1I_iGABA_netcon = [+2.155748847039300e-01   -5.679183689965102e-02   +1.800591695716719e-01   -4.491684347030717e-01   -1.985874142032890e-01   -2.177673100848556e-01   +6.729310812748834e-01   +5.453240040318121e-01; +7.607641670246676e-01   -3.093852782599444e-01   +6.430828767923192e-01   -1.230690395675513e-01   -1.242593638548158e-01   +1.508082205671846e-01   +1.660682085151443e-01   +1.399886451353758e-01; +2.134307071437908e-01   -7.404068856152386e-01   -5.847661619626718e-01   +7.613141509266288e-01   +2.485050169008477e-02   -5.158202308689513e-01   -4.834793982687912e-01   +4.073399112966543e-01; -6.605460286721730e-01   +3.658430460189257e-01   -1.051519861196862e-01   +4.389216247811308e-02   -6.244216710507753e-01   +4.100472596373266e-01   +2.831382316284800e-02   -2.948539313672367e-01; +3.244661515761718e-01   +2.756560442818816e-01   -9.992248855737865e-02   -9.610362404871250e-02   -2.028770275939554e-01   +2.471540575460809e-02   -4.115635179589487e-01   +8.637877210754444e-02; -4.143788250396410e-01   +1.155986801562712e-01   +1.841393267710520e-01   -9.851817483632798e-02   +8.011764573235457e-02   +3.584318604046060e-01   -4.444697578300730e-01   +2.407616792552721e-01; +5.905803307249228e-01   +4.180909659463659e-01   +6.643287243723869e-02   -3.089370698025229e-03   +2.243417945479025e-01   -1.930302546274756e-02   -4.946132455088465e-01   -4.428928302333898e-01; +3.120259186501832e-01   +5.314231788553444e-01   +5.837486431147852e-01   -6.691997872934524e-02   +3.651162896225402e-01   +3.600630096707117e-01   +1.543833555165173e-01   +6.779432688191058e-01; -3.034700861400380e-01   -5.883650437415668e-01   -2.459619238144706e-01   -7.960407307869427e-03   +6.114234068728737e-01   -3.385050802129196e-01   -3.559920306395102e-01   -2.115715741619462e-01; -7.516174980244081e-02   +1.464915624954230e-01   +3.401388983525127e-01   -6.430765913933953e-01   +7.892059621625941e-02   +2.807317565567097e-01   -4.454424113265821e-01   +3.883478718710893e-01; -3.144158881513165e-01   -3.647579183378269e-01   -1.536636314201079e-01   -8.467436735511855e-03   -1.232283772467772e-01   -3.114991729032742e-01   -3.794096815559818e-01   -2.355521732110477e-01; +5.485803750225902e-02   +3.193564462034716e-02   +2.152475430679807e-01   -8.782367865408237e-02   +3.539989895454712e-01   +2.307136115309904e-01   -1.320355609321598e-01   +7.338728640512751e-02; -1.557405667523952e-01   -3.778206758908948e-01   -1.464808740754278e-01   -1.672078811206227e-01   +7.406714388460423e-02   +1.879062764819207e-01   -7.413095175507186e-01   -5.861739808837682e-01; +8.733368614385262e-02   -3.467953380007764e-01   -3.262747480603765e-01   -3.175486448703356e-02   -2.289241455439122e-01   -7.149776476534454e-03   +5.307485865518253e-01   +6.334051061073083e-01; +4.677992788400991e-02   +2.780485148467233e-01   +2.430160401523289e-02   -1.106433477688664e-01   +5.320303252141176e-01   -2.367325246506714e-01   -4.219310588413703e-01   -5.161413734827126e-01; +4.479235948960937e-01   +2.555949480681043e-01   -3.157150092186446e-02   +6.953793051673574e-02   +2.696312828994808e-03   +5.544560136983181e-01   +2.721716490289384e-01   +4.071430122665819e-01];
L1I_L2I_iGABA_netcon = [+3.390024559034735e-01   -1.140762667694026e-01   +6.980066984884621e-01   -2.624755543900156e-01   -2.759772887592286e-01   +5.106192966574312e-01   +2.322986559892407e-01   -2.107704373950982e-01   +7.398350041339423e-01   -1.177383343328559e-01   +5.384078876488244e-01   -1.786146916718760e-01   +1.535649588519188e-01   -3.997371604792304e-01   +5.681004960244926e-02   +1.150748210877537e-01; +2.923195858285989e-01   -1.752326846117976e-01   -1.569991222787665e-01   +2.301813491048469e-01   +2.667284691489709e-01   -1.977689227398726e-01   -1.013358785097932e-01   +3.061542918122555e-01   -4.891358036174699e-01   -2.185319097569294e-01   -6.780686529423470e-01   -1.559673666125828e-02   -4.008035036542345e-01   +3.222446068077256e-01   -6.192734087016732e-02   +1.941466871695471e-01; +1.097357262134376e-01   +4.177592891688424e-01   -1.016380954861980e-01   +2.910505373140713e-01   +2.603822463090131e-01   -2.247832580944482e-01   +4.504642569023997e-01   -1.372932324093809e-01   -1.486560641335545e-01   +4.824968520480342e-01   -2.973638866237389e-01   +4.445202199196774e-02   +1.292907958467607e-01   -2.721737110754337e-01   +3.936862156270470e-01   +2.125015323921678e-01; +7.530267568561952e-02   -2.406800863914043e-01   -3.647724935452169e-01   -2.276480181056283e-01   +1.057807637939501e-03   +9.487043803717982e-03   -3.515039547141690e-01   -1.233374528419999e-01   +2.784872690934569e-01   -4.551631407570184e-01   +8.719130171179304e-02   -8.527218778270336e-02   +8.080423549205321e-02   -5.683888595442611e-01   -5.662042803441486e-03   -3.323813052543298e-01; +1.830585884746929e-01   +8.182373509286198e-02   -3.163532091752033e-03   -1.414592731215723e-02   -3.042814148391429e-01   -1.968611870344224e-01   +6.828554724911323e-02   -9.149277394535679e-02   -3.393628668997047e-01   -1.686287727619147e-01   -2.939146051633844e-01   +2.364924344086050e-01   +1.163195595020572e-01   -1.855575576221835e-01   +4.339761205073661e-01   -2.977170909477925e-01; -2.161780682218700e-04   -4.167196482861885e-01   +5.272138840134612e-02   -9.066074084069131e-02   -3.911928246232695e-01   +4.993837655097775e-01   +9.489077128420659e-02   -1.980763044325659e-01   +7.844962406373361e-02   +4.825911439952267e-01   -2.323150256509218e-01   +4.685251469275591e-02   -4.768986889663135e-01   -2.171313630419338e-01   +1.585621162142080e-01   -1.075873491103460e-01; -1.404957226795158e-01   -1.460259357734309e-02   +2.407365225899905e-01   +4.579718161766369e-02   +1.683120558860246e-02   -3.495141664987725e-02   -1.586695725234769e-01   +6.450542536331122e-02   -1.866925688883099e-01   +4.333977531750851e-01   -2.853208734230577e-01   -7.105158840631891e-02   -2.358754867272073e-01   +4.220110545599307e-02   +3.741926493367948e-01   +2.435568024180915e-01; +1.535387052214029e-01   +3.240355240395029e-01   -3.446449578842016e-02   +2.944112109681804e-02   -1.654758277038848e-01   -4.075116493610135e-01   +2.871057561443173e-01   -4.292224896428318e-01   -1.567220769488557e-02   +6.008427812599723e-01   -1.699117534294641e-01   -1.134836638454657e-01   -1.585573656361360e-01   +2.175436483656525e-01   +3.425124203982720e-01   -3.864409004252750e-01];
L2E_L1E_iAMPA_netcon = [-3.914146961284290e-01   +2.670907379840212e-01   -5.136763970881257e-02   -1.409218071733034e-02   -3.591158839059234e-01   -4.553768755280554e-01   -3.869987807044582e-01   +2.823419598616982e-01; +1.172591790099137e-01   +5.534108413967063e-01   +2.408213660541514e-01   -6.869580099148965e-01   -2.554441781806918e-01   -9.449788477426696e-02   -2.390531575860270e-01   +1.127380816200310e-01; -2.810772222903059e-01   +4.373292483817544e-01   +5.126803027603495e-02   +8.890082977308859e-02   -4.099684191924000e-01   -2.521708526401611e-01   +6.336689247854969e-01   -1.414281071503133e-01; +1.669913510810468e-01   +2.340248589777960e-01   +2.492298976380425e-01   -2.375683896590458e-01   +9.701542570497554e-02   -5.084666346369496e-01   -3.276268522637453e-01   -2.820140989349988e-02; +2.426705327129071e-01   +1.805203562942861e-01   +4.753247978844640e-01   +2.119466050156702e-01   -2.547045947366237e-01   +1.737413490431823e-01   +5.862669872275965e-01   -6.738154251898268e-01; +4.257738854949815e-01   -6.195969463983360e-01   -3.286533260673069e-02   -1.872841206441551e-01   -2.092145563817257e-01   +2.555297921738751e-01   +8.408341279541430e-01   -6.569438193453556e-04; -3.013410314415317e-01   +4.117548925346471e-01   +1.585419034448323e-01   +2.943801250567378e-01   +2.040882569158284e-01   +1.680587770006868e-01   -4.851330534417911e-01   +4.511737235914904e-01; +4.382668108655075e-01   +9.026936278192338e-02   +2.337490724389518e-01   +4.405126121509090e-01   +1.575121857978568e-02   -4.942037311333474e-01   +1.906603695579344e-01   +2.290727995267281e-01; +2.897900563333079e-01   -4.955087225738136e-02   +1.863509981689955e-02   -2.561979462007539e-01   +4.177609665195878e-01   +6.166729252443039e-01   -3.962916212526695e-01   -6.680886943021321e-01; -1.587601728074939e-01   -3.746630776361085e-02   -6.162462133535795e-01   -1.477264721836434e-01   +6.629560283584515e-02   -1.950881597875556e-02   +1.885253243725522e-02   +3.064616121120708e-01; -7.402999748844438e-02   -8.082819102027380e-02   +1.258880877086326e-01   -5.767923571990815e-01   +2.493808940439206e-03   -5.769132531883988e-02   -4.272786142738166e-01   -3.557729879893138e-01; +5.879759621373564e-01   -1.788910523862985e-01   +3.834632754913962e-01   -4.562494288991777e-02   +2.266464308875916e-01   -5.838457949600658e-01   -5.763760410526924e-01   -6.324085928495006e-02; -3.865666640780487e-01   -1.454539914076808e-01   -9.671358225417440e-02   -3.495271328503375e-01   +2.778808654015258e-01   -5.464643768439170e-02   +3.259042940653951e-01   -2.436417189671309e-01; +1.310261464247812e-01   -6.609166519023654e-02   -1.191411483164441e-01   -1.744857496011011e-01   -5.638467047662281e-01   +9.562475246933222e-02   +3.367879703418634e-01   -1.173290329555550e-02; -3.308850397361829e-02   -2.271876948953887e-01   -2.213103378306365e-01   -5.195926559810747e-01   +1.636887066112257e-02   +1.262723097209993e-01   -4.438441046633351e-01   +1.499610142142558e-01; -3.019640727904997e-01   +5.573013823593975e-01   +8.632672231740706e-01   -4.669675302298539e-01   +1.832289157341722e-01   +2.362493859065004e-01   -1.260242868281402e-01   -7.774351570479487e-02];
L1E_L2E_iAMPA_netcon = [-1.836920065631006e-01   +4.954427831284233e-03   +1.106913097325732e-01   +4.096087727011060e-01   -8.444177667944730e-01   -4.579852204343486e-01   -2.992723922152565e-01   +3.803406675989050e-01   -3.722170014672126e-01   +5.946713079659748e-01   -1.500587117982878e-01   +4.300562917773155e-01   -1.158838552460143e-01   -6.298547261367714e-03   +2.446085150448650e-01   +2.312662453865365e-02; +4.738546229915906e-02   -5.528921239650213e-02   +3.522321095852121e-01   +1.388909597496433e-01   -8.956952421917823e-02   -2.339649295768906e-02   -7.953912690280224e-02   +1.777964152445816e-01   -1.935055385098702e-02   -1.189188877223437e-01   -1.998796982648894e-01   +3.953140262049725e-02   -1.634167261629574e-01   -4.327930954933756e-01   +2.942510977120898e-01   +3.219544870686167e-03; +2.754090099112342e-01   +6.306705789987568e-01   -1.853576233997518e-01   +4.521677179371341e-01   -5.015619114827854e-01   -3.774258826976587e-03   -6.523365635402979e-02   -3.700542989927457e-01   +2.126781434574601e-01   -4.235641441131745e-01   +4.571281127409858e-01   +1.084965769512960e-01   +4.090887677122800e-01   -1.939020679223529e-01   +2.546851548652123e-01   -3.164123104616207e-01; -6.811417595704476e-02   +1.324782312499559e-01   +3.184267805372341e-01   -2.008610607416412e-02   +8.311050415154771e-02   -3.919123346968959e-01   -5.657974515382526e-02   +2.173122716321241e-01   +1.596900722521666e-03   -1.096942589929280e-02   +2.733054066179826e-01   +6.378295863454713e-01   +3.227409368816767e-01   -1.268776740353329e-01   -3.152671601277557e-01   -2.668644441666382e-01; -2.328192308480083e-02   -3.261035698617033e-01   +3.925168324503352e-01   -1.624764876305381e-01   -3.553794254829645e-02   +1.433958263248399e-01   +1.120724297533047e-01   +8.486649946959474e-02   +2.123107591624130e-01   +3.451428310361436e-01   +1.080968279187165e-01   -6.427927306715549e-02   -5.103270880065293e-01   +3.097951570368771e-01   +2.414648838973449e-01   +4.784137817242631e-02; +3.039707837165755e-02   -2.013045941710923e-01   +3.809142577693195e-01   +6.631907250429926e-01   +6.699928143150854e-02   -5.868213463348886e-02   -1.967913896749481e-01   -7.242966182359362e-02   -1.601373639123785e-02   +5.031833212476704e-01   +1.599015691126954e-01   +2.111841932996822e-03   +1.297044286113871e-01   -1.137604683428899e-01   +7.735416673215523e-02   +1.227262262808342e-01; +1.140613775485216e-01   +2.970455076913308e-01   -6.515766563047214e-02   -5.720199869258367e-01   -5.590603518186407e-02   -1.018955979177463e-01   -4.519891923540076e-02   -4.551042224368047e-01   -2.095938046500753e-02   -1.191219477885428e-01   -7.827047265582948e-04   +2.861288554246449e-02   -1.105458296408063e-01   -1.092834603740895e-01   -6.990452522917648e-01   -2.532865758893320e-01; -4.346234404378117e-02   -2.350396317315129e-01   -1.767710210699350e-01   +2.094378005032444e-01   -5.274784649551434e-01   +3.866315922856965e-01   -1.233875123637939e-01   -2.518072940436792e-01   +7.197327618532889e-02   -9.530205078796623e-02   -8.090288736642534e-02   +5.027679130460801e-02   +8.743523503395961e-02   -8.485349968156718e-03   +1.301468597808846e-02   -6.689949508620846e-01];
L2I_L2E_iAMPA_netcon = [-1.798172872421103e-01   +3.073846083300346e-02   -1.904746783305336e-01   +2.810523624777336e-02   -1.666184804181682e-01   +1.546402195342655e-01   +7.051462814440947e-03   +4.121683940882549e-01; -3.529211700246473e-01   +5.848295300113314e-01   -4.520523745631169e-01   +2.984799943847187e-01   -3.683407430466518e-02   +1.995616441843983e-01   -3.480817987463851e-01   +1.824044151096477e-01; +1.430225670427614e-01   +8.677376878841941e-02   +4.088727325772694e-01   +2.811844194189806e-01   +4.074433382343698e-01   -7.338593609291704e-01   -2.379226240138770e-01   +8.615892750084990e-02; +3.778494492393494e-02   +4.194849612326845e-01   -6.874164844520221e-01   +2.674505190025790e-01   -1.275436380938189e-01   +3.383476518782658e-02   -2.649648747457288e-01   +3.312240524950061e-01; +2.963337107225964e-01   -5.093740897618864e-02   +4.206726527683956e-01   +2.113904569414033e-01   +2.642883042468703e-01   -1.500725826890653e-01   +1.065206869469834e-01   +1.959110159221062e-01; -3.990742902190711e-01   -1.795600591065387e-01   -1.057492970369823e-01   +4.885596439777498e-03   -2.063856265072346e-01   +4.929479111328998e-01   -4.860004951445732e-01   -2.442395211657257e-01; -5.129710926423767e-02   +4.760116282905461e-02   -2.371174079429980e-01   +3.931896654135883e-01   -2.515443363884859e-01   +2.227177046934848e-01   +2.315849859641461e-01   +1.414557191932836e-01; -4.146930065169313e-02   -2.701586273961906e-01   -9.270296540113213e-02   -4.301498987752723e-01   -3.803602060780242e-01   -2.970551283442092e-01   -1.694594771212396e-01   -1.499333279918538e-01];
L2E_L2I_iGABA_netcon = [-6.198192712490453e-01   -2.050475938127059e-01   +3.046625667923518e-01   +2.228990188849237e-02   +1.176154425025835e-01   +2.554326569640143e-01   +3.177708777724509e-01   +2.409006346062989e-01; +1.841082367462440e-01   +4.330579127676830e-01   -1.919961898620300e-01   -6.259797986083285e-01   -4.194334415368905e-01   +6.834185806985353e-02   -7.246898763355047e-05   -1.752833648109156e-01; +1.947519011203045e-01   -1.295479378344054e-01   +7.005367167676615e-01   -2.520966623175495e-01   +2.699192491155950e-02   +2.744967393726785e-01   -8.441520702088727e-02   -4.726184971903103e-01; +1.435610155821749e-01   -1.857124709140680e-01   +2.708606585087815e-01   -2.091949630777040e-01   +3.558628121821108e-01   -3.010510529859221e-01   +1.405801879758261e-01   -3.476026866518204e-01; +6.405322720756917e-03   +3.420649417852785e-01   -1.429359510790116e-01   -8.871945549012714e-02   -2.477519817482095e-01   -3.865486757256916e-01   -5.277683940780072e-02   +6.692614543842866e-01; +1.257572186853194e-01   -4.133733035119102e-01   -3.385468923528638e-01   +9.059522036028109e-01   +3.652781908029993e-01   +1.756687833621282e-01   -1.410485318257311e-01   +8.667426382661747e-02; -1.094683880985327e-01   +2.973969097741740e-02   +6.295273993677977e-02   +3.426517561876000e-01   -1.901360404757364e-01   -5.723186569290033e-02   +5.241354425175591e-02   +1.589514588394464e-01; +1.051093942899886e-01   +1.541111670894156e-01   -1.981190589666394e-01   +1.332572601935915e-01   -2.240365568183128e-02   +5.376071406855677e-01   +1.718164534297290e-01   +6.505110232810590e-02];
L3E_L2E_iAMPA_netcon = [+4.147034834785586e-01   +3.448959837984991e-01   -6.663356071950680e-01   +2.688410693814084e-01   -2.031295906578365e-01   -2.033880441203494e-01   +1.106983072227824e-01   +3.601793808818239e-01   -2.621238923176048e-01   +5.761398139509127e-01   -3.208063940773323e-01   +1.094417018784942e-01; -1.493112970484971e-01   +1.555406237964235e-01   +8.898424081029579e-02   +2.993356495575166e-01   -3.411849887760106e-02   -3.213829809993927e-01   +7.362877665141315e-02   +1.260945881542706e-01   -3.314875704375951e-01   +2.085499324702590e-01   +1.461427915406311e-01   -4.917164859292958e-01; +1.997763105058857e-01   -6.180685580106383e-02   -5.845573553460662e-01   -3.360200920673454e-01   -4.965493820645867e-02   +2.903265135117389e-01   +1.318564537765102e-02   +7.026099477461614e-01   -8.568420136165932e-02   +5.271213000031825e-01   -2.211724131513945e-01   -7.370658608719733e-01; +2.165127066443035e-01   -4.274331033170606e-01   +3.821558440185528e-02   -6.300857131710130e-02   -2.267793552038390e-01   -1.490486476392404e-02   +5.884111847784655e-02   +8.477973501368571e-02   -5.226720546463245e-01   +4.998309915637298e-01   -3.906161487779076e-01   -2.767204611787845e-01; +2.801858007334452e-01   -5.445672599353982e-03   -1.120286490931530e-01   -1.594155092488426e-01   -1.297409270410836e-01   -1.995477747436633e-01   +3.316268279153560e-01   +6.992906627793125e-02   -1.760057671787145e-01   -5.964967809472332e-01   -5.136745572134907e-03   -1.959593742674286e-01; +2.273803428923684e-01   +7.889166392017516e-02   -1.649257900313967e-01   -1.091872449313765e-01   +1.313362727011866e-01   +3.079437003997337e-01   +1.864323462735120e-01   +1.279140391687192e-01   +2.090657215088455e-01   -2.119997919696888e-01   -5.715960359630779e-02   -5.741923704955717e-01; -1.243203698473743e-01   -6.209264119036461e-01   +6.986889328656641e-01   -7.695939744849851e-01   -2.231270691579987e-01   +1.060074415208893e-01   +3.121445702933371e-01   +1.632308014598645e-01   +2.649051641899630e-01   -1.878662252950691e-01   -2.039008389693430e-01   +7.940935423221070e-01; -5.290638668914811e-02   +3.101698206144691e-01   +5.215495508362053e-02   +4.910651055878447e-02   -3.914023843129448e-01   -1.711566627754877e-01   +7.630903832922665e-01   +5.286072955826143e-03   +8.412724146239847e-02   -2.019257443520520e-01   -4.635902954856854e-01   +9.804328359295281e-02];
L3I_L2I_iGABA_netcon = [+6.973745445562105e-02   -3.045541627988493e-01   +3.445341718507854e-01   -3.867852775701845e-01   +1.236887057268930e-01   +7.578675106089661e-01   -1.166714234998680e-01   -3.397147988417343e-01   +7.031317842824460e-01   -6.162730482059923e-01   -7.898427193878969e-02   +4.630243190113913e-01; -1.369527326243533e-01   -7.666529378230383e-02   -4.700694512629970e-01   -1.288266556189891e-01   -2.642228273966666e-01   -1.407883988015193e-02   +1.970214171733407e-01   +7.652164648547735e-01   -1.637670764281400e-01   +1.746224930312570e-01   -8.045771854362238e-02   +2.542787869508799e-01; -1.381333451636122e-01   +4.940245210850698e-01   -5.626675191105051e-01   +1.174376357741269e-01   -3.798274622106506e-01   -1.364626506601663e-01   +8.999724700094028e-02   -2.406007500885562e-01   -5.595349931998252e-01   +3.356605077718846e-01   +1.812643251697440e-01   +2.895552375519756e-01; +5.758296078688134e-02   -3.247783673052664e-01   +3.299668815528520e-01   +5.576799823224940e-02   -2.393982466854758e-01   -4.114545454812063e-01   -2.816503608004512e-01   -1.119701114395932e-01   +5.068505773089364e-04   -1.958858104653199e-02   -3.758339350869410e-01   +2.365490610211091e-01; -9.881465618401003e-03   +5.353988358954501e-01   -1.493437738854671e-01   +3.487027101947943e-01   +1.430068866950867e-01   -2.803485479960693e-01   +3.056406303732195e-01   +2.904529493557521e-01   +3.185464510834335e-01   -6.639461244306153e-01   +1.066424184269905e-01   +4.831266552353563e-01; +1.077696514930117e-01   +4.639913924381112e-01   -2.211135566688113e-01   -1.095514668901056e-01   +3.034977895071783e-01   +7.219076241955684e-01   -2.617428224688596e-02   +2.527313951903628e-01   -6.153710080195736e-01   -7.424222315880380e-02   -2.883183932242128e-01   -9.392400689303709e-02; -7.605086309238378e-02   +5.852562111848412e-01   -5.134402731873845e-01   +5.405785456813860e-01   +3.105948597381973e-01   -3.816082939510740e-01   +1.635205697287802e-01   -1.187096247656280e-01   +3.082729144006174e-01   +1.791343555058008e-01   -1.324308343603557e-01   -4.611549548384483e-01; -1.682699235897453e-01   +2.273413311548816e-01   +3.428402187972558e-01   -1.027835542998123e-02   -5.495048724580138e-01   +3.343050367049988e-01   +3.434258668271112e-01   +1.378593257153993e-01   +2.788345738474887e-02   +1.140441436759102e-01   +4.532338183186275e-01   +5.616641052782224e-01];
L2E_L3E_iAMPA_netcon = [-6.982940867681798e-03   +4.607421526486235e-01   -2.854158118386132e-01   +6.127848330900062e-01   +4.344701222843116e-01   +3.392506911179780e-01   -2.976255581065185e-01   -5.405075933470129e-01; +4.771217251563924e-01   +2.913879603490954e-01   +4.047974632040062e-01   -3.590216809329275e-01   -1.208461417932924e-01   +1.204998563109814e-01   +2.093872034250592e-01   +3.940425151611435e-02; +4.458764437339244e-01   -7.208137460862886e-01   -3.615755413632663e-01   +2.831609082654915e-01   +4.302787061276091e-02   +5.714327449751739e-01   -1.329318353039426e-01   +1.920613374264170e-01; +8.779349071306444e-02   +6.232491589758236e-01   +1.869477320545717e-01   -2.487338456901697e-02   +2.438276632826219e-01   +1.434712798595102e-01   -1.812034575378557e-02   +2.193077728193278e-01; +4.965953309151476e-01   +5.197641334477487e-02   -6.147363989703476e-01   -8.522580400470832e-02   +2.550642872571519e-01   -2.328490926225986e-01   -3.534079301369624e-01   -2.171769656335740e-01; -2.639065790833925e-01   -1.909073834301909e-01   -1.219144071305580e-01   +2.863636471116376e-01   -6.429374938696365e-02   +6.597610547209698e-01   +6.133575479999046e-02   +2.398165911034651e-01; +2.826529793348275e-01   -2.509522683174836e-01   +1.743560403175903e-01   +8.889945662281913e-02   +3.619974879783902e-02   +4.976006821261768e-01   +4.607626156462191e-03   -5.852784961432220e-02; +9.044409931198788e-02   +1.385926309467675e-01   +4.221623386284020e-01   -2.442625957873179e-01   +3.491175867191769e-01   -8.216233462771656e-02   -1.921200458993887e-01   +7.303934216607979e-01; +7.449949333398858e-01   +3.211313290123564e-01   -5.227850604697323e-01   -7.056766598636666e-01   -4.297266164640935e-01   -1.889002467611949e-01   +2.540958983258497e-02   -3.434053612028122e-02; -1.742162105510554e-02   +4.129655812061406e-01   -2.653896752299096e-02   -2.086663976624256e-01   +3.126400144485784e-01   -5.185141684390329e-01   -5.360049522221332e-01   +6.599225097933007e-01; +7.296378426646432e-01   +3.423290153922649e-02   -2.201772674512203e-01   -6.010173458744519e-01   +4.417650239268730e-01   -5.632167687657950e-01   +1.483922111802548e-01   -1.815287130308339e-01; +3.392552358793200e-01   +5.202393404102693e-01   +1.784369151004418e-01   +9.421558539081747e-02   -1.382473523277874e-01   +3.894004699816656e-02   +4.155673460519504e-02   -6.849930937920236e-01];
L2I_L3I_iGABA_netcon = [-2.143051052787591e-01   +6.649254459135957e-01   +1.808074654152175e-01   +4.609705242507321e-01   +7.605151702546747e-02   +3.155745278782685e-02   +1.858821926457874e-01   +4.248769016380198e-02; +4.013233940831731e-02   +6.220273651319302e-01   -2.677341545831084e-01   -3.623867715654017e-02   +1.308090261123771e-01   +1.591306813845272e-01   -2.476903410367250e-01   +4.572746423123086e-02; +7.638707120963732e-02   -1.286216529675576e-02   +5.148188621007680e-01   -1.402258934391729e-01   -2.201466122912675e-02   +2.284134834972082e-02   -5.574119149928469e-01   +4.595069938575091e-01; +2.081735483070905e-01   +1.184531183210355e-01   -7.026810183780704e-01   -1.407166393162859e-01   +1.650278888795950e-01   -9.092858175439220e-02   +1.595225982655866e-01   -1.347697740739335e-01; +1.389993533575249e-01   +2.102900370756808e-01   -4.777041142106577e-01   -2.436673611622023e-01   -2.024758139852701e-01   -2.057561425922423e-01   -1.236780701234814e-01   +3.016944121764870e-03; -3.584110057944768e-01   -1.299036102966275e-01   +1.425377134584760e-01   +1.276272552169584e-01   -5.578171283694154e-01   -3.436688018354115e-01   +2.293802567257278e-01   +2.049544088674176e-01; +5.731067719033860e-01   -1.392300490863008e-01   -4.454291986314577e-01   +1.426915405067818e-01   +7.926670219878030e-01   -2.429185906142005e-01   -9.248393955664920e-02   +2.236983791239184e-01; +3.504499811203276e-01   +6.074718829036804e-02   -1.150592239689895e-02   +3.587145252250935e-01   +3.615691228954521e-01   +1.417979654897904e-01   +2.790852791794421e-01   -2.049765423260599e-01; +1.162847261719279e-01   +2.522846271020774e-01   +3.614525422713726e-01   +6.560680484632264e-02   -1.718994351458096e-01   -5.273133650110760e-02   +4.473210225416469e-01   +1.832359090226942e-01; -1.002933022843492e-01   +1.260772823645813e-01   -4.834261972870377e-02   -1.877613947217615e-01   +1.004275772606916e-01   +3.535460862298522e-01   +4.877020405517634e-01   +2.623775399389104e-01; +3.925349167526910e-02   +3.163817271054378e-01   +4.277384834733734e-01   -3.878599325569384e-01   -1.121341937327342e-01   +2.363203567975938e-01   +1.843527458876241e-01   -2.397941355471669e-01; -2.714731313840120e-01   +9.421215833247000e-02   +9.815575125437857e-02   +2.151999880294282e-01   -1.287170057934164e-01   -3.986726394822642e-01   -5.051790456539572e-02   +2.892972792650878e-01];
L3I_L3E_iAMPA_netcon = [+9.437487754333890e-02   -1.231681153193785e-01   -6.779089787491918e-01   -1.885611461505210e-01   -1.049944656585813e-01   +1.149113851437993e-01   -4.463914186582982e-01   +4.172498165794249e-01   +4.050626218705453e-01   -2.041106053909929e-01   -6.621644458202630e-02   +3.651275962671185e-01; +5.912716326933469e-02   -4.224969751916267e-01   -4.280138816888442e-01   -2.401554861358511e-01   +7.453845343862328e-01   -2.021464857364549e-01   +1.837736304349804e-01   +1.837627630603338e-01   -3.537181055439550e-01   +3.792222946595011e-02   +2.059579407290719e-01   +1.823397065079306e-01; -1.626366185758363e-01   -9.978511622358027e-02   +7.391559402633446e-01   +1.140947630704653e-01   +2.570932493377952e-01   -2.211817991258316e-01   -2.905915194166196e-01   +7.062904556016082e-02   +1.560846313627412e-01   +3.285294573087523e-02   -1.564739674317263e-01   +4.653866844468355e-01; +1.151241715492598e-01   -6.126778140375289e-01   +4.721558213122435e-01   -3.012971094912552e-01   -3.219033849194707e-01   -6.027006651695375e-01   +3.018371272024130e-01   +6.054686712203412e-02   -3.274341386787838e-01   -1.417142372142751e-01   -1.557029888820360e-01   -6.101632405184169e-02; -2.834578794871420e-01   -8.131050534818111e-02   -2.006288447407950e-01   +1.820632725487831e-02   -2.010229087776245e-01   -1.809812888483131e-01   -1.351932974390775e-01   +2.311966085317149e-01   -6.143164736173560e-01   +8.447497953417954e-02   +1.440312764560868e-01   +7.512385482206144e-02; +3.530722303474151e-01   -3.881750843424258e-01   +1.567156911750775e-01   +1.898049642253779e-01   -1.901972519268319e-01   -3.735924206450743e-01   -1.877446054220678e-01   -3.855508226420502e-01   -5.718236964661437e-01   +4.418010354428356e-01   -5.116292934941213e-02   -1.481513745407981e-01; -1.957970371799369e-01   +2.197655929070130e-01   +2.998051630023519e-01   +2.995157901982290e-01   -1.366786516227051e-01   +1.107256872755206e-01   +7.031196388524721e-02   +2.555860168655765e-01   +3.535230412306355e-01   +1.408151932757386e-01   +3.263592187881671e-01   -3.201767324535610e-01; -5.117691306806079e-01   +1.976255389409086e-01   -1.995981417408099e-01   -3.180344883602193e-03   +5.302000087618173e-02   -5.446769173502024e-02   -5.375989949954015e-02   +1.769483205088442e-01   -1.618174525800580e-01   -2.928967650523217e-02   -1.330427381793271e-01   -7.992709864887949e-02; +5.973631701252363e-01   +1.535836741113565e-01   -2.038843331413001e-01   -2.982194371006387e-01   -1.211780583626176e-01   +1.363815209653608e-01   +1.677321401155070e-01   +3.130370241949363e-01   -5.245869830107556e-01   -4.172348810271029e-01   +7.837305384792337e-02   -9.518731246377973e-02; -5.589367444385205e-01   -2.196054042264273e-01   -1.516794564432199e-01   +1.216249750390182e-01   -4.692129253416497e-01   +7.570122277939959e-02   -4.084008899626318e-02   +2.167996788716512e-01   +5.415061151499380e-01   +1.104566489642613e-01   -3.388926248786998e-01   +2.979436411947318e-01; +1.309827103696977e-01   +3.999609203585149e-01   +2.811070453986997e-01   +1.548684484815511e-01   +2.617317380004184e-01   +4.409954871151198e-01   -4.847632993170544e-01   -8.045504427150256e-02   -8.532249169368683e-02   +1.377345921820635e-01   +2.137400952330893e-01   +3.171678920794015e-02; +1.431289053450333e-01   +2.965398467855079e-01   +6.164930059720363e-02   +4.452265028581103e-01   +8.576176924120010e-01   +6.236104026647404e-02   -5.735280552831032e-01   -6.085536196609648e-01   -1.735970113402374e-01   +3.058216149425504e-01   -7.058392741151661e-01   +2.793487127410729e-01];
L3E_L3I_iGABA_netcon = [-7.430713422176510e-01   +9.869268256813647e-02   +9.051297159405534e-02   -2.922962191908063e-02   +4.921973118028543e-01   -3.905537296128088e-01   -6.515512103658008e-01   -2.303782140302928e-01   +5.199680392579097e-01   +3.982377438758469e-01   +1.123614156129330e-01   -2.468580807624059e-01; +7.110554114190759e-02   -5.192154048572112e-02   +8.056143967058918e-02   +3.077473532589102e-01   -2.810672751631327e-01   +5.325629945614327e-01   -5.922515423369423e-01   +4.373219893710427e-01   -4.190164893228515e-01   +2.518704453715853e-01   -2.678159523133610e-01   +2.000375940918852e-01; -1.702002301634243e-01   -2.164100710852422e-01   +3.398235078662358e-01   -2.063449738629833e-02   -2.571509464576619e-01   +1.138783854398136e-01   -3.937326878620391e-01   +1.809500394612376e-01   -3.311417140644432e-01   -4.705872266799742e-01   -3.097720485744478e-01   +3.419140028148814e-01; -3.374278642479175e-01   +8.194754797238724e-02   +4.107061803414478e-01   -4.193760148129362e-01   +2.070082431773554e-01   -3.490584074736161e-01   -2.023596417065640e-01   +3.945593715315998e-02   -1.840058009135249e-01   +1.665032108740778e-01   -6.775392528805983e-02   +4.901009383171982e-02; +2.185600725485252e-01   +2.962934545691312e-01   -5.052004059543813e-01   +1.631934510763063e-01   +3.501852700366043e-02   +1.024762547099686e-01   -2.948118208305557e-01   -3.111451594849901e-01   +9.421930564507136e-02   -1.108074031672336e-01   +1.403558220843886e-01   -7.065250353108493e-01; +6.377189361719983e-02   +3.211755907966305e-01   -1.362531383468637e-01   +2.323369623453862e-01   +8.600262312836442e-02   -3.110030135318319e-01   -3.254488016175987e-02   +6.061860308927233e-02   +1.084337241026914e-01   +1.782452952611334e-01   -3.459419160304039e-01   -3.203099427318237e-01; +2.335228751622695e-01   +2.748891199382397e-01   -8.270026439428871e-02   -2.998344622633565e-01   -2.473205960497917e-01   +1.548784660631791e-01   +1.413024504121859e-01   +4.478216539620259e-01   -1.584180761120353e-01   -2.680164899333636e-02   -3.069713903085888e-01   -4.637031881688439e-01; -3.926678206376465e-01   -1.869660515235599e-01   +5.328494633647745e-01   -9.186041104140022e-03   -2.326625724379807e-01   +1.748721671025941e-01   -8.589629603990938e-02   -4.389410951065829e-01   +6.894822318426108e-02   +8.297459117835186e-01   -3.264781677330322e-01   +3.059725970364627e-01; +6.669768546400737e-01   -9.544705325504106e-02   +8.085601839454569e-02   +4.584794400278837e-02   +4.735001514419050e-01   -1.872770016394289e-01   -2.005284242804265e-01   +6.384764623932940e-02   +3.977900531600224e-01   +5.774232167981560e-01   -3.513202095978817e-01   -6.826341240246669e-04; -4.089947531709401e-02   +1.054306334372255e-01   +1.657273444753571e-01   -9.439685307347914e-03   -3.947485573011055e-01   +4.744322471245503e-01   +8.121739485737078e-02   +1.345362525058956e-01   -3.289937262428978e-01   +2.304349715197998e-01   -2.809683961230749e-01   -2.901980777125375e-01; -4.590586105173949e-02   -1.511437404543915e-02   +5.971741598410290e-01   +1.007230242223972e-01   -5.815204393212476e-01   +2.903308662235226e-01   +8.134962333988460e-02   +3.165026671689696e-01   +4.882940850275351e-01   -9.710526773137707e-02   -3.905742280271181e-01   +4.503989765128970e-01; -3.439886183223620e-02   -6.255718128586020e-02   -7.338926933302952e-01   +2.331461032908951e-01   +4.124892240293440e-01   -4.707596970325027e-01   -4.951410865496876e-02   +1.861075858350835e-01   +1.208707536896339e-01   +3.387952316039921e-01   +3.757214419823430e-01   +1.112639335974646e-01];
L2E_Input1_iAMPA_netcon = [-1.987018513725326e-01   -6.104959837314696e-01   +1.471408207690808e-01   +5.129235418161163e-01   -5.022201838800328e-01   +7.221018479718783e-01   +1.942729274596308e-01   -3.239267081836698e-01];
L2I_Input2_iAMPA_netcon = [+1.957213539964448e-01   +8.448061768409711e-01   +3.371338514053113e-01   +5.066072377895359e-01   +6.085676063362235e-01   +2.829124145974651e-01   -3.049774769189485e-01   +2.883323534732180e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.4*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 1.0*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 1.0*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.4*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 1.0*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 1.0*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
