function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-2.627171313067417e-01   -2.984086011134478e-01   +1.041149379532470e-01   -1.003876615091440e-01   +3.181514580783536e-03   -8.643410634410914e-02   -1.916466025210380e-01   -1.922563997575014e-01   -4.477949459178319e-01   +1.096775163290468e-01   -2.252010491035863e-01   +1.416444452266192e-01   +2.068313833841512e-01   -1.679919805936771e-01   +1.008250077659548e-01   -5.119446890852675e-01; +1.530006859701709e-01   -5.636357938104762e-02   +2.204999365530347e-01   -1.068557766262541e-01   +5.087261333459175e-02   -9.504215304922890e-02   +2.501453226261992e-01   +9.727996646313294e-02   +1.575934907485980e-01   -1.680147610936534e-01   -1.718871372715054e-02   -2.839226056299483e-01   +4.551368573659491e-02   -1.276151673935645e-01   +3.760016017062733e-01   +4.787524127186456e-01; +6.019420721219722e-02   -7.792570439212887e-03   -7.363334712420501e-02   +2.052396376364799e-01   -8.216637393863428e-02   +1.643939665185580e-01   +9.773642906922371e-02   +2.221617634740167e-01   +1.337585884936596e-02   -2.559867453978998e-01   -1.951331796713874e-01   -1.656070307135632e-01   -3.428455283690826e-01   +1.123945174057330e-01   +1.229383914836270e-01   -5.054164389146978e-03; -3.737726878052421e-01   +2.126700551165640e-01   +3.478244513585702e-01   -1.914226825927846e-01   -2.709918134169012e-02   -2.298617532659183e-03   +3.683954866250837e-01   +2.652517621186368e-01   +7.711780321780227e-02   +2.026524949943895e-01   -1.454305983992920e-01   -5.247106434517465e-02   +1.640499359185524e-02   +5.049215444013040e-01   +2.682266149143313e-01   +1.098789360238177e-01; -1.172990566477767e-01   -1.820129425647077e-01   +5.223127197854481e-02   +3.935747414605631e-01   +7.294823904849783e-02   +2.328776105832851e-01   -1.859438820530010e-03   +9.603217316949655e-02   +2.519959527084158e-02   -9.906871395124146e-02   -1.424148736100403e-01   +2.565447281011005e-01   -2.686415588604435e-02   +2.406806593611353e-01   +7.745520734026008e-02   +9.659715696466037e-03; -7.551977750383287e-02   +1.568526348248571e-01   -4.412127742398057e-01   -1.291229826069701e-01   -9.520112991872420e-02   +1.381416483660324e-01   -2.581232516854308e-01   +1.286852268542036e-01   +3.348592319694615e-01   +5.588908521779684e-02   -2.082037785864173e-02   -3.101200253832009e-03   -2.584553218029296e-01   +2.210252677733764e-01   +2.553293164507049e-01   +2.395471044798190e-01; -2.320114029845121e-01   +5.398299721094475e-02   +6.117026368281781e-02   -1.408761273642034e-02   +3.441121900826104e-02   -6.262133457381813e-02   -5.078061490514043e-02   +4.211709481873049e-03   -2.736252376316606e-01   -1.219389938732084e-01   -2.994739152560042e-02   +2.244038162801103e-02   +2.928180579247500e-01   +3.272930015892637e-02   -3.524700183327532e-02   -2.807038788702585e-01; -2.276885570724524e-01   -6.612012286860924e-02   -3.673424137321565e-02   +2.078475289769723e-01   -1.580542648135758e-01   +2.465404795179132e-02   +2.647148299522793e-01   -2.892981730974740e-02   +8.666477758600864e-02   -2.168671830202779e-01   -2.556784693097628e-01   +5.727688212884590e-01   +2.046006589853194e-01   -2.994368427948677e-02   -2.815296064684655e-01   +4.268895454951614e-01; -1.628774018210559e-01   +1.926445351915152e-01   -4.575854364796031e-03   +1.669260917689988e-01   +1.844921925038059e-01   -7.501272565042777e-02   -2.455313419231206e-01   +2.475721693186079e-01   -2.915337268916008e-03   -2.904255296463669e-01   -1.897102453445056e-01   -4.510999821911290e-01   +1.499817999458364e-01   +9.857514741964768e-02   -1.373208196354104e-02   -2.581229516670377e-01; -2.629747134579972e-01   -2.419966136413436e-01   +1.122267669676932e-01   +1.319835602695533e-02   -2.152569655848471e-01   -1.602067225840128e-01   -1.816572605731202e-01   -4.125885096226466e-01   +8.162138319751990e-02   -2.952192665314420e-01   +3.080558811310607e-01   -3.990565713015262e-01   +4.827631082776381e-01   +3.688627795159681e-01   -3.969488018192773e-01   -8.816490705666405e-02; -9.481917203025123e-02   +1.365627560448570e-01   -2.034043564715369e-01   -1.495953941383759e-01   +9.415481060114408e-02   +1.388814107257724e-02   +1.584071016934635e-01   +2.678615978624953e-01   -2.567977963697343e-01   +1.341501346088996e-01   +3.552423178756745e-01   -1.048631106390488e-02   +2.176296488095240e-01   -2.233382781387557e-01   +2.961761148043845e-01   +3.415010168007252e-02; +3.034159586499148e-01   +5.355181279100076e-02   -6.470989337822991e-02   -1.898261084861159e-01   -4.270523456465213e-01   -1.934721281463050e-01   -3.479039931028163e-01   -3.030881600703034e-02   +6.538785461522989e-02   -1.271356690513222e-01   -1.406052903138129e-01   -8.739090523555401e-02   -1.911815828337410e-02   -8.137225192163589e-03   +5.392008215860818e-02   +1.554032095359708e-01; +7.309739627348504e-02   -1.078123057561310e-01   +5.851726024711826e-01   -4.128870443812268e-01   -1.274021707669189e-01   +1.048832453547327e-01   -8.235140720924065e-03   -3.172283238401757e-01   -6.550732061883020e-02   -2.586013823377446e-01   -4.100528254911180e-01   +2.192430282634288e-01   +8.187160013460260e-03   +3.052068068160753e-03   +1.358828497864391e-01   +1.224231456530808e-01; +6.228943603815562e-02   -8.624950423418043e-02   -2.945767332722277e-01   -2.829448094083848e-01   +4.565561300858197e-02   -1.156999976742875e-01   +1.051067651335226e-01   +1.148899546775602e-01   +9.000644210743344e-02   -1.942834494619233e-01   +2.664267183474338e-01   +2.110684715718315e-01   -2.191516890617543e-02   -9.294535631725709e-02   -5.919439996918341e-02   -5.657300136509041e-02; +3.360871146174212e-01   -8.926513014672213e-02   -1.058438956818443e-01   -2.820950256440963e-01   +1.562324643717048e-01   -1.093382631645070e-01   +9.715976737706356e-03   -2.888865905232411e-02   -6.459620522398832e-02   +1.569548457778261e-01   +2.482509911967392e-02   -2.141086203608604e-01   -1.716007539043256e-01   +6.772553516421505e-02   -1.997944038179527e-01   +3.440467517217842e-01; +3.047261723800747e-02   +3.322774444492931e-01   +2.525571782723849e-01   -4.827605502797545e-01   +4.715175169347705e-02   +2.584907142593043e-01   +1.269168066784349e-01   -1.853181706940707e-01   -1.810470000557598e-01   +1.954586848761999e-01   -1.348284862363594e-01   -2.419863676460305e-01   -6.254190702136757e-02   -2.374315260620219e-01   -1.800635884697152e-02   +2.514204583776175e-01];
L1E_L1I_iGABA_netcon = [-1.368781059352793e-01   +1.637834436749071e-01   +3.917437917701388e-02   -3.538684307109869e-01   +2.460920156279220e-01   -7.423848598036228e-02   -4.759066652809926e-02   -3.740161214207805e-02   +3.398496390354813e-02   -6.641634174976767e-02   -5.602411708301254e-02   +3.106661055337697e-02   -3.363695172281360e-02   +8.409080665545604e-03   -2.724170858554355e-01   +3.430100443755828e-02; +2.612957602715603e-01   +1.869134577225253e-01   -1.250367445102858e-01   -2.859602679116673e-01   -3.717552986761342e-01   +2.131329456825131e-01   +1.855548007214685e-01   +2.911648390349500e-01   -2.009063266169675e-01   -1.122198398936498e-01   +1.884565782534460e-01   -3.226335795222381e-01   -3.257038076754676e-02   -7.079332138934830e-03   -2.877461867524616e-01   -2.757209663815703e-01; -1.990458207240154e-01   -1.237749343021447e-01   -1.426765535411199e-01   -1.804250662650960e-01   +3.771613255829822e-01   -2.893295940761388e-01   -2.267566853857037e-01   +2.133422397582983e-01   +2.335931183787528e-01   +1.572419402339136e-01   +1.789118289815954e-01   +2.305731728876369e-02   -2.921783895718342e-02   -2.321119468888104e-01   -6.793336739209117e-02   +2.033431352075971e-01; +1.824634406523697e-01   +2.823081306534623e-01   -1.809111280596049e-03   +2.159494829162903e-01   -2.366177816528878e-02   -3.907327397966673e-02   +4.348761121089209e-01   -2.391158872167645e-01   +1.444849547865606e-02   -3.214855801475557e-02   +7.386815650954942e-02   -2.012618713106010e-01   -1.820436198992924e-02   -3.738013481127407e-02   +1.124487328360729e-01   +2.494779440780601e-01; +2.759591241453279e-01   -4.926609958499688e-02   -2.503003952731137e-01   +2.005809613571924e-01   -2.501444871974872e-01   -1.649255669559473e-01   -1.604328700854574e-02   +8.014265296441986e-02   +2.422851738461401e-02   -3.666596334450277e-01   -2.894505987881591e-01   -1.571702164316164e-01   -4.265827150064749e-01   -1.756637231160096e-01   -8.046628593823454e-02   -1.829085664546772e-01; -1.509253354267214e-01   +4.002534775078262e-01   -4.332723758877051e-01   -2.040933435743524e-01   -4.479416223923778e-01   -1.258891338447451e-01   -5.979469399993911e-02   -1.005802140728384e-01   -3.790029777411619e-01   -1.090505635708953e-01   -1.205063659649525e-01   +3.048724640477831e-01   +1.955405281087719e-01   -6.613444066614410e-02   -3.983004754924424e-02   -1.105250639766361e-01; -8.273287602064527e-03   +2.843836895203731e-01   +8.857799202795322e-03   +4.760342211472673e-01   -2.028373841298612e-01   +7.762195331053617e-02   -2.482421903338284e-02   +1.619401771843768e-01   -2.017369276110423e-01   +3.100345055114656e-01   -3.033598071655304e-01   -9.111415304987523e-02   +2.590948615264473e-01   -1.656495617561673e-01   +1.076467638771574e-01   +3.313719143492785e-02; +8.879896979595861e-02   -4.323985594645346e-01   +2.065721580641789e-01   +4.756392940328297e-01   +1.164136531904659e-01   +3.926685155153690e-02   +4.913386628223793e-02   +2.211825188067599e-01   -1.079880724103155e-01   +2.656773142969001e-01   -1.335652743179042e-01   -1.724789961972019e-01   -1.419986753093917e-01   +7.405658555699901e-02   -2.170355932480010e-01   +1.829506425452971e-01; +4.470607804451607e-02   -2.976071973035244e-02   -3.405782534492576e-01   -5.292320733257939e-02   +1.107030644061047e-01   -3.651602386726711e-01   +1.264436432460819e-01   +2.319134162286633e-02   +3.586816272263513e-02   +1.852515660654426e-03   +5.259621414707577e-02   -1.681323810792740e-01   +3.055317627685762e-01   -2.176555670549903e-01   -1.667775996333306e-01   -1.594229995239657e-01; +1.264419213567956e-01   +6.404552026224697e-02   -9.492474649019203e-02   +3.104086633793052e-01   +1.646032726540745e-01   -1.782559196205453e-01   -2.533677447589014e-01   -1.859524388150337e-01   +3.036459344179557e-01   -3.346908730237401e-02   -2.908370482651496e-03   +2.364159909446469e-01   +6.233753891159513e-01   -1.109084981686910e-01   -4.517758773895459e-01   -1.296675159325594e-01; -2.572458458410193e-01   -5.886591332422922e-02   -1.468280564153523e-01   +1.778975920455273e-01   -1.878841648111861e-01   +1.886524889950187e-01   -2.627908537828374e-01   -5.027373710678066e-01   +2.853006135949132e-04   -4.168245352336544e-01   -4.017471041618807e-02   -1.589810318749727e-01   -4.602735061785825e-02   +3.266176387864170e-01   +1.832703499483802e-01   -8.118379714841414e-02; -8.054285747587142e-02   -5.306097107491074e-02   -1.516261506952394e-01   +8.179103381274239e-02   +3.619054874653455e-02   +1.730933512346655e-01   +2.591404616431369e-01   +9.240119213298879e-02   +2.282111599640677e-01   +1.424229757084297e-01   +1.423926709125325e-01   -1.932700409752627e-02   +9.984528553442840e-03   -3.102384755917851e-01   -3.103050169481024e-01   +1.657209430113408e-01; -6.234298209662312e-02   +1.430206974006109e-01   +1.607780070251569e-01   -9.320528190017839e-02   +2.723745636877045e-01   -3.286904784875939e-01   -4.741029452229104e-01   -1.979265476394876e-01   -2.622943590246120e-01   -3.098685492778910e-01   -2.917100381577498e-01   -1.568973765320450e-01   +6.658510096414796e-02   -4.022179415341898e-01   +3.069484876171252e-02   +2.101495998505758e-01; -3.138114060220287e-01   +2.743053945608424e-01   -2.227899391555041e-01   -1.158500107983873e-01   +1.320247312409827e-01   -8.730360388892626e-03   -1.092732898042965e-01   -5.985526348892801e-02   -1.005057206920311e-01   -2.118490968679032e-01   -1.383644677903420e-01   -3.519375608723928e-01   +5.296121059028520e-01   +1.738127128236662e-01   -3.067065465979534e-02   +2.928893937919168e-01; -5.264588596136122e-02   +1.234379226071251e-01   +3.391195793044668e-01   +3.762851467619036e-01   +1.730539255596823e-01   +2.409148464523186e-01   -1.548360622435430e-01   +2.191603477303030e-01   +3.529245338097394e-02   -6.988128219411775e-02   -6.330257457883759e-02   +4.089683365782491e-02   +7.776079068646355e-02   -1.153586633194022e-01   +4.893397963846488e-02   -2.853533673147633e-01; +9.539849954289098e-02   -3.188515933663022e-01   -2.979601928759401e-01   +4.248708488728588e-01   -2.809659241506584e-01   -1.388203210137375e-01   +8.416528895735895e-02   +2.996908626461646e-01   +3.546126117839282e-02   +1.016536025191342e-01   -1.514324495375884e-01   +1.591923427885124e-01   +3.858316967550607e-02   -3.205090453386743e-02   -1.358339567151388e-03   +2.492572733031401e-03];
L2I_L1I_iGABA_netcon = [-2.653645418562399e-02   -4.056627001153936e-01   +2.012418925013390e-01   +1.399881728356408e-01   -1.507219702212009e-01   +2.937233189773004e-01   +9.558116870570871e-03   -4.501359138162792e-01; +7.957362396231873e-02   +2.241946935366209e-01   -5.876448209442803e-03   -2.165205232453147e-01   -3.270481842343118e-01   +2.945389197590887e-01   -7.058000011168827e-02   +1.486046161738085e-01; +2.460265125316508e-01   -1.983657583708294e-01   +1.671068796895855e-01   +6.091154233034361e-03   +8.460796476218782e-02   +2.225459696437505e-01   +1.966090347356311e-01   +2.889978608848985e-01; +4.380139945270903e-02   +5.068088738605705e-01   -1.305528827317352e-01   -1.869603301891053e-02   +1.175834725098111e-01   +2.509103051918558e-02   +1.066470576501711e-01   -2.894735790874034e-01; -9.978044554713701e-02   -5.905633141088818e-02   +1.927981959169102e-01   +3.677168514209175e-02   +1.734868674504159e-01   +2.509125853553331e-01   +6.391608818143028e-02   +5.295535990496514e-02; +2.534066723592930e-01   -1.853120671436190e-02   -2.529556623728382e-02   +9.023920111720787e-02   +3.580835804566279e-02   -1.962477914642046e-01   +6.142014830616539e-02   -3.372512644763805e-02; +2.722782503131491e-01   -1.942131538244303e-01   -4.189059725488647e-02   -1.040977499988050e-01   -1.130025432462162e-02   -4.835258394777566e-01   -3.567764406568939e-01   -1.233989279193010e-01; -2.721638585164498e-01   +2.024941781301536e-01   -1.463525717643163e-01   -7.117734444306371e-02   -1.655358317159502e-01   -3.788232723603068e-01   +1.489944835939522e-02   +1.680203235036957e-01; -1.729686418794280e-02   +1.028615259778476e-01   +2.241754059849720e-01   -1.178533859270543e-01   +4.780838233056606e-02   -1.854832175393582e-01   +3.538170314351269e-01   +3.922965428227818e-01; -1.689939673098340e-01   -2.273070114034014e-01   +1.290821968211934e-01   -1.395341587412299e-01   +8.365217791295865e-02   +6.764021916525424e-02   +2.735882009234708e-01   +4.845165144597330e-02; -1.397590978278901e-01   +2.020060418337898e-01   -2.629911899097542e-01   +2.923259159383605e-02   -1.413018060922681e-01   -1.108600537054727e-01   +1.244310515445721e-01   +1.901711223798975e-01; +3.249754455849792e-01   +3.207189857293232e-01   +2.024980072588660e-01   -9.291357834023445e-02   +1.546012996826030e-01   -3.075643947910899e-02   +4.506205701822552e-01   +2.360404269857885e-01; -2.533732270780656e-01   -1.955006336688736e-01   +2.158825955025920e-01   -3.023431684870313e-01   -1.227537649692756e-01   +1.626345104378312e-01   +8.027120007117304e-02   +6.491534611378438e-02; -5.624508485300828e-02   -4.110614988354093e-01   -6.198880116463197e-02   +3.104556627042261e-01   +5.939457194794392e-02   -2.174720790186195e-01   -2.580630916917408e-01   +2.990718206268466e-01; -3.414513445535273e-01   +1.365215125030004e-01   +3.156433299099463e-01   -9.549473344360493e-02   +3.067636365250209e-01   +1.725087158849049e-01   +4.542562131364633e-01   +4.029373245002910e-02; +4.154103228351385e-01   -1.025958007895463e-01   +2.282954044511994e-01   +7.807531918938965e-02   +2.670319455019402e-01   -2.297431910826912e-01   +4.325415438563001e-01   +1.089343048819664e-01];
L1I_L2I_iGABA_netcon = [+7.303265940956918e-02   -8.266197478965365e-02   -2.395693052200963e-01   +2.808663078727536e-02   +5.872780641521681e-02   +3.033196880632895e-01   -8.346266443787098e-02   +3.337136042422756e-01   -2.905950543212160e-01   -1.005427868341187e-01   +1.282195130304037e-01   +5.772404000639452e-02   +1.802711410840331e-01   +2.245660041534737e-01   -1.340758793560600e-01   -1.550136348480904e-01; -2.585372287522556e-01   +1.857561830430279e-01   +2.117006272775533e-01   -1.440764193021161e-01   +1.048761927784436e-01   -4.029021681036397e-01   -7.836581013015741e-02   -6.128754905373397e-01   -1.800613407409967e-01   -5.410458060198944e-01   +5.314655500602922e-02   +2.081372334466869e-01   +8.210548392732810e-03   -9.142157348900398e-02   -8.226767209287351e-02   +1.615360383859898e-01; -3.650197104150912e-01   +1.202110419314927e-01   -2.652026411850198e-01   +3.297392284482192e-02   +9.151977640753237e-02   +1.708078537231560e-01   +4.317555093104952e-02   -5.479515248246233e-02   -2.562028060261056e-01   -4.152117894844967e-02   -2.094162450235399e-01   -1.397886945803904e-02   -1.338156202196286e-02   -2.643036075478254e-01   +2.128823808223144e-01   -2.869727021760225e-01; +4.492970330170182e-01   -6.779065191036462e-02   +2.241618451822094e-01   -1.915191704131263e-01   -1.901119324332427e-02   -3.934254165999647e-01   -2.064450872370571e-01   +1.564839415892611e-02   -7.118411831956724e-03   -3.468870809240357e-02   +3.164274113193997e-01   +2.219853290345990e-01   +3.446340476516749e-02   -2.062903382134914e-01   +2.108539786167399e-01   +1.822932600769001e-01; +2.574526230380888e-01   -1.420588996155445e-01   +4.783356087014201e-01   +8.680916932537866e-02   +1.881164920252547e-01   -2.693966094617179e-02   +2.772922212042118e-01   +4.017173149712892e-01   +1.530680860308699e-01   +2.173448489525762e-01   -9.999297631584085e-02   +1.742145303022421e-01   +3.459369469186290e-01   +1.747172491584005e-01   +1.507671725528355e-02   +1.880685681697854e-01; +2.081856538911625e-01   -1.799456849033093e-01   -1.218360500293929e-02   -2.108523653196619e-02   +9.056233108589259e-02   +2.501051188716379e-01   +2.688564199770731e-01   -6.610029211711868e-02   -1.056942821170208e-01   +2.915021576039526e-01   -4.090319423404715e-01   +6.433147460329369e-02   +2.433849002015363e-01   -4.464435597328131e-01   -1.508374421021881e-01   +7.725758119669841e-02; +7.839285534099488e-02   -1.310868176491648e-01   +2.311253625788406e-01   -2.853956837287656e-01   -1.296389870014090e-01   -2.475612740681605e-02   -2.733972755691442e-01   -9.522507755043895e-02   -1.329113887813900e-02   +1.054039085246489e-01   +1.270981168851104e-01   -1.651976267559433e-01   -1.666459067340623e-01   +2.261606257034967e-02   +3.111234738785376e-02   +1.943331937512066e-01; -3.555052767687930e-01   +1.031329226384378e-01   +4.509502782943324e-01   -1.610564130161456e-01   -8.090969010596280e-02   -4.288501310232432e-02   -1.028147120050049e-01   +2.356333891103825e-01   +1.740477221425373e-01   -1.853944096279440e-01   -2.457099585547116e-01   -1.388509031340241e-01   -2.024495769075265e-01   -3.787293750958735e-01   -3.075049555880244e-02   -3.133486951552039e-01];
L2E_L1E_iAMPA_netcon = [+2.752980706784012e-01   -1.137431210035941e-01   +6.730527924738433e-02   +4.377272773883217e-02   +1.205297518390460e-01   +3.153904494615853e-01   -1.124723355910853e-01   -1.831034997936911e-01; +3.992337767384921e-02   -1.130602818895422e-01   -5.491507530768264e-03   +3.523217686455624e-01   -6.664374838086851e-02   +3.860991512272322e-02   -1.112585159574882e-01   +1.692463429883828e-01; +2.660661864099257e-01   +4.715533075778231e-02   -7.522526376978333e-02   +1.977908445422735e-01   -5.391857338624823e-04   -3.049596290553447e-01   +1.317433038529059e-01   +4.072595862224479e-02; -1.409373175893812e-01   -2.556764039997899e-01   -1.727293098784397e-01   +5.379149515643902e-02   +4.125269876979365e-02   +1.062349886031968e-01   +1.778627729810662e-01   -5.026767793876563e-02; -7.633170246116877e-02   +7.910494526281167e-02   -3.577723077149647e-02   -2.044961525099480e-01   +7.585677408148153e-02   +4.881883955818310e-01   +1.741626522780558e-01   -7.551757827003673e-02; +5.492969899133430e-02   +6.311379388593370e-02   -1.241465608732615e-01   +8.898928174465107e-02   -1.091387179654885e-02   +3.607019922463403e-01   -3.542044729839499e-01   +2.117182384910528e-01; -2.340533892464586e-01   +1.054257627136437e-01   -6.019342556606933e-02   +2.928651110724623e-01   +1.221196639697718e-01   -5.697396196143498e-03   -2.852695459256110e-01   +2.065768156617362e-02; -1.639391521248582e-01   +1.431886698830959e-04   +4.279659684029821e-03   -2.018898884799399e-02   +4.851641125460038e-01   -1.562376199485769e-01   +2.552545336926298e-01   -6.019648881215924e-01; +2.424250555942700e-01   -2.458460943234266e-01   -1.993961897581105e-01   -6.754264850955813e-02   +2.732519457023478e-01   +2.220846115705954e-01   -2.938518955463661e-01   +4.093987842336902e-03; +4.218910843561295e-01   +1.729734345972126e-02   +1.349451770363763e-01   +6.001253171263618e-02   -4.390742076500143e-01   +5.730251923441287e-03   -2.959067447786435e-01   +2.466773117874146e-01; +2.757572643357202e-01   +1.291389511677450e-02   -4.669771559758976e-02   +1.790036482304543e-01   -4.263640015071151e-01   +2.408099152699449e-01   +1.871851728909608e-01   +6.202158914369990e-02; -2.959819353514046e-01   +1.502084125671327e-01   -2.130957715363269e-01   +3.281757304740119e-01   -3.757079922987024e-02   -5.080601393696855e-01   +2.799955398478269e-01   +1.074888247620762e-01; -9.122207884045573e-02   -2.134063651824827e-01   +2.110843344150487e-01   +5.247578062953091e-02   +2.498533814848350e-01   -1.055188149289292e-01   -3.503899506318342e-01   -5.366526240704229e-01; -1.277979718841043e-01   -1.330514816904843e-01   -3.959949199865120e-01   -2.281311968826022e-01   -1.664398014845937e-01   +1.600041208940701e-01   +2.282744199662947e-01   -1.910844313991329e-01; -2.446119344753595e-01   +1.256519811039657e-01   +1.328489761156968e-01   +1.398202717319629e-01   +1.128787883288026e-01   -1.862691586627070e-01   +2.711448032144351e-01   +9.044045027969597e-02; -2.547086904813584e-01   -1.044099667514214e-01   +4.961680463335047e-02   +3.423243889151550e-02   -4.023436239591516e-01   +2.527094884276798e-01   -8.844267881789861e-02   -1.170843754126971e-01];
L1E_L2E_iAMPA_netcon = [+9.478686763236562e-02   -2.922793934339482e-02   +1.327152411748605e-01   -1.706820366802168e-01   +1.998542957641312e-01   -1.467457010936331e-02   -2.000568868532077e-01   -1.003248905012569e-01   +5.606027868164692e-02   -2.361797829907275e-01   -5.267262347878438e-02   -2.120579136277030e-02   +9.728556442231480e-02   -1.655578720866552e-01   +2.466192388595169e-01   +1.722551612158192e-01; -1.005467398175576e-01   -1.455448506549973e-01   +2.294719306313889e-01   +6.255559622517043e-02   -1.672292180202216e-01   -1.262103943038883e-01   +8.750050137625881e-02   -2.818536835234829e-01   -3.577487516272616e-01   +3.707052842521114e-02   -1.868220757691942e-01   -3.599299445213439e-02   +2.148372752327023e-01   -2.352924858087368e-01   +2.840611602406528e-01   -1.968746302403414e-01; +1.247974967850395e-01   +2.069430482987018e-01   +3.868021389099445e-02   +1.383672414305763e-01   -2.681151129890084e-01   -1.297492340675918e-01   -1.231030014184120e-01   -1.901041299005249e-01   +8.132848498632397e-02   +1.087185435023476e-01   +2.655001398562731e-01   -1.846900288699946e-01   +3.762272729145179e-02   +2.213121487689339e-01   +1.640328805914190e-01   -3.184563364869459e-02; -1.187544096984346e-01   -2.956640700532035e-01   -8.685501147712715e-03   +1.356299286648561e-01   +3.802446258397235e-02   -3.371346584495724e-01   -2.308301719215274e-01   -2.519806509739977e-01   -7.266020762323697e-02   +2.147776696759536e-01   +1.007072406022197e-01   -2.996681680447517e-01   +2.260430595458847e-02   +8.414359810904792e-02   +4.247421203971576e-02   +2.622555596938165e-01; -1.934649425017563e-02   -9.778415445607071e-02   +9.445036571633528e-02   +3.395135111563907e-02   +4.827078279992337e-01   +4.037736228323799e-01   -1.359099466195057e-01   -2.998543872871427e-01   +6.112455728273609e-01   -3.571136833770662e-01   +6.992965206119961e-02   +2.874778745651188e-01   +2.730496755124594e-02   +6.571345618467192e-02   -1.143015827212196e-01   +1.298318870637731e-01; +1.694864931164506e-01   -1.197332163780939e-01   -2.915641352751612e-01   -2.403006018692826e-01   +2.337821843783942e-01   +8.457601835970725e-02   +1.587844544900701e-01   -4.188058222767951e-03   +9.720067172022298e-02   +6.667806179224992e-02   +3.207012164812477e-01   +1.352177837217511e-01   +1.204564995663777e-01   -3.677157931627999e-02   +3.934358747070725e-01   +3.054161847480180e-01; +3.493010211339746e-01   -2.640956757949144e-01   -5.311621675296355e-02   +1.683213253740877e-01   +1.107527599880068e-02   -2.673499288836785e-01   -3.045155271814837e-01   -9.539698748055345e-02   -1.953824554792361e-01   -3.296070529363376e-02   +3.111790609063404e-01   +1.633797317202362e-02   +1.966281848320134e-01   +4.162220219614567e-02   +1.822051950797481e-01   -1.086547689261965e-01; +6.830660047066871e-02   +8.682974105553673e-02   -1.213987823748624e-01   +1.001470539155567e-01   +2.746538221835437e-01   -1.484001620641051e-01   -2.378843408008553e-02   +5.205417196372102e-02   +4.845878376100402e-01   +5.070002488766798e-01   +2.813586684014917e-01   -3.604586115403926e-01   -3.005114457749716e-02   +1.069992225369524e-01   -9.945489824824005e-02   -8.860758228815484e-02];
L2I_L2E_iAMPA_netcon = [+4.660477982117847e-01   +1.445004027765118e-01   -1.754353591370209e-01   +1.814876085438379e-01   +1.341853871850917e-01   +4.633476558871280e-01   +3.975271247486525e-02   -7.289180220563712e-03; -2.623034142492756e-01   +2.810720980092566e-01   +1.153497142365920e-01   +3.221847773765469e-01   +2.534929724161181e-01   -1.777844493513420e-01   -4.991955504225000e-02   +2.937883574752809e-01; -3.022256324509366e-01   -1.388960423842873e-01   -5.498749182619116e-02   +1.526131873965200e-01   +5.340131264001186e-02   +1.397390936268249e-01   -1.799295265800560e-01   +2.622118903940892e-01; +2.370481900396488e-01   -4.871356387620455e-01   -1.008590216870444e-02   -8.426517537323201e-03   -1.563282496684488e-01   -1.762313480216728e-01   -1.553157791091417e-01   -3.081415251091121e-01; -2.015206779021828e-01   +1.910366854813808e-01   -3.781928540588739e-01   +3.635997746681455e-01   +1.544808196912690e-01   +2.767985724435865e-01   -4.021079769898862e-01   +3.554863706940160e-01; +5.953722781645934e-02   +8.947589281744098e-02   -9.859340674191913e-02   +3.320321876484612e-02   +8.744254191638499e-02   +1.740005896028955e-01   +3.236905751521899e-02   +4.384680079793983e-01; +1.551136711261147e-01   +2.619719535187758e-02   -1.496671738221687e-01   +3.914069816800650e-01   -3.027992282904715e-01   -6.041079941012163e-02   -2.165945406926950e-01   -1.985470659066671e-02; +3.311506387751717e-01   +3.060913781145257e-01   -1.869084198189829e-01   -2.116599187409685e-01   +3.364176789798326e-01   -1.912882550123918e-01   +1.060776663075315e-01   -2.239597950233531e-01];
L2E_L2I_iGABA_netcon = [+1.959272607661351e-01   -8.787946062141305e-02   -3.045710269309491e-02   -1.024948475712009e-01   -6.505967628310728e-02   -6.906770586414185e-02   -1.278246464053316e-01   -5.120004109591095e-01; +5.379509936781290e-02   -2.167864908967057e-01   +1.005210697703781e-01   +3.192964016909426e-01   +2.270172032236065e-01   +1.862276748447446e-01   -8.307490200613732e-02   +7.818601258421776e-02; -9.625345402843019e-02   -2.330886140913804e-01   -1.114561783348206e-01   -3.677716788476025e-01   +1.420599861175920e-01   -1.490385654829892e-01   -1.062721652442168e-02   +3.761066709230693e-01; +4.297621433052376e-01   -2.364951724542504e-01   +2.122646217281156e-01   -1.121990656366333e-01   +1.608344686710564e-01   -8.500684402407449e-02   -3.650410482082426e-02   -2.385672886167186e-01; -5.060348800011235e-02   +1.377069851150886e-01   -2.085286842076207e-01   +4.338762492572819e-02   +6.212348260032578e-02   -1.483001317302053e-01   -3.725180790535704e-02   +2.817456278682323e-03; +4.161179739642477e-01   +3.751627082734882e-02   -1.083998328776790e-01   -3.468219811149238e-01   -4.246122017197680e-02   -7.174247971520778e-02   -2.838938462036621e-02   -3.224446305931213e-02; -4.723909544877100e-01   -2.762295042732450e-01   +4.096328504559954e-01   -2.130079157938889e-01   +2.136166275975638e-01   +3.109758389382976e-01   -1.053441727915085e-02   -3.564795146616379e-01; -1.098486213548831e-01   -2.972964778676972e-01   -3.795304595908904e-01   +1.217181739737565e-01   +2.042786528464645e-01   +1.807782611966746e-01   +2.599249368101217e-01   +2.921255405745883e-01];
L3E_L2E_iAMPA_netcon = [+2.338908108629859e-01   -2.966123355151414e-02   +3.944515632686519e-02   -1.363857744454255e-04   +7.316507148223630e-02   +9.668672440440168e-02   -3.116876633128289e-01   -8.221345911409450e-02   -4.421756549990959e-01   -1.636099066000674e-01   -1.806442862345803e-02   -3.504962247840489e-01; +2.431840777295564e-01   +3.654298739233286e-03   -4.059568679999043e-03   +1.151662704745843e-01   -2.103630272446291e-01   +2.336317549344491e-01   +5.471578447842982e-01   +1.437080779710016e-01   -2.456722675882319e-01   -4.821335010759982e-01   +1.166185894022944e-01   -1.689395449107893e-02; +2.534981001751235e-01   -1.600562940279159e-01   +4.188968461056493e-01   -2.051978482040667e-01   -2.879503253287068e-01   -1.172939783614167e-02   +1.467598930385958e-01   +1.538764604249494e-01   +1.425655096871342e-01   -7.854715332737360e-02   -1.995296175812463e-01   -5.135256036303293e-02; +7.063056415342846e-02   -1.809833289018563e-01   -2.017218459134940e-01   -7.332873945292315e-02   +1.376274400608643e-01   +3.111163945113630e-01   -2.242598250098546e-01   -5.620456492487608e-02   -7.120013575154127e-02   +7.910962254333016e-02   +1.080975868726712e-01   +2.626608500792067e-01; +1.712821784815389e-02   -1.264175739941841e-01   -5.357643632848079e-01   -9.760850768896726e-02   +1.157141105475266e-02   +1.259484755313559e-01   +3.188793130838211e-02   -3.938947614527796e-01   -1.627576819437138e-01   -7.076503780198182e-02   -3.274229084590785e-02   -2.977582274856387e-01; -2.982636865798622e-01   +4.478373098194893e-02   +1.844494411979971e-01   +2.419586949026164e-01   -3.871235862601967e-01   -8.149588684463004e-02   +1.263914718048860e-01   +4.838371661335772e-01   -1.023369571502729e-01   -2.522523768234277e-01   +2.241314895582882e-01   -1.860187879411733e-01; -3.383498126882727e-01   -1.367421066896199e-01   -5.548430652457791e-02   -1.370726477564495e-01   +1.122902644447494e-01   -1.701562976810631e-02   -1.433742095611394e-01   -3.680773666081655e-01   -8.569227695655017e-02   +1.071543748034264e-01   -2.785733245642442e-01   -2.237252318695174e-01; -4.251999288651587e-01   -9.895053594772685e-02   +2.141207152126186e-01   -2.025564802364997e-02   +2.891271016565943e-01   +3.486797099648983e-03   +1.740640084766168e-01   -6.466537318094506e-02   -1.220099403264081e-01   +1.120776085123208e-01   -2.654154651614979e-01   +1.355618125580045e-01];
L3I_L2I_iGABA_netcon = [-7.978902022454695e-02   -4.076739583805116e-01   -2.722616901550636e-01   +9.268512731233013e-02   -4.098709172234427e-02   -4.253131083111993e-02   -5.090963038457111e-01   -1.769551715766636e-01   +2.628079901735256e-01   -3.695347864317372e-01   -1.737316812696066e-01   +2.907515178266287e-02; -2.697180147845831e-01   +2.177073572918040e-01   -3.512437071606953e-01   -1.230950864015316e-01   +3.575779229610769e-01   -9.703809729892154e-02   +2.189247662396433e-01   +3.107830437380056e-01   -3.895858603649339e-01   +1.814482051605801e-01   +2.240090167137575e-01   +3.279973690666923e-02; -2.361452809956957e-01   -1.347536777777694e-01   -1.897345997641899e-01   -1.490212044994245e-02   -2.022303137822903e-01   +4.346995056358091e-02   -4.892128919754992e-02   -3.781101315905535e-01   -1.877634612194630e-01   -5.656378938881246e-02   +3.515169734202030e-01   +3.556881755257787e-01; +8.765282177747476e-03   -2.374423006729424e-01   +2.689753184066884e-01   +3.747047767380339e-01   -3.183663051057110e-01   +1.039932862577089e-01   +2.404222850061474e-01   +3.625339225367749e-02   -3.242517673730839e-01   +9.353146805456750e-04   +8.375089756953635e-02   +1.082681859404890e-02; -1.787639787801547e-01   -9.485213795067129e-02   -2.006954313924680e-01   -1.387368272046493e-01   -9.326622630092610e-03   -2.598078172579513e-02   +2.470420652684633e-01   -6.885605920540680e-02   -5.048928414225812e-02   +7.642951929613553e-02   +4.090334886712835e-02   -2.756625424792652e-01; +6.412600760078851e-04   +4.661983791275685e-02   +1.085990437229833e-01   -2.802949059660070e-02   -1.469854956360712e-01   -3.662311121033852e-01   +4.962579885797535e-01   +3.430313509322462e-01   -2.509124635330634e-01   +1.778370795827575e-01   -1.010367068843630e-01   -5.208098542636787e-02; -4.385999950218969e-01   -8.447494485172121e-03   +5.512127206560248e-02   +2.980010070366833e-01   +6.833361529320574e-02   +2.108180885212168e-01   -1.651065802269828e-01   -2.992225699477308e-01   -2.946408365220232e-02   +9.553656098831555e-02   -7.654924116960465e-02   -4.799838713253765e-01; +9.239548742086341e-02   -2.620598180590977e-01   -1.370549704825410e-01   -3.786402987162121e-02   -1.829787124537748e-01   -2.766985066989417e-01   -2.471673896782600e-01   +1.096535289361702e-01   -9.819982324435012e-02   +2.642918622736912e-03   +3.530758097076276e-01   -1.832317465324546e-01];
L2E_L3E_iAMPA_netcon = [+1.126437165329132e-01   +1.805959955027674e-01   -8.542223354106691e-02   -4.720319847077536e-02   -1.376689403366801e-01   +1.250941811212767e-01   +2.302623525515071e-01   +2.474214708506958e-01; -1.880220662378373e-01   +1.167123197563332e-01   +2.118646349820950e-01   -7.786789682554324e-02   -1.912119688950525e-01   -2.492369289682004e-01   -2.460461695155631e-01   -6.387402022870081e-03; -8.957658051710364e-02   -5.299006431695199e-01   -2.116248206093939e-01   +9.743888290081602e-02   +3.495093663843054e-01   +1.547655837806592e-01   +7.600531602285027e-02   -1.723368584511543e-01; +2.710105772729038e-01   -1.493316284372793e-01   -2.671193180354948e-01   +1.909584519705159e-01   -1.052347641360052e-01   +4.460387826577360e-01   +2.031584033755423e-01   -1.736756108674165e-01; +1.315720031439613e-01   -3.401556345375083e-02   +2.508777404361544e-02   +3.691497139507419e-01   +2.223770662489878e-01   -2.544469442052169e-02   -5.083894313454945e-02   +1.315755757883732e-01; +3.101151417995895e-02   +1.843327225607146e-01   -1.618135081447737e-01   -1.736596276468024e-01   +4.103890807115176e-02   -3.813167322349436e-01   +6.165052696536108e-02   +2.202051758670135e-01; +2.251987859265523e-01   -3.198743397682695e-01   +2.050204755517898e-01   -2.726367497950933e-01   -1.751047654097949e-01   +5.661339137758038e-02   +1.962532912656627e-01   +2.964090070792070e-01; -9.440637982366096e-02   -9.268279569710521e-02   -3.756751900397921e-02   +1.172389493973005e-01   +2.353852279884286e-01   +7.679881615325382e-02   +1.714600614258289e-01   +7.263890070569572e-02; +1.226590429682351e-01   +2.975704261040516e-01   -2.665127325687355e-02   +2.517800741916041e-01   +1.282860617162368e-01   +3.251486058362438e-01   +1.072671029927540e-01   +2.611940529927196e-01; -1.638529957317289e-01   +4.992890780478785e-02   -1.427689508754868e-02   +7.071984723255140e-03   +6.725393848355911e-02   +1.658790513612288e-01   -1.092171591319247e-01   -2.517549593309056e-01; +2.335737485927490e-01   +2.441507859962293e-01   -1.225161260220317e-01   +3.997559807111420e-01   +1.428264820970528e-01   +1.837462499505375e-01   -9.967668621427839e-04   -1.049472718368398e-01; +8.113790692545368e-02   +1.730174334084815e-01   -2.800451352920162e-02   +3.366532402220024e-01   -3.801140962244923e-01   -2.191182304611685e-01   -1.398737726612328e-02   +2.712203771644348e-01];
L2I_L3I_iGABA_netcon = [+4.480018697456984e-02   -2.024416044460517e-01   -1.054810922455002e-01   +4.280265612374976e-01   -4.078694323520563e-02   +1.931827240326777e-01   +1.982225829091989e-01   -8.222797681376981e-02; +3.374499689635285e-02   -2.019821912766844e-01   +2.983079592493073e-01   +1.285719806934153e-01   -2.584927481735058e-01   +1.362991505306414e-02   -1.623834792923809e-01   -2.056175863027784e-01; +8.860360977562014e-02   +1.541993680702036e-01   -2.168046277329090e-01   -2.334890295228334e-01   +9.895151270737840e-02   -1.826767305022627e-01   +1.663618595983352e-01   +8.242878044657523e-03; -2.536903664892007e-01   +9.953833934023859e-02   +6.054998005648515e-03   -2.060007664165602e-01   +3.914291249246947e-01   +2.140785510246115e-01   -4.777703476926576e-02   -1.858043875135357e-01; +7.670252482974080e-02   +1.006352939598084e-01   -1.743179073775852e-01   +2.375848161854601e-01   +1.680842120418963e-01   +2.400833136651080e-01   +3.514360466375371e-01   +1.370137404576049e-01; +2.043491456931704e-01   -1.247250148964595e-01   -9.827465205399002e-02   -6.196855000428862e-02   -2.436513338769011e-01   +2.140855867224010e-01   -2.787757417311657e-01   +2.352187811960860e-01; +1.685881532501344e-01   +2.363176092661643e-01   +1.039661550397444e-02   -1.979490370549803e-01   +2.119254743066862e-01   -2.174128382088940e-02   -2.382653218198189e-01   -2.082659008866728e-01; -7.623680212234889e-02   -5.350405441003129e-02   -1.730301332932719e-01   -8.150942409437603e-04   +1.976274236945947e-01   -5.341059139904066e-02   +2.608310332341699e-01   +1.692662308301085e-02; -9.829324618280946e-02   +4.986582740677488e-01   -2.864599099847867e-01   -3.115751973701923e-01   +2.922071869916097e-02   +1.358287644200987e-01   -1.280243093445055e-01   -8.914106150007950e-02; +4.835943370454960e-01   -8.149812476429850e-02   -4.825708294394949e-01   -2.592057211794328e-02   +1.938898929682614e-02   -2.421470996258644e-01   -2.486067710808310e-01   +2.830967051040901e-01; -7.907432433320352e-02   +2.408054912618521e-02   +1.422270415290327e-01   -4.222599611623640e-02   -2.525853387880183e-02   +2.683174686259964e-01   +2.347902200791813e-03   -1.704869680139746e-01; +4.661063008318599e-01   +3.377368572650519e-01   -1.438235453881172e-01   -2.279618005018576e-01   -2.724740296507819e-01   -1.012404549934275e-02   +3.255847840888003e-01   +3.428142372054041e-01];
L3I_L3E_iAMPA_netcon = [-4.773778523911671e-02   +1.858325163889392e-01   -2.626999026739658e-01   +2.217216853064649e-01   +2.875451053884856e-02   -5.520974858639223e-02   +2.295727284801403e-01   +2.390192041329596e-01   -4.323333070034634e-01   +2.739874816310177e-01   -1.635372961721459e-01   -1.310293805559584e-01; -1.274014317401272e-01   -2.569950293162113e-01   -2.444150803540361e-01   -9.442403098490060e-02   -7.402773871503884e-02   +1.722675496777870e-01   -1.073765488146394e-01   +1.190474070142169e-01   -1.272600293115390e-01   -3.452795370548474e-02   +1.959874508278217e-01   -4.557504623855019e-01; -1.880475808991983e-01   -1.428535631687511e-01   -4.414173487021767e-02   +4.912540509756641e-03   +7.693500208414442e-02   -3.190708628092359e-02   -1.717020149069119e-01   -3.828315573874235e-01   +2.281868126459920e-02   -1.742860927862175e-01   -1.131295116970601e-01   +1.018836201633576e-02; +4.458316491100432e-02   +3.692890180630929e-01   -3.750717253205909e-01   +2.357422844781645e-01   -2.575661147685004e-01   -1.395318203589134e-01   -1.508159616136794e-01   -1.558293586917352e-01   +8.891018247575259e-02   +7.888670172510909e-03   +4.776593376317552e-01   +1.497672045327164e-01; -7.092543612479080e-02   -2.634096178853351e-01   -5.855164479530678e-02   +2.706369780516781e-01   -9.953250714390613e-02   -3.646164109013339e-02   -3.878452293555276e-01   +1.289766252434011e-01   +4.732623679308210e-02   +2.588954046449669e-01   +2.673525148701457e-01   +1.555054589226841e-01; -1.713690882610926e-01   +2.913091637443409e-01   -5.184883125771891e-02   +4.213183724313031e-02   -1.015038036661442e-01   +4.281140544311310e-02   +4.427795654976070e-02   +2.960600000705302e-02   +1.987608803624681e-01   +8.919207244306804e-02   +1.553403157541718e-01   -4.049261217765450e-01; -1.905504500765873e-02   -4.218287004218503e-01   +2.689852396500122e-01   +3.297000594992232e-01   +2.283505498701810e-02   +1.803154008778368e-01   +2.164317547370378e-01   -3.950218632329302e-01   +3.715590675254320e-02   -3.072122525465518e-01   +1.949542720107520e-01   +2.559674934905836e-01; -2.432359699262767e-01   +8.435453894074399e-02   +2.413832736343876e-02   +1.356931373188166e-01   +1.311154042163874e-01   +1.501112677751790e-01   +1.848028987662619e-01   -2.352213648142555e-01   -7.524247066051681e-02   +9.954554207938937e-02   +6.322957444143372e-02   -2.698286690431994e-01; +1.876296090669939e-01   -1.492873361358725e-01   -8.778235259558462e-02   +5.285340659048230e-02   -2.598679679700048e-01   +2.475089054079620e-01   -5.108875069756913e-02   +3.228937887360065e-02   -1.245235754335401e-01   -2.452670374153845e-01   -4.695461014914663e-01   +9.453966591860843e-02; +4.306561791279470e-02   -1.072210125534387e-01   -2.842140510534427e-01   +3.721327404204259e-01   -9.486404064238080e-02   -1.522654183847956e-01   +4.094399260683174e-02   +1.666941344540779e-01   +3.507258424791941e-01   -2.297893163832689e-01   +2.517968283999684e-01   -1.697531490738076e-01; -1.943927481367810e-01   -3.530120940018477e-01   +4.209182907882393e-02   -3.048385641618936e-01   +2.699257205783892e-02   +2.487981787514555e-01   +2.965132646286647e-01   -4.348454353582498e-03   +2.420094691318417e-02   -1.499685073116118e-01   -8.991118333658686e-02   +4.691351023783504e-01; -6.209987921729287e-02   +1.179190445813295e-01   +1.919299038599858e-01   -5.640941169856557e-02   -6.156438038765631e-02   +1.171889276104478e-01   -9.389435480213962e-02   +2.564163463569252e-01   +5.294071245819316e-02   +1.115764745909410e-01   -4.019201208188650e-02   +2.349154462447351e-01];
L3E_L3I_iGABA_netcon = [+1.661296463278020e-03   -1.042594069593886e-01   +3.003282588667997e-02   -4.320716036876032e-02   +3.404057347287534e-02   -3.553514088538904e-01   +3.782045422767564e-01   +2.117757397903908e-01   -1.645952818746457e-02   +7.785853186467091e-03   -3.420724700533978e-01   -1.536478214032399e-01; +8.452551419436710e-02   +7.802715796101523e-02   -1.467002990475481e-01   -2.511691393454774e-01   +1.491990592514663e-01   -2.748426202405802e-02   +7.422216207499942e-02   -4.514853505181683e-01   +2.811853659014331e-01   -1.475761675577786e-01   +2.443573558904324e-01   -9.172395811971214e-02; +2.409445162866663e-01   -1.254069978583755e-02   +2.475426948547619e-01   -2.448312183698750e-01   +2.469364452497508e-01   +2.403034947952455e-01   -5.653557958610177e-02   -1.475713068452253e-01   -8.126624405898257e-02   +2.559239240116118e-02   +1.425158176996683e-01   +1.443737342499548e-01; +1.895390200470790e-01   -2.114536757355946e-01   -2.941710886952004e-02   +9.224757843220208e-02   -9.239558903024681e-02   +1.489308479931490e-01   -2.542417608285664e-01   -4.819624021292996e-01   +6.300602568393111e-02   -8.144997215208881e-02   +7.039664046840681e-02   +1.557561553095417e-01; -1.288184283838067e-02   -1.039143543107672e-01   +3.290789044047391e-01   -1.679742679815114e-01   +1.808994839715261e-01   +3.287137297002752e-01   +2.174141010764594e-01   +1.139790697183142e-01   -1.193122188194159e-01   +2.094941213884599e-01   +7.680923693773145e-02   -1.963020132491601e-01; -1.424054769903322e-01   +4.564489884281292e-03   -4.683188330991451e-01   +3.937777277428187e-02   -7.503118954345406e-02   +4.068463935419887e-01   -1.658766637542682e-01   -1.225216432190421e-01   +1.301792983038207e-01   -4.123946384786945e-02   -1.652532166462571e-01   -2.155682920832796e-01; +2.558076933493564e-01   -5.889870572438503e-02   -3.065962158940379e-01   -2.098636476076800e-01   +2.978733971952190e-02   -2.682706306642917e-03   -4.096678012615049e-02   +1.212288191827496e-01   +4.611265889587542e-02   +1.803903474366832e-01   -1.711304246440405e-01   +1.642579000415959e-01; +4.525441382787565e-02   +6.194647792280854e-02   -5.205250220242352e-02   -2.339720274335970e-01   +7.739618150713219e-02   -1.984256646659320e-01   -2.282452202987631e-01   +4.185713679793075e-01   -3.399045016687451e-01   +2.140705315801459e-01   +2.136606078269653e-01   +2.448684341072498e-01; +1.014891653829798e-01   +3.006026009101714e-01   +3.871190676880052e-02   +4.768765726519324e-02   -2.687436723209916e-01   +1.078060631705564e-01   +1.480044261435570e-01   +2.950667576313113e-01   +3.203281271373880e-02   +1.942941634520586e-01   -2.261698837425164e-02   -2.199343381104716e-01; +3.706669590603753e-01   -1.698412636801198e-01   -1.287190207962973e-01   -1.628551769483399e-01   +3.765667289638497e-01   -8.181312176823476e-03   +3.455289473163734e-01   -1.623590945434978e-01   +1.523032006971118e-01   +3.133166680545251e-01   +1.052773502660438e-01   -2.921961258383807e-02; +3.424987888010932e-01   -3.789777701620715e-02   -1.403719513547008e-01   +4.480134395963107e-01   -2.524060607503750e-01   -2.878611123498228e-01   +1.816847074664353e-01   +2.595926449309267e-01   -7.635638189328109e-02   +2.492596571216200e-01   -4.212378912922301e-01   +6.947962415463485e-02; -2.289981238298187e-01   -3.006405891106875e-01   +2.216047576236248e-01   -2.032542839082125e-01   -3.339245441524481e-02   +3.951255382568372e-02   -1.665362367403071e-01   -1.419336787271264e-02   -1.984938314065803e-01   -1.751899728237876e-01   +3.868926744961200e-01   -1.868141074519233e-01];
L2E_Input1_iAMPA_netcon = [-4.491771085836437e-01   -4.604338150794626e-02   +7.359786255268705e-02   +7.710300216192589e-02   +4.240904286477507e-01   +4.741415434128329e-02   -1.986961928630973e-01   +2.899693850473825e-01];
L2I_Input2_iAMPA_netcon = [-8.663949162276882e-02   -2.031171945222269e-01   -8.389263700359405e-02   +5.062759250051934e-01   +1.628846797233554e-01   +1.023336131492018e-01   +2.249228528541870e-01   -1.923351557111666e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.03*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.15*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.15*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.03*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.15*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.15*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
