function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+1.689096535913890e-01   +1.770598527552527e-01   -2.653470343051421e-02   +6.598926355301617e-02   -5.107638411243817e-02   +1.307316690925550e-02   +1.343871231534796e-02   -1.596758895285930e-01   -2.640303368838740e-02   +6.981930657504834e-02   +6.139616886891282e-02   +6.722446771336271e-02   -1.576091719962872e-01   +4.186271547542737e-02   -7.089514110975220e-03   +3.843275241491098e-02; -1.468934203186648e-02   -3.042626755436157e-01   +5.470330111240036e-02   +2.345936034035109e-01   -1.893064714718989e-01   +1.224022385316148e-02   +1.478456216625306e-02   -5.463554636233597e-02   -3.731808906147129e-01   +2.181367780812867e-01   -2.247939508786487e-01   -1.180155000086022e-01   +3.285177733220323e-01   -1.913114819619194e-01   +3.201710222334257e-01   -1.092902362057878e-01; +1.359126382222240e-01   +1.097261506694461e-02   -5.039118780440499e-03   +5.724441636537091e-02   -2.366806584076898e-01   +8.345681919016748e-02   -8.367620651469547e-02   +3.195252867898811e-01   -1.375681789603186e-01   +1.590806342685359e-01   +7.190909585830402e-02   -1.347146991888895e-01   -1.157321162033375e-01   +1.845796927017191e-01   +2.433443558660994e-01   +4.880002940809468e-02; -1.123889610682403e-01   -2.995590487198668e-02   -1.776976221114814e-01   +6.208309131414337e-02   -9.876733589350659e-02   +5.512502120318823e-02   +4.937673062111474e-02   +1.389058917077494e-02   +2.644165407982776e-01   -7.872571050601421e-02   +2.550745213535344e-02   +9.557999261394465e-02   -2.732484476409896e-02   +1.005363716775374e-01   -2.119233388300718e-01   +2.093895988218123e-01; -1.579888216324224e-01   +6.232779442157217e-02   +2.326051431224599e-01   -9.348319561481962e-02   +5.348927747086932e-02   +1.109441506817730e-01   -4.716417170936596e-02   +1.812937536696140e-01   -1.182287224086675e-01   -1.631736094462844e-01   +2.110661210059293e-01   -1.382705767459661e-01   +4.262576663099186e-01   -9.357730672589505e-02   +1.269810616738707e-01   +3.455360118956318e-01; -3.765722713756059e-02   -1.952428921855310e-01   +2.138113340089331e-01   +6.798065033098433e-03   -2.186929444690625e-01   -3.588637372986567e-01   +1.355487141353809e-01   +8.979139311631593e-03   +3.157923318510905e-03   -9.890693829292874e-02   +2.840180569377231e-01   -7.406199269735503e-02   -6.395353712673649e-02   -3.479159839643501e-01   +8.163499548751565e-02   +1.448541473656293e-01; -2.024071784261019e-01   -9.797005884889520e-02   -1.193180819890957e-01   +2.357846432910644e-01   -3.421695426736616e-01   -7.855324612884865e-02   -1.370830938763061e-01   +1.364971583695930e-02   +1.392196176036869e-01   -7.709756684847196e-03   -1.888445407206978e-01   +2.540037224831774e-01   -2.680180017790360e-02   +3.155941403703680e-01   +1.204480532701094e-02   +8.510699639043817e-02; -8.760343927900144e-02   +2.281949969875236e-01   +6.129906316215648e-02   -2.378634723001037e-01   -4.703168617545801e-02   -1.248222660248818e-01   -1.652772551267504e-01   -1.860950427388838e-01   +2.279416571529005e-01   -1.524025503120169e-01   -1.822338462649460e-01   -3.591402013357523e-02   +1.056593643773414e-01   -4.247318120386001e-02   -9.675441597917689e-02   -2.996809367230042e-02; -1.819196985027283e-01   +1.120929074691020e-01   -2.781513767036681e-01   -1.332961577849092e-01   +1.672117673865714e-01   -2.617458335110497e-01   +1.688861315644653e-02   -1.427017630362151e-01   -2.219222818642550e-01   +1.234358850941713e-01   -9.614096064463518e-02   +1.081371984752377e-01   +3.437718050760888e-03   -1.148612856208381e-01   -3.590024531555860e-02   +2.553089291017005e-01; -6.171018934668085e-02   -1.521512199730849e-01   -2.154080926615897e-01   -4.436065783770819e-02   +7.867677152732859e-02   -1.122053930678749e-01   -1.815744744365213e-01   -1.146113987996220e-01   +1.320653803129224e-01   +5.273188861053886e-02   -9.141982316269429e-02   +3.748765826031841e-04   -2.163325709432163e-01   -1.504344045242639e-01   -1.565230161166007e-01   -1.779738877516557e-01; -1.832355691750146e-01   +6.638222414114181e-02   -2.962594933857084e-01   -2.327595468630581e-01   -4.690893540924794e-02   +1.381753464266814e-01   -4.861396344195608e-02   +2.444276514425429e-02   -3.072751246657203e-01   -7.580263214950911e-02   -1.871540545266158e-01   +2.579671939204412e-01   +1.361873582850316e-01   -1.883762161352873e-02   +3.939309410628106e-02   +3.671218007276163e-02; -1.991382730306911e-01   -7.520346502174098e-02   +2.855051392080504e-03   -1.614591899967574e-01   +7.541573332881950e-02   +1.957456994510494e-01   +1.919528018558701e-01   -1.948305809088233e-02   +7.267829135575340e-02   +2.954752482479821e-01   +1.142378804105898e-01   -1.964012877693646e-01   +1.837795013942277e-01   +8.347454381636614e-02   -1.320682531002385e-01   -3.593925711040930e-02; +3.423030850175615e-01   +9.428749577963728e-02   -1.427075309628436e-01   +2.160529001888090e-01   -1.718290833969257e-01   +2.151228650177448e-01   +1.908416698622378e-01   -3.374339913010310e-02   -4.036155800677349e-01   -2.205661738946129e-01   +4.173051425048624e-01   -1.736634671948424e-01   -2.029868769239832e-01   -2.209295072410719e-02   +7.827839209232570e-02   +1.245605454345646e-01; -2.259793404762450e-02   +1.910065159026006e-01   +1.095988219373459e-01   +1.056235949967074e-01   -9.762981709535508e-02   +3.172154581693672e-01   -3.547144578502273e-01   -2.074510894846110e-01   +2.567966857856182e-01   -1.451410462290479e-01   -1.818563550190175e-01   -1.867665164747159e-01   -1.000381377078300e-01   -1.221579643168249e-01   +6.650631837479744e-02   -3.602215295913548e-01; +4.591657866179245e-03   +9.978081426262765e-02   +1.126526208653712e-01   -4.566735074292402e-02   -4.598421859111473e-02   -1.137636017917002e-01   -1.648521769933300e-01   -2.393067508931666e-02   +2.345712989161608e-01   -3.915798964444315e-01   +8.642007754213640e-02   +9.274287735104084e-02   -1.363034160169888e-01   +1.787431925276480e-01   -1.058527032546260e-02   +8.606022272512476e-03; -2.875460218283873e-03   +3.202795427036566e-01   +5.077622786600818e-02   -4.538587188485537e-02   +6.055001590025813e-02   +1.142032818496121e-01   +4.736290757094658e-02   +1.406569161306492e-01   -3.285568633263962e-01   -6.754979465438851e-02   -2.717147820080505e-01   -2.611080913239685e-02   +2.544290862258588e-01   -1.745282886174681e-01   +1.584243761062626e-01   -1.828847323671951e-01];
L1E_L1I_iGABA_netcon = [-3.381795958873020e-02   +4.970666123701298e-02   +1.163484264118329e-01   -1.279880444953363e-01   -1.382577189728323e-01   -1.324478133080893e-01   +4.510652981864990e-01   -1.471455309297425e-01   -1.435983912759280e-01   -1.781215403093330e-01   -2.573696924246071e-01   +3.486239068005542e-01   +7.844893260382194e-02   +1.481000838004140e-01   +2.397553464163804e-01   +2.128496445631466e-01; -4.099506201232028e-02   +2.992805440667434e-01   -3.924620061280738e-02   -2.783225684783182e-01   +2.028285108373926e-01   -2.411177062186858e-02   -3.640160196865677e-01   -2.340689675245532e-02   -1.669318675571157e-01   +7.751336386188024e-03   +1.018841577325968e-03   -1.185980550028722e-01   -1.880248277925535e-01   +2.298236376107249e-01   +1.493266482685728e-01   -1.907349430949103e-01; +1.151317077514771e-02   +2.469682970860936e-01   -1.825971351290864e-02   +6.350845641904208e-02   +1.649611365185704e-01   -1.012393317537874e-01   +1.801450373633298e-01   -1.910244242610643e-01   -1.165793296265697e-01   -1.399291616573370e-01   +1.019756644190196e-01   +1.942167896563771e-01   -2.550356498226159e-01   +1.260326359568256e-01   +1.714567531530622e-01   +4.211806907467906e-01; +2.906596226265376e-01   -1.131218680464247e-01   -2.379384949307293e-02   -1.410427795881900e-01   -1.632225005085705e-01   +7.093670934189265e-02   -2.783296250319959e-01   -2.002403034698493e-01   -2.919763533842433e-01   +6.176174552805244e-02   -1.926197794320981e-01   -1.920668962106809e-01   -1.594036865908464e-01   -1.621607451660546e-01   +1.458891878537854e-01   -2.154627686542694e-01; +8.800235997771583e-02   +4.142589063674727e-02   -2.879436374333301e-01   -1.588175784381102e-02   +2.640730395038923e-02   -1.522599980419852e-01   -1.459429918142457e-02   +6.807298909010476e-02   -8.442151731349658e-02   -3.755579506085972e-02   +2.769043379209007e-02   -3.310054695412076e-01   -2.537052446445723e-01   -6.656151241379306e-02   +1.506035453248707e-01   +1.687157005210603e-01; -3.091294282412073e-02   -1.345076310721583e-01   +3.889185701395166e-02   +3.967293254780098e-01   -1.201506820009683e-02   -2.349651821666129e-01   +1.576012585109821e-01   +2.060339535942105e-01   -8.053641310354298e-02   +8.474795593241083e-02   -6.956346860930114e-02   -5.726674886662340e-02   +2.231324567959242e-01   -1.430592096672665e-01   -2.678039406381314e-01   +2.213155905397261e-01; -1.546253360344432e-01   -1.065750110410184e-01   +1.431692806737227e-01   -3.408836713536693e-01   -2.844872970010410e-02   +4.104005870127078e-01   -2.041024800303869e-01   -1.949753725061473e-02   -1.698737670154915e-01   -1.925692401318660e-01   +1.943255008146517e-02   +3.885316544295089e-02   +8.152610723800102e-02   +1.233712281727782e-01   -6.367929448278037e-02   -5.909298825078683e-03; +3.301740413958461e-02   -3.084502951794130e-01   +9.494845916625916e-03   +3.770335267458833e-01   -1.893073837800660e-02   +4.457657723162530e-01   -1.467827320747150e-01   +1.529578235512400e-01   +1.618842529349933e-02   +3.348521778865754e-01   +1.550619746280621e-01   +9.789492255459509e-02   -1.076491711288620e-01   +1.756058742658649e-01   -4.275512844411224e-01   +3.089727353772835e-01; -1.970104667327980e-01   +2.676698813574671e-01   +2.150200344587546e-01   +2.213604181064442e-01   -1.481093503919348e-01   +8.989555791123148e-02   -1.481333022287541e-01   -1.844719313107484e-01   +3.021101981354595e-01   -1.748862075976058e-02   -5.372241372119327e-02   -1.109674258888725e-02   +1.477839006602298e-01   +7.056564514114555e-02   -6.180891671533989e-02   +1.146067321560724e-01; -4.634672381469811e-02   +8.053231972580094e-03   -3.346206309168563e-01   -1.160463058907187e-01   -1.062531313253480e-01   +9.354508836359918e-02   -1.753369890587916e-01   -7.144572407186442e-02   -2.400119242922341e-01   -1.346728966742198e-01   -5.225641439326240e-01   -5.679942701143366e-03   -1.978579202882620e-01   -1.597021009984567e-01   -5.558440378224561e-03   +2.301102186728675e-01; +1.645675826031787e-01   +2.889101677691092e-01   -1.650031768542746e-01   +4.438632250968164e-02   +1.785657099292347e-01   -3.534327566984738e-01   -1.706774883710893e-01   +7.304849707826075e-02   +3.318784628423271e-03   +6.274870028166049e-02   +9.515650647572349e-02   -3.642577410498074e-03   +4.364618614353261e-02   -1.797213472858245e-01   +2.028871176759470e-01   -1.873913819522922e-01; +2.208573294498350e-01   -1.958954815594058e-01   +1.036074328064498e-01   -1.544282171723435e-03   +6.508777372746251e-02   -1.108307054779519e-01   +2.908999414567517e-01   +2.300374919134209e-01   +1.167060685462897e-01   -2.039982997984408e-02   +4.196436682670183e-02   +1.980919656865843e-01   +1.467355687775559e-01   +9.250048817746603e-03   +4.518861147959104e-02   -3.334646516518941e-02; +7.991064909893651e-02   -2.800752370261332e-02   +2.143020761216820e-01   +2.076560075696868e-01   -3.491018604917351e-02   +2.061362644347723e-01   +4.674244040624137e-02   +3.179947034253968e-01   +3.745392746218426e-01   -1.431960643788367e-01   -5.429015536068722e-02   -1.254122723958648e-01   -5.723447479860184e-02   -7.194067368363168e-02   +2.140527614004900e-01   +1.514458514330766e-01; +2.746366215404775e-01   -1.251234577091615e-01   -4.846901431385431e-02   -9.990635297873533e-02   -1.724954962727991e-01   +4.507984552191853e-01   -9.909089406513780e-02   +1.627569577461974e-01   -3.054840869245196e-01   +1.589706045905302e-01   -6.415393038461761e-02   +1.662603728728735e-01   -2.021446460721297e-01   -4.025639010573367e-02   -4.236027935926929e-01   +4.993560596271650e-01; -3.572129302918662e-01   +3.375460773846233e-01   +9.686968255503228e-02   -1.884854109555238e-01   -2.156396913357676e-01   -5.374299232738330e-02   -1.936511227952460e-02   -3.646589877368614e-02   +4.538707974893667e-01   +1.286813731700307e-01   -4.648660235669835e-01   -2.970908151028365e-01   +2.266065524905056e-02   +2.141970226852320e-02   +2.539895259185292e-01   +1.907835517519428e-01; +7.165485446746654e-02   +2.958332589031124e-01   +3.430306881503962e-01   +6.744798180648851e-02   +4.358063756185875e-02   -2.142532555445632e-02   +2.207112769019139e-01   +3.256166108009768e-02   -9.314309343155826e-02   +3.568376932439073e-02   -3.153516745432473e-02   -3.494673986567304e-02   +1.455926801585475e-01   -2.892947372471398e-01   -5.963379879848761e-02   +2.325183038797445e-01];
L2I_L1I_iGABA_netcon = [-5.755290499313687e-02   +7.629928278336046e-02   -7.854791711772326e-02   +3.170994071656129e-02   -7.691332088629627e-03   +1.579944230796013e-01   -3.884935014003644e-01   -6.437953816002848e-02; -1.198424942119962e-01   -2.251366409400576e-02   -2.295714003248759e-01   +1.398024834615563e-01   -1.100380335120499e-01   +1.854731692811508e-01   +1.987685010072178e-01   +5.963443219902210e-02; -3.094662415384390e-01   +2.194100664542312e-01   +9.062258282479575e-02   -1.254782850443666e-01   +6.019835037468964e-02   +1.703423341206079e-01   +6.642120703461055e-03   -3.868086394247044e-02; -3.070991254364412e-01   +3.429520334412092e-02   -5.355247313549640e-02   +2.179411337439402e-01   +4.067011797770395e-01   -8.768075659388158e-02   +1.028114240567211e-01   +9.780274759234260e-02; -9.564771578445709e-02   +2.165207112473685e-01   +5.202941283976004e-02   +2.186947023397445e-01   +1.669872555086938e-01   -1.121788374659650e-02   +3.685047522619485e-01   -1.153030466315644e-01; +1.877008555327137e-01   +1.429991622878701e-01   -3.140056454427777e-01   -5.057866880939842e-02   +8.930192150589585e-02   -3.949284156829437e-02   -8.726932307016952e-02   +5.229025087561831e-02; +8.840134112908876e-03   -1.498952413823989e-01   -2.811843947020667e-01   +3.376181797642087e-02   -2.404438199531673e-02   -4.033413119125015e-01   +2.104035849314196e-01   -2.278133915602806e-01; -2.044254690980089e-02   +1.868712146771597e-01   +4.805501233083900e-02   -1.122276559907461e-02   +1.454951842210642e-01   +2.016354872159374e-01   +3.094697916377603e-01   -1.428118130627765e-01; -2.189615900847535e-01   -1.545302695519695e-01   +1.535075112702177e-01   -5.525643795393190e-02   +2.854614373806029e-01   +1.421675984552875e-02   -1.443282368046453e-01   +8.661266889422162e-03; -5.427101133261106e-02   -5.523343614809058e-03   -4.965135677411536e-02   -5.418511219357854e-02   -2.292864225993762e-01   +2.512097263725160e-01   -3.903535300772645e-01   -3.186679919257683e-01; +1.197630133498310e-01   -7.750921858277650e-02   +7.067734303010931e-02   -5.649881758256955e-02   +7.571049974750511e-02   -8.243364088900094e-02   -2.651678242296556e-01   +2.168445239335940e-02; -6.693454977384096e-02   -1.417635634513301e-02   +3.532389220336266e-01   +3.315885677889003e-01   +1.127520488830649e-01   -1.050656052393605e-01   +1.398543373516545e-01   +8.642417756917933e-02; +6.317261434392370e-02   +2.220790841956184e-01   -2.144122227513332e-01   +2.132597056091781e-01   -8.195023476406768e-02   -2.710100346579475e-01   +2.949558523780764e-01   -2.542796297358592e-01; -1.694860670769266e-01   -3.166107446740928e-02   +9.517386051763245e-02   +2.403123395248957e-02   +2.689313379353690e-01   +3.645505017441819e-01   -8.961046475921731e-02   -2.477073730533039e-01; -2.454435707748473e-01   -1.149687377498303e-01   -5.226713223365362e-03   +1.570710070234765e-01   -1.960527424411544e-01   +1.326604075821312e-01   -3.173991717770459e-02   +4.855952074575121e-02; +2.517219488520775e-01   +1.138780768923996e-02   +1.693768397147996e-01   -2.641660191316656e-02   -1.088883599704255e-01   +3.767471277044355e-01   -1.247675742284691e-01   +2.764072963244615e-01];
L1I_L2I_iGABA_netcon = [-8.491102556276188e-02   +9.526411256209834e-02   -1.939226103779438e-01   -1.018227927194687e-01   -1.434126388727533e-01   -2.435872549448916e-02   -4.291496894893015e-01   +4.097001303960350e-02   +4.671826924667221e-01   -1.722315351032300e-01   +2.197873599507759e-01   -2.387575700289246e-03   +1.903752372087133e-01   +1.204277216985267e-01   -1.532632550654098e-01   +9.772964973359385e-02; +2.692545895960289e-01   +1.112887989661270e-01   -7.159898510156090e-02   -2.086681389159213e-01   +7.630660284280166e-03   +1.502765663316611e-02   -1.099741906296832e-01   +2.081314987318972e-01   +1.144001966975764e-01   -1.596017803247364e-01   -3.205664616889848e-01   -3.045919365107983e-01   +2.770864108684508e-01   -4.491938879532238e-02   +1.021952461578188e-01   +4.469780415144010e-02; +7.128906174341786e-02   -3.951633395397181e-02   +7.430169641303890e-02   +6.327419478734603e-02   +8.931052695094928e-02   +2.507052794630447e-01   -3.267710712382283e-01   +1.724887291825258e-01   -7.328143876130856e-02   -1.710301771323240e-01   -3.746094269341186e-01   +4.800308869865599e-01   +2.226836031581893e-02   -1.012315567516152e-01   -2.146530653722145e-02   -2.738279125364666e-02; +2.899743451865532e-02   -1.993147914005857e-01   +2.100692442602367e-02   +1.244672542749964e-01   -7.505295593932654e-02   -3.102643694496230e-01   +3.555960583459558e-01   +2.267880264593481e-01   -2.748654596649687e-01   -1.106912571840711e-01   +3.610470815624733e-02   -7.228203036503143e-02   -2.379349048191787e-03   +1.737302775172277e-01   +6.115339780677118e-02   -2.389505768039391e-02; +5.189822263087472e-02   +2.330299842907659e-01   +2.778409543686468e-01   -1.685746026495184e-01   -1.623453763206734e-01   +9.324517679063879e-02   +1.266599821310873e-01   +2.763422467653542e-01   -2.986087694601431e-01   -1.658761505128762e-01   -1.823670441021021e-02   -2.549054946381866e-01   -2.437573171871098e-02   -2.550944266615095e-01   -6.340627213682185e-02   -1.334569621531291e-01; +5.371367881280089e-02   +2.071325598992924e-01   -3.146842839050493e-01   -1.463833541035803e-01   +3.589768255553371e-01   -4.266924089810744e-02   -1.408981809699140e-01   +9.706472520764692e-02   +4.598940661979982e-01   -3.575780484357385e-01   -1.021159266877904e-01   +9.095872122391349e-02   +2.116071178663622e-01   +1.866029337664530e-01   +2.253808571438715e-01   -2.519339631797373e-01; +6.811312214651644e-03   +9.460912606004651e-03   +1.320034977403213e-02   +3.581697358666573e-01   -5.238254975751201e-02   +3.031047707768137e-02   +1.470821924927371e-01   -1.240665194517571e-01   -3.834433110053042e-01   +3.492965797957227e-01   +1.123521159659077e-01   +1.970275748514440e-01   +7.912163123476923e-02   +3.132196747254135e-01   -3.650170898579177e-01   -1.154431654839858e-02; +4.048234096140846e-02   -2.570039237239893e-02   -7.795136825220622e-03   +1.173849422052047e-01   -1.100263806567415e-01   +1.635229987740046e-01   +2.776320691352539e-02   -4.870456917953306e-02   -4.226147269063776e-02   +1.383944549698335e-01   -2.965569621856998e-01   +1.963928968855108e-02   +3.168214351911991e-01   -1.007374151561637e-01   -1.174643487274515e-02   -2.086364653166106e-01];
L2E_L1E_iAMPA_netcon = [-2.849180421810140e-01   +6.351371286361616e-03   -3.182874559520174e-01   +9.285701956301406e-04   -1.197026470079704e-01   -5.626107238825409e-02   +2.820172920106001e-01   -3.134547683361149e-01; +2.421851515178988e-01   -2.257488668908466e-01   -1.881563071017331e-01   +2.905083765061953e-01   +3.405329678878555e-02   +2.884693733540467e-01   -3.187636066970643e-01   -7.645386423863473e-02; -4.894082724997023e-02   +9.238392361522749e-02   +1.166226413518646e-01   -1.788992518441844e-02   -1.987125901294128e-02   -1.787588965978229e-02   -1.500531585935336e-01   +9.485629582233837e-02; +2.467021212571192e-02   -3.230276455415358e-01   +1.703806050938923e-01   -4.215122216812455e-03   -3.104036364068533e-02   +3.503892305016580e-02   -4.103795688804282e-01   +2.260618139903168e-01; -1.841076434861631e-02   -1.843439926817814e-01   -2.963364139552546e-01   +1.437386661973424e-01   -1.876813152841141e-01   +8.387667344585900e-02   +1.272258048292971e-01   +6.144235572397355e-02; -2.163222827192346e-01   -2.636961345275164e-01   +1.183918209492891e-01   -2.923605333054432e-02   +2.376126449294670e-01   +1.098716990679914e-01   -7.933865626964509e-02   -2.270277251794041e-02; +1.526003054501804e-01   -2.619598131903151e-01   +2.882375922064684e-01   -1.093188606152634e-01   +1.113884387610233e-01   -2.219415200821300e-01   -4.010659790641669e-02   -4.997017694490811e-01; -5.520031371114779e-03   +1.580676996863210e-01   +1.695254127560132e-01   -1.620454696871770e-01   +2.116232019508764e-01   +2.736502947035524e-02   +7.649668627801294e-02   -1.509011595859294e-01; +2.964107362784419e-01   +9.963385827333475e-02   -1.451498168350986e-01   +2.682633913203085e-02   +4.201050774747359e-02   -9.954455505666560e-02   +1.810644746532362e-01   -5.393636350979045e-03; -2.160887666243996e-01   -1.261143213985567e-01   +3.006493871868551e-01   +2.215052957418736e-01   -3.283571706926217e-01   -3.458820238282476e-02   +3.498915563499542e-02   -2.333548689730010e-03; -1.727225737062452e-01   +4.149539465571218e-01   -3.813813378141436e-01   +1.032815907353513e-01   -1.470709683234508e-02   +2.978644481413829e-01   +1.141097874395366e-01   +1.916901600621674e-01; +9.833896245544721e-02   +4.525963203003354e-02   -1.088717496069340e-01   -1.391741664141353e-01   +4.822641451922947e-02   +1.250840508789114e-01   -1.737859334242859e-01   +2.122739732936072e-01; +3.240774289237140e-01   -1.237297804976722e-01   -3.519132606142515e-01   +3.960085295593643e-02   +1.473481759027698e-01   -2.981156186575067e-01   -8.286033532774095e-02   +1.682601630226727e-02; +2.144825259641024e-01   -3.539638196045630e-02   -4.246583592971843e-02   -2.450617806212759e-01   -1.584162238255468e-01   +2.061512721331746e-02   -9.098049195154884e-02   -8.266513744251597e-02; -1.640213118068116e-02   +1.061673870774097e-01   +6.949016375172450e-02   -4.240099731872094e-01   -2.184028063120727e-01   +2.432871868361517e-01   +5.877487925061807e-02   -1.887886183124014e-01; -3.021488437559520e-01   +1.582808205523664e-01   +2.760969736756043e-01   +3.631020409381670e-02   -2.067378985965418e-01   +2.022166138351392e-01   -1.808348279347338e-02   -4.181491062622773e-01];
L1E_L2E_iAMPA_netcon = [+2.586228121530811e-02   +5.737355057999052e-02   -1.007351429825964e-01   +6.059171854107469e-02   -1.226143825295362e-01   -1.031889023507319e-01   -8.698127070569663e-02   +3.458994108977795e-02   +4.210457514918359e-04   +7.738341464001522e-02   +1.604310162540488e-01   -2.009390323519483e-01   +8.805862051669505e-02   +2.432767350997184e-01   +4.061466369646660e-02   +2.170999083075107e-01; -4.223032568130938e-02   -1.091678813989239e-01   -2.890180807885223e-03   +2.023796240721366e-01   +1.840520654912996e-01   +9.583907100607757e-02   -1.070524742291601e-01   -7.601958130323383e-03   +1.063362608061211e-01   +1.920690561776207e-01   -2.056574468391474e-01   +5.557924337140464e-02   +3.306037765600351e-01   -2.516482248326477e-01   +2.626061722429882e-01   +2.420510199543938e-01; -1.923888018869165e-01   -9.270591404140285e-04   +5.466707617388632e-02   -1.760763316192488e-01   +7.475274112570740e-02   -8.830595636616839e-03   -2.869754247623545e-01   +2.300900991098926e-01   -3.682027959961939e-02   -5.012195718580310e-03   +6.945830487460214e-02   -2.708502456069088e-01   -1.845015796292715e-01   +6.820876182291699e-03   +3.265398599479307e-01   -9.172423999050336e-02; +5.339931546697294e-02   -1.119656500403689e-02   +3.186833749632472e-01   -1.346563425181132e-01   +1.490319755936192e-01   +2.069139236593187e-01   +1.928145636391491e-01   +1.200498958504094e-01   -4.008768712656305e-03   +7.964227933931096e-02   -3.547829163965195e-01   +3.221776752318892e-01   +1.748289218794024e-01   -5.887122566419798e-02   -7.337030747027397e-02   -1.240930239105874e-01; +8.530546648083787e-02   -1.572914506016427e-01   +1.202883403235529e-01   +9.038132940321337e-03   -4.767323249142459e-02   +2.756737708365652e-01   -1.878220887292211e-02   +2.412787925820415e-01   -1.430817058990653e-01   -9.459998881817271e-02   +1.290544064413352e-01   +8.458804497730425e-02   +2.980931317302074e-01   -3.611006735411734e-02   +1.273627813490646e-01   -4.888135963854270e-02; -3.265284076409002e-01   +2.741595477502780e-01   +3.855443489544225e-01   -1.188957558826480e-01   +1.381555652568974e-01   +7.697140028909091e-02   +1.010756444820067e-01   +9.123152856341825e-02   -2.309883417742114e-01   -8.051506534512143e-02   +2.391581810249475e-01   +1.590479577658804e-01   +5.586968632510153e-02   -1.908070071583921e-02   -8.324497464476391e-02   -5.912729928013694e-02; -1.407867477617930e-01   -9.300303195845544e-03   -5.054921369561544e-02   -1.259327007789256e-01   +1.089677509993993e-01   -4.200455787206188e-02   -3.054182488597594e-02   +8.772108465534129e-02   -1.536259783904324e-01   -4.668361200594710e-02   +1.985291707563018e-01   +1.623681614119443e-01   +4.272318954925469e-03   +6.671147442316243e-02   +7.585762040053377e-02   -1.328006463353371e-02; +1.751917136290612e-02   -2.746666142635588e-01   +2.410180751640303e-02   +3.224551517105512e-01   +1.182392344937847e-01   +1.431485339348115e-01   -2.784734962568358e-01   +3.411571713073515e-01   +1.397804451266363e-01   +1.623036331996899e-01   +3.950647685351961e-02   +7.827619705608621e-02   -2.684392969911558e-01   +1.884204763212116e-02   -7.984310726013832e-02   -3.546484091818498e-01];
L2I_L2E_iAMPA_netcon = [+5.838100395644474e-02   +1.390428559940744e-01   +2.873544945803113e-01   -5.704326750791820e-02   +1.664044907383102e-01   -7.961485855721703e-02   -1.899039143008576e-01   +6.652792689034416e-02; -2.347089877124076e-01   +4.299756717986203e-01   +2.935589093568713e-01   +1.218790199245029e-01   -2.083736349737915e-02   +2.363209879464054e-02   +1.988387510275138e-01   +3.188634937096818e-01; +8.567656372667629e-02   -1.082845044921509e-01   -2.516317251332083e-01   +5.859173837338799e-02   +3.162424374884709e-01   +1.131598699033314e-01   -4.162147247425854e-01   +2.900416175302186e-01; +2.507207949442612e-01   +1.441762288212597e-01   -4.462540204703605e-02   -2.965691412494731e-02   -6.874359997682236e-03   -1.637141220470156e-01   -1.370437341993992e-01   +1.451850519858776e-01; -1.309315597465620e-01   -4.856912760872521e-02   -2.183187877384977e-01   +3.268554088024507e-02   +2.767086860293798e-02   -3.296946561703111e-01   -4.898250617546257e-02   -7.394224384439363e-02; +2.374015940610154e-01   -2.099007744514279e-02   +3.498531065286251e-01   -1.117407757117486e-01   +1.475545127809689e-01   +1.245948717252090e-01   +3.140595171439896e-01   -1.211827966558183e-01; +7.868600416172894e-02   -8.250615836213324e-03   -2.136998818302913e-01   -1.522620919294643e-01   -4.495287905921243e-02   -7.046741472164121e-02   -3.062579409882864e-01   -4.872386260859783e-02; -4.488050284827769e-01   -2.772781693026625e-01   +2.481608843977721e-02   +4.466587546131703e-01   +2.360960775449821e-01   -1.061559931238674e-01   -4.560140483884009e-02   +3.858226229882156e-01];
L2E_L2I_iGABA_netcon = [+2.868498494516915e-02   -1.747962165234106e-01   -1.118351979975622e-01   +1.203073303627590e-01   +3.029129876792844e-01   -4.026908353923266e-02   +2.964793522435236e-01   +1.338523459876102e-01; +3.890599297006753e-02   -1.097050995069083e-01   +2.183450896496889e-01   +2.462429751220509e-01   -1.356629527065351e-01   -9.619647930806019e-02   +1.099993349926763e-01   +1.593564194857470e-01; -2.580521365918441e-01   -1.772350005583298e-01   -1.131967524537884e-01   -8.482794364299033e-02   -8.332533991567220e-02   +3.103866514095243e-01   -9.139563045860173e-03   -5.026215295659910e-02; -1.926109121645543e-01   -4.813801373574631e-03   +4.608763658606193e-02   +7.855275418752362e-02   -3.489109951033215e-01   -1.226185235312050e-01   +3.399581769643351e-02   +1.017049764268289e-01; -1.577909389779026e-01   +1.088282545726620e-01   +1.036836799599108e-01   -1.808627243701456e-01   +1.821041094014316e-01   -1.919120186921709e-02   -1.896671610339116e-01   +2.470911558971896e-01; +2.203836377271567e-01   -3.427852438252536e-02   -6.154329253322932e-02   +7.399058005296902e-02   +1.259295876548699e-01   -7.324875103903594e-02   -2.180467776137146e-02   -2.792526559462362e-01; -2.790952317699558e-02   +7.586673431445198e-02   +3.995623912488708e-01   -1.620312667182425e-01   +1.500297054393558e-01   -2.184973801566022e-01   -2.448149671657731e-01   -3.955142161397758e-01; +8.808980799950465e-02   +1.294207211554136e-01   -1.073696629658641e-01   +5.381733755457666e-02   -2.163771889349243e-02   +4.553440111265047e-02   +2.048651358873180e-01   +1.050803273841262e-01];
L3E_L2E_iAMPA_netcon = [+2.434057607294658e-02   -6.321701389145874e-02   +8.186694219983787e-02   +6.604444832049160e-03   -2.355354781350112e-01   +2.813979880018267e-02   +1.617214337144613e-01   -1.317223927660061e-01   +1.832613232068205e-01   -1.292766336333482e-01   +3.181129714316157e-01   -1.420612502128170e-01; +2.335011767670796e-02   +1.958014005181832e-01   +3.935513237471656e-02   -2.022742439758436e-01   +1.896599867948567e-01   +8.343752525736728e-02   -2.096190157192269e-01   +2.469710696686839e-01   -3.347932984722347e-01   +1.372223978015946e-02   -5.369108669370806e-02   +2.449796741140650e-01; -1.983562731957695e-01   +2.691157773959579e-01   +1.931315489710591e-01   +1.713269686442427e-02   -2.514277024652130e-01   +1.890585304836805e-01   +8.382300618927932e-02   -1.968747163500765e-01   +1.501734385525975e-01   -2.921356608429860e-01   -5.244574920670493e-02   +5.916801990987184e-02; +2.985938410148011e-01   -1.957553633088850e-01   -2.260959394355344e-01   -1.217004934329643e-01   +1.676454349287985e-01   -1.499359230145912e-01   -6.337033932747679e-02   +2.274602037130672e-01   -1.812282366863826e-01   +8.973588198477615e-02   -1.395087925242181e-01   +1.930493902119349e-01; +1.689355941776519e-01   +5.224783452999052e-03   -9.348262097475625e-02   -6.795524240732059e-02   -3.800052267941283e-01   +1.951474082707810e-01   -3.951417327635284e-02   +3.370445061195957e-01   +1.035600518943375e-01   -2.803691269879420e-01   -2.496363342202653e-04   +5.745276239381904e-02; +7.521176153401121e-02   -6.168840924919856e-02   -8.153249701002799e-02   +3.330802413533348e-02   +3.520786117008821e-01   +4.560749739329441e-02   -4.238372135899486e-02   -2.852589990355502e-02   +1.282649093152692e-01   +1.541778834033083e-01   +4.431110950257799e-02   -2.722722022574352e-01; -1.138057448646342e-01   +6.052447284110228e-02   -9.197441130187282e-02   -1.762837201974498e-01   -6.833240943203836e-02   +1.209360074526150e-01   -6.954358731438934e-02   -8.127992662392552e-02   +2.609821527689885e-01   +1.313841654064055e-01   -1.468544493573573e-01   -3.174245704560687e-02; -1.237345034326898e-01   +1.325309988346767e-01   -9.931147636093837e-02   -3.589866863445868e-01   +3.373373301558377e-01   -1.609860277278653e-01   -3.059788128971059e-01   -1.003410881607718e-01   -1.695765041111546e-01   -1.083568768762796e-01   +5.316978711849728e-02   +2.753224514850503e-01];
L3I_L2I_iGABA_netcon = [-1.383518257804237e-01   -2.545920203266538e-01   +1.698508249724451e-01   +4.770479334546675e-02   -2.394258926000779e-01   +8.504326156219721e-02   +3.269341174895733e-01   -3.345243962422157e-01   +1.910304834573344e-01   -2.355086116307010e-01   +1.315512758933739e-01   +1.034331127515065e-01; -1.949064455772917e-01   +5.701856758709496e-02   +3.285090136978330e-01   -7.151952377204909e-02   +1.228103502952422e-01   +1.407931733331580e-01   +1.638762000569628e-01   -2.327010296279938e-01   -1.169359950308804e-01   +1.594586251162794e-01   -5.975488907407695e-02   +1.839503669652822e-01; +1.360039782082953e-02   -2.933925297971840e-01   +4.670966407648523e-02   +1.496637111630214e-01   +1.518359307731117e-01   +1.521465103900898e-02   +1.244772764733884e-01   +1.371515591936270e-01   +2.555673201911109e-01   +2.570169222181024e-02   -1.058291965890349e-01   +4.370768105474006e-02; +8.681952867917876e-02   +4.341293346461270e-02   +1.807797982620024e-01   -1.010888804256918e-01   +4.516411485651023e-01   +2.207224707795549e-01   -3.127633645221002e-02   +3.015773109187873e-01   +9.458733327875642e-02   +1.447082056567252e-02   -1.575367607110820e-01   -3.262913905390648e-01; -1.415139821194820e-01   -9.946902517288941e-03   -4.308606319386608e-01   +1.140819120241958e-01   +5.365942961330472e-03   -2.590590076220012e-01   +1.338696045281287e-01   +6.103769266523185e-02   -2.095274412457607e-01   -4.997728213473272e-02   -2.538900876169752e-01   +1.554999052303525e-01; -2.101264652433210e-04   -6.573516612759716e-03   -9.775287322666683e-02   -1.998163083927237e-01   -4.678393179321541e-02   +9.213424413367699e-03   +1.989956271878776e-01   +1.474625249808298e-01   -5.512260792207922e-02   -2.005241509041872e-01   -2.480388691109527e-02   +3.284068368556898e-01; +9.504849314560210e-02   -2.098283099841836e-02   +1.123653703850644e-02   +5.919007579410890e-02   +3.512643330558177e-01   +7.401919311502773e-02   +1.436632156148078e-01   +1.138719892338067e-01   -3.094220160511194e-01   +7.617406703611725e-03   -1.088832553732120e-01   -2.332187605122771e-01; -1.583317041608951e-01   -1.780052820654838e-01   +2.179034265564793e-01   -1.959759997478145e-01   -1.177988110896508e-01   -1.087284186182382e-01   -1.530091219981791e-01   +1.347360932729418e-01   -1.107797057774197e-01   +3.208251628023563e-01   -2.151881690566296e-01   +3.048693323495387e-02];
L2E_L3E_iAMPA_netcon = [+1.642671772252568e-01   -1.909083890144300e-01   -6.465845375543897e-02   +2.637522655931769e-02   -1.641075631597025e-01   +5.932162554919007e-02   -1.153986094885658e-01   -2.264771192035574e-01; +2.120505781452211e-01   -1.705013374744854e-01   -2.935372682842341e-02   +1.460832901308604e-01   -1.973075766873052e-01   -7.573902550749370e-02   -6.702837397469551e-02   -1.697806651132296e-01; +3.811183388292514e-01   +2.116073436471150e-02   -3.819754675948279e-02   -1.702395372981848e-01   -7.957714013064578e-02   -3.055310882855576e-02   +4.767093398796813e-02   +2.313467610157835e-01; -4.161617838642447e-01   +2.574684218697504e-02   -3.668998233964409e-02   +2.231244621837685e-01   -2.960165096310125e-02   -1.045312822884677e-01   +1.479370775268172e-01   +1.396089115872537e-01; +3.976882079937841e-01   -1.695887943762089e-01   +3.992837726251994e-01   -4.044076703738098e-02   -4.766737471463239e-02   -3.448619655816980e-02   +4.301936439034955e-01   +1.368998997435473e-01; -1.773620963469856e-01   -5.595214320915728e-02   -7.564093497091760e-02   -3.070657845618179e-01   +5.631064465538571e-03   -1.312220393074778e-01   +2.355215242320693e-01   -6.868486053312001e-03; +3.555521236739659e-02   +1.844552253459477e-01   -1.176280820563990e-01   -4.059010964952163e-02   -1.965453940931443e-01   +2.268714301841231e-01   -3.106069862629917e-01   -5.131135973183947e-02; +4.403542724874990e-02   -5.440292451975639e-01   +2.650482551144845e-01   +1.540927678143711e-01   -3.824707771115650e-02   -2.413607966971096e-01   +9.779423060168177e-02   -1.778478984481029e-01; +6.753003513916264e-02   -2.028991022440160e-01   -7.581574155950427e-02   +4.749966203399571e-02   +1.964003920676022e-01   +1.073856363372847e-01   +3.160623422510914e-01   -1.972439838977401e-01; -2.260658870950572e-02   -2.778507949929801e-02   +7.262307763719963e-02   +1.965862412156874e-01   +3.417391046872397e-01   -1.272820682034704e-01   +3.604474129947572e-01   +3.206674699254954e-02; -2.130873591154408e-01   -4.037506600578485e-01   -2.116400674599928e-01   +1.186827556791502e-01   +1.109204172706724e-01   +9.876644617039063e-03   +1.299883963568027e-01   +1.324972968111934e-02; -1.239726023660743e-01   -1.894599795188391e-01   -9.275960079410596e-02   -2.788107989301867e-01   +6.883548598265185e-02   +1.019598276629989e-01   -2.303745123438020e-01   +2.088321987641474e-01];
L2I_L3I_iGABA_netcon = [-2.346440047447321e-01   -1.784151023748720e-01   +3.053111308978341e-01   +2.781299782125832e-02   -7.017199720454061e-02   -3.057422751629263e-03   +9.660720503269908e-02   +2.408287020918525e-01; -6.518343484192321e-02   -1.101796396239865e-01   -1.449745428418200e-01   -1.529698734293870e-01   +1.754300865524039e-02   +2.983762159880206e-01   -1.217621516582689e-01   -2.730076322968745e-01; +1.310981982027738e-02   -7.704920728883659e-03   -1.509360413136419e-01   +1.305061250580197e-01   +3.082877785953437e-01   +8.744723351109457e-02   -1.354053069242925e-02   +1.278067266692747e-01; -1.673031989357097e-01   -3.238623872398000e-02   +1.569684368064938e-03   +7.563164598674454e-02   -2.366206673120199e-01   -8.115672679688822e-02   -2.509872863647071e-01   -8.316869439255334e-02; -5.046077015989410e-02   +1.727188174785663e-01   +2.906500754913117e-02   -1.401871684461851e-01   -1.306326195001203e-01   +2.104707448289307e-01   -5.529805868002022e-02   -1.924039254019176e-01; +1.464239402700798e-01   -1.852073798951614e-01   +7.650976727608329e-02   -2.851437534043286e-01   -1.360406433181331e-01   -8.655346021510577e-02   -1.190600300729400e-01   +1.462143497779594e-01; -1.084272779599128e-01   +1.142737158501320e-01   +1.612355966805550e-02   -1.267749580214128e-01   -4.751112755129708e-02   +3.832736076983875e-02   +5.990495280531102e-02   -2.207072636332146e-02; -2.960272495049333e-01   +1.847803413961545e-01   -8.983786745131428e-02   -1.611018096854422e-01   -3.288953853644018e-01   +1.876754440549822e-02   +9.107459593857396e-02   +1.431760002607264e-01; -3.010547317311219e-01   -1.806910232831581e-01   +1.543805138840782e-01   +1.404303549885876e-01   -9.518707230730787e-02   +1.549648786239358e-01   +2.861484675989331e-02   +7.253378049722642e-02; +2.570411281314350e-01   -2.300064092900138e-01   +1.716663648957238e-01   +4.316556844950362e-02   +2.581028031233139e-02   -7.674737026406103e-02   -9.509175255892229e-02   +4.214422762146228e-02; +3.121097883019915e-02   -1.419487148761980e-02   -2.463583931131708e-02   -1.019536351335155e-01   -1.963841954249947e-01   -9.395418091649413e-02   +3.182237009005534e-01   -1.092406932532065e-01; -2.776004042763690e-02   +1.614714151350318e-01   +6.200145907048964e-02   -1.951104655101733e-01   +1.360356855282657e-01   -1.192782270945060e-01   +4.463042001384393e-01   -3.162097815816486e-02];
L3I_L3E_iAMPA_netcon = [-7.714487044693757e-02   -1.372993684930869e-01   +7.449548096857006e-02   +1.033331509876404e-01   -2.264145067916262e-01   -1.010779964353121e-01   -4.414548632555756e-01   +1.472147611101762e-01   +9.587128729081394e-02   +3.017146999060160e-01   -1.973514122350733e-01   +3.499604547420831e-02; +6.377990408051178e-02   +1.117953353312075e-02   -3.042880749277033e-01   +3.075691779357838e-02   -5.418937569101887e-02   +9.360209425135303e-03   -3.017548874768020e-01   +2.944712431725487e-01   +1.756664368118116e-01   +3.784887122778892e-01   +4.688261745016170e-01   +3.470877046624065e-01; +1.175479684627763e-02   -2.902909655611958e-01   +8.160039651150780e-02   +1.087829554679187e-01   +1.775007291688926e-02   -1.867363421776255e-01   +9.241277397890263e-02   +1.775071942348827e-01   -1.160284200533794e-01   +2.496096374930377e-01   -2.240085794387127e-01   +1.666696983277968e-03; -2.156080778306435e-01   -1.099339480325562e-03   -2.001578540072282e-01   -3.630562687833023e-01   -6.160406763707416e-02   -5.790685401625500e-03   -4.701514016149549e-02   -3.845253847547518e-01   +1.959697788696647e-01   +1.677372170298147e-02   -1.363849973728243e-01   +1.493001482188663e-01; -2.385441686305795e-01   +3.050706221201532e-01   -4.573971198232293e-02   +1.489994930264202e-01   -1.305221932848491e-01   -5.077939809660724e-03   +3.529299382895965e-01   -2.313230607504983e-01   -3.883489279450944e-02   +1.561068568011823e-01   -3.701450854017921e-02   +7.724165853249816e-02; -1.874407859438060e-01   -1.726640381699237e-01   -1.223327443115629e-01   +1.470840843394267e-01   -3.124317551516759e-01   +1.909989742294690e-01   +2.175369749387100e-01   -1.034646697444868e-01   -3.116568643906362e-01   -3.875157022050561e-02   -8.278162355306151e-02   +2.144059015448854e-01; -6.070608837473497e-02   +1.160073633297453e-01   -4.491273327411641e-02   +7.269071737804296e-02   -1.636515107644677e-01   -2.256588070240317e-03   -9.419113309318461e-02   +2.795170190277361e-01   -1.920810489597725e-01   -1.008541651111565e-01   +2.483595875527705e-01   -4.220329227026559e-01; +1.291404752936558e-01   -2.595168157883690e-01   +4.399570456919064e-02   +9.923889262606103e-02   -6.673637554284906e-03   +5.708679706475042e-02   +1.395249482641541e-01   +2.443015619437662e-01   +1.118297056702817e-01   -1.774806111381554e-03   -1.409921334416567e-01   -2.446471141912514e-01; -2.075046339231758e-01   -4.509752450597779e-01   +1.905634578861954e-01   -2.667736874731879e-01   -2.627577739225343e-01   -1.218206206876570e-02   +2.116683278109808e-01   +1.051176573966805e-01   +1.317582311757390e-01   -1.451894229043686e-01   -2.176891692124757e-01   -9.458288886663699e-02; +5.301379364061539e-02   -1.315143050564659e-01   -1.480900227506959e-01   -2.048896464233754e-01   +2.607954449908420e-02   +5.639760195098556e-02   -2.119544961575811e-01   +1.927807177469260e-01   +6.537212680981035e-02   +2.710986076719500e-01   +1.690323914870416e-01   +1.937377288564445e-01; -5.043415695859053e-02   -1.245871851621356e-01   -2.522657970145699e-01   -2.583748741247645e-01   +6.154029627525801e-03   -1.561700809213720e-01   +1.232263711416643e-01   -2.158099001150533e-01   -1.577921240953896e-01   +1.034228401873172e-02   +1.816952443821163e-01   +1.089600228243556e-01; -8.376634435280224e-02   +2.320747654177674e-02   -2.022658226488447e-01   +1.174792579982391e-01   +1.074028759034165e-01   +3.323892979830698e-01   +1.137942381102221e-01   +6.793635856197973e-02   +2.744650025566786e-03   -3.219197799164269e-01   -9.213565207152510e-02   -3.325022773463049e-01];
L3E_L3I_iGABA_netcon = [-2.163772596438740e-02   -1.698754943552373e-01   +2.294338002821694e-01   -7.508923970587725e-02   +1.150111656093341e-01   -6.947041408818416e-02   +1.826376290827433e-01   -3.546282901244757e-02   -7.045099161451314e-02   -1.526586951756847e-01   +8.907346192813578e-02   +2.215812534932772e-01; +1.480691910404519e-01   +1.337554766261419e-01   +3.808475199125957e-01   +1.780803974098984e-01   -4.302483063145686e-01   -1.683231797384363e-01   +3.883093735566596e-02   +3.964125484375008e-02   -2.279094953582584e-01   -3.437820234634355e-01   -1.595615199901167e-01   +2.514098656870054e-01; +1.890618861852939e-01   +2.149506818217796e-01   -9.483853331582126e-02   -1.092799760262706e-01   -2.910607539940451e-01   +2.939801271742766e-02   -5.869124579283516e-02   +1.631803797350338e-01   +1.024804686030426e-01   +1.487379849233273e-01   -4.471118503154077e-02   -4.703122686187698e-01; +1.089927426251572e-01   -9.157741669113403e-02   -5.826088332225776e-02   +1.282092120804875e-01   +3.206832362137189e-01   +2.817177076451120e-02   +1.848534546594199e-02   -2.985489999522271e-02   +4.886022148484113e-02   +1.262349211150141e-01   +1.679862595611092e-01   +2.331299577175737e-01; +6.189421146137689e-02   -8.164593115058287e-03   -1.952139249246154e-01   +7.659303947684878e-02   -9.934909019551369e-02   +4.065593409343107e-01   -3.830083419980795e-01   +2.116503216735371e-01   +1.539312392761182e-01   -6.552727533935293e-03   -1.124962822973139e-01   +2.919029558791912e-02; +9.778962636851907e-02   +2.052430153945747e-01   -3.240806809778771e-02   +1.972453105061162e-01   -3.102878648346773e-01   +1.114736131076339e-01   +1.211626168054152e-02   +1.452556506059286e-01   -4.838192925744681e-02   -1.555005822324896e-01   +2.434454181712407e-01   +3.994061965556011e-01; +1.486666966237146e-01   +4.929877878227754e-03   +1.940571082567756e-01   -1.757043999075100e-01   -4.282168162341020e-02   +2.032198466393288e-01   +1.341373147539076e-01   +1.058116592323976e-02   +1.403921247036580e-01   -8.871975805089433e-02   +1.847291778607538e-01   +2.323461858583125e-02; -1.425169329447276e-01   +2.766489944811502e-02   -1.253908926867456e-02   +1.203239789867545e-02   -1.960282455497132e-01   +4.647964136500161e-02   +2.287320535327562e-01   -1.866058648712515e-01   -3.213573078350838e-01   -1.425466979243390e-01   +2.896830162779679e-01   -1.195045771732051e-02; +9.335162309340339e-02   +1.586912195113505e-02   +8.914290897896504e-02   +3.456027101048937e-01   -1.715364079052976e-01   -2.034218203049266e-01   +1.524159101599273e-01   +1.152199443106031e-02   +3.525874562444933e-02   +9.327797927524657e-02   +2.200849172081393e-01   +2.118598328754270e-01; -1.244449634313288e-01   +5.573966147306805e-02   +6.353657599863474e-02   +9.095427790030261e-02   +1.000093045856939e-01   -2.391114339391241e-01   -1.508279556103041e-01   +8.556106145659614e-02   -1.566748083615057e-01   -2.125127696924575e-01   -4.632006808446436e-02   +2.924090112499937e-01; +6.207710195908638e-02   +1.731410397685313e-01   -2.098720947249074e-01   +3.938313526502332e-01   +1.237269111762966e-03   -2.937481935767438e-01   -1.553915862000409e-01   -4.172099675574820e-01   +1.435894240500173e-02   +4.045138256422937e-02   -2.995565551966112e-01   +3.014756632079463e-01; +2.480816962705133e-01   +4.860531610298474e-02   -1.967357252354629e-01   -2.347024490125595e-01   -3.356720792154497e-01   +4.954084263863364e-01   +5.144922238630337e-02   +2.035291964901816e-01   +7.107616328509901e-02   -5.460142264878112e-02   -1.297859942221301e-01   +1.827750642501134e-01];
L2E_Input1_iAMPA_netcon = [-1.462445359086623e-01   +2.169999541416249e-01   +2.233090529390886e-01   -2.509013775101989e-01   +1.392134254260752e-01   -1.005562480816278e-01   +1.852714457834932e-01   -2.473223530010020e-01];
L2I_Input2_iAMPA_netcon = [-1.042846113479931e-01   -9.912138064968531e-02   +2.996859062133012e-01   -2.168436695108532e-01   +1.802313175136586e-01   -1.851779181400458e-01   +2.652029346304711e-02   +2.175271830749905e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.04*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.9*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.1*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.9*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.1*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.9*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.04*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.9*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.1*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.9*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.1*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.9*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
