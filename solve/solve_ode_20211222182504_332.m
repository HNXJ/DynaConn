function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+2.992312126962412e-01   +4.602814853127102e-02   -5.012973625084919e-01   -1.801754889327608e-01   -3.029899293976639e-01   +6.014237860589953e-01   -1.268482243822926e-01   -4.921521851384081e-01   -5.756575023848658e-01   -4.054494183872786e-01   -4.790378705604971e-01   -1.776994188389848e-01   +8.419299495485991e-02   +1.492341258451098e-01   -1.417236004497904e-01   -2.970195505884990e-01; +3.634939420124215e-01   -1.076107861866411e-01   -2.166241235539987e-01   -1.893885339777595e-01   +1.285749368012964e-02   +3.603092919058127e-01   -9.867240601500185e-02   +2.333317561969632e-01   +3.165094136722970e-01   -3.900941353728811e-02   +8.624842060156674e-03   -3.010708294321010e-01   -7.006460025642993e-01   +1.233476031732151e-01   -1.088464640037824e-01   -5.653747431990538e-01; -1.544502407758972e-01   -3.654231504238814e-01   +7.608525477328924e-02   +2.552558562344431e-01   +1.781415255060882e-01   +1.744776939447688e-01   -9.701025797478625e-02   +3.373914349930103e-01   +2.848166986860949e-01   +3.190019348874408e-01   -3.856109895978334e-01   -2.372909477148787e-02   +5.451103406961947e-01   -9.697599499974580e-02   -4.374993959096620e-01   -5.758085319054032e-01; +5.083688584581704e-01   -1.117542096034901e-01   -7.218626605181189e-02   -6.616214739203782e-02   -5.708792866283673e-01   +1.053585326910208e-01   +7.400762540299266e-01   -4.966751039105169e-01   +3.359778832946434e-02   +8.570628215973594e-02   -1.862905981581692e-02   +3.877052283648049e-01   -2.097645499373364e-01   +7.010041011863853e-02   +8.038046915502857e-01   -7.588135270694939e-02; -3.964659614842715e-01   -2.392133486807829e-02   -6.412874434143383e-01   +3.515061641480766e-01   +4.297257354730493e-02   +2.738463873698566e-01   +4.045591502078171e-01   -2.894505947644981e-02   -4.812556618307809e-02   +5.911763756004786e-01   +3.491465111294126e-01   +3.462024114519053e-01   -4.052090317416955e-01   -6.336459403696026e-02   -5.054752787253055e-01   -6.010299145013379e-01; +1.068664914709524e-01   +3.860163630398366e-01   -3.167890483410910e-01   +3.925771197240489e-01   -5.450471867952708e-01   +7.095226666069426e-01   -4.810460652415214e-01   +2.060720826022644e-01   +5.602459691207611e-01   +4.896478871604509e-01   +1.078530008563356e-01   +3.304275282373755e-01   -1.177978392293644e-01   +4.665336474110945e-01   -6.709706078278939e-02   -8.912316343873271e-02; -2.012393491334206e-02   +4.128870998442979e-01   +3.472538155543454e-01   +3.908227828694779e-01   +3.619739219939386e-01   +3.487563675366021e-01   -1.625528977205037e-01   +4.764106151797457e-01   +5.284679987871230e-01   +5.262136142860504e-01   +1.358280635925268e-01   +8.021667961874288e-03   -5.451377838099730e-02   -3.684770609080368e-01   +5.744469193033033e-01   +2.574866350673253e-01; -6.357877045928588e-01   -5.888347050879008e-01   +6.094173843334325e-01   +5.041786076223322e-01   +2.610133013342415e-01   -5.344975714189248e-02   +2.332589010688753e-01   -3.937235280710680e-01   -3.626007407179057e-01   +3.306259349247638e-01   -4.701415331003618e-01   -3.195796904494846e-01   +2.620439235748775e-01   -1.554611311265000e-01   +5.252597552231809e-01   -1.717301466677917e-01; +2.825922708571331e-01   -6.239812044368378e-01   -2.645937770948174e-02   +1.376359245727410e-01   -1.536376760422033e-01   -6.323329871877122e-02   +1.124069896089687e-01   -5.683065953389885e-02   +3.423965268149906e-01   +1.533463255083908e-01   +1.874615712422028e-02   +2.441341062188847e-01   +4.432851165523590e-02   -2.403252519557327e-02   -5.483389659235068e-01   +2.385616782013652e-01; +9.271555943648412e-02   +1.009715994240943e-01   -4.192159258105634e-01   +1.484534290606247e-01   -7.096810908865726e-01   +2.827620735276971e-01   -2.312884974588020e-01   -5.668245076919778e-01   +4.942137864661503e-01   +7.379529525017134e-01   +2.534507406604291e-02   -5.420730311343157e-01   +1.758951403450751e-01   +4.188106296049455e-01   +6.612221688406451e-01   -4.093468258420268e-01; -6.209915238507048e-01   +5.022733946717830e-01   -6.333722082126467e-01   +6.036423987336090e-02   -2.366016623402372e-02   -2.772819124187437e-01   -1.414329952455624e-01   -2.503760882222513e-01   +2.870394814523711e-01   -1.543525969380973e-01   +4.225087184974246e-01   +3.659705562450339e-01   +4.437564088948430e-01   +7.508643850268992e-01   -5.305217587013689e-02   +4.272098462502503e-01; -2.631241052862076e-01   -3.691452834661278e-02   -2.483650812996324e-01   -3.399143971141789e-01   -5.057471061501440e-01   -4.106648665836595e-01   -4.838597525665766e-01   +2.470963441783727e-01   -1.175111975147656e-01   -9.073974392605436e-02   +6.641070620711105e-02   -5.893402178432259e-01   +1.640049059374659e-02   +9.875559608621762e-02   +4.452019687791128e-01   -1.423714900194661e-01; +2.936549752487745e-01   +2.057381686667620e-01   +4.331562448276395e-01   -2.893806733223339e-01   -1.026265331142857e-01   +7.674640492740069e-01   +2.532895560726838e-01   -3.561489631080069e-01   -3.249989841173332e-01   +1.838991959030586e-01   -6.885048432031428e-02   -3.518626631112561e-01   +3.879258375426516e-01   -1.628541713009881e-01   +1.976459186919659e-01   +1.108476179497750e-01; -2.373877140278746e-01   +6.649076450360542e-01   +1.000000000000000e+00   -1.616046714593494e-01   -3.407945956177337e-01   +2.611230026621563e-01   -1.632199077244938e-01   -1.545990540227012e-01   +2.842640789072090e-01   +5.697758331114462e-02   -2.652597452055888e-01   -2.554446143716767e-01   -1.360829063735603e-01   -2.712282569775687e-02   +9.607446747179510e-02   -1.033619211639360e-01; +2.598610042826324e-01   +6.058164844867262e-01   -3.556939937352684e-01   -5.561137762918300e-01   -4.093410524206243e-01   -4.437100539981868e-01   +1.455194426406176e-02   +2.084122057660207e-02   +3.984137305346261e-01   +9.654220274276432e-02   -6.046923975832630e-01   -5.582582588724279e-01   +4.604426281776135e-01   -5.286131813772221e-01   -4.588375653304796e-04   +3.707612803676979e-01; +3.693647714195005e-01   -3.786270703512290e-01   +1.995221859158731e-01   -1.539567502302382e-02   +1.720948308851775e-01   -1.089748389781122e-01   -4.327434491866183e-01   +3.826884867023408e-01   -3.438179784493867e-01   -3.399462273624307e-01   -5.011021000363383e-01   -2.122122522205883e-01   +1.034092846894506e-01   +6.327029949989793e-01   -1.055132919054572e-01   +1.939016133369119e-01];
L1E_L1I_iGABA_netcon = [+2.978789367187915e-01   -5.536073411549629e-01   +2.185356054061528e-01   +2.407048809612531e-01   +6.539587278595855e-01   -1.639025375114146e-01   +7.606306110195231e-02   -9.128780590244595e-02   +5.236016457890745e-01   -1.498242087777577e-01   +5.558360118503676e-01   -5.508539154339238e-01   +1.659041623216043e-01   -5.814362343012765e-02   -6.445964595715000e-01   -5.120575028864684e-03; -3.522684835879429e-01   +1.906771867493129e-01   -4.911844599072520e-01   +6.313585724945878e-01   -5.237229892489529e-02   -1.068729427480234e-01   -5.200872372651727e-01   -5.367580350442913e-01   +1.000000000000000e+00   -1.959783927576118e-01   +3.986079363100986e-01   +3.399868345602698e-02   -2.472509401042022e-03   -9.759088258814426e-02   -6.113543261944385e-02   +5.350853485710519e-01; -6.563171010545810e-01   -1.469089322794274e-01   +5.128175088999812e-01   -3.795602830630326e-01   +4.135250893649032e-01   -5.035476084382157e-01   +1.009725597471480e-02   +5.249966546712225e-01   +1.155650082964923e-01   +4.858719968704008e-01   +3.543967779595438e-01   -3.288843564197214e-01   +3.945177649949885e-01   +1.848731041936360e-01   -1.504200390414725e-01   +6.190297084398205e-02; +4.149217896602445e-02   -2.462958783227396e-01   -4.561406299466861e-01   +5.492588792784771e-01   +8.645218915176853e-04   -6.649111416119350e-01   +3.510351847496131e-01   +2.538507484592221e-01   +2.061068722330126e-01   -9.423768978360655e-03   +6.302471751167318e-01   -7.336052488827322e-01   +2.418507886712385e-01   -4.860471174611045e-01   -2.114196481379689e-01   -4.635696151933440e-01; +1.670490836943366e-01   +1.743811727935914e-01   +4.193035585336614e-02   +3.962661609321688e-01   +3.702685882513480e-01   -5.465980991529255e-01   -3.815273703406428e-01   +8.828775607965560e-02   +1.400960509994598e-02   -6.692327249098162e-02   +3.628078472989285e-01   -2.680979144370613e-01   +7.859128050384349e-03   +5.435674468406527e-01   +5.771590048305318e-01   -4.839183173005835e-01; -6.716901089280855e-03   -1.128071541952491e-01   -4.193243394242801e-01   +6.077795444190817e-01   -1.141885609221767e-01   +4.009391466148531e-01   -6.832005079781338e-01   +3.026220550256390e-01   +2.207463604605714e-01   -1.832087685797758e-01   -2.437731636288422e-01   +1.460009325291990e-01   +6.801749748166416e-02   +5.401739412425967e-01   -9.652435267208059e-02   +1.834805661875356e-01; -8.213848089204694e-02   +5.809498971238698e-01   -5.705085990523296e-01   +5.685458106059611e-01   +6.338496179038674e-01   +4.685321035451551e-01   -3.754124386239927e-02   -3.122880314740102e-01   -2.672403827904399e-01   +7.547132223952303e-02   -5.213025852369557e-01   +5.210317609115281e-02   +3.686496090807407e-01   +3.994758446492154e-01   +6.089722378109619e-01   +3.150552000326697e-01; +7.899944544970415e-01   +2.192792211126854e-02   +4.856358154271310e-01   +4.774855785133255e-01   +5.524033198729145e-02   +3.154052223167835e-01   -6.276748165648750e-01   -1.718594039906829e-01   -1.004305435223914e-01   +1.814956148435538e-01   +2.752568830228714e-01   -5.689712336742073e-03   +3.356470639267262e-01   +4.256807741850592e-02   +1.056428536978377e-01   -5.389909496611535e-01; -9.044429516873607e-02   -5.684736853659789e-02   -2.755032382912692e-01   +4.217774841971090e-01   +1.286427237751002e-01   -2.188614566880715e-01   +3.223050324759341e-01   +3.486939272727614e-01   -1.033774295409076e-01   +1.534185957313327e-01   -4.764373720294551e-01   +1.009100539288653e-01   +5.100570191717235e-01   -1.093509366381844e-01   +6.934019891164154e-01   -3.235141936248966e-01; -7.513219083896481e-01   +2.261279882341243e-01   -4.316548729241344e-01   +4.121104256051704e-01   -1.297185968909702e-01   +3.860705605689271e-01   -3.333342066609066e-01   -6.559540147276028e-01   -1.762909140638216e-01   -6.492663971988733e-03   -2.536563822240310e-01   -3.987035970162984e-01   +5.357410081091123e-01   +3.327578757737202e-01   -7.057544574884317e-01   +1.878684940666192e-01; +3.114218160346335e-01   +2.132605963951619e-02   +3.965440001403914e-02   +2.672510224609086e-02   -8.366115537560846e-02   +4.363514507557150e-01   -5.692821289121146e-01   +1.942081614579829e-01   -1.665795410646372e-01   -6.195982575907067e-01   +3.982786685789948e-02   +1.756080752059431e-01   +1.886924187094688e-01   -2.427600768427261e-01   +2.119067777896309e-01   -1.167600128031724e-01; +4.075875192966130e-01   -4.898984922979015e-01   -2.271774623576817e-01   +1.916940565262147e-01   +1.274582023249618e-01   +3.969435663007245e-01   +2.934358554047810e-01   -1.674256955722049e-01   -2.132172822509696e-02   -2.488681860369534e-01   +9.848111365035009e-02   -4.787953950949050e-01   +2.338680006891309e-01   -3.362531590583048e-01   -1.396654780247111e-01   -2.166375036067441e-01; -4.674164184435021e-01   -4.980974713409770e-01   +9.645707192117171e-03   -4.776961605925756e-02   -1.523224190183051e-01   -2.582617953636522e-02   -1.352688683035733e-01   -3.971183059062731e-01   +2.145424684850610e-02   -2.968584987720457e-01   +5.952964912895613e-02   +2.232713667514123e-01   -3.398299810863630e-01   +2.974954171115528e-01   +2.316847892950069e-01   -7.862785481609003e-02; +1.927049822020854e-01   -5.683990973857330e-02   -5.415347430825563e-01   -4.094968805775825e-01   +4.958625920069762e-01   -4.024182770221560e-01   +4.288056854232679e-01   -7.585425365207045e-02   -3.034087377204335e-01   +7.168908410701556e-02   -1.220168758851935e-01   +1.525817026528809e-01   -1.672377056174186e-01   -5.358994839680589e-01   +2.521978913148564e-01   +4.909052256686412e-02; +3.727910772763255e-01   -1.319291744682563e-01   -6.986626604043663e-01   +6.824054183965308e-02   +3.606483070778881e-01   -3.112853307902030e-01   +4.986244270432981e-01   -2.851114430939456e-02   +3.019285524803339e-01   +2.631920397278948e-01   +6.108138992673678e-01   -5.231134527371874e-02   -5.148743457908558e-01   -4.780879533827834e-01   +3.937683947764401e-01   +5.547496754875590e-01; -3.372051957719042e-01   -4.449677821187709e-02   -3.183284470805654e-01   -5.414850315375656e-01   +2.272560414124684e-01   +4.026272554284500e-02   +3.061818525112774e-01   +1.284316013952925e-01   -3.322390893777817e-01   +2.155298317212102e-02   +2.742829726382933e-01   -3.112578868243213e-01   -6.271225162041771e-02   -2.544242059590053e-01   -5.602989747363704e-01   -4.547712618441119e-01];
L2I_L1I_iGABA_netcon = [-6.236429725868434e-02   -7.121715430926391e-01   +4.295154223996359e-01   -2.209656120711267e-01   +6.431514185147499e-02   +1.872117944972318e-01   +1.605653885384378e-01   +6.674892194967434e-01; +7.901537630043880e-02   +1.106766061652439e-01   -1.401648346624071e-01   -8.477328795607920e-01   -2.526189820707559e-02   +2.944766333646058e-01   +8.128111111044432e-02   +1.909961278986044e-01; +8.441534112656774e-01   +1.839998480103954e-02   -1.000000000000000e+00   +2.457443075680854e-01   -9.581888535210713e-03   -4.093117782454338e-02   -2.533729271323106e-01   -1.575317736240172e-01; +1.917810003926766e-02   +1.660433283778514e-01   -4.711957943014645e-01   +1.997273573145922e-01   -7.102533949975748e-01   -4.016996939923244e-01   +2.246928156563913e-01   +1.763982567731588e-01; -3.135429719648083e-01   -3.606087256502666e-01   +4.158847857873647e-03   -7.797195041873571e-01   +2.757311660153322e-01   +2.826552661237903e-01   -4.611599589878281e-02   -5.511452394395332e-01; -2.429310910747428e-01   -2.403353993866700e-01   +1.292976761125846e-01   -7.022345267123306e-01   -1.194638872768934e-01   -2.123109881766582e-01   +5.129352668369783e-02   +5.311768803705397e-01; +3.812985876340204e-01   -1.987226537767111e-01   -6.210320008787421e-01   +3.383279858026498e-01   +4.345806924509459e-01   -4.222304338906292e-01   +9.914758672940615e-01   -7.237514597336568e-01; -1.194892888979375e-01   -2.117817670481016e-01   +2.519964893248702e-01   -9.892795554954278e-01   +6.391077480953167e-01   +4.378854683883715e-01   +5.478831702235015e-01   -8.595361170105528e-01; -3.733498607381560e-01   +7.761289527794733e-02   +1.361846134032280e-02   +7.810700333201094e-01   -7.634001046814766e-01   +3.752938363786257e-01   +2.112500615639901e-02   -1.288018301617533e-01; -5.005359506768086e-01   +9.621677037309147e-02   -4.042883215249168e-02   -1.123304285020136e-01   +4.017899079941176e-01   -4.530185307936948e-01   +1.800334765356759e-01   +7.995342442219466e-01; -2.050038121121527e-01   -2.608022752084047e-01   +6.035103610999676e-01   -5.765953395350553e-01   -7.979889398302223e-01   +1.162239116929089e-01   -3.884993696855827e-01   +3.584621266001398e-01; +7.527358715697131e-02   +5.352384480628312e-01   -2.525676332782089e-01   -1.809171006878519e-01   +4.241535809146473e-01   -2.015156987374045e-01   -4.266895748644874e-01   +2.225717631957728e-01; +9.010196996008456e-01   +3.098579147536116e-01   -7.514991797331650e-01   -4.551434141477525e-01   -1.131273647178718e-01   -2.137074082597513e-01   -9.373451812445855e-01   +1.452815646954556e-01; -5.186734428341846e-01   -3.568414144083625e-01   +5.093540466742117e-01   +2.472047978284531e-01   +8.847938928213857e-02   +1.486413715385691e-01   +3.881757479377710e-01   +6.122441583920732e-01; +8.056721756084125e-01   -7.525552456613500e-01   -1.398435069795745e-01   -7.315415153746040e-01   +1.419893639081587e-01   +3.085612142334639e-01   -1.120034896946987e-01   +1.402808267792035e-01; +2.249586319791126e-01   -5.385883700597365e-01   -8.127106361459184e-03   -4.070660516148559e-01   +5.496020382111205e-02   +3.269992522974564e-01   +1.161889156472626e-01   +4.762936913342054e-01];
L1I_L2I_iGABA_netcon = [-1.000000000000000e+00   +6.975835135279597e-01   -4.215636886713049e-01   +1.001684196323359e-01   -5.033830970238046e-01   -6.749447351869875e-01   +4.667033278653892e-01   -1.123066110451777e-01   -4.130184183555906e-01   +4.991968007404209e-01   -1.193606036099000e-01   +7.193612192911138e-02   +1.915538540357566e-01   -4.321621160118913e-02   +8.962751795412123e-02   -1.580447646908853e-01; -4.565050264963601e-01   +4.589500988685714e-01   -2.463951303736861e-01   -3.780379158620651e-01   +4.101271109059667e-01   +2.839881802632103e-01   -6.223842545830062e-01   -7.357748426224408e-01   -4.346948876240163e-01   -4.811722018532016e-01   +1.571937079335302e-01   +7.123366106379559e-01   +2.984921583343518e-01   -7.515444902589924e-01   -4.031664517022652e-01   +5.199247890086860e-01; -8.744332738330338e-02   -2.857288328362362e-01   -2.512626837244402e-01   +7.212349301024946e-02   -4.586868702673900e-01   -2.696867629764392e-01   +6.954442915841805e-01   +4.177959528660134e-02   +4.232576275986792e-01   -4.031433164898952e-01   -7.031970551815553e-01   +1.986094790702353e-01   -1.835862499800944e-01   -1.674065831166017e-01   +2.645947913832151e-01   +9.390870216201875e-01; +1.824311931298541e-01   -7.914789971952724e-01   +8.014113683399342e-02   -1.302374270449767e-01   +4.975089449656902e-02   -2.192297143027022e-01   -3.778819438584810e-01   +1.213679026908250e-01   -3.194098927348566e-01   +5.428825575555568e-01   +3.750703464215974e-01   +3.964794621402775e-01   -4.182824951797870e-01   -1.233714049432015e-01   -6.689761023450855e-01   +1.921529556590135e-02; -4.990172282563995e-01   +6.049397636951576e-01   +5.553628380685179e-02   -5.517612036577992e-02   +1.884782726495033e-01   -7.398330966983062e-01   +4.702497663025414e-01   -9.022922872813093e-01   -1.762527302505664e-01   -3.902653216041414e-02   +1.258391668910576e-01   +1.487190837871790e-01   +7.438800120324491e-01   -4.573247286295289e-01   -8.388932590617990e-01   +4.891323242475503e-01; -4.607572734745344e-01   +2.818535532152333e-01   +4.590457188354235e-01   -1.637390507170413e-01   +6.948891140187632e-02   -3.081230474647088e-01   +6.998959175153007e-01   -1.497841457350384e-01   +4.916630844267041e-01   +4.193608805323868e-01   +1.582811707652575e-02   +2.874260873523006e-02   -6.720590334850948e-01   -2.486996003038765e-01   -6.458842100314908e-01   +5.532843536835277e-01; +7.307738158833359e-01   -9.771354331906466e-01   -7.997046584447801e-01   +2.257023275646155e-02   -5.412143410725793e-02   +1.381907466854258e-02   -4.527811610659974e-01   -2.593623563857758e-01   -6.051868992870658e-01   -3.026879030811331e-01   -5.154048709687064e-01   +8.439163182056302e-02   +6.747011675825129e-01   -1.756768436926539e-02   -2.279092132107994e-01   -9.387839362767081e-02; +1.026723173674121e-01   +7.061697146303861e-02   +5.819939061492190e-01   -3.187542575190806e-01   +1.162149865612000e-01   -4.541212485457181e-01   +3.162511838677005e-01   -3.059192881305758e-01   +5.029224635570150e-01   -5.062237427710943e-01   -1.852534184789845e-01   -7.031000668703878e-02   -3.025335348457214e-02   -4.274053849032447e-01   +9.658009954102342e-01   +5.797278299858024e-01];
L2E_L1E_iAMPA_netcon = [-4.589704863521659e-01   +2.126516699989470e-01   -5.793146590026234e-01   +5.192591166469369e-01   +5.967545890281940e-01   +3.479072146183936e-01   +2.485032688381497e-01   -7.049649490649071e-01; -7.938237997638378e-01   +3.974495225514052e-02   -9.361807287109178e-01   +1.405797403341642e-01   -6.978988626915640e-01   -4.148765001489835e-03   -1.185936974218859e-01   +3.070635153404494e-01; +4.508004034624041e-01   +1.460387531903321e-01   -9.999907800097734e-01   +2.988551968338560e-01   +4.089303823595656e-01   +1.969959341183531e-01   -3.203428224980029e-02   -7.237090334895729e-01; +2.897040522993410e-01   -1.655051495437525e-01   -5.490087616686341e-01   -8.642580372963087e-01   -3.034649120954854e-01   +2.488442394292263e-01   +3.615423981409012e-01   +4.692956304421171e-01; -8.915504013234876e-03   -2.050148342698047e-01   +4.075629556666542e-01   +4.878970820142463e-01   -8.231108928801169e-02   -2.205319003917751e-01   +3.388278207764533e-02   +7.176218817957195e-01; -6.728120509129838e-01   +2.139664540385136e-01   -8.408176595848910e-02   +2.504243160109177e-01   -1.191871083521084e-02   -3.407479859413347e-01   -4.979145779511417e-01   -4.748772651576273e-01; +2.078019973830659e-01   +7.067840189886067e-01   -5.542514359011064e-01   -1.184470010606509e-01   -8.166570118497529e-01   -5.690892425988854e-01   +8.367161966099133e-01   +3.919022196527154e-01; -3.202820686589425e-02   -2.468874510930112e-01   -1.700368151950641e-01   +3.672464651585508e-01   -1.663888188802484e-02   -2.529665002724341e-01   +7.406690462522791e-01   +4.699980515308697e-01; -8.242808447189733e-01   +3.905344895091342e-02   -4.713942584232902e-01   +1.598532076913717e-01   -7.088418778298420e-01   -3.038299903377103e-01   +6.143772034677526e-02   +9.411589683792151e-01; -6.084707591044500e-01   -4.766719300263420e-02   -3.264135872665423e-01   -2.897883441360628e-01   -3.602928078686484e-01   +2.307692766075203e-02   +1.825829641679535e-01   -6.444177466420794e-01; +4.433727123334432e-01   +2.348003377844069e-01   +2.205756279502746e-02   +6.580432882622517e-01   +4.635181829562689e-01   +2.508936553309818e-01   +1.433237854311727e-01   -5.506458900401560e-01; +4.686082943351656e-01   +5.736364469798237e-01   -6.740462324565488e-03   +3.752739837773498e-02   -4.112825561214381e-02   +2.733333807364949e-01   -5.609566165911429e-01   -9.805016665690949e-01; -6.122746793069791e-01   -6.316324629025824e-02   +9.390461426689538e-02   -7.988452047097576e-01   -2.956539649015799e-01   -3.701084965568532e-01   -5.630779003962370e-01   -4.371433956795691e-01; +1.029013093445779e-01   +1.949189961831259e-01   +5.159096360533691e-01   -2.851426700983650e-01   +3.631530002016442e-01   -6.803568789389487e-01   +1.794445370141556e-01   +4.159762742994552e-01; -2.744986407282901e-01   -7.664150617298373e-01   -2.368539291984736e-01   +5.006733252291664e-01   +5.070562179395953e-01   +2.920629843142728e-01   -2.561538736202614e-01   +2.279413552751823e-01; +5.601790096985959e-02   -7.517858267622403e-01   -8.357113594558058e-02   +8.592931389421616e-01   -5.426363859934791e-01   +3.585152921341324e-01   -7.256605355478111e-01   +9.847586098962835e-02];
L1E_L2E_iAMPA_netcon = [+8.392757665960707e-01   +2.855344594530549e-01   +7.022880089564434e-01   -4.372316730115570e-01   +4.474665592503672e-01   -3.383244354842422e-01   +6.724359567533295e-02   -9.562381496681494e-01   +3.062479198314692e-01   -3.854170572399048e-01   -2.693629383813668e-01   +9.410171996974420e-01   +7.197396706040706e-01   -8.362801756596874e-01   -2.290727360238221e-02   +4.120883302225843e-01; +1.322090206573127e-01   +5.535587582758199e-01   +1.045109503883640e-01   -8.833758924356703e-01   +9.141085388866829e-02   +9.325361373988131e-02   -3.420729771480464e-01   +3.705349684598753e-01   +4.809290926108484e-01   -8.137913511683481e-02   +2.833080761875849e-01   +1.676587450712508e-01   -2.193528600126594e-02   +3.097307587036114e-01   -9.932934872122101e-02   +1.851379173796382e-01; +2.838257908023152e-01   -6.544135180594620e-01   +9.347775684074557e-01   +5.651801142037679e-01   -3.272918832222876e-01   +1.050781207260689e-01   +1.108433817829007e-01   -5.400766473536553e-01   -5.266272028762468e-01   -4.223824806182995e-01   -8.252182432069234e-01   -1.810255838961302e-01   +2.663778922654562e-01   -9.587317343677569e-01   -4.001302374518534e-01   +2.929829231313587e-01; +1.409231243258308e-02   -1.340233796654762e-01   +3.865978715877944e-02   -5.039754671733517e-01   +4.253035539672779e-01   -4.664790691391020e-01   +2.353403133331880e-02   -3.136765845930172e-01   -4.986365915080518e-02   +4.769765626905517e-01   +5.319476378514615e-02   -2.139184944282853e-01   -4.511556230200708e-01   -7.566449773372302e-02   -1.297594819126559e-01   +2.851271078896421e-01; -1.882779436999662e-01   -3.159729774994864e-01   -4.848248935252949e-01   -4.179621230232245e-01   +1.010355840339376e-01   +6.634991482282210e-02   +5.448705278364625e-01   +5.705958166318194e-01   +5.047609224027627e-01   +2.510683485540109e-01   -3.572693580803382e-01   +3.230492505089272e-01   +5.483903373318374e-01   +6.613831196986967e-01   +3.094106921655330e-01   +4.266659248045760e-01; -2.212423755498429e-01   -4.524888840705733e-01   -2.662905942759713e-01   -4.252491150479165e-02   +8.549425477121289e-02   -2.130441482927950e-01   +3.235177442153493e-01   -1.948921487538690e-01   -2.445532164449148e-01   -2.382775350954363e-01   -3.866084380143658e-01   -4.548934398414360e-01   +1.814370806802125e-01   -9.082650225200560e-01   +1.173183982603903e-01   +2.404956184093974e-01; +5.939818602747088e-01   -5.392787232939004e-01   +8.500318844980760e-01   -1.152213860020168e-02   +5.576864970624165e-02   +6.450417099715627e-01   -1.581777550317419e-01   -1.080831321248070e-01   +3.198225131186575e-01   +1.069869571465784e-01   -5.410850421638627e-01   -2.618576094605743e-01   +6.738286040837606e-01   -4.458475757871438e-02   +9.084986738377088e-02   +8.611255382111302e-01; -6.559580274015292e-01   +4.801137485236190e-02   -8.196144326816761e-01   +7.049597942024606e-01   -4.251930742799815e-01   +1.071391976153478e-01   +3.897061374650069e-01   -1.821429689626569e-02   +8.703189846829304e-02   +5.777047583541520e-01   +1.827035367445784e-02   +7.391388955711320e-02   -1.615446842286176e-01   -1.655687672462157e-01   +1.784330980227932e-01   -7.277486551238654e-02];
L2I_L2E_iAMPA_netcon = [+5.501766102162774e-01   +5.604422187302903e-01   -2.290496435660092e-01   -4.465611377992063e-02   +1.155659653733798e-01   -3.358656573867950e-01   +4.900422728849531e-03   -4.728284116458014e-01; -5.163116568556977e-01   +1.837551333726650e-01   +1.795280867050283e-01   -7.313610366549269e-01   +6.251064215299791e-01   +3.826083447476797e-01   +1.531384163795133e-01   -6.584337268963651e-01; +4.095800648655355e-03   +5.501213502375439e-01   +3.318999690699540e-01   -1.233957128148187e-01   -2.622507309860337e-02   -2.506880557818008e-01   -2.170372522651458e-01   +1.663600921897937e-03; -9.522680938002014e-02   +5.470468844757074e-01   +5.823284074190888e-01   +2.224067723773966e-01   +2.771635641145506e-01   -8.182262644372416e-01   +4.942080846744020e-01   -1.845433707318026e-01; -3.426434852640171e-01   -8.294828979193293e-02   +1.563129403977108e-01   +2.289543137659736e-01   -2.254753360439709e-01   -1.479253281201040e-01   -1.129770564097007e-02   -2.923909860054633e-01; +3.707849324399755e-01   -1.304172772960661e-01   +5.620767703554986e-01   +4.876677325765180e-01   -2.548616329818599e-01   -2.995306355779774e-01   -1.956306781250814e-01   +8.217083127956825e-01; +3.010437234313394e-01   +1.525591865383570e-01   -5.082693121848804e-01   -5.711419807333608e-01   -2.685218086513058e-02   +3.284997923759986e-01   -1.483000677254330e-01   -5.629750093591284e-02; +3.691355793459810e-02   -6.736915582357544e-01   +3.437403955401279e-03   +4.228825815385848e-01   +1.000000000000000e+00   -2.343172641578269e-01   -1.128323185458038e-01   -5.018775813264735e-01];
L2E_L2I_iGABA_netcon = [-2.604361062658470e-01   +2.826044350876966e-01   -1.276601854189275e-01   -2.906722402612752e-01   -2.330946533534468e-01   +4.009588771549777e-01   +1.323436599658595e-01   +4.906971383874498e-02; -3.298940580921212e-01   +2.490474957278457e-01   -8.731694065992383e-02   -4.507926617938068e-01   +3.314506989487718e-01   +1.000000000000000e+00   +2.632136692161979e-01   +6.563520259286878e-01; -6.451986466528314e-01   -8.490260000672607e-03   -1.492422946751315e-01   -5.856367726467755e-01   -3.081459548996728e-01   -7.750825077163735e-01   +1.764061624154163e-01   +5.331356427850488e-01; +1.468054479499053e-01   -3.004064899508886e-01   -4.272495897153210e-01   -2.025943325724610e-01   -2.205753331233848e-01   -5.458080671330509e-01   +3.802496691769312e-01   +5.905415476317573e-01; +4.695444730829464e-01   +1.374098430823313e-01   -1.448198112700457e-01   -2.477756084093096e-01   -1.581152782328956e-01   +3.087519138502324e-01   +1.813490881455337e-01   -5.385678810541908e-01; -4.310497678562362e-01   +2.972080919655622e-01   +3.186862709969155e-01   +3.357793315432188e-01   -6.148338004845505e-01   +5.945124118405232e-01   -4.117071821677457e-03   -1.555223819707710e-01; +2.437664306969780e-01   -5.099396350089699e-01   +2.624152067542805e-01   +6.804467468663959e-01   -2.298796710890509e-01   -3.890528883057632e-02   -1.056940524437009e-01   -3.954979776431137e-01; -3.763355204898676e-01   +2.732395075265119e-01   +3.688566301584542e-01   -2.818684741096864e-01   +7.286890495213437e-02   -2.638603862490736e-01   +4.508145726894686e-01   +3.883725464498620e-01];
L3E_L2E_iAMPA_netcon = [-6.226968884019237e-01   +9.267275201270930e-01   -3.799084789059884e-01   +5.998107676044271e-01   -4.474189090490907e-01   +7.802751742855819e-01   -1.291876243710128e-01   -2.636689963419676e-01   -2.318012455225539e-01   -7.661033867446050e-01   +4.420527896651476e-01   +8.379201956843121e-01; +8.479794765136577e-01   +6.011197087913510e-01   -1.513807514846141e-01   +9.587077288345447e-02   -9.173057006969401e-02   +1.537362299225932e-01   +2.518828032400158e-01   -7.592908726777186e-01   -5.465529889217988e-03   +5.975704525608485e-01   +1.604471377627786e-01   -4.145128052035976e-01; -2.595757091615297e-01   -5.406090777572754e-01   +7.929450658328032e-01   -4.898656893521275e-01   +1.506470845733168e-01   -2.584724219612316e-02   +3.987223568733548e-01   -6.899828616132984e-01   -3.426194922014993e-01   +3.995873658728504e-01   +3.679224032164225e-01   +5.071948725580306e-01; -1.719845762163211e-02   -5.119895018371639e-01   +2.924158621598740e-01   +7.912334660668849e-01   -1.890201547528062e-01   +4.882809444205433e-01   -1.345474763206357e-01   -7.852129266210566e-01   -2.114067175794473e-01   +2.967049480146042e-01   -4.217242085023833e-01   -2.603193775570263e-01; -3.603533465513539e-01   -1.326234394121248e-01   -2.964313361733525e-01   -3.700110764403525e-01   +2.931202523096033e-03   -3.037650307177044e-01   +1.210767599818144e-02   -1.640691775094872e-01   -3.282581035330930e-01   -2.860580326451210e-01   -6.011593635750981e-01   +3.998719601985914e-02; +2.895465518500177e-01   +4.662592666090095e-01   -3.190097694618432e-02   +8.361560484375241e-01   +2.828888443232114e-01   +4.798237726636310e-01   +1.050232395828830e-01   +2.100564791850643e-02   -1.204069819069532e-01   +9.048745512109647e-01   +4.153763220419865e-01   -4.941596985248386e-01; +1.010311843098863e-01   +5.993846557815767e-01   -3.583986379689216e-01   -3.791433917527438e-01   -2.114541493075734e-01   -1.175257373630234e-01   -2.335689271366734e-01   +2.085151169944365e-02   +2.884292295982303e-01   -9.459990658262657e-02   +4.303887620536884e-02   -1.386270691328653e-01; -5.867511673656638e-01   +3.198793638163854e-01   -5.028586463440854e-02   +2.362371292448462e-01   -5.165312121469310e-01   +4.924131297674166e-01   -8.430519702376693e-02   +4.331241118447663e-01   +4.522164282168012e-02   -8.407820200842087e-01   -2.328973024855338e-01   +3.457510735268694e-02];
L3I_L2I_iGABA_netcon = [+8.911696659803516e-01   +2.500712141022835e-02   -1.401156609951604e-02   -5.398763631001533e-01   -1.323330538052702e-01   -3.245418524067167e-01   -1.035702746925114e-01   +1.577756250206464e-01   +5.273029920260598e-01   +3.678890655150372e-01   -1.925499697619093e-01   +6.032550961305938e-02; +2.616596905591822e-02   -3.997223393449755e-02   -6.886099582692899e-01   +2.470537489395449e-01   +5.883512193769156e-01   +9.032771644290113e-01   -4.458297054585924e-01   +6.493179508430663e-02   -5.148016135806149e-02   -1.400452353487770e-01   +7.004623417141081e-01   +2.760162458853080e-01; +2.743761945052759e-02   +1.660844744608340e-01   -8.571492135350850e-03   +1.032555271236163e-01   -1.385327256003308e-01   -3.292520666310519e-01   +3.246143365360478e-01   -6.738668124906740e-01   -7.794679353998003e-02   +2.708891437225870e-01   +4.538841675062852e-02   +4.905365915531737e-01; -3.213408370358940e-01   +2.349877462887240e-02   +7.017111627056841e-01   -7.099120477327613e-02   -1.660432285393213e-01   -1.342014525427728e-01   -3.675078057454091e-01   +4.896394372692517e-01   +4.966780894079834e-01   -9.415258716464517e-01   +2.245356817543363e-01   +3.358241231742772e-01; +6.719068778453811e-01   -3.319521011212905e-02   +4.273621285393760e-01   +4.707339774619875e-01   -4.966691619458114e-01   +1.000000000000000e+00   -2.348754865399496e-01   +2.075673228593910e-02   +4.555970690234705e-01   +9.113976865790554e-01   +6.958724890765842e-02   +9.696266688644119e-02; +8.243995269116656e-01   +6.149356629154258e-01   +5.688495985417223e-01   +3.646064012486893e-01   +5.967073935244473e-01   +6.117308045103454e-02   -5.570938135910083e-02   +1.524466261162045e-01   -5.064547834396789e-01   +2.918416193750459e-02   +3.774867779082307e-01   +5.134072629694367e-01; -5.154719579709175e-01   -1.617421487457995e-01   -3.065452179465008e-01   +9.150694758948601e-02   +4.288481751877596e-01   +1.189518952409302e-01   -4.798423706425257e-02   -4.018851382486999e-02   -1.823850184680829e-01   -2.789317885700691e-01   +2.293536778671314e-01   -6.589611618231487e-01; +2.459227975245093e-01   -9.253052840187029e-01   +3.493392357870976e-01   -1.036127185990669e-02   +1.228687533933308e-01   +1.536780606467049e-01   -4.992717063056509e-01   -1.552952444503668e-01   -2.609323603338967e-01   -2.001960228631174e-01   +8.014669148464515e-01   +2.475458117267512e-01];
L2E_L3E_iAMPA_netcon = [-3.051120263124438e-02   +3.482228589213621e-01   +5.542218046514644e-02   -1.738744203383654e-01   +2.384145722478895e-01   +2.433735237086519e-01   +8.950580629919914e-02   +9.637156083231628e-02; +4.768287163811853e-01   -1.111755187544031e-02   +3.476588514640138e-01   +2.953583279560114e-01   +9.180509879699345e-01   +5.216063302772926e-01   -2.191625732775971e-01   +7.396102249923087e-01; +4.614022922217437e-01   +2.481279861725129e-01   -2.338176590708324e-01   +4.697805456389912e-01   -5.890572582037007e-01   -2.640102342280604e-01   -7.089858925076720e-02   +5.122001503503861e-02; -1.596682965120894e-01   -7.877481997287765e-02   -4.651163392396936e-01   -4.963321486263422e-02   -6.662940938363966e-01   +7.577787376673314e-01   -5.852229794701407e-01   +9.087355951326364e-01; -3.267621366894201e-01   -6.016620457101391e-01   -2.301788803476587e-01   -7.105578467870762e-01   +2.558437561215622e-01   -3.507187401273203e-01   +1.917911731040158e-01   -3.316260535906843e-01; +5.187490736787258e-01   +8.957286603964307e-01   +5.487887534191138e-01   +1.907261692986005e-01   +4.639755106124783e-01   -2.626802746630695e-02   -3.250698249985454e-01   +1.414542760946978e-01; -3.914945724957172e-01   -5.248409387316871e-01   +3.020565772787973e-01   -6.564028790411394e-01   -6.449800901528649e-02   -7.642677989979166e-01   +6.725908987360706e-01   -6.809548624594864e-01; +6.704505134585623e-01   -1.176681386028183e-01   -6.879027737128434e-01   +6.439860322927269e-01   -6.278458366614384e-02   +2.568540492200335e-01   -1.046643800977134e-01   -1.633099004054769e-01; +6.804765420128586e-01   -6.579260831924838e-01   -4.495120794661542e-02   -4.370953070187660e-01   -5.841745102587140e-01   -2.533134169270999e-02   +3.769573499650735e-01   +4.348175461942918e-01; +3.230708442639444e-01   +4.700309652604689e-02   +5.342431853159284e-01   -6.785963376314594e-02   -7.245655011649306e-02   -5.076567099228084e-01   +2.135243754408116e-01   -1.000000000000000e+00; +5.708523765154772e-01   -3.372283324608771e-01   -1.182761559671311e-01   -6.774014765935839e-02   -3.849461226870917e-01   -9.264241808870695e-02   +6.155256055984146e-01   +6.663131079494135e-01; +3.752031307627900e-01   +2.734871414428667e-01   +1.664151309900843e-01   -4.091015144437012e-02   -5.231800493343313e-01   +2.118766744192238e-02   -6.980586035491155e-01   +5.288524572578985e-01];
L2I_L3I_iGABA_netcon = [+2.472834179996521e-01   +2.980505256473583e-01   +5.385383123614492e-01   -2.552220787095467e-01   -4.905410624530644e-01   +2.736800826698542e-01   +7.226664664620244e-01   +6.497283148784697e-01; -1.577002239965544e-01   +6.425833765623248e-02   +4.129813780648767e-02   +9.119919302055852e-01   -2.640939450357941e-01   +5.666226258657591e-01   +4.057166968525866e-02   +5.281667253346669e-01; -5.995078150780708e-03   +1.104093386156551e-01   -3.779704986026414e-01   +2.109688909910714e-01   -2.719274269863907e-01   -1.625528373464929e-01   +7.145627882184991e-02   +4.251957011332553e-01; -4.444480748963153e-02   -5.937938040685022e-01   -5.699561755269572e-01   -2.305433322840411e-01   -1.898856858223916e-01   +5.486491378815717e-02   -7.098820122694705e-01   -2.266300889179723e-02; -9.957197985618957e-02   -6.296765698901983e-01   +2.096176918408728e-01   +6.288853344176922e-01   -8.554552877566726e-01   -8.364327064371624e-02   -6.651823902067128e-01   +1.722945066936623e-01; +8.385019480945357e-01   -4.580091228240678e-01   +2.051882688021089e-01   +9.096796331646975e-01   +7.354688373567912e-01   -4.062004754898314e-01   -3.422600344551859e-01   -1.980914551524371e-02; -8.867714642501894e-01   -4.457109645026425e-01   -3.496025482235421e-01   +2.104877576225950e-01   -7.794591551334649e-01   +9.842792706718779e-01   +3.394255330867465e-01   +1.453868502298078e-02; -1.125680029066860e-01   +2.042260392105008e-01   -5.075813842230230e-02   +9.884841944209695e-01   +1.849162938529710e-01   +4.245701354552113e-01   +7.584848765596941e-02   -3.254408434249258e-01; -9.737150406675414e-02   +4.614893519041099e-01   -3.121068196336638e-01   -9.319445082119644e-01   -6.991830243346827e-01   +3.194697815495129e-01   +3.941942261375708e-01   +4.235728315096698e-01; -2.325042331604644e-01   -3.054939994808505e-01   +6.147837897880963e-01   -4.146446249888011e-01   +3.097932191578709e-01   +3.703395870176441e-01   -8.138892491502758e-02   -6.203132046745699e-01; +3.941223966431011e-01   +1.363128330078796e-01   -1.096619598383491e-01   -2.187663892093738e-01   +5.639532337390341e-03   -8.757295335914250e-02   -6.296052815643303e-01   -1.136991671475448e-01; +5.545824032077480e-01   -1.148895155861923e-01   +4.536434836798625e-02   -4.484348241193958e-02   -9.031841984989095e-01   -4.642887028774639e-01   +1.289191121949856e-01   -7.626037798232493e-02];
L3I_L3E_iAMPA_netcon = [-1.982559655128629e-02   -4.512718215336172e-01   -2.738800444540618e-01   +8.798624535512371e-02   +1.217508205312883e-01   -7.510050429895038e-02   -5.881808099889709e-01   +3.218439536186967e-01   +1.000000000000000e+00   +1.687849186713932e-01   +3.959874481189785e-02   +2.792925629820910e-01; -1.397950944157005e-01   +1.344099941550088e-01   +7.356789846787986e-01   -4.336748088402929e-01   +4.231188082001724e-01   -1.153249212795972e-02   +7.742030393162286e-01   +3.128486968862201e-01   -6.422109986446181e-01   -7.552381721072156e-01   +3.504052318321626e-01   -2.647862060924324e-01; +1.797146791371188e-01   +1.300886181351229e-01   +1.569793603472528e-01   -2.626744573390389e-01   -1.735251766901107e-01   +8.295621656782736e-01   -3.556656321553778e-01   +7.341734124143326e-02   +7.337635626686688e-01   +9.325100037835894e-02   +3.172193883360614e-01   -8.363827546168912e-01; +7.359971671630851e-02   -1.880455206350728e-01   -9.098394673857103e-01   +7.143921698050490e-02   -2.287312581216243e-01   -1.720018271968869e-01   -5.479451223914100e-03   +4.156071597890841e-01   -6.861015776723224e-02   -2.922992361918688e-01   +2.431321908690875e-02   +7.769580538031894e-02; -3.356167483579930e-01   +1.852303517445287e-01   +1.551745281305089e-01   +6.154680761647330e-01   -5.457536478481267e-02   +9.943532472691287e-02   -5.082011793623228e-02   -1.657966158910734e-01   +1.542621893227693e-01   +2.992257817885096e-01   -5.550851424723900e-01   -2.568366296146853e-01; -3.259045222422546e-01   +8.170517759486305e-02   -1.720380003514591e-01   -3.817556677698025e-01   -3.908510030204207e-01   +3.313819890586332e-01   -1.989698757746058e-01   +1.786570776860942e-01   +1.130432692248457e-01   +2.717982576951598e-01   -3.021878734330894e-02   -5.726984251307787e-01; +3.062885182624652e-01   -2.340857604439947e-01   -1.293903594550328e-01   +4.461266096503536e-01   -1.732442639300575e-01   +2.764251687917766e-01   -3.714577273346213e-01   +4.691932309038901e-01   +2.614647397853665e-01   +1.996519423919289e-01   +7.730767007373432e-01   +5.520017270334007e-01; +2.873198877955244e-01   -1.352806096134136e-01   -3.250203559302332e-01   -4.298935201492372e-01   +1.405202756354651e-02   -4.984877246786099e-01   +2.124356009332793e-01   +3.692939209730194e-01   +3.850889251923260e-01   +3.207244925883324e-01   +4.355016320378730e-01   -8.117603170371168e-02; -6.150737321784704e-01   +2.694618088376659e-01   -4.135892977045196e-01   -6.066029933627624e-02   -4.901980931041330e-01   -3.737457171835656e-01   -3.299296320125984e-01   -3.795823492122901e-01   +2.720824965549549e-01   -2.318429554518885e-01   +2.131527613352374e-01   -3.747788245910678e-01; +3.670111348811383e-01   -3.973486319021566e-01   +8.860320151387423e-02   +2.797191877584349e-01   -4.320400325073151e-01   +1.530463548798716e-01   -3.276705164501038e-01   +2.120892248248571e-02   +1.660912925208020e-02   +1.728094243581550e-01   -1.933745003328723e-01   +2.547941234832629e-02; -4.471949351127845e-01   -1.387063955984925e-01   +2.757280850414243e-01   -5.235449933175732e-01   -5.931230962948694e-01   +9.454176484233194e-02   +1.745914328251673e-01   -4.889296191611964e-02   +1.760078422635059e-01   -2.116979949623953e-01   +7.223355222018493e-01   -6.059644586867922e-01; -2.473581198750623e-01   -8.823540966773905e-02   +5.572231474764272e-02   -3.743274692586122e-01   -5.097644556260751e-01   +3.096696605205625e-01   -4.519175676635227e-01   -2.975617225973395e-01   +5.604797519199619e-01   -9.976520992574148e-01   +6.580077972563867e-01   -2.790055553729813e-01];
L3E_L3I_iGABA_netcon = [+2.463630562324097e-01   +4.498934687371249e-01   -1.869741123258495e-01   +5.228762440866476e-01   +1.248172438184755e-01   +1.653771781856344e-01   -1.164213477048088e-02   +6.151017010822648e-01   -5.424048541132643e-01   +4.599287747764386e-02   -6.936729690616587e-01   +3.531192515253207e-01; -1.132702142055255e-01   -6.700076677615288e-02   -5.694122625277721e-01   -1.601717038953802e-01   +2.796259407856274e-01   -5.338682582395013e-01   +6.433814003884010e-02   -7.236773857233507e-01   +1.164018340296980e-01   +1.310903179362761e-02   +3.102951320909795e-01   +9.695673941162083e-02; -4.346838500819875e-01   +1.527574460799236e-01   -6.089202132781037e-02   -3.856191926162173e-01   -1.142913091346912e-01   +3.012680324393366e-01   +3.937764901539169e-01   +7.497770033240271e-01   +6.323567870009862e-01   -2.346228600431852e-01   +2.027072579416554e-01   -3.991164697615261e-01; +6.599952773048979e-01   +7.876397641640438e-01   -3.925349436675675e-01   -1.319149206427585e-02   -7.878931222302209e-02   +5.384293485641245e-01   +8.683212186914813e-01   -5.308784228333941e-01   +9.573226043981178e-02   +2.600086877099531e-01   +6.878191557903526e-01   -6.099622421818799e-01; +5.969853970516189e-01   -6.465770558197106e-02   +5.530554133893253e-02   -3.904281858268839e-02   -1.367091693554912e-01   +6.095137153295483e-02   +7.299256695466609e-02   +6.932058126027803e-02   +2.418795314580864e-01   -2.495051003579543e-01   -1.359352272421363e-01   +7.384306165517518e-01; -2.193216108496228e-03   -3.092412071306575e-02   +3.955727831190135e-02   -5.715418596770331e-01   -5.105961707097809e-01   -4.308322591249408e-01   -7.935735358547642e-02   -8.190213678052446e-01   -8.925149454413747e-02   +6.353993773784290e-03   -1.265831631337380e-01   +2.002777022695748e-01; +1.901621711635360e-01   +1.354897261640929e-02   -1.518769107863954e-01   +2.773399663868160e-01   -3.149544091375490e-01   +3.726058111740644e-01   -5.053991758362643e-01   +5.573949912013169e-02   -6.533441740792454e-01   +1.231269638002255e-01   -3.803295070859072e-02   -2.037186796278705e-01; +3.438187121150674e-01   +7.397963930752423e-02   -2.373185722237038e-01   +5.902268546159271e-01   +2.356133536697675e-01   +2.639396858819620e-01   +1.593798100440693e-02   +1.000000000000000e+00   -2.337937433995815e-01   +1.561963223350079e-02   -1.181878602027700e-01   +5.538295786784747e-01; -2.950854977911194e-01   -2.543474889794857e-02   -6.431057014943662e-01   -3.256266876015266e-01   -5.706584737141510e-02   +2.106129748537285e-01   +3.544238740978688e-01   -3.825899787863595e-01   -6.038599458761654e-01   +3.703194550246482e-01   +2.293535271250880e-01   -3.251512866073960e-01; +1.441151113481104e-01   +8.867398246342646e-01   -4.934073799033207e-01   +2.477384860255085e-01   -3.412846496518168e-01   +7.202686790791626e-01   -4.531759402746569e-01   -6.978435202314081e-01   +1.468073452407271e-01   -8.795932166313787e-02   -5.700711677385961e-01   +4.027688525753310e-01; -7.866941621530589e-02   -3.666472103493545e-01   +2.405441873550934e-01   -3.723345798795747e-01   -2.643800797647878e-01   -6.780834212085119e-01   -6.299863762689407e-01   +5.829919832497548e-01   +2.394697801351602e-01   -1.093763196548296e-01   +1.186567568237348e-01   -4.225285881526429e-01; -5.332932801507758e-01   -8.347309144138949e-01   -7.453177151871365e-02   +2.540837943874130e-01   +1.608841236828401e-01   +3.785244261189420e-01   +1.538704497798073e-01   -2.075957901586750e-01   -3.241781515649534e-01   -1.296301339655844e-02   -1.476614392217201e-01   -4.815781398895559e-02];
L2E_Input1_iAMPA_netcon = [-4.552815799214437e-01   +6.465259116175750e-01   -7.300841289386292e-02   +2.492974817530391e-02   -7.438798952430647e-02   -2.601880657157516e-01   -1.269740524282766e-01   +5.819722676584476e-01];
L2I_Input2_iAMPA_netcon = [-7.830869847813791e-01   +4.757132230683779e-01   -2.184292352061897e-01   -7.797635307239916e-01   +1.894162403228750e-02   +1.000000000000000e+00   -1.481875473705498e-01   +7.955089318696360e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.4*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 1.0*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 1.0*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.4*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 1.0*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 1.0*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
