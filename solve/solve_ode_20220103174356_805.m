function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+3.894847388798206e-01   +5.058840645526398e-01   +3.960274085722520e-02   -4.644126685473836e-01   +5.712436249167774e-01   -1.929298869203860e-01   +3.145334323235353e-01   -2.845352945667941e-01   -2.795844665074736e-01   -6.072056060658663e-01   -2.234681147201828e-01   +1.367842807293414e-01   -3.204839123876750e-01   +1.901585754613375e-01   +5.288951294791883e-01   -5.172648808878193e-01; -2.439418096376869e-01   -3.641345531309639e-01   +7.235269091091848e-02   +6.211118690810089e-01   -8.071194249574506e-01   +1.089567889755597e-01   -3.216898401910047e-01   -3.931679499974247e-01   +7.973930599384930e-02   +3.354580181430690e-01   +9.626291709135695e-02   +2.269269022216021e-01   -7.110376915142124e-01   +4.891331134217974e-01   +4.883530903129625e-01   -2.942349182617517e-01; +2.009535413694151e-01   -5.957168128597938e-01   +1.250148620543283e-01   -7.012669632696041e-01   +6.030697601591454e-01   +4.473545198792728e-02   -3.957954364246791e-01   -5.025053397638520e-01   +1.719772131547421e-01   -6.514419140334803e-01   -2.454146415347702e-01   -1.524748627863005e-01   +3.649371433228356e-01   +7.296346420282153e-01   -7.073559133549767e-01   +3.314339940686531e-01; +4.533686624748414e-01   -2.341141416820525e-01   -8.971385533809842e-02   -7.892806949530583e-01   -2.807602364298089e-01   -1.368082833899518e-01   -8.047296718986154e-01   -2.558826543434115e-01   -4.118345634445744e-01   +1.809865404873715e-01   +1.000000000000000e+00   +1.635665690285613e-01   -1.694863549240721e-01   +1.129704976093252e-01   +1.966182359921329e-01   +8.164671129130358e-01; -2.369001895924659e-02   -5.986261273830459e-01   +1.387543559197498e-01   +3.045872720504378e-01   -7.412284598712117e-01   +4.396707197726565e-01   +9.001756141420464e-01   -2.660513635919037e-01   -4.843843095309072e-01   +2.066120743886856e-01   +8.408728516592799e-02   -2.832929538065837e-01   -1.242153920764555e-01   -5.656339741545735e-01   +8.130082458608290e-02   +7.226805949249444e-02; +7.684398246641115e-01   -6.952350845940098e-01   +8.120229001684381e-01   +2.602032609492074e-01   +4.536585924533449e-01   -7.688485631808456e-01   -4.950445719381442e-01   +4.825146162045101e-01   +3.256111506808682e-01   -7.512276846199736e-01   -7.146844342820489e-01   +2.714301124887135e-01   +1.356702768983995e-01   -3.423474966755607e-01   +5.962085672019283e-01   -2.172500855832560e-01; +5.599730272939264e-01   -1.671565031925515e-02   +2.886627912653253e-02   +4.831027821962234e-01   -7.228643953754338e-02   +2.590298569059820e-01   -6.367005621123195e-02   +5.212517290778399e-01   -1.821265803886933e-01   +8.155439324760702e-01   -6.135866514541297e-01   -2.391276515328730e-01   +4.228658203707871e-02   +7.601590238448003e-01   +2.178971095220846e-01   +3.497105965670603e-01; +2.644956243824920e-01   -2.639921208994970e-01   +2.117819541529069e-01   -4.970700092505322e-01   +1.961218139691317e-01   -7.022773829541160e-02   -7.962048866825846e-01   +8.980314915674983e-01   -2.538784660910144e-01   +6.734280279448599e-01   +1.289427723140557e-01   +3.046976695490924e-01   -8.853243411763125e-01   -4.977869825764812e-01   -3.880325827047729e-01   +7.183334242644328e-01; +2.007272969098374e-02   -6.802382921590330e-02   -5.209919498483834e-01   +5.635730604399296e-01   +2.507469381786817e-01   -2.539185988848465e-01   -6.501818354976376e-01   -6.400327522415132e-01   -5.418537585829420e-01   -4.860245069193564e-01   -4.736936727468921e-01   +7.385021531092204e-01   +3.712454160475464e-01   -3.199765285348060e-01   +1.730106339362139e-01   +2.114703558192710e-01; -2.861530896333331e-01   -1.966858414833126e-01   +8.354861207323357e-01   +6.049355206636580e-01   +2.113503480114577e-01   +6.256625978772612e-02   -5.008682916029390e-02   +2.363179622315875e-01   +3.700208326778610e-02   +5.618311995710784e-01   -1.125210942599962e-01   +1.878790086725608e-01   -7.353086235186507e-01   +5.274678143561602e-01   -1.235284687967932e-01   -5.191744793313767e-01; -4.334931486475341e-01   +5.127236603419871e-02   +2.035327751848075e-01   +2.324607395117681e-01   -4.906391227727250e-01   -2.103630592422850e-01   -6.136295628573764e-01   -4.098155137268763e-01   +2.154403944740463e-01   -3.731127298049602e-02   -5.466137739371718e-01   +4.515557487394296e-01   +4.511698106551417e-01   +3.710733386848335e-01   +2.831810445851460e-01   +1.568826640167937e-02; -8.294355335442133e-02   -1.009559583877437e-01   -3.486185805395423e-01   +1.204050019154036e-01   +8.767712400295787e-01   -7.685778301657280e-01   -5.480540811180501e-02   -6.810187043490900e-01   -5.139385023239539e-01   +5.826623349138624e-01   +1.654525531817575e-01   -2.980699408538471e-01   +7.544025918480556e-01   -6.051973224628395e-01   +7.561074452713749e-01   -6.205429772786680e-01; -1.202950546543832e-01   +6.795635676085042e-01   -6.361448934053417e-01   +5.530481466927621e-01   +1.372198414713425e-02   -1.752267772032797e-01   +1.910479505279947e-01   -8.175281259606214e-01   -4.057770416647291e-01   +7.548300958245919e-01   +4.955209403979224e-01   +8.527215542805526e-02   -7.705709900046289e-01   -5.610603785306498e-01   -4.787627450993590e-01   +4.252839090533734e-01; -6.733339754388292e-01   -5.753991779354899e-01   -1.822020535228338e-01   -5.816336205546071e-01   -3.560473003435013e-01   +1.615452952219513e-02   +2.948119004844304e-01   +2.855212623424199e-01   +8.010579302902829e-01   -6.867413052939128e-01   +8.320643653154844e-01   -3.828924604414071e-01   +6.963821888187245e-01   -1.342244870571013e-01   -1.355343793096926e-01   -5.473247665626578e-01; +1.670059471391496e-01   +8.915018991300713e-01   -2.830882012688066e-01   +5.368548344800934e-02   -2.196053199978414e-01   +2.575051360425096e-01   -3.861563802581937e-01   -8.611895160290007e-01   +6.022057891853030e-01   -7.649820368036575e-01   +4.000466521031549e-01   -4.593840627405940e-01   -5.880886350132423e-01   -4.760700503685539e-01   -4.895286289048161e-01   -6.773069476764116e-01; +3.136177240255136e-01   +4.089497446920603e-01   -6.020349939529592e-01   -4.756781311655921e-01   +4.427170395626140e-01   +4.717580068465286e-01   +6.052530893833189e-01   -6.500090557487622e-01   -1.954788924757322e-01   +6.730556345118695e-02   +4.719977883849876e-01   -2.272156766200910e-01   -4.492458185992756e-01   -5.364271017634012e-01   +3.044355400286236e-01   +2.114036802423047e-01];
L1E_L1I_iGABA_netcon = [-1.061551798229871e-01   -5.620244305421980e-01   +6.041213464302573e-01   +1.761601011200768e-01   +6.873323257833628e-01   +1.670563953575314e-01   +4.806566705035966e-01   +5.881981510549462e-01   +5.970326185544235e-02   +1.915374540674193e-01   -1.000000000000000e+00   -3.012146716520715e-03   +9.457399747984607e-01   +4.775312214985171e-01   +5.051685983023871e-01   -6.095228386233279e-02; +6.269612494594161e-01   -1.827509019031049e-01   +6.421816349602526e-01   +1.586192558250498e-02   +5.458937311588373e-01   +3.974129216331589e-01   +8.746397880522782e-01   -3.141528974702099e-01   -3.410094594637197e-01   -3.291845824335926e-02   +4.609096697681806e-01   +5.877482165665353e-01   +2.357265661573939e-01   -6.978070626659518e-01   +3.073614854500416e-01   -4.418577454558258e-01; -6.438370755881644e-01   -6.361363355485350e-01   +4.946645340559892e-01   +1.759697205421296e-01   -3.695174099012332e-01   -5.999702534914146e-01   -1.036755008844746e-02   -4.301262123599522e-02   -8.252025624962642e-01   -8.624458160828219e-01   +7.934519640407637e-01   +3.916256357334165e-01   -6.821398360113613e-01   +9.758763952160556e-01   +2.090485062756681e-01   +7.338320512321113e-01; -4.136898842971078e-01   -2.137083594312002e-01   +6.299150488156411e-01   -5.370682242545786e-01   +3.164523213039647e-01   +4.843767840933333e-01   +4.496381200473223e-01   +4.875973699642503e-01   +5.070782250156488e-01   -1.723049799046617e-01   -3.208616026167579e-01   -2.753896860297302e-01   +2.459963931001668e-01   -4.460106928458258e-01   +4.251960390480722e-01   -2.437599994166565e-01; +7.712002979012047e-01   +3.104783786335185e-02   +1.005967858126082e-02   -2.042454957753071e-02   -2.307286160759894e-02   +7.076179804202982e-01   +8.775558973707088e-01   -5.851247093824267e-01   -9.832781143575373e-01   -4.382176184983876e-01   +6.388564343511368e-01   -4.844053170728102e-01   -6.668287578983488e-01   +6.410901649745251e-01   -7.674549407629958e-01   -2.057597191056105e-01; +4.618301170533218e-01   -6.899629376708596e-01   -3.133652105752179e-01   -3.708315744580876e-01   -1.077348322982280e-01   +6.475861071951451e-02   +2.646679673080526e-01   +5.387270914821248e-01   -3.952238894193560e-01   -7.866431612260456e-01   +3.814073485405848e-01   +6.569618252000253e-01   +1.462318631245636e-01   -1.629234363844657e-01   +9.197709722564262e-02   -3.487366477965330e-01; +2.360048896462451e-01   -4.604708280488468e-01   -5.082701301940206e-01   -3.654012742457798e-01   -9.733334161336661e-02   -5.545850755854080e-01   +5.864049022067432e-01   +9.155544482978328e-02   -5.072765627805824e-01   -4.582987374632309e-01   -8.021284708860268e-02   -5.600182777886982e-01   +1.607783757155157e-01   +1.939491047138389e-01   -2.431538418188056e-01   +7.264485510506159e-01; +2.399299693991547e-01   +5.344651708181001e-01   +4.578475071224099e-01   +3.808256893566470e-01   -1.754603550829920e-02   -1.518331803800433e-01   +3.580958016110111e-01   +4.969419705887936e-01   +7.113774558559239e-01   +1.962486280129826e-01   +1.220854126474012e-01   +1.011248858261594e-01   -5.168206779910038e-02   +3.354898625610696e-01   -1.133904367995085e-01   +7.095919481722648e-01; +9.846238927275879e-02   -8.837762215472363e-02   +4.852669467787814e-01   +2.604112915516617e-01   -4.168238513200451e-01   +4.233057597282443e-01   +5.179340962802003e-01   +1.935942773173148e-02   -4.631231531932197e-01   -1.055225270525001e-01   -5.552846088087109e-01   +4.886505407374180e-01   -3.838911139732454e-01   -5.635379870323812e-01   -6.869561268691946e-01   +4.578331961461323e-01; -5.566115718028333e-01   -3.896147069553872e-01   -6.613549171843797e-01   +6.980722014012626e-01   +6.976391968899143e-01   -6.290687793068437e-01   +7.885228023876564e-02   +3.484388555581280e-01   +2.622598809270974e-01   -7.399709419944541e-01   -9.775224619564049e-01   -5.038212757031532e-01   -8.176436108833847e-01   -4.346181168873009e-01   -1.139043936965878e-01   -8.780138804300804e-01; -3.774391713529865e-01   -3.696574014971467e-01   -3.716044956694581e-01   +7.473730247994423e-01   -1.489086455237343e-01   -6.394286433866612e-02   +5.247236804118152e-01   +1.193947155556979e-01   +5.435136977169922e-01   +1.304841972048704e-01   +9.330764166259222e-01   +1.992019314739184e-01   +4.136182817729964e-01   -1.561949024980127e-01   -4.717449810703361e-01   +7.992942661246967e-01; -6.636034802578221e-01   +7.111939756422814e-01   +3.878653948033414e-01   +2.563936314378344e-01   -2.929547050931451e-01   +1.375032492609484e-01   +7.685561582260443e-01   -3.361466446474907e-01   +2.517024588589286e-01   +3.376942531325627e-01   -2.022480336383146e-01   -5.984024012269211e-01   +9.368110448371540e-02   +1.868209983016349e-01   +4.289446610310823e-01   -4.772899873875713e-01; +4.637460077190242e-01   +6.348730116461800e-01   +3.113050591484158e-01   +6.471316621438978e-01   +6.749135220977516e-01   -1.074513302379011e-01   -2.381639955769508e-01   -6.016125902788385e-01   -8.700755309123233e-01   -5.108176345178780e-01   -1.487944508324044e-02   -6.172976611818221e-01   +4.957615330933647e-01   +4.200009194388135e-01   +3.869836769826495e-01   -5.325021099910529e-01; +4.727610063412654e-01   +3.598404969718254e-01   -6.263882246436013e-01   -1.724257946307179e-01   -5.298551974161024e-01   +1.926392613776459e-01   +7.278073987060958e-01   +6.157459961160918e-01   +4.248444316384563e-01   -7.178857996586374e-01   -2.064330221531452e-01   +2.632927703262484e-01   -4.266370486179565e-01   -1.014298422113196e-01   +4.482015039617338e-01   -2.691374458942955e-01; -2.269664998556855e-01   +1.639711258064283e-01   -7.924030792911877e-01   +7.373811644272524e-03   +3.700608771293071e-02   -7.944859285228744e-01   +4.227629838666206e-01   +6.514545761045931e-01   -8.677593889531151e-01   +6.611939918491012e-01   +5.378507712312490e-01   -1.896147597483347e-01   +2.671081892084705e-01   +9.104647177281133e-02   -1.702483736173789e-01   -6.200413150646777e-01; -7.953578584603240e-01   +9.613954102436618e-02   +6.753970344489357e-01   +4.612862390790412e-01   -3.567670920358811e-01   +6.097014634401240e-01   -7.103494388578726e-01   -2.581057427915421e-01   -7.318340184619873e-01   +5.492515912203421e-01   -3.618886976796755e-01   +5.836025386080981e-01   +3.634672779455782e-01   -4.166340123790742e-01   -3.470303219380105e-01   -2.866809981882668e-01];
L2I_L1I_iGABA_netcon = [+4.968262196507665e-01   -5.925320476277709e-01   -3.739481414568583e-01   +7.892535196788661e-01   +1.128075579477259e-01   -4.536704191695538e-01   +5.996038193673882e-01   +3.654061837285611e-01; +1.827367974704563e-01   -6.745333262706975e-02   +1.805598207953514e-01   +3.953119994410066e-01   -3.077810773668266e-01   -7.650871913298598e-01   +2.964496065228029e-01   -2.110874075006906e-01; -6.594776768545340e-01   -3.439322087530639e-01   +4.391538635477921e-01   -5.388959999977071e-02   -7.589876916824329e-01   -1.315132512199851e-01   +3.558455075134948e-01   +6.656527041832121e-01; +7.284469722013553e-01   -5.903626339891107e-01   -3.631581522634807e-02   -1.340578199470145e-01   +6.189481245483358e-01   -1.044180492193347e-01   +3.169806597793683e-01   +3.212980359426792e-01; -4.629486616801706e-01   +1.293187376456664e-01   -8.594662164517139e-03   -2.214482311546309e-01   +4.787058010058357e-01   -2.538690211466271e-01   +6.748363757339617e-01   -2.940471183762613e-01; -1.498397425193546e-01   +9.579921095510720e-02   -1.160780807863384e-01   +4.057658440675676e-01   -1.350105893129069e-01   +5.225523200888538e-01   +3.132534879609244e-01   +1.069019999774984e-01; -6.116403026883758e-01   -3.511554816643558e-01   +4.668341173490663e-01   +2.545287109233383e-01   +1.719327961300646e-01   -4.715660828916940e-01   +4.474383311736724e-01   +1.863023132797950e-01; +5.568653457386737e-02   +2.217363193888848e-02   -4.187802146216382e-01   -1.146383431641207e-01   -5.625043051153360e-01   +8.434038730087303e-01   -1.014293313087438e-01   +6.345365716976697e-01; -3.162304114815251e-01   +2.965645177688083e-01   +4.862201269457274e-01   +1.677369743050085e-01   -5.298868759819211e-02   -6.587688335517969e-01   +2.200237566815422e-01   -1.945722829571963e-01; -1.000000000000000e+00   -1.284973071534428e-01   +6.539572467043226e-01   +3.745808431869121e-01   +1.218115254808290e-02   -5.002374101363727e-01   -4.192018947110647e-01   +6.665527822688738e-01; -1.220593036522946e-01   -6.269466908222148e-01   +6.064128504709129e-01   +3.338030820243681e-01   -2.591643690182316e-01   +4.366217296237653e-01   -4.891471962556212e-01   -6.562030082761176e-02; +1.054003340811141e-01   -7.928850944112782e-01   +3.949137420431482e-02   -5.690726004392346e-01   -3.584651318877278e-02   -4.741336466824679e-01   +4.247851648325241e-01   -1.458970657828895e-01; -8.878027623657189e-01   +4.243813562392363e-01   +5.764481951987609e-01   +4.728626773134031e-01   +4.155648103091606e-01   -5.401335631043400e-01   -7.092464636833060e-01   +4.916646416955556e-01; +6.375682621386122e-01   +6.385290972335300e-01   -7.027129989727724e-01   +1.311846295110226e-01   +5.980167543760230e-01   +2.748257130803259e-01   +9.595534003700591e-02   +8.632358478409986e-01; +5.219766531373777e-01   -3.858202155411166e-01   -2.898255429759283e-01   +2.945748709913034e-01   +8.935375190828312e-02   +5.303113329804381e-01   -2.855940061814004e-01   -3.951855871521135e-01; -5.598759659661649e-02   -6.342923907058728e-01   +2.009286140280653e-01   +7.492987270816579e-01   +2.483865407391941e-02   -7.306469496821577e-01   -2.056856544538682e-02   -3.426315644641280e-01];
L1I_L2I_iGABA_netcon = [+3.183691431291338e-01   -3.633645276533728e-01   +9.091863580779475e-03   -7.967949774973733e-01   -5.679436334503130e-01   -4.110730085653257e-01   -4.818818773942591e-01   +4.389278316059804e-01   +7.410069261794695e-01   -1.095402194653620e-01   -9.058182501502640e-02   -2.255611152018889e-01   -1.165880861209940e-01   -2.411048969902704e-01   +1.202143747439869e-01   -8.867955411330905e-02; +4.790991764416107e-01   +3.166605746357615e-01   -1.097035583186723e-01   -2.617549016699984e-01   +5.292357234269079e-01   -1.185905848546054e-01   +4.033645892256220e-02   -3.537117021245049e-01   +1.348457684117962e-01   -2.187695364782254e-01   +6.057545373430327e-02   +3.168730983599520e-01   +5.984630707701532e-02   +4.798696013359268e-01   -2.185571934053642e-02   +2.885500620454816e-01; -4.233258460508659e-01   +3.475596221155544e-01   +8.436727253123908e-01   +3.557066069013409e-01   +7.266242830683148e-01   -1.912637620213659e-01   -4.641361987681970e-01   +2.619388038156990e-01   +4.142646184256502e-01   +5.558970552058959e-02   -2.964861876162126e-01   +1.000000000000000e+00   +5.987107072065097e-01   +1.072464406264074e-02   -3.440500553827084e-01   +3.592232189755135e-01; -5.133945563902302e-01   -8.524560626949823e-02   +4.664687699887753e-01   +1.809917744760691e-01   +5.721194072390455e-01   +4.593364070561339e-01   -1.995572949870870e-01   -5.696731523409136e-01   +6.767070952511141e-01   -3.663281624404086e-02   -5.485456616013333e-01   +3.219980385449319e-01   +2.570613262753190e-01   +2.482620674879281e-01   -4.356695684732641e-02   +2.750189665950745e-01; +7.339347389055789e-01   -7.140608493261502e-01   -7.223792806967293e-02   -7.061814864610529e-01   +1.040143696630669e-01   -1.994923858910908e-01   +5.068114868812461e-02   +7.228575983120621e-01   -5.561127976969867e-02   +7.590773634934226e-01   -4.519794411665947e-01   -4.891792492631352e-04   +4.961875357477385e-01   +5.870079048942832e-02   -5.917690901617872e-01   +8.165953241202341e-01; +1.653787901410688e-01   +4.635234967080493e-01   +1.231911318999635e-01   +2.543624988305724e-01   +3.621825590713095e-01   +8.120308531971812e-01   +5.572025564028701e-01   +3.974035216750726e-01   +6.065182573889197e-01   -3.925892944440317e-01   -2.261078124032609e-01   -4.466205557286025e-01   +7.687186581016220e-01   +6.262949383812645e-01   -2.106020422021088e-01   -3.308196220052435e-01; +1.843554989428925e-01   -2.957057894355913e-01   +1.667612838865154e-01   +1.536726603267846e-01   +6.266678704582810e-01   -3.445550372000984e-01   -4.181452820893673e-01   -6.723254324546603e-01   +5.607165601621694e-01   -9.363625315156331e-02   +1.522027358932878e-01   +2.828644402118323e-01   +7.584148872370204e-02   -7.428034839270634e-01   -3.558139482316937e-01   +8.129632895833305e-01; +8.515105988718689e-02   -1.264296293282580e-01   +2.975794133602940e-01   +3.041466027247413e-01   -3.575643634387108e-01   -8.015720449861841e-01   +1.391117053402625e-01   -2.116673448686246e-01   +5.887109039306923e-01   +4.686423383433871e-01   +1.132034819842983e-02   +3.825715291126516e-01   -5.794125670073396e-01   +7.038973700365665e-01   +3.269269526474441e-01   +3.256191064258568e-01];
L2E_L1E_iAMPA_netcon = [-4.576729810100142e-01   -2.516272490365936e-02   +2.511466040420219e-01   -7.333216656826590e-01   +3.222205433417734e-01   +3.902562042335846e-01   +7.301113204328266e-01   -1.637193686076939e-02; +2.885498728530179e-02   -1.572944537992319e-01   -2.976742981865410e-01   -5.759906661239164e-01   -8.218584357529599e-02   -9.615692772136054e-01   -4.854861933157856e-02   -2.799036444961802e-01; -3.037504502187126e-01   +6.358420371215769e-01   -5.034698381259528e-01   -3.916353436266847e-01   -1.911606739130586e-01   -4.964100749400439e-02   +6.886187886668589e-01   -8.583812882749390e-01; -5.001660485805060e-01   +3.837545586593167e-01   -6.235482014337516e-01   -1.779840977043434e-01   +7.655831883526404e-01   +4.441340681135381e-01   -7.711248246277004e-01   +1.215596472449911e-01; +7.055579880246297e-01   -8.822659917651734e-01   -2.118112680223654e-01   -2.282666918238318e-01   +6.823337923455465e-01   -1.206433372881888e-01   +4.725673393621710e-01   -5.388766349184433e-01; -1.005071323581699e-01   -3.324050415123823e-01   -4.318203031182644e-01   -1.000000000000000e+00   -5.554580888035590e-01   -3.050472276160001e-01   -1.357898052684475e-01   -4.584841314783912e-01; -1.654318818265649e-01   +5.458209856805125e-01   +4.770558302251494e-01   -5.963580388483428e-01   +7.718596049542754e-01   -2.468487794121066e-01   -8.218043804193484e-01   -8.247098947288828e-01; +5.416165946711257e-01   +5.063374413017604e-01   -9.238634983941849e-01   +1.252765387663865e-01   -3.855118752392258e-01   +4.883385190179994e-01   -6.249516491953722e-01   -3.835167060823131e-01; -8.533813200274906e-01   +5.245718861846176e-01   -5.963384472880110e-01   -4.435773178125455e-02   +1.994508647377082e-01   -4.413086681972483e-01   -5.964030937452486e-01   +6.489232380688107e-01; -5.071601258614085e-01   -4.997102547573069e-02   -2.662773097367117e-01   +1.372852566027225e-01   +5.743542600552362e-02   -6.688861269600420e-01   -6.528187524037583e-01   +2.642174344875713e-01; -1.341696457087447e-01   -4.428894481995046e-01   -6.146536998409000e-01   +6.580136277839715e-01   -6.315686609295315e-02   -5.630849213012084e-01   -2.293481804714414e-01   -2.299152968727655e-01; +4.826319156724703e-01   +3.715124248368836e-01   +6.912510358272552e-01   +2.681071067765793e-01   +7.233786961997798e-01   +9.016431657952183e-02   -2.425163377401579e-01   -5.236309334572667e-02; +1.381601168227424e-01   -3.978483931905716e-01   -7.420648246733775e-01   -8.514367299368107e-02   -6.646035710973215e-01   +9.734933973724813e-01   -7.518980864629196e-01   +1.799368431621876e-01; -2.076736364637233e-01   -5.230834111665869e-01   +5.806617249273009e-01   -2.307990340578564e-01   -9.152112473293970e-02   -4.247234857236313e-01   +2.004765249629513e-01   -2.422522758202451e-01; -1.574562911865932e-01   +4.036645455413425e-01   -4.613639466036100e-01   +2.204343208925729e-01   +5.286478197554086e-02   +6.804636813973848e-01   -3.761708458053052e-01   -2.148285562596655e-01; -3.933336808268929e-01   -2.465423784465207e-01   -6.434155375350253e-01   +7.754642498188279e-01   +1.178683022509587e-01   -4.294540835615716e-01   +6.061676875816264e-01   -1.177869564973958e-01];
L1E_L2E_iAMPA_netcon = [-5.725699369627737e-01   -7.733750184741921e-02   -5.143657874913027e-01   -6.864593878280335e-01   +6.494084977001114e-01   -1.899933527623875e-01   +8.888388841317370e-01   +8.547396874543061e-01   -2.209508973469861e-01   -4.551966955007188e-01   -7.417316877838180e-01   +2.317906549818455e-03   +2.445757728794213e-01   -9.943546201007429e-01   +6.997191586999501e-01   -7.803587680723640e-01; -1.764315029557083e-01   -4.795807058515086e-02   +7.800992245751915e-01   -5.274687053670846e-01   +7.855356695919572e-01   -2.322948326963918e-01   +5.018489975953891e-01   -2.054231673305540e-01   +5.802515157721865e-01   +6.164478784074308e-01   +6.395149493945212e-01   +3.627039970597698e-02   -4.431640690713340e-01   +5.987492265019276e-01   -4.761247555830883e-01   -9.710608812272116e-01; +2.053996291171328e-02   -7.230716134609069e-01   -7.986077641593594e-01   +7.282527551769028e-01   +6.108060499320611e-01   -5.420030756034410e-01   -4.288791395638729e-01   +1.424435474318942e-01   +6.654917372625359e-01   -3.786717558083874e-01   -2.060298941929883e-01   +7.966765454365455e-01   +5.427182592415969e-01   +1.334545667486727e-02   -5.468708771440994e-01   +6.098064113965630e-01; +6.727353472468166e-02   +2.739975325967021e-01   -6.029759885035955e-01   -1.754061898803254e-01   +9.447564305090030e-01   +3.406868202761477e-01   +2.116071532354960e-01   +6.885254738580693e-01   -2.591858750289371e-01   +7.627116435562605e-01   +6.061562372912199e-01   +1.355264259885746e-01   -2.918503852764603e-02   -5.664794982513315e-01   +5.870418493545996e-01   -1.915122312120557e-01; -8.301646213708783e-01   +2.665470172768281e-02   -5.480329869479965e-01   -5.237596693267050e-01   -4.789894929186178e-01   -4.712243554056086e-01   +4.278536327386332e-01   +4.776051758945825e-01   +4.629261004874007e-01   -2.572221812478213e-01   +6.407665589693845e-01   +1.636279912228719e-01   -3.470202218321658e-01   -3.881473150247866e-01   -5.099339286374152e-01   -8.647416488613736e-01; +1.859041897016336e-01   +4.351451395718581e-01   -6.207151267029882e-01   +6.784632317198345e-01   -3.902249865077839e-02   +1.119404312128087e-01   -1.000000000000000e+00   +4.838765819897430e-01   +2.517515882590787e-01   +3.571827175221040e-01   +4.667574626470523e-01   +7.704820142595077e-01   +1.840233130010089e-01   +4.530100688811181e-01   +1.103151584935603e-01   +4.757447430976507e-01; -3.591038363212822e-01   +5.265469859257524e-01   +7.823319277128259e-01   -9.987058102064332e-01   -7.472728149065107e-01   -2.061362142447644e-01   +2.391542665520268e-01   -1.421703952353035e-03   +8.231737585750769e-01   -1.509111794255550e-01   +8.117113775261632e-01   +1.992731712442675e-01   +8.252802832897850e-01   -4.752150222774087e-02   -1.283400926665623e-01   +2.873073611327667e-02; -4.283115864269537e-01   -6.906604911342649e-01   -8.692739815940372e-01   +4.692953126946629e-01   -4.362433197714108e-01   +4.830306274805051e-01   -9.060818283696221e-01   -1.957538414740276e-01   +8.502720302785592e-02   +2.599019827664620e-01   +1.601279742240356e-01   -4.489803139856332e-01   +5.827356264891106e-03   -3.332024345494096e-01   -5.916452341801449e-02   -6.127031714988735e-01];
L2I_L2E_iAMPA_netcon = [+7.202961328232746e-01   +3.822576854065566e-01   -1.473805804329592e-01   +4.148561481389317e-01   +1.278906414674849e-01   -6.631505655570796e-01   +5.490842946965718e-01   +8.669455969693992e-01; -2.154894593687895e-01   -3.765077004759745e-02   -6.423441470448881e-01   -2.769698854914756e-01   +3.166490924346793e-01   -4.540839287053890e-01   -4.644217466213224e-03   +1.108102502863767e-01; +6.554250901204416e-01   +7.971401058141100e-01   +4.319891967748665e-01   -1.213875262167686e-01   -4.670146118193361e-01   +6.006309353202064e-02   -3.950947046747736e-01   -5.456981178673864e-01; -4.927821892489187e-01   +6.724462910756714e-02   +4.131304092020989e-01   +5.695121367355561e-01   -5.047690947551968e-01   +1.370970309982334e-01   +3.535394759595251e-01   -2.899442677945412e-01; -1.722153978955151e-01   +9.649203266033167e-01   +2.156775481510696e-01   -8.144148559309846e-01   +4.756799284379612e-01   +1.689597572142714e-01   -5.147970210621078e-01   -3.207738476866804e-01; -4.031584322371368e-01   -3.929415540505311e-01   +5.236496733788089e-01   -6.499118315472387e-01   -2.725840462165945e-01   -1.435852828780549e-01   +2.354802371726066e-02   -3.591914588980631e-01; -9.727752813504848e-03   +6.085415302185669e-01   +1.697228761912357e-01   +4.624017530528519e-01   +7.335991982795616e-02   +5.769066849656689e-01   +5.665380705055004e-01   +7.451432733888684e-01; -8.159036134450287e-01   +6.496091657584846e-01   +1.173334543066269e-01   +4.675665841925168e-01   +1.000000000000000e+00   +5.861504544843028e-01   +1.050108203311155e-01   -6.359025320604420e-01];
L2E_L2I_iGABA_netcon = [+1.983745533866739e-01   +2.649846026112674e-01   +5.154249044667246e-01   +2.497038807122630e-01   +9.830091162144887e-02   -1.717371150854721e-01   -3.644141901240416e-02   -8.252497444089545e-01; +4.869707179715988e-01   +4.590695259801016e-01   +6.388703897860239e-02   +1.000000000000000e+00   -5.355287546589149e-01   +8.463344165735733e-01   +1.507891432301757e-01   -3.318998210062737e-01; -7.479669218335978e-01   -2.709393694521827e-01   +9.966101394311809e-01   +2.462155189746400e-01   +1.647771099822476e-02   +2.989473271682878e-01   +4.751726821495187e-01   -2.158433772887343e-01; +6.898489843016311e-01   -6.662939488420150e-01   +4.616925214898346e-01   +2.045716261568452e-01   +4.094492336121779e-01   +1.316260255206685e-01   -6.611131917430169e-02   +7.680165859943435e-01; +6.479493932650308e-01   +2.036883435447819e-02   +6.035212363036683e-01   +1.406309139150953e-01   +2.054623149982148e-01   +3.190853789819958e-01   +7.950071336750609e-01   +9.864051847891150e-02; -2.423688372166703e-01   +5.804595554594250e-02   +9.340222661150983e-02   -4.858035400148806e-01   +3.713333210485958e-01   -2.694903763907697e-01   -2.139268986575664e-01   -6.065610054071621e-01; +2.221939113466424e-01   +3.353082814969282e-01   -5.534141448028559e-01   +7.305382573622476e-01   +8.895076451982865e-01   +6.787464350882377e-01   +3.008736934437005e-02   -2.307885983016393e-01; +6.473320445986519e-01   -3.244384871914015e-01   +8.123525197984730e-01   -5.811048530721392e-01   +2.601039012746872e-01   -7.955734909693745e-01   -5.517463352398196e-01   -2.208373005645397e-01];
L3E_L2E_iAMPA_netcon = [-2.821209393801400e-01   -7.552823997688776e-01   -4.231811657174318e-01   -8.075001969232011e-01   +7.962746342260046e-01   -3.436534714357420e-01   +2.011937140965806e-01   -4.888883189966079e-01   +8.208458843676680e-01   -4.126139175468911e-01   -8.029156558832834e-01   +1.012700095372523e-01; +4.106134876380227e-01   -5.455213379639606e-01   +5.581194645577829e-01   +5.700166205169227e-01   +3.702680734958362e-01   -8.292496907207659e-01   +8.492436547041636e-02   +4.338663454122261e-01   -1.378533462846331e-01   -2.380237922000798e-01   -6.118670838824026e-01   -9.155114335534656e-01; +6.355372841974441e-02   +5.451854207514514e-01   +4.265514451948324e-01   -2.612349486645945e-01   -5.503213997570965e-01   -4.330450111879501e-01   +3.066858478208178e-02   -7.759980194352012e-01   -5.760757017227667e-02   -2.349542152802059e-01   -3.402266328174075e-01   -7.115151001180852e-01; +5.427452560135507e-01   -5.479829358362245e-01   -3.687399866749382e-01   -6.038779481361314e-01   +2.639245254563550e-01   +7.749930152617024e-01   -3.822340459787096e-01   -2.070065976583615e-01   -5.307547041652985e-01   +6.761538171820553e-01   +8.722023670247303e-01   -7.451607096239722e-01; -1.974375963607489e-01   -6.002007476694147e-01   -5.781056680682601e-01   -4.337474992331851e-01   +6.746808092249514e-01   +3.213481670975872e-01   -3.125249722695842e-01   +5.082276951142304e-01   +6.260943365025901e-01   +5.302908872714052e-01   -8.388290100800707e-01   -3.858575318886646e-01; -3.309229132955402e-01   -1.044753814790965e-01   +5.216982114770187e-01   -4.694163947005766e-02   -2.600006022374204e-01   +4.639613166544326e-01   +1.000000000000000e+00   -6.086786701854345e-01   -5.432982967438938e-01   -1.099353437509339e-01   +3.119279515640274e-01   -5.928538880519939e-01; +7.188110438502031e-01   -2.182768783400145e-01   -2.657138240022238e-01   -4.631208388465142e-01   -5.968631285233302e-01   +4.148465649270526e-02   -4.095467691055297e-01   +7.972379486359182e-01   +3.564750738408097e-01   -7.320067085264969e-01   -3.705574212051367e-01   -2.107834081297366e-01; +5.773966544369552e-01   -6.158370200347566e-01   +6.002063191737904e-01   +2.768282748039084e-01   +3.306392401177995e-01   -9.984193433120159e-01   +8.342063267788710e-01   -8.336670556462881e-01   +5.066251948422026e-01   -4.257546738593680e-01   +3.632481588556702e-02   +5.913911018851734e-01];
L3I_L2I_iGABA_netcon = [+3.463782484571826e-01   +4.437898901193799e-01   -1.934141738464925e-01   -4.195939847572894e-01   +6.224205981775536e-01   +1.244653594336106e-01   -7.294848785679045e-02   -1.475085657469553e-01   +1.119692152960055e-02   +3.630603848888035e-03   +1.382248559763877e-01   -4.373302087747706e-01; +6.207692785499299e-01   -4.383046668918056e-01   +3.209161571299818e-01   +8.442565980458797e-02   -1.530249854547401e-02   +7.533885929904224e-01   +1.973087395621707e-01   +2.459174787305531e-01   +1.505832448255671e-01   +2.113879390992356e-02   -8.708892735355122e-01   +6.331262244018950e-01; +6.812795623400406e-01   +6.776648452977271e-01   +1.603435437995309e-01   -5.545171734762131e-02   -4.173258634078074e-01   +1.724610428326306e-01   +8.222789153497203e-01   +6.935772066890648e-02   -2.136978774882300e-01   +2.252136560622514e-01   +7.172690808079654e-01   -5.110806588619173e-01; -4.324238378768905e-01   +5.564969197944495e-01   +3.062836405655445e-01   +5.891790553625912e-01   +4.258559942078863e-01   -4.279096445162201e-01   +4.418870793916998e-01   +7.239085841625584e-03   -4.151535113353451e-01   -7.978502572527693e-01   -7.304737610052207e-01   +8.156432806683921e-01; +5.232925841749655e-01   -8.594610143130119e-02   -3.314347407833219e-01   -1.315178320029933e-01   -3.696999660491581e-01   -5.826087030772792e-01   +5.802264365418339e-01   -1.473262764861691e-01   -1.879929796694829e-01   -8.299124166803106e-01   -4.108907147252863e-01   +2.248919885368877e-01; +4.561943083702374e-01   +9.115583192475502e-02   +1.000000000000000e+00   +8.647784728742820e-01   +3.791674289066156e-01   -1.188669731896549e-01   -8.083993372164898e-02   +3.204931183146243e-01   -2.357536137332632e-02   +6.992215118376834e-01   +3.915505990921911e-01   -5.556388136648081e-01; -4.821849888745735e-01   -7.324467712712530e-02   +3.248110467519683e-01   -5.960391405902513e-02   +1.750493419736822e-01   +7.526436686277649e-01   -6.699583921720675e-02   -5.949576807206589e-01   -4.708775735573754e-01   -3.026462568427292e-01   +5.320370660520100e-01   -7.321513275361080e-02; -4.976262101296455e-01   -6.743989317946693e-02   +1.700403355378583e-01   +8.486381638224607e-01   +5.282898934797249e-01   +8.016172469602639e-01   -3.218327760545104e-02   +3.785036949894019e-01   +3.089264932602880e-01   +5.354055384627134e-01   +7.670208319851791e-01   +7.567955304363115e-02];
L2E_L3E_iAMPA_netcon = [+4.934724882769995e-01   +2.979965442505590e-01   +9.459814244094754e-02   +6.407055370506288e-01   +9.823910416467800e-01   +2.874140203755063e-01   +4.136269802571982e-01   +8.731933258881118e-01; +7.769285023823542e-01   +2.112839258989209e-01   +6.517683276445171e-01   -9.169270544152212e-02   -2.731317548155546e-01   +3.152748621683222e-01   +3.618408088024679e-01   +3.380989932201318e-02; -1.112028927127627e-01   +4.723612203464200e-01   +5.517788781318437e-01   -4.704194538660615e-01   +2.103557746968970e-01   +2.918207294058655e-01   -3.381442895795424e-01   +2.522098754335369e-01; -5.006264419843095e-01   +5.739126846693426e-01   -7.367334359090137e-01   +5.682774207647672e-01   -1.465637222757605e-01   -1.932295097963437e-01   -6.357065670475667e-01   +1.000000000000000e+00; +7.736107229841751e-01   -1.045139630131835e-01   +8.337041650461511e-01   -3.176915831695623e-01   -8.220377831122637e-01   +1.287156837925015e-01   +4.212366761006497e-01   -3.653611165814195e-01; -4.113311544934402e-01   -1.683141136828693e-01   +8.358729655202751e-01   -3.935943045638612e-01   -1.984127539769512e-01   +6.928853518440492e-01   -6.450162029775103e-01   -3.242661427276829e-01; +7.843636733876551e-01   +7.627023381280881e-01   -5.731767887677475e-01   -2.244400130932934e-01   -2.901662544258403e-01   -5.873299265791869e-02   +6.681061510816232e-01   +5.107090811357361e-01; -4.308463821497139e-01   +2.459120660081357e-01   -7.374973028357230e-01   -2.019193591506109e-01   -6.895582703921828e-01   -1.558362488390558e-01   -3.050243291647315e-01   +6.314799794810390e-01; +7.466035307224286e-01   +4.084196835924275e-01   -2.827112037838050e-01   -3.435949645930356e-01   -8.534441467324286e-01   -2.956639442564973e-01   -8.989399406252160e-01   -6.786676423240313e-01; +9.311977198104126e-03   +2.875395712615170e-01   +1.613639076558195e-01   -7.128418818693724e-01   +3.178072380715859e-01   +3.721612010772095e-01   +5.642899641762410e-01   +3.106326805583080e-01; -1.906678385076354e-01   +9.041881314910954e-01   -7.987126850343137e-01   -2.835269513395468e-01   -4.009739720332615e-02   -9.698639633792333e-01   +4.656962719260908e-01   +2.036654428322497e-01; -1.515329405347458e-01   -1.339764085825243e-01   +1.888603000248367e-01   -7.669975641403978e-01   +2.241583733457480e-01   +2.182497120625935e-01   +7.382218791187517e-01   -4.127210678796215e-01];
L2I_L3I_iGABA_netcon = [+1.718846225243645e-01   -7.589682132595810e-01   +1.651379424380334e-01   -5.578786914772557e-01   +7.034085991856299e-01   -4.027791000500168e-01   -2.976880337559502e-01   -5.939101528967170e-01; +4.355159672160978e-01   -5.705959442105218e-01   +8.444906966104455e-01   +6.309628408439673e-02   -2.003630027884555e-01   -5.675221202852060e-01   +3.315941748204487e-01   -1.542597784721814e-01; +1.851732273807768e-01   +7.470284294274557e-01   +1.814425645054304e-01   -7.419706453525643e-02   +6.804115603721317e-01   -1.724965095041986e-01   -5.275294638323409e-01   +5.263422802175919e-01; -3.064233338888623e-01   -6.385474762285327e-01   +9.439744019084026e-03   -5.432858558993042e-01   +3.578133837301137e-01   -1.034969986920298e-01   -4.279723992102872e-01   +6.333845656621202e-01; +6.602323888990601e-02   -9.843766685672689e-01   +4.965204521529923e-01   -5.665547502928086e-02   -3.939775920833695e-01   -6.329312598526842e-01   +7.054529671958955e-01   -5.750900443152179e-01; +9.814586581526576e-02   +4.047203070137323e-01   +4.482376135757847e-01   -8.057898775667798e-01   -8.192154541175665e-01   +5.843223199567800e-01   -3.375516982507761e-01   +3.538003611689971e-01; +7.651839647218331e-01   +6.389461253417802e-02   +3.802128750963283e-01   -3.620657640024244e-01   -4.557831982445258e-01   -9.973537214922111e-03   -4.804977335882730e-01   +3.367583369144246e-01; -1.921899178946900e-01   +2.010918606990286e-01   -6.114337049912606e-01   -1.395722078026085e-01   +8.218345261404084e-01   -5.290615069046745e-01   +2.148917162020015e-01   +1.481125575476403e-01; +2.731781614010040e-01   -8.321341197396794e-01   +1.000000000000000e+00   +3.045678229446446e-01   +5.721787824349583e-01   -6.750198140501539e-01   +1.152220281965555e-01   -6.707398651752082e-01; -9.837846301333925e-01   +7.863795107819062e-01   +7.053720704708896e-01   -1.008125475296575e-01   +8.132948454315858e-01   -5.667304660709106e-02   +3.732286236604004e-01   -8.797080870559842e-02; +2.973118125201561e-01   +3.268736328006309e-01   -5.416935749349284e-01   +1.133590766484869e-01   -3.719898029872710e-01   -1.506765670158832e-02   +5.659022823193266e-01   +1.745883389137557e-01; -3.044965463204972e-02   +5.368200138616699e-01   +4.577661646229373e-01   -1.334523961615893e-01   +6.576995005801450e-02   -2.953779704877037e-01   -2.745579967303124e-01   -2.504064492527776e-02];
L3I_L3E_iAMPA_netcon = [-1.680113271790348e-01   -5.062824916755524e-01   +5.584105923944227e-01   +2.010222982476198e-01   -5.907696546766117e-01   +1.000000000000000e+00   -4.169954525165519e-01   -5.512039206177154e-01   -9.738729965330832e-01   +7.322687495155586e-01   -6.091145715452181e-01   +2.806094446611966e-01; -3.231536012959960e-01   -2.142815676126565e-01   -5.891388561756745e-01   -9.178746215289124e-01   -5.277021787460400e-01   +5.959908923501229e-01   -4.433040393029924e-01   -4.853678729331729e-01   -1.917704994243238e-02   +4.700299481355552e-01   +5.720391087786642e-01   +5.377476762697374e-01; +1.249778816360835e-01   +4.386230143083162e-01   +8.559697335998060e-01   +8.218328084864976e-01   -8.930733290995753e-02   -8.448633750439136e-01   -5.808874830100690e-02   +2.591582506157742e-01   -6.750458550249584e-01   +3.023940706376714e-01   +1.642202133002123e-01   -2.300000397929355e-02; -2.471350489263188e-01   +8.858181890420743e-01   +8.297406643200649e-01   -2.623527914209940e-01   -3.626602485250763e-01   +1.019086512629248e-01   -8.543354245646450e-01   -4.861941635558982e-01   +7.640680652168951e-01   -4.270241006860741e-02   -4.879266172756718e-02   -4.451095630361325e-01; -3.985208688438899e-01   +6.881503884126406e-01   -5.001029455434280e-01   +1.714772543965188e-02   +1.350382474798067e-01   +1.615106660241316e-02   -2.484046848238683e-01   +6.050393076637444e-01   -3.350200529050825e-01   +5.347093523180876e-02   -3.103624927424204e-01   +1.887243449254085e-01; +2.727128416163526e-01   +2.588210831565449e-01   -3.313281545639273e-02   +1.013793779940438e-01   +9.229623281295339e-02   -4.628010807966054e-01   -8.462826908338553e-01   +7.837822240465553e-01   +5.732560662066219e-02   +3.617461209921021e-01   +6.443666621573066e-02   -6.761300984383103e-01; +3.563132590363173e-01   +1.587337806680596e-01   -3.380518522489548e-01   -6.639504392938972e-01   -4.404638795277234e-01   +1.713142210065464e-01   -2.828266922810649e-01   +5.749098741297335e-01   -2.776151289976234e-01   +5.326470181400644e-01   -3.764651568114644e-01   -6.945217711087484e-01; -2.907947322759075e-01   -8.551726052322423e-02   +6.123595352130078e-01   +5.489817239258881e-02   -2.401950054035180e-01   +2.322351174054572e-01   +6.861516483755102e-01   +9.835106750667970e-02   +3.811136784693355e-01   +1.889594768768353e-01   -9.123776294680009e-01   -4.884698812021564e-01; -6.033306676530389e-01   -2.347502201549361e-01   +1.782709543072796e-01   +4.704988565200374e-01   +9.219946380786258e-02   +1.581019743242913e-01   -5.337105234323621e-01   +3.964648476909441e-01   -4.882581166742170e-01   +3.751146950990580e-01   -3.691696159216766e-01   -6.517012431227794e-01; -5.482885423623108e-02   +6.539419758778500e-01   +4.570724357895139e-01   +5.074998544844923e-01   +6.381987483749999e-01   +4.552817048665115e-01   -6.449778475590877e-01   +1.140072261149236e-01   -5.203378789900689e-01   +7.807087256438722e-02   +4.522427708573503e-01   -6.615269463771865e-01; -3.067310059625015e-01   +4.263424326074371e-02   +3.178760586560805e-01   -2.954925106768136e-01   -2.031968919647994e-01   +4.112768047047622e-01   -7.100180151862439e-01   +3.644760896287477e-01   -6.884880384385357e-01   +4.839103403210049e-01   -2.671230503346323e-01   -3.648249257121016e-01; +3.724632847651221e-01   +9.054802776538001e-02   -1.654541641087022e-01   +2.981677447593720e-02   -1.175077065317181e-01   -2.275757970737838e-01   +6.593715281727363e-01   +5.855387938691969e-01   -3.487237639088344e-01   +3.997005719408381e-01   +6.607618072053545e-02   -3.044329473201693e-01];
L3E_L3I_iGABA_netcon = [+5.759313281750943e-01   -8.175116164280279e-01   +3.766705635491840e-02   +2.461852248026243e-01   -3.276894715764529e-02   -1.320239683714673e-01   +5.750043030529622e-01   +9.461221854071475e-02   -6.952068930808708e-01   -6.519850048937043e-01   +2.613836600963392e-01   +5.916641128887221e-01; -2.321909518378687e-01   -2.699630928309195e-01   +9.233379523185960e-02   -2.641236316851130e-01   -9.907463106502437e-02   +8.718023326468932e-01   -6.010718364622206e-01   +2.803909881936527e-01   +5.005146310032798e-01   -1.200958535260069e-01   -1.728445090104508e-01   +1.228085479478524e-01; +3.619255090197496e-01   -6.262685337665282e-01   +6.893835079100317e-01   -2.602733322549604e-01   -2.617868217571536e-01   +5.658425243819294e-01   +4.964323344039383e-01   +6.219625828315133e-01   -1.718778228009839e-01   -1.017381300315626e-01   -6.485251068567954e-01   +3.613427590766293e-01; +3.890156956991642e-01   +2.750101520331225e-01   +4.512448711195546e-01   +3.241877351645399e-01   +3.263128960692765e-01   -7.615122797664989e-01   +4.519616834815740e-01   -2.528701987472720e-01   +2.848978418398608e-01   -3.700348823147264e-01   +7.435023267474093e-02   +5.958205441342087e-01; -1.214618948923066e-01   -6.760142790646856e-01   +6.198389595307072e-01   -4.412125830375866e-01   -2.753681257875600e-02   -7.602794254539977e-01   +3.770281824604668e-01   -2.846957751236253e-01   +1.668266041929482e-01   -5.396152012071957e-01   +3.868738180523372e-01   -5.628629468698634e-01; -1.053286202363533e-01   +6.420371220600514e-01   -1.023577279613765e-01   -8.603184437963898e-01   +8.540425763633944e-01   -3.426586959988653e-01   -8.472184736873500e-01   +5.342770002163912e-02   -4.908160914456983e-01   -6.957015504249211e-01   -1.819915809619517e-01   +9.244823015458741e-01; -1.985194811310961e-01   -1.509777744205583e-02   -3.120878919668809e-02   +5.502881054716643e-01   -6.118390534146519e-02   -4.009451594929159e-01   -1.550351399758943e-01   -1.439982317726973e-02   +7.630291892725690e-01   -7.720527206359546e-01   +7.915577086328879e-01   +4.522495045763246e-01; -4.686427378549543e-01   -8.823809800769065e-02   -5.064294480159813e-02   +5.724796706119539e-01   +5.622988858311618e-01   +2.488508602527862e-01   +4.369961155030633e-01   -8.536483169831992e-01   -8.067505583095845e-01   +1.174364247478325e-01   -1.415592667184260e-01   -3.764853763234077e-01; -4.852148113918096e-01   -5.872882035342646e-01   -8.153317933236894e-02   +3.372025249917028e-01   +8.088220122473149e-01   -5.093760431949046e-01   -3.933795415348209e-01   +1.118642827897031e-01   -7.124151561907884e-01   +1.816006575817146e-02   +7.084691722090062e-01   +8.557793072756577e-01; +6.796678406113598e-01   -2.833424986989582e-01   -3.746924886218369e-01   +2.336081292106643e-01   +5.653736674634298e-01   +9.962865294659242e-01   +7.540245784460908e-02   +4.349647698329372e-01   +5.705458157312551e-01   +3.016499355083445e-02   +2.066919943902917e-01   +5.156156115758171e-01; +3.951796918972761e-01   -3.298952255389815e-01   -2.506852994367788e-01   +6.708240491111398e-01   -4.446021604455335e-01   -1.477179970109787e-02   +1.079734533210746e-01   +3.574478951477244e-01   -8.120365556527767e-01   -2.640847529144726e-01   +1.000000000000000e+00   +5.788652219523285e-01; +5.671184327537606e-01   +3.324123585847351e-01   +6.874521585625377e-01   +3.297601005786819e-01   -6.244137451402774e-01   -4.977109626605355e-01   +8.055923338622160e-01   -8.523351489769125e-01   -2.859897963498900e-01   +1.647281448627033e-01   -1.642937304216475e-01   -6.827570973806544e-01];
L2E_Input1_iAMPA_netcon = [+8.507778534476713e-01   +8.286691726583774e-01   +6.253406658820416e-01   +1.000000000000000e+00   +3.349106062280475e-01   -3.483676903823787e-01   +8.016729274059483e-01   +7.020974884802697e-02];
L2I_Input2_iAMPA_netcon = [-1.717153037531247e-01   -1.000000000000000e+00   -3.839377851308174e-01   +2.444021942220965e-01   +5.905914770110709e-02   +8.067170226665358e-01   -5.620548246290438e-01   -5.041994561326815e-02];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last =  11.21 * ones(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))*0.4 + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.5*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.5*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))*0.9 + 0.5*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))*0.4 + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.5*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.5*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))*0.9 + 0.5*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
