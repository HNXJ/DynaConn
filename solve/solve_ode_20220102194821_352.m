function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+2.144041594766363e-02   -2.011821219122338e-01   +6.823345233491253e-01   +4.433527455697672e-01   +1.862760526308938e-01   +4.819674168399675e-01   -1.297650120671656e-01   +1.325097996197427e-01   +3.447057859538576e-01   +6.053968954578981e-01   +4.356115131400967e-01   +2.842327490301260e-01   +1.764250271247262e-02   -3.172938060144495e-02   -2.767879645726605e-01   -1.076100488077590e-01; +1.567214878625362e-01   +1.434107706117871e-01   +4.002816360156899e-02   +8.024907579576809e-01   -7.864171666918902e-02   +3.421427819587436e-01   -1.643240326548226e-01   +4.282081683413252e-01   +5.378742459776573e-01   +1.185606895584454e-01   +4.711999174356401e-01   +4.405282367763300e-01   +1.459828368697617e-01   +3.375083498143976e-01   +9.734857311495475e-02   -2.661529251024949e-02; +6.576805385199154e-01   +3.949581186297325e-01   +1.862901235337867e-01   -8.393726893475641e-03   +1.822201042584177e-01   +3.808232948626774e-01   +4.411804129190732e-01   +2.423794290520827e-01   +1.631047354401499e-01   +4.297522897798138e-01   +4.720841696267251e-01   -4.581402943602646e-02   +2.470652916972337e-01   -8.801636060314906e-02   +7.739747444475522e-03   +9.569348831115269e-02; +1.036171091210335e-01   -2.462428119885020e-01   -6.658668784408053e-03   +4.064318525654099e-01   -4.765613221639412e-02   +5.499581797344644e-02   +5.936154203679210e-01   +7.897409627709622e-01   +4.895646335305628e-01   -8.538782026763413e-03   +3.876926377644438e-01   +7.104964253659368e-01   +2.917668487952221e-01   +6.329607254219531e-01   +7.268085953308966e-02   +6.368599373341117e-01; +8.025014100965320e-01   +9.212439141183761e-02   +5.039614308987176e-01   +7.459131663760739e-01   +7.057501188160276e-02   +4.063763043088380e-01   -6.476238702002615e-02   +5.168033913428716e-01   +7.148874149085561e-02   +3.631871344725663e-01   +3.101045566710016e-01   -2.237066722326049e-01   +6.324408835142875e-02   +3.151720934608928e-01   +4.563331306699782e-01   +3.114366702601071e-01; -1.440600235587778e-01   +5.822105472883806e-01   +1.495529242572761e-01   -1.581934421198532e-02   +7.444453486867948e-01   +2.331616943921310e-01   +7.320005060684590e-01   +1.231964644636274e-01   +4.096713745018367e-01   +2.961917103520691e-01   +3.658204560927522e-01   +2.825640481767838e-02   +3.211742514690469e-01   +3.054464296591745e-01   -1.035381439861403e-01   -7.174658560119920e-02; +5.042530848453110e-01   +5.770793208077203e-01   +3.493515842139073e-01   -8.478819372834640e-03   +7.604835993315076e-02   +3.219616021244563e-01   +3.022950455870929e-01   +1.971288827313107e-01   +5.213538607744466e-01   +4.298132162213333e-01   -3.624496898881334e-02   +4.000095386088529e-01   +3.050957875742796e-01   +4.039849052834957e-01   +4.094489719877853e-01   +3.755981932922784e-01; +2.535392755790271e-01   +5.131475160274063e-01   +8.323791067438559e-03   +7.035304521749235e-01   +1.863504621132732e-01   +8.967368249388379e-02   +4.330723085378711e-01   +7.814022320552804e-01   +7.504544323282223e-01   +6.621610654189876e-01   +1.156806686826945e-01   +5.608716564600178e-01   +3.055590523001445e-02   +1.437163333073465e-01   +4.385752140091564e-02   +4.511971265033160e-01; -6.884619509018509e-02   +6.492304757094435e-01   -4.458052339683570e-01   +2.921119527369179e-01   +5.097187080694617e-02   +6.069724825011645e-01   +2.628605844439084e-01   -3.465329962202146e-01   +3.352660754126338e-01   +3.266624163624460e-01   +5.571607157656822e-01   -1.814470723854031e-01   +6.373240985518031e-01   +4.141171901495570e-01   +1.120321823961026e-01   +2.109827492700402e-01; +1.072314609044909e-01   +2.716256988539321e-01   +4.494161806605100e-01   +3.915174676984080e-01   +4.164796832566696e-01   +1.707049740117295e-01   +4.320285681685884e-01   +1.529678972653977e-01   +4.242778108979393e-03   -5.623895961731552e-02   -6.615853534423555e-02   +1.955216423013203e-01   +7.554205330070870e-01   -3.206563095297447e-02   +2.521647013586322e-01   +5.516289093350230e-01; -2.406443314613766e-02   +7.343317280464723e-01   +2.329077402255238e-01   +1.637318157422975e-01   +5.467958897383646e-01   +5.999662233334782e-01   +5.750058886573929e-01   +2.352229260546898e-01   +9.286850849002243e-02   +4.739090095159830e-01   -6.586392066286879e-02   +5.136351414443896e-01   -2.888051010880211e-01   +4.784276423429250e-01   +6.261149230508032e-01   +2.714708268236447e-01; +7.757265827383854e-01   +9.872180485716515e-03   +1.094036573503315e-01   +2.217322800464808e-02   +3.314824326008131e-01   +4.281327594824352e-01   -1.463235879037937e-01   +3.876410677732525e-01   +5.849355833300612e-01   -3.401930590383410e-01   +7.125832631583078e-02   +4.843964094628486e-01   +5.728194281196224e-01   +4.444128774402891e-01   -8.679898893658256e-02   +3.258419634005572e-01; +2.538048832743160e-02   +6.318990004771344e-01   +5.513554981528636e-01   +4.565470428594107e-01   +5.235534063869116e-01   +5.227181403527804e-01   +3.497461338084665e-01   +6.385223671042791e-01   +6.735084057612918e-01   +4.913794962982910e-01   +2.291859965121418e-01   +1.313283408322833e-01   -2.567841311316513e-01   +3.451015394039106e-01   +4.133446162707601e-02   +4.558919611106869e-02; +1.523852459976390e-02   +3.981735860512258e-01   +3.140765065285849e-01   -3.831245523273116e-01   +7.404642123481253e-02   +6.974435015667283e-01   +6.261548321581314e-02   +1.003648493154431e-01   -1.545002661276221e-01   +1.752849517594319e-01   +8.833525796362970e-01   +5.839007599403274e-01   +5.786873620575903e-01   +4.706736439862206e-01   +2.243636953535146e-01   +3.107639733656926e-01; +3.393841708721720e-01   -6.099177967182345e-02   +4.634258470290167e-01   +7.326205047347599e-01   -1.596719825383457e-01   +7.950808908428261e-02   +6.014095255008570e-01   -7.007028479380562e-02   -2.984797474424224e-01   +3.500579910757272e-01   +3.009879840233616e-01   +2.246063251103071e-01   +3.074515241861486e-01   +1.034142501963344e-01   +2.675979088711822e-01   -2.135857930999206e-01; -1.720742448709482e-01   +4.786939579819992e-01   -2.790250983982309e-02   +5.700956060369736e-01   +1.000000000000000e+00   +6.849607867792358e-01   +5.027251407876308e-02   +8.448081767669369e-01   -9.959739535060394e-02   +5.080928657080400e-01   +5.130983295644042e-01   +3.508881767816310e-01   +1.026859160049913e-01   +6.045986431771858e-01   +5.653568309977617e-01   +2.050221014651554e-01];
L1E_L1I_iGABA_netcon = [+1.795992978522490e-01   +3.343547308310498e-01   +2.596264793391904e-01   -2.236528633868170e-02   +3.040809829031697e-01   -1.214233074860017e-01   +2.215777033583901e-01   +7.138734714479486e-02   -2.479228311421343e-02   +9.153813577112611e-02   +3.306130137423687e-01   +2.546063436040424e-01   +6.611092995687516e-01   -3.823305373682062e-01   -1.825598218834364e-01   +8.648506696277908e-01; -8.295309460356248e-02   -1.111705273916230e-01   +2.656786187617086e-01   -2.349459029276339e-01   +6.843173978436784e-02   +4.635823796117460e-03   +4.539468945837540e-01   +2.505579327944447e-01   +6.609014112388013e-01   +7.331568311766549e-02   +6.452872401990850e-01   +2.900004276096404e-01   +5.907987970957911e-01   +2.857917566479908e-02   -1.327764351055875e-01   -2.363541908792887e-01; +2.222761756894627e-01   +2.362818040666954e-02   +9.701519756938955e-02   +4.221411503615257e-01   +2.446463418124198e-01   -5.949414242860327e-02   +2.751066183367835e-02   +1.422720632083152e-01   +1.279726534414410e-01   +1.000000000000000e+00   +6.950714477796725e-02   +2.777536610726900e-01   -1.560215957928534e-02   -2.189627605603670e-01   +2.534007001464885e-01   +6.208246586701415e-01; +5.217601399262661e-01   -1.568665443721507e-01   -5.899999411371930e-02   +2.963698013348546e-01   -7.036121189962971e-03   -5.326770307959262e-02   +2.579868823451993e-02   -2.396126107116763e-01   +1.349048150861294e-01   -1.215372335406592e-01   +1.436740091818642e-01   +3.957636017680443e-01   +1.307962107668598e-01   +2.685453717749927e-01   +1.060273780161593e-01   +8.993139118641592e-02; +1.560143331755996e-01   +1.263696514245967e-01   -1.417655027209311e-01   +2.219766532386539e-01   +6.009091504200458e-01   -3.682024875942451e-01   +4.015870543302764e-01   -9.995047849954918e-02   +6.515924140608273e-02   +3.237252805159898e-01   -1.290409635090120e-01   +4.673852554749205e-01   +3.077088964355791e-01   -1.204039615097264e-01   -1.362651489165482e-01   +3.631685282853511e-01; +3.021475998716471e-02   +2.677998201418225e-01   +2.796908373685704e-01   +4.475250557445632e-02   +4.409690849714481e-02   +4.247655958778685e-01   -4.331270218942357e-02   +3.272124032905610e-02   -9.981789353952003e-02   +2.362276518992447e-01   -1.296618358353694e-01   +3.189838843942355e-01   +5.210234222362023e-02   -2.211181779775304e-01   +4.273026196171972e-01   +4.596872877602500e-01; -1.273694479584517e-01   +2.559371298515257e-02   -1.711768400928088e-01   -1.121580111457691e-01   +8.831340941564114e-02   +2.322418164611477e-01   +1.687234991684931e-02   -2.920322122571107e-01   -5.897947836590084e-03   +1.183574105763651e-02   +4.446084742876696e-01   +2.116214770206444e-01   +2.686350788448871e-01   -2.032527659695146e-01   +6.245792512708481e-01   +1.033113533784360e-02; +8.833752357174951e-02   +4.065441855565732e-01   +4.346102373439432e-02   +2.012340266594405e-01   +2.080464487325848e-03   -1.419225603565060e-01   +6.061657656937645e-01   -1.123979535827059e-01   +6.294548139309415e-01   -8.341398128516726e-02   +1.721800810673192e-01   -2.921343417547891e-01   +2.228871500170543e-01   +1.240206819253725e-01   -1.625938680610357e-02   +1.627245250736613e-01; +3.887350145966649e-01   +4.905751413631926e-01   +3.905145111389505e-01   -1.191050040756395e-02   +1.508359568357627e-01   +3.267149770032908e-01   +2.240606516119089e-01   -4.701281921806057e-02   +4.665013982559716e-01   +6.670029851445315e-02   +2.634260649656313e-01   +1.057009346526677e-02   +1.049467750382231e-01   -1.714591171249444e-01   +5.651846576981119e-01   +1.811074894636223e-01; +2.800631646470666e-01   +5.077530667044832e-01   +7.197724456375081e-02   +5.340750410118484e-01   -5.342769965305789e-02   +1.805524258500265e-01   +1.535764720962484e-01   +1.450582055579739e-01   +1.710324024578169e-01   +1.079373757770972e-01   -1.692519468006258e-02   +1.739473669441929e-01   +1.252313988662616e-01   +3.174069972346302e-01   +2.540407238864407e-01   +3.718775404036376e-01; +1.363851009610995e-02   +1.000826579624177e-01   +5.549551747341501e-01   +1.500733613765936e-01   +1.934201616974784e-01   +1.065211118637944e-01   +3.029916279719303e-01   -8.058447436767969e-03   +4.502674092519738e-01   +1.522381970838178e-02   -7.989113592904287e-03   +5.598238551265128e-01   +5.974087885571064e-01   +6.867542062504501e-03   +1.304166383134745e-01   +2.750931328448003e-01; +2.466902779292271e-01   +8.052670462932265e-02   +1.510572608863841e-01   -1.427107003865419e-01   +1.566550233169907e-01   +2.709321016926702e-01   +1.928850585601255e-01   +2.746547481411515e-01   -1.632951176071447e-01   +3.718409671419985e-01   +4.780472031088833e-01   +4.478842233507179e-01   +2.037735874230974e-02   +2.006193353614150e-01   +3.551522350261674e-02   +1.708857290634983e-01; +2.012962189190068e-01   +1.739917636950449e-01   -1.115759830397964e-01   +8.082810612381959e-01   +3.320976876757286e-03   +3.061897375486320e-02   +1.178386705750829e-01   +4.571773933984752e-01   +2.288154796062754e-01   -7.134265012955486e-02   +3.086611982468281e-01   +2.602787201206428e-01   +2.842248595989256e-01   +3.380459530454493e-01   +3.755144684289903e-01   +6.464656999249685e-02; +3.297325555235932e-01   +1.297226287650204e-01   +1.620636038140734e-01   +5.212304367909913e-01   +2.193807019296174e-01   -1.188414616845153e-01   +1.228797617483229e-01   +1.863746059816913e-01   +3.110482787288877e-01   -4.358182013239224e-02   +3.747240734225353e-01   -1.801058431734658e-01   +8.345580003832086e-02   +1.815930029644261e-01   +4.079371760660537e-01   -1.180061578570122e-01; +3.758120471558307e-01   -5.384460744956418e-02   +1.235958480917946e-03   -9.604495842164665e-02   +8.921629102880868e-02   +1.336519226856992e-01   +3.921105146679703e-02   -8.947268020049234e-02   +3.465476296337852e-01   +3.487997969903170e-01   +4.026690507718221e-01   +4.017331637560305e-01   +2.419930439378107e-01   -1.924349512640156e-01   +4.001972209232805e-01   +1.335207755812741e-01; +1.298998858071752e-01   +1.971209547067208e-01   +2.647117886744501e-01   -1.340951964473283e-01   +3.547185500564572e-01   +1.919061625183291e-01   -5.416420099074472e-02   +1.679704973043670e-01   -2.333397542148998e-01   +9.479024496922367e-02   +1.372189647509859e-01   +4.581493876994417e-01   +2.527711623157923e-01   +3.218793584968658e-01   -4.875846061162514e-03   +4.410288238765517e-01];
L2I_L1I_iGABA_netcon = [+2.750877720166194e-01   -2.289615980422144e-02   +2.936643901850392e-01   +5.510554756298567e-01   -8.224479641170726e-02   -1.913298345788337e-01   +6.025112304041290e-02   +2.223079878159503e-01; +4.818879243022356e-01   +7.055206548759567e-01   +1.435419064086084e-01   +3.038628456233971e-01   +2.727271945179287e-01   +1.953804237576074e-01   +3.514560698901732e-01   -1.738477207176488e-01; +4.290956817273748e-01   +5.146558182339491e-03   +4.808969508253240e-01   +5.421933703152420e-02   +4.801079276926175e-01   +1.831083703904813e-01   +2.300476161109764e-01   -3.738314085286135e-01; +7.939228650595564e-01   +1.614001734954443e-01   +6.761803791411094e-01   +1.565191612010395e-01   +8.498581168295084e-01   +3.465590712838742e-01   +6.057714622124345e-01   +3.384392182662135e-01; +1.688957849313621e-01   +4.077321580587098e-01   +3.489991259099834e-01   +4.164723194034681e-01   +1.992001519360733e-01   +3.289753409417980e-02   +2.754927735780888e-01   -3.052723870668018e-02; +1.662864113928056e-01   +1.113585988707734e-01   +4.477289035882203e-01   +3.995215037219771e-01   +2.689841394640028e-01   +4.941159539664068e-01   +2.640811811751019e-02   +3.703906558679880e-01; +4.528266536243882e-01   +4.378254744221670e-01   +3.002201739114194e-01   +4.376914371115616e-02   +4.821543635701003e-01   +3.092282580674880e-02   +5.345405619574454e-01   +2.655813968507305e-01; +1.367827468742544e-01   +3.158072303356331e-01   +3.915065775523189e-01   -4.936234410681262e-02   +1.396585706295486e-01   +2.832419651549699e-01   +8.587586071986489e-03   +3.015750956933431e-01; +5.463257743211591e-01   +9.981280156994506e-01   -1.058987513788911e-01   +5.131449582177954e-01   -2.046606897717596e-01   +1.761986846383269e-01   +3.940555848970068e-02   +4.326216295904354e-01; +5.922755940366834e-02   -5.044460264794003e-02   +1.653205937871469e-01   +2.970459619351362e-01   +5.158527371694644e-01   -7.845967944195484e-02   -3.612427338056183e-03   +6.252875470876516e-01; +4.236124879628009e-02   +2.837340735053692e-01   +5.289495465359773e-01   +4.277512505867290e-01   +4.150593858331326e-02   -3.381177192914886e-03   +3.534410897494842e-01   +2.331194507387879e-01; +1.095215746730531e-01   +6.125627863296812e-01   +3.194294918165669e-01   +3.966409378955218e-01   +6.737925911038253e-02   +2.365134325153822e-01   +3.198704415941927e-01   +4.095734554400938e-01; +2.866845134265547e-01   +5.268273088696896e-01   +6.998759226344401e-01   -8.689308964829082e-02   +1.486483556211647e-01   +5.360595480638772e-02   -1.542677345439229e-01   +5.435707248960038e-02; +2.931186171276047e-01   +1.085628727174105e-01   +2.194562142916038e-01   -6.660442905113023e-02   +5.290326818742344e-01   +2.018470564148624e-01   +2.060298904509834e-01   +1.777076297869885e-01; +5.106440217564248e-01   +3.984332874128663e-01   +3.711141314662514e-01   +7.074067661183467e-01   +2.183931937588434e-01   +1.000000000000000e+00   +4.212543303605313e-01   +5.270606166493339e-01; -3.014861826784965e-02   +7.322469733087833e-02   +4.377171455684191e-01   +4.375314506088553e-02   +2.371390336235556e-01   +1.271931091146340e-01   +2.080029107691337e-01   +4.738698302360519e-01];
L1I_L2I_iGABA_netcon = [+2.853718277437877e-01   +2.055151583990809e-01   -1.044417309296458e-01   +4.483222841960146e-01   +9.236868825883039e-02   +8.961374084639784e-02   +1.214437340555625e-01   +5.042078049078544e-01   -3.735442861419145e-01   +5.659220748541030e-01   +2.159880630020719e-02   +3.900644480533234e-02   +4.911115259615104e-01   +2.218860201971014e-01   +2.884558488230056e-01   +4.114821832656481e-01; +4.077935955814916e-01   +2.343807905360897e-01   -1.836317081894621e-01   +2.453131917688326e-01   -1.689304144932035e-01   +2.035902224998943e-01   +6.095928139401439e-01   +2.433318186723545e-01   +3.230302843451691e-01   +6.026344036019700e-01   +8.320572958464524e-02   -2.397298349600183e-01   -9.628954958524545e-02   -6.031057053013389e-01   +2.166751010690245e-01   +5.145993237151690e-01; +6.036802426200395e-02   +5.259379705523620e-03   +4.122609903055497e-01   +2.116110552909738e-01   +1.366574932403003e-01   +2.010937157082653e-01   +4.691590342123976e-01   +3.237833585589434e-01   -2.296225254081196e-01   +5.013999640734899e-01   -1.778080479234968e-01   +3.878091451623128e-01   +4.528384731533043e-01   +3.611024676790520e-01   +6.898938818059683e-01   +4.047618716800401e-02; +5.999560170088905e-01   +2.614899098905040e-01   +2.710103948397088e-01   -9.017051788484369e-02   +6.779880499569524e-01   +2.149285012474172e-01   +6.831998213216823e-01   +5.621530666488638e-01   -1.892051459712779e-01   +4.918134509077997e-01   +5.282173615252698e-01   +5.177637952048251e-01   +3.381990993389895e-01   +1.461969280260826e-01   +3.404234065579704e-01   +1.614113574830770e-01; +9.602008884511265e-02   +1.816025783288823e-01   +1.074376005127699e-01   +3.890578645764838e-01   -6.770291390991040e-02   +8.216464362561173e-01   +5.808379096144285e-01   -1.907964503610327e-02   +5.530179999301900e-01   +4.781365953520129e-01   -3.615511789976192e-02   +2.527231466845289e-01   -2.247786445185239e-01   +3.457490511403597e-01   +3.038809145930557e-01   +7.282068348482300e-01; +1.999784545141378e-01   +3.017011971515942e-01   -5.425889993711117e-03   +6.506612329898739e-01   -1.957367397978760e-01   +4.397689854267164e-01   +4.932749417514005e-01   +2.497205952299195e-01   +2.410655878355512e-01   -2.840360691452397e-01   +5.539261555825947e-01   -1.997754508038016e-02   +6.258372412412243e-01   +7.335535013503809e-01   +5.589744794153858e-01   +1.804956978793361e-01; +2.392712252169119e-01   +6.250120506913248e-01   +2.361738215300628e-03   +4.248482458766160e-01   +1.813697667686712e-01   -1.283286578356374e-01   +3.429942735246073e-01   -7.892679236139050e-02   -1.309918969279999e-01   +5.562500783210865e-01   +3.367378539858680e-01   +1.695062648082586e-01   +5.573556765624561e-02   +9.513712762800622e-02   +3.723691121819545e-01   +4.897459192677681e-01; +4.843633808448305e-01   +2.130556880711343e-01   +3.780883695113301e-01   +1.867921203485079e-01   +4.719510136106885e-02   +5.186205516054960e-01   +5.206057566587368e-01   +3.892275678301317e-01   -1.527849385878176e-01   +2.784295465351748e-01   +9.383115247139404e-01   +5.001413332309883e-01   +3.597324343425780e-01   -6.913382288267164e-02   +2.286210564296764e-01   +3.155607982875392e-01];
L2E_L1E_iAMPA_netcon = [+3.323002468586686e-01   -3.991698834368188e-03   +2.369279473320867e-01   +3.273341777634871e-01   +7.192672024684263e-01   +5.718122669877692e-01   +2.077197398428849e-01   -1.018057699504657e-01; -2.462527647761204e-01   +5.249439957469669e-01   +1.737152049444100e-02   -1.212315459659507e-01   +5.221314214297290e-01   +1.133584539450699e-01   +5.150475395312896e-01   +6.907812252412910e-01; +1.358518176355730e-01   +6.196635755376205e-01   +6.594670945723473e-01   +2.701359906752937e-02   +2.591504984472995e-01   +1.365877506675325e-01   +6.261578676024052e-01   +2.039065741087869e-01; +4.820975349830419e-01   +2.452474653236175e-01   -3.771449977089133e-01   +4.415982399579429e-01   +2.698509253888416e-01   +1.467462989559820e-01   +2.663207418793044e-01   -1.773016784634452e-01; -1.347672568880171e-01   +6.203906079011343e-01   +2.589593795799014e-01   +3.641187116086222e-02   +3.519119427326376e-01   +1.537084506329571e-01   +4.245715638131544e-01   +5.282416238315552e-01; +3.333747424843226e-01   -1.879904408806348e-01   +4.273222227200998e-01   -1.010099718392866e-01   +4.614411503474175e-01   +8.264869208621045e-01   +3.823792179520580e-01   +7.470826431483452e-02; +1.366262485868215e-01   +4.698499894044613e-01   +1.803835514745590e-02   +3.775942358984410e-01   -8.413460691489327e-02   +4.487125683312299e-01   +8.520368851727211e-01   -1.310212708810196e-02; -5.889913688445442e-02   +4.897327108697159e-01   +7.074591168316202e-01   +8.963367510700995e-03   +5.980576431650310e-01   +2.828190523953792e-01   +3.027854291892753e-01   +2.909121104635897e-01; +6.658489720869671e-01   +1.088695850869654e-01   +3.256135414983993e-01   +8.631032457389747e-01   +2.989311846989301e-01   +4.343956168759845e-01   +2.214701679165442e-01   +1.951898102345020e-01; +3.392024611437187e-01   +4.819156296429798e-01   +3.242562645382353e-01   +5.803580918849884e-01   +9.859972995418949e-02   +5.736865245619446e-02   +2.149459356243468e-01   +3.240420867878437e-01; -9.266429446358335e-02   +3.972276178023059e-01   +4.246305864406436e-01   +1.321952685687410e-01   +1.287061812199727e-01   +1.889385179319967e-01   +3.027097121806575e-02   +1.243608661198419e-01; +3.781076937611582e-01   +2.311176386066483e-01   +9.577943414349240e-01   +1.329294675479854e-01   +4.784368251178905e-02   +2.815148700481485e-01   -4.291483377050561e-01   +7.109306601166357e-02; -1.451570807155115e-01   +4.498912605485102e-01   +1.949480980975631e-01   +5.403192483180161e-02   +6.996268805439287e-02   +8.159633596183120e-02   +4.096076611070107e-01   -4.249843189346901e-02; +1.922421216666253e-01   +4.169846658016335e-01   -5.659101792481159e-02   +2.369119353133070e-01   +8.115925871309643e-02   +5.038684336111005e-02   +2.193655409129955e-01   +2.850238874989514e-01; -2.381041411169331e-01   -1.971361609636832e-01   +2.411423228274234e-01   +5.227724398419035e-01   +1.574254950476845e-01   +3.770326979273825e-01   -5.126963217750229e-02   +3.305658204862238e-02; +3.220516416356087e-01   +1.843406216923856e-01   -1.849730325422905e-02   +4.085481425701950e-02   +4.849171051970105e-01   +2.207551769523948e-01   +4.643480513513788e-01   +6.274060132909620e-01];
L1E_L2E_iAMPA_netcon = [+2.173150170146317e-01   +2.602972614016824e-01   +9.521631303840640e-02   +2.782466553623708e-01   +2.106363737893012e-01   +4.548936894067647e-01   +1.429415031531239e-01   +1.818775758901700e-01   +4.194026032846317e-01   +3.066091956753467e-01   +3.955407485675269e-01   +5.111937083637470e-01   +5.527101936352491e-01   -6.745501362685281e-02   -3.908206377753334e-01   -1.547221553778072e-01; +3.597354895580642e-01   -1.213682550650653e-01   +5.559338629139046e-01   +1.463615854639687e-01   +3.163711786389893e-01   +7.292581154982271e-02   +2.825547290440500e-01   +2.480379637635766e-01   +1.593048826364892e-01   +4.379234188854431e-01   +2.234856003940820e-01   +3.671436872802005e-01   +4.064744514978315e-01   +2.949460289949201e-01   +4.826072487734092e-01   +1.579981116248150e-01; +6.871384850659192e-01   +1.628168981277825e-01   +2.098842614979582e-01   +2.302438213043546e-01   +2.899155482863270e-01   +5.699157356437848e-01   +3.728201647154261e-01   +2.697121185019311e-01   +2.283191086322846e-01   +6.576776129375793e-02   +2.569515914861287e-01   +5.802804671809522e-01   +8.143703502806685e-02   +4.439135607032884e-01   -1.452226692799027e-02   -2.189964719753046e-01; +2.859084000894592e-01   +6.276285228840800e-03   +4.049229554407270e-01   +4.872235559366064e-02   +7.360347821681426e-02   +3.428566819093929e-01   +8.884798434520074e-01   -1.307596267797088e-02   +1.442475471526228e-01   +1.308446713374834e-01   +3.683549029857084e-01   -1.898368564589045e-01   +2.502842479207171e-01   +4.672536729788133e-01   +3.827089410717617e-01   -6.100423744471850e-02; +1.142619191614499e-01   -2.054373995080499e-01   +6.622390114477223e-01   +6.406546704670535e-02   +4.812875172228085e-01   +1.827700130778702e-01   +6.592322389431411e-01   +1.274876286150376e-01   +1.900677738947936e-01   +2.622468697735526e-01   +8.988665540631238e-02   -2.861611417569843e-01   +2.758226402061370e-01   +5.572429279850658e-02   +8.705208646646222e-01   +3.488236252506921e-02; +9.650401686736723e-02   +4.931397431044975e-01   +3.444506105585388e-01   +4.002184529553840e-01   +3.835376099106411e-01   +6.307560862974072e-02   +3.819016467634002e-01   +3.348025664330486e-01   +7.043451076882146e-01   +2.710018856520586e-01   +4.561969709342784e-01   -9.486914532780906e-02   -8.497579013667687e-02   -4.455022336859127e-01   -2.561187709906154e-01   +5.127745674979566e-01; +1.415888041685259e-01   -2.790690902563567e-02   +1.114092691094871e-01   +5.760756959656208e-01   +3.215965274655215e-01   -2.284023080246212e-02   +7.698133682078873e-01   +1.387416368549246e-01   -2.314788024913373e-01   +2.469586838687285e-01   +1.217699747818048e-02   -2.486181376185628e-01   -3.096027147649741e-01   +2.541626005184315e-01   +4.954452750471690e-01   +9.577209929156996e-02; +2.584850950080320e-01   +2.066589865406416e-01   +1.933703833692544e-01   +6.794040387352633e-01   +2.778013956356421e-01   +8.290090739695154e-01   +5.172249806189346e-01   +2.169321651267622e-01   +2.068812366119650e-01   +4.802260288466390e-01   +3.582032208236938e-01   +3.126077927554435e-01   -6.181685720410986e-02   -1.097902857250240e-01   +3.557813013935220e-01   +1.504069836159701e-02];
L2I_L2E_iAMPA_netcon = [+2.899993295427604e-01   +4.550364183788748e-01   +5.839872304581224e-01   +2.112121575308925e-01   +9.500588997981069e-02   +5.954880258674092e-01   +3.021281020825019e-01   +5.475859130175611e-01; +4.272144993302514e-01   +1.796016234894131e-01   +6.100047987441585e-01   +5.089778765932211e-01   +3.846805997434722e-01   +1.073894521071350e-03   +1.743605235499550e-02   +8.050810321766617e-02; +2.117144970588104e-01   +6.001202445091494e-01   +2.749370892838381e-01   -6.002735348868152e-02   -1.391939322859888e-01   +2.932175888772931e-01   +3.537995213580921e-01   +6.956863841105677e-02; +1.708026307838932e-01   +3.058508810746257e-01   +2.011414579790459e-02   +4.042089692365086e-01   +3.140852411611827e-01   -1.946545805477141e-01   +2.281084531122864e-01   +7.129048339435292e-03; +4.229799809500280e-01   +7.287703719977989e-02   +6.224562015984952e-02   +3.327992931031208e-01   +2.572717056543620e-01   +1.009253351587271e-01   +4.770449707869013e-01   +2.466928166234036e-01; +2.907366962741093e-01   +2.426045317963774e-01   +1.760552283801923e-01   +3.035283590185376e-01   -1.018846085712989e-02   +3.005081438696329e-01   +5.269829071440010e-02   +1.448528210930655e-01; +3.341357163270098e-01   +3.526015810403144e-02   +1.961971451605819e-01   +4.960749898927365e-01   +2.515283685358659e-01   +1.889897565165566e-02   +1.000000000000000e+00   +1.465290030634648e-01; +5.604281933817058e-01   +1.058922141485072e-01   -1.763925986236316e-01   +2.494441642553406e-01   +8.711103796105306e-02   +1.727462508706370e-01   -1.813579384705330e-01   +2.461834183415766e-01];
L2E_L2I_iGABA_netcon = [-1.137071698729751e-01   +3.916187342523121e-01   +4.868886609037441e-01   -2.355305981951633e-02   -9.413672518681047e-02   +2.655699871997763e-01   +6.828223682672996e-03   +3.964121625959720e-01; +4.783205113065839e-02   +1.743156951215362e-01   +2.514132648283227e-01   +3.260727176524499e-01   +4.539042108977123e-01   +4.112150597990892e-01   -4.452737806054759e-01   +2.483729659799448e-01; +1.140290026666407e-02   +7.278026994522094e-01   -1.080070205249840e-01   -5.263561527624865e-02   +3.197579783283775e-01   +6.040930246396249e-01   -3.345120112282700e-02   +8.117815750883767e-01; -2.217319865435878e-01   +2.214465225676393e-01   -7.807807555068343e-02   +5.775522413969326e-01   +6.801085837361618e-01   +7.096663409731439e-02   -5.125146843332085e-02   -2.224459012352139e-01; +1.077813439016533e-01   -5.445172843567242e-02   -1.423497889352728e-01   +4.470249439949718e-01   +6.765708300433263e-01   +1.949128880519665e-01   +2.641705723152235e-01   +1.694754603796239e-01; +3.214707792386416e-01   +3.127692760803369e-01   +3.890129418170339e-01   +2.889696200157968e-01   +3.161558173210836e-01   -8.972602513990749e-02   +2.313987288891847e-01   -3.921173992633156e-02; +2.871296452038654e-01   +4.011277240718808e-01   +4.404086188666403e-02   +1.370818201010944e-01   -1.211530541183566e-01   -6.438098194112199e-02   +2.355492244527940e-03   +8.564529226993757e-01; +2.830760751089041e-01   +5.400755212544558e-01   +4.858014303431688e-01   -1.958377020566504e-01   +4.742341912435660e-01   +2.835043622402676e-01   +4.220173421416539e-01   +4.225730990186246e-01];
L3E_L2E_iAMPA_netcon = [+6.507962875900331e-01   -2.090370987835481e-01   +6.249382422639328e-02   +1.781456002317227e-01   +7.372459452533585e-01   +3.230194415830656e-01   +4.421147714348380e-01   +4.511711792062515e-01   +2.841841867005992e-01   +3.266221166367177e-02   -5.478126957709367e-02   +1.846645959057035e-01; +3.599445682042215e-01   +9.104710814852409e-01   +2.462812128424191e-01   +4.442701549569630e-01   +1.079067634318178e-01   -4.093535042692445e-01   +1.826653973471793e-01   +7.034251979987104e-02   -2.255369600778565e-02   +6.206069277231034e-02   +1.891406254540128e-02   +3.098354100258704e-01; -2.199044320322624e-01   +1.584207043269316e-02   +7.524833652101749e-02   +2.890664797859356e-01   +7.751750975083154e-01   +4.930870115519808e-01   +3.783966838522324e-01   +3.670216168362967e-01   +5.366568780308393e-01   -3.673867641059665e-01   +3.481776905574424e-01   +7.764068606745431e-01; +2.067061690933824e-01   +3.059625531555439e-01   +3.117120227328937e-01   +1.203810447657119e-01   +4.889074622704197e-01   +8.673036739208578e-02   +3.001420084246083e-01   +2.134132816607850e-01   +1.991028755324820e-01   +6.028661891424358e-01   +1.297806728256238e-01   +1.627276265595945e-01; +5.327354637977179e-01   -1.366024134889036e-01   +3.989993803878001e-01   -2.489380586688573e-02   +1.000000000000000e+00   +2.183467799383245e-01   +4.730695764444433e-06   +9.910945364475861e-02   +3.852002016842279e-01   +6.044531153847035e-01   +7.415827991590008e-01   +6.396092988191592e-01; +7.280966237900092e-01   +6.112468875734074e-01   +2.527795004065649e-01   -1.369946705764269e-01   +2.099570286133225e-01   +7.204666630975715e-01   +2.741404420094067e-01   -9.458761172725613e-02   +1.030996858532242e-02   +5.485874584062926e-01   -8.813920684946279e-02   +5.240350952496198e-01; +2.818965663624367e-01   +1.312762309727745e-01   +8.336459574184183e-01   +4.865645062202009e-02   +1.313059959848741e-01   +4.000356127958511e-01   +1.247043137335307e-01   +5.318121825032628e-01   +5.487554523302098e-01   +6.609343297971831e-01   -4.369477673371804e-02   +2.563555910004439e-01; -1.593587949783141e-01   +7.927158504990349e-01   +4.747772263682945e-01   -3.786383472013118e-01   +7.864245085418159e-01   +1.780087632010293e-01   +1.994491132738952e-02   -2.628770884837259e-02   +5.721164060940930e-01   +4.913585148507805e-01   +2.490321154702617e-01   +8.871796714255240e-02];
L3I_L2I_iGABA_netcon = [+6.837752132127513e-01   +4.757328208409687e-01   +2.502217960689090e-01   +4.246588446885621e-01   -3.039429187338740e-01   +3.172904219479961e-01   +6.419554261011328e-01   +6.234886560603693e-01   +1.000000000000000e+00   +1.952421922572774e-01   +3.336501834188171e-01   +3.809449410916737e-01; +3.657654373576009e-01   +1.064597435750870e-01   +1.554369450529638e-01   +1.823880761681519e-01   +5.274290214616429e-01   +3.347130470504546e-01   +5.332531952710959e-01   -1.027406556427641e-01   +2.914232977581910e-01   +1.075356593579803e-01   +4.090569101088358e-01   -3.259206044751517e-01; -3.332779791328869e-02   +5.198580330437557e-01   +5.421712343442828e-01   -4.908065347396300e-02   -3.914651495587253e-02   +7.965066071385779e-02   +6.044012173102088e-01   +6.471904358452510e-01   +2.853400720939647e-01   +1.075513245787544e-01   -2.126607660849912e-01   +7.434650353297627e-01; +3.882647434856762e-01   +3.176742002544745e-01   +4.595163881560971e-01   +1.406357614583610e-01   +2.415976285834233e-01   +3.512437256574252e-01   +1.097627444583411e-01   -1.573679018244133e-02   +3.743904532692094e-01   +3.334540856591898e-01   +5.193261157912860e-01   +3.528754851627912e-01; +1.903655912926517e-01   +3.183950982842677e-01   +2.576304399503560e-01   +5.356777507532499e-01   +5.478634583952304e-01   +4.437277398450798e-01   +1.936108196038785e-02   +9.721412903535610e-01   +6.470525551136662e-01   -3.878986629332279e-02   +1.041593368406385e-01   +4.444730471693965e-01; -8.896311908179924e-02   +4.382862225484411e-01   -1.525943220374049e-02   +4.592046285450631e-01   +7.057460936884763e-01   +3.954893848193439e-01   +3.255862821925420e-01   +8.452462556589366e-02   +2.609475814027851e-01   +1.126814808705264e-01   +2.743865422456589e-01   +4.844948209849668e-01; +6.197213730087960e-01   +3.293121249481191e-01   +5.563811819485317e-01   +2.013721969714135e-01   +1.318854515445557e-01   +4.756491683851601e-01   +3.790940656634119e-01   -4.115314175700362e-02   -2.643786680130654e-01   +6.076994696014858e-01   +5.913655648462134e-01   +2.988292164855905e-01; -1.413613730988893e-01   +3.325223852437956e-01   +7.507709248821445e-01   +7.056061450478635e-01   -3.359225656585702e-01   +5.504728990236296e-01   +7.258711383890954e-01   +3.950921377399531e-01   +7.628927239118548e-01   +2.963861826811139e-01   +6.632733272430414e-01   +5.023399714346868e-01];
L2E_L3E_iAMPA_netcon = [+6.209477859600140e-01   +1.050963147883748e-01   +1.396601500077753e-01   -1.314180033403479e-01   +1.791519062433966e-01   +1.078128713137031e-01   +4.114179562243154e-01   -4.970551570726310e-02; +2.329630147091812e-01   +7.918378563007422e-02   +5.625034344237060e-01   +2.881185261876507e-01   +4.127941316011371e-01   -3.463028848935622e-01   -1.693397481149990e-01   -3.538500629557610e-01; +4.810241235545205e-01   -3.050547795907839e-01   +3.655175973297756e-01   +6.900574561107249e-01   +1.275796177000242e-01   -8.858517455899945e-02   +3.789268389844344e-01   +2.803052661519663e-01; +1.013940167659680e-02   +1.398880216420917e-02   +7.096939821098542e-01   +8.058573844954345e-01   +7.362627458062887e-01   +6.547229647841105e-01   -1.347561923770345e-01   -4.042327279998745e-03; +1.941739498974789e-01   +3.173352499113828e-01   +3.345789110200819e-01   +8.086245176127730e-01   +7.056300638598725e-01   +2.206651603205725e-03   -9.225291044383060e-02   +5.542089814128598e-02; +4.238298273335746e-01   +8.435801142386841e-01   +7.183895171358720e-01   +6.353176287035828e-01   +6.247726286954045e-01   +2.424770618498323e-02   +5.339742890036651e-01   +1.126669833954421e-01; -6.422904595434198e-02   +3.246218589848516e-01   +7.688864118750244e-01   +1.082660469196742e-02   -1.457419696918058e-01   +1.302623285673661e-01   -1.697797322599193e-02   +4.386427282319454e-01; +4.318914826779098e-01   +2.479174690144410e-01   +4.100070444420287e-01   +8.027265693115412e-02   +2.678920252660713e-01   +1.923337770169678e-01   +2.600280649416460e-01   +8.308400433799669e-01; +5.418507321623588e-01   +2.907923685025629e-01   +3.483724627439482e-01   +1.873858844412568e-01   +2.494798084518563e-01   +8.354773707804586e-02   +6.447012399538337e-01   -2.839131505352259e-01; +8.456807573511625e-02   +1.438421404037769e-01   +3.884248127477891e-01   +2.089201086689779e-01   +2.252160888166191e-01   -7.998807518122528e-02   +4.878631127509877e-01   -7.927714712760774e-02; +3.881879181646675e-01   +1.753883223532885e-02   -1.370753270651777e-01   +8.384069305451493e-01   +2.753924319613249e-01   +2.410797443108605e-01   +2.176133838742740e-01   +5.772156023757858e-01; +1.652628841172120e-01   +9.880973252308016e-01   +6.200128443372687e-01   +6.005925781333380e-01   +2.983243784312524e-02   +1.946645339034765e-01   +4.859966614641749e-02   +4.874737767340565e-01];
L2I_L3I_iGABA_netcon = [-3.501073890757841e-01   +1.338238379666442e-01   +4.710417116541783e-01   +5.066047074311876e-01   -7.353910528276213e-02   +6.347416734802040e-01   +2.795632269028298e-01   -3.562125015139992e-01; +1.080256085962309e-01   +2.088287414748698e-01   +2.971039267189685e-02   +9.913207540345578e-02   +3.318926098167330e-01   +3.719712167920364e-02   +3.276084955026062e-01   +1.319067617269453e-01; +7.422368373421979e-01   +6.870618769932525e-01   +1.681906498306452e-01   +5.265413225387157e-01   -1.043449351987922e-02   +9.540578980536857e-01   +3.875978447753323e-01   -1.890822288752886e-01; +1.657683121012139e-01   +2.868155816094823e-01   +7.007979235120304e-01   -1.769455187634373e-01   +2.184560317626637e-01   +5.733504362109837e-01   +8.177187014065397e-02   +5.785654845609266e-01; +7.900419799310137e-01   +4.560057308733660e-01   +1.125248936195126e-02   +4.157920574074406e-01   -1.149217443898637e-01   +2.890615960207148e-01   +9.348608638404562e-02   -1.652587214733905e-02; -1.478929785890203e-01   +4.543880819146680e-01   +5.402930686020864e-01   -3.756764506297138e-01   +4.056212633471813e-01   +7.818188294611894e-01   -1.872957436506119e-01   +3.231083473065274e-02; +5.591721269058384e-01   +4.258219539860275e-02   +3.068426808417402e-01   +2.017978616716366e-01   +2.510351118482064e-01   +6.380114378847013e-01   +6.165692712214444e-01   +3.107966513112598e-01; -2.134000306484232e-01   +7.701155430225153e-01   +1.371526955045756e-01   -4.135707340294686e-02   +2.223893930164523e-01   +5.324617307629349e-02   -2.957398788972501e-02   +7.799005905033611e-01; -8.011121314158340e-01   +7.122336489499430e-01   +6.511026290861582e-01   -3.515513837722414e-02   +1.611244543630745e-01   +4.552211726405950e-01   +3.909689449728876e-01   +4.832084460969409e-01; +4.044462373164477e-01   -2.531426806163787e-01   +3.097570659468637e-01   +2.024135274119970e-01   +4.785134998925900e-01   +6.006918871096782e-01   +1.218261434260113e-01   +4.761299411758802e-01; +8.969871078216172e-01   +2.344305382267017e-01   -3.379268329720784e-01   +1.917291470678425e-01   +3.998469113440816e-01   -6.311891286864879e-02   +5.063333754203192e-01   +9.967397832722592e-01; -4.065114721333679e-01   +6.072277870410159e-01   -3.784035392680811e-01   +6.929165625929424e-01   +8.045952959677486e-01   +2.638786775443204e-01   +2.146649785194865e-01   +2.801144848677308e-01];
L3I_L3E_iAMPA_netcon = [+3.791862848828009e-01   -1.222530246278677e-02   +1.505496034843619e-01   +4.028313628050393e-01   +4.181041997523668e-01   -9.764239200249100e-02   +2.929455148245230e-01   +1.130634291603300e-01   -2.379773109383915e-01   +4.623176467928701e-01   -7.193720363165931e-02   +6.839622033214596e-01; +2.352752920224192e-01   +1.772660142123684e-01   +2.629345820803515e-01   +7.117351123479261e-01   +5.889178926360814e-01   +6.225365494251010e-02   +2.141127682531912e-01   +2.916929823231122e-01   +5.100777646903842e-01   +2.889109623516013e-01   -6.829994877244774e-02   +1.749611407068086e-01; +4.996515001154718e-01   +5.158231259649355e-01   +5.076512667758373e-01   +4.519162458413530e-01   +8.952540205178232e-01   +3.219625370746908e-01   +7.013901773089837e-01   -2.364972746543421e-01   +3.523293662701504e-01   +3.992566919890524e-01   +1.235646424326782e-01   +4.928382971713565e-01; +4.087648873535134e-01   +5.208664224179007e-01   +4.409411401233279e-01   +1.356148264408566e-01   +1.553245749060448e-01   +8.750043460082756e-01   -2.818003027372806e-01   +4.152790412476325e-01   +3.976841277601267e-01   +3.255230411105192e-01   +1.554488464352059e-01   +3.030587826682669e-01; -9.956116566693257e-02   -9.528492579661388e-02   +8.010143378839796e-01   +9.946346242770679e-02   +5.000744648104993e-01   +2.843316129413590e-01   -7.291380318843885e-02   +3.993649035797310e-01   +6.487592032306848e-01   +7.192768355005510e-01   +2.164331278503696e-01   +2.485150726087351e-01; -2.368322283420270e-01   +1.933321033719411e-02   +1.555805346162472e-01   -1.804742249512062e-03   -3.721700075399645e-02   -2.171965478546928e-01   +4.224023101599320e-01   +2.832814898692358e-01   +3.382729898782351e-02   +2.648665703558532e-02   +1.937484761547809e-01   +3.154289227024209e-01; -2.890070863566455e-01   +8.718617971725726e-02   -1.177915569361050e-01   -7.954642298480422e-02   +5.689849037111717e-01   -7.604805280369817e-02   +4.757272236409861e-01   +5.472833551534567e-01   -3.655377582785196e-02   +3.858695848208427e-01   +5.976942061010975e-01   +1.032799422093496e-01; -2.648777931614762e-03   +3.144788013893065e-01   +3.147156672152135e-01   +1.828327653607268e-01   -8.624770888646326e-02   +1.112319704760721e-01   -1.628080560595535e-02   +6.498599813868778e-01   +5.364248762076501e-01   -3.728311791598992e-01   +7.108003517105040e-02   +4.468761196539871e-01; +7.319983832160508e-02   +7.452114811398618e-01   -1.451497865966503e-02   -7.967902246563713e-03   +2.218133488186750e-01   +7.576162285475108e-01   +1.256705876474594e-01   +5.799429070013438e-01   +1.463963953718408e-01   +3.085419112719980e-01   +6.589759217495296e-01   +8.369803958092370e-01; +9.090394966237398e-01   -5.813034172620810e-01   +9.145071625483384e-01   +3.185154294193651e-01   +3.029065968976432e-01   -3.169540271348960e-01   +4.099965536085141e-01   +2.366491141167477e-01   +1.640511603068155e-01   -2.563239400398921e-01   +9.620511459890201e-01   +8.720709103567822e-02; -3.516836213902962e-01   +1.754387181111719e-01   +7.449370161750475e-01   +6.207440401138983e-01   +3.925166140743784e-01   +2.282281682198150e-01   +2.046755788235669e-01   +4.631441398581129e-01   +9.665595603236925e-01   -1.037962616409892e-01   +7.815062433110329e-02   +4.931842726115466e-01; -1.982750707345314e-01   -5.705609465693404e-02   +3.229418293445272e-01   +1.535890437099810e-02   -3.191850760019638e-01   -1.750116834136349e-01   -5.527186474848700e-02   +1.225825730351373e-01   +6.737645260914052e-01   +8.955262501645782e-03   -6.827189526950328e-04   +3.221619506066067e-01];
L3E_L3I_iGABA_netcon = [-2.066930609081939e-01   +2.381563125118163e-01   -7.780943535485696e-02   +4.068062692992145e-01   +3.808709344074337e-01   -8.397041682987018e-02   +2.902437931138214e-02   +1.742610258577056e-01   +1.980259677550300e-01   +3.237141303635269e-01   +4.149086834060254e-01   +1.079325024805552e-01; +5.024252382414247e-01   +3.282024687160844e-01   +1.544105504392763e-01   -1.229844253049876e-01   +2.626821554402580e-01   +1.372382343589664e-01   +1.327710283909820e-01   +3.320882239863968e-01   -1.945903053937942e-01   -6.888530302241204e-02   +8.627608278206862e-03   +2.061707239772471e-01; +8.629760016361129e-02   -7.862864283670900e-03   -1.462410974053222e-01   +1.756156498381790e-01   +3.118556666745597e-01   +2.579714961741311e-01   +2.663705104853599e-01   +3.417421935847423e-01   -1.177111380512985e-01   +4.907249281056041e-01   -2.852630246127771e-02   -2.624748520851363e-01; +2.655668232028196e-01   +4.260267274771429e-01   -2.475361167990525e-01   +3.025980652216992e-01   +8.124179987715546e-01   +6.798898346857025e-02   +6.921512409616316e-02   +2.241701034258925e-02   +7.393872563660797e-01   +4.919429024139022e-01   +1.383389184324373e-01   +2.495543784706475e-01; +3.336610035414205e-01   +4.998491784177624e-02   +1.524196938366707e-02   +3.845840270055166e-01   -7.795128353461583e-02   +2.514975946262815e-01   -2.981840748665173e-01   +6.110625400091931e-01   +2.877372528526889e-01   +3.791962215783857e-01   +3.714529646110814e-01   +3.380393091568145e-01; +4.101869646631653e-01   +4.153335485376727e-02   -1.703070863847232e-02   +7.789312882761847e-02   +2.281160933951721e-01   +7.287896444397507e-02   -1.506897460891871e-02   +3.016141115970103e-01   +5.729450711663467e-01   +3.447885136332863e-01   +1.432257806157514e-01   -2.347752258799911e-01; -1.819050712044707e-02   +2.296474724167800e-01   +6.995321590773640e-01   +1.000000000000000e+00   +1.867262225071817e-01   +1.818646505417151e-01   +6.727238793495406e-01   +5.024463893985159e-01   -4.797536647668374e-02   +4.716508723350540e-01   +6.093756315582221e-01   -5.274437987113886e-02; +2.801295831595094e-01   +1.235221419163400e-01   +5.485818510262015e-01   +1.424656036721163e-01   +2.632575094130712e-01   +1.433025136219965e-01   +1.450707529925920e-01   +5.691374159860595e-01   -1.135313489866240e-01   +5.028200941395410e-02   +4.110006071230079e-01   +4.022158585058961e-01; +5.539845614894268e-02   +1.377019822479676e-01   +2.280046886186789e-01   -1.088770714769760e-03   +2.156947301490277e-01   +1.717336748055073e-01   -3.095670266628794e-01   +1.282783278017364e-01   +3.813170066271990e-01   +6.050196823567144e-01   +5.462750584909450e-01   +5.427619316444909e-01; +2.499463807298361e-03   +8.582118955943753e-02   +4.404078359608707e-01   +1.892756906688640e-01   -3.973014349052049e-01   +3.070738101141725e-01   +4.172212985691873e-01   -3.316088515658419e-02   +1.063785502312942e-01   +2.425942316593320e-02   +1.664326551371107e-01   +2.162820602085993e-01; -7.156440485045761e-02   +2.166293671450319e-01   +3.959200310172915e-01   -1.469318346526942e-02   +2.353600615143887e-01   +5.278095976694283e-02   +3.560829226870278e-01   +1.842431706738273e-01   -3.099733899907845e-02   +1.763935786139680e-01   +3.676273708996778e-01   +1.815702830288781e-01; +6.823675976290490e-02   +3.128591847648503e-01   -1.336220369327886e-01   +1.978832979122870e-01   +8.174655013078209e-01   +3.749172776012675e-01   +5.087482640301165e-01   +2.235976564328621e-01   +1.332451741498515e-01   -1.990985195709571e-01   +1.947382970267448e-01   +1.082867776304576e-02];
L2E_Input1_iAMPA_netcon = [+5.752658295415536e-01   +7.189426599693146e-01   +8.121121760476472e-01   +8.064231519102858e-01   +6.882874987873216e-01   +8.185328826779567e-01   +7.162184886446021e-01   +7.236408218827609e-01];
L2I_Input2_iAMPA_netcon = [+6.749588846408493e-01   +5.812039927883543e-01   +7.829687343792816e-01   +9.525621716207889e-01   +1.630112604270096e-01   +8.949292035550893e-01   +2.867466081014937e-01   +1.633754374304086e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.2*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.2*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.2*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.2*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.2*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.2*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.2*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.2*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
