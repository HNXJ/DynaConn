function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-4.503199907689733e-01   +3.992812514070975e-01   -3.888450715160525e-01   +2.341988331698702e-01   -6.658933123333451e-01   +1.972937382180146e-01   -1.917292716613939e-01   +5.549528260928562e-01   +1.475307716981128e-01   +3.068704163531884e-01   +4.919897128244604e-01   +6.093872491090133e-01   -4.246942034396556e-01   +7.319741665509583e-01   -4.835640060049958e-01   +1.471352260706534e-01; +8.047826755770024e-01   +3.834300086600278e-01   +2.764906757678543e-01   +6.351013825153208e-01   -6.327404636000920e-02   +1.303020829634468e-01   +5.186074153384889e-01   -2.973203218942979e-02   +1.824330566023532e-01   -7.572946412783168e-01   +7.956758130674504e-01   -4.814407665635682e-01   -3.042589673060079e-01   -3.276394561494224e-01   -4.115982110531139e-02   +6.873270593780720e-02; -5.314038736440843e-01   -2.433734493194729e-01   -3.690284625417049e-01   -3.336075526607226e-01   +6.948807885864970e-01   -4.277999282293961e-01   +5.327706028507146e-01   -4.091660705263401e-01   -7.904832769289467e-01   -7.765041822625901e-01   -2.187773684393057e-02   -1.759936710780726e-01   +1.499909874531039e-01   -3.285182914781986e-01   -2.087737326246778e-02   +4.233627672920677e-01; +7.271913704260385e-01   -6.503281652235743e-01   +5.900906889629152e-01   +3.679229336414511e-01   +1.284887947794801e-01   +6.032210836090872e-01   -3.985707252919754e-01   -1.500537360797875e-01   -5.654483607027843e-01   +2.165775616893937e-01   +4.387513058388404e-01   -6.893419684774652e-01   +2.041886025513203e-01   -2.773733244606219e-02   +1.668748943428680e-01   -8.006900182731844e-01; -2.529756181451640e-01   +5.460555702271327e-01   -2.688802328568977e-01   -1.402470232658639e-01   +2.005634403836031e-01   -1.106725599182137e-01   -5.637011556448054e-01   -8.379771770719713e-01   +4.076856216087235e-01   -3.521530028000298e-01   +3.884356795313788e-01   +4.640666951614444e-01   -1.863232437307809e-01   -1.870287383561434e-01   +4.507737696664700e-01   -1.868567071482172e-01; +1.751970499212150e-01   +5.313282835695964e-02   -9.750272796674513e-01   -5.070389438358528e-01   -5.132290751682530e-01   -4.264530690331943e-01   -4.466781080184711e-01   +3.670690332903079e-02   +3.602127693876702e-02   +2.096207183829014e-01   -2.456335304161590e-01   +2.207771392132800e-01   +8.073203638893141e-01   -2.279440463499828e-01   +7.694492789311583e-01   +4.183968269220648e-01; -5.967110039780139e-01   -2.149284155841816e-01   -9.672089628835083e-01   +3.676214281784696e-01   +1.058362406338028e-01   -7.877640079273095e-01   -3.836915822373395e-01   -6.949593410480394e-02   -7.335984968882115e-01   -2.724267503411206e-01   +5.321110770593500e-01   -1.525218309447895e-01   -3.218345219236006e-01   -4.188360463066433e-01   +6.942051851041010e-01   -5.923232627983520e-02; +7.041936086675845e-01   +5.521206665425612e-01   +4.170809563029834e-01   +2.490677033568783e-01   -6.504925073868313e-01   -6.006296266048715e-01   -6.722237425226685e-02   +5.648255808206477e-01   -5.190677968862868e-01   -2.874155894582883e-01   -6.885931496133896e-02   -4.017637517060474e-02   +4.763763752869154e-01   +4.801811241735860e-01   -3.414534308825250e-01   +4.358516674894730e-01; +1.151513301635218e-01   -3.800488325947361e-01   +5.509875012811651e-02   -7.466237268189032e-01   +3.096618535114508e-01   -2.872540456516126e-01   -1.499589203902053e-01   -1.664062348956797e-01   -1.823364934595295e-01   +4.637631909362487e-01   +2.693606641110358e-01   -4.787345599147659e-01   -3.470722686611376e-01   -3.654048517886431e-01   -5.605148070413778e-01   +1.532551499351577e-01; +4.615912235662551e-01   -1.380800776594134e-02   +1.729396581991881e-01   +1.356243675833312e-01   -7.032823177905252e-01   +4.069715189725693e-01   -8.999599545044646e-01   +2.002844850350080e-02   -2.646038022094472e-01   +2.394100564166244e-02   +4.666981801308382e-01   +5.226363012337120e-01   +2.721839503045420e-01   -2.467541765337478e-01   -3.267976854141545e-01   -5.777908399318876e-02; -1.456520478459395e-01   +6.907534167907493e-01   -3.156284139646280e-01   -6.088647378828200e-01   -8.820929710376675e-01   -3.345039120585626e-01   -4.087025031479340e-02   +6.094829517001199e-01   -5.031812646558471e-01   +5.423512097489660e-01   -6.416764278218030e-02   -4.757927314930410e-01   -1.823394298666566e-01   -5.997729709941109e-01   -7.914880710876843e-01   -9.941999377778231e-01; -4.975911350286956e-01   -4.829124300099664e-01   -1.159047644413311e-01   +2.643568816626334e-01   +5.169993232312547e-01   -1.254167504499170e-01   -4.975689404581523e-01   +4.644360958182094e-01   +7.572148568015055e-01   -1.683569628698153e-01   +1.752993850809225e-01   +5.430926716659378e-01   +2.899658271777369e-01   -1.162582020969513e-01   +5.627271079921334e-01   -1.919856226597278e-01; +8.061426473859410e-01   -2.335712936161652e-01   -4.405929646756054e-01   -8.846671310927154e-01   -2.409649279173301e-01   +3.307565429076516e-01   -6.430126696640656e-01   +2.467258600490720e-01   +1.396541101969295e-02   +7.573885192264749e-01   -4.185986284201874e-01   -3.345694037553083e-01   -4.407444021854151e-01   +2.352089666798274e-01   -2.745933365564474e-01   +6.900539014518067e-01; +4.026761294988359e-01   -3.539763906788738e-01   +5.135477311817962e-01   +7.654933175052238e-03   -3.167213260957737e-01   +3.672802583933317e-01   -2.458303465345866e-01   -3.278655181450102e-01   -2.998863105022423e-01   +3.906804075600608e-01   -2.947254320582462e-01   -2.133460030277098e-01   -2.541634414672395e-02   +5.811917118148764e-01   +5.037063600385525e-01   +5.624999492854876e-02; -1.705542490836643e-01   +6.425721415631513e-01   +3.528203744158103e-01   +6.165744197979637e-01   +6.532161314614020e-01   +5.401203816558487e-01   +2.721395938981455e-01   -6.391972043801174e-01   +2.578027145359322e-01   -2.109268031685805e-01   +3.169858976246918e-02   +2.860594223367874e-01   +1.838081585294085e-02   -4.120078378242752e-01   +1.719843182016554e-01   -1.480135702787631e-01; +4.403832768973744e-02   -2.630832898615195e-01   +7.442922586210406e-01   +2.970948237746630e-01   +5.563875758992460e-01   -4.064992396277854e-01   +3.144270811414692e-01   +1.381494583869570e-01   +6.216625267475480e-01   +5.997429115486304e-01   +8.937765023882590e-01   -5.870355179107951e-02   -3.829846121887599e-02   +5.345324491158951e-01   -3.693989892236884e-01   +3.917311628786037e-01];
L1E_L1I_iGABA_netcon = [+5.758886802569019e-02   +3.877633053164736e-01   +1.759053300097306e-02   -8.402056404027308e-02   -4.424577315060629e-01   -1.350557459453256e-02   -5.945161380411350e-01   -1.745332802876781e-01   -7.194214793886387e-02   +5.099228406576730e-02   -4.365462654867577e-01   -7.311668719782649e-01   +4.118817718931465e-02   -7.518318728068708e-01   +5.176755457166075e-01   -1.708147206698576e-01; +4.501115711449886e-01   +1.918166934532946e-01   -7.905001949360163e-02   +2.955150141626733e-01   +2.625729830873573e-01   -4.137672106652578e-01   +1.102092318535573e-01   -4.268422467245418e-01   -7.150335608639233e-01   -1.634266832430322e-01   +8.506446341585898e-01   -8.970966805945291e-02   -6.309532083457764e-02   -1.264169764003542e-01   -4.544172563436470e-01   +1.762129822428130e-01; -3.749643535547106e-02   +8.283718459219934e-02   -1.889628932492722e-01   -6.477127164486646e-01   +3.672667716036049e-01   +2.891224337258566e-01   +3.098355053191760e-01   +6.146726180081475e-01   +9.725758911962790e-01   +2.662610928474696e-02   +3.077018347273691e-01   -4.703097457969665e-01   -5.645795994726379e-01   +3.260620043874236e-01   -1.369257674759249e-03   -3.446813313330140e-01; +6.386486777879881e-01   -6.450436368459019e-02   -2.690447558203894e-01   -7.881498395403813e-01   +9.350846730723811e-02   +6.916784314706283e-02   +7.501715515685221e-01   +1.755403162023642e-01   -3.557921557447547e-01   -6.261359998206346e-02   +1.485527757671956e-01   +3.707894048678937e-01   -3.451062093815092e-01   +3.712978291900542e-01   -1.439807070849623e-01   +3.814031430589104e-01; -5.589438368050216e-01   -4.405705258525199e-01   +2.095786773210135e-02   +1.516358291840347e-01   +4.258673266444135e-01   +2.304558574587003e-01   +1.520672235215572e-01   +7.102661537338694e-01   +6.865379710896395e-01   -2.719358438204504e-01   +5.103899536207294e-01   -8.930972877599658e-01   -1.577354209109212e-01   -7.263195836325439e-01   +6.524289804015113e-01   +1.230194722439598e-01; +2.970779730287013e-01   +1.289789635586975e-01   -5.302243058272563e-01   -7.600362800022383e-01   -4.246677925300424e-01   +6.138816183970486e-01   +1.291921497643958e-01   -5.858787810032763e-01   +2.448484879530174e-01   -3.322486192056973e-01   +8.411352137249853e-02   +6.508250985844894e-01   -2.801931092712839e-01   -2.243691060776621e-01   +3.678773500212551e-01   +2.044966743320768e-01; -4.455161408152462e-01   +3.454429401868714e-01   -3.891547427640339e-01   +3.217653537268164e-01   -7.272498554510510e-01   +2.342109280062881e-01   +1.266057734110624e-01   -4.258560408541840e-01   -1.905873262481937e-01   -3.627486481958406e-01   -7.975730938592513e-01   +4.356909471354982e-01   -7.770115676774968e-01   -6.177174588886492e-01   +5.063206898156569e-01   +8.049700943197674e-01; +3.479970595931023e-01   +6.960990507923154e-01   -2.247116908620663e-01   -4.305675878508951e-01   +8.958364230917128e-02   +8.241255907388569e-02   -3.647246264064603e-01   +8.941702710602508e-01   -2.939600163304855e-01   -4.439224042442243e-01   -4.613355046617722e-02   -9.367946126538867e-01   +4.493712882463326e-02   -3.109022895252302e-01   -1.247002001039916e-01   +2.872788858895807e-01; -1.603390527453190e-01   -2.247888182113010e-01   -5.063644285053098e-01   +3.170771940868143e-01   -2.832129084412905e-01   -6.956656835192445e-01   -6.563255389607349e-01   -3.086357299963553e-01   -3.123016002558636e-01   -2.461839679265553e-01   +3.585095430968517e-02   +3.158496699452613e-01   +1.709783374233535e-02   +1.317691599000010e-01   -1.679625697257913e-01   -2.809795576897792e-01; -5.233071037714399e-01   -7.926571321420042e-01   +9.178963365997278e-02   -1.345075835631578e-01   +4.799790797231417e-01   +1.989932246970245e-01   +2.393096716237073e-01   -2.017424588165506e-01   -5.256412148804606e-01   +3.540148970684180e-01   +9.952107445760347e-02   +2.614599085072980e-01   -2.614280785403033e-01   -2.807211699748796e-01   +4.844085209285184e-02   -3.764403392222800e-01; -3.824121500158983e-02   -5.911766208111768e-02   +2.870416723654327e-01   +1.446533719034129e-02   +5.377418677316153e-01   +3.702189178464901e-01   -4.864471789246223e-01   +4.757690114330894e-01   +7.569910804874280e-01   -1.038116294369355e-01   -9.718209846502338e-02   -2.117511283109590e-01   -1.303572956976692e-01   +2.085693749873919e-01   -1.877807571352846e-01   -4.680459887405737e-01; +1.056645076500614e-01   +8.317654984851446e-01   +2.401106449386416e-01   -4.115226770751214e-01   -1.538041823464709e-01   -5.289026315316611e-01   -3.586819406761519e-01   +1.381563666999565e-01   -1.290690083465038e-01   +4.812554855514010e-02   -3.797824360616226e-01   +2.250141799425685e-01   -1.785070196810315e-01   -3.159939801343688e-01   -1.960275964014123e-01   -6.157100916778205e-01; -7.300494302412022e-02   -2.322418792849883e-02   +5.580608337315200e-01   +6.089832350793405e-02   +6.640858837129149e-01   +3.282702400062792e-01   -5.163960625971298e-01   +1.343192082662354e-01   +6.825498438480314e-02   +3.956238720959682e-01   +5.851449182441812e-01   +4.278212493516081e-01   -4.091651582970085e-01   +1.029690188205464e-01   +8.133614062761571e-01   +1.026474804753387e-01; -2.163171559571997e-01   +1.393404931366206e-01   -2.130007072271079e-01   +1.129451346618080e-01   -5.507191645994179e-01   -9.656909830911115e-02   +2.220119057230346e-01   +1.708515138170777e-02   -4.682991830381776e-01   +7.355203470893261e-02   -1.187158757366623e-01   -8.034695645543904e-01   -2.835687324439314e-01   +3.392199215738534e-01   -1.022630093801756e-01   -7.982045318483943e-02; +1.082565516305608e-01   +5.543570115031725e-01   -6.676653480016865e-01   +2.621952273079565e-01   -1.996173054031279e-01   +1.908014573686754e-02   -5.388074951841434e-01   -3.684605438396516e-01   +6.374305458764983e-01   +2.605881466768315e-01   -3.612106829426500e-01   +3.537845274623956e-01   +1.708101231627437e-01   -1.074872582858210e-01   -1.220320478409419e-01   -1.211171919060327e-01; +7.404106018969426e-01   +3.329556354951113e-01   +3.512248041914858e-01   +3.311287467986465e-01   +4.768683607729391e-01   -7.473545891498911e-01   -2.793932785507288e-01   +4.209868542758464e-01   -4.350063083474380e-01   +1.841272961562773e-01   -2.162415654727842e-02   +2.314308248509447e-01   +9.882624027283424e-01   -4.803203475712561e-01   -6.453021361412355e-01   -6.414023053215684e-02];
L2I_L1I_iGABA_netcon = [+6.122839904876797e-01   -5.485947172834392e-01   -4.090442582537001e-01   +6.344982066845555e-01   -5.894729353320596e-01   +4.038058067044921e-01   -1.952011785509871e-01   +3.674941143252978e-01; +6.126139415530423e-01   -5.946517940605894e-01   +5.990504627100735e-01   +6.784660960766913e-01   +7.140634417291905e-01   +4.798836986947984e-01   -1.533132078329314e-02   +5.012949546670514e-02; -5.192799706978653e-02   +6.194962958009536e-01   -1.131809787730390e-01   +3.554249943526213e-01   +4.044088273388161e-01   +6.334281097478800e-01   +7.361470429069776e-01   -4.256224761724183e-01; -1.644195079766025e-01   -3.883499672448286e-01   +1.469716500833774e-01   +3.115318411533536e-01   +1.593465765586815e-01   +4.901058607413087e-01   +3.626169045408985e-01   -5.946669391235238e-01; +7.048186753197029e-02   -5.154022540576681e-02   -4.411106216376640e-01   +4.111697653386061e-01   +7.201612722035290e-01   +3.083893912486844e-01   -7.505216339294123e-01   +5.258046147679014e-01; +2.323003068278596e-01   +4.691480735565633e-01   -6.014869073845226e-01   -4.054826028362759e-01   -5.748422408798776e-01   -2.225001547467907e-01   -8.698669189583251e-01   -3.932112205672059e-01; -8.697271315430323e-01   -9.340006801396616e-01   +2.750326773876389e-01   +6.413460132889652e-01   -8.945421639453416e-01   +9.905864725258552e-01   +2.042800427920736e-01   +3.820713704919998e-01; +7.457564346781027e-01   -2.222177298409954e-01   +4.559456387021754e-02   +8.735525137029679e-01   +1.729057076957508e-01   +1.654397492248712e-01   -2.565427081111835e-01   -5.532921816953627e-01; -1.285723107824588e-01   +3.140433384807322e-01   -5.647653274773857e-01   -5.765934736911496e-02   +3.283701544937215e-01   +1.264346900035150e-01   +1.738528897143249e-01   -2.111394713620592e-01; -4.454731781084360e-02   +4.342766944639552e-01   +2.230322048884111e-01   -9.937879649365865e-01   +5.647994457137759e-01   -7.295402730038277e-01   -9.599397176104080e-02   +6.032274311605627e-01; +7.403200735653233e-01   -1.393833924068699e-01   +6.708346856599794e-01   -3.151222308242543e-02   -6.242912873465315e-03   +5.690339021929542e-01   -5.647249294625707e-01   +7.191396983663459e-01; +7.884650958571064e-01   -8.809764938007555e-01   -5.064492792465083e-01   +9.592288587713498e-01   -2.864563276939445e-01   -3.520704004175319e-01   +3.680102150779037e-01   +8.309911489729737e-01; +7.817015269900884e-01   +1.033493381288250e-01   -2.255533804415039e-01   +5.005553455552991e-01   -3.038714154932561e-01   +5.634256352728163e-01   +3.954428526226925e-01   +3.266054685744085e-01; +5.212226862204560e-01   -2.731628674367059e-01   +4.792836365766026e-01   +7.978980125335983e-01   -6.525111463955804e-01   +2.560846575656294e-01   +3.564661827228581e-01   +8.629900685932588e-01; +5.976934008777943e-01   -8.813099013299017e-01   +1.047848985377101e-01   -2.219642380312752e-02   -3.636963989958676e-02   -1.132333413626506e-01   -4.354794143067220e-01   -5.600650316106892e-01; +6.009746486227983e-01   +7.083633359119431e-01   +3.421080872785375e-01   -7.610280647717409e-01   +2.614045451726974e-01   +6.918635102204307e-01   -9.690941639943187e-01   +6.360391438894223e-01];
L1I_L2I_iGABA_netcon = [+3.499951308081168e-01   +1.995046415646455e-01   +3.966754268386321e-01   -4.216376614160008e-01   +1.984119775349325e-01   -3.129046236298077e-01   +9.548612680160834e-02   +3.192713712258161e-01   +1.027820112999960e-01   -2.692569379575113e-01   -3.347235834823275e-01   +5.068931951235249e-01   +7.723997180318756e-02   -2.573841390801819e-01   -4.250935056857306e-02   -5.050583563063449e-02; -3.396406600585213e-01   +9.888022828738277e-02   +3.198775820533736e-02   +1.993302727120150e-01   +1.857167942835082e-01   -4.896132299813243e-01   +7.378234752163298e-02   -2.794640474281175e-01   -5.829043770086298e-01   +3.970039324293432e-01   -6.069041310623695e-01   -9.055515456464322e-02   -6.456599149674758e-02   +6.303095434782955e-01   -7.368621915617926e-02   +4.608523282996029e-01; -2.404666850497319e-01   -9.291824537020391e-02   +1.036795034739771e-01   +4.652332948725625e-01   -9.160911546489067e-02   -8.094130608265812e-03   -3.732465131849866e-01   +4.238348775395844e-01   -2.612184956143530e-01   +1.950572300990334e-01   +3.152585510301880e-01   +3.968337372107655e-01   -9.276883777444374e-01   +3.889883172150606e-02   +5.455065264964004e-02   +2.138781317446781e-01; -6.630274915465534e-01   -2.676102725431722e-01   -4.292742254311795e-01   -6.613232631491539e-01   +1.452931077939714e-01   +6.092510580962858e-01   +5.429366694718410e-01   +4.870372502790616e-02   -3.314313411112075e-01   -9.661912013530640e-01   +1.025153395944955e-01   -6.142221038157922e-01   -5.970591814068957e-01   +4.213935623808647e-02   +2.392332183764300e-02   -8.072400671194832e-01; +9.929347222737400e-01   -2.977725274044054e-01   +2.912718249033497e-01   -2.401142938050853e-01   -7.816770213952783e-01   -7.746831981628720e-02   +4.364055371436307e-01   +1.529599054464446e-01   +2.040661053046472e-01   +1.178617167011642e-01   -3.367413039985993e-02   -3.715197200953343e-01   -6.814834759103193e-01   -3.190742425341664e-01   -4.096577448146341e-01   -2.098613067492704e-01; +3.173826286466468e-01   +1.534294553101589e-02   -7.043849396142519e-01   +4.050069460994583e-01   -4.438091675691211e-01   -3.004204912290679e-01   -4.422699815527415e-01   -4.072227883270257e-01   +3.357548236590183e-01   +4.429234189540568e-01   +4.098773677321936e-01   +1.831110988497193e-01   -9.334031071032439e-02   -2.293468310504574e-01   -5.689998143740548e-02   -3.439227503074284e-01; -3.840264394934757e-01   +3.412948538478101e-01   -3.044544570473092e-02   -2.119675798601204e-01   +3.747477437738544e-01   +2.190889275611416e-01   +7.541535954302656e-02   -1.711808780744153e-01   +6.200593914874943e-01   +3.082154324135667e-01   -3.292195157595910e-01   -2.909406178575750e-01   -2.053801433571238e-01   +2.101771492194663e-01   +3.799886451765697e-02   -3.218241730059408e-01; -6.013476934869305e-01   -2.999033111209493e-01   -6.407376133189460e-01   -8.308766511412348e-02   -1.803405875759053e-01   +9.174895619007484e-01   +3.178895975351564e-02   -9.768170844968108e-02   +7.081100884060509e-01   +2.672290852418344e-01   -6.322956884791451e-01   -4.393168408505150e-01   -3.112135080978224e-02   -4.140214096276532e-01   +1.439254461372231e-01   +2.964684320933415e-01];
L2E_L1E_iAMPA_netcon = [+8.031711637599767e-02   +2.117828659703118e-01   +1.397544490972032e-01   -1.763159910662269e-01   +1.709945495380505e-01   -1.847836744626459e-01   +8.104515585314025e-01   -4.024710702836542e-01; -2.566210864421846e-02   -2.823967779226769e-01   +5.308542655771311e-01   -5.576237798484226e-01   -5.701141959869827e-01   -1.072876304114610e-01   +3.171798966348010e-01   +1.671442385816720e-01; -6.777739702211434e-01   -5.997550776526128e-01   -1.001376856751223e-01   +6.911783589089696e-01   +9.089535196301234e-01   +7.042095896033803e-01   +1.312864789939359e-01   -2.782542368276509e-01; -7.412613340356371e-02   -2.934411338670463e-01   -5.153493113972485e-01   -8.797232238786998e-01   +5.743591884945429e-01   -3.249675877048048e-01   -7.541304275387298e-01   +3.408132777196256e-01; +2.016521189224957e-01   -1.261894162212276e-01   -3.627722940595573e-01   +1.777524268769149e-01   +1.037984586249969e-01   -3.150718335287444e-01   +7.510987851759299e-01   -2.397511607553645e-01; +7.124880454833903e-01   -5.121093163787502e-01   +7.181856689927794e-01   +4.275118070736587e-01   -2.831141581222479e-02   +4.888745971515322e-01   -5.721678282677206e-01   -4.147390214269857e-01; +3.432541302954064e-02   -1.749152959979920e-01   -4.479872922983062e-01   +4.965322827034464e-01   -1.986887735634455e-01   +1.384050898835347e-01   +1.000000000000000e+00   -7.896167851186116e-01; -1.809520527114012e-01   -1.485137562085261e-01   -4.036845194396034e-01   +4.260055318633199e-01   -3.161513740162485e-01   +1.953389359858744e-01   -7.267040905093332e-02   -1.548254455361437e-01; +5.785944366006999e-01   -3.553885285187922e-01   +8.158181260173756e-01   -1.434041212253250e-01   +2.584531800711730e-01   +5.150241764956819e-01   +1.948985448017825e-01   -2.015153891777948e-01; +1.012880109608103e-01   +9.314074459319395e-02   -7.584482590083713e-01   +4.817628084204557e-01   +8.277483099983339e-02   -4.199742583149840e-01   -4.286959772398397e-01   +5.307325881780257e-01; -4.367151796733522e-01   -8.065667517372744e-01   +4.848010985283916e-01   -4.188714606408699e-01   +2.101734225368729e-01   +7.895832222088618e-02   +3.613319208172056e-01   +8.182736094419375e-03; +1.154791737693216e-01   -3.944643429135611e-01   +5.151107196383632e-01   -7.679208496610113e-02   -7.451210693708725e-02   -7.904481611288074e-01   +5.778894542246837e-02   +4.393986447928453e-01; -6.582524006944644e-01   -6.083014829816123e-02   -5.710955696864968e-01   +6.303379283015334e-02   -3.212625505214146e-01   -4.110466790843803e-02   -5.226753067417749e-01   -3.448092923623741e-01; -3.300617805007317e-01   -6.377262820485964e-01   -5.127539010077061e-01   -9.783805316997471e-01   +1.748999034365308e-01   -6.599269241803138e-01   +3.630879016025573e-01   +4.043594863102957e-01; +6.781501681283246e-01   +2.891003622426473e-01   +8.924521924509895e-01   -1.769813081141344e-01   -1.515351518486043e-03   +6.393997643387476e-01   -4.684592609246207e-01   -7.985897229964024e-02; +1.662237373952823e-01   +7.748359413653134e-01   +6.642158581417333e-02   -5.012532231527664e-01   +2.782763377316089e-01   +4.570629198788811e-02   -6.947027346294551e-01   +1.968861865249026e-01];
L1E_L2E_iAMPA_netcon = [+4.563478290508193e-01   +4.269535232054157e-01   +2.489255278534878e-01   +8.758353158707879e-01   +2.701747105740011e-01   -2.106535425624551e-01   +5.006793437106649e-01   -3.635773449403510e-01   +5.751454349049242e-01   +4.021848525530187e-01   -7.552659991858631e-01   +7.729093271331016e-01   -3.817617976773535e-02   +4.918769890329373e-01   -3.104871720383011e-01   -1.605717485521661e-01; -3.618779804160612e-01   -3.544872366163317e-01   -3.064394630738669e-01   -1.365088581328568e-01   -9.127529370906546e-01   -2.419553718170699e-01   +1.494970836782926e-02   -6.122142062874268e-01   +1.547689325555874e-01   +1.414317276044657e-01   -3.633715345193504e-01   -3.049568879901265e-01   +1.921135079805052e-01   +9.031544387658056e-01   +4.222461122247231e-01   -8.862054295620186e-01; +1.082878791631151e-01   +5.735649812320653e-01   -3.566960425068311e-02   -3.622919198981360e-01   -4.404468352748341e-01   +1.570371041618326e-01   -6.398684968408922e-01   +1.727092231065760e-01   +2.000414858960443e-03   +7.684997526640943e-01   -6.600073936127999e-01   +2.221845169607576e-01   +9.757733926157750e-01   +2.945863211470037e-02   +1.472598521950904e-01   +5.739605155257820e-01; -9.281807318567441e-02   +5.236610322741871e-01   -4.393612951629017e-01   +5.838426556369896e-01   -5.340124121386339e-01   +6.013869558448300e-01   +3.968321112994239e-01   +6.594235006524610e-02   -7.179067554532705e-02   -1.188345357574111e-01   -6.013088965938720e-01   +2.324390307162647e-01   +2.865407564919564e-01   -5.972157676740533e-01   +4.992878719772265e-02   -8.921027949856015e-01; +1.071202922213544e-01   +5.062597239508201e-01   -6.361038876146982e-01   +3.250239615423055e-01   +2.800594066283290e-01   +3.065513720288552e-01   +8.980900711950828e-01   +7.576713109709845e-01   +1.218957837934540e-01   +9.200857501365388e-01   +1.240006161114290e-01   -6.145734245674781e-02   -8.210469378305134e-02   -6.815022667014003e-01   +4.536237957062754e-01   +6.292043630626267e-01; +2.033655069658685e-02   -2.399664503781584e-01   +9.916569527292504e-02   -1.297266660770878e-01   -2.101949406413366e-01   +3.886885863231334e-01   -5.552248315205600e-01   -2.110885820918425e-01   -3.021581968994157e-01   +1.732717538288450e-01   +1.608030546869432e-01   +7.875739046600029e-03   +2.882552847551881e-01   -3.283190634812450e-01   -4.523863010872261e-01   +3.524383048271374e-01; -6.413733036646983e-02   +3.195884147665987e-01   -9.691856073797284e-02   -7.607349561145176e-02   +6.768848560071585e-01   -1.588005407187223e-01   -2.472033153094076e-01   +3.586901795077741e-01   -5.645470107439365e-01   -6.434804031694927e-01   +7.919952969168855e-01   +5.794028331467485e-01   -3.670861099863282e-01   +3.751424681367183e-01   +2.380396598609618e-01   -6.563999132949563e-02; -4.216569500687422e-01   -2.077404243134987e-01   -3.918140632950234e-02   +5.528923472505097e-01   +1.195917498230733e-02   +4.233216829355141e-01   +6.924734891795108e-01   +9.607972482577895e-02   +7.873060045638400e-02   +6.463739818377423e-02   +5.024456453444863e-01   -3.718007764624660e-01   -5.636399795967375e-01   +1.369187365115113e-01   -4.596346471969225e-01   -5.810239345486095e-01];
L2I_L2E_iAMPA_netcon = [-1.333736361472500e-01   +7.639158193522699e-01   -8.286085480336666e-01   +4.754957104631401e-01   -9.508648601399909e-03   +1.125444596014791e-01   -2.776794557674819e-01   +1.492815403807004e-01; -2.006010867019601e-01   -9.373789554200377e-01   +4.506740047312907e-01   -3.862625236216524e-01   +4.516809839734607e-01   -2.705270936802548e-01   -3.955429953303209e-01   +3.460946286089049e-01; -3.379882867125544e-01   +6.135413521941652e-01   +1.612638817952854e-02   +1.593409066616308e-01   +6.643529246007751e-01   +5.079231713244292e-01   +3.765434423444741e-01   -5.080045284249700e-01; +2.364239696612991e-01   -5.498694142563590e-01   -1.272447794664581e-01   +1.949362735356547e-01   -2.338342803040653e-01   +1.745247811676817e-02   +4.941590040986045e-01   -4.757392479887812e-02; +1.676287752595860e-01   -1.060961923611402e-01   -6.915139126520120e-01   +3.551578719490167e-01   -1.212030451986030e-01   +2.041233259164312e-01   +4.276345816537364e-01   +4.995046532176011e-01; -2.369364532919465e-01   -4.083921868916958e-01   +3.000024142563594e-01   -8.541648013271230e-02   +3.776500628911668e-01   -2.206427572121831e-01   +9.665890757863952e-01   -2.948493193732721e-01; -2.771197089795083e-01   -1.357656549199674e-02   +9.650455102750002e-02   +2.713658277734533e-01   +2.064565060490568e-01   -2.633552133717969e-01   +4.075291507290752e-01   +2.718700799649175e-01; -3.014884445561691e-01   -8.230314495982917e-01   +6.640850026162614e-01   +1.118411825846100e-01   -2.020406779932212e-01   +3.307868278429769e-01   +5.717969899089405e-01   -3.395884148388794e-01];
L2E_L2I_iGABA_netcon = [+3.684475410751464e-01   -4.654698240451954e-02   -2.657807208718557e-01   +4.010966722293532e-01   -6.193099105249641e-01   -9.258209826101342e-01   -7.523564619357084e-01   +2.961554356899299e-01; +4.745558254344476e-01   -3.081581717667465e-01   -3.746071837664588e-01   +5.251681531430193e-01   +1.262742186353522e-01   +3.028858577932929e-01   +1.295953000966523e-01   -7.485941798464384e-01; +3.272263882802035e-01   -1.985187014744543e-01   +1.140577027701929e-01   -3.786919489194036e-01   +1.243200841478999e-01   -1.028051342238419e-01   +9.801267030120041e-01   -1.127003312035341e-02; -4.610302522321166e-01   +5.464765385558421e-01   +4.447449122456150e-01   -2.553306181973401e-01   +3.836411284602420e-01   -5.360141374753541e-02   -1.943526024147747e-01   -3.039852302365582e-01; +5.356388523157752e-01   +7.146680950384743e-01   +4.772356091049373e-01   +2.683026057245265e-01   +1.576015239581664e-01   +5.287975014445209e-01   -6.885452325254027e-01   -2.896173424176418e-01; +1.439101815125144e-01   +6.424526835099328e-01   -3.324832562175554e-01   -4.580916788204087e-01   +3.392016099491958e-01   -2.440352903973063e-01   -3.779434951980520e-01   -2.316590004655766e-01; -4.700302710318348e-01   -4.520345240217854e-01   +6.278046354750987e-02   +7.681384228881253e-01   +2.598040203976080e-01   -8.222804441745583e-02   -3.590722587023535e-01   +2.000272769823001e-01; -8.115771602538197e-01   +2.351235090431752e-02   +8.550087081062578e-01   +3.017897738264175e-01   +4.433773764775347e-01   +3.808999757112258e-01   +2.169362975378912e-01   -2.483658831288162e-01];
L3E_L2E_iAMPA_netcon = [-4.123302929786393e-01   -1.389241474769212e-01   +4.886664430205971e-01   -7.309749478712774e-01   -1.120508579135221e-02   -8.520493771635078e-02   -2.078322389457849e-01   +4.273049071643174e-01   +7.801093200998617e-02   -2.196079388178834e-01   -4.304916640092007e-01   +4.866187362333038e-01; -5.970623735505608e-01   -1.466299665813154e-01   -6.463921977235139e-01   -2.418255702971117e-01   +2.720947361795683e-01   +1.000000000000000e+00   -7.332571824869218e-01   +4.945233075532490e-02   -3.882242907836919e-03   +2.707870912083143e-01   -7.028364241779252e-01   -2.405070891410708e-01; +1.242086954015208e-01   -2.468498796925607e-01   -8.680066908235460e-01   -7.111044059433350e-01   +2.193489584932724e-01   -3.926791861561832e-01   -3.185656746241023e-01   +6.503492031547602e-01   -8.888783944732338e-02   +6.433937806394258e-01   +5.429929555184686e-02   -8.164948917801285e-01; -3.607950779198013e-01   +9.584702666589003e-02   +5.020126371905478e-01   +2.678196286102580e-01   +3.605243102777727e-03   +5.721853518085248e-01   -5.152504260322851e-01   -6.625383961301308e-01   -7.707059351061250e-01   -2.619179565637981e-01   -1.871838732214953e-02   +6.036348523240807e-01; +4.379247707271183e-01   -4.829852911935962e-01   -5.549520442256100e-01   +2.892648251920427e-01   +1.714691796600904e-01   +2.921368778158053e-01   -8.544576629298335e-01   +4.896995171373823e-01   -3.728734198405526e-01   +5.158147886873798e-01   +2.766919131170424e-01   +6.085859913892840e-01; -2.836251547316720e-01   -2.139753355733156e-01   +5.644413158266559e-01   +1.143544262420124e-01   -8.853061048883139e-02   +5.240046820205894e-01   +4.636261147874862e-01   +5.312010401989981e-01   -5.412186523659817e-01   -7.452867067844771e-01   -8.172158306948141e-02   +8.214402952221541e-01; +4.211595356069184e-02   +2.183966378633140e-01   -7.940655501481619e-01   +7.547167574188839e-01   +4.898806319833885e-04   -4.978514034424042e-01   +4.197452485861760e-01   -7.707995988907057e-01   +1.588700583103799e-02   -2.485228333157679e-02   +9.354971273529635e-01   +2.933333407470942e-01; -4.498492685954587e-02   -3.401937720421551e-01   +2.667148591455519e-01   +9.347117649660208e-02   -1.334510174138633e-01   -2.265581679113048e-02   -2.980956270836418e-01   -2.730320481187086e-01   -6.542784992422181e-01   -4.156399358091801e-01   -5.416533951659612e-01   +7.614539532056921e-01];
L3I_L2I_iGABA_netcon = [-9.301299504181584e-01   -4.015877531595626e-01   -8.091429500224331e-01   -8.168040879799056e-01   -5.761916946233113e-01   -6.906312357403921e-01   +3.438141074121243e-02   +3.291293929588303e-01   -4.407512568925546e-01   +1.235589511187818e-01   +1.436587978555190e-01   -1.640238356822501e-01; +7.835360598120358e-03   -1.536258665798632e-01   +6.935109452737186e-01   +1.262317186954527e-01   -3.835275502379552e-01   +4.168790063731235e-01   -1.288577533694961e-01   -3.198840184259580e-01   -1.653707303424275e-01   +6.500020687203110e-02   -1.765041684343874e-01   -7.789822943976650e-01; -4.214071047775417e-01   +9.024327586088773e-01   +2.545229154464062e-01   -4.115928157234122e-01   +5.649552039545780e-01   -2.116524998830520e-01   -6.205499603695410e-01   -3.023881267862892e-01   +2.826545595105542e-02   +5.465997540889789e-01   +6.362368259153836e-01   +2.749443389411637e-01; -1.000000000000000e+00   +8.115790422758713e-02   -7.443024260835776e-02   -4.680476685810004e-01   +9.602069876718175e-02   -1.582293735460448e-01   -4.934683986264638e-01   +4.400616325649181e-01   -3.106315067939042e-01   -2.748766871729653e-01   -3.922438250302588e-02   +5.859570767029439e-01; -5.702379535571840e-01   -5.182324460931794e-01   -3.983488140978185e-01   +7.423064825426697e-01   -5.653829186617687e-01   -5.516404267114444e-01   -1.218176411709359e-01   +4.121685396130976e-01   -6.611676540035696e-02   -1.694226155889498e-01   +4.898591361936526e-01   -1.015435949408436e-01; -4.891600551220882e-01   +3.184183314655145e-01   -5.441533908544423e-01   +2.455062245564197e-01   -5.223772996425537e-01   +2.445077498399625e-01   +5.820582819385314e-01   +4.962870610922634e-01   +6.694547830320166e-01   +6.342942892572070e-01   -8.861363059623673e-01   +6.906304182750697e-02; -5.040747146160134e-01   +5.403196520920623e-01   -1.754504654456201e-01   +5.042445363316101e-01   -6.867255226638391e-02   -3.989752879260057e-01   -6.167251877300113e-01   +1.427156725250211e-02   +5.275174830204887e-01   +1.878520014314975e-01   -5.343482873157072e-01   +5.044168052899589e-01; +7.605199467585805e-01   +2.089475156102369e-01   +4.086112516710376e-01   -1.576925724311947e-01   +5.413099234222689e-01   +6.005888165390587e-01   +4.108977687078791e-01   +4.751177177379218e-01   -4.708363140770461e-01   -5.024170662467383e-01   +4.988684549040771e-01   -4.198707070199162e-01];
L2E_L3E_iAMPA_netcon = [+6.563887753478596e-01   +4.092184635669893e-01   -4.196469724004614e-01   -4.097160527976681e-01   -1.928293132058851e-01   -3.946077739624897e-01   +3.547545763272225e-01   +3.035347176113854e-01; +6.578171542773484e-02   -2.200624970108809e-01   -3.451381733953729e-01   +2.624223301103624e-02   -7.409309926314807e-01   -3.437670084571213e-01   +4.354213906826597e-01   -5.011104930935290e-01; +2.492135942866043e-02   +3.164211951396827e-01   -3.264023878867536e-01   +1.512295601969878e-01   -7.957351049664034e-04   +2.551865901363130e-02   -5.691965304968268e-01   +1.449794138172840e-01; -1.908756572348841e-02   -2.092160124672677e-01   -7.263000228204780e-01   -2.280898432265349e-01   +1.000000000000000e+00   +3.149486973019655e-01   -3.401550649505849e-01   +6.990599173601865e-02; +5.986457841174324e-01   -2.198799902978245e-01   +2.013904295964969e-01   +9.977596665144908e-02   -2.739373688127696e-01   -4.015734735839391e-01   -1.537883062416733e-01   +2.692026998210009e-01; +1.606831000406313e-01   +6.309070489727484e-01   +7.337550262175246e-01   +6.482092599115569e-01   +4.393689951028238e-01   +1.114626800781183e-01   +3.497841492480663e-01   -2.374423984199198e-01; -2.009320590330941e-02   +4.786851017374726e-01   -1.210453253818358e-01   +1.022290865200284e-01   +5.204391275738735e-02   -1.150689948302526e-01   -4.732195121828939e-01   -2.536310002401627e-02; +3.335977975933723e-01   +4.675819683527689e-01   -5.293027508347725e-01   -1.312467080704756e-01   +3.805096941274649e-02   -5.284994886005108e-01   +1.346312016908283e-01   +4.486588064206717e-01; +2.967510606519308e-01   -8.092609531537401e-01   -7.554667457466661e-01   +3.117678431210069e-02   -6.463694760881108e-01   +6.192876165737017e-01   +4.737496869502773e-02   -3.437101060464350e-01; +5.994861731859770e-01   -6.151290386967925e-02   +3.718882631247676e-01   +8.187585517435694e-02   +5.943438370825510e-02   +5.729923201785284e-01   +2.133773877177991e-01   -4.407571153280433e-01; +1.626153921587703e-01   +2.194698348748887e-01   +5.365152397989662e-02   -2.290950156111509e-01   +1.543158851597968e-01   +3.889315456273383e-01   -2.243135556457798e-01   -7.671521376491227e-01; -3.320062358084434e-01   -5.663670502367675e-01   +8.036424281998621e-03   +2.115392234687358e-01   -5.012863254317633e-01   +2.584406372211538e-01   -4.811752928012537e-01   -8.152650584635929e-02];
L2I_L3I_iGABA_netcon = [-5.691793224301939e-02   -1.534945692703575e-01   +2.212208974040822e-01   -9.689302899909443e-01   +3.174735479224364e-01   -6.497620547184834e-01   -9.829805264335163e-01   +9.796631744589854e-02; -8.469528113342410e-02   +1.505098326213196e-01   +3.775777348571064e-01   +3.686169062405412e-02   -3.331235454393413e-01   +1.161237836275274e-01   -3.196776084576246e-02   +3.679329183646782e-01; +4.843626388542726e-01   -7.308126309633086e-01   +3.837892966857703e-03   +1.220072908800390e-01   +1.334662912670891e-02   +2.787717366940882e-01   +1.783548290988352e-01   +8.903028678039293e-01; +4.828270378231340e-02   -4.658547047520318e-01   +3.274470988490114e-01   -3.759111075340300e-01   +7.237067609061502e-03   +1.086947706038266e-01   +9.762607104316758e-01   -1.549463725207478e-01; +8.208453958239552e-01   +5.382506959824097e-01   +7.840060702297919e-02   +2.639486482083585e-01   +7.513342811375926e-01   -8.202095333994439e-01   -1.940013089552645e-01   -2.824727946952270e-01; -3.457633942549054e-01   +5.317404159479472e-01   +7.557954699520871e-01   -5.021317011403640e-01   -6.777845959172782e-01   -1.300952453552577e-01   +4.081162962145753e-01   -1.921221010619755e-01; -5.184287966267381e-01   +3.821114654104252e-01   -1.978943592581419e-01   +1.405836222455861e-01   +6.648039249359693e-01   -5.707296567781704e-02   -4.092997135759419e-01   -2.927092388844507e-01; -8.358097652016952e-02   +2.325564329130264e-01   +8.357728874133959e-01   +3.793763853760211e-01   +5.674938015010941e-01   -6.060500455547009e-01   -2.608994046253852e-01   -5.252213372148871e-01; -9.197502199808171e-01   +4.836917983395935e-01   -7.783058587191459e-01   +1.240104189488148e-01   +2.781952453511446e-01   +2.975350141608099e-01   -1.653062269849221e-01   -3.721599280572656e-01; +4.532846453372374e-01   -4.622067360511632e-01   -2.381859624487398e-01   -2.178401905313105e-01   +2.180428135156821e-01   -9.140227890796372e-01   -8.531987175319499e-01   +5.246541096846025e-01; +8.223692468979279e-01   -2.836672374399338e-01   +1.759753251129919e-01   -1.495304205736588e-01   +1.957173038783121e-01   -5.523798216184828e-01   -6.706134947961301e-01   +4.345449523440930e-01; +4.626848396353153e-01   -1.754069558862444e-01   -7.150283174070567e-01   +2.260313662622327e-01   -1.130497583350289e-01   -3.918550153413085e-01   -2.676557884322917e-01   +2.922769368704652e-01];
L3I_L3E_iAMPA_netcon = [-3.528278042807901e-01   +1.270277197250268e-01   +9.741155148028195e-01   -2.124880353494353e-01   +4.196988743162952e-01   +7.427088554208530e-01   +5.558521913062736e-02   +3.316409961671652e-02   -1.361274918399024e-01   +4.613223778721567e-01   +2.592389361110654e-01   -2.570464095606791e-01; +6.994058536016916e-01   +5.933698868599436e-01   -3.833278305686496e-02   -8.435818702609229e-01   +2.702246045145303e-01   -1.208082308567662e-01   +2.673302099422818e-01   +3.163120801035605e-01   -9.981937001116749e-01   +1.360254566607060e-01   -5.683420983005233e-01   -7.574583529612268e-01; +5.238622313687139e-01   -3.230936604018002e-01   +7.104135587248102e-03   +5.864519158322793e-01   -5.491265391105143e-01   -9.492880357634100e-01   -1.099663231305057e-02   +1.592600463324409e-01   +1.953558960286336e-01   -6.091155204187797e-01   -6.557582459647560e-01   +4.101158178747281e-01; +2.292438100689382e-02   +3.462441615092386e-01   -1.127816720806606e-01   -7.797678839549120e-01   -6.137232977120912e-01   -5.411445341611230e-01   +2.936988264989963e-01   +3.072261481303135e-01   +2.380460335472848e-01   +4.970362948898162e-01   -7.635808465899085e-01   +6.581082724263071e-01; +5.072700145195976e-01   -8.081430623655527e-01   -1.888303013143305e-02   -3.159793292240691e-01   +6.415003007085459e-01   +6.925294158715760e-01   +2.847182788907656e-01   +1.563824762311079e-01   +7.634143353081687e-01   +6.323957271030634e-01   -2.988473555301622e-01   +1.849882299005797e-01; -7.695390700695787e-01   -7.425523721850338e-01   +3.263295083009955e-02   +1.767630085952527e-02   -3.423521725323839e-01   -1.101983196555829e-01   +5.091757005311226e-01   -1.159102944563311e-01   +2.623375952901831e-02   +1.174947945061336e-01   -4.293863682860931e-01   -3.448082111753596e-02; -3.171276802171707e-01   -3.597611399219953e-02   -1.975339199664778e-01   +1.420088842311520e-01   -3.250630442537644e-01   +2.142427383030207e-01   +7.332159375184979e-01   +4.255478734022564e-01   -7.595032625944758e-01   -3.136881910578102e-01   +3.234285715872855e-01   -2.384777507695598e-01; +3.008020124167732e-01   +1.277882845113116e-01   -6.377462420563529e-01   +3.595748618280434e-01   -6.475007220533645e-01   -3.205645519949338e-01   +7.970942191842580e-01   +4.061653079345156e-01   +6.767757675082831e-01   -4.863770141869110e-01   +8.412340483352767e-01   -2.236468374221580e-01; +4.627650933431172e-02   +3.934168181544162e-01   +3.966364569835464e-01   +3.378958858541709e-01   -2.567430409495915e-01   +6.684451608645675e-01   +5.024315663894819e-01   -9.143024698743745e-01   -5.574937108284066e-01   +3.086717111434999e-01   -8.960726560399476e-02   +7.731821106568897e-01; -3.146159000891544e-01   -6.317346271446990e-01   +4.079547601420893e-01   +5.337814047678856e-01   +1.359589742237116e-01   +5.187436187442351e-01   +4.867203699870981e-02   -1.183690985712847e-01   -5.039071070453861e-01   -3.519107065319645e-01   +5.828866890428398e-01   +2.975356719073297e-02; -5.626938009565203e-01   -6.033494584632920e-01   -1.333039958416773e-01   +2.059729849676266e-01   +1.832466476114001e-01   -3.353379110285937e-01   +3.451465671587909e-01   -2.846360135166250e-01   +2.012936628535270e-01   +1.455926630632991e-01   +7.545830484590153e-02   -7.814768871966823e-02; +2.504263873337931e-01   +7.434026585874793e-01   +5.171050815046062e-01   +6.833813952937099e-01   +1.893581419289717e-01   +4.228638163769375e-01   +4.955010535640842e-01   -3.178541806834992e-01   -7.030819500783047e-01   +3.387386307096485e-02   -4.914523465771312e-01   +7.415025482264609e-01];
L3E_L3I_iGABA_netcon = [+9.548153493924066e-01   +1.291465288917528e-02   +1.810711506823744e-02   -5.920866714415378e-01   -1.398306906904510e-01   +2.811965901982847e-01   +8.043891323473048e-01   +9.574041999409876e-01   -6.681850831764630e-01   -4.380843560243314e-01   -3.485630623590141e-01   -7.623611179939559e-02; -4.813183976397432e-01   -1.206773584764820e-01   +7.160651176656530e-01   +6.384340863225800e-01   -5.183905635554600e-01   +6.142613131255645e-01   -1.514531605971007e-01   -8.537827529095049e-02   -2.782188864982367e-01   +6.267727772301475e-01   +7.155065210363237e-02   -5.331978757373369e-01; -5.293972104542745e-01   +3.615626118287011e-01   +6.678718383388050e-01   +1.781647046391038e-01   -5.400433791957013e-02   +4.739013544438155e-01   +6.722133178657165e-01   -1.524452725581402e-01   +1.215962756908094e-01   +5.698126147417281e-01   -2.997004797554689e-01   -2.313350648835063e-02; -1.000000000000000e+00   +9.895030026239363e-01   +5.922950678459846e-01   +4.634366994429961e-01   -3.297679107433149e-01   +4.547430581712238e-02   -8.238822564839168e-01   -6.073310763493545e-01   +5.230709799581776e-02   -1.682753617945867e-02   -4.999399533661991e-01   -2.209656626263887e-01; -1.832201801837801e-03   +2.902969083096238e-01   -6.733056965973797e-01   +4.166497717998973e-01   -2.614518606146062e-01   -2.672527975433194e-01   -3.104259238929246e-03   -2.766431727259687e-01   -3.307269235972979e-01   -2.442762472600732e-01   +7.538097079990104e-01   -3.462964403929801e-01; +3.191058747880653e-01   +8.037831965885455e-01   -1.972034281535773e-01   -5.518199322787476e-01   +2.616333383826934e-01   +3.167202576212279e-01   +1.920260052846975e-01   +2.995192826646583e-01   +1.836185501073807e-01   +3.603760566122470e-01   -6.855182334732696e-01   +1.336189159999080e-01; +5.187638308112100e-01   -4.800717301106134e-02   +1.223220661867055e-01   -6.010683731207170e-01   +7.297550532040725e-02   -4.610334099436780e-01   -6.433352615683839e-01   +9.589050260244235e-01   +4.787704535865721e-03   +5.978344815526462e-01   +4.735519311731434e-01   +2.948178408804006e-01; +4.071626895010919e-01   -7.629245670008549e-01   -1.403853713005117e-01   +3.358510946946490e-01   +6.240102369797190e-01   +2.913506663277638e-02   +5.241134623513372e-01   -1.667209958041557e-01   -1.652731818496629e-01   +5.975768628536511e-01   -2.858743294616765e-01   +8.790759447243344e-01; -3.121860269535881e-01   -2.245303948713274e-01   +2.256206706822957e-01   +7.897793816291081e-01   -8.707471489167216e-02   -5.838526181561570e-01   +5.127974478061723e-01   +4.478103146355795e-01   -3.716526393908869e-01   -4.071257551127055e-01   -3.748478529640091e-01   -5.926903030957171e-01; +4.330050227098927e-01   +5.139667824215345e-01   +6.458022060537637e-01   +7.849893804228721e-01   +6.426087237909491e-01   +2.221384759611104e-01   -6.191977560581031e-01   -3.061287169196670e-01   +6.532134980927780e-01   +6.087896248623191e-03   -6.935534588310522e-01   -5.352314783559226e-01; -1.269268281498386e-01   +1.652235079724638e-01   +2.303067830481007e-01   -5.882170652694583e-02   -7.945089426852748e-01   +3.769332107782375e-01   +3.619906541109129e-01   +8.458979686489418e-01   -4.695586515287401e-01   +1.199552126225900e-01   +1.976077694625056e-01   -9.320444907833887e-01; +1.215853877127591e-01   +4.289028119987230e-01   -6.268803456274625e-01   -6.177579859486838e-02   -2.913105241721781e-01   -3.410553489183685e-01   +9.378760937197800e-01   -3.335846832075603e-01   +4.727061868261223e-01   -2.362739003912381e-01   +3.630263151874600e-02   -4.031427802337778e-02];
L2E_Input1_iAMPA_netcon = [-2.774711001974551e-01   -3.230484396387381e-01   +4.649329729753276e-01   -3.887505221504120e-01   -7.198303251161834e-01   +7.780655493806025e-01   +5.974211757116530e-01   +8.304219305881404e-01];
L2I_Input2_iAMPA_netcon = [+1.000000000000000e+00   -4.448905967325210e-01   +7.593691986595400e-01   -1.808767897733504e-01   +5.428828597168219e-01   -6.927210194680571e-02   -1.048757773744155e-01   -8.298286356491910e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last =  11.21 * ones(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))*0.4 + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.5*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.5*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))*0.9 + 0.5*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))*0.4 + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.5*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.5*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))*0.9 + 0.5*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
