function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+6.922245534090750e-02   -5.623910254368972e-01   -1.520844076106367e-01   -1.021726833982675e-01   +1.441373528325767e-01   +5.565458118089806e-01   +3.489245354864400e-01   -8.773902789525481e-01   +9.330602546128314e-01   -7.558534654442732e-01   -5.099875052624926e-01   -2.183265653638072e-01   +2.224919423718015e-01   +7.029384744267142e-01   -7.315984952026231e-03   +5.629847233280347e-01; +5.902609979948295e-01   +7.640377696613712e-02   +2.966378121401270e-01   -4.596584992202038e-01   +3.086705658471627e-01   -7.985836853378195e-01   -5.521578304938127e-02   -9.712483069481132e-03   -8.004474656640875e-01   +2.678568540105790e-01   +4.375940716423352e-01   -4.790112088152212e-01   -2.626358376045031e-02   +2.431786419601824e-01   +7.616879053284151e-01   -8.894345212203433e-02; +5.639010412766962e-01   +8.717247032852443e-01   +2.810933530927948e-01   -5.371787196938521e-01   +1.161575111791541e-01   +2.951222498711671e-01   -1.005213721252905e-01   +2.015936609327751e-01   +5.155189342290196e-01   -2.701441732031239e-01   -5.907978187138828e-01   +5.864003744391036e-01   +2.959638497858061e-01   +4.936128449033267e-01   -1.994295137004961e-01   -3.929687529388722e-02; -3.234476643619548e-01   -3.957647211187560e-01   +7.326145290720573e-01   +9.504808422850138e-02   -1.064681514408705e-01   -3.551884475825643e-01   -2.490124708149707e-01   +8.950892436465896e-02   -2.981368145780159e-01   +1.395180122353424e-01   -2.810805341392315e-01   -2.347655275089886e-01   -1.169365514312443e-01   +5.009424099594576e-01   +2.718279753700221e-01   -6.520489522383131e-01; +4.074616830545742e-01   +3.553902432108481e-01   +3.714010330554277e-01   -2.339863059092424e-02   -5.631808643047458e-01   +1.779287416807267e-01   -3.765879437272566e-02   +2.508363591847264e-01   +5.917398670809917e-01   +4.480759084769634e-01   -7.555393096974743e-01   +1.747158928917693e-02   -1.427175294541593e-02   -8.038610225082427e-03   -6.467333620461304e-01   -1.502840530025703e-01; +4.459991440278328e-01   -1.814824662464521e-01   +1.081710114129590e-01   -1.960558171355812e-01   -2.475566675695830e-01   +3.092931844116432e-01   -4.261160978832144e-01   +4.133168123928606e-01   +6.647926501238871e-02   -1.868778057256923e-01   -3.825273008432715e-01   -7.252969236096037e-03   +1.395572035125535e-02   +2.400619995123696e-01   +5.677216281966798e-02   +8.260362032586778e-01; -2.988272973459523e-01   -1.759617721885152e-01   +4.517022015300458e-01   +8.938582058100609e-01   -2.035823568057732e-01   +4.147872137657335e-01   -5.793321337852878e-01   +1.946478958599591e-02   -4.248583478720714e-01   +3.857017312734352e-01   -6.467589285448686e-01   -3.167732675910971e-02   -5.780958658635326e-01   -4.852248265965242e-01   -3.586058774499520e-01   -1.385481892955070e-01; -5.984927495993535e-02   -2.782091707123073e-01   -6.431670570434290e-01   -3.626586287129027e-01   +1.638857406330340e-01   +4.806553507769957e-01   +7.722884216915013e-02   +4.863026502316435e-01   +2.790369121325869e-01   +1.358104044493378e-01   +3.484636972674620e-01   -3.482463475112569e-01   +8.801786629542836e-01   +1.770389220364509e-01   -3.133295046118799e-01   +3.308038629988089e-01; -1.886362761854192e-01   +2.806355412166236e-02   +1.700760309119486e-01   -1.667168698914846e-01   +1.714422499364236e-01   +3.927941867112692e-01   -2.017550309492535e-01   +1.121140078390773e-01   -9.603054020083175e-01   -2.528731367291902e-01   +5.180548456035028e-02   +1.199079538733525e-01   +3.568331983766836e-01   -5.711108393133184e-01   -2.121953432188181e-01   -3.621070503042170e-01; -6.169852549832296e-01   +6.437604781554863e-02   -2.822514087779610e-01   +5.271451998260124e-01   -3.078936729559959e-02   -2.425666422417885e-01   +5.951250659611816e-02   -8.816270899556601e-01   +2.868268396883396e-01   +4.247559527528266e-02   -6.101195203396150e-02   -6.382286352667064e-01   +2.645573863291424e-02   +3.470289659936510e-02   +6.095472346031544e-02   -8.396018948464841e-01; -1.295334146772613e-01   +8.307654452110530e-02   -9.399883152318160e-02   -6.985062840194064e-01   -4.543858352964883e-01   +3.569950722874922e-01   -1.126253073967177e-01   -9.903554213874347e-03   +4.309827742156127e-01   -4.503684508308554e-01   +5.972211402741717e-01   -1.000000000000000e+00   -1.693519781046966e-01   -5.577837585080846e-02   +2.333229887840201e-01   -4.701829143378092e-01; +6.393282171293934e-01   +1.157758095630157e-01   -1.951396986168704e-01   -8.941643388509087e-02   -2.125082109051777e-01   +6.377108745658094e-01   +2.867423351543921e-01   -5.658449825582748e-01   -2.972032542023682e-01   +2.953795474487755e-01   -4.130975878993533e-01   -6.787081601121533e-01   +4.338683378374548e-01   -1.344153370955123e-01   -6.115959507067418e-01   -1.328093758146331e-01; +3.237213633299084e-01   +4.998340195403105e-01   +6.126402215133400e-01   -3.696377417540072e-02   -7.022981987766852e-01   +5.912208836848744e-01   +2.061384217049546e-01   +4.549351140021226e-01   +1.485010201671681e-01   +4.943461346953288e-01   -5.971155779050231e-02   +2.609746265972137e-01   +1.446501702336169e-01   -3.100099721157644e-01   +7.290880218805920e-01   +3.192626486224611e-01; -4.018820549269628e-01   +4.664882285926501e-01   -1.937586399834930e-01   +2.123480335771303e-01   -3.527748711616870e-01   +2.753714392006499e-01   +4.369586318563332e-02   -4.958989134555408e-02   +6.148088560053784e-01   +1.364916183502937e-01   -4.953790244207585e-01   +1.491771244733900e-01   -1.151657674136006e-01   +1.814621666684776e-02   -1.566489223750239e-01   -8.542570818575353e-01; -3.502118189693479e-01   +2.192092032543882e-01   +1.751370907931623e-01   +1.286033816419476e-01   +5.030360778518710e-01   -5.121757262744356e-02   +7.278817376907040e-01   -1.043718290852197e-01   +1.244240167021897e-01   +6.058972422455206e-02   -9.673125832111183e-01   -3.256243992036769e-01   +5.353187517955521e-01   +1.961858160979635e-01   +2.020372018215842e-01   -1.722273137534297e-01; +9.753522794244250e-01   -1.893197098960098e-01   +3.719323935929170e-02   -8.974770458739392e-02   +6.178369305500498e-01   +2.819000625355679e-01   +2.894836086457811e-02   -7.084858317242575e-01   +1.285376638208277e-01   -4.513899683263055e-01   -6.522622274114757e-03   +2.554009810782337e-01   -5.013437950784745e-01   -1.747552740085865e-01   -1.124575570173410e-01   +5.777189285195240e-01];
L1E_L1I_iGABA_netcon = [-1.763896467980162e-01   +4.483688365557714e-01   -4.259242905902436e-01   +2.985554333160277e-01   -1.831589829605702e-01   -3.409143136722718e-01   -6.247750799149050e-02   -1.010419153572126e-02   +1.972766586397726e-02   -1.546509051509156e-01   +2.585839716896235e-01   +4.447912362765155e-01   +4.189267173724109e-01   +2.616205215056075e-01   -3.003627570416446e-01   +6.244526032133858e-02; +4.180739219743279e-02   -1.534831150181627e-01   -1.288745681468901e-01   -1.315004178104365e-01   +3.507082898004222e-01   +2.064298584369657e-01   -2.734716052002245e-02   -3.378255943663149e-01   +4.200046198489777e-01   -4.664501965372070e-01   +6.934515778952984e-01   +1.031302488919692e-01   +1.801008122045955e-01   +2.551833724097378e-01   -1.206130704505031e-01   +2.265803803102298e-01; +7.873518748626636e-01   -3.148891092726782e-01   +3.490333890263196e-01   -1.337136385984440e-01   +3.851157256161840e-01   +5.550632788996577e-02   +3.818293823311514e-01   -2.905619474713611e-01   -3.099604726916738e-01   -6.109469197425260e-01   -1.441776539040977e-01   -5.039080217619389e-01   -3.476511530242516e-01   +1.863053167479098e-01   +5.745712622468420e-01   +1.657590067295416e-01; -1.124166160170748e-01   -3.214685335624696e-03   +3.939811942762506e-02   +5.269338189418925e-01   -2.664211173567446e-01   +6.724891843458798e-01   -8.879959199954583e-02   -5.568393539477978e-01   +2.819780617873464e-01   +3.632956328627286e-02   -3.866874959326704e-01   +6.389328115010106e-01   +5.792345790809620e-02   -5.294645368454175e-01   -5.651265564380891e-01   +3.627810754116991e-01; +2.487567537154445e-02   +3.494724071736271e-01   -5.419462121304608e-02   +3.841178974092257e-01   -2.600437522145689e-01   +2.348338554207497e-01   +5.014243946720437e-01   +6.509233660423165e-02   +2.780642464872539e-01   +3.724844681367557e-01   -3.350514020692819e-01   -3.510098719773826e-01   +3.227127181115529e-01   +2.400295402088971e-01   +6.584494334839346e-01   -2.912682413253141e-02; -6.693060704321665e-01   -3.039982420632548e-01   +3.348397358387721e-01   +4.003071951203857e-01   +5.090538331876771e-01   -2.146879191309678e-01   -3.890050392399570e-01   +5.241475581340456e-01   +5.830104995448072e-02   +4.536780975178580e-01   +6.418843118969230e-01   -3.227819252068836e-01   +1.905609377731946e-01   +1.869271529137899e-01   +1.845597619470104e-01   +6.427665854536957e-01; -4.078619739443565e-02   -5.758513703384952e-01   +5.570503070188068e-02   -4.396602353632950e-01   +1.067242342832246e-01   -6.954351827008627e-01   -6.993738880038855e-02   +5.980092968423701e-01   -2.738150546684000e-01   -3.823610151634506e-01   -4.520634161835053e-01   +2.370984787505709e-01   -3.329167788032933e-01   -4.711673160977873e-01   -4.046276470824497e-02   -4.957474043102245e-02; -5.258450315027035e-01   -5.288703046538237e-01   -1.760445906619199e-01   -1.803573744084416e-01   -9.465404438791110e-03   +3.989223589919773e-01   +4.526865267709307e-01   +6.983758196488676e-01   +7.417747637197872e-01   +1.925874703488660e-01   -3.415555946496200e-01   +4.775169593951828e-01   +3.082785452144066e-01   +9.826250746094740e-02   +3.392568311279391e-01   -2.086976886642360e-01; -2.356218854045037e-01   +1.135065665455172e-01   -2.107535843255230e-01   -3.754118035673120e-01   +4.525307996118804e-01   -5.218334783849271e-01   +1.045250783579445e-01   +3.819586484032887e-01   +5.035322974678155e-02   +1.595457007574223e-01   -6.128031604198683e-01   +1.428396557244066e-01   -1.897096396144979e-01   +7.482268430633646e-01   +6.871565869947975e-02   -7.844873101356675e-01; -2.473579655610268e-01   +5.126290353003275e-02   -8.707240602285974e-03   +3.767189316957123e-01   -4.878497395165208e-01   +6.474331163779550e-01   +6.420299473363938e-03   -3.660671396912930e-02   +7.397524098136622e-01   +2.920832076815257e-01   +5.523641847250405e-01   +1.474179661806799e-01   -3.792550067818165e-01   -7.876696968553080e-01   -4.098660521254150e-01   -5.520151359239809e-01; +6.499007031300083e-01   -5.695688928438799e-01   -3.516013664878954e-02   -1.846292152309378e-01   +1.904476315973466e-01   +8.534858645844932e-02   +3.714521112386227e-01   +2.370711658070034e-01   -1.524072932159270e-02   +5.585023374177726e-01   -3.139303034597454e-01   -7.443638435558673e-01   +3.096988504533987e-01   -5.282916941365955e-01   -6.075279546750102e-01   -2.150364385300108e-02; +4.329852743823039e-01   +3.770106163997575e-01   +8.241426776800764e-02   +8.795428833208896e-02   +3.919276691743298e-01   -5.721894769132928e-01   -4.943085344340940e-01   +3.009108610422517e-01   -2.459936137359592e-01   -1.154488641749358e-03   -4.368686193512961e-01   +5.273762491439162e-01   +4.088416289205397e-01   -3.336945645516000e-02   +5.184880724264479e-01   -6.428811797261520e-01; -5.915021462020886e-02   -2.188059469126590e-01   +2.873531961645917e-02   +4.353384670413556e-01   -2.650475032869510e-01   -7.722101711667065e-02   +3.739345690981241e-01   -9.498663565931173e-02   -1.585328490296415e-01   -4.525426344833038e-02   +1.019480398636479e-01   -6.944331477656850e-02   +7.666991229938065e-02   -4.646483924563308e-02   -7.240154129762939e-01   -3.980823380090002e-01; +7.189274492260841e-01   -2.945842597669887e-01   +4.534975061688539e-01   -5.579911798475919e-01   -1.562507013708331e-01   -1.745956877680681e-01   +1.512910752915965e-01   +5.821414194474337e-01   -2.999908705933758e-01   +1.212882199232675e-01   +8.247959410860047e-02   -4.866783783863924e-01   +3.497809401224438e-01   -4.110506687750662e-01   +4.726567404707089e-01   +5.822366986806884e-03; -2.470736474065686e-01   -3.883123695925900e-01   +1.615878803782680e-01   -3.229155581510894e-01   +4.451897819219652e-01   -5.302362535108707e-01   -2.411265796762684e-01   +1.368424337164413e-01   +6.721038512126819e-01   -4.129457800937836e-01   -2.281891327686562e-01   -1.000000000000000e+00   +2.231323815728439e-01   -2.783048471345467e-01   -2.714760511143691e-01   +4.237832253078067e-01; +2.998538098639073e-02   +3.918351736487578e-01   -3.274396421730272e-01   +1.100199204839869e-01   +4.410335131015564e-02   -2.122152919025278e-01   -9.061245822414064e-02   +4.482220871065083e-01   +5.745656316210725e-01   +3.788170765007248e-01   -9.172531058244148e-01   +1.665661921404921e-01   -8.696735891185865e-01   +7.649739296124465e-01   +8.515340219082573e-02   +6.701440570932325e-01];
L2I_L1I_iGABA_netcon = [+1.375938081130629e-01   +3.376713419029034e-01   +9.664289081542071e-02   +3.217636051373868e-01   -6.976917336771442e-02   -1.452535288271630e-01   -4.530239365521356e-01   +8.629929063944180e-03; -2.969949137115668e-01   -4.232189912119435e-01   -9.575264731178017e-02   -7.460241978207673e-02   +3.019047415163795e-01   -4.330012774424317e-02   +5.945175495494278e-01   -1.672534421488921e-02; -4.330386797939451e-02   -4.658894165244585e-01   -7.211902945083152e-01   +3.755573692013389e-01   +9.616396845359118e-02   +1.921882615560475e-01   +4.391586119692933e-01   +6.667916243690843e-01; -4.569139709262792e-01   -1.373122460047823e-01   -5.798988727513609e-03   -1.671314441762977e-02   -2.198232043833842e-01   +1.260618078064888e-01   -4.148623929143876e-02   -4.742160508912759e-01; +3.977481960212302e-01   +1.436802183878395e-01   +5.490969264770832e-01   +1.217383773214890e-02   +4.661116570481348e-01   +5.559458265678487e-01   -7.035726278674592e-02   +2.133572519752817e-01; -7.084933300031179e-01   -1.995537349916540e-01   +6.549437108163058e-01   +2.199270443850776e-02   -3.037464825649760e-01   +1.568589615551584e-01   -2.289495015382516e-01   -8.024413112111550e-02; -3.651116064915607e-03   +1.214400570993654e-01   -5.880495346333819e-01   -1.000000000000000e+00   +3.488753979603242e-01   +4.957366839949195e-01   -2.208978888126459e-01   +5.119011865756922e-01; +5.546187050787189e-01   +4.985164657873549e-01   -2.036211599679201e-01   +2.264946624223353e-01   +1.970839528038299e-01   -5.729054981701712e-01   -2.794519749473132e-01   +2.591516600419154e-01; +3.841752904908524e-02   -4.682096266661468e-01   -4.116379508048639e-03   +3.229497933682652e-01   -1.595715079242171e-01   +4.618941723212691e-01   -6.260036337033713e-01   +5.378908929808829e-01; -2.485625470136669e-04   +4.069010958950113e-01   +2.889967335798551e-01   -7.756281014681256e-02   +6.494259181852972e-01   -2.182442908647697e-01   -4.222320690752713e-02   +3.720592072352726e-02; -2.452277324994606e-01   +5.454832609448517e-01   -2.979535878590336e-01   +3.584021053963617e-01   -3.266586634647232e-02   -3.615190764729755e-01   +5.698770665418869e-01   +2.450453002977352e-01; -2.731899569144369e-01   -6.415305783977099e-02   -3.143730932135381e-01   -8.335736025609081e-01   +4.870658436556723e-01   -3.795011737108268e-01   +1.242272650950732e-02   -1.221179826437977e-01; -4.034814953536522e-01   +7.100803098118218e-01   -4.730276218324356e-01   -3.531317681319083e-01   -6.024436388360185e-01   -1.678713796667311e-01   -8.510431622931082e-02   +3.707564135943673e-01; +2.501937891374452e-01   -8.196998137634692e-02   +3.670430402461756e-01   -7.025692442068443e-01   -3.408908842124877e-01   +1.169042994361763e-01   +9.002680509709925e-02   +2.960486189104043e-01; +1.301719702723351e-01   +1.958373440830550e-01   +9.321234848772804e-02   -2.038546504723285e-01   -1.230292431317968e-01   -4.029495234365896e-01   +6.520287042616364e-02   -7.461029540486795e-02; -6.426208139497210e-01   -3.208456848036100e-01   +1.540078608408344e-02   -4.062802610262399e-01   +5.844834630713558e-01   -4.769838519093098e-01   +4.320045905791902e-01   +4.623798535081565e-01];
L1I_L2I_iGABA_netcon = [-3.072684227205624e-02   +2.504352454140686e-01   +3.167129478729738e-01   -1.114719211194019e-01   +1.733475846023331e-01   -7.282435432155335e-02   +2.976801393723015e-01   -2.101010267403071e-01   +4.322445812917720e-01   -3.697355199165680e-01   +2.376420627245467e-01   -2.622217418657549e-01   +2.442013913440325e-01   -2.822511421748444e-01   +3.179336827855871e-02   -1.936455546619608e-01; +3.527400793654725e-01   -6.351203901764089e-01   +2.711743572326478e-01   -4.599979530561991e-01   +2.059356989447883e-01   -1.947956040116463e-01   +8.858245181250261e-01   +6.288718711077277e-01   +7.690584215121939e-02   +3.535466970385448e-01   -6.255882738780010e-01   +4.255352467800937e-01   -7.035554263468002e-01   -5.879154467237672e-02   +2.935711064369444e-01   -4.112738573571838e-01; +1.949876548873539e-02   +3.720989460866131e-01   +4.360651198088082e-01   +7.421643142288984e-01   -3.753360206684172e-01   -7.318841141754182e-01   +5.571532564196409e-01   +6.412027865216974e-01   +6.132215976498666e-02   +3.138749881414489e-01   -2.422754976547657e-01   +1.216846503048422e-01   +4.043266544839990e-01   +6.366064739189349e-02   +5.925185244193183e-01   -3.747496634987967e-01; -2.781891131138902e-01   -3.970743275551812e-01   -1.860282489896815e-01   -4.771757697360040e-01   +3.087987680441235e-01   +4.369899105414949e-01   +5.450098753434166e-01   -1.311350979810115e-01   +6.993651633109583e-01   +9.276700305894046e-02   +6.940489743314655e-02   +5.360802385013227e-02   +7.352707921799414e-03   +6.004297432678889e-01   -3.463393675186585e-01   +1.562095418799038e-02; +2.379896076766927e-01   +5.445070640661843e-01   +1.979913714954902e-02   -8.776294036016438e-02   -5.336580547996009e-01   +1.096518701213806e-01   -7.827038892240800e-01   -7.453778262662118e-02   -2.192440982260194e-01   +1.303597302295934e-01   -3.100824309207616e-01   -5.162984029109234e-01   -1.730754813706475e-01   +1.243073693395514e-01   +2.614751369012549e-01   +7.853347590701344e-01; -3.537789460206233e-01   +1.054248202979976e-01   +6.144647582606633e-02   +3.819287598429528e-01   -3.055153595450291e-02   +2.825365628631756e-02   +3.403047795514259e-01   +4.214763507611691e-01   +3.677624734664976e-01   -1.297100425603365e-01   -1.921043613871760e-01   +2.695199426497790e-01   +4.215216180038769e-01   -6.902763077420363e-01   -1.562517903811513e-01   -8.304048712977977e-01; +4.357461829784978e-02   -1.211405903391101e-01   -1.238386935660620e-01   -4.549861577487599e-01   +3.428454047372192e-01   +6.320364990912831e-01   +4.371630357931108e-01   -2.963214954836730e-01   -4.368157143605781e-01   +5.092844601451624e-01   -6.893161640323924e-01   +4.000874064814367e-01   -2.480993883250144e-01   -1.000000000000000e+00   +1.026335512710921e-01   +8.586010162268461e-01; -1.422538765229246e-01   +6.494045874314307e-01   -2.447083966687096e-01   -5.067776079801790e-01   -6.139931750500200e-01   +9.252423369315377e-02   +1.486809168034607e-01   +8.221313370461265e-01   +3.645159275097678e-01   -2.334426927244196e-02   -5.799711467466345e-01   -2.953084281219422e-01   -6.503426885661726e-01   +4.628736937872683e-01   +5.277110299507682e-01   +8.896730638392392e-02];
L2E_L1E_iAMPA_netcon = [+3.628302204958276e-01   +3.922383975827614e-01   -9.311127326201751e-02   -9.062577022711116e-02   +1.487209263361339e-01   +1.889766425704894e-01   -9.054610082677307e-02   -2.351405135922967e-01; -7.085883083366722e-01   +6.106885479192659e-01   +1.321891827092793e-01   +2.716248801928902e-01   -5.806796055348378e-01   +6.010506164060110e-01   -3.598613576330367e-02   -5.397486212159254e-01; -1.435466148255706e-01   +2.320732552052287e-01   -9.844665522361074e-03   -4.954110237048690e-01   -4.284424470564444e-01   +5.431695128893284e-01   -4.971695956389843e-01   +6.512000884461890e-01; -1.895670344238745e-01   +1.263360923229073e-02   -5.309783187219691e-02   -5.634958550323776e-01   -2.132942086160694e-01   +3.254655153757880e-01   -7.423108008392498e-01   +9.004256790911015e-02; -2.014158471489171e-01   +2.614288802424675e-01   +4.597664922093878e-01   -3.956378896805762e-02   +2.992900384953050e-01   +7.386883102819708e-01   -3.093292733813141e-01   +2.847934682899994e-01; -6.840882285499659e-01   -5.422476174084387e-01   -8.862357926996344e-01   -5.724494182415563e-01   -6.967572546312720e-02   -8.794331741910305e-01   +1.245842843746778e-01   -3.514676462389377e-02; -9.511525136803835e-02   +3.471654813048191e-01   +2.701981593018533e-01   +3.279625352948294e-01   -1.365290216184489e-01   +1.699977399544303e-02   -4.780952956185294e-02   +6.498971347001132e-01; +5.556763227842287e-01   -1.940792564912216e-01   -5.347971470891760e-01   +6.452592514772097e-01   +1.486432417460776e-01   -5.921560090404210e-01   -2.733219188002612e-01   -3.081961562377106e-01; -3.555727949588549e-01   -2.748084529071475e-01   +7.689843613873468e-01   +2.514051042558948e-01   +7.073233509569000e-01   -6.030617382025010e-01   -1.991848238767829e-01   +6.765904792135902e-01; -2.773302768493957e-02   -2.603105730984850e-04   +6.742890335447452e-01   +4.064494533881754e-01   +3.110461527231914e-01   +4.508518179164100e-01   -2.456911539784544e-01   +5.101063585526353e-01; +4.106323965733540e-01   -3.982069446205799e-02   -2.819680163375272e-01   +1.156784568717278e-01   +1.399477695969827e-01   +6.802170951532333e-01   -3.429141186632967e-01   +1.130665104917151e-01; +5.411294614806935e-01   +8.204315306959628e-02   -4.003016780873980e-01   -3.911076426528751e-01   +2.293421609580966e-01   -3.386102609393683e-01   +2.675513834882944e-01   -4.247232554074108e-01; -5.368666503967086e-01   -5.039335855623386e-01   +9.706107767204899e-01   +7.389579030847403e-02   +8.751021640095952e-02   +2.434758822471154e-01   +1.563716306086267e-01   -4.121040050839757e-01; +3.636113895184415e-01   +2.256811042929690e-01   -8.980995982550795e-01   +1.383898941669287e-01   -1.831688558587029e-01   -5.896546194086983e-01   -5.304024523046199e-01   +7.787556423429978e-01; +3.669402106592622e-01   -5.889541560615164e-01   -1.109369328353102e-01   -3.506074716888992e-01   -8.435153154477970e-02   +5.171163941165725e-01   -4.684525330378100e-01   -1.358352256333763e-01; +1.689052963451154e-01   +9.742712120804096e-02   +1.374614067047314e-01   -1.114424437790705e-01   +7.353611010351124e-01   -5.181153574308262e-01   +9.749492944535799e-01   +8.020953137526932e-04];
L1E_L2E_iAMPA_netcon = [+7.355550800850219e-02   +2.466147150413091e-01   -3.401924814928584e-01   -4.065867686582361e-01   -5.613836338535063e-01   +1.738418036391952e-01   -3.676949231322979e-01   +1.884142625167542e-02   +5.823156769747169e-01   -4.914149972457021e-01   -6.160557267924750e-01   +2.047966681845390e-01   +3.863497036895271e-01   +2.441500765418583e-01   -4.240300557084312e-01   -7.136767369912570e-01; +5.447032456754062e-01   +4.212160418821553e-01   -1.516692167088068e-01   -5.668429533160742e-02   +4.388675784428935e-01   -4.436786057062243e-01   +2.882799377043035e-02   -9.835191052165189e-02   +6.693169133503890e-02   -7.868156926182832e-01   +1.669204545969537e-01   -6.126560540112103e-01   +3.406498190074914e-01   +2.604198325467750e-02   +8.331116081689813e-01   +4.230651257811835e-02; +1.261747272502043e-01   -4.232683085215001e-01   -3.070603383555478e-01   +9.461584013286359e-01   -2.743545124878069e-01   -2.003787515085233e-01   -1.046197970584677e-01   -2.354905639519594e-01   -4.594714815087581e-01   -1.731059284734995e-01   +1.531649206248749e-01   +1.908288837848550e-01   +6.164225052675796e-01   +8.870330371369850e-01   +3.383007961039253e-02   +2.221941366177899e-01; +1.444075166801123e-01   +9.446184557889070e-02   -2.259101241319122e-01   -8.825903438704439e-01   -2.226705155318167e-01   -7.285893552764247e-01   -1.287164590487030e-01   -9.306443291602216e-01   -1.013724619245304e-01   +1.153043218905454e-02   +7.141345998890707e-01   +2.121621010706830e-01   +6.732948880230905e-03   +2.252038084549327e-01   +3.019789105387652e-01   +4.237812076255398e-01; -4.476756286570107e-01   -3.969997130085777e-01   -2.886464070035087e-01   +9.667323877216980e-01   -8.863224609981611e-01   -3.718151788085853e-01   -1.840486733425285e-01   +1.813062676790877e-01   +6.071843135339545e-01   +5.645198508932205e-01   -3.235264520049682e-01   +3.643675671710239e-01   -5.631364276246116e-01   -3.087935268276840e-01   +7.038526806845795e-01   +8.003023433428922e-01; +6.166413000940398e-01   +7.147839965884611e-01   +2.675168331310885e-01   +3.684876592132156e-01   -1.050557899061277e-02   -2.261062834225669e-04   -3.765065582405197e-01   +5.316384681257806e-01   -1.693422899122545e-01   +6.829901935629692e-01   -7.194862276483784e-01   +4.547731390444723e-02   +4.253730665728182e-01   +8.112412158504460e-01   +3.815890299982607e-01   -1.918336221909701e-01; +8.389800840352235e-02   +5.512129785732034e-01   +5.484028041584808e-01   +1.227702574482634e-01   -6.322436674466657e-01   -2.741509973028466e-02   -5.963402248916829e-01   +8.257488609962044e-02   -1.932678125936240e-01   -6.733632911611402e-01   +7.759260681044894e-02   -5.356666020853192e-01   -8.121187499662561e-01   -5.566353998298592e-01   -7.343032924792076e-02   +4.709936951679086e-01; +5.330841593365014e-01   -3.276809019418329e-01   -4.464619125704734e-01   +1.607716406699430e-01   -5.297587098976508e-01   +3.206817730565763e-01   -1.548549037766300e-03   +4.348772799645489e-01   -4.214685667492707e-02   +4.354591800221810e-01   +3.703043399727121e-01   -3.464673180354513e-01   +7.940133467089333e-02   -3.772046189155223e-01   -1.709392969363159e-01   +5.582414026013862e-01];
L2I_L2E_iAMPA_netcon = [+1.062277483302352e-01   +2.097362737197025e-01   +6.902984347798933e-01   +6.908497289525729e-01   -2.195200139412296e-02   +8.163596126276884e-02   +6.410477832320187e-01   -5.251833516734319e-01; -4.030119671443935e-01   +8.720071098147402e-01   -3.563992301271585e-02   -6.794539901844020e-01   -2.054904603420731e-01   +5.435553170530629e-01   +5.635476072416739e-01   +1.167291566960408e-01; +4.002281594717722e-01   +4.386101119314594e-01   +5.275938336427195e-01   -1.359090812415807e-01   +2.667436246052395e-02   -2.432163212065310e-01   -1.831809542290898e-01   -4.385100754432102e-01; +9.714953123209361e-01   -2.587693335204454e-01   -6.537339713941777e-01   -1.000000000000000e+00   -2.183180715616776e-01   +5.606233784657931e-01   -5.721767719012246e-02   -2.052513881079970e-01; -1.679981012775531e-01   +3.401914862888274e-01   +4.051355543727107e-01   -6.048306607092668e-01   +5.420654473478807e-02   -7.688624252608679e-01   +2.761292839908209e-01   +2.457674592303019e-01; -3.845550674311111e-01   -1.246164113637058e-01   -6.840563092880678e-01   -5.753154550103050e-01   +4.926444698568450e-01   +2.075320938207569e-01   -8.549615352402684e-01   -3.087091469305088e-01; -7.760404535784928e-01   -3.437364041597935e-01   -2.693271120871761e-02   +6.829097885393659e-03   -2.597089083599008e-01   -1.239150609245329e-04   -7.321636565977033e-01   -5.701759768905621e-01; -2.669954655236431e-01   +5.100390952806275e-01   -2.101565566189782e-02   -6.404457809707256e-02   +5.759095143563338e-02   -4.706976947945150e-01   +1.033143831990824e-01   +1.737099223030417e-01];
L2E_L2I_iGABA_netcon = [-4.640541388376259e-01   -8.391652652054475e-01   -6.465267481888053e-01   -4.982556203870934e-01   -3.210132930238271e-01   +1.179862849397665e-01   -1.000000000000000e+00   +1.773985896255329e-01; +8.363622354756982e-01   -2.795282784217632e-01   -5.973136801082958e-01   +2.832349105335413e-01   -5.698769185119310e-01   -8.282911598618700e-02   -2.066696443572858e-01   +5.721780710858378e-01; +1.626055108632696e-02   +4.545874529260613e-01   +6.347460018029012e-01   +7.224607259985336e-01   -4.356828846514396e-01   +3.485423910909609e-01   -7.261592327943482e-01   -6.576571174765661e-01; -2.657273340170067e-01   +5.662313560974988e-01   -8.302575951117934e-01   -8.476483550302459e-02   +7.104565370821342e-02   -3.019700734809475e-01   +7.567113993318091e-01   -5.700157687623147e-01; +7.744378711680338e-01   +3.748593492940160e-01   -7.309885733474822e-01   -3.370792559631092e-02   -6.307554451920462e-02   -3.298442271946678e-01   -7.644859932231660e-01   -3.809566157051211e-02; -4.325545584390838e-01   -9.391607411353121e-01   -2.012041766643391e-01   +2.585309168920125e-01   -5.025061264118992e-01   +6.062462884084920e-03   +5.526132731227190e-01   -2.424060073535633e-01; +9.214214467081994e-02   -1.654961138219849e-02   +4.551777329963236e-01   +2.610072407948332e-02   -7.777112891897031e-01   -2.902720553453284e-01   +4.320597696820000e-01   -5.788689563690712e-01; +3.822173193463307e-02   +1.574075557064237e-01   +6.909936637005964e-01   +8.972376795134057e-02   -2.616519126232140e-01   -2.622849085113311e-01   +4.149397305716176e-02   +7.764367854672203e-01];
L3E_L2E_iAMPA_netcon = [-6.400457498359158e-01   -4.272727609559671e-02   +4.641536119603572e-03   +6.830718617519794e-01   +7.497230440737763e-03   +4.722982715036662e-01   -7.952305171672847e-02   -3.718254143100964e-02   +5.933344716575520e-01   +5.315667990762939e-01   -1.614800329775404e-01   +9.054748539341297e-01; +1.454112877563110e-01   +6.858769164523518e-02   +1.730147728576539e-01   +7.136688563044568e-01   -5.974181636015508e-01   +7.138571100720575e-01   +7.193407821255490e-01   +3.506569396786872e-01   +6.692647512707118e-01   -2.749935123546293e-01   -3.342099248793337e-01   +6.755683744948717e-01; -5.401628598278899e-01   -1.598169421637212e-01   +4.385358002902752e-01   +1.917041419693776e-01   -7.614495548240358e-01   -2.746086658608332e-01   -3.218055173357123e-01   +1.285167881602731e-01   -2.800266520729957e-01   +1.984523038037419e-01   +3.153973799350944e-01   -7.311830584276341e-01; +1.000000000000000e+00   +3.247445954936216e-01   -3.910066471319876e-01   +2.093729475676413e-01   -2.047362963960865e-01   +2.449614963633922e-01   -2.826187857201495e-02   -3.310355624796238e-01   -3.070452902278843e-01   -3.950519376631582e-01   -2.647456751841641e-01   +1.091535367861050e-01; +1.273410760493759e-01   +6.913979641197404e-02   -3.400602494895475e-02   +1.563263403329648e-01   -4.092619613429490e-01   -1.379423458218232e-01   -8.203708385110373e-01   +8.182919081326258e-01   -6.612303011895528e-01   +1.483239595511676e-01   +3.977612014550764e-01   -4.125768854886309e-01; +6.069139255703797e-01   -1.059877155218800e-01   -9.364912308985364e-02   -3.064338713792631e-02   -2.575395971604187e-01   -6.260124765088352e-01   -1.909969811067412e-01   -7.979637188445824e-01   -3.435984936970213e-01   +7.378530827914240e-01   +2.139504375328789e-02   +8.969595077024355e-02; +1.244166523492633e-01   -1.441485896424179e-01   +6.947542070627295e-02   -3.804755306186975e-01   -1.832239159927492e-01   +4.591292403502157e-01   -4.043194857808461e-01   +2.446972286785191e-01   -1.979456770058982e-01   -2.901616434507152e-01   -5.728465316523621e-01   +5.524224615524232e-01; -5.166808625602736e-01   +4.104184907308766e-01   -9.010616432832468e-01   +5.750248310391731e-01   -2.188915227699260e-01   +5.753764379324734e-01   -2.745405883341048e-01   -4.501033395350668e-02   +1.443669861778277e-01   -5.191920972351388e-01   -1.254274219695506e-01   +5.442122700338849e-01];
L3I_L2I_iGABA_netcon = [-1.023428594639475e-01   -4.634621280019693e-01   -3.044695061109848e-01   -5.938291108979404e-02   -6.112104445990270e-01   +2.795160383162573e-01   -4.837109899345756e-01   +1.328755508308830e-01   +8.268755837186207e-01   -6.585786612360610e-01   +3.428014970583259e-01   -4.433874216007739e-01; -5.185050373571181e-01   -3.528107658917461e-01   -5.068971953864291e-01   +7.568738011565381e-01   -8.808249995342228e-02   +1.499093945234246e-01   -5.594278834880385e-01   +8.423833481739528e-01   +3.852102435603068e-01   +7.028996312286556e-01   +2.616498614284894e-01   -1.604043307257907e-02; +5.804521319944355e-01   -4.080436674374553e-02   +5.494407885375828e-01   -4.244213410641950e-01   +8.938303767018436e-04   +8.148254210522670e-01   -2.582528004382777e-01   -5.488641378703004e-01   -6.312634569347902e-01   -4.872804899956067e-01   -3.623067550379169e-01   +9.864244548719701e-01; -5.928459506364816e-01   +8.005652594177662e-02   -2.374835049156800e-02   +1.451679264788651e-02   +6.656430143453821e-01   +2.284382943868877e-01   -6.906511545891106e-02   -3.732338876958909e-01   -1.000000000000000e+00   +2.090696082021644e-02   +1.094490959871047e-01   +1.804087100090228e-02; +2.450278941449701e-01   -2.296368822569839e-01   -6.079588756380043e-02   +5.037453973346675e-01   +3.121678302723729e-01   -4.132531733063737e-01   -2.150622127321674e-01   -5.195300911722803e-01   -5.323875423694127e-01   -7.181410108702959e-01   +4.178568131937649e-01   +2.651044541868907e-02; -2.397699811503156e-01   +3.627178894706200e-01   +3.636266215926516e-01   +6.044996442548741e-01   +3.322902841978095e-01   -3.542920800425148e-01   +3.615992675738214e-01   +4.148441752520892e-01   -2.513107035891593e-01   -1.148224731134632e-01   +1.758402712666842e-01   +4.359168813542277e-01; -3.536386224928006e-01   -5.254881085037062e-02   -1.160365117562498e-01   -7.107957962662214e-01   +1.058885340169294e-01   -1.208568819906936e-01   -3.398707416652251e-01   +1.650485492684920e-01   -6.519694233005388e-01   -1.234614230058335e-02   -4.539771306953731e-01   +2.647492021785839e-01; +1.782761740541529e-01   +9.035873429805008e-01   -7.444123200429842e-01   +5.249370762699833e-01   -2.494405449885289e-01   +2.645394797746687e-01   -5.780985714596553e-01   +3.180701987748760e-01   -1.056738463516150e-02   -2.687693585206715e-01   +1.643668130976833e-01   -7.940428828724072e-01];
L2E_L3E_iAMPA_netcon = [-6.522625698898529e-02   +2.494484869717452e-01   +8.425418484220600e-01   -1.000000000000000e+00   +1.860569927629973e-01   +8.534441249636521e-02   +2.094652397813833e-02   -5.884096014561507e-02; -1.899165628835015e-01   +1.667478287639900e-01   +7.035818260966397e-01   +2.059142703134210e-01   +9.917492188944715e-02   -4.529452325259942e-01   -2.612717630290503e-01   -8.910376197574731e-01; -3.463090834758648e-01   -2.560131498912636e-02   +7.212619253230786e-02   +9.004025291374309e-01   -3.731359392762759e-01   +7.868753335983202e-01   +5.424026543090377e-01   +2.246160460677504e-02; -7.867054461575367e-01   -2.902927389130930e-01   -2.360476845454534e-01   +2.844307958380858e-01   -2.043644655982506e-01   +6.138697269073430e-03   +4.660579863243435e-01   +1.020843630444713e-01; +6.455084676083898e-01   +1.598199008460840e-01   -5.293303919990252e-01   -2.881803699714175e-01   +5.788953154460564e-01   -6.245568034186441e-02   +2.705351973601878e-01   -3.257692074011170e-01; -5.689412080444073e-01   -7.970280452345863e-01   -4.833321204060975e-01   +1.997656535791988e-01   +5.906102098179440e-01   -6.814370431786915e-01   -3.932480214300296e-01   +2.649502448851597e-01; +3.356904189113006e-01   -1.018297324090547e-01   +8.184230590469467e-02   -3.770534220559155e-02   +5.187737983065104e-01   -3.503125644360022e-01   +1.984822336524987e-01   -1.956586102571284e-02; +3.327461442606618e-01   -2.440744446069386e-01   +7.985131738111640e-01   -6.138728072421227e-02   +1.745686957989418e-01   +3.427441216189599e-01   -7.382519643032371e-01   +2.270604730997536e-01; +1.311478954122688e-01   -5.661791210425901e-01   +3.140642413634676e-01   -4.173686519730263e-01   -3.408465097622954e-01   +3.545268416642531e-01   +4.639682947294293e-02   +8.849168542107217e-01; +1.829659792193237e-01   +6.208194077268352e-01   +1.621492734110576e-01   +4.147861663547321e-01   -9.320074140745882e-02   +3.156640653200732e-02   +8.589386899282774e-03   +7.756830996300603e-01; +1.120605360637061e-01   -1.157186066430486e-02   -7.148475321899407e-01   -6.709714586796094e-01   +4.752758060571364e-01   +1.989948847231066e-01   +8.455792923017917e-02   +2.324977316295074e-01; +2.434214591685954e-01   +1.792289401397104e-01   +2.255117461562350e-01   -7.293268675610056e-01   +7.082491272228325e-02   -8.783513459926091e-02   -9.566484482153292e-01   +6.682621487106970e-01];
L2I_L3I_iGABA_netcon = [-3.401922138529311e-01   -1.314686528659888e-01   +3.371241257329679e-01   +3.826290478990345e-01   -1.222470827942300e-01   +3.247813175227847e-01   +3.581482649402097e-01   +5.204234225869036e-01; +4.163005726660194e-01   +5.652733841489794e-01   -7.137597409994988e-01   -4.114348291728867e-01   -7.304788658531106e-01   +2.852459927989117e-02   -3.843635692679944e-01   -2.289468083246988e-01; +7.933137878916963e-01   -7.267956493632715e-01   +2.492915449124713e-01   +3.514167327570353e-02   -6.239406685337902e-01   +6.549469466981891e-01   +2.115934778291015e-01   +6.972452662434173e-02; +3.102905235231537e-01   +8.875974163456628e-02   -5.741228642984024e-01   -7.686078787960565e-01   -1.559350696682050e-01   -1.053661467050216e-01   -9.204282262756232e-02   -7.815148880137459e-01; -4.099946830383071e-01   -3.931869958758832e-01   +8.018032885039412e-01   +9.901888129577523e-02   +3.670495753833147e-01   +8.915588481538702e-01   +1.317159944288764e-01   +3.974765498254019e-01; -7.911510592107347e-01   -1.811710976475006e-01   -1.955485833876733e-01   +1.940580823853364e-01   -4.947827517503959e-01   -4.199246937563524e-01   -7.512089018523033e-01   -6.023417030181774e-01; +9.254025396964508e-01   +2.415181954351852e-01   +3.714278188882391e-02   -7.618627685047994e-01   +5.796951483932409e-01   -3.636252045195930e-01   +2.164883875823554e-02   +4.582835177100763e-01; -2.274764915971204e-01   +1.591640756355102e-01   -1.078507618730756e-01   +6.763015736988746e-01   +2.472115099423144e-01   +2.179443410235684e-01   -5.590629563027220e-01   +1.059017693660990e-01; -5.534042536378454e-01   -8.842479181556260e-01   +3.029331173180796e-01   +1.217143912762838e-01   +2.904032684823131e-01   +3.985337495989791e-01   -1.106942973762570e-01   +3.603835220950700e-01; -8.670732481950236e-01   -2.825437590491769e-01   +1.920229654658020e-01   +8.910255061326001e-01   -1.000000000000000e+00   -5.250606219080749e-01   -5.530647777529402e-01   -4.014417949057100e-01; +2.955139409511048e-01   -7.575705762350634e-01   +5.245255573081492e-01   -5.639922922373908e-02   -1.021527190189824e-02   +2.567890789476983e-02   +8.247076287927192e-01   +8.443671278898681e-01; -3.000196585978044e-01   -4.171430672288170e-01   -1.502167086885546e-02   -7.774965754300948e-02   +2.983533300039289e-01   +5.112012361235014e-02   +7.853028834224296e-02   +4.796274506838892e-01];
L3I_L3E_iAMPA_netcon = [+1.249230840124947e-02   +1.850383072904380e-01   +2.789366731660508e-01   +6.573957156038052e-01   -2.237027521367139e-01   -1.115456773264492e-01   -4.109508330132408e-01   +2.602095362800010e-01   -1.454186269154365e-01   +7.689349912394501e-01   +3.295191562118813e-01   +2.760222277206612e-02; +8.678322084996116e-04   -5.028677649417451e-02   +5.016597980447728e-01   +8.429123103635922e-01   +2.950520343703968e-01   +6.445520233400444e-01   -5.848217908653948e-01   -2.807854773392201e-01   -7.637825326389399e-01   -4.119672196692982e-01   -3.750188066292564e-01   -1.847793814744958e-01; +2.433128257754229e-01   -3.756082082784918e-01   +7.515647725915524e-01   +1.512091952311745e-01   -7.522056278074769e-01   -6.780243308297578e-01   +1.535341823334770e-01   +7.283633036477938e-01   +1.403185583374976e-01   +6.334513777015064e-01   +4.541097746719137e-01   +3.828047703978018e-01; +1.643594632422968e-01   -4.763758572649154e-01   +3.691866049577905e-01   -1.900595361246180e-01   -6.474014382221335e-01   -8.953634853910813e-01   +2.127634113326460e-01   -6.273052445779032e-01   +2.592901797423743e-01   +3.197661786914026e-01   +2.024233068423150e-01   -7.676613445836338e-01; +7.518564165061177e-01   -1.048663939131419e-01   +5.418781652637746e-01   +7.306412986051235e-01   -7.455654510200012e-02   -7.321516985480063e-02   +4.203092409304624e-01   -3.848569846692974e-01   -7.937412380417196e-01   -2.767233962460112e-01   -2.109355806337295e-01   +2.090384521639680e-01; -4.764225171091153e-01   -3.777891156219695e-01   +4.533428630595386e-01   -5.677773535829899e-01   +1.618551802576872e-01   -8.871608002990640e-02   -1.763716265938235e-01   -2.631962783358961e-01   -4.312481614314633e-03   -5.184645009160614e-01   +3.451476949829711e-01   +3.555537914666302e-01; +4.746139824529201e-01   -4.950300317282016e-01   -5.868976294227339e-01   -5.473627238909660e-01   -4.370702989654625e-02   +5.878725868667932e-01   -1.803261313239474e-03   -6.495811296821374e-01   +9.417838881912582e-01   +1.473907365187583e-01   +3.206795920388363e-01   -1.000000000000000e+00; +1.401535699428769e-01   +5.401518466943903e-01   +7.611330062140822e-01   +9.627588504146586e-02   +8.229315641556423e-02   -9.364702102646331e-01   +5.066481262961842e-02   +6.886517423662991e-01   -1.105184629258093e-01   +3.846825272658269e-02   -3.238696621385951e-01   +2.516328701937738e-01; +8.429641528458158e-02   -3.109447240302814e-01   +1.125215924992843e-01   -4.877220972481437e-01   -9.932237337258139e-02   -8.551324367040080e-01   +9.492039754106626e-02   +7.098043741454569e-01   -3.539687401782982e-01   +6.596895662339517e-01   -2.070487546025356e-01   +6.712489560781197e-02; +1.078570608410368e-01   -4.337112409173114e-01   -1.148055353805814e-03   -1.662430656252873e-01   -5.941089684796780e-01   +4.738777052973061e-02   +1.988906642583708e-01   -2.415357128212007e-01   -2.502757391804025e-02   -3.816823174354828e-02   +5.171963472928496e-01   -1.083516321891177e-01; +6.842030869842564e-01   -2.611826057468103e-01   +3.533483709581623e-01   -9.592964190347429e-02   +1.134378280901344e-01   +2.297265695103216e-01   +5.604918450560833e-01   -2.938847041873787e-01   -1.158430814118227e-01   +4.200501010647896e-03   -1.975878221033119e-01   +1.939202076370404e-01; -1.848542417978919e-01   +5.779097340165041e-01   -7.538862741269560e-01   -2.922327724985919e-01   +1.361960667209571e-01   +6.903628393311795e-02   +7.157570186240449e-02   -5.703507397563182e-01   +2.481717429383739e-01   -4.183645599682803e-01   +4.407714765169128e-01   +4.503356817753331e-01];
L3E_L3I_iGABA_netcon = [-1.563214327515109e-01   -2.796911936048438e-02   -7.050098046948082e-02   -2.943716352263518e-01   +2.007961608976958e-01   +4.849461895566919e-01   -5.123023074599661e-01   -5.574804946913394e-01   +4.109141969233139e-01   -3.287204209467543e-01   +6.723971631011390e-02   -2.416759291995782e-01; +3.049979455501824e-01   -2.721949785170759e-01   -4.494088670396206e-01   +1.043898050050190e-02   +2.598199317762751e-01   -3.602072579319957e-01   -4.601227593586462e-01   +2.766807158083024e-01   -1.984266413397575e-01   +4.086982614376655e-01   +1.123800654670662e-01   +7.811379877024751e-01; -1.565329383906972e-01   +4.500357643063208e-01   +7.072315466110931e-01   -3.076902395683561e-01   -3.471215174873553e-01   +1.761905567519415e-01   +2.118569687438086e-01   -1.744456252247550e-02   +6.283895932895085e-01   -6.910239237133216e-01   +4.756524977513057e-01   +3.753573940176026e-02; -1.605457921294084e-01   -9.512548592780874e-02   +2.379816992900503e-01   -1.761746421275502e-01   +1.916790177368033e-03   +2.479109414238823e-01   +2.727671303249777e-01   +4.771225126597706e-01   +4.189205562474856e-01   +3.833462309854913e-01   +7.208195287843880e-01   -2.956676771777841e-01; -3.801165640053232e-02   -1.315699714637493e-01   -2.110071273326876e-01   -5.474974310597586e-01   +6.338765549622893e-01   +8.068095426856343e-01   -6.817307342022518e-01   +1.581295202320186e-02   -2.100473921766420e-01   -1.083139215715430e-01   -3.702898275253938e-01   -8.190959631388131e-02; +3.840862100346882e-01   +2.296750773129178e-01   +2.483546089497810e-01   -2.894616151666779e-01   +1.721901799939175e-01   +5.831999260361438e-01   +5.499252397696446e-02   -8.026652080515161e-02   +6.747968288073710e-01   -1.081044688887328e-01   +5.847059025823836e-02   -3.413118048944912e-01; +6.248971908784733e-02   +4.188048377261773e-01   -4.628566575034053e-03   +3.180581728204703e-01   -7.992027717432408e-01   -2.108291474130953e-01   +1.845868250785776e-01   -2.424566278109151e-01   +2.318853442864056e-01   -6.284482519060117e-02   +1.737015659940472e-01   -9.503383519375758e-02; -7.298371092978870e-01   +2.110968813121621e-01   +1.669207781001049e-01   -1.800391122917035e-01   +3.766146351958954e-01   -3.827187468221737e-01   -3.371430935697994e-01   -3.754442654277860e-01   +8.191198193142689e-01   +1.715593578407267e-01   +1.618388085991083e-01   -2.534124547152213e-02; +9.096630348957010e-01   +1.822384591853555e-01   -1.421220376616773e-01   +2.534294184395745e-01   +3.192622599710535e-01   +1.710171167224912e-01   -6.745819609294772e-02   +7.371494553602212e-02   -4.033966009668932e-01   +4.821407183066782e-01   -5.947227415948659e-01   -3.593150918894577e-01; -1.916329927969717e-01   -9.864969161113367e-02   +4.020874203385796e-01   -1.772427858245188e-01   +6.360293254944706e-01   -5.442024363462108e-01   -4.976730917850744e-01   +3.840192064380151e-01   +7.991019980276153e-01   +5.766868262236279e-01   +2.919695968938864e-02   -3.008877001295800e-01; -4.401356537652213e-02   -3.110478981277907e-01   -3.950960260141127e-02   +6.094322439156185e-02   -8.469984939622099e-02   +4.561463713586039e-02   +2.913221528859984e-01   +1.000000000000000e+00   +2.536911964704318e-01   -8.902242449482052e-02   -2.133397884416916e-01   +2.361388437360802e-01; -4.643735575830695e-01   +4.091291421852123e-01   -1.795044739299524e-01   +5.125752516674219e-02   -4.783578317236344e-02   +1.699568910115964e-01   +3.761524165665123e-01   +8.443061374260461e-01   -7.710563274788395e-01   -2.294732971242451e-01   -3.904789244227107e-01   -7.835136502134398e-01];
L2E_Input1_iAMPA_netcon = [-4.765665972903155e-01   +1.702784999918280e-01   -1.921655581960839e-01   +8.192303444459138e-01   -6.586891839281152e-01   +5.834743141197948e-01   +4.660791049294550e-01   +3.687595900990818e-01];
L2I_Input2_iAMPA_netcon = [-2.582383914748794e-01   +8.413738533140573e-01   -3.596570862978052e-01   -2.500807957474742e-01   +6.291838019764492e-01   +5.885045389314227e-01   +1.885047665722667e-01   -2.144034084534889e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.4*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 1.0*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 1.0*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.4*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 1.0*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 1.0*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
