function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+3.122016472380058e-01   +3.818065754725817e-01   +4.489404566909805e-01   -1.212918508771269e-01   -1.434244878588129e-02   +7.172276737816711e-01   +7.697168930933257e-01   +3.757696067075755e-01   +2.396519503297350e-01   +1.862704106336123e-01   -2.129204785741405e-01   +4.160302646501884e-01   +9.149463250312614e-02   +6.866856445048152e-01   +7.164953494036417e-01   +9.586349855143229e-01; -3.938608161400867e-02   +6.537915318674630e-01   +5.247430328198277e-01   +2.857136957833688e-01   +3.919803836381016e-01   +6.076039010175271e-01   +2.879066197263728e-01   +6.855472437332817e-02   +6.334617505577232e-01   +2.871593812080089e-01   +6.688585201909335e-01   -2.523665195860455e-01   +2.829593343155702e-01   +3.945056689939114e-01   +7.563007440631497e-02   +4.204088385651941e-01; +4.572339521232933e-01   +8.168410378468146e-01   +5.310389481649577e-02   +2.343077439611880e-01   +4.739187142409468e-01   +3.452803358150952e-01   +6.545392234277715e-01   +4.589726535543722e-01   +2.229909904022097e-02   +4.244336905481749e-01   +8.236110156272914e-01   +3.955693025929800e-01   +5.044342688869670e-01   +5.745499532059930e-01   +1.144178316826619e-01   +5.669326126989467e-01; +2.935072171519474e-01   +2.948344212346468e-01   +3.953079733666387e-01   +6.766278875570610e-02   +6.324066009151565e-02   +2.880340893486265e-01   +3.501659692094111e-01   +5.213867896163726e-01   +5.149672024599918e-01   +2.892715836621079e-01   -3.437883761676680e-02   +7.268330727869264e-01   +8.568481839853102e-02   +2.126734688471768e-01   +8.771579847789668e-02   -1.089918266791396e-01; +7.204263592508003e-02   +1.220720072402724e-01   +1.011484188423758e-01   +8.065635164764979e-01   +9.765331943131236e-02   +4.278101262350515e-01   +9.745283498943101e-02   +6.451498315771138e-01   +2.610509279224991e-01   +4.932217039218306e-01   +3.253487568257741e-01   +3.888568039715817e-01   +8.242041558788374e-02   +8.640488305751715e-01   +1.152486440525079e-01   -2.140508858131679e-02; +2.060179079684289e-01   +8.075695792489319e-01   +5.870244559713967e-01   +3.105525482791168e-01   +6.037706202797977e-03   +7.338389334041823e-01   +2.717395176914094e-01   +2.752102297153705e-01   +5.522158507470175e-01   +2.946673226891188e-01   +5.466477267111127e-01   +5.648385524566164e-01   +8.674139877927566e-02   +8.607222561928465e-01   +3.782662913448328e-01   +3.641227049687969e-01; -8.101024870519080e-02   +3.237825172515036e-01   +7.162610963755908e-01   +4.509824276568952e-02   -8.559771613561035e-02   +2.455159884919543e-01   -1.132508987521693e-01   +4.580472737578973e-01   +1.583919512187590e-01   +3.797080668854462e-01   +4.075799191907886e-01   +1.927015308958772e-01   +6.681455284664182e-01   -2.496363773966785e-01   -3.994179075856993e-02   +4.048799519488409e-01; +4.997163584291830e-01   +2.333737255012348e-01   +8.080298861241540e-02   +5.706952382140531e-01   +3.481891990294242e-01   +9.051102907805698e-01   +3.193352873120924e-01   +1.958910212718860e-01   +3.861616246055098e-01   +1.921078517886787e-01   +1.938078561330265e-01   +1.611234279635790e-01   +1.646102828696349e-01   +7.897433053938557e-02   +6.640054502827456e-01   -9.517993143273584e-02; +3.218221566072140e-01   +8.357329643404712e-01   +7.449052090788167e-01   +4.096538398512345e-01   -5.475931858431380e-02   +3.926692544319169e-01   +2.981147376577396e-01   +4.865253868678308e-01   +6.383529946274903e-02   +4.971386233493367e-01   +2.636739552356999e-01   +2.717894095904332e-01   +8.036457828234224e-02   +1.947303879390894e-01   +1.021024073892870e-01   +3.972290270444073e-01; -3.097192165206549e-01   +8.163099579088839e-01   +4.544941877523175e-02   +2.674522511555697e-01   -1.759816309751050e-01   +8.258596931281529e-01   +3.064476399438972e-01   +7.748239442435413e-02   +6.776089238856792e-01   +2.756039286730532e-01   +7.511562859723062e-02   +6.600922339581157e-01   +1.820058050189118e-01   +2.136307998156677e-01   +4.038413356175499e-01   +4.475543011860125e-01; -1.215364002202616e-01   +6.713737215241535e-01   +8.326462931904560e-02   +2.944658806042612e-01   +7.159325886604053e-01   +8.839050438349857e-02   +4.600734622304400e-01   +3.155146828343007e-01   +3.990173325126280e-01   +7.616930542976654e-01   +3.713961024010800e-01   -2.512050341315099e-02   +7.452539333747565e-02   +6.308029734134554e-01   +1.161378448033426e-01   +3.629958959294567e-01; +4.764057081807729e-01   +6.829045071311109e-01   +2.827882972242538e-01   -2.752094919619634e-02   +4.005010146756608e-01   +3.147872635480911e-01   +1.685413882870936e-01   +3.251491341146310e-01   +5.906385597553003e-01   +5.569156051787123e-01   +1.007800625885583e-01   +1.654430256206288e-01   +6.771722926062812e-02   +7.303725293419294e-02   +7.678050603284998e-01   +2.515019583717796e-01; +3.359535992634849e-01   +7.243995575621659e-01   +7.098989845261441e-01   +1.469719928986676e-01   +1.396092544400326e-01   +1.351657169631081e-01   +1.501308884547067e-01   +2.689433392149856e-01   +2.400047799808786e-01   +2.052132073736303e-01   +4.304721756502133e-02   +7.980372183831221e-01   +4.409890486005569e-01   +6.322799579207371e-01   -1.529828925203041e-01   +7.505876226363097e-01; +1.162483820850316e-01   +8.762652319281052e-02   +8.752032145551329e-02   +2.360095469673224e-01   +3.818067939356404e-01   -3.478003648066696e-02   +6.882975113937099e-01   +3.267395999413972e-01   +3.017668302182849e-01   +2.671411336673277e-01   +2.889727058667748e-01   +6.324131938130799e-01   +5.114895226877458e-01   +3.732755087606989e-01   -1.709774213899616e-02   +1.331630081841861e-01; +3.252977846549935e-01   +3.945114504763551e-01   +2.807848069260441e-02   +1.000000000000000e+00   +7.497389685784963e-01   +4.721796052300571e-01   +3.329805845509293e-01   +2.409896061682300e-01   +2.232928882513019e-01   +2.951825580940829e-01   +7.001889088680583e-01   +3.409949575896611e-01   +4.298518164119731e-01   +1.565448917412880e-02   +2.859896498663075e-01   +8.032912935578221e-01; +1.344378059240796e-01   +6.932272541295883e-01   -7.677824315981052e-02   +1.166474538142199e-01   +1.575546480983203e-01   +8.779069546931528e-01   +6.571951845210336e-01   +7.985422982439812e-01   +3.464150953690279e-01   +3.158033840961334e-02   +2.045488274426377e-01   +8.281891890243864e-01   +7.413454394206169e-01   +4.472948599447314e-01   +5.532508351865298e-01   +7.309727085494044e-01];
L1E_L1I_iGABA_netcon = [+7.918508589385493e-01   +2.697801380759559e-02   +2.205767703596355e-01   +2.924005080780577e-01   +1.000000000000000e+00   +3.940859735285091e-01   +6.723791204083480e-01   +1.208949711626726e-01   +3.740767280142633e-01   +2.399780887596883e-01   +9.058774436171498e-02   +2.467392026975260e-02   +1.238977747805659e-01   +3.423106144081537e-01   +3.689044951515795e-01   -1.295721766263287e-01; +6.987063214723723e-01   +2.705554646242823e-01   +9.637070548598101e-02   -1.694268700369783e-01   +1.929267756045498e-01   +7.464096273338342e-01   +3.012138377460346e-01   +6.090605221038712e-01   +3.240861999865673e-01   +4.885657437291240e-01   +1.861753215722778e-01   +5.215664232529112e-01   +5.037587483341915e-01   +4.168119093309797e-01   +6.511984015508927e-01   +7.092925648562941e-01; +2.574158920814706e-01   +8.406529998944841e-01   +3.361088819658851e-01   +1.355245902196776e-01   -1.485479133808094e-01   +1.972558608439071e-01   +8.748399705589903e-02   +5.254941906545912e-01   +2.971281593192173e-01   +5.285362733199077e-01   +4.701485321042974e-01   +5.262826661041532e-01   -1.060003649739681e-01   -1.321769918637159e-01   -7.153752745941623e-02   -4.858801356129483e-02; +5.922616667989760e-01   +4.845878420404768e-01   -6.209338281955641e-02   +3.100292526980838e-01   -4.619833634956071e-02   +2.764826734063520e-01   +1.874033200247736e-01   +1.273842418057963e-01   +4.310827276886690e-01   +6.026381403050072e-01   +3.787380189708774e-01   -1.327788294957376e-01   +4.713565847235210e-01   -1.465301048110578e-01   -5.233117433217182e-02   -8.089474374824253e-02; +2.243276036191994e-02   +2.969348606673510e-01   +9.983416804228331e-01   +4.601494303616841e-01   +4.274187238245645e-01   +4.395650475834666e-01   +2.469665858842061e-01   +4.790350126914136e-01   +8.303890430382295e-01   +9.499394371703115e-01   +4.173004677034686e-01   +2.490620343186487e-01   +4.280025035591443e-01   +8.625262034267885e-02   +2.351982761281080e-01   +4.448781937432332e-01; -1.498615431857588e-01   +2.034218928370913e-01   +5.105180746513949e-02   +7.307390400769791e-01   +7.267726494942162e-01   +5.466133255810598e-01   +7.207711767124531e-01   +4.707619026160994e-01   +5.989364579443422e-02   +1.407126980939475e-01   +4.254231160435259e-01   +3.793573411359148e-01   -5.389216653733875e-03   +4.284797980487380e-01   +3.736949772263034e-01   -1.629161773203353e-01; +3.424918458979159e-01   +4.857430492852531e-01   +3.721403982401898e-01   -4.346129676674790e-02   +8.137454707569687e-01   +6.865147338533082e-01   +4.106615047263600e-01   +8.257250835616415e-01   +2.532915261708742e-01   +6.722164843062143e-01   +5.290114522330340e-01   +4.635927060570864e-01   -1.974511129989475e-01   +5.629738690841611e-01   +3.921660785018310e-01   +3.405675780561468e-02; +9.098392552144591e-03   +6.574010709108208e-01   +4.505192432348963e-01   -5.555656993749338e-04   +2.615048350675703e-01   +5.136564236558507e-01   +3.554026560227835e-01   +4.024971795726285e-01   -1.822450794011062e-01   +4.947617242405366e-01   +5.489237434522045e-01   +2.376392510494465e-01   +2.394495551454547e-01   +1.184829625811997e-01   +5.232125545785767e-01   +7.087275379572990e-02; +2.550202131795621e-01   +9.973136282034263e-02   +6.281318656895323e-01   +4.263898594143622e-01   +4.919148364486595e-01   +4.359829005482512e-01   +8.094374743898631e-01   +3.595985266593692e-02   +6.704481795867022e-01   -1.032345519217851e-01   -1.818565408474819e-01   +4.036884844347644e-02   +1.129352121581949e-02   +2.296470541394118e-01   +4.044853814593100e-01   +3.046221643417558e-01; +6.409440105549647e-01   +7.341755687607624e-01   +2.331921767100168e-01   +7.302836375986673e-01   +4.631505320748224e-01   +3.066784503494896e-01   -5.248906752846133e-02   +5.070497072061542e-01   +1.081974783257211e-01   +2.062281058287992e-01   +2.965825501643257e-01   +5.823143314922570e-01   +7.026141947143920e-02   +8.213734915704846e-01   +3.770426136022151e-01   +5.612009958611417e-02; -2.397083648848903e-02   -6.078088679058406e-02   +3.883544367456787e-01   +6.807665576014825e-01   +3.438413670883753e-01   -8.723902624867681e-03   +6.117409153300847e-01   -1.130336937357028e-01   +6.910598974959909e-01   +2.333399368326000e-02   +6.246559301603276e-01   +6.206160743514210e-01   +2.363718891317425e-01   +4.349084706188791e-01   +2.697237955403596e-01   +7.020251420157232e-01; +1.770102735483848e-01   +3.925009543698630e-01   +2.189127779124435e-01   +2.986308168076190e-01   +5.854800212851095e-02   +2.115604160809787e-01   +3.729601210776499e-01   +8.001131347290049e-01   +1.387638698204761e-01   +7.678266933195287e-02   +1.364898525608066e-01   +5.315263866727605e-01   -1.924117873245805e-01   +3.648992789911592e-01   +7.874313528485510e-01   +5.662274068140634e-01; +4.610487340944829e-01   +2.402924927809014e-01   +7.587216293621273e-01   +4.255946205183454e-01   +1.741941539202456e-01   +4.972682824403749e-01   +8.254571010407374e-02   +5.025176433123303e-01   +1.175548183296804e-01   +2.297503539435718e-01   +8.504740617516623e-02   +1.281405692317826e-01   +2.054893222576880e-01   +2.665641344825358e-01   +4.272689610345664e-01   +1.263933865940857e-01; +1.948661625466541e-01   +3.933314086016483e-01   +5.547146947043834e-01   +6.042874701457717e-01   +7.497871357657365e-01   -1.180972982720992e-01   +4.891710277663434e-01   +5.560092486432107e-01   +8.586393262514802e-02   +6.119631956358851e-01   +5.064453628252511e-01   +3.864884151263140e-01   +1.811334159662967e-01   +7.582450188560484e-01   +3.266117791824400e-02   +1.728325886925450e-01; +7.297931814839325e-01   -3.228863340421192e-02   +6.967458107575952e-01   -7.343426234806696e-02   +4.404539396469347e-01   -2.830443495389864e-01   +3.706797418553884e-01   +3.376480334518780e-01   +3.125931546483535e-01   +7.037196010728995e-01   +3.342750726815260e-01   +3.175260896653752e-01   -2.649985079037517e-01   +1.354411044069641e-01   +6.587006215445458e-01   -2.113763860967028e-01; +4.217893505058530e-01   +8.629358833367366e-02   +3.040793332725569e-01   +5.375731140141987e-01   +8.819667874152051e-02   +1.617154035619726e-01   +4.863812478526910e-01   +3.012955101073898e-01   +6.132008513911437e-01   +5.602068760075308e-01   +7.005453091075317e-01   +1.352972023271249e-01   +3.184319023906943e-01   +6.978823912169885e-01   +2.927752282806417e-01   +3.355865373598267e-01];
L2I_L1I_iGABA_netcon = [+1.605727278715812e-02   +8.214644163089924e-01   +8.221618138408939e-01   +3.604096289962683e-01   +7.363448390818674e-03   +6.568106989965868e-01   +3.754690379408036e-01   +2.262812804317549e-01; +9.583085999515507e-01   +8.242260252504445e-01   +1.667352489248036e-01   +6.857459612848360e-01   +3.675197898183178e-01   +5.754856366867657e-01   +8.377239180884171e-01   +1.871318266261591e-01; +5.636534250560850e-01   +2.758758344072975e-01   +7.151504128557474e-01   +8.762795938819962e-01   +4.858591473095106e-01   +5.577027907521814e-01   -1.806454965176891e-01   -7.536718607113126e-02; +4.533262841360874e-01   +1.662441214310540e-01   +5.623389105502438e-01   +7.041878751171917e-01   +5.768372851395468e-01   +5.121895763486380e-01   +8.731488089007685e-01   +6.417044168121764e-01; +2.678480565556709e-01   -8.834444504974824e-04   +6.029500879220251e-01   +6.640848282297163e-01   +8.106213005375994e-01   +3.424987668357740e-01   +6.634092354861356e-01   +5.867513490361410e-01; +3.134055924206028e-01   -1.769351664170573e-01   +5.735316749280324e-02   +7.685390278220310e-01   +4.764000886272722e-01   +4.867013405316887e-01   +4.349766675002303e-01   +2.408111316700558e-02; +4.865566394293144e-01   +4.920880870845653e-01   +8.942660520862471e-01   +5.769121355885541e-01   +3.607427534147079e-01   +3.164290566174170e-02   +8.267432769421091e-01   -1.321541023283818e-01; +6.475312808434206e-01   +6.535909823444596e-01   -9.429401008614920e-02   +3.415091515401550e-01   +2.996202241496829e-01   +8.413995110734236e-01   +7.751524560300797e-01   +2.097446225800935e-01; +2.095164533707128e-01   +9.167593729535650e-01   +1.006688225424115e-01   +1.740844486736468e-01   +2.850265116510300e-01   +5.845390935227222e-01   +9.747463850985336e-01   +6.453605072863168e-01; +5.643208252541516e-01   +2.540668150996236e-01   +1.000000000000000e+00   +8.592210011389763e-02   +5.031040122290559e-01   +7.031127074680606e-02   -3.263085432738119e-02   +4.226277376682798e-01; +9.179308066662827e-01   +7.129713122351251e-01   +3.551322951448724e-01   +3.149038082633654e-01   +3.017431024526380e-01   +8.449864366122207e-01   +5.832364307763839e-01   +4.859254093121287e-01; +5.677901923762975e-01   -1.072539566003889e-01   +4.648640780154953e-01   +2.872188469058326e-01   -2.198131930130618e-01   +1.614656698613260e-01   +7.760362394021901e-01   +8.715523591024132e-02; +2.651316475600523e-01   +5.071192806982289e-01   +3.264794574432162e-01   +2.452355345170308e-01   +4.004588442089225e-01   +1.578937838496573e-01   +5.011644976138331e-02   +8.692717775312182e-02; +8.051763543693611e-01   +4.296436903845453e-01   +8.934115484087635e-01   -1.643486354784970e-02   +6.788817797411671e-01   +8.967591206900047e-01   +8.049182978891384e-01   +3.408593029003361e-01; +6.193128362741949e-01   +3.465970176837928e-01   +3.980918574926526e-01   +4.715967389529876e-01   +1.213060089698308e-01   +2.298830216327600e-01   +5.209131543193523e-01   +6.586624481900800e-02; +4.373160687256097e-01   -1.016718998747032e-01   +5.224068932286996e-01   +2.933640306881866e-01   -3.007180203431607e-02   +4.907015838489664e-01   +1.082812648485983e-01   +1.234193531818270e-01];
L1I_L2I_iGABA_netcon = [-1.016764731397777e-01   +3.293118308600566e-01   +9.838428795052644e-02   +1.385011277445984e-01   +5.036972196444671e-01   +3.685851584604722e-01   -1.044369433905416e-01   -2.752622985576177e-02   +1.677794793041198e-01   -1.030693342464226e-01   +1.000000000000000e+00   +3.211729253234443e-01   +8.014096422817411e-01   +8.283188572538419e-01   +3.848625508436566e-01   +2.596111425173507e-01; +1.102515349075574e-01   +4.976578924101113e-01   +3.789096139413424e-01   +1.580214466388141e-01   +1.802613291948550e-01   -1.870562053553434e-01   +5.505593760594194e-01   +5.034554048600171e-01   +9.221624599087209e-01   +2.493407218103888e-01   +5.943767547676401e-01   +2.039572803631285e-01   +5.494998006444598e-01   +1.950340374471739e-01   +1.765949384540649e-01   +5.993839691758530e-01; +6.861350313281750e-01   +1.166589640099863e-01   +6.368931626563308e-01   +8.589231621758487e-01   +2.939092122649675e-01   +4.198713444966680e-01   -1.761414539505467e-01   +4.448778780239805e-01   +1.053903345595799e-01   +4.943881056783478e-01   +4.917152519870935e-01   +2.592602292327152e-01   -6.930305008775835e-03   +2.412992582721109e-01   +7.339861720339680e-01   +1.447574017277405e-01; +1.734709064470612e-01   +3.467098344537131e-01   +5.744263596793221e-01   +4.189735850559713e-01   +5.668167502696646e-02   +6.907940226100894e-01   +8.698536476210326e-01   +9.030169033239582e-01   -1.168982671886429e-01   +1.825073347201439e-01   +2.313584398211102e-01   +3.811244429790154e-02   +6.829569682033619e-01   +1.081488583744074e-01   +3.041192555976717e-02   +4.627200442850412e-01; +2.500415411648966e-01   +4.434175102359937e-01   +5.310809868358203e-01   +2.751648663461848e-01   +3.755271097150524e-01   +5.197177827590377e-01   -2.290223850001127e-01   +4.460904031012739e-02   -6.294434865210338e-02   +9.624550039296342e-01   +8.572565963625682e-01   +9.072792762729411e-02   +6.842539101436553e-01   +3.219933071177299e-01   +9.555878475811402e-01   +1.128952122556923e-01; +4.930109078738883e-01   -6.916069049682905e-02   +4.094942834405221e-01   +3.577587178835551e-01   -2.809566022993931e-01   +9.021857562730512e-01   +2.843171210785513e-01   +5.219287353922654e-01   -3.235871385727925e-01   -1.099808678658105e-01   +3.019566828052869e-01   +2.685116726817336e-01   +6.280862340973734e-01   +8.669478796812462e-01   +4.317996535646746e-01   +5.325437713136283e-01; +5.129708794978071e-01   +5.941423426532170e-01   +3.216754023532591e-01   -2.270248483297354e-01   +6.984052466005324e-01   +4.932666932260483e-01   +1.612544392601150e-01   +1.690916384338930e-02   -1.312399281477365e-01   +2.624874804512142e-01   +7.289535432067259e-01   +2.386631029745150e-01   +9.574685164278331e-01   +6.306937265572942e-01   +2.027407828835242e-01   +3.614705590722178e-01; -3.773133086615299e-03   +2.752151730952672e-01   +5.576169306973269e-01   +7.669734136924565e-02   +8.536855064660737e-01   +6.151273725682576e-01   +5.096976069213827e-01   +4.072378928027576e-01   +9.996644779779542e-01   +6.843936838780256e-01   +1.725780560884555e-02   -1.695953678017697e-02   +4.607084017199161e-01   +7.808597421739002e-01   +2.918466521814910e-01   +2.653209261730148e-01];
L2E_L1E_iAMPA_netcon = [+5.871222259826711e-01   +5.914736785097875e-03   +2.597141235682931e-01   +6.032789759762594e-02   +4.255112781687325e-01   -2.167521395817287e-01   -2.220625678816751e-01   +5.408903340450623e-01; +3.476025220184932e-01   +2.247063474239535e-02   +6.279600846590060e-01   -2.585162062258078e-01   +2.271897981034715e-01   +1.000000000000000e+00   -9.514041479073548e-02   +2.737453227403405e-02; +8.187258772324669e-01   -1.878856969506805e-01   +5.675555691350880e-01   +2.812677672477193e-02   +1.438399410570209e-01   +1.866842783251300e-01   +4.023563043686372e-01   +2.670226543320742e-01; +4.524622849661170e-01   +6.939073825104143e-01   +2.423855556125659e-01   -6.476699873229878e-02   +1.394473659853496e-01   +2.695605371397132e-01   +4.054888558986746e-01   +3.926569466058676e-01; +3.518066958192626e-01   +9.781404712409489e-01   +1.176974589524837e-01   +3.933535947965034e-01   +1.114267436183790e-01   +1.912795433241272e-01   +2.533327566631399e-01   +3.530629858546840e-01; +5.368959877399361e-01   +3.562668096756488e-02   +7.883696402125338e-01   +6.245972419803340e-01   +4.463773187709919e-01   +7.072107400513691e-01   +9.781219602832739e-02   +2.335478620115329e-01; +6.060801100712251e-01   +5.535513791751282e-01   +1.255453624518808e-01   +4.127081789687623e-01   +4.376337362529620e-02   +4.388037107260149e-01   +7.025745492516922e-02   +3.812871371012578e-02; +2.460903445499107e-01   +5.527855340372282e-01   +4.783695095747259e-01   +8.310114260639803e-01   +2.569655164894115e-02   +1.273074872798785e-01   +5.436267004208203e-01   +2.325356392330387e-01; +5.091476367071063e-01   +2.947614403345079e-01   +1.306418396935246e-01   +7.509130736831477e-01   +1.471609031989671e-01   +8.369033106697560e-01   +3.256515207897094e-01   -8.145880694277763e-02; +5.947223300186234e-01   +1.751104457688418e-01   +3.582669469151889e-01   +6.980714404767377e-01   +2.937880362479782e-01   -8.216059603475509e-02   +4.747272661256080e-01   +3.296833498067802e-01; +1.552823140390845e-01   +7.400676310088575e-02   +2.130051242368368e-01   +1.888494211542970e-01   +1.355425417607883e-01   +3.563438541056084e-01   +3.756644953441456e-01   -3.810767212932820e-02; +9.412902283384047e-01   +3.868416016263939e-01   +2.251623744521050e-01   +3.942210175798206e-01   +3.998314254872796e-01   +3.373258015825162e-01   +8.874480733256028e-01   +8.534413665235855e-01; +8.011426050481276e-01   +4.811662998182991e-01   +8.984906144101231e-01   +2.580579126608786e-01   +8.932895445505107e-01   +2.950102429589871e-02   +6.877576099824691e-02   +1.010069365569662e-01; +1.790353485181591e-01   +4.231942602418656e-01   +3.409920364925128e-01   +6.814728320837184e-01   +5.324707661591616e-01   +3.911976682804413e-01   -1.106206530545489e-01   +7.900203788950735e-01; +4.331643625220061e-01   +5.857637976179399e-02   -5.035555797609851e-02   +2.854668594345636e-01   +4.974479810675129e-01   +5.144264673400777e-01   +7.422600433927738e-01   +3.657358667208866e-01; +2.146730322347486e-01   +4.228389262727881e-01   +2.625768259883298e-02   +9.034493801816078e-01   +2.100653444642867e-01   +1.471454182710381e-01   +2.939665549017242e-01   +7.920427408566174e-01];
L1E_L2E_iAMPA_netcon = [+4.827302258058940e-01   +2.730086682793833e-01   -1.531772920801786e-01   -5.772371359020742e-02   +5.078157942398950e-01   +1.582448535325479e-02   +2.607907563925356e-01   +5.388377758675795e-01   +5.248484925101031e-01   +2.821026134520086e-01   +3.475530426945975e-01   +9.219384917348133e-01   +6.245198978978358e-01   +5.120001073804892e-02   +2.670494786874986e-01   +7.668526507865312e-01; +4.920832884788309e-01   +3.866596064012188e-01   +3.329034616189266e-01   +3.959089325146846e-01   +4.790221310738408e-01   +4.288250689539463e-01   +7.146441455750138e-01   +4.037556936361399e-01   +3.544037221895171e-01   +3.138175067085299e-01   -1.561369847158123e-01   +6.148373065496454e-01   +2.202584578634167e-01   -4.038313369196549e-02   +4.664173057371963e-02   +2.642056277723749e-01; +5.127168662792865e-01   +6.651577119213918e-01   +6.411798579275624e-01   +1.000000000000000e+00   +7.542433445099256e-01   +6.340450570760322e-01   -8.576891077462193e-02   +1.899387671411207e-01   +4.214733430024112e-01   +6.581833809730130e-03   +4.239488607051843e-01   +6.526923298381897e-01   +2.117720007704021e-01   +5.729056102759195e-01   +3.085753415515239e-01   +6.581731133861027e-01; -1.238992251375486e-01   +7.397025819873936e-01   +8.482026088658009e-01   +2.749341205491950e-01   +4.188459628714682e-01   +1.528592681120354e-01   +2.157407906663613e-01   +4.455049148951957e-01   +4.039734994905949e-01   +5.350346218165183e-01   +2.394342447565153e-01   +2.436189774596208e-01   +7.745833859264362e-01   -2.785169173405362e-02   +5.595210654623716e-01   +5.812374730274424e-01; +1.574194240944578e-01   +6.271763635210933e-01   +5.699979848998484e-01   +6.857241854980519e-01   +8.016734158256075e-01   +2.480007322235378e-01   +5.949544280801224e-01   +2.880968699264225e-01   +7.041764654862558e-01   -7.976466720304928e-02   +7.759175931734656e-01   +7.513014961014010e-01   +1.556311045781776e-01   +3.478678640318246e-01   +2.572937096222691e-01   +8.568597362265225e-01; +9.841589763903802e-01   +7.266243639411814e-01   +8.715329513272720e-01   +6.424856247963295e-01   -6.443256343285588e-03   +5.052790023790193e-02   +3.912743121247164e-01   +5.014934997504309e-01   +6.497125796440223e-01   +4.217458993796016e-01   +9.333116490327807e-01   +4.829017029591587e-01   -2.090263289487915e-02   +6.782726452711744e-01   -1.036350361394864e-02   +3.847853965744862e-01; -4.617223496226424e-02   +6.582604821609610e-01   +6.074205522305381e-01   +1.033007836910969e-01   +6.906455283780112e-01   +3.974029699247756e-01   +5.102733017824240e-01   +3.724955299906297e-01   +5.572169742659310e-01   +5.490753068039769e-01   +3.091128494456332e-01   +1.623955862771984e-01   -1.559385940261449e-01   +5.118233354754348e-01   +1.893544067634041e-01   +3.150872516765130e-01; +1.791815239977311e-01   -2.000226984123187e-01   -6.303756815540380e-02   -2.373109330260704e-01   +2.612345530314640e-02   +4.644525260006991e-01   +5.246829119022272e-01   +5.918122914205295e-01   +2.363925838957256e-01   +1.730100068785904e-01   +2.989014397749138e-01   +6.705231386588522e-01   +6.248697030671034e-01   +3.864579672102999e-01   +4.152577073984930e-01   -2.457949406290033e-01];
L2I_L2E_iAMPA_netcon = [+4.620703762037683e-01   +3.993183189786330e-01   +6.257261901380969e-01   +6.080234068651710e-01   +2.669272531792281e-03   +4.358018933601257e-01   +8.511657217217663e-01   -1.370897820206917e-01; +6.207249347166619e-01   +6.414200674906045e-01   +8.064416947786786e-01   -1.392759960287286e-01   +5.606123807997339e-01   +2.076528472155012e-01   +5.367455424400426e-01   +2.083850537369839e-01; +1.040555075688752e-01   +5.708706107194215e-01   -5.795585305460699e-02   +4.067507771072768e-01   -9.736289627651417e-04   +3.215271696455492e-01   -5.263617785054559e-03   +5.708678576310005e-01; +7.802887170550006e-02   +2.317625282672059e-03   -2.379918600124475e-01   +2.453245107008096e-01   +3.431841609632238e-01   +2.588272174727301e-01   +1.389895654276503e-01   +6.799403434967265e-01; +1.000000000000000e+00   +8.518257326492519e-01   -1.165212272499444e-01   +4.559569371260748e-01   +7.445232416425189e-01   +9.394301962803834e-01   -5.295265234848844e-02   +1.279030552022550e-01; +1.025038625939791e-01   +3.956228673525298e-01   +1.907427251123890e-01   +1.553085708234323e-01   -2.776588396205573e-01   +3.333967434551687e-01   +4.508728794568724e-01   +3.010488429331675e-01; +6.160392247985639e-01   +6.905653289865747e-01   +5.080469859948971e-01   +6.864014762007357e-02   +2.934433037001077e-01   +9.707897527121051e-01   +7.733358798764927e-01   -1.299631189039898e-01; +5.061284508668202e-01   +6.662049265185847e-01   +4.640401250030278e-01   +6.546977454918220e-01   +4.854465922350650e-01   +2.960588178227620e-01   +3.392944203426540e-01   +7.041154951982728e-02];
L2E_L2I_iGABA_netcon = [+9.450684299334411e-01   +3.211960377625361e-01   +2.426855368065487e-01   +4.111109570614185e-01   +3.739245900959085e-01   +5.326085505072217e-01   +7.733476210045718e-01   +5.196682326371750e-01; +7.318197517692302e-01   +2.143639983880986e-01   +2.638952653657903e-01   +4.069022022753854e-01   +4.311155951989881e-01   +3.544932157401435e-01   +7.383214325605527e-01   +1.047247830211311e-01; +3.761034131091116e-01   +9.517845339081794e-03   +1.000000000000000e+00   +3.464048461949379e-02   -1.788102333446872e-01   +1.764116412245085e-01   +1.097837908485311e-01   +4.375967076754237e-01; +4.543374637071041e-01   +8.452498149920830e-01   +1.530096009868860e-01   +1.361762544073914e-01   +3.723911517040634e-02   +7.186510644253088e-01   +8.140192517051241e-01   -7.787260397287189e-02; +4.565297617039266e-02   +8.256917097185279e-01   +4.293825700724949e-01   +3.155788860615184e-01   -5.437022367935043e-02   +1.416430918796250e-01   +6.903074089146387e-01   +4.827734266941976e-01; +2.185472257276483e-01   +5.060626897721904e-01   +9.342052414278209e-01   +6.562351606022916e-01   +2.928605853748911e-02   +4.330264792624155e-01   +6.303399429677976e-01   +5.080279358458869e-01; +9.188778481231721e-01   -8.319143590587734e-02   -4.953478898523282e-02   +6.499650471051245e-01   +4.638420312951864e-01   +4.362391760771890e-01   +4.740393141330812e-02   +3.303578239356043e-01; -7.528471846011942e-03   +5.413045260309259e-01   +5.072855588370977e-01   +5.948776965441102e-01   +3.417574903439415e-01   -2.005113840251529e-02   +3.179863549391943e-01   +3.830741713066918e-01];
L3E_L2E_iAMPA_netcon = [+1.082279649193905e-01   +9.710694566411864e-01   +7.852644854643503e-01   -2.085808271682666e-01   +8.939689048073325e-01   +3.644048529655683e-01   +2.990017563209442e-01   +1.604291750715077e-01   +7.222936445339651e-01   +2.349408624833636e-02   -7.803968807681037e-02   -2.233587178856550e-01; +4.524043407692218e-01   +4.717588997553967e-01   +5.156412310772497e-01   +8.177637075741414e-01   +8.975730250648374e-01   +5.910914998413003e-01   +2.524162301286726e-01   +5.616624733183194e-01   -3.740064131496829e-02   +1.107981497604322e-01   +5.332266971853492e-01   +6.955488532939030e-01; +5.666366662402244e-01   +3.184483150178960e-01   +5.631132529708154e-01   +4.287835742643702e-01   +3.624616211486061e-01   +9.175678447689625e-01   +4.613820821231399e-01   +3.441314141678466e-01   +4.018058732307484e-01   +5.167901046519267e-01   +4.326620165846924e-01   -3.163040925371918e-02; +4.935741857091656e-01   +5.052765625624008e-01   +2.982976098693748e-01   -1.130615842230636e-01   -8.205638209656320e-02   +8.633075157312367e-02   +6.297493334649032e-01   +4.683833934032307e-01   +6.193143982699133e-01   +1.549944463816780e-01   +2.156790205928210e-02   +8.833529833047061e-01; -1.447114897420061e-02   +8.516755721785148e-01   +2.488645781005376e-01   -2.380059172799568e-01   +2.203757442379252e-01   +1.871988576682795e-01   +4.096627159987601e-01   +5.430184488119340e-01   +7.740089617030921e-01   +1.858003608892279e-01   +5.965951576972457e-01   +7.934654010248541e-01; +6.046174138583935e-01   +4.502188794248972e-01   +5.197853956502705e-01   +1.370632903749555e-01   +6.031450207943028e-01   +3.102302102702671e-01   -4.569546399460906e-02   +3.508325493014351e-01   +3.866285393085895e-01   +3.847578526121062e-01   +4.306314974524398e-01   +6.543405365754349e-01; +1.489444388200229e-01   +6.390073514182090e-01   +1.951131488891391e-01   +1.214560599450600e-01   +2.887197856003353e-01   +1.031868813140321e-01   +8.119722355205466e-01   +4.761758599201147e-01   +1.000000000000000e+00   +5.878153950419905e-01   +6.784227740973264e-01   +1.423989650693855e-01; -6.326635219035313e-03   +3.287069875807384e-01   +3.462344604915517e-01   -9.781027535517259e-02   +5.572703955870340e-01   +7.651095557671055e-02   +3.266610745159710e-01   +3.901716997192745e-01   +2.218203652934469e-01   -5.857297883959700e-02   +1.758115471805647e-01   +6.438692290979753e-01];
L3I_L2I_iGABA_netcon = [+3.481103790538486e-01   +7.654143225731080e-01   +5.564433437523452e-01   +3.840346541992838e-01   +6.938611339646810e-01   +7.936036210272668e-01   +8.306190346616275e-01   +7.354587278076808e-01   +3.032993053655121e-01   +5.160540100457814e-01   +5.609847702145115e-01   +3.263170853973822e-01; +3.498291623417574e-01   +3.950156405532390e-01   +4.406488492775099e-01   +6.463784304955690e-02   +1.000000000000000e+00   +1.831052944262757e-01   +5.752571071660123e-01   +4.587099947422161e-01   -2.165964526417044e-02   +4.226223569003160e-01   +1.368285753269829e-01   +6.121497629153264e-01; +4.977380576011673e-01   +6.760113368389699e-01   +3.907202630259873e-01   +8.118771100463970e-02   +9.738118515998080e-01   +6.714012734905356e-01   +9.648077137057728e-03   +3.742517382993291e-01   +4.551816868405020e-02   +7.321183454530645e-01   +4.890814373299683e-01   +1.361543219029224e-01; +6.723862474486590e-01   +3.542518124793319e-01   +5.570035187336571e-01   -8.320856881192719e-03   +2.919785482595438e-01   +2.820656061676355e-01   +2.707900643825117e-01   +6.275181117674183e-01   +7.625094300556611e-01   +1.558639797757974e-01   +3.491506539972006e-01   +1.954590617791403e-02; +7.679321988033725e-01   +7.667973988922602e-01   +2.978342124120396e-01   +8.889787759966841e-01   +1.221960560895709e-01   -2.427008255338952e-01   +6.484730342723973e-01   +2.508250676382077e-01   +2.830213004047187e-01   +3.634831277343699e-01   +4.569234728656661e-02   +7.325062832819147e-02; +6.559166911280071e-01   -3.897218816232930e-02   +8.153710889729929e-01   +7.421027941549176e-02   +3.151759077203132e-01   -9.351353341236641e-03   +4.312986596214835e-01   +3.640455245088116e-01   +9.790974863266518e-01   +1.673600469790150e-01   +9.488602560888153e-01   +3.729138264260690e-01; +6.087707407840988e-01   +1.655139648815724e-01   +5.586528104388906e-01   +3.346096129153515e-01   -4.844443505824987e-02   +5.651804364204988e-01   +2.182924058731763e-01   +4.865736415732023e-01   +4.871042621066991e-01   +7.327945120228638e-01   +1.637501540425014e-01   +4.086870961146616e-01; +6.345760892322961e-01   +3.715246224199727e-01   +2.606883184898560e-01   +3.516470896134004e-01   +9.287304450440809e-01   +6.463840676066587e-01   +6.360170057507285e-01   +6.450977553593330e-01   -2.212689171115856e-01   +1.354049544297655e-01   -1.486509333416263e-02   +2.745141288117876e-01];
L2E_L3E_iAMPA_netcon = [+5.330342193888760e-01   +5.228389149704664e-01   +8.795946945760330e-01   +4.332626970173418e-01   +9.033194492364282e-01   +3.107724168682214e-01   +7.483088023101701e-01   -9.042031281700041e-02; +1.516724073637306e-01   +5.214129004816457e-01   +4.175225542115366e-01   +9.117179925147287e-01   -2.066671747335287e-01   +3.306750962694189e-01   +6.520730177819171e-02   +4.662593939699084e-01; -9.096646286344609e-02   +4.106371453594408e-01   -4.415523694984319e-02   +9.848289964227401e-02   +2.758067423365298e-01   +5.235196057848120e-01   +5.120607620848713e-01   +1.000000000000000e+00; +3.211108255256769e-01   +3.975851787663454e-01   +7.700835240130409e-01   +4.259421216426893e-01   -7.074150929323428e-02   +2.319941179022874e-01   +7.136351488929256e-01   +2.849169884907423e-01; -1.288924728888229e-01   -2.579540977076747e-02   +3.101919981297865e-01   +3.762633499257330e-02   +9.154986061941038e-01   +9.216938277943310e-01   +1.307483778899337e-01   +2.378292298152533e-01; -6.987491104559176e-02   +8.460036198476513e-01   +5.878957027316973e-01   +4.405824595545744e-01   +6.743014569551705e-01   -1.343925055852629e-01   +1.876414377720466e-01   +1.989169601445551e-01; +3.105088443820070e-01   +8.772337583403080e-02   +6.235579412209864e-01   +9.371477676261800e-01   +5.450957743703835e-01   +2.116331346998776e-01   +4.255313396548476e-01   +5.679281292487220e-01; +4.283794163601348e-01   +6.265801419563697e-01   +5.735460581698968e-01   +4.125302660443624e-01   +3.695478870835006e-01   +7.055910322787394e-02   +3.777455697281641e-01   +2.958779045576374e-01; +2.105204325780568e-01   +6.581385190362016e-01   +1.612657245377514e-01   +1.795533913528941e-01   +2.769271740210520e-01   +1.077667004067411e-01   +2.287162902924577e-01   +1.523379124988878e-01; +3.487753082499687e-01   +6.660675061557735e-01   +1.693579326757931e-01   +9.917186894168892e-01   +3.588281873268110e-01   +8.393464662915521e-01   +5.668916519997946e-01   +8.117272784718094e-01; -8.292663350428481e-02   +6.990750174188087e-01   +5.131610280615279e-01   +6.304688844416525e-01   +3.672466827484421e-01   +6.748427337452102e-01   +2.357558965816379e-01   +3.835807618723825e-01; +3.646329119000989e-01   -2.672654697560199e-02   +3.436036880581590e-01   +3.504345403994770e-01   -3.947901446648703e-02   +7.442195235098077e-02   -4.346740841207017e-02   +7.153974526701685e-02];
L2I_L3I_iGABA_netcon = [+2.247075380509072e-01   +5.349776486119218e-01   +8.880353781230762e-01   +5.624230705838071e-01   +8.773799672224868e-01   +5.733739223812281e-01   -2.417481663558259e-01   +3.717829132893165e-01; +5.175232270908677e-01   +8.425794050752902e-01   +7.057262364656623e-01   +1.285364871821990e-01   +3.729196138224731e-01   +3.872525511245364e-01   +6.394115165658532e-01   +1.000000000000000e+00; +1.206693089480034e-01   -5.137055003858357e-02   +7.911302810487518e-01   +2.424870017976937e-01   +5.590608565424062e-01   +4.637876825321208e-01   +6.002256869909017e-01   +2.863267365672753e-01; +4.250506524159122e-01   +6.100911155380192e-02   +6.889465013490412e-01   +8.592071468480919e-02   +4.801756571845712e-01   +9.165127780225270e-01   +5.954644689452361e-01   +4.509399189567899e-01; +1.271972287919858e-01   +6.408378525032067e-01   -9.361847649320981e-02   +1.722157783343798e-01   +6.241095737963960e-01   +1.629678925748791e-01   -4.433593405146625e-02   -1.325059104955734e-01; +5.972546274708526e-01   +6.701778172894651e-01   +1.672103684203819e-01   +7.260155911511299e-01   +7.025728493656825e-01   +6.024255453510104e-02   +2.798093884443203e-01   +1.501091370284323e-01; -8.165682384458872e-02   +5.414853647396876e-01   +4.389577055572042e-01   +3.360353904708565e-01   +3.555354640417029e-01   +2.238498993099881e-01   +1.914827519647983e-01   +6.995891467530819e-01; -1.927156307878799e-01   +7.025635536858390e-01   +1.891298995451372e-01   -1.516882366524864e-01   +3.068674868345045e-01   +1.781411269198968e-01   +3.414873905180126e-01   +3.819221018296767e-01; -4.879576912348602e-02   +1.995667019804682e-01   +3.709771880116951e-01   -1.055227855511142e-01   +1.097265169826552e-02   +4.938777477435762e-01   +3.333261912266484e-01   +4.779664382115766e-01; +2.574169464384972e-01   +9.478407535374822e-01   +6.119595898711369e-01   +3.150914999580804e-01   +5.115943357289944e-01   -4.854728961431392e-02   +7.718881550144827e-01   +3.971095020159250e-01; +8.206489705344707e-01   +3.477143619522511e-01   +1.978633588988797e-01   +3.600059449299253e-01   +2.519005102556263e-02   +9.195863445756496e-02   +3.337045704812763e-01   +1.054406187340314e-01; +2.628611661563061e-01   +3.933702665995462e-01   +1.639673605641557e-01   +2.968550199443963e-01   +1.112701692112946e-01   +7.414107018743901e-01   +5.921357494490883e-01   +3.676365656114272e-01];
L3I_L3E_iAMPA_netcon = [-6.257751829644256e-02   +2.711232104602892e-01   +7.888101653913090e-01   +2.134019052077494e-01   +1.000000000000000e+00   +5.170536508586080e-01   -1.527928296614542e-01   -2.055339014904935e-01   +4.564966455749393e-01   +5.826071223297793e-01   +3.326203214105316e-01   +2.495389240061017e-01; +7.368773996109554e-01   +3.050711252505153e-01   +1.434517284827320e-01   +2.691669598055725e-01   +5.574931986634593e-01   +4.197640435377333e-01   +1.378419849309157e-01   +5.207555256193168e-01   +9.728765962654620e-01   +2.017050529134086e-01   +9.187805483949138e-02   +7.972140748170858e-01; +1.710168124991619e-01   +4.105916024051447e-02   -8.311520525668163e-02   +4.554700049569835e-01   +4.163416629147330e-01   -5.386689570119786e-02   -2.154384700951159e-01   -1.310878782759617e-01   +9.101190260127403e-01   +2.529846658096400e-01   +4.187531650730314e-01   +4.567178584198657e-01; +5.400361013831922e-01   -8.233024965723688e-02   +5.127071890287808e-01   +1.982458178994727e-01   +4.391579095734870e-02   -1.739930135829071e-01   +5.413749944219236e-01   +2.480560215861585e-02   +2.483452846038521e-01   +2.529447014139168e-01   +9.769747784584530e-01   +8.435918614366484e-01; +9.945954776825711e-01   +1.290416395952074e-01   +6.057438863956943e-01   +2.018719764852729e-01   +9.258333670413700e-01   +7.905759184087939e-01   +8.405766147227497e-01   +6.916650306248502e-02   +1.283663709332775e-01   +7.613825850773963e-01   +4.422333013222653e-01   +6.245664994843106e-01; -4.490193936758399e-03   +2.938387109961797e-01   +3.394780692539847e-01   +4.309958694836367e-01   +5.290900255159656e-01   +3.142541320496429e-01   +5.324839649202835e-01   -2.957415591442298e-02   +7.196546703649315e-01   +7.593899507026476e-01   +7.162773418209216e-01   +4.726315231434466e-01; +9.091070611976976e-01   +2.212570642121632e-01   +1.625778932970623e-01   +3.270032099422059e-01   +3.288578285318208e-01   -1.625710004330208e-01   +4.633411483367300e-01   +9.044411250658312e-01   +4.822111509059411e-01   +6.534677044888350e-01   +4.566977300975973e-01   +1.993256798681725e-01; +5.605134346093316e-01   +1.384401474291967e-01   +6.316189191139479e-01   +7.782817577666141e-01   +3.331700576685877e-02   +5.251892583523601e-01   +4.542925990657837e-01   +5.465426694348436e-02   +3.749770474446371e-01   +8.471364961368250e-02   +5.593996759162986e-02   +4.973657608066221e-01; -6.044391447793172e-02   +1.524408343970935e-01   +1.481488726120769e-01   +7.360970460611725e-01   -1.024058386539752e-01   +5.920104918463579e-01   +3.005293292172188e-01   +8.763635099782466e-01   +3.745127894211093e-01   +5.361723638238781e-01   +4.307765088734274e-01   +4.185148116828510e-01; +2.069170753026811e-01   +5.475737155819999e-01   +3.852664908939962e-01   +8.008758928837054e-01   +6.294505226281222e-01   +4.203196777917890e-01   +3.448284108192524e-01   +7.956333682393779e-01   -1.038321529919173e-01   -2.288053091048830e-02   -2.165847696114204e-01   +8.890499192234935e-01; +9.569836284358993e-01   +4.747076775233088e-01   +5.661660419515723e-01   +1.425422103962856e-02   +5.030767308338807e-01   +1.071718536972237e-01   -3.118901827110849e-01   +4.682164148651919e-02   +4.244739185742509e-01   +1.963995061916724e-01   +8.677079257005431e-02   +6.275573407862729e-02; +4.160656514453732e-01   +3.335408278533263e-01   +1.957297697483471e-01   +6.636413569675376e-01   +3.648028570659885e-01   +3.345040392123021e-01   +9.823068585485084e-02   +1.904532094015420e-01   +3.272152753703651e-01   +1.283821134693420e-01   +1.698245546575497e-01   +5.598095044117000e-01];
L3E_L3I_iGABA_netcon = [+8.435647040377320e-01   +6.585638963970550e-01   +4.204361700250890e-01   +1.964687765706558e-01   +1.961681487876346e-01   +9.664766028701705e-02   +3.499773258369137e-01   +4.626001948347337e-01   +8.997446531383073e-01   +6.068912082730948e-01   -1.522624341924828e-01   +4.182706924302167e-02; +3.821530362318967e-01   +6.557946668325580e-01   +1.584566882076381e-01   +3.730743080798068e-01   -1.184461071775717e-01   -1.967433402107285e-01   +3.477317030557598e-01   +8.645680575703650e-01   +1.971694491609317e-01   -8.405014516428409e-03   +1.642326414884544e-01   +2.259588146072177e-01; +3.866815113442882e-01   +3.332746110189929e-01   +3.020747524352576e-01   -4.051287663578266e-02   -3.787803464224879e-02   +8.044563267641093e-01   +7.832957835985587e-01   +4.209784688442954e-01   +6.284548876093030e-01   +3.817563423257320e-01   +3.931469788774162e-01   +6.887886136437539e-01; +5.250489039976129e-02   +2.592285758977101e-01   +1.947926499692032e-02   +3.903937359185562e-01   -1.316783213407367e-02   -2.602604294627804e-01   +1.761820179443250e-01   +8.437363355421535e-01   +5.055629175434070e-01   +4.777580739015859e-01   +5.209971237206855e-01   -1.100064096494857e-01; +4.670549117119181e-01   +7.417575739136685e-01   -6.256713866545074e-02   -6.880603154935085e-02   +1.138515192308578e-01   +5.471454617801588e-01   +5.969208220310585e-01   +6.346619015921230e-01   +3.104637451442142e-01   +2.855078599138257e-01   +2.769651807259789e-01   -1.028940681546716e-01; +9.517913220776923e-01   +7.083854341123510e-01   +5.967826779560904e-01   +1.506091864810795e-01   +6.269212226583452e-01   +5.635324142084183e-01   +1.453126592526902e-01   -1.282944417668679e-01   +5.275265319386930e-02   +1.000000000000000e+00   +9.387160851202910e-01   +6.398936350550530e-01; +1.457930900654097e-01   +6.373728615378029e-01   -2.673396251995834e-02   +3.357024650447010e-01   +8.002805152060025e-01   +7.923690185360067e-01   +1.603985655950878e-01   -6.441753635166905e-02   +2.745227062232464e-02   -1.034010605826454e-01   -4.778094928899654e-02   +7.945197141624307e-01; +3.052504880691923e-01   +4.848931814713101e-01   +6.358003120711363e-01   -1.004536505455418e-01   +4.922748281923310e-01   +1.529725798308520e-01   +1.910567095167182e-01   +1.951602993559239e-01   +8.509220351611350e-01   +5.873322233560514e-01   -1.323327437863998e-01   +5.838720081163119e-01; +2.436607165112586e-01   +5.462835125010165e-01   +6.589811343669311e-01   +6.795907083748119e-01   +3.231928546697803e-01   +9.312412277079224e-02   +7.598756636994038e-01   -7.051373198971965e-02   +1.694692373153457e-01   +1.626952042135040e-01   +4.922453420849381e-01   +9.777550958044230e-02; +8.120588712747819e-01   +2.357197356908953e-01   +6.526062302867272e-01   +4.287053309959035e-01   +6.320618366861877e-01   +5.071595286352309e-01   +4.343929019852658e-01   +3.770657693605733e-03   +2.900418264132684e-01   +2.310343882563372e-01   +5.614063208009380e-01   +4.057700892870467e-01; +2.299821183434048e-01   +2.562753493417714e-01   +8.145189937462471e-02   +2.678132472028159e-01   +2.122668217752730e-01   +9.787237516051964e-02   +6.479097893001328e-01   +1.860556602816672e-01   +5.620571015335213e-01   -2.891073324360261e-02   +7.201367380503656e-01   +5.414348030833714e-01; +5.569814968425069e-02   +2.404727358964934e-01   -9.928129609907180e-02   +6.508916407389047e-01   +2.940522523640535e-02   +8.322753815131891e-02   -2.992132520883545e-02   +2.775382044442823e-01   +6.049441489549091e-02   +7.974304643908851e-01   -2.082911176845147e-01   +1.768508856553344e-01];
L2E_Input1_iAMPA_netcon = [+5.013646525602529e-01   +1.986813267522782e-01   +3.658156305049605e-01   +4.889844829593388e-01   +3.380751369227848e-01   -8.538406284257125e-02   +2.917568756745159e-01   +4.071297142389236e-01];
L2I_Input2_iAMPA_netcon = [+6.038702565793604e-02   +8.129367472009397e-01   +5.100869642481778e-01   +1.460517886261046e-01   +8.843003532694257e-01   +4.051118756219240e-01   +2.000613970159780e-01   -1.328292477601188e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last =  33.63 * ones(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 60*((exp(-10*((t)-( 50))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = -60*((exp(-10*((t)-( 50))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
