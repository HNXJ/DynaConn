function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-1.174203925369801e-01   +1.543810328301345e-01   -9.122082552732738e-02   +1.165809086681203e-01   +1.310280589394116e-01   -7.169107329341123e-02   -2.505886579853031e-02   -2.286634183696795e-02   +1.179232012613567e-01   +9.525322827024697e-02   -1.068591696433145e-01   +1.754459321368360e-01   -6.290416063794867e-03   -3.389991387271433e-02   -9.039815328293588e-02   -3.548055145274772e-01; +2.849093936062666e-01   +1.777531322597510e-01   +2.006100015260255e-01   -1.369409739209696e-01   -2.805800151879393e-01   +1.984940598595108e-01   -1.493870431679397e-01   +8.597055359227154e-02   +7.708246974887399e-02   +5.448161148172712e-02   -1.101882312254178e-01   -2.166476985025783e-01   -2.406985578640023e-01   -1.208386096413895e-01   +1.458617222771102e-01   -6.988332237269369e-02; -9.391913777543531e-03   -7.213503822866747e-02   -2.527126508411528e-02   +5.889625847030582e-02   +8.539974147695654e-02   -2.218590549652934e-01   +1.156741036264574e-01   +6.252444939255251e-02   -7.882198754094392e-02   -8.408957383796950e-02   +6.560601927316825e-02   -3.143212726487415e-01   -2.094441844140989e-01   +4.579454206134128e-02   -3.851412337839439e-02   +6.135796307527981e-03; -3.783188735252213e-01   +1.433674890782303e-01   +1.949327094322546e-01   -1.394708082295658e-01   +1.187526592449935e-01   -2.522903005894533e-01   +1.001886400822918e-01   +1.671941990604149e-01   -4.833975272976022e-02   +6.070927956915712e-02   +2.122198551000383e-01   -1.368961421241822e-01   -2.970392345394597e-01   +4.055460565993717e-02   +1.853052798824290e-01   +4.084270799657522e-01; +8.590440526848032e-02   -9.680891736168665e-02   -9.663575161643653e-02   -1.115358288482768e-01   +2.434409388634826e-01   -1.926202699047999e-01   +2.457488442090733e-01   +1.282263975282595e-01   +6.744230462714840e-02   +6.914881621347038e-03   +3.576845177367701e-01   +3.399259349750529e-02   +3.857132616590458e-02   -2.014808528010928e-01   +1.077656780672685e-01   -1.269109565247855e-01; -2.580398083165184e-03   -1.060056326767086e-01   -2.192593206109409e-01   -1.923120741864389e-01   -3.421763987905448e-02   +1.764952328471392e-01   -1.587227642258033e-01   +4.180489024313642e-02   -3.276024871504896e-02   +6.130014565247727e-02   -3.451175552478127e-01   -1.560757168434195e-01   -1.140804959652742e-01   +4.766804718201417e-02   +2.180904991118847e-01   -1.929680671901527e-01; +5.457188105195063e-04   -2.765529218449376e-01   -6.830807756516624e-02   +2.442949920361293e-01   +2.403708079179577e-03   +4.070529156126017e-01   -1.128044593265939e-02   -2.307572235126255e-01   -3.135471251327383e-01   -4.021826749435700e-02   -3.852815307184811e-01   +6.138553239845659e-02   +3.067123833881043e-01   -3.291375674820130e-02   +2.492573250744904e-01   -2.217686789110921e-01; -4.287314145690028e-02   -1.169403829827470e-01   -6.146783331701975e-02   -3.834854808423299e-03   -3.259052734325155e-01   +1.923588760413227e-01   +1.118998606532884e-01   -1.568346191702408e-01   +8.190437889434303e-02   +2.234650074498941e-01   +4.469779560492805e-02   +6.540807064034150e-02   +1.411295657966126e-01   -1.326643405636078e-01   +7.809546239464774e-02   +4.276516046287218e-02; +1.590327306982506e-01   -3.804750741131010e-03   +2.209296541660252e-01   -5.845018681801775e-02   +1.816915084886142e-02   -2.302147920229080e-01   -5.958161121695324e-02   +3.160004505984317e-01   +2.117633293193311e-02   -1.227239351109187e-01   -3.363606180081634e-01   -3.622561040060684e-01   +2.463960525062941e-01   -1.609167342576139e-01   -8.991737816109815e-03   +3.199121264473402e-02; +1.755657650378231e-01   -1.726752959157377e-01   +4.799352190141566e-02   -2.073230225156126e-01   +1.639670439882939e-01   -4.051056432688779e-02   +5.000043068962738e-02   -2.366599267889474e-01   +3.274470461089952e-02   +4.694703476399286e-02   +1.471920949512379e-01   -1.475575136676031e-03   -8.843140520861735e-03   -1.043002615841051e-01   +2.306244450945471e-01   +1.266240210466904e-01; +6.733034596226044e-02   -3.173596902529849e-01   +1.887611191527569e-02   -6.903563578482071e-02   +1.090965503380702e-01   +4.113819798774911e-01   +3.614604411697164e-01   +3.983478112897604e-02   -2.977654373878962e-01   -2.923840107147471e-02   +2.780115727172220e-01   +1.152557157161738e-01   -5.884961969355906e-03   -8.626570107459469e-02   +9.125251257244033e-03   +2.654098132630001e-01; -9.285768456932836e-02   -1.137211875902837e-01   -1.307154101752829e-02   +3.477963461182541e-01   -3.750036599273955e-01   +1.231625522951975e-01   -1.465584534090450e-02   -5.471726282692555e-02   +2.047069540040496e-01   +6.771287503679102e-02   -1.436328978291073e-01   +1.758839344872162e-01   -5.388767764243264e-02   +8.933841501683271e-02   -5.311534522108894e-02   +2.698130162420306e-01; +1.343546735390723e-02   -6.213945851048080e-02   +1.309074933684463e-01   -2.434643517294826e-01   +1.072539546496948e-01   -1.938462432929001e-01   -2.252852826700247e-01   -8.860606802915275e-02   -1.170157371403349e-03   -1.402831901821391e-01   +3.617989424752874e-02   -3.960489299961545e-01   -1.729361740178060e-01   -3.411954566594363e-01   +3.086630906514167e-01   +1.422261643799621e-01; +2.741213163786871e-01   +3.122947125174846e-02   -3.394269011231129e-03   -1.091133627266382e-01   +1.323237161063370e-01   +1.436088544683477e-01   +2.117396045915362e-01   -1.149290589021611e-01   +8.921644092740617e-02   -1.469922022517105e-02   +1.031042304714593e-01   +1.675701555755713e-01   +1.298621659269577e-01   +5.171582455227882e-02   -7.454906348902011e-02   -9.965736111806289e-02; -1.851926547588922e-01   +3.512011331100329e-01   +1.618205541750329e-01   -2.843948159342561e-01   -1.930272272830582e-01   -3.191962841297032e-01   +1.648567940245914e-01   +2.811274045984229e-01   +1.955839370267482e-01   +5.505852221736723e-02   +1.946027940923759e-01   +2.113580122839843e-02   -3.887082556024645e-01   -4.493565612521397e-02   +5.381291299144772e-02   -1.360971794052495e-02; -3.541315865894452e-01   -4.335374698996147e-02   +2.021497571085691e-01   +3.488098315270159e-02   -1.947873281334337e-01   +1.251715255428160e-01   -1.562870690470328e-02   -1.589186787620471e-01   -9.875257138582243e-03   +1.435670811624210e-01   +2.835522987637542e-01   -7.309105149663717e-02   +3.693829060375083e-02   -2.343439789594677e-01   -9.374139240619578e-02   +1.685601661553599e-01];
L1E_L1I_iGABA_netcon = [-3.842226102239799e-01   +4.739168454708548e-02   +1.126834079986335e-01   -2.288008709116482e-01   -9.646490528040560e-03   -1.585162247767526e-02   +7.564099392819729e-02   -2.778028453982693e-02   +1.335721160711821e-01   -1.585850126024312e-01   +1.717548186863546e-01   -2.841918362166240e-02   -1.875554919091470e-01   -1.809075829348429e-01   -2.211597563837757e-01   +7.087168840052162e-02; +8.648700307305299e-02   -1.627586000144294e-02   -2.132797917516638e-01   -3.126161594921196e-01   +2.635338121208806e-02   +1.455186739196952e-01   +1.461837087975232e-03   +1.327496250423597e-01   -1.309001623107774e-02   +3.359504435101865e-02   +1.315832191743700e-01   -3.180460956701477e-01   -4.386138732136519e-01   +8.565267907015997e-02   -4.000800437085348e-02   +1.199508840855429e-01; +3.134584698516202e-01   +2.890938677154819e-01   +1.764816722449138e-02   -1.574981431478031e-01   -7.969341719797206e-02   -2.588483718852901e-01   +9.699817410546431e-02   -2.688660472591359e-01   -1.395993506767184e-01   +6.920655031623621e-02   -1.573394594408814e-01   -2.074931762528090e-01   -4.506828987436939e-02   -1.304285824266052e-01   -1.416278780128446e-01   +1.751443131059086e-03; -1.060660995641111e-01   +2.840432845552687e-01   +2.538912246269838e-01   -5.300443517196197e-02   -1.721901072524377e-01   -2.768200784160961e-01   -6.084870198834517e-02   -4.589311675160454e-01   +5.111265978943394e-02   +4.211597686206365e-01   -5.008938955177615e-02   +4.534910910539575e-02   -4.632304344593074e-02   -1.035833079802077e-02   +5.962394076259632e-02   +1.037840454667147e-01; +9.968023565836419e-02   -2.117882161216990e-01   -4.854860249757592e-01   -2.576872987437042e-01   -4.005904968676605e-01   -2.738911124736125e-02   +1.150264461687753e-02   +2.038933594028953e-01   -8.801467404083117e-02   -2.528462947425189e-01   +5.216759572296600e-02   +3.150570012245904e-01   +1.289171541617669e-01   +8.482563636385264e-02   -6.219930750345153e-02   -1.489356754110085e-01; +5.722183366476224e-02   +1.539970617748711e-02   +6.324463468355004e-02   +1.216267813712237e-02   -2.701289100079213e-01   -1.025912503542716e-01   +1.375389778846636e-01   -6.122827979697078e-03   -1.876099238037767e-01   +5.278720594825999e-02   +3.636144634445590e-03   +2.110255255401329e-01   +3.894800985031305e-01   +3.025370953668062e-01   +2.457791881433094e-01   -1.886056911474987e-01; +8.580834662922956e-02   +2.401528943681746e-01   +9.755539619059374e-02   +1.936521828676478e-01   -2.335287601201647e-01   +1.517631301601438e-01   +3.166473961111601e-01   -1.974242495515005e-03   -3.394164452690346e-01   +1.573537093063924e-01   -8.549125736727697e-02   +2.649287193763094e-01   +3.552429324064785e-01   -1.567426657934742e-01   +1.855491936938365e-01   -1.562031413622416e-03; -4.020791966517490e-02   -2.779652193858032e-01   -2.389626235641310e-01   +3.656434929014166e-02   +5.897416071129849e-02   -8.116953048645638e-02   +5.546878244953878e-02   +1.261349001189296e-01   -3.172263078580714e-02   +2.011646179892438e-01   +3.500827529920790e-02   +2.013421457624631e-01   -1.741037515476881e-01   -2.395842114388501e-01   +1.091232168323883e-01   +3.605359234307225e-02; +2.881250774137369e-01   +5.430289055104787e-02   -2.048579126646126e-01   +1.125822794362597e-01   -3.750210739462025e-01   -1.831994470699982e-01   -2.373686289248632e-01   +2.109917138419678e-02   -1.864619290105912e-01   -2.681169407088472e-01   +2.011492593262828e-01   +5.586256568953736e-02   +3.097805995559746e-01   +2.083421038630334e-01   -1.097089226643695e-01   +8.731217365601562e-02; -1.704860107130184e-01   +4.891160607830494e-02   +1.630942885085344e-02   -3.305090675312338e-01   +6.571650958923275e-02   +8.772169989805756e-02   +2.221770377444234e-02   -2.958933918326926e-01   +3.318553524313228e-02   +1.031547024840413e-01   -1.562533297984960e-01   -1.049151706902272e-01   +8.657818906135678e-02   -8.555008043374208e-02   +6.240767024469358e-02   -2.553610827519577e-01; +3.368344156041429e-02   +3.024448664772017e-02   +2.824884836176216e-01   -6.546095854363655e-02   -2.779824391939418e-01   -4.229165176001933e-02   +1.097192674234035e-02   -1.495162977387547e-01   +2.022082691822500e-01   -3.353630937047630e-01   -2.022270818552304e-02   +9.496566753072252e-04   -1.258352712062545e-01   +3.897641782805059e-01   -3.573806279872940e-02   +2.228755832335924e-01; -2.092686042108651e-01   +1.246839643094315e-01   -1.689297348181334e-02   -6.399461044098941e-04   -1.229605125208727e-01   +2.421930571807824e-01   +1.805040875519242e-01   -2.705962804149163e-01   +4.380840239713751e-01   +3.181422633107744e-01   -2.808793591845772e-02   +9.635250272026913e-03   +1.065828927487357e-01   -1.307880559860837e-01   -8.065728206316562e-03   -1.177442863909567e-02; +2.615457501925612e-01   +1.428239059857651e-01   +4.161612802164021e-02   -1.877372360369870e-01   +2.356152089989705e-01   +6.763337041101131e-02   -1.459023305367178e-01   +1.466760143206454e-01   +9.203527615372264e-02   +5.843259436781615e-02   -1.303596012260735e-01   +6.974800713993087e-02   +2.213299891334729e-01   -1.094824151270654e-01   +2.277039234693496e-01   +2.196774604031471e-01; -1.949581655541083e-01   -2.418569591228396e-01   -1.568221271115217e-01   -2.037821052461565e-01   -2.596112423236292e-02   -2.245482112118803e-01   -7.266389632292267e-02   +2.588950319020212e-01   +1.376307780919876e-01   +8.453957152311856e-02   -2.115818056462476e-02   -1.636018209372911e-01   -1.382371356607037e-01   +3.335977317906472e-02   -2.199686253212687e-01   -9.910714718068026e-02; +3.420184727347256e-02   -1.552865965476804e-02   +1.648563740784750e-01   +1.074882872898858e-01   -1.669922876583612e-01   +1.302209887634089e-01   -2.566515833995441e-01   +3.723144259413682e-01   +1.392498846383438e-01   -1.480935576660244e-01   -1.348923855197693e-02   +1.676721165641017e-01   +1.319889682172826e-01   -4.104425863697921e-01   -8.430050095322274e-02   -6.437683068754572e-02; +9.887774873496685e-02   -2.601936441016273e-01   -9.920938060175599e-02   +3.493160492452851e-01   -3.719564253996158e-02   +7.191249175629130e-02   +3.202747801006172e-01   +1.964257048482656e-03   -3.095972302521777e-02   +1.342969157308146e-01   -4.426472120185532e-02   +2.114748537212565e-01   +2.307072745040614e-01   -5.614804115666815e-02   +1.327650464791739e-01   -3.629444205160641e-01];
L2I_L1I_iGABA_netcon = [-9.384700284370402e-02   -6.960089748076348e-02   +1.638971866720617e-01   -1.747273621546857e-01   +3.911989831178855e-01   +3.209558097320311e-01   +1.073658365749507e-01   +3.510622559800308e-02; -7.718945267115063e-02   -1.433930603911741e-02   +5.875863407287994e-02   -2.974698195813846e-01   +3.906349884243419e-02   -3.025615561269988e-03   -2.378825665343515e-01   -6.806411767750342e-02; +2.262418763470963e-01   -2.086757823580727e-01   +2.951434604882008e-03   +7.143556838801247e-02   +3.417536457456686e-01   +3.893769325311380e-02   -4.805819845196796e-02   +2.327450625546151e-01; -6.992566039354370e-02   +1.487599450138765e-01   -2.256314295122631e-01   -3.681012576502486e-02   -1.114527245055342e-01   +3.970960986899658e-01   +4.755201381046981e-01   +1.992161952305002e-02; -1.887914647635443e-01   +3.682586821051303e-02   +1.182598725328458e-01   -5.805825620917857e-02   +2.176463012560412e-01   +1.150583796967431e-01   +1.737004795136909e-01   -1.799094692033761e-01; -1.353590124414958e-01   -4.161916838876591e-01   -2.033053633505101e-01   -3.530598640770163e-02   +1.806518819343424e-01   -1.196402798906772e-01   +1.405625561846407e-01   +1.026150621499426e-01; -5.084932382209417e-03   -2.289253516883526e-02   -2.933674142276902e-01   -4.186767907398124e-02   +1.539934865915232e-02   +9.126077069709768e-02   -1.646794143856173e-01   -9.428960779819925e-02; +1.008438825719382e-01   +3.294046341229120e-01   +1.368724077447215e-01   -1.701166274098233e-01   -1.178527255517057e-01   -1.357430295891744e-01   -1.788603899237219e-01   -1.524694680259865e-02; -7.232885692278027e-02   +8.457039478346173e-02   +1.720991706378938e-01   +1.780157762075554e-01   +2.428424600345017e-01   -7.000454845728514e-02   +7.138409299855791e-02   +3.542983658500397e-02; -3.683026847601669e-02   -1.700511830079283e-01   -3.071672236450947e-03   +1.655877283012632e-01   -8.960802464503712e-02   +1.505986185537321e-01   +3.696465641043766e-01   +1.003345640229243e-02; +3.974558034667434e-01   +4.075629711076845e-01   +1.743858109451796e-02   -2.882628703623347e-01   -1.482302577705624e-01   +7.470588647016424e-02   +1.504881468774231e-01   +3.226719021406576e-01; +2.442358090390553e-01   +2.100393689228366e-01   +1.930617789011843e-01   +4.200249000435513e-01   +3.477303010660031e-01   +1.241629696872311e-01   +3.778711890638677e-01   +1.238836950828278e-01; +1.570362111867652e-01   +5.512622571530361e-02   +1.287534238822708e-02   -1.975394862560378e-01   -1.717260703587295e-01   +1.516865458118348e-01   -1.584312675366304e-01   +1.324519617138739e-01; +3.278074360627230e-02   -1.995897825615053e-01   +9.805434573042407e-02   +1.427531954910725e-02   -2.309000889698955e-01   -3.301026462840010e-01   -2.748555775442707e-01   +1.360080649944261e-01; -6.495538981408268e-02   -2.913150930727526e-01   +2.737073812775419e-01   -3.239809688565212e-01   +7.783565039015769e-03   -1.274556765901434e-01   -1.284567364322080e-01   +2.299657393681034e-01; -1.385758956720582e-01   -8.448664574995847e-02   +2.026485552402582e-01   +1.778844512059296e-01   -6.278883958490275e-02   -2.567866779989123e-01   +9.482051071844640e-02   -1.016489481850346e-01];
L1I_L2I_iGABA_netcon = [-1.810504602353957e-01   -4.546666616562312e-02   -3.036713829658287e-01   -3.937177542725500e-01   -2.765838816337002e-02   -1.850225677816566e-01   +1.492147799186938e-05   +1.513688102721847e-01   -2.015495302928294e-01   +1.952872861813638e-01   +2.920382097964685e-01   -1.191378887156535e-01   +1.279170527924862e-01   -9.895378430965163e-03   -2.130541974391838e-01   +6.645953524962459e-02; +1.221829636102979e-01   -1.532945836845899e-01   +2.234772883340300e-01   -2.221764628942849e-01   +2.811541603355404e-01   +3.267316480156991e-02   -1.884365625941721e-01   -2.612351393204811e-01   -4.404884607434226e-01   +4.724314898530085e-02   +3.376302684407553e-02   -5.586582641128451e-02   +9.802834043270059e-02   +2.935901546365692e-01   +2.436556114494512e-01   -2.571516973758026e-02; +8.728365625298398e-02   -2.192035213060019e-01   -3.473140986765169e-02   -1.487236051430148e-01   +2.443803952128805e-01   +5.136080893041801e-02   -1.966552648865326e-02   -1.565844405164372e-02   +2.028123794648570e-01   -2.617393501661385e-02   +2.604353432951106e-01   +7.486362520657888e-03   +4.084995379002854e-02   -3.222326379902184e-01   -1.397636904736788e-01   +7.613525690016079e-02; +2.602540465858527e-01   -8.717581144861845e-02   +1.612329346365258e-01   +3.256189805253407e-02   -3.299206962262734e-01   -9.286067073680335e-02   -8.274679633011593e-02   -2.194878489462639e-01   -5.998632852052097e-02   +1.913412540884391e-02   +1.068503765522340e-02   -1.350561809705345e-01   -2.900648856727623e-02   +1.469008119230682e-01   +1.019996637288414e-01   +2.571913540884193e-01; -2.046918922064304e-01   +2.563065035178089e-01   +2.209709222605286e-01   -1.505119372578166e-01   +2.409427335766582e-01   -8.082902197048755e-03   +1.044028832734083e-01   +3.089283238447137e-01   -1.049638256237980e-01   -2.729999823446173e-01   -7.572507657687486e-02   +2.340283466903492e-01   -9.045858745285809e-04   -1.127662750640526e-01   +8.742552814689127e-02   +1.836298409314928e-01; -1.177372230741751e-01   -2.084431280247601e-01   +4.727541844201329e-03   -1.347687635128607e-01   +1.109718450039730e-01   +4.012338889411465e-02   +2.187196941286901e-02   -6.859699111384093e-03   -3.884034362259925e-02   +1.147771726080346e-01   -1.763344877742600e-01   +2.997654707393364e-02   +2.627111116119576e-02   +2.355473170011998e-02   +5.025524923097482e-02   +7.480883765645076e-02; -2.087730187784392e-01   +2.394840898179725e-01   +2.203863566979214e-01   -1.969699394780597e-02   +1.098610141929081e-01   +7.633484812720948e-02   +1.121780498830327e-01   +2.687021013458661e-01   +2.374458190753850e-01   +2.222594981544100e-01   +5.814697604969522e-02   +3.009829246779199e-01   -7.940689789784025e-02   +2.521606394556777e-02   -2.133315702970950e-01   -1.903019322787974e-01; -2.313683916824885e-01   -2.723383262714274e-01   -5.798574675784506e-02   -6.792045561604844e-02   +2.666038561385181e-01   -1.567838716803883e-01   +1.424419567538896e-01   +1.084153289652292e-01   +1.529408871321881e-01   -2.046158783924555e-01   -1.614212253074777e-01   -1.253538799907366e-01   -2.043681529112075e-01   -1.662683754669789e-01   +9.922878549623286e-02   -1.437966878717535e-01];
L2E_L1E_iAMPA_netcon = [+1.128505579953781e-01   -5.540442488907643e-03   -3.147664102730245e-02   +1.509842755056601e-01   +5.055902060812483e-04   +8.027242305671187e-02   +3.104565418463659e-02   +4.122009682859771e-02; -1.572774374198210e-01   -2.811416438614551e-01   -2.027264994109652e-01   -1.109579302240089e-01   -3.916458509161089e-01   +2.885896051077443e-02   +1.582047057112529e-01   -2.901436165434830e-02; +1.231624428642427e-01   +3.264083327236479e-01   +1.084769234151528e-02   +2.142150689572657e-01   -2.192586648412447e-01   -2.502940555521229e-02   +4.894032069761138e-02   -8.482792296946100e-02; -1.094913798697922e-01   +4.292778886558511e-01   -1.639936969468296e-01   -1.387755056236302e-01   +2.435151249325001e-01   -1.505571673081461e-01   +1.507601523827887e-01   +2.750483731311160e-01; -1.700066855628643e-01   -4.979595890231653e-02   -3.515381037915800e-01   +1.401330679478264e-01   +5.277615587512825e-02   +3.639434702783710e-01   -1.413924713909546e-01   -1.366708150899156e-01; +1.755846342811856e-01   -9.570454400033340e-02   +8.131994997241097e-02   +6.732317907264121e-02   +1.188801636627838e-01   +9.530882537083417e-02   +8.569865228646163e-02   +5.359712401857284e-03; -3.106370751369675e-01   -3.942475926701419e-02   -2.830854507512357e-01   -2.014194905693581e-02   +8.115601106838760e-02   +9.195640138744514e-02   -3.091334254410332e-02   -1.265296931125977e-01; -1.567360158065491e-02   +6.085624112323558e-03   +1.676139276332476e-01   +1.032856135093286e-01   +1.900217017506926e-01   -1.668340604760817e-01   -7.785739140113206e-03   -9.300249895722867e-02; -1.372863674461268e-01   +2.988686980749035e-01   -2.979904415277815e-02   +1.592328900181702e-01   -1.670438448234978e-01   -1.282777571796548e-01   -4.508734293787200e-02   -2.953477281724369e-01; +8.808314672142309e-02   -2.080326175229307e-01   +1.499470316933168e-01   -7.020919532530742e-02   -9.720877403347333e-02   -2.078042855202705e-01   -1.402250158996360e-01   -1.049286779746851e-01; +1.593706200271487e-01   +1.363492782456122e-01   +9.215332151327363e-02   +1.108611669634737e-01   -1.021755085972860e-01   -1.149968763476172e-01   +7.211387232638715e-02   +1.025670739700375e-01; +1.734282715124325e-01   +2.260545215923248e-01   -1.732381477178829e-01   +3.204216457894483e-01   +2.080140333247787e-02   +6.273307645764545e-02   -2.010680277148025e-01   +4.521985394671361e-02; -2.802599202154416e-01   -9.581972590697882e-02   +3.138499489155695e-01   -6.917749608348404e-02   +1.444854979759642e-01   +2.578891483095988e-01   +7.270727522984126e-03   -1.717342520111932e-01; -1.849146484401153e-01   -2.710970528115827e-01   -1.324553829920093e-01   -1.599762663572093e-01   +1.863308868425488e-01   -2.589933052591690e-01   +1.780491385833213e-02   -2.499234148702789e-01; -9.427091861239065e-03   -1.142249442920191e-01   +2.471604383136610e-01   -1.046528337732172e-01   -2.470324813228804e-01   -1.395043109396120e-01   -2.887701391647081e-01   +1.465334326858532e-01; -8.947089186841355e-02   -2.247048617934274e-01   -8.611366872987888e-02   +6.977801440589357e-02   -3.406961841030184e-01   -9.732961990189506e-02   +9.653140468802431e-02   +1.329356832298174e-01];
L1E_L2E_iAMPA_netcon = [+6.610875481073707e-02   -7.611593923955620e-02   -6.211839622120326e-02   -8.507464925441999e-02   +4.538208299142726e-02   -1.414786164943418e-01   +1.237082855722397e-01   +1.687495626405903e-01   +5.717305551796642e-02   -1.106252093173446e-02   -6.455615561837447e-02   +1.151749736083758e-01   -4.017274164653524e-01   -2.857130693431233e-01   -5.991595032143422e-02   +1.175997507128520e-01; +7.513048746728443e-03   -3.045605108355779e-01   +1.835397194898996e-01   +1.707711308266351e-01   -1.171999078537051e-01   +2.838557207984710e-01   +3.072152285462899e-02   +1.565782049886476e-01   +1.198441491526933e-01   +2.273927765232590e-01   +1.735894897350049e-01   -1.012434429250227e-01   -2.824170700574773e-01   -2.408690007908815e-01   -7.183540154969711e-02   -3.561852961076760e-01; -2.674241217497793e-01   +1.735405122861463e-03   -5.717891169926213e-02   +2.631507376906149e-01   +2.190516193258397e-01   +1.901602327887943e-01   -1.757847798333681e-01   -1.489119097050902e-01   -4.290867999633193e-02   +2.239753959155836e-01   -2.907751160338082e-02   -9.795426812112475e-02   -4.507693758671215e-02   +2.901404476389326e-02   +2.718031217758093e-02   -2.726290570008338e-02; -4.921363314626789e-02   +6.804961029771536e-02   +5.420886609139378e-04   +4.898888938731986e-02   +1.240014750195034e-01   +2.035492205496799e-01   +1.773239978280183e-01   -2.840784544609119e-02   -7.653713444056912e-02   +5.515411228548703e-02   -1.460881524121651e-01   -2.656923254050127e-01   -1.089580589466005e-01   +1.186284198274061e-01   +7.135491585946348e-03   -2.308064850403572e-01; +2.279743489026057e-01   +2.180424585228886e-01   +2.262852409173637e-01   +8.819568211888541e-02   -1.145186309205046e-01   +3.232431910500961e-01   +2.300781331687306e-01   +7.750662462424360e-02   +2.028595639350404e-01   -4.898555534900730e-02   +9.340972153365938e-02   -5.748254357023395e-02   +1.733001675440991e-01   -1.143516527753240e-01   +1.860426891770419e-01   +5.766419596085105e-02; +7.356872110057454e-02   -3.513991381482634e-01   +9.865113224163680e-02   -2.074665900318360e-01   -4.614012566888648e-03   -2.597613359475517e-01   -6.854302189824997e-02   +2.846648648756565e-02   +8.342447210503638e-02   +7.784370243055214e-02   +2.222678672455820e-01   +1.927916228799325e-01   -4.198062395509691e-02   +1.755721510883956e-01   +1.078566067031769e-01   +1.479762804269145e-01; -7.219464409048826e-02   -1.801759757025148e-01   +1.295841978088120e-01   -1.598722190616561e-01   +4.098811414781735e-01   -9.783348493183977e-03   -1.110439952700047e-01   -1.224379722883560e-01   +1.644949462659097e-01   +4.821978513006908e-02   +1.317769076623084e-01   -2.265669587323904e-01   +2.969261760492695e-01   +1.083982015785418e-01   -8.622419397383099e-02   +1.053904124053848e-01; -9.584559800593667e-02   -2.782876491901491e-01   -1.355951783904407e-01   +7.740752567840868e-02   -6.438750818058889e-02   -3.035213761121521e-01   +1.226290003539412e-02   +3.064543015108220e-02   +5.017540887266657e-02   +1.749994737121429e-01   +3.267523284267194e-01   -2.098052523108165e-02   -2.250045951488427e-01   +4.493960568684539e-02   -1.603814742961223e-01   +2.652819573860412e-01];
L2I_L2E_iAMPA_netcon = [+2.346190953897949e-01   -2.148700542208760e-01   +2.299641397703615e-01   -1.885141671669221e-01   +1.734621208069477e-01   +5.812841133805594e-02   +4.670567427132241e-02   +2.608959065514925e-01; -2.585987891818454e-02   +2.034164183180746e-01   -5.053494466266632e-02   -1.453469011265422e-01   -4.548707655867901e-03   +2.229247991385313e-01   -1.082366853550715e-01   +6.659286296111007e-02; +2.778088816601557e-01   +8.124773892386061e-02   -1.528175072793128e-01   +1.389327961648457e-01   +1.226390836893619e-01   +7.257241644902798e-02   +3.264353438166810e-01   +2.303364466041105e-01; +1.353716159608182e-01   -1.770443328692853e-01   +1.964604505714205e-01   -8.915817813237240e-02   +1.954662557775487e-01   -3.336125955432026e-02   -1.321932961906902e-01   -1.036203512760172e-01; -7.324853692153716e-02   -2.196805309404195e-02   -3.425853286621172e-01   +3.785524776034190e-01   +9.352185119055648e-02   -1.092347772509628e-01   -5.469423672018513e-02   -1.657842871180966e-01; -1.228423081833962e-02   +6.087573718520888e-03   -8.016863764417895e-02   -1.023601873314007e-01   +1.151985339254670e-02   +2.538321454655351e-01   +2.829738277719521e-02   +1.668888680355060e-01; +4.079247425091582e-01   +2.359733008154471e-01   -1.602594551363920e-01   +9.496382038705548e-02   -2.424870541512550e-02   +8.676553860948055e-02   +1.350161907552417e-01   -9.132158783224839e-02; -2.702395252995423e-01   +1.193948658663419e-01   +2.868713451392699e-02   -9.168848323229781e-02   -3.124347230319022e-02   -2.489979211238242e-01   +4.645605147356901e-01   +3.213295962094272e-02];
L2E_L2I_iGABA_netcon = [+4.975093381525555e-02   +1.229719504163168e-02   +1.419756872550861e-02   -2.416576868669592e-01   -1.187718884144505e-02   -1.195382343440899e-01   -4.972045053514256e-02   -1.879570489078448e-01; +3.096806599985171e-02   -2.539607068555002e-01   +5.763277693962218e-02   +1.811116338038818e-01   +1.915222921257619e-01   -5.550600587255876e-02   -1.749888504269373e-01   +2.129803334742264e-01; -5.788407258978707e-02   -1.777948577256227e-01   -3.918521180133407e-02   -8.433194771525998e-02   +2.058762289202306e-01   -1.584998118706198e-01   -1.234311352494514e-01   +2.152000026020528e-01; +7.059408628831934e-02   +6.474774897429691e-02   +4.145151594986949e-01   -5.172462653985370e-01   +2.607713663200515e-01   -2.260662587228685e-01   -3.248764414399644e-01   +4.755713304842504e-02; -4.317901132343035e-04   +1.671117219733170e-01   -1.387147443166604e-01   +9.004176053414496e-02   -1.829265971099472e-02   +2.031282931745222e-01   -4.331333993122671e-02   +1.628621021847376e-01; +2.516151886643722e-01   +3.540077020207751e-01   -1.443500450303738e-01   +5.338125590346810e-02   -5.179423102693723e-02   +2.453050801714936e-03   -1.469195093713137e-02   +6.463122496751489e-02; -3.288734997858337e-01   -1.619875089065493e-01   +1.116090009534300e-01   +2.097000677806281e-01   +6.947699905875353e-02   +2.346280637325136e-01   +1.022838930544978e-01   -2.196619203286845e-01; -1.887833347897908e-01   -2.383645274705183e-01   -1.007577644671903e-01   +1.990265185561150e-01   +1.700296962529318e-01   -1.790329398806209e-01   +1.836826574876080e-02   +2.320930578471901e-01];
L3E_L2E_iAMPA_netcon = [+2.935609835924222e-01   +1.299050225081231e-01   -1.846542062034505e-01   +4.449954332904071e-04   +2.688943234396990e-01   -9.002816296499405e-02   -4.025061132637465e-02   +2.011901273493840e-01   -2.986840180670067e-04   +3.704172724285597e-01   -1.626760283191470e-01   -6.330973812641463e-02; +2.505856277106565e-01   +3.862347797001298e-01   -1.225879196492621e-02   +7.573234459065228e-02   -2.802200015957820e-01   -4.118593987793428e-01   +7.666941050111557e-02   -1.002262045151340e-01   -1.166733828819169e-01   -6.569434485058742e-03   +1.453913667275976e-01   -2.547999649280610e-01; +1.254080067294032e-01   +4.004430799847248e-01   +1.361210261075603e-01   -7.861176972690158e-02   -2.897128606303856e-01   +1.682707848619818e-01   -3.941440541097870e-02   -3.342498130876789e-02   -6.780642530628839e-02   -2.336972305512092e-01   +1.164303230441216e-01   +1.063318100358261e-01; +2.190973822556742e-01   -8.204845050561768e-02   -2.911529000377463e-01   +1.903162306324850e-01   +2.293034741414930e-01   +1.102873043271891e-01   +1.731490290523968e-01   -6.843788023566026e-02   +2.246648066316352e-02   -3.462777091635019e-02   +1.571835470401411e-01   +2.401062345221188e-01; -1.675546128979200e-01   -1.330129668742555e-01   +1.597454778875529e-01   +1.054434393945528e-01   +2.276547941550220e-01   +3.813269093927315e-01   -5.507642957570293e-02   -6.157981451896000e-03   +2.797141175998525e-01   +1.738230063063582e-01   -6.302817373812428e-02   +1.547270686102466e-03; -1.986380566934755e-02   -3.167504368317173e-01   +1.263985755003869e-01   +1.897299960349755e-01   -1.491658457980008e-01   +2.388878949824239e-01   +2.878984005553916e-02   -1.417625681336996e-01   -6.516232980705142e-02   -2.020688034785340e-01   -1.937589854204816e-01   +1.032375191753778e-01; -1.587696894240506e-01   -2.317592219267675e-01   +5.654356589282340e-02   +1.873646451490821e-01   -1.054466017144170e-02   +1.645834824373227e-02   -3.887561770317967e-02   -1.937490128630406e-01   +1.034678761642999e-01   -8.304253142379558e-02   +1.232616985768716e-01   +6.107028550165152e-02; +1.157082778269374e-01   +1.271000202019945e-01   +2.355851540839711e-01   -2.091712019885152e-01   +2.780458032389011e-01   +8.586250514560963e-02   -8.941665147492849e-02   -3.117292290648768e-01   +1.698467887836562e-02   +1.369101390506761e-01   -8.781182507696758e-02   -7.834830402128282e-02];
L3I_L2I_iGABA_netcon = [-1.945675381205254e-02   +2.538314054542763e-01   -4.735036392028143e-02   +1.199758372709903e-01   -3.614150566861248e-01   -1.172942984879445e-01   -7.531376691853012e-02   -2.787245057436031e-01   +1.765031485567091e-01   -1.897470364178026e-01   -1.950307718782548e-01   -6.563543148622033e-03; -1.381599413943202e-01   -3.307456334614845e-02   -2.199912020974872e-01   -3.697777184925071e-01   +1.846905749031822e-01   -9.556955812928296e-02   -6.435270703464301e-03   -4.495607796327207e-02   -9.740956908458946e-02   +8.926172698367874e-03   -2.356790282079454e-01   +3.268434575951448e-01; -2.103949473592142e-02   -2.498686944925415e-01   +6.013886190114215e-02   +7.465423772563698e-02   +1.387896442163408e-02   -2.110715442996119e-01   -4.009792098358845e-01   -2.716433912820815e-01   +4.575322560958651e-02   -2.342985420501567e-02   -1.865635424146793e-01   +1.491673283355400e-01; +1.968869282788090e-01   +2.859360321906419e-02   +1.841485021012038e-01   +3.517507794976862e-01   -5.884507437535201e-02   -4.000088977406691e-02   +3.735725287467170e-02   -5.753761152112499e-03   -2.988497841850520e-01   -9.741894191121200e-02   +2.538422317951284e-01   -1.012097260111583e-01; +2.013540426090444e-01   +6.036043224826975e-02   -7.240480131966416e-03   -6.239617786039103e-02   +2.398049212458621e-02   -1.073134009576099e-01   +2.543458837627565e-01   -7.171379762760480e-02   -9.633150348493595e-02   +2.319961654669317e-01   -9.529582079039138e-02   -2.411968621609720e-01; -1.987795136109937e-01   +3.880077242376052e-01   +2.260041376402967e-02   -7.116041544989418e-02   +8.901013737022889e-02   -1.027764024485462e-01   +6.145302634158409e-02   +2.772817299285452e-01   -1.782205994669204e-01   +2.202538395026384e-01   +9.308880669383307e-02   -8.576059416585985e-03; -8.021938911285657e-02   +2.178838871126532e-01   +2.882084227066672e-01   -2.240301948316605e-01   +1.075951779751559e-01   -1.735488848201949e-01   -3.113226896483213e-02   +8.886269392676319e-02   -1.499797354290064e-01   +2.836602475532189e-01   +1.652823353125159e-01   -2.708774580916372e-01; +6.324291494641421e-03   -1.818135541142373e-01   -4.014612502161402e-02   -1.568123051243808e-01   +1.170173452177579e-01   -3.110981558386229e-01   +2.183286766543557e-02   +1.349157136682722e-01   +2.053038656106665e-01   +3.554567372559718e-01   -5.772998951605734e-02   -2.598407800664511e-01];
L2E_L3E_iAMPA_netcon = [+8.153175045259876e-02   +2.605935238888200e-01   +2.649173985690651e-01   +1.459068217916630e-01   +4.073511988313746e-02   -3.238892020673944e-02   -1.472193898674982e-01   +2.420307892947736e-02; +6.932943433308229e-02   -1.786675417845616e-01   +5.539608435921582e-02   +2.848485531539025e-01   -1.775827786870198e-01   +4.802916245518866e-02   -1.059431689032249e-01   -2.306261554518258e-01; -5.485231913477819e-02   -2.031268017394667e-01   -1.536344058447781e-01   +1.586834219310450e-01   -1.712672700741980e-01   +6.771035548701139e-02   -3.892136106045918e-02   +9.861447238228693e-02; +1.543627280734612e-01   +2.811769593038252e-01   -2.826576835423741e-01   -2.617183879131586e-01   +2.457198929897127e-01   -2.090662795499661e-02   +3.470940720320981e-01   -1.345997113256907e-02; +8.787732329168932e-02   -2.338646510832084e-01   +1.055321525540392e-01   +3.726166951043566e-01   +1.262006990576598e-01   -3.580261002991990e-01   -1.346696428373494e-01   -1.295139788994797e-02; -1.157869187661517e-01   -5.699814610669483e-03   -3.085454016522811e-01   +1.447907105182867e-01   +1.513777004189531e-01   +1.223409622162046e-02   -4.011854300289708e-02   +1.950008115786055e-01; +2.277235744126592e-02   -1.944092754324198e-01   -5.180433766987062e-03   +6.977971755213891e-03   +9.633577775601041e-03   -1.389658123605162e-02   -1.201031526865642e-01   -3.275796583906607e-02; -2.571194797354647e-01   -9.951498785068479e-02   +4.129458217879107e-01   +3.637031617315122e-01   +1.430759346661866e-02   -2.448894758235358e-02   -3.082990883190878e-01   +4.511175405950976e-02; -2.389558639876741e-01   -8.996208047854770e-02   -3.186573043046455e-02   -2.171561071388681e-02   -3.789372963589977e-02   -6.829112384805905e-02   -1.018999808104366e-01   -8.437074128929492e-02; +2.187541177743359e-01   -2.768938447748289e-02   +3.615306663400118e-02   -8.086773969544783e-02   -2.905925036259183e-01   +4.234047161496326e-02   +9.169889670737202e-03   -2.279403117078357e-01; -5.278767878413566e-02   +1.853263261464366e-01   -1.934258842596743e-01   -6.839224839842781e-02   -2.217819378544704e-01   +7.219677004543519e-03   -4.139432770677355e-01   +3.849518037885227e-01; -1.446270505487691e-01   -1.936016323778949e-01   +1.221463030756280e-01   -1.397884278179365e-01   -2.894879315618226e-01   -8.936084914751688e-02   -1.877239428389561e-01   +3.361813057803573e-02];
L2I_L3I_iGABA_netcon = [-9.632171389519520e-02   +9.768008627395583e-02   +3.932142945301264e-03   +2.823021928869017e-01   -1.171643087018123e-02   +1.677452952717211e-01   +1.993234737359541e-01   +1.584769673558647e-01; -2.464976257154940e-01   +1.589147098611515e-01   -1.806853315422595e-01   -1.296630350068274e-01   -3.674750399021565e-02   +8.312263951941226e-02   +9.413838107318631e-02   +1.065682985040009e-01; -3.818413643907929e-02   +2.725656743059801e-02   -3.485984658066821e-02   -6.174963697412238e-02   -1.088794502817921e-01   +6.379579622946584e-02   +3.584811851896549e-02   +1.066599313592589e-01; +8.905286683250671e-02   +1.881764084987415e-01   -2.982670463308013e-01   +2.630105379199393e-01   +2.404507948304128e-01   +3.401903103659301e-01   +3.150773496956308e-01   -1.973236150758133e-01; -3.685822503143604e-02   +1.700052955236552e-01   +1.554405102993800e-01   +2.816732290451048e-01   +1.938327407512412e-01   +4.348588483487487e-05   +3.714211922052825e-01   +7.162076837755972e-03; +1.220372025502030e-01   +2.409023378915001e-01   +3.071821700552625e-01   -1.245567008715785e-02   -1.498002490182432e-01   -1.960234792960648e-01   +1.380989756056050e-01   -2.545005608791346e-02; +6.407263571234664e-02   -2.450608979936933e-02   +2.336515509593556e-01   -1.155411522513932e-01   -9.377076145255840e-02   +1.158034955957207e-01   +1.351514027034609e-01   -2.240860393102788e-01; -1.719002061382078e-02   +2.083356770733281e-01   +1.165857373945449e-01   +9.600320535310580e-02   -1.028926466057184e-01   -2.804922684853267e-01   +3.364120430698344e-01   -1.338107394373975e-01; +1.204630982796167e-01   +3.133928409400757e-01   +5.609872305585990e-02   +1.605668522137743e-01   -4.224072775941180e-02   -1.243803326838901e-01   -2.941547969792879e-02   -1.563377957514970e-01; +4.186648941312143e-02   +7.615082518669038e-02   -1.159211144217901e-01   -3.952524054495876e-02   -4.420624784821667e-02   -9.317529912651022e-03   -9.726049520586078e-02   +2.194222934048993e-01; +4.940068211106077e-02   -1.016204921221207e-02   +6.016074331775269e-02   +3.237145840084885e-02   -6.774718562928697e-02   -2.646691118669370e-01   -8.446167713682677e-02   -1.071265208546716e-01; +1.058918244174225e-01   -1.773511627955192e-01   -5.161216054932360e-02   -2.780380040875078e-01   -1.330906493039645e-01   -3.084003567333611e-01   +4.805405700682647e-02   -9.546085739638613e-02];
L3I_L3E_iAMPA_netcon = [-8.107549616344539e-02   -1.798173776024272e-01   +1.019913296477716e-01   +8.617440402180217e-02   -7.866720431001381e-02   +2.384594519783237e-01   +3.873058071025310e-02   +7.318711443479536e-02   -2.568580957834069e-01   +5.291775282919460e-02   +1.190207115390897e-03   +2.432263198783458e-02; +2.488139867932983e-01   -2.875051719534777e-02   +8.334802593025627e-02   -9.499397319642275e-02   -1.433950903258709e-01   -3.642767354467984e-01   +1.672214611151553e-01   +1.643432152111866e-01   -2.126389593371706e-01   +2.450532149187656e-01   -2.003688835169309e-01   +5.782500081582731e-02; -1.971624353622381e-02   +1.937481876848964e-01   -3.378565357316196e-02   -6.386838712799220e-02   +9.015504632852395e-02   +2.309683089653160e-02   -1.857748648262547e-01   -1.224047635440536e-01   -3.256673977441281e-01   +1.196439748787564e-01   +1.901690245396865e-01   -9.389878624195068e-03; +4.088656895856232e-03   +4.362310791837236e-03   -1.044192701464935e-01   -9.769030550017455e-02   +2.102310556735388e-01   -1.028377702513429e-01   +1.235778899250659e-01   +4.710766318835204e-02   +4.266936003124178e-02   +1.174984249913780e-01   +1.312898393437282e-01   -5.213130291545136e-02; -8.617497811386877e-02   -1.688727769793656e-01   +2.962952262234284e-03   -2.464205505941837e-01   +2.469841303193020e-01   +1.496192426050883e-01   -1.037765870707655e-01   -9.980957039603530e-02   +3.506631434973241e-01   +3.208475457327957e-01   +1.086012031631696e-01   -7.906319194180296e-02; -5.836386935368308e-02   -6.724331527293215e-02   -4.078054143823010e-02   -2.590540221755229e-01   +2.594974056447572e-01   +1.303648605533926e-02   -3.094555484424771e-01   +1.513002885668478e-01   +1.156284856742798e-01   +7.422050646806838e-02   +5.125358541423727e-02   +1.462062360084368e-01; -2.296673294615163e-01   +2.343351259397760e-02   -1.652821226800720e-01   +1.683929966250575e-01   -2.566527105794438e-01   -1.073454276409415e-01   -2.058574700614699e-01   -2.437226312790711e-02   -6.036940057703731e-02   +3.574607904529053e-02   +4.736012235186611e-02   -9.745797868028311e-02; -1.513935519877265e-01   -3.447887150411153e-02   +3.993623422245892e-02   +1.676594225410534e-01   +1.133419803898413e-01   +2.368702467837017e-01   -1.216128514219830e-01   +2.366813691820779e-01   -1.095132556907942e-01   -2.353978044408487e-01   +1.512731464952108e-01   +1.213095498757536e-02; +1.903081571751589e-01   +1.937315073574080e-01   +1.883138758134936e-01   -1.232103106474917e-01   +1.790380630810745e-01   +1.308832309078729e-01   -1.753594771302043e-01   -4.957447529822939e-02   -8.756041665319778e-02   -1.442705956744963e-03   -2.784471169769854e-01   +4.536651543012475e-02; +2.331417421776608e-01   -4.587005388692990e-02   -1.043408381398047e-01   -7.060082488258899e-02   -3.850013808291116e-01   +2.219781866512067e-01   +1.573243498437725e-01   +1.421273219041793e-01   +2.306825938135957e-01   -1.355747447705516e-01   -2.014185904026582e-01   -2.807081973979943e-01; -5.982025308655654e-02   -2.581873540313963e-01   +4.935890795152956e-03   -2.169474928956078e-01   +2.086210017501172e-01   +1.535592989428033e-01   +1.045234383213131e-01   +1.374741996386647e-01   +2.736700095620077e-01   +1.321150408110377e-01   +1.069180111890359e-01   +3.859348882067904e-01; -2.363335185159003e-01   +4.431594711128376e-02   -5.984351268255340e-02   +2.473443497896851e-01   -3.516035696968341e-02   -3.830035810037015e-02   +5.854304593176145e-03   +1.129142735145247e-02   -2.166648421607048e-02   +2.317463589834420e-01   -1.741929672510864e-01   -3.074996014971615e-01];
L3E_L3I_iGABA_netcon = [+2.264923782057210e-01   -1.248288691892707e-01   +3.650898507123954e-02   +1.309048616462548e-01   -1.500046404050486e-02   -8.563927423026085e-03   +3.748932022947529e-01   +2.352313038677991e-01   -7.182386572369386e-02   +9.250033605937324e-02   +2.471142557683316e-01   -8.352643806118103e-03; -1.313309045004063e-01   +2.837940986131208e-01   +4.031918480575366e-01   -6.089013778395991e-02   +1.225089093246128e-01   -1.789635027982145e-01   +1.407733313517100e-02   -9.611905599702880e-02   +6.441201430846817e-02   +2.411922409509227e-01   +9.904190537309662e-02   +1.155360260894629e-01; -1.236144090983138e-01   +3.866134711691375e-01   +9.404872692633626e-02   -1.041041239730139e-02   +2.176649848523535e-01   +7.419790980935090e-02   -5.473249221250458e-02   +2.174501410455519e-01   -1.697111254455107e-01   -2.231290525547912e-02   +1.405664385715918e-01   -1.730524096239549e-01; -2.490137968011549e-01   -1.951602465741325e-01   +2.390391133194449e-01   +2.378516594298042e-01   -4.679497661003949e-02   +1.741756893757039e-01   -2.007095931526761e-01   -2.211392688469959e-02   -2.104635235477356e-01   -4.404931175508804e-02   +9.380921803605706e-02   -1.349735922015766e-01; -2.206006476287221e-01   -1.922965018154523e-01   +4.304117241397738e-01   -2.264181981150738e-02   +2.182954718101743e-01   +2.342681447061729e-02   -6.411680981114501e-02   +1.197261111595707e-01   -1.969675384295154e-01   +1.155572971786619e-01   -2.514964731888174e-01   -1.265173309422400e-01; +1.073679337605201e-01   -3.551853649865504e-01   -5.704287782161062e-02   +2.054913185709326e-01   -2.275821529845352e-01   -2.209775695654853e-02   +9.537478283191646e-02   -7.768601174780093e-02   +4.384792474665723e-02   -1.600468717647673e-01   -5.825245423422343e-02   -4.757094869485397e-02; -1.698631728078838e-01   +2.403453718745029e-02   -4.583305316444790e-03   -9.414291505263946e-02   +2.392736912729252e-01   +2.278578056159273e-01   -5.201278428461276e-02   +2.541182654069304e-02   +3.323423699318137e-01   +4.320075934975681e-02   -1.100479589402657e-01   +2.203400254531156e-01; -3.360704428730970e-01   -1.600419944222457e-01   +2.156089930459842e-01   +3.831304851146601e-02   +1.631152689381695e-01   -2.378584440467710e-01   -1.943719735117696e-01   +2.615406893947854e-01   -1.279777492655796e-01   +1.946984491270753e-01   -3.188966843116306e-01   +3.808725840700728e-01; -2.898630361978750e-01   +1.010908463630436e-01   +4.871756702674712e-02   -2.467809403615598e-02   -1.544207825353295e-01   -1.136797602632770e-01   +2.199154735058073e-01   +3.976301577320436e-01   +7.860165421853699e-02   +2.986351171361122e-01   -1.559630815155073e-01   -2.133526878249541e-01; +9.102408997341688e-02   -4.759241546796668e-02   +1.023903341932489e-01   +7.576059073682630e-02   +2.811788708455430e-01   +2.219467075062960e-01   -7.511454065507991e-02   -2.157865617588610e-01   -1.588820153713775e-01   -7.411510304902350e-02   +1.913066318025982e-01   +1.350007276818062e-01; -1.548889804085447e-02   +1.584663512098198e-01   -9.133151156070142e-02   +2.930211973177385e-01   +1.787436499383488e-01   +2.985715063005865e-02   +2.271599901873109e-01   +1.084477656874932e-01   -2.980605021858119e-01   +1.874234333623303e-01   -1.834041796124536e-01   +1.962294021239717e-01; +2.512600868406225e-02   -6.920036174263053e-02   +1.732033530398530e-02   -3.017945150535160e-01   -6.326313200017006e-02   -1.138598485847480e-02   +5.137780992517017e-02   -9.961643536087153e-02   -3.588444137785533e-01   -6.399226035160122e-02   +1.395171930454407e-01   -1.731281609254266e-01];
L2E_Input1_iAMPA_netcon = [-3.174166905333261e-01   -2.676789750292125e-01   -4.145068219285122e-01   -2.913532051454932e-01   +1.484946486252777e-01   -7.513600843980542e-02   -1.030183430294927e-01   +1.869704429284720e-01];
L2I_Input2_iAMPA_netcon = [+5.476533385178835e-02   -6.461307331894008e-02   +1.268421108799930e-01   +3.915032292882990e-02   +2.561197949208857e-01   -2.414026823820199e-02   +1.152614978119239e-01   -2.086574205407500e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.03*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.15*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.15*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.03*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.15*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.15*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
