function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+1.417233524031942e-01   +1.161009924125041e-02   +6.245738089353208e-01   +1.083153314253717e-01   -2.138578929809671e-01   -1.218545979305811e-01   -1.553774507333812e-01   +1.672713432116814e-01   +2.324256803751151e-01   -5.108002847968925e-01   +4.180612834662835e-02   -2.553512395648221e-01   +4.385842122931591e-01   +5.346042505526441e-02   -2.128842229617105e-01   +1.443746638433599e-01; +3.627399197348853e-01   -9.849945652938052e-02   -4.411841747632569e-02   -1.188958420684144e-02   -2.899562519028143e-01   +1.735942112937782e-01   +5.718327927496655e-01   -1.818864112511552e-01   -5.238622537221211e-02   -1.095513711943305e-01   +3.148925615601868e-01   -1.533345125636258e-01   -4.768134236419179e-01   +4.753330193143110e-02   +3.770431571268904e-01   +1.439642123204142e-01; -1.237423551462085e-01   -5.117668847673307e-01   +1.669139983062895e-03   +1.444741384622376e-01   -1.582619022087179e-01   -2.086625316142722e-01   +4.384686591880181e-01   +2.525346738852302e-01   +1.191222982160095e-01   -9.946661126452125e-02   -3.436355094657239e-01   -1.073444918585068e-01   +4.671974296855894e-01   -1.045130654912472e-01   -1.749422177620243e-01   +3.046186460786391e-01; +2.693830448716032e-01   +4.606931405859287e-02   +3.204954156534598e-01   -1.855233925393713e-01   -2.412103675667704e-01   -3.383765968119257e-02   -2.251665483557408e-01   +3.306778894015742e-01   -2.585959464276203e-01   -1.100981975798060e-01   +1.657426495429736e-01   -2.360667164736994e-01   -3.944168680792272e-01   +1.185183937500911e-01   -1.147925893065363e-01   +2.362963850516277e-02; -1.382248000984866e-01   -2.972812804713719e-01   -2.480090957306949e-01   +3.109204824994349e-01   +3.215125945236696e-01   -1.553282914921869e-01   -3.714833563299141e-01   +1.601400303535774e-01   +2.154986794111557e-01   +1.357441691557729e-01   +3.737373276203644e-01   +3.060376779486998e-02   +3.313661344313407e-03   -1.528316131429539e-01   +2.165087333213383e-01   -1.568118718558914e-02; -8.191200107294627e-03   -5.387712999793616e-01   +1.005685651383420e-01   +9.523373638819659e-02   -1.473315791962001e-01   +1.087539619409309e-01   +4.875807310112592e-01   +3.998644940807616e-01   +3.231895381646465e-01   +2.001314235773769e-01   +4.443089406448471e-01   -2.089984510963500e-01   -5.280102441591839e-02   -3.615495452044495e-01   +5.137794272317295e-01   +1.073380206000930e-01; -4.000586504477668e-02   +2.467848941893013e-01   +1.570007241811084e-01   -2.138376586375620e-01   -4.680578607827377e-01   +3.941910665019620e-01   +1.216283547791525e-01   -2.579139753332683e-01   +4.441076691964656e-02   +8.251493680971982e-02   -2.149159545396016e-01   -2.160256340209236e-01   -1.470676869174045e-01   +3.529984397703218e-01   -1.100058670275963e-02   +4.020256656633641e-01; -4.515610448655881e-01   -1.098508891801173e-01   -4.602783051920917e-01   +1.465576669128190e-02   +3.012577727266372e-01   +4.318110517352234e-01   -1.104806444553726e-01   +7.485889541938814e-02   +2.657539852581214e-01   -4.590444734319651e-01   +2.235537424797371e-01   +6.346877360350930e-02   -9.555134862472604e-02   +4.292355167378724e-01   -2.753570562404653e-02   +3.288916898575479e-01; -2.406489613914635e-01   -4.830237803920795e-02   +2.291120193562529e-01   +5.056222075727497e-01   +2.333165639677239e-01   +4.392759811087830e-01   -1.866417760318362e-01   +3.833388910211740e-01   -2.296975034476062e-01   +2.636297138531705e-01   -1.189007304084577e-01   -3.523328905368137e-01   +9.070723473628053e-02   +2.180588943473280e-01   +3.874422602225383e-02   +3.699296683332965e-01; -3.594398585025779e-01   +2.507988855426222e-01   -4.675788217627820e-01   -1.425511789883943e-02   +2.880867245482283e-01   +6.054715056634462e-02   +2.806703391910533e-01   -2.476124265799405e-02   -2.185050728147511e-02   -1.424596889792437e-01   +1.224718675503543e-02   +3.389967645230569e-01   +1.910440221309812e-01   -4.141831396277446e-02   -6.438795552081972e-02   -7.680382188677995e-02; +2.888214880044898e-01   +4.999317161099978e-02   +3.498684320387926e-03   -1.069878647180379e-02   +1.111929469795020e-03   -2.872744332091812e-01   -3.277662188796714e-01   -6.730913423088808e-02   -1.515507869807925e-01   +1.639524584797870e-01   -3.388477096552208e-01   -1.533228594822621e-02   +1.867808071491890e-01   +1.095107597193667e-01   +1.156989857774737e-01   +5.191482080826461e-01; -2.343702741969597e-01   +2.517818328784913e-01   +2.682244044947686e-01   -4.771427942054100e-02   -3.399449878479067e-01   +2.280005864860755e-01   +2.314499155068649e-01   -1.875559749979491e-01   -4.443838255636226e-01   +7.707239294114603e-02   -1.897510877014678e-02   +2.132304781575826e-01   +1.842353153126657e-01   +1.096259340062934e-01   -6.830747323910094e-02   +8.326003170640011e-01; +1.229130687867524e-01   -7.837278742697240e-03   +1.722084009617232e-01   +8.600808010706702e-02   -3.177798986295874e-02   +2.985850163632102e-01   +7.622355525594138e-02   -1.335288995193640e-01   -5.888037541152725e-01   +1.494138522144391e-01   +2.061481991306500e-01   -2.777603283909174e-01   -1.630386310254790e-01   -6.230904070615062e-02   +7.038481543308381e-02   +5.734025952166774e-02; -1.102985475679896e-01   +6.534870798452558e-02   +2.090673787065367e-01   +2.943208778695707e-01   +3.745437536256769e-01   -5.142389709813906e-01   +2.338262916266508e-01   +2.022187093616314e-02   +1.053642563451756e-01   +6.273139599524525e-01   -2.150301697135314e-01   -5.472171793638438e-03   +1.994119486035648e-01   -2.369889192762793e-01   +1.900074644760673e-01   -2.672215968982419e-01; +3.380835531481214e-02   -1.374862681263351e-01   -7.325661029281026e-02   +7.477927998935410e-02   +2.369711047950776e-02   +4.024925648833109e-01   -1.511378255172853e-01   +6.925174439074244e-01   +1.924286081126351e-01   -3.112940118847438e-01   +2.835686660387584e-01   -2.097898963617608e-01   +1.751773152054255e-01   +4.896290492398921e-02   -9.258895448873092e-02   -6.420949551933443e-02; -4.042806012243544e-01   +7.151536904218830e-02   +2.240918547361478e-02   +1.336418938617039e-01   -2.139261319118669e-01   -1.375305812886848e-01   +2.489172893485545e-01   -1.269939904077572e-01   +2.129124177728597e-02   +2.035946625334132e-01   -1.242853492903476e-01   +9.811182594213830e-02   -2.186723827050631e-01   -1.987536952916838e-01   +2.131595355866613e-01   +3.167793585516254e-01];
L1E_L1I_iGABA_netcon = [+2.781473253028695e-01   +3.160858900085778e-01   +6.046501553165136e-01   +1.902860366738824e-01   +3.044017492788559e-02   +3.326405940527682e-02   +1.504155503696945e-01   -1.276471198707747e-01   -1.743512914648936e-01   -3.031983686325104e-01   -4.489442550447381e-01   +3.328694195563557e-01   -3.103712585242708e-01   +4.120940286696581e-02   +7.139140952746591e-01   +2.525953169016771e-01; +2.108233280361330e-01   +5.210505857908166e-01   -9.323766269290683e-02   -1.756958816892416e-01   -1.450553518293510e-01   +6.996977691147085e-04   -1.330292179442683e-01   -4.524653807824288e-01   +2.360358175460370e-01   -1.420267226929322e-01   +1.275225637570032e-01   +1.859582755436686e-01   -3.555308323414963e-01   -2.211451862370370e-01   -4.739594292585159e-01   -2.809087082790300e-01; +5.093207644433398e-01   -8.871955140824844e-02   -1.335409083284000e-04   -1.198059190635447e-01   +3.223389894375617e-01   -2.739115004887451e-01   +6.218242379604351e-02   -6.427144591206249e-02   -8.352731028963109e-02   -3.369107829301893e-01   +8.152646202939327e-02   -3.701060390607536e-01   +3.137516652215224e-01   +4.147496624922256e-02   +2.970740291237469e-01   +4.809705113615406e-02; +2.869069430257412e-01   -1.556870253968762e-02   -2.704897322576680e-02   -1.570028853136638e-01   -4.318903198221860e-02   -1.368379405859159e-01   -5.350141196361686e-01   +2.484545938101207e-01   -3.390866084465260e-02   -1.049763526982919e-01   +1.791788816261798e-01   +5.222599285514391e-01   -1.188682133066497e-01   +1.553789915353165e-01   -9.545849243734611e-03   +2.996217280409314e-01; -5.885680391224298e-01   +2.491078394265318e-02   -7.290800428237795e-02   +6.920096370830180e-02   -1.030815162323831e-02   +4.501075013455164e-01   -2.895760255787688e-01   +2.897443101630858e-01   +1.187628231929437e-01   -2.752986480536841e-01   -1.646381759844695e-01   -7.297159183179774e-03   +4.101258866019447e-01   +2.438334120332927e-01   -2.965341443839950e-01   +6.260458388123024e-01; -1.099822875603532e-01   +9.001902595947611e-02   +3.455605369028225e-04   -1.284632334709349e-01   +2.017737704718952e-01   -5.102615121852212e-02   -9.206565715979499e-02   -3.417644538127533e-01   -1.237528648304623e-02   -1.444298921266089e-01   -2.361549637664026e-02   +8.742861550160656e-02   -4.881727093557447e-01   -2.030850556854852e-01   +1.784436919910166e-01   -3.629268423952723e-01; +4.037441167126875e-01   -3.799628778386008e-01   -1.841356833490162e-01   +2.199683840383725e-01   +1.925519735576276e-01   -3.762171753562388e-01   -2.519336657579862e-01   -4.362095602100090e-01   +9.321754423566711e-02   +1.583053247660604e-01   -5.909632618672771e-01   +2.250280806976941e-01   -2.112029749649911e-01   +2.045490237062164e-01   -2.403811289582176e-01   +1.369667618526698e-01; +4.535508461158606e-01   +1.860194288834973e-01   -1.571788669005692e-01   +9.560244506930216e-02   -5.253113523396806e-01   -2.167082702430123e-01   -8.413369837637208e-02   -1.521619831318964e-01   +7.264232246574972e-01   +2.508220700507225e-01   +6.015628131055425e-02   -2.063295660751287e-01   +2.126184378868697e-01   +7.705443060476794e-02   +1.463936412064492e-01   -2.523889771910112e-01; +2.407795311290595e-01   -3.397741996409188e-01   +2.931222293261334e-01   +6.903724392921720e-01   +5.402843344957683e-02   -1.264393633677975e-02   -2.538471442883222e-01   +4.238144331138359e-01   +4.748873722820809e-01   -1.842885268075410e-01   +1.214626812106369e-01   +3.487476475189035e-01   +4.511801712423599e-01   +2.942583600006584e-01   -1.744768728976132e-02   +3.393861851177448e-01; +5.753960124129687e-02   +1.021964894960293e-01   -3.459900595030602e-01   +2.053671797706504e-01   +2.282241589415029e-01   +3.119986933138757e-01   +9.672609338756891e-02   +6.790213795523847e-02   +1.901340363054838e-01   +3.369613903652500e-01   +9.582543162094893e-02   +6.993726741943573e-01   +1.272770523005049e-01   -3.719324632123340e-01   +3.480214318121531e-01   -6.332062181438943e-01; -1.782919735584097e-01   +1.836255598270645e-01   -2.298304774659426e-01   -3.911931183548303e-01   +7.037358383828473e-01   -4.898293624140599e-01   +6.754250887788555e-01   +5.034695604157189e-01   -1.578159366726495e-01   +5.633144959211179e-01   -3.664436160395020e-01   +3.252740919130733e-01   +3.667357550109518e-02   -1.491189358223942e-01   -6.295880970241002e-03   +1.098155460699313e-01; +5.563075635525260e-02   +8.245021015600110e-03   -4.977580299235698e-01   -1.508441572718131e-01   -9.185288754409876e-02   +8.479034184174926e-02   +1.073369888150049e-01   -1.011520378227865e-01   +3.331687126904939e-01   -3.579315947600421e-01   -5.792816299933846e-01   +1.953049562904661e-01   -1.907209549637541e-02   -4.901850095978220e-02   -2.224443060691396e-01   +6.198310444277828e-01; -3.622191502017735e-02   -2.170919108747547e-01   -3.412160144656839e-01   +1.730858774984860e-02   +5.516335615899988e-01   +1.164816753239801e-01   +5.104262022633788e-02   +4.853633796454019e-01   +1.389487668201112e-01   +3.671439481150349e-01   +3.293692558773009e-01   +4.591303555647501e-01   -4.252671381295925e-02   -4.685413528203876e-01   +2.463650743998406e-01   -3.784171077577427e-01; +6.427116848968216e-01   +1.427879207862254e-02   -1.123963519298570e-01   +9.318880909615235e-02   +4.777161602955377e-02   +1.330901351448470e-01   +2.411545334715076e-03   +1.048724455786153e-01   +6.105716345860859e-02   +4.799145769103662e-01   -1.534865086936032e-01   +5.944793398289100e-03   +1.624034198053591e-01   +2.200273888604530e-01   -2.339127740529825e-01   +7.970309060150949e-02; -9.397761144068205e-02   -4.484624501425569e-01   +8.368013131130951e-02   -3.777483542579746e-01   +2.559454435529002e-01   -4.034136090716065e-02   +1.807181446739446e-01   +4.783158581364592e-02   +3.077123514731779e-01   -5.153141125715149e-02   -5.712094079340757e-02   +1.318843246753484e-01   +2.316062980076017e-01   -1.093809041472610e-02   -1.828834176748697e-01   +3.433389665118222e-01; +6.539378840053403e-02   -1.471348494696991e-01   -8.124217267957738e-02   +1.726261119471265e-01   -9.119330499503840e-02   -3.027758664296438e-01   -2.614400952645170e-01   +4.139904349939452e-01   +2.396154025431264e-01   -2.990996571066007e-01   -4.002825468090165e-02   +2.893881307576948e-01   +2.195182295708573e-02   -4.037630874748448e-01   -2.741724382718235e-01   -3.695470684180348e-01];
L2I_L1I_iGABA_netcon = [+2.965845918079424e-01   +5.338135936768814e-01   +1.231583560104098e-01   +1.053908911033142e-01   -2.713964138476093e-01   +9.630479449204227e-02   +4.343896587381035e-01   +5.583383780153837e-01; -2.074082193368426e-01   -1.234466769467151e-01   -3.221319350096690e-01   -1.556743412557359e-01   +4.433256655516182e-01   +1.149408732608298e-01   -2.566089098918258e-01   +1.508336265179331e-01; +1.330413113187910e-01   +2.641395420302362e-01   -2.221073944863177e-01   +3.297004263074068e-01   +3.537704953760440e-01   +1.035344689772095e-01   +3.517879056110756e-02   +4.559417953968460e-01; -2.670771319744645e-01   +5.782885975855712e-02   +1.944265191780008e-01   +1.714335903499867e-01   +4.344164885303892e-01   +5.524325995510820e-02   +3.792208907522335e-02   +1.343316915904932e-01; -2.635428032728575e-01   +3.230654911420525e-01   +2.953059453096515e-02   +2.528967566807708e-01   -1.127168627685596e-01   +5.363579788499393e-01   -5.257304813573956e-03   +3.161585000397377e-01; +1.776387244986996e-01   -4.088589474675597e-02   -2.610124384297900e-01   -1.682426573215068e-01   +3.356845364770972e-01   -3.098222640075812e-01   +5.601837489190343e-01   -7.817281107671058e-02; +8.714355708650658e-02   -1.729140293701242e-02   -7.502047678781526e-02   +9.678598621786605e-02   +3.633220396454190e-01   +3.092968331775328e-01   +2.273888686851213e-01   +6.288780971903150e-01; +1.029289385097588e-01   -2.913126404321079e-01   +3.277265040305541e-01   +4.438474127291584e-01   -3.070328682427201e-02   -3.309385872757289e-02   -5.629800088217640e-02   +2.624954074610844e-02; -2.249179522370071e-01   +1.967964747944678e-01   -1.063884267601184e-01   +3.844448909155410e-02   +3.309162835633563e-02   -2.543987959426672e-01   -6.473923040402991e-01   -1.107961035347795e-01; +9.604183210462233e-02   +1.286688927541416e-01   +3.212790474823251e-01   -6.487242910921375e-01   +8.431120090775338e-02   +3.314163989217850e-02   +3.314599490886086e-02   +9.847750518079006e-02; +1.737740953907187e-01   +6.854361321846961e-02   +2.862391011274721e-01   -9.722156999307349e-02   -5.477911785233233e-01   -5.649259829572659e-01   -1.418908545353317e-01   +1.534789440605429e-01; +4.072197912329259e-02   -1.232233124535916e-01   -6.595373859681074e-02   -3.429277748740727e-01   +2.533208653465721e-02   -1.530276658414409e-02   -4.361630797251240e-01   -4.108851916530299e-01; +2.111498609748643e-01   -1.806660873229157e-02   +1.838854956109697e-01   +1.673016215405756e-01   -7.840592824535481e-02   +9.102487209276039e-02   +3.642377067380904e-02   -2.917118134820013e-01; -4.281887262418076e-02   +7.254211082175027e-02   +1.459503142351076e-02   +5.303462267941907e-01   +9.386384218929819e-02   +3.727301046426439e-02   -3.416066225712556e-01   -2.757015608525328e-01; +4.073624601670405e-01   +3.000836978609157e-01   +8.005547831700371e-01   -2.085132239458143e-01   +3.845224920757151e-01   -1.769450975462826e-01   +1.516368641535600e-01   -2.888645381173008e-01; -1.159685318769648e-01   +3.152275474992070e-01   +3.361590902172336e-01   +2.402897496610384e-01   -2.077992202001666e-01   +1.774495808687299e-03   +7.957420236204877e-01   -3.350790638705393e-01];
L1I_L2I_iGABA_netcon = [-2.054131738676003e-01   +5.592722399875194e-02   +4.077825648426240e-01   +1.067703676874853e-01   -2.937479800907422e-01   -9.639423065713214e-02   +3.310161487207784e-01   +1.989381702248814e-01   +3.096314442289269e-01   +3.140035104631970e-01   -4.643751865329030e-01   +1.834642285237636e-01   -4.302473400307427e-01   -3.547900069724312e-01   -1.415780673810636e-02   +5.597969010602338e-01; +1.126649993252132e-01   -4.923408944122759e-02   +4.449446010366328e-01   -7.893738690885854e-02   -1.789857302535568e-01   +3.027373385590890e-01   -4.379851990369931e-01   +1.315340475904363e-01   -2.131675663087266e-01   -1.268988491209194e-01   +1.259220975761910e-01   +2.683059548744255e-01   +5.818788681631395e-01   -2.888641374950920e-02   +3.153289327248845e-01   -8.674647596859772e-02; -5.327247233969417e-02   +2.466868546298426e-01   +4.903719020714434e-01   -4.572702092943141e-01   +4.957439192958230e-02   -3.609444251297876e-01   +9.605649190831367e-02   -2.263024566491252e-01   -6.854191100015021e-02   +1.865398510806965e-01   -3.145252613366002e-01   +1.171181653402019e-01   +5.177380329512676e-03   -3.725597434594861e-01   -6.247722019403681e-01   +5.144401063757029e-02; +2.304677810855560e-02   +2.129326408119381e-01   -3.691990341855703e-02   +1.576287960760708e-02   -1.642566817186016e-01   +6.163572035554035e-02   +1.450167174097711e-01   +1.785966124913849e-01   -4.215469930066260e-01   +2.744408953670228e-01   +2.437991881821737e-01   -4.089940431624596e-01   +1.274485354104698e-01   -8.451195433766084e-02   +4.141590523417538e-01   +2.498976244792280e-03; +7.419464462511497e-01   +3.790597857536486e-01   +3.663127080739664e-01   +5.753153172289520e-01   +2.324449403526040e-02   -4.315310637803810e-02   -5.818053194234252e-01   -2.667758584643438e-01   +3.214313425753231e-01   -1.072718012302262e-01   +3.908987137247916e-02   -1.606406017363379e-01   -2.006193155363369e-01   -1.533495390764815e-01   +2.991585175921666e-01   +6.567864700551875e-01; -2.279514770759701e-01   -1.344295416380383e-01   -1.985009230051500e-01   -4.260982175743075e-01   -1.999225470348257e-01   +1.449928113892065e-01   -4.762624501476072e-01   +3.577948035350472e-01   -4.642480022902816e-02   -1.125970860546607e-02   -1.064135902661355e-01   +2.383890276782420e-01   +1.829222790683344e-01   +3.650849276897520e-01   -5.341811222760633e-02   +7.197874030451544e-02; -2.976149616525703e-03   +1.989819970609378e-01   +1.618435806467115e-01   -7.030553826733299e-02   +3.268521776592139e-01   +3.491566295473441e-02   +8.976662882622233e-02   -3.471241615996677e-01   +4.951901364313049e-01   -4.438472260517687e-02   +5.356582578953951e-01   +9.232504937221614e-02   +2.968885453286133e-01   +2.058801879131968e-01   +2.674025840264421e-02   -1.006542239851319e-01; -9.536369455652027e-02   -1.048784403643465e-01   -4.684599763571683e-01   +6.603012131023553e-02   +3.254252397837422e-03   -4.113544959703283e-02   +1.505105363222026e-01   -5.021911662995078e-01   +2.001618831810526e-01   +2.781895956484680e-01   +3.083566959218249e-01   +1.283142459907512e-01   +9.113313879444870e-02   +1.084317105105511e-01   -2.067373641347513e-01   -2.666374628509230e-02];
L2E_L1E_iAMPA_netcon = [+1.909640687257325e-01   -4.887515418864903e-01   +9.904924439556355e-02   -4.153896002808911e-01   -2.566289453917295e-01   -1.387226028141760e-01   -3.867886411820903e-01   +2.357327256582148e-01; +2.527826712787120e-01   -1.032918480577614e-01   -5.599021899864339e-01   -4.511446409088218e-01   +3.344355860536778e-01   +1.117152387031149e-02   -1.416076742817614e-01   -3.411233599091501e-01; +1.502436230035379e-01   +3.874132967201078e-01   +5.014630776528589e-02   -1.333064167744369e-02   +3.409680605180246e-01   +4.800875412568193e-02   -3.617122141328261e-01   +1.132809399770955e-01; +2.116163289502792e-01   +1.234972932021727e-01   +5.779839313728812e-01   +6.144614599778775e-02   +4.466059420063023e-01   -2.403236092616571e-01   -1.000937771867010e-01   -3.375020890061557e-01; +3.533507493117495e-01   +6.412845785989517e-01   +2.897443189234479e-01   -2.924480020863920e-01   -2.021483980190588e-01   +2.627476441975901e-01   +1.841893137925533e-01   +4.223117474773053e-01; +5.169996781875073e-01   +2.899887339589833e-01   +2.547225855469241e-01   -2.404078503465332e-01   +3.276903898771747e-01   +3.350627396445371e-02   +1.868716394189678e-01   +5.328350074695886e-01; -1.391329408645271e-01   +5.690030009219596e-02   +2.101033410424633e-01   -3.060651267496698e-01   +1.296266208966690e-01   -6.290013844562946e-01   +3.407811016138373e-01   -5.610406594171184e-01; -1.215963589229380e-02   -1.275352605340538e-01   +8.237432438615083e-02   +1.781699548307757e-01   +2.955893320409879e-01   -5.831079862707875e-02   +3.992145266624603e-01   -9.210626717388508e-02; -3.380983053423210e-01   +1.717977333495713e-01   -1.108921429120930e-01   -2.353674407696338e-01   +2.615347752584941e-01   -1.496028325665843e-01   -1.073496818013725e-01   +4.206506553316524e-01; +4.196511345977776e-01   -4.746102195272597e-02   -2.432926498522259e-01   +4.401826201361182e-01   -1.357060926990306e-01   -1.507568649968210e-01   +3.883091852834193e-01   +1.067332205995264e-01; +2.809907354739151e-01   +8.420122751969931e-02   +6.884993323598007e-02   -3.691567537579722e-01   -4.420574670628546e-01   +3.345219336150212e-02   +6.568273792414404e-02   -1.966590932464510e-01; +1.023329450138256e-01   +1.058472950879460e-02   +1.336926197525254e-01   +5.603710677147741e-01   +2.989860478109729e-01   +3.702922578114454e-01   +2.470992716796076e-01   -3.512743954514301e-01; +1.720011245039945e-01   +5.998895035165995e-01   +4.839127196375686e-01   +4.454574437025000e-01   +2.829071867523150e-01   -9.127633743075855e-02   +3.060911308299429e-03   -2.029991319645266e-01; -8.600849574587441e-02   -1.371657880287810e-02   -1.750465898127744e-01   +4.476795344623258e-02   -2.805903059588744e-01   -2.224247200279439e-01   +4.319132542699023e-01   -2.720116799955472e-02; -5.898414496381011e-01   +2.010351132214309e-01   -2.485070831279619e-01   -1.677499561824867e-01   +1.774410751113200e-01   -1.407077725894273e-01   -1.992428499487580e-01   -1.825954265441812e-01; -1.703543812386828e-01   -1.293151685007514e-01   -6.835680062519232e-02   -2.570480784847089e-02   -2.294544908426001e-01   -1.206176114521861e-01   +9.961979520700144e-02   +2.340144209151868e-01];
L1E_L2E_iAMPA_netcon = [+3.716437078934805e-01   -2.117210229578267e-02   +1.237076132679173e-01   -2.892507958786952e-01   -1.366268959345479e-02   +1.678365989273286e-01   +1.161241175992043e-01   -2.898429727125825e-01   -2.074011601864964e-01   -1.206112485373840e-01   +3.974702374768015e-02   +1.054581195754754e-01   +2.382782262521686e-01   +6.263993260859289e-02   +2.085877709510114e-02   -2.344719696351782e-01; -8.246171351822623e-03   +5.734972253233068e-01   -1.873564496853850e-01   +1.873123185363290e-01   +2.141708903173348e-01   -3.209515140042883e-03   +1.727681505479761e-01   -4.787100207549466e-02   +2.438471581767244e-01   -9.880249603068575e-02   +2.643625557601214e-01   +8.250613589774847e-01   +1.099923727731167e-01   -3.120305678282576e-01   +3.275456767934197e-01   -6.786477991534699e-02; +3.951866091168546e-02   +2.059403389413505e-01   +2.534165428236732e-01   -2.617839844787928e-02   +2.964614419054179e-02   -3.492966356777605e-01   -5.920192397387396e-02   +5.158410484903164e-02   +1.543932414898596e-01   -1.517422889080629e-01   -5.528150514931507e-01   +1.310747087161262e-01   -2.074236908287713e-01   -4.102098521689114e-01   -2.517781244554064e-01   -2.601543751902068e-01; -3.378047200360909e-02   +5.012151465943494e-01   +2.887074578302447e-01   +1.690724322093151e-01   +1.000151427973688e-01   +8.801876642645304e-02   +2.943071374179583e-01   -2.154563249050873e-01   +1.265476102723276e-01   +1.366174820445119e-01   -3.947118525844662e-02   -2.192127790148869e-01   +2.941422628532020e-02   +5.559868792722275e-01   -2.544770171425544e-01   -5.977979251198046e-01; -1.744973012252781e-01   -2.700283186079204e-01   +8.360928797077354e-02   +2.911281618369453e-01   -8.494534847805008e-02   -1.214465873690826e-01   +1.076363250169627e-01   -1.942812716060689e-01   +1.004612715178546e-02   +2.527952773037552e-01   +4.220631280651227e-01   +1.005399108066439e-01   +1.239290914060229e-02   -4.044624253989905e-01   +2.410313270521655e-02   +2.879437021432310e-01; +4.732373574813591e-01   -2.734992372847049e-01   +1.014475719207190e-01   +2.409955248849347e-01   +5.013882990550871e-01   -2.738018469358547e-01   -8.133616314690433e-02   +2.108619752972381e-01   +1.784525146924967e-01   -1.000707639088124e-01   -5.329077717668137e-01   +2.383451184464444e-02   +1.097948667462416e-01   +1.324186072761347e-01   +5.827863693161884e-01   +2.236513332468625e-01; -1.347516456725408e-01   +1.147604464459987e-01   -4.667070599321201e-01   +1.149867300179149e-01   -4.764684970101890e-02   -2.242695561951258e-01   +1.159283296842334e-01   -7.705847952926267e-02   +2.586587987829531e-01   -2.938547062309685e-01   -2.397382487908874e-01   +3.197568546707942e-01   +6.338383606723416e-02   +3.099526744961535e-01   -2.542578950277579e-01   -3.350079910702576e-01; -8.582558933505692e-02   +2.971866062341834e-01   +2.167152820607112e-01   +2.170263731800600e-02   +1.958079944106795e-01   +7.487809735820458e-02   +4.243513001525950e-02   -1.229124238231846e-01   -1.271778175860418e-01   +6.064721929440449e-01   +1.326425295367536e-01   -2.285042184618744e-01   -1.911328923969809e-01   -4.997322510082258e-01   +1.328721831350555e-01   -1.738711230414930e-01];
L2I_L2E_iAMPA_netcon = [+1.328030737212237e-01   -3.312391577077048e-01   +2.065357825306058e-01   -1.190602125898236e-01   -2.126486355910920e-01   -2.778664465451686e-02   -1.613264857811051e-01   -6.563061879677504e-02; -2.804862249611219e-01   +2.968992686105083e-01   +3.345212314157716e-01   -1.603854351369511e-01   -1.934758068053009e-01   +7.114602728443528e-02   +1.287303029082364e-01   +9.727858456656563e-02; -4.445117128162471e-01   -2.021425096212472e-01   +1.942104724430556e-01   +1.266023079747211e-02   -6.323342473999574e-02   +2.549948977966277e-01   -1.296005096928739e-01   +4.294484935435636e-01; +1.828077041935428e-01   +1.330860795438369e-01   +1.146166221844125e-01   +4.426563392756807e-01   +4.157694259617627e-02   +6.165926982384154e-02   -1.136211104770874e-01   -2.153536949538876e-01; -5.102687345152862e-01   +3.994458373722232e-01   -7.529908328214969e-01   -3.953355470578039e-02   +4.166006626442048e-01   -8.622176207537932e-02   -2.628049364871082e-02   +2.178265068070916e-01; -4.056399856217044e-01   +4.788013354720069e-02   -7.863688202586605e-02   -2.262942474135639e-01   +4.609005602144789e-02   +4.370267112150374e-01   -7.884573838823988e-03   +2.109698032103477e-01; -2.673903858716871e-01   +4.021658842549548e-01   +1.009862416122491e-01   +8.460464136889585e-02   -1.690342957798818e-02   -2.234634063566932e-01   -1.215174586385893e-01   +4.613000775752560e-01; +2.231145863028694e-03   +6.631452803864354e-02   +3.247490517085112e-01   +4.984796728504062e-02   -6.422805717355631e-02   +5.251380797488757e-01   -4.673161072428600e-01   -3.586706007382330e-01];
L2E_L2I_iGABA_netcon = [-1.930702882246046e-01   -1.448287965485454e-01   +1.109461962096171e-01   -1.047255265115021e-01   -1.863300778023811e-01   +4.174197085086702e-01   -8.739517211258123e-02   -8.472407515471111e-03; +4.084449974441485e-01   +9.142587718050398e-02   -1.399054916284756e-02   +3.891965427913074e-01   -4.558303196066709e-01   -8.980597662987561e-03   +1.218291417714425e-01   +3.349872900187530e-01; +7.392044530051577e-01   -3.397929474560327e-01   +1.775913913690553e-01   +2.481158184124830e-01   -2.028666805928318e-01   +1.347165482380516e-01   +7.945693488909611e-02   -6.066289650904222e-04; -3.303779749805472e-01   +9.091964480161316e-02   +2.828647193206572e-01   -7.105043519003068e-02   +3.814557137105837e-02   +2.390408003307841e-01   -2.820652964316813e-01   -1.066600641694127e-01; +1.589177767354273e-01   +1.732776054507938e-01   -4.917665412636544e-01   -4.110021395546020e-01   +2.288429060707745e-01   +1.132195898802306e-01   -1.955247044252854e-01   +2.955830683546612e-01; -1.107330780420701e-01   -7.177330338207619e-02   +1.827163420637500e-02   -1.267509514871362e-01   +1.274631263744507e-01   -2.530205544046576e-02   +3.074331492625929e-01   +1.379829637224853e-02; +2.542732446817400e-01   -3.177519048493621e-01   -9.887332177299207e-02   +2.435950785592203e-02   +6.430191249521251e-01   -2.859846648304480e-01   -2.347348075700967e-02   -1.317526663195930e-01; +2.026302894641643e-01   +4.480825041776883e-01   +1.755914162365547e-01   +3.495012416303175e-02   +8.596452876232194e-02   -1.183033398397072e-01   +6.040379267387198e-02   +2.159915911673330e-01];
L3E_L2E_iAMPA_netcon = [-1.499164417146049e-01   -5.202882448978315e-02   -1.211883524042193e-01   +1.711315074291136e-01   +3.359056562262280e-01   +5.513924331244517e-01   +2.140045258384918e-02   +2.007419808512607e-01   +4.006381661113811e-01   +4.523258326579214e-01   +6.059126144088353e-02   +3.506900655577706e-01; -1.249596240971668e-01   -2.241766349376872e-01   +3.204025008451185e-01   +3.519263323774813e-01   +7.692660418497439e-02   -5.564192384777686e-02   +2.123363778138937e-01   +3.560831311786528e-02   +3.939090568082391e-01   -3.873448432259693e-02   +1.816463767763143e-01   -3.693537991909981e-02; +3.954745998661536e-01   -2.974477156843186e-02   +8.044345005164211e-02   -1.401852089142231e-01   +4.969873616463095e-01   -2.371723705768035e-01   -1.785899928219663e-01   +3.154031991851871e-01   -3.596007420828748e-01   +1.396181403385619e-01   +4.196480367213692e-01   -1.356216472512062e-01; -3.821696306693393e-01   +3.224077088879563e-01   +6.919486792417900e-02   -2.434249554153436e-02   +3.506632508069496e-01   -2.750440415628309e-01   -7.705740758825584e-02   -1.856653796879974e-01   +3.809734552956087e-01   -3.426323214078822e-01   +1.152342479501325e-01   -2.942110772343361e-01; -7.648374227811695e-02   +2.317849247282336e-01   -6.769398268321489e-02   -2.018014481370037e-01   -3.414597639833147e-01   +3.311341525837344e-01   +7.172484465418544e-03   -1.242128598569013e-01   +3.961984242743423e-01   +5.824104708524724e-02   +2.007799203450438e-01   +9.890289947958965e-02; -5.788171715073257e-02   +2.519008344405594e-01   +1.989528911061302e-01   +2.748891140249739e-02   -5.143727150396528e-01   -8.699765040359492e-02   +1.810688351767382e-01   -1.338623912832324e-01   +5.317895485079807e-01   +3.018188728040557e-01   -2.888145578861799e-01   +2.425080619511997e-01; +7.262385260888363e-02   -3.022875836912914e-01   +5.458313599176298e-03   +1.229639925907166e-01   -2.387001295976435e-01   -4.014643386933184e-01   -4.399872823070223e-01   -1.918216472044181e-01   +1.247828295068138e-01   -3.933406142280044e-01   -1.523810890995435e-02   +8.807264067054385e-03; -4.179029341798063e-02   +3.290007763659262e-01   +1.481904037699054e-01   +5.955619533226608e-02   +3.556858772813766e-01   -1.426572750738593e-01   -2.749847687694859e-01   +4.553654618365053e-01   -1.712715882221829e-01   +2.057300009657022e-01   -2.327419434087444e-01   -1.143093355122231e-01];
L3I_L2I_iGABA_netcon = [+3.396921935087663e-01   +2.915366369629087e-01   -5.651930682780657e-01   -5.983240071924273e-03   -3.787213628097273e-01   +2.644619810415467e-01   -2.677640472801665e-01   -1.142971183459324e-01   +3.012150094683471e-01   +1.784967085789653e-01   +2.876188949825588e-01   +1.001892848354735e-01; -4.020798002160500e-03   -3.849756425018611e-01   -3.351347372756643e-01   +1.531163670367971e-01   +1.123841906109936e-01   +3.573396416746943e-01   -1.723173916049862e-01   +1.117299922711102e-01   -1.783264314663538e-01   -4.945071868015962e-01   -3.196605527414313e-01   +3.892838671773116e-01; +1.422963852430766e-01   +3.213228709501345e-03   +3.592662907439259e-03   +5.205261276770771e-01   +2.254952672595560e-01   -2.177252915415913e-01   -6.593800966897796e-02   -5.258144109544552e-02   -2.694810834373312e-02   -2.192102320266366e-01   +5.367519829841472e-01   +4.003999401571920e-01; -9.348507852289117e-02   +1.540529227884304e-01   -9.548771028753800e-02   -1.140939954734982e-01   -1.602168466177530e-01   +3.680273152149724e-02   +3.860585599811767e-02   -4.147927895222901e-01   -1.732624286238824e-01   -6.351019848345183e-01   +5.424112260974860e-01   +3.467347904659894e-01; +2.729235237565766e-01   +1.498947290931251e-01   +1.352301999001187e-01   -1.744810379283834e-01   +3.954696184189960e-01   +8.099743826198427e-02   -1.834179791924291e-01   +1.567063637209898e-02   +5.044742323719025e-01   +4.607039627812824e-02   +1.674000987015453e-01   +7.357626469552220e-01; +3.172423326871834e-02   -3.641969601398087e-01   +4.190817505121910e-02   -2.552767119922195e-03   +8.268198244541616e-02   -2.727007890440865e-01   +2.779978661275612e-01   -4.222705692234131e-01   +3.477883107416068e-01   +6.010469016311679e-02   -4.349541088558925e-02   -2.625520097034234e-02; +6.356342481707011e-01   +3.160839845877354e-01   -2.533287469479598e-01   -1.009933039810421e-02   -3.471466795570773e-01   +1.262750886186108e-01   +2.223557484796935e-01   -1.248496338119183e-01   +4.622245867706821e-01   +1.510777669821539e-01   +6.626546649366373e-02   -1.062927612370608e-01; +9.468912324974084e-02   -2.152468067782674e-01   +4.019031564302680e-02   +1.202577167289984e-01   -2.837723071946623e-01   +1.697872628600965e-01   -9.855982886445165e-02   -2.757963589495327e-01   +1.933639791551768e-01   -3.760016207166601e-02   -4.793998756672208e-01   +5.120101785626052e-03];
L2E_L3E_iAMPA_netcon = [+2.470937771989846e-01   +1.034901072449036e-01   -1.679281698329510e-02   -3.220996930329899e-01   -2.580118785489533e-01   +3.345916602325435e-01   +2.220759476487044e-01   +3.451386864489951e-01; +1.024910744131087e-01   +1.793132059938838e-01   +2.422674562029560e-01   +4.671678524590159e-01   +6.354017710592724e-02   +2.429175458625985e-01   -2.880709884886524e-01   -4.265353669340116e-01; -2.617548345076495e-01   +4.659486837247160e-01   +2.903061347420180e-01   -3.298194880625119e-01   -4.726309217405465e-01   +9.497514493485862e-02   +1.056409840264733e-01   +1.409270555190789e-01; +2.168303307710540e-01   +9.145999969488450e-04   -3.886914403038930e-01   +2.040383710169815e-01   +7.418403613567366e-02   +4.909541851043645e-01   -1.178220535117269e-01   +2.609832680897849e-01; +3.428665509271485e-01   -1.772181685705143e-03   +7.054391820708299e-02   +3.970634788515425e-01   +5.138249456637998e-01   -2.727014758057521e-02   +2.204105191124787e-01   -3.738582854715889e-01; -2.017106514539014e-01   -9.503090513674614e-02   +2.492215298907088e-01   -6.516879431100427e-02   -4.314898013405175e-01   +2.079140734736508e-01   -1.764431349183257e-01   -1.763174777219513e-01; -2.258855421570635e-01   +3.413873544587163e-01   +1.860360631498753e-01   -1.349734040645020e-01   +2.936685527495807e-02   +4.203458742440831e-01   -3.549144484904408e-02   +1.190142826289859e-01; +4.867308503019475e-01   -2.015354986946872e-01   +4.233419093944116e-01   +3.431870332079110e-01   +1.209460254821854e-01   +1.872983655651795e-01   +2.000624972037469e-01   -1.952569986000789e-01; +4.842735051731464e-01   +6.887341330014886e-02   -3.663084955671900e-01   -1.138564979528789e-01   -2.978812486893695e-01   -9.679687571735086e-02   -1.737809448904661e-01   +1.073840376531961e-01; -1.655623577640465e-01   +8.401119813412976e-02   -3.480787241268621e-02   -5.338722124686845e-02   -5.071273433421813e-01   +1.219608469237457e-02   -7.251952143777254e-02   -1.810990749899988e-01; +2.941103173778645e-01   -4.423411491038885e-01   -1.647855895294918e-01   +1.166725837858480e-01   +4.476582113072805e-02   +1.764150301609330e-01   +5.630082335635122e-01   +5.640492434422110e-01; -1.983398364647402e-01   +4.588490540445681e-01   +2.402036679824203e-01   -4.510812211303510e-01   +2.430261068897717e-01   +1.336070117364751e-01   -3.337390959079982e-01   +3.466734279487690e-01];
L2I_L3I_iGABA_netcon = [+4.096438921558784e-01   +2.346180301622958e-02   +2.335668480515057e-01   -3.614830032013654e-01   -2.560317042113330e-01   +1.945763490113748e-01   +2.527783543639222e-01   +4.236797080680154e-02; -3.569420242970862e-01   +1.406144904645704e-01   -2.277961129816512e-01   +1.783014130848103e-01   -1.251130934358691e-01   +3.430923187954922e-01   -3.161104831189481e-01   +1.806076290245447e-01; -3.815185391659001e-01   -5.427993950321469e-02   +2.666918090775241e-01   -3.179763372879630e-01   -4.559464716406950e-02   -7.100973542937106e-02   -1.720910747851875e-01   +2.590628938088309e-01; -2.313836681396026e-01   -1.857882978253974e-01   -1.188201688667120e-02   +1.455920690623406e-02   +1.919120088407462e-01   -2.081004270628173e-02   +4.511715449168632e-02   -4.118626914827009e-01; +3.343753191016864e-01   +4.204102096938298e-01   -7.664991958846934e-02   -1.103668119041512e-02   +3.090679019777501e-01   -2.312496422684687e-02   -6.932979759428393e-02   -3.084244755289080e-01; -1.637954056200031e-01   +5.311377508048084e-01   -1.822983792039180e-01   -3.264837773454546e-01   -2.417295685193320e-01   +1.552480225313584e-01   +2.310980483557104e-01   +1.065993414001028e-01; -1.871854181876323e-01   +9.526577520163529e-02   -4.209114936425655e-01   +9.426417051416884e-02   +2.056824487175067e-01   +1.906757139181875e-01   +6.002557120581803e-02   +1.970267311929979e-01; +3.414066458465215e-01   +1.884799132679017e-01   +9.426692131288437e-02   -3.333187599804802e-01   +1.029723843436776e-01   +4.327680255860848e-01   -5.867146616734279e-02   -3.385812110641852e-01; -4.344980378786532e-02   +1.177676723878650e-01   +3.704370918486050e-02   -3.198195942268866e-02   -1.359990575363036e-01   +4.162503336719333e-01   -1.051188273943512e-01   +7.109158720614538e-01; -2.866786619301375e-01   -1.927609441661893e-01   -1.765044033520050e-01   +5.925657955889001e-01   -1.756054435105403e-03   +4.227314337332884e-01   -2.435569586377592e-01   +1.919192667745325e-01; +3.156881700790042e-01   +1.234682109204480e-03   +1.602215034958695e-01   -1.554551836049627e-01   -5.626602742085099e-01   +1.056453074764228e-01   +3.574525182309702e-01   +4.747511679308663e-01; +2.929435760386975e-01   -4.191308693910574e-02   +7.162084769771235e-02   +1.526185782874299e-01   +2.465290451249645e-01   -8.713351876978209e-02   +1.857548504738343e-01   +2.605989556267020e-01];
L3I_L3E_iAMPA_netcon = [-1.799696011131260e-01   +1.468691258041617e-02   -2.819951092333849e-01   -8.699792421357921e-02   -8.029968880491692e-02   +6.764201446345042e-02   -3.486503520081854e-01   +2.448338900421841e-01   +1.119582721879112e-01   +1.424021397498370e-01   +2.320346455550296e-01   +1.424265785165388e-01; -2.979043663933225e-01   +4.582460435199735e-02   +4.737944969007536e-01   +7.421520844056265e-02   +2.533464104848487e-01   +4.038532712439546e-01   -9.837262464866742e-02   +2.286028547613265e-01   +2.443756457379954e-01   +3.425185626387727e-01   +3.916467062222638e-01   +7.688507925542208e-02; +6.805603493332033e-02   -1.738182354976369e-01   -1.593820316484773e-01   +4.741982170201945e-01   -3.132446285946043e-01   -1.447845426417543e-01   -1.611332242020045e-01   +3.029329181935263e-01   -4.077438679232839e-03   -2.512922517508653e-01   +3.604766902805950e-03   +1.696035486438658e-01; +6.300445001384917e-01   +3.098807545647055e-01   +1.480106303153275e-01   +4.806594349233981e-01   +4.990434007663436e-01   -2.139679653114074e-01   -1.439639838128938e-01   +2.160872384265488e-01   +3.830836218984156e-01   -1.087508804753889e-02   -1.010094190035457e-01   -3.491457933674477e-02; +1.999474603367402e-01   +2.573015751916398e-01   +1.587895634717899e-01   +2.006118089278590e-01   -1.342471462076992e-01   +7.694084388878413e-01   +1.059239283894471e-01   -1.720346241329213e-01   +1.528300434683716e-03   +2.637493257198259e-01   +1.151752214455037e-02   -8.433190273411816e-02; +1.005027997649410e-01   +4.583336632735885e-01   -3.603727389475436e-01   +5.548744791133923e-01   +2.261784951609877e-02   -2.478425317292284e-01   +1.574729720371351e-01   -1.278447128428312e-03   +2.095392828569040e-01   +2.052191117086729e-01   +2.934985664369723e-01   +2.090920461144959e-01; +3.303792557179910e-01   +1.348399116589753e-01   +3.208803816491578e-01   +2.774984676249556e-02   +3.319486111751699e-01   +2.581588291265354e-02   -1.326720136707825e-01   +9.287194805520604e-02   -3.060096720077363e-02   +2.003359745586233e-01   +2.193681279542345e-02   -7.733490570329844e-02; +2.234277278232408e-02   +2.642854751166323e-01   +1.790853635666363e-01   -1.799448052526520e-01   +1.519688433163302e-01   +4.520114063063541e-02   +6.112690900230661e-02   -3.250801144038356e-01   +5.757249869218997e-02   +3.795403536610341e-01   +1.840838877428405e-01   +2.574771623607152e-01; +2.099052381618523e-01   +3.226433787167054e-01   +4.421064200660308e-01   +9.387655161701072e-02   +4.178868417877723e-02   +1.869705285213758e-01   +1.800302828350048e-01   -6.943885929710347e-03   +2.610407764352813e-01   -7.412256748059953e-02   -2.268809102168067e-01   -1.609366992325818e-01; +1.036073361183853e-01   -1.503290016621479e-01   +1.917417926966384e-01   -4.070787037697569e-01   -1.352844530308810e-01   -5.487308394544448e-01   -9.543509448574637e-02   +1.994640829451670e-01   +2.362164218248944e-01   +2.175865201066280e-01   +3.091997210861059e-01   +3.159511666474986e-01; +6.446237699151047e-02   +9.005787890099037e-03   +2.158095094941667e-01   +2.808978399835275e-01   +1.942218370107899e-01   +1.881098760971688e-01   -2.226618234569216e-01   +9.643823046194407e-02   -3.920753532498523e-01   +1.251114782237308e-01   +3.421527898461207e-01   -2.063815953728618e-01; -1.017709056920856e-01   +4.292925168545035e-01   -5.550697438745246e-01   -1.010241515220200e-01   -4.688952630263407e-02   +2.016059943787477e-01   -3.667184203066305e-01   +3.334882972920266e-01   +2.826615095178992e-01   -1.712028330061128e-01   +1.839835459505376e-01   +4.265071811289041e-01];
L3E_L3I_iGABA_netcon = [+4.045879317887214e-01   +5.114113686488393e-01   -1.527711922984422e-01   -1.450620787141427e-01   -7.934027077634037e-02   +5.691725735229386e-02   +3.305751424638136e-01   +1.481926926768222e-01   -3.399691268676825e-01   +3.096086090763583e-01   -3.121405739476353e-01   +1.963533536426263e-01; +3.651340872655306e-01   +2.291789638884496e-01   +4.764829241213202e-02   +2.131779041740738e-01   +3.415895820988489e-01   -4.136327283845307e-01   +2.463183567525611e-01   -1.857665699563454e-01   +5.788190393448469e-01   +2.817170716965881e-01   +5.205996157774904e-01   -1.627949468894660e-01; -8.780750079338923e-02   -8.345904865118690e-02   -5.040337431946623e-02   -3.515020215382099e-01   -7.899436954255767e-03   +2.907710112500625e-01   -9.786804314633801e-02   -1.855483248815886e-01   +2.617578891695604e-01   -1.071131426927039e-01   +1.255489728336719e-01   -2.872013154217668e-01; +2.681912969977871e-01   +1.016261689312004e-01   -1.470770839689708e-01   -3.826413304844832e-01   +4.604202766426811e-01   +3.309286880021604e-01   -2.751378776112381e-01   -1.121125963582205e-01   +1.457066297360652e-01   -2.136792228565536e-01   -1.096291145926976e-01   -4.708789013907581e-02; -8.557581537936375e-02   +8.442569831808758e-02   +5.741930456587901e-02   +7.450820816527322e-02   +9.364783359188555e-03   -1.845001782252268e-01   +2.152594774687419e-01   -8.285955858828539e-02   -9.691339028000047e-02   +2.840325678644277e-01   +1.561342728804933e-01   +2.899966075559010e-01; +5.426901727583777e-01   +1.910407300537957e-01   -2.514371399615348e-01   -2.104719165165389e-01   +2.977854013080191e-01   +1.238366149747754e-01   +1.197308551306208e-01   +4.930823389163552e-02   +2.188426068730629e-01   -9.672388895220989e-02   +3.254580635915501e-01   -3.684162150955540e-01; -1.099668129002257e-02   -4.621668190502681e-01   -3.231783081341033e-01   -1.817310327826767e-01   -1.581043171737831e-02   -6.666208020655418e-02   -2.691957328011536e-01   -2.494606366989551e-01   -4.183286045383896e-01   -5.032909429037197e-02   -1.283285587875044e-01   +2.692560705743219e-02; +4.449878408117184e-01   +1.452627288461625e-01   -2.298693556385925e-02   +1.187131805057966e-01   +2.829497222896101e-01   +3.070724980537974e-01   +3.018401998469148e-01   -1.754766556161713e-01   -5.415116075808143e-01   -7.780014729820200e-02   +1.618087180353881e-01   +3.126867537045296e-01; -2.849708449398826e-01   +4.275576716738920e-01   +1.736733266737880e-02   -4.767512560079121e-02   +2.271126138867110e-01   +1.153565096577162e-01   +1.047613293020555e-01   +2.143498129586282e-01   +1.363088616865693e-02   +1.619136618276988e-01   +2.183694725935783e-01   -3.085116636254510e-02; +2.464382430720395e-01   +2.406169318784941e-01   +5.489144788931584e-01   -3.565136079838187e-02   -1.246657479163403e-01   +5.071136002368680e-02   +4.913382412922997e-01   -3.194849133257084e-01   -1.458616878824639e-01   +7.906877137488327e-02   -1.861977956777409e-01   +3.608099488921708e-01; -1.359012523630659e-01   +1.745187258851489e-01   +2.973220678634048e-01   -7.621288917051078e-03   -4.250257151991252e-01   -1.222972424757263e-01   -3.958085275657261e-02   -2.423320896501800e-01   -3.051216118066593e-01   +4.483007311503656e-02   -2.338001686898294e-01   +3.019722856817176e-01; +1.305896122524005e-01   +8.896184244961396e-02   -2.760438767580828e-01   -4.832221067983877e-01   -1.583426373401468e-01   +2.509277578922146e-01   +3.752788932289667e-01   -3.565262415344850e-01   +1.098010387656827e-01   -2.155542232258215e-01   -1.252123287527614e-01   -3.773357465941829e-02];
L2E_Input1_iAMPA_netcon = [-1.772622738267445e-01   -3.062351394554494e-02   -1.371622283040947e-01   +1.795501170613762e-01   +1.219180074579883e-01   -2.461996323124557e-01   +3.981597193843578e-02   +3.056017793269618e-01];
L2I_Input2_iAMPA_netcon = [-3.915358744314717e-02   -5.912085787705684e-02   -5.951827364670483e-01   +2.660657707594141e-02   -1.072503407601034e-01   -7.196379742660336e-02   +8.802410201773478e-02   +1.283737813249419e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.04*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.5*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.1*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.5*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.1*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.5*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.04*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.5*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.1*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.5*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.1*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.5*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
