function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-1.666214681377733e-01   -1.017983864197139e-01   +1.296190620784028e-01   -3.487134833604151e-02   +3.132675676169674e-01   -1.467659754959736e-01   -2.695462986756921e-01   -1.397058385219475e-02   -9.116886763441698e-02   -2.479924383445182e-01   -5.345349791705482e-02   +2.034509890738327e-03   +4.365073301382912e-01   -3.355564091960684e-01   +1.088225346451726e-01   +4.176933012144862e-01; +1.510891589347394e-01   +1.887010180575618e-01   +2.596505902476005e-01   -1.774785257994565e-01   +1.665578770887458e-01   -5.872236076070490e-02   +7.016538800798673e-02   +3.057713552444253e-01   +4.337427409182817e-03   +5.036988294060996e-01   +3.984880259771936e-01   +1.701569029195156e-01   -2.424367263812102e-02   -3.652587111267873e-01   -3.512605407391088e-01   +2.047323754191480e-01; +4.584707040011637e-01   -4.755910748311767e-03   +4.409413581803091e-01   -4.320726032559180e-02   +6.868413482363279e-01   +1.549319597587493e-01   +1.841063780288592e-01   +1.812424404492984e-01   +8.414898195350320e-02   +1.652841267057519e-01   +2.492941904977977e-01   +1.386332103076809e-01   +1.181386520817520e-01   +3.279026190658790e-01   +5.617279060760368e-01   -1.643727425111572e-01; +3.761823408169216e-01   +1.480137451144155e-01   -6.370443652418172e-02   +3.623805785746250e-01   +2.554692398909729e-01   -2.839655605732637e-02   +3.839694083637069e-01   +7.088935965113544e-02   +4.155145265223240e-01   +5.475863546831734e-01   -7.188675067242739e-02   +1.970980561858460e-01   +2.397976034537081e-01   -3.035223055648797e-02   +3.850169633934564e-01   +1.841067129101325e-01; +2.371881338532832e-02   +1.426064495563475e-01   +2.704873828137354e-01   +1.240192175752491e-01   +2.018556080305066e-01   +2.818645757078986e-01   +1.036600806941486e-01   +2.418634662939428e-01   +5.124112827770994e-01   +3.043368039005732e-01   -1.168363033067576e-02   +4.444284052120485e-02   +1.662077078716257e-01   +4.466160329658383e-01   -2.191074346307598e-01   -4.772561960279538e-03; +3.436607141215683e-02   -1.355368456338632e-02   +2.557729068353239e-01   +5.104360798870868e-01   +2.222358361769777e-02   +1.308333943133670e-01   +3.620881170908398e-01   +3.397955597185826e-01   -1.488255727732568e-01   -2.224101716487609e-01   -2.147257870757149e-02   +2.077490727999324e-01   +1.389359350754667e-01   -4.586912093229131e-03   +2.872441422202332e-01   -1.352936800287219e-02; +1.039964441082264e-01   +1.868769464130449e-01   +2.201179394396948e-01   -7.592725065106060e-02   -1.853056367718929e-01   +2.890412021014861e-01   -2.710718571162552e-02   -1.143692530678295e-01   -2.092798308836851e-01   +1.819573763006445e-01   +5.630140502208643e-02   +8.253266092216412e-02   +3.423282192929579e-01   -1.335119962275237e-01   +1.950845980522438e-01   +6.284742634244922e-02; +2.894163352381007e-02   -3.307458884115750e-01   +4.044368745610665e-01   +9.720134076243660e-02   +3.465749748275069e-02   -2.151568233941924e-02   -2.260779172948374e-01   +4.146851480343577e-01   +1.349225180553155e-01   +1.942339211971300e-01   -2.507619098915704e-01   +2.506748377859267e-01   -5.318744075327277e-03   +2.227471997679778e-01   +1.681194652119428e-01   -2.915454858147729e-01; +2.287535118025336e-01   -5.604206195005380e-02   +1.281421376251334e-01   +2.376632975359348e-01   -2.255610874465519e-01   +8.782989899623952e-02   +3.656422548563812e-01   +8.817742047764392e-02   -1.255543692932910e-01   +3.640441715690481e-01   +2.686365741046483e-01   +8.214380757855283e-02   +1.651749727674816e-02   +3.535354404074197e-01   +6.925347344872740e-02   -1.723265660365474e-01; +5.595460125407417e-01   -1.383726914783240e-01   +1.149160385809719e-01   +6.935029392103591e-02   +1.758795386291108e-01   -5.455373924056768e-02   +4.945071406175186e-02   -1.299374990067422e-01   -2.073498319340775e-01   +3.942282656653701e-02   +2.231530261324384e-01   +2.706568154866553e-01   -2.186946720047538e-02   +6.442233319188452e-03   +1.126234037144994e-01   +1.714248348964272e-01; -2.507017349813865e-01   +3.485374126876509e-01   -2.611223439031990e-01   -2.529762244265579e-01   +3.911992754488654e-01   +1.843222567423176e-01   +3.415063602223615e-01   +9.581361100556547e-02   +4.401834680213459e-01   -1.687250072689155e-02   +3.504691415025963e-01   +1.259633136799732e-01   +3.354042580739596e-01   +1.368749754409538e-01   -4.398653865079651e-03   -1.916637843269277e-01; +7.111626509642960e-02   +2.276296403377757e-01   +1.286802774829196e-01   +2.159571557487255e-01   +6.896068702547073e-02   +3.901006260363831e-01   +3.265939766325830e-01   +4.032072306139500e-02   +8.614100466625621e-02   +2.570588239714041e-02   -1.004346950320933e-01   +1.245930895735834e-01   +3.788436987350370e-01   -1.543695374595181e-01   +3.000184554122221e-01   +2.664075887232398e-01; +2.080721213101604e-01   +4.655923464351100e-01   +1.556909056455353e-01   +2.700679200133256e-01   -3.015303382869490e-01   -1.108988018473994e-01   +1.582546767632072e-01   -7.365857576779360e-02   +2.719792663283101e-01   +2.453260313910259e-02   -3.813381906461362e-01   +3.377121836989174e-01   +3.934134072990914e-01   +2.000803645053679e-01   -1.449015558497896e-02   +1.168101535576975e-01; +3.515742427397095e-01   -3.117732710610240e-02   +3.774878409606354e-01   +1.103070283654633e-01   +1.652821517468790e-01   -3.638636767658017e-02   -1.451385608394494e-01   -1.792802447452039e-02   +5.072229663634868e-02   +7.610225749192631e-02   -2.099289469582052e-01   +4.514393014230242e-01   +2.243848233805675e-01   +3.976885557790373e-01   +6.939951055808714e-02   -2.021773862500697e-01; -9.194589810997703e-03   -1.575571584256606e-04   +2.354898810288801e-01   -6.951730404471272e-03   +1.629760925366884e-01   +4.517579221035743e-01   +2.107558229963306e-01   +2.084932997896814e-01   +1.792648414492983e-01   -1.156457763487102e-02   +4.087288424777943e-02   +1.401234633443951e-01   +5.928344056185110e-01   +1.798850790561677e-01   -1.529584392590901e-01   -2.237982408467762e-01; +1.644188766913316e-01   -3.804718506687620e-02   -1.313594643413016e-01   -2.804990449113941e-01   -6.974224300771453e-02   +1.335173548814614e-01   +3.733581037559699e-01   -2.261577172322569e-01   +5.576301708758867e-01   -2.318760616588261e-02   +1.993193489580774e-01   +5.218865950120366e-02   +1.450886806014708e-01   +3.798282744284696e-01   +9.006505557699623e-02   +3.297372005585615e-01];
L1E_L1I_iGABA_netcon = [+1.710143507533733e-01   +3.137955829460810e-01   +1.538081118369024e-01   +1.662970161698059e-01   -5.998036346991781e-02   -1.060208934784929e-02   -1.167563235611587e-01   +3.071123382945190e-01   +2.774549606996719e-01   -1.221535428997113e-01   +1.974761647374893e-01   -5.888302152263995e-02   +1.856704478458375e-01   +1.589667435972294e-01   +1.009043584887673e-01   +5.269023837417889e-02; +3.045450900984993e-01   +1.750058158399018e-01   +2.111970614830249e-01   +3.346052076425705e-02   -5.944529353952799e-02   +2.806682321209253e-02   +2.154874270501896e-01   +1.894238785161979e-02   +1.897299041904230e-01   +2.580728288732272e-01   +2.560755948827473e-01   +1.327045682222976e-01   -1.472795331200258e-02   +4.079081143140967e-01   +3.408937184568022e-01   +8.388673033568571e-02; +9.288809167527036e-03   +2.784126766146242e-01   +1.021547502099117e-01   +8.442191586159332e-02   +3.492258176033711e-01   +7.951658371835174e-04   +1.304820887641013e-02   +2.411380754461939e-01   -1.289336146239259e-01   +2.495569105709466e-01   -6.360307169665814e-02   +2.420969403728970e-01   -2.247759260844906e-01   -9.828599569093457e-02   +1.005300390961397e-01   +3.316468093179455e-01; +3.526714857490926e-01   +1.923470327971141e-01   +1.428159290653986e-01   -2.903012670321421e-02   +1.608192106169237e-01   +3.596636003577003e-01   -7.532843672545669e-03   +3.252064399640686e-01   -3.458123598186646e-01   +6.109103125530847e-03   -7.562122272171198e-02   +7.498037990226245e-02   +4.674676905843441e-01   -2.119008820642903e-01   +5.530826315177972e-01   -1.048273722401382e-01; +3.458566306590107e-01   -1.504610863325661e-01   +4.859867193571239e-02   +3.138363311512392e-01   +5.468354714524094e-01   +1.118876520642091e-01   +1.863266359539876e-02   +4.076210007230728e-01   -7.977916753640332e-02   +1.869734852290552e-01   -1.985116291062766e-02   +1.416094832206935e-01   -1.473352983384486e-01   +1.409166318683515e-01   +3.254901258213875e-01   +2.560831051798533e-01; +1.289085190123722e-01   +6.434647547416208e-02   +2.923922150151449e-01   +1.351290200302363e-01   +5.225309957486559e-01   +1.724926964343467e-01   +3.074462328038958e-01   +5.884559218392534e-02   +2.595940872072209e-01   +7.699342934812574e-02   +3.249946602728918e-01   +2.310751361184827e-01   -3.970377063507235e-01   +2.712114747835127e-01   +2.031685692213606e-01   -1.846783870224279e-02; +2.523646604909744e-01   +1.216708406004126e-01   +4.459389615480401e-01   +3.622178277792333e-01   +1.668125309918677e-01   +4.620332368505667e-02   +5.142193499483889e-01   +1.903965107386881e-01   +2.481278760251309e-01   -1.008645565499544e-01   +9.814652960463546e-02   +1.557984896882869e-01   +1.737636502817718e-01   +1.536983916292547e-01   -5.140385488391389e-02   +2.953990911842980e-01; +4.304489186443222e-01   +1.966632531374231e-01   +3.613573439451747e-01   +2.296111752810019e-01   -8.658030029217109e-02   +1.688075483987148e-01   -1.984362995319886e-01   -1.335722820191610e-01   -1.442333386250025e-01   +2.713366791733681e-01   -6.667586434539977e-02   +2.016343934490089e-01   +6.120114275179903e-03   +6.171862932463138e-01   +2.715118928051606e-02   +1.786499104928888e-01; +2.944318893820965e-01   +4.590135544754838e-01   -2.708251241096177e-01   -1.176412987712027e-02   +1.190169805825617e-01   -1.656029624281182e-01   -5.162937056245029e-03   -1.341662661338453e-01   -1.656976997628525e-01   +3.511569843902464e-01   +2.310341895112306e-01   +3.552757468663522e-01   +3.555267175779427e-01   +1.781518508977582e-01   +2.253799342846454e-01   +1.318721153061184e-01; -2.609333301516242e-01   -2.670340459348289e-01   +1.972642747840024e-01   -7.717944856526937e-02   -1.739472597434198e-01   +2.646847752108541e-01   +4.971322512863693e-01   +1.945768388072338e-01   +3.490083101860542e-02   -6.650568736831339e-02   +3.072461179831407e-01   +4.479974121722421e-03   -1.313799257359024e-01   +2.007351598633681e-01   +3.706081876430894e-01   -5.445492493840803e-02; +3.534810291663261e-01   +1.619679892695244e-01   -2.501101261362432e-02   +1.561928020571049e-01   +1.775447260106492e-01   +1.028955998189065e-01   +2.316738315565185e-01   -1.777674935586420e-01   +1.855046655204979e-01   -2.222567153849066e-02   +2.636660654423063e-01   +1.927195265605736e-01   -1.265031908747102e-01   +2.281468935407376e-01   +9.333618087203507e-02   -1.405271707345928e-01; +9.987712848329738e-02   -2.034082935002822e-01   +3.487533517699492e-01   +9.980028324319584e-02   +7.578174994191030e-02   +4.369051788089032e-01   -4.104638845917322e-02   +4.113088159591945e-01   -1.336989806814354e-02   +5.383232481522835e-01   +1.434445459864948e-01   +4.281799594749940e-01   -1.122140567768864e-01   +8.883245407905237e-02   +2.986558826260060e-01   +2.404695145762215e-01; +2.371328640194241e-01   -1.581844743043175e-01   +6.143136076528492e-02   +2.481657087210711e-02   +3.484796905844466e-01   +1.652278959220519e-01   +2.441393424043765e-01   +6.992316619460215e-02   +3.068895590179915e-01   -3.456498680307334e-03   +1.889925249780711e-01   -2.539373716170750e-01   -7.073723707896676e-02   +5.552119789857740e-02   +3.766716368374078e-01   +8.242547854226644e-02; +2.036685298537813e-02   -3.448392536456183e-01   +6.084667237195139e-02   +2.252734682800482e-01   +3.727658598367614e-01   +1.139686214702168e-01   -1.479421056129839e-01   +1.230949177024209e-01   +4.825584475003951e-01   +2.518150941769940e-01   -1.218930398865040e-02   +2.203360694107065e-01   +2.309482735973107e-02   +1.764966831088433e-01   -8.885383819774928e-02   +2.178640173818370e-01; +1.108589741076067e-01   +4.458470491542982e-01   +1.269101160263298e-01   +1.863449329901401e-01   +4.859335273867294e-02   -1.958104728146560e-01   +3.021962653348967e-01   -3.050551467207587e-01   -2.602173307708133e-01   +4.196417641302633e-02   +1.454989725713240e-01   +1.943798356740903e-01   +1.841646636523591e-01   -2.888638907588060e-01   +4.315510757544520e-01   +8.722530290711669e-02; +1.415224597129167e-01   +3.302925927528556e-02   +9.788815568704073e-02   +5.345530331423025e-01   -2.304627162274709e-01   +4.759174488203753e-02   +2.808043551508624e-01   +1.271227971389757e-01   +2.828284119414021e-02   +3.780583926785892e-01   +1.713489734315246e-01   -3.185681980066381e-02   +1.583670820513364e-01   +3.841786781876061e-01   -2.953626259933473e-01   +2.286133147396654e-01];
L2I_L1I_iGABA_netcon = [+5.002076325774144e-01   -5.450620535785829e-02   +3.558999770417678e-01   +2.038642576857193e-01   +3.664829991340756e-01   +3.616321284221172e-01   +1.648357196610017e-01   +1.899122335837770e-01; +4.128626397384483e-03   +3.809776330060067e-01   -3.256136774215777e-02   +1.518918737628422e-01   -8.409569112681273e-02   +2.731612496277283e-01   +7.662327109043017e-02   +1.749919165584758e-01; +2.671396857356934e-01   +3.424314865644519e-01   +2.158014395553443e-01   +6.342952453728247e-02   +4.671602376802552e-02   +1.148781540116906e-01   -1.815531568587432e-01   +3.393436497178304e-01; -8.263773297535308e-02   +1.797839477510026e-01   -2.190639485456410e-01   +1.579723182556663e-01   -9.616374843607092e-02   +1.826264201126599e-01   +3.932997565236813e-01   +2.411739118164927e-02; +1.554033183983581e-01   +2.517892808530598e-01   -2.052215131185092e-01   +2.894846067418276e-01   +3.644294851561863e-01   -8.531312681727957e-02   -8.076507799573263e-02   +2.520733077464316e-01; +1.286283599146470e-01   -1.505990706140353e-01   +3.016041999721208e-01   +1.354120031833521e-01   +1.748562225643379e-01   -3.571163760960909e-01   +1.828639546232254e-01   +1.275617494778359e-01; +1.868912653992996e-01   +5.034373076935063e-01   -8.790740594854374e-02   +1.433258028780524e-01   +1.872215235301155e-01   +1.583270809357590e-01   +2.428845939058036e-02   -4.910991945162555e-02; +2.433276833681389e-02   +1.571912977796718e-01   -5.674238172132891e-02   -2.173361235079813e-01   +1.514456153400813e-02   +2.762955672166857e-01   -1.498575851424485e-01   +4.773996541234683e-03; -1.865325227297396e-01   -8.323308906052339e-02   -8.029325086952274e-02   +5.500223557970806e-02   +1.041378018757511e-01   +2.107330859099732e-01   -3.484779756691826e-02   +4.234979228904305e-01; -2.193302168251871e-02   -3.458128437848602e-01   -1.536129516627599e-04   +1.507995995209373e-01   +1.731395805223368e-01   +1.640969393513863e-01   +2.435777506987376e-01   +9.593589111241067e-02; +5.496888992655103e-01   -1.446207396864513e-02   +2.397097225683286e-01   -9.301422581079914e-02   +2.803210790373765e-02   +3.238416172691042e-01   +1.009610418160212e-01   +3.047492358225484e-01; +1.743756592440252e-01   -1.395491518141655e-01   +1.055443534697950e-01   +3.726870965137719e-01   +1.368558577577086e-01   +2.504705409138388e-01   +2.292288524894743e-01   +1.701192548794129e-01; +1.607261671496959e-01   -4.452668867580273e-02   -1.603351348641814e-01   +2.473506550276052e-02   +1.683219634371695e-01   +2.808622201635853e-01   +2.801631857772192e-01   +6.437210270466423e-02; -2.657390666295890e-01   +3.089314681532743e-01   -5.839737998942814e-02   -1.904985082729977e-01   +1.190074731077590e-01   +1.583797770220854e-01   -2.470761524440322e-01   -1.656818030004732e-01; +3.598896019983182e-01   +1.603488495693946e-01   -1.259525889206638e-01   +2.507828347299051e-01   -2.110378931735130e-01   +6.003677854214556e-02   +3.993208680273772e-02   -6.851229848592613e-02; +1.310439782203471e-01   +1.509816964358279e-01   +3.005643551097424e-02   +4.814782215542345e-01   -2.493909917117739e-01   -2.138554012593303e-01   +3.634184550644700e-02   -1.350225262928089e-01];
L1I_L2I_iGABA_netcon = [+1.732720362171428e-01   -2.624786815094307e-01   +2.814557311879919e-02   +2.545683159754547e-01   -1.784817430526813e-01   -1.696303371479111e-01   +1.251371232473015e-01   -2.977422383929167e-01   +1.295667701245112e-02   -5.446676263627714e-03   -6.955067003134381e-02   +3.440868562632598e-02   +4.819245438116246e-01   +3.817063045358804e-01   +2.961728567483590e-02   -8.332224972427438e-02; +1.308980805420938e-01   +2.301789934723825e-01   -4.898498480623574e-02   -6.827507886448765e-02   -2.404841616791828e-01   -4.087912722123486e-02   -1.168086007269728e-01   +1.946436821808074e-01   +2.142045351906609e-01   -3.571114785905696e-02   +9.262012650236340e-02   +2.811111398808446e-01   +1.021441540178709e-01   +1.118759517818637e-01   +8.433838502801339e-02   +7.192776825988893e-02; +3.606772877488617e-01   +2.459902766826332e-01   +1.206075750868939e-02   -1.681446287698591e-01   +2.846011318931149e-01   +1.639372499114866e-01   +3.195919560328348e-03   -3.225003894770492e-02   +1.171113131942104e-01   +1.925527190888832e-01   -1.334331692538919e-01   +2.593299337484866e-01   +1.744958729829368e-01   -7.136709084273118e-02   +1.792165307505101e-01   +1.727388151387209e-01; -1.573173988447537e-01   +6.054576207448393e-01   +2.738467519525198e-01   -4.472104185230889e-02   +2.899276727746469e-01   +6.042185048768488e-03   -2.016042084380511e-01   +1.583520008599216e-01   +5.254037455730858e-02   +4.108476114082225e-01   +2.277061487306002e-01   -1.610555497821384e-01   +2.254188403913772e-01   +4.925017987359917e-01   +1.172938993464639e-01   +1.697727366448839e-01; +1.274384443378148e-01   +3.285887392864122e-02   +4.548434646581268e-01   -6.660836906700800e-02   +1.424138413720143e-01   +2.799412370363815e-01   -1.149628957028679e-01   -1.302634151521558e-01   -3.505002857790221e-04   -2.219659971460543e-02   +4.695392610649053e-01   -2.477010040845832e-01   -1.099059617752905e-01   +2.798397940803983e-01   +2.394283568895771e-01   +1.573832798813016e-01; -2.864827266033005e-01   -2.814751526462126e-01   +1.613927895982888e-01   +2.149193441412129e-02   +3.368841213040001e-01   +5.206243131069092e-02   +2.306900696883474e-01   -1.674673861772288e-02   +1.736916180839615e-01   -2.458267348560909e-01   +2.070092350910774e-01   +3.092412117935144e-01   +4.863434629112104e-01   +2.281488678479006e-02   +1.635315659933542e-01   -2.387507775565196e-01; -1.839048771802786e-01   +3.494869970242714e-01   -8.285560542970760e-02   +4.513081271277777e-02   +4.743129837261363e-01   +5.341078399943050e-01   -1.314921890128984e-01   -9.568464690915025e-03   +1.930225674100624e-01   +6.912685247478401e-03   -1.485518187138954e-01   -5.599892163447778e-02   +2.462028944330380e-01   -6.237026503680971e-02   +2.541269527086288e-01   -7.520398535040616e-02; -6.401712964008427e-02   +2.994189924554271e-01   +9.483824128840147e-02   +4.751399332541498e-01   +4.508067621257285e-01   -6.810446507815493e-02   +1.046726511412079e-01   +3.162839774322431e-01   +1.123596061799026e-01   +2.322651269163439e-01   +3.429084539960427e-01   +1.215787351251194e-01   -2.070586903900297e-01   -9.164524761344137e-02   +6.453109972047110e-01   +6.709957296042823e-02];
L2E_L1E_iAMPA_netcon = [+2.425204105980892e-01   +1.174032307816661e-01   +5.155996015050577e-01   -1.252923061540703e-01   +2.563571823900987e-01   +2.711184046587189e-01   -6.179253017589321e-02   +9.211372095208631e-02; -3.249654937762701e-02   +1.955662618426734e-01   +1.297732374160387e-01   -2.218209496796077e-01   +1.706324590546256e-01   -3.203966383707964e-02   -8.741843640078954e-02   +1.059161828356101e-01; +3.437633851085775e-01   +6.474559298977139e-01   +4.124170552477490e-01   +3.448873547491828e-01   +2.879249326524279e-01   +3.680856785718705e-01   +4.153768057405235e-01   +1.564324515399665e-01; +5.608766050198308e-01   +2.027320038921312e-01   -8.782157509218011e-02   +1.668316753252175e-01   -5.012360462567284e-02   +4.757800611591948e-01   -3.165900285924622e-02   -2.682071867342292e-01; +3.937343441337175e-01   +4.032379185009045e-01   +1.426012998507790e-01   +1.344109043799968e-01   -1.274077474204853e-01   -1.373979983654364e-01   -1.611731938490041e-03   +4.940027572008297e-01; -4.567072807785160e-02   +1.256289909811208e-01   +5.485994015703297e-02   -1.814023291352140e-01   +5.240267274994183e-02   -3.302402105043310e-03   +3.049802128362509e-01   -3.617627225173201e-01; +2.094066953691832e-01   +2.940973943671019e-01   +5.851190699911255e-01   +3.296140241012191e-01   -2.278972376924847e-01   -3.961645830212028e-02   +2.079159705009764e-01   +2.552815887908226e-01; +3.140022711267522e-01   +6.670646433051055e-01   +2.026731754673113e-01   -1.643924565582058e-01   +7.992322099676273e-02   -1.945626325370368e-01   -7.073306852524804e-02   +4.629696234496210e-03; +3.650864241779205e-01   +1.648261703699161e-01   +1.466261395978455e-02   +2.113580274422818e-01   +1.351433131324477e-01   +1.329569741340562e-01   -1.062529758945490e-02   +3.777338249975062e-01; -9.532409643492434e-02   +1.467912712108474e-01   +1.331562527495130e-01   -1.917657328957983e-01   +3.484344125128609e-01   +1.691265313852995e-01   +4.773148128698463e-01   +2.319722304555686e-03; -4.336154650944399e-02   -4.586454047258567e-02   +9.385672159334096e-02   -2.117552217222793e-01   -2.281805692689315e-01   +1.944761265713133e-01   +3.542757056138766e-01   +1.083468502783563e-01; +2.706566210086849e-01   -2.311202282904752e-02   +2.964703336465553e-01   -6.884383447256871e-02   +2.313642077146721e-01   +4.407482098950414e-02   +1.348786936061373e-01   +1.774070199915074e-01; -1.013980924820339e-01   +1.317626990519865e-01   +1.075320301689091e-01   +3.716872607298169e-01   +4.592558710186613e-02   +2.521155542714355e-01   +2.943556342814066e-02   -4.016508816446249e-02; +9.744825305105018e-02   +2.222636215669684e-01   -2.316707459962870e-01   +2.032616686570211e-01   -3.277629853855997e-01   +3.936357445795781e-01   +7.809729115165226e-02   -1.283482509445765e-01; +5.720006467813198e-02   -3.206737650478113e-02   +6.734462559435411e-02   +7.006487109736277e-02   +6.197356894563823e-02   +2.207631542393409e-01   +6.102427561847321e-01   +1.439509283127985e-01; +1.586975918440209e-01   +1.353843200872155e-01   +2.295079846833003e-02   +2.963151261829073e-01   +1.306459853980940e-01   +2.929986231434221e-01   +2.373154952414314e-02   +5.936194543796748e-02];
L1E_L2E_iAMPA_netcon = [+4.320764543633360e-01   +7.669487128911898e-02   +3.471988073600864e-01   +8.277537310280142e-02   -1.179469311382182e-01   +6.411871279530434e-02   +4.670489377315730e-01   +1.865766267309212e-01   -8.668255831975953e-03   +3.627240191027404e-01   -4.665560332350766e-02   +2.440499397944705e-01   +5.943873856429595e-01   +1.067758490208726e-01   +1.194961206223419e-01   -2.102733016896304e-01; +1.220644547835332e-01   +1.557488918122946e-01   +2.545388066986415e-01   +3.880290601379517e-01   -2.748014685496821e-01   +6.973376032160847e-02   +2.344596441490305e-01   -4.235303607998492e-01   -9.103247748159363e-03   +4.711202556364397e-01   -1.222728328348948e-01   +2.193707468906532e-01   +3.788695597957136e-01   +1.293839467171297e-01   +1.254381749953843e-01   -2.792629356890272e-01; -2.475053827155277e-01   -2.807155925438951e-01   -7.541094998425675e-02   +1.512783127496460e-01   +2.476343782727676e-01   +2.141865324265614e-01   +8.582085229383701e-02   +1.589039124524229e-01   -2.987973705284597e-02   +5.988323856987231e-02   -5.831599619806860e-02   -1.458229476555964e-01   +1.309896974553082e-01   -1.994991845864624e-01   +4.640911764958759e-01   +1.204974551292902e-01; +2.252699417971155e-01   -3.661732848056531e-02   +5.265198264274334e-02   -4.832604384501629e-03   -1.824140380688103e-01   +2.618521347735769e-01   -1.655529122764001e-01   +9.946229069850951e-02   +2.679750033766756e-01   +1.218187692831489e-01   +3.981337684891250e-01   +3.163812260629829e-01   -8.980928393124128e-02   +1.376663754510640e-01   +3.253375246616430e-01   +4.669504270303153e-02; +2.894517784144984e-01   +5.297413266744230e-01   +1.195717529294506e-01   -1.365535432981104e-01   +2.265981574119232e-01   -2.091988612002216e-02   +1.358793771257104e-01   -8.640621414784883e-02   +1.479845582183058e-01   +9.957575485419719e-02   -4.685793232772988e-02   +1.137479964333144e-01   -2.664449528190235e-01   +2.253759234244416e-01   +1.462070515328087e-01   +5.546236524414623e-01; +2.242804459025613e-01   -1.206579612920803e-01   -1.930967836159773e-02   +9.762560490880472e-02   +1.636601028327838e-01   +1.223610990650623e-01   -7.975143355986584e-02   +2.445756867110636e-01   +2.162949513649168e-01   +3.659483295792910e-01   +2.166748231429742e-01   -2.726362012670528e-02   +4.548970555366208e-01   +3.898934604239918e-02   -1.116832718220903e-01   +1.271121977313235e-01; +1.183603641577268e-01   +1.716904810997380e-01   +2.700077057337574e-01   +1.168851827183640e-01   -1.933209878826761e-01   -2.008988244036577e-02   +3.986034403288991e-02   +5.109365854119205e-02   +1.294719627798058e-01   -2.224216040379821e-01   -4.154294467173927e-01   +2.797161826698834e-01   +4.251988838076314e-01   +3.842416193276105e-02   +2.409382387877016e-01   +1.464370696828741e-01; -1.216140229664178e-02   +1.627674549896805e-01   +2.505375317668651e-01   -1.515192749965910e-01   +9.206175629656076e-02   +1.623556499546006e-01   -1.278375455736735e-01   +3.069950899945000e-01   -2.009200337779412e-01   +8.172792471115928e-02   +2.922323856489139e-01   -1.389844449160547e-02   -1.200715948000411e-01   +2.190162736957893e-01   -4.431954430038764e-01   +1.247486192781944e-01];
L2I_L2E_iAMPA_netcon = [+4.761115394271175e-01   +2.424019045003307e-01   +2.159205967184258e-01   +3.607590446508303e-01   +1.186098700947925e-01   +5.012824000659881e-01   -1.145335559259808e-01   +5.198223826496337e-01; -4.900295621006488e-02   +3.410258379419125e-01   +1.138272138434755e-01   +5.421893513986534e-02   +1.437982847853154e-01   +3.089456358585746e-01   -2.013142237074080e-01   +4.745843792348239e-01; +4.584553474923266e-01   +1.030236947159643e-02   -1.029504081887318e-01   -5.524305070024360e-02   -2.001371673780629e-01   +1.733437456850299e-01   +1.307980917136211e-01   -3.999017008194651e-02; -7.017308909048767e-02   -8.838502762214810e-02   +4.052085028635098e-01   +2.807539978657979e-01   +2.808146335368668e-03   +2.410234291033041e-01   +8.830373849820539e-02   -2.542857121639855e-01; +8.074001676290385e-02   +5.144212990981361e-01   +2.363729788751724e-01   -1.267203731373666e-01   +4.678823125902612e-02   +4.358797112538270e-01   +2.889192687370453e-01   -3.911280225637406e-02; -6.386702091837322e-02   +1.680879298876012e-01   +1.467078494516691e-01   -9.800923429025844e-03   +5.480790929719136e-02   +2.952737929021583e-01   +5.502151429096477e-01   +1.500072262361495e-01; -8.349489106528710e-02   -3.499078859567095e-02   +1.363375028602513e-01   +2.527188768754550e-01   +2.048184501159095e-01   +3.098287954833339e-01   +2.510008570187530e-02   -1.769159886114389e-02; +7.885230103267321e-02   +2.339576355093992e-01   +1.932944515040251e-01   +3.499689190478444e-01   +4.039823985147036e-01   +3.322015984841047e-01   -1.967481489709724e-01   +1.145792068457666e-01];
L2E_L2I_iGABA_netcon = [+3.700132985135705e-01   +2.078538312026544e-01   +2.222883318799905e-01   +1.235820258142822e-01   +2.475429437835598e-01   +2.252957621497091e-01   +2.790284266335354e-01   +2.680592355009758e-01; +5.510295928096177e-02   -1.508927306640768e-01   +4.816778006537736e-01   -3.317741745354564e-01   +5.908953971793125e-01   -1.141463368073899e-01   +3.090775193174732e-01   +2.916268356707551e-01; -3.451462838974861e-02   -2.203279405699030e-02   +2.738818883949379e-01   +2.865904571480986e-01   -2.670034758184544e-01   +4.999574734182343e-01   +2.379312671390303e-01   -2.815863227417313e-01; +2.999611475685399e-01   -1.017280705490934e-01   +2.932432221095498e-01   +4.847349888802535e-01   +4.087091002470883e-01   -3.019106348812288e-02   -2.101850439666105e-01   +2.791846058955941e-01; +2.355895929129780e-01   -4.331281975343283e-01   +5.156737908542453e-01   +4.645037221788050e-01   +1.246423994549940e-01   +3.554952144987301e-01   +8.625674957544122e-02   +1.965265542878536e-01; +2.602265259765295e-01   -2.626379522971728e-01   -1.643106831326737e-02   +3.813555963691741e-01   +1.027066553331456e-01   +2.984988237267861e-02   -1.859609512821714e-03   +2.439166536231601e-01; +1.423963822523283e-01   +9.518675838772392e-02   +2.893511458256132e-01   -4.306858329110180e-02   +1.381970144033897e-01   +3.650364126873911e-01   +6.814564797047631e-03   -1.239926288886776e-01; +5.131805859534813e-01   +7.985450807149493e-02   +1.217371322048681e-01   +4.034587864733829e-01   +1.697641418562220e-01   -6.524804370526467e-02   -8.410089171166084e-02   +4.037870119163047e-01];
L3E_L2E_iAMPA_netcon = [-1.980632988657378e-02   +4.932121310200360e-02   +2.028492502007885e-01   -1.274003649991047e-01   +3.712009947961067e-01   +4.238023001223906e-01   +4.285615448154292e-02   +6.578668968465697e-01   +1.759469016998632e-01   +1.665727533619745e-01   +4.361327553809655e-01   +4.431373156066552e-01; +1.815790917524398e-01   +2.325776640989411e-01   +3.384384898424046e-01   +4.083354533548271e-01   +9.695428473355755e-02   +1.190260502298797e-02   -1.417599136294733e-01   +2.752832092441831e-01   -2.318269983653578e-01   +3.799973654360329e-01   +1.017357539401673e-01   +1.862165306795482e-02; -7.921585221909146e-02   +1.742463135480838e-01   +2.478208184281365e-01   -5.120089625200909e-01   -2.637769741656648e-01   -2.015567825080190e-01   +3.716159037889228e-01   +5.697636502605061e-02   +7.914928576375076e-02   -1.028283852927366e-02   +2.585692236749248e-01   +1.755001554412745e-01; +3.668363222422350e-01   -1.766942244358556e-01   +2.590385949704906e-01   +1.945728709546919e-02   -2.243193181047056e-01   +1.410997600555311e-01   -2.156749128495523e-01   +3.549922931356240e-02   +3.018349222022365e-01   +2.415193318563421e-01   +2.095237518312563e-01   -6.584887504007367e-02; +2.993546197752368e-01   +4.828476387509727e-01   +3.361091206147097e-01   +1.055234793791558e-01   -2.141126957044113e-02   +2.353145170455734e-01   +2.085337928664058e-01   +1.818552313684270e-01   -2.245924635193439e-01   +1.541082913220424e-01   +7.200071289211585e-02   +4.805615255439030e-01; +3.346062646334603e-01   +1.173515058805728e-01   +6.107015746692803e-01   +1.427405100090551e-01   +1.870193812101312e-01   +3.241239349561617e-01   +1.547537486004975e-01   -8.617587923403712e-02   -4.529896880286837e-02   -5.037976752253695e-02   +7.709879112267035e-02   +2.436071113123008e-02; +5.837112351948435e-01   +7.330790047451671e-02   -2.618011371019549e-01   +3.430648147914291e-01   +2.355950427613031e-01   -2.777521209521930e-02   +2.158406697528092e-01   +3.193634791702046e-01   +2.034048480248198e-01   +1.883537945870071e-01   +2.782329545664073e-01   +1.221494297587447e-01; -2.572869240816403e-01   +4.169972606859958e-01   +5.172011808180304e-02   +1.303413723378770e-01   -9.669728937752733e-02   -5.116110427158538e-05   -5.452264657565073e-02   -2.812351260140570e-03   -1.794847724917953e-01   +3.682199709882086e-01   +1.568578885986922e-01   +5.706867498645379e-01];
L3I_L2I_iGABA_netcon = [+3.046512926995757e-01   +6.417547090504844e-01   -2.761827284218289e-02   -8.749334419931924e-02   -9.737529473325796e-02   +2.842146376122692e-01   -1.792999483811036e-01   +1.392489978735731e-01   +4.188153337095333e-01   -1.320930495535969e-02   +7.310139203545503e-02   +2.730530659021654e-01; -1.449661671113303e-01   +1.895642116844765e-01   -5.447118324107139e-02   +4.131568545858384e-02   -1.112019534762101e-01   +3.356435494836289e-02   -1.707923247532369e-01   +1.711036594906721e-01   +1.019309260629417e-01   +1.753031093048458e-01   +1.039610122618242e-01   +5.479985163744385e-01; +3.343496233348958e-01   -1.243546191495985e-01   +3.382599654227598e-01   -4.456212332670306e-02   +5.789322566198072e-02   +1.918364098201961e-01   +9.759371798952934e-02   +4.326658134989618e-01   +2.688822254055488e-01   +2.052127562836795e-01   +1.226285589785540e-02   +1.173031521717583e-01; +2.648733431917069e-01   +2.129541375884879e-01   +3.219281616781774e-01   -1.443256818238567e-02   +1.260880486044319e-01   +5.444607184599373e-01   +2.906846184891638e-01   +1.841720213204094e-01   -3.402310778008786e-02   +5.182599673550320e-01   +4.644579027858762e-01   +5.764733194960044e-02; +3.496206416113848e-01   +4.793122255613860e-01   +5.014407861410837e-01   +1.452874296299829e-01   -5.348918789615603e-03   +7.915616052511967e-03   +9.567101140480974e-02   -2.115608093073070e-01   +5.476382143863711e-02   +2.655424658617011e-01   -1.742166834933489e-01   -7.003971135587458e-03; +1.195778486451680e-01   +3.747299319492121e-01   +1.578667463963516e-01   +1.508382659108658e-02   +4.706573981380566e-01   +3.143779673098471e-01   -6.260253663413140e-02   -1.203261688523116e-01   +2.018967592214685e-01   +2.767497078600780e-02   +1.174664828660567e-01   +2.494192987730033e-01; +2.867684066203796e-01   +1.480990367347446e-01   +3.820100610978160e-01   -2.724360351271349e-01   +1.588534950316268e-01   +1.963421948171564e-01   +2.879730684010620e-01   +3.501375522416622e-01   +2.440108945882675e-01   +2.472843230049608e-01   -1.135856419441435e-01   +1.622304373946230e-01; +1.236099726775787e-01   +5.235393517327402e-02   +1.169518268917107e-02   +1.978147533861881e-01   -5.045752999067264e-02   +2.657858270863193e-01   -9.829991904864269e-02   -8.117942016507451e-02   -7.470720504446329e-02   -1.524420515644590e-01   +1.913929831556802e-01   +1.752121971605250e-01];
L2E_L3E_iAMPA_netcon = [+1.867376259186800e-01   +2.311512715909995e-01   +5.774730629738143e-01   +4.759983259669084e-02   +4.223378518717947e-01   +1.926718480855617e-01   -2.016322135688826e-01   +6.085432118623409e-02; +1.255793615079007e-01   +3.251606083701607e-01   +3.342879237410600e-01   +1.253565018675879e-02   -2.606164821819361e-02   -1.050914872904186e-01   -8.283968693446164e-03   +3.175434104131800e-02; +2.453959501418909e-02   +3.132528374573618e-02   +2.056697832017883e-01   +2.224604276163238e-01   +1.379512924617731e-01   -2.568659940730129e-01   -1.232811588539067e-01   +1.059602578270802e-01; +2.849438941439210e-01   +3.386713376446597e-01   -1.357562100550495e-01   +3.322407769806376e-01   +2.671108626716119e-01   +5.260765336561753e-01   +1.261745223263024e-01   +7.024419799545925e-02; +2.140161010826168e-01   +2.183193496117638e-01   +3.456002889925695e-01   -3.861197368918937e-01   -2.108540242010642e-01   +2.064650285621913e-01   -2.461839503147703e-01   -3.021631129885927e-01; +2.771324628750316e-01   +1.758335946753726e-01   +1.669366949584519e-01   +2.375234633032642e-01   +2.378971902804052e-01   -8.162918601541873e-02   +6.640001564405901e-02   +1.327892919933582e-01; +1.866680982971843e-01   +1.836507594261931e-01   -2.145316819669483e-01   +7.392319809692618e-02   +2.029281938946896e-01   +2.144401690927099e-02   -8.091190031904341e-02   +6.716752918439967e-02; +9.736120470820391e-02   +8.847177037265723e-02   -1.914473551882649e-01   +2.444867412841762e-01   -2.065735802260647e-01   +7.772532355383294e-02   +2.445098238816102e-02   +5.169101174659922e-01; -3.006322488091569e-02   -4.356738303272165e-02   +1.159199942781569e-01   +2.856671792269792e-01   -7.600265540398138e-02   -2.030572446595410e-01   +1.504353672896662e-01   +1.208999749976712e-01; +3.665549322292544e-01   +2.110693008750741e-01   +3.093033445766882e-01   +1.982587571622751e-01   +1.596560912294878e-01   -9.203669551465563e-02   -3.575829876007769e-02   +3.915174205350885e-01; -2.528876223030176e-01   +2.793727740622797e-01   -7.982238563600638e-02   +3.190023707188745e-01   +3.001343024920486e-01   -1.041130381912958e-01   +6.043295026390353e-02   +3.813890697119750e-01; +2.527857724863782e-01   -1.294027248224597e-01   -1.052091428160787e-01   +4.893118518901434e-01   +1.497498533907514e-01   +2.431565035864419e-01   +1.034134443115443e-01   -1.501095323737201e-01];
L2I_L3I_iGABA_netcon = [-5.744535497204870e-02   -1.376444978009096e-01   +2.816132092586804e-01   +1.882399163788204e-01   +3.780896782987054e-01   +4.023659742229073e-01   +1.881693253050050e-01   -1.167253110309437e-01; +1.218094728153189e-01   +2.822012682928925e-01   -3.226131430718543e-01   -2.471651416942782e-01   -2.943666599064716e-02   +1.205534391113976e-01   +2.300607212480684e-01   -2.352792716089101e-02; +3.558778576736602e-01   -1.685459510729719e-01   -2.251145239653395e-01   +3.045117539231265e-01   +2.740079507491324e-01   -2.546642875392963e-01   +5.845631453038189e-02   +3.499055032006269e-01; +1.808872871947032e-01   +2.309189427662036e-01   +1.305539526725008e-01   +6.215760123432905e-02   +1.476930597999574e-01   +2.046199052326222e-01   +2.292121963814568e-01   +1.224248103436174e-01; +1.332608104510787e-01   +2.816271536804155e-01   -2.112853220250644e-01   +1.518313947826334e-01   -7.406707577483174e-02   -3.100697424282412e-01   +1.260531433340142e-02   -1.346561231753553e-01; -1.534979949452354e-01   +1.935014055852957e-01   -3.844722378158745e-02   +3.443498099899257e-01   +1.015594006058163e-01   +1.118740921170047e-01   +2.415562424885197e-01   -4.701680414621184e-02; -2.041087197342806e-01   +2.656540269023412e-01   +4.797882492619197e-02   +3.255878069164082e-01   -2.198888448452956e-01   +1.300840825334422e-01   +1.924188170420236e-01   -1.502290025346276e-02; -1.847009175857093e-03   +4.246128158432518e-02   -1.008439422891258e-01   -1.215921154476664e-01   +2.530719738690346e-01   +4.889735256802099e-01   +1.068856687785169e-01   +3.193495125035645e-01; -2.111250377031125e-01   +8.213811981332376e-02   -8.158455580813255e-02   -2.310172501844497e-01   +3.409314394627112e-01   +3.036739162163954e-01   +9.911079670709477e-02   -3.716336715109720e-02; -1.087893488896413e-01   +2.900397840960135e-01   -1.614485473165517e-01   +1.496980074663725e-01   +1.248483381202368e-01   +2.747157927968501e-01   +1.299534016608570e-01   +3.795613289875037e-01; -1.590092811190149e-01   +4.376645751287760e-01   -6.820303171527428e-02   +2.756913575009143e-01   -4.190393548358882e-01   -2.753349209189595e-01   +1.096769025208736e-01   -6.450470828950730e-02; +3.503718723184072e-01   +2.659141112128213e-02   +9.331416494292685e-02   +2.829220546605973e-01   -1.298358925199693e-01   +2.723373164709888e-01   -7.226368352978314e-02   -1.021587647944380e-01];
L3I_L3E_iAMPA_netcon = [+9.069565969492868e-02   -9.759891418988276e-02   +7.506183643893223e-02   +2.950212983725207e-01   -6.430554137015174e-02   +4.276892974239857e-01   +2.887214665818658e-01   -4.240881434333035e-02   +3.386147194827168e-02   +1.839503483501795e-01   +8.760214665551223e-02   +3.146902581349129e-03; -4.743624842232143e-02   -1.310918330256080e-01   +2.686955033946841e-01   +1.938259552329110e-01   +3.237771681269128e-01   -2.547468555295876e-01   +4.410943219150318e-02   +1.963633779745790e-01   +3.239641001917237e-01   +2.306965629165551e-01   -3.037985631837775e-01   +4.106181391404614e-01; +3.782307867639206e-01   +1.926381603295319e-01   -2.657164194243249e-01   -9.656582568276627e-02   -1.028753065162948e-01   +3.693919662555487e-02   +1.311324803653022e-01   +3.564982412024343e-01   +2.150183064336714e-01   -8.168425012997749e-03   +3.064373579934384e-01   +2.937474710188345e-01; -2.786911351442655e-01   +4.188430348800319e-01   +6.665447062626757e-02   -9.302073158325114e-02   -2.044596793121762e-01   -9.690667997699387e-02   -1.204301737181996e-01   +3.381271000257188e-02   +2.938095200115952e-01   +1.185984356119991e-02   +4.825202488466899e-01   +4.243809639095944e-03; +2.508170937705934e-01   +2.141762260836568e-01   +5.536424589198152e-01   -3.033700030584578e-01   +6.000273594904283e-01   -2.167533147031407e-01   +6.177146921580948e-01   -6.474609042624603e-02   +4.006155538415096e-01   -2.386265741031533e-01   +1.830643315546638e-01   -1.097002159591200e-01; +2.878395503247189e-01   +1.371545305266651e-01   +4.319763206395628e-01   -2.431892058595999e-01   +1.569869883076517e-01   -1.559950712788889e-01   +2.161688949284291e-01   +9.438339424433145e-03   +3.860804857578812e-01   +3.257071789972538e-01   -6.703357841298875e-02   +4.857702369619368e-01; -3.070672470044211e-02   +1.018728576801840e-01   +3.361896881746723e-01   +6.965889513031924e-02   +1.346520268462880e-01   +1.799540659378840e-01   +3.080944679393429e-01   -2.003764106538296e-01   +4.351571371871070e-01   +1.409159513127420e-01   +2.294941886671063e-02   +2.737897230673465e-01; -9.230818371987251e-02   +1.848595746160095e-01   +1.690757920819744e-01   +1.449150633693921e-01   +5.388555997270553e-02   -9.478841269875177e-02   +4.576809965884957e-01   +3.145426792869186e-01   +3.191840142389581e-01   +2.813127143386990e-01   -1.067653375844880e-01   +5.502207804295691e-01; -8.280300931994616e-02   +6.103500098185241e-02   +3.423104485792057e-02   +3.692164413983302e-01   -6.786855540096128e-02   +2.333060381021770e-01   +3.209073801098272e-01   +3.571553878748229e-01   +1.565525855892246e-01   +3.236536129894452e-01   +9.350089549539059e-02   +4.665279496403909e-01; +4.030379880999502e-01   +1.429176348473682e-01   +6.369274229050631e-02   -1.131646743322027e-01   +1.976289026886819e-01   +6.095008126430876e-01   +1.294477610426366e-01   +1.308775693221430e-01   +1.476911180495336e-01   -9.506034239101110e-02   +1.986235325918863e-01   +7.168003751339844e-02; +3.375065383048497e-02   +1.628283325689471e-02   +2.096696924778547e-01   +1.700381541438306e-01   +5.451470192688466e-02   +3.023053159930240e-01   +2.978709590187466e-02   +3.630021595880045e-01   -8.784359404561937e-02   +7.402825497039804e-02   +3.974221606803732e-03   -1.657835806328452e-01; +1.236359997600968e-01   +3.425099093669041e-02   +3.980078587066918e-01   +8.665558845544172e-02   +1.415574161432905e-01   -3.079883186511369e-02   +1.192804994209319e-01   +7.695439201618556e-02   +1.661462329867401e-02   -1.910577465836479e-01   -6.991779607893907e-02   -6.075580276536129e-02];
L3E_L3I_iGABA_netcon = [+9.521562847505988e-02   +2.056821260979643e-01   +4.119203796704153e-01   +4.022685099717574e-01   -6.247160509141340e-02   +3.643022870058839e-01   +2.516489879784297e-01   +2.504414636452967e-01   +2.685218673244767e-01   +2.407792928560160e-01   +5.234306486551751e-02   +4.635626193515776e-01; +4.625876627909874e-02   +5.153111458986358e-02   -1.717996771767702e-01   +1.410703154515066e-01   +1.428031014148807e-01   -6.721989027367986e-02   +7.072941674777253e-02   +1.480733902671335e-01   +4.548402874765503e-01   +3.582367892233979e-01   +2.236368566895822e-01   +4.441479624989612e-01; +9.779252798805210e-02   +3.755404562850168e-01   +1.116739025661336e-01   +2.554256413572552e-01   -7.160618426425922e-02   +6.915761772574468e-01   +5.843930751399246e-04   -1.024891112366695e-01   +2.123660558430860e-01   +2.020838788174569e-02   +2.562380454994746e-01   +1.893407496634860e-01; -2.707137972003106e-02   -2.724112882889854e-02   +4.417838415147060e-01   -1.097028105543224e-01   -1.623944400245247e-01   +2.058445169727877e-01   +1.028489215522260e-01   +4.009959384826955e-01   +4.010028449390429e-01   -1.958511076462194e-01   +6.424974953234169e-02   +2.422279341670336e-01; +1.294134837248824e-01   -2.627336453788857e-01   +2.343678456310473e-01   -1.773917562291915e-01   -9.839967881194786e-02   -1.749721080180315e-01   +8.312908522710542e-02   +3.661377727974554e-01   -4.975265731944191e-02   +3.228382257575529e-01   -2.200589726552358e-01   +3.595307583288073e-01; -2.123829876281493e-02   +3.629655928564914e-01   +4.942208308810610e-01   -3.813965750572015e-02   -1.209096925600937e-01   +5.114176030132128e-02   -2.286479576305885e-01   -3.081544712154817e-02   -3.732591305345462e-02   -1.591569406979221e-01   +1.431680387035721e-01   +5.976625971298630e-02; +2.475454102146029e-02   +2.135407988215202e-01   +1.265011127915099e-01   +6.200283893893693e-02   +4.384675530729459e-01   +1.216648894735519e-01   +1.838728328489667e-01   +2.249092381200208e-01   +4.894850354180343e-01   -8.367327953520312e-03   +4.192082783742034e-01   -5.716063524847897e-02; -6.817046430360592e-02   +1.794267438900084e-01   +5.100444928301009e-01   +4.026710804215167e-01   +3.392096107023239e-01   -2.392864135532876e-01   +2.163435032634899e-01   -2.473992749144695e-02   +3.207093839440681e-01   +9.160363852029202e-02   +1.205029228081177e-01   +5.326787695011114e-01; -2.656057631533773e-01   +2.070095208072141e-01   -3.073529671361249e-01   +1.275306265643542e-01   +5.654747197228450e-02   +9.990172882341317e-02   +7.824031929474907e-02   -6.048905243622286e-02   +2.475138688231285e-01   -2.336754911527606e-02   +2.176881650045375e-01   +6.252376596435154e-01; +3.330480069773396e-01   -1.251167256401828e-01   +5.127845465610368e-01   +3.585920839786292e-01   +1.117918478650847e-02   +1.431879374469108e-01   +3.287581547126583e-02   -3.334377397822383e-01   -1.533387763912388e-01   +4.437283976533854e-01   -1.956163657508447e-01   +3.290821026345538e-01; +3.866695370024514e-01   -1.327697626508809e-01   +2.262525863284969e-01   +1.356792794344543e-01   -9.704450201419607e-02   +4.329019714623287e-01   +3.424968505434389e-01   -7.900342347490417e-02   +1.179689155877385e-01   +1.865753803506155e-01   -1.915186655029455e-01   -4.691844061393562e-02; -1.941241528499676e-01   +1.751432142373084e-01   -1.791812845348132e-01   +2.208630227910797e-01   +9.092413172776369e-02   +3.074756937418041e-01   -8.941957620137440e-02   +2.662322634189322e-01   +3.677700816077960e-01   +3.738422873275382e-01   +1.232284818362489e-01   +2.540805464469734e-01];
L2E_Input1_iAMPA_netcon = [-2.420583075040802e-01   +3.014725052650469e-02   +1.489580199939640e-01   -3.471786520386105e-02   +9.890215090214398e-02   +1.855332904823369e-01   +5.036092632807644e-01   +2.624177459247237e-01];
L2I_Input2_iAMPA_netcon = [+1.253186206932254e-01   +2.010565936909306e-03   +1.365723778134532e-01   -7.869627517965802e-02   +4.412828553956274e-02   -5.086177255639781e-02   +1.007872597857609e-01   +6.042087179133313e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.03*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.15*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.15*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.03*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.15*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.15*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
