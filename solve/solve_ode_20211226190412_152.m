function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+1.419856030592142e-01   -1.000399298951455e-01   -8.105642963813432e-02   -1.026852493203587e-01   +1.034948218248351e-01   -2.267314772555451e-01   -4.136283807208958e-02   -1.007867099395610e-01   -3.705531867038944e-02   -1.674682528498912e-01   +1.433003193759373e-01   -1.640374328328245e-01   -1.135376455224202e-02   +1.793221324565108e-01   +2.897841001947338e-02   +3.412556821979365e-02; -4.981310976795383e-02   -6.780668272305217e-02   -1.797423250292595e-01   -7.175332395418077e-02   -1.824172553520060e-01   -2.791836849503385e-01   -3.111523719451624e-02   -5.734266665680320e-02   -2.802457789768830e-01   -2.382440495272737e-01   -1.710768323529839e-01   -1.685262828908226e-01   +1.123641409879613e-01   -1.486674441176334e-01   +2.418975373844972e-01   +2.229594701192859e-01; -4.402237060044134e-02   +9.236143905555043e-02   -1.529817894090267e-01   -2.925611795333131e-01   +3.993694498031983e-02   -5.049920771318117e-02   -2.073659131357223e-01   +5.992789107300085e-02   -3.972787589992562e-02   +6.402329514861796e-02   -9.712103620931868e-02   -1.748792426590212e-01   -7.293392612061525e-02   -3.573138864386529e-02   +2.238019141104541e-01   +1.348484576187197e-01; -4.631085381051103e-02   +5.335106601162851e-02   -4.843007283013000e-02   +1.186694981364052e-01   -1.076681618888205e-01   -1.086681529437614e-01   -4.994908845973699e-02   -1.571928453031269e-01   +1.089559529922605e-02   -1.072384698005608e-01   -3.167726956977561e-02   +1.012016797682739e-02   +2.183373018625079e-02   -1.539336802437631e-01   -1.553255359777060e-01   +4.999444600852881e-02; -6.951097811581955e-02   -9.606555314946942e-02   +1.505198990704948e-01   +3.652734898957698e-02   +9.982149374873246e-04   -3.815826993691367e-02   -2.293488499118500e-02   +2.700197027741436e-02   +1.311759962310718e-01   -1.179674190749929e-01   -1.725677933198877e-01   +1.698260086961010e-01   +1.046159388804113e-01   +2.023731095592999e-01   -5.888063685879578e-02   -9.140237407736330e-02; +1.740367049728581e-01   +1.274992824551774e-01   +2.967874187887517e-02   +2.600686377376201e-01   -1.452328358614827e-01   -1.011683760191348e-02   +2.036723106705990e-02   +9.051054184105252e-02   +2.193987039003130e-01   +1.571332812340142e-01   -2.117757171493223e-01   +1.716537309366642e-01   +5.649003061272247e-02   +7.300923454524365e-02   -1.169435718960023e-01   -4.095673945040525e-02; +1.792894708549556e-01   -3.182353653947577e-02   -9.715168939887561e-02   +1.237962846551266e-01   -1.019074101391407e-01   +2.982576045377442e-01   -1.869666477265400e-02   +7.640761555641401e-02   +9.579737159001826e-02   -3.435253161315897e-02   -1.133865996473093e-02   +6.320538137949312e-03   +2.413948547521234e-01   +1.404842583417790e-02   +1.094215549103655e-01   -1.283928671542278e-01; -1.986064965474846e-02   +2.649217438925022e-01   -1.336357353904361e-02   +1.317116296291905e-01   -1.953820826376558e-02   -3.666779304591118e-02   +1.194057333694061e-02   -2.069836098218661e-01   -6.891799388884354e-02   +1.357162173649089e-01   +2.002099893927855e-01   +1.368517753013436e-01   -1.114048314927765e-01   +3.905397603414091e-03   -1.044723043432028e-01   +9.648709326857799e-02; -1.999459797484365e-01   +2.286521904422715e-01   +9.135023263366973e-02   -6.442495546355975e-02   +6.275965580878930e-02   +9.623794562148245e-02   +4.349211760597333e-03   +1.501668581670693e-02   +1.166629022422967e-01   +3.570468140625578e-02   +1.419674237329950e-01   -3.667338652144712e-03   -1.257156841346617e-01   -2.514811603865580e-01   -1.622603346536225e-01   +1.136078214446932e-01; +1.684195819097107e-01   +4.220998608692887e-02   -1.721929050854024e-01   -1.428498225247869e-03   -2.414883793363739e-01   +7.465454625912674e-02   -1.187727556514063e-01   -1.522680234676531e-01   +1.874839552571728e-01   +1.371579948815639e-01   +2.125774871911459e-01   +1.661852521364080e-01   -1.344955688057888e-02   -2.270979023751041e-02   -7.365508637299413e-02   -1.440292371281194e-01; -1.067840166341161e-01   -7.693370025579235e-02   -1.060935807682726e-01   -7.273534520481298e-02   -3.930429087853487e-02   +2.110007137487333e-01   +2.070359008563536e-01   -8.453751272779206e-02   -8.489538791133866e-02   +1.210059174743136e-01   +2.959848022360511e-01   -2.219506252680016e-01   -9.798779535801834e-02   -4.756934222655156e-03   +2.362173024730501e-02   -1.298607391842146e-01; +3.017922404125867e-02   +1.933541641920450e-01   -2.247064424413423e-02   +2.493079476079209e-01   +1.645632075474434e-01   -6.913608785223949e-02   +9.226067779601882e-02   -1.442420943445964e-01   +6.649099712624357e-03   -1.613513155124739e-02   +2.020240013996851e-01   -4.743876942192143e-02   +1.608103675871594e-01   +5.327066102603847e-02   +6.929505614956852e-02   +9.776550839936184e-02; +4.943045847513265e-02   -1.065318326776558e-03   +7.349821319651129e-02   +2.236992002918650e-01   +1.470922151280981e-01   -3.245181765375256e-02   -7.311162033849353e-02   +1.547145016501319e-01   +1.793972100115753e-01   -6.876433195749161e-02   -1.507247235664108e-01   +4.915674968474391e-02   +1.978970081606080e-01   +1.211432028680179e-01   -1.512776176250601e-01   +2.203464869844142e-01; -1.080935377289383e-01   -1.520017880331814e-01   -2.294941754365028e-01   -4.480238626699727e-02   +1.585277970387975e-01   -1.040662526154461e-01   -3.964227142893643e-02   -2.563508789947198e-01   -2.996658591695601e-01   -1.131477317052784e-01   -1.767390636788809e-01   +1.409247521557833e-01   -2.471908582290610e-02   -6.442268602618900e-02   +1.497729767772872e-01   +2.260147273510292e-01; +2.711799025792312e-02   -6.668891549352060e-02   -9.349162756305310e-02   +3.256628914719039e-01   +5.697704770968219e-02   +8.401761847604740e-02   +1.543386275187845e-01   +4.560113548721098e-02   +4.584100817758892e-02   -1.013156215080300e-01   +1.295099082903538e-01   +1.921863597988487e-01   +3.185951021916508e-02   +3.526238719680494e-02   +5.155991602583385e-02   +1.229449144213252e-01; +1.459146153490492e-01   +1.467773406422402e-01   -7.281621844134528e-02   +4.754481308695482e-02   +1.916979184377189e-01   +2.318157403549805e-01   +3.974709677749145e-03   +2.430758954612536e-01   -2.749159054291258e-01   +4.625764621539145e-02   +2.377371781401550e-02   +3.535659820369502e-02   +2.729436929538665e-01   -4.024006798456831e-02   +4.037170699843325e-02   +1.459519702918252e-01];
L1E_L1I_iGABA_netcon = [+3.275109521336633e-02   -2.443632372545364e-01   +3.602083228148573e-02   +1.485650730820519e-01   -5.426199292786341e-02   +9.460554095110815e-02   +7.460105617516219e-02   +1.721698311542224e-01   -4.839434430561428e-02   -2.961071925450930e-02   -2.872330156654447e-02   +2.610115135698052e-01   -1.412000125484138e-01   -1.978252610491406e-01   +1.748222055379417e-01   -3.006293494059046e-02; +1.083580432830790e-01   -1.534653349444061e-03   +6.191577539518039e-02   -9.057233624109977e-04   +6.654033368826447e-02   +1.437697959629105e-01   -1.477169732635956e-01   -3.424925964956465e-02   +1.351813498321423e-01   +9.860326078114666e-02   -2.798995392153714e-02   +1.131497589349058e-01   +1.712666624528198e-01   -6.660589652790436e-02   +2.286640984916583e-01   -1.004071050932481e-01; -6.987367728356395e-02   -8.197140366487407e-02   +1.226773419764970e-01   -7.809355765858084e-02   -1.200055207865525e-02   +1.481726174458288e-01   +3.541091838795070e-02   -6.297751696411882e-02   +1.612965078822312e-01   -1.961739609423233e-01   +1.707698369718629e-01   +1.564523537151033e-01   +6.005814296166252e-02   -2.019869216766118e-01   -4.750924855452161e-02   -3.425915235411013e-02; +1.469090195410903e-01   -1.265770866199211e-01   -6.108999312311079e-02   -1.356232698693051e-01   -2.298382113369108e-01   +8.334957286456374e-02   +2.486522288873920e-01   -7.623693348732176e-02   +1.775045767828723e-01   +1.632367677377942e-02   -1.087780417323982e-01   -5.489527856914103e-02   -4.418965041370083e-02   +1.113182989155441e-01   +2.448270926580522e-01   -1.734097430635043e-01; -2.909064966816614e-02   +1.653435513375670e-01   +1.257053133144605e-01   -1.459722911238059e-01   -2.656737937285698e-01   -1.442791293759278e-01   -8.947075934733716e-03   -2.428517638111583e-01   -4.065625232595402e-02   +1.683836198745983e-01   -2.372055949979830e-01   -4.545398604612171e-02   +2.331296562047985e-01   -1.355680260712703e-01   -3.823557991026797e-02   -2.282296340799687e-01; -5.168903734239399e-02   +5.040736877964455e-04   +2.401619778524434e-01   -2.663550106342415e-01   +6.396903653823305e-02   +1.389626291692438e-01   +4.641907096329901e-02   -1.275969500901086e-01   -1.193424167669348e-01   +1.555555929319405e-01   +2.909555034512700e-01   -2.009729203968044e-01   +1.689052955716782e-01   +2.224835463619875e-01   -5.236053726519892e-02   +8.200014281536228e-02; +2.310035151898901e-01   +2.376134860948814e-01   +1.185594107540348e-01   -4.491701225414005e-02   +1.484576372721132e-01   +1.479325081100310e-01   +1.008282533729612e-01   -1.774713195146677e-01   -1.124777057130284e-01   +2.058239650937474e-02   +6.896810897750488e-02   +1.362174739108198e-01   -2.914546439555806e-02   -2.041563078589357e-01   +4.954380653146813e-02   -6.454367042889329e-02; -1.156551129139850e-01   -7.348191736307286e-02   +1.087769979274490e-01   +6.071387660978821e-02   -1.522208569076978e-01   +2.126023593333264e-01   +1.485765788648932e-01   -3.378634971522471e-02   +5.714377788480227e-02   -6.875866783538158e-02   +1.619254665079121e-01   -1.740899403667118e-01   -7.522867054127393e-02   +5.286968558340899e-02   -9.838859848686324e-02   +3.882955716567948e-02; -1.615306351545928e-01   -1.304149431980564e-01   +1.474695054223492e-01   -1.076949518339237e-01   -2.967739045525685e-01   -1.397621514263042e-01   +2.174793799275224e-01   -1.457680445456613e-01   -2.015217250974327e-01   -2.768447824586803e-01   -6.159060268808332e-02   -1.877633007281148e-01   +1.021979091737469e-01   +2.049139475978811e-02   +2.719442119187614e-01   -1.342594337819808e-01; +1.617136543299469e-01   -3.269603164071762e-02   +1.641060556716354e-01   -1.819526284936209e-01   -1.653056064423878e-01   -1.057493423268906e-01   +1.189554444248532e-01   +4.930881188993114e-02   -9.051972277754348e-02   +1.198122447902790e-01   -1.014693753988681e-01   -1.085938364719782e-01   -7.106255628803687e-02   +2.332421029332095e-01   -1.065761011933979e-01   -3.311835975434699e-02; +1.324630357780901e-01   -2.173729567295409e-01   +4.736333354491907e-02   -8.036211369154325e-02   -1.495435096256186e-01   +2.640495316021802e-01   +2.329838689960568e-01   -4.534707556183272e-02   +8.437866739121228e-02   -8.576266262899999e-03   -1.397318268274612e-01   -1.346674987397630e-02   +9.372235693017168e-02   +1.548545030990828e-01   -7.132829259437719e-02   -8.259805195453566e-02; +7.143783109685236e-03   +1.875687550274181e-01   -1.062860432183902e-01   +1.122067374642306e-02   +5.706462685029247e-02   +9.056626753994818e-02   +1.899412811483160e-01   -2.760184045735539e-02   +2.210867602058650e-01   +7.818287285496872e-02   +3.729081553581416e-02   -1.143831937130196e-01   -2.058599736547803e-01   -1.483979508495978e-01   +2.802167376368641e-02   +1.411398573602124e-01; -5.066261947782426e-02   -2.657729572328063e-01   +1.629954401420532e-01   +7.019828294350217e-02   -1.001239186373767e-01   -2.129728251641088e-01   +2.407983101067490e-01   -8.460254468647777e-02   +2.390066022680880e-01   +3.502746646006687e-02   +2.247467283482905e-01   +1.542086329451287e-01   +2.209549626118723e-01   +3.097841372726783e-02   -1.017192279154292e-01   -4.873438952591906e-02; +5.411860228554789e-02   +9.008164721392149e-02   +1.154945213100142e-01   -1.893561659510570e-01   +4.352396953747095e-02   +1.996326325029222e-02   -9.992972002826419e-03   +1.156146230617952e-01   -2.149126242306216e-01   +1.770914385079695e-02   +1.693497843608200e-01   -9.676509750255127e-02   +7.916070965800498e-03   -1.612482411885344e-01   +8.870334057989793e-02   -9.278591408588827e-02; +1.227651734036912e-01   +9.544520915169641e-02   +8.555177163988496e-02   -2.109671319249205e-01   -1.289348578746330e-01   +4.685731043169879e-02   +5.393921869219954e-02   +7.573788726132974e-02   +4.886774773805642e-02   -1.799314138680068e-01   +2.556034451939881e-01   +1.441620130616593e-01   +6.921279740460597e-02   +6.574312073782526e-02   -1.482670011630844e-03   +1.150231452594730e-01; +4.005816465123697e-02   -2.359501485348831e-01   -4.660752150496830e-02   +9.858312285118244e-02   -1.135412714414221e-01   +1.009825859997042e-01   -3.352558397197453e-02   +9.540048847348406e-02   +6.362269805137082e-02   +9.452478985852555e-02   +6.060695969854035e-02   +2.026498976771209e-02   +5.674806929696938e-02   -1.580513688174227e-01   +1.698657147738804e-01   +2.608407749515703e-01];
L2I_L1I_iGABA_netcon = [-1.406644662373423e-01   +1.543155658056385e-02   +2.036083126318882e-01   +1.096077068065641e-01   +8.445445650446483e-02   -1.283266020379702e-01   +9.873229749461632e-02   +1.751887469192322e-01; -2.773739908360287e-02   +1.342781519480689e-01   +2.372539072554777e-01   +1.183125038625912e-01   -6.691129621380312e-02   +2.056271612227521e-01   +1.727490297449001e-01   +1.961330727583022e-01; +2.204249811778792e-02   +1.775289811708534e-01   +1.809193939575089e-01   +2.234216681061521e-01   +1.039950275155695e-01   -4.625498670242968e-02   +8.226236424638801e-03   -8.835238506415349e-02; +2.830655464730494e-01   -3.144258308756735e-02   -2.111600372697132e-01   -1.862589261699434e-02   +1.219208227212040e-01   +2.547793706547707e-02   +2.825616683756088e-01   +9.539753550365238e-02; -8.373056803254385e-02   -4.225958310405156e-02   +2.739997748910310e-01   +2.776310486086647e-01   -1.716689944583671e-01   +4.146344839359956e-02   -1.009400031730205e-01   -1.826004764353508e-01; -1.927012449872937e-01   +2.006764843827284e-01   -1.777527210772182e-01   +4.046205120706406e-02   -1.655530377477975e-01   +1.063511974872718e-01   -9.710264675390110e-02   +1.049407178161499e-01; -2.545063069453309e-03   +9.725762898115685e-02   -1.800110270218078e-01   +9.536899177424644e-02   -1.654776598134171e-01   +2.132323719760660e-01   +1.561437541155940e-01   +1.513286885196765e-01; +3.427833967296935e-02   +1.116628660142151e-01   +9.940804037947763e-02   +1.621677823767224e-01   +2.451364875199342e-01   +1.487339401897355e-01   -4.407146818123460e-02   +2.550040229996179e-02; +6.706306566352302e-02   +2.639859274951718e-02   -1.434039250967716e-01   +3.051561534322518e-03   -1.840730576302490e-02   -3.969674335666251e-02   -3.093959552744820e-02   +2.587131490301203e-01; +9.806326170544045e-02   -2.047730631598170e-01   -4.376547176041792e-02   -6.549751433675113e-02   +1.425559257549662e-02   -7.664729186571503e-02   +6.501842866178568e-02   +5.148554170909952e-02; -1.021117898593569e-01   -4.219812684218342e-02   +2.149420828207415e-02   +1.128938971736632e-01   +1.412676604686260e-01   +7.381151766233486e-02   -3.066791691304850e-02   -3.182394647297106e-02; +2.312021837479167e-01   -1.485467882757959e-01   +1.311931487281735e-01   +7.129583053976224e-02   +2.113452630671368e-01   +1.849107780509941e-01   -4.139690551671315e-02   +1.283760892167997e-01; +1.341473368430754e-01   -1.860538216185184e-01   +3.187252122527151e-01   +6.121073240613460e-02   -1.598916686246843e-01   +7.578177068370107e-03   +8.210444676091366e-02   -2.436238875553801e-01; -9.300862034592712e-02   +8.257994240822306e-02   +5.345567681233743e-02   +6.537970367048208e-05   -1.737203733602374e-01   -1.151018331256810e-01   +1.905954965893087e-01   +2.335214666912463e-01; -1.735841251117569e-01   -1.465158951952021e-01   -2.228258090077452e-01   +2.039104108527921e-01   -1.119122215602454e-01   +1.005107200966262e-01   -6.789639414111594e-02   -3.092927154005474e-03; +1.157435264216192e-01   -3.932033250413313e-03   -5.193868386291263e-02   -8.191823647241733e-02   -7.254549899807417e-03   +1.867567351837388e-02   +2.927470848283314e-01   +2.010843523856791e-01];
L1I_L2I_iGABA_netcon = [+6.704461066392803e-03   +2.756524830549731e-01   -5.574231054362452e-02   +1.261124547867946e-01   -8.846361204551727e-02   +2.929659690863785e-02   -1.624230053960518e-01   +1.685566102081279e-02   +4.958820489163113e-02   -1.806435768074394e-01   +1.259282891724470e-01   +2.539553285586903e-01   -1.847506985544661e-01   -5.023246213553653e-02   -1.698963769415198e-01   +1.299722376031662e-01; -1.012379976861217e-01   +3.995010219790699e-02   +1.476484469321615e-01   +2.796567826420818e-01   -1.528439691200581e-01   -2.594149375767632e-01   -1.585809977630765e-01   +7.547466446673197e-02   +2.102661083795616e-01   -5.993776151508128e-03   +5.298485383693900e-02   +1.276310995800745e-02   -5.721194635198802e-03   -3.513291164465540e-02   +8.605785573330160e-02   +1.920432913363404e-01; -2.343496374154279e-01   +2.507961274294907e-02   +3.111369228599723e-02   -1.010749354050453e-01   -1.448502678601620e-01   -6.008186144134654e-02   -3.269319417584492e-02   -7.087148512150764e-02   -3.028154277476613e-02   +9.752542530537182e-02   +5.249339619896182e-02   -4.950576538253012e-03   -2.223219769850498e-02   +2.084740972786277e-01   -5.353576459356822e-03   +2.499066662425249e-01; +1.883906725481265e-01   -1.820060936376958e-01   -2.305017434945997e-01   -1.278569233901500e-02   +1.007684897500370e-02   +1.553167432141959e-01   -5.622184093541789e-03   +2.987365224482362e-01   +8.825246460031529e-03   +2.283104309273213e-03   -3.380254555267186e-03   -9.355406207187686e-02   -8.714841054671754e-02   +6.166216147223021e-02   -1.706654087635580e-01   -5.896315612724107e-02; +1.452324389761658e-01   +2.991826250691397e-01   +2.403950126189754e-01   +4.920291415954061e-03   -6.058258123891551e-02   +1.018291350487050e-01   +7.647653670869532e-02   +4.449166040661010e-02   +1.814680187073878e-01   -8.681567083772962e-02   +2.608882379973727e-02   -3.682812715869757e-02   -8.035128342584175e-02   +1.099848729336610e-01   -3.922699788289329e-02   -9.677345257844177e-03; -5.595037571131228e-02   -1.539094099918598e-01   -3.649387929127283e-03   +8.626001462339310e-02   +4.647826346681590e-02   +8.250715267714995e-02   -9.907023635349899e-02   +2.904593644718375e-03   +2.264812655932275e-01   +8.259447343746967e-02   -3.802391791676319e-02   +5.957075579725464e-02   +5.231634817321854e-02   +1.543161661327820e-01   +1.184790735642750e-01   +8.722875348880156e-02; -9.113884610548384e-02   +1.328090678254989e-01   -6.013024941545647e-02   -1.331324529127163e-02   -3.796675616203583e-02   +1.063637923267823e-01   +4.533198668903099e-02   +1.958612826637620e-01   +1.011738084074837e-02   -7.500714299132574e-02   +7.077481939234473e-02   -8.603727145371769e-03   -8.989817177413437e-02   +2.099099727507002e-01   -1.188115935374255e-01   -1.580568261588779e-01; +1.127132980509739e-01   +1.933407146615682e-01   +1.301600290618067e-01   +1.253245785940651e-01   -1.796891404718312e-01   -1.861512719213278e-01   -4.277387747526495e-02   +4.321759561903177e-02   -3.046560015071833e-02   +2.252936863863650e-01   -1.793102609163688e-01   -6.985396969725699e-02   -1.249977886341735e-01   -9.238097097262003e-02   +7.063021213610003e-02   +1.569732912503779e-01];
L2E_L1E_iAMPA_netcon = [-1.753311088526914e-01   +3.177642869454025e-01   +1.666358369757507e-01   +5.929927180404666e-02   +8.078267904484444e-02   +1.049491339473339e-01   +2.451512482857539e-01   +1.961634256029477e-02; +1.895667007347273e-01   -1.205759659131623e-02   +1.419942522048038e-01   -2.704011944598672e-02   +7.576091655769362e-02   +4.150866952483400e-02   +6.737052371438701e-02   -1.004486826872349e-02; -2.434105833378057e-01   +2.013793215842385e-01   +9.821923353694959e-03   +2.062620227779401e-01   +2.195677956525419e-01   -1.325737205011540e-01   +4.064315395271731e-03   +1.232870608251692e-01; -6.219359159743630e-02   +1.981353998465039e-01   -1.394418176837140e-01   +1.659026354267664e-01   +1.042673085743504e-01   -4.787577988060866e-02   +1.152386759855188e-01   +6.814702126304995e-03; -1.439130240748814e-01   -4.387166306036003e-03   -1.431519505370669e-01   -4.486485544888370e-02   +1.627043138740495e-02   -9.224732362275002e-02   +3.292310985435948e-02   +9.032607370473894e-02; +2.055093585763878e-01   -9.914030458279818e-02   -1.047603429180327e-02   -7.323577170289146e-02   +7.899412521352028e-02   +5.599320015333742e-02   +2.389220355151102e-01   -5.820922831206404e-02; +1.650432617053719e-01   -1.427338719260971e-01   +5.796151566440744e-02   -9.005276635033324e-02   +1.236368058496633e-01   +2.637056828026698e-01   -1.977080510740499e-02   +4.067703156107047e-02; +2.887404812606128e-01   +4.692581773568547e-02   +8.877068571303065e-02   +9.027851665594727e-02   -1.075778805304588e-01   -1.190938529854675e-01   +1.338324228836500e-01   -2.712652515845551e-01; -1.142463568558194e-01   -2.628325559124173e-01   -8.080354133700975e-02   +1.557793344655570e-02   -1.096641135271186e-01   -1.118576541344654e-01   -2.656359704459067e-01   -3.856269780961068e-02; -1.413377873154647e-01   +3.297705929949122e-01   +1.562638905845882e-01   -2.774853965743983e-02   -6.933715206651417e-02   -1.025170300984939e-01   -1.814765662986953e-01   -7.391050184606979e-02; +1.142786077603713e-02   +1.260154504142624e-01   -1.690202873273607e-01   -1.893708901440488e-01   +1.141744296033366e-01   +1.247138920694132e-03   +2.165856830248412e-01   -2.168252805390078e-01; -7.686480474800676e-02   -7.000952301308699e-02   +1.112372381039069e-01   +6.854903285536385e-02   -2.034846164554095e-02   +1.590460817833579e-01   +2.731146463447393e-01   -1.425035133675247e-01; -7.335166976980284e-02   +1.982769884192655e-03   +7.531349365228740e-02   -2.708447863145027e-02   -1.967428960132353e-01   -5.424600427531587e-02   +8.156604034142964e-02   -7.828460386280875e-02; -7.485104047579368e-02   -9.707327681491321e-02   +1.168793797088540e-01   -3.376358958613007e-02   +7.803608586658076e-02   +1.372281046240806e-01   -1.713205344072944e-01   +9.107985092423881e-02; -6.682041333057243e-02   -9.764872506604150e-02   +1.188086611070282e-01   +6.390065467603770e-02   +1.801556136971395e-01   +5.255772074094815e-02   +2.474358496429975e-02   +1.446601902394003e-01; -9.715126580556191e-02   +1.814347074417914e-01   -6.512719437813165e-02   -1.590716443289130e-01   -1.619661099024352e-01   +1.315954856883180e-02   +8.627677319325859e-02   -2.021355778851032e-01];
L1E_L2E_iAMPA_netcon = [-5.947131380394065e-02   +1.073267647302767e-01   +1.394365717131303e-01   -2.210429140282360e-01   +1.014355789395124e-01   +6.498919879805409e-02   -1.150197267854798e-01   -2.877641758908836e-01   +2.715053686946527e-01   +2.603279949690852e-01   -7.469968174615335e-02   +1.993533864039256e-01   +2.752679091793504e-01   -1.086983604688651e-01   -2.823258462179500e-02   -5.171163045724447e-02; +5.789435584162657e-02   +1.765213462239992e-01   -2.228420810381920e-01   +2.638756160697872e-02   +9.045739420785377e-02   +2.136287976486448e-02   -1.272888380179878e-01   +4.198313007007488e-02   -2.342745109596555e-02   -1.812240475438453e-02   -2.291876443312323e-02   -8.310726360759482e-02   -9.344805269838902e-02   -1.128652082754036e-01   -1.778789191128027e-02   +5.585467708758883e-02; +1.471291990357034e-01   +2.200210653808652e-01   +1.173813657687067e-01   +7.356657682896259e-02   -5.657280000067912e-02   +7.277642797088044e-02   -1.531396517079094e-01   +1.355215101899442e-01   -2.289053507276132e-01   -4.373757801100167e-02   +1.302991841381738e-01   +5.576034136810235e-02   +6.013576108585203e-02   +2.017513989669038e-01   +2.369404685717573e-01   +4.229631848586519e-02; +7.398292691126042e-02   -2.388058856003368e-01   -8.631527984093354e-02   -6.220990763067707e-02   +2.105350770514211e-01   +9.516921642425590e-02   -1.569586278896481e-01   +8.148887054112945e-02   -1.003644883040412e-02   -3.846012824656388e-02   -1.926271845384519e-01   -9.136611865114229e-02   -1.907586411408425e-02   -3.995476663964730e-02   +2.093616789873411e-01   +3.074427681968640e-02; -1.885647149432296e-01   +7.215388310062028e-02   -8.083897574873156e-03   -1.177953728560726e-01   +1.334991972664924e-01   +1.150363116012751e-01   +3.581444791279758e-02   -6.027980786362042e-02   -2.174429083053561e-01   +1.897875427408451e-01   +3.510160356186061e-02   +2.163499438847996e-01   +8.168010762007767e-02   +1.177690946708650e-01   +2.507785332505453e-02   +2.611226439612820e-03; +1.209986008031316e-01   +3.940367554483054e-02   +1.768890415265979e-01   -8.258357750327561e-02   -1.152598286062785e-01   -1.250408686142311e-01   -1.027759705969216e-01   +1.429692445686667e-01   +2.193386630682014e-01   +2.134709310165033e-02   -6.883201591845053e-02   +7.315353206646916e-02   -1.424764064587002e-01   -1.751357446778411e-01   +2.741785677835861e-02   -8.623591321209249e-02; +1.495627233473175e-01   +1.674776199152857e-01   +1.116787597860673e-01   +8.479904621439355e-02   +2.137593850879211e-01   +5.528123753926783e-02   +2.433759272771739e-01   +2.026972567432092e-01   +1.458539849338985e-01   +3.381297868878591e-02   +7.051760297883455e-02   +1.529095969685772e-02   +1.511835050143129e-01   -2.211959177049133e-01   +2.295749102028264e-01   -2.957368370540774e-01; +1.638791720340514e-01   -1.110488809083185e-02   +3.571092148581649e-02   -2.725556411924077e-02   +9.204493272593364e-02   +1.163490621747287e-01   +1.562713144034581e-01   -2.395507738895526e-01   +1.332424210947176e-01   +1.948585448436276e-01   -9.886529412285243e-02   +1.107298099922424e-02   +2.088635768868190e-01   +1.234123812682911e-01   +1.371832521400441e-01   -2.367973474964833e-02];
L2I_L2E_iAMPA_netcon = [+1.625730448120681e-01   +1.490205223404461e-01   +2.227028275996513e-01   -1.145816649686005e-01   -1.202254507981950e-01   +1.655861180415824e-01   -1.500070250975033e-01   +1.561636191151009e-01; +5.045795949017604e-02   +9.318934575921164e-02   +1.973490147749150e-01   +8.408595706960820e-02   -2.526129480748271e-02   -2.609486754743613e-02   +2.830966791094447e-01   -2.686702406391877e-02; +1.123789162020027e-01   +8.811771991204126e-02   +1.111734491487405e-01   -4.842046059268430e-03   +2.726411758060734e-02   -7.261350008510277e-02   +1.537642064471067e-01   +5.878472506419284e-03; -1.837579350860690e-01   -1.455164678338544e-01   +4.642780540034941e-02   +2.475822069267106e-01   +2.905424895093910e-01   -5.324096105608896e-02   -9.308028852767242e-02   -9.592356332467572e-02; +8.574557504323338e-02   -2.424091517701092e-01   +1.709784512062831e-01   +2.868281569085113e-02   -9.457111068847751e-02   +1.962218245749974e-02   +1.706275038021365e-01   +6.358035221118313e-02; -1.526008608315169e-01   -1.017734080478463e-01   -1.263560618940772e-01   +1.528411561793845e-01   -9.697402170801951e-02   -1.057497894124785e-01   +2.917644803215458e-02   +4.877676774424775e-02; +1.239325854415339e-01   +7.980972414547732e-02   +9.368858119024859e-02   +1.506805826523234e-02   -1.344737650132779e-02   +6.809774850216005e-02   -2.995609052178578e-02   +2.484711159066450e-01; +5.713886076184929e-02   -2.845896593106306e-01   +1.824597789131958e-01   -4.245662476426132e-02   +2.381823045249977e-01   +9.316479840242764e-02   +2.784392302443097e-01   -8.244944754592826e-02];
L2E_L2I_iGABA_netcon = [-8.437618306891576e-02   -1.416414110205994e-02   -9.396745816402394e-02   -7.364848304966212e-02   -2.314217613032502e-02   +2.674807737528975e-01   +1.093260826377984e-01   +1.050384233329862e-01; -2.116678602057971e-01   +1.395331737673167e-01   -9.450221844978435e-02   +1.644195760264580e-01   -7.892816516445500e-03   +2.085828724770936e-01   +1.931965873003076e-01   -1.229982589433721e-01; +1.002103941501668e-01   +1.748307049203029e-01   -2.355007294797595e-03   +1.951115757837076e-01   -1.000397600139047e-01   -3.802832953957830e-02   +8.951319068119846e-03   +1.043860788788401e-01; +6.309456489031481e-02   +6.280453633473494e-03   +8.260084282772853e-02   +6.705727808851999e-03   +1.515321787316615e-01   +1.698766018746008e-01   +2.617551059176792e-02   +1.336279705814499e-01; +2.588283771038872e-01   +1.767745144746601e-01   +3.794298376136884e-02   +5.004875755088689e-02   -1.043614464371622e-01   +1.142308356498463e-01   -3.587688131613322e-02   -1.551902279822129e-01; +8.996338283529356e-03   -2.412485348624080e-01   -1.269643386607349e-01   -2.585312836624458e-02   -1.652164208974292e-01   +6.370191693881730e-02   +1.349636017439644e-01   +3.719619991720500e-02; +1.532344180939806e-01   -2.528832149623785e-01   +1.356493852689851e-01   +9.532604587054200e-02   -6.524066800311507e-02   +1.890071066618080e-01   -1.625239658214088e-01   -2.348982262012435e-01; -1.692396850942038e-01   +1.174537190069184e-01   +9.970218989412243e-03   -1.508615361625265e-01   -1.604803134747540e-01   -2.375502094496737e-01   +2.207042229498963e-01   +5.430759585497929e-02];
L3E_L2E_iAMPA_netcon = [-3.340192923511366e-02   -4.019642012728483e-02   -5.805625635440383e-02   -3.531180602750665e-02   +1.448549485326925e-01   +1.057732797436987e-01   +1.477971668681973e-01   -1.807896894242222e-01   +2.121106429263417e-01   -2.664883121108478e-01   -1.904026954652119e-01   -1.975870151045166e-01; +1.579081190233565e-01   +5.662787325430910e-02   +2.442511670104521e-01   -5.782874373012570e-02   -2.488383540308839e-02   +2.442689281863475e-01   +6.515932226776612e-02   -7.063948820423614e-02   +2.317278503823477e-01   -7.036610576616636e-02   -6.875712532553077e-02   -4.959456968148176e-02; -9.381178924246929e-02   +7.478897947866023e-02   -2.124481008760637e-02   +3.786812466671381e-02   +3.147786238258691e-02   -2.280833680664790e-01   +2.585766974323455e-02   -9.579369635375136e-02   -3.000322261442389e-01   +8.355306441304702e-02   -1.271543519666910e-01   -7.469698438706025e-02; -2.632560390373742e-01   -9.087802275243287e-02   +4.236143307907016e-02   -4.009344937205861e-02   +1.580597653637195e-01   -2.845703731969247e-01   +4.459456952390651e-02   -1.317785265331588e-01   +2.756133006482536e-02   -8.356752662307308e-02   -1.737730946749662e-01   +1.350295882124254e-01; +3.364810515353359e-02   -5.959690649219254e-02   +3.047388504367454e-01   -3.349142151076078e-02   -1.687924217466648e-01   +1.301139769428834e-01   +9.476702823489838e-02   +1.550846597360053e-01   +2.435010760404411e-01   +8.358407542305643e-02   -1.591923743002737e-02   +1.305642913877892e-01; +1.264723442417897e-01   +2.307492705924321e-02   -6.445012341818002e-02   +2.157630526715444e-01   -1.449305093752917e-01   +1.039499946936654e-01   +6.607656714114846e-02   +1.175082481068174e-03   -2.356506204181870e-01   -2.003029651123834e-01   -6.003068906666568e-02   -6.167712597011464e-02; -2.111845327525830e-02   +7.539800514105482e-02   -5.648539262572316e-02   -9.462295108750939e-02   -5.319944194603449e-02   +2.102573639831541e-02   +8.267530270017760e-02   -1.258629544643093e-01   +7.376974402630587e-02   -2.240187744172462e-02   +1.679675009198023e-01   +4.834105846228452e-02; -3.714835339252766e-02   +4.613179976432027e-02   +4.333620121771179e-02   +1.326363536445346e-01   -4.862768356072504e-02   -9.423801671585001e-02   -1.803687075420701e-01   -1.103967461690917e-02   -3.759839164923189e-02   -1.461276686500282e-01   +2.250964322097561e-01   -2.710317517037495e-02];
L3I_L2I_iGABA_netcon = [-1.401385580291999e-01   -3.861601436283897e-02   +1.236554498827011e-01   +2.172877022213041e-01   -3.779340136409076e-02   +8.500725855940980e-02   +4.573308701194666e-02   +9.580373349485676e-03   -5.798239503898719e-02   -3.266073317551722e-02   +1.129966712263147e-01   +6.089044150191043e-02; -6.751467190017077e-02   -1.461628646120362e-01   +2.534921491535096e-01   +7.730175396171522e-02   -2.042009805876790e-01   -1.049069608744604e-01   -4.982339847270058e-02   +1.517380555241008e-01   -2.239765817374607e-01   -1.367393679831458e-01   -3.064985632765082e-02   -5.486539933141200e-02; +1.899229017595299e-01   +1.554557744530440e-01   +1.169453593849115e-01   +1.499365358729757e-01   +1.588176056841272e-01   +1.760841985928606e-01   -5.896766865647288e-03   -7.402185717525112e-02   -1.936236910645782e-01   +8.359901357096867e-02   -1.133278482212641e-01   -4.260899817766196e-02; +1.908684088102647e-01   +5.602607015294100e-02   -1.523609100252044e-01   -1.187229721894569e-01   +5.423278185187708e-02   -9.704843873394368e-02   +6.341682486036851e-02   -8.610468048519312e-02   +1.810274743585929e-01   -1.299173444875416e-01   -1.129123553427593e-02   -1.370314134164924e-01; -1.691906161861292e-01   +1.075495083953160e-01   +4.917157632121300e-02   +1.020673962536223e-01   -1.308394183773106e-01   +4.781505038047812e-02   -3.245768732999825e-02   +2.171376625175181e-01   +1.642260600924737e-01   -1.880963465537316e-01   +2.670360314858293e-01   +1.254474911952581e-02; -1.287428771759970e-01   +4.837263476526705e-02   +1.061375989588721e-01   -2.169017696076047e-01   -2.379692993663115e-01   +2.437921138788438e-01   +1.235847680898739e-02   +8.869957960894959e-02   -6.148410425726886e-02   -1.617608537117865e-01   +9.877279502271316e-02   -1.506031157517093e-01; -1.640433578254304e-02   +6.461678899937894e-02   +7.358871803938839e-02   -4.695139011572282e-02   -7.512834795078055e-02   +4.083259988387344e-02   -1.058320439116574e-01   +1.770252649304768e-01   +1.313703309256286e-01   -7.228454251383191e-02   +1.030611526387099e-02   -5.893046071915236e-02; +1.301298996817509e-01   +1.453017284270286e-01   -2.667232119013186e-01   +1.296284819114098e-01   -1.378405554487763e-02   +1.824698654761095e-01   -1.069898448215882e-01   +3.131398864107977e-02   +1.832242878086617e-01   +3.783062985137853e-02   -2.326251755850194e-01   +1.576780865469458e-01];
L2E_L3E_iAMPA_netcon = [-1.104654345259534e-01   -9.868692983529609e-02   -7.189797839707425e-02   +2.515204851075016e-01   +6.865856424796479e-03   +1.351659109231754e-02   -8.093165027299351e-02   -4.029306390246892e-02; -2.160397636557705e-01   +2.052103829401026e-01   +5.716832228418887e-02   +1.995249446828771e-01   +1.108125782481007e-01   +3.135527821933126e-02   -1.085872147177907e-01   +1.572225134487764e-01; +1.289087148840308e-01   -2.451898458864120e-02   -2.934752323370418e-01   +1.033270006979399e-01   -1.292738820254281e-01   -2.088122579405357e-01   -1.858470335314664e-02   +1.160125777980059e-01; -8.625719545474007e-02   -2.055306658968022e-02   -1.114934018998059e-01   -1.105309660739434e-02   +2.597896415452775e-01   +1.892113433639820e-01   -1.071653404852660e-01   +1.106991655775626e-01; +9.850868660577139e-02   -1.706878350799048e-01   +1.878449633627203e-01   -4.701127048678146e-02   +2.660583978956188e-02   -6.679255096078984e-02   +1.678619978203661e-01   +2.391627423822043e-01; +1.654450082776841e-01   -1.489936933650677e-01   +9.689998013027185e-02   +5.715677482152232e-02   -8.141901043074874e-02   +8.270803046242253e-02   -2.408959782005366e-01   +1.875432268329665e-01; -1.659763098159319e-01   -5.146538341702580e-02   +1.680790148445818e-01   -3.069674443128912e-01   -8.884497201629991e-02   -9.420265008218338e-02   +2.124633410838822e-01   -1.262250892665972e-01; +1.319907760933774e-01   -4.930871386909565e-02   -1.886393553481049e-03   -4.535001745498969e-02   +2.103439762487388e-01   -4.568560764265304e-02   -4.053251969283923e-02   +3.431282514444335e-02; +2.573445272962426e-02   +1.250785386540579e-03   -1.013008644383151e-01   -9.827856766489396e-02   -1.223784290502792e-01   -1.033679004862460e-02   -7.078238148340674e-02   -1.560018597839244e-01; -8.605597788762563e-02   +2.342260652243611e-03   +1.602514204471273e-01   -2.204128141402260e-01   -3.652701561472264e-02   -8.953694095407069e-02   +3.535914369902991e-02   +7.247033234146491e-02; -1.982009945624142e-01   -7.154691538588448e-02   +1.696806462340457e-01   -9.762319118230445e-02   +4.607003437765077e-02   +1.549713507383373e-01   +1.240673184719450e-02   +1.719730625091985e-01; +7.312121489324516e-04   -9.644271434071840e-03   +6.903928063277405e-02   -4.552011764156817e-02   -1.164638939909945e-01   +1.403927246426919e-01   -2.619448406353944e-01   +1.216118205460434e-01];
L2I_L3I_iGABA_netcon = [+7.432600350299180e-02   +4.371737065585975e-02   +7.249295701190753e-02   +2.576173389112549e-01   -9.401913013210375e-05   -2.165073300428680e-01   +1.173230211226887e-01   +7.721071687113183e-02; +1.385034406725126e-01   -1.022497739042365e-01   +1.446940407273408e-01   -1.702942901914701e-01   +1.287042344140968e-01   +2.275254107563442e-01   -2.305045308951412e-02   -8.831823608958005e-02; -4.519732078998637e-02   -6.351993512679759e-02   -7.416751348739388e-02   -1.141919420271582e-01   +1.253578265341369e-01   +1.034576066620079e-01   +9.253991862373105e-02   +5.363968758644816e-02; -1.736628332563419e-01   -1.356847010431159e-01   +3.693876510219949e-02   +1.362293898887328e-01   -5.004647885625491e-02   +5.330910993329547e-02   +1.965470542519880e-01   +9.637459180558100e-02; -1.620333958627059e-01   -1.328522914700727e-01   -3.271574791806407e-02   +1.143159388163770e-01   +6.072319530760203e-02   -2.499872774605959e-03   +1.301379200913229e-01   +4.332669374121231e-02; +1.963408336039426e-01   +7.042114431991930e-02   -1.224462335231500e-01   -3.494150274716028e-02   -4.832409326080921e-02   -1.665463671844671e-01   +7.268185787336441e-02   -4.323966827393235e-02; -7.154269054540954e-02   -1.005122898020461e-01   +1.270705880169773e-01   +1.410816248124552e-01   -5.536463719571031e-02   -2.292927861723545e-01   +3.160596789809776e-02   -1.702699023635853e-01; -1.049652471700753e-02   -1.255887455343300e-01   -2.138622706443804e-03   -6.841366268044699e-02   -1.836364248310650e-01   +1.066180829648712e-01   -1.233300243281414e-01   +9.550370893394222e-02; +1.392069520787516e-01   -1.697903651188807e-01   +3.172531787238803e-02   +2.624494273991794e-01   +6.170867661336277e-02   -2.139938920348432e-02   +5.559482969102629e-02   +1.485366797875921e-01; -4.964615039339881e-03   +1.370735823229400e-01   +2.296676042538527e-01   +5.226394492848776e-02   +2.885816158810274e-02   +1.297605783416205e-01   +1.712739169124897e-01   -5.061405298889399e-02; -1.288776088764540e-01   -2.354909343064387e-01   -1.828372632670999e-01   +1.898747986758140e-01   +4.734556636751876e-02   +1.581719916082612e-01   -1.506718390159487e-01   +1.990442756735146e-01; -1.953565225453905e-01   -1.955836878652233e-01   +1.559385401790829e-01   +1.114711455042836e-01   +7.862872387849418e-02   +8.442076026986842e-02   +1.899509325245979e-01   -2.601166819096289e-01];
L3I_L3E_iAMPA_netcon = [+1.462350454569314e-01   -1.356263006255236e-01   -1.765378765918111e-01   +1.565034311384771e-01   -3.203083628424092e-01   +2.968067464683613e-02   +5.435499441483952e-02   -7.306410136643940e-02   -5.330919372278350e-02   +8.118335804087963e-02   -3.516385255328110e-02   -4.720203860537861e-02; +3.916733075424495e-02   -1.261200645384014e-01   +1.913366321777363e-01   +1.053694193210763e-01   +6.119645314605832e-02   -1.438953352079224e-01   -1.592695591184706e-01   -1.335573121429441e-01   -4.128167834492530e-02   +1.839703600545940e-01   +2.676636891609600e-01   -2.532686018398400e-01; -5.174298156084071e-02   +1.006948789495139e-01   -5.904109614140630e-02   +2.408110322503147e-01   -1.218917728186397e-01   +5.774749159021747e-02   +1.474803875944264e-01   +2.705687769711015e-01   +1.845072336640108e-01   +1.106007472303189e-01   -1.773595046177596e-01   -4.064883661042699e-02; +1.266808520119698e-01   +3.241974268281426e-02   +8.645620332597638e-02   -5.696125239740472e-02   +7.671340945588438e-02   +5.468940691324257e-03   +9.237436219101246e-02   -9.699109812241531e-02   +1.717708523196931e-01   +7.573967838595873e-02   +1.472940628971628e-01   +2.652420119520129e-01; +2.037224951174747e-04   +1.091241242715433e-01   +1.792761899462240e-01   +2.442526899158245e-02   +1.369802610056170e-01   +1.305069059327924e-01   +2.218306476606294e-01   +2.199832740555167e-01   +2.408221416263734e-01   +1.364463079092342e-01   +9.677658051087951e-02   -2.470662938116725e-02; +2.107400800220156e-01   -6.698404474338877e-02   +2.052368898152005e-01   -2.148343589301561e-01   +7.552117509403847e-02   -1.229531060610879e-01   +1.779976150785233e-01   +3.706721172611442e-02   +1.430988202667089e-02   +6.071234716114534e-03   +1.243778001585013e-01   +1.396103091100494e-01; +2.686530256625779e-01   -2.249992648009611e-01   +1.923950511119614e-01   +1.631501194976464e-01   +1.768615054757749e-01   -2.105728262313183e-01   +2.607301714865634e-01   +6.626883773838201e-02   +1.316921319662730e-02   -4.301114412592055e-02   -2.088850718636172e-01   -1.527219148429337e-01; -3.523857565501289e-02   +1.882580482658635e-01   +2.090780356014860e-01   +1.486699998624804e-01   -2.161104534020139e-01   -2.882769223281887e-02   +1.200455794087348e-01   -2.064375176883601e-01   +3.010816117816632e-02   -1.242981665502633e-01   +2.156908381215233e-01   -1.828328922641914e-01; +2.940363886617053e-01   -1.581749317514461e-01   -1.378496299623338e-01   +1.178024271216638e-02   +2.652577932771265e-01   +8.550097696906424e-02   -2.281801475740675e-01   -1.725547034039103e-01   +8.141246306313629e-03   +2.181913166153289e-01   +1.785637648844711e-01   -1.741923834981224e-01; +7.003624539467172e-02   +9.681525041429689e-03   +8.359559986839810e-02   +1.146025299460224e-01   +1.259242504049287e-01   -1.391872709215866e-02   -1.810948262818242e-01   +6.369063264088271e-02   -1.946194713164676e-01   -1.561585908951214e-01   -5.864677015735690e-02   -4.012513643140560e-02; -4.167592965493210e-02   -2.054118323706418e-02   -1.867630104617694e-02   -1.292497770500130e-01   +8.235242544565594e-02   -9.294887772931211e-02   -6.467501436684156e-02   -4.161865250706243e-02   -6.491281058768866e-02   +1.891085313289795e-01   -4.576187310609479e-02   -1.492710207044260e-01; -1.339423299017236e-01   +1.154199885141121e-02   +3.315654855225926e-03   +6.441417772073101e-02   -3.694041242395654e-02   -2.022685153718576e-03   -9.692360648372378e-02   -1.664527667252633e-01   +3.785902327443683e-02   +1.181888351018850e-01   +8.532591864635966e-04   +1.007954817634492e-01];
L3E_L3I_iGABA_netcon = [+1.337147382620244e-01   -2.495331959867131e-01   -1.969230821381953e-02   -5.314685665204475e-02   -2.203552309731743e-01   +6.514155800482101e-02   -9.864575005300762e-02   -5.709999948191072e-02   +2.986699556213130e-01   -1.405715162240127e-01   -1.705146519552289e-01   -6.821294987998064e-02; +2.290364906993220e-01   -1.815911667038584e-01   +2.587333488314468e-01   +8.420116834859004e-02   +8.164569045731936e-02   -1.439268904733094e-01   +1.838732789358415e-01   +2.968259523395052e-02   +9.859836516144987e-02   +9.104472373743464e-02   +7.908483013465133e-02   +8.698357836534422e-02; -7.182209899676035e-03   -1.672959628947656e-02   -4.480343078864853e-02   +1.603366988590701e-02   +1.811695697534031e-01   +9.546368993595117e-02   -5.230615162362313e-02   -1.380129302615067e-01   -1.004610434736151e-01   -8.611739141566831e-03   -5.436567117349612e-03   +7.101848044228545e-02; -1.670447699431544e-01   -1.650215242914862e-01   -7.687832230731506e-02   +1.382500703495343e-02   -7.920368454430933e-02   +1.385964709491119e-02   +8.925969712271839e-02   -1.870505409925711e-01   +5.511487925980194e-03   +2.257082122029622e-02   +1.375879899509696e-01   -1.178495636307469e-01; -3.837201790058251e-02   +8.331014469088743e-02   +3.441678991902476e-02   -7.838018668849452e-02   -1.854543750227442e-01   -4.012441307465524e-02   -5.003826605710394e-02   -3.228022566657024e-03   -5.305110580776103e-03   +1.431984582749183e-01   -1.828742818441685e-02   -2.803262206938963e-01; -1.558400821767046e-01   -2.260580449175616e-01   +7.172935117000230e-02   -2.946001095607330e-02   +2.128327385902094e-01   -7.374616726328065e-02   +4.154215719135704e-02   -9.522125206092991e-02   -1.007883688836864e-01   -1.222018416697429e-01   +5.373475983253544e-02   +1.135828083880301e-01; -3.359032263830829e-02   -8.899854963175063e-02   +1.764823184085843e-01   -2.975005913560136e-01   -6.819644646997240e-03   +5.372613334150834e-02   +1.955808280958450e-01   -4.708038409240982e-02   +6.772481084661429e-02   +1.803205781022790e-01   +4.086045876283396e-02   +1.125783718358965e-01; +6.167584609087945e-02   +2.022800906823662e-02   -1.207048473745039e-01   +1.849552203762259e-01   -7.895946790459199e-02   +2.730889406406831e-01   -4.418288869174484e-02   +1.279775727193100e-01   -1.956001875843381e-01   -1.686465268258069e-01   -1.699730484885378e-01   +9.302368905416300e-02; -1.454969881391269e-01   +9.843993005558829e-02   -2.936707452199959e-02   +1.074810440859567e-02   +1.221849077220892e-01   +2.660461729941511e-01   -8.652029537483011e-02   -9.785540800692291e-02   +1.966611825136070e-01   +1.395543865343996e-01   -2.662798953252672e-02   +2.025279801236398e-02; +9.454341793010695e-02   +8.377727198168022e-02   +6.958232256751876e-02   -5.941436123348939e-02   -1.228698673186487e-02   +2.785575298720091e-02   +1.987960637014769e-02   -1.629921565251368e-01   -4.276958198217843e-02   -8.731919668523021e-02   -1.304878431211639e-01   +2.031007669680888e-01; +2.969722205192715e-01   -7.278638621072366e-02   -2.602620291668886e-01   -9.861473761685027e-02   -6.816940146709680e-02   -2.686501804181340e-01   +5.447273028395500e-03   -2.226227330449554e-01   -1.103260770159493e-01   +1.447434212241969e-01   +1.078191682261973e-01   +1.223995141405205e-01; -3.754905038584745e-02   -4.799261059420979e-02   -6.678832642070402e-02   +2.706224881688327e-02   -8.831321112537835e-02   -3.112741094746741e-02   -3.765512730772808e-02   -1.210990045371222e-01   -3.424152935829514e-03   +2.603007286231226e-02   -6.514997164438778e-02   -4.285175706847107e-02];
L2E_Input1_iAMPA_netcon = [-1.555162388768849e-01   -1.947423724167635e-01   +2.068084359049392e-02   +2.554366888498584e-01   -6.963648048484107e-02   +1.849027680641264e-01   +2.266538717635627e-02   -3.042337367182372e-01];
L2I_Input2_iAMPA_netcon = [+8.958803938190138e-02   +8.736125005402368e-02   +7.756007519848754e-02   -1.536820794604965e-02   -6.368062769176457e-02   +6.262863998843438e-02   -2.607822835540685e-01   +1.426372485359758e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.04*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.9*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.1*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.9*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.1*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.9*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.04*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.9*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.1*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.9*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.1*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.9*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
