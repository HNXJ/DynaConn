function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+3.339212760652920e-02   +8.122657428159072e-02   -1.264700754555325e-01   -8.384821762646065e-03   +3.829001849154351e-01   +1.577510489704963e-01   +1.720339402706891e-01   +3.399748530796457e-01   +4.214121192972292e-02   +8.519895487670627e-02   +7.271408289024188e-02   +3.235881936295775e-01   +2.557869721575025e-01   +1.314822153034393e-01   -1.705186859113460e-01   +3.494791732815057e-01; +9.174827686373896e-02   +2.386100265314935e-01   +5.231214942966175e-01   +2.964074904772044e-01   +5.918651700157709e-02   +4.743359267920061e-01   +4.821064171357506e-01   +2.221578268344631e-02   +1.064892919642067e-01   +3.672483667062891e-01   +2.427610135153128e-01   +3.687994024737493e-01   +4.168277330049018e-02   -6.785408880289218e-02   -1.009860829715001e-01   +3.848604025527829e-01; +3.660448442653882e-01   +4.581190455941909e-01   +5.440781088785238e-01   +3.247439139241790e-01   +5.659002925482792e-01   +3.935051136130321e-01   +3.445554342039461e-01   +1.063179319031701e-01   -1.427613491235988e-01   +4.077228187498072e-01   +4.270335111318585e-01   +4.494855952232782e-01   +1.370009609485745e-02   +1.662131699349771e-01   +4.468058980591842e-01   -1.571213906703314e-01; +1.350021544169994e-01   +2.091758034569392e-01   +2.976686304716227e-01   +5.941000913390205e-01   +2.212353318539643e-01   +2.574254864470498e-01   +2.504686594315468e-01   +8.865696612391244e-02   +3.688217023575884e-01   +2.557782819349207e-01   +3.756086965136901e-01   -1.798552701616850e-01   +4.665426733529565e-01   -2.637829665559713e-03   +2.194080677432523e-01   -1.979358270774104e-02; +4.739372233461215e-01   +5.144901090153058e-01   +2.078829278856627e-01   -5.772285905600368e-02   +3.905644265853319e-01   +7.359363043173314e-02   +2.423318126069970e-01   +1.473263583392201e-01   +7.519686920362991e-01   +9.133975952630244e-02   +4.933225020038910e-01   +3.353352868703460e-01   +2.478165286698878e-01   +2.850751118598585e-01   -1.288725274945942e-01   +2.426109366218022e-01; +2.286002998637219e-01   +4.496304236246882e-01   -1.105993496873840e-01   +4.083659156288938e-01   +1.686675055691461e-01   +5.839352749619842e-02   +2.901091846710772e-01   +4.337556811852459e-01   +1.096996777822129e-01   +7.567524746781498e-02   -3.846793024945935e-02   +2.168756346603277e-01   +1.164851669557846e-01   +2.401878745752916e-01   +2.421694185847466e-01   +1.843055911044135e-01; -1.309431717413487e-01   +3.005576241272825e-02   +2.832821707390809e-01   -2.164724643683258e-02   -7.419493214700087e-02   +4.106330431429273e-01   -5.212766149439563e-02   +2.934836830463606e-01   -2.743316257300075e-02   +1.676202276965130e-01   -1.692085460481775e-01   +4.049969284550081e-01   +4.829971760293341e-01   -5.330275220760371e-03   +6.974544916474691e-02   +3.157343879798168e-01; +1.863702796617727e-01   -4.966757631419274e-02   +9.472331650803888e-02   -5.546771002050475e-02   +2.675924412919671e-01   +1.069180593091333e-02   -9.799233837170061e-02   +3.988041858116586e-01   +3.942216504848857e-02   +7.505978919534577e-01   +2.426139595927156e-02   +2.645143249805074e-01   -1.590871594256875e-01   +6.107724134551319e-02   -2.011605488491513e-01   +1.586221134477753e-01; +2.612554461225999e-01   +4.465073277949133e-01   +1.236229980221719e-02   +8.292816742435527e-02   +1.964597101797360e-01   +6.234118250802799e-01   +2.609201551008620e-01   +3.003799158858956e-02   +8.893109686110751e-02   +2.972499770670160e-01   +4.728681829678092e-01   -6.184259057392846e-02   +2.669259797895465e-01   +2.428123685506032e-01   -1.450228255109513e-01   +3.750296338333600e-01; +3.963290532211323e-01   +2.731045365571257e-01   +5.657058665618685e-02   -8.173936319368705e-03   +2.404147531995351e-01   +2.928242150533355e-01   +1.883740831996818e-01   +1.476427785676488e-01   -1.003722425346418e-01   -1.381725137004166e-01   +3.481110148524885e-01   +3.661312213086335e-01   -7.366547223474020e-02   +5.892696583657129e-01   +4.161338718932951e-01   +3.959410131770939e-01; -8.028953186980520e-04   +2.226593601138201e-01   -6.964529095191199e-02   +1.057922236547935e-01   +3.103829067177247e-01   +2.696417682091150e-01   +5.851573668196534e-02   +5.775655081914418e-01   +2.901114646613615e-01   -2.459471282137429e-02   +3.549490268418980e-02   +1.611901163308021e-01   +2.791991137383175e-01   +2.643469088540975e-01   +1.571934857847164e-01   +1.031028568210867e-01; +2.987504208585915e-01   +2.276336738531110e-01   +4.408849434956789e-02   +1.165724735228504e-01   +4.982196588929491e-01   +3.333899582490869e-01   +2.594403065648921e-01   +3.595931494134843e-01   +8.649790529478024e-02   +1.556710915252875e-03   +2.946868525184810e-01   +4.109176221317246e-01   +1.603941333619902e-01   +2.587742603372065e-01   +7.463907971359822e-01   +6.425388586102656e-01; +2.496766603385400e-01   +1.676660463695380e-01   +6.994946918265045e-01   +4.825400323459809e-01   -8.138485369594117e-02   +9.393603050783234e-02   +6.155831874635636e-01   +1.103320474496198e-01   +5.834459869966174e-01   +1.147132690794015e-01   +1.332360850351328e-02   +2.728196194398266e-01   +7.704643472727563e-02   -1.169227914378151e-01   +3.943177587208586e-01   +2.570586100350284e-01; +4.880007954469296e-01   +1.996021555177538e-01   +2.964982716184066e-01   +3.414046349427240e-02   +3.193366137369510e-01   +4.934572855099424e-01   +6.483695479685278e-02   -1.742733442776948e-02   +2.959969145193734e-01   +2.652974921445013e-01   +8.868249209425694e-02   +3.221862293805861e-01   +4.946953174804671e-02   -2.821247371842174e-03   +3.499631234257347e-01   -5.604852819004691e-02; -3.284086865432039e-02   +6.141279662307848e-01   +3.785561222263607e-01   +6.299296492820690e-03   +1.096677624911941e-01   +2.220142689057706e-01   +3.807697430768295e-01   +1.518962877175601e-01   +2.723735285985374e-01   -6.742133550416389e-02   +4.170676028480802e-02   +3.922347595370494e-01   +3.422882403353392e-01   +4.573351917778827e-01   +1.776589560970294e-01   +1.179477604690530e-01; +6.531318842040387e-01   -1.502527517460613e-01   +1.398789606392216e-01   -2.452459939598680e-01   +4.416039245177442e-02   +8.920287749751832e-02   +6.824780797463424e-01   +1.635317551906987e-01   +4.293972005413461e-01   +1.756216843939674e-01   +2.884649844005595e-01   +2.254126974590082e-01   +4.534381735105391e-01   +8.028675289377474e-02   +4.153244120936330e-01   +5.285695236046342e-01];
L1E_L1I_iGABA_netcon = [+2.425087534320245e-02   +8.433382364082480e-02   +2.173585248569035e-01   +5.291184677745168e-02   -7.518880138842426e-02   +1.593007272733899e-01   +3.143757098937856e-01   +4.393861476020492e-01   +5.696216729778834e-01   +3.979800643148221e-01   +5.672085194696077e-02   -1.669578276401808e-01   +1.722821194154797e-01   +2.290607610836365e-01   +3.704585313234117e-01   +3.984373339464429e-01; +4.229226746974822e-01   -2.649896505144828e-02   +1.134087014232966e-01   -1.322732317685599e-01   -1.311856280971102e-01   +4.122320250333947e-01   +2.364224368252568e-01   -8.092153463239402e-02   +4.038020716414122e-01   +2.630045320491760e-01   +2.953905022266843e-01   +1.502159647937404e-01   +5.634843814807867e-01   +2.392449315139935e-01   +4.685155606142801e-01   +2.802698962106818e-01; +9.500589788508922e-03   +3.367261022577936e-01   +3.042250701645548e-01   +2.716049853423444e-01   +3.253741652285181e-01   +6.533397916980078e-03   +5.693529301942415e-01   +1.984584454653293e-01   -1.365081535097235e-01   +3.918478815178764e-01   +4.282203743347880e-01   +1.087281639516917e-01   +1.644200893756682e-01   +4.082611554362360e-01   +4.260465935509989e-01   +3.558493194605817e-01; +4.492578610473351e-01   +1.296859051386748e-01   +3.216787202976579e-01   +3.522273469250369e-01   -4.676508978390460e-02   +2.517330814966707e-01   +2.884976123401081e-01   +1.206476523535812e-01   -1.818128342418766e-01   +4.060898770518888e-01   +1.541944457490770e-01   +2.807045133175465e-01   +4.123764867016983e-01   +1.557743437817015e-01   +4.361197285464209e-01   +9.527386438067503e-02; +1.922557774085476e-01   +3.699751623698057e-01   +2.251694340126320e-01   +3.436775303524080e-01   +4.569147157489962e-01   +2.986821676754008e-01   -2.781793260792004e-01   +4.127977869534616e-01   -4.627142737912619e-02   +5.543133214003262e-01   +3.973860289126163e-01   +1.035751832136635e-01   +8.571543307083428e-02   +3.493243876932089e-01   +3.823666069747901e-01   +3.909143024721368e-01; +1.900297525959130e-01   +4.768180876536554e-01   -9.029957400829423e-03   +1.690602004141051e-01   +4.834648632970966e-01   +4.140526814868708e-01   +4.722914398909364e-02   +4.348768678884956e-01   +3.792343860226943e-01   +9.917532605972035e-02   +3.288930899257174e-01   -6.571862737841822e-03   -1.901677483271362e-01   +2.827162095089576e-01   -9.817009375134267e-02   +5.037173130137456e-01; -1.754768587681804e-02   +6.824804489701264e-01   +2.517625981004118e-01   +3.259656584580254e-01   +5.853356739236171e-01   +3.502551965916931e-01   +6.281420214538053e-01   -7.219952120943417e-03   +3.210878391268236e-01   +1.073468040417782e-01   -1.166905248272778e-01   +1.552261387681576e-01   +5.602245773090399e-01   +3.445707775908001e-01   +4.206579353462827e-01   +3.520343038300439e-01; +1.156921324179149e-01   -8.515218246743311e-02   +4.902195348977745e-01   +3.795146492367185e-01   +1.380621995674019e-01   +7.152031973000919e-02   +3.539364640635211e-01   +2.964919579227149e-01   +1.991314015222502e-01   +4.770696226824017e-01   -1.259122643316759e-01   +2.026968284620062e-01   +3.756844745804377e-01   +5.692122937543768e-01   +2.895791330140088e-01   +2.968037189992724e-01; +4.621192823402797e-01   +5.627445412853906e-01   -8.175913764654708e-02   +2.907781545332327e-01   -2.062597046408567e-01   -2.490943562395010e-02   +9.886941036914515e-02   +1.419157812353747e-01   -1.946462150340655e-01   +3.426767781217883e-01   +2.517458055803758e-01   +4.047885959116984e-01   +3.896327790183092e-01   +5.140669786109573e-01   +1.497988283396229e-01   +5.036486545497585e-01; -1.917732486398178e-01   +1.557224988127057e-01   +1.483976412115953e-01   +6.542103881481806e-03   -9.395491243334705e-02   +7.284626164579958e-01   +7.369140581940599e-01   +3.297600918458377e-01   +4.501104989967590e-01   +2.102518443621623e-01   +3.680316810682840e-01   +1.014905336258421e-01   +1.051416301957599e-02   -7.750926203923972e-02   +1.975574957298685e-01   +4.869710407782438e-01; +6.282083685232344e-01   +2.095187214016671e-01   +1.952966887775282e-01   +1.845014235335635e-01   +1.788691670977556e-01   +6.161795358599834e-01   +1.864264445990809e-01   -9.173480930685271e-02   +4.831303700510783e-01   +4.991499432300020e-02   +4.625080885369108e-01   +1.987039061292036e-01   -9.857178084592656e-02   +2.543889549355341e-01   +3.070270466253779e-01   +2.373071577434368e-01; +3.617909793544008e-01   -8.247335931503419e-02   +6.688961337697795e-02   +3.248325502690083e-01   +5.854289571042242e-01   +3.799822896994917e-01   +8.312338159325089e-02   +4.095349089558962e-01   +1.517512071534876e-01   +5.909006034098940e-01   +2.318827628752869e-01   +4.246053536441621e-01   +3.750596967820523e-01   +6.808677226731249e-01   +4.307202240368810e-01   +4.178813566841860e-01; +3.724001381061335e-01   -8.656479621783057e-02   +9.347316822730732e-03   +5.442082203177703e-01   +2.083771457687744e-01   +5.800959484950039e-01   +5.112327336503821e-01   -8.499084234830873e-02   +2.592117393364280e-01   -1.714856971071241e-01   +1.869324639988049e-01   -4.396439031271131e-02   -5.531766604778626e-02   +1.349377650104170e-01   +1.788265654725714e-01   +3.006579983331877e-01; +6.114275927890956e-01   +3.160083749982375e-02   +1.941946635774330e-01   +3.693579989867582e-01   +2.696661870810385e-01   +7.734745906746462e-02   +4.736593252025092e-02   +9.308360212268822e-02   +6.174765480983121e-01   -7.570335278657689e-02   +4.121840976466686e-02   +1.970749432431737e-01   +2.917265522979746e-01   +5.682438096808811e-01   -8.375914608348342e-03   +2.440237354691402e-01; +6.081318721859162e-01   +2.153469557156744e-01   +4.009677410816403e-01   +1.551779049606499e-01   +5.031239180235515e-02   -1.485409049336694e-03   +3.702709106423874e-01   -9.696623857146849e-02   -1.312151514101810e-01   +1.136227844584410e-01   +2.237535128117340e-01   +2.263210558124137e-01   +3.681906512969201e-01   +1.945137232937368e-01   +4.214903372604926e-01   +2.381824255342037e-01; +3.242468314599951e-01   +5.188923843566182e-01   +3.462963120623561e-01   +2.253037703442639e-01   -6.533184529968193e-02   +1.998471261101902e-01   +4.919685110039919e-01   +3.912446621508506e-01   -1.184145775305578e-01   +4.237458808173352e-01   +4.208050904775025e-01   +3.491422078220274e-01   +1.365371829618162e-01   +3.617892649653494e-01   +2.448175290329557e-01   +5.101477174587784e-01];
L2I_L1I_iGABA_netcon = [+5.146758133774665e-01   -1.090645058283159e-01   +3.667291857403843e-01   +1.972118509419503e-01   +4.301981292559025e-02   +3.044081491285633e-01   +2.736306867119465e-01   +6.868715477103672e-02; +1.350049429363626e-01   +3.188352383908720e-01   +2.131474387094188e-01   +1.098704610263605e-01   -6.603760416671212e-02   +3.827746851137577e-01   +2.636603144288494e-01   -4.751762045465371e-02; +6.742154045329792e-01   +3.158349039048062e-01   +4.547929731948095e-01   -6.537718413692543e-02   +3.421432977915950e-01   +4.127468013588360e-01   +1.341104287867308e-01   +1.073129815150267e-01; +3.459080367009282e-01   +1.749829898172103e-01   -1.527066635169076e-02   +6.879290615732365e-01   +1.578290352174428e-01   +4.599949076120352e-01   +5.724845122730959e-01   +3.757022009782505e-01; +4.513671937806382e-01   +6.093406359342258e-01   -2.199844458692075e-02   +2.802159134853101e-01   +3.293013721405953e-01   -6.553869756846153e-03   +2.239586358984246e-02   +1.501465972800235e-01; -3.054713747026678e-02   +2.297393837947807e-02   +5.857342708731240e-02   +4.507549050211355e-01   +1.929036045094673e-01   -2.733203643263120e-03   +2.234964351161029e-01   +3.287630644439801e-01; +1.311323675875525e-01   +5.157389707396685e-01   +2.519219323767800e-01   +2.490494314207960e-01   +2.103765285607353e-01   +4.368893065156608e-01   +4.935039523527426e-01   +2.304790735797601e-01; +1.197688581841337e-01   +1.537832102790201e-01   +5.618702537321090e-02   -1.119864349382280e-01   +4.251743536529746e-01   +2.944524829865998e-01   -1.676698880318379e-02   +2.174147094624364e-01; +4.158931826677575e-01   +1.034521095925132e-01   +2.766872926400440e-02   -5.248752139677354e-02   -3.170714427150869e-03   +5.987225764246041e-01   +3.078699782447323e-01   +1.640763529706254e-01; -1.213661654574716e-01   +2.470355074672618e-02   +1.838283833642846e-01   +3.974631269386394e-01   +1.754974867174831e-01   +4.557529472108173e-01   +8.633751892641969e-02   +2.797183009173543e-01; +5.505888439996030e-01   +3.460953519491221e-02   +2.351418406657817e-01   +4.642380234852938e-02   +1.172175704138451e-01   +3.711985700107572e-01   -4.721878790762599e-02   +1.645402048675723e-01; +1.363658340317070e-02   -9.708795234978619e-03   +3.122403704918770e-01   +1.961565931645948e-01   +1.101643942153266e-01   +4.549001717074380e-01   +1.131983901373278e-01   +2.137385112842608e-01; +4.267118575765305e-01   +1.212870544127093e-01   +1.665361303138766e-01   +3.671229468940527e-01   +2.602304411779613e-01   +5.621000108593960e-01   +4.592691975837674e-01   +4.474979874053165e-01; -6.092032824512462e-02   +5.168270755969874e-01   +8.467105143475573e-02   -1.574839597729281e-01   +2.657967187196139e-01   +2.209448636737697e-01   +1.107326303786466e-01   +9.801416214867169e-03; +1.577373747639526e-01   +3.715648106826770e-01   +1.421113609497763e-01   +2.794365925952442e-01   +5.169231590960827e-02   +2.394666121729919e-01   +3.100766770840486e-01   +5.655760561445464e-01; +1.276874868903284e-01   +3.539998896900632e-01   +2.238920406246306e-01   +3.926320589397599e-01   +2.206340090732882e-01   +1.232793313658148e-01   +4.197122141454057e-01   +2.275318270674928e-01];
L1I_L2I_iGABA_netcon = [+1.038974886258624e-01   +9.089792916732937e-02   +3.553542041556547e-01   +3.364562157814579e-01   +1.653330430679380e-02   +2.825912756935750e-01   +2.183809824573015e-01   -3.006217568980358e-01   -3.869321597315346e-02   +1.735671601116228e-01   +9.621472167431620e-02   +1.254378333981009e-01   +4.269073430429665e-01   +9.152861256569542e-03   +1.927185856945314e-02   +4.118643301729076e-01; +3.955512303340019e-01   +2.283445037053454e-01   +3.675608114208585e-01   +2.593185043359508e-01   -1.677028909811086e-01   +7.831620392224906e-02   +2.399559215193100e-01   +6.160238396271360e-01   +2.042141079706442e-01   +4.730565092392815e-01   +2.796949288411010e-01   +3.486410905691784e-01   +2.172796365840920e-01   +1.851696909823267e-01   +7.558563140501542e-02   +2.818287810102371e-01; +5.873558190066047e-01   +3.448600535714415e-01   +4.075826386722258e-01   +1.806771803939738e-01   +5.188432688809548e-01   +1.259219196553825e-01   +2.465582965289136e-01   +1.821338755072894e-01   +2.304889974876583e-01   +5.254060435036414e-01   -1.234687341697319e-01   -2.298067310887600e-01   +1.870750164646362e-01   -3.060569618820140e-02   +6.099326924258520e-01   +3.996745404594428e-01; +1.383677594579632e-03   +5.772108303356022e-01   +8.275827258433124e-02   +3.105734185896636e-01   +2.336785390402342e-01   +4.037628521536046e-01   +1.910859969398834e-01   +3.322084744480887e-01   +3.910324868630057e-01   +5.643842829665808e-01   +2.086612987876783e-01   +2.642746294102031e-01   +5.737721727949234e-01   +3.886933726666540e-01   +3.626599423941573e-01   -2.266933800990061e-01; -2.458692200713970e-01   -1.529154054971213e-03   +4.659660516620963e-01   +2.413016755756237e-01   +3.809523192447567e-02   +1.865555967325647e-01   +3.408055296337683e-01   +4.420740568789906e-02   +1.291957790928864e-01   -7.613989305955209e-02   +6.810918504020899e-01   +3.353628960064201e-01   +1.791289950672469e-01   +7.317235812193876e-01   +3.743181738147084e-01   +3.403853869496543e-01; -9.361199793937117e-02   +1.121103613640452e-01   +6.218067772262126e-01   -1.742605559833425e-01   +5.007185744612033e-01   +1.522479052032922e-01   +4.957028241427852e-01   +1.820859330186039e-01   +3.896244782890267e-01   +4.778740999312928e-02   -5.181498063704366e-02   +5.323755677135140e-01   +5.449907598328382e-01   +2.074811276286071e-01   -4.894454280690046e-02   +2.379255409850805e-01; -1.526055423279990e-01   +5.580361743861382e-01   +7.219044824368412e-02   +4.811693421648406e-01   +3.623914725218642e-01   +5.235839104510209e-01   +1.693526595082190e-01   +8.775319862412592e-02   -1.695100397917599e-01   +2.594093376025284e-01   +2.741843618501885e-01   -5.731896243576812e-03   +3.256683102665827e-01   -1.088963037681877e-01   -3.486675007058150e-02   +3.257189900068126e-01; -4.243652630415710e-02   +5.356114083828531e-01   +8.651425118071228e-02   +6.094467736290047e-01   +2.514736996146853e-01   +3.185132151010039e-01   +2.164252195664059e-01   +3.518332817563388e-01   +2.694710514048781e-01   +2.829889389522386e-01   +4.513062018920920e-01   +3.523882474468209e-01   -2.163643260022290e-01   -1.365841123380667e-01   +7.303225998867177e-01   +8.560805407965268e-02];
L2E_L1E_iAMPA_netcon = [+5.595418732150869e-01   -4.970104305877561e-02   +4.481074879593417e-01   +4.170393990050009e-03   +1.726829483382103e-01   +3.199311913515184e-01   -8.314536432082512e-02   -4.990938362949285e-02; +9.037990492477460e-02   +3.908582368833460e-01   -1.583141253508196e-01   -1.102277939354651e-01   +4.710687511018613e-02   -3.093994107317369e-02   +1.736119748192816e-01   +3.663478130404854e-01; +1.360218105600986e-01   +3.918259711258411e-01   +3.116990650591562e-01   +8.887141093857961e-02   -1.195480935075275e-01   +3.731500057135107e-01   +5.652720410206261e-01   +3.036452525000717e-01; +5.616775379510488e-01   +4.900208262720160e-02   -1.316051238246536e-01   +4.953876680556260e-02   -5.275382012817102e-02   +2.810170630024747e-01   +1.084926917927372e-01   +6.095081645092727e-02; +4.076204014732132e-01   +2.341743072820033e-01   +3.033340391904905e-02   +1.281910988096503e-01   +2.865423332416789e-01   -2.454743371526248e-01   -2.269526537910894e-01   +4.598701136190955e-01; -1.547739918106626e-01   -4.829793148672198e-02   +1.686102204162460e-01   +1.123897418986877e-01   +1.538214447703314e-01   +5.636692570602668e-01   +1.558606794820634e-01   -9.583775176260931e-02; +3.137312525719547e-01   +2.063156925430890e-01   +4.300069594626120e-01   +3.825839668188452e-01   +3.412072048984893e-01   +7.963550675581475e-02   +3.788669215388931e-01   +7.577464864872896e-02; +1.309050621090036e-01   +4.688718385081879e-01   +6.284353960270143e-01   +2.587607349972392e-01   +3.811299308091440e-01   +4.743507367867930e-01   -1.028940737154062e-01   +1.580776042239798e-01; +3.242568359765500e-01   +1.082153532510673e-01   -2.288889472451911e-02   +1.810296934743111e-01   +1.457787702669728e-01   +5.739092649404373e-01   +3.117934120611359e-01   +4.557388800863856e-01; +2.498851179463700e-01   +1.337358339591150e-01   +1.819065993591536e-01   +4.175547268449654e-01   +2.611626690969646e-01   +2.176425559080033e-01   +3.791375425392213e-01   +1.396754099680611e-01; +3.205167738448231e-01   +3.545442946221258e-01   -1.558788363754495e-01   +3.447808379680176e-01   +1.061088637150495e-01   +2.803998809266821e-01   -4.473468895457648e-02   +5.374362579807440e-01; +1.487701717045830e-01   -1.662712707004396e-02   +3.022857557215679e-01   +1.032991359581015e-01   +1.509262721850004e-01   +3.792629040059638e-02   +3.031089816787322e-01   +1.533556637581754e-01; -1.099657530093424e-01   +2.891943118782431e-01   +2.334140690294509e-01   +5.571080980420460e-01   +4.513938958930672e-01   +3.777743115564504e-01   +2.607060044045637e-01   +4.855079909377141e-01; +2.915716322149863e-01   +5.555837910256116e-01   -1.100114214974517e-01   +5.325418731781372e-01   -1.297162668443262e-01   +1.260002933012830e-01   +1.714118535744081e-01   +2.403924611212189e-01; +3.095437141855086e-01   +1.692536364688546e-01   +4.153540657326213e-01   +1.797168158847575e-01   +1.700565340437740e-01   +2.511203539235320e-01   +6.013062078248824e-01   +3.371947201612488e-01; +1.611367652602871e-01   +2.746457937689093e-01   +4.638637506556248e-02   +3.734790871412587e-01   +2.291375444398164e-01   +1.424378880440201e-01   +1.527733268296543e-01   +5.277296962723648e-01];
L1E_L2E_iAMPA_netcon = [+5.386005588513298e-01   +4.927863783059176e-01   +5.081050542688997e-01   +1.087956335735210e-01   +1.667091140632954e-01   +4.586919607115144e-02   +2.445044793319159e-01   +2.751235205968360e-01   +5.419073482437052e-03   +2.343980127799286e-01   +1.918590789423006e-01   +1.300053568068759e-01   +3.672117837420916e-01   +1.717263583648574e-01   -1.866472029263419e-01   -2.152921092426184e-02; +2.457843936817602e-01   +1.062601618047018e-01   +4.104483282258155e-01   +4.094778459808547e-01   +9.482993451508145e-02   +1.353909385017482e-01   +4.089188002511370e-01   -2.822269925035720e-01   +6.544125404660510e-02   +3.836494440683607e-01   +8.840855749246537e-02   +7.275893543823369e-01   +4.057230733532466e-01   +2.343074538298262e-01   +1.480938122903911e-01   -4.552877736244349e-02; -5.209959623210066e-02   +1.671031764751339e-01   +2.336051077205392e-01   +2.058602530330436e-01   +3.564616445955754e-01   +4.328363808917571e-01   +5.034534366988114e-02   +1.573658101408366e-01   +3.297243464096193e-02   +4.908825665295989e-02   +9.906298699060218e-02   +8.832967084829758e-02   +7.116626060368437e-01   +1.219294297450988e-01   +4.856348421707520e-01   +2.229237351019060e-02; +4.183568715894964e-01   +1.904428909078093e-01   +3.446927886829274e-01   +1.687479914732987e-02   -1.106974224462600e-01   +5.532443141392263e-01   -3.590222379012116e-02   +4.047396929883626e-01   +1.499897623645617e-01   +4.588752828826287e-01   +3.799062949870759e-01   +2.872553823754285e-01   -8.571345422653526e-03   +3.843641587129279e-01   +3.933641751194217e-01   +4.798348659961806e-01; +1.550894172105371e-01   +6.206360605204971e-01   +3.370845210282180e-01   +4.316985017617974e-01   +3.078575772781497e-01   +3.401164612722046e-01   +6.364825478807876e-02   +2.939482981312784e-01   +1.371789784442884e-02   -1.374059056963020e-02   +2.764482907131852e-01   -2.155277110819754e-02   -9.130840336587552e-02   +2.662795369505598e-01   +4.567981432166568e-01   +3.726115874662771e-01; +2.930782165394210e-01   +1.460378577072479e-01   +2.199950455947597e-01   +6.016580287087634e-01   +3.747660858369027e-01   -2.267289911599263e-02   +2.606771981560419e-01   +2.861891760289003e-01   +4.889188547985651e-01   +6.919929302689384e-01   +4.308022646388193e-01   +1.500289913834832e-02   +3.179087562334501e-01   +1.941038374332935e-01   +2.324521667944818e-01   +2.212395985333363e-01; +1.037533265370968e-01   +2.234213998707946e-01   +3.697714713143662e-01   +1.052982362383466e-01   -2.321379160717964e-01   +2.916637573524274e-01   +6.146684771752846e-02   +3.046474025107984e-01   +5.765533023539365e-02   +3.024319073593525e-02   -2.433212074604743e-01   +1.483615123699302e-01   +2.900933081250407e-01   +4.502497312984002e-01   +4.418470262659359e-01   +3.570048917997246e-01; +4.060208569899667e-01   -1.503149701996056e-01   +5.463261320137274e-01   +2.994271557932108e-01   +5.752000003845584e-03   +2.420465587752637e-01   +3.275893581192609e-01   +8.086862051565048e-01   +1.284240501488834e-01   +1.778998732371805e-01   +3.891964771318703e-01   +1.513919214090703e-01   +6.912641609119412e-03   -2.179980650606113e-02   -2.930053821254680e-01   +1.050346506396547e-01];
L2I_L2E_iAMPA_netcon = [+2.173000785555285e-01   +1.787457762483856e-01   +3.671011417126037e-01   +3.361062137894085e-01   +8.128254563118488e-01   +4.581775159779618e-01   -2.738492661635201e-01   +4.697654247857303e-01; +3.689613982902411e-01   +3.881872707306156e-01   +3.201131626815752e-01   +1.761405598922486e-01   +1.789365340262123e-01   +1.196797559758972e-01   -1.692715887451755e-02   +4.270990201356666e-01; +2.167549309205044e-01   +1.599909526635602e-01   +1.981545937428718e-01   -1.524873990702538e-01   -1.013499294655678e-01   +2.251930931326892e-01   +5.835843090698188e-01   +2.884986445902030e-01; +1.696701630493255e-01   -4.050777392783513e-02   +2.516550188369715e-01   +4.073100439916591e-01   +3.927170390704770e-01   +2.109366887031692e-01   +2.802301517652788e-02   -4.289958959307598e-02; +1.872836974976932e-01   +5.547975936867870e-01   +1.064497895767827e-01   +4.513043191786698e-01   -6.473341603840433e-03   +3.610947864240928e-01   +2.768111045869759e-01   +6.094580268588859e-01; +3.325668323021368e-02   +1.623287934442236e-01   +5.356937261041917e-01   +3.824960615833273e-01   +5.245083124807647e-02   +3.766172099990636e-01   +4.693205864290622e-01   +3.558997886123303e-01; +1.182346345210407e-01   +1.604740876927447e-01   +2.959172893806568e-01   +6.651755701305763e-02   +6.247086155786313e-01   +2.848712570024826e-01   +3.954187981984015e-02   +2.387490268038632e-01; +2.080151430288951e-01   +4.748945597148433e-01   +1.906832732623461e-01   +2.802556170636179e-01   +5.169066448729374e-01   +3.214532746743805e-01   +2.274066071269905e-01   -3.485990979169131e-02];
L2E_L2I_iGABA_netcon = [+2.980148352325088e-01   +2.841443041924295e-01   +3.872119543852190e-01   +4.344829977957662e-01   +3.063038102087607e-01   +4.264482320732622e-01   +2.225856108239682e-01   +2.103451195862572e-01; +3.724644458574009e-01   +2.768978621057809e-01   +3.976163220371327e-01   +1.262784956298634e-01   +4.291174950037674e-01   -1.530725305930543e-01   -2.348832901204122e-02   +3.846331495847125e-01; +1.086140518085242e-01   +1.000074373440870e-01   +1.339735435693715e-02   +4.689726133323144e-01   +3.462675237930912e-01   +7.459651984504894e-01   +5.637073847035842e-02   +2.806993576551698e-01; +1.259181073935736e-01   +2.703697545800238e-02   +2.910241307721163e-01   +4.099911407279641e-01   +1.917417938313546e-01   +3.229041043805779e-01   +2.276005237742011e-01   +6.117790493555146e-01; +4.041458835373986e-01   -1.320441007466113e-01   +3.054423125800603e-01   +5.691604493197034e-01   +1.315671028213515e-01   +1.951255889678781e-01   +2.599109153620429e-01   +3.935841252601809e-01; +5.246466267558703e-01   +8.535797470895369e-02   +2.142846108864043e-01   +4.199007929431176e-01   +2.723852567455657e-01   +5.045133472460990e-01   +1.866336481241143e-01   +2.449923435756848e-01; +4.162415154429049e-01   +2.713588857337523e-01   +9.774946980706381e-02   +2.796399362354480e-01   +3.670927021194539e-01   +6.164097847008725e-01   -2.349278557959129e-01   +7.798343375575685e-02; +6.492765447186634e-01   +4.090488208511213e-01   +5.175345968599834e-01   +3.335538166079326e-01   +3.963187076281885e-01   +3.551385402264176e-01   -1.142069531527818e-02   +3.535740897822313e-01];
L3E_L2E_iAMPA_netcon = [-5.174097706526651e-02   -6.446880911805572e-02   +2.994037352397355e-01   +1.086896870927393e-01   +2.649615019273746e-01   +4.551190733031458e-01   +2.224830443643182e-01   +7.445065809023682e-01   +4.162148093415986e-01   +1.858340995116469e-01   +2.339556765023368e-01   +4.680867166038046e-01; +4.660303116311068e-01   -8.255231446219935e-02   +2.716296314818885e-01   +6.345444871321076e-01   -2.955241111174384e-02   -1.643893846898070e-02   -4.538849030126589e-02   +1.822862960353086e-01   -7.391436582646177e-02   +2.023258201025089e-01   +9.477403802759386e-02   +2.121201545794332e-01; +3.415118001202276e-03   +1.753420046900397e-01   +1.477996321062655e-01   -2.228392294708950e-01   +8.928913562302711e-02   +2.535926724840263e-01   +5.811325249786750e-01   +3.259474867700289e-01   +4.651727363914214e-02   -1.188598028863738e-02   +3.406099356939524e-01   +2.284651656746867e-01; +3.932655637643623e-01   +1.138735519977521e-01   +5.758616413136137e-01   +2.419153938021983e-01   +1.845674056073491e-01   +2.838166918621910e-01   -2.015582760603334e-01   -5.527218845771541e-02   +4.631317328691190e-01   -1.168005500152562e-01   +3.380016229572508e-01   +6.165967598379231e-01; +2.696420281091327e-01   +3.433184673192763e-01   +2.811420997130737e-01   -3.840130768809491e-02   +2.973429222802865e-01   +1.912001734699582e-01   +1.863155746061632e-01   +2.707332338833656e-01   +1.958709134477303e-01   +4.959316284636651e-01   +1.567343859820862e-01   +3.076515604088136e-01; +8.420159984128676e-02   +3.653414119520433e-02   +3.627313723229862e-01   +4.598009824012616e-01   +8.437577423074528e-02   +5.823897004655045e-01   +3.303408897021449e-01   +1.611370199269503e-01   +2.952131033218238e-02   +4.466552068697490e-01   +1.355841812687525e-01   +4.884839380667566e-02; +7.335418598673190e-01   +2.169847758509942e-01   +9.591007559676672e-02   +4.291665681152153e-01   +3.211714638981980e-01   +3.757626451279209e-01   +4.475227902755466e-01   +6.052853706729650e-01   +1.977371144709638e-01   +3.329458804318012e-01   +1.724996336338036e-01   +1.088980531324069e-01; +1.555094806686896e-01   +1.398270575650193e-01   +3.941626126912997e-01   -1.199407727793707e-01   +2.255807126555315e-01   +2.184089729282466e-01   -2.000984553863830e-02   +1.649657721056288e-01   +1.877390341387039e-01   +4.466259621462573e-01   +4.143209273256930e-02   +5.008106576721078e-01];
L3I_L2I_iGABA_netcon = [+4.950051601953298e-01   +5.482120415464139e-01   +3.816537507686903e-01   +3.926831418488148e-01   -6.195704915840169e-02   +8.153146465586888e-02   +2.443396009209814e-02   +1.139113247136576e-01   +2.992818812095467e-01   +4.187945931455811e-02   +1.349614667961587e-02   +3.370454268727152e-01; +2.619765097536851e-01   +5.816535953176216e-01   +2.725450356953885e-01   +5.189908107122194e-02   -6.260744138434018e-02   -1.737361808511199e-02   +9.018030605951288e-02   +2.899169396127837e-01   +4.601900859882601e-01   +3.234996260019785e-01   +3.998545560495790e-01   +7.916583106188141e-01; +5.572635225802806e-01   -1.346904382139096e-02   +3.866119075716061e-01   +1.108373420352210e-02   +4.495097925267862e-01   +2.202003030478338e-01   +6.930340892615809e-02   +4.646938195102452e-01   +3.045325581808314e-01   -3.960673880046728e-02   +2.650820032947880e-01   +5.401688275080793e-01; +4.337560434483061e-01   +2.531598752895292e-01   +2.253797301210704e-01   +2.275699640743970e-01   +7.186784830524964e-02   +7.099179394158016e-01   +3.145116213935976e-01   +9.779609567593799e-02   +1.440694712407479e-01   +5.003806964922852e-01   +6.186929291129742e-01   +1.686551765357855e-01; -8.333981997826222e-03   +6.859566559668002e-01   +1.471728152276958e-01   -1.416779822100638e-01   +2.064858104553131e-01   -2.619110515742618e-01   +2.752478835472345e-01   +2.875483252449278e-02   +2.538314534371214e-01   +1.175214309546287e-01   +2.696706176636670e-01   +2.616360669564898e-01; +2.023920703389928e-01   +1.843379443850700e-01   +3.896944613572526e-01   +1.556541288512441e-01   +4.302750912787352e-01   +3.597281294360102e-01   +2.498169275971202e-01   +8.337207962312349e-02   +1.229864158275490e-01   +1.083812971022850e-01   +2.451595329397620e-02   +2.769245365645714e-01; +3.312093060715304e-01   +4.472646891110537e-01   +2.136586768844229e-01   +3.024351512311658e-02   +4.835042996511587e-01   +4.566134749956627e-01   +6.260393425904922e-01   +2.110602707440953e-01   +3.631325981577936e-01   +5.317782581283285e-01   +2.523515045508334e-02   +9.979988662118483e-02; +2.633829390829491e-01   +4.368758136998243e-01   +1.014481903886064e-01   +1.109058926381865e-01   +1.070761389003076e-01   +4.253298550750013e-01   +2.648199616949662e-01   +2.209879532008939e-01   +1.123496645990004e-01   -2.306742137258534e-02   +3.425778757716752e-01   +3.525965983844820e-01];
L2E_L3E_iAMPA_netcon = [+1.475931111962596e-01   +1.117038394882884e-01   +6.566088371688412e-01   +1.758110167950110e-01   +4.203695324691945e-01   +3.132785806176364e-01   -8.087933748278944e-02   +1.427595942888520e-01; +1.729232101539825e-01   +5.240046729458381e-01   +3.525386970329213e-01   -1.856384602467909e-01   +1.599931841115056e-01   -2.137997626050161e-02   +1.265088124240023e-01   -4.613961659280873e-02; +2.876691999601936e-01   -1.739906097897828e-03   +1.895749200405716e-01   +6.685088651206693e-01   +5.936949537987112e-02   -1.051389289707367e-01   -1.605871536575050e-02   +1.247129112315710e-01; +5.234617093204113e-01   +3.882630425592167e-01   +2.086416813881595e-01   +2.842762144860761e-01   +7.644449286266232e-02   +6.181908316731985e-01   +4.867156997007345e-01   +8.598075634739451e-02; +5.392321807282479e-01   +3.231587075237551e-01   +4.534261480891057e-01   -1.553399536896421e-01   +7.883848430049571e-02   +5.558883194087084e-01   +3.412476152653157e-01   -2.294088539744272e-02; +3.251478184221915e-01   +3.349175233954100e-01   +7.364929312130981e-01   +4.620924052203484e-01   +3.378377096607897e-01   +5.043904398586212e-02   +9.124073742290853e-02   +4.614118585808021e-01; +2.770273624134647e-01   +2.729690854066560e-01   +1.981566293422332e-01   +4.701333400486712e-01   +3.782034608435617e-01   +1.280323940585909e-01   +2.265481394108806e-01   -1.420759150729978e-01; +2.211849221715051e-01   +2.719007372339963e-01   -5.966405765416963e-02   +5.670611574825698e-01   +3.155397555048960e-01   +2.209160570872281e-01   +1.240143116273147e-01   +5.031660256615493e-01; +1.329025741725720e-01   +6.190591220788238e-02   +3.798211383774179e-01   +7.704584158738953e-01   +1.213279093917900e-01   +2.506874668155840e-01   +3.090273651513658e-01   +4.947436868467541e-01; +3.361551585684459e-01   +3.741418658255800e-01   +1.372051775851084e-01   +4.125817156909302e-01   +8.345379473545253e-02   +3.736405559126742e-01   +2.336876476990785e-01   +1.853293984838228e-01; -1.943697466939960e-01   +5.357191583042153e-01   +2.086252687243079e-01   +6.339484561608119e-01   +7.811170930095487e-02   +2.468039889184256e-01   +4.020064736004429e-01   +1.228658784614381e-01; +3.588288062215830e-01   +3.687448320446433e-02   +7.083100441215799e-02   +3.080315919663384e-01   +2.604999537461910e-01   +3.115735950195652e-01   +4.649729549313008e-01   +1.697551697721936e-01];
L2I_L3I_iGABA_netcon = [+1.882002705724928e-01   +3.583354018864774e-01   +5.778707071319171e-02   +6.039157669791470e-01   +3.463716078031233e-01   +4.676138107704797e-01   +1.945211249994728e-01   -9.715155451942181e-03; -2.356723066149546e-02   +9.182755818417263e-02   -6.398664668307011e-02   -1.269172136639020e-01   +3.664347519142597e-01   +4.327313742126703e-01   +4.376160112486925e-01   -1.136618588467948e-01; +3.834734175125958e-01   -1.334555847633520e-01   +6.386955720760523e-02   +2.831264873863995e-01   +1.431356050190135e-01   +9.458672969917956e-02   +4.444303017656812e-01   +3.403402412864073e-01; +4.384245806222862e-01   +1.847363060157084e-01   +3.238616299290238e-01   +1.472549842267894e-01   +5.262073330697085e-01   +3.786807454820863e-01   +2.434468676130704e-01   +2.663234569988751e-01; +5.186258442975637e-02   +1.071369799142056e-01   -1.469517813107128e-01   +4.130068556841172e-01   -5.252486241199734e-03   -3.173365753497877e-02   +2.373004077573682e-01   -7.104292214227614e-02; +3.090617893726630e-01   +2.148985759995371e-01   +1.912973019106788e-01   -1.247368899405181e-02   -3.044641857677021e-02   +3.258906145835224e-01   +2.953879090247417e-01   +2.251644285106688e-02; +6.957898026794328e-02   +3.141586634697767e-01   +1.568501383068268e-01   +1.886461455224542e-01   -1.934179715102710e-01   +2.560797917687617e-01   +4.640432100903075e-01   +1.094923385251793e-01; +4.896846496996407e-01   +3.911861867049281e-02   +1.705857315475882e-01   +5.028034975113695e-02   +2.471171867378179e-01   +3.672772228348993e-01   +4.655000235186379e-02   +3.161424810662354e-01; +1.654230000791720e-01   +5.334375537658610e-01   -3.986969325051128e-02   -1.121116575591515e-01   +3.078512607871173e-01   +2.551860384448651e-01   +5.031672625797313e-01   +3.929895636967075e-02; +3.347865451303502e-01   +3.385728030221788e-01   -4.982783170487444e-02   +3.508035813218434e-01   +4.398824098075238e-01   +1.283864858564008e-01   +6.876556305074312e-02   +4.880759666546872e-01; +9.100253741492240e-02   +5.829157187187274e-01   +3.112891950232409e-01   +1.073271356409126e-01   -9.381892349959364e-02   -2.412948254331104e-01   +4.003706006914622e-01   +2.243808310700294e-01; +9.725328608119306e-02   +1.516964274733727e-01   +3.115351077836101e-01   +3.029300836703753e-01   -1.780275932509703e-01   +1.857503724546126e-01   +4.059388682332887e-01   -1.003250681494415e-01];
L3I_L3E_iAMPA_netcon = [+1.288613372975155e-01   -2.351922057694403e-01   -9.390411033338703e-02   +3.388786625607741e-01   -1.998880691906429e-03   +2.757259625707074e-01   +1.501585629073189e-01   +2.805245090931618e-01   -8.503017975935742e-02   +1.806199401132811e-01   -8.227823563639156e-02   +1.728852966109413e-01; +1.534460412350130e-01   +9.082859557897857e-02   +1.349299288936653e-01   +3.900834046321861e-02   +4.608951244892455e-01   +5.171651043235437e-02   +2.311851185783849e-01   +2.938265843612134e-01   +3.710320484881712e-01   +3.246358621554736e-01   -1.558600037953234e-01   +2.660696864213913e-01; +6.109067489622947e-01   +3.872905837012330e-02   -6.781826318155215e-02   +2.867805967519602e-02   +3.076313021201135e-01   +3.581459953858013e-01   +2.280386594427455e-01   +3.545209918502439e-01   +1.648113712852481e-01   +2.197080588252505e-01   +5.217567548206771e-01   +2.383309160207515e-01; +7.350254308119003e-02   +4.231439270297597e-01   +5.135522220261928e-01   +6.123415201849315e-03   -2.795174875511501e-02   +1.807092705179526e-01   -1.275035674168641e-01   +3.646312964679652e-01   +3.007946327497812e-01   +2.193738861851184e-01   +2.871680771538373e-01   +9.603212578674593e-02; +6.755810281999624e-01   +2.973045470486466e-01   +6.090179532419379e-01   -6.218598832860958e-02   +5.890204258881311e-01   -2.380627762978641e-02   +6.025942102260432e-01   +3.148334281228132e-01   +5.047076383474075e-01   -1.194572302746762e-01   +3.198751801490674e-01   -1.381660731332562e-01; +1.751914016280424e-01   +9.726158672990395e-02   +4.650262245149165e-01   +1.744435815477118e-02   +3.032981179789502e-01   +6.512329915492591e-02   +2.268022035484188e-01   +1.540922777287731e-01   +5.777738240124253e-01   +1.471468829169104e-01   -8.440147480638766e-02   +2.883298990981914e-01; +2.320112571051134e-01   +2.979840029492732e-01   +5.247125793972777e-01   +1.110998392420300e-01   -1.426800906083229e-01   +6.410359969127120e-02   +6.307701696833909e-01   +7.655329731684422e-02   +2.857402836655938e-01   +4.871573076438492e-01   +2.947819980205909e-01   +3.107434563223921e-01; -1.461406691618098e-02   +3.831174842545403e-01   +2.543279930017588e-01   +8.616375493164777e-02   +3.441101070593784e-01   +1.662594807154866e-01   +4.951925758550408e-01   +6.330305139816848e-01   +2.679904668981494e-01   +3.049033132305153e-01   +2.334228811990660e-01   +4.483624787133332e-01; +1.146920718509679e-01   -8.576708416883627e-03   +9.545627854710080e-02   +5.376787680235046e-01   +2.178535695186590e-01   +3.088461543271782e-01   +4.961884788709914e-01   +7.202799964046334e-01   +2.560485185907820e-01   +2.316795500263698e-01   +2.565791535977149e-01   +1.623658848435580e-01; +4.293749042848314e-01   -1.256367472478370e-01   -5.473724208209151e-02   -8.993889170206346e-02   +3.178756899868428e-01   +4.630760626492266e-01   +5.640852073572280e-01   +2.580436170458313e-01   +2.348789961209204e-01   +1.917642353205402e-01   +4.079022811466726e-01   +1.240550543791526e-01; +1.007553411452869e-01   +2.853640915262053e-01   +1.336595517145475e-01   +2.835571348891828e-01   -5.990611700681799e-02   +1.779620875987288e-01   +1.106761237285252e-01   -4.211250262550187e-02   +3.856397129320260e-01   +3.709707625866046e-01   +1.695576654785522e-01   +2.782759407947371e-01; -1.439792679542369e-01   +1.326790304774212e-01   +3.084784638139795e-01   +1.004899057926339e-01   +5.839489096330019e-01   +2.155955003083181e-01   +4.985107576144830e-01   +4.538340707198424e-01   +2.838212316100681e-01   +6.429597135390133e-02   +3.314601599554771e-01   +3.340065226468579e-01];
L3E_L3I_iGABA_netcon = [+2.619902904637239e-01   +6.704234452852544e-01   +4.636749054896271e-01   +2.790872159705445e-01   -1.506532617930851e-02   +5.955932396850788e-01   +1.767101512238236e-01   +6.787577659003478e-01   +3.313643439952089e-01   +2.010084003098651e-01   +1.336724349056192e-01   +5.033027586691730e-01; +3.139375971538956e-01   +2.335643347889205e-01   +2.762873140583103e-01   +3.450429900364900e-01   +2.911261046753604e-01   +1.883931455793795e-01   +4.471632334545445e-03   +2.200580679135796e-01   +4.612248160957660e-01   +3.376160614094477e-01   +1.411362029902258e-01   +6.562787030607420e-01; +3.788797366633096e-01   +3.071469130599993e-01   +2.485271668608555e-01   +1.335731714124732e-01   +3.675574174610225e-01   +5.961206956592596e-01   +1.976447100900072e-02   +8.790052989043523e-02   -1.460653305364540e-01   +3.249606333936699e-01   +1.820643830242207e-01   +2.954485495519646e-01; -5.288341343843482e-02   +1.321792694048345e-01   +3.632221748317241e-01   +1.060718388979423e-01   -6.923118566487232e-02   +2.615455441565603e-01   +3.349158957582845e-01   +1.213798669161753e-01   +3.335686636290290e-01   -1.732669741073188e-01   +4.641766708228145e-01   +2.762915542222892e-01; +3.067610934425252e-02   +2.085040375120827e-03   -1.580959308692510e-02   -1.869338581169852e-01   +6.464828818684480e-02   -1.697047311226241e-02   +1.463833252172496e-01   +4.195407432343630e-01   +1.515191384766832e-01   +3.019789259233833e-01   -1.152251574720501e-01   +1.611082842628253e-01; +7.343391426741380e-02   +3.991184826783891e-01   +6.381807162488266e-01   +1.792869671387141e-01   +2.429874278820278e-01   +3.591857613636892e-01   +1.276852530285553e-01   -1.295372013516113e-01   -2.699275164750202e-02   +2.062837944719176e-01   +4.025019247292573e-02   +1.863527039374503e-01; +2.256336355461871e-01   +1.435888044261334e-01   +4.044183244307334e-01   +2.402766929508398e-01   +3.759640480499468e-01   +6.032042856469635e-02   -2.775258844075072e-02   +2.029861703281765e-01   +3.669547931892830e-01   +2.360256262816069e-01   +6.084037095404611e-01   +2.597195458812035e-01; +1.168150192163593e-01   +1.738342147939252e-01   +3.945536545650129e-01   +3.744281488223555e-01   +2.328170501476729e-02   -7.672401000783467e-02   +3.167603238107908e-02   +3.547060385271946e-01   +7.803546358811346e-02   +1.012605506191678e-01   +4.708021847875427e-01   +4.769889249088914e-01; +3.968035285197192e-02   +4.112537718938870e-02   +9.416979080871404e-02   +3.948912606678883e-01   -3.499336294032197e-02   +2.191934862394785e-01   -1.566385949428917e-02   -3.305597400097968e-02   +1.149481833109791e-01   +1.241613753319416e-01   +3.089878236397066e-01   +5.207162100692425e-01; +4.822065346470719e-01   +7.160846161828203e-02   +3.915703564690257e-01   +2.857863326372199e-01   +3.930732196957600e-02   +3.263595895366191e-01   -2.009124778325047e-01   +1.008928229611430e-02   +3.186310380006536e-01   +2.435497011476286e-01   +2.328053733529016e-01   +3.501929910261834e-01; +3.308700769812962e-01   +7.123494096181013e-02   +9.354580211640712e-02   +3.416185197076794e-01   +1.233595900037805e-01   +7.160717367339311e-01   +2.291863171061186e-01   +1.058264102694300e-01   +2.130731340057371e-01   +9.252890504519906e-02   +1.368230548085864e-01   -1.697215450738736e-01; -5.534934421825957e-02   +2.667591883949790e-01   +2.091180183509977e-01   +1.440426975001933e-01   +4.293162088358879e-01   +1.205548279485831e-01   +3.140778656052552e-01   +2.079969015248989e-01   +3.203161833293506e-01   +5.960269990671989e-01   +3.342795154273203e-01   +4.455456178174455e-01];
L2E_Input1_iAMPA_netcon = [+1.336846923569389e-02   +3.232677446185659e-01   +1.899375476189760e-01   +2.344282530473183e-01   +3.711250785615178e-01   +4.012616408831249e-01   +3.134057579039884e-01   +2.186681705558822e-01];
L2I_Input2_iAMPA_netcon = [+4.371226402821861e-01   +3.042780331947245e-01   +2.395481059065375e-01   +4.098759441037238e-01   +2.762455378817197e-01   +4.359052511550875e-01   +1.483756666507098e-01   +7.338359461156154e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.03*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.15*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.15*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.03*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.15*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.15*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
