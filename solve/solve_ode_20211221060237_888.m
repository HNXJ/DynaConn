function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-3.285571174055912e-01   +3.988139659757435e-01   +3.210286754528757e-01   -4.591116364436355e-01   -6.669109067862999e-01   -3.306430550522180e-01   -1.561616623974857e-01   +4.486746114072294e-01   +5.904585452902984e-01   -4.493286531410575e-01   -8.428819980587524e-02   +2.647527457110999e-03   -2.536819731440861e-01   -1.727094560618478e-02   +4.815175011468808e-01   -4.020047520168550e-01; -1.454872153941348e-01   -4.831264709933411e-02   +2.229766507981274e-01   +8.527780262590728e-02   +1.306564172160524e-02   +2.029544277577393e-01   +2.592756177783613e-01   +1.515365412583143e-01   +1.575404906144265e-01   -3.508231438777140e-01   -2.367151760657162e-01   +5.382807479744425e-01   -1.374571084950350e-01   -4.511939463916556e-02   -1.823560574825098e-02   -2.598404608607374e-01; +4.328386831910411e-01   -2.717437768401868e-01   -1.164478905928609e-01   -7.161686741153787e-02   +8.601866767137197e-02   +6.307731406823774e-01   -1.006972216346747e-01   -2.389353625212743e-01   -7.939328509844225e-01   +8.093297610365031e-01   +1.961547767741632e-01   -4.540382560927888e-01   -1.011376920952499e-01   +1.916608192862648e-01   +1.236232083047163e-01   -3.373565901148156e-01; -1.817125722094523e-01   +1.399422883888215e-01   -4.610590847210604e-01   -5.477487710518003e-01   +1.170506810882468e-01   -2.259520380337310e-01   -2.210993196324436e-01   -3.371613436216815e-01   +4.828703893134468e-01   -4.335428197306874e-01   +2.236233588408369e-01   +3.356332648366470e-02   -1.902925211347607e-01   -3.075854746957082e-01   -2.315523555285239e-01   -3.813393216238258e-01; +1.350683869341034e-01   +4.140018177237227e-02   -1.393752551259501e-01   +1.226852632922243e-01   -2.381841745702890e-01   -3.082178078108547e-01   +2.317724561982741e-01   +1.868758078493214e-01   -1.057394758702793e-01   +2.319969817894865e-01   +6.528079508471121e-01   +2.137974759058801e-01   +5.243643005383886e-01   -5.453217987072210e-01   -2.670049465307005e-01   -1.856750549182719e-01; +6.425284774235651e-01   -4.211701763655816e-01   -7.740403996798847e-02   -1.886508954723081e-01   +1.858822143214506e-03   +5.304893674167250e-01   -4.141095108873781e-01   +3.121533203327040e-01   +1.684261999926389e-01   -2.545429005227360e-01   +3.952049862762387e-02   -3.678662808889683e-01   -3.849130019819386e-02   -2.048735031289725e-01   +3.311411455551832e-01   +5.724612986362094e-01; +4.110489820586337e-01   +3.851335761325297e-01   +1.555246300883978e-01   +2.201190238430904e-01   -2.457718753040778e-01   +2.466312864935492e-01   -2.062535100544419e-01   -2.617462459754392e-01   -3.036629174356835e-01   -2.748632423647159e-01   +1.702596880903853e-01   +3.003387997596339e-01   -5.739069852055298e-02   -4.009659798266300e-01   -2.306148508621897e-01   -2.695765020578427e-01; +1.435001860533262e-01   +2.282862870423190e-01   +7.575484674808237e-01   -2.160278008755894e-01   +8.717113836481100e-02   -6.351554450170944e-01   +1.912482092762447e-01   -2.716115835989183e-01   -7.005576388983146e-01   -7.061770749445296e-01   +4.241561420388328e-01   -1.731402932145759e-01   +2.245271259502417e-01   +1.101183994684597e-01   +4.603034879695457e-02   +7.180725167640220e-01; +3.817253090267982e-01   +3.665106234066007e-02   +1.208362236135742e-01   -1.433901081068686e-01   +5.155898820990057e-02   +2.030325119375653e-01   +1.615488642143081e-02   +8.414077530441930e-02   +2.268292744130984e-01   +4.699647310460241e-01   -1.127841759991316e-01   +2.599776579498929e-01   +4.210559468596442e-02   +6.127955886670832e-02   +7.748073307747896e-01   +4.864414202957918e-01; +2.279357368153839e-02   -4.281599690054390e-01   -1.337751977585753e-01   -5.602018737938834e-01   +1.918416597732583e-01   +5.347066438559634e-01   +6.754706544542278e-01   -3.958176545103758e-01   -2.368475604918552e-02   +6.717299538418068e-01   +8.925550386839448e-02   +2.015155208351805e-01   -1.044599597846626e-01   +3.575999021854709e-01   -3.321010783686491e-01   +3.375105595540286e-01; -3.886311312139064e-01   +1.884174121908049e-01   +1.687846584335909e-01   -3.621061276488288e-01   +9.495919521732502e-02   -2.732971121110803e-03   +3.036057010492726e-01   -3.079238947386273e-01   -9.371813560271865e-02   -2.805443990886735e-01   +1.946294576628903e-01   +5.981765243619371e-01   -1.520073370629984e-01   -1.838341465767409e-01   -3.242042806408146e-01   -3.840932253124170e-01; +6.323809907459217e-02   -2.042372344177854e-01   +1.307901495019635e-01   +2.604443581458205e-01   +3.978981745940102e-02   -8.883775424214078e-02   -1.976990947519520e-01   -6.448400875170562e-02   +2.717688998833120e-01   +3.143575142996365e-01   -3.798636069628281e-01   +7.025530070284766e-01   -1.553703273680941e-01   -3.793285164661078e-02   -3.886216661153163e-02   +8.067267388937893e-02; -1.655066524756422e-01   +1.136199188090011e-01   -5.636713413287935e-01   +2.645416824015158e-01   +5.526316219055950e-01   -6.635590326393932e-01   -2.946830396911390e-01   +1.708955414467935e-02   +1.773794416423430e-01   -3.460881008882571e-01   -6.560697435373442e-02   +1.166182154804996e-01   +1.824982663472795e-01   -5.129187902354693e-01   +1.123536669266875e-01   +3.415245027233126e-01; -1.163013770719344e-01   +6.526082829655186e-01   -6.956769021967402e-01   -5.540505174138550e-01   +2.125421179147886e-01   +1.526342860081705e-01   +3.266273704861909e-01   -3.547386740462076e-01   +2.396097686336839e-01   -4.614810349523935e-02   -2.052113786669704e-02   +2.863204229690590e-01   +4.494009728092652e-01   +5.146871811848350e-01   +1.199139659316850e-01   +3.645257427550622e-01; +2.715004623173432e-01   +3.875483892973134e-01   +4.979863048857762e-01   -3.622518165324921e-01   +3.841347008992503e-01   +2.784630046870497e-01   -1.053859601673167e-01   +1.180742564137341e-01   -2.491381770255922e-02   -1.663094108605234e-01   +7.543529959389081e-01   -5.405088401085705e-01   -2.132290959720076e-01   +6.538664341862277e-02   +6.244823098739072e-01   +1.278188298141537e-01; -1.028760652423580e-02   +5.102511878824657e-02   +1.544545180194106e-01   +2.532127998577623e-01   -6.823599731651406e-02   -3.965443383578133e-02   -2.019829847532530e-01   -5.646884712448980e-03   +3.223242926290755e-01   +3.348948706347785e-01   -3.165461661750649e-01   +5.972598369110389e-01   -4.667807004419342e-01   -8.624320906244164e-01   +4.712437108267062e-03   +1.313824692703316e-01];
L1E_L1I_iGABA_netcon = [+5.208535545672904e-01   +6.289811080003849e-01   +2.127376049550019e-01   -2.583366004844623e-01   -5.776840877484095e-01   +4.819852132969914e-02   -3.697513861295733e-01   +7.024965803432717e-01   -6.259984092827026e-01   +1.121848069653953e-01   +1.083920743798109e-01   +5.741186637372701e-01   -2.140363875581040e-02   -1.752663996055218e-01   -4.541800864033373e-01   +1.945590925654469e-01; +3.101520785599117e-01   -3.677486936187574e-01   +3.340550711034738e-02   +3.001460225170678e-02   -2.973592168190502e-01   -7.754700216988103e-02   +3.292222465603935e-01   -3.025470854434030e-01   +1.763048755730858e-01   +4.566489498563191e-02   +6.846552638664285e-01   -7.236079730435776e-01   +5.662113908553793e-01   +8.252457051261874e-02   +3.029284757507549e-01   +1.415962726214748e-01; +5.166164502348567e-01   +1.286937366067754e-01   -4.384736986585164e-01   +4.423828130248942e-01   -4.070064715739481e-01   -1.029938567731745e-01   +3.880477231850675e-01   +2.616920644402044e-01   -1.329781758674624e-01   -1.142926005578478e-01   -4.578473263793943e-02   -4.207098016948568e-02   +4.325418621515476e-01   -4.683744011105965e-01   -2.492080830854944e-01   +1.723383065814113e-01; -1.176795837971079e-01   +6.478093242882108e-02   +5.182553510333692e-01   +5.762669593903137e-02   -8.637891089954070e-02   +3.392394055154693e-02   +4.747731410367562e-02   -4.790165177058513e-02   +4.354154259217893e-01   +3.002863706166925e-01   -1.637856677184198e-01   -8.507885027238256e-02   +3.255124392702393e-01   -2.502583481187852e-01   +6.044970950438344e-02   -1.636733736264065e-01; +1.042574228486622e-01   +6.080399575636437e-01   +2.799430394929047e-01   -4.294177590568869e-01   +2.572904403437726e-01   -5.152742426382171e-01   +1.370141298048950e-01   +4.460109143483033e-01   -1.571950814840109e-01   -6.844116665484945e-02   +3.506848983567976e-01   +2.869398461581565e-02   -1.399151006979999e-01   -5.496996228301175e-01   +7.527118116192014e-03   +1.047536653940560e-01; -2.618965237992801e-01   +1.820413938745976e-01   +5.251336384197862e-01   -1.963856626618600e-01   -7.231212189664387e-01   +5.528783141741160e-02   -4.623975715689975e-01   -4.416465506137396e-01   -3.175566258289908e-02   +3.157282856112970e-01   +1.609489616100979e-01   +2.511440882472936e-01   +4.190525672875945e-01   -4.827261745610059e-01   -3.895382210808017e-01   +1.192895167976846e-01; -1.955181380802014e-01   -1.986873699999582e-01   +3.205613011975204e-01   -3.565926095564548e-01   +3.519495349778746e-01   +4.107236594123888e-01   -4.605601388824537e-01   +6.016198434971655e-01   -1.982125419600682e-01   +5.906586929814376e-01   +5.104742406188134e-04   -1.944882942811813e-01   -9.873942999960775e-02   -6.359060636065521e-01   -2.187863806711773e-01   -6.225157638043850e-02; -1.856745398145521e-01   -4.383528138231029e-01   -1.500920777311817e-01   -7.962797213739516e-02   +1.562932497990738e-01   +3.502668591161846e-01   +7.882389529523065e-02   -1.741512630281580e-01   -1.745958826528267e-01   +3.426384156657781e-01   -9.287389909657102e-01   +2.089180763125565e-01   -1.069584057329506e-01   +1.065372947135499e-01   -3.447913992071636e-02   +1.961720862179163e-01; +1.056312070231109e-01   -3.620287838681546e-01   +2.024905531894508e-01   +4.760459516539413e-01   -2.597247193281570e-01   +4.912265479353368e-03   -1.698784891460156e-01   +4.648659022069539e-01   +1.419378955029054e-01   +4.602526603438027e-01   -1.701307407746794e-01   +2.813396935015459e-01   +2.537393086163298e-05   +7.453358848859808e-01   -3.964905618343252e-01   -1.435090985016536e-01; -3.010235867718415e-01   +3.752025205587499e-01   -4.507152329787187e-01   -2.888172049180959e-02   +1.613452149523935e-01   -2.293316741479295e-01   +3.016526044042777e-01   +7.522120615425453e-01   -4.215725789387681e-01   -2.994891089773163e-01   +2.367501388536135e-01   -2.715382790675398e-02   +7.776433174775217e-01   -1.010742686165699e-01   +1.698893034693943e-01   +4.953085433286250e-01; +2.508142074374489e-01   -1.106506046038342e-01   -3.070677862496912e-01   +4.089722152564749e-01   +1.442674485396102e-01   -2.795999483780016e-01   +4.407948119265731e-01   -6.280447672644205e-01   -3.675255310754462e-01   -4.209729287258727e-02   -1.871090295552196e-01   +4.907367270409944e-01   -1.640976511454521e-01   -2.263254552383515e-01   +3.317089197503990e-01   -1.801547086857015e-01; -5.230277095665672e-01   +2.873097804671553e-01   +3.861911639548610e-01   -3.505075295925930e-01   +1.623388086831007e-01   -1.912495099198505e-01   +2.369214862368844e-01   -3.587232952186546e-01   -2.874671260211896e-01   -1.829713689628200e-01   +1.513265324151195e-01   -2.986784119467479e-01   -3.234359857272131e-01   +4.943754702789622e-01   +2.363044003450300e-01   -4.944755705259966e-01; +2.466275341009439e-01   -2.084782985622777e-01   +8.445527494616948e-01   +5.880443688825585e-02   -9.761678742990007e-02   -8.673112851913323e-02   +1.716790492539603e-01   +1.316478162628973e-02   -2.651920301722908e-02   +9.572968761169201e-02   -3.279572085846532e-01   -7.529757636917239e-02   +2.812737682343360e-01   +5.275620866915188e-01   +5.130735552176645e-01   -4.008482693109401e-01; -6.755140479680953e-01   -6.635734654271171e-01   +1.127836521340099e-01   -9.702316898074097e-02   +6.602598585063463e-01   -3.281588013464304e-01   -1.610002354898679e-01   +8.510730311333503e-01   +4.433089260919887e-02   -1.157566179177377e-01   +6.536676961986385e-02   -5.358139297018294e-01   -1.716326031639875e-01   -6.148873766151330e-01   -3.193950294894368e-01   -1.180693504468577e-01; -6.881583233907959e-02   +1.651332998298189e-01   -1.303716691324613e-01   +2.667487015780656e-01   +5.599964170666875e-01   -6.157570371620780e-02   +2.128958766875326e-01   -2.730725293884207e-01   -2.892476489064155e-01   +1.052335217205731e-01   -1.462645985763194e-01   +2.091995684686729e-01   +5.922285302721382e-01   -2.969966924842788e-01   +1.048909168903227e-01   -8.823157167091314e-02; -2.163018917401859e-01   -4.773726890767632e-03   +5.684225011480319e-01   -1.422910101325917e-01   -3.462849871789906e-01   -4.984244163616067e-02   -5.242757660720266e-01   -9.668837933268548e-02   +6.840466820654464e-01   +1.652449992226290e-01   -6.881151689879632e-01   +2.161574220646354e-01   +5.198374057063521e-02   -3.453544130354805e-02   +5.222001731008211e-02   +7.664789863294477e-01];
L2I_L1I_iGABA_netcon = [+2.055254696945118e-01   -3.231358401365743e-01   -1.204044256563869e-01   +5.300634536257645e-02   +1.729068214790012e-02   +3.942785451371732e-01   +7.690808676344008e-02   +2.562416248701720e-01; +4.674805123052713e-01   +7.579663079826433e-02   -2.595448931572362e-01   -1.851128864800248e-01   +5.861165766853282e-01   -4.476207855660364e-01   -2.437649553762724e-01   -3.377201785621857e-01; -3.368668535207400e-01   -5.558637387440230e-01   -2.700504182616268e-01   -5.447059712667621e-01   +2.678009323577712e-01   +9.016460335515000e-02   -1.962705213699957e-01   -6.362947692275922e-01; +4.708466247095922e-03   +2.512166749043954e-01   +5.452840059675818e-02   -3.925397952108780e-01   -1.739654167824692e-01   -1.624878026461874e-01   -2.116499503149424e-01   -2.503354377631924e-01; -8.496799741024083e-02   -1.979011157357820e-01   -8.430856394233290e-02   +6.526038904800650e-01   +2.902353553498531e-01   +5.502606736390061e-01   +1.909478499602438e-01   -3.964043283609326e-01; +1.894050906848927e-01   +4.514545603032247e-01   -2.045514355085947e-01   -2.847261709000218e-01   -1.023261575673630e-01   -5.683630937431877e-02   +1.635621534577910e-01   +2.865971418630684e-01; -1.611844044004374e-01   +5.829251639207971e-01   +3.820858297768953e-01   -9.062383777343488e-03   -7.739376729882877e-02   +1.206774382626368e-01   +4.174191670384030e-01   +6.166187578829672e-01; -2.156148550178528e-01   -1.643940684180623e-01   -4.020769011755557e-01   +2.470769090646925e-01   +3.990263974678806e-01   -9.098285924041735e-02   +2.269414068255330e-01   +5.077511148757169e-01; +1.523472022985431e-01   +3.237744950468568e-01   +7.564982324263336e-03   +3.235882765884180e-01   +1.531735551639486e-01   +6.551009806698208e-01   +2.507166085980622e-02   -7.877674689056574e-01; +1.198241955044607e-01   +1.050108801939816e-01   +2.839988503013996e-02   +4.406583359853528e-01   -8.740955333906317e-02   +4.493728591085904e-01   -1.147808508029012e-01   -1.499905848039986e-01; -5.265169878491083e-02   -5.918199816808165e-01   -1.961166039955567e-01   +1.812254403878354e-01   +6.553201763331082e-02   -1.495075299917369e-01   -3.078520558760571e-01   -4.890282852288083e-01; -1.652107569901708e-01   -1.936577263853184e-03   +4.925920518340555e-01   -2.556783571200339e-01   +1.636327168036429e-01   +5.264225378702718e-01   -5.940265055380379e-01   -5.595117691838875e-03; +4.497108348234574e-01   +7.265277350235558e-02   -6.013096014825710e-02   -1.878286786214239e-01   +2.321847060836463e-01   -3.861473327982435e-01   -5.702741055402832e-02   -6.234869609853837e-01; +7.136949725042740e-02   +1.800613038190914e-01   +2.787990829499884e-01   +4.642465428448821e-01   -1.090143189437593e-01   +1.516150408245714e-01   +1.861470748648394e-02   -1.521218324579246e-01; -3.843975864862690e-02   +4.906674347406075e-01   -2.939160589974676e-03   -6.376764090737199e-01   +4.679193674059325e-01   +5.766018854243905e-02   +5.002262139430679e-01   -3.220405825330955e-01; +1.421551737464185e-01   +4.558507048967727e-01   -3.841206779467670e-01   -5.756898731594385e-01   -9.541492277753186e-02   +5.106474179096286e-01   -3.207060307886198e-01   +2.963428610309549e-01];
L1I_L2I_iGABA_netcon = [+1.249854396408011e-01   +5.132094522057863e-01   +3.208510665748020e-01   -5.443947361353653e-01   -6.076255167339741e-02   -1.051826629838037e-01   +5.247581812817513e-01   +1.955136539151890e-01   -2.838998349561190e-01   +1.752139028362886e-01   -1.580618033453293e-01   +6.687538611075318e-01   -4.158986505339260e-03   -2.501238228948302e-01   -1.970708271096727e-01   +2.023005885952872e-02; +6.429013629823244e-01   -9.506304479976656e-02   -7.691090303694902e-01   +3.332423465948793e-01   -5.235737464422603e-01   +3.060257950065353e-01   +8.265597902394429e-01   +2.374107737916938e-01   +1.110361020409458e-01   -5.026925117025874e-02   -5.080563538141283e-01   +2.856970300116900e-02   -1.479122211957024e-01   +3.736588807337228e-01   -6.589737984166157e-01   -2.144139431945526e-01; +9.025552691688800e-02   +5.802159719132879e-01   +3.127603164985511e-01   -3.164934201378215e-01   +4.421763784446413e-01   -3.412866099885925e-01   -1.720965102633308e-01   +7.704912985477247e-02   -3.842165261994835e-01   -3.060300718069521e-01   +4.397979472375992e-01   -6.481818251341789e-01   +3.022943950798526e-01   -1.374674240991060e-01   +6.381206283619333e-01   -1.942802795471625e-02; +4.575517713413924e-01   -4.965329130865206e-02   +4.574922863539937e-02   +5.381541761216775e-01   -6.533230684180888e-01   -1.323094362483692e-01   +8.609042989684844e-01   +5.422986107792445e-01   +7.718278602911519e-01   +1.552381186657411e-01   -1.571735258527038e-02   -7.255493504452551e-02   -2.162161179330631e-01   +2.826208176300481e-01   -3.076085359692973e-01   -4.635237672591288e-01; -2.867045397088233e-01   +3.003787357306034e-01   +3.022698055242999e-01   +6.537519096789329e-01   +1.350168150060972e-01   +1.394528722400352e-01   +7.274568937202813e-01   -2.153287641610152e-01   +2.401973584973969e-01   +2.525719452593636e-01   +8.678375528115537e-02   -2.491846601334464e-01   -8.370008947391189e-02   +2.267879217483203e-01   -1.094692188295487e-01   +2.312074414811080e-01; +2.211343845243093e-01   -2.692843037082299e-01   +4.482606046826096e-01   -1.702177701058861e-01   -6.337151596954388e-02   +2.981298067042038e-01   +6.219249521556334e-01   +4.717926394762095e-02   +3.418513307717320e-01   -8.111318531283379e-02   -2.659618103361307e-01   -1.161899958380858e-01   -3.575227435051725e-01   +5.357907871262270e-01   -2.855254955395368e-01   +2.656465074060138e-02; +5.215852926348824e-02   +2.178834444188786e-01   -2.626777952114268e-01   +4.423772516609585e-01   -4.048623353697716e-01   +2.573180161522090e-01   -3.465147972642239e-01   -2.881224174149229e-01   +7.981514204587343e-01   +1.259843897825622e-01   +4.760418626994528e-01   -6.097450127519005e-02   +1.383616863682042e-01   -2.096641143479392e-02   +3.289684077283998e-01   -4.225359533435964e-01; +2.654133644674234e-01   -6.131631915777532e-01   +1.006647177658164e-01   -2.376124896223483e-02   +6.184779614100260e-01   +3.590266749496910e-01   -8.735695901955384e-02   -1.519012790882533e-01   +4.142581956699884e-01   +2.791948613838480e-01   -2.060646814195718e-01   +3.730805844847719e-01   -1.484059816383456e-01   -5.672224312215867e-01   -1.594372043221884e-01   +2.075572028829132e-01];
L2E_L1E_iAMPA_netcon = [-3.265113242876913e-01   +9.727789255069436e-02   +4.991575226169088e-01   -7.878191664754217e-01   +6.480430249380520e-01   +2.749670452858821e-01   +8.548826411111654e-02   +5.440479787652046e-02; -2.469458614000920e-02   +2.141394414792556e-01   -5.268855634773947e-02   +2.294111904141437e-01   +4.450074046619342e-01   +2.737468885482558e-01   +1.719718369492984e-01   +4.654177683701836e-01; +5.319453984180669e-01   +3.398155152286080e-01   +2.710175467270597e-01   -1.066345299114674e-02   -4.397649777000074e-01   +2.199686996503601e-01   -4.919045777852551e-01   +1.662549779469011e-01; +1.767314213713536e-01   -3.951954106954937e-01   -1.393966280617159e-01   +3.957452175417384e-02   -3.900883884320854e-01   -5.813447769729461e-01   -9.008110137047637e-02   -1.741716993350059e-01; +3.014419873758806e-01   -1.858990372271060e-02   +7.776191590589292e-02   -3.234745356583479e-02   -2.147576449202611e-01   +3.000204709327799e-01   -2.698709511674754e-02   +2.829920514105739e-01; -4.872605827161796e-01   -3.254749633990355e-01   -3.874663944031400e-01   -2.537923904675183e-01   +3.836393349410010e-01   -5.356893574534141e-01   -1.313620643958018e-01   -2.982288440530366e-01; +1.507208872505209e-02   +6.252973224123334e-02   -2.210134619744598e-01   +3.714293109945915e-01   -9.220601383522631e-02   +2.906405437195396e-01   -5.514273989185621e-01   +2.823618130891742e-01; +5.169201357994156e-02   -4.904326769012030e-02   -4.626845199376385e-01   +1.466932569032407e-01   -1.994064031558912e-01   +8.872327294594023e-02   -1.728467833518155e-01   -1.727130930572214e-01; -3.155957325027272e-01   +2.076720802966295e-01   +5.740114818412893e-01   -1.507426545605361e-01   +3.693392836057092e-01   +1.779479422794732e-02   -7.210888255059054e-02   -1.356821596069517e-02; +6.271971952355988e-01   +3.463697231992814e-01   +2.242641028156722e-01   -3.411096266782104e-01   +2.348528415445616e-01   -3.372258211504641e-01   -3.444360441048355e-01   +5.126170783997343e-02; +2.131510608932681e-01   -2.392011195287453e-01   +2.412577954864200e-01   +6.499641522924124e-01   -1.556760120846580e-01   +1.621458635005513e-03   -4.461925084759835e-01   -2.461698731134052e-01; +3.563790783171970e-01   +3.732386083132808e-01   -4.047824347572324e-03   -6.690090510555805e-01   -9.092954791587224e-02   +1.828670721796744e-01   -2.365274519747981e-02   -4.186484441913060e-01; +6.982367851058303e-01   -1.573008259621650e-01   +1.497213582328664e-01   -4.565797578752326e-01   +9.929979609025671e-02   -3.344701397977328e-01   +1.971163206069868e-02   +2.832405625466378e-01; -1.689051382101166e-01   +3.760359438002264e-01   +5.794191822810134e-01   +3.457944333930097e-01   -4.022042042467158e-02   -5.280305320965746e-01   +3.516478337050878e-01   +5.342506246716572e-01; -8.485153796306107e-01   -1.680684938954636e-01   +1.966407563779010e-01   -3.510152240855471e-01   -2.619046294570370e-01   -4.115572479002704e-01   +2.086798789282738e-01   -3.288768886646707e-01; -6.571970693633767e-01   +3.510378761385800e-01   -4.413538132167621e-02   -7.554051776459713e-01   +3.875703364061882e-01   -2.404955790513499e-02   +3.573739297820203e-01   -3.672849005230518e-01];
L1E_L2E_iAMPA_netcon = [+2.745402146602237e-01   +2.476592317862504e-01   +1.150598691245602e-01   +1.424333612269682e-02   +2.979508545570725e-02   +2.586603811679777e-02   -1.051145963830434e-01   -5.977761553815119e-01   +1.535599148754882e-01   -3.526999404947608e-01   +9.141067480811990e-04   -7.271829080507318e-02   +1.515611574369681e-01   -1.693994756062353e-01   -8.194770845015367e-02   +1.608894555640143e-01; +6.799370680739250e-02   -4.332704334004380e-01   +4.111809323351815e-01   -2.215434045616236e-01   -8.038688001955251e-02   -7.928103455177342e-01   -9.824908785909361e-02   -3.163601683225742e-01   +8.000430418762248e-01   -8.108001167751573e-01   -7.443575589878324e-01   -4.839336940907430e-01   +3.018493113284451e-02   +1.810943857904075e-01   +2.150423236947262e-01   +1.750299581472388e-01; -1.839465091213445e-01   -3.815179331959132e-01   +1.851023628735002e-01   +1.316025383262071e-01   -2.736930619159929e-01   -1.174201018707458e-02   -6.456099186375009e-01   -5.766135194884071e-01   -8.598321749400819e-01   +2.807830113792270e-01   -2.634526376814801e-01   +2.827938851845866e-01   -3.091161442610685e-01   -1.441423661749601e-02   +1.847798922819572e-01   -1.124312168226972e-01; -2.891407443862084e-01   +4.201243518304926e-01   +4.768469060421106e-02   -1.997374115099896e-01   -3.628223557035805e-02   +8.037861497412574e-01   +7.916725737889743e-02   -1.787319215153489e-01   +3.152449597324214e-01   +6.010619687720306e-01   +1.016857922775867e-01   -1.529150880023183e-01   -1.907681642639462e-01   +2.188846392555967e-01   +3.906639629594505e-01   +4.925482344624710e-01; +1.900236224674829e-01   +4.425075247619896e-01   -1.418130050543047e-01   -4.125007672034453e-01   -5.433574996916175e-02   +5.768603937126877e-01   +7.458889201813627e-02   -2.350895635389134e-02   -3.074564394558258e-01   -5.568736739782754e-03   -5.774397356660057e-01   +6.168959323237797e-01   -7.922437320537552e-03   -3.597557423871673e-01   +3.923611439078359e-01   +4.229286864603318e-01; +3.441103942569659e-01   +2.924699501504340e-01   +5.410776138804295e-02   -1.627661548384778e-01   +3.321665455945848e-01   -1.528607798808087e-01   +2.874187464851279e-01   +5.928899646937014e-02   -1.336406505576481e-01   -1.979611042051602e-01   +2.663119408645915e-01   +2.300518732791563e-01   -2.046922588220842e-01   +1.849381400067675e-01   +2.212011973873118e-01   -5.323224815256453e-01; +5.192193606517276e-02   +1.078512073746215e-01   -4.356635951959615e-01   +1.742713711466826e-01   -5.045392839160600e-02   -6.532216091660571e-01   +4.288726793563077e-01   -1.760925927231816e-01   +2.978846364952102e-01   +1.545889196773065e-01   +6.355837985254631e-01   -2.579049212009506e-01   +4.455076112461552e-01   +2.068395205844801e-01   -2.363991517744415e-02   +4.428929230143542e-01; -3.290113655632043e-01   +4.036287715757586e-01   -4.001365806883538e-01   +1.215146132900978e-01   -3.877452610765374e-01   -2.020642055612759e-01   +2.870310379857970e-01   -4.247406974027772e-01   +1.309219547145332e-01   -8.409978825521713e-02   -1.288717925353009e-01   +1.361490297575679e-03   -5.857752426759331e-01   +2.793397185005041e-01   +1.281318334518748e-01   -2.757550208944362e-01];
L2I_L2E_iAMPA_netcon = [+2.641275106112598e-01   -1.361068304440837e-01   +1.486573440383593e-01   -3.100462385701916e-01   +4.926313525381010e-02   -3.522825811791030e-02   -1.887569549223774e-01   -5.873793090890465e-02; +1.891177542390448e-01   +9.505247183023550e-02   -4.277204066449427e-01   +3.217572348860400e-01   -1.335787356913347e-01   +3.002150896735831e-01   +7.817666777446447e-02   +3.028954821636355e-01; -2.178053859519306e-01   +6.177969513320657e-02   +2.277199605190996e-01   +3.247285125214050e-01   +3.063320880397339e-01   -7.744696102482844e-01   +1.023918172010802e-01   +1.116499296448987e-01; +1.311957237961124e-01   +9.431702706673997e-02   +8.809799402357918e-03   -6.458641906365718e-02   +1.419080478890145e-01   +3.749681917316631e-01   -1.052540945615248e-01   +7.516224713981112e-02; -9.371161587192212e-01   +1.799741963968000e-01   +4.640999940928253e-02   -1.258585806544942e-01   +6.702789474224255e-02   -3.510138980124782e-01   +1.232327621169418e-01   +8.432766527449861e-01; +3.529927588414531e-01   -9.841015367123271e-02   -7.866076734761535e-01   -6.490160697671211e-01   -2.755918633991395e-01   +2.053100074018505e-01   +7.829066856091446e-02   -1.086235782486314e-01; -9.517104520359257e-02   -8.755036445955433e-04   +6.127065883619130e-03   +4.720181365033503e-01   -1.499617433315276e-01   +1.122093620511677e-01   +1.654201005998618e-01   -3.836204776409989e-01; +4.699755444426161e-01   +5.974775801943326e-01   +1.636997991892399e-01   +4.319840140410615e-02   -1.982490888247110e-01   +5.303568600225167e-01   -2.929517080447331e-01   -1.704407665691828e-01];
L2E_L2I_iGABA_netcon = [-1.909042426660955e-01   -4.289152395317821e-03   -3.122300432645597e-01   -2.211040945852656e-01   +2.043149653186709e-01   +2.687374268615914e-01   +4.915627154855495e-01   -4.492846377550604e-01; +6.676757269827641e-02   +2.933139800667828e-01   +3.876052379814315e-01   +4.531861559710552e-01   +2.791715956531229e-01   +9.513813829717137e-02   +1.744425061201149e-01   +5.024084760091032e-01; +2.466259502808189e-01   -8.041035577659142e-02   +1.069375472669547e-02   -7.081497842209304e-02   +5.531869292229570e-01   +3.091964876933936e-01   -4.817173450084428e-02   -1.200271625854363e-01; -7.226706949110411e-01   -4.317457111849509e-01   +6.291892141753015e-02   +1.348488794999740e-01   +5.900535752930932e-02   -2.650799499358233e-01   -6.098066194804729e-01   -7.447517351773504e-02; +3.837146685677054e-02   -6.182261565145565e-01   -2.181286335727744e-01   +2.248210476146565e-01   +2.501191111893590e-01   -4.890682059799705e-01   +3.058746479356303e-02   -7.902253657026272e-02; -3.156259939271491e-01   -4.957322932569720e-01   +2.613576829097005e-01   -6.786401845883714e-01   +4.441350911428700e-01   -1.297810806639917e-01   -5.107461353642935e-01   -2.816762315796903e-01; +1.856309958384920e-01   +6.957554345566783e-02   -3.763293761850127e-01   -4.964662483507444e-01   +5.418514716831548e-02   +3.619276038250578e-01   -5.237273855032888e-01   +5.813281849330244e-01; +3.158507134903015e-01   +8.908651246607269e-01   +1.835978187648502e-01   +1.793920732051914e-01   +4.687133757667074e-01   +4.430114790297300e-01   -1.751742278355529e-01   -5.126893237562641e-01];
L3E_L2E_iAMPA_netcon = [+4.301240594462095e-01   +7.063303729758807e-02   -5.585082705811907e-01   +3.162906383395270e-01   +6.196678416874764e-01   -1.233434400710083e-01   +3.325625383561923e-01   -1.876710122365223e-01   +7.041828690895005e-01   +6.187670529469493e-01   +3.433669513344038e-01   +8.990405365242633e-01; +5.625548356090682e-01   -7.954311046908996e-02   -1.978747880127585e-02   +2.303337149443052e-02   -6.867647226073569e-02   -4.584289671760940e-01   -4.419748996345180e-02   +2.723666778356229e-01   -7.776515317080976e-01   +3.320361657008423e-01   -1.422450286714386e-01   -9.272876065715485e-02; +4.669187280148340e-01   -2.826071181026321e-01   -1.877405268522374e-01   +1.486874885729185e-01   +4.589801883178588e-01   -2.492163560286772e-01   +4.822157345023073e-01   -4.207675740325947e-01   +8.049157951307258e-02   -3.044118956502589e-01   +2.261594325795139e-01   +8.934460704894882e-01; -2.198021490343250e-01   -2.893934937759682e-01   +1.849638269883548e-01   -4.514530845903799e-01   -3.733349864019351e-01   -2.651445901570509e-01   -2.055348159460797e-01   +8.482745706433514e-02   +4.684052495039945e-01   +4.039438812510951e-01   +3.228145950548118e-01   -5.597221606078151e-01; -1.904602933217759e-01   +7.404110926088028e-02   -4.865766431553415e-01   +2.916080449095003e-01   +2.029423160972580e-01   -1.480278597343556e-01   -1.215704613834047e-01   -8.438506890576788e-02   -2.535779667794131e-01   +2.846435891476984e-02   +4.608452621507567e-01   -5.247006112444937e-01; +7.233689255497966e-01   -8.375895164617038e-02   -4.534090670833233e-01   -1.776160712846495e-01   +8.347246638421887e-02   +2.260968105439092e-01   -6.890072384256656e-02   -4.885581039020226e-02   +5.685774605997945e-01   -2.172870790151449e-01   -4.968069572524071e-01   -5.241141377275635e-01; -1.786928544271320e-01   +4.965896979711653e-01   -1.052867302016080e-01   -2.603498394611791e-01   -4.098530109960574e-01   +4.164201214640528e-01   +7.582320769046921e-01   -5.411715972916880e-01   -4.675509079335559e-01   +3.164119904225088e-01   +6.714785771893125e-01   -1.863962030738221e-01; -1.529706762558660e-01   -1.401555757153692e-01   +6.182983860010238e-01   -2.802778923585938e-01   +3.198618241170645e-01   -9.356608190810471e-01   +5.860233875162153e-01   -3.016430661247449e-01   -1.760277243139911e-01   +1.100322848092727e-01   +2.721999672112248e-02   -1.545087256499500e-01];
L3I_L2I_iGABA_netcon = [+2.018005684491833e-01   +6.993953101284060e-02   -1.217239632235688e-01   +1.437678787353949e-02   -1.283500410386931e-01   +6.139616000293195e-01   +9.196547579269485e-02   -4.074402763130155e-01   +4.643762428479411e-01   -1.755169172350051e-01   -5.390452420647204e-02   -1.496974751805155e-02; -9.733563913692982e-02   -7.576657188282898e-02   -4.913961013627203e-01   +4.327664226866236e-01   +1.454106129879726e-01   +3.152766620615711e-01   +3.083527409903722e-01   -5.137152465376452e-02   -5.239763590501741e-01   -1.058308864155717e-01   +1.895447922791706e-01   +6.501699692315253e-01; +8.257404218818018e-02   +1.872900929908163e-01   -3.244251018609233e-01   -9.569231103646579e-02   -2.710174553484445e-02   -1.858020276951395e-01   +5.881419208501193e-01   +4.517951907039180e-01   +3.943615278947756e-01   -2.265057742662817e-01   +5.198748517688028e-01   -8.157471960668830e-02; +3.012987327138723e-01   +2.231384335292678e-01   +4.493692046653355e-02   +1.925393602058800e-01   +2.111284329037672e-01   -3.752777372694277e-03   +1.600946398319922e-01   -1.951720182542572e-01   -1.197052139649003e-01   +1.702593217760449e-01   +1.607779946058881e-01   -2.134253057819180e-01; -1.258737294039996e-01   -6.952382702738989e-02   -3.202766084015986e-02   -4.213308572082510e-01   -1.838540020934233e-01   -1.591481761379663e-01   -7.446948216808505e-01   -1.063371526514982e-01   -6.802318161424978e-01   -9.635165516820940e-02   -2.942408514642848e-02   -4.782711280825686e-01; +1.530280590235230e-01   -3.077930963472713e-01   +8.183116698696126e-02   +1.401727654746128e-01   +3.401704681452898e-01   -1.988907883821731e-01   -4.004060354443137e-01   +3.722122000389023e-01   +1.831381122069198e-01   -3.048276281072708e-01   -4.772019289502607e-02   -5.251376003767647e-01; +1.401282170059534e-01   +7.466998069471059e-02   -1.385625116088373e-01   +8.435970794680167e-02   -1.623876685416802e-01   -1.544669221093110e-01   +1.158413555216593e-01   +6.986429210158063e-02   -2.490530804833572e-01   -1.288640226349887e-01   +6.063717802728313e-01   -9.380361029150273e-02; +1.999575412078367e-01   -3.743282194993499e-01   -3.441468745708628e-01   +1.754588812302774e-01   +1.463393034947504e-02   +4.641849641542571e-01   +2.710260982883240e-02   -2.512080192798049e-01   +4.021024432568615e-01   -2.458705183988374e-01   +2.740435367146790e-01   -3.756214083456669e-01];
L2E_L3E_iAMPA_netcon = [-1.070409665242690e-02   +2.778378202188120e-01   +3.259887638159684e-01   -2.747902057452870e-02   +6.416355185106583e-02   +4.215363103140288e-01   -4.007641753686760e-01   +3.877799790800865e-02; +2.779176573938833e-01   +2.570888921630990e-01   -1.059795287730170e-01   +3.630082798901617e-01   -2.779770708043851e-01   -4.019683003849903e-03   +2.708394927267938e-01   +3.186279049237602e-01; +4.681395341371947e-02   +1.273656831302542e-01   +6.173174949973248e-02   +2.475616459923393e-01   +2.984814438073118e-02   +6.202660421128813e-01   +4.211465658591832e-01   -3.270235601122055e-01; -9.257776764428700e-02   +2.560237087439313e-02   +2.308087227362886e-02   +1.602627676022982e-01   +3.338272032671977e-02   +8.275675027219706e-02   +6.925918533448457e-01   +1.400401544824789e-01; +3.783784882450515e-02   +1.213158318253797e-01   +2.607253841838514e-01   +2.125865326671896e-01   -6.974525712093893e-01   +2.758071554040090e-01   +3.207767381387658e-01   +9.026537187393913e-02; +1.842282033653374e-01   -1.380560407463680e-01   +5.458494288922114e-01   +2.188619138461422e-01   -2.082857046056552e-01   -9.540775470465787e-02   +4.152859518868446e-01   -6.173927215289857e-01; +3.635889940751955e-01   -5.011709726321408e-01   +7.679672039037359e-01   +3.186669207046418e-01   +3.686145349702793e-01   +2.964810929391559e-01   +1.409150694117446e-01   -3.968395116497767e-01; +3.376835410522239e-01   +2.494000482320164e-01   -3.389721571805679e-01   -6.016629570088571e-01   -6.621789748109072e-02   -9.877697597030932e-01   +3.352955342544890e-01   +6.607789226928102e-01; -1.587640084670274e-01   +1.695133435162378e-01   +2.853092510284413e-01   +6.811911057105230e-02   -2.653558207826098e-01   +5.399772298326988e-02   +2.734751197036999e-01   -2.158410302056424e-01; +3.698575858330070e-01   -3.473996489586271e-01   +1.213727144816086e-01   +6.397262385182128e-01   +4.825172567930100e-02   +3.511094497808619e-01   -6.273412627547735e-01   -2.400419179298146e-01; +1.734218377586424e-01   +6.853940327397702e-02   +3.069478950023671e-01   +5.086743269469609e-01   -1.623370966368316e-02   +1.899660764683787e-01   +2.061971575192542e-01   +6.679700932563713e-02; +3.983643597206346e-02   -2.395227979368220e-01   -9.876559568897081e-02   -3.236992268544556e-01   +4.002066904966091e-01   -1.131191252906055e-01   +3.318856235763507e-01   -5.813068055402231e-01];
L2I_L3I_iGABA_netcon = [-5.019686900121915e-01   -4.456105716212937e-01   -6.852713494372012e-01   +7.005878522652804e-02   +6.279519567325305e-01   +3.103905397859128e-01   +7.352267969818446e-02   +3.930729022455921e-02; +4.560628698807028e-01   +1.871043083967314e-01   -4.183107875222444e-01   -3.896329092365931e-01   +9.197014003386997e-02   +2.259013104176170e-01   +7.763807704629127e-01   -1.615206650828551e-01; -5.526429977115539e-01   -4.134959063741037e-02   -3.446617653268075e-01   +1.929083476577300e-01   -6.118550909272635e-01   +5.006116401548799e-02   -7.691161095731987e-02   +7.703673095655522e-02; +1.992635512777668e-01   -4.692385986977717e-02   +2.559673038846282e-02   -1.763550929546890e-01   -5.695942406625679e-01   -2.913003945988454e-02   -8.902806885606102e-03   +1.701631408206734e-01; +9.444959584218282e-02   -3.785083807462960e-01   +1.577967261124179e-01   -5.366292316864883e-03   +8.082602424980699e-01   +3.439913331620483e-01   -1.771426553690549e-01   -1.620299712637145e-01; +5.323815147764392e-01   +3.638647143088986e-01   -5.780298444683202e-01   +5.099679226695998e-01   -2.493049529517594e-01   +1.179937179072127e-01   -3.670472786666353e-01   -4.006729416914790e-01; -9.710604251749352e-02   +8.472568683539355e-02   +3.285278459545802e-01   +4.303670389757658e-01   +1.080062257914431e-01   -3.049941480471624e-01   -1.969544764810129e-01   +6.852895564697520e-02; -2.195556690196121e-01   +7.531312834734304e-02   +2.379835718626396e-01   -3.291065579208451e-01   -2.007737528037951e-01   +1.359937201365721e-01   -4.027969261299597e-01   -1.576542777166931e-01; +4.554348392335358e-01   +2.396143857322138e-01   -7.438634419766638e-03   -8.647111074592558e-01   -3.745981824577370e-01   -1.028623442484516e-02   +3.518697385569919e-02   +1.949934963516601e-01; -4.133600229779528e-01   +5.636000940982593e-02   +6.187632383135641e-01   +2.234967618865994e-01   +7.728488392139284e-02   -1.527910115532973e-01   -4.868892032486590e-01   +2.011740768351199e-02; +3.305885434482880e-01   +7.459276573936542e-02   -2.324260063882376e-02   +4.367471750572962e-01   +3.859673555298987e-02   -2.541178013146407e-01   -2.590618014560592e-04   +4.135947985215856e-01; -3.108830932641374e-03   +1.088010112805409e-01   +2.385076070835174e-01   -2.499875908558561e-01   -1.648269294546606e-01   +5.044059660521268e-01   -5.623486633428230e-01   -5.659827570343209e-01];
L3I_L3E_iAMPA_netcon = [+3.027427841355284e-01   +8.095569393041940e-01   -2.856723367994431e-02   -1.487752087741356e-01   +3.366749533093683e-01   +1.098082978992494e-01   -3.541269138011471e-01   +4.975048793127610e-01   -3.374232643030093e-02   +5.953492307276839e-01   +1.265131425459272e-02   -2.970678795031267e-01; +2.385588969718573e-01   +3.603360800915769e-01   -2.425876462562790e-01   +2.469250188926009e-01   -4.444478238698082e-02   -1.535034586466379e-01   +5.473445352389472e-01   +3.703272370306023e-01   +2.782575342648184e-01   -8.272958763526839e-02   +1.509039498087314e-01   -1.105264486057174e-01; -3.038657595990934e-01   +1.647031623833450e-01   -6.900184714698539e-02   -1.922257762432780e-01   +1.535435145355688e-01   -5.451187652546313e-02   -1.929141758917448e-01   +5.270475161923953e-01   -2.961448423333246e-01   +9.630529850994383e-02   +2.090272023407784e-01   +3.439127449744379e-01; +3.710022234227227e-01   +1.122121597941174e-01   +5.689705518543794e-03   +1.872272964132047e-01   +1.116583590939113e-01   +7.191085335227763e-01   -6.874783944415739e-01   +3.385196292277896e-01   -3.276478276586510e-02   +2.942966692974410e-01   -6.248452378392347e-02   -3.223459175750662e-01; +1.530736402852998e-01   +9.120468997730973e-01   +4.231586171772466e-01   -1.572213176503405e-01   +1.596345135580449e-01   -1.204796048027889e-02   +1.564653987111359e-01   -4.651407329103271e-01   -5.892005580506135e-03   -6.900811572879229e-01   -1.762454288196877e-01   -3.282489027458295e-02; +5.821116621144313e-01   -3.145001992379946e-01   -1.983530789691746e-01   +7.440169241523027e-02   +5.600921879355575e-02   +3.784944774218785e-01   -3.679433694228597e-01   +1.467529270120527e-02   -1.286201645337664e-01   +6.929272560744500e-02   -2.069964620358458e-01   +3.092494548821154e-01; +6.585631403421668e-01   +1.447513467823237e-01   -8.032232729081243e-01   +1.801647594284501e-01   +4.895360440000946e-01   +4.540868865260530e-01   -1.020296443654629e-01   -5.104678118627624e-01   +1.054625692908457e-01   +4.507942143686502e-01   -2.426767408860683e-01   -3.159747154018597e-01; -5.494838906530972e-01   +3.819943440742871e-01   -6.048212522959244e-01   -4.115238674656669e-01   -2.392233881966296e-01   -2.310341379697070e-01   +3.967199682048664e-01   -5.607844609014490e-02   +2.674982185288660e-01   +3.297118968422378e-01   -2.444361075492211e-01   +1.035447212624816e-01; +2.426013821822135e-01   -6.169355484580946e-01   +4.037032183797043e-02   -3.622814222312531e-02   -6.525612187609612e-01   +9.699039363023132e-02   -7.458543725906215e-01   +3.506517739537249e-01   +8.085054844289470e-01   +2.048124001651667e-02   +1.747022411705038e-01   -6.007374723278074e-01; -6.286934738301970e-01   +6.964305084152672e-02   +1.462536073962462e-01   +6.440801091478394e-01   +1.494832892143824e-02   -5.746617977191407e-02   -4.589298725767418e-01   +1.448988108701442e-01   -9.863141328481699e-02   -5.224356984411745e-01   +1.083911719686802e-01   +3.198509447109805e-01; -1.816581406348909e-01   +9.632028353845778e-02   -3.472665095372793e-02   +1.914992005932585e-01   -3.157204946955261e-01   -3.672497848627583e-02   +6.024223790699037e-01   -3.586722909697512e-02   -3.616572317437411e-02   +1.196970716286350e-01   +2.289303360168553e-01   -3.322652874619109e-01; -7.289065469642114e-01   +6.052184902530854e-01   -5.419462701499341e-02   -2.150477597630046e-01   +5.956538760590261e-01   +3.435460554239276e-01   -6.501362572041369e-01   -1.125953484913061e-02   +4.460529376723156e-01   -2.022244600178364e-01   -2.562378925217363e-01   +6.284137581541084e-01];
L3E_L3I_iGABA_netcon = [+3.404567062130824e-01   +2.451323107306488e-01   +1.113987466742073e-01   -1.058803197265814e-01   -2.465300191940085e-01   +3.479232944675000e-01   -5.947840283114361e-02   -3.483182722623959e-01   -9.388869088139645e-01   -1.145527095622522e-01   -3.126577748961135e-01   +4.484396452560927e-01; -2.981444184297211e-01   -1.737752538497993e-01   +3.393415847299319e-01   -8.868066486420190e-01   +5.252413758784387e-01   -4.125343436509012e-01   -3.640657585148940e-01   -3.190645008249391e-01   -2.659954777365701e-01   +4.054619526282170e-01   +4.976690809823301e-01   +6.737826722031309e-01; -6.662653663475000e-01   +1.539482046458884e-01   -2.324021163055405e-01   +2.087432106009960e-01   +2.202384029642887e-03   -1.649902150233961e-01   +2.164123190663597e-01   -1.495440564827009e-01   -3.951634747130696e-01   +2.977639856434649e-01   +2.598319342558635e-01   +2.457543948075167e-01; -6.530054529530021e-01   +1.592593439238176e-01   +5.983598134777579e-01   -3.468011229322986e-01   +2.240811252885259e-01   -2.958207448003469e-01   +4.231142496335448e-01   +5.193156218452261e-01   -2.883124922950977e-01   -3.618993586762856e-01   -5.109197651914652e-01   -1.955841168236960e-01; +3.238300136193001e-01   -6.781992660259900e-02   +1.264573030950246e-01   +1.115998981178227e-01   -2.152986771934606e-01   -1.191285711640389e-01   -1.291965464374007e-01   +1.032675141024396e-01   +6.520911131325128e-01   +6.325592259346778e-02   -3.202670459668325e-01   -4.232851209897722e-01; -4.347299406409293e-02   -4.297758326226217e-02   +3.333617110571804e-01   -3.089807337165169e-01   -5.479287660809511e-02   +2.554530249795375e-02   +3.450137276484881e-01   +4.337819897162548e-01   -1.928239187553707e-01   -1.417406806336617e-01   -3.629597020056686e-01   -4.887994350960577e-01; -9.862015065779357e-02   +7.313489053078835e-01   +8.827509267937522e-02   +1.332701776170443e-02   -1.483053231279006e-01   +2.067333382250465e-01   +1.142561530072294e-01   +2.276450425473597e-02   +1.158463496427596e-01   -5.401810065817340e-02   -4.026415036219256e-01   -3.147151773243880e-01; +2.187622729995526e-01   -3.431592148601397e-01   +7.583818334223823e-01   +1.852449245444488e-01   -6.255902099509035e-01   +1.895536198018204e-01   +9.165291400561093e-02   -4.742787304621774e-01   +1.991153627613749e-01   -1.232966096914374e-01   -4.264934754592097e-01   -6.595230801011995e-02; +1.985315097997795e-01   -3.614619427865324e-01   +8.157400273898602e-02   -4.692114161581726e-01   -7.797812606500168e-02   +5.152091200638014e-01   -1.560787317743085e-01   -1.587954403494955e-01   +1.065818031054774e-01   +5.877606225103189e-01   +2.698794507585312e-01   +1.741355762876459e-01; -2.233341399501608e-01   +2.293467475300072e-02   -1.956536060761132e-01   -4.561374492723787e-01   +5.906500629174929e-02   +1.088443463535269e-01   +3.229040510261662e-01   +2.253467004553286e-01   +4.118575031921873e-01   +6.853488924176832e-01   -9.252472601756807e-02   -1.938114212974325e-01; -1.971238154336580e-01   -5.793005734217764e-01   -2.408405365608652e-01   -7.306379664918153e-02   -5.115182151685309e-01   +1.937011415872912e-01   +7.094710305888015e-02   +4.253927010350331e-01   +4.505781652309483e-01   +3.897516548750404e-02   -4.665970744061975e-01   +3.412111680281662e-01; -5.409418653752239e-01   -2.084753088963213e-01   +1.402151977807594e-01   -5.174442559896871e-01   +3.964384801117923e-02   +3.356446480414059e-01   -9.075250933743464e-03   +1.421021948126244e-01   -2.509721181862647e-02   +3.450750901326899e-01   -1.450113535790861e-01   -3.462658040177858e-01];
L2E_Input1_iAMPA_netcon = [+2.282642459873758e-01   -1.016654761367934e-01   -4.235855871609148e-02   -9.694488951663803e-02   -1.154385613626741e-03   -5.041529774077773e-01   -6.973505591928705e-02   -5.109184062879564e-01];
L2I_Input2_iAMPA_netcon = [+1.998606157913588e-01   +3.022844458698434e-01   +3.028179104557174e-01   +3.105895442219700e-01   -2.125115615340000e-02   -1.115929805031531e-01   +5.588610035967063e-01   -2.359825920619649e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.4*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 1.0*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 1.0*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.4*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 1.0*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 1.0*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 100*(sin(2*t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 100*(sin(2*t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
