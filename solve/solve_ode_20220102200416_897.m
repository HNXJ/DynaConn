function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+1.914078771373074e-02   -4.591530084851482e-01   +4.487590840069199e-01   +5.410975568946039e-01   -2.346454727135277e-03   +3.883769528123334e-01   -3.762014445522281e-01   +2.250801502036198e-01   +3.264977273144279e-01   +7.864577489168838e-01   +1.918773783271919e-01   +5.143564716451704e-01   +1.270091659811392e-01   -1.337937932093698e-01   -3.743630084503132e-01   +8.328932551034705e-02; +2.745920191516206e-01   +1.211742618599070e-02   -2.034620985602307e-01   +4.244312326058827e-01   -2.909565048701530e-02   +3.766419437227464e-01   -4.708089291703235e-01   +3.395832129898368e-01   +7.343297406047880e-01   +1.173953061915003e-01   +7.170012900741799e-01   +5.649849499636778e-01   +3.345094834236055e-01   -1.260618298776747e-02   -8.549279392758101e-02   -1.454639357199236e-01; +7.766981041108953e-01   +2.632169622349271e-01   -1.572028186548370e-03   +2.913903685163750e-02   +1.444744426519892e-01   +7.653134263780638e-03   +2.963633419186772e-01   +2.316070461233628e-02   +4.396800758324507e-01   +1.799320235691516e-01   +3.656380551408822e-01   +1.847106648555683e-01   +1.720579718998431e-01   -3.568048195284937e-01   +1.667856207635547e-01   +4.894629965170055e-02; -1.460057899038102e-02   -2.573530617685750e-01   +7.281828385689997e-02   +4.705942917829636e-01   -5.252997302957148e-02   +1.496536202860828e-01   +3.797367424771395e-01   +8.040119361267964e-01   +5.535603639594812e-01   +1.222970555667951e-01   +2.912332264571557e-01   +5.978828666309726e-01   +3.012726866170543e-02   +5.601274457401504e-01   -5.003274997812776e-02   +8.700645800351917e-01; +5.710722533465131e-01   +1.441771077411781e-01   +3.867699266982137e-01   +8.714108891765415e-01   +7.574883742600892e-02   +4.692736939626984e-01   +2.085763109697084e-02   +3.194317185097730e-01   -1.390286252638299e-01   +2.563829779631474e-01   +5.295514440939050e-01   -2.460006836252235e-01   -9.742972335538874e-02   +3.587041140772834e-01   +6.319338064075654e-01   +4.848738521235568e-02; +7.384728160162526e-02   +4.659334252081030e-01   -2.301004383957070e-02   +1.456347920681072e-01   +9.542120659489352e-01   +3.452318800056685e-01   +7.239475806104159e-01   +3.288854337424257e-01   +2.159284714868211e-01   +3.955321703240371e-01   +2.299510418283653e-01   -1.110222464619415e-01   -1.817428887109201e-02   +1.641430939660134e-01   -1.233510840209728e-01   -6.925379649907983e-02; +4.415217118939430e-01   +5.860466387328211e-01   +2.685647199793780e-01   +1.455519600840244e-01   +1.811017387268528e-02   +3.588998786618171e-01   +3.801051535504317e-01   +3.179876366191523e-01   +2.400358721173135e-01   +2.646853850596474e-01   -1.882547191754024e-01   +4.162548592659162e-01   +4.800159424251094e-01   +1.348078934460777e-01   +3.146900463959870e-01   +2.495381720322797e-01; +2.148799498337734e-01   +2.091096705182881e-01   -1.297838173007211e-01   +4.574873899782680e-01   -8.348531711482331e-02   +1.076516725628647e-01   +1.488395693860732e-01   +4.842807155033788e-01   +5.325223091773167e-01   +5.440585794898231e-01   +1.674084012205072e-01   +4.563998489634102e-01   +1.180051877019060e-01   +1.797337706512991e-01   -1.240059463733406e-01   +3.937676874347207e-01; +8.553611947604667e-02   +5.046255686608976e-01   -1.765742346802252e-01   +3.904691886811969e-01   +2.486351248183295e-01   +4.706985067881075e-01   -4.505309920395176e-03   -2.838816214195954e-01   +2.708397686429730e-01   -2.224187148487990e-02   +6.687437752916319e-01   -1.765177106586465e-01   +4.852791652169365e-01   +3.572371716045187e-01   +2.178291634300659e-01   +1.368574806814054e-01; +1.115816937254800e-01   +4.162154187223897e-01   +2.860818996262964e-01   +3.377945677147777e-01   +3.339332314110579e-01   +9.168740840160909e-02   +5.754778902464095e-01   +7.999979003222021e-02   +8.723483384256631e-03   -8.101371497941322e-02   +1.904472760394016e-01   +2.994539927404140e-01   +8.156103006864673e-01   -3.320706544825297e-01   +2.972178808985901e-01   +3.879743377234046e-01; +4.821632268386815e-02   +5.315720406156694e-01   -9.803331754594316e-04   +1.230879362839253e-01   +5.615508167871966e-01   +2.662514305690243e-01   +6.234985100201208e-01   -6.650832106668123e-02   -1.446203789364419e-01   +5.446585147695561e-01   -1.211275406775300e-01   +4.347430927912830e-01   -4.975399280705219e-01   +4.898307166851208e-01   +5.991667692110444e-01   +1.806874214856959e-01; +4.423509678226684e-01   +7.670944882572325e-02   +6.825913846528937e-02   -2.676256988837298e-01   +3.665462605521752e-01   +4.372426110216788e-01   +1.584538271506667e-01   +4.376978883886500e-01   +6.799002406334025e-01   -8.109705968552598e-03   +1.065798887843810e-01   +3.681433899637442e-01   +5.706561989474691e-01   +2.622938321974537e-01   -1.667204543276374e-01   +3.260329559598545e-01; +1.074008128485778e-01   +3.747571975086146e-01   +7.175830589298462e-01   +2.725180043007104e-01   +4.208007126630513e-01   +3.929021691993019e-01   +2.146369929488383e-01   +7.288980328153478e-01   +7.071661613634077e-01   +1.396595057082107e-01   +2.374551292487812e-01   +2.438930442262139e-01   -3.003388342533758e-01   +2.684337969340719e-01   +2.633423159002314e-01   +1.350966724065462e-01; -1.019019247476872e-01   +2.963684187815043e-01   +2.993057904995576e-01   -6.120884619153170e-01   +9.697711707784383e-02   +7.944767343553766e-01   +8.932690188315817e-02   +3.049046555803544e-01   -2.103439821988826e-01   +2.653243402311303e-02   +5.812896702819536e-01   +3.620304572049737e-01   +5.108215288691085e-01   +4.442840177033641e-01   +1.140523605335718e-01   +1.630748627035807e-01; +2.902301197133142e-01   -1.247926543015079e-01   +3.856690001945148e-01   +6.146109292573891e-01   -4.333018991159719e-01   -1.589333219974183e-01   +7.077226304997219e-01   -2.368957411808564e-01   -1.357232087749542e-01   +3.308958334344795e-01   -7.372862134696596e-02   +1.084088306626789e-01   +1.622466268456487e-01   +9.500539108556605e-02   +1.735849021767385e-01   -2.301185260801047e-01; -2.963872164797322e-01   +5.251648646708222e-01   +6.165396134462176e-02   +4.783423211499325e-01   +8.531059839694102e-01   +8.221410834592231e-01   +7.490392038555285e-02   +7.187839979363824e-01   -1.167052496945384e-01   +5.126995876345426e-01   +4.268901872330544e-01   +4.851969892397172e-01   +2.093567578804398e-01   +3.629506319345818e-01   +7.530194117199338e-01   +2.998579735264938e-01];
L1E_L1I_iGABA_netcon = [+1.276833971632434e-01   +2.580831976264403e-01   +1.278437042926901e-01   -2.138116463274608e-01   +3.920813869068168e-01   -1.151732104860277e-01   +7.516235013369894e-02   +1.720642979858827e-01   +1.889615314729386e-01   +8.590344106597939e-03   +3.717959849260853e-01   +4.223334077398312e-01   +7.866029044790814e-01   -4.101317472243662e-01   -1.294038077763735e-01   +9.083927427855849e-01; -2.123409008640819e-01   -6.996859193844819e-02   +4.974638857830195e-01   -2.765651052343908e-01   +1.160244464916225e-01   -2.681819813802895e-01   +5.144258482769690e-01   +2.441056127306007e-01   +3.363572870313518e-01   +2.648810888003056e-01   +4.855457398964290e-01   +2.203838327680360e-01   +4.797210010012080e-01   +1.523642238765553e-01   -3.714739367323230e-02   +2.952203050380723e-02; +1.959689074318539e-01   -1.015306412822657e-01   -4.036459433362859e-02   +4.784325659311260e-01   +4.145696993608640e-01   -1.816152789520485e-01   +3.521993692233994e-01   +1.178233403401589e-01   +5.048361399943022e-02   +9.762532474018683e-01   +5.823101880798112e-02   +1.381569700531680e-01   -8.335105112478644e-02   +2.157172991118923e-02   +3.276326449901019e-01   +5.614833047164972e-01; +5.034094163326019e-01   -6.646488724540993e-02   +5.502140340247544e-02   +1.759744014349676e-01   +1.454182948905280e-01   +2.374571786758522e-01   -1.418483187627880e-01   -2.363274068315152e-01   +1.207477195481812e-01   +1.510522737865806e-01   +1.544465732690433e-01   +5.019983226513339e-01   +2.162127288587344e-01   +2.552846284996327e-01   +1.174436323301289e-01   -1.198554510542326e-01; +1.051910185195282e-01   -1.217764435157142e-01   -1.653764543598836e-01   +1.397892971464677e-01   +4.976390646951270e-01   -1.784923748727151e-01   +2.984718061229762e-01   -1.630517521504452e-01   +1.505786188225968e-01   +1.918245149885373e-02   -3.774877183229939e-01   +6.044723505293331e-01   +4.860740765781829e-02   -2.074240393137556e-02   -1.960658050986029e-02   +3.547234724410677e-01; +4.392974544454908e-02   +1.646968489056117e-01   +7.081947297724094e-02   -1.234740835315944e-01   +1.277875036543214e-01   +5.037117505839501e-01   +1.984542204078596e-01   -1.888671313357345e-01   -5.139116045323350e-02   +2.182506594214385e-01   -1.143481149072022e-02   +2.874628661489668e-01   +1.307695956583600e-01   -1.994422371997154e-01   +5.065038059571162e-01   +2.060303266436721e-01; +1.439083197117171e-02   +8.058694363053751e-02   -1.069674936960378e-01   -2.294567556664778e-01   +2.554164657501152e-01   +1.820992470550177e-01   +5.222599279184093e-02   -2.586975173640537e-01   +2.324075505481200e-01   +1.084065238144079e-01   +5.023703406955156e-01   +2.251213308464420e-01   +1.679927234854097e-01   -2.539228760545895e-02   +8.015316682270046e-01   -1.738378891951810e-01; +1.963954641854067e-01   +1.853244575563232e-01   +7.319947144884457e-02   +1.701529786481093e-01   -2.446706780609754e-02   -2.330295339864586e-01   +6.236504883717536e-01   -9.344043450512804e-03   +3.904298060064332e-01   +1.522846679547101e-01   +4.054856760802638e-01   -2.861335088123592e-01   +2.626560903106893e-01   +4.124198608259073e-01   +2.654645257242209e-01   +1.572049424476010e-01; +4.210960990139651e-01   +6.172451990707919e-01   +4.008857164787826e-01   -5.976391018789191e-02   -8.358608342922903e-02   +1.412621507648233e-01   +3.276678561380668e-01   -3.278917772628783e-01   +2.888193800916118e-01   -1.275977821734897e-01   +1.783858580574670e-01   +2.773598882691948e-02   +1.480892884746506e-01   -5.474453310965244e-03   +8.225559298837682e-01   +7.933379291960954e-02; +1.860013380102333e-01   +4.855612071696488e-01   +3.863738697777451e-03   +2.520505937245861e-01   -7.133624648793231e-02   +2.084851614040404e-01   +1.645658477825780e-01   -9.051981647318852e-03   +4.106037109671317e-01   +2.397194135508833e-01   -4.602943559208986e-01   -2.849190073633018e-02   +2.691236737358247e-01   +5.150996071789734e-01   +1.991204949343350e-01   +3.767080335535666e-02; +1.621260728655947e-01   +4.402464940540589e-01   +4.695719584698592e-01   +2.450742970876620e-01   +3.774441927030512e-01   +1.565245492760198e-01   +1.819312433212556e-02   -1.342706824401856e-01   +2.821632887323700e-01   +7.203023094696973e-02   +1.646450533836082e-01   +6.824013335539213e-01   +5.052051252677624e-01   -3.439224215260681e-02   +8.091000081150831e-02   -4.275246834829603e-02; +2.077058779000964e-01   +1.326344226154901e-01   -1.059877959426012e-02   -3.774619648164044e-01   +9.685582780949958e-02   +3.961225454052587e-01   -6.558336762925618e-02   +1.697438135120610e-01   -2.621969575344352e-01   +1.366236287569801e-01   +3.843980455196417e-01   +4.273867908228292e-01   -3.298728423384557e-02   -1.028715632320083e-01   +2.768176388785577e-01   +2.492225650419748e-01; +3.278165300897047e-01   +1.428826262041223e-01   +1.929983315745623e-01   +7.531374051869062e-01   -5.573501748271442e-02   +1.972926726571048e-01   +6.219472466690334e-02   +3.278953499330177e-01   +3.429260951966323e-01   -3.287281026600068e-01   +3.809491278508785e-01   +2.995834620231876e-01   +2.266692284390796e-01   +3.509326895810102e-01   +3.792018646576600e-01   +2.563182453712782e-01; +4.012590874173833e-01   +1.452966198100935e-01   +1.168740252778725e-01   +2.794201888362318e-01   +1.986592158974919e-02   -2.099530299821053e-01   +4.364456226604829e-02   +1.570152918126541e-01   +2.336636782993737e-01   +2.073187602575260e-02   +3.075923757490505e-01   -3.118304437475377e-01   +8.496011471979625e-02   +3.520115230403292e-02   +2.704685622235232e-01   -2.416278627711432e-01; +4.683494612824103e-01   +1.458467167136826e-01   +8.726899563630326e-02   -2.426250708702580e-02   +3.167715908663565e-01   +2.184061746311983e-01   +2.920482239743796e-01   -5.160150855367657e-02   +3.006011550702451e-01   +1.341712207114207e-01   +3.094167139429969e-01   +3.110552461418970e-01   +1.461842683564470e-01   -1.197551164639923e-01   +3.455910350196469e-01   +3.052110648003097e-01; -1.827951224196091e-01   +2.495285696658551e-01   +1.422539000915228e-01   +7.407337290435398e-03   +1.940466083975171e-01   +4.971269768833960e-01   -1.307986453773675e-01   +2.908942689521296e-01   -2.547442408686364e-01   +3.037499942307293e-01   +1.547831328416292e-01   +3.446671479754932e-01   +2.281669854044064e-01   +2.161796436452284e-01   -1.813932334768519e-02   +3.454609557022589e-01];
L2I_L1I_iGABA_netcon = [+2.642046048929735e-01   -1.300195892266913e-01   +2.121673841358890e-01   +6.830567793300221e-01   -3.140618486827132e-01   -1.171484087981191e-01   +1.399364514861832e-01   -1.513393338019038e-01; +5.195470722934061e-01   +8.017768143993537e-01   -2.662177532179736e-02   +2.252278074928623e-01   +3.744304384605016e-01   +3.553533804277326e-01   +4.156056315846123e-01   -2.175115359807258e-01; +5.749999556539357e-01   +2.426589230467989e-01   +2.649161327397014e-01   +6.782540273902386e-02   +3.901232944376043e-01   +1.396828928508423e-01   +1.290099113155762e-01   -2.996844627320572e-01; +7.174010432086028e-01   +9.089673082412933e-02   +3.740615872642989e-01   +2.424746258555370e-01   +7.418238757755641e-01   +4.205739795521125e-01   +5.298879933151373e-01   +2.091354714891983e-01; +2.238152755699034e-01   +9.423621222030265e-02   +3.136330559987294e-01   +3.541362940488560e-01   +4.820332491788325e-01   +2.259170320987225e-01   +1.973634034021164e-01   -1.512169234526642e-01; +1.103264308504532e-02   +2.761222295360182e-02   +2.669816043066315e-01   +5.048144374655589e-01   -8.786357718024290e-02   +5.365347817705113e-01   -6.008657311702001e-02   +6.797062448635628e-01; +5.493644331156984e-01   +1.666271076274904e-01   +2.045349501051667e-01   -1.243279425518776e-01   +2.535900093450880e-01   +2.703953507714040e-01   +6.223371429571910e-01   +2.730982134962965e-01; +1.689616666101401e-01   +3.455475391483563e-01   +4.390106218892295e-01   +1.276646220987783e-01   +2.983976282815994e-01   +2.458460064779479e-01   -1.469173374440788e-01   +3.065404595282793e-01; +4.094634416081028e-01   +9.658175858815244e-01   -4.070035215392638e-01   +2.880335189350772e-01   -2.113804918670398e-01   +2.342284385273191e-01   +1.536919162824240e-01   +4.962491427901700e-01; +7.711896834824006e-02   -2.441400090488250e-01   +3.793979861165170e-01   +3.771653509121846e-01   +5.205650321176309e-01   +2.892366503439081e-02   +3.498527106120256e-02   +3.156078651657421e-01; +7.082295801278751e-02   +1.171416192034997e-01   +5.142723625066475e-01   +6.764529802660955e-02   -1.514903071399797e-01   -1.232775519787966e-01   +1.490320065416025e-01   +2.738577198474336e-01; -6.125274644024776e-02   +3.908548496534204e-01   +5.791043106345724e-01   +3.426323225375279e-01   +1.055070485059466e-01   +7.536107261089305e-02   +4.007179064512832e-01   +4.039184709472716e-01; +3.891965364652019e-01   +5.661539661690316e-01   +6.581466603649319e-01   -2.305258117726655e-01   +1.089201198011951e-01   +2.926261305032484e-01   -2.519056897630201e-01   +2.313859494100727e-01; +4.027316192175635e-01   -1.344198759433230e-01   +1.725339185834137e-01   -1.026923215832970e-01   +5.530085988108999e-01   +6.636626113442255e-02   +2.676928305185360e-01   -1.134646219607876e-01; +2.553749301074114e-01   +1.998300979267527e-01   +3.067906560099281e-01   +3.580074344857000e-01   +1.189162713267680e-01   +9.336737773625061e-01   +2.739378177670123e-01   +4.071826019388393e-01; -7.467218214979499e-02   -1.151140661622623e-01   +1.438453865557497e-01   +1.501735198026756e-01   +5.413566103769529e-01   +7.681840778153956e-02   +2.131228354897953e-02   +1.871236079717188e-01];
L1I_L2I_iGABA_netcon = [+4.596780635320121e-01   +2.074985140677210e-01   -3.765555702223865e-02   +4.135390367595154e-01   -2.765044906894973e-01   +5.275871077215795e-02   +6.382279888775873e-02   +2.564899591509102e-01   -4.151769887795488e-01   +5.899546801635470e-01   -1.199560744272537e-01   +5.396338554709691e-02   +5.346827863642253e-01   +3.447613883790023e-01   +2.360927977929963e-01   +5.362066527710518e-01; +4.146817149790485e-01   +3.571711976341936e-01   -2.701270855193492e-01   -2.348112519191840e-02   -2.443169201693165e-01   +8.854688403556990e-02   +7.043160805276547e-01   +3.101990476833826e-01   +4.788094232747639e-01   +9.750401903974395e-01   +3.458919955505802e-01   -2.714366889508957e-01   +1.207498950642612e-02   -4.716968094126001e-01   +4.156406504534132e-01   +4.154318000694472e-01; -8.584101992298181e-02   -1.187602534651511e-01   +3.886795583174430e-01   +1.763422738450934e-01   +3.541049938216228e-02   -2.440576800989598e-01   +6.296035504440308e-01   +5.612661445899112e-01   -3.054858746170221e-01   +4.837307094855635e-01   -2.619146008974447e-01   +3.741270757614291e-01   +6.801432172546729e-01   +5.731286597606585e-01   +7.201428201058561e-01   -2.008903277179490e-01; +6.278888777979127e-01   +4.262208417508532e-01   +3.582801028665414e-01   +2.152978865760548e-01   +8.218868704239424e-01   +3.055837914809397e-01   +9.054890145122758e-01   +6.740075730244813e-01   -3.561577553316788e-01   +8.707873079159355e-01   +7.513625062819546e-01   +3.435362170877491e-01   +4.581425664416116e-01   +2.653714252507194e-01   +2.707930380374921e-01   +1.265738144129535e-01; -4.917727817554005e-02   -4.358202867784590e-02   +6.009782678733755e-03   +2.679511040266611e-01   -1.627414071574859e-01   +8.735025802162614e-01   +7.079022674481980e-01   +2.139036078689247e-01   +5.686047848457190e-01   +6.009641428119754e-01   -2.733450005620335e-01   +2.679260488024158e-01   -4.661515619862173e-01   +5.200689454592060e-01   +2.172698491298834e-02   +8.937624354904976e-01; +1.417535423003101e-01   +2.508164196758598e-01   +7.252095213360171e-02   +6.127060904632371e-01   -2.666078897299782e-01   +4.531462132307995e-01   +4.369793172230361e-01   +1.626338863262553e-01   +4.240813216377035e-02   -1.703053506146053e-01   +4.994829106023446e-01   -3.456314863441333e-01   +7.229981998616695e-01   +9.404246238687375e-01   +5.161644805081824e-01   +5.802174928897808e-01; +3.763594559952663e-01   +4.552776854669523e-01   -5.365389199848400e-03   +3.072382742628830e-01   +3.693583223113835e-01   -2.450440021086372e-01   +4.173687614678807e-01   -1.484602155486912e-01   -1.425350837556025e-01   +5.802133143241806e-01   +5.685101440990072e-01   +3.544052432936700e-01   +1.797463535439604e-01   -2.912139047522983e-01   +2.074934743409581e-01   +6.528198569780036e-01; +3.733783962849068e-01   +2.532799976065122e-01   +1.322964874367785e-01   +2.810512695872752e-01   +2.047226443142208e-01   +7.158028451724645e-01   +3.937306502798650e-01   +2.024349207293033e-01   -1.751880857199800e-01   +3.101683417476848e-01   +9.064538959348336e-01   +4.771187143556491e-01   +5.096251338258649e-01   -1.035470781756410e-01   +3.290691311825829e-01   +3.206466724963736e-01];
L2E_L1E_iAMPA_netcon = [+4.505597907436898e-01   -9.496812090800240e-02   -2.301330471908947e-03   +4.265873040089753e-01   +9.596291234329938e-01   +4.276783908463026e-01   +4.667295296845616e-01   +1.512294838423890e-01; -2.837141583195643e-01   +5.145765135930576e-01   -1.877200405678783e-01   +1.564917568963234e-02   +5.302835583776395e-01   +4.120872085543592e-02   +5.857720975727581e-01   +4.073579793269148e-01; -6.150544764691983e-02   +5.249388156182916e-01   +6.083026958087363e-01   +2.369144579625996e-01   +7.873279627631204e-02   -2.722341371220487e-01   +4.705236058281416e-01   +2.967857798598343e-01; +4.736803864393356e-01   +3.217176798056295e-01   -1.088991759393599e-01   +5.674499856153530e-01   +3.087010133614742e-01   +1.711075304870200e-01   +2.247575400702310e-01   -2.971633182161164e-01; -2.862583064134230e-01   +4.644923901210061e-01   +5.756116428377021e-01   -2.037265427823724e-01   +2.620523318044622e-01   +1.778322273168448e-01   +4.009429092261567e-01   +5.913445556581542e-01; +4.290101668848034e-01   -2.054218509148674e-01   +3.003554304874920e-01   -1.956801398692563e-01   +5.061913524084901e-01   +8.798145699876251e-01   +2.725977519996079e-01   +3.484127764221941e-01; +2.077156946985588e-01   +3.755127222505953e-01   +3.041906318505142e-01   +2.495846590939723e-01   -2.520403121147932e-01   +4.497392784260361e-01   +9.482594663388318e-01   -1.312801585217540e-01; +1.347347972036043e-01   +4.339596436678287e-01   +7.521594642748560e-01   -8.659948869806772e-02   +2.035781789516177e-01   +1.529764220071878e-02   +2.915214462098970e-01   +4.285770286882301e-01; +6.569007820320436e-01   +1.152529125811982e-01   +3.062164127857286e-01   +7.955884532271177e-01   -4.230563385454766e-02   +3.256533462250856e-01   +3.263608937397762e-01   -6.800066732053746e-02; +1.576382303907942e-01   +2.406436031285693e-01   +2.362326172305572e-01   +4.988646884245503e-01   +1.187098511916038e-01   -7.212082298708186e-02   -1.137180051454545e-01   +3.306341402943379e-01; -2.347777843633763e-01   +4.643239864118076e-01   +3.479919923610280e-01   -1.328726279582556e-01   +1.103208018335263e-01   +2.556807053810767e-02   +2.902246979959682e-01   -1.188932990451262e-02; +3.664403445451950e-01   +4.182141279259086e-01   +7.092328478549295e-01   +3.120805820869242e-01   +2.334105946397821e-01   +3.090222594994995e-01   -3.231483796871576e-01   +2.160349884040885e-01; -2.078363475758240e-01   +4.257353257399344e-01   +2.915259917937559e-01   -8.650439019615593e-03   +2.014853162825944e-01   +7.745059157550840e-02   +3.094475978588007e-01   -6.780119488042996e-02; +2.104225637452557e-01   +5.463288381397010e-01   -4.017548974549472e-01   +7.348658104673297e-02   +4.073778449228307e-01   +2.501738027019305e-01   -6.449980872561420e-02   +3.003178640070857e-01; -3.254341560019545e-02   +1.644656195274813e-01   +1.436321712716603e-01   +5.979501589905076e-01   -5.691234149803036e-02   +7.038494277970402e-02   -2.898453246993622e-03   -1.136979923945989e-01; +2.212807875928645e-01   +2.355808295534712e-01   +1.376207594385440e-01   -3.130453593678641e-02   +3.268963033020967e-01   +3.932986554443560e-01   +5.155561303352179e-01   +7.078159868248222e-01];
L1E_L2E_iAMPA_netcon = [+2.539070597849509e-01   +3.681984961613705e-01   +1.327408032843223e-01   +2.597884533996337e-01   +3.571495868261411e-01   +3.704716894520675e-01   +7.807426900704009e-02   +2.514344977811263e-01   +2.239256154442564e-01   +1.712945267278768e-01   +3.849073035618549e-01   +2.556599375888203e-01   +4.209397245886406e-01   -2.209771505196503e-01   -3.192129897648932e-01   -3.758213869541493e-02; +2.380568408627992e-01   -2.879180248975812e-01   +7.628971948991008e-01   +3.516346299078440e-01   +1.209370262778992e-01   +2.022283843737427e-01   +5.742742154930999e-01   +2.954997434013029e-01   -7.293688207168694e-02   +3.759120268986063e-01   +3.198633750138832e-01   +2.296003479466042e-01   +5.544863730683923e-01   +3.561793540428891e-01   +4.390261713271278e-01   -5.389091617198138e-03; +5.110130763575145e-01   +1.911440212597172e-01   +1.042080977204070e-01   +2.639283955362574e-01   +2.417591880297317e-01   +4.330202228264650e-01   +1.923483601099994e-01   +3.896997112351695e-01   -3.355607088051222e-02   +1.031384393216138e-01   +4.517009667055822e-01   +7.216719455118052e-01   -5.918707098958941e-02   +5.162171410528916e-01   -7.038112444105837e-02   -3.033719952148961e-01; +2.730589603958295e-01   +8.506469324252014e-02   +2.918875600544206e-01   -1.684420188959756e-02   +2.144368226607382e-01   +6.209087506241181e-01   +9.577180760493754e-01   -6.023401580612801e-02   +1.574407166651864e-02   +2.072898424608440e-01   +3.356866790990298e-01   -2.121723169679570e-01   +6.932018794133242e-02   +6.407736716361265e-01   +3.976766622330432e-01   +1.516296735050991e-01; +8.106969723156006e-02   -4.564247484953666e-01   +5.922020976727154e-01   +6.525348451906585e-02   +6.183039112731477e-01   -1.105285383021520e-02   +3.631422408976753e-01   +2.205167604503656e-01   +1.822783930571111e-01   +2.241595178408841e-01   -5.439100097688850e-02   -3.080950571004606e-01   +4.807123155003181e-01   -9.807815327275010e-02   +9.640494071530128e-01   +5.614326352877302e-02; -8.421811805910388e-02   +5.465117965454703e-01   +2.366439310132693e-01   +6.830441190396389e-01   +3.714183780407125e-01   +1.884847314873068e-01   +7.319649432812756e-01   +2.920280860379392e-01   +6.523000015273721e-01   +2.010920543023233e-02   +5.998882633281289e-01   +2.127612354297715e-02   -1.314843900830156e-01   -3.262768736785463e-01   -3.757688653613993e-01   +2.627326428395809e-01; +1.003536968592549e-01   +7.405979113618483e-03   +9.012531728094328e-02   +4.834264414000103e-01   +1.450886646830886e-01   +2.818653846064900e-01   +6.434790631829069e-01   -1.040083508364969e-01   -5.364894888016588e-02   +3.481916638159618e-02   -1.004018082696235e-01   -9.145336890651130e-02   -2.898208062062412e-01   +1.358826708490823e-02   +5.014812700495641e-01   +2.063486897526605e-01; +3.572509660705639e-01   +2.906620521473618e-01   +1.887209562455316e-01   +4.421141948762176e-01   +4.739374900049126e-01   +8.644066177429448e-01   +4.718692758468587e-01   +3.316973105485683e-01   +3.621326361810159e-01   +2.986336372473472e-01   +7.317804331290194e-02   +2.809864384730209e-01   -1.910264499558031e-01   -2.823550875553805e-01   +5.082663001077162e-01   -1.210235132767240e-01];
L2I_L2E_iAMPA_netcon = [+3.871343526676927e-01   +7.509371616992959e-01   +7.656807438672396e-01   +1.099752828040709e-01   -1.460580713399535e-02   +6.768777691260587e-01   +2.935529930171045e-01   +5.691801383672772e-01; +5.567759422003187e-01   +1.643852782627334e-01   +9.254246180769701e-01   +5.265915055469333e-01   +5.279648905855616e-01   -7.316726026633266e-02   -6.879996106937630e-02   -1.223003276012612e-01; +1.577329635612209e-01   +3.436760095938744e-01   +1.743369285139416e-01   -9.030661725849512e-02   -2.461305434294082e-01   -2.503359350055625e-02   +4.323169280098239e-01   +1.706849983061588e-01; +1.107438962149306e-01   +9.366677989314084e-02   -2.023212581538554e-01   +6.591569438396395e-01   +1.278665124906273e-01   -3.238496250298895e-01   +2.471102075860501e-01   +1.159096772593708e-01; +3.999827434885260e-01   +6.765163312421260e-03   +1.727306026053159e-01   +4.619374247803894e-01   +2.117873714401062e-01   +1.198248668230350e-01   +6.207638820959701e-01   -3.021504511152714e-02; +2.749823675193117e-01   +4.035889515822364e-01   +1.525077800839195e-01   +4.433742937931385e-01   -8.031900669420776e-02   +3.828186859077125e-01   +6.172663681823679e-02   -5.621940986483172e-02; +5.274006907330833e-01   -5.203783918175194e-02   +4.070165959705298e-01   +7.278362528743406e-01   +3.578418220868181e-01   -1.163613825999572e-01   +9.076799247425700e-01   +2.357785329285838e-01; +3.308292084408064e-01   -9.060327169934243e-02   -2.363841739057060e-01   +2.152888454833043e-01   -1.015944532609323e-01   -2.593609732120282e-02   -1.916605944043970e-05   +5.548128006802828e-01];
L2E_L2I_iGABA_netcon = [-1.908558029647813e-01   +3.114491714922515e-01   +6.184648392281136e-01   -2.760454124825696e-01   -3.004495287537767e-01   +3.361997257185240e-02   -2.382538673148248e-01   +5.200772033188613e-01; +1.771922512012928e-01   +3.144206911940560e-01   +1.851564487736571e-01   +4.916846229898904e-01   +6.407180932724371e-01   +2.325422988861849e-01   -5.258765503768068e-01   +3.331399767296861e-01; +8.323753341458727e-02   +6.156122186929545e-01   -2.131213757637358e-01   -2.746550999650968e-01   +3.787084376789143e-01   +5.021143607184463e-01   +1.976523072075856e-01   +6.300367903904321e-01; +4.794401065001355e-03   +4.370887580318610e-01   -2.102613331321788e-01   +7.759906561760981e-01   +6.174283388962306e-01   -2.081562670406990e-01   -3.501728727749270e-01   -1.485625916254482e-01; -7.551340710474860e-03   -2.668118222056197e-01   -7.232000413232671e-02   +2.718500594044138e-01   +8.007623611742534e-01   +3.920188603181025e-01   +1.514041160083373e-01   +1.180992477438889e-01; +6.156127040658574e-01   +1.575664788988002e-01   +3.204719354735843e-01   +4.309141892063288e-01   +1.705287739193657e-01   -4.573306699304353e-01   +3.351646825186499e-01   -3.845889431653672e-01; +2.315779856434323e-01   +3.816514648878800e-01   -2.836419080218550e-01   -3.233402806621867e-02   -1.347061064384356e-01   -2.916388548512985e-02   +9.276895593379894e-02   +7.608383682810409e-01; -1.321923969192404e-01   +3.946034244228221e-01   +4.055811241402309e-01   -1.602569736551377e-01   +4.227294949846457e-01   +3.827836623684623e-01   +3.891149576815032e-01   +5.180787600505199e-01];
L3E_L2E_iAMPA_netcon = [+4.471359147842159e-01   -4.694364120374956e-01   +2.224822008780254e-01   +1.116251862005231e-01   +4.909116775027282e-01   +1.901214475576534e-01   +8.869549008097137e-02   +5.481936668263401e-01   +1.359087062454591e-01   -2.672398507314032e-01   +2.293352104399478e-01   +5.641255518651071e-02; +2.829275188956790e-01   +7.976604118234368e-01   -1.008506554443375e-03   +3.835992739923349e-01   -3.521935903678607e-02   -5.559233384254303e-01   +1.501813451796674e-01   +1.572372644530348e-01   -1.363938100895826e-01   +1.766631779254576e-01   -1.626073400511949e-01   +3.439240495952299e-01; -3.919395861957366e-01   -2.751828592038983e-01   +3.508263853090126e-01   +3.154071934013603e-01   +1.000000000000000e+00   +3.414601704046027e-01   +3.468123926410504e-01   +3.367343843449837e-01   +7.025390046336191e-01   -2.348416125589420e-01   +5.451428937647889e-01   +6.401191664891234e-01; +1.938034835816096e-01   +2.726353478032937e-01   +3.568528061927511e-01   +1.964706172968761e-01   +5.291854743461929e-01   +5.357104187719959e-02   +1.054433300975302e-01   +1.865111791226663e-01   -1.064237621375900e-01   +2.536921943786578e-01   -7.376805116238221e-02   +4.848335044217904e-01; +2.923218804689761e-01   +1.419455252083272e-01   +1.943560029732738e-01   +4.470955111180115e-01   +5.416260624339096e-01   +8.027312077451187e-02   -7.783762715466848e-02   -1.668420779365727e-01   +2.249484128043118e-01   +5.904190060595320e-01   +6.977404509757061e-01   +6.614268500610974e-01; +5.894061157377720e-01   +4.693638280879122e-01   +1.808255796519223e-01   -3.819586214749965e-01   +1.737220711918454e-01   +3.693035361154250e-01   +2.292239899958447e-01   -1.362875034740168e-01   +1.859609746830659e-01   +4.273664246859475e-01   -1.647826315102386e-01   +1.248376416666013e-01; +3.204825087027130e-01   +1.669789276680478e-01   +7.472014152015644e-01   -8.276389548963450e-02   +3.377533981489174e-01   +3.922297197648325e-01   +5.266336572001938e-03   +1.379648693919381e-01   +4.002458387201731e-01   +3.898440475691937e-01   +1.254503372705449e-01   +2.638600168321120e-01; -1.664292044996212e-01   +8.939512753739055e-01   +6.574735048002479e-01   -3.548786630984584e-01   +6.862165214876554e-01   +2.116835809706587e-01   -4.831599890881776e-02   +2.285477855581297e-01   +4.511302034200273e-01   +5.068217236224122e-01   +1.061307509214652e-01   -2.566771948995019e-01];
L3I_L2I_iGABA_netcon = [+7.042980116651988e-01   +5.700525643122135e-01   +9.479978563656896e-02   +2.321906574511158e-01   -3.267494991996767e-01   +1.275638561692232e-01   +8.664374879531584e-01   +5.722278916204576e-01   +7.513723740205437e-01   +1.724496953597158e-01   +2.347978725995664e-01   +5.268215354890095e-01; +4.291412753368786e-01   +1.705343868370526e-01   +2.795956867006387e-02   -9.840612499125130e-03   +4.899834302714250e-01   +3.735775950535705e-01   +6.709938335873427e-01   +1.881244228759038e-02   +4.017541852559193e-01   +4.417062916108982e-02   +3.528470089681146e-01   -2.766943562521029e-01; -1.057139276639711e-01   +5.408599059577545e-01   +3.683155954927471e-01   -9.257075087903389e-02   +3.055430318577414e-02   +3.063116245040209e-01   +4.029229960197356e-01   +3.424062826588536e-01   +2.580651430760559e-01   -1.777153916906318e-02   -1.699545911229685e-01   +7.663554788889103e-01; +3.444215438762659e-01   +2.634833796708128e-01   +5.470109426164010e-01   +7.422889770566678e-03   +1.097556510764282e-01   +9.515430023715643e-02   +4.742872357664791e-01   -1.395421711143617e-01   +5.687618547749810e-01   +3.512060107962918e-01   +8.555936179175837e-01   +1.279117536403124e-01; +3.165164452767631e-01   +4.785486991106234e-01   -8.241616185077344e-02   +2.314870876815652e-01   +5.612091645293624e-01   +6.097437385818547e-01   -6.615781468620005e-02   +1.000000000000000e+00   +6.540872028014134e-01   +7.032586223338493e-02   +3.183336657642442e-01   +3.523216956642716e-01; -2.231284247984148e-02   +3.924192384680225e-01   +3.120546608759907e-01   +1.798716847596153e-01   +8.037797496057538e-01   +4.665651502449246e-01   +4.667855979209352e-02   -1.828002219043970e-01   +2.668377510235617e-01   +3.377881995280468e-01   +5.547482319209001e-02   +3.406506236134323e-01; +6.094869726844776e-01   -7.669635348816428e-02   +3.923580400482201e-01   +2.746390120567291e-01   +3.031526448460234e-01   +5.353231039250246e-01   +3.783122263947485e-01   -1.393533520842042e-01   -5.485510081575765e-01   +7.545033394719254e-01   +4.376290516248817e-01   -7.012442445763467e-02; -1.277405845959215e-01   +2.694162146533935e-01   +3.938561911545941e-01   +3.539255466283851e-01   -5.115246722816430e-02   +5.944857145434874e-01   +7.050223769863750e-01   +4.566978297672130e-01   +4.045671617441544e-01   +3.097915997539773e-01   +3.948861789758362e-01   +3.143039635299811e-01];
L2E_L3E_iAMPA_netcon = [+4.851680712891093e-01   +1.265399356231365e-01   +4.798674855939348e-01   -3.016793900555735e-01   +4.594740728396304e-02   +2.050736501955181e-01   +5.985098669066968e-01   +3.741576329190038e-01; +5.495736432906173e-02   +1.967430087083820e-01   +1.609183012042224e-01   +2.860260257996844e-01   +4.608068157686444e-01   -1.301853734837043e-01   -1.611607960593853e-01   -2.601988489036202e-01; +2.758322584291407e-01   -5.381039133800729e-02   +1.791728431987094e-01   +3.844163892358746e-01   +2.323878110985420e-01   +1.540318113113365e-02   +2.417749393198380e-01   +1.321547645504720e-01; +2.859053821682944e-01   +2.354228036175933e-01   +7.081183383873959e-01   +8.005010096934522e-01   +3.319596597524695e-01   +5.891898291252803e-01   +1.406143059869026e-01   -1.813556703289707e-01; +2.966692377168362e-01   +5.008407394665958e-02   +1.846844835785871e-01   +7.178049761978477e-01   +5.561619260286798e-01   -2.295560929121598e-02   -6.398637548393279e-02   +8.029362155581424e-02; +3.267599889046523e-01   +6.939764896180057e-01   +5.147631404513470e-01   +5.930808401741172e-01   +5.509719471431014e-01   +1.009211707871998e-01   +3.687385943743566e-01   +1.325984757145530e-02; +1.600145683725723e-01   +4.389447159260887e-01   +5.292007212634402e-01   -1.364388774864465e-01   -7.153752204238871e-02   +4.854442453491398e-02   +8.176446481182889e-02   +3.994681737388640e-01; +2.160088950298219e-01   +3.814049556191678e-01   +3.021267800982644e-01   +2.002315860886685e-01   +2.263864563429558e-01   +3.556726490012345e-01   +2.347684409901564e-01   +7.374075971497298e-01; +4.595737249297782e-01   +5.289287066546968e-01   +4.286358885953853e-01   +5.464464449780461e-02   +9.201048580422516e-02   -6.142043762191719e-02   +7.791221941941200e-01   -2.840369286018285e-01; +9.265958885605900e-02   +2.664454578725091e-01   +2.955182721563349e-01   +1.508318200456413e-02   -2.146787563073692e-02   -7.547907160911405e-02   +4.011372876083752e-01   -3.049085678571868e-02; +4.494280706274076e-01   -1.548454812069956e-02   -1.065252024713259e-01   +9.482326812315162e-01   +1.616963071954686e-01   +3.419652748025176e-01   +1.462629273644294e-01   +2.187445054296535e-01; +2.038985088787068e-01   +7.786107276134591e-01   +5.702151650924467e-01   +6.882522608222363e-01   +1.403662689654497e-01   -8.256571956250197e-02   +1.847090461037085e-01   +3.539150946915068e-01];
L2I_L3I_iGABA_netcon = [-2.164462594658945e-01   +1.052104189867794e-01   +2.077750954201877e-01   +3.688939534868980e-01   +8.880853851136669e-02   +6.953264147640501e-01   +2.940638043346199e-01   -1.139579567994186e-01; +3.203524979189243e-01   +1.773825090733646e-01   -8.141423562037350e-02   -1.151081911678610e-01   +3.073321237525260e-01   -7.228377789586080e-02   +4.457933150149939e-01   +3.244531449095348e-01; +7.585798373124044e-01   +9.228301829684723e-01   -6.484357399211268e-03   +6.020320831301745e-01   -8.400455351960762e-02   +7.871756229176606e-01   +2.711216670868134e-01   -3.905034360928188e-02; -7.569489111116455e-02   +2.538261530074075e-01   +8.964233231160832e-01   -3.509708253084617e-01   -8.016246229856185e-02   +5.309773748300923e-01   +1.026895420024209e-02   +3.094971332674537e-01; +5.974076356108742e-01   +2.298668989382802e-01   +5.119207195517826e-02   +2.649241903255298e-01   -2.101848167324818e-01   +1.662883001706982e-01   +9.095015752229965e-02   +6.190657985305514e-02; -3.552218952202387e-01   +2.337238975128287e-01   +8.365292212710788e-01   -2.002198159530051e-01   +3.925984982674027e-01   +1.000000000000000e+00   -4.101752001632527e-01   +4.250315681113116e-02; +5.214139833298242e-01   +1.154050672119646e-01   +4.081580096137713e-01   +2.291770467880296e-01   +3.268361784762553e-01   +4.347059071292561e-01   +9.433542364153339e-01   +4.770173234006790e-01; -2.788991105364763e-01   +5.823483486764462e-01   +2.631408219382586e-01   -4.205970829032906e-02   +5.865353634029169e-02   +3.936434911953980e-01   -1.071933635749428e-01   +7.581201816288916e-01; -9.924597596063859e-01   +7.772484412853342e-01   +5.802235003985096e-01   -1.612763258977968e-01   +2.859517120075137e-01   +4.169734810073423e-01   +5.438069450701990e-01   +3.041859417240925e-01; +2.492727716892395e-01   -2.485194058656118e-01   +2.479951959744323e-01   +1.429992022517129e-01   +4.423095193737455e-01   +4.490878580395504e-01   +1.372510397079347e-01   +5.990407162193819e-01; +8.401054637297574e-01   +4.808635222872413e-01   -5.168581121496678e-01   +2.742196638228788e-01   +2.696200631228129e-01   +2.381351429467592e-01   +5.657145112049338e-01   +7.952739574315028e-01; -5.116311144773736e-01   +8.650947933640049e-01   -3.792235239049719e-01   +7.498477918193869e-01   +6.008125882961434e-01   +2.229030593996155e-01   -1.349228620710700e-02   +1.633735493262176e-01];
L3I_L3E_iAMPA_netcon = [+2.475021695244965e-01   -1.214503954408650e-01   +2.279555549571068e-01   +2.656410170494599e-01   -1.467843674890618e-02   +7.386708229427458e-02   +1.929370034320598e-01   +1.179751491550008e-01   -2.054598944911183e-01   +3.731362197958095e-01   -1.158781619467300e-01   +4.028145663734027e-01; +6.439555166802870e-02   -1.075419174306497e-03   +5.491028689955443e-02   +4.864446985677977e-01   +2.012560043928076e-01   -1.637249175578798e-01   +2.443845655676655e-01   +3.269191301024911e-01   +5.034752093871144e-01   +7.953398540948969e-02   -9.954929718161807e-03   +1.209665826163397e-01; +2.538334615121259e-01   +4.703158557766040e-01   +5.524309303405744e-01   +7.509562824713881e-02   +6.159961307770940e-01   +1.884066129454238e-01   +6.462753263714667e-01   -2.006504618375141e-03   +3.262554674257503e-01   +4.797444627644294e-01   +1.483124738467579e-01   +2.722412237278795e-01; +4.019300081821697e-01   +2.727790892064154e-01   +5.011441155908345e-01   +6.523536846842234e-02   -8.169665256572808e-03   +6.110660750251212e-01   -1.546605577564531e-02   +3.071855502941140e-01   +2.003305763095185e-01   +2.965229451401672e-01   +2.333969303940773e-02   +1.019731125062475e-01; -1.215527288782151e-01   -1.555746094593688e-01   +8.157336311903702e-01   +2.487716609936685e-01   +3.300000588357277e-01   +3.189305221240953e-01   -1.657654303686930e-01   +3.422053318641334e-01   +2.984758903265430e-01   +6.065333737678668e-01   +2.792291144041896e-01   +3.070884593652135e-01; -1.224382488114408e-01   -2.684583583737308e-01   +1.667348846309323e-01   -1.145893709465523e-02   -2.975068682787787e-01   +9.447670525252222e-02   +2.898403655576922e-01   +2.519883616884200e-01   +3.323041707600625e-01   +7.387591637131785e-02   +2.330371247885617e-01   +4.690205031891866e-01; -1.434901047428935e-01   +1.374568512909859e-01   -2.024726308972321e-01   +6.950477280631702e-02   +3.020126073371034e-01   -2.421455842894132e-02   +7.236805027873506e-01   +4.594493014470779e-01   +5.522805091743933e-02   +3.350179212538316e-01   +3.301277310777438e-01   +1.768134849820355e-01; +1.101791124379430e-02   +2.874417482443219e-01   +2.958333561672390e-01   -1.102848327827025e-02   +7.975753330746187e-02   +8.315515306507820e-02   -2.102496886754295e-02   +3.714926482782032e-01   +2.482336999678692e-01   -2.485784994627406e-01   +1.147234419799950e-01   +3.235186729226558e-01; -1.242800112050686e-02   +5.300294316939451e-01   +1.971258839208018e-01   +4.188894674236424e-02   +1.059061994558562e-01   +5.894901642107991e-01   +2.280324480122112e-01   +4.875889711195112e-01   +1.197653961197762e-02   +6.340113588652743e-02   +5.366643949710811e-01   +1.000000000000000e+00; +6.242299654350159e-01   -5.290452623156247e-01   +6.309927421587707e-01   +1.812629602304329e-01   +2.504824965500927e-01   -4.406480550330358e-01   +5.303206385818925e-01   +2.379293440917961e-01   +6.090908536510799e-02   -1.512136944441453e-01   +9.035205363253612e-01   -1.414285434225400e-01; -5.069700194140799e-01   +3.096172512810292e-01   +6.419115129021722e-01   +4.729217636572354e-01   +5.898006699073333e-02   +9.743135116336676e-02   +2.842224337010601e-01   +1.573458831640007e-01   +5.404858450648468e-01   -1.518608461938084e-01   -3.488117002553724e-02   +2.733219987842757e-01; -1.820598852475623e-01   +1.775203974043728e-01   +2.833228396508168e-01   +3.450160665863898e-01   -2.224820496814238e-01   -2.277402576956783e-01   -3.672453036048986e-01   +2.698095037291451e-01   +6.171650537785798e-01   -2.584323379937693e-02   +2.663334066341063e-01   +2.457154038004600e-01];
L3E_L3I_iGABA_netcon = [+2.230407234608419e-01   +1.205006858490706e-01   -1.439185172486531e-01   +4.151139418833593e-01   +2.236941905515710e-01   +5.919369883725878e-02   -5.123895068853157e-02   +1.607493914763804e-01   +7.488824282955750e-02   +3.179653605913135e-01   +2.967199528067406e-01   -7.682069479903686e-02; +4.254351364052243e-01   +4.075180227709366e-01   +1.173913241688463e-01   -2.350919655537693e-02   +3.124721520867090e-01   +2.103003578264853e-01   +2.491919921341022e-01   +3.717102875729386e-01   -4.061150892824726e-01   +1.239309107493054e-01   -2.822842426789922e-01   +2.180937769110051e-01; +1.365751497073497e-01   -7.399803059111881e-02   -3.621767206098727e-01   +1.506775953475769e-01   +1.312453157849732e-01   +9.036079382290746e-02   +8.954838196610199e-02   +2.904244074048747e-01   -1.819478416509039e-01   +3.423877229626938e-01   -2.044968610749490e-01   -1.510633045875254e-01; +1.109826243231272e-01   +3.194531571098185e-01   -4.054568094689521e-01   +4.302817044285082e-01   +7.052988766694280e-01   +2.486989230981131e-02   +2.855709074518974e-02   -7.430047556900896e-03   +5.711593459531407e-01   +2.897641135114715e-01   +1.926044652086924e-01   -5.502192118861344e-03; +3.043137118131836e-01   +8.726961589269058e-02   -1.789318390345231e-02   +2.926405010411610e-01   +2.700997021042731e-02   +1.749083445862134e-01   -1.291920731427090e-01   +5.836539150116685e-01   -2.009481631483218e-01   +4.388804705723298e-01   +4.245788029123843e-01   +2.402429877863326e-01; +4.246568493540147e-01   -3.293109178013646e-02   -3.722843253548363e-02   -6.562703691054846e-02   -3.470753399298291e-03   +2.824738703652804e-01   +8.996189216784907e-02   +1.637062198494567e-01   +3.838477778788913e-01   +3.637904436597902e-01   +1.383105992754393e-01   -2.642140727029650e-01; +8.893181396763757e-02   +1.437305384716613e-01   +3.455727738639308e-01   +9.702356959702219e-01   +2.846234364854833e-01   +4.987297404171442e-01   +4.870599005857424e-01   +2.273937957297175e-01   -9.882766556925794e-02   +2.227928896935838e-01   +6.065930487128656e-01   +1.582620480474947e-01; +1.865981118446344e-01   +9.426857785625989e-02   +5.468859813903746e-01   +1.800788503406804e-02   +2.658546694927765e-01   -1.610128557293146e-01   +9.916089563477352e-02   +6.913517509414703e-01   -9.573760502103068e-03   -7.786218581214377e-02   +4.395471735935839e-02   +3.527184217897236e-01; +2.959550992030796e-01   +6.098134108917365e-02   +3.986132216293324e-01   -1.315582614504166e-01   +1.864479658784383e-01   +1.017359544198935e-01   -3.742255162597548e-01   -1.394874486377948e-01   +4.029945531420571e-01   +4.953548707159156e-01   +2.965679666315612e-01   +5.880351542941180e-01; +1.802314857247428e-01   -8.871152541961604e-02   +4.244991303606251e-01   +2.489989533448108e-01   -2.570428882577281e-01   +3.429158121873869e-01   +1.703285932112874e-01   -5.212745679323870e-02   +1.930067874951998e-01   +9.452680926567432e-02   +3.196477766469437e-01   +3.086955701704878e-01; +2.660384027822592e-01   +1.913299257816708e-01   +4.189840224623086e-01   -1.382845362847125e-01   +1.527624781193189e-01   -2.068332815090710e-01   +2.668257069318201e-01   +3.477550244215989e-02   -2.371895132090678e-01   +8.779891147614824e-02   +3.003868786408863e-01   +4.522968391104698e-01; +5.247841171694333e-02   +4.546590980237822e-01   -3.300416956251485e-02   +4.772992963547579e-02   +8.071563088232732e-01   +3.603536584118754e-01   +4.358522772515231e-01   +1.336018752202159e-01   +8.272144827010125e-02   -1.045370050860936e-01   +2.346595725321993e-01   -2.839001148260020e-01];
L2E_Input1_iAMPA_netcon = [+6.696278265896877e-01   +5.486651239871425e-01   +7.090080801802157e-01   +8.825186859467959e-01   +1.000000000000000e+00   +6.911557832974958e-01   +4.828461694694171e-01   +7.760821979616886e-01];
L2I_Input2_iAMPA_netcon = [+6.548698142623884e-01   +6.873172482925008e-01   +6.931844839291149e-01   +8.531175261167024e-01   +2.087256565569194e-01   +8.850226909347514e-01   +1.289693732147223e-01   +1.260618959726545e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last =  11.21 * ones(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.2*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.2*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.2*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.2*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.2*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.2*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.2*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.2*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
