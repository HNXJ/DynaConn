function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+8.236003086396304e-01   +4.232448371687782e-01   +5.307217997807087e-01   +6.372924052375369e-01   +6.003527605826710e-01   +3.409661092077352e-01   +6.480414359553451e-01   +8.398040380652398e-01   +5.448054621705536e-01   +1.931891379278519e-01   +4.455509764521130e-02   +8.225658923077236e-01   +7.677884005021696e-01   +1.099402597910976e-01   -9.721114854471966e-05   +8.392831158614761e-02; +9.836539045259930e-01   +9.551636130671322e-02   +3.240427101881801e-01   +9.569025221737892e-01   +3.871120980421707e-01   +6.062052895478778e-01   +6.781442509860883e-01   +8.317755143371184e-01   +7.223826742098607e-01   +1.381283518809446e-01   +7.536746411489019e-01   +4.298062618032397e-01   +1.679804496783594e-01   +1.355418098682248e-01   +8.654684989702714e-01   +6.267072920014161e-01; +7.308542151138709e-01   +5.977631679203402e-01   +1.054454202130186e-01   +2.422121843359658e-01   +9.158979912539132e-01   +1.911617473882732e-01   +6.350205148400062e-01   +2.560320764742759e-01   +5.217114093043663e-01   +6.958266638397684e-01   +2.424670428041841e-01   +8.877075814769504e-01   +8.633446088378716e-01   +6.789018117399996e-01   +6.123604528121280e-01   +6.615847381474247e-01; +3.438318559080479e-01   +4.726998875083928e-01   +6.114523329946391e-01   +6.758949781508852e-01   +7.944806550896621e-04   +7.390273841262169e-01   +9.454942771493283e-01   +6.131583149085096e-01   +9.930934957213843e-01   +9.267388657749999e-02   +4.433330957734573e-01   +3.917239577479827e-01   +9.904635578951368e-01   +4.943482611210628e-01   +9.890669291035943e-01   +7.301346815872324e-01; +5.855371554422887e-01   +6.962485022933284e-01   +7.792770037076929e-01   +2.881923808247159e-01   +4.621819591249421e-01   +2.422418659058241e-01   +2.091460569278509e-01   +5.826585509120410e-01   +2.207318088662785e-01   +5.241093102451174e-01   +6.877527949670426e-01   +7.695910554581358e-01   +5.159439297182173e-01   +1.890496098817037e-01   +5.261972689767127e-01   +8.926318583307312e-01; +1.089496224299081e-01   +7.006547779876475e-01   +4.240958260800145e-01   +6.705731919493604e-01   +4.248813137490863e-01   +9.184947097113889e-01   +7.094799296145551e-01   +5.403631573847789e-01   +1.047037926662475e-01   +5.307904101549752e-01   +3.590173717980038e-01   +3.970152788413695e-01   +8.841356454162509e-01   +4.946504485887579e-01   +4.807323749505349e-01   +9.825252654113903e-01; +9.057175869094889e-01   +6.395245155130092e-01   +9.025624230682763e-02   +6.948451827048129e-01   +4.613844967219966e-01   +2.705902664402552e-01   +2.370649681824214e-01   +8.711453221469208e-01   +1.112176546399796e-01   +8.619688850313910e-01   +7.369664057696884e-01   +8.099035732557999e-01   +5.877148661607395e-01   +1.478022196045422e-01   +8.019984640012980e-01   +7.688555588364140e-01; +8.805125741357254e-01   +3.373808930722779e-02   +2.654329750695957e-01   +6.722396797942132e-02   +7.705555563395868e-01   +7.656837358454859e-01   +1.191978549270749e-01   +2.643220191306679e-01   +6.505235257682250e-02   +4.849750876303993e-01   +3.940815292516763e-01   +7.549929605754978e-01   +1.547317118380824e-01   +5.346757072643052e-02   +2.286462793124547e-01   +5.827470859469122e-01; +8.176801159336862e-01   +6.836491818056251e-02   +1.534128039845929e-01   +2.534029193088129e-01   +3.236320317107628e-01   +1.897611517659601e-01   +6.078563635580997e-01   +3.166365410264796e-01   +4.037467733328979e-01   +3.926555759177177e-01   +6.842087833779977e-01   +3.774779641463902e-01   +1.995139091622358e-01   +8.509307626039702e-01   +4.967941831600123e-01   +9.262350674419737e-01; +2.602219786066889e-01   +3.187514448619655e-01   +2.816464801295298e-01   +2.216905493540489e-01   +7.844292202595834e-01   +2.862112886210532e-01   +4.513488460712802e-01   +1.189384848932948e-01   +4.471976101599420e-01   +6.719262857238268e-01   +7.042695331625092e-01   +2.165217694240986e-01   +4.072901351146408e-01   +5.621911789596334e-01   +8.990108919419956e-01   +5.813169693366598e-01; +5.937777420832259e-01   +5.302102964516769e-01   +4.415844310969249e-01   +6.684027486754158e-01   +4.707616664484267e-01   +9.058891392298371e-02   +4.583551176422819e-01   +9.402306603524057e-01   +3.653290187227623e-01   +7.420547461668336e-01   +4.425688964185301e-01   +7.900545574231681e-01   +7.485215412117838e-01   +9.298393305166670e-01   +5.755852428067192e-01   +1.619116497992272e-02; +2.285241810134421e-02   +6.538727012230010e-01   +5.264943738937750e-01   +8.440325842276269e-01   +3.543979219034992e-02   +5.783412065368270e-01   +6.622073878927778e-01   +6.463087429460992e-01   +7.624654198246302e-01   +5.191582070737910e-01   +1.838249969396805e-02   +9.493498798671007e-01   +8.245714840733666e-01   +6.975533495124235e-01   +8.448237930548574e-01   +1.217035730177421e-01; +4.263571567863330e-01   +4.075023877792884e-01   +4.580238735999217e-01   +3.453850986914598e-01   +1.769997587634122e-01   +6.838882441936357e-01   +7.697104149303864e-01   +4.802613442735320e-01   +6.265762471283911e-01   +3.455324009290480e-01   +3.298271816682634e-01   +3.290350079513072e-01   +7.914467022330388e-01   +5.839869723820362e-01   +7.387036800651677e-01   +8.621905339168161e-01; +3.123949527575648e-01   +8.190510994586233e-01   +8.746498182237777e-01   +7.817859990537643e-01   +7.207820810887164e-01   +5.474485965229987e-01   +3.498980230717505e-01   +6.393725868937080e-01   +7.726515614846181e-01   +1.495063247188307e-01   +4.232599327239960e-01   +6.724384504930032e-01   +3.188145738940942e-01   +8.159157191714901e-01   +5.857629573631264e-01   +4.831520285679796e-01; +1.606552915525787e-01   +7.200533878872877e-01   +5.192238251498358e-01   +6.762474404945065e-01   +4.735546017960820e-01   +4.244918054215936e-01   +6.617065866682166e-01   +5.446578096775964e-01   +9.332643843056034e-01   +5.865586641247500e-01   +2.693509928443638e-01   +4.404255209014132e-01   +5.335357306147654e-01   +8.807001683262616e-01   +2.451567971001425e-01   +8.444530960635628e-01; +1.780026513952701e-01   +9.687561265816922e-01   +9.452369635631263e-01   +7.941577055253049e-03   +1.533822591674985e-01   +6.432971474634428e-01   +4.158892059879418e-01   +6.466525004688650e-01   +9.733666171245734e-01   +2.612151924667047e-01   +1.972195082662588e-01   +8.326006504682731e-01   +9.036198168673627e-02   +9.894102793766703e-01   +6.659330533543819e-01   +2.094109816932765e-01];
L1E_L1I_iGABA_netcon = [+5.512654698153130e-01   +6.945483176978207e-01   +1.047166962860605e-01   +1.770500388267116e-01   +5.529254552807168e-02   +1.789346395472816e-01   +5.959848735069236e-01   +9.968817444340672e-01   +3.392172648288014e-01   +7.794475605812431e-01   +6.830713947681903e-01   +3.649194686351783e-01   +7.827154972152931e-01   +4.328404040199625e-01   +5.918450283258486e-02   +9.745559254721255e-02; +6.315957705637566e-01   +4.989979753845325e-01   +1.420870822752876e-01   +3.982917623735656e-01   +1.776698007522034e-01   +3.606491722497065e-01   +3.006929033729093e-01   +3.307559945844329e-01   +2.936986962852698e-01   +3.381442932190937e-01   +1.314071449486217e-01   +3.690494975526028e-01   +1.008776076276696e-01   +6.550891200790974e-01   +3.145263037203034e-01   +1.414910920418041e-01; +3.263885235837566e-02   +5.349405896914231e-01   +1.666519750407053e-01   +1.329362516215374e-01   +6.610164298082616e-01   +5.668216990639503e-02   +1.342949310174184e-01   +2.968495248972102e-01   +7.457441648300278e-01   +6.077210226844096e-01   +7.226417380018515e-01   +6.843783510318270e-01   +2.932733289990317e-01   +1.110156449975919e-01   +7.721562871907242e-01   +1.693167741831955e-01; +6.147189712304826e-01   +4.432819703806067e-01   +6.220847423969854e-01   +2.946124417072555e-02   +3.320928320119776e-01   +5.219464859851420e-01   +2.112468115065423e-01   +6.248950395525165e-02   +1.055404071835897e-02   +7.411077611020160e-01   +1.104183341967473e-01   +5.978913670755051e-01   +2.365285157031883e-01   +9.321435409467427e-01   +6.953651614811515e-01   +1.953157285944690e-01; +3.630023015200884e-01   +1.235262888556937e-01   +5.739755473173423e-01   +9.381188468939736e-01   +8.982589700170245e-01   +3.345723504870391e-01   +8.956998320367456e-01   +2.976038209007904e-01   +4.779665220865659e-02   +1.052304958502796e-01   +1.165582451920541e-01   +7.885001970343791e-01   +5.302463446390093e-01   +1.853390163025027e-01   +1.250248643791669e-01   +3.177572945535556e-01; +4.963558598364646e-02   +4.910832215458328e-01   +5.261748828254373e-02   +3.021396528648130e-01   +1.175006659599641e-01   +1.741674150846771e-01   +7.181778269822296e-02   +4.504547618655324e-02   +6.680530795339309e-01   +1.265118886016859e-01   +6.401197812068425e-01   +3.680414161660976e-01   +9.221371613453337e-02   +2.669551220796760e-01   +1.280602975985592e-01   +3.173029969042060e-01; +4.876687684264722e-01   +8.524545883064865e-01   +9.321466245525842e-01   +2.959690897514393e-01   +9.883098256731095e-01   +2.101984354723899e-01   +2.431043078004415e-01   +5.053815207847988e-01   +6.044337429085460e-01   +5.491226783983701e-01   +3.288140972571349e-01   +2.058491229569359e-01   +4.056207835185364e-01   +7.981426695238875e-01   +9.185323669973873e-02   +2.170786550295735e-01; +1.921522796386445e-01   +8.743230392672867e-01   +7.281642899483720e-01   +3.350219499349082e-01   +5.417439646200366e-01   +9.052479659282359e-01   +5.423827209049344e-02   +7.610377116073687e-01   +5.262065141734255e-01   +4.849451580068086e-01   +6.541309548149723e-01   +8.711789697061209e-02   +1.037676792267514e-01   +4.878471312053111e-01   +8.967374092366170e-03   +2.517082322417714e-01; +1.225221747961911e-01   +2.706164120636078e-01   +7.375388157154543e-01   +4.683098191891729e-01   +7.055942803936665e-01   +6.747444438540390e-01   +4.407627583811686e-01   +6.323101363203498e-01   +7.290880162538786e-01   +8.906771149924501e-01   +7.506777731403615e-01   +7.725350339244730e-01   +1.114134599513866e-01   +7.692478568272364e-01   +4.235009071168158e-01   +8.934156791840686e-01; +2.060818088199097e-01   +2.093420054086104e-01   +6.316784067123797e-02   +6.479980053755890e-01   +9.988360229786671e-01   +4.680558022320775e-01   +1.420673480175525e-02   +9.076680543593731e-02   +7.073830656508466e-01   +7.995817092551996e-01   +5.839132926583929e-01   +2.076353471819358e-01   +7.859706635911359e-01   +3.969269672132371e-01   +6.554641390049593e-01   +7.025712001681395e-01; +1.465642508689036e-01   +5.641014855303186e-01   +8.592800446142150e-01   +2.406521692514253e-02   +2.885055627957869e-01   +9.119946873508991e-01   +8.969607801426351e-01   +8.036813455760600e-02   +7.810008126718369e-01   +7.345639876101024e-01   +7.412893756922304e-01   +3.891415147284243e-01   +2.908802512805891e-01   +2.730657831099308e-01   +7.230404823432420e-01   +5.551951301694095e-01; +1.892563045745891e-01   +6.391169389510367e-01   +9.329017962902797e-01   +8.426570096824557e-01   +4.134062189931769e-01   +1.034923699331711e-01   +1.952738311895350e-01   +7.755598999771328e-01   +2.886622463102221e-01   +5.318797762301187e-02   +2.342247143750877e-01   +5.522077547663339e-01   +6.043190673349008e-01   +3.759419040784336e-02   +5.302677470580156e-01   +1.844432277070497e-01; +4.340808820906324e-02   +4.165050005109891e-01   +9.834462536309045e-01   +5.580837451779557e-01   +4.664264603799277e-01   +7.442753059778506e-01   +9.291421366971499e-02   +9.054782567328190e-01   +6.900311758809921e-01   +7.229594764720530e-02   +7.341499681610596e-01   +2.285175476965206e-01   +9.633623634367401e-01   +6.739148763238616e-01   +1.075982253058741e-01   +2.117660343980966e-01; +6.351078284566659e-01   +2.063146703958397e-01   +8.575915086996249e-01   +8.539209316513494e-01   +7.645611515580647e-01   +7.372117106808423e-01   +3.074170336163782e-01   +5.331272009039261e-01   +5.561204081991419e-01   +8.739901372893079e-02   +9.709486813086011e-01   +6.419642808906175e-01   +4.320573068843597e-01   +4.300906885790818e-01   +6.327413216929160e-01   +7.723465998440629e-02; +2.817949722825388e-01   +9.487051755540619e-01   +7.856107940637654e-01   +3.485416558374622e-01   +8.172989304902455e-01   +5.619517951575018e-01   +4.557460436988660e-01   +1.081630432405276e-01   +3.952588307775663e-01   +7.964817145270470e-01   +8.673079360654425e-01   +4.836379363699535e-01   +6.950017430877644e-01   +4.504173601437361e-01   +1.279862769414228e-01   +9.145074257820954e-01; +5.379934581212268e-01   +8.100320181922890e-02   +5.142907219599041e-01   +4.463243342946352e-01   +1.000875437043653e-01   +1.852992957242011e-01   +1.015559858482210e-01   +8.275280443350447e-01   +6.162763326038918e-02   +9.429845849831429e-01   +8.623248480392770e-02   +1.517666217448412e-01   +7.577129747255298e-01   +6.084098454174605e-01   +1.341757320375270e-01   +7.069171945928051e-01];
L2I_L1I_iGABA_netcon = [+5.584122645476131e-01   +1.597738588016590e-01   +4.236796693392700e-01   +6.825991305686614e-01   +8.086201822555692e-01   +7.954548184373269e-01   +7.886384250806993e-01   +2.611862394873986e-02; +3.125466505265425e-01   +7.584260212042662e-01   +4.291902463433643e-01   +4.633397527946783e-01   +7.478297690331955e-01   +5.781114287738367e-01   +8.513646164706179e-01   +4.214122248940090e-01; +1.655564862591470e-01   +8.702941774443582e-01   +1.247195575577272e-01   +2.132641829131590e-01   +1.192243815302719e-01   +4.414549691131607e-01   +5.061306760195479e-01   +1.829036983899521e-01; +6.210273772388765e-01   +3.511761907143122e-01   +2.386019096003503e-02   +9.854629022240503e-02   +5.247107089344121e-01   +2.577484826715012e-01   +6.354649866341927e-01   +7.261253158281801e-01; +9.872458384627057e-01   +6.862554927307645e-01   +2.901993805842126e-01   +8.228303679998412e-01   +3.257869844276288e-01   +7.516074960206498e-01   +9.519152713425693e-01   +3.695755332329681e-01; +1.705908557107311e-01   +2.937178380904292e-01   +3.188446206288321e-01   +1.757378086729663e-01   +5.460051441431041e-01   +2.284413808527367e-01   +4.437290356592381e-01   +8.417694062064927e-01; +2.579193359841947e-01   +5.302154007205742e-01   +6.537037434752275e-01   +1.644211090705052e-01   +4.002572827601197e-01   +6.567360513819198e-02   +5.869927933980670e-02   +7.330975386426325e-01; +3.974759681955193e-01   +8.331767329713727e-01   +9.572999292094206e-01   +6.674456789121606e-01   +4.154165914579735e-01   +7.666129170809965e-01   +8.673268383483247e-01   +5.699091740478398e-01; +7.424613795790586e-02   +5.989006376342605e-01   +9.368477028695157e-01   +8.933350070573097e-01   +1.797538264964144e-01   +6.716181930765313e-01   +6.311149004935240e-01   +1.775644746858685e-01; +6.840845058847218e-01   +3.345950435070115e-01   +4.585038828737523e-01   +5.164125608243290e-01   +2.551170852755298e-01   +7.144351768777699e-01   +3.535878638679511e-01   +9.592557311831273e-01; +4.033586535912539e-01   +2.993892075262567e-01   +2.398398152285396e-01   +7.023093243824188e-01   +1.959555644364530e-02   +6.424488625834047e-01   +9.972425805616987e-01   +2.660163159546277e-01; +9.825691997105550e-01   +4.528215777542610e-01   +7.643069169258380e-01   +1.519306516798592e-01   +9.232926012647166e-01   +4.190162347776102e-01   +2.245926147425583e-01   +9.247404206768493e-01; +4.005916074812357e-01   +4.233352126845288e-01   +7.594209722001206e-01   +9.532465259178943e-01   +6.541384550781892e-01   +3.906634342190577e-01   +6.522056921072863e-01   +2.220583513334283e-01; +6.217638957959788e-01   +3.594358361368082e-01   +7.393937389527081e-01   +5.401719042893307e-01   +9.328813531761897e-01   +8.167809952742073e-01   +6.045774712419039e-01   +3.730907435670570e-01; +1.549535255035818e-01   +5.603245825076526e-01   +7.450434357915473e-01   +6.809076672542334e-01   +1.639921098702331e-01   +3.163674231118048e-01   +3.871434404476172e-01   +8.773798598394858e-02; +3.823914766860472e-01   +7.432544178997489e-01   +1.078306144626145e-01   +3.752584819957302e-02   +9.222287769087838e-01   +8.157470028013627e-01   +1.403435019472260e-01   +6.411858533481424e-01];
L1I_L2I_iGABA_netcon = [+1.815341634602489e-01   +9.111635042371364e-01   +2.760025978918184e-01   +8.732237002581070e-02   +5.334091200240070e-01   +1.068032126095859e-01   +9.886352007299990e-01   +4.120178549474893e-01   +7.198447748128174e-01   +2.182948070608640e-01   +9.218549471396936e-01   +6.739748464737613e-01   +1.065582512793382e-01   +5.564412509511775e-01   +6.301861403487744e-01   +4.839474126689434e-01; +4.580508088487642e-02   +8.001706795215106e-01   +2.476603030470794e-01   +8.029057458730914e-01   +8.867682430456829e-01   +6.146164903323682e-01   +7.673273065966111e-01   +6.010545447606501e-01   +9.971000167866315e-01   +1.268054056515314e-01   +7.706056809888301e-01   +4.777676954702997e-01   +1.809518218893356e-01   +7.718124731771050e-01   +1.006560848612378e-01   +8.949326890805335e-01; +7.225965568885278e-01   +7.443422282098217e-01   +4.519352060086224e-01   +9.890720489057780e-01   +8.981024888235846e-01   +9.403128704656269e-01   +3.368592053093596e-01   +7.496485167072942e-01   +3.545788232946727e-01   +3.084686266024804e-01   +4.303975520453401e-02   +6.240786742194113e-01   +9.984067898743722e-02   +3.125609397534993e-01   +3.918158913167139e-01   +1.383528374429254e-01; +3.483839582715577e-01   +8.129677800848059e-01   +2.269340468886407e-01   +6.661691261387241e-02   +6.255299662847299e-01   +3.530213258977273e-01   +6.627622911626808e-01   +5.843000179507717e-01   +9.712420915509418e-01   +7.256483866455425e-01   +3.788147154333572e-01   +2.373622295624860e-01   +4.902477032360554e-01   +1.786303815419974e-01   +5.534606799119549e-02   +3.889285297093537e-01; +6.606172151323928e-01   +3.834803879350440e-01   +8.042751906273068e-01   +9.400206518346993e-01   +1.374427207936258e-01   +4.104246694859620e-01   +2.455433402802114e-01   +5.517640880170053e-01   +3.476537722245917e-01   +7.829663077396551e-01   +7.044483909004390e-01   +1.779025359351650e-01   +1.927220225329378e-01   +3.387369186855806e-01   +5.008161840921929e-01   +9.272555383054110e-01; +3.847456036822754e-01   +6.179486872580983e-01   +9.858501102170003e-01   +1.726435763177728e-02   +2.184753170853694e-01   +9.840300140661545e-01   +2.943551034075599e-01   +5.812787091835777e-01   +8.864086110317593e-01   +6.925946823178888e-01   +7.275093647893139e-01   +8.287943455972171e-01   +8.938033206020367e-01   +2.094832405924499e-01   +4.312849635422422e-01   +9.187981931997239e-01; +6.277486625211306e-01   +5.767155009923628e-01   +2.959021608799543e-02   +6.842563740239335e-01   +1.815552851479933e-01   +9.455011787465961e-01   +6.787561177869748e-01   +5.109330240659690e-01   +4.549294689780300e-01   +9.211695489312529e-03   +2.255618622316757e-01   +7.655269217370756e-01   +9.963120831252703e-02   +5.101343717610625e-01   +9.976822419407828e-01   +7.147458183027580e-01; +2.291551648068406e-02   +5.280373289196328e-01   +5.356554879419990e-01   +7.833764914214091e-01   +4.265907969270921e-02   +6.774046293563601e-01   +5.262741751178499e-01   +8.161927631994582e-02   +4.148792274262303e-01   +8.445260027089428e-01   +2.689754923145964e-01   +9.347522359818907e-01   +4.436049202223072e-02   +9.054814915539089e-01   +8.105642865266870e-01   +6.174721615489078e-01];
L2E_L1E_iAMPA_netcon = [+3.426986559556065e-01   +7.581109100132875e-01   +5.893378380448799e-01   +5.019611992724773e-01   +8.512022882911063e-02   +4.707501243096685e-02   +9.235700670358712e-01   +4.752834453431553e-01; +9.367205906331629e-01   +4.140043976192243e-01   +6.612395972324099e-01   +4.894278069516960e-01   +9.739728113954031e-01   +3.438251748373007e-01   +8.009518200458265e-01   +3.644574083332838e-01; +1.239697528474892e-01   +4.930426503100522e-01   +4.830802580924323e-02   +8.786182873333717e-01   +6.512519612117414e-01   +7.368785761075932e-01   +2.864508779435134e-01   +7.881055328091017e-01; +7.311673569603461e-01   +6.961153656566693e-01   +3.488012078275392e-01   +3.524323761526190e-01   +2.308061210889049e-01   +7.955418076776430e-01   +5.441204311941191e-01   +7.807925030807429e-01; +6.467475572430753e-01   +9.737432431681107e-01   +4.492211493167450e-01   +4.490905088413719e-01   +4.026047732339728e-01   +5.447831367064818e-01   +9.840567422506581e-01   +6.679990511838484e-01; +8.330973834842810e-01   +3.279019555521102e-01   +2.393780084935624e-01   +9.640191468994409e-01   +1.211638453766976e-01   +6.870917473959922e-01   +7.152843821250545e-01   +1.334684619576547e-01; +3.972805543685887e-01   +8.373261064480743e-01   +7.151113800212375e-01   +4.282456476766891e-02   +2.692740580224663e-01   +8.946943420368039e-01   +8.380932211684924e-01   +2.010307134269914e-02; +7.497971480859925e-01   +7.401794300583291e-01   +8.564454084933903e-01   +9.740645836007041e-01   +2.560384218323150e-01   +5.435030323015554e-02   +4.346546354719233e-01   +5.595069754045472e-01; +8.348564957411425e-01   +9.533083257991083e-01   +2.828849929171049e-01   +1.874844983798667e-01   +3.330631566796790e-01   +3.039813414699815e-01   +4.710379209910744e-01   +3.012874715314784e-01; +3.237250945446204e-01   +3.296966143581045e-02   +7.310165418360297e-01   +6.664261117441558e-01   +1.503224039656875e-01   +4.550640259573227e-02   +5.612450553013072e-01   +9.392840756080906e-01; +5.515273729730407e-01   +3.558496696234301e-01   +1.396749454755790e-01   +5.872102588901746e-01   +3.480605444359551e-01   +1.952392291846992e-01   +2.696277378500816e-01   +9.817495694872175e-01; +9.810404592126473e-01   +6.617472312288476e-01   +8.383600925261873e-01   +6.756504663829253e-01   +1.200827631605485e-01   +7.186240687403468e-01   +7.485537017007980e-01   +2.871138406823903e-01; +5.484769506345597e-01   +2.814255570111103e-01   +1.391239112212918e-01   +3.595193339678857e-01   +8.832426175692069e-01   +7.224836817445752e-01   +5.044200825108036e-01   +7.997875381692855e-01; +3.307663465201040e-01   +2.299088500442917e-01   +5.876099728488291e-01   +6.201378220746491e-01   +9.504029924428990e-02   +8.775027143225956e-01   +6.475186622647104e-01   +8.949475515007860e-01; +6.191932035052518e-01   +7.104617150314380e-01   +3.666361867576331e-01   +8.110570666133727e-01   +9.307339442437513e-01   +5.803097064823898e-01   +3.074757836150678e-01   +5.978719830939605e-01; +3.617454258712849e-01   +6.232374340189776e-01   +8.058121889138611e-01   +2.023675380594744e-02   +3.997363288964688e-01   +7.276510158118779e-02   +1.391093306642960e-01   +8.839293941344228e-01];
L1E_L2E_iAMPA_netcon = [+9.436523825424901e-01   +3.716741334575892e-01   +6.678033797128093e-01   +4.850539712382389e-01   +2.469463033649088e-01   +4.515804952424500e-01   +1.230404095527653e-01   +4.975940739716450e-01   +8.829030616669604e-01   +3.245864942117323e-01   +5.144876078491147e-01   +8.603066145405029e-02   +6.315000141847588e-01   +4.294930416737102e-01   +6.127472526787683e-01   +5.041283565107101e-01; +5.490184531191719e-01   +9.370832221407432e-01   +2.083379808012522e-01   +7.576310198200014e-01   +7.850554678511407e-01   +2.052789419162974e-01   +4.066697896233787e-01   +6.931558938256727e-01   +7.198831367589863e-01   +2.460420295155104e-01   +6.575408219009253e-01   +1.631815865319053e-01   +8.588202369806399e-01   +4.921067153514891e-01   +8.199427995854615e-01   +6.122479407240492e-01; +7.281775593060866e-01   +8.293447606665728e-01   +6.530002872631809e-01   +4.163717457412418e-01   +8.834801429105216e-01   +8.985908144220879e-01   +2.758844858249422e-01   +8.337892375679176e-01   +1.918891952643902e-02   +3.432020202511514e-01   +9.518234272015593e-01   +3.240748275243847e-01   +9.760513251013087e-01   +7.103408752110243e-02   +8.866341051777076e-01   +8.198585381076163e-01; +5.766953844092150e-01   +8.495708604779606e-01   +7.159916609096649e-02   +9.723907509782610e-01   +9.127768462662703e-01   +7.633375166701847e-01   +7.168500589920785e-01   +6.115381484902436e-01   +6.743896259992745e-01   +3.748237479954946e-01   +7.228084750550288e-01   +3.016835876632672e-01   +5.696359713225931e-01   +8.873706304618471e-01   +9.305000432102977e-01   +5.321075520831646e-01; +2.576596183359448e-02   +3.711699348436917e-01   +4.068678357284115e-01   +9.894377754424066e-01   +5.582016402417790e-01   +8.836925719405335e-01   +2.826534733683553e-01   +5.747547165980538e-01   +4.385998576646241e-01   +5.454348379674204e-01   +3.995591326278313e-01   +1.109583288315109e-02   +9.973560231135998e-01   +6.475447036658864e-02   +1.921025201760214e-01   +2.023106641342950e-01; +4.480044200015547e-01   +5.930151598398972e-01   +6.662086710674177e-01   +8.637400203976402e-01   +5.987064182941938e-01   +2.867966040129629e-01   +8.959696312440449e-01   +3.247520055235328e-01   +4.366083226777728e-01   +5.633223857810539e-01   +8.340309417476868e-01   +5.407072745367797e-01   +5.535083292262669e-01   +4.360033487806599e-01   +2.584240161523151e-01   +4.546031650626356e-01; +6.470627825345497e-01   +8.736731348534744e-01   +9.355966636281915e-01   +3.884424366446036e-01   +1.478253573404990e-01   +6.713828090942277e-01   +8.266909098500170e-01   +4.555339716413296e-01   +1.158209878904358e-01   +3.950557734425246e-01   +1.348905015338150e-01   +9.632943625630372e-02   +5.148796498314535e-01   +8.254561737812340e-01   +8.974132942958083e-01   +4.286256477929375e-01; +5.215748375490179e-01   +9.339200679577530e-01   +8.098738734798515e-01   +4.538595146850530e-01   +9.011089285907798e-01   +6.639413367966949e-01   +3.903630802487613e-01   +7.144584198426920e-01   +8.142951408218682e-01   +3.973980518691015e-01   +6.029024838170498e-02   +1.474190755051862e-01   +3.317688794766179e-01   +3.931428733208052e-01   +5.938107588106720e-01   +9.659813272353621e-01];
L2I_L2E_iAMPA_netcon = [+6.192612608313799e-01   +6.956789419498811e-01   +7.336382540669949e-01   +5.905136317771992e-01   +6.693753747411474e-01   +5.478781050667481e-02   +9.879024301856640e-02   +8.484107155412812e-01; +6.965247877865679e-01   +4.263830952628997e-01   +4.295719248101669e-01   +4.587234532769766e-01   +5.004800228595497e-01   +1.532747069925323e-01   +9.081942206486330e-01   +9.169723362842425e-01; +7.215220202147158e-01   +8.367196228647861e-01   +6.942052370134001e-01   +5.125372529001399e-02   +2.188046922334938e-01   +1.990216844977436e-02   +1.101886526856703e-01   +9.870661148859881e-01; +3.470812840259183e-01   +7.308777271072769e-01   +9.452331620146552e-01   +2.285921973723322e-01   +5.725584668793825e-01   +4.344295915644616e-01   +5.177368718566713e-01   +5.038430654886006e-01; +5.179113752238838e-01   +3.600131759397005e-01   +7.836199066349390e-01   +8.335635866734191e-01   +1.219365710138246e-01   +8.315898809515273e-01   +1.431548968795286e-01   +2.708877480724715e-01; +5.569371817964116e-01   +4.541152579301203e-01   +7.057648645829674e-01   +1.459333980601874e-02   +6.709957911878460e-01   +6.160648081087757e-01   +5.591091837665588e-01   +1.007890568740704e-01; +1.578719871713978e-01   +3.872974488984574e-01   +1.093687406347189e-01   +8.641169295559913e-01   +5.995722485597208e-01   +5.196769600088864e-01   +4.410664979667647e-03   +5.079033645975236e-01; +5.637639903892384e-01   +7.751485922867672e-01   +3.897504362112963e-01   +7.905742826400601e-02   +5.566011933697116e-02   +8.638325999953624e-01   +7.674362870946343e-01   +5.844847365965963e-01];
L2E_L2I_iGABA_netcon = [+7.643470061452242e-01   +9.422354391105238e-01   +2.387023939286420e-01   +8.336369253671542e-01   +2.573792427985808e-01   +7.479132694948148e-02   +1.735816622057939e-01   +5.235697299829515e-01; +8.279140443054768e-02   +6.572309994683440e-01   +5.785322210609377e-01   +4.026219357806313e-01   +2.983716771841511e-01   +3.945631739496926e-01   +1.390493495961195e-01   +2.649620812334937e-01; +6.603364525999889e-01   +4.517721097909219e-01   +8.668928345652812e-01   +3.906944289606599e-01   +4.251200471174563e-01   +3.762961626689910e-03   +5.986179248038132e-01   +6.825599953626589e-02; +5.172137741816395e-01   +8.394152556474767e-01   +4.059269099453350e-01   +3.620461489145214e-01   +1.189110015472604e-01   +2.195921956505649e-01   +8.996476057497991e-01   +4.366130891921644e-01; +1.720810806891068e-01   +5.332171341264390e-01   +1.114243170443607e-01   +1.385958965212793e-01   +4.967265900699817e-01   +6.024142541357812e-04   +9.390591429967295e-01   +1.725941704454920e-01; +9.395278071731601e-01   +5.541909550041286e-01   +4.438335764027838e-01   +2.580311338329949e-01   +7.067799278949038e-01   +1.899994155016357e-01   +2.202111036950616e-01   +2.701900617208198e-02; +5.911329190051766e-01   +6.809340940991238e-01   +2.981524706490208e-01   +8.671667285173612e-02   +2.430557025396559e-01   +1.420977358142041e-01   +4.811480869398634e-01   +9.542147296990114e-01; +4.408482648361360e-01   +3.669821295071427e-01   +4.003887001380532e-01   +4.294977114197021e-01   +7.842262095815922e-01   +2.675181220513527e-01   +3.761622215607875e-01   +4.305210126000336e-01];
L3E_L2E_iAMPA_netcon = [+9.616545291846940e-01   +7.730303814211843e-01   +9.106970572991785e-01   +5.315065616144394e-01   +4.838375271580021e-02   +8.187631333610663e-01   +6.254872261628872e-01   +7.486633283716241e-01   +6.736574078534361e-01   +9.052861000363041e-01   +5.829047985672575e-01   +5.909891484991135e-02; +7.620676501634024e-01   +2.275135048690907e-01   +9.073860953271535e-01   +7.164783575254310e-01   +5.520591127354236e-01   +7.273080510273275e-01   +5.419535778199757e-01   +6.465630695402328e-01   +4.318965463160134e-01   +3.935250113171099e-01   +6.862822545132073e-01   +9.806732863684284e-01; +8.073551428912534e-03   +3.709901675541994e-01   +5.912998804300297e-01   +1.793822539503832e-01   +2.746603903372918e-01   +1.771497730849521e-01   +4.377754319732077e-01   +1.222816920423560e-01   +6.930458160291137e-01   +2.552066243214610e-02   +7.204511935082586e-01   +2.852336478305899e-01; +6.796780176629378e-01   +8.920319671649638e-01   +3.316126641968223e-01   +3.354498912912180e-01   +2.430310980689422e-01   +3.605598860879954e-01   +2.872609635588408e-01   +5.052251453865800e-01   +2.567120198866539e-01   +6.703557942309009e-01   +6.496211948899935e-01   +5.940600907321578e-01; +7.048989204045755e-01   +8.563174336163293e-01   +8.533785981030347e-01   +1.867402416694244e-01   +2.421312464548168e-01   +1.873494600142367e-01   +5.015759494517990e-01   +3.474880621473490e-01   +1.189090852516438e-02   +8.372935580318833e-01   +7.256796904582522e-01   +9.610411456991269e-01; +6.453116445951183e-01   +4.015899176768972e-01   +4.426925298925691e-01   +3.211923207948814e-01   +1.546361484969084e-01   +1.004429874129100e-03   +7.629672615512945e-01   +9.143391684452941e-02   +5.312843223452117e-01   +9.711455680503869e-01   +3.745936088835843e-01   +1.868591180818925e-01; +5.533008163805658e-01   +3.194915116505417e-01   +9.025764779702733e-01   +4.040362423233336e-01   +9.582036928921841e-01   +3.146103207207177e-01   +7.618553488184464e-01   +1.477174011436646e-01   +2.800236272969625e-01   +5.670653024603810e-02   +5.807567072762814e-01   +1.922629882178404e-01; +2.178137619433328e-01   +6.092616982569073e-01   +3.378889550538738e-02   +5.491617974079911e-01   +9.365741169340800e-01   +6.986606992464578e-01   +5.764535424507741e-01   +1.987566814880603e-01   +9.457987793944728e-01   +4.498737872873863e-01   +1.145207270522154e-01   +3.410100583021259e-01];
L3I_L2I_iGABA_netcon = [+9.333372283212201e-01   +9.265665789148678e-02   +6.192293969603403e-02   +2.787850288973987e-01   +2.550928903708312e-01   +4.042089466990089e-01   +5.294950543113720e-01   +1.086485300190334e-01   +9.123576870334489e-01   +5.847021673622929e-01   +2.083957150959302e-01   +9.085375489266976e-01; +3.906938966536431e-01   +6.161125777565338e-01   +4.944993381680442e-01   +7.460370672871931e-01   +8.578602406077442e-01   +9.883342934041373e-01   +8.290387265189458e-01   +2.708277962219036e-01   +6.392667471373343e-01   +2.837135186216873e-01   +3.174525297981933e-01   +5.511530385387245e-01; +2.728335130931565e-01   +1.120879234673111e-02   +6.434168165457131e-01   +2.382719926089191e-01   +9.113494157507939e-01   +8.972001971494632e-02   +8.572512466369524e-01   +5.237149783189867e-01   +2.548859085224598e-01   +8.276666151238071e-01   +1.332849992175954e-01   +3.403390768120227e-02; +1.529250258019997e-01   +5.729787451301456e-01   +2.222302009689774e-01   +9.572841661685179e-01   +6.991025165452039e-01   +3.219993763535260e-01   +7.885898255696382e-01   +9.725785002743053e-01   +9.057487598158667e-02   +1.918134306828617e-01   +6.722379198657170e-01   +5.432540485454130e-02; +3.969159249292851e-01   +7.881235382066666e-01   +8.373758193574656e-01   +6.215295461369010e-01   +7.265331889650459e-01   +5.128139738416702e-01   +3.184627801043235e-01   +7.088287619353298e-01   +8.383744533208033e-01   +4.413222765067240e-01   +5.703436674212804e-01   +8.059719544435122e-01; +3.751158553209873e-01   +2.361809742632984e-01   +9.708544772997088e-01   +6.012498146532111e-01   +2.296160540336277e-01   +5.961316172302165e-02   +4.522910835726318e-01   +3.106901758979536e-01   +5.845823929748092e-01   +3.929885603582129e-01   +1.707401205872575e-01   +4.511509918144085e-01; +1.294188042207533e-01   +4.475618423375813e-01   +8.470498539705379e-01   +1.730784776198404e-01   +5.744699836886416e-01   +7.250767574009674e-01   +7.522151615934054e-01   +2.933460122631217e-01   +9.483276581188625e-01   +8.267312525842641e-01   +1.481163521895445e-01   +3.813292240179994e-01; +4.345369568648081e-01   +5.696596602068359e-01   +5.062871094773261e-01   +8.964397894679978e-02   +8.109160898781508e-01   +5.574850160516444e-01   +1.106021042330221e-01   +8.492712566655598e-01   +6.158938661172774e-02   +6.782972033319586e-01   +4.757695399580268e-01   +7.901850920832864e-01];
L2E_L3E_iAMPA_netcon = [+3.648864262392847e-01   +7.565787275253011e-01   +7.387150095887744e-02   +5.178967988595290e-01   +7.572022981392010e-01   +4.324514805745092e-01   +1.997186597443523e-01   +8.756018187884561e-01; +5.312369218810234e-01   +9.976349571804681e-01   +5.914923665798146e-01   +9.951443855181957e-01   +9.958133348187224e-01   +5.433797539304320e-01   +1.940455463225456e-01   +7.865537101489547e-01; +7.127335190894806e-01   +1.875944752370985e-01   +9.107454230751391e-01   +8.568363415025718e-01   +9.626713559147099e-01   +7.118468593417897e-01   +3.260128573059544e-01   +4.659062674946153e-01; +8.710111493396717e-01   +7.809899237332547e-01   +1.916166801953978e-01   +9.612244143808512e-01   +5.354577371789871e-01   +1.601400966425744e-02   +8.796414660733531e-01   +8.132505985123304e-01; +3.283960064324419e-01   +1.949173820292633e-01   +4.320910426788844e-01   +6.780582677504430e-01   +9.651728667898225e-01   +8.015109841198620e-01   +4.711145490867466e-01   +8.971786580680052e-01; +6.494422401362819e-01   +9.924239727638157e-01   +7.490094625084035e-01   +4.026332590916338e-01   +1.167915930468291e-01   +1.423804785480196e-01   +4.041909936678605e-01   +4.281255557864369e-01; +9.759937957991438e-01   +8.015401588483019e-01   +3.983449284488483e-02   +9.335846829764531e-01   +5.001273244092690e-02   +4.790432103187643e-01   +1.801804333153446e-01   +3.339910178123298e-01; +7.616877248297978e-02   +4.246172209683851e-01   +9.463088920716117e-01   +4.796791747595298e-01   +3.027491307912486e-01   +2.551391593840850e-01   +9.689190600287835e-01   +5.963565533262878e-01; +5.882220987616495e-01   +7.283948547671051e-01   +7.633548981790261e-01   +2.303735652933585e-01   +5.809712373994055e-01   +3.694407031903989e-01   +4.081636001921660e-01   +9.008301539462872e-01; +4.126398473822874e-01   +4.974488413491365e-01   +5.574920598533277e-01   +3.961079278637443e-01   +5.316762048370509e-01   +6.617858374953793e-01   +8.442501165227999e-01   +7.018847622716029e-01; +3.087217969617749e-01   +8.089938503051777e-01   +1.832906718755215e-01   +7.047648541196490e-01   +9.000994140592863e-01   +1.682209133481667e-01   +6.164937874871540e-01   +3.785472453658534e-01; +2.637669415926377e-01   +3.564442934006190e-01   +5.002143068571545e-01   +5.583866440174015e-01   +5.400189620462602e-01   +2.796347058123144e-01   +3.752302656057212e-01   +7.349783414460520e-01];
L2I_L3I_iGABA_netcon = [+9.543924393744925e-01   +3.202171076990830e-02   +9.039631785686984e-02   +4.593873159662538e-01   +3.276585419353590e-01   +3.677125942039373e-01   +6.848607207754821e-01   +8.043984706849707e-01; +5.426103418241994e-01   +2.078849504693394e-01   +5.932985274315039e-01   +6.378320115111501e-01   +8.035670089548607e-01   +2.090392060049890e-01   +9.100702913009974e-01   +6.617373879059721e-02; +5.384847242356718e-01   +4.546636401430508e-01   +2.408072857504084e-01   +9.163236213944289e-01   +1.000000000000000e+00   +4.412391207403639e-01   +6.105845736537775e-01   +9.489222089050235e-01; +3.098922327438717e-01   +1.269517492511241e-01   +8.391250549301887e-01   +1.614597205925953e-01   +9.799564069540868e-01   +9.547303819503603e-01   +8.996350769090823e-01   +4.961682710001163e-01; +6.976682702504003e-02   +9.812289497045571e-03   +8.579399502002064e-01   +7.140757795575607e-01   +1.260684680050313e-01   +1.241687582205757e-01   +1.940803218649974e-01   +7.534432150337359e-01; +1.819920133626538e-01   +7.274061710380348e-01   +9.612022455049322e-01   +5.773969656020804e-01   +2.305504360992048e-01   +4.690416045578267e-01   +7.533150092668220e-01   +7.407167958378902e-01; +9.240869039979860e-02   +3.533239312471043e-01   +4.886853710880210e-01   +4.318520754937463e-01   +2.410442811374262e-02   +8.552280347036725e-01   +3.473874434356976e-01   +8.310504564795644e-01; +4.635930760733514e-01   +7.792741362960358e-01   +2.183947164229046e-01   +8.828520279317662e-01   +6.080862742601401e-01   +4.250573073829068e-02   +4.185028828350267e-01   +1.555912700281348e-01; +1.051669402855302e-02   +4.357633510731631e-01   +2.266425448394898e-01   +3.916914881865453e-01   +1.095021504200119e-01   +6.900699389747961e-01   +1.543105717430729e-01   +4.573112453313193e-01; +9.138512175645016e-01   +4.369848320085042e-01   +5.365208342287279e-01   +1.775714223321596e-01   +4.073543890745436e-01   +9.774520637116738e-01   +8.184841727327955e-01   +6.178577026188371e-01; +6.422227611931703e-01   +5.066384173169568e-02   +7.615394200405103e-01   +6.312486491152418e-01   +8.833208317502103e-01   +2.839167707409562e-01   +6.227607893681200e-01   +9.300456710427781e-01; +2.978617304366285e-04   +4.880025775623253e-02   +3.462998921032264e-01   +6.240591891587951e-01   +5.480585462681188e-01   +1.341938056899941e-01   +7.396928165785904e-01   +8.341066830648127e-01];
L3I_L3E_iAMPA_netcon = [+8.953602900183744e-01   +2.549530587659732e-01   +7.404412481474626e-01   +6.811772227936186e-01   +6.015638926178906e-01   +7.487535539758998e-01   +7.459242433210374e-01   +2.235235533192466e-01   +4.510837166008517e-02   +8.013545072811996e-01   +2.904568240414115e-01   +8.018262684928582e-01; +5.826284278511409e-01   +3.227938553865279e-01   +6.931654815802100e-01   +2.359903982557998e-01   +8.560939629114378e-01   +5.432259198258427e-01   +1.267978514694884e-01   +3.514436922156509e-01   +2.142322424797698e-01   +2.337693247448266e-01   +4.029665025990433e-01   +1.037578062325396e-01; +5.830716374998415e-01   +4.026067918875917e-01   +8.232016286562019e-01   +4.557206090975391e-01   +9.895288218412946e-01   +3.397690777057240e-01   +8.219315619033121e-01   +2.861611065168452e-01   +3.972223729940721e-01   +9.316646198591215e-01   +8.624656964257748e-01   +8.210991897019011e-01; +8.545730526620260e-01   +4.048062562362564e-01   +8.285950062407013e-01   +3.834325678827200e-01   +9.290731090195341e-01   +8.323852564660991e-01   +2.668438870872528e-02   +9.269081961033525e-01   +3.341609205820582e-01   +7.638504276988857e-01   +6.151311362597807e-01   +8.409180974073192e-01; +3.347654597439250e-02   +3.858745972580792e-01   +2.948194939388503e-01   +5.380768626216287e-01   +4.105054940242728e-01   +5.511305132643886e-01   +4.160183427100294e-01   +5.118030333914530e-02   +2.293716720127875e-01   +8.272479099347645e-01   +9.912327475142239e-01   +3.556533316332192e-01; +8.846858173114255e-01   +6.088771423961432e-01   +3.093009008254259e-01   +9.913178004902371e-01   +1.207378153856383e-03   +9.581979440562217e-01   +7.305053960239118e-01   +5.935138320412915e-01   +9.351594913959976e-01   +5.728892745059327e-01   +2.041325133026118e-01   +4.299695834029445e-01; +4.069470629080864e-01   +1.655016580210958e-01   +5.239899967258841e-01   +7.559139588119838e-01   +5.424356939621019e-01   +8.934502292140478e-01   +7.812613567458818e-01   +1.615207300631907e-01   +6.819777132900038e-01   +7.924799790322089e-01   +8.277173948563677e-01   +5.705833025603499e-01; +3.719943706561073e-02   +1.893077227944423e-01   +3.268236985621604e-01   +9.818392369781360e-01   +2.081178097141961e-01   +3.570967952660155e-01   +3.676727336178839e-01   +8.377443652350099e-01   +9.634122920554083e-01   +3.289589666155299e-01   +6.765374951508568e-01   +6.998619360963195e-01; +7.459652769915147e-01   +9.613664081381126e-02   +8.334506740522541e-01   +2.359222321098250e-01   +2.191602097668123e-01   +5.482183598734941e-01   +7.461145926651139e-01   +1.682181528708013e-01   +4.391075067062686e-01   +2.237008237809054e-01   +2.488146912924562e-01   +7.426990601462898e-01; +1.549035201829705e-01   +3.221731272206538e-01   +8.088016880677735e-01   +5.283085870998838e-01   +3.278958167037100e-01   +3.461096669770757e-01   +8.930645579202929e-01   +5.019590521899915e-01   +9.392678529803321e-01   +3.113618380445083e-01   +4.768862453013236e-01   +7.564952802680645e-01; +1.440983076498192e-01   +7.701373152419503e-01   +5.583329661458812e-01   +5.341218522130218e-02   +9.611899960602914e-02   +6.229078572338274e-01   +2.437878183539048e-01   +9.989489445650412e-01   +6.209932400915183e-03   +5.845343603608728e-01   +3.995029805662545e-01   +3.893957532750442e-01; +6.068666161063108e-01   +2.354912885672276e-01   +2.635584957859013e-01   +7.579727813517196e-01   +7.488242375901253e-01   +7.980456631677442e-01   +1.290566762479425e-01   +3.551520515241197e-01   +6.110394984420729e-01   +8.304523986657405e-01   +5.993094149777443e-01   +4.274151482397484e-01];
L3E_L3I_iGABA_netcon = [+9.554736402045918e-01   +8.850650515897301e-01   +8.004251246245481e-01   +9.858034574568234e-01   +9.014186160582280e-01   +9.613207603501234e-01   +6.536963692247679e-01   +4.994490330400120e-02   +1.081376961558786e-01   +4.522085942204297e-01   +8.295366606741490e-01   +5.801284053138557e-01; +5.728495225556840e-01   +4.377563704232271e-01   +9.869802528703077e-01   +5.595841084248543e-01   +9.946238902200870e-01   +5.419769445977523e-01   +6.630012954108222e-02   +4.663188723519407e-01   +4.607241053945225e-01   +3.342951034865538e-01   +6.258131928527076e-01   +6.365852573965881e-01; +8.498756643243293e-01   +7.820281863522324e-01   +1.592398513754896e-01   +9.332591334646885e-01   +6.521849726807294e-01   +3.176220418586361e-02   +2.754476310276719e-01   +3.243848659649992e-01   +4.510734216000821e-01   +5.890990885933643e-02   +5.397381745594648e-01   +6.503529058979188e-01; +2.760069501169169e-01   +1.490840490982880e-01   +2.371030847556520e-01   +7.200662339759492e-01   +1.078072717506088e-01   +6.961727308785129e-01   +2.822517678593173e-01   +6.311263843287305e-01   +5.503757650228259e-01   +7.406193449431264e-01   +6.506060758837361e-01   +8.638937218263371e-01; +6.226749468825807e-01   +6.211012402436862e-01   +7.022608047207122e-01   +4.848115441707563e-01   +3.731567506205544e-02   +5.192964340135520e-01   +8.798306349662980e-01   +2.292527887154950e-01   +8.060299021121751e-01   +5.066022108437289e-01   +7.260951440445040e-01   +5.630089182664848e-02; +5.902096005245505e-01   +2.601087383445362e-01   +3.767018422422768e-01   +6.393201332723134e-01   +6.184650648451961e-01   +6.043175284722416e-02   +4.451575596637076e-01   +5.799065265554417e-01   +7.011028343258784e-01   +2.004444396532576e-01   +9.441712074285742e-02   +8.178690108184600e-01; +9.641795917205148e-01   +4.452278992702303e-01   +9.750787120672459e-01   +8.877903317999036e-01   +5.664700310972183e-01   +8.891227169452797e-01   +7.575109833830795e-01   +6.033518923561847e-01   +8.726573777603670e-01   +4.266720597897273e-01   +8.788535714159439e-01   +5.285016942424053e-01; +8.627253019217776e-02   +8.450827993253573e-01   +9.707852678625557e-01   +1.976798076324223e-01   +9.619503356754037e-01   +3.303067492965978e-01   +6.018816540228313e-01   +6.000505473124921e-01   +5.233244241214385e-02   +1.677493597578554e-01   +1.241187573201912e-02   +6.951833290820641e-01; +5.013855595375718e-01   +1.974521195378882e-01   +6.430193516722802e-01   +3.965170010341379e-01   +7.476427002943006e-01   +2.284802176244660e-01   +7.830091970912487e-01   +4.479031294077896e-01   +2.185330492578295e-01   +7.509334761220058e-01   +2.921159898929651e-01   +2.125889613587618e-01; +5.215805671785712e-01   +3.031612503181702e-01   +8.600350368472506e-01   +9.923733934622987e-01   +6.621677637209568e-01   +1.134270842906692e-01   +1.140322336626967e-01   +3.420380312468833e-02   +4.590277589675592e-01   +3.668770077389500e-01   +1.789828255029564e-01   +5.436874758124822e-01; +9.088914093379862e-02   +4.811442277955171e-01   +4.015847937419535e-01   +4.014183232046658e-01   +5.238587341530961e-01   +3.115980763237263e-01   +9.778330545230153e-01   +5.126787195774463e-01   +9.581501901423354e-01   +9.425886977652035e-01   +9.263517954469750e-01   +7.033423952719994e-01; +9.056858840741230e-01   +3.377261620698726e-01   +6.309791925729015e-01   +6.583581285623529e-01   +2.595143544852142e-01   +2.276583444312694e-01   +8.487647655147750e-01   +4.074129579754641e-01   +7.918535531278782e-01   +1.577904568028828e-02   +6.874951178153656e-02   +9.557227941759173e-01];
L2E_Input1_iAMPA_netcon = [+9.977251542007270e-01   +1.000000000000000e+00   +9.981865513439121e-01   +9.983006151965181e-01   +9.969601286056869e-01   +9.978905117772251e-01   +9.977170897175601e-01   +9.968533617478724e-01];
L2I_Input2_iAMPA_netcon = [+9.982434972704308e-01   +9.986568147209123e-01   +9.992437957250536e-01   +9.998502302049324e-01   +9.993908780647858e-01   +9.978620095033074e-01   +9.999833813519728e-01   +9.976686915074910e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last =  11.21 * ones(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))*0.4 + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.5*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.5*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))*0.9 + 0.5*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))*0.4 + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.5*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.5*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))*0.9 + 0.5*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
