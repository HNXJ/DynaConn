function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+5.576046557590867e-01   +2.738577739205921e-03   +5.032308445542422e-01   -7.655106379512337e-03   +2.428885938218708e-01   +5.703793239837190e-01   +9.887465633909864e-02   +2.547987732961162e-01   +3.056266136823049e-01   +7.747432106783709e-01   +9.283838397496211e-02   +2.971682167650119e-01   +2.487437533835108e-01   +5.405241073970503e-01   +4.645397792147044e-01   -2.985435787865577e-02; +5.697455974928731e-01   +1.888316317742907e-01   -2.320745760767972e-01   +7.329327496826812e-02   +5.046736141360795e-01   +5.221076649797221e-01   -4.380704400186142e-02   +4.194784852840738e-01   +3.035816838720702e-01   +1.900259866031486e-01   +3.220000468312747e-01   +5.277565418588841e-01   +3.868274278767834e-01   +7.073375756888981e-01   -8.953654311874309e-02   +2.662629407098582e-01; +4.514419408810605e-01   +3.711149602700389e-01   -7.786498936930937e-02   +3.746087023749426e-01   +5.129247074058496e-01   +1.961470125563297e-01   +2.275588054056486e-01   +1.345484511536379e-01   +2.089968452933399e-01   +4.142636387567190e-01   +1.177123460391932e-01   +2.332720765829973e-01   +3.654479203416837e-01   +6.164704814107387e-01   -3.938911755764194e-02   +4.199862481493351e-01; +5.247079459473246e-01   +3.282336410483977e-01   +7.017767643361921e-01   +9.466180521351220e-01   +6.862035011281608e-01   +3.982996999389826e-01   +7.316070833502936e-01   +8.640685055544364e-01   +8.665980168933632e-01   +4.110061851322341e-01   +4.007307381891424e-01   +1.946776632841590e-01   +3.413741654584009e-01   +5.620577579073868e-01   +1.902837169337091e-01   +3.779731467937701e-01; +4.679502272187213e-01   +6.091341749783915e-01   +4.757636689478754e-01   +8.506265757226941e-01   +8.532471516037400e-02   -9.404864697449450e-02   +1.115829047858491e-01   +8.550454089014030e-01   +5.471820269597220e-01   +5.435664180869971e-01   +7.937246294123522e-01   +3.358950806828053e-01   +6.320630949731543e-01   -1.309932766090134e-01   +5.240335416348304e-02   +4.977976285766810e-01; +3.141587464208908e-01   +2.339856480630871e-01   +5.898109505748987e-01   -3.910571027902462e-02   +9.141593015205247e-02   +6.974905798934492e-01   +3.915861896640086e-01   +5.043601633211713e-01   +2.378247712990543e-01   +4.238589758793292e-01   +1.590047493539835e-01   +6.495542898857644e-01   +2.428267809707477e-02   +3.756028546624767e-01   +4.414388963209428e-01   +6.175219426771513e-01; +5.014599492953689e-01   +6.268988287562084e-01   +9.482438701105669e-02   +9.238183808386445e-02   +3.710294483564281e-01   +4.021247961670514e-01   +6.159013802461295e-01   -4.067697360012250e-02   +2.234927778366020e-01   +3.146838809930443e-01   +6.278555072694093e-01   +4.676284670054241e-01   +5.901162151417435e-01   +4.024998755568543e-02   -5.902968676912221e-02   +2.200096529282735e-01; +7.745630757073957e-01   +8.149112128508345e-01   +3.874822750912056e-01   -4.796057615508782e-02   +4.301783903790821e-01   -9.934470428931955e-02   +4.845694259582643e-01   +2.667984201893915e-01   +4.565845676463037e-01   +6.166840574115235e-01   +2.803811016298060e-01   +1.071923252436883e-01   +3.679776941856648e-01   +2.301286377179387e-01   +1.020106563917658e-02   +5.973440980947119e-01; +1.733336015154527e-01   +4.947467456117377e-01   +1.032343792485799e-01   +2.657989504777568e-01   +6.457666179673005e-01   -9.029129312688436e-02   +4.980141620562377e-01   +5.005788325069713e-01   +1.635697833951454e-01   +2.654867222571046e-01   +5.163632004731187e-01   -2.120071174039459e-01   +2.031509958152983e-01   +3.156777067356344e-01   +2.052949142868284e-01   +9.556435761801753e-02; +3.466673369910761e-01   +5.136763362234089e-01   +2.655084689497568e-01   +3.653784096534719e-01   +6.235365620021367e-01   +4.397199649363669e-01   +4.920367993285198e-01   +3.903926189832438e-01   +3.845916464520160e-03   +5.703469589427856e-02   +2.251209551963514e-01   +4.523259614329778e-01   +6.538996246169260e-01   +6.095797705930066e-01   +2.997326661365519e-01   +5.877450651951154e-01; +4.182568801438739e-01   +4.136344280610116e-01   +1.991052926078279e-01   +5.356637129197226e-01   +6.392894158757789e-01   +1.645328013859837e-01   +3.253830251629813e-01   +7.078457054541175e-01   +3.795664215876902e-01   -1.119596464264008e-01   +1.449924895937274e-02   +5.446681949783957e-01   +5.107738508630154e-01   +2.898443740304230e-01   +3.131540021209948e-01   -1.394848504152420e-01; +2.592070578546079e-01   -3.202927889880193e-02   +4.204460454576277e-01   +5.377421422271051e-01   +4.874023896148860e-01   -3.604345168228831e-02   +2.693288018865950e-01   -1.072602267126347e-01   -2.130356345432328e-01   +5.469391643138476e-01   +7.815343015272726e-02   -1.467318556865434e-01   +6.740885421228290e-01   +6.190376149167192e-01   +1.136357849548242e-01   +3.953310379927258e-01; +2.120471351895695e-01   +1.797616695861197e-01   +9.931709139559869e-01   +7.009752410476209e-01   +5.732173868001240e-01   +7.627614808398165e-01   +3.566017888711438e-01   +3.031813034143648e-01   +7.377410216075976e-02   +2.847090324605436e-01   +2.618653690377120e-01   +5.586583817450804e-01   +3.922038669108810e-01   +3.914572205299547e-01   +4.707717510221312e-01   +3.943073419367595e-01; +5.542372910116974e-01   +6.926434775075376e-01   +6.673085164014192e-01   +5.848130542177590e-01   +7.312730207798853e-01   +4.437751949263277e-01   +2.068113241266711e-01   +2.377632436379433e-01   +4.554566584489660e-01   -1.162387702095292e-01   +3.291385041186716e-01   +1.681990166098529e-01   +1.457848569944099e-01   -7.273204845333628e-02   -4.963237330162275e-04   +1.536964609251088e-01; -2.128047657185869e-02   +4.445802962007701e-01   +2.986475137141469e-01   +4.113778088008658e-01   +5.206733178745321e-01   +7.546536943762208e-01   -2.294272783432595e-02   +1.720100590322507e-01   -1.916409990825374e-01   +4.568649190526845e-01   +6.032283721419437e-01   +7.521417864229287e-01   +5.570010314946860e-01   +7.848993093975624e-01   +4.612897516487605e-01   +2.510717704080782e-01; +5.848850336455689e-01   +2.442151402664872e-01   -2.295740473595911e-01   +1.464116500516196e-01   +6.202750943714963e-01   +3.068881238688278e-01   -1.066973129031480e-01   +1.252020149830382e-01   +2.928030135329631e-01   +3.290991947460929e-01   +4.391662402678425e-01   +2.896274667044135e-01   +5.799958508736519e-01   -2.230376630159811e-01   +5.574699006668450e-01   +4.188172381407679e-01];
L1E_L1I_iGABA_netcon = [+4.920730204181698e-01   +6.800079303167700e-01   +7.052601028063930e-01   +1.067532737880108e-02   -4.879520557824765e-03   -7.584214542582511e-02   +3.985123337462833e-01   +7.346739840415413e-02   +5.967203231332786e-01   +5.213330640720348e-01   +5.722513958609931e-01   +3.896468918387211e-01   +7.051568655033590e-01   +3.287609285704098e-01   +4.267850966097962e-01   +2.840974063012530e-01; +2.173578817762221e-02   +2.272144446159208e-01   +1.463665232069840e-02   +2.140748432657185e-01   +2.382088104605112e-01   +2.875199234751509e-01   +2.679107761313536e-01   -1.883296089197330e-01   +7.912178185606904e-01   +4.526405934891982e-01   +5.025485773043684e-01   +2.581276395144768e-02   +2.578355329207770e-01   +2.682181484518060e-01   +4.099327854555406e-01   +3.300708795853415e-01; +5.805586743301350e-01   +4.209531685141742e-01   +4.343181598700066e-01   +1.969735843688840e-02   +6.509151389395812e-01   +7.964649559940296e-01   +1.813684267511989e-01   +2.661121178190424e-01   +3.939823230694348e-01   +7.081729070197085e-02   +7.337453499098311e-01   +5.779143217365712e-01   +6.936362678565093e-01   +1.578704974829784e-01   +5.407185234129195e-01   +6.142385174090562e-01; +7.463826200988045e-02   -8.434134640704133e-02   +1.377428870841603e-01   +5.404739425578243e-01   +7.202494504382179e-01   +3.940621280163721e-01   +7.545240636932679e-01   +4.291951383658488e-01   +4.877880246124324e-01   +8.765691182811859e-01   +1.871788249246507e-01   +2.906312756445637e-01   +6.681973187817014e-01   -1.022361097107372e-02   +5.597105299542795e-01   +5.429621305211288e-01; +1.028510714680864e-01   +3.078821276210112e-01   -1.604680608538084e-01   +2.440479345280537e-01   +2.536758475513078e-01   +4.462256738707837e-01   +6.216320195112947e-01   +6.482964654631358e-01   +2.960069903022070e-01   +4.689050644292717e-01   +2.997085313326588e-01   +6.287952320266700e-01   +2.441225364116271e-01   +3.577125583177068e-01   +4.584283721953029e-01   +2.786817524111497e-01; +6.123568217208544e-01   +4.302600352209001e-01   +2.848284195062646e-01   +6.136278032783045e-02   +2.839660486007810e-01   +1.624409318461575e-01   +3.032006209311751e-01   +3.500071683607105e-01   -8.395326233103144e-02   +6.520775984744327e-01   +3.630642736601663e-01   +2.737232002817359e-01   +1.230210729438361e-01   +3.915809470734529e-01   +3.793859023368179e-01   +6.225419324660799e-01; +7.922776247627586e-02   +6.129033992484066e-01   +1.524978112218899e-01   +2.143242951017363e-01   +1.476173399446987e-01   -4.031294975519549e-01   +8.009035548759462e-01   +5.475731537975741e-01   +2.675956412334274e-01   -2.002200472838080e-01   +2.546297026378821e-01   +4.043450181432849e-02   +2.889312833657989e-01   +5.578452958038903e-01   +6.116605193720771e-01   +3.731465182332728e-01; +4.188920213733349e-01   +7.666983742304994e-01   +7.058850657598713e-01   +2.486049138910765e-01   +3.807854667544812e-01   +5.932869225330405e-01   +1.853417167446271e-02   -3.440452986982030e-02   +3.688820772914705e-01   +4.152047644074309e-01   +7.590667402795921e-01   +5.203575295047856e-02   +4.846946812788819e-01   +7.089424927233146e-01   +4.848889215256293e-01   +1.272048683680354e-01; +8.333383197833048e-02   +2.031972272293587e-01   +4.687993105857095e-01   +5.000078481849686e-01   +7.294744475842844e-01   +2.639397124184125e-01   +6.614733090946106e-01   +5.736205211192406e-02   +5.005401777355188e-01   +1.648143353280038e-01   -9.071513207038039e-02   +3.738537724168030e-01   +4.127164151165253e-01   +6.628311797284654e-01   +4.106638576834058e-01   +2.273570859213218e-01; +1.381858224810295e-01   +7.212523077498044e-01   +4.865392686487284e-01   +8.686397475081298e-02   +2.672170399826417e-01   +5.420750758468733e-01   +2.357376341933291e-01   +6.886988673780833e-02   +2.692597283278476e-01   +4.413975843507281e-01   +3.020371761057715e-01   +6.730413687122027e-01   +5.010538287082953e-01   +2.252614036841706e-01   +4.733061624014434e-01   +1.099840399235609e-01; +3.039967542624535e-02   +5.513699386708200e-01   +8.489902595809107e-01   +7.047011099634111e-01   +5.205574847408130e-01   +6.912268026790661e-02   +1.998564736510084e-01   +5.980319985878119e-01   +6.515994636086971e-01   +4.117735797838052e-01   +6.022612164616382e-01   +3.303126763761806e-01   +1.782951859885072e-01   +5.382773781102371e-01   +1.101522142140881e-01   +5.972267156199990e-01; +7.079694608769131e-01   +3.218545831222233e-02   +6.764523141883026e-02   +5.536379390082311e-01   +6.823159915233001e-01   +2.525881978570030e-01   +3.311707486559177e-01   +4.122727484827633e-01   -7.762818540616143e-02   +2.366664721929642e-01   +4.726345757300908e-01   +4.443044179302999e-01   -2.019536761958460e-02   +1.527705416245500e-01   +2.986807462940741e-01   +5.874490100259430e-01; +4.331513373907063e-01   +6.637436150234387e-01   +6.992402142131793e-01   +1.707990977026686e-01   +3.340274400979066e-01   +9.241132345276006e-01   +2.402410387313385e-01   +5.512177451134016e-01   +4.825101805754213e-01   +5.386436483193525e-01   +7.948318396881753e-01   +2.102093190285837e-02   +7.056227817706225e-01   +2.215634462951707e-01   +8.007637089669760e-02   +4.504262018666672e-01; +4.659730038645732e-01   +3.608298336648458e-01   +3.614298587629874e-01   +7.677009048152982e-01   +8.681540270650785e-01   +7.508784277005845e-01   +7.654702700673898e-01   -2.077596754897713e-02   +1.218885131167270e-01   +3.775945932722475e-01   +1.348858170177036e-01   +6.185528514148189e-01   +5.068644137242668e-01   +4.082067945968409e-01   +5.024815545556064e-01   +4.304745540497333e-01; +7.257103830901418e-01   +9.388592561039034e-01   +1.384690542912148e-01   -8.151109654035417e-02   +5.111696725920553e-01   +2.434035131434738e-01   +4.050130883777708e-01   +1.734072777265245e-01   +6.381313673066015e-01   -1.690842058522893e-01   +5.135322355305704e-01   +4.016597083319495e-01   +6.779392608155536e-01   -2.722968571103639e-01   +2.202400802603289e-01   -2.590695314024745e-01; -1.163605350217668e-01   +2.905895029675787e-01   +6.970862028466387e-01   -1.605231032068437e-02   +1.487769175555677e-01   +5.572006956290488e-01   +1.282100214980039e-01   +7.870244816184040e-01   +5.353825121792517e-01   +9.294824302339375e-02   +2.679191962456929e-01   +7.566770045887324e-01   -1.090921665468178e-02   -4.116110209587369e-02   +6.297116624610807e-02   +1.755699974753954e-01];
L2I_L1I_iGABA_netcon = [+3.254437922742153e-01   +1.281939052604893e-01   +7.784759828567974e-01   +7.775021888126675e-02   +7.382766831779474e-01   +5.219885887772892e-01   +7.519236431969318e-01   +9.318318530598629e-01; +1.661406083338317e-01   +2.327502782136842e-01   +4.163540829528292e-01   +2.291002338837472e-01   +5.987705910367346e-01   -1.915209922318397e-02   +2.753442867511368e-01   +5.275080363815920e-02; +6.344666419878704e-01   +4.579010919433718e-01   -1.000806689839338e-01   +2.344942719146641e-01   +5.601649925735149e-01   +1.807270853406322e-01   +5.440658207334640e-01   +4.026398189901017e-01; +5.069404285599693e-01   +5.718077821383436e-01   +1.525531387618425e-01   +5.273402529853710e-01   +2.817385084345125e-01   +1.708254328240283e-01   -3.548582546625278e-02   +3.502860010803671e-02; +2.721332811151608e-01   +4.814271249647937e-01   -2.722507579931549e-02   +7.057445252483194e-02   +6.455081113631699e-01   +2.217622571797660e-01   +5.504863693358329e-01   +5.055348898942009e-01; +5.395112445290984e-01   +5.720284016634094e-01   +4.125140165039154e-01   +5.429945705699911e-01   +4.478282996825249e-01   +4.082231844370524e-02   +6.135758043349201e-01   +9.023064574386966e-02; +2.645253813110475e-01   +5.531371612529067e-01   +4.815785492031920e-01   +6.980672530639130e-01   +6.880219969692586e-02   +1.576147348804391e-01   +2.284597086087504e-01   +4.416953288093365e-01; +5.182450989991529e-01   +2.575821238020599e-01   -1.369752068768370e-01   +2.792089325140901e-01   +1.227115430610338e-01   +5.250266514366768e-01   +2.821141938439534e-01   +2.998100612288593e-01; +2.577520024371682e-01   +2.635389935406597e-01   +7.288037557424213e-01   +3.649790735238966e-01   +2.907240623216029e-01   +9.005416560994277e-01   +3.643750376676629e-01   +8.565498445734727e-01; +5.604834490451815e-01   +3.097779259327349e-01   +5.664439423016790e-02   -1.849588317657861e-02   +5.658090093085631e-01   -2.242373769631361e-01   +2.353861579666021e-01   +2.773102559685707e-01; +3.229197520196510e-01   +4.876760705906795e-01   +3.018604142219134e-01   +8.781444185523967e-01   +1.155279682106713e-01   +4.467988288390468e-01   +9.945326656444832e-01   +7.014658307634569e-01; +5.489687783643320e-01   +9.169357546568743e-01   -1.160609652004635e-01   +8.567516709570108e-02   +2.574237690615788e-01   +5.264002782855947e-01   +4.776254424584627e-01   +2.348547529780286e-01; +9.388170774536578e-01   +2.233463697108236e-01   +6.286453300247524e-01   +9.826960756010070e-02   +4.411412537510279e-01   +4.276108424076953e-02   +6.364217534938874e-01   +9.789435808191659e-02; +6.720798163065700e-01   +3.230692393198301e-01   +4.516428085261788e-01   +1.092687845648400e-01   +2.650879354797093e-01   +4.697013318068169e-01   -8.771669638067617e-03   +1.262433091286881e-01; -1.133041289066702e-01   +7.231566085567684e-01   +6.700250362440608e-01   +2.694179851500327e-01   +2.506901216152875e-01   +5.329538656395443e-01   +8.353735267232039e-02   +3.791641895304936e-01; +1.647961299353549e-01   +6.365204430505588e-01   +3.282293049457364e-01   +4.622872702588387e-01   +2.263809692739115e-01   +3.790994252938841e-01   +3.075011631164418e-01   +5.134741727793986e-02];
L1I_L2I_iGABA_netcon = [+2.518148588603112e-01   +4.703126098342139e-01   +2.818351473920631e-01   +3.331953296310378e-01   +7.537827098115588e-01   -5.618175735888421e-02   +5.971460441724757e-01   +4.313541596624172e-02   +3.737175568446595e-01   +5.474165927870190e-01   +3.244909178742450e-01   +4.979684690720226e-01   +6.401437516982169e-01   +2.735010568194495e-01   +7.192870711104085e-02   +5.947776137882462e-01; +7.361608202528751e-01   +4.569535554153761e-01   +6.561212477756116e-01   +5.384158178175775e-01   +6.348344942403827e-01   +9.823179817644118e-01   +4.838611369790772e-01   +2.394157790256171e-01   +6.169643136430809e-01   -1.998820721482786e-02   -8.974321110440629e-05   +7.470100559265547e-01   +5.640988720948829e-01   +1.897871436904240e-01   +5.483346203936031e-01   +9.125576022255411e-01; +3.350107685133860e-01   +1.530425257421966e-02   +4.940261339595980e-01   +4.686527094696967e-01   +4.467250091560761e-01   +7.277290231359298e-01   +4.174301922392591e-01   +5.006262730906620e-01   +4.804717418668648e-01   +4.069716554411231e-01   -5.303410993007689e-02   +3.526450458675655e-01   +4.516611388839777e-02   +7.803413648246156e-01   +3.850598520047648e-01   +1.685862329784283e-01; -1.529809816048015e-01   +6.510211071781860e-01   +4.802916689021453e-01   -1.528382376656011e-01   +4.453953920473734e-01   +3.973196106431439e-01   +9.496226130483565e-01   +3.480677035141533e-01   +7.766524462193711e-01   +2.306985182838874e-02   +2.369535780239931e-01   +7.830708134540487e-01   +3.814455349104246e-01   +4.856689016993875e-01   +7.908123940391389e-01   +6.665081791251593e-01; +4.777803796631694e-01   +7.015019880085153e-01   +4.316309878442063e-01   +4.144949041826453e-01   -1.071960093295660e-02   +1.594056939385262e-01   +6.766375042214676e-01   -5.161876503520145e-02   -7.024310459491291e-02   +5.336837548077569e-01   +5.015127199831169e-01   +5.680104915445167e-01   +7.477481468247400e-02   +3.805275746706267e-02   +5.619543723003936e-01   +7.046652472820024e-01; +7.892223631981198e-01   +4.591540770164873e-01   +3.508277502638369e-01   -1.780978337489564e-01   +2.303943646330121e-01   +1.043575685955779e-01   +7.456083694868751e-01   +3.060927809514360e-01   +1.949925453579774e-01   +8.098827673633116e-01   +9.220721764146901e-01   +7.596849569651176e-03   +1.722676879276134e-01   +5.503294081909869e-01   +3.548213135240665e-01   +3.810667527920683e-01; +1.745128769456826e-01   +6.377650075231585e-01   +6.213397530642534e-01   +3.045726730535289e-01   +3.912631803787176e-01   +8.819957985169133e-01   +5.546818096044887e-01   +9.593897366772611e-02   +1.091851183354444e-01   +2.492436175699327e-02   +4.450085955310017e-01   +1.682614288327081e-01   +7.391114080864333e-01   +8.315899766552136e-01   +1.730385257893856e-01   +6.093291139975213e-01; +2.986990285036116e-01   +6.754553698807315e-01   +4.841732115713360e-01   +7.888057886321340e-01   +6.017193785973993e-01   +4.171859421300002e-01   +4.964426670600626e-01   -5.967913289799447e-02   -2.479179491982670e-02   +2.212535314146040e-01   +1.452991140310355e-01   +3.944131301478823e-01   +1.184717504272172e-01   +7.081301571752353e-01   +5.156668039045221e-01   +5.493491030755047e-01];
L2E_L1E_iAMPA_netcon = [-3.676449235668690e-03   +1.916815791224462e-01   +6.802523085675145e-01   +5.135184398582789e-01   +6.057500085426862e-01   +2.616060644672967e-01   +5.273846810569169e-01   +8.562246324869689e-01; +6.551399001881359e-01   +2.238716626590610e-01   +2.132384918861964e-01   +3.486697337545442e-01   +2.973027901911075e-01   +3.752919479595268e-01   +1.246378351782867e-01   +4.028378383395301e-01; +2.107968410481957e-01   +2.621076264930570e-01   +4.777131877802418e-01   +1.000000000000000e+00   +1.999503572739214e-01   +4.270421797070802e-01   -2.101482526323798e-01   +6.777529391809383e-01; +2.544258136079788e-01   +1.179081058243577e-01   +3.841180871107749e-01   +5.786908145657083e-01   +5.463818605363114e-01   +2.844208083090353e-01   +5.358988413136275e-01   +4.376511200028870e-01; +8.362335202059996e-01   +6.538642826135584e-01   +2.835139923929130e-01   +1.170449278080344e-01   +3.391394032645283e-01   +3.189923837414380e-01   +2.731378412741474e-01   +3.026163872575694e-01; +6.784304910603604e-01   +2.288162140760700e-01   +7.731999655664769e-01   +7.843832371785132e-01   +7.033292366180323e-01   +5.708521303152324e-01   +5.053944174443679e-01   +8.486016454962210e-01; +5.602811414872628e-01   +2.890947778809576e-01   +1.792895849168911e-01   -5.667068320792399e-02   +6.078433640196096e-01   +4.286488913952250e-01   +1.684739792050042e-01   +7.938214533700493e-01; +6.580584338021918e-01   +4.641606502374045e-01   +2.959111399870063e-01   +3.095959108134078e-01   +1.861312406164702e-02   -1.467013281795477e-01   +4.174648235049356e-01   +7.775368015760616e-01; +1.056198471117559e-01   +1.497926067566971e-01   +2.788381368634607e-01   +1.727172171758218e-01   +6.338673876733847e-01   +6.171597742156529e-01   +2.641271735225580e-01   -5.181646427544244e-02; +3.617821717805548e-01   +3.260703384758149e-01   +3.627357351449559e-01   +6.843049995687619e-01   +4.277385176352426e-01   -1.695464261163903e-01   +8.940239479578936e-01   -1.574028464176015e-02; -3.672231631965597e-02   +7.502316829415015e-02   +3.656503750843839e-01   +5.763351186362318e-01   +2.274027238226604e-01   +4.994723620393196e-01   +7.532986765374897e-01   +3.602327889605755e-01; +7.581869544650862e-01   +1.571395685340706e-01   +8.873146067037788e-02   +7.265187362564022e-01   +5.229051556288717e-01   +1.484095568369889e-01   +3.429388842408754e-01   +6.086964474570610e-01; +1.152170982889911e-01   +5.397960594555974e-01   +3.607337250717803e-01   +2.643462208636725e-01   +4.412649233190074e-01   +3.476079640100027e-01   +2.258608043914725e-02   +3.226073518381265e-01; +1.598911432581444e-02   +6.240347508327585e-01   +6.752995547542677e-01   +5.068095291249027e-01   +2.901170059877800e-01   +5.118653781967838e-01   +2.284622325993032e-01   +7.525540550340334e-01; +3.571763460747242e-01   +3.133583610104445e-01   +4.321611962062968e-01   +7.015317800011542e-01   +6.236300044003651e-01   +4.814506055316739e-01   +4.870726720478398e-01   +6.702114035325505e-01; +3.392533769337004e-01   +2.134939692078210e-01   +2.610365577945779e-01   +3.348596063249082e-01   +7.357330538892546e-01   +1.576836027988804e-01   -3.653996298959965e-02   +1.854561899775823e-01];
L1E_L2E_iAMPA_netcon = [+4.604525023858648e-01   +5.465035565737408e-01   +2.771877645695276e-01   +5.676826058742707e-01   -1.008478561715862e-01   +4.201164605711110e-01   +1.251275727818441e-01   +6.782393785908229e-01   +7.777309555369332e-01   +2.472614591344087e-01   +4.363378205362924e-01   +6.663490155931932e-01   +5.730492726834719e-01   +2.399995704064140e-01   -3.478372785472698e-02   +6.760587288298201e-01; +4.057329916805570e-01   +5.098547119455021e-01   +8.349554533304921e-01   +6.152599336210880e-01   +4.789188988209254e-01   +5.857080160307840e-01   +4.001310464151563e-01   -2.696355512286994e-01   +2.293432868108483e-01   +6.275133395395990e-01   +1.395874116337573e-01   -1.146407199393419e-01   +4.554135235088960e-01   +7.242624242656609e-02   +1.555666535610701e-01   +1.809997785324051e-01; +1.143303240514286e-01   +3.794511287978203e-01   +6.476167144786763e-01   +7.216720128533294e-01   -2.469428991233995e-01   +2.362908092191511e-01   +4.859269642096788e-02   +9.316879724420170e-02   +3.073197654748210e-01   +2.186911809023717e-01   +8.423550916277572e-01   +5.396444156327336e-01   +3.577099821303129e-01   +6.337226828105085e-01   +6.216570513981472e-01   +4.146288473146421e-01; -4.240797097334413e-02   +6.311570413452636e-01   +3.646780053866222e-01   +5.402082131986404e-01   -1.375443778870991e-01   +5.356995544765782e-01   +7.234276235416892e-02   +1.652820242640684e-01   +2.751161179197222e-01   +4.112712938304462e-01   +5.058478478353932e-01   +2.628449263650788e-01   +3.040583641595890e-01   +3.859628530913999e-01   +2.557195219520074e-01   +5.971470871941185e-02; +1.504942898265115e-01   +6.938605980508435e-01   +6.768507102823270e-01   +1.350636617082445e-01   +3.243328119172934e-01   +7.054434887614330e-01   +4.485069999333409e-01   +2.187185630550642e-01   +5.050959657857911e-01   +6.235061847998046e-01   +9.636990333888557e-01   -4.459737401269972e-02   +7.410283137785802e-01   +7.650228744805286e-01   +1.954903793773992e-01   +1.681067015358413e-01; +2.982868102034151e-01   +1.247856174826783e-01   +4.109339936051232e-01   +5.168857398888379e-01   +3.773248466505111e-01   +4.088340735071837e-01   +7.197286172554411e-01   +2.524629887860502e-01   +1.118668417792208e-01   +5.644224665937646e-01   +1.527054508634168e-01   +5.033766994767207e-01   +3.938902971561583e-01   +3.521536303753248e-01   +6.052390317611631e-01   +5.999949811998374e-01; +4.944677015143858e-01   +2.910446037777955e-01   +4.033249185555012e-01   +5.131091377474805e-01   +3.019659934873777e-01   +1.935411186309654e-01   +8.496353116441971e-01   +7.798783222415182e-01   +2.493020964533448e-01   +4.610307219857820e-01   +6.445355961825008e-01   +6.271346056769050e-01   +6.445597903840448e-02   +4.581672531307495e-01   +4.338926949408505e-01   +2.096253070477180e-01; +5.086191484238782e-01   +5.577693459550381e-01   +4.589922389776038e-01   -9.229343725296381e-03   +7.232260146762101e-01   +3.244993912157532e-01   +3.934235799162896e-01   +4.800482323249000e-01   +3.366954298539383e-01   +2.709126744522852e-01   +4.412653240379152e-01   +2.166194981339077e-01   -2.947153706803008e-03   -1.214903790986989e-01   +3.325767341334224e-01   +3.323353396454214e-01];
L2I_L2E_iAMPA_netcon = [+2.852266893203938e-01   +8.027738207445434e-01   +7.015714947984888e-01   +5.571788436203549e-01   +3.865236052681291e-01   -1.188427702909796e-02   +8.251370423094393e-01   +7.763204542489143e-01; +6.408268881071847e-01   +9.011553763067506e-01   +2.143032902510492e-01   -1.295811090749668e-01   +5.230234072230819e-01   -1.707802176858737e-01   +1.124515066930109e-01   +3.469745771425761e-01; +7.814735855591883e-01   +5.656005710585102e-01   +7.417965604577428e-01   +2.032806098202413e-01   +3.806405881043097e-01   +7.933123574653036e-01   +2.059612348865673e-02   +2.963563814205062e-01; +4.576582681828593e-01   +7.118599351893518e-01   +3.381846264046524e-01   +4.892807439589528e-02   +5.775295901836053e-01   +8.364043545416526e-01   +6.549373544547936e-01   +6.415219662664110e-01; +8.582280096607804e-01   +2.014852257845640e-01   +4.548841017092646e-01   +8.389051883333558e-02   +2.899660721080716e-01   +8.148365158272490e-01   +5.645248633811950e-01   +3.538066932530142e-01; +2.603003313328234e-02   +2.037973061877257e-01   +1.043896293681472e-02   +3.704535119149777e-01   -6.229113228347567e-02   +8.111263222302205e-01   +7.855541414935096e-01   +1.751362193978009e-01; +9.423113155178687e-01   +2.930032648382261e-01   +4.501203827766999e-01   +5.227369811415535e-02   +1.959166979741742e-01   +1.188442844081372e-01   +5.911630424350163e-01   +4.755130786010348e-01; +1.121118299379523e-01   +3.201399401790628e-01   +4.423779434064147e-01   -2.539173867315297e-02   +6.939183321126892e-01   +6.729655043475116e-01   +1.317269605962376e-01   +8.243517360025784e-02];
L2E_L2I_iGABA_netcon = [+7.502993109551109e-01   +7.074510418360878e-01   +7.680816021083751e-01   +6.436884151497714e-01   +3.626384425894357e-01   +1.043902545554379e-01   +3.632153841418641e-01   +2.665638358036730e-01; +4.917212564090369e-01   +1.000000000000000e+00   +8.576414727598661e-01   +8.691461364521276e-01   +2.140310606919421e-01   +3.990647101630141e-01   -1.635849653882835e-02   +7.591983010896791e-01; +8.354594890178085e-02   +7.591095144250734e-01   +7.962819755659614e-01   +7.941536931933673e-01   +5.431081532696641e-01   +3.409765368346883e-03   +7.353235142213769e-01   +1.166548424841616e-01; +4.477500497738372e-01   +3.723583578178816e-01   +8.279443378456692e-01   +1.763486442129569e-01   +5.337311613983201e-01   +4.285798047217677e-01   +4.358980053943493e-01   -1.660540454053583e-01; +4.989079973243992e-01   +9.633538381179314e-01   +6.058572884324893e-01   +5.191989314748222e-01   +5.245564351447025e-01   +3.523613650312919e-01   +7.719837218635198e-01   +4.344514973779449e-02; -3.794580497803812e-02   +9.371197975857673e-02   -1.909920643964285e-01   +2.784175094707273e-01   +6.936645047029713e-01   +3.858478440368923e-01   +4.844258521463755e-01   +2.232156451779198e-01; +4.387361841905006e-01   +8.110185928762315e-01   +1.688614654672954e-01   +4.327325149174538e-01   +5.041869812023861e-01   +9.651810974483676e-01   +5.346685151664784e-01   +7.919164558549164e-01; +3.797921481834148e-01   +3.346926414334482e-01   +3.243516184776612e-01   +7.945687692118925e-01   +3.643559467601501e-01   +3.926560565699677e-01   +1.396811989803058e-01   +8.261734269293604e-02];
L3E_L2E_iAMPA_netcon = [+2.732892418729775e-01   +1.696194371500078e-01   +5.421401221119653e-01   +3.112296931211988e-01   +6.085492823166351e-01   +4.207149460454960e-01   +5.194610297252902e-01   +4.762125016386668e-01   +1.362383696250172e-01   +5.629692662148481e-01   +9.947335174614499e-01   +5.402666734339234e-01; +2.640394511775386e-01   +2.615555949103873e-01   +6.002822601066706e-01   +2.683991905729954e-01   +2.838633199083802e-01   +2.624875658525991e-01   +1.951345381993979e-01   +8.352735005475347e-01   +1.852847791840261e-01   +4.801701704150165e-01   +4.119782038287361e-01   -4.990217423816725e-02; +6.143268638017649e-02   +6.695683657823301e-02   -8.714094379469520e-02   +4.689794028483543e-01   +6.250774339987997e-02   +4.334764055427248e-01   +2.131373823628832e-01   +2.584624993794189e-01   +6.084759909067314e-02   +1.161108227635866e-01   +1.470495743508939e-01   +3.231804030998822e-01; +4.526831255382792e-01   +3.618432746498519e-01   +4.904247501478089e-02   +4.354847584591762e-01   +4.721798678410472e-01   +8.692067479765685e-02   +2.891029225483490e-01   +8.923118260655138e-02   +5.760037653851262e-01   +9.851116580086186e-02   +3.453549474612633e-01   +5.136443447557605e-01; +5.967104306293302e-01   -3.704808436745077e-02   +5.671858042771560e-01   +5.236706251555956e-01   +4.360204494491870e-01   +8.073401198529887e-01   +4.553513229670835e-01   +5.232395555971531e-01   +6.956698717608163e-02   +7.811096413209472e-01   +4.534785557128912e-01   +2.696483277462659e-01; +6.137797855603588e-01   +5.595186206303564e-01   -8.706423733996189e-02   +5.391220217701009e-01   +2.696570441710646e-01   +5.977040795895605e-01   +5.255492750738952e-01   -2.082569758698591e-01   +1.199998452936173e-01   +6.343445228417699e-01   +1.405424764351574e-01   +4.983398973282862e-01; +6.076047195318914e-02   +4.203820488320485e-01   +3.377012128639553e-01   -8.793402029777718e-02   +9.554776997295359e-01   +6.734755381848184e-02   +4.188804952541282e-01   +6.222021651469787e-01   +9.005700685217925e-02   +3.412130717716527e-01   +6.713433196262343e-02   +6.155378753453723e-01; +2.096566091590846e-01   +1.390584595098263e-01   +9.221472447403624e-03   +1.259332350607174e-01   +5.955331282636880e-01   -2.390699581803470e-02   +5.220654334865457e-01   +1.044981958648721e-01   +2.777461582103269e-01   +3.394353154027403e-01   +4.602369463472886e-01   -8.526196081804025e-03];
L3I_L2I_iGABA_netcon = [+7.661552710843004e-01   +4.550508901601600e-01   +6.012997488360268e-01   +2.162339220609741e-01   +1.876618630359584e-01   +4.983894955426245e-01   +5.378267517686366e-01   +1.965299451345338e-01   +3.388286240074488e-01   +3.939483199128315e-01   +5.581979001414390e-01   +7.855879488738029e-01; +3.555426012187990e-01   -3.711343469909072e-01   -1.121358916154359e-01   +6.984666493951606e-01   +3.144015514779088e-01   +6.033754006849800e-01   +4.486041108111725e-01   +2.466222643424248e-01   +7.298283005052439e-01   -2.775375788028838e-02   +6.499826966315754e-01   +3.162083643375517e-01; +2.091504272622557e-01   +5.050262707307195e-01   +7.873124674818021e-01   +6.623231660001406e-01   +8.113776315656004e-02   +3.825447286957972e-01   +1.618114116674813e-01   +6.047374849530937e-01   +5.270996639238338e-01   +4.026645051622869e-01   +7.223399828797461e-01   +8.829699517005881e-01; -1.547084242621830e-01   +3.258862772077332e-01   +9.400508641388445e-01   +3.877904292865301e-01   +5.256587760953156e-01   +5.735942363405852e-01   +1.165453087092617e-01   +3.885993480345041e-01   +5.679486757520579e-02   +2.615347392441769e-01   -7.285829525746929e-03   +1.155714966359140e-01; +2.388162800465960e-01   +4.307740971274906e-01   +1.783609394791293e-01   -2.278906188440466e-02   +2.850019524466092e-01   +2.281053470944867e-01   +1.178406375021476e-01   +2.673446667927253e-01   +3.506295089077054e-01   +6.669328662024387e-01   +9.101313892411830e-01   +7.625288549084884e-01; -1.394867244122089e-01   +7.004034720915366e-01   +4.987528621531621e-02   +5.280082729914521e-01   +2.054264358247782e-01   +1.101642494989157e-01   -1.368236056775023e-01   +2.272533440339958e-01   +2.100485513516980e-01   +7.062386379924681e-01   +6.616429736861930e-01   +7.160598414019385e-01; +5.785931436722703e-01   +5.408394411609107e-01   +6.580065744434231e-01   +3.969581473608910e-01   +5.627944730501458e-01   +3.474591701442621e-01   +3.839872784522260e-01   +3.631185202292817e-01   +1.796207043957274e-01   +7.247605458500180e-01   +2.612496553003043e-01   +4.371702756203614e-01; +4.291298075721995e-01   +8.869255783992127e-01   +3.160938775316889e-01   +8.367084812477955e-02   +3.291791428158186e-01   -1.912692676723497e-01   +9.966916083255544e-01   +5.838338428973827e-01   +7.402237329049491e-01   +6.111749704199174e-01   +3.406906201964329e-01   +7.753020768852444e-01];
L2E_L3E_iAMPA_netcon = [+5.752370932225355e-02   +2.754890085423862e-01   +2.700522004997623e-01   +4.603814000053273e-01   +6.048788561523480e-01   +3.326737452747900e-01   +2.018208234657321e-01   +1.482723058790697e-01; +5.648667718999304e-01   +7.289878041592859e-01   +1.206326866564657e-01   +5.443501907934042e-01   +9.104886963986242e-02   +5.729360986355011e-01   +6.601892583944417e-02   +5.863749892554904e-01; +7.411802999076179e-01   +4.027128668570497e-01   +1.326404877111199e-01   -9.074177745239862e-03   +7.475357087231715e-01   +2.840486000757404e-02   +2.833680439021783e-01   +3.054751377703559e-01; +3.545685656048805e-01   +7.087719056526386e-01   +4.679517050881301e-01   +4.225296227203712e-01   +6.189883290763348e-01   +3.784270285411788e-01   +2.936754983823460e-01   +6.320494923809789e-01; +2.625645844334057e-01   -1.126440571429817e-01   +6.366162894812171e-01   +4.902244951603892e-01   +4.144055281737282e-01   +1.344755910287674e-01   +7.741368631054076e-01   +2.443477343455218e-01; +3.910783225901662e-01   +5.281003599713099e-01   +2.339960862868983e-01   +9.297570170316938e-01   +1.352189065364716e-01   +6.391390950844544e-01   +3.071202306127064e-01   +5.719026201610021e-01; -3.707972233490281e-01   +3.681598838378403e-01   +4.169083406228755e-01   +3.448032486866718e-01   +1.438816195435873e-01   +4.843007093128682e-02   +8.857813949862999e-01   +6.011495349082747e-01; +1.371025721887562e-01   +8.748352165457933e-01   +2.606420233557791e-01   +1.464117348325929e-01   +4.046293271948856e-01   +4.589073232718090e-01   +7.269912074941708e-01   +2.256462454602739e-02; +6.712211330427479e-01   +8.522459826139756e-01   +5.743124522002894e-01   +7.571130019884624e-01   +1.473673416223280e-01   +4.979284098473189e-01   +4.930451356574346e-01   +1.000000000000000e+00; +4.138799476125891e-01   +1.270814766751375e-01   +2.232874761266282e-01   +5.908805510047082e-01   +2.812523910091317e-01   +2.694250229015325e-01   +8.009226896809453e-01   -3.045976249847967e-01; +1.856894793469049e-01   +4.693822785979003e-01   +1.017708151877013e-02   -1.393782747208618e-01   +3.936368340867553e-01   -2.818474261019114e-02   +2.836186701339702e-01   +8.362043403824438e-01; +5.747683191564332e-01   +3.229583774687051e-01   +4.645237735232796e-01   +6.348630083720026e-01   +8.533526712333617e-01   +1.660041820445354e-01   -7.845203463448529e-02   +4.922758649157501e-01];
L2I_L3I_iGABA_netcon = [+3.379401975406462e-01   +3.043670487239100e-01   -1.092842352224752e-01   +9.176296788930898e-01   +3.817803816790272e-01   +7.044404340490545e-02   +6.041057827466007e-01   +2.115406133349903e-01; +2.885470087990660e-01   +3.021696517775158e-01   +2.077530150868482e-01   +1.290912935087142e-01   +1.753663175906791e-01   +5.010439311226915e-01   +8.195868972907204e-01   +3.136614064037125e-01; +1.068677972464925e-01   +5.331429003577738e-01   -7.306587234010994e-02   +6.601416056933940e-01   +2.174177369178286e-01   -2.535235818588329e-02   +3.093368076426326e-01   +3.359553619845695e-01; +6.447398956761261e-02   -3.825888690570461e-01   +4.561686619030395e-01   +4.902384126584097e-01   +6.761252461420895e-01   +1.210840719158292e-01   +5.784638739876247e-01   +2.438400659124984e-01; +3.671588008507777e-01   +4.529514053357650e-01   +2.902564315789772e-01   +7.616167690819260e-02   +2.685418076033827e-01   +3.220318000011095e-01   +3.888228257307391e-01   +6.294043153832690e-01; -2.742957704987914e-03   +4.861862007959894e-01   -8.702789082262913e-02   +4.168549410498459e-01   +4.063571462083593e-01   +6.561648200481716e-01   +1.531365200008187e-01   +4.058403365940322e-01; +5.171676532619490e-01   +1.740137112948391e-01   +3.112274727749796e-01   +6.049509988895719e-01   +3.168636438757061e-01   -9.536664318288327e-02   +1.340211451455819e-01   +3.552641131447059e-01; +5.225279956806494e-01   +7.282358206412057e-01   +4.701780370224457e-01   +2.488381232868520e-01   +1.398075534109697e-01   +5.426337520755760e-01   +3.166502223073667e-01   -5.561781268962020e-02; -2.908860577330464e-02   +1.520629759194561e-01   +3.533355112880565e-01   +3.497488554235464e-01   +6.879117456895091e-01   +4.677100219428249e-01   +5.165814399751801e-01   +1.240875469484169e-01; +6.365959578723872e-01   +2.073129599239286e-01   +4.053690757919756e-01   +2.322931391760950e-01   +4.893278981904221e-01   -1.459118199520135e-01   +6.448124979407886e-03   +8.169046914512221e-02; +3.152972110663553e-01   +7.052473125563280e-01   +1.728473157639743e-01   +6.468957592588108e-01   +7.532315234455238e-02   +9.350583364850915e-02   +2.072026285152097e-01   +1.086835398477376e-01; -5.479323399378081e-02   +2.542960978381259e-01   -1.405553311890139e-01   +3.021295109136841e-01   +6.545871652378802e-01   +7.083924272767590e-01   +7.405489362345421e-01   +2.218644078352656e-01];
L3I_L3E_iAMPA_netcon = [+2.909827163419497e-01   +7.472361546462173e-01   -1.655303660813172e-01   +2.858651048914108e-01   +8.995654984918466e-01   +1.564416684408238e-01   +6.692211589550893e-01   +6.327104862700803e-01   -5.830632973347376e-02   +1.421342598922622e-01   +1.346035154085633e-01   +4.793070684798031e-01; +8.002913115901129e-01   +8.236154324808456e-01   +4.820970826277630e-01   +1.802926717490827e-01   -3.826327680093678e-02   +7.782653025588144e-01   +6.270247622444769e-01   +8.989480695198939e-01   -5.753274936597768e-02   +8.844964378874566e-01   +4.706610491732550e-01   +5.348888988544219e-01; +4.880631470709038e-01   +6.706251329173758e-01   +2.725671583848185e-01   -2.812672851238206e-01   +6.961417979999776e-01   +7.049179854819453e-01   +3.803757985566861e-01   +7.347048383556920e-01   +3.867749574096412e-02   +5.890252209094186e-01   +9.349310838384340e-01   +4.928421650092412e-01; +6.874638877025842e-01   +4.128016768719635e-01   +3.293429459043885e-01   +8.235232972266104e-01   +7.255476799781706e-01   +9.028087283810923e-01   +8.374134502781068e-01   +8.110864416253551e-01   +1.189449819954246e-01   +7.620687212695081e-01   +5.087456433793088e-01   +6.551287629937550e-01; +8.216443986323348e-02   +6.581932643890924e-02   +1.498916897122290e-01   -6.029968870647135e-02   +6.511328983494841e-01   +8.989512491796166e-01   +1.594247277532345e-01   +6.964181997484954e-01   +7.407961379355833e-01   +3.589094045433703e-01   +7.717662921104759e-01   -1.128117115824457e-01; +3.509800308468213e-01   +7.840148405714799e-01   +2.155569345473543e-01   +6.630300182765591e-01   +4.659223694095785e-01   +7.401751844600486e-02   +4.032557846032534e-01   -1.475051788992883e-01   +4.048888159574121e-01   +4.319539441243837e-01   +3.876016683631661e-01   +2.700404693339701e-01; +1.098951080595839e-01   +3.443393723204658e-01   +2.032050026937857e-01   +1.254371119505331e-01   +1.000000000000000e+00   +2.803260361499224e-01   +4.074964372670039e-01   +5.664121562784455e-01   +2.197327300843975e-01   +4.500091284984791e-01   +4.337415516613361e-01   +3.201389800156374e-01; +2.538121589146154e-01   +6.922398787942244e-02   +3.881362891372008e-01   +2.167929150763680e-01   +3.193003783003027e-01   -4.049317185761288e-03   +1.886666310935547e-01   +2.371455972076807e-01   -7.959526294933439e-03   +7.564576936983406e-01   +4.083656805644973e-01   +3.352200537667583e-01; +1.393653715849296e-01   +2.997812699881885e-01   +4.972110935065475e-01   +2.716640466890217e-01   +3.795219817327355e-01   +7.581684293771591e-02   +2.081783788826451e-01   +3.121492391418872e-01   +7.127736804931083e-01   -8.574464052393159e-02   +2.556393659967336e-01   +4.203728956973522e-01; +5.029582485856136e-01   +7.144302925085835e-01   +4.151865917963573e-01   +4.749318732542545e-01   -2.220589634607268e-01   +3.734983726530958e-01   +7.122868167095537e-01   +5.744018716091996e-01   +7.380895978346788e-01   -4.055323022011081e-02   +5.658918336013955e-01   +3.482127162826228e-01; +1.012672959878915e-01   +7.579600089549084e-02   +5.143582169389990e-01   +4.523927139056939e-01   +1.003459287842726e-01   +3.635753209531653e-01   +7.326364517915675e-02   +7.106874967180654e-01   +8.425210891237103e-01   +8.617694359424688e-01   +9.861363376125386e-02   +5.097456836392454e-01; -4.149041554847297e-02   +4.626511083234210e-01   +1.248254825897101e-01   +6.475619058767467e-01   +8.835815337425348e-01   +8.271298024642627e-02   +1.949627955190351e-01   +4.025454719120251e-01   +6.845326403927539e-01   +3.733207778996467e-01   +3.324064364432693e-01   +3.921003060082907e-01];
L3E_L3I_iGABA_netcon = [+5.469022077731633e-01   +1.047625431164090e-01   -4.888227435235816e-03   +5.540370220429949e-01   +3.458615950779218e-01   +7.158082777121310e-01   +6.466428033961502e-01   +8.292079654973787e-01   +7.188480414607263e-01   +2.857201291209016e-01   +2.871922841553045e-01   +4.005110387354987e-01; +3.830947713933863e-01   +1.731502686989662e-01   +7.599208408421780e-01   +2.263162050989448e-01   +2.864352286092091e-01   +6.099217254347415e-01   +1.000000000000000e+00   +1.923565679686956e-01   +3.737379364032118e-01   +2.416213128732559e-01   +1.715230332709300e-01   +4.626747411064303e-01; +1.308380380761194e-01   +5.945920071123816e-03   -1.159348814821077e-01   +3.395134132350671e-01   +2.671863676662348e-01   +3.536029867682777e-01   +5.358348363594759e-01   +6.073112693093869e-01   +4.995502037074110e-01   +5.114025699864895e-01   +4.810158599927599e-01   +3.562691207460387e-01; +3.688111919071810e-01   +7.634465171421042e-01   +4.551090569067007e-01   +1.685296240341239e-01   +6.106426013640367e-01   -5.370871480913808e-02   +4.893354039910259e-01   +3.185672476396238e-01   +3.457032996281793e-01   -1.317656776951100e-01   +4.794717092728997e-01   +2.835224574391403e-01; +7.708197871521634e-02   -4.692517167517537e-02   +2.958455573712160e-01   +2.664560411628368e-01   +2.619913720524075e-01   +1.702278480979210e-01   +5.091470976156088e-01   +3.490603060938299e-01   +3.857368788076167e-01   +1.139631220716685e-01   +4.638778613191032e-01   +1.792211161187312e-02; +9.019906155342092e-02   +1.499481418547165e-02   +5.493056749788405e-01   +5.546789979452248e-01   +4.348450604322783e-01   +1.773445152889562e-02   -2.071418391089000e-02   +2.489714795039747e-01   +3.162763150490193e-01   +6.068319524866045e-01   +5.382196944485024e-01   -1.888180561302342e-01; +5.125711022800792e-01   +3.266108197487732e-01   +5.728136660493004e-01   +1.820254402647877e-01   +5.718861255180304e-01   +4.580110304040849e-01   -3.131580007407594e-02   +5.356859889773876e-01   +6.202975254875280e-01   +2.718245824142139e-01   +4.994383688996712e-01   +3.205444278840565e-01; +9.669850965941723e-02   +1.561862497641567e-01   +1.115567419823923e-01   +6.693318270471433e-01   +5.218210038502662e-01   +2.810715845768094e-01   +5.108964983556507e-01   +1.240745186538254e-01   +2.762952184165982e-01   +2.586076851987036e-01   +3.504609373827432e-01   +7.366578797269250e-01; +2.941224020464288e-01   +2.067020539218456e-01   +5.089286945442569e-01   +6.485161988497772e-01   +4.117193240236058e-01   -7.203696835855869e-02   +4.721168753815544e-01   +5.073144871281746e-01   +2.172029794815649e-01   +2.167173328671009e-01   +4.874994386772826e-01   +7.429724335890330e-01; +3.505505898139841e-01   +7.743296833451371e-01   +9.025646671930633e-01   +7.902721419665916e-01   +2.094026667927971e-01   +2.450469462862793e-01   +6.999549855346283e-01   -1.191222744410024e-01   +7.773028274913769e-01   +4.596204387049920e-01   +1.503308237602917e-01   +1.798158955339480e-01; +6.109868220305244e-02   +3.686647363551181e-01   +2.120473468075973e-01   +5.811014510178532e-01   +6.252592471589915e-01   +2.483742903922664e-01   +6.757787205025796e-01   +7.246252025994223e-01   +6.781323495940247e-01   +3.989537925057733e-01   +1.429630533910558e-01   +7.428378212447185e-01; +6.478908623254447e-01   +6.441881990562984e-02   +4.415873993579471e-01   +5.652962146307958e-01   +3.962759742883457e-01   +4.034360793109477e-01   +3.191699209788401e-01   +2.886735916914449e-01   +2.073263177132200e-01   +2.975975501744760e-01   -1.665881207028997e-01   +2.693724260277098e-01];
L2E_Input1_iAMPA_netcon = [+5.121995585886786e-01   +7.300823343350624e-01   +6.685123083221207e-01   +6.339405461188982e-01   +8.541980579361528e-01   +5.655071696853748e-01   +1.000000000000000e+00   +4.675853230935884e-01];
L2I_Input2_iAMPA_netcon = [+8.703399641922700e-01   +6.595300205406844e-01   +5.410720989523577e-01   +6.811516609371335e-01   +5.643908520076739e-01   +8.171728344678105e-01   +3.689577569735788e-01   +6.203159286579136e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.5*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.4*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.5*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.4*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.5*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.4*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.5*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.4*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
