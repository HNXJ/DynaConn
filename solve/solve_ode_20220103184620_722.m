function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+7.144861734262860e-01   +9.462056417200623e-01   +6.984563628844285e-01   +1.551456045335697e-01   +9.220714160053805e-01   +2.198419156431032e-01   +7.408193779475596e-01   +3.023875654197044e-01   +5.332177358523987e-01   +8.291226768882558e-01   +9.686244843347480e-01   +9.640648846840980e-01   +6.957888015733011e-01   +3.714587071542707e-01   +2.971273233105837e-01   +3.782557217436569e-01; +3.453537225027635e-01   +1.294560485090693e-02   +1.415035674044175e-01   +1.758662472408981e-01   +7.104672564132759e-02   +8.072815841513955e-01   +7.948798686054592e-01   +7.589088535175291e-01   +7.841973597179969e-01   +1.813365728048130e-01   +4.664551056956627e-01   +6.558612385833100e-01   +3.759294594747707e-01   +2.751181056943889e-01   +6.848659348922818e-01   +9.535710722325991e-01; +2.075476408053426e-01   +4.676286650680448e-01   +8.364527544235567e-02   +7.033665621881470e-01   +3.137678330303486e-01   +3.816265257188189e-01   +6.635729830615116e-01   +9.531268996366536e-01   +4.856173000679376e-02   +9.266271254950186e-01   +8.694116017995577e-01   +2.093812525113882e-01   +5.415637578947530e-01   +7.521370724161185e-02   +7.727971114917405e-01   +8.115104886980299e-01; +2.438318331367181e-02   +4.895504776241519e-01   +4.326700971652312e-01   +8.322564438747729e-01   +6.282036996569859e-01   +8.562348954867246e-01   +4.411770953980912e-01   +8.300216655369282e-03   +4.625129792287693e-01   +4.207374250503677e-01   +9.467156505308921e-01   +8.976063826385792e-01   +5.181651725366219e-01   +1.511590252665864e-01   +7.210049311536567e-01   +8.921333953038740e-01; +7.655411193009204e-01   +5.155353430690985e-01   +8.950473266891609e-01   +8.152556086746419e-02   +9.053647068180208e-01   +3.234745969409885e-01   +5.755345247202801e-01   +4.071718555981385e-01   +9.381374888012531e-01   +3.004958688981085e-01   +2.326382226971321e-01   +4.879890037248234e-01   +7.643471865034965e-01   +3.651565027981847e-01   +2.785991291972696e-01   +6.844975848568842e-02; +5.706371377511754e-01   +2.868435362906671e-01   +7.318078435479897e-01   +8.350121407262768e-01   +7.969736228052791e-01   +3.792689674310955e-01   +5.184644604196481e-01   +1.518385219345526e-01   +4.731063801407426e-01   +3.487148389876587e-01   +9.183719554011571e-01   +6.622575041149544e-01   +7.977498141215135e-02   +7.177677579450797e-01   +1.403583507883274e-02   +9.022993453080057e-01; +5.766023622666019e-01   +5.646476051699311e-01   +6.803807656808152e-01   +5.410459560151295e-01   +6.430899843093723e-01   +6.370516587066585e-01   +7.252991186872533e-01   +8.215587980378869e-01   +7.783936164328648e-01   +9.718231509565801e-01   +6.348901003541960e-01   +5.260702372068177e-01   +5.307035800817296e-03   +5.322628594538885e-01   +1.516050884313874e-02   +6.675883709177721e-01; +3.906707651258429e-01   +5.094628469272768e-01   +2.017306614432425e-01   +9.625411650779577e-01   +4.404319002699099e-01   +3.874677391166184e-01   +2.223528271115094e-01   +2.880032038601067e-01   +1.093448052945217e-01   +5.306541188933879e-01   +2.844211297406333e-01   +7.086787285569265e-01   +4.008009324154543e-01   +2.322103249239552e-01   +9.368140745491113e-01   +3.465712073580041e-01; +5.567957575922783e-01   +6.779724695275771e-01   +5.297595189364550e-01   +6.776390310627148e-01   +7.483538390115975e-01   +6.716209891622574e-02   +9.980543569869543e-01   +9.781669188543446e-01   +5.219668587827561e-01   +7.896335308016156e-01   +8.557748688397752e-01   +7.187239325595626e-01   +6.623640475754997e-01   +4.704387922952585e-01   +9.343097561451702e-01   +8.372910222045988e-01; +1.829671792981969e-01   +6.161402508790831e-01   +8.304106383719790e-01   +3.366739244291078e-01   +8.253467135224571e-01   +1.687614637291214e-02   +6.196509679165237e-01   +6.254124762723976e-01   +6.359279150411223e-01   +7.942168550511797e-01   +1.655007483889443e-01   +2.944474235216223e-01   +3.681008575833412e-01   +7.166225022989607e-01   +3.742237143550451e-01   +1.987093703100747e-01; +1.180932967556386e-01   +5.650839465630604e-01   +1.753394383210961e-01   +2.211373249907445e-01   +3.412720172825576e-01   +8.795818339132268e-01   +9.801761545932155e-01   +7.435804917606351e-01   +5.785315544115799e-01   +1.447258452427677e-01   +8.278723225009378e-01   +1.168137346171960e-01   +3.923201995878926e-01   +5.143855459371068e-01   +1.090837265366968e-01   +8.417154695270174e-01; +5.930097628836477e-02   +5.047193755546788e-01   +5.182215318181215e-01   +5.688747713573786e-01   +1.392909067894962e-01   +1.574183488337117e-01   +4.955823999803307e-01   +8.722760537946372e-01   +8.353595040337497e-01   +4.567975990773520e-01   +2.166558492836431e-01   +3.250592340505365e-01   +1.345129639208141e-01   +5.135957419954024e-01   +7.192786660049574e-01   +4.247961688987268e-01; +9.325363378881939e-01   +6.678443810601693e-01   +3.561445988802434e-01   +3.878550698760380e-04   +5.038903601613750e-01   +9.139371104850398e-01   +5.222306151298218e-01   +3.291694889653565e-01   +1.156372325514226e-01   +4.583094433548370e-01   +2.679634797824189e-01   +4.570974430129117e-01   +3.385637924623499e-01   +3.859307146567759e-01   +4.491487652020707e-01   +5.584786072713913e-01; +7.453458972584444e-01   +6.330425367157083e-01   +6.454501630690398e-01   +5.889211694748121e-01   +4.135810391025935e-01   +5.562342619894178e-01   +8.542658039938261e-01   +9.892829606465757e-02   +5.175971043313464e-02   +9.543376009060938e-01   +8.671926283749677e-02   +7.166927053044310e-01   +1.227926232946915e-01   +4.789515251022534e-01   +1.293848384477475e-02   +4.478343319559637e-01; +2.431421612618594e-01   +1.447914511204131e-01   +2.815436416214974e-01   +8.910958098345438e-01   +1.719881231948782e-01   +9.219700160239419e-01   +2.540932979040488e-01   +4.504782356735860e-01   +5.173979901434932e-01   +5.311851425553808e-02   +9.166384812717826e-01   +4.055569927191778e-01   +3.688059565673880e-01   +7.398683225704085e-01   +1.242713539264895e-01   +7.599047057316796e-01; +2.044452316796754e-01   +1.790480599704465e-01   +4.366313954315785e-01   +2.550095179528684e-01   +4.941859606084566e-01   +5.978138721297124e-01   +5.824871733400740e-01   +2.392935692378519e-01   +6.971541470511513e-01   +3.628386785438057e-02   +7.262485738811234e-01   +2.421949840452552e-01   +2.502049102463492e-01   +7.015486965455699e-01   +6.587903061612966e-01   +9.579951987390155e-02];
L1E_L1I_iGABA_netcon = [+8.437700616310415e-01   +7.523941168071452e-01   +8.746046987171061e-01   +4.354158461356399e-01   +9.178526791523527e-01   +7.796915758203318e-01   +3.218538953522397e-01   +6.407027194485145e-01   +9.390089863796448e-02   +2.650791717455171e-02   +1.292583010603275e-01   +5.202479488396911e-01   +8.698969298032757e-01   +5.758604112771128e-01   +1.659794020267015e-01   +6.274358732950759e-01; +6.212659988280516e-01   +9.955636983967896e-01   +3.088912694889643e-01   +1.471899151933566e-01   +8.835067727171756e-01   +2.728272494880524e-01   +9.628952895408737e-01   +4.291068766730245e-01   +2.926981021712106e-01   +5.136315289597266e-01   +4.247188925733330e-01   +2.043398477920096e-01   +8.028700426366998e-01   +2.881157774403720e-01   +5.477655927644767e-02   +3.363119066339949e-01; +6.715841891990399e-01   +3.707954225421125e-01   +4.334482104846433e-01   +6.543746819366559e-01   +5.858350036084917e-01   +5.271696938659778e-01   +3.520767919655177e-01   +4.779305854248033e-01   +3.265429598511846e-01   +8.630233662481432e-01   +4.809046107102553e-01   +7.751711594389950e-01   +6.466177928467551e-01   +1.320234643831220e-01   +2.114923704308572e-01   +1.566893284780047e-01; +7.822748424174569e-01   +5.028340540423123e-01   +3.820651799363992e-01   +7.211601891568804e-01   +8.358108004307824e-01   +4.029427175173055e-01   +3.202392038965183e-01   +1.000889062967816e-01   +4.831313050225105e-01   +5.819031464663199e-01   +6.742508732637220e-01   +3.909697015915734e-01   +7.348823060493386e-01   +5.028997529667505e-02   +2.041184622481413e-01   +4.020422908602341e-01; +3.087642836243716e-01   +7.583083436426962e-01   +6.569016138550842e-01   +1.618552500862567e-01   +7.762420479486021e-01   +7.792697314101487e-01   +9.085711543780043e-01   +8.068428871268772e-01   +2.415111298365773e-01   +4.221496119541641e-01   +3.570312393364179e-01   +6.638548848261407e-02   +6.671895421805940e-01   +6.241482486070032e-01   +2.175908502718895e-01   +9.128811959210829e-01; +3.299807443130211e-01   +1.270628670946252e-01   +2.373298529616235e-01   +3.428725272219434e-01   +7.852803195957199e-01   +2.536434325856170e-02   +8.855401842324266e-01   +6.533278919958607e-02   +4.538558271826179e-01   +7.133117086816082e-01   +4.973612471438607e-02   +7.558085988238494e-01   +8.805805044620251e-01   +6.054371308059682e-01   +5.787111407655482e-01   +1.493187124683342e-01; +6.336401184281129e-01   +5.181178009916110e-01   +6.857707887407026e-01   +1.059398278650468e-01   +7.011351648783477e-01   +4.118057510687470e-01   +3.527840041353990e-01   +9.546381088633910e-01   +7.582657084389808e-01   +2.338250568804596e-01   +2.908674652566259e-01   +4.532258803232691e-01   +8.529661426103954e-01   +3.715869288497589e-01   +3.371132437397996e-02   +4.640208245286703e-01; +9.021217467079420e-01   +9.062617761934726e-01   +3.263511151110282e-01   +4.129817112377664e-02   +1.803420539625978e-02   +8.264176670135051e-01   +7.503438052894549e-01   +7.733638534345880e-01   +7.182772110977296e-01   +5.908044279607833e-02   +7.939795692392407e-01   +3.192806926503827e-01   +4.034444862997595e-01   +8.319437494798761e-01   +7.954812185072905e-01   +7.774475577455763e-02; +3.714581363013766e-01   +9.928889571666599e-02   +8.807879774093582e-01   +4.784157597449405e-01   +3.306452190613731e-01   +5.928506289357507e-01   +1.263616838909882e-01   +4.404729403498484e-01   +2.381746874993529e-01   +9.762909859434853e-01   +6.512216095106782e-01   +2.776112879704175e-01   +1.051615392410739e-01   +5.198075838256407e-01   +1.348957638396296e-01   +3.419873634910127e-01; +8.815133323934272e-01   +1.788355796493001e-01   +9.988363305476143e-01   +4.771490943946400e-01   +9.476203375547447e-01   +2.132464371625779e-01   +5.995297621889846e-01   +1.653234785106589e-01   +6.991682816491560e-01   +9.690727158464504e-01   +7.098728181223726e-01   +5.838670810835777e-01   +4.036018275753140e-01   +8.011802916114741e-01   +5.823745783596315e-01   +4.960328259171468e-01; +1.240563811052929e-01   +1.730863184153749e-01   +6.809371099935173e-01   +5.462830757594912e-01   +3.992182294789313e-01   +2.967031429712422e-01   +4.369580854484423e-01   +8.079840447497419e-02   +3.055548697564785e-01   +1.364975745112103e-01   +7.648592870027046e-01   +9.120318041451875e-01   +3.407123697639542e-01   +5.699466701024403e-01   +8.583544398935930e-02   +4.898797731670060e-01; +8.847060776223739e-02   +5.338569613544166e-01   +3.451077268983618e-01   +6.520123929516685e-01   +6.320846160493671e-01   +2.680245773766062e-01   +9.589145832219383e-01   +7.418833602261106e-01   +4.695670321181150e-01   +5.365289706403476e-05   +3.842509250754477e-01   +4.512632357612617e-01   +1.147964536241039e-01   +7.145293392086965e-01   +2.287260573631956e-01   +1.278497893200136e-01; +5.460414430660608e-01   +9.790518633914003e-01   +5.608019490056741e-01   +3.489302356724998e-01   +8.589918341095382e-01   +9.286277828944071e-01   +9.642355829466462e-01   +5.440698561644096e-01   +4.442144454888011e-01   +9.364273202473902e-01   +3.620057309361120e-01   +9.802495220270436e-01   +8.524211778988369e-01   +7.329154251386921e-01   +4.522670727676125e-01   +8.530306653488391e-02; +6.106469347826632e-01   +8.427903157264530e-01   +8.904424177871142e-01   +2.561572726589139e-01   +3.767504252426978e-01   +5.530974590478521e-01   +2.424014786687623e-01   +4.856802540669857e-01   +7.343362676575674e-01   +7.407250395620901e-01   +8.106390307062247e-01   +1.107127514441510e-01   +8.916718706447601e-01   +4.550322969575792e-01   +1.792401287870083e-01   +6.739217429716267e-01; +7.275505855546729e-01   +6.728125368527942e-01   +6.469274287037002e-01   +1.765706559638611e-01   +2.046481298365871e-01   +4.327315202148079e-01   +7.702808902146236e-01   +8.956180695343207e-01   +8.759323196253802e-01   +4.331180734888687e-01   +3.853939594834929e-01   +4.159349847168854e-01   +6.855659099814916e-01   +2.831204645960186e-01   +4.148947870904759e-01   +1.215975241511593e-01; +9.914811154484656e-01   +8.832163844421152e-03   +3.768714285662288e-01   +4.780697936629270e-01   +9.118718060952078e-01   +3.284284711317332e-01   +7.128711061973235e-01   +5.825635650007400e-01   +9.132976307071133e-01   +9.438705494066003e-01   +8.716283929969603e-01   +3.826102499274899e-01   +7.428917831866486e-01   +1.517869535096964e-01   +9.652714480341320e-01   +9.893156393835055e-01];
L2I_L1I_iGABA_netcon = [+5.743392120582611e-01   +5.647421914113434e-01   +1.081487759384115e-01   +4.596710902738865e-01   +7.965471053025777e-01   +9.782387939284443e-01   +2.237139104594475e-01   +7.585643331751986e-01; +5.580814850422076e-01   +9.526942574429832e-01   +1.188956029570503e-01   +5.674927697053034e-01   +5.422318819721120e-01   +4.225161213356127e-01   +6.627368951516993e-02   +5.062278469147069e-01; +6.110403459588464e-01   +9.213590963138689e-03   +4.336484864024634e-01   +8.174768585165543e-01   +2.573937079658136e-01   +3.932283268288623e-01   +8.357026339184747e-01   +8.279468220049526e-01; +4.667047578920219e-01   +1.261254615628438e-01   +9.327522695988445e-01   +3.550991016859744e-01   +7.813902386331162e-01   +4.607926306746722e-01   +4.159111663936535e-02   +9.277309355881513e-01; +4.345983063773423e-01   +8.534867287965684e-01   +1.399172850698447e-01   +2.485657733532947e-01   +7.790583391373762e-01   +1.212950797267777e-01   +9.092140630289696e-01   +7.106257690170571e-01; +6.282542881127721e-02   +2.179102488002053e-01   +8.266589344836853e-01   +7.714596119477232e-01   +1.446000391432204e-01   +4.545071110084394e-01   +4.498593451648010e-01   +7.979939145528554e-01; +6.467385426576214e-01   +7.096159635356558e-01   +9.327725540485866e-01   +2.321443953009083e-03   +8.229737812637169e-01   +2.652957226363926e-01   +2.852022607667943e-01   +9.582895027047904e-01; +4.261436694345225e-01   +7.744579873016501e-01   +5.726020718867717e-01   +2.758813831054163e-01   +6.234497668523389e-01   +9.291392339524045e-02   +7.550578448161513e-01   +9.510467971923815e-01; +7.564914361507999e-01   +4.211388111545088e-01   +4.986096582210237e-01   +2.335443189570028e-02   +4.573278856040577e-01   +6.618204565301944e-01   +9.269569002123067e-01   +2.954203226185605e-01; +3.067733490635972e-01   +7.256598512051970e-01   +9.310322311384126e-01   +6.699952760364295e-01   +4.837843420062020e-01   +9.448922948675016e-01   +1.410899143272730e-01   +3.523438363680351e-01; +5.980206485470524e-01   +4.576652899530455e-01   +8.623967833612173e-01   +9.674585651387828e-01   +2.198259389117593e-01   +7.649545788163303e-01   +9.555047013395449e-01   +5.411225246294834e-01; +3.345850396149948e-01   +8.043419677905660e-01   +2.533842108376005e-01   +9.454457603950613e-01   +8.580520951704720e-01   +4.312080626227375e-02   +3.043029499323184e-01   +2.135237507316884e-01; +6.431664620660014e-01   +4.279101893412580e-01   +4.587315187948905e-01   +4.703183547071449e-02   +8.801081549828577e-01   +2.615910293003655e-01   +2.095883165438532e-01   +8.075539281060727e-02; +1.107840201923698e-03   +1.490462247383368e-01   +7.405654988620159e-01   +2.863799544774140e-01   +8.452889539763163e-01   +6.349560806116734e-01   +4.639242116698696e-01   +5.064026479580164e-01; +1.443023054896952e-01   +8.045645760516074e-01   +7.520344249742550e-01   +4.873302549492490e-01   +4.429108027426640e-01   +8.951615725408218e-02   +5.974862511964497e-01   +1.949566949931841e-01; +2.473333331692468e-01   +3.812618307773064e-01   +2.306777372314649e-01   +8.871015858716588e-01   +5.429996537388357e-01   +7.464100417265253e-02   +5.521987276059696e-01   +1.452358392029275e-01];
L1I_L2I_iGABA_netcon = [+6.989440024941250e-01   +8.676057810080674e-01   +6.139958432789040e-01   +5.489836889386109e-02   +1.431588332274998e-01   +2.349771294235952e-01   +8.387807563590050e-01   +3.712387304863924e-01   +7.066794609309417e-01   +3.839196553145824e-01   +2.391918129291261e-01   +6.667297831925471e-01   +1.676658819246856e-01   +5.699850058437999e-01   +4.384102294465401e-02   +4.898930312596485e-02; +5.979221933012411e-01   +7.983920374571426e-01   +6.103496985596268e-01   +5.736205091318543e-02   +7.447475400252934e-01   +5.568157345142363e-01   +1.978675836994213e-01   +5.588865287795479e-01   +1.873048235516138e-01   +7.198928861369788e-01   +5.131151644171463e-01   +3.293687396501691e-01   +1.155955428100521e-01   +8.095781887757035e-01   +4.426101819481045e-01   +9.212512240898064e-01; +1.629615214974982e-01   +6.269170715240850e-01   +3.140322112069854e-01   +5.970660296580712e-01   +9.513266785864488e-01   +1.136495725099015e-01   +6.174316464101628e-01   +8.301770369548642e-01   +2.305714020848835e-01   +6.414520000031380e-01   +7.318840489418686e-01   +5.518895591461669e-01   +7.362265646811806e-01   +6.738416421179229e-01   +9.164861383405615e-01   +1.739546799458017e-01; +4.829538054987061e-01   +4.721683035886942e-01   +1.422165809412463e-01   +6.571810024260112e-01   +2.659493234733448e-01   +8.186258861084996e-01   +1.545120494850163e-01   +7.075066312424318e-01   +9.984958064251220e-01   +1.009385193761858e-01   +7.708905020030257e-01   +5.320708332931122e-01   +2.110477367165723e-01   +4.439908558666022e-01   +8.847132858878072e-01   +7.441125627383403e-01; +2.859014564776816e-01   +1.931948499410692e-02   +6.050949617443571e-01   +4.799974385782805e-01   +9.531733387598817e-02   +6.507772258380452e-01   +5.837379594338226e-01   +1.159289451159070e-01   +9.053172411949738e-01   +4.919322495519727e-01   +6.769482422591540e-01   +9.016709091832805e-01   +4.839178198095620e-01   +8.935888670626710e-01   +9.259272474136174e-02   +4.761567703960457e-01; +4.033312457277766e-01   +1.175840324227782e-01   +8.899677180067103e-01   +9.784130962168288e-01   +2.311726011191682e-01   +2.375513611167681e-01   +5.449827698269409e-01   +7.403306890204033e-01   +1.142026471046545e-02   +5.620524709191291e-01   +8.127139314773082e-01   +2.842090397561819e-01   +5.054160238169120e-02   +7.833047809507647e-01   +6.752942925915220e-01   +2.461448121408807e-01; +4.909433090658191e-01   +7.190797173815249e-01   +5.628239943934361e-01   +8.637531802214219e-01   +8.961089625567582e-01   +3.016858360857860e-01   +6.820049609988278e-01   +9.239446227911524e-01   +8.341439578686204e-01   +5.574182077087564e-02   +4.184287524968011e-01   +1.392548075227830e-01   +5.716467091251153e-01   +5.817792765127524e-01   +9.415570008386439e-03   +6.632974064842810e-01; +8.625818257458263e-01   +6.825755325480037e-01   +6.330265195962368e-01   +9.542653792574833e-01   +1.995966031756600e-01   +3.301987400012190e-01   +6.982873032471898e-01   +9.236135307595910e-01   +2.523944717820595e-01   +8.927889080967800e-02   +4.973811282712197e-01   +9.574154462042260e-01   +4.909375088990088e-01   +6.164503173704051e-01   +1.208043395473552e-01   +6.093466544202621e-01];
L2E_L1E_iAMPA_netcon = [+3.677364568351471e-01   +5.620762869944343e-01   +2.005054648661559e-01   +5.144827530723449e-01   +2.899103084095731e-01   +7.443705554420912e-02   +2.785482231672725e-01   +2.668772818655819e-01; +4.376822950544917e-01   +1.932168460083069e-01   +1.370566474626838e-01   +6.855079986468500e-01   +6.198662553636347e-01   +5.939564178874542e-01   +9.290271015498011e-01   +9.043842416123058e-01; +7.181746510114769e-01   +6.132359905243848e-01   +8.184502168209495e-02   +2.075679671761717e-01   +8.629493008458463e-01   +7.639383468786007e-02   +7.639826433009135e-01   +1.596037959382847e-01; +1.911805010124605e-01   +7.403319874044603e-01   +9.141773369155183e-02   +9.720622271253051e-01   +8.205852412232517e-01   +3.969742176733572e-01   +2.626059337189058e-01   +5.538507705253182e-01; +4.016073802568797e-02   +8.315737164822774e-01   +5.515194043704581e-01   +3.508214893840328e-01   +2.064770708188464e-01   +5.937317855061275e-02   +2.427369826046104e-01   +4.227884161423245e-01; +3.152420470270039e-01   +2.774074751872435e-01   +7.314521154747262e-01   +1.846346542442722e-01   +7.508508478482619e-01   +1.287274439954345e-01   +1.653468991089920e-01   +5.473735105894127e-01; +7.899121161779961e-01   +6.077050127876148e-01   +5.441430537388889e-01   +2.382592505891484e-01   +1.984230244690629e-01   +2.441026203196781e-01   +2.876306057486601e-01   +7.543367267578127e-01; +4.717343183040045e-02   +5.479300671841018e-01   +5.473185511285127e-02   +2.539400071157855e-01   +5.780123442710630e-01   +9.436094000802095e-01   +5.641825642833573e-01   +1.361409729225090e-02; +2.162337590434444e-01   +2.744608265866472e-01   +6.325609853692924e-01   +2.227777906169909e-01   +8.768849311522975e-01   +2.034607637537536e-01   +4.048751822627503e-01   -9.813430535166247e-04; +2.743180012309265e-01   +3.403160699345500e-01   +9.942708078723295e-01   +3.597328030626627e-02   +7.138167295619441e-01   +3.273620239535978e-01   +9.863292058139933e-01   +2.168784069804967e-02; +7.894504423900834e-01   +5.666950390724179e-01   +9.149425907090740e-01   +3.566525258312181e-01   +7.002512840974511e-01   +8.666486286911740e-01   +5.444148880012701e-01   +3.589983085433291e-01; +9.906484719035652e-01   +7.439551408082713e-01   +7.685053448689202e-01   +8.987717243767231e-01   +4.676493471630124e-01   +9.223876292932082e-01   +9.283157779405289e-01   +4.266344721074079e-01; +9.493744295751450e-02   +7.717364806339816e-01   +1.914802627443996e-01   +1.400215206323564e-01   +5.046450676409295e-01   +2.369868473453636e-02   +9.918103467602050e-01   +5.455314243269670e-01; +1.960140064807552e-01   +3.981199878934673e-01   +3.209947843677482e-02   +9.551419429670726e-01   +7.966051457385965e-01   +3.645124256982658e-01   +8.359735497501450e-01   +4.927233829147623e-01; +1.168475132830606e-01   +1.487393965610407e-01   +3.733756098510101e-01   +9.023792904884925e-01   +9.399831209742391e-01   +5.281054891690355e-01   +1.804057166476491e-01   +9.203650715360262e-01; +6.476612515101271e-01   +2.080777362187334e-01   +5.753288437724803e-01   +4.099306321500454e-01   +7.820522219163963e-01   +4.062520069714184e-01   +3.135470797963347e-01   +4.159338155075573e-01];
L1E_L2E_iAMPA_netcon = [+4.968598893428123e-01   +4.497707493542852e-01   +6.167287658221544e-01   +4.904923195832580e-01   +2.304755175360466e-01   +7.213717130213305e-01   +6.945312753244878e-01   +6.328409526688669e-01   +5.224053746185233e-01   +2.411520323212895e-01   +8.768131492829850e-01   +1.742890077654772e-01   +1.374273757295727e-01   +2.434409761867502e-01   +1.831791913163212e-01   +2.374242578570034e-02; +8.379904256105873e-01   +3.693615869940322e-01   +1.035381987722915e-01   +6.613084299883356e-01   +8.362229427074245e-01   +3.806189648995551e-01   +9.796254491342794e-01   +6.266541367859374e-01   +6.728952280333947e-01   +7.292863706404468e-01   +6.585687967579332e-01   +3.025189555119820e-01   +2.828138500335212e-01   +7.487599544560544e-01   +1.459923456187122e-01   +2.511168458605104e-01; +1.850389374147212e-01   +3.003208038723228e-01   +7.520080901389987e-01   +1.783020539408670e-01   +7.342789569413060e-01   +3.839676641722592e-01   +7.505226027036163e-01   +4.070909734486695e-01   +7.773793431150681e-01   +1.361689185730904e-01   +5.380783647274253e-01   +1.090702577580603e-01   +7.225885042846167e-03   +9.365272521416600e-01   +1.327703619494124e-01   +9.889488040656415e-01; +3.365908898577757e-01   +2.328010263961982e-01   +5.365115556695487e-01   +4.789478386847273e-01   +4.889861498317683e-01   +7.157504394597595e-01   +5.528927980409405e-01   +4.252367213791638e-01   +4.633223434933726e-01   +4.076556994295343e-02   +2.518660297076974e-01   +4.514687907130544e-01   +3.054778909303650e-01   +2.948090459839033e-02   +1.718453268947458e-01   +6.290955479876993e-01; +6.932398255348429e-01   +1.369935517518577e-01   +4.441582120439895e-01   +4.990134039777265e-01   +8.486451892057768e-01   +8.386346633233626e-01   +2.940648867734520e-02   +5.101626460177749e-01   +9.076987644266313e-01   +6.502169924589448e-01   +1.053784632154904e-01   +5.843459712412337e-01   +9.052141235044151e-01   +4.351464709453200e-01   +9.227694412198535e-01   +3.579433110034489e-01; +6.925638064987969e-01   +9.981806951289392e-02   +7.432359513171654e-01   +6.009396043018920e-01   +7.149266774871971e-01   +6.679353446680930e-01   +1.950895406817560e-01   +2.596785415144321e-01   +2.507757734347007e-02   +2.003958344275587e-01   +9.715213128159395e-01   +2.248440231834319e-01   +2.941675299672578e-01   +8.313385130405063e-01   +2.595281072648686e-01   +9.363460431120102e-02; +3.678449828062438e-01   +2.267399973017880e-01   +3.874321249461560e-01   +2.406066160669069e-01   +5.218706566101849e-01   +6.510232591573000e-01   +9.419345206156027e-01   +4.231518753419424e-01   +4.801563040704923e-01   +9.735430438937086e-01   +5.972534489505517e-01   +1.106435450385852e-01   +8.329412994492488e-01   +9.990752669913578e-01   +2.058452492418685e-01   +4.092373291614023e-01; +3.450374788643994e-02   +3.461658876712637e-01   +5.261276833468969e-01   +5.173295538789254e-01   +9.373542350347037e-01   +5.643836067612380e-01   +3.967800176232117e-01   +5.230717595715523e-01   +2.713104357821102e-01   +8.209172118034664e-01   +8.190984742319516e-01   +5.609656929891078e-01   +7.457828965706547e-01   +9.200322535638333e-01   +6.132207064947235e-01   +9.308109654278410e-01];
L2I_L2E_iAMPA_netcon = [+6.775112922504960e-01   +6.144775227422928e-01   +4.206494973755560e-02   +7.925277088940356e-01   +5.237398072577309e-01   +8.261490624218190e-01   +6.441361354135940e-01   +3.861045634341342e-01; +2.321011822121659e-02   +9.452817732411879e-01   +5.511687552144703e-02   +9.297143541497412e-01   +5.377420745784589e-02   +1.082127661579080e-01   +3.947032300284727e-02   +1.673359479792542e-01; +7.342685813547688e-01   +9.644963161906855e-01   +4.017454152421366e-01   +9.361603861969923e-01   +2.871552900774145e-01   +2.339288970129948e-02   +5.683403399660415e-01   +4.445394673835826e-01; +2.134390774256490e-01   +3.690589477647398e-01   +9.839542932489956e-01   +1.462833382428601e-01   +7.098166189743690e-01   +1.219131328530556e-02   +3.048543503613345e-01   +8.732665525406604e-01; +8.604987525030920e-01   +7.951264417686384e-01   +7.122004393299750e-01   +3.194824744161079e-01   +8.781873236962924e-01   +3.362939264645067e-01   +2.611153304532244e-01   +4.116359001387049e-01; +1.568942862806460e-01   +7.284159059040830e-01   +9.888666975744234e-01   +4.284649390097478e-01   +3.660441654568858e-01   +6.640024610516002e-01   +7.217926652908047e-01   +1.629408840832869e-01; +6.689400308821356e-01   +9.537803312909515e-01   +6.453438627231405e-01   +7.018901736394730e-01   +5.609554086102863e-01   +5.954951999335182e-01   +3.051751604609426e-01   +6.620264563240218e-01; +9.355538309489119e-01   +1.067388439174219e-02   +5.018958638744183e-01   +6.144369821085555e-01   +8.838172997407158e-01   +7.965725146289458e-02   +8.952991821672389e-01   +9.253603416157917e-01];
L2E_L2I_iGABA_netcon = [+5.954384198937195e-02   +5.197332773703073e-01   +3.525330380309173e-01   +2.617181351853213e-01   +4.196887330694941e-02   +8.904403946692153e-01   +3.446639302784406e-01   +4.514969199983687e-01; +3.540176728757436e-01   +6.950969023023883e-02   +5.568662436587024e-01   +9.843645018974292e-01   +3.606534600118917e-01   +5.400670198165325e-01   +9.351554417797392e-01   +6.716671572166546e-01; +9.327550263993806e-01   +1.844468536579182e-01   +6.921132991860690e-01   +3.495252970308803e-01   +3.566881641137312e-02   +7.174433195921543e-01   +9.182923291407186e-01   +7.695078197938032e-01; +2.415017442354559e-01   +3.169678397726603e-01   -5.990584053903504e-03   +4.025077618472078e-01   +4.858835143672020e-01   +7.103225351501405e-01   +7.249759908502005e-01   +9.272697038444743e-01; +1.024382435998769e-01   +2.437353087435631e-01   +4.833025386262167e-02   +7.524471914715165e-01   +7.232348129663457e-01   +1.691567209730261e-01   +4.426635945775538e-01   +6.582301402289815e-01; +7.160637396336912e-01   +3.222068846974162e-01   +3.084713403343458e-01   +1.014234925606054e-01   +1.400732465478909e-02   +3.518689042196357e-01   +1.513900538311566e-01   +5.016983204209590e-01; +5.239497280765418e-03   +8.791406100723297e-01   +8.689456626225283e-01   +5.906498502718358e-01   +5.168534576786981e-01   +3.797156054911170e-01   +8.314888339072609e-01   +3.421379687749624e-01; +1.854611043702708e-01   +3.008922109143694e-01   +6.274967705933647e-01   +1.229635459597142e-01   +2.396383570466227e-01   +7.584959951522606e-01   +2.566676357297283e-01   +9.466757056908016e-01];
L3E_L2E_iAMPA_netcon = [+7.912306973708279e-02   +1.572546368433347e-02   +3.683118006761656e-01   +4.967788556563095e-01   +1.804365558033865e-02   +9.555997284958953e-01   +3.596371538267178e-01   +1.425122078699733e-02   +2.038676672705872e-01   +6.192885779326959e-02   +2.431036449203900e-01   +9.993547584288189e-01; +9.519955191268448e-01   +9.772862158437323e-01   +1.158600583058349e-01   +6.546097282439502e-02   +8.059161414548651e-01   +3.871657393067761e-01   +2.243528942336609e-01   +1.216268551607878e-01   +3.558697445488226e-01   +7.415711033095163e-01   +5.333801805927201e-01   +3.446648545713792e-01; +6.626878941840010e-01   +7.242743230894837e-01   +5.145515632778330e-01   +8.618939318064457e-01   +7.917683145483838e-01   +6.641310983303205e-01   +7.245366977208851e-01   +6.695394895952351e-01   +8.880078220596171e-01   +9.906466210308688e-01   +3.331135060561155e-01   +8.222447125818640e-01; +1.685211425334762e-01   +8.714443151790690e-01   +7.074475802701533e-03   +9.966627317942589e-01   +4.234667568384163e-01   +5.848542973837216e-01   +7.724952893857842e-01   +5.084468527201815e-01   +8.088168685968339e-01   +7.675672198468246e-01   +6.746801090554984e-01   +1.094968058045808e-01; +1.970614974408226e-01   +8.144861476863304e-01   +8.686236298921188e-01   +1.228303833499647e-01   +6.302058373523898e-01   +5.951637898600039e-02   +3.421751359770240e-01   +7.055126756545152e-02   +3.197787595719611e-01   +8.811874368758521e-01   +8.754774866658330e-01   +7.732030437199218e-01; +9.946474622460257e-01   +3.023601347121407e-02   +9.044299381879114e-01   +1.000829270927330e-01   +5.679451109782077e-01   +7.631382879038531e-02   +5.767316221986425e-01   +5.354242311888824e-01   +6.004012806750230e-01   +3.615789845771481e-02   +9.830755056459916e-01   +1.503031507611945e-01; +9.253066341875977e-01   +9.644755673070826e-02   +1.136148655666077e-01   +1.485541554772215e-01   +8.961813126095510e-01   +2.277898337619657e-01   +6.425063900326810e-01   +6.782505369745551e-01   +6.988044225147948e-01   +7.939837723313691e-01   +1.453762530124104e-01   +7.316725956836694e-01; +9.821711244603717e-01   +8.521434425696386e-02   +4.368992226031297e-02   +1.289917259407603e-01   +7.483614054265936e-01   +4.203922549355208e-01   +3.660105500978936e-01   +5.878926753434789e-01   +1.781525236342139e-01   +7.067590316653773e-01   +8.771926089657848e-01   +1.089377543408354e-01];
L3I_L2I_iGABA_netcon = [+7.673195117051662e-01   +5.355790375853546e-01   +5.969947072331975e-01   +3.047330705120228e-01   +9.662237949527132e-01   +1.151484812410569e-01   +2.980831051688015e-01   +7.956203044277609e-01   +9.136814635787156e-01   +9.948379519567866e-01   +3.099555646427063e-01   +9.958891355977307e-01; +6.373965018399737e-01   +4.532420138106768e-01   +5.624854271007748e-01   +7.625722290866651e-01   +5.444246182332689e-01   +7.014782249457030e-02   +1.681385086253063e-01   +5.280166128283791e-02   +3.856198065090133e-01   +2.874441032305777e-01   +4.423780246056353e-01   +9.150763755521919e-01; +7.962797129618259e-01   +1.145283131882205e-01   +6.850401683326898e-02   +6.477625746143066e-01   +9.819010240400839e-01   +5.108308420800362e-02   +7.242718321523051e-01   +1.813920350853413e-01   +7.501875953817737e-01   +5.157181460977730e-01   +2.083255703060131e-01   +6.910482992332039e-01; +9.599059688842708e-01   +7.205646457033388e-01   +7.684736688638307e-01   +3.318588514779393e-01   +1.247811313103344e-01   +1.300859802283327e-01   +2.983531105305549e-01   +2.463135521966663e-01   +8.785888489136859e-01   +3.590541904921571e-01   +9.408864643575047e-01   +2.212429473344885e-01; +7.162241599607321e-01   +1.856849777366082e-01   +8.680545611183721e-01   +9.707413248658568e-01   +1.683840475202566e-01   +4.913275839758892e-01   +6.775381817106568e-01   +2.619162983123804e-01   +3.926086745690269e-01   +5.169849315713867e-01   +2.898321469701096e-01   +3.145241031439051e-01; +6.435369232118047e-01   +3.248515644303710e-01   +7.086151744287567e-01   +5.317895574347460e-01   +3.342185883161458e-01   +4.678955189172191e-01   +7.463356935258842e-01   +6.474113954842772e-01   +1.680061816208201e-01   +5.011265346822439e-01   +1.224286689401848e-01   +2.368459843343566e-01; +5.124527495804688e-01   +9.668297649500590e-01   +1.079198828747768e-01   +7.517991664650059e-01   +5.311183709712752e-01   +1.586781938631372e-01   +7.458569751435370e-01   +9.794821268995686e-02   +4.365425280931989e-01   +1.881516411305096e-01   +6.928269980363612e-02   +7.076428186711167e-01; +9.526061671696470e-01   +7.007540727416466e-01   +6.663888409964942e-01   +2.700360188190757e-01   +6.923639467554302e-01   +1.380794876083568e-01   +7.845286347926119e-01   +4.684401911902123e-01   +8.579857992355446e-01   +4.775277563556330e-01   +7.292081715868276e-01   +3.758273453002044e-01];
L2E_L3E_iAMPA_netcon = [+6.568021130954637e-01   +3.868285409451320e-01   +2.347774850693481e-01   +4.638965574239818e-01   +9.044684982228048e-01   +9.501632391382497e-01   +7.616365180777411e-01   +3.548297912480740e-01; +3.841910951763433e-01   +2.312578360466785e-02   +9.050664834619103e-01   +2.835712477571603e-01   +6.795179658508105e-01   +2.615786548649825e-02   +9.031668855715318e-01   +6.639653268772883e-01; +3.081442194680028e-01   +3.294620892095028e-01   +4.875420603641453e-01   +2.757034961721735e-01   +8.426861979745021e-01   +5.018896865760487e-01   +7.965640215996774e-01   +5.924558384024186e-01; +1.573601735576690e-01   +4.846493029232933e-01   +5.957502297165316e-01   +1.428758489396635e-01   +9.493814020863808e-02   +3.392088871915070e-01   +9.565291429537219e-01   +5.384145982860271e-02; +7.775216705031273e-01   +2.623998522789649e-01   +9.553101465297165e-01   +1.397003403016738e-01   +7.349567426735276e-01   +6.726677165490271e-01   +5.351912241564369e-01   +2.165511286843119e-01; +7.091627933944864e-01   +5.260430857298795e-01   +8.495201820423220e-02   +2.645509237561878e-01   +5.435479234572205e-01   +1.670445642496404e-01   +1.637553424772814e-01   +6.014634117497361e-01; +1.727249825985381e-01   +4.167165248077915e-01   +2.217863297026605e-01   +6.108615068639537e-01   +2.571446768684940e-01   +2.266805269525319e-01   +1.345185624308936e-01   +2.693514332774910e-01; +4.477726210525013e-01   -4.041069308616161e-03   +1.522407847028787e-01   +1.065052287527616e-01   +7.147633585568490e-01   +1.177300687643081e-01   +3.363362392470847e-02   +1.100151521182089e-01; +8.377446820915661e-01   +8.941870102281613e-01   +3.898933381835710e-01   +4.848965891377582e-01   +3.601939427297913e-01   +9.931442732125766e-01   +6.808298442725410e-01   +2.107719495981381e-01; +6.980046957108151e-01   +2.395181199759096e-01   +1.849720745284233e-01   +8.935202128582721e-01   +8.540828986346896e-01   +1.397162998020398e-01   +5.867209516701926e-01   +8.735440178791922e-01; +7.660421572352761e-01   +7.919706662475011e-01   +7.635856922507533e-01   +1.883930606024138e-01   +8.191609106815161e-01   +7.697269019036660e-01   +2.987299727970909e-01   +4.587894585796881e-01; +9.804953356751591e-01   +5.781736723186537e-01   +2.283520038364817e-01   +5.189420773920918e-02   +6.104139064640438e-01   +6.339686038213198e-01   +7.415997765111911e-02   +7.270475601191501e-01];
L2I_L3I_iGABA_netcon = [+5.891909066366015e-01   +1.472355644504628e-01   +3.440889516220924e-01   +3.695188031473093e-01   +5.993837072909552e-01   +5.072013669249622e-01   +7.726594120397471e-01   +2.648689189559826e-01; +8.458555441511478e-01   +9.902311524146317e-01   +4.606746315917744e-02   +5.374193397676641e-01   +4.787051125873483e-01   +2.366517540308961e-01   +1.788785884238605e-01   +5.850982371615381e-01; +6.047967494058052e-01   +4.805065879986832e-01   +9.418711230756865e-01   +9.741105179735281e-01   +3.768768755077172e-01   +2.719233429422563e-01   +4.539823837391779e-01   +6.792221466728215e-01; +7.449217897958427e-01   +3.567647306022117e-02   +8.664583030140047e-01   +9.964968237560567e-01   +9.785486180546071e-01   +4.051279491000335e-01   +3.059662039330162e-01   +4.152506828366366e-01; +8.495286328097893e-01   +2.699840458045599e-01   +1.339008629257683e-01   +4.142996326363654e-01   +1.382273082776596e-01   +2.601876277892402e-01   +3.879444162980655e-01   +5.112447916901026e-01; +1.463477115522897e-01   +6.763181870847748e-01   +5.900154749793994e-01   +4.507925612300006e-01   +2.708908743260637e-01   +8.540611354635952e-01   +8.036480384319724e-01   +8.148291867394082e-01; +7.418446463481564e-01   +1.469219096748208e-01   +6.232270086982734e-02   +2.550696956694358e-01   +2.258855658952540e-01   +4.791282942527887e-01   +7.776565733389438e-01   +5.443875004530758e-01; +1.752247074214778e-02   +7.734585353264791e-01   +9.470400402819885e-01   +6.010769190664089e-01   +7.916638453231304e-01   +3.414618965810383e-01   +6.460960815652418e-01   +5.893622295585208e-01; +2.278591235749062e-01   +2.673445900250871e-01   +4.971855139663700e-01   +7.772213276111103e-02   +8.174740140459438e-01   +6.390720938999257e-01   +2.418727444619466e-01   +5.349749684884031e-01; +5.377342226869847e-01   +8.804985523960396e-01   +2.612217822592320e-02   +9.123493570423368e-01   +7.921214850260784e-01   +4.159264935868229e-01   +6.085740029306445e-01   +5.409885403764884e-01; +7.203121918416368e-01   +3.687440022004856e-01   +5.692555661274400e-02   +4.732683715458572e-01   +1.131713583254566e-01   +5.438366086616728e-01   +4.191993895090690e-01   +1.511231886092575e-01; +4.338044543126153e-01   +1.035988222364338e-02   +3.008906458792709e-01   +5.075743530246400e-01   +6.326800031925286e-01   +3.397896772093385e-01   +2.938102183604558e-01   +7.036311910834039e-01];
L3I_L3E_iAMPA_netcon = [+6.376350296066406e-02   +7.729980853755037e-01   +5.546524032626260e-01   +5.729599651296448e-01   +9.203421811029768e-01   +8.349701566319205e-01   +8.492478865506703e-01   +8.629661632148528e-01   +5.338615890482348e-01   +9.881431793638964e-01   +4.814284252312215e-01   +3.503183078112569e-01; +9.222306788541380e-01   +8.387922333663701e-01   +8.441061310016845e-01   +9.357770976929156e-01   +5.928352186610452e-01   +3.926145241886838e-01   +6.279616483793973e-01   +8.560479160521350e-01   +5.671645959318278e-01   +7.011007172660090e-01   +7.397154614505549e-01   +3.998601282833568e-01; +1.804856403246163e-01   +5.928694909983774e-01   +9.697924903757412e-01   +7.788028130314929e-01   +5.755620100492334e-01   +7.057128914816202e-02   +4.446848606492037e-01   +9.496071047804630e-01   +9.804438601183211e-01   +8.443479466517326e-01   +5.950259963955983e-01   +9.880038947640983e-01; +5.432476723972803e-01   +7.668635055526442e-01   +4.661317690883304e-01   +5.961920776676272e-01   +6.585638043119425e-01   +3.736434516519527e-01   +2.346575168546016e-01   +6.940682843461622e-01   +9.679535533854114e-01   +7.380348526433418e-01   +2.630754456574065e-01   +2.974890095215560e-01; +3.974956192035666e-01   +6.582391451257663e-01   +7.764269322899839e-01   +5.829099400285749e-02   +4.361865323502368e-01   +8.490677708978999e-01   +5.126655273908683e-02   +3.627996315923644e-01   +5.597655074366236e-01   +9.960652018617555e-01   +6.069814603020630e-01   +2.248021338318228e-01; +9.143684293818032e-03   +5.890987363461477e-01   +2.197265173703057e-02   +5.434932356784210e-01   +9.352078748365007e-01   +2.486337003452911e-02   +7.124226136600192e-01   +3.733774497057450e-01   +5.317955423394918e-01   +5.071187190616503e-01   +2.321890685858710e-01   +3.302764474011650e-01; +1.024180586901176e-01   +2.645873199401649e-02   +6.779296988987535e-01   +8.646735147427276e-01   +1.025548249560584e-01   +4.210882604382253e-01   +8.484211080818341e-01   +8.420784427469995e-01   +4.787429502526880e-01   +1.890745569224782e-01   +1.945832959883163e-01   +1.650170919571222e-01; +8.561661173889387e-01   +6.923349300496633e-01   +8.350236179080850e-01   +3.383835012843490e-01   +4.091758569468669e-01   +2.542416965686403e-01   +4.048325616043475e-01   +3.841673102599790e-01   +9.010882571117089e-01   +9.594907374011259e-01   +2.049080143124432e-03   +3.838328200925633e-01; +3.371719870592924e-01   +3.271975742448774e-01   +6.845396046169512e-01   +1.787056641663764e-01   +8.928852049013885e-01   +7.422871103067569e-02   +2.872318844926156e-01   +7.704335170567344e-01   +4.824793959875725e-01   +4.519048790312940e-01   +6.463874979120223e-01   +5.260359064418678e-01; +1.494593970612609e-01   +7.584606265207820e-02   +8.954690210205029e-01   +8.813885308223768e-01   +7.386784384119560e-01   +9.208491260823557e-01   +2.628268417811338e-01   +7.731298948346379e-01   +4.869996431065466e-01   +6.059765402964428e-01   +3.999336030672328e-01   +5.953745049814608e-01; +8.076347050844428e-01   +7.443037218761653e-01   +9.513558538055936e-02   +8.414347397549737e-01   +9.586730599822029e-01   +2.681843829679361e-01   +5.049215645263804e-01   +4.333782581603854e-01   +3.136457942384812e-01   +6.446002930361259e-01   +2.721312012435883e-01   +1.698839383289947e-01; +6.554551861691300e-01   +9.652193731207164e-01   +7.064112431869016e-02   +8.340402941794700e-01   +9.701837199461875e-01   +1.005090757570940e-01   +1.166311549060929e-01   +4.878201093999792e-01   +8.591627217473197e-01   +7.664151227933947e-01   +3.801112519689208e-03   +7.245613555845780e-02];
L3E_L3I_iGABA_netcon = [+4.374011786433200e-01   +7.115640619996172e-02   +5.872175115901088e-03   +4.950147271982492e-01   +5.434999437438159e-01   +2.522820049543218e-01   +7.182432185112306e-01   +7.615361391863777e-01   +3.785063854439324e-01   +4.489862418944904e-01   +2.002841364518270e-01   +6.492916017854353e-01; +5.776709428249097e-02   +8.078424662007562e-01   +1.326028903057784e-01   +1.927302531986704e-01   +2.112231132308258e-01   +3.340797239727579e-01   +2.225075076276619e-01   +8.891213488255917e-01   +6.104142058596066e-01   +3.946709520803630e-01   +8.281187149492980e-01   +8.989540190844976e-01; +6.260759552295607e-01   +9.092042918540177e-01   +3.084469852225020e-01   +6.418625717479575e-01   +2.701004821754737e-01   +5.915766925907363e-01   +4.983684976403438e-01   +7.312060134244115e-01   +1.679324392338784e-01   +6.684729234552779e-01   +4.467120962638647e-01   +8.390136573478135e-01; +7.990428437792411e-01   +4.262497497148756e-01   +2.387639121368839e-01   +2.557311293691933e-01   +1.322930544653608e-01   +4.821271564790951e-01   +4.755377576010331e-01   +6.975848736216816e-01   +1.052580894548313e-01   +3.358885049298144e-02   +4.177734111786746e-02   +1.704513516319943e-01; +4.009818997530611e-01   +1.835757479718033e-01   +6.493416688207070e-01   +9.485200589395419e-01   +1.611737741142024e-02   +8.977251754739205e-01   +4.308223386773628e-01   +6.461956673912749e-01   +6.259605700826030e-01   +7.867873883479041e-01   +7.688615297440300e-01   +1.608014764388555e-01; +8.837105339875261e-01   +1.834672561399519e-01   +8.078310576784559e-01   +2.876271912727865e-01   +1.518875545920866e-02   +2.946575820877741e-01   +5.568999186072486e-01   +6.199174061184417e-01   +9.523678305054183e-01   +3.788980487269743e-01   +9.742789229946437e-02   +1.359960829791133e-01; +7.223635553759247e-01   +6.721650101284616e-01   +7.407275882108458e-01   +1.493515908606786e-01   +9.794332222614134e-01   +7.848517062021411e-02   +2.069966066240183e-01   +7.825235958420690e-02   +6.651386185104967e-01   +6.517641024286789e-01   +6.522994720271703e-01   +1.586399798546028e-01; +1.970380829587120e-01   +5.250247572505253e-01   +1.227360969386086e-01   +8.708295750034959e-01   +6.477275943429336e-01   +3.919812670900488e-01   +2.767951368313711e-01   +5.488346862673428e-01   +4.727544834459118e-01   +4.969692367999874e-01   +2.709014465230395e-01   +3.944469981425149e-01; +3.749545638469912e-01   +7.763333624931474e-01   +1.722062689744794e-01   +8.863350162636277e-01   +8.162702609747562e-01   +1.987253106820374e-01   +8.126537131999951e-01   +8.838941237632963e-01   +3.402944780288085e-01   +2.130162167599346e-01   +4.365626645194517e-01   +6.667041225860069e-01; +2.124298243874683e-01   +2.997224248119653e-01   +2.738208212241911e-01   +6.679688770017643e-01   +2.758010803918723e-01   +7.224935859158259e-01   +9.551319495941718e-02   +9.873475344985294e-01   +5.910203839165860e-01   +2.164588251806888e-01   +8.487641874854158e-01   +2.231467090645747e-01; +2.593477286080261e-01   +4.742312279081925e-01   +8.149992003487249e-01   +9.977716814720046e-01   +1.515131186073330e-02   +4.218636614547777e-01   +3.339303887716933e-02   +7.108827697052118e-02   +5.461466037608856e-01   +4.516779864256197e-01   +9.024126389024917e-01   +6.437033305069978e-01; +9.924580010119856e-01   +7.072771211217240e-01   +5.915043493811911e-01   +2.675214505405989e-01   +1.011994670940456e-01   +2.686520104039882e-01   +6.462159383571454e-02   +3.282369802694347e-02   +3.885910303971239e-02   +6.294173504725429e-01   +2.853159524139737e-01   +6.122192552940017e-01];
L2E_Input1_iAMPA_netcon = [+9.921641498129470e-01   +9.895780138901501e-01   +1.000000000000000e+00   +9.877239342965661e-01   +9.854006901360722e-01   +9.996844429928932e-01   +9.837764571017630e-01   +9.971370724297010e-01];
L2I_Input2_iAMPA_netcon = [+9.920024690136833e-01   +9.991807887391324e-01   +9.849798909119885e-01   +9.951760203535200e-01   +9.888220992502404e-01   +9.895833104994112e-01   +9.962318722525705e-01   +9.971167921115314e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last =  11.21 * ones(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))*0.4 + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.5*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.5*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))*0.9 + 0.5*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))*0.4 + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.5*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.5*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))*0.9 + 0.5*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
