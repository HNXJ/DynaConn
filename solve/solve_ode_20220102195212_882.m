function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+1.629813637029147e-02   -2.670716455905119e-01   +6.033884026426515e-01   +4.277565712617527e-01   +1.885947654757361e-01   +3.785629338681842e-01   -1.357915870011749e-01   +9.995027380641361e-02   +2.431870174420895e-01   +6.445965746731870e-01   +4.159686914989092e-01   +3.422775584372065e-01   +8.406520481056418e-04   -1.150612726327178e-02   -2.583001490766340e-01   -8.005738787801603e-02; +2.116722123191056e-01   +1.037565969342886e-01   -2.478369816854173e-02   +7.444117903749746e-01   -3.388799786210722e-02   +3.442897359714719e-01   -2.197876151290594e-01   +4.659710402317194e-01   +5.436799163225696e-01   +1.213859748861571e-01   +4.956818944114546e-01   +3.909379848882399e-01   +1.071600200806119e-01   +2.371090810100882e-01   +5.893991839961221e-02   -1.444088038158957e-02; +5.273914135215199e-01   +3.300105810313985e-01   +2.078865875834207e-01   +2.255851259888215e-02   +2.058277468449942e-01   +2.974615088203063e-01   +4.099609179816696e-01   +1.641247058183960e-01   +1.125979668191479e-01   +3.796164306978687e-01   +4.704507289786803e-01   -5.768352152481798e-02   +1.691508948431669e-01   -1.403493335138807e-01   +2.739979327438385e-02   +4.311917010938492e-02; +9.036585546225034e-02   -2.417166447268136e-01   +1.200492998381618e-03   +3.095783966897113e-01   -1.145712506633061e-01   +2.155362105440754e-02   +6.150669838966710e-01   +6.581371522588321e-01   +5.157909445861976e-01   -5.832244980188313e-02   +4.406813862977400e-01   +6.822070365916625e-01   +2.485760577000355e-01   +6.846779392523955e-01   +1.159266915251055e-01   +6.517656297140094e-01; +7.299222963274998e-01   +1.023968371374962e-01   +4.037712345546898e-01   +6.150355375256102e-01   +1.026839114248404e-01   +3.903387231457471e-01   -1.256468831330972e-01   +5.442233979442918e-01   +4.410942893224042e-02   +3.048797544035890e-01   +3.463604549010234e-01   -2.059432759456705e-01   -1.309866102929626e-02   +3.347078431044387e-01   +4.109566712147293e-01   +2.341920491339450e-01; -5.111167333389822e-02   +6.054056210880965e-01   +1.871591405132689e-01   +6.230997824260549e-02   +6.665187513119961e-01   +1.878603863861045e-01   +6.081514930490850e-01   +1.428636036870049e-01   +4.362040741400138e-01   +2.193912254938067e-01   +3.850253311049007e-01   -6.303782924722448e-02   +2.922901054320158e-01   +3.070023242201619e-01   -5.911433902803982e-02   -6.905765572655462e-02; +4.039959220163481e-01   +5.701380534142483e-01   +3.177705436073210e-01   -6.866538330794933e-02   +9.294361633912518e-02   +2.621445397585506e-01   +3.106133116836693e-01   +2.110121281032322e-01   +4.202121708474774e-01   +4.266743002998487e-01   -7.835213085879283e-02   +4.115152831147282e-01   +2.671939951769237e-01   +3.173814347363598e-01   +3.732540293291445e-01   +3.710468321558505e-01; +2.618691210581292e-01   +5.222524975555446e-01   -1.079911849883982e-02   +7.346600215090545e-01   +2.304714690235456e-01   +1.242568048639805e-01   +3.866020804562129e-01   +7.662818612884424e-01   +7.636390789010351e-01   +5.736030203121176e-01   +9.707798584438146e-02   +5.542977549844560e-01   +9.360672406939449e-02   +5.860054288572212e-02   +1.034917175338040e-01   +3.369187888874225e-01; -1.643233886891949e-01   +6.447478336403691e-01   -4.318884998081659e-01   +2.059918224016863e-01   +1.051202910667529e-01   +4.788378379565221e-01   +3.090740510925507e-01   -3.812916931960773e-01   +3.846779522351289e-01   +2.969061875231844e-01   +5.049118544738205e-01   -1.391508189664647e-01   +5.813962830152669e-01   +3.024419605684316e-01   +1.096969198494923e-01   +1.083796054587881e-01; +1.129807319711152e-01   +1.663096507359160e-01   +3.534358011045565e-01   +3.268280809770110e-01   +3.342592394289550e-01   +2.083105979983375e-01   +3.646644853423686e-01   +1.199196704139036e-01   +2.699911464032907e-02   -2.690386116348695e-02   -2.098396400774826e-02   +1.243747922836181e-01   +7.345827486547089e-01   -3.823049519276528e-02   +1.608532273359206e-01   +5.542498367571268e-01; -1.146999183534697e-01   +7.241164867222933e-01   +2.552226143881426e-01   +1.987874921648145e-01   +5.316087828991384e-01   +6.143091462735105e-01   +5.986091836046170e-01   +1.922316108848282e-01   +1.158110870130226e-01   +5.022989621956964e-01   -1.183214659452546e-01   +5.338088891987972e-01   -3.481276698471279e-01   +4.104169565003084e-01   +6.689376163661351e-01   +2.716698488376486e-01; +6.984516004335620e-01   +5.540217603843833e-03   +2.685243176088112e-02   -5.523234109837072e-02   +3.496575576066363e-01   +3.239392405240242e-01   -1.419703192197505e-01   +3.217435496127328e-01   +6.270541711111151e-01   -2.611699516770984e-01   +6.062419659109316e-02   +4.174555455458329e-01   +4.902095100091882e-01   +3.552026801330953e-01   -4.875591941004171e-02   +2.820953403824378e-01; +1.747756385123905e-02   +6.618234590856824e-01   +5.320544864370607e-01   +3.867554494144074e-01   +5.213037683959326e-01   +4.352784859319709e-01   +3.582281832621303e-01   +5.897494286450177e-01   +6.283923968681417e-01   +4.689445165995333e-01   +2.947422380650244e-01   +1.765864995473323e-01   -2.634756206262962e-01   +3.276076232434199e-01   +1.136843887563113e-01   +1.090372984776740e-01; -5.322971964009850e-03   +3.980502923853646e-01   +2.565806971803961e-01   -3.722234747121194e-01   +1.483525911482606e-01   +7.135566478220672e-01   +1.235042946547367e-01   +5.460367852313672e-02   -6.683853531422501e-02   +1.881664785551469e-01   +7.791729261150001e-01   +5.075827497337801e-01   +4.754489857350351e-01   +4.293634450910606e-01   +1.488298658659666e-01   +2.804097859458365e-01; +2.555582971701322e-01   -8.998791054738578e-02   +4.108151081210525e-01   +6.112496557805657e-01   -1.521262913299086e-01   +5.383087918858000e-02   +6.424538442476998e-01   -1.092615872669148e-01   -2.860099075993220e-01   +4.102533803560567e-01   +2.465274768293214e-01   +2.228215511050680e-01   +2.314957703720206e-01   +1.005153293790463e-01   +2.294013652417828e-01   -1.548108335325927e-01; -2.339336873431711e-01   +4.444493942172901e-01   -8.124989525077804e-02   +4.919870094617875e-01   +9.892645942084287e-01   +6.566054927316859e-01   +5.711526161356132e-02   +7.126203446523190e-01   -8.023011265250744e-02   +5.425210696183802e-01   +5.564961235254959e-01   +3.261154144425014e-01   +1.418529353310663e-01   +5.803489001811283e-01   +5.017529922589403e-01   +2.000837839786785e-01];
L1E_L1I_iGABA_netcon = [+2.258738844819117e-01   +3.984750133926396e-01   +2.081350319966572e-01   -8.768425034759170e-02   +3.100416756992259e-01   -2.218595727569852e-01   +1.672326430066748e-01   +1.153218174947194e-01   -1.533302679336674e-02   +1.342753712589560e-01   +3.190504573345543e-01   +2.870173572038832e-01   +6.593645136399613e-01   -3.687819195972387e-01   -1.708030631378370e-01   +9.302580464280342e-01; -1.144729969398309e-01   -8.956823576525631e-02   +2.200046827294928e-01   -1.441203435481704e-01   +1.181871626338828e-01   -4.901713791495572e-02   +4.875681643475506e-01   +2.900669779219218e-01   +6.655225383637113e-01   +7.721296487499675e-02   +5.850889694699932e-01   +2.929628222298653e-01   +5.652527447900029e-01   +9.849937722647990e-04   -1.188734941558434e-01   -1.768575043299431e-01; +2.482812668228669e-01   +6.085747755642724e-02   +5.532476051952907e-02   +4.456095056428673e-01   +2.661320132804324e-01   -2.820314918362954e-02   +1.177222524353024e-01   +1.919051122575190e-01   +3.637724350468535e-02   +9.337837025697616e-01   +5.497842999689470e-02   +2.414671275163921e-01   -2.262878331523157e-02   -2.068800775441182e-01   +3.285530831489210e-01   +5.774111487450488e-01; +5.022755348617184e-01   -1.920899903481332e-01   +5.758884917278306e-03   +2.239632987415422e-01   +2.313004761131193e-02   -3.107472455164979e-04   -4.679803992961629e-02   -1.843345543145280e-01   +2.097042064346862e-01   -8.187008825109530e-02   +5.404602259300414e-02   +3.730436148971251e-01   +1.568228575425063e-01   +2.739000373798456e-01   +1.586014181510886e-01   +1.423144121287793e-01; +1.337868154606867e-01   +1.362137666290109e-01   -7.864896899462792e-02   +2.823503569177100e-01   +6.300772883377601e-01   -3.234616696464532e-01   +3.871478386643540e-01   -1.585514254563663e-01   +7.654097668497127e-02   +2.935733185727821e-01   -9.803011010974004e-02   +4.560329617719090e-01   +2.973310638283236e-01   -1.972310649104417e-01   -1.854764786328237e-01   +3.441885825181968e-01; +9.846729584998916e-02   +1.841415250064369e-01   +2.161386080583166e-01   -2.128734020829442e-02   +1.574178046762510e-02   +4.563821648877045e-01   +5.304969788878815e-02   +3.232120660290777e-02   -1.605829063010273e-01   +2.274760087405084e-01   -1.575220499074755e-01   +3.401743388736149e-01   -1.261733107262525e-03   -1.715986461190200e-01   +3.572115252624253e-01   +4.623043720453385e-01; -1.736503496093239e-01   +8.939003358866827e-02   -1.390129781161002e-01   -2.648595728951143e-02   +1.493493451898232e-01   +1.808039387223942e-01   -7.560935057021856e-03   -2.420657493543726e-01   +3.006225706385744e-02   +5.635905388907624e-02   +4.244233555598405e-01   +2.322454703736808e-01   +1.809107801633557e-01   -3.026400521574796e-01   +7.316556031682161e-01   +1.236515033474175e-02; +1.065661031912620e-01   +3.467590756117873e-01   +9.725400223523253e-02   +2.992161191712244e-01   -1.079544662094655e-02   -8.333741366517219e-02   +6.721421998016276e-01   -1.848650345748428e-01   +7.031566843986229e-01   -9.008572290699295e-02   +2.157490020665937e-01   -2.201960631607827e-01   +2.428296502246663e-01   +1.845484017165501e-01   +3.035360563647276e-02   +1.304056275242195e-01; +4.733249545175099e-01   +5.584095133590936e-01   +4.338030076283035e-01   +2.618490037748509e-02   +1.852483632946295e-01   +2.520775542998093e-01   +2.753646951067929e-01   -1.051203397024115e-01   +4.359448017847216e-01   +6.409445691280848e-02   +3.234216584262561e-01   +5.133767508320027e-02   +1.116804876369124e-01   -1.838622644733429e-01   +5.798856331060979e-01   +2.617476377631293e-01; +2.154194094241165e-01   +5.222984697744772e-01   -1.503472330588096e-02   +4.571502664897318e-01   +2.986667838760739e-03   +2.607736287324595e-01   +8.700989345941591e-02   +2.341968499084780e-01   +2.443268968448641e-01   +1.065623898663222e-01   -1.105677793021584e-01   +1.407748047398915e-01   +9.684546353746558e-02   +2.701496772495412e-01   +1.992389958689464e-01   +2.783334961347654e-01; +1.184551219210968e-01   +1.449633066545578e-01   +6.347650856501788e-01   +1.749267946312982e-01   +2.638301567159107e-01   +4.475765937206263e-02   +3.059970521073880e-01   +3.167377875253834e-02   +5.033255006002415e-01   +7.544375680262619e-02   +8.026758145295355e-02   +4.978855254296182e-01   +6.094405962213791e-01   -1.120968923588751e-04   +1.147657996777503e-01   +2.561265026198081e-01; +2.196471434574806e-01   +1.040863282980434e-01   +1.691429276442795e-01   -1.855772813972393e-01   +2.223539235558051e-01   +3.107238266393326e-01   +1.155170434659222e-01   +1.879747281452454e-01   -1.989393249028863e-01   +2.651182896964387e-01   +4.530955276928863e-01   +4.250120290428492e-01   +7.963118349647835e-02   +1.686353313031480e-01   +7.424347034319234e-02   +2.525561081434393e-01; +1.993773213765243e-01   +1.618871961442080e-01   -1.029935214847718e-02   +8.906687338550067e-01   +4.388075416848831e-03   +7.273770752721764e-02   +1.123559165259729e-01   +5.186441950269457e-01   +2.965185622971163e-01   -1.641532817168982e-01   +2.255385225269126e-01   +3.498945629252840e-01   +3.677010868686507e-01   +2.761096452972472e-01   +4.180532993228874e-01   +1.222204019611079e-02; +2.511453945547629e-01   +1.518466462617793e-01   +2.489025720075347e-01   +4.543384437949495e-01   +3.008653314368244e-01   -6.440043895107868e-02   +1.402643739039884e-01   +1.078490588942483e-01   +3.293102331142926e-01   +4.395990531225999e-03   +4.148761222609609e-01   -2.008687840515266e-01   +1.359247925146683e-01   +2.207903050779044e-01   +4.127719404766302e-01   -7.618990174428503e-02; +4.003686533576579e-01   -6.662264200224910e-02   +3.333577385666302e-03   -5.932702261242069e-02   +1.264000821037774e-01   +1.738846689087518e-01   +6.407101175444298e-02   -4.811554902770927e-02   +4.234984677146150e-01   +2.608575135881855e-01   +4.114936354563248e-01   +3.499579566051911e-01   +2.818952470793402e-01   -1.805472556193152e-01   +4.040072808693891e-01   +1.221414473393574e-01; +6.857226627135776e-02   +1.644848111512430e-01   +3.310070778212917e-01   -8.484462550114440e-02   +4.091827414786770e-01   +2.708203674593473e-01   -1.139080096612114e-01   +7.232785462404893e-02   -2.695078310756938e-01   +1.606687454413674e-01   +1.343510027282472e-01   +3.844958128556836e-01   +3.307085389763595e-01   +3.953962436669539e-01   -1.167461146095983e-02   +4.034418476595277e-01];
L2I_L1I_iGABA_netcon = [+2.652190837033581e-01   -5.081893167051611e-02   +1.994880255523729e-01   +5.785922458914415e-01   -1.275022559207862e-01   -1.562337572166768e-01   +1.839924741138569e-02   +1.711573018705012e-01; +3.866810510864794e-01   +5.838081847737603e-01   +1.352872709024553e-01   +2.665852488372586e-01   +2.624813896921528e-01   +2.141529376650274e-01   +2.586165716832713e-01   -1.035601493571803e-01; +3.401843754870176e-01   +6.282846522606467e-02   +4.586547274727064e-01   +9.022082013125776e-02   +4.007980698515928e-01   +1.802154636024754e-01   +2.086926772192502e-01   -3.720444254811633e-01; +8.011644241178856e-01   +1.815787009928629e-01   +5.417795886547420e-01   +1.557539528440367e-01   +7.934369028592623e-01   +3.908783354573365e-01   +5.236176680154875e-01   +2.469508539046988e-01; +1.323107308856711e-01   +4.538447245688304e-01   +3.100014184639864e-01   +3.918197567647467e-01   +2.481993139937393e-01   +1.589169296828495e-02   +1.568529040010888e-01   +5.568222818512340e-02; +1.656499028017946e-01   +3.368815169812846e-02   +3.768678166414476e-01   +3.106842944636042e-01   +2.239777025721345e-01   +4.500087946546522e-01   -4.237481129810203e-02   +3.945540793960702e-01; +4.167847501984542e-01   +3.155138081442482e-01   +3.453707687108243e-01   +4.723184169271730e-02   +3.858648311285928e-01   +7.304892801974019e-02   +4.992112250453308e-01   +2.180450537567584e-01; +1.216309480364296e-01   +3.051568409564339e-01   +3.970585219503109e-01   +1.251702787887057e-02   +1.937991517378715e-01   +2.094686919416644e-01   +6.734450958883749e-02   +2.297597117891351e-01; +5.721316909337122e-01   +1.000000000000000e+00   -1.629640180986723e-01   +4.152506392302634e-01   -2.284639707664420e-01   +7.969088600225295e-02   +8.512061643837246e-02   +4.060412102340065e-01; +2.070105693937398e-02   -1.059777616302620e-01   +1.248095417287318e-01   +2.943533658167606e-01   +4.477660948252459e-01   +1.444175733387508e-02   -6.072825199368202e-02   +5.955628162429981e-01; +7.055455880767292e-02   +2.198331565844704e-01   +4.449267488113554e-01   +4.238607715198640e-01   +1.043625126370252e-01   +4.570301546788857e-02   +2.607584710292821e-01   +2.820904652315744e-01; +9.796439484220899e-02   +5.039008078769515e-01   +3.187661398940785e-01   +3.305637886462984e-01   +1.206801065179439e-01   +2.908829631189205e-01   +3.491110142115652e-01   +3.724212992876540e-01; +2.396526928362174e-01   +5.089049941971340e-01   +5.649294274235662e-01   -1.054009435296857e-01   +1.102632565528520e-01   +2.979677461963544e-02   -2.215541977429943e-01   +1.271413145167220e-01; +3.184513612453532e-01   +2.534303791395313e-02   +2.640266355396571e-01   -2.081943044272427e-02   +4.798077788956446e-01   +2.240895611452556e-01   +1.201099061752116e-01   +1.077154877777481e-01; +4.153199013236268e-01   +3.667435279303732e-01   +3.887021529415768e-01   +6.571987020550567e-01   +2.017169274175037e-01   +9.538223354497568e-01   +2.955583828503749e-01   +5.510577498801911e-01; -7.468297899696311e-02   +4.399557493708588e-02   +3.070078379761628e-01   +8.737575441859131e-02   +3.069090696693386e-01   +1.379922210807760e-01   +2.376057743120147e-01   +3.783908867831395e-01];
L1I_L2I_iGABA_netcon = [+3.369531337782792e-01   +1.212014788761991e-01   -6.096199621476014e-02   +3.942003010466433e-01   +8.538537207307644e-03   +1.595852061423456e-01   +2.137687079501542e-01   +4.668357333035649e-01   -3.705313277004408e-01   +6.188223135672027e-01   +6.832586178954148e-02   +3.044400637836915e-02   +4.900328278395833e-01   +2.474656922155369e-01   +2.611471781356398e-01   +3.561147263925597e-01; +3.679344976636082e-01   +2.460666623159659e-01   -2.340790157488958e-01   +2.930113128486755e-01   -1.484952259680764e-01   +2.736733259781951e-01   +6.672844591150021e-01   +3.157312333566939e-01   +4.100782155372402e-01   +6.715179104722402e-01   +1.668146827999869e-01   -3.114861494341417e-01   -3.789624962166822e-02   -6.860780787332071e-01   +2.611195177714421e-01   +5.481102241267771e-01; -3.678464866731966e-02   +9.373094154149578e-02   +4.451226840148216e-01   +1.199866060820870e-01   +1.537676748032199e-01   +1.259661567525582e-01   +4.562335461769688e-01   +3.031132307700308e-01   -2.353168587775319e-01   +5.909233278609070e-01   -2.593188091131851e-01   +4.734988467883255e-01   +4.828672499141263e-01   +3.501885903600108e-01   +6.364832786400653e-01   -2.126018316669870e-02; +5.753988137084097e-01   +2.629983698984586e-01   +2.657110781769072e-01   -6.990416747427682e-02   +6.537810132148498e-01   +2.832374738435324e-01   +7.192377301770783e-01   +6.598464461163012e-01   -2.427807819281406e-01   +5.732445014354144e-01   +5.769168240874951e-01   +5.261227698757867e-01   +4.143924934248783e-01   +1.199757560825389e-01   +3.496785911331439e-01   +2.536085715827593e-01; +7.549893623436610e-02   +1.815953214961748e-01   +8.190172765754312e-02   +4.239644022438093e-01   -4.077262365374933e-03   +7.473985043484535e-01   +5.280712295342380e-01   +1.089693061819516e-02   +4.911781310871379e-01   +4.039239685703869e-01   -1.067577851179803e-01   +2.698723961839477e-01   -1.736510292869620e-01   +2.815283488666880e-01   +2.157240040338965e-01   +7.221345576993209e-01; +1.958145018806829e-01   +3.542471311865226e-01   -7.162731447983038e-02   +7.299550616199270e-01   -2.663232594282189e-01   +3.824231430723269e-01   +4.162077856557077e-01   +2.044297241302082e-01   +1.925103353649972e-01   -3.419326265102869e-01   +6.130562758652489e-01   -1.190430640435171e-01   +5.900999885225602e-01   +6.561693196576555e-01   +5.387751272742587e-01   +2.617360324034714e-01; +1.460881252312790e-01   +5.919429094758701e-01   +4.573361002913542e-02   +3.782489038281013e-01   +2.404614884948710e-01   -2.146386452546479e-01   +3.883508663490455e-01   -1.143361726821067e-01   -1.136186728272792e-01   +5.219430094128554e-01   +4.090032724843274e-01   +2.256883318430194e-01   -2.540511283025221e-02   +3.686984780913984e-02   +3.145618057761251e-01   +5.494079842609827e-01; +4.325237444504453e-01   +2.887929134469474e-01   +3.300006750125714e-01   +2.225666210918344e-01   +1.201400985328088e-01   +5.182286427154290e-01   +5.689101996737150e-01   +4.153204543047726e-01   -1.938102875821146e-01   +2.380591626280534e-01   +9.810000305982962e-01   +5.732920599221646e-01   +2.976257786655534e-01   -3.791861170073170e-02   +2.511026701665577e-01   +3.374075685960805e-01];
L2E_L1E_iAMPA_netcon = [+3.604180475274257e-01   +2.988045702277419e-02   +3.025492256812170e-01   +3.745276214716877e-01   +7.646969981717572e-01   +5.828865673393463e-01   +2.206816908847052e-01   -4.519714834376110e-02; -3.279628050817036e-01   +4.691112023766557e-01   -1.844580621503265e-02   -1.108387291909536e-01   +4.408900567730702e-01   +1.603151506329469e-01   +5.636100890962009e-01   +6.426640852733800e-01; +7.434064262478314e-02   +6.581332795462665e-01   +6.134831169806698e-01   +7.262454424546032e-02   +1.718959555643591e-01   +6.620524387793592e-02   +7.269931777752313e-01   +1.990317834205148e-01; +4.064338166194669e-01   +2.106099699859191e-01   -3.299362332153651e-01   +4.224411881391462e-01   +2.785108767424845e-01   +1.075095452111186e-01   +3.606668128283743e-01   -2.592843113591534e-01; -2.211334621349881e-01   +6.376340001576755e-01   +2.922940413446508e-01   +4.950846765325123e-02   +3.531931045926917e-01   +8.901337341837008e-02   +4.659078112609168e-01   +5.682398351959806e-01; +3.664416930178723e-01   -2.155618281438631e-01   +4.293040947538346e-01   -1.439648004598054e-01   +5.092756316529479e-01   +7.591294279711898e-01   +3.317966075475223e-01   +9.719191756371104e-02; +1.177121220991194e-01   +5.110775650070054e-01   +1.038448590018470e-01   +3.904128095564991e-01   -1.710792325034013e-01   +5.270212514404226e-01   +9.091660423022599e-01   -2.323387574459736e-02; -1.107183786919709e-01   +4.432387116697743e-01   +7.766811097076477e-01   +3.132496711853835e-02   +5.662837699891228e-01   +2.147882822923997e-01   +2.447787797146128e-01   +2.343191443473295e-01; +5.919928216633263e-01   +5.348075869002981e-02   +3.788550387764713e-01   +7.917088105665446e-01   +2.175175637869494e-01   +4.004136389133888e-01   +2.567923323050502e-01   +1.846990616247180e-01; +2.380052576302882e-01   +4.130042923721055e-01   +2.752306088131032e-01   +6.573309471108605e-01   +1.590081707384562e-01   +3.602308229296858e-04   +1.891323941542440e-01   +4.102832415948243e-01; -8.828507771154824e-02   +4.704921510279299e-01   +3.811508278220539e-01   +2.003048025423859e-01   +1.422213931325037e-01   +2.184268762992142e-01   +7.430419820401069e-02   +1.397191553040835e-01; +4.236556595843537e-01   +2.954687585936378e-01   +9.229963185530299e-01   +1.285263632098377e-01   +1.078065271614107e-01   +2.567811226076807e-01   -4.229993530687270e-01   +9.093641019184578e-02; -1.772590856335159e-01   +4.551380989947225e-01   +2.167367933894418e-01   +1.491014923592882e-02   +8.247747997526014e-02   +5.483045244331270e-02   +3.604067523246829e-01   -1.301941534584623e-01; +2.032572123715740e-01   +5.040746217967282e-01   -9.097365708976671e-02   +2.039179920700089e-01   +1.687571073445222e-01   +1.345519408041042e-01   +2.362814540811887e-01   +2.198546217220971e-01; -1.416581967793132e-01   -1.108341591299883e-01   +2.810119650371982e-01   +5.841236496324356e-01   +1.456866906153487e-01   +4.536144116798965e-01   -1.127648829823177e-01   +5.972384414101562e-02; +2.877107749904173e-01   +2.430621425297486e-01   -2.444107073771246e-02   +1.106471681293546e-01   +4.122150161664234e-01   +1.961094038291703e-01   +4.201042436319568e-01   +5.337099571847398e-01];
L1E_L2E_iAMPA_netcon = [+2.024061345479432e-01   +2.204112955317011e-01   +4.788427272262474e-02   +2.933040148232769e-01   +1.744873388791710e-01   +3.818126620603076e-01   +5.957471502298303e-02   +1.944638981151462e-01   +3.965451872372897e-01   +3.014374286893916e-01   +3.364739247606092e-01   +4.285802525194969e-01   +5.364713814445280e-01   -7.956740226511037e-02   -3.111389716178709e-01   -7.991885733024950e-02; +3.212020161492546e-01   -5.903536413939722e-02   +6.295499789272585e-01   +1.262298568279892e-01   +2.677387349064791e-01   +5.500872262261331e-03   +3.358988333607288e-01   +1.972799881983125e-01   +1.516979317801738e-01   +4.420846297698054e-01   +2.824152294235208e-01   +3.429966500070366e-01   +3.768349706455238e-01   +2.758090133399424e-01   +4.187026473547261e-01   +1.992435000321494e-01; +6.766083099200016e-01   +1.288119884718958e-01   +2.216654212042665e-01   +2.768797481137771e-01   +2.985018672458377e-01   +4.996881581639829e-01   +2.878389608342826e-01   +3.346839169029811e-01   +1.916774340750995e-01   -2.289875910048887e-03   +2.146711757374303e-01   +5.377525757521714e-01   +3.179418078140699e-02   +5.167842481417299e-01   +1.150581936860841e-02   -2.460013054696946e-01; +2.676839726429997e-01   +8.436077443129655e-02   +4.010414344634396e-01   +1.008668169481581e-01   +1.373695673778846e-01   +2.649499609375329e-01   +9.165736156689031e-01   +4.851713376721987e-02   +9.686108956970502e-02   +1.740766018572932e-01   +4.314203522279256e-01   -1.314422148662644e-01   +1.816828729984459e-01   +5.440748029857153e-01   +3.536510895498104e-01   -9.315652327308601e-03; +7.183460120772632e-02   -2.510670681614257e-01   +5.880630072247361e-01   +1.387126802635975e-01   +5.114742000963783e-01   +1.184749459280670e-01   +5.757250502868998e-01   +1.713146868775287e-01   +2.483577805853306e-01   +3.219533515265218e-01   +1.209678492473401e-02   -3.084418127730091e-01   +2.202831848057577e-01   +6.108409769248545e-02   +8.344813174012838e-01   +3.755011571744469e-02; +1.252132796463642e-01   +4.702281273833216e-01   +3.373828236276512e-01   +4.951311979050714e-01   +2.908544724179078e-01   +3.180764054474566e-02   +4.532745225674764e-01   +4.162100214819832e-01   +7.491962512805812e-01   +1.892004416881863e-01   +4.398213506314397e-01   -7.589053179946383e-02   -8.465248811583047e-02   -4.089197041262174e-01   -2.039700775296409e-01   +5.532236167665309e-01; +8.091891220254749e-02   +1.834158737910208e-02   +5.542687935468876e-02   +6.335508858156409e-01   +2.782060978628786e-01   +7.309354956137114e-02   +7.317150678005069e-01   +2.002931568346930e-01   -2.822646413387208e-01   +1.698269844729440e-01   +7.237003983926753e-02   -1.704200679181852e-01   -2.480890389415296e-01   +1.569379090287358e-01   +5.076640682670807e-01   +1.224023832620825e-01; +3.188859239064215e-01   +1.975339281547768e-01   +2.505000642492558e-01   +7.417670360890359e-01   +1.809094185010431e-01   +9.133329768646512e-01   +5.431625676687170e-01   +2.333751417882844e-01   +2.324368324825542e-01   +4.895934135250561e-01   +3.053794534608327e-01   +2.989979659839801e-01   -1.291251321565793e-01   -8.038089112723540e-02   +2.766428444486445e-01   -6.685322096301453e-02];
L2I_L2E_iAMPA_netcon = [+3.565307108758869e-01   +4.145642728066460e-01   +5.351700842791278e-01   +2.207796063732794e-01   +1.322339000020223e-01   +6.323392902530921e-01   +3.656273422260468e-01   +4.612762310605475e-01; +3.378665073466894e-01   +2.428709626430411e-01   +6.919424072576923e-01   +5.553281318116718e-01   +4.119048092747479e-01   -1.745505061575408e-02   +2.402596814029745e-02   +2.943910695949035e-02; +2.199700382983744e-01   +5.152904827551622e-01   +3.178988785800582e-01   -2.847488116224648e-02   -1.845631591715705e-01   +2.123970855439037e-01   +3.028395198816960e-01   +1.336050477020098e-01; +1.068590701810935e-01   +3.015510371638872e-01   +1.123776639324682e-01   +4.345440777615969e-01   +4.046412934353738e-01   -1.254030396546022e-01   +1.872908955770758e-01   +1.495149437726466e-03; +4.687732168237206e-01   +9.885473086456784e-02   +4.069371838183857e-02   +3.277867836500959e-01   +3.121718283828194e-01   +1.845255169421205e-01   +4.835865756013032e-01   +2.480673403288818e-01; +2.224832826294401e-01   +2.311096111464190e-01   +1.858986459685160e-01   +2.771710780420171e-01   -3.171730824762095e-02   +2.737950348312850e-01   +1.364804186891555e-01   +1.626467706530932e-01; +3.017820094795567e-01   -5.161411127504602e-03   +1.660660107524181e-01   +4.182311018968011e-01   +2.036446724425947e-01   -4.200398566535330e-03   +9.044168718715992e-01   +1.077631696238138e-01; +4.749602002387536e-01   +5.343400447851266e-02   -2.099793334635628e-01   +2.130090314579968e-01   +2.265988195179743e-02   +1.356587487656441e-01   -1.650845749660208e-01   +2.391304868927695e-01];
L2E_L2I_iGABA_netcon = [-1.461080191424815e-01   +4.804507219511279e-01   +5.649264919024752e-01   -4.454448175011876e-02   -6.826924286287679e-02   +2.043905472398707e-01   -6.978455271196426e-03   +3.677472173802774e-01; -1.838915252492846e-03   +2.375741135276569e-01   +1.930709160533854e-01   +3.945166447655817e-01   +4.758785119143482e-01   +4.002111563349740e-01   -4.411730487550166e-01   +3.029803892422321e-01; -4.336456170585001e-02   +7.873728359976809e-01   -1.924118106477777e-01   +2.254087077632063e-02   +3.771105939339704e-01   +5.849768555665789e-01   -3.118111105746280e-02   +7.749429058302677e-01; -2.240732350060053e-01   +2.911076383790883e-01   -1.235819406480116e-01   +5.262005989209450e-01   +7.436735765292088e-01   +4.031211087409209e-02   -1.360646433793290e-01   -2.174994922228518e-01; +1.437396509410233e-01   -7.685283413389954e-02   -1.652855707385758e-01   +4.465211316314238e-01   +7.190101221584106e-01   +2.531300388500616e-01   +2.280046577242843e-01   +1.512824266383294e-01; +3.273433831754577e-01   +2.587615819337734e-01   +3.847839537463975e-01   +2.598470081680654e-01   +3.563101066892593e-01   -9.035973205161631e-02   +2.160151244359869e-01   -5.681743918095337e-02; +2.516120278224435e-01   +3.194755016387048e-01   -3.143025459977371e-03   +8.306993629079228e-02   -1.531202704952274e-01   -6.625044657428177e-02   -6.830858029153541e-02   +7.961769000001219e-01; +2.154046495617470e-01   +4.814968661045592e-01   +4.621103910534800e-01   -1.257398736268905e-01   +4.252855324777477e-01   +1.914701716990145e-01   +4.445587048423245e-01   +4.130675961923698e-01];
L3E_L2E_iAMPA_netcon = [+6.065815686188460e-01   -2.396480009648322e-01   +1.288723520354429e-01   +2.231231066604462e-01   +6.819318140593317e-01   +2.478220624349446e-01   +3.739761739042270e-01   +4.638468157924324e-01   +2.669749279897466e-01   -4.177318630060536e-02   +1.750947990414914e-02   +2.498908962448631e-01; +2.705281261087486e-01   +9.039008724731635e-01   +2.031918972871371e-01   +4.527765836547270e-01   +1.202512339594836e-02   -4.037116436346012e-01   +2.441246308049841e-01   +9.299000371532506e-02   -1.128342981963241e-01   +1.710309251649304e-02   -4.030786655983601e-02   +3.233405872762363e-01; -1.734524284746021e-01   -2.147154483888543e-02   +8.973428403295552e-02   +2.494746087823474e-01   +7.629063816875772e-01   +4.681746047729521e-01   +3.343330485739056e-01   +3.140454513834156e-01   +4.818314517237416e-01   -3.408110717629212e-01   +2.668922318768028e-01   +7.587239829652455e-01; +2.144107762094414e-01   +3.378515139662316e-01   +3.413889471652506e-01   +1.038156130190699e-01   +4.626192661850979e-01   +1.059000705381277e-01   +2.416994307506878e-01   +2.677157385555031e-01   +1.621774474640058e-01   +4.843240732957823e-01   +4.908092436571201e-02   +1.665543807018329e-01; +5.019523266438028e-01   -1.185469914247651e-01   +2.971862287311741e-01   +7.077118754361875e-02   +9.945301624567254e-01   +2.028852476909154e-01   -2.242128689691097e-02   +7.079189984937781e-02   +4.007665257478404e-01   +5.161122874896470e-01   +6.500510824957482e-01   +5.963663284829727e-01; +6.280203800686078e-01   +6.291131157326781e-01   +2.137056221610999e-01   -8.252128396813121e-02   +2.273644536428930e-01   +6.790923835597807e-01   +2.369872494993678e-01   -1.721519713143011e-01   +6.633108649861132e-02   +5.206008681933436e-01   -1.556500996915898e-01   +4.781321646125443e-01; +2.445983954162623e-01   +1.638925972363256e-01   +7.922415150648618e-01   +9.513528697041385e-02   +1.438903612665876e-01   +4.012656176154664e-01   +1.750492610871162e-01   +4.343415902844484e-01   +4.956774247475284e-01   +6.468481358724379e-01   +3.950486465789297e-03   +2.061107537074758e-01; -1.822431051881165e-01   +7.361580902250705e-01   +5.098385562290193e-01   -2.988244052270968e-01   +8.160067234045846e-01   +1.784232307599204e-01   +6.230190124253406e-03   -6.899234775922970e-02   +4.881309334138050e-01   +5.350591234221237e-01   +2.268147013581398e-01   -7.431532476483194e-03];
L3I_L2I_iGABA_netcon = [+5.897088032813165e-01   +4.467570511277295e-01   +2.779510786818768e-01   +3.590586894667660e-01   -2.700061446884070e-01   +2.254642643368702e-01   +6.416004849738911e-01   +5.403558891943349e-01   +9.926991122893574e-01   +2.191484070403313e-01   +2.925883878037795e-01   +4.045046361859237e-01; +2.936574097823110e-01   +3.937433248559274e-02   +1.216710652979213e-01   +2.202270009084739e-01   +4.768538701867186e-01   +3.573298858245770e-01   +5.491588628481524e-01   -1.581415219352736e-01   +2.646200439945063e-01   +1.282317585045760e-01   +4.111562886109789e-01   -2.048619788975166e-01; +3.312194434026543e-02   +5.543179476409763e-01   +4.774838976628841e-01   -3.134711490010186e-02   -1.124722930205155e-01   +8.371273701727029e-02   +5.252633380885053e-01   +5.545518559959192e-01   +3.169811491705491e-01   +1.695601216513593e-01   -2.123189679196417e-01   +6.837034656327907e-01; +3.591863502162398e-01   +2.669663348758097e-01   +4.794095728327221e-01   +9.908432508069723e-02   +2.465525033379087e-01   +2.652775774742123e-01   +1.771602737983133e-01   -9.354381831911544e-02   +3.220324721971688e-01   +3.828210891650176e-01   +5.090704511703507e-01   +3.237759004453847e-01; +2.502870847980971e-01   +3.290586499924065e-01   +1.979265192501874e-01   +4.492430491100191e-01   +5.007350105154119e-01   +4.300608724986627e-01   -4.449761247902953e-03   +9.005833059556582e-01   +5.845482456372604e-01   -9.652595535681253e-02   +1.143967818102552e-01   +4.914654961930343e-01; -7.843881123588346e-02   +3.935127559267950e-01   +4.795694367815438e-02   +4.009995018881066e-01   +6.144246063797483e-01   +3.022616872906814e-01   +3.268413911344603e-01   +1.686899779002323e-02   +1.615033298421360e-01   +1.521054459707841e-01   +2.551071859219873e-01   +4.983373633525526e-01; +5.748072871120873e-01   +2.556718561758250e-01   +4.770025344310729e-01   +2.347324890030888e-01   +8.474970630295144e-02   +4.579302667036234e-01   +3.791928748018170e-01   -5.203501840004477e-02   -2.831396065931421e-01   +6.025485949544379e-01   +5.443858844894495e-01   +1.903047854102536e-01; -7.356511940473878e-02   +2.816833036861763e-01   +6.351352049932326e-01   +6.446989418520676e-01   -2.461759126508131e-01   +5.521276471060685e-01   +7.327676907826853e-01   +3.376553911658900e-01   +6.447845046460416e-01   +2.204276936095762e-01   +6.265240601522070e-01   +3.973756736600906e-01];
L2E_L3E_iAMPA_netcon = [+5.551082891013501e-01   +1.222918368851096e-01   +1.522562273541040e-01   -1.193096426272441e-01   +2.615968088030080e-01   +1.314183661921031e-01   +3.899590089650797e-01   -3.893191111338536e-02; +1.312165072913177e-01   +1.007185482546356e-01   +4.440599418941981e-01   +2.613995736790494e-01   +4.507459224425882e-01   -2.661993931589163e-01   -2.087674791469752e-01   -3.808766112215798e-01; +3.967894699192903e-01   -2.138780708470309e-01   +3.311021205430258e-01   +6.706150498261328e-01   +1.316303305242502e-01   -1.190545065967061e-01   +3.012587496359513e-01   +2.554675850453523e-01; +5.097949044642788e-02   +8.079401152821994e-02   +6.117255817568179e-01   +7.819786245181063e-01   +6.153172491695696e-01   +5.458125991816867e-01   -8.761762678587316e-02   -3.817591989313598e-02; +1.902361220709467e-01   +2.427035510105312e-01   +2.902167326101220e-01   +7.419967072581126e-01   +5.774109328141551e-01   -5.571230897084395e-02   -1.212004574600482e-01   +1.067742955388962e-01; +4.136120313228608e-01   +8.511892925681399e-01   +6.365233740928995e-01   +6.050738149819911e-01   +6.444398689207378e-01   +1.130610300052988e-01   +4.926941637150387e-01   +8.310478205473008e-02; -2.783930236099297e-02   +2.957803342588383e-01   +6.472105681352267e-01   -2.229163938143102e-03   -7.337045155630599e-02   +1.290209047014087e-01   -4.995448164474465e-02   +4.215162983910714e-01; +4.562342589720363e-01   +1.709811181363378e-01   +3.840673278022626e-01   +7.127043530831041e-02   +2.872778597324454e-01   +2.644351741999534e-01   +3.377778816378685e-01   +7.330638597577575e-01; +4.866249091420167e-01   +2.639844058830800e-01   +3.353318455958452e-01   +9.889417993106030e-02   +1.591810247721783e-01   +8.307313194176576e-02   +5.527411624918864e-01   -2.735138576905717e-01; +5.359253544031412e-02   +1.010552285021643e-01   +3.510848691063184e-01   +2.416467804964871e-01   +1.627497852755661e-01   -1.380236020570280e-01   +4.016492106600107e-01   -2.507694894778747e-02; +4.438517241345605e-01   -4.699712554126364e-02   -9.880629197905065e-02   +7.997530257517389e-01   +1.907351802263010e-01   +2.566101232800064e-01   +2.741770403732696e-01   +6.033304946280922e-01; +1.223928379050212e-01   +1.000000000000000e+00   +5.916832410160372e-01   +6.130961582113874e-01   +9.163850833463311e-02   +1.181435143024390e-01   -3.280049500253034e-02   +3.769669775593555e-01];
L2I_L3I_iGABA_netcon = [-3.222390614515845e-01   +8.202757549476680e-02   +5.358702543055025e-01   +5.212724263191274e-01   -1.959430737915003e-02   +6.382417596316892e-01   +2.552636128544246e-01   -4.342881304404587e-01; +6.011447485216322e-02   +2.483133174563730e-01   +4.206407452793116e-02   +1.593832558472192e-01   +2.585520055122084e-01   -1.554666063594855e-02   +3.801771314877795e-01   +1.713264042440348e-01; +7.721555718406752e-01   +6.577336441865130e-01   +9.289710102109368e-02   +5.715131597762543e-01   -5.022468693081197e-03   +9.524696022837539e-01   +3.961579613714241e-01   -1.365685752893237e-01; +1.144874156202139e-01   +3.314104891588593e-01   +6.623959272292982e-01   -2.481852007382827e-01   +1.765004625382969e-01   +6.077290469773464e-01   +1.226684799313118e-03   +6.163578496765022e-01; +7.020476965670994e-01   +4.308991846578146e-01   +1.350988119219107e-02   +3.641128654147393e-01   -1.992172133023439e-01   +2.355951732588614e-01   +2.335340296899425e-02   -1.284710628520689e-02; -2.098339562636767e-01   +4.371651001438471e-01   +6.188051222357728e-01   -3.248701498618750e-01   +3.958688796276245e-01   +8.020218745715151e-01   -1.376260765443958e-01   +1.189028824706697e-01; +6.503766878136439e-01   +1.735020405067243e-02   +3.038445073392113e-01   +1.134960074825524e-01   +1.800935448148093e-01   +5.460155554154512e-01   +6.951014154908233e-01   +3.833680133115395e-01; -1.945481376090328e-01   +7.209417521277489e-01   +1.487111855373320e-01   +2.295602548642110e-03   +2.420799480944438e-01   +1.277951678978791e-01   -9.666634862183782e-02   +7.874534157778202e-01; -7.457132911366100e-01   +6.953138365669601e-01   +6.830352118380493e-01   -3.032518959098816e-02   +2.264872724646219e-01   +3.952308647451123e-01   +3.656933928176412e-01   +4.153626030802380e-01; +4.587421035589388e-01   -3.087010903701490e-01   +2.457608714829987e-01   +1.956644597613292e-01   +4.316078861373236e-01   +6.066587238678001e-01   +5.436517196575438e-02   +4.306901489560017e-01; +8.981466021167530e-01   +2.876570291182927e-01   -2.484875856227286e-01   +1.383586682342378e-01   +4.601051684677664e-01   -4.777517206500224e-02   +4.853246093395791e-01   +9.460471263548340e-01; -3.806142447455530e-01   +6.444348478235747e-01   -3.720198412130697e-01   +6.884273594795750e-01   +7.621825585629572e-01   +2.022420056885628e-01   +2.917215296082717e-01   +2.924255695984927e-01];
L3I_L3E_iAMPA_netcon = [+3.521471101528171e-01   +6.061361250007494e-02   +1.851704377934070e-01   +4.762825812778808e-01   +4.564125913273994e-01   -3.450123241787593e-02   +2.175290696814376e-01   +1.392517116533185e-01   -3.278342363858783e-01   +4.992727842814342e-01   -4.192091984651264e-02   +5.883065468559155e-01; +1.826591900612524e-01   +1.879135888077144e-01   +3.303185470430256e-01   +6.347106866384171e-01   +5.010339377149036e-01   +2.385672142812146e-02   +2.089574279154075e-01   +3.176245081280935e-01   +5.194231718407387e-01   +2.137017883202501e-01   -7.422319337983706e-02   +1.925043329479514e-01; +5.256182001185151e-01   +5.036189273044750e-01   +5.969408739746653e-01   +4.580046026389706e-01   +8.429302643116379e-01   +3.895280361318871e-01   +6.230460464862806e-01   -2.503004192242952e-01   +3.250212645401722e-01   +3.726880887751257e-01   +1.752493749996837e-01   +4.936230118324867e-01; +4.734973967638115e-01   +5.850846723489703e-01   +4.333581232970227e-01   +1.558036581375445e-01   +1.110450833895328e-01   +8.865946999479611e-01   -2.535444603104439e-01   +3.546757363681831e-01   +3.580219549583576e-01   +3.920301612789998e-01   +1.125289415916098e-01   +2.600222512735217e-01; -1.682026183472309e-01   -1.155268167016151e-01   +8.182990394676010e-01   +1.915780652980336e-01   +5.792305340436321e-01   +3.747779521537055e-01   -1.093525033871929e-01   +4.667411387496879e-01   +6.370200146818616e-01   +7.588270141389135e-01   +2.552938380811943e-01   +3.556519970814188e-01; -3.253784605766202e-01   -4.079583849742899e-02   +1.705416634148339e-01   +1.045002901968002e-01   -6.271886994600501e-02   -1.533619933846459e-01   +3.661923187064324e-01   +3.397035014138490e-01   +1.093842377339851e-01   -4.027746775338718e-02   +2.561588803696093e-01   +3.305625314459973e-01; -2.177390470028976e-01   +1.586863017859096e-01   -1.608423475368708e-01   -1.247399635698320e-02   +6.122159917447041e-01   -9.659284701108735e-02   +5.482811215109030e-01   +5.634406923390110e-01   -1.231790286212837e-01   +4.497822171586375e-01   +5.365001171756303e-01   +1.727865837294635e-01; +8.039912866369105e-02   +2.435745008884355e-01   +2.817769589408690e-01   +1.477483163486926e-01   -7.801577521467998e-02   +1.888874557079345e-01   -8.772926581869959e-02   +5.777192365991576e-01   +6.012883978835698e-01   -3.950118097407155e-01   +1.031678331809439e-01   +5.169661920086965e-01; +1.606191564300799e-02   +8.273380697153504e-01   +6.707382660385498e-02   +1.345111576679067e-03   +2.688647531168114e-01   +7.751881657507895e-01   +1.522200543334722e-01   +5.977757411989256e-01   +1.203397755291680e-01   +2.701713879620701e-01   +6.833100095305151e-01   +9.100251732753567e-01; +8.306081510202583e-01   -5.514947919154849e-01   +9.845550312879116e-01   +3.516742552858870e-01   +2.940119867029934e-01   -3.174226333004801e-01   +4.878811457156347e-01   +1.920555200155287e-01   +2.402451410425769e-01   -1.920678748023225e-01   +8.946650429077486e-01   +1.594352057688711e-02; -4.315743644120106e-01   +2.418997034372378e-01   +7.342552827683233e-01   +5.887849926049633e-01   +3.714217024193986e-01   +1.325863564809329e-01   +2.995644798794101e-01   +4.071061784174878e-01   +9.460149323202142e-01   -1.076065124685355e-01   +1.429355116418285e-01   +4.559931035975317e-01; -1.832895661435304e-01   +2.050905050228900e-02   +2.933239318229061e-01   +7.761051584163194e-02   -3.655399104262753e-01   -1.887972917845528e-01   -9.741221436378403e-02   +2.208352946076956e-01   +6.755964155308638e-01   -4.002515826675640e-02   +4.039918665869931e-02   +3.697780926645103e-01];
L3E_L3I_iGABA_netcon = [-1.868482619202501e-01   +2.207592723754669e-01   -9.401954030881440e-02   +3.374086841552149e-01   +2.908359655743477e-01   -4.218518287620815e-02   +8.074790106873586e-02   +1.932160433147555e-01   +2.111829790420829e-01   +2.582546892151119e-01   +4.532975837614684e-01   +1.385563254029858e-01; +5.026670014992151e-01   +2.232411392955720e-01   +1.339650695840657e-01   -2.020917654740959e-01   +2.333107892210784e-01   +4.939499150423849e-02   +1.752719473854840e-01   +3.389053250935590e-01   -1.636127972734951e-01   -2.079228322080053e-02   -4.615778900449125e-02   +2.378496263014342e-01; +4.889379209343882e-02   -6.824844023732355e-03   -2.304561656598338e-01   +1.079241913349761e-01   +2.744386478997557e-01   +1.972811212217284e-01   +1.949051634016133e-01   +2.349693572588642e-01   -1.187174145000122e-01   +4.198596716046490e-01   -5.454690089953275e-03   -1.515296064009611e-01; +2.671689910343834e-01   +4.133124930220319e-01   -3.066901218952736e-01   +3.514477417165731e-01   +7.693260115448523e-01   +1.477757291553343e-01   +9.900844059871501e-02   -5.681298786947506e-03   +7.850840461461096e-01   +4.745054673499586e-01   +1.071713341179135e-01   +2.126525107731853e-01; +3.068919670175218e-01   +3.678861780535015e-02   +9.146967285872100e-02   +4.040586895576515e-01   -1.345583753501075e-02   +2.448266154545939e-01   -2.803369844492136e-01   +5.488632380413881e-01   +2.103035518865322e-01   +3.913989111330875e-01   +4.036586578519548e-01   +4.077514510830091e-01; +4.586451870131099e-01   +6.640004714992676e-02   -7.037813332781014e-02   +8.079267508506878e-02   +2.430698363011866e-01   +1.102896852439095e-01   -7.514990601236048e-03   +3.445566928594812e-01   +5.293481987969046e-01   +4.219812035536691e-01   +1.239354444145719e-01   -2.680013150398325e-01; +1.270069615839148e-02   +1.826179441740345e-01   +5.888182511389459e-01   +1.000000000000000e+00   +2.238488839569216e-01   +2.257802964194810e-01   +7.130242375155164e-01   +4.391714249801078e-01   -9.315758872294688e-02   +5.167813002800575e-01   +5.574358384382903e-01   -5.846074502292826e-03; +2.548208544766213e-01   +1.046637618043038e-01   +6.032246569152840e-01   +6.784360849269253e-02   +2.928728778485512e-01   +9.420264618572483e-02   +1.467244794800387e-01   +5.156274384887672e-01   -1.612184981333612e-01   -4.275470092023384e-03   +3.289654142803589e-01   +4.729865698758406e-01; +1.259692530213082e-01   +2.153779371936198e-01   +2.097566005815526e-01   -2.270049758702630e-02   +1.768032255779134e-01   +7.892296727440822e-02   -2.728096425788892e-01   +3.067676117275743e-02   +4.535232517786102e-01   +5.448609200424174e-01   +5.953027922239266e-01   +5.189897493442640e-01; +4.786996174394248e-03   +3.267607550434712e-02   +4.481038641283493e-01   +1.943494831342805e-01   -4.262444011165323e-01   +3.295124240358620e-01   +3.275921961386982e-01   -4.448871127582307e-02   +1.373945676780716e-01   +1.029161264792335e-02   +1.242612426207447e-01   +2.949003510605413e-01; -4.830390237426688e-02   +1.433314712773388e-01   +4.798227127583248e-01   -3.357564664348728e-03   +1.750495609589227e-01   +1.289787247439827e-01   +3.618822518489365e-01   +1.883105563147369e-01   -1.066354721044289e-01   +2.250159441245665e-01   +3.050928457572568e-01   +2.015407348339451e-01; +1.846543598901584e-02   +3.679838811673269e-01   -8.938703724253369e-02   +1.333973602560060e-01   +8.291455722847536e-01   +3.570417501800466e-01   +4.683136647492102e-01   +2.564621131281880e-01   +4.761300206843133e-02   -2.459385698212165e-01   +2.425944271350114e-01   -6.169756449742227e-02];
L2E_Input1_iAMPA_netcon = [+6.195818053872064e-01   +6.734090562673972e-01   +7.842798336367449e-01   +8.859543209615188e-01   +7.308203235943562e-01   +7.799890888993176e-01   +7.161654683023406e-01   +7.164632263177736e-01];
L2I_Input2_iAMPA_netcon = [+6.157513567312597e-01   +5.225371919093831e-01   +8.396727949634518e-01   +8.778958879954923e-01   +1.668826965495253e-01   +8.777024178948524e-01   +1.966786555849377e-01   +1.338318215746445e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last =  11.21 * ones(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.2*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.2*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.2*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.2*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.2*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.2*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.2*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.2*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
