function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-2.031297623673801e-01   +5.755416913210448e-01   -3.946119035796278e-01   +2.544849705519087e-01   +9.814558260346161e-03   -4.069731901020204e-01   +2.124715947969225e-01   +1.392520095355376e-01   -5.633643871127442e-02   +3.552644882231891e-01   -2.194924198320852e-01   -1.202334363244110e-01   -4.452653661677308e-02   -6.739646336647205e-01   +7.816694776590180e-02   -2.031941619763281e-02; +7.101390796282497e-01   -3.433672732502749e-02   +5.537699111112421e-01   -4.254800954179726e-01   +3.479704028594557e-01   +4.961411383037980e-02   -3.589625976298443e-01   -7.853877358353283e-01   -4.379470946735634e-02   -5.993210342285769e-01   -2.019646978350260e-01   -6.983920508105887e-03   -7.855975745936683e-01   -3.347772851303137e-01   +7.333084828087868e-01   +3.713692196085390e-01; +3.502386802608159e-01   -8.653925282850812e-03   +4.284250933519275e-01   -1.755549570316294e-01   -4.674137297827745e-01   -1.895090101213351e-01   -4.662929413319407e-01   -2.327870567637272e-01   -4.322682871905733e-01   +4.509051766223396e-01   -4.784506272385107e-01   -2.958000291352518e-01   -4.453178465835648e-01   -1.404887333787243e-01   -7.025245022405511e-01   -4.884447571087194e-01; -3.124052073205733e-01   +6.429866628229089e-01   -5.519389937271187e-01   +1.510828442647406e-04   +4.404577234650194e-01   +4.008690982396279e-02   +4.533733878504749e-01   -6.160797759083506e-01   -4.225997078795352e-01   -3.368938260001828e-01   +4.010649686786555e-01   +3.110312556916624e-01   -2.554966609931960e-02   +8.839135383881405e-02   +1.284358443641867e-01   +2.933440444430837e-01; +1.541935208193360e-01   -8.142011896380948e-03   +4.192997805311948e-01   +5.716398521508285e-01   -3.735464984714774e-02   -2.702373211542022e-01   +1.841903757279142e-02   -1.603493468214983e-01   +5.750914280808870e-01   +7.238888710043873e-02   -1.964785534072161e-01   +5.352126212307385e-01   -3.195706641387980e-01   +7.088894909121576e-01   +3.513702122767626e-01   -9.857394847802653e-01; -6.748531766160600e-02   -5.256388462166225e-02   -6.748966869172380e-01   -5.462139374668739e-01   +1.971625946181825e-01   +7.051914682251998e-01   -1.737053856400624e-01   -3.673776954933557e-02   -6.056716978206390e-01   -3.270405849220889e-01   +5.605433723671462e-01   -7.323064393510363e-01   +2.646612386111021e-01   -1.357109922357837e-01   +3.593695023226232e-01   -3.556361993220221e-01; -2.902787427021848e-02   -7.041292858551951e-01   -6.988880059777614e-01   +1.576137807491923e-01   -7.376215711567946e-02   +7.052710467791693e-01   +4.497960764270778e-01   +5.738364823934584e-01   -5.763107957147880e-02   +4.002268981469032e-02   -1.756119668196011e-01   +5.497412961193331e-01   +3.633128364374118e-01   -1.021157810234765e-02   -2.401223785405295e-01   -5.150580966868138e-01; -4.173271689347702e-01   +2.344492206061339e-01   +1.736974946190707e-01   -3.452542461370363e-01   +4.474933435391385e-01   +2.241540469308215e-01   -3.830154920295158e-01   -8.463089889515579e-02   +7.383904970706696e-02   -3.132150605581024e-01   +6.568637091280638e-01   +1.168178292798333e-01   -1.576100041065071e-01   +1.903315599064412e-01   -5.819947931129476e-01   +1.904152999398830e-02; +1.449358824559930e-01   -1.918618466837183e-01   -5.447433297854382e-01   +2.486561507783201e-01   +4.195340351365275e-01   -1.598493080266725e-01   +1.712489846401870e-01   -2.713890831630996e-01   -3.404760956939635e-02   +5.771856782445185e-01   -5.158366408677975e-01   +6.040083105284865e-01   -2.896216761436292e-01   -8.108725434268147e-01   -1.077888909656095e-01   -1.521647300778779e-01; -7.679046455994912e-02   +2.235524150940719e-01   -4.162978652518841e-02   -2.201922520051526e-01   +5.829294586376075e-01   +3.598924844743350e-01   +3.922412473969686e-01   +3.985273926121415e-01   +4.682603005130372e-01   -3.754712455449932e-01   +1.631758056333880e-01   -8.807582158263184e-01   +1.496493001619407e-01   -1.886581098615592e-01   -5.017988614397962e-01   +1.205107699360153e-01; -5.263227593192822e-01   +6.934023005139806e-01   -3.526076776746331e-02   +5.116904978882689e-01   +1.692244721210321e-01   -1.035045698479075e-01   -4.789774823196487e-01   +1.076637803593863e-02   -6.820607780995620e-01   -2.624807273157074e-01   +4.199872960912732e-01   -6.339868414464136e-01   +4.997933242880506e-01   -6.341574553052141e-01   +6.687168279828182e-03   +5.002409156567236e-01; +4.848048894744393e-01   +1.085090091335264e-01   +4.793477455343644e-01   +5.173073679070996e-01   -2.062722679506382e-01   +2.926088075832993e-02   -3.544480925409416e-02   +8.240084812901682e-01   -3.332903023861184e-02   +2.223135733883632e-01   -2.077836636631757e-01   -4.537486018839918e-01   -7.115558153253247e-01   +1.000000000000000e+00   +4.805357390565682e-01   -2.859645854891130e-02; -1.837231542081296e-01   -6.873489059437609e-01   +1.931178554469223e-01   -3.990831555237525e-01   -5.801700709204404e-01   -1.233262712713740e-01   +1.999615778926820e-01   -8.443629262668756e-01   +4.127441692492954e-01   -1.365396081225963e-01   +3.323583433798042e-01   +5.131644819082867e-01   +3.460875569995573e-01   -2.613115742052952e-01   -8.103239935266180e-01   -3.240053732181589e-01; -2.727663257040354e-01   -4.464354432413458e-01   -4.586063485337710e-01   -6.468486862528602e-01   +4.631318863927324e-01   +4.641425943370450e-02   -2.315592564436445e-02   +2.094707548947063e-02   +4.180219164215839e-01   +1.379415697379945e-01   +1.760677155996603e-01   -2.272408460391613e-02   +1.091425314323612e-01   +3.196863433038685e-01   +2.398536709234217e-01   -5.005265761472013e-01; -2.852346644785030e-01   +5.059639252688914e-01   +9.406710053644142e-02   +2.031063486730420e-01   +2.082393318569046e-01   +5.946124348223055e-01   -6.077298894153761e-01   +1.803017015522033e-01   +6.076258269838313e-01   +4.033802486201538e-01   -3.168178765362798e-01   +2.942775417911592e-02   +5.161591577216619e-01   +4.256611491948175e-01   -4.092252015696555e-01   -2.172482804504612e-01; +4.307284739234490e-01   +4.346516070565324e-01   -6.774484408480201e-02   +1.504906747135801e-01   +4.824782396624567e-01   +6.096701233504378e-01   -2.675404110495025e-01   +4.328429832794874e-01   -1.726089403987066e-01   -1.456189930514953e-01   -2.169592509032211e-01   -1.998930649403408e-01   +7.974003507187871e-02   +2.773124504409420e-02   +1.699246673724669e-01   +3.282181310316946e-01];
L1E_L1I_iGABA_netcon = [-6.306170966453912e-01   -1.925467708023316e-01   -8.185384141875490e-01   -9.860400012245471e-02   -2.482256283443195e-01   +5.421738581737071e-01   +4.476541885285890e-01   -4.344118238257307e-01   -5.267304446910508e-01   +5.532775264515291e-02   -1.540177212324975e-01   -3.989586107866856e-02   +1.461450508022486e-02   +5.098442257088442e-01   +3.256788162114115e-01   -7.223082154808078e-02; -4.312572305615756e-01   +6.539610654200135e-01   -3.413815261113046e-01   +1.443055313889484e-01   -1.853717353898211e-01   -7.147906685828656e-01   -4.762399278406224e-01   +2.620741811825633e-01   +7.095571686459681e-01   +4.681983888285904e-01   +8.512622597306380e-02   -6.136480935171073e-03   -1.202195863940270e-01   +5.870189800556626e-01   +1.464213199878686e-01   +3.366032162352924e-02; -1.299378075211729e-01   -1.452241919994872e-01   -3.549684982745012e-01   -6.867958838806966e-01   +4.493479718558094e-01   -6.867289659186566e-01   +1.316349939101380e-01   -7.051576886618977e-01   -4.369099981375230e-02   -8.483914973415156e-02   -3.950064093621695e-01   -8.291437455725413e-02   -6.451056293431504e-01   +1.000000000000000e+00   -1.769955566228732e-01   +5.151380567901445e-01; -5.412081109111794e-01   +2.497560091915346e-01   -1.546768728719050e-01   -2.062035769361822e-01   -3.536572653842009e-01   +5.127144300354654e-01   -3.771066279920966e-02   +8.366667455344626e-03   -9.200984786439188e-02   +1.551870863572499e-01   +3.143337792717472e-01   +4.525503789965407e-01   +7.750007584757308e-01   -2.911195049989737e-01   +3.043975306253990e-01   -1.023141749388165e-01; -8.218404615918162e-01   +2.547116719559819e-01   -6.937302745733956e-01   +7.214540412560895e-01   -6.053184297982543e-01   -1.754734607453355e-01   -1.583242810396782e-01   -7.422189413477848e-01   -4.184312957187492e-01   -4.034478133976498e-01   -4.499104227733247e-01   +6.286523350764999e-01   +2.361882971873299e-01   +3.178903232228999e-01   +3.906634584136383e-01   -1.598738600575257e-01; +2.017340950225374e-01   +1.012483236848418e-01   +1.062643262940996e-01   +1.276557526810140e-01   +2.921123355192459e-02   -8.867163597829077e-02   -1.881679267686660e-01   -2.860031362067494e-01   +4.446078350603637e-01   -2.346806756974615e-01   -1.843143559537304e-01   -5.593459624521491e-02   +6.343490509406530e-01   +1.642552988233558e-01   -7.492152201080844e-01   -4.754053118249494e-01; -4.644602088518516e-01   +1.493157562167441e-01   -3.544951461127778e-01   +5.395222948106665e-01   +1.653991661355069e-01   +9.607239793408988e-02   +8.148668901267037e-01   -7.392911589583812e-03   +1.487444764589681e-02   +5.794362420209085e-01   -4.849273891134238e-01   +1.162979535208826e-01   +3.855118746891767e-01   -4.284500252561084e-01   +4.316279031259513e-03   -5.628407589144164e-01; +2.288081295975685e-01   +1.087726119954420e-02   -2.204244280495397e-01   +6.220758007413165e-01   +8.329661287585730e-02   +8.893256220661415e-01   +3.752572935555750e-01   -2.936818922541376e-01   +1.476539103895427e-01   -9.244233250237378e-02   -1.418407620516290e-01   -1.905662024079779e-01   +2.152671802247181e-01   +1.051695888366673e-02   +3.478626623671846e-01   +4.441985452356513e-01; +9.799058247360780e-02   +4.628325551397143e-01   +5.770950190161566e-01   +1.521853722221936e-01   -2.667802066848355e-01   -4.691981839641644e-02   -3.769316425390113e-01   -2.797694456640739e-01   -2.768523871390686e-02   +5.274035518933919e-01   -5.800410599293547e-01   -4.269911945051081e-01   +2.709664987521946e-01   -2.362314997296157e-01   +1.702510873266619e-01   +4.128366394809707e-01; +3.843488881092830e-01   +6.633766889020671e-01   -2.065254937660604e-01   +3.696482084236466e-01   -2.011057822299668e-01   +1.273444686603045e-01   -1.446385649217583e-01   -7.834524400207848e-01   +1.180316430721222e-02   +2.169249671125675e-01   -8.776929378367639e-02   +4.034236550429358e-01   +3.324419305932643e-01   -7.988984902036439e-02   +3.022555523802585e-01   +5.222310530058650e-02; -6.841336950324232e-01   +3.933079493529977e-01   +6.112315425681811e-01   -4.645241713740271e-01   +2.126269195216616e-01   -5.378183415159529e-01   -1.122647538696580e-01   -6.727989844243766e-01   +6.607395005265407e-01   -2.231357002460207e-01   +5.718918210313083e-01   -4.732164976163281e-01   +8.490053491548845e-02   -4.414596680813048e-01   -6.525713142336648e-01   +5.144005010427842e-01; +3.829449390131101e-01   +3.734841010206943e-01   -5.190244925285059e-01   +5.419931599859151e-01   -6.888044594309404e-01   -1.294695630019342e-01   -4.185937011074435e-01   +6.989476814245892e-02   +7.315379118450487e-01   +5.973328816345875e-01   -6.071676061088811e-01   -3.975023954594064e-01   +1.482876134999747e-01   -2.905958286466966e-01   -1.441072165865731e-01   -7.400733598004300e-01; +6.583170274540727e-01   +5.698074926896841e-01   -1.996222027793640e-01   -7.886883438017964e-01   -5.394679640884072e-02   -5.855386541754302e-01   -7.049556269124688e-01   -6.537070714538198e-02   -3.936806128256189e-01   +1.970644468728447e-01   +4.953160700095487e-01   -5.699620225699369e-01   -6.360194371387842e-01   -6.306551532931118e-01   +1.367593135631082e-01   -1.092319793015513e-01; +2.040138859528338e-01   -6.483464705817789e-01   -5.308849215862106e-02   +5.971642518731417e-01   -2.188358980544908e-01   -4.065927370505875e-01   +7.240763448182298e-02   +4.444439686101604e-01   +6.283669594683314e-01   +4.900624599979689e-02   -7.440002626718624e-01   -7.604970222209568e-01   -1.958342025186447e-01   -2.394241095076788e-01   +6.529023750861579e-01   +2.801562398258564e-01; -4.586025099399409e-01   -3.114375319392008e-01   +5.384108318234426e-02   +5.422756855138856e-01   -7.536546449545815e-01   -3.163686777872728e-01   +2.219311131375160e-01   +5.172320670983311e-01   +2.811547289506345e-01   +4.064371152624307e-01   -2.776175251644764e-01   +6.883859020336145e-01   +2.582046138873907e-01   -5.025326800196864e-02   -6.606040421978439e-01   -4.684393229679171e-01; +3.485727083649620e-01   -3.986208155257980e-03   +1.030693804681752e-01   +1.639476607925913e-02   +4.354557252175512e-02   -3.265282395540320e-01   -1.894493761375875e-02   +6.539728252601534e-02   +4.933043609352916e-01   -4.476839112514878e-01   -4.172059134583506e-01   +2.652124682217451e-01   -5.278119715084552e-01   -9.322044895283674e-02   -2.514321510032665e-01   +7.855083241355758e-01];
L2I_L1I_iGABA_netcon = [-1.520313941973097e-01   +4.544686025698118e-02   -3.651593469620992e-02   +4.420960682146318e-01   -6.690858527886819e-02   -5.891412258473897e-01   -4.751591263550767e-01   +5.484840669288524e-01; -3.764477417492913e-01   +1.785392654609884e-01   +5.173834103535829e-02   +1.406381631058305e-02   -3.577874604559317e-01   +6.126437834561166e-01   -1.859578606167936e-01   -2.895055739736579e-01; -1.955892784016657e-01   +2.650669745596627e-01   +2.766356084099016e-01   +7.435354065558445e-01   -7.066889041668417e-01   -4.338655839876422e-01   -2.938917045697764e-01   +3.188003388235521e-01; -5.864435698458740e-01   +1.911806813604861e-01   +2.347496027414024e-01   -3.622453728222015e-01   +3.304544517574248e-01   +1.928467377894966e-02   +2.604668381178250e-01   -4.325736827778084e-01; +1.867950522533966e-01   +1.000000000000000e+00   +3.309721826975658e-01   +4.185031831736352e-02   +1.721817852470944e-01   +2.706402651608734e-01   -5.582503831995149e-01   +1.006250829902565e-01; -7.645652933524673e-01   -4.768634307216544e-01   -1.602804826149725e-01   +5.924250645486775e-01   -2.690332905786738e-01   +5.423454770456779e-01   -3.221755894116293e-01   -1.580043436208142e-01; +1.907813459303015e-01   +4.020843478402025e-01   -3.533078658825937e-01   -3.585922776308436e-01   +6.260671323651019e-01   -6.971825260699444e-01   -6.996927819626797e-01   -4.833139869749766e-01; -1.885838965968605e-01   +2.467532364327265e-01   -8.795853785335747e-01   -1.798791971437064e-02   -5.935301338498923e-01   -3.229536538849379e-01   +2.291260853636971e-02   +5.568453264498967e-01; +1.526261319352480e-01   -7.412932273402268e-03   +4.955947282458785e-01   +7.040258077152041e-02   +3.894535085395870e-01   +6.129180395070145e-01   -1.545810947512375e-01   -4.687923589582416e-01; -1.707026843607171e-01   -1.730568261457089e-01   -6.351418046302444e-01   -4.780944429492706e-01   -5.785453705455955e-01   -4.904771846742844e-01   -2.688524518903097e-01   -1.012696670951689e-01; +3.460216013014502e-01   -2.006238466461328e-01   +3.344719227345893e-01   -1.733663477247450e-02   +5.164163577632223e-01   -4.188629269140856e-01   +4.291009157761454e-01   +3.072752635372105e-01; -1.223799550674556e-01   +2.623588983466723e-01   -2.592643437788062e-01   +3.442585199487903e-01   +1.629672570893975e-01   -5.314305265475205e-01   -6.040281126852209e-01   -5.371888864660339e-01; -2.369585732316372e-01   +6.864266157798815e-01   -4.200404476176412e-01   +1.422255670805686e-01   -1.466719725692185e-01   -3.873371569387168e-01   -3.825701081288456e-01   +9.082937381707680e-02; +2.950884001864104e-01   -2.769907532169080e-01   +2.915419405502206e-01   +1.514275637053466e-01   -5.989555266191668e-01   +5.494520916932764e-01   -7.336242360479305e-04   -3.578666232520407e-01; -7.447892957004240e-01   +4.346142307648910e-01   -4.881433121587993e-01   -5.230325649623035e-01   +9.089404677188982e-02   +1.192957709482093e-01   +4.467427368207254e-01   -6.648539329540474e-01; -1.239380836087118e-02   +9.089897920530934e-01   -7.980685808179863e-02   +5.429374890027870e-01   -4.045189842047067e-01   +6.262625244444819e-01   -1.649239119823635e-01   +6.449820057733393e-01];
L1I_L2I_iGABA_netcon = [-2.852004022423438e-01   -8.755206575177333e-01   +5.190722422587442e-01   -1.705939860399479e-01   +7.936094659855497e-01   -7.320239181096402e-01   -3.516819776360551e-01   -3.275589839695183e-01   +7.358649880421978e-01   -3.015332340597279e-01   -2.905268307903134e-01   -2.685919599553421e-01   -2.837387720023647e-01   +2.952594022117139e-01   +3.784047094534128e-01   +2.189307047529208e-01; +9.483294740617158e-02   -1.272875635927006e-02   -2.559645171737581e-01   +2.037080000803083e-01   -2.696809910858039e-01   -1.978840479796895e-01   +5.632829494798869e-01   -6.883551456443333e-01   +5.426594968345336e-01   -3.955072562900494e-01   -5.758585275907565e-01   -2.131906336718272e-01   -7.084126442113680e-01   +6.772459496123964e-01   +5.234710411272293e-02   -7.009608011355701e-01; +5.958116041720404e-01   +4.046956374625951e-01   +7.455183938426321e-01   +1.000000000000000e+00   +6.306919867420143e-01   +7.596630950019230e-01   -1.732867699645922e-01   +2.378244668241538e-01   +4.700131400436158e-02   -6.565491515734428e-01   +8.975098328122662e-01   -2.748996212695885e-01   +6.733151542640912e-01   +5.615733482919100e-01   -3.221639026863846e-02   +4.868446432136879e-02; -7.454642911569520e-01   -7.819791251940503e-01   +5.720605818198936e-01   +4.700822702646711e-02   -3.142987902640145e-01   +4.668778431986889e-02   +3.461893537708627e-01   -6.368313551075833e-01   +3.975243367282982e-01   +2.953656541838823e-01   +5.124369169346886e-01   +7.588124334449182e-01   +2.882770006297439e-01   +3.189265559508795e-01   -3.206438370345895e-01   +3.694249500569864e-01; +4.725945739115883e-01   -4.878711487547301e-01   -4.729849499418539e-01   -7.018265704794260e-01   -8.632629795544802e-01   -2.869712879379760e-01   +5.388642345347101e-01   -7.722612682376715e-01   +9.454808215175790e-01   -4.726514184074087e-01   -2.820149174063710e-01   -5.920300105138701e-02   +2.452157254690958e-01   +5.659988143402529e-01   +4.497498132421782e-01   +8.639940547399291e-01; -3.581866011408890e-01   +3.823191754132025e-01   +7.877784719708215e-01   +3.681999269897226e-01   +2.957613269690188e-01   +1.477738492927373e-01   -9.138303604032914e-02   -4.783285591074544e-01   +3.440569435190825e-01   -3.101113906365223e-01   +2.632101958816507e-01   -7.140623446620087e-01   -1.613441583180167e-01   +1.074734742085851e-01   +5.536434201802972e-01   -8.032120950525173e-01; -6.897770092621811e-02   -2.290866558117066e-01   -4.535263791893247e-02   -1.877274297414420e-01   -3.067195516840305e-01   +6.369159673804897e-02   +3.840661739266584e-01   +5.448238925171964e-01   +4.433410233643202e-01   -2.031337279483046e-01   +8.066625945417182e-01   -9.139570767570779e-01   -4.523571892376132e-01   -5.304060044855471e-01   -5.667178901471364e-01   +5.344197693313243e-01; +8.870107954816926e-02   -1.418685333012925e-02   -3.099418459772584e-01   +5.204420394878843e-02   -1.684227163655040e-01   -2.024302352574773e-01   -3.093487745302546e-02   +2.718354299967343e-02   -2.371185663507356e-01   -3.289347150836097e-01   -2.010109140313656e-01   +3.897549352015694e-01   +2.450122177613282e-01   +7.587547735427942e-01   +6.121506318078170e-01   -1.006500243295301e-01];
L2E_L1E_iAMPA_netcon = [+1.551214395766738e-01   -6.242932381193884e-01   +5.084335931029442e-02   +1.335569775972416e-01   -1.414421193019217e-01   -5.176408890613465e-01   -4.269179047766830e-01   +6.044589020366629e-01; +3.568114658362268e-01   -5.658450532286656e-02   -1.325828493580582e-01   +3.822650241307204e-01   +3.859004703372642e-01   -4.744513710444979e-01   +4.834574550132956e-01   -6.626053951751236e-01; -7.972540692840465e-01   +3.852419043809147e-02   -5.033331512715641e-01   +4.179410410675616e-02   -3.276375416477486e-01   -5.515318906208648e-01   -7.020492887945075e-01   -6.777045543691985e-01; -2.099059877579813e-01   +9.270861456161304e-02   -3.505650835457480e-01   -1.397539474818515e-01   +3.690631811806850e-01   -8.029337605128656e-01   -2.561558378916319e-01   -4.052397684376517e-01; -3.738941784870617e-01   -6.788032619572346e-03   +1.108846638548972e-02   +5.551001438498351e-01   +3.137637584168008e-01   +4.422796934616884e-01   -4.402281171519809e-02   -9.724564663094254e-01; +6.016628107666948e-01   +1.258249034537703e-01   +1.114540031829848e-01   -2.757867483188378e-01   -4.714505396625809e-01   +3.473064880870100e-01   +9.909989883794455e-02   -4.275132251832196e-01; +3.598558938011104e-01   -6.228464221390786e-01   -2.542479512251630e-01   +2.494077783928086e-01   +5.093931936341247e-01   +1.097539458908204e-01   -1.000000000000000e+00   +1.697628779954426e-01; +4.296739400624929e-01   -3.686371060280530e-01   -2.082110951100090e-01   +3.077178144233735e-01   +2.879293227841778e-01   -7.227970152760631e-01   -1.057665857138389e-01   -3.421002085028544e-02; +4.898645070915777e-01   +4.814926994224624e-01   -3.872179295728748e-01   -7.161540518290152e-02   -6.634368513783774e-02   -4.775451286222562e-01   +2.481817004638004e-01   +1.338986400919847e-01; -2.947276167820160e-01   -3.371931602214768e-03   +3.300944551238769e-01   -3.908153235970201e-01   -6.501228895909985e-01   +3.852986788661102e-02   -9.146753655289368e-02   +4.951034685485410e-01; -3.495430626655812e-01   -2.694830272725605e-01   +6.650026009777029e-01   +5.415566831416194e-01   +5.797598592511952e-01   -3.974375881147276e-01   +1.780771546107165e-01   -5.562736079088010e-01; -2.675145925181160e-01   -7.136801695153498e-01   -4.579864338616272e-01   +7.283730201396944e-01   +9.010038639149537e-02   +3.371770514161786e-01   -4.125959595984235e-01   +4.523581866628134e-01; +1.827909096225431e-01   -3.510306758161978e-01   +2.882711059443265e-01   -8.622774640481203e-01   +6.785059810651893e-01   +6.305816818964813e-01   +1.064237140432571e-01   +7.276908735467069e-01; -8.986333844555830e-02   +3.595701860854560e-01   +7.014737424525259e-01   +4.904399864565512e-01   +4.866739948364912e-01   -6.550700081838865e-01   -5.270169502314934e-01   +5.563063140634196e-01; -3.238505026524205e-01   -4.910590714235740e-02   +1.365618655822842e-01   -2.118972046162438e-01   +6.451925412839816e-01   +2.234092011247286e-01   -9.415320412500248e-01   -2.802631979352505e-01; -1.984682994748364e-01   +7.191944588216754e-03   +3.102224588491558e-01   -4.921348303010281e-01   -5.970328419056075e-01   +5.537547335080006e-01   +4.067363847807626e-01   +6.900686087729250e-01];
L1E_L2E_iAMPA_netcon = [-9.470140447345524e-02   -7.651806840771693e-01   -4.812528432555287e-02   +3.861186554075166e-01   -5.554279603460532e-01   +4.336344740211303e-01   -1.227442656478137e-01   +7.545137812485492e-02   -2.132271636699196e-01   +3.810363697096580e-01   +3.616685817757007e-01   +8.313893515944164e-02   -3.775674123860863e-01   -6.699342578524807e-01   +9.881307182765292e-02   +2.518766067647030e-01; +4.455744966785243e-01   +5.106139071540244e-01   +1.603177711966246e-01   -1.715403279816520e-01   +3.481195111588026e-01   +1.321851545051320e-01   +6.501518119617774e-01   -2.722269821651742e-01   -1.073818929321626e-01   +7.088761686531624e-01   -2.844790152226009e-01   +7.208313734053862e-01   +5.131862098507555e-01   -3.086520013785244e-01   +9.562887371401024e-02   -3.345737164181996e-01; -2.645996151945466e-01   -9.929102227210647e-02   -3.391398404997750e-01   +2.590496206873574e-01   -3.200864104091779e-01   -3.379500598579585e-01   -3.531306001319214e-02   +5.109468453207663e-01   +2.710101967523351e-01   -1.996849862291670e-01   -3.694288981907431e-01   -6.445427890757767e-01   +3.091541030811456e-01   -5.175360273543453e-01   -3.363910000453156e-01   -3.395364550474537e-01; +5.335060691537966e-01   -1.182735168512038e-01   -5.955578930298773e-01   -3.390674751507285e-01   -5.183828205485613e-01   +4.967827632871089e-01   +5.497327475721107e-02   +1.501956254127646e-01   +1.259149297523756e-01   +3.536785907623864e-01   -7.850142001078710e-02   -1.063584558804147e-01   -7.203212428488252e-02   +5.809099557493604e-01   -3.799168957903166e-01   -8.495800945333700e-01; +4.722943066867149e-01   +5.017087276653702e-01   +2.227256999385613e-01   -5.520360345215531e-01   +4.330493725154979e-01   -2.116790305077370e-01   +1.444057440424276e-01   +5.692857034343340e-01   -1.887220053404975e-01   -5.414182515358734e-01   -1.875232423209481e-01   +3.105913647314294e-01   -3.526842494445231e-01   -3.210258209074565e-01   +5.098736906821678e-01   +4.686727870407197e-01; -1.994214874054366e-01   -1.000000000000000e+00   +2.743320931288520e-01   +2.174288089250619e-01   +4.784841239796042e-01   +1.188892211499924e-01   +1.540992103169343e-03   -1.827012908133527e-01   +7.871087653826665e-01   -1.972687822489556e-01   +3.526092616477653e-01   -1.686262455686916e-01   +8.782591078853318e-02   -1.136548416836343e-01   -7.332598891385794e-01   -6.424799250524241e-02; -2.815746128950428e-01   +6.026072406067772e-01   -8.761638242230894e-01   +6.099488223125406e-01   +1.440841444110204e-01   +8.398219378177967e-01   +3.273534075710121e-01   +9.476509509640119e-02   -4.795190701098836e-01   -2.991627172408238e-03   -5.474934863146811e-01   -4.030880715159381e-01   +7.452445137672421e-01   +3.412294592684725e-01   -6.883159097677636e-01   -5.118638766928860e-01; +2.196702009472120e-01   -3.971096977198506e-02   +4.045165442089607e-01   +1.024530543157704e-01   -1.188675754849532e-01   -2.478746574222035e-01   -5.134447642321111e-01   -3.188829585574716e-01   +5.782649911479702e-02   -3.670058476709617e-01   -3.028792906268176e-02   +3.036292247893088e-01   +4.287655973959374e-01   +4.286437772049544e-01   +6.904045443277182e-02   +4.001963223084223e-01];
L2I_L2E_iAMPA_netcon = [+1.500374269644296e-02   -3.992891664337813e-01   -6.529416025230087e-01   +7.564830593971086e-01   +3.050425988232562e-01   +9.079186131394595e-02   +5.275297136929162e-01   +2.081588849032731e-01; -7.760199327776728e-01   +2.911480076459041e-01   -1.496312845972233e-01   -6.875491971986937e-01   +2.037793689444442e-01   +9.743643408573051e-02   -2.652233025536586e-01   -2.803134343090802e-02; +3.371552510344534e-01   -1.925163238951903e-01   +8.167720493025036e-01   -6.381293339083881e-01   -1.000000000000000e+00   +1.001264997359255e-01   -4.277838627276727e-01   +5.480746225062019e-01; +4.205025946753897e-01   -5.383009457641290e-02   +6.086664666954025e-01   -3.337934375797162e-01   -8.451450070028637e-01   -3.864338524848858e-01   -3.949700766054460e-01   +5.983030094654704e-01; +1.865590605029671e-01   -8.652443110406149e-02   +4.765793329953808e-01   +3.625730641576931e-01   +2.453894096196252e-01   -1.006146436901788e-01   +2.552650988353923e-02   +3.280722613375269e-01; +9.598311621193983e-01   -2.601338226878978e-01   +1.845895200934553e-01   +2.185692914132136e-01   -2.656513661622585e-01   -7.519687386378799e-01   +4.269387558072811e-01   -7.548264985281976e-01; -3.170559171692216e-01   +5.503907560234367e-01   -3.184797286701398e-01   +4.216290547238876e-01   +7.138387807811100e-01   -1.907414963305229e-01   +1.798364681542588e-01   -5.062612897167643e-01; +5.414984455489058e-01   -2.290427702986013e-01   -1.465724815465742e-01   -6.552738549918997e-01   +7.567193489759146e-01   +1.176526707224151e-01   -2.372442857596187e-02   -8.163543410732977e-01];
L2E_L2I_iGABA_netcon = [+2.912407029266664e-01   -1.000000000000000e+00   -4.734931838704589e-01   -8.261450290866332e-02   +5.915151000969840e-01   -1.915383428241029e-01   +3.913514972765616e-01   +2.823483122868923e-02; +2.272948768113353e-01   -2.730582993708232e-01   +7.330188502461633e-01   -1.489444780289547e-01   +1.407485410576809e-01   +5.438128001789861e-01   -8.304789615214776e-01   -1.261646288342085e-01; +3.108600705242199e-01   -5.067975981843283e-02   +1.148649014604498e-01   +9.252271867973292e-01   +4.924501632486716e-01   -1.761293695376913e-01   -2.853828506989483e-01   +4.951284625092384e-01; -1.992319497328490e-01   +5.886156727212839e-01   +3.145079326237440e-01   -1.311457197519364e-01   +6.466643926281793e-01   -8.324249348671277e-01   +4.949657682478323e-01   -1.930230625795698e-02; +3.350421838496447e-01   -5.660731649553521e-01   +2.611084025030080e-01   +4.299408047419646e-01   -5.310282289676479e-01   -6.132184225412647e-01   -1.848854033321790e-01   +2.397783370479744e-01; +2.192371033060163e-01   -4.369105754187652e-01   +3.798661956951985e-01   +5.170035560831814e-01   -2.257082606307900e-02   -1.120038450007828e-01   -3.610810580352946e-01   +5.975627440671870e-01; +4.161476642731286e-01   +3.369611587937455e-01   -4.520656064468171e-01   +4.405946115900009e-01   -3.155960142562735e-01   -1.879649403699188e-01   +1.653977229564031e-01   +1.341519023733815e-03; +9.796666673201189e-02   +4.865733608671559e-01   -9.334688774014507e-01   -5.197771514610738e-01   +9.169868154031721e-01   -1.386150950395693e-01   -8.055611133120049e-03   -6.929258962481216e-01];
L3E_L2E_iAMPA_netcon = [+1.941350868487054e-01   +1.102345295125091e-01   +6.614522232432083e-01   +1.964767109857992e-01   +5.773343338384568e-01   -4.375066911887163e-01   -1.304889897050741e-02   +7.673475265453981e-02   -3.069995109559759e-01   +9.095199143493556e-02   -2.806811550587037e-01   -5.096506263830071e-02; +7.292009258106609e-01   +3.655954377735894e-01   +2.034234835953544e-01   -3.340760818337804e-01   -4.070619281987657e-01   +7.641921157603396e-02   -5.086884711596278e-01   -6.750255592722931e-01   -6.691520713808773e-02   -1.858319269111231e-01   -1.934781288473382e-02   +1.018743893186765e-01; -1.356633211408699e-01   -6.140896165355636e-01   -1.508739468546001e-01   +6.083844239735017e-01   +8.607730899522709e-02   -4.596401984975649e-02   +3.212796070668546e-01   -4.355286447924578e-01   -1.877161514354547e-01   +4.331647545925568e-01   -1.482390163693322e-01   +1.000000000000000e+00; +3.190132447358306e-01   -7.769564272413444e-01   +1.387272872404865e-01   +1.842926805081114e-01   +5.337139825834186e-01   +2.913745112423082e-01   -2.370028824650633e-01   -5.889139680572780e-01   -3.047983102937000e-01   -5.685213492812579e-01   +1.916067193513113e-01   -8.077401267032617e-01; -2.648869533041932e-01   -4.563251189032161e-01   +4.436259297491840e-01   +1.600393149675968e-01   +3.119474038180312e-01   -1.970761835706344e-01   +1.321703519722385e-02   +5.594897211162468e-01   -4.027365763113037e-01   -2.270061341849052e-01   -4.902015279820705e-01   -8.365503752854783e-01; +8.569256559494554e-01   -1.057394149427365e-01   -3.350667593231965e-02   +6.326188363988475e-01   +6.295923025549776e-01   -4.657455700892426e-01   +1.717367004681524e-01   -4.867756020844544e-01   +2.180837214359130e-01   -4.485091426962944e-02   -6.040925001343832e-01   -4.126651377286389e-01; +5.745205556919283e-02   -5.194459863697419e-01   -9.254476317721493e-02   -4.764759427162808e-01   -4.342119169617412e-01   -2.076905301386456e-01   -1.117653186967502e-01   -5.657194268890975e-01   -7.331602412547190e-01   +3.131345733459999e-01   -2.667659504174831e-02   -7.978654859789842e-01; -2.382678665445703e-01   +1.747369879122410e-01   +1.819806000313372e-01   +2.532881146256438e-01   +7.752548839849954e-02   +1.242489869461880e-01   +2.349279875033281e-02   -3.226538017043038e-01   -7.044081050425842e-01   -3.803790902790641e-01   +2.695735458083732e-01   +2.155864582822419e-01];
L3I_L2I_iGABA_netcon = [-4.765431226293684e-01   -7.681612100395524e-02   -4.171986694684313e-01   +5.970409583921086e-01   +2.011156133512933e-01   -4.865687701823356e-01   -2.001821705667904e-01   -2.100191621110499e-02   +7.983416128390088e-01   +6.852843478306617e-01   +3.654664317935039e-01   -6.054445690988729e-01; -9.651891808216276e-02   +7.747407423747947e-02   -5.302003715759730e-01   -5.878814763456706e-01   +1.000000000000000e+00   -8.087405692166634e-01   -6.690029908612156e-02   -7.657090547535323e-01   +3.790148716951969e-01   -7.543662696829017e-01   -2.051009544413158e-02   +6.159342801005123e-01; +7.774627711331565e-01   +6.826887130068543e-01   +1.996409901501451e-01   -1.692986031980722e-01   +8.197925265835548e-02   +6.081988236379766e-01   +5.842910299552302e-01   +9.724120355923956e-01   -6.011794175470467e-01   +7.014486418497394e-01   -5.934324673405487e-01   +2.729485482080011e-01; -2.061399683168585e-01   +6.283584433809782e-01   -4.997565129753395e-01   -2.885249069969374e-01   +9.836433703906644e-01   +4.591049842597960e-01   -2.768914621458068e-02   -4.073073413857667e-01   +6.734446922107662e-01   -6.980997605487541e-01   -5.695118479786192e-01   -1.856832873456446e-01; -7.716609182451248e-01   -2.426732624001457e-01   -5.376240311497325e-01   +1.105976046082494e-01   -1.689799173524037e-01   -6.679308697423753e-03   -3.088224609854757e-02   +7.862125107972011e-01   +6.009781152235480e-01   -6.053740114248987e-01   +1.512734417039775e-01   +1.062302712871634e-01; -2.890210623723783e-01   +4.235720420948871e-02   +4.717476664502390e-01   -7.602972429818766e-01   -1.064354252353243e-01   -9.259625463246768e-02   -4.297039973264939e-01   +8.586957271759084e-01   -9.650871917543970e-02   -3.147854106188733e-01   +2.066794627506410e-01   +7.995799938319644e-01; -6.864034861156683e-01   +9.693132070753241e-02   -4.565252692605594e-01   -8.807507468044607e-01   -2.567167242777691e-01   -4.667140977288124e-01   +3.463299046873695e-01   +2.649420980669011e-01   -2.543022445385490e-01   -1.358752214440144e-01   +3.129894136924369e-01   -6.207174643862118e-02; +2.281028465943102e-01   -6.104172339169207e-01   -3.136947724567232e-02   +9.862823868501900e-01   +2.843770034665342e-01   -1.249726540469182e-01   -4.675564731419246e-01   +2.250915031043792e-01   -1.586501277843786e-01   -5.729550033074992e-01   +8.005213104954265e-01   +6.855446079332837e-03];
L2E_L3E_iAMPA_netcon = [+2.922316970691042e-01   +7.742979190262830e-01   -5.023173080845602e-01   +7.118005623239255e-01   -2.043043018313078e-01   -3.177459033986631e-01   +1.361041492070624e-01   -5.365913616802103e-02; +5.282380075473232e-01   -1.198064460499084e-02   +2.742937525718345e-01   +3.323438059427387e-01   +6.466160793471393e-01   +3.860838086672573e-01   +4.713044551285415e-01   +1.845787318493953e-02; +1.266808884975286e-01   -1.140758530251839e-01   -1.144177734905752e-01   -4.115412941863696e-01   +2.448767466468753e-01   +1.138840813604133e-01   -3.723557977241495e-01   +5.083225451370033e-01; -3.377685085594135e-01   +5.194023113635072e-01   -1.759267110991916e-01   -1.955431988446530e-01   -5.852857400483644e-01   -5.633403428678763e-01   -7.620433941081041e-01   +5.662776454315275e-01; -6.374534880916265e-01   -3.946202730970512e-01   +3.546288788568054e-01   -2.761336450437586e-01   +5.805305470053589e-02   +3.567298119916990e-01   +2.130434180309981e-01   +3.925029703235260e-01; -8.604995473466713e-01   +5.318952409831307e-01   +7.912032170324382e-01   -5.023756689283441e-01   -2.169398721003600e-01   +3.077051900562584e-01   +1.368377533502614e-01   +9.648637149788677e-02; +1.880373883459409e-01   -3.400530725269891e-01   +3.579680432572386e-01   +2.853439100113253e-01   -6.985013722930383e-01   -7.973061414427465e-01   -4.244704934822417e-01   +4.932882417217445e-01; -2.579256174850449e-01   +3.353038792506298e-01   +4.777030230464233e-01   -3.260622533537693e-01   +2.975283932609050e-01   -4.739896267278425e-01   -3.764542022768601e-01   +2.956995732884659e-01; -3.352234160187476e-01   +6.745322778123126e-01   +6.156559306653513e-01   -2.630864128399207e-01   -2.280879277442474e-01   +2.634733696080409e-01   -5.089996115335632e-01   +3.015407082508745e-01; -2.720480236601827e-02   +5.521326185905152e-01   +4.673117457602107e-01   +3.594126254271970e-01   +6.253832509470022e-01   -5.477184191936060e-01   -2.237829448742037e-01   -3.930061879524667e-01; +3.846942816290749e-01   -1.320538495409367e-01   +2.619947931831311e-01   -9.554063712117228e-02   +1.000000000000000e+00   -1.942013321995787e-01   +5.186800742105038e-01   +6.557673343889252e-01; +1.178188670341394e-01   -4.269331344476368e-01   -3.981316832359196e-01   +6.418151357638184e-01   +1.056831670910266e-01   +2.019906773341473e-01   -4.282734937870137e-02   -7.799699232012905e-02];
L2I_L3I_iGABA_netcon = [-6.073072507465075e-01   +1.715567330630489e-02   +1.989098398755443e-01   +2.000228965459681e-01   +1.000000000000000e+00   -5.193684781947649e-01   -5.713769793110085e-01   +4.490189120334080e-01; -6.539059403300315e-01   +3.294952656343914e-01   -7.651020742797064e-02   +1.896900752860875e-01   +4.386609842701817e-01   +3.608707142435835e-01   -5.237508556080044e-01   -2.477940666640134e-01; -3.489134501498489e-01   +6.953140998490907e-02   -3.487325749976977e-01   -7.034217095674421e-01   -1.892135674180900e-01   +1.162888151311157e-01   -6.372829909906511e-01   -1.980363390060382e-01; -3.392601845240096e-01   +1.063698393971174e-01   +1.841721544686619e-02   -4.544077609893094e-01   +4.695162838199023e-01   +1.673399409250795e-01   +3.002653649955137e-01   -4.621312695333479e-01; +5.296820127021343e-01   +2.870653806229782e-01   +2.771913302980328e-01   +3.858785289232741e-01   +4.392340364259572e-01   -2.978593113978037e-01   -2.548649229439816e-01   +7.649058408618306e-01; -4.698684805064160e-01   +2.881120847244475e-01   -2.362272517073501e-01   +3.997086430235342e-01   +4.072692172997575e-01   +4.152182533380968e-01   +2.483848110313873e-03   +1.655329676148538e-01; -7.237478437391311e-01   -5.227310953060292e-01   +9.170405997198132e-01   -6.382701718809278e-01   +4.973883258930644e-01   -1.387116882433079e-01   +1.993006070762237e-01   -3.045922198298867e-01; -1.570706954703721e-01   +4.331124990362010e-01   +7.355338067319764e-01   -2.540987813274377e-01   -9.477354401738711e-01   +6.637124022930374e-01   -1.926716927340599e-01   -6.241434177618189e-01; +1.584185082261042e-01   +1.312494241736534e-01   -2.004756311291314e-01   +2.683432019358477e-01   -4.469873732895344e-01   -9.336263643456187e-02   +3.398758892498816e-01   -4.343805504990967e-01; -2.763334634104228e-01   -3.236004117452881e-01   -2.020709632148625e-01   -3.348728535249019e-01   -4.619682802926559e-01   +6.314850154341284e-01   +1.202672941030507e-01   +2.295813254098995e-01; +8.842463934126266e-01   +5.475588910801633e-01   +5.779646586684041e-01   +4.049490188251754e-01   -4.737620017879861e-01   +6.203628599285780e-01   -3.427373767933941e-01   +3.618337146942811e-01; -1.079411988085877e-01   -8.639592561030236e-01   -4.008806408372510e-01   -5.387454092374584e-01   +9.863860443732582e-02   +5.665958442634548e-01   -1.160811329025612e-01   +1.028693048641273e-01];
L3I_L3E_iAMPA_netcon = [-1.016935678144852e-01   -1.790287661554164e-01   -3.047710509261541e-03   -2.687307495991905e-01   -2.904329356625827e-01   +3.740216815779187e-01   -4.138944478144823e-01   +2.970157295113230e-02   +3.597208906141143e-01   -2.443343180941867e-01   +2.174759234129728e-01   -2.977404195285013e-01; -2.150545035979408e-01   +1.000000000000000e+00   -4.636117576347203e-01   +2.508177891305751e-01   +4.908344766906037e-01   +4.687409282998898e-01   -1.789000918370160e-02   +4.190444779500379e-02   -6.100738589262744e-01   +1.892407721232020e-02   -1.419859980979075e-01   +2.967177629775255e-02; +5.208064609315879e-01   +1.157935622395501e-01   -8.380395736110737e-03   +2.204482194159185e-01   +6.871626554822211e-01   +1.869253880095867e-01   +3.972102723948419e-01   -4.059216383300556e-02   +9.481220233703549e-02   +2.794100530817354e-01   +4.091425529294970e-01   -1.430762105280037e-01; +1.457699366946150e-01   -4.019003128528402e-01   +5.473978873674668e-01   -6.208663706657538e-01   -3.360943041573271e-01   +4.443000499919631e-01   -2.354922079334633e-02   -7.744578623238942e-02   -1.400052531658279e-01   -4.425701038873797e-01   +5.504131771309300e-01   -6.938194760667333e-01; +7.358798023934061e-01   -6.013143699592367e-01   -3.838592876957370e-02   -2.960131085735686e-01   -9.209119699301353e-03   +6.910696589605724e-01   -7.216673559473429e-02   +2.201912572028559e-01   -9.385098539153704e-02   +6.742697104416698e-02   +3.893679256296907e-01   -1.720687220172138e-01; +4.613806699210684e-01   -5.088247385828999e-01   -4.723275974308187e-01   -9.613037563082041e-02   -7.701486312911335e-01   -2.101069373448497e-01   +5.074896767425351e-02   -7.285139732127333e-02   -2.460566006686147e-01   +3.256610198902079e-01   +7.946465689568183e-01   -7.830316276704894e-01; +1.536749266495648e-01   +6.142319581711084e-02   -2.600013518835244e-01   +6.649754429397527e-01   +2.781062812052384e-01   -7.850750677355142e-02   +9.207543531633133e-02   +6.228120128317226e-01   -2.406388341250154e-01   -3.654211890037926e-01   -5.294105058448081e-01   +4.808703880488998e-01; +3.597133497150160e-02   +1.743644513080060e-01   +4.752070078786336e-02   -4.147322278330406e-01   +4.896253477243971e-01   +1.984937400390424e-01   -5.493157964947794e-01   -4.912544307810653e-01   +2.696169614464041e-01   +3.856061974645228e-01   +3.367584990774000e-01   +5.405159586728303e-01; -3.980581571834922e-01   -1.439521516280121e-01   +4.810961985313439e-01   -7.626177608692730e-02   -2.986592142652345e-01   -4.915100495226691e-01   +3.848975348900623e-02   -1.523883214453481e-01   -5.504939873523745e-01   -6.145697849486091e-01   -3.561772747266060e-01   +3.473685126784119e-01; +2.551688277333785e-01   -6.077611288211502e-01   -2.569853123667539e-01   -5.133096975851719e-01   +7.688897176123987e-01   +6.216068315526990e-01   +4.074808106801775e-01   +7.816575203300624e-01   -8.747441274185620e-01   -4.353046429511882e-01   +6.740565738348376e-01   +5.136964581691345e-01; +3.796658215554809e-01   -7.109798350586405e-01   +4.239427860027773e-01   +2.799524795054013e-01   +3.451021684949908e-02   -1.157324967643391e-01   +6.094060176558178e-01   -2.588196461644567e-01   -1.371670861506948e-01   +3.141549401005592e-01   -5.246042455303010e-01   -7.339947022170107e-01; -4.295925691274485e-01   -4.303962893162768e-01   -8.239839479631587e-02   -1.259859608870864e-01   -1.649281417343414e-01   +2.841499156786684e-02   +1.655032625315089e-01   +5.506923530268629e-02   -7.446955612822590e-01   -1.369277247446430e-01   +1.720261267491964e-02   -2.672324623969590e-01];
L3E_L3I_iGABA_netcon = [+1.741943034449578e-01   -3.692348863281811e-01   +2.035524874095058e-01   +4.542178700932925e-01   -3.078839482988598e-01   +5.589949023765324e-01   +3.646742711939674e-01   -9.183977476046688e-02   +1.786373128457142e-01   -2.465346764279161e-01   -6.699203528934751e-01   -4.968350645413452e-01; +1.074851956722835e-01   +2.099289105568574e-01   +1.328477564647304e-01   -5.754946329340542e-01   +2.214377433986600e-01   -5.668681315585898e-01   +4.690462510443257e-01   -2.743681788407588e-01   -6.703723630730514e-01   -3.106657721005504e-01   +6.279449232577787e-01   -6.521616403196374e-01; -5.285932713013480e-01   +1.724899035168221e-02   +5.605596462490582e-01   -1.168443746171403e-01   +2.109466295383240e-01   +4.658603723305968e-02   +6.831814060491535e-01   +1.572984269198961e-01   -6.625864619948005e-01   +4.649854858320253e-01   +2.469809210280564e-01   +6.145811701867784e-01; +5.000872247099893e-01   -6.634677429967009e-01   -2.168240973437953e-01   +2.837502768862644e-01   +2.823634910452526e-01   +2.634400813886205e-01   -1.931961161405362e-01   -5.220883028795504e-02   -5.317022136449175e-02   -1.883414355272466e-01   -2.918170186514388e-01   +3.882105035655077e-01; -6.199802177281512e-01   +6.567940760554430e-02   +1.592653360970934e-01   -6.231093439850881e-01   +1.000000000000000e+00   -6.467382641254246e-01   +4.127065345418195e-02   +5.399289015220368e-01   +2.239610395177376e-01   +8.375028293666721e-01   -4.199208811215930e-01   +9.120707756599453e-02; +7.763837121306244e-01   +8.775692338664705e-01   -7.058020965662742e-01   +5.247996483690330e-01   +3.340703650269639e-01   +2.601019282412509e-01   +7.546310036642976e-01   +4.601818874148557e-03   +3.166362278508274e-01   +7.141274505754650e-02   +3.192297923308931e-01   -6.180575325025190e-02; +2.521234420664150e-01   -1.388883540743375e-01   -4.352621560423037e-01   +2.262632680731332e-01   -3.262489485018997e-01   +9.822035335205934e-01   +2.970768867247988e-01   -2.788077776777411e-01   +7.096188707363256e-01   -1.042795048125756e-01   +5.341741828254881e-02   -2.114588965276070e-01; +8.079707812856028e-02   +2.219686111753585e-01   +1.433484609376501e-01   +5.061270183770732e-01   -4.151052896278754e-01   +1.134266083586517e-01   +9.101315568706441e-01   +5.962431293758091e-01   -5.046483241598171e-01   -1.950194558413587e-01   +5.438332623181742e-02   -3.903764087898928e-02; +3.346964839499300e-01   +3.126361557185384e-01   +1.424352817299483e-01   -2.557536161451105e-01   +9.136462047192959e-02   +1.497351562374184e-01   -4.846011541247855e-01   -8.840337983073855e-01   -7.811419670919040e-02   -6.903851562786983e-01   +4.305227710744490e-01   -1.922005721904906e-01; +3.110702672257952e-01   -8.178051632605067e-01   +2.576946722830674e-01   +4.087469200218058e-01   -1.342520087977953e-01   +1.365801078710114e-01   +2.982630534397462e-01   -3.111693202030382e-01   +1.278573223839979e-01   -3.180523752203012e-01   +3.995376443124574e-01   -9.083500631485517e-02; -3.354313516717721e-02   -1.026562265651240e-01   +6.642579888379680e-01   +8.264545301797656e-01   -2.582194782627835e-01   +2.255774308424555e-01   -6.195385948725426e-01   -2.539804457594821e-01   +3.369363842680361e-01   +4.441790532975259e-01   +8.410583546626018e-01   +7.553710904384717e-01; -3.007910711073171e-01   +5.007797150865263e-01   -4.257120563693532e-01   -5.730600769020328e-01   +4.926802272037777e-02   -7.015311135970743e-01   +2.464484645553822e-02   -1.399659392258715e-01   -3.367208311755485e-01   +3.403156239399512e-02   +7.763050071486990e-01   -2.294008185175825e-01];
L2E_Input1_iAMPA_netcon = [+1.924074093683172e-01   +5.462191265357345e-01   +1.954584374718798e-01   -1.000000000000000e+00   -3.667131911228607e-01   -1.048843908024736e-01   +8.802314881538159e-02   -1.495487381705892e-01];
L2I_Input2_iAMPA_netcon = [+3.886747449306727e-01   -9.205266070608676e-01   +9.473046738150035e-01   -5.375397452819868e-01   +3.995848548170138e-01   -6.309775735499985e-01   -1.000000000000000e+00   +4.598709052385179e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.04*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.9*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.1*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.9*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.1*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.9*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.04*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.9*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.1*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.9*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.1*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.9*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
