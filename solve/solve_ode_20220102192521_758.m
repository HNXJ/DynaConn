function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+1.467978296046850e-01   +3.132057675992943e-03   +7.987774956712083e-01   +3.704846105311168e-01   +1.551928127957473e-01   +6.576090690325985e-01   -3.231421196397760e-01   +5.155662255586136e-01   +4.038156617136795e-01   +8.131469028745243e-01   +5.093291934455221e-02   -3.795305082133017e-02   +2.234862749526895e-01   +5.170091703808709e-01   -1.204828031242450e-01   -2.889534793834118e-03; +2.848692736733262e-01   +3.675152782820126e-01   +2.051279304253944e-01   +8.528541024446273e-01   +3.504708253480295e-01   +2.235487776458244e-01   +5.848158052854189e-02   +6.119363129131461e-01   +8.126967137023704e-01   +5.293910266807668e-01   +6.408077238395997e-01   +5.970844478660851e-01   +1.748682746635996e-01   +6.763322630392987e-01   +2.681658122546566e-01   -1.765214812613873e-02; +7.494028493687601e-01   +1.997657481324161e-01   +1.509661589080383e-01   +3.397444420514490e-01   +3.658465335712653e-01   +1.286790617275815e-01   +7.082675315602210e-01   +3.129654223429373e-01   +4.548743916625509e-01   +4.852989837523574e-01   +2.578544606094725e-01   -1.743632424663308e-02   +1.917589011075477e-01   -3.963324041540330e-01   +2.628999272938669e-01   +2.270519649060093e-01; +3.021358767283346e-01   -2.015189820019731e-01   +9.577707457449475e-02   +4.887360148410861e-01   +2.589467999793940e-01   +2.088497743666937e-01   +8.727939600590692e-01   +1.000000000000000e+00   +4.961521941462602e-01   +3.029504163150301e-01   +4.558816926162598e-01   +6.140450311272085e-01   +4.028401057818253e-01   +2.873048595366956e-01   +2.456285694297314e-01   +4.582414613260243e-01; +7.591629200215207e-01   +1.746540956716522e-01   +5.924592734866765e-01   +8.716875215543900e-01   +2.956765379001424e-02   +4.286885258190785e-01   +1.364011857937591e-01   +5.827977204904244e-01   +3.485781166175156e-01   +6.795827732396561e-01   +4.990071334954430e-01   +1.828307445929247e-01   +1.814207979074854e-01   +3.356716823493468e-01   +5.233785031651064e-01   +2.014267232798244e-01; +7.252944163557871e-02   +4.658700021662354e-01   +3.173031199134597e-01   +2.687249940550994e-01   +8.638815222310133e-01   +2.998308275476327e-01   +9.958427958212885e-01   +2.294238051431529e-01   +3.688443956541349e-01   +2.029494630036857e-01   +4.604039627523181e-01   +2.020853920110338e-01   +5.096546100392022e-01   +1.442072797133468e-01   +3.935219881172598e-02   -9.570076397126910e-02; +5.043972503556772e-01   +5.256217747649392e-01   +3.206216594625119e-01   +2.775967824117093e-01   +2.546824034292547e-01   +2.781702363691060e-01   +2.810161880942797e-02   -2.163308867411892e-02   +9.073527019511124e-01   +4.232382685655773e-01   +2.300577079338313e-01   +4.482918693090622e-01   +1.550968637390531e-01   +3.903051657969140e-01   +5.976238772192968e-01   +3.723268053976850e-01; +4.256766255644444e-01   +6.843452627349195e-01   +8.954890404968294e-02   +8.557969299292132e-01   -1.165809723049452e-01   -1.419278966504621e-01   +4.936568112980158e-01   +5.890099097825295e-01   +7.028858052312316e-01   +3.341561801357188e-01   +3.532449773444769e-01   +4.229444401338782e-01   +3.934396972197686e-01   +3.386148935160860e-01   +6.973699793978810e-01   +5.685689269422667e-01; -2.951581620353449e-02   +6.673697052713778e-01   -6.533241830902643e-02   +4.526407828844886e-01   +3.441666583597573e-01   +7.698276547572621e-01   +6.190641471842894e-01   +4.817409565283683e-02   +1.688574845816374e-01   +3.633114579841151e-01   +7.482630913990207e-01   -1.306351166192623e-01   +6.146607204174749e-01   +3.249150448301495e-01   -1.617141928583403e-01   -1.796656073516009e-01; +2.827048097926665e-01   +2.474407630336443e-01   +8.241203112782248e-01   +6.278366199958670e-01   +5.109731095272295e-01   +4.016864415942879e-01   +3.977215642437262e-01   +5.604106576833006e-01   +8.573849225425387e-02   +4.309759136660636e-01   +3.363628125982163e-01   +3.599190165576760e-01   +7.957128557401404e-01   -1.463299276152945e-02   +4.028022193258972e-01   +5.860376543925471e-01; -9.072206024499889e-02   +5.922169211272008e-01   +4.473959466546926e-01   +1.652801402322393e-01   +8.896514411052769e-01   +6.697949112824745e-01   +5.782658264513953e-01   +2.847625765169445e-01   +3.430801372834967e-01   +4.846458915523189e-01   +3.695380955149771e-01   +5.778818335152297e-01   +1.004025690355281e-01   +4.360989889493269e-01   +5.460325881564002e-01   +6.396368180462929e-01; +7.288799751400048e-01   +6.930698657692230e-02   -9.342022609105759e-03   +5.899068282604574e-02   +3.562067493912354e-01   +6.788801278376081e-01   +3.382743316052551e-01   +3.923694273067732e-01   +8.343552924581777e-01   -3.703248924156410e-01   +1.200886675020111e-01   +5.893500028748095e-01   +4.059461486169496e-02   +2.498572333267699e-01   -1.079499255871453e-01   +6.406035997871282e-01; -3.961479574344701e-01   +3.045382679832486e-01   +5.865118410126932e-01   +5.518957547448067e-01   +6.907515067037013e-01   +4.949456379469608e-01   +1.781551242336362e-01   +4.017407537471496e-01   +8.406760921936814e-01   +6.041765988609625e-01   +1.538990676182649e-01   +1.819054566771427e-01   -4.577997942977614e-02   +6.762487854805890e-02   +4.420498907828483e-01   +2.016933836012639e-01; +3.033896484243270e-01   +4.745394231187325e-01   +4.831286783763169e-01   +1.801786305517989e-01   +2.235648949905251e-01   +4.423657091389573e-01   +3.346334921371679e-01   +6.347139280108960e-01   -3.703763160287954e-02   +2.757784954784320e-01   +6.378857284072744e-01   +4.246365278097849e-01   +6.587619841409013e-01   +2.741869611045361e-01   +5.447305392204495e-01   +2.099089189012677e-01; +6.149311108104611e-01   -3.884169021267323e-02   +4.012343650215221e-01   +7.546001742649383e-01   +1.478908590801304e-01   +4.462415548742874e-01   +5.033251842511153e-01   +6.669585314832498e-02   +6.021909239151783e-02   +3.022773804505337e-01   +2.293275909177899e-01   +4.990739221464164e-01   +6.581304519307751e-01   +3.917969084507996e-01   +5.022946803301522e-01   -6.265054746703760e-02; -1.872364625429856e-01   +4.129280948038113e-01   +5.929199602921055e-01   +5.944662771930020e-01   +6.712752715706173e-01   +7.070080307585117e-01   -1.418568093453388e-01   +8.538897330027163e-01   -5.042479330064541e-02   +7.293356315542668e-01   +4.365766406749779e-01   +3.805650261982634e-01   +1.201139600671650e-01   +6.995926708346790e-01   +4.884729980234824e-01   +9.083349042305947e-02];
L1E_L1I_iGABA_netcon = [+6.735775538987928e-01   +5.604960673455783e-01   +2.940799824625568e-01   +4.035678828897029e-01   +2.466109374781744e-01   +1.182229785148063e-01   +4.405753220429608e-01   +3.386948161389310e-01   +1.945260543124154e-02   -7.305283435472536e-02   +2.117145912807729e-01   +2.232853508813147e-01   +5.138045184090781e-01   +6.784483396015563e-02   -1.569544674351502e-01   +1.000000000000000e+00; +3.832918920518634e-02   +1.024700556412779e-01   +5.385698955148891e-01   +9.541311779138638e-02   +3.943984191974806e-01   +6.796875570793828e-01   +5.123320946522582e-01   +4.312526402649187e-01   +3.942984761730209e-01   +8.029510098960380e-03   +2.549380071784853e-01   -5.847845542242721e-02   +9.063732434389840e-01   +5.303178019353083e-01   -4.801169655909204e-02   -1.651391544294132e-01; +1.137599535029742e-01   +4.869089420041003e-01   +3.901489343514717e-01   +3.001517546510058e-01   +3.567050390819324e-01   +2.950888217277772e-01   +2.787219651222650e-01   -1.297831542103696e-01   +2.246307885998476e-01   +7.816150022541389e-01   +3.995262235646322e-01   +4.374086091424327e-01   +1.205876535131561e-01   -1.672030252112819e-01   +2.253431402520017e-01   +6.469677713032209e-01; +6.089642159058063e-01   +1.631560434329422e-01   +8.174324639511731e-02   +4.374445266343335e-01   +6.942758420344150e-02   -9.221239038483135e-02   +3.399443893207327e-01   -7.724552659858988e-02   +2.259798697676970e-01   +1.025540460350964e-01   +1.797475553586079e-01   +8.287996551061722e-01   +1.069277625196230e-01   +3.544031097204610e-01   +1.208091813549016e-01   +4.701250558042595e-02; +3.236402518371370e-01   +2.946020672751272e-01   +1.001750497786874e-01   +1.335291066550709e-01   +5.708814875829379e-01   +5.823750659514187e-02   +2.791881859263656e-01   -4.672414096825909e-02   +3.797126787953538e-01   +1.167917216989242e-01   +1.391240659644116e-01   +2.884411734712620e-01   +3.894805778895700e-01   -2.170740074207960e-01   +3.274077995984678e-02   +4.969613513649181e-01; +6.843673390023128e-02   +3.133350573894635e-01   +7.300141102132912e-01   +2.964352379512135e-01   +5.277765169673255e-01   +3.656343640761404e-01   +1.094189685762283e-01   -3.948468105268119e-02   +1.441302798296180e-01   -2.140946972273117e-02   +2.876147624738594e-01   +5.242873559015884e-01   +7.836389328150506e-02   -3.646928879042284e-01   +3.971789135551774e-01   +4.470848137541811e-01; +3.248967873745304e-01   +8.290447379399954e-02   +1.010521561759284e-01   +2.450548770503930e-01   +3.271143972691911e-02   +3.935406468134707e-01   +2.365187903888862e-01   +9.746955957610245e-02   +2.058932118038932e-01   +1.024409895539208e-01   +4.678362083586793e-01   +4.144903568353933e-01   +5.529928370936628e-01   -2.838914948014115e-02   +1.170293155970858e-01   +1.077886242560432e-01; +3.740861277156410e-01   +4.650688277461538e-01   +1.535977328114558e-01   +6.183195572393110e-01   +1.278445443558407e-01   -3.787218554055410e-02   +2.210834869615571e-01   -9.583836320382601e-03   +6.675754492171414e-01   +8.033224845871423e-02   +4.368263079127097e-01   +1.515786170361079e-02   +3.144087680804711e-01   +1.425876482479718e-01   +2.984572443966280e-02   +4.273325974151356e-01; +4.642757043602449e-01   +2.570886914917701e-01   +2.665956156350390e-01   +1.302783127788472e-01   +1.771915627543301e-01   +8.470439243823470e-01   +3.097909664216160e-01   +1.801173859757417e-01   +4.570358713729487e-01   +5.590394641627373e-01   +2.171626738552781e-01   +4.061903996764548e-01   -1.479537407798765e-03   +2.003926687352331e-02   +4.867347633004950e-01   +4.164367309623214e-01; +4.581437387011345e-02   +6.019019131874332e-01   -9.351437903201078e-02   +4.557054193859549e-01   +6.810891767993403e-03   +5.331584365281041e-01   +3.881517278783386e-01   +2.384252862015499e-01   +3.583506428208758e-01   -1.280471726525594e-01   +4.483421917522250e-02   +4.747893962332052e-01   +4.261747330878821e-01   +6.577580893881091e-01   +1.836429219095815e-01   +4.764310103752240e-01; +2.024875206310136e-01   +1.591973332785709e-01   +1.552213129929277e-01   +3.147119088382057e-01   +2.232831498560898e-01   +3.602892373282903e-01   +3.628850315723693e-01   -5.520414413330341e-02   +5.265172021606948e-01   +1.614095929746227e-01   +1.383616544258800e-01   +3.587698908189366e-01   +2.381623222316654e-01   +2.025793444651500e-01   +2.105255790547985e-01   -4.906664463094546e-03; +5.371322227280633e-01   +1.855120434633307e-01   -5.667927368379005e-02   +2.906917144411756e-02   +2.819063297406550e-01   +1.392117514047427e-01   +3.301666248066399e-01   +6.285000429264362e-01   -1.259951961549622e-02   +2.584697632907029e-01   +4.223956773454060e-01   +6.984642473701311e-01   +7.852057308489085e-02   +1.091390457973467e-01   +2.358435822553332e-01   +4.206058740920389e-01; +6.125576917082658e-01   +3.601739590809707e-01   +1.900392814453293e-01   +6.692209537113082e-01   +4.867095164366893e-03   +8.999966286503262e-02   +1.460866419720228e-01   +2.643549731093277e-01   +2.228924389380660e-01   -3.521911396373544e-02   +4.612962515417323e-01   +2.638524499230068e-02   -8.971074809714862e-02   +3.230862650311461e-01   +5.250032947188696e-01   +1.963172583221955e-01; +4.979839558132061e-01   +5.245943328232839e-01   +3.966125695703748e-01   +4.162677553440490e-01   +7.112672917947897e-02   +4.566204113418471e-01   +5.203244781743113e-01   +1.023311636305698e-01   +6.341633963249891e-01   +1.872391586051209e-01   +4.407523245966098e-01   -6.600463616012563e-02   +2.746875728797057e-01   +2.846974952275613e-03   +2.103251714091925e-01   +1.483146557706230e-01; +6.441080521540786e-01   +2.414597352758881e-01   +2.377987697831040e-01   +2.309925634856251e-01   +6.386037534966665e-02   +2.680643902339971e-01   +7.434797158504296e-02   +4.711919394805467e-01   +2.916431890868983e-01   +2.452044525364049e-01   +6.586010995921785e-01   +9.003243270617495e-02   -1.976470608579514e-01   -1.826592989646981e-02   +3.621973151113148e-01   +3.814032012194941e-01; +3.068570485344473e-01   +1.060223120796056e-01   +6.318240013585683e-01   +1.856591390604585e-01   +6.765520040424562e-01   +3.785319576210421e-01   +4.064795342275272e-01   +3.726766492144364e-01   -5.094796533391453e-02   +3.013503615851719e-01   +9.875417096295375e-02   +3.567330218252427e-01   +3.799688032867615e-01   +2.859000998014699e-01   +1.430632940565432e-01   +4.835239981088252e-01];
L2I_L1I_iGABA_netcon = [+3.976187143071977e-01   +1.438112172653634e-01   +5.272158844529818e-01   +5.069063931016898e-01   -9.653383477382482e-03   +1.275158346964618e-01   -4.349481590118721e-02   +4.133885893538867e-01; +5.228820319620621e-01   +9.029254130476957e-01   +3.113461682025661e-01   +2.855300348322072e-01   +5.234517545913003e-01   +1.978948453070292e-01   +6.914564855682097e-01   -2.253544899729293e-02; +3.538596637547337e-01   +5.129927247821806e-01   +6.214213909577896e-01   +1.478481763194097e-01   +8.259100861665958e-01   -6.760056621802891e-03   +2.074823586359751e-01   -1.230860500427284e-01; +6.770869768079144e-01   +2.216603827744987e-01   +5.441898533545424e-02   -1.117236289214005e-01   +7.223859815790299e-01   +4.348345500139636e-01   +4.947180840873790e-01   +4.921775550676554e-01; +1.236566674094597e-01   +7.534030930286972e-01   +5.943235630614370e-01   +5.380772653942680e-01   +5.275605582449568e-01   -5.920766683362705e-02   +4.392601102645652e-01   +2.657938403545283e-01; +4.705488503302332e-01   +2.089314969300599e-01   +4.676924999240007e-01   +5.895890170593073e-01   +3.137236574473174e-01   +5.035579250993788e-01   +4.144230756358850e-01   +6.201790368440131e-01; +6.006439970498347e-01   +8.493200745481633e-01   +6.883110724160296e-01   -3.420354970350373e-02   +6.383076290839791e-01   +2.956174923741740e-01   +4.876875844026080e-01   +9.071854632716524e-02; +3.372400165387899e-01   +4.015865736659826e-01   +4.031677600015311e-01   +5.579183969121182e-02   +1.678046000294497e-01   +5.414347099023975e-02   +4.160747152732496e-01   +2.737571846079229e-01; +7.266149072286645e-01   +9.319557626756078e-01   +1.032413148040526e-01   +8.409900428177091e-01   -1.961588870724741e-01   +1.963733890118000e-01   +3.009024556995495e-01   +3.024798461604185e-01; -2.708850160215128e-01   +1.330769616474975e-02   +1.492572254882452e-01   +6.962725207157583e-01   +8.141729093737532e-01   +8.035941900117852e-02   +3.634519819910165e-01   +6.896297644431953e-01; +4.412895061337461e-01   +6.092535261876445e-01   +5.564097616031495e-01   +6.844680543726814e-01   +1.644440534601477e-01   +2.661684179179508e-02   +2.866426708237487e-01   +2.422091143329816e-01; +2.742891720259590e-01   +3.765075374922877e-01   +5.685895328058685e-01   +3.126728774370546e-01   -1.478035199357786e-03   +4.826083644279883e-01   +1.941969060286939e-01   +4.504872324386360e-01; +1.980450644812951e-01   +4.581127735815539e-01   +7.867844595078836e-01   -4.839916489440144e-02   +1.647831421170425e-02   +5.793335751002817e-02   -3.186053071654835e-01   -1.626376143588922e-01; +2.039384956569730e-01   +3.849888475481148e-01   +1.758790231113296e-02   -2.915703873157474e-01   +6.301072520094430e-01   +4.649297674129335e-01   +4.972065545476628e-01   +9.812584517554415e-02; +9.039716423144050e-01   +8.060594653111838e-01   +5.460804564886035e-01   +9.092119117378128e-01   +5.827048624578444e-01   +7.051105786669456e-01   +4.488610859812444e-01   +8.030372065235492e-01; -2.403223728789262e-02   +1.691007183605787e-01   +6.792537682942452e-01   +2.092350706453514e-01   +7.215933897673422e-02   +2.918967295596410e-01   +4.529762353090568e-01   +8.575982138412717e-01];
L1I_L2I_iGABA_netcon = [+4.415360535587352e-01   +5.470326223790587e-01   -8.485015236054161e-03   +5.513195682006312e-01   +2.841073693882367e-01   +3.384265941650300e-01   +6.041884534413904e-01   +3.174557491585961e-01   -2.834597506252931e-01   +6.483845256529024e-01   +1.536716282426883e-01   +1.052390134398981e-01   +4.976620207395187e-01   +3.281469061280967e-01   +2.119783668955233e-01   +3.218690867273277e-01; +2.819912973900406e-01   +4.808834676577344e-01   +1.369294297176188e-01   +2.183082695541685e-01   -7.213912334415923e-02   +4.622071416792725e-01   +6.661014485837368e-01   +2.228540101844372e-01   +5.293065066527503e-01   +4.567358993287751e-01   +3.466840437286993e-01   +2.293088698337380e-02   +2.276102883542134e-01   -2.138537993001262e-01   -8.070272367205718e-02   +5.266120685511364e-01; +2.003633272464911e-01   +5.886169233160646e-02   +4.535904284240729e-01   +4.395334593027256e-01   +3.332454285833502e-01   +6.108300237682200e-01   +3.222324803207312e-01   +6.011742000858835e-01   +2.643272534021979e-02   +1.849756599312879e-01   +1.594386980212119e-02   +5.032230551662431e-01   +2.217490864129451e-01   +5.409439961905259e-01   +3.905909307164367e-01   -5.827903903576028e-02; +3.320591266262684e-01   +3.861194464416993e-01   +3.539925442632268e-02   +2.711256291199059e-02   +4.502038921201122e-01   +2.521713339120122e-01   +4.874962589592185e-01   +7.186826528003862e-01   -2.669748815191346e-02   +3.276292634510951e-01   +6.856506123264966e-02   +8.011776555724374e-02   +4.780780250098879e-01   +1.650070796102248e-01   +3.359598924195363e-01   +1.241469726806031e-01; +4.489516728370332e-01   +6.176879684011140e-02   +4.492952528684206e-01   +4.211539928036770e-01   +2.430768376103835e-01   +1.000000000000000e+00   +5.305780483615010e-01   +2.579857684083298e-03   +2.238858565772548e-01   +1.042801363726597e-01   +1.443483333529556e-02   +1.034788370940126e-01   -2.321092970933403e-01   +4.475221322189665e-01   +3.925982240547051e-01   +5.882916168088022e-01; +2.581730370085454e-01   +4.077668634328284e-01   +5.254781720369160e-02   +7.642816253048486e-01   +3.130523611267454e-01   +4.410840841091551e-01   +4.366630837938874e-01   +2.660484528668375e-01   +2.663856974412439e-02   +2.348643898203468e-02   +3.889977677203327e-01   +1.055283762554375e-01   +4.364533886761965e-01   +7.033229531819639e-01   +2.024119265851778e-01   +3.018897976767427e-01; +5.658637968625402e-01   +5.363240119959697e-01   +3.038906555607846e-01   +5.890552817187319e-01   +5.498657942420915e-01   +9.598632861565538e-02   +5.936328703291607e-01   -1.193196480854228e-01   +7.915901189832393e-02   +5.200780805063026e-01   +2.944280470647077e-01   +3.108024462764565e-01   +1.897640579103876e-01   +2.666969080532989e-01   +2.684491286851702e-01   +4.569028496591341e-01; +5.817806057936610e-01   +2.868462859724231e-01   +5.331950260386847e-02   +2.888857689363942e-01   +6.336050205409623e-01   +5.773116749261713e-01   +2.623404126620709e-01   +2.025969940652817e-01   -3.179146162071658e-02   +1.523339675710496e-01   +8.399480757180646e-01   +4.307071878959569e-01   +6.318494676446229e-01   +1.875160382835799e-02   +5.905170476476516e-01   +1.700730612141392e-01];
L2E_L1E_iAMPA_netcon = [+5.957949644013157e-01   +4.325291075801637e-01   -2.759572013922321e-02   +2.896599621794843e-01   +5.244047089307589e-01   +2.488971410588634e-01   +3.368580635556253e-01   +3.220985496027970e-01; -2.909572005437808e-02   +5.456406874101674e-01   -4.872367850494615e-02   +1.797343972860621e-01   +1.525161709313192e-01   -6.718373393730036e-02   +1.902630934616863e-01   +5.381682464735447e-01; +3.243620844108641e-01   +5.897241248324928e-01   +5.031583185695067e-01   +2.361379699085862e-01   -2.742327871991748e-02   +6.938961508180306e-01   +4.375955123083723e-01   +4.192252994621075e-01; +3.489339671467394e-01   +1.457024242762293e-01   +2.834498816001850e-02   +6.336063946912422e-01   +5.092853502685915e-03   +1.088662502997978e-01   +2.857988247424618e-01   +1.178108340100800e-01; +4.387899211965372e-02   +3.037106379451715e-01   +2.922579711000920e-01   +7.976707558116120e-02   +6.723658362282207e-01   +6.836940330312647e-01   +9.878785088951505e-01   +7.464340844126950e-01; +4.145448597053436e-01   -1.608725161915571e-01   +6.689309994977590e-01   -2.264672368870917e-01   +4.334653778673081e-01   +4.735540099224377e-01   +6.773252951292256e-01   +2.799661596257392e-01; +1.770548114857268e-01   +4.869158422544191e-01   -8.030778381150669e-03   +1.326275121104837e-01   -1.113440409299263e-01   +8.485281650972538e-02   +7.639941799359653e-01   -2.246228648495346e-02; +4.683254532406309e-02   +5.711210343447231e-01   +7.181629346567585e-01   +5.209084992322954e-02   +4.120713088111099e-01   +2.236279491002963e-01   +5.279242442159152e-01   -1.647049828313529e-01; +5.989053894157463e-01   +9.180823731519994e-02   +2.125704843118359e-01   +6.942238163537858e-01   +4.545116248098693e-02   +5.172335474470536e-01   +4.352161219537559e-02   +4.831093789724049e-01; +4.583207499542836e-01   +5.921523565423176e-01   +3.398076858548588e-01   +4.916008146648539e-01   +4.663445603485455e-01   -3.782937619427390e-02   +4.271011299903332e-01   +5.403837030231115e-01; -1.030886578733410e-01   +5.473569021108582e-01   +2.958785843166953e-01   +3.299557031558167e-01   +4.060239361516822e-01   +4.053075944582560e-01   -2.461421415314323e-01   +5.326660602650712e-01; +1.764539504195531e-01   +3.447768364012767e-01   +4.686699290068461e-01   +5.462793597357356e-02   +3.049197245895468e-01   +1.848500070931701e-01   -4.050555304441205e-01   +3.548215791357568e-01; +2.353752027342273e-01   +4.825243694323956e-01   +1.412509045591646e-01   +5.089206499322667e-01   +3.943992579296500e-01   -1.089446312821541e-01   +5.907400235084852e-01   -1.984177860219672e-01; +1.998675559627748e-01   +2.380575652772229e-01   +1.958797538592504e-01   +5.410727068061748e-01   +1.058748121908470e-01   -1.292440279545977e-01   +5.704584619789984e-01   +3.845061564709402e-01; +1.312625099445355e-01   +9.104689844303880e-02   +7.062353694248868e-01   +3.528786702773375e-01   -6.229873914292087e-02   +5.460050557518017e-01   +2.632465183576590e-01   +1.161132433638133e-01; +4.163725387821311e-01   -1.200082252196137e-01   +2.224852529615658e-01   +2.837264404949191e-03   +6.550635077979238e-01   +2.930164468650271e-01   +3.561224913998385e-01   +5.624018159484226e-01];
L1E_L2E_iAMPA_netcon = [+2.213562198168078e-01   +2.893737043066930e-01   -4.809474967641315e-03   +4.722193068002073e-01   +2.150763227753901e-01   +2.241145507246431e-01   +4.439392283681847e-01   +3.709387184631521e-01   +4.991629664099168e-01   +4.898729394953632e-01   +6.436067722262058e-01   +6.957319067885220e-01   +7.923393796226920e-01   +2.032125550674806e-01   -7.111405759386258e-02   +2.526234720060951e-01; +5.607082258510255e-01   -1.721129787449832e-01   +2.218167538115616e-01   +4.040889196653410e-01   +4.291619695305646e-01   -8.225550608692232e-02   +1.750370612331979e-01   +3.952833251051823e-01   +2.242767641746962e-01   +2.642352305062973e-01   +3.945597706716122e-01   +6.631357159916487e-01   +3.834374191107192e-01   +3.192266275364386e-01   +3.076098048056793e-01   +2.597834526424870e-01; +7.178045939299992e-01   +3.039884389231056e-01   -1.299765885762530e-02   +6.243360314939174e-02   +5.948963528036046e-01   +5.326774372879891e-01   +6.266345229585828e-02   +7.473486620486391e-01   +4.689265981481321e-01   +3.404517587642320e-01   +3.730412313232014e-01   +4.256934851337797e-01   +3.780719857412351e-03   +4.911247573103592e-01   +1.882644165034942e-01   -1.030024860509366e-01; +2.627499592874714e-01   +1.382645846939227e-01   +7.346808240114313e-01   +3.419447026607600e-02   +1.426240637958832e-01   +1.409752662868605e-01   +9.570817331569480e-01   -6.887578676373218e-02   +3.062246770761374e-01   +3.615205013668100e-01   +6.515161935345175e-01   +1.724491724982797e-01   +4.713273175729987e-02   +2.992477165106495e-01   +5.529975323962288e-01   +6.047123516374248e-02; +2.914139730705090e-01   +2.245810292441990e-01   +9.884461180333211e-01   +3.467798145330734e-01   +3.813653386717670e-01   +7.516808781194130e-01   +5.198583629786466e-01   +4.291572008282730e-01   +8.573417293995875e-01   +3.595109869728423e-01   +1.768650465978985e-01   +5.929001967465191e-02   +4.035705223233131e-01   +4.512146565575435e-01   +9.261938298393921e-01   +1.788273551140168e-01; +2.727237895111099e-01   +7.482940352636069e-01   +2.797106872230639e-01   +4.006734854568725e-01   +1.379610089279097e-01   +9.000973319964969e-02   +6.099161142161075e-01   +4.461087744059348e-01   +6.435466287083547e-01   +3.436615903993157e-01   +6.914673098532915e-01   +1.198558675263505e-01   +8.901752479338804e-02   -6.944604772979446e-02   -1.262968987670135e-02   +3.327769299002057e-01; -1.271749647570487e-01   +1.805115770649681e-01   +4.490158180684765e-01   +7.712589982422520e-01   +2.957013913771961e-01   +2.623627229827135e-01   +8.640613778851202e-01   +3.875488903950810e-01   -1.829964014675460e-01   +7.458419495320953e-02   -1.235949234813211e-02   -2.223006358352742e-02   -1.977708855886371e-01   +1.822433642806785e-01   +3.474558661062352e-01   +9.269997944341744e-02; +4.784511625534409e-01   +3.549002170477680e-01   +5.510852663591532e-01   +7.118205839113284e-01   +8.539620728619335e-01   +8.457722242259158e-01   +7.664363809798559e-01   +8.040922368687095e-02   -3.215286790877141e-01   +2.816792303547702e-01   +5.658866251386003e-01   +3.260971108864433e-01   +2.609625336630577e-01   -5.924245951677796e-02   +3.149565270829878e-01   +2.388009600365779e-01];
L2I_L2E_iAMPA_netcon = [+6.101339606254086e-01   +7.131803967554380e-01   +4.330846129101411e-01   +4.406634602148070e-01   +2.550124428844427e-03   +9.155178703993280e-01   +3.476463360709410e-01   +4.190035183461361e-01; +7.091559143600416e-01   +1.991334733104689e-01   +7.236018488737498e-01   +6.778881104608836e-01   +8.116169373952329e-01   +2.648913628599829e-01   +4.555232735100950e-01   +4.310935580191885e-01; +5.713500325093558e-01   +3.695463574666243e-01   +4.512276427910601e-01   +5.316374063851268e-02   +1.113616616566040e-01   +5.518968142939015e-01   +4.718094530109312e-01   +2.861969404402014e-01; +5.256849722326925e-01   +5.199530978462782e-01   +2.236798105865899e-01   +9.573187039154150e-01   +1.720058748612590e-01   +1.911301483787920e-01   +4.467728192996327e-01   +4.915688272409092e-01; +7.582941193328032e-01   +4.547326866818013e-01   +3.160896148604084e-01   +6.693672437902202e-01   +6.473600850788150e-01   +7.248611983617933e-01   +9.344786271578909e-01   +2.058416972538691e-01; +3.852309156770500e-01   +5.796847722644672e-01   +3.134601504026785e-01   +6.700747720970213e-01   +2.228033055022667e-01   +3.556354909646307e-01   +4.594813580886560e-01   +5.369895201141586e-01; +7.030823930182669e-01   +1.476755772492847e-01   -9.327888898977922e-02   +8.127463516157424e-01   +6.712558027860978e-01   +3.505029817820950e-01   +1.000000000000000e+00   +1.929868585000973e-01; +9.637518337542089e-01   +2.731869044757668e-01   -1.629853667164405e-01   +5.781325190256955e-01   +3.069753653420589e-01   +5.470842196423148e-01   -3.286844010228352e-01   +7.428873869342405e-01];
L2E_L2I_iGABA_netcon = [+1.146040791572358e-01   +3.265375003797077e-01   +4.272980292108940e-01   +3.633877251759283e-01   +1.645113364747658e-02   +5.417268249228041e-01   +1.323595405598237e-01   +6.699191742460575e-01; +5.114989942236977e-01   +6.737215962020123e-01   +6.089278691996193e-01   +6.281550449481010e-01   +6.868054428346526e-01   +5.171875949000405e-01   -1.028716128838246e-01   +2.300331104847944e-01; +1.177682731024489e-01   +8.111545431298739e-01   -1.715005434777273e-01   +6.097848694877029e-02   +7.295252043647160e-01   +7.275247382798855e-01   +1.227147561880267e-01   +7.886733665013024e-01; +6.293158028942700e-02   +8.114273050723405e-01   +6.630584960143772e-01   +5.430281144949493e-01   +1.000000000000000e+00   +4.946218556155908e-01   -5.336177279429354e-02   -1.027960965522565e-01; +2.559694949586392e-01   -2.395749987951201e-01   +1.023275623247460e-01   +5.906142618819757e-01   +4.446755462727058e-01   +2.477302653245445e-01   +4.200929401805044e-01   +7.427287682700330e-02; +1.027528231854552e-01   +2.478026803766657e-01   +2.308703127015716e-01   +3.117851065822950e-01   +4.051626062055499e-01   -1.358176096865461e-01   +5.772325277557917e-01   +8.118712087416549e-02; +6.986287214896933e-01   +3.022537166593099e-01   -8.195862544935857e-02   +2.411050891438137e-01   -5.922463194612479e-02   -1.270957837939142e-03   +4.889199893904028e-01   +7.819429886549289e-01; +4.920147762074714e-01   +5.510879859985487e-01   +4.604697494933567e-01   -4.117660393454551e-01   +6.006044791378851e-01   +3.953912184037205e-01   +7.595478096072997e-01   +5.979498136555164e-01];
L3E_L2E_iAMPA_netcon = [+3.448093489281480e-01   -4.495130159966844e-02   +6.410216968588607e-02   +6.331121535033611e-01   +5.551707289565440e-01   +1.693629427962193e-01   +3.379685316200106e-01   +6.573665491032533e-01   +4.162899284757081e-01   +1.875171872083801e-01   +4.075477329699462e-02   +6.785231231476044e-01; +4.852780951062807e-01   +8.022352870984376e-01   +2.023646353479867e-01   +1.818727408730781e-01   +2.267939008427740e-01   -7.804765407519745e-02   +2.336617498200610e-01   -4.294868878771154e-02   +3.915695269992628e-01   +8.673962435116998e-04   +2.749647864639985e-01   +3.392715933660752e-01; +1.561245914621316e-01   +1.918610536318007e-01   +6.961944816454972e-01   +3.210973890300743e-01   +7.972110925552562e-01   +4.836110709094134e-01   +6.077498785468900e-01   +5.175188245415878e-01   +5.193111545717666e-01   +1.038131262187683e-02   +1.103820566599202e-01   +5.818948289440263e-01; +1.847046919794365e-01   +3.881840698849237e-01   +3.411960410950044e-01   +1.087697988872497e-01   +4.573118332580556e-01   +2.357089510603990e-01   +2.120654537633889e-01   +4.337565843254656e-01   +3.160250867940746e-01   +4.443567074744414e-01   +1.134305823403776e-01   +1.177780814946082e-01; +6.406784533063532e-01   +3.441832165273028e-01   +2.800636339701070e-01   +9.892910878527067e-02   +5.303283969473257e-01   +5.036120047205214e-01   -2.001403853475780e-01   +6.655448695263577e-02   +5.221382611196569e-01   +4.983478742139200e-01   +7.552645001028021e-01   +7.238215597890963e-01; +4.613994649637995e-01   +6.446458705263098e-01   +7.256475443564228e-01   -4.776018630525622e-02   +5.211588695679962e-01   +9.623019910293176e-01   +3.841320720291050e-01   +9.606901985588842e-02   +1.228935738313095e-01   +5.046099152434257e-01   -4.988707963012522e-02   +4.449464782079947e-01; +2.934879594929575e-01   +2.858532551891934e-01   +7.595896692953267e-01   +5.141972776731521e-02   +1.043807875150132e-01   +6.078913866063703e-01   +3.456252113633902e-01   +4.603804836381645e-01   +5.633628068633759e-01   +3.799817822551333e-01   +1.823022014693953e-02   -6.360202796031812e-03; -2.128791783919620e-01   +4.633951807777831e-01   +6.572397678031475e-02   -2.226245698591365e-01   +1.542840283978392e-01   +4.524756150809182e-02   +2.846068973802298e-01   +7.412487104618443e-02   +9.157637840701902e-01   +6.151644758309639e-01   -2.173189320924568e-01   +2.389410165549857e-01];
L3I_L2I_iGABA_netcon = [+6.085785924656947e-01   +4.803298971768270e-01   +2.999604136680747e-01   +7.710602983882082e-01   +2.366081773005868e-02   +3.354859268992662e-01   +6.737686743566709e-01   +6.149568332908542e-01   +6.230943284729676e-01   -1.308461096877128e-01   +4.073724750895605e-01   +7.491313561080872e-01; +3.847826836481032e-01   +3.321216044458106e-01   +2.730630896970640e-01   +3.584661383365146e-01   +8.315697453110179e-01   +2.965972132946560e-01   +4.510188242668359e-01   -3.505411773465179e-02   +3.549439132450013e-01   +3.248058345255732e-01   +4.665270635346616e-01   -3.273486644446176e-01; +2.454188503570669e-01   +5.819734172492295e-01   +7.185173835204718e-01   +2.286260583126027e-01   -1.875234461219315e-01   -4.176514812811776e-02   +5.641614228943627e-01   +7.290581395212838e-01   +1.393917941179381e-01   +2.583555096782093e-01   +1.456865822442628e-01   +6.316946196399030e-01; +4.200085007940760e-01   +7.779640048294606e-01   +3.053137313670064e-01   -7.407041786578718e-02   +1.997085878983341e-01   +7.627669777873674e-01   -8.501587740277171e-02   +6.310661260174369e-02   +4.920918360993216e-01   +2.064263638068698e-01   +3.908589984251694e-01   +4.449211234456834e-01; +1.584229657762339e-01   +1.850452696835651e-01   +3.762536346850689e-01   +5.733426476416182e-01   +6.203405611781455e-01   +9.068808237199596e-01   -2.688791703105278e-02   +1.000000000000000e+00   +5.892187434490924e-01   +2.755740094952444e-01   +3.066649059472924e-01   +9.083998819272248e-01; -2.440058966472874e-01   +7.152345968275645e-01   +2.467754048759538e-01   +4.608722198684099e-01   +9.227768053074170e-01   -4.475373661782510e-02   +2.968872172839392e-01   +5.069690753027555e-01   +2.505231443545008e-01   +2.582616881295052e-01   +3.907525565354308e-01   +6.922134062236008e-01; +5.127848465592922e-01   +3.841115335407371e-01   +8.637064100736978e-01   +3.196339134917570e-01   +5.123727993388150e-02   +5.417344679879473e-01   +8.698436922880620e-01   +1.609190883421938e-01   -1.581032481437064e-01   +3.448151012144910e-01   +3.851281264251577e-01   +3.909352387365433e-01; -1.014102277106604e-01   +2.266766537038899e-01   +9.143373736631292e-01   +6.776775178352360e-01   -2.982314633605848e-01   +7.380709150505432e-01   +4.053620678513142e-01   +1.916909425950060e-01   +6.324658058253999e-01   +3.012927054655617e-01   +4.590756871616354e-01   +3.718923414358206e-01];
L2E_L3E_iAMPA_netcon = [+4.039613382181651e-01   +2.043450135922488e-02   -1.084794444493145e-02   +1.714823188504478e-01   +9.354532967698549e-03   +6.217515245946905e-02   +1.995636689886130e-01   -2.127863851719727e-01; +2.750719298793344e-01   +4.786324314616399e-01   +3.400612259161159e-01   +1.461629631903361e-01   +5.120859527404598e-01   +1.924321391513992e-01   -2.041125573340888e-01   -3.634574159049978e-02; +4.980380230121056e-01   -8.037091739117790e-02   +4.600356982248803e-01   +7.291336827858644e-01   +3.563204621372420e-01   +4.111345796484973e-01   -2.509195065746042e-02   +5.244372550042139e-01; +1.068783932557019e-01   +4.250934501139866e-01   +5.261618534726987e-01   +8.425025931846192e-01   +6.125592266780546e-01   +3.643045619743323e-01   +1.638041860936054e-01   -1.257394382412698e-01; +4.739581129841819e-02   +4.417065813195714e-01   +5.069121788807770e-01   +9.500562741326340e-01   +8.100257915791417e-01   +2.168059375159550e-01   +7.736731507822753e-02   +5.684544267883908e-01; +3.604844785226246e-01   +7.093273263337787e-01   +1.000000000000000e+00   +6.368715797860672e-01   +4.365985846321452e-01   +5.383104465198659e-01   +7.271862296455118e-01   +3.435975695598660e-01; -1.298573778480762e-01   +2.539488922931455e-01   +7.675822710363918e-01   +6.734939041000525e-01   +1.782692159033795e-01   +2.002263886383757e-01   +2.350123818013105e-01   +2.369820343715193e-01; +4.902686798905534e-01   +4.331173250528873e-01   +2.309827218086766e-01   +1.921342779698663e-01   +6.025319453174914e-01   +3.336851417613295e-01   +4.656007973414492e-01   +8.113601613204929e-01; +5.872120202120983e-01   +2.486101534799793e-01   +2.790868038677833e-01   +1.620484514996873e-01   +1.065277565360502e-01   +7.232207833943484e-02   +6.468555679556102e-01   +2.757269134928568e-01; -1.248902491860793e-01   +3.215059775180071e-01   +3.097258219217334e-01   +5.527561437487637e-01   +1.276116704871889e-01   -1.135280274002336e-01   +7.040631616543468e-01   +2.361865253514019e-01; +4.005176730772236e-01   -6.708031957064643e-02   -3.757762575471994e-02   +5.890090604367761e-01   +6.731636521411790e-01   +5.402691239962036e-01   +8.177500128247549e-02   +5.653464811929213e-01; -1.683859355625906e-01   +6.466469359924877e-01   +7.730478200197420e-01   +5.240357071313922e-01   -3.332252514788407e-01   -5.602685028548920e-02   +1.519575176390298e-01   +4.017206488896122e-01];
L2I_L3I_iGABA_netcon = [-7.439223959335588e-02   +2.365195176012592e-01   +7.416406148739617e-01   +7.085078555827009e-01   -1.384493442456372e-01   +5.015304406534069e-01   +3.163095354732825e-01   -1.906364114639265e-01; +1.861518398178515e-01   +2.890657695924532e-01   -6.326720694828959e-02   -2.671172753736593e-02   +4.693321624012512e-01   +1.717855683006215e-01   +2.033711068264200e-01   +1.071695813679944e-01; +6.444583906827495e-01   +4.283063072889122e-01   +1.486468483747086e-01   +3.708838899092161e-01   +4.093543799945140e-01   +1.000000000000000e+00   +3.025608112693049e-01   +2.730241720814152e-01; +4.645989084498828e-01   +3.591928218968654e-01   +6.647670022206229e-01   -1.601829510264874e-01   +4.287445219344258e-01   +3.543755658145775e-01   +1.475271371737507e-01   +5.298396454766633e-01; +8.520315001322267e-01   +8.049287354067732e-01   +4.263183104140548e-02   +1.920824360642091e-01   +3.978744494201378e-01   +4.870992402998960e-01   +2.244683874332568e-01   -1.152939871482663e-01; +2.557494301620390e-01   +3.422499404993580e-01   +8.056673194796713e-01   -3.908933600289863e-01   -3.892851089826892e-02   +5.140301151604556e-01   +1.929187723140485e-01   -1.805246674867852e-01; +7.774450779341617e-01   +5.895475630546896e-01   +1.435877988322243e-01   +6.461001864390343e-01   +2.613953731769704e-01   +4.607198510614985e-01   +6.169513414094974e-01   +4.361341211990876e-01; +8.806909056857700e-04   +4.307576363496632e-01   -1.417903926686298e-01   -1.793971478389322e-02   +4.912555738660487e-01   -2.438707338940524e-02   +2.756928109008158e-01   +5.033950880870933e-01; -3.147602615948370e-01   +5.098484420189717e-01   +3.889502626118374e-01   +7.034728802771421e-02   -2.623443548393975e-02   +6.689373581295768e-01   +5.757421683808266e-01   +4.005807630638711e-01; +5.531126728505175e-01   -2.342659120064183e-01   +2.716751466897722e-01   +1.393830544853980e-01   +4.710965865658272e-01   +5.639313417536390e-01   +7.304959007298097e-02   +5.317118158957324e-01; +4.764018784352715e-01   +2.667217199232100e-01   +1.677387696821289e-01   -1.907233275831421e-01   +4.288227406567308e-01   -8.241456561317446e-02   +2.563787078210135e-01   +8.184156474591893e-01; -3.030762330812070e-02   +5.744944542824576e-01   -3.480713172699691e-02   +3.027139227922513e-01   +7.948914756019424e-01   +2.768925522509812e-01   +2.301058045630552e-01   +1.430178810066166e-01];
L3I_L3E_iAMPA_netcon = [+6.066705046035185e-01   +5.951833851204602e-01   -1.279053733463383e-01   +5.013066120702666e-01   +1.458247098588396e-01   -5.795528588858505e-02   +2.204972201460081e-01   +7.600704690065185e-02   +1.995342999530598e-01   +3.779860725660320e-01   +1.234909754798761e-01   +4.048928514417017e-01; +3.220563315925880e-01   +4.024414112909315e-01   +4.743421349841017e-01   +4.751419221598713e-01   +9.891297337756307e-01   +3.535962972353995e-01   +4.839086515511385e-02   +5.102031075900760e-01   +7.625362155434448e-01   +2.543419220020050e-01   +7.093556919796912e-02   +3.974977029141381e-01; +4.963567065328389e-01   +7.406376744438294e-01   +1.000000000000000e+00   +4.368936173363523e-01   +5.858333636106284e-01   +4.655986256846273e-01   +5.835319827468580e-01   +4.816330712395396e-02   +5.140541682194820e-01   +8.407254786932173e-01   +3.355956171673191e-02   +6.503631240767841e-01; +3.949461672585612e-01   +4.300797292116371e-01   +2.552629953455744e-01   +3.528368301489902e-02   +3.640315162737416e-01   +5.042755141249723e-01   -2.825883723650211e-01   +2.391302125502585e-01   +2.675644059127000e-01   +4.433217928603100e-01   +4.086493502290657e-01   +2.352862562054781e-01; +3.258703437028607e-01   +1.383444149574676e-01   +7.292295788488025e-01   +3.633970202709575e-02   +3.748275124142167e-01   +3.233794014465873e-01   -1.375347817328539e-01   +2.768616372716412e-01   +4.978749956561640e-01   +5.671964079843513e-01   +5.476156725932884e-01   +6.806099814267748e-02; +1.455999178621903e-01   +4.652456519931016e-01   +3.715872771823951e-01   +4.164642410102016e-02   +2.398909733452415e-01   +4.112103316603120e-02   +5.629700532089129e-01   +1.667867414426073e-01   +3.444124770571069e-01   +1.548766286196775e-03   +4.427077794313307e-01   +3.350078383904650e-01; +9.489329363391877e-02   +4.092619181418716e-02   -6.703924104234756e-02   +2.762763608150332e-01   +4.305060461568635e-01   -5.396729220304645e-02   +4.173640979440338e-01   +2.211222939293849e-01   -1.787096899884091e-01   +9.940818806372059e-02   +5.111786372483725e-01   +3.258551770678064e-01; +6.615699178466098e-01   +3.834540156410013e-01   +3.427669371754495e-01   +4.984617579184852e-01   -2.280184373977512e-01   +5.173475171412331e-01   +1.117307932720799e-01   +5.097579937366710e-01   +1.082420066561775e-01   -2.356719110975802e-01   +5.449961634484948e-02   +5.087876014038469e-01; +1.384070431302368e-01   +6.506794777264611e-01   +1.386776414001650e-01   +7.113587354908584e-01   +2.633070267144838e-01   +4.448465252595703e-01   -1.573222359139306e-01   +5.338821845439861e-01   +5.356756541958718e-01   +6.263254662177279e-01   +4.241485461189778e-01   +8.859254962583964e-01; +8.249817035865894e-01   +6.989344724996982e-02   +6.749200895401735e-01   +7.189970032656251e-02   +5.721946274698607e-01   +4.918773929931604e-02   +6.090953856426977e-01   +2.809397994054741e-01   +4.796528262595506e-01   -1.136989469941560e-02   +6.449752061751189e-01   -1.404627260810063e-02; +1.303739951518687e-02   +4.169563257368450e-01   +4.355198427617517e-01   +2.928027843268482e-01   +7.713441384510514e-01   +1.510161999834902e-01   +3.451211498526220e-01   +6.199315691294314e-01   +8.023555739421773e-01   +3.526844280888233e-01   +6.429336148986790e-01   +7.955860953498679e-01; +3.828320428178207e-01   +8.933354057037443e-02   +3.135410787959388e-01   +3.335622668361562e-01   +1.018687971761383e-01   -1.889967435315116e-02   +1.255195795728936e-01   +4.070912951624509e-01   +6.498457568994086e-01   -1.360678667274278e-01   +5.562607636607614e-01   +2.454487420160253e-01];
L3E_L3I_iGABA_netcon = [+7.465017623758294e-02   +9.432222567453641e-01   +4.580443758878703e-01   +2.990827139072247e-01   +4.386403675383153e-01   -1.095990777928165e-01   -1.326871368061262e-01   +3.869274629222663e-01   +1.758383216235164e-02   +4.713642786183085e-01   +2.045558134742417e-01   -1.532705077337577e-02; +5.483123394675466e-01   +3.735610295348574e-01   +7.177171050485467e-02   +1.164412618753837e-01   +3.218228999258624e-01   +1.258237670796870e-01   -2.526259688791959e-02   +4.205830103949142e-01   -9.238924490876608e-03   +2.172242595242389e-01   -3.857160080570945e-02   +1.632817951330225e-01; +5.667239402401215e-01   +7.549822013411804e-02   +6.396011184972064e-03   +4.071449910869297e-01   +7.414282858054319e-01   +3.386042964378289e-01   +6.489494080880149e-01   +3.605777963609358e-01   -8.282979607331536e-02   +5.229173433388343e-01   -2.955820051616654e-01   -1.771556286006361e-01; +2.754609019843325e-01   +5.659875185915150e-01   +1.293727773979123e-01   +3.919750263249232e-01   +8.192588055304530e-01   +4.409150680409989e-01   -1.430620751966027e-01   +2.597027874372256e-01   +6.414243616288173e-01   +7.172455752302062e-01   +2.316520733296347e-01   +5.041681537877100e-01; +4.627128058129112e-01   +1.706149596407724e-01   +3.397740876621460e-01   +7.180161308819309e-01   +1.544659573512632e-01   +3.828292669374814e-01   -2.455042156118170e-01   +4.256614020437525e-01   +4.667080495695519e-01   +6.495783569063924e-01   +3.334414383201881e-01   +2.053437266406966e-01; +3.387025066153798e-01   +3.837889772220834e-01   -1.764806833015786e-01   -2.341011467856330e-01   +6.681498099308413e-01   +6.863004610382956e-01   +4.536739362273091e-02   +3.143389056146465e-01   +5.950056957074566e-01   +5.246991518598506e-01   +3.846806971628702e-01   +2.031831863701647e-01; +7.181309206599902e-02   +2.020250536169655e-01   +4.453652619779399e-01   +1.000000000000000e+00   +3.770111077295026e-01   +4.344590798635845e-02   +7.350190032722278e-01   +5.727739019162619e-01   +1.847561920503907e-01   +5.673293295151071e-01   +6.528163949799186e-01   -2.314793069997815e-02; +1.601572573853929e-01   +1.848141311139435e-01   +4.271080514100519e-01   +4.837035849150519e-01   +5.765727140365555e-01   +2.713117446601261e-01   +4.983317796052275e-01   +8.832336471772460e-02   +3.135960553733295e-01   +4.699974052610206e-01   +4.580573531865490e-01   +2.384380454584068e-01; +3.882297484246078e-01   +5.283000940662141e-01   +3.189691445042479e-01   +1.053691465825778e-01   +4.405387834679992e-01   +1.792357050763134e-01   +2.379962876197321e-01   +1.228542015665683e-01   +6.136531773266370e-01   +7.932314572969302e-01   +6.872156279525339e-01   +3.990918436972479e-01; -1.603276287564463e-01   -1.748572746564428e-02   +6.443903296845980e-01   +1.692989758527932e-01   -4.429561843256475e-02   +2.864145091781251e-01   +4.771529884758202e-01   +4.681070046106059e-01   +2.731342478371672e-01   +1.428179775907186e-01   +3.611296510150686e-01   +7.999319973835098e-01; +3.645906989224966e-01   +2.292296136858402e-01   +2.777477453185085e-01   +1.132856444190564e-02   +4.706947182463684e-01   +1.198323337846981e-01   +2.716855892109933e-01   +4.156465222699272e-01   +2.557088309533550e-01   +6.607196972160976e-01   +1.091811938368699e-01   +2.621104187229007e-01; +2.854941842683020e-01   +5.654834459294432e-01   -5.466425781639958e-02   +6.104596834710155e-01   +7.341683402391439e-01   +5.301061083718382e-01   +5.198862083289917e-01   +1.414660209930840e-01   +4.781550572509798e-02   +1.096559750582230e-01   +2.264503789201708e-01   -7.570833310835851e-02];
L2E_Input1_iAMPA_netcon = [+5.594018636773787e-01   +6.274300087589809e-01   +7.491536576079959e-01   +7.340357146676455e-01   +8.963791101218149e-01   +1.000000000000000e+00   +6.753845057642435e-01   +8.953800665965045e-01];
L2I_Input2_iAMPA_netcon = [+6.636043504717416e-01   +7.243204261438020e-01   +8.424617156082949e-01   +7.398417381854230e-01   +5.085084689362879e-01   +9.940496095327729e-01   +6.106039904309016e-01   +7.171815676484069e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.2*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.2*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.2*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.2*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.2*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.2*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.2*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.2*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
