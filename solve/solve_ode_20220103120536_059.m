function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+5.404598882841332e-01   +1.118627638457109e-01   +4.847019165900703e-01   +4.970867361976518e-02   +7.706394812383209e-02   +4.234976828027797e-01   +1.339903098876690e-01   +3.081653879055340e-01   +1.838586202400349e-01   +5.706908718744398e-01   -2.324979389379623e-02   +2.249759761940869e-01   +2.091594075168514e-01   +4.032643623915635e-01   +3.633408639094819e-01   -8.189290369133324e-02; +4.815414349317821e-01   +2.438576797998207e-01   -1.904695563942689e-01   -2.277307179275148e-02   +4.851347817755924e-01   +3.999040170545417e-01   -2.336047029229040e-02   +2.713615034506945e-01   +4.056603509991498e-01   +2.101479444608332e-01   +3.481558761632770e-01   +3.800686813538182e-01   +3.416664999889642e-01   +7.030400769243723e-01   -2.141638736558255e-01   +2.933242928006995e-01; +4.408197937296080e-01   +4.060512109679101e-01   -1.535001899207981e-01   +2.433622006455680e-01   +4.727062080028661e-01   +2.136963043096294e-01   +1.147739514127666e-01   +2.196113626389359e-01   +1.330103290150404e-01   +5.244014646238128e-01   -3.814490826139597e-02   +9.717434772055041e-02   +4.046918055463224e-01   +4.091654240396703e-01   -1.003996919543033e-01   +3.309337457355921e-01; +4.981481565397175e-01   +1.442454231096943e-01   +5.142011797906562e-01   +1.000000000000000e+00   +5.746323423309080e-01   +4.401590773730447e-01   +7.187683613544109e-01   +8.042142797393920e-01   +8.174353352083970e-01   +3.834708462252046e-01   +3.928894628055605e-01   +1.941774144049053e-01   +2.817027495946479e-01   +3.894139070752474e-01   +1.838516795630265e-01   +3.100999212278294e-01; +3.813650574410404e-01   +5.345407105674526e-01   +3.413092624589096e-01   +8.721068011200841e-01   -2.082575906394210e-02   -3.025840186915165e-02   +8.919181672235799e-02   +8.308610280173616e-01   +3.892175136049109e-01   +3.010756367853317e-01   +8.335015068886891e-01   +3.394040610832583e-01   +6.181887146464310e-01   -5.246006088454946e-02   +1.069088719238926e-01   +5.881246631743001e-01; +2.085382428895630e-01   +3.449017184586334e-01   +4.398484089628282e-01   -1.222464508076817e-01   -4.087340845355695e-03   +6.437501447857999e-01   +2.726517866867328e-01   +4.669447166398142e-01   +3.299659722785406e-01   +4.048152413025093e-01   +8.343909126506151e-02   +4.598668946711161e-01   -2.698843316447608e-02   +3.619587662081675e-01   +2.732489816483149e-01   +6.616201044326063e-01; +4.578901293097101e-01   +5.836936221490380e-01   +1.966544525106665e-01   +2.578027348733509e-03   +3.662834639062750e-01   +5.009228849070073e-01   +5.343156529507377e-01   -8.217300187762167e-02   +1.806677430201051e-01   +2.646970266042737e-01   +4.954677805210636e-01   +4.290874824324448e-01   +4.923934311098908e-01   +1.230754695781080e-01   -5.290025746308101e-02   +3.588257833275815e-02; +5.935782062869991e-01   +6.777258529296992e-01   +2.984129495260505e-01   -9.616289774044438e-02   +2.871196579888026e-01   -6.150491281905021e-02   +3.786456538870731e-01   +1.950292412703120e-01   +3.270814731001686e-01   +4.892470870791324e-01   +2.102942933459613e-01   +1.587753293178867e-01   +2.865764252141247e-01   +2.116662698681678e-01   +1.419762342835777e-02   +5.472169652258426e-01; +2.730035471820131e-01   +3.669091051893538e-01   +3.272264947400343e-02   +3.342899066630616e-01   +5.577188728027487e-01   -1.004645342573586e-01   +3.309252710853997e-01   +4.274837221814723e-01   +2.088599092191878e-01   +1.177747672326667e-01   +4.305950297921577e-01   -1.658264778544242e-02   +1.588991856613726e-01   +2.805089058918412e-01   +2.892388658337173e-01   -2.772765025965241e-02; +2.904796791721623e-01   +5.610217410289106e-01   +2.514452070678868e-01   +2.872340390407403e-01   +4.461668827271427e-01   +4.723827297506964e-01   +6.141037956649300e-01   +2.403871508226650e-01   -2.191576770561689e-02   +1.588907385754799e-01   +2.535697853179893e-01   +4.256737760495288e-01   +5.894488202829569e-01   +5.053842512727504e-01   +2.997155003271325e-01   +4.364440285871607e-01; +3.356389328806957e-01   +2.971694610623007e-01   +1.359319446895178e-01   +5.462926053578961e-01   +5.331218550297988e-01   +1.806408923565103e-01   +3.253542913406714e-01   +6.163561108246406e-01   +4.104430513960101e-01   -2.157959616469431e-01   -1.274444088697727e-01   +5.001670903507697e-01   +4.465937292967030e-01   +3.131797523644339e-01   +3.095787110315213e-01   +1.846354687528731e-02; +1.834280952983283e-01   -6.798992337589828e-02   +3.570093168385376e-01   +4.296078595473552e-01   +3.152285839068699e-01   +5.019213341755241e-02   +1.524234617696376e-01   -1.874818813369159e-01   -1.246766419966129e-01   +4.445479452451331e-01   +2.347497924563252e-01   -2.405904442354190e-01   +5.607130998665860e-01   +6.041387496680859e-01   +5.699505686798120e-02   +2.781314529099631e-01; +1.236205578299984e-01   +2.035343379355289e-01   +8.948242054586681e-01   +6.756810083541546e-01   +4.836608707356192e-01   +8.139244667416436e-01   +2.616953492295528e-01   +3.047149544633682e-01   -2.666931443868624e-02   +1.194071838104280e-01   +3.121525144125873e-01   +6.169125211083374e-01   +4.484611958933544e-01   +4.742384957402825e-01   +3.211630284816057e-01   +2.698714733603925e-01; +4.114133435380847e-01   +6.797100176432275e-01   +4.690839064187561e-01   +4.489126861774941e-01   +6.839491863524177e-01   +4.199312370123361e-01   +1.921809618897211e-01   +1.201469498366943e-01   +4.600333408170016e-01   -8.843194772106112e-02   +3.870067137486186e-01   +9.759303520674317e-02   +1.551460546584838e-01   -8.577021482150347e-02   -8.673170688452940e-02   +4.416219028815237e-02; +7.620161215675825e-02   +3.891386096382398e-01   +3.121579985526232e-01   +4.836784419265938e-01   +3.109420642173188e-01   +8.107393417595959e-01   -9.712315623473712e-02   +1.409410537343670e-01   -9.894726722001849e-02   +4.009976491167114e-01   +4.435392391358619e-01   +6.682845628211674e-01   +4.952957283551991e-01   +6.893424420565630e-01   +3.040249063232566e-01   +1.407275551752059e-01; +4.450220772358517e-01   +1.282509932205237e-01   -4.178036695447099e-02   +5.378520601417826e-02   +6.492860875726498e-01   +2.766197705689767e-01   -4.716633462585045e-03   +7.465215705744133e-02   +3.787520388301069e-01   +3.848366037462140e-01   +3.055041522518840e-01   +3.246747402644674e-01   +4.399751680517388e-01   -2.727425572846162e-01   +5.733716117053420e-01   +2.589330264780746e-01];
L1E_L1I_iGABA_netcon = [+3.957305663900433e-01   +6.303625340784125e-01   +6.718077180860665e-01   -9.365989618664801e-02   +6.839641792034858e-02   -1.283935685550260e-01   +5.308280291414272e-01   +1.423713584426002e-01   +6.898747128673247e-01   +5.331602898398835e-01   +6.135864924330227e-01   +5.200270504250487e-01   +6.363900658220998e-01   +2.865328739873940e-01   +3.960487954008731e-01   +1.435711775444750e-01; -3.065901101309274e-02   +2.736992979203680e-01   +1.961314568621678e-01   +2.758243867018235e-01   +2.499572058939090e-01   +3.143348549369344e-01   +3.560100014255203e-01   -3.346083364401431e-01   +8.534875622323606e-01   +3.727096790375542e-01   +5.360134082615005e-01   +6.601332371174247e-02   +3.771623102144011e-01   +2.031107481384073e-01   +2.688755819409575e-01   +3.269667088572750e-01; +6.344441411599558e-01   +3.901793662685968e-01   +5.298416516796532e-01   +1.087365177172228e-02   +5.515971607020050e-01   +7.584556014299868e-01   +2.719212357224663e-01   +2.122565874759193e-01   +3.671500509762735e-01   +1.403307356362881e-01   +7.000133791822537e-01   +6.555354989308656e-01   +7.038292480680007e-01   +1.262250567287372e-01   +6.034091774027633e-01   +6.366646774907860e-01; +8.321451450145083e-02   -4.594106265998252e-02   +7.635048006935485e-02   +5.509622462403079e-01   +5.687463732257825e-01   +2.242782754596780e-01   +6.991105147824791e-01   +3.400347000058976e-01   +5.381341473647897e-01   +8.347021159541219e-01   +1.799569398625394e-01   +2.513015854155801e-01   +6.865144006894833e-01   +3.351489812751440e-02   +4.111816578948042e-01   +5.667226545558343e-01; +7.535067928244661e-02   +2.194928990431677e-01   -1.093982016773212e-01   +2.518840326921495e-01   +3.833432727542652e-01   +5.193603137857937e-01   +6.808461988546791e-01   +5.141926767238642e-01   +3.211240688645781e-01   +5.882770800091841e-01   +2.059072234539932e-01   +5.934044620098092e-01   +2.756061825418501e-01   +3.316875702290203e-01   +3.953000331252489e-01   +2.378263155382281e-01; +6.352055137627376e-01   +3.747466453471908e-01   +3.274736590217889e-01   +7.538134340221353e-02   +3.100351243273672e-01   +1.056149766067184e-01   +3.963196850628988e-01   +3.334943812763090e-01   -5.164473555280623e-02   +6.952724908093695e-01   +3.681774393855587e-01   +3.092205453272430e-01   +9.023926609857151e-02   +4.180054383020660e-01   +4.783757683436355e-01   +5.333041464037607e-01; +1.064983287680555e-01   +6.171371645743911e-01   +1.093800138452141e-01   +2.582914468933642e-01   +8.980458006320130e-03   -4.525190975806329e-01   +8.441574575385009e-01   +5.589651944949633e-01   +4.185761305281395e-01   -1.257247343376567e-01   +1.817934506694915e-01   +1.523533918325080e-03   +1.769930249960572e-01   +5.760780133988579e-01   +4.665548897957496e-01   +3.799136648485201e-01; +3.405718305081968e-01   +7.536049891587894e-01   +7.936409161532141e-01   +2.332878433303884e-01   +2.497714398952426e-01   +5.993997820397775e-01   +7.180146698416114e-02   -1.882311366273250e-01   +2.304468188566351e-01   +3.970451123847546e-01   +7.317329725539683e-01   -7.612675188425561e-02   +5.521344151908489e-01   +7.641522041779829e-01   +2.776338778762300e-01   +7.419896405073895e-03; +7.353668245546625e-03   +6.705651339295335e-02   +3.647131192889831e-01   +5.400802186954597e-01   +5.770103130171381e-01   +1.842057360019547e-01   +5.907145797672341e-01   +2.256387820364657e-01   +6.199728955685224e-01   +4.869403689021645e-02   -1.077964088795979e-01   +3.185385790173341e-01   +2.786322533462039e-01   +6.726888002966690e-01   +3.486499626740006e-01   +1.166865458612490e-01; +1.305577422176503e-02   +8.184700596293564e-01   +4.694349296267261e-01   +2.674719467168955e-02   +2.883173488963427e-01   +5.080271651673528e-01   +1.743238361286828e-01   +6.949020054373177e-02   +2.823243945511190e-01   +3.753107190293530e-01   +3.657661123689974e-01   +6.861063380021227e-01   +4.018532503520184e-01   +2.899384680080885e-01   +3.638636587363699e-01   +3.320805433527362e-03; +7.460885667931379e-02   +6.522434788004794e-01   +7.682398030731317e-01   +5.651306802796942e-01   +4.041383044861060e-01   +1.262834432694014e-01   +6.099362149545549e-02   +6.509785620732710e-01   +5.251659821854350e-01   +4.913602678431105e-01   +5.649257312989013e-01   +4.647812698977408e-01   +1.402303715782098e-01   +5.762459130015036e-01   +2.147372966086382e-01   +6.134901933497243e-01; +6.467908772861941e-01   -4.766227880086919e-04   +1.093594877628370e-01   +5.113855603234878e-01   +5.843933786626745e-01   +1.289367106569782e-01   +2.938066088289001e-01   +4.561892507693289e-01   +2.517311732513488e-02   +3.146226117818520e-01   +4.334713792371770e-01   +5.340045192508264e-01   +5.157272750923278e-03   +6.518154331320497e-02   +2.664804395261173e-01   +5.096948001775222e-01; +5.426071063815281e-01   +7.466099989900163e-01   +7.156050892256247e-01   +2.742683794601029e-01   +3.711644247833543e-01   +8.643728633928512e-01   +6.747536320764541e-02   +3.369108693222023e-01   +4.911302522898794e-01   +5.665240573066668e-01   +8.267107530473595e-01   +5.215605548527691e-02   +6.812831008069234e-01   +3.223016287611362e-01   +9.926625954433768e-02   +4.544359628608405e-01; +3.460268223067834e-01   +3.474119728308801e-01   +4.301683274683227e-01   +6.463497275428141e-01   +9.913072563457695e-01   +5.790037428912351e-01   +7.211379688798621e-01   -1.160165371507690e-01   +1.204039691791910e-01   +2.407966548064892e-01   +1.956463507959050e-02   +7.132715523614603e-01   +5.405501266219852e-01   +2.369642203902504e-01   +5.233263217913260e-01   +4.917605597374614e-01; +6.255718530041784e-01   +1.000000000000000e+00   +1.915116002914759e-01   -1.595121181655290e-01   +5.738928496588678e-01   +1.158154964359860e-01   +3.977492666272560e-01   +8.022144940781807e-02   +4.477311941300119e-01   -1.471865618355562e-01   +3.571994073242506e-01   +3.847732245008446e-01   +7.239516138288006e-01   -2.236526361881639e-01   +2.465218161706056e-01   -3.301836887352694e-01; -1.486493035977749e-01   +3.198998373380549e-01   +7.987873682526503e-01   +1.540495429662484e-02   +2.593838759096236e-01   +3.630003358183159e-01   +2.790017400854752e-01   +6.945877026917928e-01   +4.477220130816497e-01   +2.244984421705879e-01   +3.194080429520694e-01   +7.366495018277339e-01   -9.943275420412709e-02   +7.910850825959978e-02   +8.126713483276543e-02   +1.586861832076938e-01];
L2I_L1I_iGABA_netcon = [+3.162528508904819e-01   +1.344681714937562e-01   +8.280106149646167e-01   +1.309383021777119e-01   +5.769188056120311e-01   +5.782494248728161e-01   +6.436441964214170e-01   +9.993500408341131e-01; +2.665091617837797e-01   +1.355886521890731e-01   +4.074083229563485e-01   +3.986215125147483e-01   +6.144206453397981e-01   -9.977625113352089e-02   +1.949749470079737e-01   +2.434755900513900e-02; +6.362428580239616e-01   +5.116029029168987e-01   -8.882296614976089e-02   +2.662535190728636e-01   +5.928572459173821e-01   +1.444104847279409e-01   +4.746510202389794e-01   +3.868245157046136e-01; +5.047262562148794e-01   +5.437402676698211e-01   +4.943286220474616e-02   +4.199390413267694e-01   +8.045845372776017e-02   +6.970760830610359e-02   -3.498689546725706e-03   -6.785961911361708e-02; +2.987869973952711e-01   +5.271018814356331e-01   +5.548417830846220e-02   -3.829016505884596e-03   +5.801602341899244e-01   +1.523251998996253e-01   +5.141315687280200e-01   +5.250684415744741e-01; +5.462183974593475e-01   +4.940889696507237e-01   +5.628007239177534e-01   +5.736382931035380e-01   +3.830024133356494e-01   +5.225505993740741e-02   +4.516732076443484e-01   -3.470313585751110e-02; +2.718675953188573e-01   +6.474428330358809e-01   +4.291526101318661e-01   +7.339297323250653e-01   +1.851468335680904e-02   +1.566361145089629e-01   +1.780135767714156e-01   +4.574604685414563e-01; +5.476591416786580e-01   +3.899651483706068e-01   -9.991567019416163e-02   +4.029318467876705e-01   +2.151292109136569e-01   +4.385062390068853e-01   +3.685396820451527e-01   +1.944853519375367e-01; +2.644235405848110e-01   +1.845634659172849e-01   +5.473007845522353e-01   +2.234371466423478e-01   +2.706714281029328e-01   +9.657224940291472e-01   +3.543063309335482e-01   +9.342193303742459e-01; +5.741314305998890e-01   +3.769757970532956e-01   +2.588715406948724e-02   +2.295669690644583e-03   +5.361567828280185e-01   -3.187485118454659e-01   +1.816553126388616e-01   +4.067250279356331e-01; +2.871625863142203e-01   +6.446077723968064e-01   +3.301359931523616e-01   +8.113162277095916e-01   +2.042967355612452e-01   +4.029295817924650e-01   +8.497193548457911e-01   +7.617939610966917e-01; +5.855127250262814e-01   +9.356608672786854e-01   -1.630128239903277e-01   +5.882568982452611e-02   +2.577895910990756e-01   +5.245384045835837e-01   +3.630297339015032e-01   +2.862616892844022e-01; +9.251625511456552e-01   +2.697877031676108e-01   +5.846840374262458e-01   +8.860814820583350e-02   +4.822604251835000e-01   +1.427147579577242e-01   +6.554053492355333e-01   +1.970202326550187e-01; +6.044027840902690e-01   +3.556493365673694e-01   +5.039008173792455e-01   +1.759239869301824e-01   +3.895213392799108e-01   +2.922916276973492e-01   +4.041899284109658e-02   +5.899377078516418e-02; -1.551990230583924e-01   +7.840693838828812e-01   +5.900086664046665e-01   +2.010120601780284e-01   +3.299566485699335e-01   +5.959706660590913e-01   +1.023202343756895e-01   +4.679991597675758e-01; +1.218608191133294e-01   +6.070489356277445e-01   +1.721137342823363e-01   +3.433487110174316e-01   +2.286299702573771e-01   +3.712917007789651e-01   +2.126116267992409e-01   -9.390924866527439e-02];
L1I_L2I_iGABA_netcon = [+3.702920249259018e-01   +4.998243111406740e-01   +2.584473573463166e-01   +4.567441930624256e-01   +7.012371535608398e-01   -3.571182726033382e-02   +5.813674673098369e-01   +7.822006750061605e-02   +2.451988865721042e-01   +4.492279401434496e-01   +4.758384675864075e-01   +5.625902717733718e-01   +6.237895695237589e-01   +2.856581145029589e-01   -3.676107844815928e-02   +5.475987987239351e-01; +7.613759144530925e-01   +4.541485734507907e-01   +6.076314736580785e-01   +6.169836789423537e-01   +6.240302306985839e-01   +9.761922027572481e-01   +6.429461257375789e-01   +2.019444445298402e-01   +4.469212435822794e-01   +3.901057916257392e-02   -2.054731268884987e-02   +7.349836004108588e-01   +5.688074222139723e-01   +2.436612230894386e-01   +6.219126732954983e-01   +8.916101155868923e-01; +1.694962234141538e-01   +2.685458633126687e-02   +5.122460307714065e-01   +5.185137960107613e-01   +3.505610776703059e-01   +6.300749758800264e-01   +2.441778646698180e-01   +5.902207012181038e-01   +4.360917186436534e-01   +4.222546803643893e-01   -2.846835770612996e-02   +3.185229075328628e-01   -1.061759047220942e-01   +8.356650264791775e-01   +3.679636057259052e-01   +2.637875765120055e-01; -2.742515354738962e-01   +6.227305525079511e-01   +4.640607023459076e-01   -2.857281784519761e-02   +4.966037501358428e-01   +5.156857283279886e-01   +8.884074895157892e-01   +4.019029700490601e-01   +7.030867515540109e-01   +1.808967599073142e-01   +2.700978585694227e-01   +8.198561064265623e-01   +4.823948917384128e-01   +3.026730943104802e-01   +6.249360148634183e-01   +5.073288272642570e-01; +6.210238853983895e-01   +8.264239929603259e-01   +2.576061274672368e-01   +3.301975156479369e-01   +7.968340174398827e-02   +1.621618650699307e-01   +6.255060762545044e-01   +1.340933819491593e-01   -1.919591070793823e-01   +4.774200441126408e-01   +6.180268739016499e-01   +4.809592556616304e-01   +5.233199665362528e-02   +4.727186338903092e-02   +6.365767546348727e-01   +7.124254433890116e-01; +7.518185956734588e-01   +5.052944960414716e-01   +3.784234445974917e-01   -1.320562206891536e-01   +2.302986233885250e-01   +7.709928248792386e-02   +8.554015055606801e-01   +2.458602230577937e-01   +3.593460193317590e-01   +6.951452212980060e-01   +9.325897507456933e-01   +5.023726248732233e-02   +2.699092568024348e-01   +4.946634951307125e-01   +2.837649875195341e-01   +3.507825384840677e-01; +2.082731157267301e-01   +6.982305673620441e-01   +7.318489111784702e-01   +2.794942919731549e-01   +2.968326243885757e-01   +8.640009904937955e-01   +5.980153169273418e-01   +2.361030334305109e-01   +3.695446000913738e-02   -1.262996763622845e-01   +5.515852415274657e-01   +8.420719370675284e-02   +6.767089399496721e-01   +9.224519131206632e-01   +1.158236400337359e-01   +4.802097071719955e-01; +3.084176977819268e-01   +7.440349103827175e-01   +5.025131615459867e-01   +8.589970765783173e-01   +4.705549400746638e-01   +3.378428461011654e-01   +5.625950340720374e-01   -2.043393201819306e-01   -9.168080877647872e-02   +1.692187220258678e-01   +9.189130422285360e-02   +4.780859967990836e-01   +7.917517395754840e-02   +7.272659089097825e-01   +4.025859168299527e-01   +5.379904338194649e-01];
L2E_L1E_iAMPA_netcon = [+6.846380250538925e-02   +2.892690069962983e-01   +5.755543795030219e-01   +5.720494276811589e-01   +6.388360938547480e-01   +3.527431522024415e-01   +4.486563708137455e-01   +7.052899960955702e-01; +7.043168118595696e-01   +1.480001671772135e-01   +1.075331514823331e-01   +2.165564579501055e-01   +2.697698673212863e-01   +4.124987280797678e-01   +2.180371317473951e-01   +4.056863682040649e-01; +2.162328838603337e-01   +3.121567546503536e-01   +5.620155709423907e-01   +1.000000000000000e+00   +7.330650324047570e-02   +3.679660661789194e-01   -8.216194130872141e-02   +6.076758647625584e-01; +1.684779367220389e-01   +6.503395074472598e-02   +3.619717122481326e-01   +5.461961681859210e-01   +6.119160690027320e-01   +2.965745610078346e-01   +5.662435537048049e-01   +4.256182642282011e-01; +7.836896641786404e-01   +6.614731853290421e-01   +2.090563712771322e-01   +2.151701221649716e-01   +1.790888311303757e-01   +3.423970597563413e-01   +3.060457671608597e-01   +2.284768391603439e-01; +5.321540690306246e-01   +2.615645972971984e-01   +7.191183706856829e-01   +6.280738886634855e-01   +5.382620187592712e-01   +4.936194415560988e-01   +4.697308146736577e-01   +8.310273744347263e-01; +6.701843052206644e-01   +3.411062836036389e-01   +2.130781945679326e-01   -5.126514472195445e-02   +4.147515299601182e-01   +4.574234452216206e-01   +2.700071104275393e-01   +7.063312542221982e-01; +5.220168559100744e-01   +4.440711520793433e-01   +2.803480565513216e-01   +4.034425533326166e-01   +8.643608707454149e-02   -9.080026083985719e-02   +3.792603361631056e-01   +8.707804949352338e-01; +1.083195864101695e-01   +1.033667360814539e-01   +2.997827537592281e-01   +1.751650649208323e-01   +6.437936724399500e-01   +4.711434813214222e-01   +3.377621407123632e-01   +4.800693070369418e-02; +2.465889220541060e-01   +4.340056270979895e-01   +2.786228178412151e-01   +6.354347942789367e-01   +5.374761208468744e-01   -2.196158435967427e-01   +8.407504613478162e-01   +5.403921003760732e-02; +1.643227404272908e-02   +1.620991153284371e-01   +3.370979897916359e-01   +5.388986614259602e-01   +1.909868647954130e-01   +3.612538026937588e-01   +7.504692122258352e-01   +3.745494937427160e-01; +6.284346521348296e-01   +2.465985593991922e-02   -7.296787961290362e-02   +7.409206214317613e-01   +6.176934455559283e-01   +2.060054678814884e-01   +4.376142734492483e-01   +6.197109903032795e-01; +5.813347300348871e-02   +6.344087862373834e-01   +2.609424336372280e-01   +1.527302154632016e-01   +3.291065663629409e-01   +2.867581334087731e-01   +1.957492439129485e-03   +3.179924335758041e-01; +1.485254915989907e-02   +4.104804963887932e-01   +7.141464165905196e-01   +3.445244429394418e-01   +2.459344443337346e-01   +3.793603035630553e-01   +2.137972089143447e-01   +5.866911249905844e-01; +3.365662976274105e-01   +3.338736525887651e-01   +2.778240768984327e-01   +5.943817312947703e-01   +5.171583543471183e-01   +4.180749768030357e-01   +3.268982316083356e-01   +7.032658436805791e-01; +3.434655554874038e-01   +2.560435714375763e-01   +2.460434118728832e-01   +2.927276768384064e-01   +7.565775850760041e-01   +1.854491691392379e-01   -4.524866050988768e-02   +1.765789982062547e-01];
L1E_L2E_iAMPA_netcon = [+5.080943395582105e-01   +6.609418048203072e-01   +2.070471776860996e-01   +4.614631893762960e-01   -1.760055168678220e-01   +2.658732184487271e-01   -3.408499263473657e-02   +7.826066432235371e-01   +7.846180159422902e-01   +2.753130543603096e-01   +5.904558310394191e-01   +6.809292868708339e-01   +6.489457667964023e-01   +1.169487035508872e-01   -7.574878698949966e-02   +6.860185356846019e-01; +3.879497896340970e-01   +6.533555716089423e-01   +7.247928562370114e-01   +6.754745216948350e-01   +4.601119312183312e-01   +4.299474387826304e-01   +5.077038400055782e-01   -2.326807957927985e-01   +3.786400624313037e-01   +7.592070807528313e-01   +2.713661063954020e-01   -1.738326700358149e-01   +4.091252471600789e-01   +2.617638261209546e-02   +1.360978536964073e-01   +2.693039273925022e-01; +5.275043130236436e-02   +4.051400831371347e-01   +6.210068789324670e-01   +7.307825252287983e-01   -1.086338343891202e-01   +2.698840243408335e-01   +4.422847533125243e-02   +2.030920366346380e-01   +2.908443299921086e-01   +2.460927108237149e-01   +7.986174703247009e-01   +5.359558806986070e-01   +2.457351690279674e-01   +6.364293161562841e-01   +6.335203480706473e-01   +5.404098203940169e-01; -1.381007563701034e-01   +6.587466304934478e-01   +3.375591811913354e-01   +4.632967779741140e-01   -2.231731310416436e-03   +5.705528820056452e-01   -1.031879235206894e-01   +2.627431053540272e-02   +1.338730209265084e-01   +3.724467337669686e-01   +4.659762172757556e-01   +2.318370962648272e-01   +3.343633792497602e-01   +2.031114694453217e-01   +1.140727344447751e-01   +1.215776400762102e-01; +2.132104103421492e-01   +6.393095893001961e-01   +6.575129534481364e-01   +1.359149936109804e-01   +3.038419901387424e-01   +7.484013870900157e-01   +5.483144103463981e-01   +2.301903180344228e-01   +6.384247028046620e-01   +5.374411502545944e-01   +8.537290290511084e-01   -4.217423690042977e-02   +6.972391021033711e-01   +7.690783845337444e-01   +2.629514424347310e-01   +1.272995529951734e-01; +3.102034473331229e-01   -1.539318646077558e-02   +3.626329363187168e-01   +6.967166221682605e-01   +5.106581146862499e-01   +5.354191380579256e-01   +8.315537067719890e-01   +2.875717847442182e-01   +1.555580980234515e-01   +5.306149499984947e-01   +1.329742541837550e-01   +4.211330247159447e-01   +4.369167436769444e-01   +2.949627606881406e-01   +5.943919558685195e-01   +7.079563559734093e-01; +5.157506185501445e-01   +1.202107122703495e-01   +3.023454921975415e-01   +6.006167143525178e-01   +3.491535456036067e-01   +3.231840241332058e-01   +9.115037843251612e-01   +8.372242145665314e-01   +2.653851238821563e-01   +3.468685851589733e-01   +6.419204101084377e-01   +4.463843105892208e-01   +1.532553901111094e-01   +5.264798699446971e-01   +4.399296239762850e-01   +3.385474717506495e-01; +6.014317069865963e-01   +5.375834907589627e-01   +4.165067614630428e-01   +3.560735602797702e-02   +8.253733501612697e-01   +2.721067791276636e-01   +2.658371397729196e-01   +5.075063542962840e-01   +4.106017544772148e-01   +2.190956553802103e-01   +4.943551231176138e-01   +2.869168919193249e-01   -1.236866538273244e-01   -1.437248143019749e-01   +3.851612291909898e-01   +4.897161558970443e-01];
L2I_L2E_iAMPA_netcon = [+2.339100151054219e-01   +8.672826626172064e-01   +6.977825957042734e-01   +6.467898263820180e-01   +3.877927152596857e-01   -8.184564094337828e-02   +8.221976940580527e-01   +6.650868678110573e-01; +7.373807932383412e-01   +9.805214541133632e-01   +1.518785792276177e-01   -1.310620717639309e-01   +4.930694073458703e-01   -1.526003846564699e-01   +2.205009794598711e-01   +3.122998463259771e-01; +6.377939711894961e-01   +6.340523992788758e-01   +7.349839687604300e-01   +2.564666312626948e-01   +4.147872386094300e-01   +7.062294840630607e-01   +4.435354725188553e-02   +3.068553593122143e-01; +5.136813528040549e-01   +7.148215887068310e-01   +3.474064208633685e-01   +1.408001511468119e-01   +6.865988975525945e-01   +9.504189210692106e-01   +7.883800016729737e-01   +8.215773397706196e-01; +8.514319181494033e-01   +9.772224426470813e-02   +5.321470572832158e-01   -6.604935329992720e-02   +1.114942209628143e-01   +7.828652987293185e-01   +3.888802989564123e-01   +2.610207395877242e-01; +1.185908413558666e-02   +2.417108753024580e-01   +1.809855232381370e-02   +2.456034319029496e-01   -4.547705706368302e-02   +7.513517100591051e-01   +7.044384967358830e-01   +2.557134766793757e-01; +9.172146307216515e-01   +2.247428320088529e-01   +3.911971421508166e-01   +1.120536379129991e-01   +2.651915003277488e-01   +2.935179289821634e-01   +5.177055437322513e-01   +4.646122799676028e-01; +6.161012748533834e-02   +2.042185784359643e-01   +2.869801809315956e-01   +6.679536115381507e-02   +7.376392128064407e-01   +6.846117361423283e-01   +2.935220367065322e-01   +1.560230046554212e-02];
L2E_L2I_iGABA_netcon = [+8.262121974101755e-01   +7.494954682081544e-01   +7.796182920321006e-01   +5.642405546122200e-01   +4.642930647319515e-01   +2.032787980577913e-01   +3.050596109658130e-01   +3.207244701173721e-01; +4.527870209457260e-01   +7.894420251806896e-01   +1.000000000000000e+00   +9.583598076511278e-01   +2.758705774822270e-01   +3.460477300094518e-01   +4.685650355595203e-02   +8.056073677550130e-01; -6.996079721706859e-02   +6.144595687630188e-01   +8.607559138531776e-01   +6.857743085317223e-01   +5.217207611880199e-01   -1.115831326541826e-01   +6.069830651792810e-01   +1.792724754987751e-01; +5.337403747142516e-01   +2.631654823671831e-01   +7.808210416008614e-01   +1.194402115013713e-01   +5.429257926390995e-01   +3.402808765556440e-01   +2.825807617237276e-01   -2.700159489226207e-01; +4.409695105491445e-01   +9.551224068913139e-01   +6.071251606806141e-01   +4.617479636281238e-01   +4.083325773369266e-01   +2.070722016718841e-01   +7.435511785285052e-01   -9.519676491573509e-02; -2.336691382997919e-02   +1.434160755250082e-01   -2.268205123740061e-01   +3.725627650971849e-01   +7.167069744151170e-01   +4.470355246999165e-01   +4.526651644652925e-01   +9.190257998553733e-02; +4.791083541537770e-01   +7.672130237955208e-01   -1.916019119218537e-02   +5.524506310557736e-01   +4.675008362741557e-01   +8.303334033985573e-01   +5.064698498871489e-01   +7.395964932264372e-01; +3.550865742887245e-01   +2.525576064718452e-01   +3.354159264925021e-01   +6.776016661389189e-01   +4.487250514742865e-01   +2.947583928996876e-01   +2.603680898638870e-01   -4.781336122662960e-02];
L3E_L2E_iAMPA_netcon = [+2.725206338285335e-01   +2.259631812804632e-01   +5.681719453833816e-01   +2.242100259181657e-01   +4.213682573621505e-01   +3.545089904166639e-01   +4.696697404006349e-01   +5.213828801116401e-01   +2.635413645890876e-01   +6.066251369122334e-01   +7.909254407208802e-01   +3.771477123400024e-01; +3.306439826042878e-01   +2.033880077308824e-01   +5.568398154424513e-01   +3.886008901493671e-01   +1.311740384430284e-01   +2.867640630109747e-01   +6.347083452418331e-02   +7.892818458087473e-01   +2.383255939103167e-01   +3.508227919698481e-01   +4.051931649081603e-01   -7.869079756616741e-02; -2.613543650606609e-02   +1.677381054150295e-01   +5.892449822673864e-04   +4.877094378714258e-01   -6.598437404657860e-03   +3.066180755826211e-01   +1.994441734250783e-01   +2.379051736046066e-01   -6.620424040951448e-02   +9.858703145360934e-02   +2.123871274112363e-01   +2.233687141418636e-01; +4.533354473740782e-01   +2.695984325011747e-01   +4.218165525594494e-02   +3.195610602034020e-01   +4.550755689558190e-01   +1.683191524100422e-01   +2.270516292617885e-01   +3.396443197876229e-02   +6.621773203364023e-01   +2.094341199683538e-01   +4.401181450239533e-01   +5.446852680558634e-01; +7.203942129973566e-01   -1.553678176953715e-01   +5.107752990613438e-01   +4.676638651370509e-01   +3.260212981124178e-01   +8.151601118701397e-01   +4.704817247406363e-01   +6.602116142652391e-01   -1.736777471271075e-02   +6.489601979161406e-01   +5.302908763329491e-01   +3.768506622283498e-01; +6.911646050147775e-01   +4.337413537409366e-01   -1.158220125158730e-01   +6.042876001489851e-01   +1.156456759813284e-01   +6.637322946844407e-01   +5.748180008368622e-01   -6.201566456775066e-02   +2.631465897295612e-02   +6.228874742682659e-01   +2.591878063747024e-01   +4.683808252660697e-01; +1.059475601987176e-01   +4.816817904462527e-01   +1.504171771183134e-01   -1.662011408358043e-01   +9.704411025395500e-01   -5.261922582796223e-03   +2.611368640445969e-01   +5.636334099981924e-01   +2.893381797831240e-02   +4.606152762214429e-01   +1.610731850776767e-01   +6.774694446653597e-01; +3.041301857461101e-01   +8.077239620850768e-02   -7.684816779714704e-02   +7.428831067182487e-02   +5.381326196259142e-01   -1.055165282867132e-01   +4.357644815471892e-01   +1.464138492806829e-01   +1.973662267421531e-01   +4.024293690122035e-01   +5.674506862092782e-01   -5.571052962645824e-02];
L3I_L2I_iGABA_netcon = [+5.953772663339078e-01   +4.281975679003370e-01   +5.834782479343142e-01   +7.219541187354706e-02   +1.465054288694018e-01   +4.065430851862844e-01   +4.371504543272878e-01   +1.198344482846570e-01   +2.636565771104858e-01   +3.070436606946497e-01   +4.507407137629593e-01   +6.566004096332972e-01; +4.276805155253157e-01   -3.177758110965068e-01   -2.010796573876556e-01   +6.656291200928676e-01   +3.906456149615147e-01   +4.734035499593702e-01   +2.750965977925001e-01   +1.552846760687542e-01   +7.239787774640167e-01   +8.275521029482817e-02   +7.051886311053551e-01   +3.756290398524576e-01; +3.539237169129745e-02   +5.967212398210228e-01   +6.672206105008373e-01   +6.363179950610163e-01   -4.390548809752991e-02   +3.874863462231783e-01   +8.960275965027446e-02   +6.256870557691252e-01   +4.644626705692904e-01   +3.713091922762111e-01   +7.422584674933268e-01   +7.007577101006903e-01; -2.081511746989198e-01   +2.352827432028712e-01   +8.421748494258583e-01   +4.203085963289075e-01   +5.227252576941099e-01   +4.848523426710656e-01   +7.830611890005587e-02   +3.529927820774872e-01   +1.795372962369345e-02   +2.174781829760171e-01   +1.743563767998828e-02   +8.964486558965570e-02; +1.494899145086634e-01   +3.433778698959591e-01   +3.969958089870618e-02   +1.835759138844577e-02   +2.228634696536687e-01   +2.645884677345697e-01   +1.124225669242118e-02   +2.169045445795832e-01   +2.296211170613211e-01   +5.072626869990997e-01   +6.437586403984322e-01   +6.299261371873759e-01; +4.642176901047539e-02   +5.258165109707326e-01   -3.834236885584652e-03   +4.527575510850929e-01   +7.333662603756415e-02   +1.777084193858352e-01   -1.895792962810239e-01   +1.006960744560527e-01   +4.590650306455614e-02   +7.138967546945177e-01   +6.533944057829710e-01   +6.401596511664401e-01; +5.962747908230203e-01   +4.784735557290180e-01   +5.244440484526594e-01   +4.102134033346522e-01   +3.769505334557203e-01   +2.106365686286933e-01   +4.438091726619832e-01   +2.030407696523673e-01   +1.586570272756047e-01   +6.749151463591423e-01   +1.623402151408614e-01   +4.640083132336350e-01; +5.172328401348267e-01   +7.782226929695786e-01   +3.104817144463380e-01   +4.569253877610562e-02   +4.411920491854734e-01   -2.342299562714564e-01   +9.721127326415495e-01   +5.424056732222163e-01   +7.419875564604156e-01   +5.022157279474103e-01   +3.459828298019836e-01   +5.924834572421327e-01];
L2E_L3E_iAMPA_netcon = [+4.172940369248071e-02   +2.379062790416877e-01   +1.012293948971777e-01   +4.677960476847548e-01   +5.056869840871993e-01   +1.979134069755389e-01   +1.032139352403128e-01   +4.072370815669373e-02; +5.178692555906962e-01   +5.053177773083314e-01   +1.056269172034243e-01   +6.154439879122328e-01   +8.993382717262996e-02   +4.943206239194654e-01   +1.265374625299897e-01   +6.453882759547928e-01; +5.951071954650212e-01   +3.736426031700384e-01   +1.006466542720995e-01   -1.014934828991100e-01   +6.084992345611898e-01   +5.719238341776779e-03   +2.642488298047949e-01   +2.333236205521633e-01; +2.293237138108010e-01   +4.813758840999237e-01   +4.410985493787724e-01   +3.887574186150831e-01   +6.259881743006457e-01   +2.958019690360595e-01   +1.559979241660964e-01   +4.087022683056721e-01; +1.387425817124828e-01   -9.193573386208720e-02   +3.980045522022689e-01   +4.416251920966385e-01   +2.973922484913756e-01   +1.054719738402935e-01   +6.697375408386324e-01   +1.432089714468770e-01; +5.181749026663792e-01   +4.757027350369136e-01   +2.374180963473656e-01   +7.579772358339026e-01   +1.660849827619371e-01   +4.494378509400706e-01   +2.736582720690598e-01   +6.090418667388411e-01; -2.839012173951106e-01   +3.388970244128878e-01   +3.510229069618723e-01   +4.159052033519078e-01   +1.082307090366658e-01   +3.846969551617688e-02   +7.515490821797308e-01   +3.755667983703622e-01; +1.061432552928929e-01   +6.797008534377660e-01   +2.754924247799908e-01   +2.574637669395796e-01   +2.673994501240289e-01   +4.120582260958988e-01   +5.199425384922470e-01   +1.544064102336086e-01; +6.642751844946964e-01   +7.499032612121269e-01   +4.217870333876237e-01   +7.357335778854361e-01   +2.373224694619856e-01   +4.017191424267642e-01   +5.207702028810803e-01   +1.000000000000000e+00; +2.745063012483469e-01   +1.467355968676382e-02   +2.217298290909797e-01   +5.529636565329785e-01   +3.703212989472558e-01   +2.073699972838960e-01   +7.491037373643754e-01   -2.993086480464905e-01; +1.231439935845526e-01   +2.534515776766496e-01   +7.760283835772624e-02   -4.299520001310463e-02   +2.348207534447752e-01   -4.662317109990250e-02   +2.490395336381316e-01   +8.191836540496806e-01; +3.693690752615839e-01   +1.846383863514671e-01   +4.857455068564133e-01   +6.005916564797948e-01   +7.804626486729224e-01   +1.605070345717227e-01   -1.940926509893523e-02   +4.343495189766051e-01];
L2I_L3I_iGABA_netcon = [+2.451776616443570e-01   +3.613930105359599e-01   -2.659903254148739e-02   +1.000000000000000e+00   +3.162426281079985e-01   +8.893407478343197e-02   +5.449391531334621e-01   +2.622803724108514e-01; +2.620290682664255e-01   +1.351088347306368e-01   +1.458751826156008e-01   +3.032086470008182e-01   +6.247098451480446e-02   +3.449995558337687e-01   +8.904951494727757e-01   +2.523758376996799e-01; +3.785715760052705e-02   +4.242046808334208e-01   -1.252982927773107e-01   +6.534358239001286e-01   +2.008036929265930e-01   -5.084592311376764e-02   +2.379602305866314e-01   +3.863529823664260e-01; +5.714083491662069e-02   -4.661953010508806e-01   +3.263104411524143e-01   +4.961222741376696e-01   +7.297659753455229e-01   +2.259622360985718e-01   +4.948129457725145e-01   +2.002117934109618e-01; +2.867429497974668e-01   +4.910205465860550e-01   +3.085370845624398e-01   -8.469404320249121e-02   +3.281003389815281e-01   +1.911086978637649e-01   +2.768196972604146e-01   +5.720194107931907e-01; +7.789864293953537e-02   +3.858301325332092e-01   -9.460418395230355e-02   +4.546846655453907e-01   +4.485240188877520e-01   +7.569993867651580e-01   +8.579849254907848e-02   +4.183973866344509e-01; +5.543862775839413e-01   +2.720929324315189e-01   +3.339124802301883e-01   +4.920034895763113e-01   +3.781089429213520e-01   -1.719736614362414e-01   +1.343031438741839e-01   +3.241191592495233e-01; +4.603770934160986e-01   +6.726131025890872e-01   +5.497683619310638e-01   +2.213774188119831e-01   +6.821050141024411e-02   +5.450516257048355e-01   +2.665197864976817e-01   -1.060873666815378e-01; +1.745665351045549e-02   +5.958031745432667e-02   +2.408094703193558e-01   +3.477406547313755e-01   +5.261795855467506e-01   +4.935452652312480e-01   +4.046776126667179e-01   +2.159995400143787e-01; +5.033845957338881e-01   +1.227078085809288e-01   +3.988051288024277e-01   +3.252410647955862e-01   +4.079180265142875e-01   -8.255272674397195e-02   -1.375354720717110e-01   +1.608868641632109e-02; +3.330187685816920e-01   +8.083507183312900e-01   +2.584456785789946e-01   +5.601749944374464e-01   +2.123908310049795e-01   +5.375519118977081e-02   +3.061450161738195e-01   +1.601680740368828e-01; -1.523069249888396e-02   +2.964390631300235e-01   +2.784852077439909e-03   +2.468807146267645e-01   +7.188205238965540e-01   +5.137522841494504e-01   +6.742161431178988e-01   +2.092694855428473e-01];
L3I_L3E_iAMPA_netcon = [+2.159464466377670e-01   +7.429282737534473e-01   -1.757106662950609e-01   +2.803852915825433e-01   +1.000000000000000e+00   +7.094948076001802e-02   +5.204532914625641e-01   +6.809925689889750e-01   +7.285301951172705e-02   +1.482784381939756e-01   +1.887766812532273e-01   +3.509391026139892e-01; +6.670341519476018e-01   +8.660630052137185e-01   +3.194241298175765e-01   +3.444130909400203e-01   -2.043194398069268e-01   +7.023476140962674e-01   +5.493416535972154e-01   +8.382931047534736e-01   -4.685335845571520e-02   +7.533734758999380e-01   +3.487018776961934e-01   +5.466246212500070e-01; +5.324844937876889e-01   +6.094971648169618e-01   +7.290568976183041e-02   -2.672971860882421e-01   +7.725769797571315e-01   +6.966714924198765e-01   +4.507698241798160e-01   +8.790633823519948e-01   +1.056422961959246e-01   +3.908928757591070e-01   +8.787511031999341e-01   +4.812165554964818e-01; +7.382845306452325e-01   +3.165905644481797e-01   +3.850546649967920e-01   +8.730697461323013e-01   +7.783773952510913e-01   +8.556919608893782e-01   +8.011478460532500e-01   +6.991831717621995e-01   +4.039797869206355e-02   +6.758241715472854e-01   +3.115307804350974e-01   +7.313174673008445e-01; +7.320923890794638e-02   +8.879887627737316e-02   +3.051126340612582e-01   -1.495237170701371e-01   +6.681526234519882e-01   +8.338732453946323e-01   +1.077926417871030e-01   +8.074207625291616e-01   +8.640846873364220e-01   +3.260451704086268e-01   +6.838583420154740e-01   -2.391546010891385e-01; +2.563775589001027e-01   +8.402273863175831e-01   +1.832917975351076e-01   +5.091232570244960e-01   +4.844574767051489e-01   +1.292721137874329e-01   +3.728642710155355e-01   -1.915959634356096e-01   +3.536652038878693e-01   +2.859865175469916e-01   +3.312393090570442e-01   +2.855744496690673e-01; +1.798784336879228e-01   +1.991950454733783e-01   +2.323672031955090e-01   +9.967503178363291e-02   +9.325040369104873e-01   +3.446183568734100e-01   +4.633407291897221e-01   +5.859985703581837e-01   +1.539561638276077e-01   +5.897221014526618e-01   +2.729009369819386e-01   +2.388915054877785e-01; +2.770461318222651e-01   +1.555524919931878e-02   +4.369583541655426e-01   +5.149460598454950e-02   +2.711773783144539e-01   -1.166159941810194e-01   +1.098678102445805e-01   +2.778188959806961e-01   +1.020343333985883e-02   +7.364945803992125e-01   +3.187395394410302e-01   +4.078614381350034e-01; +2.696459412848663e-01   +3.575450891966231e-01   +4.377415119560715e-01   +2.183460810923279e-01   +4.161443876436677e-01   +1.442662153919784e-01   +2.690577593608666e-01   +1.987518484495305e-01   +5.344185503583075e-01   +2.180146200711508e-02   +3.301149977092603e-01   +5.277379370133095e-01; +6.018237435610729e-01   +6.835953870149273e-01   +4.062270930060695e-01   +5.672103337567389e-01   -1.201623843958380e-01   +5.186808977959233e-01   +7.128894639720058e-01   +5.891860689062454e-01   +7.473939688179895e-01   -1.738647068616295e-01   +6.440153014237248e-01   +2.903832771921839e-01; -3.590671024233423e-02   +1.226189139073471e-01   +3.419135637619078e-01   +4.139653357936712e-01   +1.519701281062908e-01   +2.506523460694321e-01   +8.845779174494212e-02   +7.052654119915589e-01   +8.516946843709786e-01   +7.485093424914089e-01   +2.021327566463980e-01   +3.472706199324296e-01; +2.372666376712275e-02   +4.782761861920071e-01   +1.420479764194974e-01   +6.163510907799227e-01   +9.040744599901613e-01   +6.018760889549063e-02   +2.093317560060073e-01   +3.368450033040041e-01   +5.390925021764134e-01   +3.695399957613841e-01   +4.202972903091888e-01   +2.246165758747112e-01];
L3E_L3I_iGABA_netcon = [+6.946245530778269e-01   +7.513809294933257e-02   +1.248155264794510e-01   +6.405848199649202e-01   +4.989344105312061e-01   +8.646480465889442e-01   +7.366781825581821e-01   +8.260229791393585e-01   +5.872103524274587e-01   +1.848417084458970e-01   +3.196804121084393e-01   +4.429080478937650e-01; +4.521956229385157e-01   +2.492650021584673e-01   +8.258276664952405e-01   +1.819790606493425e-01   +3.673996469156520e-01   +7.806627307928781e-01   +9.771498388552950e-01   +1.586101183677606e-01   +3.560257750075289e-01   +2.068130870764935e-01   +9.464020792002541e-02   +5.486538313143453e-01; -4.408712566882144e-02   +6.333963170382478e-02   -2.063863463954646e-01   +4.078083855002292e-01   +1.010158623049124e-01   +4.217192331374125e-01   +4.626057729897821e-01   +5.327668302818283e-01   +5.674043966643424e-01   +6.247803780763314e-01   +5.252739966623393e-01   +3.315545287869293e-01; +3.939015468659789e-01   +7.237225258603788e-01   +4.936905727710594e-01   +1.060561203676816e-01   +6.252257029780387e-01   +1.169396519784521e-02   +4.029634583923550e-01   +3.434865898242181e-01   +4.635511792780077e-01   +3.502217969683067e-02   +4.344816001838552e-01   +3.574074616888054e-01; -1.425842969021387e-02   -1.054581335281770e-01   +3.935875035092420e-01   +3.573130767018404e-01   +3.211500583875531e-01   +2.597211038847279e-02   +5.180857208379419e-01   +4.269549719841913e-01   +2.497138959665318e-01   +1.715097983992913e-01   +3.967963322991638e-01   -4.157081101187066e-02; -1.156126199626070e-02   +9.644292994050958e-02   +6.202227761659677e-01   +6.579638803379775e-01   +4.580041844972480e-01   +9.350114762787044e-02   +1.198018296949964e-01   +2.069417032820701e-01   +3.553715747337573e-01   +5.697796916627897e-01   +5.329883321118416e-01   -2.000566821317811e-01; +6.671496473988908e-01   +2.745081291765410e-01   +5.238123809193920e-01   +1.557514403616377e-01   +5.315400093288942e-01   +3.789986978793409e-01   -1.611247374652608e-01   +6.514312526195197e-01   +4.246464094295191e-01   +3.293176214998925e-01   +4.852783255326452e-01   +2.423290086083886e-01; +1.117461895495407e-01   +3.293284198972880e-02   +1.866414080981738e-01   +5.950144658629384e-01   +6.192597782071861e-01   +1.950068807007035e-01   +5.561508965079758e-01   +1.085601246444739e-01   +3.210166958035038e-01   +1.485096560297061e-01   +4.519101137398068e-01   +6.870163757528064e-01; +3.604388228201814e-01   +2.206557364458178e-01   +4.549269786324224e-01   +7.411187374746578e-01   +4.580789676619842e-01   -2.064629760702224e-01   +5.572730205681334e-01   +5.433826273964799e-01   +2.161518979580806e-01   +1.040353001264209e-01   +5.117617676879866e-01   +6.770340571448855e-01; +2.590028346345639e-01   +7.955452208162039e-01   +8.671913007917157e-01   +9.416668867257828e-01   +3.376887868277633e-01   +1.923535388813361e-01   +7.285961272590951e-01   -1.630320690638822e-01   +8.205446942546295e-01   +4.309312231303693e-01   +2.142631136654959e-01   +9.415325067374400e-02; +1.096583525297709e-01   +3.929820329786788e-01   +1.871825422580843e-01   +5.995804608196709e-01   +5.615716801204771e-01   +1.966529501313409e-01   +5.010824190487642e-01   +6.531421130726829e-01   +7.172411354928377e-01   +2.446073453972165e-01   +1.536835920682668e-01   +7.199068265496643e-01; +8.084952176560715e-01   +2.006438975569965e-01   +4.648221069146772e-01   +5.108209628301047e-01   +4.220081059591759e-01   +4.540782607143586e-01   +3.728204244925633e-01   +3.188612991974366e-01   +1.735963444321333e-01   +3.477045071333163e-01   -1.485080610762628e-01   +2.297832004679713e-01];
L2E_Input1_iAMPA_netcon = [+5.027607343081965e-01   +6.084081066122555e-01   +5.997247061876756e-01   +6.211770551722684e-01   +8.499962180678945e-01   +5.777621184806953e-01   +1.000000000000000e+00   +5.233310034388318e-01];
L2I_Input2_iAMPA_netcon = [+8.105937335142888e-01   +5.352799106201750e-01   +6.534677539032970e-01   +6.339816898662463e-01   +5.712118415411360e-01   +8.720097689279125e-01   +1.898190247479125e-01   +5.900892247555513e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last =  11.21 * ones(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.5*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.4*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.5*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.4*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.5*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.4*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.5*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.4*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
