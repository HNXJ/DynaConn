function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+3.787139860434270e-01   +2.903481893818002e-01   +3.903356966580522e-01   +2.755057646792871e-02   +4.186507660308110e-01   +5.074107421881452e-01   +4.547613542085832e-01   +1.784600145447704e-02   -7.424844491731883e-02   +3.931303775640822e-02   +5.923835506142404e-01   +2.423069249656487e-01   +5.904766138466454e-01   +3.148778483290034e-01   +6.441035158888164e-01   +2.242514066868330e-01; +2.742972428349216e-01   +3.319457409801613e-01   +2.659602547162294e-01   +5.625655665723478e-01   +4.050231558399430e-01   +2.110372711713500e-01   +4.334127055687095e-01   +1.850984150337927e-01   -3.788050698061055e-01   +3.150893048990301e-01   +5.341382676833135e-01   +5.037768505330148e-01   +6.247427961569119e-01   +5.897530120249272e-01   +5.989699065882939e-01   +4.030192945908306e-01; +3.335017832173271e-01   +3.478231714069493e-02   +4.971574223578093e-01   +6.347823804924067e-01   +6.651368294005824e-01   +2.986454172638244e-01   +2.785649158263701e-01   +1.557333565969778e-01   +5.838243764456300e-02   +1.244157950162504e-01   +3.119033748925873e-01   +9.346289082966619e-01   -1.656585479433973e-01   +2.578017059460174e-01   +3.353631389645560e-01   +5.706701757284671e-01; -4.899990793585692e-02   +5.547022464384581e-01   +6.037850977443475e-01   +4.697413708234783e-01   -8.470473940826610e-02   +6.895561824847308e-01   +1.000000000000000e+00   +4.485351022505656e-01   +7.319349770034738e-01   +6.851053664410395e-01   -1.240216478245996e-01   +2.846960458785132e-01   +4.397358706801359e-01   +5.589714926193559e-01   +2.854305882322735e-03   +8.381602803818526e-02; -1.689450833597712e-01   +4.387474047001041e-02   +1.226810369552033e-02   +2.590567433061142e-01   -4.117836178963020e-02   +1.389265388306876e-01   +4.322219011486177e-01   +3.714260050396002e-01   +5.250437586887378e-01   +1.734402038768461e-01   +5.503128694660357e-01   +2.602356069884699e-01   +4.088963558208367e-02   +5.724943982140831e-01   +2.954031916352284e-01   +1.992999978302633e-02; +6.455025404839870e-01   +7.509257984856780e-01   +5.139250993282992e-01   +2.336364549075597e-01   -9.461276688231265e-02   +5.386726062576787e-01   +3.316509938248499e-01   +4.955495794018119e-01   -2.329924933196119e-02   +7.753257343028163e-01   +3.347861402074171e-01   +1.412509036223416e-01   +4.938219802783209e-01   +7.058842864680388e-01   +4.835794537192827e-01   +1.241967457017280e-01; +8.377653946129145e-01   +3.407508836203130e-01   +3.487982057184110e-01   +4.920541108084907e-01   +4.373954023484238e-01   +1.396309232341870e-01   +1.771746461424927e-01   +1.347742097221641e-01   +4.437135804257345e-01   -1.485507164938047e-01   +2.918913850667624e-01   +4.062538224926893e-01   +3.312046695566503e-01   +4.503241432566448e-01   +4.155398446208193e-01   +3.032702634788761e-01; +3.592856624809797e-01   +2.303631190055152e-01   -6.014829171017304e-02   +3.072008287000514e-01   +6.064781103351847e-01   -3.115278737285740e-02   +2.056575787434601e-01   +3.350385124480519e-01   +8.165871798766611e-02   +1.510777086431716e-01   +9.116831929534948e-02   +3.951888674461891e-01   -1.751647921362246e-01   +4.768921644144503e-01   -8.664152569743432e-02   +5.355202100185770e-02; +3.819129023163147e-01   +3.722197347629311e-01   +4.190053146952670e-01   +2.890804712814157e-01   +4.245548414171757e-01   +5.070127747554598e-01   -1.580892293740538e-02   -1.453418481306865e-02   +2.453066135936194e-01   +3.938480863089163e-01   +6.223203812159279e-01   +2.964580254181994e-01   +2.366845815983309e-01   +6.807185257049233e-01   +3.009652377330371e-01   +3.239538923010254e-02; +2.551365062221152e-03   +4.899767884749637e-01   +2.318614665440821e-01   +2.530732254960720e-01   +2.858981953641282e-01   +5.081942474462314e-01   +4.110048046370887e-01   +2.888319373100120e-02   +3.276371832175304e-01   -1.567939086271272e-01   +2.614348008982786e-01   +5.655707208602845e-01   +2.093204119503530e-01   -6.475875352225528e-02   +2.909245510320082e-01   +5.137933636867235e-02; +1.102957898205416e-01   -2.125242043666663e-01   +3.798938601028324e-01   +3.586404125889252e-01   +1.986583250686820e-01   +4.432814583023797e-01   +7.120413256060327e-01   +1.633721262015684e-01   +7.103702048596748e-01   -1.405871988023780e-01   +1.815374486057749e-01   +5.093511728822349e-01   +2.236706013838573e-01   +9.640925389739745e-02   +7.178829795893352e-01   -9.152008375779402e-02; -1.330588454328762e-01   +6.182598688331139e-02   +9.607715133164667e-02   +2.875484107994223e-01   +8.914043138144681e-02   +6.951005569150218e-01   +1.136889860480852e-01   +4.547005227432044e-01   +3.137771941769948e-01   +2.306661717148178e-01   +6.179419604417498e-02   +5.614570354297649e-01   +2.508546221850607e-01   -8.454662780612691e-02   +6.056464464913621e-01   +5.020259421038552e-01; -8.600919050551395e-02   +4.617457161464498e-02   +3.381724703330788e-01   +3.881430293941706e-01   -7.550916853110860e-02   +5.911509232523909e-01   +3.795435519600334e-01   +1.766621454219518e-01   +9.088502066911646e-01   +3.979231122964912e-01   +2.121133101666184e-01   +7.786509580525591e-01   +4.953075753147619e-01   +4.144746453534611e-01   +7.730464625087360e-01   +6.355113034897087e-01; -1.910754913561580e-01   +7.317865638452962e-01   +5.764421767034438e-01   +1.085509925803683e-01   -1.669996260095660e-01   +4.242353908473405e-01   +4.165376948976277e-01   +2.528753316707687e-02   +2.843647759062676e-01   +4.480793043869936e-01   +4.494802222479075e-01   +2.164452843699331e-01   +6.049639567445991e-01   +4.985263729225444e-01   +1.902240858822474e-01   +1.941746888660018e-01; +6.742720086779982e-02   +3.990948121745654e-01   +3.930792755083538e-01   +3.553314176630445e-01   +2.101477046300742e-01   +1.902560402494342e-01   +7.552760129945743e-01   +6.811960943003160e-01   -6.383788391576194e-02   +3.347929868954355e-01   -1.944702255978356e-02   -2.373072931699299e-02   +1.337863187724556e-01   +1.957774189485041e-01   +3.413620998709750e-01   -8.319780540816833e-03; +2.167919117592090e-01   +2.377390056640477e-01   +4.371802992997235e-01   +5.031187707476832e-01   +3.081176365942195e-01   +4.338997885992435e-01   +3.475068657984183e-01   +5.132396812368952e-01   +2.974813294387759e-01   +4.975156460080949e-01   -2.678736096717801e-02   +3.498595713721728e-01   +4.382056858808252e-01   +6.189203071587651e-01   +4.254308440201075e-01   +5.514637184226122e-01];
L1E_L1I_iGABA_netcon = [+3.279724253975638e-01   +1.667562287555621e-01   +2.312513154196708e-01   +2.556439058822412e-01   +4.139045908625727e-01   +5.093318689730377e-02   -6.508872438424675e-02   +3.308936506736260e-01   +5.349623389823596e-01   +1.599048305169672e-01   +6.549968460919856e-01   +4.207234577033618e-01   -3.551159651383894e-02   +5.535984865853630e-01   +3.126440385902034e-01   +2.584852282330274e-01; +5.003686289521887e-01   +3.222442989773648e-01   +5.200379913606781e-01   +5.647475452024699e-01   +8.200487011621335e-02   +1.832877522752685e-01   +3.129639358003891e-01   +1.722220596701606e-01   +2.640610758702919e-01   +2.886176163806995e-01   -1.331362225657994e-01   +2.719697122453902e-01   +2.157317942212627e-02   -1.369221768830131e-01   +4.349782274495572e-01   +8.090926224254445e-02; +1.625688960053852e-01   +1.218380247619758e-01   +6.475157152147695e-02   +6.051260542535772e-01   +6.579080466452486e-02   +2.750522137191332e-01   +2.889957501021128e-01   +2.788606147234848e-01   +2.320994400939429e-01   +1.673532317805676e-01   +2.680615867474958e-01   +3.446616011557999e-01   +8.334872120450567e-01   +4.093485852362536e-01   +1.102626326815560e-01   +3.117360102092491e-01; +2.525634831125229e-02   +7.618913994226848e-01   +3.681847886979054e-01   +3.858404588458130e-02   +4.837509368008566e-01   +5.405131537224039e-01   +3.419167254275453e-01   +2.966527187642560e-02   -8.390228928127352e-03   -1.381417040388103e-01   +2.500256416280222e-01   +4.399395907044358e-01   -2.886451303066634e-01   +4.416326229565769e-01   +3.673911007775678e-01   +1.611023590082808e-01; +2.218124778148190e-02   +5.747009525603586e-02   -1.668025888301888e-01   +1.474694025658346e-01   -7.867818757895241e-02   +5.887511213905174e-01   -2.030579257064349e-01   -1.668492576479054e-01   +8.215670752671669e-02   +2.825634715424337e-01   +3.366892336009499e-01   +6.212743891457935e-01   +1.002206828185115e-01   -2.572747058289251e-01   +4.157699395138253e-01   +1.000000000000000e+00; +3.480194577802254e-01   -6.916965804634691e-02   -3.491622079079541e-02   +2.420298749095696e-01   +4.941374440416261e-02   +3.354178775406960e-01   +5.106977517988565e-02   +7.779518618785948e-01   +2.417230070818829e-01   +8.815536113228862e-01   +4.863217976609532e-01   +3.400782655435514e-01   +3.268719978761641e-01   +2.837113959412553e-01   -7.607118574079056e-05   +3.528390387240752e-01; +1.886956040671924e-01   +2.009719414926924e-01   +8.767486768543340e-03   +1.010776061519859e-02   +3.080339053360256e-01   +3.821125904505707e-01   +6.004472415984889e-01   +1.278777705221698e-01   +3.544111088108937e-01   +5.399372911336578e-01   +9.486495438258401e-02   +6.166279570463871e-01   +1.544276988631424e-02   +4.350335630451462e-01   +1.043228699242232e-01   +2.877764752331695e-02; +5.294965326188480e-01   -1.954535258453214e-01   +4.153002399964664e-01   +5.540252666846078e-01   +4.589698679169069e-02   +6.233955431566680e-01   +2.477987852690234e-01   +3.650640280331745e-01   +2.560946570921656e-01   +2.951817264405271e-01   +6.413096072517817e-02   +4.710917859587401e-01   +3.885543504550587e-01   -9.526288504270262e-02   -4.020960430939769e-01   +1.189711671032350e-02; +2.288676468226161e-01   +2.533505595533357e-01   +4.131866595095339e-01   +3.947216099279005e-03   +5.845087400565419e-01   +8.738254325527799e-02   +4.963777805961615e-01   +2.442829783083943e-01   -8.328039183726101e-02   +7.426823863977789e-01   -9.695216561089369e-02   +2.329751481251205e-01   +8.986565198054289e-02   +2.864794421417993e-01   -7.366263724726571e-02   +2.134509824835754e-01; +7.902614372377469e-02   +1.454203613227565e-01   -1.134995033043707e-02   -1.090877700471026e-01   +5.302069687646126e-01   -2.573471544554646e-01   +3.038830646084193e-01   +9.492156297071314e-01   +2.361206754943796e-02   +4.408237706184499e-01   +1.187788565273821e-01   +4.557762903471443e-01   +2.129824921379767e-01   -5.657040552838815e-03   +2.705313756136710e-01   +7.706243068795703e-01; +5.944446656952627e-01   +2.315895946181086e-01   +5.845410304683637e-01   +6.535942109796508e-01   +4.110818050951615e-01   +2.425947540715084e-01   +1.747052320251141e-01   -3.047595157957284e-02   +6.198973169785552e-01   -3.340831462840119e-02   +2.125089973600833e-01   +4.756232985589275e-01   -1.326147043015297e-01   +6.803618729234109e-01   -7.528350993065491e-03   +2.212915504200511e-01; +5.153529701584056e-02   +2.889251073358816e-01   +5.484988544913502e-02   +7.083662112492892e-01   -3.404652537559726e-01   +3.110452366413642e-01   +7.105517358400491e-02   +4.973631831328077e-01   +5.597588405734667e-01   +9.665634299912004e-02   +5.635974220629159e-01   +6.097036139589217e-01   +3.685038346650230e-01   +3.298028513338357e-01   +2.119078346299710e-01   +1.142600706770414e-01; +6.749046805091416e-02   +5.392231070523478e-01   -3.764780722866099e-02   +4.052325354236979e-01   +2.722709722509151e-01   +4.142288098552329e-01   +2.757023352802480e-01   +4.329032802209352e-01   +5.533975461540789e-01   +5.165246511749634e-01   +1.698856633804325e-01   +2.141019029270805e-01   +3.060823940368589e-01   +2.121147053935737e-01   +5.057028800814049e-02   +4.115616913270880e-01; +5.313124204828037e-01   +7.055884369514659e-02   +4.828265048108629e-01   +5.841983265683737e-01   +3.457643338318781e-01   +1.099827512213813e-01   +3.754891300259103e-01   -1.675516332962720e-01   +3.964478339948999e-01   +4.355616954734867e-02   +6.610127640851099e-01   +8.502807198384389e-01   +4.266174517386203e-01   +4.438318835316715e-01   -1.931431790391196e-01   +4.646679172320325e-01; +1.845557724200313e-01   +4.591778442218849e-02   +1.412101085472269e-01   -1.709806416111627e-02   +4.665852135129717e-01   +2.936212143429792e-01   +4.763986681236342e-01   +4.793786598719319e-01   +7.095425731272167e-01   +4.087247145830534e-01   +2.517220766715940e-01   +2.953219324618757e-01   +2.348041682552389e-01   +1.883534542743619e-01   +2.249663071426793e-01   +1.980981134205694e-01; +7.124980993153397e-01   +3.346518735207780e-03   +4.904738698326834e-01   +1.839777019650418e-01   +6.270234692393750e-02   +3.870188289918609e-01   +6.718701005923106e-01   +1.495867748028492e-01   +1.818896253438738e-01   +4.968373797961645e-01   +4.472681592688754e-01   +3.483335504638484e-02   +6.110666678510279e-01   +7.368011154507169e-02   -1.941206264909758e-01   -1.157301092058302e-01];
L2I_L1I_iGABA_netcon = [-7.230222261007073e-02   +5.756101839620423e-01   +5.446515033194306e-01   -8.063232088296277e-02   +4.088075992266340e-01   +1.108806234055697e-01   +1.316275354270550e-01   +3.206059564660442e-01; +3.315212321817970e-02   +3.883271947390766e-01   +3.826060253089361e-01   +5.064006140876273e-02   +5.246254533056420e-01   -2.704200918416578e-02   +4.013349696810621e-01   +7.956497038281101e-01; +8.572953024902483e-02   +1.763137942257301e-01   +5.770773502950671e-01   +6.988653942345964e-01   +3.056412180994992e-01   +4.636532859743421e-01   +6.956352700566935e-02   -7.128778075761152e-02; +5.670068786881235e-01   +2.651079950442048e-01   +4.426613006977179e-01   +7.232971814599692e-01   +2.407865534001034e-01   +2.736378594312109e-01   +4.368944213427215e-01   +8.301814404699905e-02; +1.000000000000000e+00   +5.664547138400895e-02   +3.217595142491799e-01   +1.513396241544633e-01   +4.838347701408162e-01   +3.051779433968420e-01   +7.337547401605983e-01   +5.236560002135043e-02; +2.997029629734644e-01   +6.188075811299399e-01   +4.688128805394938e-01   +4.880856225625680e-01   +6.930396063157189e-01   +7.021483514301653e-01   +4.028400233600005e-01   +6.949771292431673e-01; +5.001068254250634e-01   +5.757020551863866e-01   +2.860760028797279e-01   +1.171775841443806e-01   +7.496891310075888e-01   +4.349765224431354e-01   -1.363460133125803e-01   +5.166186337167422e-01; +6.698526262224698e-01   +2.487896511682059e-01   -1.211203853030405e-01   +3.893828279955320e-01   +6.355045808453094e-01   +6.068057644724097e-01   +5.478441248541321e-01   +3.330220530452667e-01; -3.443119273676732e-02   +2.861586879034992e-01   -1.369488594029553e-01   +1.128368811270002e-01   +6.239654148094127e-01   +6.661589179707821e-01   +2.989507995700018e-01   +9.677865588828580e-02; +4.574521207105137e-01   +5.701597746025986e-01   +4.144825391685111e-01   +3.074065732706809e-01   +4.560361298225695e-01   +1.170905252947256e-01   +5.141669041522199e-01   +2.680222387617171e-01; +4.832749545581110e-01   +9.027009255184101e-02   +7.100372697683417e-01   +6.591778669709419e-01   -2.785176710163264e-02   +3.712283960476026e-01   +4.854482936302726e-01   +2.372632437611489e-01; +4.228700660454865e-01   +1.373238895865843e-01   +4.711999824808559e-01   +3.233902595317574e-01   +3.459458857967791e-01   +4.120997295947794e-01   -6.898047689754194e-02   +9.087936440640730e-02; +7.723374926848392e-01   +6.918177284073184e-01   +3.344329238264818e-01   +2.303081017888361e-01   +3.860228189912717e-01   +1.273882829105445e-01   +3.974368544589618e-01   +6.165828214699053e-01; +2.222544471371103e-01   +7.027171925925049e-01   +1.240577185976972e-01   -2.660087035952114e-01   +6.517422665305348e-01   +6.077823560314140e-01   +7.351117932098897e-01   +4.600234107775754e-01; +4.539387290620218e-01   +4.786156784901214e-01   +4.866017446285184e-01   +4.014991915968018e-01   +4.130812530348567e-01   +3.522285027559041e-01   -3.733502473589889e-01   +5.337010822401216e-01; +2.841852157772685e-02   +4.115017136788109e-01   -5.269123682630163e-02   +1.633517781361066e-01   +5.215316813646296e-01   +3.095513629668555e-01   +1.619235229227275e-01   +4.868048076228531e-01];
L1I_L2I_iGABA_netcon = [-7.297152048749186e-02   +7.338942918137574e-01   +1.038121719388028e-01   +6.854655390905010e-02   +8.722482135535335e-01   +8.045067154712852e-01   -1.948133608342410e-01   +9.747402032148841e-02   +3.562082626778574e-01   +3.686260652617911e-01   +4.803709445149421e-01   +6.018364712487054e-01   -3.749102450452826e-01   +4.334197965497585e-01   +2.886485853447106e-01   +7.509857646552497e-01; +7.646730527035372e-01   +7.566816414906092e-01   +4.099981047444520e-01   -1.381693512498464e-01   +1.255236972792120e-01   -1.571552324223870e-01   +1.225351344931930e-01   +1.723805430186719e-02   +2.772840859200175e-01   -6.963818450891977e-02   +4.066348726302824e-01   +1.383967189500951e-01   +6.967912301432559e-01   +3.822342950593315e-01   +9.520258033224246e-01   -4.443481200006049e-01; +5.641529171366900e-01   +3.445362516946703e-01   +6.738465835406375e-01   -3.665404548293039e-02   +3.587744422466385e-02   -1.365686820599075e-01   +5.687533661222752e-01   +1.109671417984616e-01   -2.346987634762619e-01   +8.315868675485752e-01   +2.498619274851080e-01   +9.261762734320481e-02   +4.316270979054133e-01   +5.907604057423144e-01   +9.278500167534751e-02   +3.192124698931603e-01; +4.517630109633939e-01   +2.524931688296033e-01   +7.993601330419561e-02   +2.636545949566139e-01   +8.645634035445728e-01   +7.854314884759120e-02   +1.086559489386271e-01   +1.197646608892352e-01   +5.840456399212859e-01   +3.264374559632388e-01   +1.120580387182504e-01   -5.565497667221428e-02   +1.994289287994174e-01   +2.051129695289405e-02   -2.980661461668979e-02   +5.393866329291452e-01; +6.510755918982439e-01   +8.220208424920593e-01   -1.119556934095841e-01   +8.366139376151074e-01   +3.326715732682886e-01   +1.756244406010646e-01   +3.530624022852307e-01   -3.211772501858217e-01   +5.459875792725936e-01   +3.465373940008810e-01   +6.648003192191261e-01   +9.785258613476876e-01   +5.143515492295041e-01   -8.279709704095994e-02   +3.926903087647549e-01   +4.761372494275994e-01; +2.292620667181903e-01   +1.100271405921382e-01   +2.774213101226016e-01   +8.928983792926029e-02   +2.910766060959138e-01   +4.584834921919292e-01   +6.520968413627454e-01   +4.133845113699842e-01   +6.395928480177313e-01   +5.053392144035007e-01   +5.800611967519845e-01   +6.064159461977316e-01   +2.531892163012910e-01   -1.212317176760019e-01   +3.200824888162823e-01   +4.964601933792168e-01; -1.544260617211560e-02   -5.362630214242699e-02   +3.465556014470217e-01   +4.499298202838262e-01   +2.422836300285021e-01   +4.764729845944823e-01   +2.120017902630787e-01   +3.152466549126902e-01   +1.139687379520943e-01   +3.628471226338987e-01   +2.127410385556022e-01   +1.535503251966041e-01   +3.127902547705510e-01   +2.720068843740628e-01   +5.085656131239972e-01   -4.056614548256651e-02; +4.948294208850054e-01   +8.562556115833863e-01   +3.445216766599834e-01   +6.897285838002901e-02   +6.097874982424402e-01   +5.600903348090402e-01   -1.156419909260609e-01   +1.940399434812226e-01   +2.686611224228587e-01   +4.784922658666914e-01   +1.669493264030020e-01   +7.936092819660043e-01   +5.354839392605570e-01   +8.179510644661286e-01   +2.124232183562948e-01   +4.161439560499045e-01];
L2E_L1E_iAMPA_netcon = [+2.847350064632307e-01   +4.972568941944484e-01   +5.384730881137481e-01   +3.804876324489309e-01   +3.297622897661790e-01   +6.762999491704360e-01   +2.491836686875102e-01   +1.059994123075856e-01; +1.019266455397207e-01   +2.297893826691027e-01   +2.686276706251799e-01   +6.528958734114561e-02   +4.356429613797259e-01   +2.693501347957656e-01   +4.681064626408963e-01   +2.135176738704372e-02; +2.790448608374133e-01   +2.742369325149956e-01   +6.464930802471527e-01   +4.127892946750029e-01   +2.507131139667450e-01   +7.432035428831631e-01   +3.431148891994035e-02   +6.795293744211941e-01; -4.120656075979907e-01   +3.494169379975859e-01   +6.958502434440823e-01   +2.024683511212982e-01   +2.770813507157467e-01   +5.848631192448320e-01   +9.245213899396712e-02   +1.846242947959373e-01; +9.040313549116071e-01   +4.155428530346879e-02   +2.265463043276637e-01   +5.982988890595995e-01   -2.349967156624230e-02   +4.689964768456157e-01   +5.138919891815671e-01   +7.639563064554378e-01; +3.903847519528415e-01   +2.815178012103671e-01   +4.897848710233650e-01   +4.797882035079398e-01   +4.189577372739828e-01   +8.258434656238336e-01   +5.586255879018299e-01   +4.815050114481639e-01; +4.730558527579514e-01   +4.585534669588967e-01   +7.419695705709404e-01   +4.183951531493361e-01   +1.815666677161974e-01   -9.452761416728904e-02   +2.336735592092942e-01   +6.832041560133613e-01; +4.818874837886090e-01   +5.093097501283398e-01   +6.156009161244140e-01   +4.096396743350842e-01   +1.702385390006478e-01   +1.000000000000000e+00   +2.431153080688501e-01   +5.442898931318298e-01; +1.704160788911702e-02   +1.875271840103736e-01   +3.971721435767685e-01   +3.612370841228332e-01   -2.645231353850789e-01   +4.684787490248818e-01   +6.536322543014936e-02   +5.780148621539424e-01; +4.420652964952062e-01   +1.743016992631562e-01   +4.647240020862304e-01   +2.392911119232001e-01   +1.980684426702465e-01   +5.178841290651055e-01   +4.405765393565570e-02   +6.928999315755507e-01; +1.657057843488496e-01   +6.030649457067280e-01   +5.954977311842892e-01   -4.337595495775201e-01   +2.554032053457796e-01   +5.052378593440399e-01   -3.775524861575829e-01   -1.254470774455396e-01; -6.453940951263896e-02   +4.620744332769153e-01   +4.904512718025631e-01   -7.052509797255260e-02   +3.300270091332732e-01   -3.940528382699354e-02   +7.995180194949207e-01   +3.000184452745498e-01; +3.937172957655699e-01   +7.312911054994999e-01   +8.383655947471218e-01   -2.828357243528697e-01   +4.212334851285808e-01   +5.224410526464033e-01   -1.175268334014122e-01   +6.557053620540793e-01; +2.328411133215564e-01   -5.314594849399282e-01   +4.961927403190927e-02   +2.836260569902974e-01   +3.837472453765685e-01   +5.618828762188625e-01   -1.292580651854357e-02   +2.859153158427771e-01; +2.208312553259817e-01   +3.561297039327972e-01   +2.871568643121374e-01   +1.687233434809621e-01   +1.545609634334730e-01   +2.116208003244276e-01   +3.737349556449163e-01   +2.827630343422773e-01; +2.146067275534225e-01   +6.791198630622659e-01   -5.188413888001870e-02   +3.080211616075892e-02   +4.557065166854349e-02   +2.393476307457410e-01   +2.967957422465439e-01   +3.843284652957377e-01];
L1E_L2E_iAMPA_netcon = [+3.783655322963664e-01   +1.161297255449111e-01   +3.233027189836220e-01   +6.266301557690073e-01   +4.534530550747665e-01   -2.912802976099135e-01   +4.295298342203739e-01   +6.479650646926760e-01   +3.059635961010727e-01   +4.359746888024026e-01   +3.979124005177831e-01   +9.486036522051194e-01   -1.020653120274055e-01   +1.542599465970699e-01   +4.974305744802073e-01   +2.284536525866794e-01; +4.058670870906447e-01   -3.263273274211709e-03   +3.724798081879890e-01   +4.109333645627179e-01   +2.841592682812154e-01   +1.993799791919739e-02   +3.089573640314621e-01   +7.084322035582906e-02   +6.259242388160912e-01   +1.000000000000000e+00   +4.927192490820750e-01   +7.103686407913121e-02   +5.960019078379394e-01   +7.378855322574466e-01   +6.120171794479042e-01   +3.875334580831685e-01; +3.897747247176689e-01   +5.341700989933439e-01   +1.155065445051319e-01   -1.200030315407019e-03   +3.520445176137088e-01   -2.753705409493630e-02   +6.618920416217764e-01   +6.572264689448326e-01   +6.511710733130952e-01   -2.504912305545148e-02   +6.297944691136642e-01   +1.339848620252653e-01   +3.352472026571244e-01   +1.481889298425991e-01   +1.478482327451123e-01   +1.997923607939205e-01; +4.243833865133766e-01   +4.595828858857363e-02   +2.508840754203503e-01   +4.413498528658502e-01   +2.881088246806721e-01   +1.192041029725718e-01   +6.665942345421946e-02   +1.396413672691303e-01   +8.027661867366683e-01   +5.032642244541160e-01   +3.207577422040753e-01   +2.489712032910314e-02   +2.026553897464770e-01   +4.677600764059909e-01   +5.129500162689800e-01   +1.562105848138144e-01; +4.747832810566639e-01   +2.663426034850911e-01   +6.495438441976728e-02   +4.836525061892468e-01   +3.468322071218553e-01   +5.221915194543545e-01   +6.377619061622770e-02   +1.638986354475065e-01   +3.224391028216997e-01   +3.772750550286973e-02   +4.157778019693052e-01   -1.861107874447627e-03   +3.416317589647896e-01   +5.795939525201949e-01   -1.174369629846925e-01   +3.702733346282388e-01; +4.296778415642321e-01   -2.824710287833584e-01   +5.194910877472789e-01   +1.926100714466025e-01   +2.839166694385702e-01   +2.386790436793524e-01   +3.346426852688367e-01   +6.909832796730989e-02   +3.761067642293729e-01   +1.576067741430184e-01   +1.910877272786162e-01   +5.749324389618498e-01   -2.095627910276402e-01   -1.140802370008145e-01   +1.960675812173694e-01   +5.442610490000495e-01; +3.752353444063671e-01   +3.485793990967727e-01   +4.411870625194730e-01   -1.034470120349417e-02   +9.791574739450871e-01   +5.640123733260758e-01   +1.808544880937037e-01   +6.562012979873783e-01   +5.003614689948884e-01   +6.262470405614473e-01   +4.519836234475209e-01   +2.948204646621829e-01   +3.791935964709688e-02   +3.371687739061744e-01   +5.963961519015338e-01   -6.940190521196757e-02; +4.278127028692049e-01   +3.959848401913848e-01   +7.639066585292856e-01   +8.214654573488271e-02   +7.514986608159181e-01   +3.513074523703898e-01   +4.794471943099040e-01   +2.530321086314535e-02   +3.300436879602029e-01   +4.423500985342239e-01   +3.923707618921319e-01   +2.686235382054370e-01   +6.193022871823142e-01   +6.676553390441915e-01   +5.412760931476840e-01   +2.460801291931254e-01];
L2I_L2E_iAMPA_netcon = [+5.681511225572031e-01   +1.000000000000000e+00   +2.398870901166092e-01   +5.260444670856576e-01   +8.745226743759292e-01   +4.872793724393141e-01   +8.950069023566249e-01   +2.867206526789183e-01; +8.712172133763161e-01   +8.563247790477420e-02   +2.817705378737105e-01   +1.751085903724826e-01   +4.167170580437397e-01   +1.050725010089124e-01   +1.482421390780228e-01   +8.562726036652600e-01; +6.220762901067722e-01   +3.728850225747844e-01   +5.354596049658841e-01   +2.715942346668098e-01   +3.508763125898332e-01   +4.944259022150506e-02   -1.395895936098921e-01   +7.299673028787537e-01; +1.360785938810160e-01   +7.761595697244302e-01   +3.367523234865131e-01   +3.333092934384391e-01   +7.331206605022579e-01   +1.418829640241539e-01   -3.874985052038695e-02   +5.295494206595538e-01; +4.408971731698634e-01   +5.272816394339104e-01   +6.697924158854867e-01   +8.817710434634260e-02   +5.148673515523463e-01   -1.538869543591240e-02   +2.553260692432622e-01   +4.950674648866193e-01; +1.970822466177155e-01   +1.051602752422499e-01   +5.269333054114773e-01   +1.514986922684328e-01   +7.606435064033171e-01   +5.293839523928544e-01   -4.422634620090202e-02   +4.364386299952807e-01; +3.814329967406903e-01   +3.261793282883768e-01   +7.213148463538031e-01   +3.841889331676736e-01   -2.625462031034740e-02   +1.792810425727510e-01   +4.390251402118669e-01   +8.312337788264357e-01; +3.781641865545471e-01   +4.717756302223229e-01   +1.969608614678006e-02   +5.790784636459138e-01   -1.158471675957644e-01   +6.162240657611322e-01   -2.828306123072559e-02   +5.346407459862174e-01];
L2E_L2I_iGABA_netcon = [+4.243440346387733e-01   +3.456488402958047e-01   -2.022950119973640e-01   +6.398507377235890e-01   +3.872151397548149e-01   +4.893085933354847e-01   +5.143367302072724e-01   +2.213190637542608e-01; +4.028240261981409e-01   +5.132534080145186e-01   -3.050125657214624e-02   +9.043608468064898e-02   +3.769353888618555e-01   +3.879006220507132e-01   +1.468076927899008e-02   +5.524805644727365e-01; +3.146202953452439e-01   -1.123659014018608e-01   +2.543619838357828e-01   +4.936990821554030e-01   -3.890266033018221e-03   +2.167629004294808e-01   -2.608776580121891e-02   +2.655677615975151e-01; +4.584036519995664e-02   +2.389396887649560e-01   -3.395591445364919e-02   +4.728612965250601e-01   +4.587451336357571e-01   +3.694701519208008e-01   +4.459349806465157e-01   +5.549804797485220e-01; +1.439230164073987e-01   +2.871952598050881e-01   +3.310526453612879e-01   +2.192227063335265e-01   -3.000453532090596e-02   +4.315276683059312e-01   +2.436769247811788e-01   -7.313362297793709e-02; +3.346791878013777e-01   +6.005796934537343e-01   +9.245412699281852e-01   +1.000000000000000e+00   +4.525574062072871e-01   +1.191273045886882e-01   -6.825571001451299e-02   +5.903022890441681e-01; +4.310781688147836e-01   +1.076103103961659e-01   +1.217279339298587e-01   -1.665288965753511e-02   +1.919542869325997e-01   -2.548163386873619e-01   +1.943891329771683e-01   +2.969677903249785e-01; -3.373549571798722e-01   +3.843256769582206e-01   +4.184729248869764e-01   +3.296267967264238e-01   +6.765130619360142e-01   +4.582207638016327e-01   +5.987997355096623e-01   +4.926195730809171e-01];
L3E_L2E_iAMPA_netcon = [+9.212643114646575e-02   +4.886987739968921e-01   +5.166963460148214e-01   -4.616878381707179e-02   -4.860124947323827e-02   +5.499858596797595e-01   +7.097344188812098e-01   +3.105016594162012e-01   +5.075810867137842e-01   -1.827505134067143e-02   +2.799260039036027e-01   -1.310201741899230e-01; -2.751618332848659e-01   +6.574667590409837e-01   -2.290720031874091e-01   +9.599482455704453e-02   +3.207842021629395e-01   -3.764697130193058e-02   +3.321608399197268e-01   +2.647504419411839e-01   +5.300214855889617e-01   -1.164764164251212e-01   -9.163943761591190e-02   +1.922097050582741e-01; +2.616707787773343e-01   +1.001030788245297e-01   +2.551113662765620e-01   +2.295048622247149e-01   +3.125721741345318e-01   +6.398020550494521e-01   +2.603119818850029e-01   +5.738809557344834e-01   +5.721379549555061e-02   +1.785186470616297e-01   +3.902998071180596e-01   +7.588773489810384e-01; +4.702178773625544e-01   +4.986980025517664e-01   +5.644452730408465e-01   +5.408612097767336e-01   +3.327371332161293e-01   +7.847796743148197e-01   +2.943852588836011e-01   +2.289814035387190e-01   +5.122123832954772e-01   -5.768687837564307e-01   +5.246775150048237e-01   +1.000000000000000e+00; +1.441761774559319e-01   +4.824878826780837e-01   +4.491404380414927e-01   +3.018005518594412e-01   +1.728068301604977e-01   +3.665578102752606e-01   +3.521310029388826e-01   +8.519769838555132e-01   +6.207562528987235e-01   +3.880158437825145e-01   +6.089540628991937e-01   +2.627858624023886e-01; +1.172288745803419e-01   -1.883087414161252e-01   +8.266027744354625e-01   -2.758981722807083e-01   +2.927953246675973e-01   +5.201717753680006e-01   +2.643167763418200e-01   +2.755546641419892e-01   +4.555076163151761e-01   +3.128575594234636e-01   +3.422759951570432e-01   -2.293430612095197e-02; +1.126904001915738e-01   +2.559340613059500e-01   +1.854874353147441e-01   +4.011686944438108e-01   +9.132833701113071e-01   +6.080267963080223e-01   +8.747092382453198e-01   +4.822510514915950e-01   +4.424314455723787e-01   +3.991406524982048e-01   +3.543990110345900e-01   +8.500054609286498e-01; +4.352784852717002e-01   +6.275785822916975e-02   +3.804867668586959e-01   +7.074109342689967e-01   +3.084094155453564e-01   +6.739502229556245e-01   +6.325512052701224e-01   +3.638605873923271e-01   +4.203469068342336e-01   +2.654701370392424e-01   -1.642245432518980e-01   +4.453134018665211e-02];
L3I_L2I_iGABA_netcon = [+7.188450572165030e-01   -9.204095109625901e-02   +1.108952475841375e-01   +7.073179021385904e-01   +4.358212256841207e-01   -2.222299673241592e-01   +2.067388197014375e-01   +2.892906650644825e-01   +6.041175010888925e-02   +5.153619863957151e-02   +2.259388226367777e-01   +2.334547196359455e-01; +7.689750016927844e-01   -2.347647463043667e-01   +9.189485871737743e-02   +2.982065530096711e-01   +6.890730749906713e-01   +6.483806825550220e-01   +2.329466855418951e-01   +4.955790942959455e-01   +1.747843006083543e-01   +3.252214108845070e-01   +4.280579195561807e-01   +3.611387925248250e-01; +5.149986186733519e-01   -1.063074801464403e-01   +3.368721108457896e-01   -3.786320864360609e-01   +2.360066390971882e-01   +4.043510085768076e-01   +6.448615172771732e-01   +2.437580399998972e-01   +2.347170806277631e-01   +4.412079483597823e-01   +4.350336191857503e-01   +1.000000000000000e+00; +6.286501472283262e-01   +2.585099936286854e-01   +4.902550872084213e-01   +7.362269161006220e-01   +4.071196970329159e-01   -2.996835439176672e-01   +6.304433047128307e-01   +2.331716523663390e-01   +6.783423935404350e-01   -1.071793963786812e-01   -1.259513841912010e-01   +4.315776210764480e-01; +5.135315574249177e-01   +3.236198286869832e-01   +6.657477176288633e-01   -4.379840685603862e-02   +5.433858387694314e-01   +7.600306483512590e-01   +4.310488659687795e-01   -1.111775087602137e-01   +2.523451131551673e-01   +4.888145634422850e-01   +5.362305229338831e-01   +9.988411881114277e-02; +3.800648365263767e-01   +2.042824056614853e-02   +5.638416606101416e-01   +8.782199267619956e-01   +6.855988410547932e-01   -1.616065289706881e-01   +2.679599110611021e-01   +6.000908313550835e-02   +3.090905042284088e-01   +2.990589648061601e-01   +3.618049305761425e-02   +4.414160342520906e-02; +6.491303617586326e-01   +2.371322669733107e-01   +5.380114527928951e-01   +1.584240504280476e-01   +1.312312038740552e-01   +4.020907950024251e-01   -4.694630145387801e-02   +3.378659869582533e-01   +8.346996968326065e-02   +8.873475940583323e-01   +3.048470510628455e-01   +3.929783018410105e-01; +3.075379898323387e-01   -1.990537567437842e-01   +3.632779552608402e-01   +5.504129384401855e-01   -1.255323762797279e-01   -9.385378487747330e-02   +2.845492569603769e-01   -1.195995319294868e-01   +1.886799714518410e-01   +6.640919082972183e-01   +3.441934324749850e-01   +3.618671397546021e-01];
L2E_L3E_iAMPA_netcon = [+6.859690440262295e-02   +1.000000000000000e+00   +3.917015200897120e-01   +5.120667740184884e-01   +1.460262309884440e-01   -1.406298331890087e-01   -7.981900643597610e-02   +2.604109038866905e-01; +3.769059832210536e-01   +3.298185787446378e-01   +4.990505491367009e-01   +2.321337465332336e-01   +3.245005284037804e-02   +2.036351040432838e-01   +3.910039199686299e-01   +5.936713566170941e-01; -5.018904994398375e-02   -1.624290137752515e-01   +6.846574284663295e-01   +6.693122259503242e-01   +4.599792905669001e-01   +3.652274371080474e-01   -5.579103498071514e-02   +1.770173740064696e-01; +2.031639101502220e-01   +3.674614564069347e-01   +4.748409171786996e-02   +7.073792993097481e-01   +6.327965092718731e-01   +3.994029243629106e-01   +4.690354936251007e-01   +8.141413404333246e-02; +4.274119837271652e-01   +6.724178636375716e-01   +3.004405163235983e-01   +7.549283522240127e-01   +4.967050955230705e-01   +4.272635307842588e-01   -1.066270760040641e-01   +6.975101118965412e-01; +8.665076589823161e-01   +5.689757610244298e-01   +3.661809457787417e-01   +1.267034453346226e-01   +3.976439686518117e-01   +4.466306064610481e-01   +5.771337378646725e-01   +5.070852489833324e-01; -8.654735816942287e-02   +3.404983209819765e-01   +2.313394251153467e-01   -2.230388164148508e-01   -8.882887091772802e-02   +2.688041280376785e-01   -6.153126341373290e-02   +4.435984610116355e-01; +6.223569198720443e-01   +1.241531258230517e-01   +8.034091640166560e-01   +1.435244295451067e-01   +3.059279270078207e-01   +2.035719526438526e-01   +3.924700349107837e-01   -1.702758782287357e-01; +1.307362496437904e-01   +4.212183220878775e-01   +2.941993747713069e-01   -6.191146183330251e-02   +2.000066977488734e-01   +3.189017352138611e-02   +2.471496120182965e-01   +3.107309512109631e-01; +1.842625676441601e-01   +5.635886967853511e-01   +5.874525352160966e-01   +3.442196851272573e-01   +3.866198689332481e-01   +3.865053872791907e-01   +7.459956361591032e-01   +3.520245712935220e-01; +4.538579151238618e-01   +6.799116054430896e-01   +8.489982598642215e-01   +1.983766361777503e-01   +1.167019677026482e-01   -3.405567831274022e-01   +6.996496127067570e-01   +8.450525478847529e-02; +8.072485166753022e-01   +2.789311667333574e-01   +1.959924891943353e-01   +7.179853183739180e-01   +2.236079841840992e-01   +3.898101979726373e-01   +3.833931400438107e-01   +3.854905449937895e-01];
L2I_L3I_iGABA_netcon = [+2.282151311407825e-01   +1.586467853594513e-01   +4.893143402711173e-01   +3.499795977953563e-01   +2.707234375993970e-01   +4.154524902949127e-01   +5.053339171002780e-02   +3.275986580962519e-01; +1.631843336997888e-01   +5.781766071938944e-02   +6.491357687930189e-01   +2.286008269556579e-01   +1.538245891106782e-01   +3.799210372688033e-01   +7.327618449073082e-01   +5.323454804745268e-01; -1.125554708163999e-01   +2.208984823004682e-01   -1.731851516892497e-01   +3.629445608568512e-01   +2.429830696638280e-01   +8.099791115584080e-01   +2.438699988455869e-01   +2.261307088355348e-01; +2.418041214951383e-01   +1.493013226014356e-01   -2.575676195120801e-01   +3.551027316998654e-01   +6.704976621855179e-01   +1.769391432047321e-01   +5.554838426357480e-02   +4.220483398957505e-01; +5.663749721069786e-01   +1.683471270842903e-01   +4.894826142117468e-01   +6.647518972477380e-01   +2.570682832080752e-01   +6.062428881856662e-01   +1.779506950732777e-01   +1.001851058506039e-01; -3.401650158272170e-01   -2.528923426539904e-01   +4.065189223267550e-01   +4.376729896800829e-01   +7.430466491894168e-01   +3.138095906354731e-01   +3.675437734719046e-01   +2.177966085876898e-01; +1.218541592999354e-01   +3.809057173855981e-01   +1.456217249890983e-01   +4.487607709850118e-01   +2.443623272577443e-01   +5.724622715409031e-01   +4.732826528803269e-01   +1.000000000000000e+00; +5.372496125179163e-01   +5.937862236687533e-01   +2.138317717216516e-01   +1.348829989458994e-02   -2.753508852034945e-01   +7.294194434510618e-03   +3.815903617282516e-01   -1.473766393201184e-01; +5.630624898429010e-01   +2.624287067901099e-01   -2.178317624763246e-01   +1.676869395221577e-01   +4.104080180397996e-01   +8.868879826341429e-02   +4.010813464077999e-01   +2.011497641270400e-01; +1.224965269056766e-01   -5.001791747486550e-01   +6.492734121594567e-01   +3.511211900047726e-01   +8.304807911687448e-01   +4.465028564806192e-01   +4.308724804534120e-01   +5.727571057564806e-04; +4.633923168678283e-01   +3.577614725436362e-01   +5.223505132178132e-01   -1.743049839789092e-01   +4.009316828029631e-01   +3.153197358932627e-01   +4.850459271049301e-01   +5.748135272307023e-02; +6.247232739259736e-01   +1.932185474402250e-01   +4.522531963058250e-02   -1.907526396609776e-01   +4.159518516064907e-01   +6.415556962422422e-01   +1.243998085972816e-01   -7.276971790551914e-02];
L3I_L3E_iAMPA_netcon = [-7.969200968289722e-02   +1.493967140670435e-01   +1.823869299754870e-01   +7.370837674148121e-01   +6.178854779028798e-01   +3.314370813386078e-01   +1.637581291351757e-01   -5.910229194245523e-02   -1.071356850300603e-01   +3.721815353965872e-02   +1.084933049217858e-01   -2.585723934863038e-01; +4.766647543036015e-03   +4.457037659896122e-01   -3.120429337041519e-03   +2.154786106412152e-01   +2.420576108934183e-01   +9.462063385452771e-02   +5.098308426872171e-01   -8.520925196268987e-02   +2.928714021685180e-01   +4.154137957711524e-01   +3.224168506430615e-01   +6.889324974493185e-01; -5.177765646271711e-02   +7.218971597311250e-01   +3.370762053122349e-01   -4.658117585006583e-02   +1.649584620675242e-01   +4.881145973436870e-01   +1.462978074020315e-01   +2.207856731955713e-01   +2.033147252216701e-01   -3.688477799938726e-01   +4.234338111717396e-01   +2.719373615721576e-01; +9.238363006762083e-02   +9.788250581740963e-03   +2.872789227378137e-01   +7.038776054485039e-02   +4.297196851604552e-01   +9.030605679545148e-02   +1.448230010475862e-01   +1.183237916734847e-02   +3.689289944946596e-01   +3.509095683517635e-01   +2.257940421452621e-01   +1.272148773991743e-01; +1.430197227965337e-01   +7.749668725579146e-01   +2.948397893104875e-01   +1.482637430237004e-01   +3.748697947687853e-01   +3.983157747864927e-01   +1.889410459198726e-01   +1.845880443235963e-01   +6.162614416444423e-01   +2.056329493583527e-01   +3.661639613231132e-01   +2.061113902209647e-01; -9.508453618127105e-02   +2.070950329059465e-01   +8.060062548156257e-01   -5.019357342677574e-02   +2.752775562347395e-01   +6.598478789026800e-02   +4.665143854100129e-02   -1.794545731001596e-01   +6.426676436327814e-01   -2.251846066398819e-01   +1.539909407680667e-01   +7.698766196415543e-01; +3.588048963942256e-02   +6.687590976897673e-01   -6.189292413409542e-02   +2.941809155074218e-01   +2.922199426091325e-01   +2.818700689670911e-01   +1.508957568769428e-01   +3.725316595922458e-01   +6.531960204313469e-01   +5.875275685576938e-01   +1.686183564666449e-01   +6.574099517347999e-01; +1.007199820586564e-01   +3.624657457926338e-01   +4.919946492171973e-01   +5.193446914197036e-01   +9.166910735448491e-01   +1.527793036347242e-01   +8.393332329277614e-01   +2.582417918302829e-01   +1.000000000000000e+00   +3.385612203772437e-01   +2.977568475265342e-01   +3.474710634373979e-01; +4.051011412530017e-01   -2.067563542204771e-01   -8.443461064650709e-03   +5.277340980649109e-01   +5.712953410188217e-01   -1.116472120070473e-01   +7.647052616616633e-02   +5.028049310925581e-01   +3.495758531943874e-01   +7.886821586247593e-01   +2.368821454337262e-01   +1.754570615384541e-01; +3.741147978522173e-01   +8.038065241717654e-02   +5.503659786016312e-01   +5.150070139381231e-01   +8.383146496097246e-02   +1.305499553771874e-01   +4.523824134214894e-01   +5.213653222258862e-01   +2.454540957951102e-01   +1.210793101014938e-01   +8.232239275115950e-03   +5.026264066004513e-01; +9.099617974019940e-02   +5.647634979053369e-01   +2.632507023235789e-01   +4.717961384929355e-01   +6.265682923686884e-01   +2.492740398743844e-01   +4.110240428120849e-01   +5.642935797455622e-01   +1.326813411929865e-01   +3.474702772699299e-01   -1.531846262313778e-01   +5.401538105169712e-01; +1.454027292573817e-01   +3.462466807123402e-02   +3.182496609207788e-01   +6.090025079229497e-01   +7.982889105017258e-01   +1.286510141781433e-01   +2.979633170810013e-02   +4.063415803762586e-01   +5.329887060337644e-01   +3.106011347949376e-01   +1.797196507366610e-01   +4.615484445584419e-01];
L3E_L3I_iGABA_netcon = [+2.180035161835373e-01   +2.621680345010994e-01   +3.889433193172611e-01   +5.586209084601484e-01   +6.989346395025894e-01   +3.720026577512054e-01   +3.163457964292280e-01   +6.329215386606740e-01   +6.487200839740505e-01   +1.576553474235890e-01   -5.174909143658290e-02   +3.074351792366711e-01; +9.211672840777030e-01   +6.473101046474212e-01   +3.941800157606688e-01   +7.656230759968607e-01   +4.096985761572204e-01   +1.052606020093980e-01   +4.777121546134527e-01   +1.828617425871738e-01   +3.140187953294242e-01   +3.894007373137079e-01   +3.308126828790444e-01   +2.694459267417960e-01; +1.199320955828373e-01   +1.000000000000000e+00   +2.371523372405241e-01   +6.932729632878273e-01   +1.579696962605774e-01   +1.642191377918387e-01   -1.259348708454010e-01   +2.660838460237557e-01   +2.241791252691046e-01   +1.541801846440080e-02   +2.297240118264838e-01   -1.408450747870456e-01; +2.139049097721552e-01   +8.069637686200493e-02   +4.726331664425296e-01   +1.382919165979608e-01   +2.520081146459796e-01   +7.688837643457576e-02   +6.090266429531560e-01   +1.461695348333344e-01   +2.706292875959239e-01   +3.876362408015883e-01   +3.231830181865420e-01   -1.947451066280633e-01; +7.394937706251299e-01   +3.368511775793555e-01   +7.566521469784233e-01   +2.932017169458709e-01   +6.369697086640560e-01   +6.410367604711888e-01   +6.156854928896059e-01   +6.781191806848444e-01   +3.267580957826129e-01   +5.795416981483894e-01   +6.000990700615458e-01   +3.762229731096574e-01; +4.353444066691523e-01   +6.443476703208166e-01   +1.900626078485716e-01   +5.922088897598142e-01   +1.723630379296052e-01   +6.751654893480449e-01   +9.112290843073852e-02   +7.392889439741942e-01   +1.535780034328736e-01   +5.787826479622590e-01   +1.745687299821079e-01   +3.224860521355505e-02; +6.237388334746119e-01   +8.042145346575398e-01   +2.083879937020610e-01   +5.844402109346820e-01   +1.567274711874923e-01   +4.446439819634300e-01   +4.036366035716629e-01   +2.507487198879018e-01   +7.576365930142864e-03   +2.526533685135993e-01   +6.098617136370520e-01   +3.178172665993982e-01; +3.177304535227349e-01   +7.184756276745480e-02   +4.318030980627569e-01   +3.608930276870175e-01   +6.128002908304504e-01   +9.167883997479343e-04   +4.053812235584691e-02   +3.086382137960588e-01   +2.977337470280261e-01   +5.074201001187696e-01   -1.961921659993985e-01   +8.718699026062555e-02; +7.293339363067228e-01   +1.125752368007470e-01   +3.880119395695673e-01   +4.637975524909892e-01   +4.353090315240444e-01   +1.894082114799315e-01   -2.401385552367988e-01   +7.470808255444994e-01   -2.507818752205538e-01   -2.268910505195174e-02   +9.075158007389511e-01   -3.254113567127390e-01; +1.729617733654457e-01   +4.881814889967111e-01   -4.251785555724992e-02   +3.903556427716899e-01   -3.963796838129093e-02   +8.083502547675065e-01   -2.277089000119862e-01   +4.507457134401731e-01   +2.335173896667633e-01   +2.624856854239807e-01   -2.790652727045770e-01   -1.254963398398377e-01; +4.714809794335538e-01   +1.625691126184706e-01   +6.696130678334048e-01   +2.038096567040435e-01   +2.574741030379550e-01   +3.480351541276114e-01   +5.965986694577247e-01   +3.145731151792130e-01   +2.255611692666230e-01   +3.579921854286632e-02   +4.180762592998284e-01   +2.944240162033619e-01; -6.972772711556641e-02   +1.052038945976133e-01   +2.891376189319458e-01   -8.947751973118367e-03   +1.353214907202360e-01   +2.780564783150060e-01   +7.279975999622178e-01   +6.619843324120648e-01   -2.497692031602763e-02   +2.569142147030991e-01   +6.997451417482738e-03   +2.268186814615172e-01];
L2E_Input1_iAMPA_netcon = [+8.623895451896959e-01   +7.020645577574366e-01   +5.843661794316105e-01   +1.000000000000000e+00   +7.719223999525553e-01   +9.454374886673879e-01   +8.832570628064312e-01   +6.473357020654631e-01];
L2I_Input2_iAMPA_netcon = [+7.872249422992051e-01   +8.800287650265983e-01   +4.571157015334330e-01   +7.589037699734961e-01   +6.496714650215076e-01   +7.768506795973160e-01   +9.594790474306636e-01   +6.614147065492141e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last =  11.21 * ones(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))*0.4 + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.5*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.5*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))*0.9 + 0.5*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))*0.4 + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.5*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.5*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))*0.9 + 0.5*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
