function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+7.196594749360645e-02   -1.602578636758412e-01   +6.997472640509820e-01   +2.740477813741145e-01   +8.516724828790530e-01   -1.635606650280589e-01   +5.486117013117385e-01   -1.840657218622785e-01   +2.782965359648888e-01   -7.396035617422667e-03   +3.429728500084132e-01   -1.551347047041813e-02   +2.790313516565989e-01   -3.570891298834826e-01   +7.633867061550040e-02   -1.307149470815532e-01; -8.409941287709095e-02   +1.745041444849434e-01   +5.931564534263226e-01   +5.948550160854079e-01   +7.830723539422398e-01   +4.536225233302348e-01   -3.366103277544745e-01   -2.334358376711169e-01   +9.075357718184747e-02   +1.274355158911574e-01   +5.703404198965935e-01   -1.214846666461239e-03   +6.914070394686066e-02   +5.199352344847594e-01   +2.551910341464900e-01   +7.839456432070352e-01; +9.267260464562199e-01   +5.653089822242376e-01   +1.102525621303148e-01   -4.688092588333334e-01   +7.071827498842711e-01   -4.116922960921867e-02   +1.013725859011965e-01   +2.290659635192209e-01   +3.214677535867929e-01   +3.229050794796171e-01   +1.520357534992852e-01   -1.274971877153335e-01   +7.487273146554199e-01   -1.205327634937299e-01   -2.270365747017743e-01   +6.716403465819351e-01; +4.579855399532825e-01   -8.731243540178733e-02   +5.936550021401121e-01   +7.029267916341970e-01   -1.192149600009366e-01   +5.142898837253407e-01   +9.428670897566644e-01   +8.260565090160793e-03   +8.280920901854746e-01   -2.602513067224998e-01   +5.345221971890551e-01   -1.795675069354920e-01   -1.405753443530501e-01   +6.570085494999274e-02   +1.029491044429961e-01   +7.968547401906199e-01; +1.080055789556508e-01   -1.891216142919664e-01   +2.163050284478103e-01   +8.391338097480905e-02   -3.679884159871230e-01   +5.074408836646211e-01   +3.446433755765792e-01   +2.325040766002055e-01   +2.272526456183948e-01   +6.926731139500786e-01   +5.302326136583988e-01   +1.184712217289055e-01   +4.147575180462423e-02   +3.424870014492736e-01   +7.415125149805587e-01   -1.306976505229679e-01; -4.284510533225157e-02   -2.435064579800334e-01   +3.856499950209315e-01   +3.854347678950296e-01   +7.035517860296231e-01   +7.983996256577177e-01   +2.251260782292009e-01   +4.788217069724664e-01   +7.458437907108666e-01   +7.459117383899300e-01   +2.954158573545431e-01   -8.838776630507005e-02   -7.775338390521665e-03   +5.059609217789695e-01   -1.005347515640770e-01   +5.340718492713455e-01; +5.423869270705091e-01   +1.308983856470241e-01   +8.626804804379630e-01   -1.390294748576194e-01   +7.863164501866818e-01   +7.481529089811304e-01   +3.883343020726915e-01   +2.531666921290958e-01   +3.322498676169423e-01   +9.188191358463274e-01   +7.980663724137269e-01   +7.920863698570292e-01   -1.107056700497019e-01   -4.570437948661829e-02   +2.301026781806977e-01   +1.505035104900601e-01; +6.510647703122994e-01   -2.835824499638806e-01   -3.487249480587180e-02   +2.462793079633349e-01   +5.059401617947510e-01   -3.446259559519349e-02   +4.229954180985274e-01   +8.546394302099728e-01   +2.533275081576956e-01   +5.015427725274204e-01   -4.820986251926527e-01   +4.685433311240770e-01   +1.715178649507258e-01   +3.357115312026446e-01   +7.347412530234807e-01   -4.244951273580239e-01; +1.000000000000000e+00   -3.174759728735204e-01   +6.331289716764554e-02   -2.839352204369528e-02   -4.465723384154757e-02   +6.651280958232657e-01   +2.453361724721472e-01   -1.184885117544456e-01   +5.047421444035013e-01   +2.991736663520231e-01   -1.900817605261785e-01   -1.837327595195818e-01   -3.941807671954494e-01   +1.170442882145911e-01   +1.236156223977557e-01   -4.367340104431461e-01; +6.999165808611733e-02   +3.632906231267129e-02   +2.655495500641912e-01   +4.991950198166884e-01   -9.504139855832620e-02   +6.552879154836904e-01   -1.661627281362423e-01   +3.429216972215403e-01   +3.856098440199724e-01   -1.030293641462143e-01   +2.300904801808556e-01   -1.548644720300193e-01   -1.508525694308845e-01   +2.676078332128172e-01   +1.669489964029118e-01   +4.241688509895654e-01; +1.539716966237706e-02   +1.335259588383640e-01   +5.521383816378599e-01   +5.374746019514270e-01   +3.166442737328918e-01   +4.977768099254943e-01   -3.106808691334081e-01   +3.425902290007808e-01   -5.839429690241203e-02   +1.159929001092535e-01   +6.756107278343397e-01   +4.374684760075347e-01   +3.958097926907244e-01   +3.013809407179290e-01   -2.187009305999115e-01   -5.650465937273098e-02; +4.089834522761056e-03   +6.265976766072183e-04   +1.727236507720790e-01   +5.613307422840610e-01   -6.775876616124973e-02   +4.283948717354995e-01   +7.510261083592583e-01   +8.750669703815012e-02   +5.521077209821795e-01   +9.097878874973844e-01   -3.247035088147167e-01   +1.624367497820094e-01   +6.772613044849681e-01   -1.464019823468591e-01   +2.361159025240530e-01   -2.712579328452953e-01; +3.729399747230313e-01   -2.862986711053030e-01   -2.934102856294656e-01   +6.739245863431155e-01   +7.350537347921164e-01   -1.236287903632652e-01   +8.802349292186233e-01   +5.791978641403109e-01   +1.239742848027969e-01   +3.110070425140909e-01   +1.036546550418041e-01   +1.969970079873309e-01   +2.965553148267140e-01   +2.364207110350900e-01   +8.485128977477292e-01   -1.345391354333821e-01; +4.570613646156515e-01   +6.465201288036367e-01   -4.349711892670721e-01   +4.696316009999668e-01   -2.769291526354176e-01   +6.818284193062045e-01   +4.004464261144724e-01   -3.010976263264140e-01   +4.763847146284769e-01   +1.744110825599678e-01   +6.206225142676561e-01   +9.954601702905995e-02   +7.616882492128471e-01   +9.001043989720564e-02   -2.358511537018239e-01   -1.462853219995142e-02; -3.676728812733469e-01   +1.809762237423497e-02   +6.427412642928974e-01   +4.519399771829183e-01   +5.208834678053063e-01   +2.511145659403132e-01   -9.725988447231182e-02   -1.923538172831642e-01   -2.211970189161464e-01   +5.639083841507239e-02   +3.857124910575653e-02   +6.936465203811019e-02   +1.354149561927336e-01   +5.387023674737170e-01   +6.470650771150863e-02   +2.464309016651011e-01; -3.060126881853839e-01   +9.027123157198795e-02   -8.796028224656081e-02   +6.368310273585341e-02   +7.616462875152039e-01   +1.826281866886159e-02   +8.385682747813147e-01   +1.831338539768593e-01   +5.816456751569298e-01   +5.638064347571388e-01   +3.125672124979290e-01   -1.853602068960788e-01   +8.977988528196343e-02   +4.999719818354866e-01   +2.818210717745183e-01   -2.597708574820357e-01];
L1E_L1I_iGABA_netcon = [+4.096719694265900e-01   +5.300274817651964e-01   -3.231216776642377e-01   +8.112319560365602e-01   -2.419387257490785e-02   -1.203226163623358e-01   +4.136223601824401e-01   -4.075175015432911e-02   +7.885986155981166e-01   -1.942776375503717e-01   -2.437343717244047e-01   +4.376810169210664e-01   +1.573425067373742e-01   -1.371313336303522e-01   +1.782658425884486e-01   +3.571430078244101e-01; +1.335275164915619e-01   +5.579188841631295e-01   -8.311811959060580e-02   +1.828561783299749e-01   +6.067618674149390e-01   -1.628406374663574e-03   +6.147027163975127e-01   +4.368162097858760e-01   -5.297007858551162e-01   +1.884560052189024e-01   +9.291029582602128e-01   +1.782576983957534e-01   +3.669654873442486e-02   +2.107735033304217e-01   +3.451146675756750e-01   +8.490730421905584e-03; +7.334388767242627e-01   -1.477296400774420e-01   -7.497849678162391e-02   +5.568084436322535e-01   -1.154022288773420e-01   +2.180391204394365e-01   +2.492736675161958e-01   +5.448709450931535e-02   -1.873437146877101e-01   +3.098828082481537e-01   +3.340281928044383e-01   -2.086770456622890e-01   +1.632978446160875e-01   -9.377107794794970e-02   +9.610887618806356e-02   +2.254667823065281e-01; -1.747754432690944e-01   -5.109105732934849e-03   -1.543166741329662e-02   +2.703222080471374e-01   -1.255591060063446e-01   -3.074700691401734e-01   +3.929140846866280e-01   +3.764262750298434e-01   +5.309989008764902e-01   +7.319147748778431e-01   +5.292237953207156e-01   -2.334415726150816e-01   +4.039048099546246e-01   +7.752950250186534e-01   +3.065435865144865e-01   +1.965475981850771e-01; -2.946276060703109e-01   -4.610726149818012e-01   +2.061713414172999e-01   +3.072577942737322e-01   +4.689006876358432e-01   +7.970348174065604e-02   +9.210692169524091e-02   +2.761966582595534e-01   +2.619192871413272e-01   +5.742783512127307e-01   +1.322219921559187e-01   -3.048643839046798e-01   -4.543195253225545e-02   +5.586685727267151e-01   +6.740305259121476e-01   +6.772292908437324e-01; +7.784912152075748e-03   +4.579434201105161e-01   +1.185605039020309e-01   +7.923004357037018e-01   +8.845646903444684e-01   +1.065963401561422e-01   +5.907313365560344e-02   +2.142790926288801e-01   +2.279609725248689e-01   -4.432132063065053e-01   -2.376333576153052e-01   +5.863159769368137e-01   +4.695705392963795e-01   +4.874871023818010e-01   -3.901041156431880e-01   +6.453584224213263e-01; -4.472769165150197e-01   +6.226928076048032e-01   +8.800282649524299e-01   +3.932660134662478e-01   -3.895786289318058e-01   +6.060837097988595e-01   +3.354103966364750e-01   +1.000000000000000e+00   -3.031538110063314e-01   -4.469001261466248e-01   +5.380554357784574e-01   +7.794341879610283e-01   +7.178174824992952e-01   +2.943113021932848e-01   +1.206557641359293e-01   +1.673804319895421e-01; +8.417896356588360e-01   +1.595975380107726e-01   +3.031106525925050e-01   -9.876474922807371e-02   +5.694422141581938e-01   +1.574959109051378e-01   +6.819507364543330e-01   +7.464160324870749e-01   +5.092974278416043e-01   -2.238250041780017e-02   +5.385088114649519e-01   +1.304348365154110e-01   +1.043365569161696e-01   +3.206299518688555e-03   +1.063134187340162e-01   +8.058031441863363e-01; +4.982214282810927e-01   +1.396249925281521e-01   -9.183460246044035e-03   +7.957740074313422e-01   +5.920925216516930e-01   +8.806948608301890e-02   -2.093568015950071e-01   +1.151613577293036e-01   -1.206012790482908e-02   +6.290949717314176e-01   +8.972017711988183e-01   +1.570240705589055e-02   +3.727705698201330e-01   +1.607356779146648e-02   +1.626717889019417e-01   -4.025131099606174e-01; -5.666830005800497e-01   +2.630742830047278e-01   +8.472180091199030e-02   +3.657906126965612e-01   +3.328888669181947e-01   -5.890854936730756e-02   +5.250131685552254e-01   +6.061421285682175e-01   +2.796090425094812e-01   +1.698523665666216e-01   +3.628174504233094e-01   +6.022265712522259e-01   -1.255454189747141e-02   +6.295810954847553e-02   -1.039874964717464e-01   -3.046103030032140e-01; -1.566077511178373e-01   -2.763387161073529e-02   -1.013939893494918e-01   +7.811815350577564e-01   +8.247863342199104e-01   +7.135122789032747e-01   +3.099644141914117e-01   +5.283102838976320e-01   -1.643300203061560e-01   +7.119726826137408e-01   +5.143325249174794e-01   +3.081926230697631e-01   +5.912454547779548e-01   +7.483722011574511e-01   +4.664429717275418e-01   -3.970708655022505e-01; +5.742995673078395e-01   +5.364852405802195e-01   +5.913299378857209e-01   +9.514825431916304e-01   +9.016106756442565e-01   +1.678375797177413e-01   +1.592946921689394e-01   -1.535656774889943e-01   +4.781788176434656e-01   +3.969142353811910e-01   +4.355740404511748e-02   -2.697131472313321e-01   +7.683497644400709e-02   -3.568506945236140e-01   -2.900709783922101e-01   +3.805124008599007e-01; +3.141828174140450e-01   +8.485755019681911e-02   -5.555365178277074e-02   +2.534656176637211e-01   +7.840904043168538e-01   -2.935155617169102e-01   -2.942751462144972e-01   +3.405483853880856e-01   +8.004176059602379e-01   +6.932616103467063e-01   +8.402113232440787e-01   +8.065039466704225e-01   +8.150548517405470e-02   +2.890932635862663e-01   -3.169327072525607e-01   +1.505491003174046e-01; +4.423241584346871e-01   -6.903247183204375e-03   +4.473702843875242e-01   -1.201126071619777e-02   -2.812152508437423e-01   -1.050823505913244e-02   +1.175188228877387e-01   +9.259300370200978e-01   +8.595578194424720e-01   +2.929730228677790e-01   +5.905468238506222e-01   +8.948492288625516e-02   -4.069910333237269e-02   +3.950603641870089e-01   +5.271549049274874e-01   -2.497039013696024e-01; +8.230960698206048e-01   +3.909371040135231e-01   -1.151957057432469e-01   -1.455654766957530e-01   +9.244995825671676e-01   +7.332085793728413e-01   +4.871563973533626e-02   +1.784896426352003e-01   +4.274036842163356e-01   +3.507834682290701e-01   +6.798636723928692e-01   +6.955396227026981e-01   -1.958093959779257e-01   +5.108626561036054e-01   -4.220765999533050e-01   +4.051840314415353e-01; -1.653338784187407e-01   +7.932194831845421e-01   +6.195434315735119e-01   -4.214048118509418e-01   +1.755616118438570e-01   +3.630365096933628e-01   +3.818686133160414e-01   -1.678710204288717e-01   -1.740638487781477e-01   +2.108178582980599e-01   +3.833394265653434e-01   +1.451119626427505e-01   -1.408086603837696e-01   +3.308515484637576e-02   +6.798769858461067e-01   +8.148687218347126e-01];
L2I_L1I_iGABA_netcon = [-4.467833278814535e-01   +8.329695465685104e-02   +8.117910137936317e-02   -9.845450542090563e-02   +4.914582306138728e-01   -5.333578633895792e-02   +8.719644543967471e-01   +6.001376287394657e-01; +2.857407436591735e-01   +8.912155546063236e-02   +6.814544676589283e-01   +7.497144610861505e-01   -1.312848908093700e-01   +1.325086509690940e-01   -3.897977211433756e-01   +7.377867949984850e-02; -1.179803216048853e-01   +5.351488062112241e-01   +4.892671587789451e-01   +2.625445318123651e-01   -4.002541639469510e-01   +3.812190923070500e-02   +9.072997086078967e-01   +1.277464644985050e-01; -2.617388231894447e-01   +1.639796799284763e-01   -1.449445473518685e-01   -1.516507638765358e-01   -5.463079726489405e-02   +5.488835319740977e-02   +2.816087639605244e-02   -3.037174843407378e-02; +9.020746042762448e-01   +1.034412240622218e-01   +7.079335563310886e-01   -4.035184010521158e-01   -2.871924616017057e-02   -1.884092116070946e-01   +1.186666886960087e-01   +4.307639201442245e-02; +1.102170280981726e-01   +7.598805362836247e-01   +2.879295840221574e-01   -9.025262682072933e-02   -7.638368342578009e-02   +4.787257963866757e-01   +5.082925882411909e-01   +3.889707114802273e-01; +5.847317258509150e-01   +9.332726365471685e-01   +3.884729944042091e-01   +1.288049630858482e-01   -4.221388986608259e-01   +1.027906464341759e-01   -1.277196779535684e-01   +7.879412424760082e-01; +2.429544879055571e-01   -1.353868294296164e-01   +3.001616082344791e-01   +4.955597973099652e-01   +4.226745148693664e-01   +3.660381424909805e-01   -3.990265261782208e-01   +9.711136825242925e-01; +6.839551536981602e-01   -3.113590589393301e-01   -5.471129033536879e-02   -1.363766972686522e-01   +1.027894392449319e-01   -3.707766919379459e-02   -1.103254493919768e-01   -2.816900451667121e-01; -2.804870575637587e-01   +6.407524136817206e-01   +2.860766463787367e-01   +2.929004286525332e-01   -3.512069833592220e-01   +3.820138688220376e-01   -5.725387728708453e-02   +5.787901905954530e-01; +1.861530945550010e-01   +5.873878747614337e-01   +4.529574518562646e-01   +7.599453833106727e-02   +1.770505373331098e-02   +1.289101998938255e-01   -2.677919679546086e-01   +5.005025594511789e-01; -2.117689389432100e-01   -1.802936249674443e-01   +8.117234751605330e-01   +1.968615238570704e-01   -4.659709624238949e-01   +1.710530867708582e-02   +3.795830490743289e-01   -4.688069240200507e-01; +1.503105528102143e-01   +5.757255528371422e-01   +3.639679605563101e-01   +5.276572636297717e-01   +4.548701511668407e-01   +3.115941054504540e-01   +5.572644796842985e-01   +5.239305182140921e-01; +3.021417907769238e-01   -1.776418573194904e-01   +6.489002953636545e-01   -3.807515067693069e-01   -1.029914681907309e-01   +1.279475923892756e-01   +1.447171218153254e-01   +2.742043389060138e-01; +1.789216253015831e-01   +3.193617493164907e-01   +8.083639111340348e-01   +1.000000000000000e+00   +1.078404745718922e-01   -1.613834894660260e-01   +5.977279096609756e-01   +5.776411074456238e-01; +6.507540775766768e-01   -1.223588457086230e-01   +2.958384061286840e-01   +5.038464889090392e-02   +2.052298755124421e-01   +4.435391492055720e-01   -3.028774794710081e-01   -3.569582965170073e-02];
L1I_L2I_iGABA_netcon = [+7.650771857904567e-01   +7.849080140859259e-01   +2.285888569912462e-02   +6.149893290654267e-01   -4.830102059027065e-01   +1.000000000000000e+00   -5.979989341099837e-02   -3.735570198380859e-01   +1.390632592659565e-01   +6.888099015932226e-01   -1.149437184515165e-02   -2.450389632740307e-01   +6.102172717738515e-01   +9.744185936941416e-02   +6.864891408903133e-01   +5.857317482875431e-02; -3.345948965603710e-01   +7.563680845887832e-01   +5.459461599844907e-02   +2.117386719487830e-02   +4.024774684799908e-02   +6.966950911873716e-02   +2.533477210530339e-01   +3.962885388102077e-01   -1.526855259406830e-01   +9.020953751960407e-01   -2.623541185202855e-01   +1.407292907329947e-01   +6.063906572659298e-01   +5.602142854786476e-02   +1.785314662923054e-01   +6.479832556201346e-01; +6.785852208768125e-01   +4.975564130330520e-01   -1.113207101102088e-01   +6.480985278993415e-01   +4.576123307243586e-01   +6.135672346085819e-01   +2.828848352694510e-01   -1.132501974325767e-01   +3.047348287414850e-01   -2.502197344085819e-02   -3.487765269870733e-01   +4.079720776922079e-01   +4.568837905428159e-01   +8.219699594787411e-01   +1.719165661718242e-01   +1.813374958059757e-01; +6.457227848799739e-02   +6.056687082257356e-02   +8.769154608423327e-03   +6.474760119111796e-01   +7.644652496385288e-01   +2.964954432074093e-01   +5.122295243749204e-01   +4.444950946097184e-02   +8.573507597020453e-01   -4.658501290602273e-01   +8.215195944927516e-02   -1.427368652024356e-01   -9.301251203682884e-02   -1.562116211903725e-01   +4.284572613597232e-01   -2.249372352272411e-01; +1.406571935706249e-01   +9.600653462758001e-01   +2.318569927318687e-01   -1.852647447117113e-01   -2.834046515452113e-01   +6.949606654659980e-02   +3.507987834308807e-01   +6.808509535433236e-01   +6.876138093526796e-01   +1.381967663630093e-01   +9.149193338804131e-01   +4.069340856565286e-01   -1.456253366343392e-01   +6.182293150300178e-01   -1.513940386995775e-02   +1.709958242591509e-01; +4.619059594153425e-01   -7.086859157362231e-02   -4.347633123335156e-01   +6.030254555167290e-01   -3.829911872172338e-02   +7.060263642848998e-01   +1.136896540563723e-01   +9.814300924063766e-01   +4.306111989659362e-01   +7.778826581302438e-01   +2.614038435646110e-01   -2.660014584362602e-01   -4.491821929273138e-01   -2.698741827649583e-01   +5.948701704769425e-01   +1.526249535632067e-01; -1.639776359456539e-01   +1.002836541371840e-02   +2.219964360211184e-01   +1.571004324781079e-01   -3.154875320637847e-01   +6.741061601598530e-01   -3.201373596425153e-01   +7.759216294494162e-02   +4.564334305896947e-01   -2.042522368778819e-01   +4.471187688991272e-01   -8.223295467449930e-02   -2.493999089713942e-01   +3.741481586780688e-01   -4.066643137980514e-01   -1.377808772453774e-01; +1.557943120337246e-01   +1.992256170071139e-01   +1.780431687209775e-01   -1.156118504456430e-01   +5.288037514871677e-01   -1.142722738732870e-01   +4.107338406853438e-01   +1.987134482390054e-01   -1.182868762294253e-01   +2.701828233333658e-01   -1.842026133532433e-01   +6.034009553725849e-01   +1.778875700314067e-01   +5.786244125072668e-01   +5.469506634482100e-01   +1.747303471031616e-01];
L2E_L1E_iAMPA_netcon = [+3.958346448063500e-01   +5.638469245792019e-02   +9.904422166315702e-01   -8.665634224697705e-02   -5.547488727011625e-02   -2.671841844331572e-01   +3.685678187862537e-02   -1.559288734048440e-01; +2.425792655724416e-01   -2.566712043101006e-01   +6.615104127597152e-01   +3.173717932944490e-01   +1.948953332782062e-01   +2.577002183406080e-01   +1.181981806819862e-01   +2.209928199448233e-01; +4.394016080024717e-01   +9.524802527579737e-01   +5.815377873180686e-01   -1.253893105716682e-01   +1.439420536621269e-01   +4.775346698555710e-02   +5.100447466730178e-01   +5.948975956115782e-01; -3.442632985407006e-01   +3.334859474867776e-01   +7.773117887874353e-01   -3.851786975004707e-01   +3.151319703079808e-01   +1.582348568461071e-01   +4.348620727321379e-01   +2.843595000993147e-01; +8.159373633394869e-01   +7.426838316830449e-01   +6.508297799179220e-03   +6.014254985456812e-01   +7.521014819212326e-01   -4.263845378208123e-01   +6.649535402304136e-01   +8.374697394956715e-01; +2.494907370583563e-01   +3.277693009004597e-02   -2.717396400740122e-01   +4.946731650877281e-01   +5.627324009217816e-01   +9.812267486088398e-01   +8.790297254535198e-01   +3.777325915370470e-01; -1.028825171351770e-01   -1.223418876873978e-01   -2.949524381573414e-01   -9.103653040333470e-02   +6.726853848144477e-01   -1.367772044783131e-01   +1.821947103188935e-01   +3.639014271861582e-01; +7.970979911794340e-01   -2.581580068665819e-01   +1.972358208412145e-01   +5.759315981831739e-01   +3.835931081756602e-01   -2.251150205068500e-01   +1.745571199679010e-01   +4.811868096316139e-01; -5.553575427389102e-02   -2.781045206337657e-01   +1.063574717837134e-01   +1.330143970005570e-01   +4.679015475247996e-01   +1.162218865543014e-01   +4.182145506784263e-01   +1.283159823395356e-01; +4.257937016483591e-01   +4.503913937950113e-01   +6.355514029060646e-01   -2.386210557527318e-02   +7.749697895295188e-01   -2.249357787111302e-01   +9.102913015699271e-01   -2.770632217878928e-01; +3.972919792271747e-01   +8.577981139795408e-01   +4.005337563984934e-01   +8.558589579073766e-01   -5.419477225779473e-01   +4.874962556228095e-01   +3.738018690949139e-01   +6.419374991982394e-01; +2.840887367352351e-01   +4.617871355357795e-01   -1.605110666024381e-01   +9.618314659627525e-02   +5.559160044097711e-01   +2.944744717713897e-01   +4.771767475534717e-01   +9.058663634914829e-01; +3.003890645572221e-01   -2.501800820124726e-01   +6.286984543704480e-01   +2.829665826609363e-01   -8.256028300674548e-02   +1.270621126254809e-01   +8.515400237338518e-01   -1.017057655169965e-01; -6.944084112536623e-02   +7.050996335086194e-01   +1.071439557181087e-01   +6.208180187309781e-01   +5.751411740452324e-01   +1.744830500421568e-01   +6.718789513883999e-01   -3.958703870197632e-01; +3.690791014972474e-01   +4.012378871286689e-01   +1.000000000000000e+00   -2.416022917023839e-02   +1.287463180103828e-01   -3.502727064903654e-01   -6.033137644246652e-01   +6.887937973862743e-01; -1.271655665384095e-01   +6.026852477853060e-01   -8.911298651061114e-02   +3.023195223829036e-02   -1.857329694793705e-01   +4.478755603479537e-01   +1.117025624077379e-01   +8.146870973123327e-01];
L1E_L2E_iAMPA_netcon = [+9.516236905742590e-01   +9.701049321758901e-01   -2.572536674882386e-01   +2.545241210253026e-01   +8.571331819252449e-01   +3.570459948950739e-01   +5.909754255935498e-01   +7.137925027871446e-01   +8.499901602911297e-01   +4.162071290224902e-01   +9.620121868299722e-01   +3.995055279164618e-01   -1.333489807335718e-01   +3.776746325611581e-02   -1.640693078741779e-01   +5.451089117993976e-02; +2.825764439436484e-01   -2.306984702848816e-01   -2.480250250794013e-01   -4.042905912756629e-01   +9.040181608749972e-01   +5.830913393311546e-01   -1.146261539896737e-01   -5.315467937317932e-02   +1.098450438090859e-02   +9.421756620102367e-02   -4.612889331902262e-01   +5.962678020651691e-01   +7.628364447621644e-01   +3.137338275783626e-01   +2.874755580418505e-01   -2.994679331377016e-01; -1.470946391948528e-01   +1.270563834933778e-01   -2.343801639486676e-01   +7.570293022419410e-01   +1.172849453916393e-01   -4.274044942940949e-01   -6.928517996595598e-02   +4.503983395072458e-01   +2.733876895031120e-01   +5.707025302231485e-01   -3.402523028932221e-01   +6.289009639001176e-01   +3.396275272443773e-01   -2.035828038720937e-01   +6.154843526301612e-03   +1.941195801325732e-01; +1.269325616305926e-01   -4.949874437135777e-01   +4.161218421914750e-02   +2.490889379880485e-01   +5.067553783620727e-01   +2.167079220039384e-01   +1.196788723266300e-01   +7.339867032276037e-01   -3.643693468830163e-01   +5.094866203258844e-01   +2.376910356306366e-01   -6.974367095098249e-02   -5.857014482347770e-01   +6.850375861814262e-01   +1.488701467971709e-01   -3.674648416545873e-01; +1.049162378918842e-04   +4.858799724515618e-01   -3.815119272038252e-01   -1.983068514623615e-01   +5.010259704480464e-01   +1.676025755310120e-01   +3.110232097454674e-02   -3.986481460187610e-01   +5.912110630646203e-01   +3.023954798252098e-01   +8.808674289980026e-02   -5.936366255916708e-02   +4.622957435145095e-01   +5.784145300465767e-01   +8.728887638908759e-01   +1.806240399026850e-01; +8.377554807870576e-01   +4.925416001594198e-01   +1.000000000000000e+00   -4.381387421840425e-01   +1.593387044829717e-01   +1.722729227686538e-01   +2.301611952560258e-02   +5.245072579511851e-01   +5.081142057069140e-01   -3.953948446342964e-01   -2.294235423941315e-01   +2.286933023944573e-01   +9.435720925597192e-01   +6.536208008819606e-01   -5.045398152802113e-01   -6.154858179689288e-02; +6.776352310678203e-01   +4.037291664648136e-01   +6.409277466926874e-01   +3.573281106117415e-01   +2.055118367938767e-02   +2.493060101302166e-01   -9.624078020668220e-02   +9.106437250349541e-01   +2.219348657986109e-01   -1.643442471535673e-01   +5.454803251711306e-02   -3.486487967180743e-03   -4.561029022293975e-01   +6.005470692672058e-01   +1.654202014943875e-01   +3.453470931664594e-01; +1.022150045523328e-01   -6.626118336744447e-02   +2.204211172463938e-01   +3.115974947219692e-01   -3.290752653841694e-01   -1.317480107054826e-01   +2.042345993443734e-01   +3.619925971734661e-01   -1.015901254258254e-01   +2.522919691596546e-01   +7.315683827130791e-01   -6.843730347791514e-02   +7.592808403708158e-02   +3.345127799330543e-01   +1.891708927735914e-01   +3.452664245761145e-01];
L2I_L2E_iAMPA_netcon = [+3.727545628786210e-01   +1.461906325420645e-01   +1.000000000000000e+00   -2.378858697100743e-01   -1.482708777447005e-01   +3.268103729898077e-01   +6.590938530459682e-01   +7.822522823601665e-01; +7.095151230814770e-01   +7.120888470687077e-01   +3.830730879639270e-01   -2.489226002132461e-01   +1.983876149541914e-01   -4.986973621088310e-01   +2.608322472788494e-01   +3.677877386769797e-01; -1.519515270145935e-02   +5.794543570593021e-01   -5.855163011859041e-02   +1.187541078981905e-01   -6.015025364788563e-02   -1.007276773621737e-01   +1.050588218634883e-01   +3.664544539718382e-01; +3.313648996211402e-01   +2.018375412978034e-01   +5.669798040165649e-01   +2.428637488334600e-01   +5.643067731960578e-01   -2.646580643002007e-01   -2.817103289282945e-01   +6.638960535308940e-01; -1.780971432671627e-01   +2.973814577509679e-01   +5.148063302969464e-01   -3.867214292277307e-02   -4.933592666019029e-02   +1.390402275206973e-01   +3.842395269684832e-01   +8.047592980147531e-01; -2.318582039679391e-01   +4.126690345703574e-02   +6.547680851878436e-01   +1.072754784191925e-01   -1.545314879071774e-01   +5.334435752897458e-01   +4.117367965322484e-01   -3.173976245236648e-01; +1.483687246973736e-01   +4.543386401735430e-01   +5.022056615016407e-01   -2.510884501958819e-01   -1.521568376175522e-02   -1.247465884062945e-01   -1.026567676250484e-02   -8.808071027961921e-02; +6.368437858197664e-01   +2.034219623232038e-01   +4.064006198280571e-02   -1.217934930705798e-01   -2.761263597298808e-01   -1.818289869741755e-01   -3.270465515838193e-01   +2.785993297604630e-01];
L2E_L2I_iGABA_netcon = [+2.200163172553863e-01   -2.761522823115922e-01   -5.374847621418519e-02   +5.050942156438821e-01   -4.312309067807558e-01   -4.234074606033233e-01   +3.311649067937306e-01   -2.395516473304427e-01; +6.471310088322999e-01   +4.365872890563862e-01   -1.625024429923707e-01   +5.014028270351243e-01   +9.729420362550755e-01   +3.758221025207540e-01   -2.886216554100439e-01   +5.314600896272290e-01; +1.526341881667161e-01   +6.665396393205267e-01   +3.072422424458324e-01   +9.744271855438605e-02   +4.119622751922388e-01   -1.163508294146721e-01   -1.424819574705048e-01   -3.061888276868797e-01; -4.043317483786705e-01   -2.117576442471588e-02   +5.529419999864155e-01   +4.214386619344497e-01   +2.685043990622315e-01   +4.590909325998010e-01   +1.455547795113789e-01   +3.050803837444243e-01; +1.456088099403582e-01   -2.117269585557590e-01   +2.465054017701886e-01   +4.431821769232179e-01   +6.289438797316691e-01   -8.664597902357372e-02   +1.000000000000000e+00   +4.554885290061693e-01; +2.815052138546117e-01   +5.774092590761031e-02   +2.774937904696649e-01   +1.017928479522454e-02   +9.242961875318385e-01   -2.144352386904951e-01   +1.500956967000628e-02   +8.284437184160850e-01; +3.994993229329657e-01   +6.882392019989280e-01   +4.250100382400965e-02   +6.813014206731897e-01   +1.611847858826418e-01   +5.677653107314405e-01   +1.080494650150039e-01   +2.852237376842251e-02; +1.225519435035171e-02   +3.861100305581418e-01   +1.372455659566076e-01   +6.793914945196333e-03   +8.385923898579287e-01   +2.205105256268573e-01   +2.433464455349372e-01   +3.290701761977854e-01];
L3E_L2E_iAMPA_netcon = [+8.144227606509581e-01   +4.608406379158321e-01   +9.711206290506667e-01   -1.858467315952246e-02   +5.118732717281064e-01   +5.973540086671314e-01   +1.825781582648738e-01   +4.174294164180232e-01   +3.169275346468123e-01   -1.674391927089881e-01   +3.730819275040342e-01   -1.861688109340352e-01; +3.639366676667766e-01   +7.697294555023999e-02   +6.208610192952986e-01   +8.499633973901752e-01   +3.084769002383276e-01   +4.940560755231576e-01   +5.575330230810320e-01   -6.642532754262688e-02   -1.436314505432442e-01   +9.956372198186513e-01   +3.830810551831515e-01   -2.935515068681744e-01; +2.902314769555962e-01   +4.093991038862358e-01   +5.180651048664082e-01   +5.571690562545712e-01   -2.455197545189489e-01   -2.293458174488076e-01   +7.132851336229220e-01   +2.753501293860471e-01   -2.394864199530314e-01   +3.577870688917514e-01   +8.045209970477113e-01   -2.049154180262251e-01; +3.002274650007203e-01   +4.747334663973889e-02   +8.212953848705343e-01   +6.379799593578007e-01   +4.883101469302924e-01   +7.150803964953893e-01   +5.043723956910401e-01   -1.136289656496729e-01   +6.010083837059876e-01   +4.088687358926392e-02   +2.783299919185772e-01   +2.903975936495519e-01; +2.604049768165760e-01   +1.043238299030963e-01   -1.323389835891939e-01   +3.958582594715274e-01   +4.076772295466512e-02   +5.862918031155496e-01   +3.581866627345151e-01   +2.078524434690601e-01   -3.574150485510766e-01   -3.608092416001646e-01   +1.928830664357274e-01   +3.343307830309802e-01; +7.429984888845871e-01   +8.851759574901488e-01   +5.747322513554740e-01   +5.428268177868946e-01   +9.254232025603962e-01   +7.776389640408964e-01   +3.922995756310140e-01   +2.560943056281899e-01   +5.629100506639336e-01   +4.227125933219227e-01   +1.000000000000000e+00   +7.291428374710197e-01; -1.277933567809462e-01   -2.266222763045721e-01   +1.233015028394694e-01   +1.765042873864116e-01   +7.666184048675723e-01   +8.108446804051289e-01   +5.928555409628506e-01   +1.595740833400811e-01   -4.257936261551425e-01   +8.567326376734643e-01   +5.104478242291872e-01   +5.685362366739135e-01; +6.397130433965511e-01   -4.235444602580135e-02   +6.382006273105166e-01   -1.821512989786445e-01   +1.779292095426634e-01   +9.156723302729540e-01   -4.754524181596280e-01   -3.298285819507875e-01   +3.788716457692752e-01   +1.387409735884482e-01   +6.534077553997271e-01   -1.939896607464656e-01];
L3I_L2I_iGABA_netcon = [-4.389849578276801e-02   +3.630989618041002e-01   -2.424937949139979e-01   +8.770653913678969e-02   -3.679333743738612e-01   +7.486075416366159e-01   -1.128533609267088e-01   +8.910620099902511e-01   +5.594196179904580e-01   +2.497689758760983e-01   -4.937037272719137e-02   +6.822735693973571e-01; -2.043307073105989e-01   +3.223137189254954e-02   +1.000000000000000e+00   +2.355242041840260e-01   +5.210582120072061e-01   +6.701784997247220e-01   +4.183812816858665e-01   -3.224862074597811e-01   +4.000597799566550e-01   +8.158028308598304e-02   +2.175496071842893e-01   -2.501213566409614e-01; -4.011387733470080e-03   +1.460748815143289e-01   +4.433345314277423e-01   +6.539656998082314e-01   -2.643158442998176e-01   +5.604531952769096e-02   -8.214618118006062e-02   +1.039514615659719e-01   +3.942376525751521e-01   +3.064077394194526e-01   +9.764690010320005e-01   +6.661551283145953e-02; -4.040961835448018e-01   +9.204052294376377e-01   -7.935822666600695e-02   +6.984127676285071e-01   -5.189890132805658e-01   +4.332385815346408e-01   +4.672393094951623e-01   +1.381103181478919e-01   +3.584264349252239e-01   -5.459518555346258e-02   +6.648435626249835e-01   -1.920000283610225e-01; +1.607094482252204e-02   +8.600785940388187e-01   +7.343998625315191e-01   -3.393070636764065e-02   -4.081445345931105e-03   +4.348275507651441e-01   +3.296172539079888e-01   +5.968868201431190e-01   +8.116987285349384e-01   +7.211538669444609e-01   +9.080328829156561e-01   -2.596047636414713e-01; +3.184395958195244e-01   -1.640089577553752e-01   +2.744127515960211e-02   +7.079137138889709e-02   +5.216818585536191e-01   +6.592650785453248e-01   +3.987870973445008e-01   -4.620087584793247e-01   +5.261724830010992e-01   +4.526242967008536e-01   -9.290097139818158e-02   +7.226974233804814e-01; +3.868115200875741e-01   -4.375984524024664e-02   +1.703036557386972e-01   +3.381720666274332e-01   -3.119325294129016e-01   -1.161201199101833e-01   +5.142728665162564e-01   +4.313002862757899e-01   +6.412440871971212e-02   +5.241945582369985e-01   -1.459883491262880e-01   +5.520098562787250e-01; +5.340051320170627e-01   +3.354091713607028e-01   +3.402134003681664e-01   -9.895980261827590e-02   +7.911508709179786e-01   +5.311507282488668e-01   +5.172827989135499e-01   +2.760132589868713e-01   +4.802400048797915e-01   -1.542174193909813e-01   +7.256182008091857e-01   -1.246742623506771e-01];
L2E_L3E_iAMPA_netcon = [+3.025821301910768e-01   +8.758438052418295e-01   +4.845406541622569e-01   +1.000000000000000e+00   +3.497692754991276e-01   -5.264350519092929e-02   -1.551136581333128e-01   +2.528694450177963e-01; +5.352989477543558e-01   +5.780575629795964e-01   +2.204079933127753e-01   -2.076471986290699e-01   +1.185453061514455e-01   +2.876233899873240e-01   -2.355662098618971e-01   +3.910328085819798e-01; +1.653585407506534e-01   +9.431153981486169e-02   -1.507839579218150e-02   +9.414437352393192e-01   +4.332973074081805e-01   -2.311400891099101e-01   +5.520041560953330e-01   +3.490755391162529e-01; -4.477717854679491e-03   -2.308695778806311e-01   +7.145721043010979e-02   -3.167056751471703e-01   +7.351164699836672e-02   -1.831999566706727e-01   +5.538198703714388e-01   +1.813029553087028e-01; +7.044678196832543e-01   +2.746753623063509e-02   -1.981534546689480e-02   +4.490900668054847e-01   +7.398464068658763e-01   +9.621299577714333e-02   +5.696472171215115e-01   +5.469283374343322e-01; +1.504320947949715e-01   -3.742367547204122e-02   +5.225874439244663e-01   +6.590700696956958e-01   -1.035545531497599e-01   +5.912005214827598e-01   +6.420258070385008e-01   -1.857944311828028e-01; -3.175358774711755e-01   -7.404184270181106e-02   -2.773801079340856e-01   +1.792095821264458e-01   +4.976301605809800e-01   +2.057834408494475e-01   -2.011066132237851e-01   +3.265432324815385e-03; -8.745739563095711e-02   +1.271817193167769e-01   +7.404287378752066e-01   +5.633465109045063e-01   -3.577920825745361e-01   +9.265083634842107e-01   +4.547863444999580e-01   +6.543758948899584e-01; -2.268347639313047e-01   +1.889561968820619e-01   +1.048325417097684e-01   +3.621387975478567e-01   +8.086770371317583e-01   -2.601129863412412e-02   +9.074168278380230e-01   -9.459338052807770e-02; +5.665044729788785e-01   +6.293964760869571e-01   +5.610802906203456e-01   +6.034286369834546e-03   -3.433523610216582e-01   -2.922530358692166e-01   +1.715249350279590e-01   +1.859050190570243e-01; +8.189638773368950e-01   -2.882442137033705e-01   +1.309844059536009e-01   +4.259468810806443e-01   -3.520124475230667e-02   +2.101577295154180e-01   -3.787368614998455e-01   +2.543135021128883e-01; -1.074351872106954e-01   +6.432363130983190e-01   +1.545568535374005e-01   +2.305432026739987e-01   -9.584458184661486e-03   +8.390529343814492e-01   +5.679418504114986e-01   -6.220618007922591e-02];
L2I_L3I_iGABA_netcon = [+6.190849829218569e-01   +8.065277475327994e-01   +3.654341418080728e-01   +4.711353626240061e-01   +1.409119339150581e-01   -2.326933620641845e-01   +3.622405627787013e-01   +6.989997569229641e-01; +2.185115638740266e-01   -3.350533061590099e-01   +1.000000000000000e+00   +6.127854019807516e-01   -4.102595570178058e-02   +7.500105737385666e-02   +4.653153565652978e-01   +1.486178295616226e-02; +1.253343307170723e-01   +9.704853946936486e-01   +6.144821242425730e-01   +5.761324899680400e-01   +3.298640600975603e-01   +5.402199968214361e-01   -1.546712405678677e-01   +1.691218356341897e-01; +1.961445577741087e-01   -6.625092671522435e-02   -4.974390193645667e-02   +3.681393692742874e-01   +4.634242089652028e-01   -2.374154113795453e-01   +9.211842939855258e-01   -3.255423380536865e-01; +4.664983029108153e-01   +6.012635146250013e-01   +2.623925433157230e-01   -3.639695535428740e-01   +7.656733137804699e-01   +4.446447225133410e-01   -3.102631178271627e-01   -3.219629043372660e-02; -2.363487506426437e-01   +9.922597827412892e-01   -2.034817051911779e-02   -1.707899965166604e-01   +7.924470740720537e-01   -1.415234134793444e-01   +5.684653788530509e-01   +5.285287606001562e-01; +2.076164645976591e-01   +7.050319209250691e-01   +3.609877307227491e-01   -1.783100730708206e-01   +7.709974128412499e-01   -1.238904655422151e-01   +1.202251073209047e-03   +4.175253345600776e-01; +2.095873766635308e-01   +5.581400174267148e-01   +5.258265128578019e-01   +3.905505504555319e-01   -1.592131463356594e-01   +5.441031819033689e-01   -4.775945995337755e-01   +3.866852056174518e-01; +9.224078142635398e-01   +1.078308100313022e-01   +1.742327937709405e-01   +3.043845535178050e-01   +2.231845826425892e-02   +8.351705611557931e-01   +4.560319476170471e-01   +4.190106800344912e-01; +9.938587626519485e-01   -1.226973879418714e-01   -7.075268630547522e-02   +6.142679445469285e-01   +6.442035057127421e-01   +8.201133773184263e-01   +6.063828724983346e-01   -6.406582176857381e-02; +7.386466005291732e-01   -2.870741274037861e-01   -2.596173673274781e-02   +7.596501158437747e-01   -1.987711115541570e-01   -4.268371721784880e-01   -2.968968981886376e-01   -5.754477107698279e-01; -1.283901385751797e-01   -8.249609277142686e-02   +5.402788445732063e-01   +3.918878740869933e-01   -1.776973529400056e-01   +5.952527773015676e-01   +1.726352593379331e-01   +5.737977955280111e-01];
L3I_L3E_iAMPA_netcon = [+6.355523549473215e-01   +7.659642612900548e-01   +7.757982869859102e-01   -3.335418886120301e-01   +6.505965571587332e-01   -7.318055280574137e-02   +5.751050767825873e-01   -2.182695516151408e-01   -9.949117632791647e-02   -3.720177682743985e-01   +2.840616796770559e-02   +2.078878399424419e-01; +4.889254759017148e-01   +6.291101814323088e-01   +9.596737162958509e-01   -1.042236561668334e-01   +3.791782821330701e-01   +4.195076017327862e-01   -3.367609950790291e-01   +2.164600413057898e-01   -5.561865254769528e-02   -5.013493532762451e-01   -2.845857101258705e-02   +1.359818057143591e-01; -1.771103801325642e-01   -1.772006994234087e-01   -1.498659931156462e-01   -3.879787904567206e-02   +2.257434442565368e-01   +6.866798001998156e-01   +2.142653631060969e-01   +8.152710470818167e-01   -5.654590022204263e-02   +6.962578888536428e-03   +3.512751273527129e-01   +2.828745411680981e-01; +3.169742834929581e-01   +2.366106288672953e-01   +3.006873144825215e-01   -4.457102097020643e-02   +3.780694676702732e-01   -4.085120774746940e-01   +1.448277113126701e-01   +2.115060069558188e-01   +6.102549640546037e-01   -4.427800620595085e-01   +3.386770834438165e-01   +8.291401620820859e-01; +6.544888544525919e-01   +2.970118198207903e-01   +8.372722905461178e-01   +7.835060309204530e-01   +1.490469032746322e-01   +6.470715788288495e-01   +2.347185006495408e-01   -3.014749829387240e-01   +3.739312353488795e-01   +3.010150780108464e-01   -2.382488578400348e-01   +3.991066442918129e-01; +4.197834562875557e-01   +2.130769880493290e-01   -4.241466819305831e-01   +8.241983092420212e-01   +1.788210865723208e-01   +2.811591391502799e-01   +4.961736583452542e-01   +7.582824490952065e-01   -3.723381121562755e-01   +1.824226690334342e-01   +5.393580053204176e-02   -5.250251012635067e-01; +1.000000000000000e+00   +1.464773029801499e-01   +7.160124773254267e-01   +2.024628571513536e-01   -2.631883684788811e-01   +3.250190900684418e-01   +2.669962384767795e-01   +8.382718724764611e-01   +9.517450912207198e-02   -2.028107003794993e-01   +1.801356290611470e-01   +3.350469000870143e-01; +7.441197810425639e-01   +1.376240265210026e-01   -1.385394441220555e-01   -1.907307955185997e-01   +6.237246398641988e-01   -1.271816280685601e-01   +9.597723692964752e-01   +4.050337095434443e-01   -1.481811584536407e-01   +4.606414572237413e-02   +5.811235966403481e-01   +1.459277658032458e-01; +5.729506698649337e-01   +2.396554388976117e-02   -1.097495471901847e-01   +5.778402271954574e-01   +6.254565863553000e-01   -9.150320693626958e-02   +7.271933541348573e-01   -2.402296024253379e-01   +7.303270660775476e-01   +6.525654093633015e-01   +3.896023459838897e-01   +9.312688710156101e-01; +2.483013610918517e-01   +5.584726187564744e-01   -2.299866450590812e-01   +5.197079234859056e-01   -6.699751551067415e-02   -5.739144224469205e-02   +4.798483047293481e-02   -1.383137267661165e-01   +2.655337606275946e-01   -2.632627827601048e-01   +6.490491347200497e-01   +4.259866292487585e-01; +5.763546418998140e-02   +9.111827586079576e-01   -7.423900463070886e-02   +1.866631999957271e-01   +5.516373996642204e-01   +4.886322764516558e-01   +4.445546075032050e-01   +5.369762699928611e-01   +3.404793392926359e-01   -5.996731987460974e-02   +4.686356060449002e-01   +6.665355711187723e-01; +7.722909161527280e-02   +5.255125981446874e-01   +7.129401019896378e-01   +4.319530912055419e-01   +1.772476975604002e-01   +5.220975499256628e-01   +7.781007288560636e-01   -9.063457500365631e-02   +7.323222828183095e-01   +8.823185339508305e-01   +1.985610094594679e-01   +3.669220872071468e-01];
L3E_L3I_iGABA_netcon = [+2.804112812901045e-01   +5.448636411445256e-01   +3.828338044825919e-02   +6.833951476524441e-01   +8.014217367257539e-01   +6.075712456359049e-01   -6.615441086072629e-03   +9.818628669806437e-01   -7.850814470412044e-02   +5.497692710731988e-01   -3.075321290771685e-01   -2.227480147733789e-01; +8.250862633160203e-01   +7.333230424374242e-01   +3.594595181033894e-01   -4.385845104289767e-01   +2.176482503436487e-01   +6.391591988416566e-01   +9.218579029951542e-03   -1.677685475632655e-01   +5.658173537735489e-01   -3.932376835215270e-01   +5.530877167111641e-01   +2.754154220645725e-01; +1.000000000000000e+00   +8.221344164249548e-01   +2.070164753859217e-01   +1.293625688470515e-01   -1.959450032411353e-01   -4.539007904468810e-01   -2.268708428667471e-01   -5.033395085657558e-02   +5.546356761533111e-01   +6.737412554518202e-01   +2.643852706836617e-01   +7.551832281071256e-01; -3.595923427140756e-01   +7.447958941104867e-01   +9.953975884719175e-02   +1.474736921993357e-01   -1.373023723428927e-02   +7.825709855580557e-01   +6.120367295166156e-01   +3.407422880515001e-02   -2.127470714133884e-01   -1.342982767151208e-01   -1.272224267775216e-01   +1.339662218623554e-01; +7.244417818196539e-01   -8.301100604447090e-02   -2.543531149830610e-01   -1.142793313720399e-01   +7.114627150713485e-01   +3.316404818315209e-01   -8.914283690562769e-02   -1.281777801404716e-01   +3.338466306050105e-01   +4.330886182135651e-01   -2.833775131569684e-01   -1.289809137128687e-01; +7.685955627754307e-01   +2.339893144640446e-01   +5.381910555495196e-01   -4.012409316769259e-01   +3.263401646388244e-01   -8.361246100758504e-02   +3.302176153636007e-01   -5.984795956769449e-02   +5.326015939244111e-01   +2.236522583695887e-01   +9.178553741127307e-02   -3.807971421798257e-01; +3.055107284716501e-01   +5.988062714873373e-01   +6.335645310882529e-02   +4.914779775523203e-01   +1.836397668249058e-02   +8.180778223038010e-01   -2.055196372487789e-02   +2.020198245538448e-01   -4.365383211718838e-02   +1.171275500441338e-01   +5.520720213306760e-01   -1.838798707210405e-01; +2.773684185799973e-01   +9.879170294734345e-02   +4.532898384404203e-01   +5.622185558568654e-01   +3.833043979367099e-01   +7.641447654190328e-01   +4.127465029990209e-01   +4.185860971305984e-01   +6.646626215280107e-01   -1.329923633267116e-01   -3.419995086675246e-01   +4.578452846575011e-01; +5.890677218522588e-01   -1.831315336447508e-02   +6.704187559630366e-02   +7.176570662689326e-01   +4.612264453028078e-01   +5.403590667479844e-01   -2.495915187642418e-01   +9.959575260741750e-01   +1.496056221325749e-01   +1.838505482539490e-01   +4.344220282544127e-01   +3.317686466531928e-01; -2.637640831842438e-01   +9.990851564134132e-02   +4.632298266363549e-01   -4.055454331840434e-01   +7.810604101240836e-01   -1.842749707689905e-01   +5.541939763832091e-01   -1.776936063608369e-01   +8.981721203758875e-01   -2.026121339391306e-01   +4.554302026503317e-01   +3.815006487545399e-01; +7.678440360256874e-01   -5.085997623912321e-01   +3.098384564293725e-01   +1.031137232484386e-01   -1.208429302398773e-01   -1.333077252552692e-01   -1.298696724535293e-01   +7.027709912539198e-01   +5.403198840160979e-01   +6.123116763976376e-01   -2.724278748378738e-01   +2.725067655421894e-01; +5.666704686718789e-02   +7.245655173575778e-02   +7.875347495230655e-01   -1.207596125635742e-01   -2.971186283337183e-01   +5.270938170048270e-01   +1.463318367452492e-01   +7.946338527789953e-01   -8.743052420727473e-02   +7.043010369212510e-01   +3.634431446589788e-01   +3.295904763404039e-01];
L2E_Input1_iAMPA_netcon = [+1.030571287386659e-01   +9.335558020857556e-01   -6.864809699358849e-02   +1.085767717248517e-01   +6.001503701332594e-01   -3.418527869378674e-03   +1.000000000000000e+00   +6.015094989249968e-02];
L2I_Input2_iAMPA_netcon = [-1.053062958565670e-01   +2.001602972228226e-01   +1.000000000000000e+00   +7.818266167753041e-02   +4.384300360682071e-01   -1.343278770591123e-01   +4.836628657432649e-01   +4.453274677128417e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.4*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 1.0*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 1.0*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.4*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 1.0*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 1.0*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
