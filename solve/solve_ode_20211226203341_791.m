function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-2.058341402269493e-01   -1.798361981959797e-01   -3.216342552439782e-01   -1.235853259013865e-01   +1.223891032145601e-01   +6.523542178398062e-02   +3.392187097265709e-01   -4.383116291013666e-01   -1.613912037298735e-01   +5.165055805119991e-01   -2.437226743287878e-01   +4.295367411324181e-01   -3.141835145398705e-02   +6.294452344093329e-01   -1.253142054783282e-01   -1.047758323542281e-01; -1.740267361552492e-01   -4.703283279440597e-01   -8.968725281939186e-02   -9.194008134502024e-02   -8.936281416144554e-03   +1.224134711827023e-01   +3.797792282210414e-01   -8.396254956780579e-02   -1.352164477024312e-01   +1.875350350045308e-01   +1.636108626355794e-02   -2.208729513744554e-01   +2.825103820047548e-02   +9.850417708121491e-02   +1.366700972463256e-01   +4.166875118752568e-01; -8.300792473732230e-02   -2.312605895627388e-01   +1.514489435084228e-01   -1.202992201672520e-01   -1.586675726119446e-02   -6.222434728866882e-02   -1.994063728970179e-01   +6.917022008526905e-02   +2.291516506745567e-02   -7.863911136595125e-03   +4.625151963586410e-02   -2.347537770391595e-02   +5.512402899589530e-02   +6.497684383478053e-02   -3.879388892517645e-01   +6.366563237055253e-02; +1.790694871108893e-01   +1.519699304533802e-01   -2.198789043375568e-01   -4.248939721955798e-01   +8.230466862960945e-02   -2.223012575169480e-01   -1.322003471605387e-01   -1.440893679350791e-01   +4.181457074507499e-01   +2.591194907704732e-01   +2.064151265897859e-01   -1.464898687102413e-01   +3.685784812835556e-01   -4.429485323164484e-02   -4.827351014274911e-01   -3.535908237417099e-01; +3.140665483604826e-02   +2.578804292954160e-01   +3.105483747547205e-01   -1.737911770717330e-01   +3.054706074154520e-02   -1.379043824359615e-01   -9.728707958868793e-02   +1.076730598734316e-02   -1.517419599034083e-01   +5.474524377667402e-02   +4.431956828419346e-02   +8.061773437950501e-02   -2.112748007896582e-01   -2.501005653881228e-01   -4.504624739556850e-01   -1.921438333445774e-01; -2.250067530076904e-01   +2.683411375271053e-01   +2.639277018414785e-01   -3.616545151377183e-01   -1.594988598857668e-01   -1.928267840964998e-01   -2.234619522091698e-01   +4.024384740858028e-01   -4.377012175484363e-03   -2.167110822241685e-01   +1.142440780071324e-01   -2.728416341128035e-01   -1.047058178926386e-01   -2.169917036302579e-01   +6.803470791430855e-02   -4.132925794992637e-02; -1.632114539885250e-01   -3.557910343534751e-01   +4.068751186695852e-01   +4.995899748052774e-02   -1.120882802244630e-01   +1.552156286356444e-01   +3.002917098013398e-01   -1.660901200373262e-01   -2.263190992325891e-01   -2.738315000619471e-01   -1.020464672295945e-02   +8.037515432320803e-02   -2.066419092893415e-01   -5.742454645361372e-02   -1.735251222115370e-01   +1.227280225738844e-01; -4.966582393840280e-01   +2.451771875867121e-01   -1.683734924205214e-01   -4.078249243280398e-02   -1.050629874056516e-01   -2.895730974324254e-01   -7.778558099694338e-02   +2.201548588079204e-01   +4.250909069837290e-01   +2.811025762236052e-02   -1.446266536860341e-01   -1.008080930174748e-01   +3.981458504822844e-01   -3.007054485342708e-01   +3.181519747189289e-01   +1.041774950536866e-01; -3.550534015036693e-01   +8.506226880544976e-03   +1.730264530482071e-01   +1.728232930071308e-01   +2.256664319195495e-01   -3.415705333700297e-01   +1.386182620180011e-01   +2.078034738254703e-02   +2.096753569001115e-01   +8.370323673653160e-02   +2.217775355008915e-01   -1.262871721711140e-01   -2.226402751736280e-01   -6.245788270151008e-02   +2.011399920223602e-01   -1.935310134807819e-01; +1.911545872035789e-01   -2.544466274790006e-01   +3.197527868280350e-02   -9.881129474633610e-02   +2.471937510376657e-02   -8.359187579702229e-02   -4.736400597304136e-02   -1.089844309347193e-01   +1.972977468003628e-01   -1.670866015011529e-01   +2.238667645901797e-01   -7.751970587989288e-02   -2.248908617718499e-01   +1.331962561914269e-01   -7.398082187804497e-02   +1.692444214513200e-01; +3.188909002550498e-02   +9.431026233169058e-02   +2.694587945310221e-01   +3.678725064517149e-02   -9.945478082065083e-02   +2.665033817954366e-01   +1.057936275298019e-01   -2.069197682583487e-01   +2.785326828103677e-01   +6.100456553285415e-04   -3.799249086740527e-01   +1.243120991682593e-01   +2.606392275687066e-01   +1.414455863129852e-01   +1.297900413710268e-01   -1.194690042103527e-01; +2.570698145883734e-02   +1.125349791576039e-01   -1.591168259777754e-01   +4.769804033524230e-02   +1.575554825082652e-01   +4.239950070142376e-02   +2.051055218141909e-01   +2.761442388912578e-01   +3.979296585498552e-01   -1.548478787225964e-01   -3.690526796179965e-01   +1.131546759085569e-01   -4.474514319346248e-02   -3.100117574001449e-02   -2.336211274952532e-01   +1.333476845034402e-01; -2.214057779999752e-01   -1.767322671751236e-01   -8.909802730321539e-02   -1.699512964454014e-01   +1.464603552929226e-01   -1.077628683923080e-01   +9.484345975459502e-02   -2.868036056171039e-01   +2.522853979632648e-01   +4.065678315406699e-01   -1.016034722641161e-01   -2.832212798498323e-01   +5.003293108575843e-02   -2.735501803524049e-02   -1.762752478020769e-01   -1.748285826052584e-01; +2.822873126542397e-01   -1.648525535337241e-02   +2.349534965650055e-02   +1.568259117037863e-01   +2.751798334092351e-01   +4.290063437707300e-01   +3.653259958636373e-01   +1.416804157954919e-01   -3.760181127051052e-01   +3.286221843962300e-01   +2.309043002822642e-02   +4.917668896300263e-02   -1.369227360232329e-01   +1.888971509681639e-02   -7.486120356050760e-02   -1.678316157762827e-01; +7.904126404489689e-03   +7.187126874053842e-02   +9.241060335795818e-02   -1.489342197993420e-01   -1.895711270424141e-01   -5.297329964661979e-01   -7.534975641903274e-02   -1.020470126506746e-01   -5.559357808124962e-02   -5.759448197699767e-02   +7.554717779386372e-02   -2.584331934059919e-02   +3.350807015431615e-01   -4.846304475988897e-01   +9.009427469251635e-02   -2.903077926939822e-02; -2.868336280587535e-01   +7.437955314149888e-02   -1.543614775272498e-02   +6.220576854162174e-02   -3.175937975967681e-01   -2.134717070423705e-01   +1.604815654769304e-01   -3.074695832551977e-01   +7.054295804707882e-02   +1.010448414139590e-01   -1.834187150148610e-02   +4.197477785114646e-01   +1.032050225042646e-01   +1.986251420964349e-02   +3.758547761558270e-02   +6.335076239388353e-02];
L1E_L1I_iGABA_netcon = [-2.960148803426633e-01   -3.498730294751036e-01   -1.113673386331661e-01   -2.614990336877955e-01   -2.173453583913589e-01   -3.334080171140974e-01   +2.468240545315359e-01   -3.433309493416487e-02   -2.750725456225974e-01   -1.935986307644859e-01   -4.404675828547239e-01   -6.624778158855804e-02   -9.842027620746004e-02   -3.800847161357768e-01   +5.546376862928387e-01   +1.608575599512604e-01; -2.574439734128090e-01   +5.691193651105227e-02   +2.068877291690375e-01   +1.299397625665485e-01   +2.050137482048166e-01   +3.684981077375583e-02   +3.107195932082110e-01   -2.891805044788059e-03   -2.359424608269936e-01   +2.193308080227729e-01   -1.751776570148726e-01   +2.223748074158799e-02   +3.643744682541965e-01   -5.548951896903837e-02   -2.009344107811287e-01   +1.114778737799904e-01; -3.873434778235554e-02   +6.021478422052081e-02   +2.087607140626812e-01   -3.349924244747884e-02   +8.112357051686708e-02   +1.543391034300103e-01   -8.051936430021561e-02   -3.636300919213206e-01   -4.600450491345606e-02   -9.946348667688600e-03   -1.017111675356419e-01   +1.466694590519250e-01   +1.838792623369549e-01   -3.052095357500602e-01   -1.469626321674155e-01   -2.733938697965270e-01; -3.253945840728606e-01   +1.330220162097941e-01   -3.852860954091132e-01   -3.599504887595886e-01   -1.777417531251131e-01   +8.742708746083762e-02   +1.968160353825309e-01   -2.416965431127929e-01   -5.068477213392437e-01   -7.106509446531611e-02   +5.875023910255942e-02   -1.670000781980253e-02   +4.394434298619945e-02   -2.322590653026030e-01   -1.939935372615100e-01   +1.657972683836168e-01; -1.293181117686951e-01   -6.010871808113512e-02   +2.021899231508868e-01   +1.555522210213602e-01   +2.276154725892093e-01   -1.238652460584014e-01   +1.030067119417172e-01   +2.145309911009843e-01   +4.439201436825323e-01   +1.614951347143755e-02   -6.335299644160905e-02   -2.074537658709992e-01   +2.018930923918800e-01   +5.820180569439211e-02   +1.544369145737916e-01   -2.214468844298075e-01; -2.904475665661609e-01   +5.471040321923604e-02   -4.638913178670334e-02   +1.928098137948266e-01   -2.501646869778331e-01   -1.397571976906818e-01   -2.392872738616253e-01   -1.820619795030933e-01   +1.738780562309077e-01   -3.317121202834503e-02   -2.854832371730975e-02   -4.243830468039644e-02   +1.522345117366529e-01   -4.507171479784637e-02   +1.347642074567944e-01   +1.095016051805904e-02; +7.270987788883448e-02   -2.108720757742745e-01   +1.449082993922888e-01   +4.276196409120816e-01   -3.607204005202638e-01   +1.365170408712202e-01   +1.364381786734420e-01   -1.459371867101510e-01   -1.989288241618670e-01   -1.531314632063903e-01   +3.466829618476287e-01   -1.534666185581848e-01   +2.928561700740872e-01   -4.574706918455478e-02   -3.304436647737125e-02   -1.813957928945463e-01; +2.749112383991048e-01   -2.784591327268509e-01   -3.606509356366767e-01   -6.081528700001837e-04   +2.516738303312432e-01   -9.550801184125070e-02   +8.151424271588383e-02   +3.210804936812982e-01   -3.980152217443571e-02   +6.149904920773595e-01   +1.238402749078810e-01   +2.078715429423561e-01   +1.549862309275360e-01   -2.327532872974512e-01   +1.811824836793985e-03   -6.213675095757408e-02; +3.564325597686578e-01   -2.845540319171965e-01   -2.000047625998852e-01   -2.179675665036844e-01   +1.561972500529348e-01   +2.926441726030198e-01   -2.483250834522861e-01   -8.961215792652652e-02   -1.927919843169450e-01   -1.458238267683396e-01   +1.797135380298226e-01   +3.132365515824989e-01   +1.435051997925950e-01   -1.044620153590463e-01   +3.464719910769887e-01   -1.028128678452163e-01; +9.127945027353190e-02   +1.150617525816129e-01   +3.164163938294235e-01   -2.469660544449470e-01   -7.894845998211414e-02   +1.320290192262882e-01   -1.291498931258971e-01   +2.891362575854343e-01   -1.919291459055526e-01   -1.578367956935726e-01   -2.812492472500863e-01   -1.806648359343079e-01   +9.574238813363464e-02   +2.338734729458258e-02   -1.536043715474524e-01   +6.761522677695202e-02; +1.778697259355757e-01   -4.121501103278724e-01   -3.245800188050800e-01   +8.988917558212595e-02   +3.911102145582941e-01   +1.316559695455319e-02   +5.063958092949359e-01   +3.243774842827436e-01   +1.171479632740646e-01   +1.625163224199513e-02   -7.642732337892723e-02   -4.757637733736927e-02   +4.699582835580125e-02   -2.572243605872995e-02   +4.410405694702816e-01   -1.015251111271530e-01; +2.826062583350936e-01   -6.806796686343178e-02   -1.256689135862132e-01   +2.595539567293637e-02   -5.308123999548362e-01   -1.523402804158050e-01   -2.289877554556805e-01   -3.625928526676571e-01   +1.787326391730911e-01   +2.387949152915445e-01   -1.111808040699267e-01   -3.568288992455620e-01   -9.429108361009725e-02   -1.512114781631939e-01   -6.369790357033536e-02   -1.738342719873223e-01; -2.460638390546893e-01   +1.451322112604558e-01   +1.987295182275556e-01   +8.090590453795975e-02   -8.926826865097955e-02   +2.660532976106916e-01   +3.105883838029425e-01   -3.611088065188667e-02   +1.900165416834693e-01   -1.882544746367074e-01   +1.832237145827686e-01   +2.316019556801137e-01   -1.361263198200348e-01   +6.951964669839039e-02   +9.306764026660921e-02   -4.438535439380337e-02; -1.907121692960883e-01   -2.128779206914105e-01   +1.164855134165653e-01   -1.912712856996299e-01   +1.773581849906871e-01   -5.759121913946393e-02   -6.313432886634311e-02   +3.487097513017823e-01   -1.749420167159134e-01   -1.203730331566276e-01   -1.368861213818959e-01   -3.311355937966329e-01   -7.250086273021539e-04   +1.917967466751056e-01   -2.631466920207838e-01   +1.315520022130858e-01; +5.742246777838933e-02   +2.607720134682062e-01   -2.245383673708818e-01   -9.545016855300983e-02   -6.049632386435033e-02   -1.946494608212695e-01   -2.173908209840220e-02   +5.435279124981207e-03   +1.750681542530926e-01   +9.530410101486758e-02   -2.365974426139017e-02   -6.194303878767127e-03   +1.570571069946277e-01   +1.091008685053504e-01   +3.466954478740638e-01   -1.219784912655548e-01; -1.959556204072400e-01   -2.216398282808563e-01   -5.765740881853106e-02   +3.781572786545031e-01   -4.825222021563028e-02   -9.939728319122061e-02   -1.595436951783430e-01   +2.580396644995760e-01   +9.470370442538432e-02   +2.151603697995269e-01   -2.291174784535535e-02   +2.730428636072104e-01   -1.279075943037542e-01   -2.738619150351501e-02   +1.787046443693587e-01   +9.606231374137478e-04];
L2I_L1I_iGABA_netcon = [-1.403749006013947e-01   -3.344962688055191e-01   -1.004566983910226e-01   +1.297235795331192e-01   +3.712676577166935e-01   -2.712367319205388e-01   +2.066656811489007e-01   -1.005349665426388e-01; -3.011351724972133e-02   +2.063406585951499e-01   -1.877971834737688e-02   +4.334684123935736e-02   -6.304841747727341e-02   -4.102874861603997e-01   +1.946472099197840e-01   +6.763565113204822e-02; -8.602282879003817e-02   +4.247015714608544e-01   -3.387513654349794e-01   +6.536156593925903e-02   +7.137328256016956e-03   -1.042770021682614e-01   +2.716705966613079e-01   -4.011959273822147e-01; -1.406730548082468e-01   +9.288506321610145e-02   +2.364127876947191e-01   -2.720597020697225e-01   -1.192096909469939e-01   +1.044045049651835e-01   +2.501224842036687e-02   +2.006457841546659e-01; +3.360706758566073e-02   +3.461100394829486e-02   -1.421948970629314e-01   -4.783058968362399e-02   +2.144177731053623e-01   +2.425635013270986e-01   +3.603579304918045e-02   +3.565713375204400e-01; +2.114908481232723e-01   -6.546806120250388e-02   +1.957690106820825e-01   -3.728207681507717e-02   -2.067584368289454e-01   +1.061765399348470e-01   -7.021587680787396e-02   -4.725021647593092e-02; +8.395441538606528e-02   -3.241289547936166e-01   +1.617906200528764e-02   -3.029222821179540e-01   +3.628163144309642e-01   -1.406449391979915e-01   -1.587683368454861e-01   -1.907267357678857e-01; +1.792605654773481e-01   +6.842696683311822e-02   +8.525162524810448e-02   -2.044806382921974e-01   -2.731256911195624e-01   +5.864710814764409e-02   +1.612946062822551e-01   -1.012791078026432e-01; +1.278860670767354e-01   -2.143213359440182e-01   +2.182356528239249e-02   -7.176115858132233e-02   +3.558698732599659e-01   -1.815784304888969e-01   +1.702734691851726e-01   -5.093988785735104e-01; +2.749814570285940e-01   -7.217733024605337e-02   +4.157753107919836e-02   -1.197300591105543e-01   -3.557161708264954e-01   -8.255501484723773e-02   -1.145934700188355e-01   +3.775829412038443e-01; +2.665432569669766e-01   -3.444428967672756e-01   +9.139749067818727e-02   +6.870587923452426e-02   +2.979875187782822e-01   +1.904866567481106e-01   -3.433187537345553e-02   +2.714698104113265e-01; -2.870109385721771e-01   +4.628349268414129e-01   -3.412940908685564e-01   -5.548677182477349e-02   -1.957510635280960e-01   -4.136983406893892e-01   +4.441137454425100e-01   -3.180080145469983e-02; +4.421179816206030e-01   +1.610235178272124e-01   -1.499359279265713e-01   -1.538935112838722e-01   +1.585328801950757e-01   -4.177710258293346e-03   +1.698563122514160e-01   -1.628013911803946e-01; +2.154612166482782e-01   -1.446038686199435e-01   -4.995016697631033e-02   +1.232544620579270e-01   -2.733471057482244e-01   -4.360979475541062e-01   -7.244423210579254e-02   -2.031790437051533e-01; -8.383451241202192e-02   -3.180774173449777e-01   -3.760725469262545e-02   +4.581970593859552e-01   +1.887231156864194e-01   +8.168058758265290e-02   -4.288863359390837e-04   -2.124263832054860e-01; +2.678058545971133e-02   -1.495263611356747e-02   +1.504067450879625e-01   +2.370732484591156e-01   -7.749853174280807e-02   +5.340528580456610e-03   +4.988075283678364e-01   -5.223631650124744e-02];
L1I_L2I_iGABA_netcon = [-2.936800603549778e-01   -1.738975566972839e-01   -3.342369567549028e-01   +6.578585646883302e-02   -8.100594910794803e-02   +1.599601152727791e-01   -3.663266737878260e-02   -2.213787046729994e-01   -5.143479699187388e-01   -1.073419250250238e-01   +4.750634039804788e-01   -9.747131512244718e-02   -1.276670951768015e-01   -1.391768361703433e-01   -3.464116852132245e-01   -2.955269436995120e-01; -1.309129951400924e-01   -2.981332225000068e-01   -1.162579032419635e-01   -1.432924625890720e-01   -1.253892611009247e-01   -2.918702622158916e-01   -8.850642679855220e-02   +3.544345663833303e-02   +2.903954916333240e-01   +5.198918925338182e-02   -1.794877879391361e-01   -2.842361665793812e-01   +1.714713987481728e-02   -1.540339501930317e-01   -7.238975279565620e-02   +4.742100669834570e-01; +1.700763350521731e-02   +2.057002854549754e-01   +6.678856279150618e-02   -1.469940536781051e-01   +1.419960722125736e-01   -8.272118239058666e-02   +3.673290933951644e-01   -2.766300159040134e-01   -1.196916985075541e-02   +2.865736993983553e-02   +3.420287820353204e-01   -2.026880147491106e-02   -4.130896199043343e-01   -1.413011825656495e-01   +3.433880833215157e-01   +1.568701978687106e-01; +2.869026409885245e-01   -3.176673734560558e-02   +2.858823320538711e-01   +8.989940604882785e-03   +1.018905850906519e-01   +1.506107922874016e-01   -3.212346649466573e-01   +6.101141120244537e-02   +3.774858081104251e-01   +2.131350528247944e-01   -8.651184628823592e-02   +1.699973644823673e-01   -1.180520731899962e-01   -1.243015950853983e-01   +2.946042157801754e-01   -3.143609114182526e-01; +3.645987213575683e-01   -2.392283864102690e-01   +2.596119086140438e-01   -1.882714832612455e-01   -9.316020285332149e-02   -2.830995856782353e-01   -9.551479905084606e-03   -1.398049854323816e-01   -4.187433694231112e-01   +4.555814715855919e-02   -1.327371306770581e-01   -6.591918254574738e-03   +2.600906955573193e-02   -2.549725063739076e-01   +3.023867568019804e-02   -9.140492305951348e-02; -1.684012845926308e-01   +2.985340633693770e-01   -1.736102230937586e-01   -1.177713775617037e-02   -3.176327998484328e-01   -1.861478896908747e-01   -2.707521586824037e-01   +4.631106481824012e-01   -1.475760680086584e-01   -2.865753519193611e-01   +1.974642838278984e-02   +3.943170713665296e-01   -3.190653464743753e-01   -3.552426389127872e-01   +1.229760169188898e-01   +3.626176793927179e-01; -1.773840548558716e-01   -1.446104174412338e-02   +2.444821837493574e-02   +1.800476563620474e-01   +1.175113602619599e-01   -5.472510201632122e-02   -3.592563120763266e-02   -1.155104781958995e-01   -1.870613838467693e-01   -1.366543917512438e-01   -4.047977846237101e-01   +8.569006885181252e-02   -4.079127224559928e-03   +1.579541950129812e-02   +1.187829942996268e-01   +5.839457813193775e-02; -4.091477729894121e-01   -2.979296101812959e-01   -3.952225322725491e-01   +2.098931430115296e-01   -7.035315351323651e-03   -8.345626050751624e-02   +1.445582256406450e-01   -2.922679077472873e-01   +2.819717800505311e-01   +2.085170605989965e-01   -3.959461355117842e-01   +2.535862228849972e-01   +4.182535422578987e-03   +3.852101266174595e-01   +2.499496658618064e-01   +1.692654404233797e-01];
L2E_L1E_iAMPA_netcon = [-2.216560047578726e-02   -3.208793801928367e-01   -1.645605159660568e-02   -9.653617686896451e-02   +4.033757106183519e-01   -8.658057045208639e-03   -1.267942888207241e-01   -1.846350946175140e-01; -2.022936306795638e-01   -1.392693834762835e-01   -7.589504358566224e-02   -2.696980885291407e-01   -3.022080575418929e-01   +1.283804679592464e-01   +2.122776051248257e-01   -2.726510683510318e-01; -8.791600861952349e-02   +1.218014676587513e-01   -1.173339215844862e-01   -1.108369355516837e-01   -6.458374767480028e-02   -3.929199018929724e-01   +8.191533260285011e-02   +3.745564439930364e-01; -2.004167211268442e-01   -9.170781731179575e-02   -4.815390023253593e-01   +1.615815032332130e-01   -3.277623315201370e-02   -1.213612912877472e-01   +4.257355307583382e-01   -8.108446007150100e-02; -1.259861805516891e-01   +9.200234682592678e-02   +6.002230625093743e-02   +2.728449469647047e-01   +6.178347662557065e-02   +2.719712162713174e-01   +1.601765499797299e-01   -1.482682022475565e-01; +8.295492043103476e-02   -1.193037023768389e-02   -1.123881041485900e-01   -2.287724825170434e-01   -1.815301112209710e-01   +3.783159196632490e-01   +6.476001939056832e-02   +7.710052386595620e-02; +2.413528758928372e-01   +1.250243020058822e-01   +2.307516801765231e-01   -1.722516146010921e-01   +4.501091536604575e-01   -2.008736988130434e-01   -1.674239450856319e-01   +5.137454244164974e-02; -2.045399347272728e-01   -1.456224949591407e-01   -3.014607958259863e-03   -1.713160065088634e-01   +3.142069213286408e-01   -2.488692877503855e-01   -1.056080736187955e-01   -2.040372894608472e-02; -3.536812671815715e-01   -2.781258749307897e-01   -1.787109327580769e-01   -3.160308047155453e-01   -3.698638202679341e-01   +2.870712601003558e-01   -2.618085105006686e-02   +3.063884882318701e-01; +2.282948386224344e-01   +3.321443393458312e-02   +2.092862971131897e-01   +1.411959648327875e-01   +4.282524834592583e-01   -7.774505685653807e-02   -2.352817848989624e-01   +2.487571268000974e-01; +1.316449443666486e-01   -1.939928597801120e-01   -1.125971823673493e-01   -1.684845012046500e-01   +4.344071541143815e-03   -4.422052469344179e-01   -2.705893188175472e-01   +5.979158885719701e-02; +3.496646614993945e-01   -6.224218284401259e-01   +2.590734056714942e-01   -2.313905280443244e-01   +1.019690616794635e-01   -3.362245369474220e-02   -1.974505937710355e-01   +2.978157994239908e-01; -2.743811364242427e-01   -1.028757923598864e-01   +1.174771799468294e-01   -3.927125333749732e-01   +2.046062421203746e-01   -2.485617468799266e-01   +4.663016356632482e-02   -8.221901383612394e-02; +1.473673425758618e-03   -2.211771595976325e-01   -1.624204564481700e-01   +3.143840236266790e-02   +3.066083793286029e-01   +1.310276967637062e-01   -1.762727135544907e-01   +1.668962740324423e-01; +5.551400681485806e-02   -3.106040829074163e-01   +1.012837534319180e-01   -5.709878402533394e-02   -2.598839202789941e-03   -2.122158656716659e-01   -1.653918069201808e-01   +4.093510752409026e-01; -5.208755523553644e-02   +5.384348465175219e-02   +1.833110805471430e-01   +5.379142978283260e-01   +1.342710408930813e-01   +1.407612827828403e-01   +4.950852087561644e-02   -1.644900093166107e-01];
L1E_L2E_iAMPA_netcon = [+1.762245638760619e-01   +3.910595450221780e-01   +1.154114201861741e-01   -4.280243961811445e-01   +3.032018322614392e-01   -6.885749298325582e-02   +1.079570339075015e-01   +1.751720792271696e-01   +3.269386174266761e-01   -1.462080607330381e-01   -1.660483461560310e-01   -1.680800974651545e-01   +4.062816196395341e-01   -1.078686045327336e-01   +2.977635467738486e-01   -2.303360342813737e-01; +2.422235926624325e-01   +1.277074253388805e-01   +8.608837488113005e-02   +1.113043050489840e-02   -7.503871558900164e-02   +7.046391508645290e-02   -2.543512557899255e-01   +2.532664052936098e-01   -5.781997553800000e-02   +6.085579032456176e-02   -6.007704200493946e-02   +8.454244362689464e-02   +3.678748359634721e-01   +2.204664510618984e-01   +2.208186624222254e-01   +9.817843847297771e-02; +1.433342060278200e-01   +1.455086818471268e-01   +4.419178171153870e-01   +2.079285407965841e-01   -2.417265023284318e-01   +4.402227696673826e-01   -1.507640763156831e-01   +1.360573893302380e-02   +4.129704728049499e-01   -1.885448136752050e-01   +1.284537374822545e-01   -7.061190065180267e-02   -5.388622674868345e-01   -3.709835507819405e-01   -7.813271926054091e-02   +2.043699711085525e-01; +2.364745301827381e-01   +8.250561144132745e-02   +1.619021195892686e-01   +2.242613005056737e-01   -1.374586551785107e-01   +7.145888527409930e-02   +1.447163549046277e-01   -3.079878811936864e-01   -1.040627204256128e-01   +2.190534743855469e-01   -3.803842175461113e-01   +3.904125996283539e-02   -1.906944453512970e-01   -2.372672439442461e-01   -1.882995857675846e-01   +1.665261717008900e-01; -2.830106569018669e-01   +3.987589204459419e-02   -6.042799949925362e-02   +4.355748267724336e-01   -1.318751168506822e-01   +1.932892889441941e-01   +1.456154881551252e-01   +3.164179208156981e-01   +9.148840087642690e-02   +4.812264773084799e-01   -2.629312969286365e-01   -2.433413254329994e-01   +7.211598881948315e-02   +4.802951820275582e-02   +2.639252141788880e-01   +9.972352539912363e-02; -1.337491819919298e-01   +1.895736394281821e-01   +2.027489412131665e-01   -2.376479058250258e-02   +2.205847226213557e-01   -1.379994134281983e-01   -9.023860729350477e-02   +2.244928116195063e-02   -1.047867647248479e-01   -2.066786172780298e-01   -5.863056251550480e-04   -4.850457599274074e-02   -1.745871949336155e-01   +1.275140638461513e-01   -1.833824168485859e-01   +2.674759178828213e-01; -2.362172790573551e-01   -5.490494583043266e-02   +6.060184277775610e-02   +2.011632498973547e-01   +3.257609194801908e-01   +3.087902847098634e-01   -3.314444331855555e-01   -8.232993343843766e-02   +3.396329732934072e-01   -1.702701065778833e-01   +1.453095017578574e-01   -2.152615533596323e-01   +3.025257539334771e-01   +9.588367746260293e-02   -1.957376301673029e-01   -2.350706318533698e-01; -1.111991717084352e-01   -4.074926943248015e-01   -3.900233568873011e-01   +3.515092586524250e-01   -8.756731495454528e-03   -2.996363084588379e-01   -2.819737911402377e-01   -2.237801290188296e-01   +4.033162587069870e-01   -1.419686778498210e-01   -3.589028575404363e-01   -2.729506705925235e-01   -2.780557002520006e-01   -7.851693639526736e-02   +1.800019888406985e-01   -3.230479907423550e-01];
L2I_L2E_iAMPA_netcon = [-1.308097003400089e-01   -2.989201549121600e-01   +1.289992098838104e-02   -4.306601259502457e-01   +1.403491636575779e-01   +4.006078057557223e-01   +6.845691078715363e-02   -4.086247875242857e-01; +9.716618506545578e-02   -3.929162009189014e-01   +1.002756213778323e-01   -1.288094144745575e-01   -1.629338890914169e-01   +2.262001181998267e-01   -3.694486899290781e-01   -5.416507604712826e-01; +1.737529034651595e-01   -6.162756243304296e-02   -3.806668893406865e-01   +1.629907945677553e-01   +1.833875017303289e-01   +1.348759539647748e-01   +3.847793571173672e-01   -1.531315311389546e-01; +4.691995451693742e-03   +3.447257976704238e-01   -1.827274676262033e-03   -1.759838118675422e-01   +5.214600562453098e-03   -6.697117905943256e-02   -1.502389186202464e-01   +2.408195239339138e-01; +9.012964599604134e-02   +3.034778932338082e-01   -3.186900407510831e-02   +1.416048981692121e-02   +4.184710252901163e-01   +1.820144456671522e-01   +4.933112819018481e-01   -1.405079679025970e-01; -8.963063860297715e-02   -2.107149493173441e-01   +9.714061999987393e-02   -1.869221673461384e-01   +2.454724580767998e-01   -1.360966804014769e-01   +2.733001530366332e-01   +4.325633167800173e-02; +1.250026864351115e-01   +2.564908383719366e-01   +8.662592680957797e-02   +6.949361252486413e-02   +3.177953278491127e-02   -4.146920953179546e-01   +2.042202318087372e-01   +8.721580672018425e-02; -4.777956170747085e-01   +9.577679719458501e-02   +1.856908113648032e-02   +3.249355975187486e-01   +6.765709283947556e-02   -1.737206890043138e-01   -9.167982695157270e-02   +4.491982168646592e-01];
L2E_L2I_iGABA_netcon = [+1.899469825268572e-01   -8.623524333668509e-02   +4.653342439341890e-02   -2.124962456260457e-01   +1.682592798061690e-01   -4.747098850605931e-01   -7.463736435717130e-02   +1.890551637173224e-01; -3.326471258400214e-01   +2.373211931014860e-02   +2.286766139884882e-01   -1.790930077518682e-01   -1.123184651167390e-02   -3.065556943565112e-01   +2.184297175670941e-01   -1.023321560555443e-01; +8.123329313476185e-02   -2.816401590316618e-01   +1.911461499552712e-01   +1.208685447327952e-01   +5.346352591206095e-02   -3.192895833896172e-01   -3.473958355242297e-01   +6.915252670741819e-02; +3.500039949764423e-01   -5.091331926510637e-01   -1.918849482176933e-01   +3.921822720508868e-01   +1.868826924991622e-01   -2.085999029587527e-01   -8.554689972952063e-02   -4.289803389793284e-01; +2.695045293668512e-01   -5.099006124487246e-01   -3.352583326962733e-02   +4.203934820574404e-01   -1.176014870086237e-01   +1.620097823257801e-01   -9.577232031975563e-02   -2.945610393097757e-03; +1.520375258897975e-01   +9.486169582504403e-02   -2.520486249538296e-01   -3.747388691322893e-01   -1.733458314363433e-01   -1.290912061865339e-01   -1.541897937763132e-01   +1.230973726281539e-01; -3.856678360352914e-01   +4.875897577018745e-01   +3.881026127042041e-01   +8.353280737812288e-02   +2.532395574913695e-01   +2.180211475874885e-01   -7.589492554142753e-02   -1.254772156493635e-01; -6.097082654491114e-02   -5.854331154698338e-01   +9.349372521883426e-02   +8.619423249028596e-02   -7.567723885877697e-02   +2.280671836549747e-01   -2.312833294031407e-01   -4.456065270940463e-03];
L3E_L2E_iAMPA_netcon = [-8.803430850744351e-02   -4.407632174937657e-01   -1.554992908659052e-01   -1.751890325003352e-01   +4.767469812447923e-01   -2.499843497621482e-01   +1.366536236581035e-01   +2.768591969261956e-01   -1.706478117531642e-01   -2.061459503847565e-02   -5.517869289377461e-01   -1.256881952732644e-03; +2.623977182619540e-01   -1.122866382591435e-01   -1.782773711320302e-01   +1.651003211039147e-01   -1.840256887866053e-01   -2.027219552549413e-01   -2.815127405454640e-01   -4.325069403998466e-02   +1.954247065383440e-01   +7.379384600710112e-02   -4.519456222791582e-02   -5.265734892411056e-03; +2.095976383495610e-01   +2.855457728570875e-01   -2.739847231576732e-01   -5.320553040071833e-02   -2.289138832180741e-01   -2.210723697814684e-01   +1.714045386446427e-01   +1.060083247484802e-01   -1.152936838485333e-02   -8.776517669240008e-02   +3.503185647432253e-02   +1.535727374684284e-01; -3.614635423696215e-01   +6.202779083890594e-02   +3.830948897442762e-01   +2.610599226809184e-01   +3.160867239640421e-01   -1.571106645555642e-01   +2.181067686105055e-01   +9.095012354252512e-02   -2.132231516241749e-01   +2.048796320845504e-01   +1.869159261351954e-01   -4.492518027845176e-02; -1.200306127550979e-01   -4.136344037437205e-01   +4.568216123349297e-02   +3.198128500073117e-01   +2.785055709774626e-01   +3.150111991498624e-01   +1.322729466009289e-01   -2.122652840851114e-03   +8.010159850662268e-02   +9.190560193190633e-02   -2.328629695930336e-01   +4.054509396082698e-01; -1.320265379867777e-01   +1.271251718832018e-01   +3.322728355642532e-02   +2.205369600314281e-01   -2.905082103142925e-01   +1.539485418267798e-01   +2.603008959774126e-01   -6.470189478824889e-02   +2.496454880647207e-02   +1.918956671987969e-01   +1.265010501445324e-01   +1.279884634084774e-02; -1.500281147706041e-01   -1.255108387622959e-01   +7.691929989869044e-03   -3.396258817259140e-02   -2.727428600350953e-01   -2.566639788970764e-01   -5.177728917189915e-02   +8.049239088539684e-02   -2.335590782451033e-01   +8.171453194875389e-04   -1.641750511864571e-01   +2.449952421453094e-01; -1.915839696602818e-01   -2.100760819354712e-01   +2.611811396499205e-01   +1.098456199054941e-01   -2.070009493763827e-01   -1.765860663791411e-01   -3.192686997238406e-01   +4.199284828284588e-02   -3.664389610956640e-01   +7.992923474594489e-02   -2.465374389879471e-01   +4.824794404240240e-01];
L3I_L2I_iGABA_netcon = [+2.190912149309551e-01   +5.864924562970748e-01   +4.187848654159257e-01   +2.352372631352795e-01   -3.189495858580080e-02   -2.419676692572583e-01   +2.482377759587025e-01   +1.673043890434727e-01   +5.171840303467481e-01   -3.586441748592734e-02   -1.975422500035006e-01   +3.491110346275204e-01; -1.894290747344300e-01   +2.851084325840968e-01   -3.494299460950056e-01   +1.064867646014283e-01   +1.197883953246515e-01   -1.592993545266425e-01   +3.446274732231588e-02   +4.358341176243985e-02   +3.451681651375096e-02   +3.305863946294674e-03   -1.335511594965929e-01   +7.182551469444361e-02; -1.408853358876352e-01   +2.512288938559074e-01   +1.800673044889168e-01   -2.371340461155190e-01   -7.601703338538240e-02   +2.114573471908380e-01   -1.079103723891904e-01   +1.124597991663351e-02   -3.640079433470290e-01   +3.505281716579580e-01   -4.489855763407810e-02   -2.733592557570514e-02; -1.523704832662851e-01   -8.998479413097914e-02   +2.102939814377125e-01   +1.572730359215389e-01   -5.352349837309432e-02   -1.328878877678788e-02   -3.190020524858490e-01   +1.736827322650336e-01   +1.589805258781288e-01   -3.943158089363558e-02   -3.492059405994101e-01   +6.309796831446245e-03; -1.775567370778528e-01   +1.716080537651853e-01   -3.067194009545389e-01   -3.077519529259920e-02   +2.088289404101208e-01   -3.532177109876741e-02   -3.201491792716833e-01   +3.059387686514598e-02   +3.073659652118063e-01   -7.817305542453409e-02   -1.035231931966263e-02   +2.037898854399872e-01; -7.949197296195079e-02   +3.815095080728491e-01   +1.630977489619048e-02   +1.135043909143222e-01   +1.572909114013226e-01   -2.310253649266455e-02   +7.454069347429859e-02   -4.295950673390021e-02   +1.408566816511199e-01   +8.959262460547451e-02   -3.558552148826947e-01   +6.205393853704139e-02; +3.121137915537834e-01   +1.481280293456618e-01   -3.229619200791863e-01   -2.792373022588269e-01   -3.171094917103343e-01   -9.417000920317295e-02   -6.287278580392899e-02   -3.634963959371549e-01   -2.827335482792129e-01   +2.016381542645675e-01   +2.454272682482521e-01   +2.920528801728250e-01; -3.629328616547263e-01   -1.049330619407478e-01   +5.003966906025944e-01   -1.921328112652905e-01   +3.063269980654032e-02   +1.571446076556060e-01   -3.469884141855233e-01   -1.612672869778398e-01   +1.664768808738002e-01   +1.969925997505818e-01   +1.086926535292220e-01   +1.049849438023102e-01];
L2E_L3E_iAMPA_netcon = [+7.523125499992407e-02   -3.311289458496569e-02   +1.709284199153834e-01   +1.225550134386590e-01   -2.300566314621090e-01   +4.415839476531970e-01   -3.154100704409340e-01   -6.758247976830692e-02; -2.009661071650806e-01   -2.897233821658797e-01   +1.563029613517052e-01   +1.399606521794531e-01   +1.951517559565096e-01   +2.607032616742044e-01   -3.100908908292080e-01   -5.959142191538425e-02; +3.467427301751609e-01   +1.445640937260348e-02   +7.724869111657140e-02   +2.129447809419992e-01   -3.006692952137499e-01   +5.468474851216491e-02   -2.837942525797079e-01   -5.151886452655476e-02; +2.367567637168113e-01   -1.485354625263021e-01   +1.426227012086175e-01   -1.211034442308043e-01   +2.165487939039867e-03   -2.417821599106396e-01   +6.645489924554493e-03   -3.174595480821757e-01; +1.565764101070501e-01   -9.113327337800581e-02   -1.248711471817093e-01   +4.790963433709536e-03   -1.650934637865681e-01   -3.006811117415668e-01   -1.881101379291213e-01   -1.689287525424400e-01; +2.139400383044083e-01   -8.543898351732611e-02   -3.471188017794959e-01   -3.601947692468165e-01   -2.256466126048423e-01   +4.941313437755461e-01   -3.432129045329269e-01   +1.520370980189920e-02; -1.152945714146538e-02   -2.125771160830443e-01   +2.261207034962635e-01   -2.571179531307911e-01   +5.871299493206625e-02   -2.761821924252866e-01   +5.610099406582196e-01   +2.285895971840724e-01; -1.302903484681794e-01   +5.729791266240049e-02   -2.576046767619930e-01   +1.186979325683437e-01   -4.775557401225842e-01   -3.214630087863059e-01   +2.780555347882764e-01   -2.529656539601436e-01; -6.020927365707818e-02   -9.921716306293180e-02   -1.958934521602775e-01   -2.484588618261425e-01   +2.233778045125783e-01   +4.170939456494144e-01   +3.038363125784619e-01   -2.651358352430340e-01; -1.166593844546691e-01   +1.753584880220534e-01   -2.523871093059445e-01   -2.555365421253729e-01   -8.738211780325078e-03   -1.187952375321225e-01   -8.113704662241422e-02   -5.774667181122652e-02; -2.441701429816229e-01   -1.350482583260892e-01   -1.650455814534464e-01   -2.557805190701268e-01   +2.135001369159098e-01   -1.625800471419407e-01   +3.429139540683592e-01   -5.791417117857713e-02; -2.427554057149542e-02   -2.482278019315318e-01   +3.084130257172705e-01   -4.450719115016229e-02   -5.379566481242884e-02   +1.883889847645795e-02   +5.051619389960267e-02   -9.214435516684914e-02];
L2I_L3I_iGABA_netcon = [+8.436650432752232e-02   -6.087000082329218e-02   +4.443384311778553e-01   +1.626298462411597e-01   -5.508591318734009e-01   +1.732783378639038e-01   +3.599740248747937e-01   -2.445100902382182e-01; -1.229764722209157e-01   +2.316021748157668e-02   +1.362316981695105e-01   +1.877380161211864e-02   -9.098091752706007e-02   -2.917820200468833e-01   +1.209388391359316e-01   -2.887109140083465e-01; +1.071540702431596e-01   +3.248515418528727e-01   +1.452881013919343e-01   -4.647504071673650e-02   -1.482450335049915e-03   -4.237923569631613e-02   +1.676249193171323e-01   +1.241304464756085e-01; -3.185769115905059e-01   -2.512766275923906e-01   -1.072990328508676e-01   -7.651780263216468e-02   -3.833453391108356e-01   +2.913585577952669e-01   +4.221995894319773e-01   -1.882743660548837e-01; -6.392115355742300e-03   +3.541553665158514e-01   +4.614020081098885e-01   +1.437275938322304e-01   +2.617040292257377e-01   +1.761630292289784e-02   +7.332799587909375e-02   +2.619832316306692e-03; +4.403082666869146e-02   -8.235730828066976e-02   +1.492864085807248e-01   -3.573471774999290e-02   -2.206159698981720e-02   -1.968381953577671e-01   +2.154787823744606e-01   +4.289181517421316e-01; +2.244298590460380e-01   +2.121141416896729e-01   +3.647454533647344e-01   +3.040199286349575e-01   +4.045014006236436e-01   +2.286130828300906e-01   +1.992070124111792e-01   -3.673876637960181e-01; +1.466892874865560e-01   +2.159480889288862e-01   +3.992282998012131e-02   -2.409283354372976e-01   -3.117073911264698e-02   -3.429754053677628e-02   -3.395113497251752e-01   +1.460580750294828e-01; -2.680424003669191e-01   +7.598876486416509e-02   +1.502695670268105e-01   +4.509988001927319e-01   +2.204416527169837e-01   +4.176613383416158e-01   +2.824613623039271e-02   +2.047619955845775e-01; +2.581569355317886e-02   +2.725216399486750e-01   +2.729590640785416e-01   -4.437514558942960e-01   -3.939009310472741e-02   -1.122420810576321e-01   -2.963972187518800e-01   -1.215939960646664e-01; -4.071531654143429e-02   +8.444607101091545e-02   +1.570764000939483e-01   +1.363880908093418e-01   +6.284564237744361e-02   -1.151450426873329e-01   +2.532210181043664e-01   -1.288034588290474e-01; -8.510638561156145e-02   -1.415659260409408e-01   +1.905496142532536e-01   +1.683031849657401e-01   -2.692506003350441e-01   +1.133988569767003e-01   -3.059322895576205e-02   +2.141124735401788e-01];
L3I_L3E_iAMPA_netcon = [-4.831643275893172e-02   -2.870587901421039e-01   -2.628813658462806e-01   +5.363393153533458e-01   -1.242594709902794e-01   +5.601756487716418e-02   -5.372758614789602e-02   +5.676611812166191e-02   +3.119134808308271e-01   -8.429271705882607e-02   -1.731095938144654e-01   +3.351707672674940e-01; -1.454782102273575e-02   +8.127986387903112e-02   -4.400204948505496e-01   -1.698820028895539e-01   +4.917462481998558e-01   -1.240788501362092e-01   +8.111972096685269e-02   -2.613204575721406e-01   +2.960025039439880e-01   -3.476912795625956e-01   -2.779061657394771e-01   +1.216961058892476e-01; +2.270363273509374e-02   +2.677267964266783e-01   +7.399380187889332e-02   +3.253000362814656e-02   +1.560943783693325e-01   +2.071437075640635e-01   +1.578902492914440e-01   +3.002029893049869e-01   +7.874991799475520e-02   -2.046047361470776e-01   -2.659780828296802e-01   +2.631657279797311e-01; +2.605587846596888e-01   +7.384621112253270e-02   +4.158729760836079e-02   +1.585574064770429e-02   +2.864204434609222e-01   -4.153956636391584e-01   +1.175467375648653e-01   +2.267842464866035e-01   -1.625606034908804e-01   +1.094244218711041e-01   +2.896304432234726e-01   -8.706348384183890e-02; +2.297954571393980e-01   -6.757510508976522e-02   -3.873298408507624e-01   -3.704825392550465e-02   +2.217662427063551e-01   -2.607217782027708e-01   +5.725220278096341e-02   -2.338602284899158e-01   -2.066715691561494e-01   +2.054581638480889e-01   +2.808457910649337e-01   -1.943495989194022e-01; -1.420045766154496e-01   +6.346826212963022e-02   -3.918906336802792e-01   +5.220015994604456e-01   +1.102926343493683e-01   +3.965107324967804e-02   -2.420454073102300e-01   +2.097299069625941e-01   -2.665127170653372e-02   +5.232642115751491e-01   -6.512546289158937e-02   -3.028308092896612e-01; -1.880278573534028e-01   +9.026271726949427e-02   -2.218079484044617e-01   +1.752353605361864e-01   -8.554673207012661e-02   -2.537587779767725e-01   -6.563233487023595e-02   -4.566999583355641e-01   +1.606607795416086e-01   -1.731738204649928e-01   +5.423663520431083e-01   +2.263583744129335e-01; +2.275302608085044e-01   -7.942419798723135e-02   -7.180447131600656e-02   +2.276374900748041e-01   +2.700638765464458e-01   +2.251574858249771e-01   -3.548504446491959e-01   +4.093532679013941e-02   +1.313551673734388e-01   +6.861410040462070e-02   +2.156219818381616e-01   -2.207286921745964e-02; +3.915261456051942e-01   -2.438128159715409e-01   -3.311537915725862e-02   +2.411827196616140e-01   -2.168297050707331e-01   -2.346485512943400e-01   -1.659543185828141e-01   +1.797099398915604e-01   -8.347111205292551e-02   -2.150331381818875e-01   -1.728826302785497e-01   -1.072079909820170e-01; -3.870111418371512e-02   -8.616958092395684e-02   +7.381836410947773e-02   +2.587892809365466e-02   -1.837841194340060e-01   -6.664927389344320e-02   -2.390984361612364e-01   +3.521692205116687e-01   -4.448741946700313e-01   -5.811239620519755e-01   +1.089815045063847e-01   +2.745008132775427e-01; +1.895527213191020e-02   -1.527979458705324e-01   +1.309522467795073e-01   -3.568096224350703e-01   +2.646112290592040e-01   -3.027470481409210e-01   -2.597052972279644e-01   +2.343725072575628e-01   -2.119064185246824e-01   +3.313053167897878e-01   -2.650781367226097e-01   +7.302791079622663e-02; +1.011643337712297e-01   +9.388117680246247e-02   +3.789469073987782e-01   +1.582178503427011e-01   -3.794908717677761e-01   +8.456196155869082e-02   +7.147022695296663e-02   +1.431647386212093e-01   -1.445845487930648e-01   +3.632046875890241e-01   +8.588743221557815e-02   +3.451962557358708e-02];
L3E_L3I_iGABA_netcon = [+2.563110121967120e-01   +7.678628993748310e-02   +2.512771221018792e-02   +6.688226611189498e-02   +1.800867602871317e-01   -7.726790999230418e-02   +4.189281339040646e-01   -1.331899777171161e-02   -1.860012740173507e-01   -2.084103196493630e-01   +1.220491248517503e-01   +2.341323345131064e-01; -1.684056280093443e-01   -2.795183846691340e-02   +1.100917619088421e-01   -4.389505663410699e-02   +2.216167630233702e-01   +2.264753542999262e-01   -5.074671032389115e-02   +3.717814689899941e-01   +2.064815043931208e-01   -2.511261621265468e-01   -4.605135330654269e-01   -1.373823898562466e-01; -1.070562110758705e-01   +6.442402889335568e-02   -6.187403882772790e-02   +8.704528125666444e-02   +8.590306792454117e-02   +9.838121650468558e-02   +2.107326816414691e-01   -1.831950124279272e-01   +9.728002931078661e-02   +3.182130732779334e-01   -6.495365274960016e-02   +1.185175658407711e-01; +4.141107945271643e-01   +1.721818576066781e-01   -3.112979630477187e-01   +2.206924146292282e-01   -1.540914109477955e-02   +2.075635611803668e-01   -3.772369987440741e-01   -2.743766956603010e-01   -6.156803747857895e-02   +8.711829782584940e-02   +4.197052631640540e-02   -2.869224674064231e-01; -3.421401521747528e-01   +2.203734950921912e-01   -1.742871146449439e-01   -6.595735933540550e-02   +3.286810420466794e-02   +2.405053892994325e-01   +2.551027377001086e-01   -2.875389957703404e-01   -2.908252599262349e-01   -1.235041091385288e-01   +5.019685643572450e-02   -4.185540290596159e-01; +8.479363326770570e-02   -6.209345158367408e-03   -4.650710606432346e-01   +5.212110317286864e-02   +3.588809355974453e-01   -1.267577605297094e-01   -8.355291375602183e-02   -1.131959733498061e-01   -3.388416288041080e-01   +2.308420969195307e-02   -4.921702238276049e-02   +2.626600495249864e-01; +2.557718450051840e-02   -3.519223404919811e-01   -7.767961993126868e-02   +1.541462053465100e-01   -2.321390157389364e-01   +2.332858186880869e-01   +4.800080386719663e-02   -5.703830728603634e-02   +1.252755398521902e-01   +2.443564242982008e-01   +5.024762925154561e-02   -4.228054478182530e-01; +4.215362434290927e-02   -3.032257280825114e-01   +8.469534493294184e-02   +1.820375403465411e-01   -2.754748806614136e-01   -5.507636034871584e-02   +2.286444691247011e-01   -1.099964203593247e-01   -1.452198419992564e-01   -3.095293484650356e-02   -2.452479452465328e-01   +9.946039639766757e-02; +2.919006913017330e-01   +1.824887986868075e-02   -3.195801617982791e-01   +1.625055518741271e-01   -1.737968240702910e-01   +5.671561970611116e-02   +2.430206898042830e-02   +5.381968292500684e-01   -5.828778998803170e-02   -3.637267243059463e-01   -3.169139481244428e-01   -1.158349294446191e-01; -2.750234314618118e-02   -3.841815835805554e-01   -1.062130236405734e-01   -1.502959107516719e-01   +3.300198902453616e-02   -2.803510930110159e-01   -2.307062532773529e-01   -3.502028530751153e-01   +1.021840907131640e-01   -7.289455597285671e-02   +5.238885571914823e-02   +1.891635848148048e-01; -8.472248199104136e-03   +2.504155366591059e-01   -1.483753100507114e-01   +2.453734419028771e-01   +4.952188417858398e-02   -2.090130070004154e-02   -1.835848065809613e-01   -3.069704356451419e-01   -4.556087061161113e-01   -1.401308450945925e-01   -5.436266278269720e-02   -1.101809755174599e-01; -2.892626105223721e-01   -3.144160511242049e-02   -1.717872475396147e-01   +3.548367623058434e-01   +4.074083592263282e-02   -6.453552142753391e-02   +2.751327670174199e-02   -2.390260803818922e-01   -2.154541478293424e-01   +2.094481329474606e-01   +1.537527027551432e-01   -2.965172314743228e-01];
L2E_Input1_iAMPA_netcon = [-4.010965574908203e-02   +3.261052279695965e-02   +9.439253152824011e-02   -1.611084234589028e-01   +5.947998627429915e-02   +5.204412797138774e-02   +7.607224087553582e-02   +1.509007704247327e-01];
L2I_Input2_iAMPA_netcon = [-2.709013338256959e-01   -1.112489133121316e-01   +1.594039957094492e-01   -3.207043480492292e-01   +2.716298817297507e-01   -2.369597263235133e-01   +1.668235407588116e-01   -2.056568043389168e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.03*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.15*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.15*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.03*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.15*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.15*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
