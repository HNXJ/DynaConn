function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-1.957637701473510e-02   -4.513824296012000e-01   +8.118328697390566e-01   -1.570959860968804e-01   +1.000000000000000e+00   -1.613967646242189e-01   -7.422546662567838e-01   +5.589862482529166e-02   -1.085067512041925e-01   +4.130601223884336e-02   -2.988017251635420e-01   -5.432158369418018e-02   +1.742760957769872e-01   -2.298313558467937e-01   -4.923215779629055e-01   +5.218238998598595e-02; +2.722128287012026e-01   -2.773783592811237e-01   +3.414537877634447e-01   -3.913562803868219e-01   -1.825544247975768e-01   +2.995952025858344e-01   -2.673492484832383e-01   +2.204620796916766e-01   +2.591400968541929e-01   -2.719505656507156e-01   -2.868482878827752e-01   +6.144656426935150e-01   +1.482152968031365e-01   +2.578593358835147e-01   +3.397322552406552e-01   -7.141024294150384e-01; -3.152508408451160e-02   -9.553965808126931e-02   +2.368600034211575e-01   -6.710379612596288e-01   -3.862811830646111e-01   -2.972113764926103e-01   -2.800805967682090e-01   -1.150170165890883e-01   -5.101889457219838e-01   +7.404914039651144e-01   +2.558303378200215e-01   -1.831488676110460e-01   -3.007687162509533e-01   -8.006835125421616e-01   -4.193166528035825e-01   -6.514453144286487e-01; +4.399781657193759e-02   +4.342399929131446e-01   +2.041377082972612e-01   +5.052209987441706e-01   -2.672666878797599e-01   -1.689882986600429e-01   +5.036185601747579e-01   -1.156088055536259e-01   -1.118142387329007e-01   +4.667006761198466e-01   -5.900208722213344e-01   +1.741341622716107e-01   +4.227616857617260e-01   -1.045231195995539e-04   -1.930984914648516e-01   +3.595364612907906e-01; +3.055072761914793e-01   +6.965521432386097e-01   -4.690625821369641e-01   -1.351031016568748e-01   +9.908387395271906e-02   +3.938074452698865e-01   +8.133003216955025e-02   +5.762731972572552e-01   +5.816441541758343e-01   -5.892573441292182e-01   +2.237903170293267e-01   -4.753659346286627e-01   -2.924226051236269e-01   -6.481569310989179e-03   +8.434439933427456e-01   +9.842146664116713e-03; -1.908128728519928e-01   +6.334875462936012e-01   -1.919524650530128e-01   +3.337120479685054e-01   +5.041413239238089e-01   -8.031300760535889e-01   +3.713948702762533e-01   -1.450917080158241e-01   -1.219532076647944e-01   +3.664336873151745e-02   +2.299791279388498e-01   +2.171688322905998e-01   -5.531985045187542e-02   +3.259137201447704e-01   +5.813648910329369e-01   +3.745894118392279e-02; -1.846906756968848e-01   +6.623358538843567e-01   -6.048104289369471e-01   +2.147377621278172e-01   -8.593005800640000e-02   +6.060426995475060e-01   -1.860384237842623e-01   +7.596493420004912e-01   -5.076202503515103e-01   -4.499532924033543e-01   -1.997777831102764e-01   -2.995292257610867e-02   -9.484039000713800e-01   +3.654430873752009e-01   +6.499587170407570e-02   +1.591668525070135e-01; +4.917286867934605e-01   -5.312487599346164e-01   +2.282072096090480e-01   +4.744663277715388e-01   +3.031240659269170e-01   +1.447063890697509e-01   -2.106701001983153e-01   +9.212489800781838e-02   +5.543885968444714e-02   -2.870452050342780e-02   -5.618112935594254e-01   -3.088845165934240e-01   +1.332820157895267e-01   -2.146185990791830e-01   -4.523684727597131e-01   -1.665470413405263e-01; +6.959108288007552e-01   +3.379988021788052e-01   -1.269546202686101e-01   -1.881488018953746e-01   +2.219855364511034e-01   +1.071210192187271e-01   +1.686898731886075e-01   +9.352457598223113e-02   +5.183010926825398e-01   -2.509118569265420e-01   -2.206135035708022e-01   +4.253061043035907e-01   -3.155220417872902e-01   +3.714298487061024e-01   -3.945849626882152e-01   -3.437261147945438e-01; +3.142714777201274e-01   +6.886208872339618e-01   +5.204270136164421e-01   +7.373425871622170e-01   +5.939223825309379e-01   -3.196681267070025e-01   +8.296580303623791e-03   -4.790838884188025e-01   +4.260807251888487e-01   +4.432599758733893e-01   +3.370417240767458e-01   +8.675307815034711e-02   +2.350167139667941e-01   -2.419094320577056e-02   +2.532182108251516e-01   +1.153383489044921e-01; +4.427742956544795e-01   -2.849175027541031e-01   -7.968546237953789e-02   +5.123754935385189e-01   -5.202063633152169e-02   +4.432252852520859e-01   +1.205165023624701e-01   -4.068313902183869e-01   -3.126644701401749e-01   +5.712683152901605e-01   +3.643882413740768e-02   +3.305216660495012e-01   +2.338738232129115e-01   -5.597262645282653e-01   -1.592942851313533e-01   +5.134794349899044e-01; -2.361123382540283e-01   -7.841852596224921e-01   -5.203045850719127e-01   +1.870277943336269e-01   -2.139065346022176e-01   -2.182012979240529e-01   -4.916977895251948e-01   +7.120812326954681e-02   +6.871783535581155e-01   +2.844271671514655e-01   +8.648507048020381e-01   +5.145977792301444e-01   -2.013207247188913e-01   -2.330172712659474e-01   +3.088865807663986e-01   +3.206483899370416e-01; +9.100495395377491e-02   -2.649312261680134e-02   -4.758344509008927e-01   +5.739603252835144e-01   +3.577763041001088e-02   -3.310236276730054e-01   +3.109881782259173e-01   +5.246062755651388e-01   -3.629450266344157e-01   -6.593611065624108e-02   -4.297292945434982e-01   -5.478640362906246e-01   -3.690299074832665e-01   +4.341499784767607e-01   +5.807822222028315e-01   +1.056523160168705e-01; -1.346560961550115e-01   -2.030467102763310e-01   +1.024620495146843e-01   -6.757594506554587e-01   -7.626139146789532e-01   -1.092978190716666e-01   +5.903233404678601e-01   -1.864446141942485e-01   -6.180992708340172e-01   -1.099226526819062e-01   -3.281863012936984e-01   +5.402104343438155e-01   -1.797679687066904e-01   +2.099517200794349e-01   -7.989403503397324e-01   +3.679509108686731e-01; -6.621574773987277e-01   -2.050298126891506e-01   -4.967734894118787e-01   +5.261077058658887e-01   +7.461055640097948e-02   +9.285687720076910e-03   +3.791703418872751e-01   -3.787382711132686e-01   -2.599496851352793e-01   -2.246868618142629e-03   -1.526124641846060e-01   +1.131991477985415e-01   +4.855120934007378e-01   -1.730742415257416e-01   +2.572255055516769e-01   -1.197727150035148e-01; -4.829351209372277e-01   +4.450824902470796e-01   +6.112735470374369e-01   +1.254670388394513e-01   -3.150863091367919e-01   +1.573352951634125e-01   +1.759430788769638e-01   -2.201104894116749e-01   +8.944323861476877e-02   -6.781611793705306e-01   +1.128541962393756e-01   -7.306014760235363e-02   -3.556164080783460e-01   +5.263806299674478e-01   +2.430310343861649e-01   -9.394519249305908e-04];
L1E_L1I_iGABA_netcon = [+2.568062292241818e-01   -1.033089072662761e-01   -1.763785696776284e-01   +5.013789089850496e-01   +2.106221520429220e-01   +1.000000000000000e+00   -2.193335105223419e-01   -2.973286932679886e-01   -5.175296988827832e-02   -1.631058955052496e-01   -5.552903099405101e-01   +4.126981422953400e-01   -2.037218581436039e-01   +3.553527849494333e-01   -3.932671517324048e-01   +1.953020372983185e-01; -1.369212872051355e-01   +1.204042715557971e-01   -2.605861773801614e-01   -7.571035348968518e-02   -2.764701148182415e-01   +3.844958264778555e-01   +5.363198416599969e-01   -3.759713053813439e-01   -3.917245501353131e-01   +1.774740898394011e-01   +1.113199322947305e-01   +1.242686229569696e-01   +1.103234729151279e-01   -4.217110726450889e-02   -1.483304415412224e-01   -3.595069470433814e-01; +3.723117835107081e-01   -4.049508296677649e-02   +7.379426149376601e-01   +3.902498840439821e-02   +6.745548317434709e-01   -3.087567010657727e-01   -2.806533739560721e-02   -2.308114646014739e-01   +1.210313592315848e-01   +2.716522669999226e-01   -3.205241325600021e-01   -1.800601522499901e-01   +3.848814517925486e-01   +5.437772199217724e-01   +6.551073370801477e-01   +1.958850821735157e-01; +4.330518763212202e-01   +3.526648779235299e-01   +3.921231635290779e-01   +3.556321553893790e-01   +4.087917233029039e-01   -3.939378010821575e-01   -1.763122028528212e-01   -4.096610999620164e-01   -4.942461266511260e-01   +8.325041743039076e-02   +1.244272651205912e-01   +2.162512624244767e-01   +1.662888345863781e-01   -5.876565916124867e-01   +3.916613372061536e-01   +4.713979194047195e-01; -2.388600932797491e-01   +4.528938774754459e-01   -7.258213582002889e-01   -3.522711517559840e-01   +1.623993232517907e-01   +1.295945686585216e-01   +7.856004444299797e-01   +3.226892778905129e-01   -3.282556079860270e-01   +8.241342002027613e-03   -4.039272352651589e-01   -3.535693789811785e-01   +1.769890200304111e-01   +5.589174182664426e-01   +4.451000522722359e-01   -9.182388913801018e-01; +1.622837718519316e-01   +4.312668143987775e-01   +3.407631781908548e-01   +2.677655626684630e-01   +1.034293295757739e-01   +3.178499594389543e-01   +7.380491574002100e-02   +5.155238685344210e-01   +3.535269398643481e-01   -3.409598831810075e-01   +6.837375457451743e-01   -1.615306745529966e-01   -5.040125406622078e-02   +5.557433378180050e-01   -2.622184169595469e-02   -2.835902764296464e-02; +5.113811084827571e-01   -5.952911527791124e-01   -4.732920089725978e-01   -1.633932740710681e-02   -5.454387798922776e-01   -6.678212109134963e-01   -8.377924707251774e-01   +4.524847891624933e-01   -6.128722434254293e-01   -3.178259225040325e-01   +2.384630907849142e-01   -1.388414661304407e-01   +2.392545838176625e-01   -1.786200604460589e-01   -2.962521222197447e-01   +5.642609321271956e-01; +3.401790674211843e-01   -4.222333529111096e-02   +6.208067706815942e-01   +6.547593962107280e-02   -2.768760920486782e-02   -2.083964591897038e-01   +2.646131659360036e-01   +2.872064529944302e-02   +3.085685114844985e-01   -5.243425903647089e-01   -1.212376992275166e-01   -1.603405501815565e-01   +3.932595959836617e-01   +7.751482403543528e-02   -4.105102337743372e-02   +6.468532940379669e-01; +3.343319973530258e-01   -2.090762065104875e-01   +1.900457023973695e-01   +1.525236830484513e-01   -1.655832919634644e-01   +2.982922905996877e-01   +5.831742871208844e-01   +1.249546482005057e-01   -4.193952105378063e-01   +2.856573328412990e-01   -3.305511693405531e-01   +3.055148794312846e-01   -5.685839821190687e-01   +8.174885645962486e-01   +4.706374527158157e-01   +7.602060846968811e-03; -3.603884087586942e-01   -4.568949714222201e-01   -3.323419463955835e-01   +2.110041374150628e-01   +2.952549519765865e-01   -4.411867861253958e-02   -1.737898920711131e-01   +1.714375606699009e-01   -2.270601992440207e-01   +2.680820676586428e-01   -6.484088847623761e-01   -3.524704292354348e-01   -3.807908356233732e-04   -7.975888714110736e-02   -3.978944945479384e-01   -3.161342570567962e-01; -4.756937238139005e-01   +5.143227684355427e-01   -5.342197073850424e-01   +1.835437231814809e-01   -3.943872242179480e-01   +7.538842556183593e-01   -2.444334398870585e-01   -1.083573381898875e-01   +5.621551463576687e-01   -3.062630541276929e-02   -1.825917148897116e-01   +9.369538792059484e-01   +1.191694352298732e-01   +3.513047029903058e-01   -1.522932410276898e-01   +6.328430013202729e-02; +1.497971446426339e-01   -4.071874653709076e-02   -2.865591611588418e-01   -7.727250217473124e-01   +1.293328513841411e-01   +3.856519923513126e-02   -1.325104217222939e-02   -1.350012176906219e-01   -4.125440872573842e-01   +3.416034686068488e-01   -3.624872940313780e-01   -7.429612400561773e-01   -2.190586663535033e-02   +3.357294530097639e-01   -2.762270696762093e-02   +3.606999157193285e-01; -3.182866870373659e-02   +6.209179618461304e-01   +1.632492073889648e-01   +1.867721236811624e-01   -3.592944853697767e-01   +4.243099329219461e-01   -1.413592824410081e-01   -2.836814261524923e-01   +4.119401120760076e-01   +4.209820470574145e-01   +6.851626458377225e-02   +9.336236490049792e-02   -1.574816554806719e-01   +3.941758514359614e-01   -9.599213504609677e-01   +5.663006265294491e-01; -3.844863802432451e-01   +1.105602489668830e-01   -1.925886358635815e-01   -1.748540143062425e-01   -3.832384461118077e-01   +1.595035404818789e-01   +4.719225042948586e-01   -4.125636507086254e-01   +2.234489704199265e-01   -1.641892054211913e-01   -1.202188045153219e-01   +5.288842695999628e-01   +1.119748096831800e-01   +2.128063087766220e-01   -1.234454161345649e-01   -1.368269734194412e-01; -1.986351085327226e-01   -5.683915818406813e-02   -8.139643418181137e-01   -5.676811874299909e-01   -4.407884549705752e-01   -1.228814788403484e-01   +1.715107630016435e-01   -1.241336448908994e-01   +1.805796109761036e-01   -4.244236877682776e-01   -3.960757095681188e-01   +1.092132083051163e-01   +2.000258559241696e-01   -1.839490881816633e-01   +3.580133928753853e-01   +2.768634855257642e-01; -5.072704667761093e-01   +3.933791920773600e-01   +7.541194272298920e-01   +2.565799966105944e-01   -1.906234666709375e-01   +1.134901523756870e-01   +4.560021790848575e-01   -3.639743934678931e-01   -5.895504729547615e-01   -4.863062963690614e-01   -5.009098507761331e-01   -6.617897822840078e-01   +2.790681651154642e-01   +1.719911798881227e-01   +9.795256824147236e-02   -1.247283873552092e-01];
L2I_L1I_iGABA_netcon = [-5.046754377444489e-01   -6.473158609979144e-01   -4.083691153785223e-01   +4.396611580277868e-01   -2.229949086639549e-01   -8.268597166896827e-01   +7.007199611428853e-01   -1.695267321177685e-01; -4.602759519959075e-01   +2.087249789426194e-01   -4.493776222316200e-01   +3.677104503914123e-02   -1.053887038569709e-01   +4.891726865180530e-01   -1.186904105907736e-01   +1.851750222014997e-01; -6.870693000516763e-01   +8.469743460149826e-01   -9.587814442797701e-02   +9.474645947511265e-01   -1.398364462310322e-01   -9.780466482465267e-03   -3.441056833313063e-01   +8.792570581965790e-02; -6.151039610866939e-01   +2.344344590005359e-01   -4.354206292194291e-01   +7.563625575319703e-01   +5.334486250797080e-01   -7.746373287133983e-01   +3.509637253406424e-01   -3.219335230684339e-01; +1.016973315013692e-01   +1.513253972594679e-01   +3.695656630968830e-01   -7.715437175970673e-03   +6.257579117209997e-01   -3.600102823935585e-01   +2.953677388670185e-01   +8.285106066524012e-02; +5.746812723121723e-02   -6.677104197294136e-01   +2.203964127866622e-01   -7.064702916492754e-01   -7.756180754783982e-01   -7.349312857312363e-01   -3.419168265626981e-01   -7.368244054831667e-01; -4.322163674300643e-01   -4.108588137910695e-01   -1.808290646091381e-02   -1.009831744268951e-01   -2.327004541807161e-01   +5.182722962998070e-01   +3.432941901463868e-01   +5.203778598237541e-01; +8.094835911192859e-01   -6.695124909280611e-01   -2.085423112688074e-01   -6.181192800785086e-01   +7.208904549787972e-01   +6.663690174532355e-01   -6.865614998639278e-01   +3.373372735595672e-01; -5.040001244748152e-01   -2.749436464283921e-01   -7.757776607426965e-01   +2.118726365236614e-01   -1.703135071911615e-01   -1.199271521744249e-02   +1.970865618800579e-02   +6.290382664034080e-01; +5.297620488080266e-01   +1.842808113578401e-01   +2.082746882837057e-01   -1.575262088199444e-01   -4.185334555990011e-01   -6.807096558969417e-01   +1.540192450528171e-01   +6.365274580338468e-01; -2.049170053832416e-01   -6.218280656048795e-01   +1.365761050309571e-01   -1.275950482289561e-01   -4.933324568862771e-01   +6.310045884437363e-01   +1.494002400196469e-01   -3.685800409253219e-01; +4.482984083142306e-01   -5.093223353550363e-01   -3.635558087316016e-01   +7.009721911909760e-01   +2.282388510744238e-01   +1.047725341865064e-01   -6.284272602207306e-01   -1.598505935674566e-01; +3.989645639210270e-01   -7.166103869912468e-01   +2.429622360403433e-01   +4.937580732974711e-01   +5.978281420286956e-01   -4.929277152354076e-01   -8.776853969116503e-01   +2.014724051632691e-01; +6.203872041577754e-02   -3.579246270361437e-02   +1.161392878713537e-01   +5.940194241625389e-01   +8.508185155047774e-01   -3.509307399318803e-01   +3.599252842787684e-01   -4.555484557954406e-01; -6.212027024337017e-02   -4.699474681669522e-01   +3.257496084409017e-01   -1.841117832377408e-01   +4.725292376038356e-02   -2.831037905116582e-01   -2.834283978301367e-01   -3.558315670042183e-01; -1.000000000000000e+00   +1.540786675063900e-01   -7.046885933025253e-01   -3.391931988618175e-01   +2.277502185395477e-02   +2.719556100641309e-01   +2.552883158083865e-01   +2.596722019582802e-01];
L1I_L2I_iGABA_netcon = [+4.339883724503091e-01   -3.329662716081305e-01   -7.571142055151110e-01   +2.318412114042213e-01   -5.924591517073533e-01   -5.986079792022637e-01   +1.270423698411545e-01   -5.768057869206830e-01   -4.802304695080423e-01   -1.241312594168247e-01   -4.595642561282446e-01   +1.153076434991913e-01   -1.111541214741367e-01   +4.504486198863973e-01   -1.693864106073909e-01   +4.491631062567212e-01; +2.277626347362272e-01   -3.693375673694010e-01   +7.572610695343253e-01   -6.278598873638483e-01   -3.497814788941407e-01   -4.474517952379724e-01   +5.868715594295394e-02   +3.081480439009295e-01   -9.261867759265401e-01   -4.023576583462621e-01   -1.656339921621270e-01   +1.539799118916921e-02   +1.736369239058683e-01   +5.286024351153013e-01   -3.178586318093514e-01   +2.485233830505470e-01; +4.046226400412036e-01   +8.422344038208007e-01   -2.759494509133243e-01   +2.097752617941547e-01   +4.163634858418928e-01   +3.313102820579347e-01   -1.696876952077808e-01   -2.822751010355721e-01   +1.120707434525947e-01   +3.601150673630876e-01   +3.451585570988228e-01   -5.516960539368202e-01   -4.757855853280425e-01   +2.180007170010224e-01   +2.617979089410981e-01   +2.638250366619375e-01; -1.454164449538540e-01   -4.537800114407519e-01   -1.121015878680635e-01   -1.973392297849144e-01   -1.657969772524832e-03   +3.248669731604387e-02   -6.920887923837676e-01   +3.987895999789400e-02   +2.501045108035307e-01   +1.790653702042985e-01   -1.660434023852149e-01   -3.021474635578023e-01   +4.329742080339976e-01   -6.619682682674022e-01   -8.920344776919908e-02   +5.568715031143178e-01; -3.249372312577271e-01   +2.689604655045429e-01   -4.716669106617896e-01   -8.176826461051170e-01   +1.560547107399256e-01   -9.620300745187568e-01   +6.529765244617745e-01   -3.472284810770747e-01   -7.419733234362473e-01   +5.712324834868679e-01   +2.301336175635441e-01   -2.428752354313098e-01   +2.235554150153198e-02   -1.404164369084571e-01   +6.937476176979214e-01   -3.693576793064712e-01; +1.382114324588354e-01   -3.875300976209259e-01   -1.964790392016496e-01   -4.953270752210846e-01   +3.438165477403636e-01   -4.872754883750682e-01   +2.787744123795404e-01   +3.371500601391387e-01   +4.760795678067660e-01   -6.804433214410467e-01   -3.473566402324334e-01   +6.113145585098494e-01   -3.586069922784777e-02   -3.059058533152458e-01   -2.414265471340361e-01   -8.570946479058515e-02; +1.906681157111794e-01   +1.000000000000000e+00   -4.579065416239403e-01   -5.228283471359170e-01   -4.468566048573737e-01   +1.732981644913327e-01   +3.404381774784496e-01   -2.364536492482707e-01   -1.520572205653173e-01   +2.469225987129892e-01   -3.091667444599239e-01   +6.677978496863972e-02   -1.109638091656316e-01   +6.424522150532824e-01   +2.590562199277959e-01   +2.852884541307074e-01; -3.928178268277305e-01   -5.931547303474856e-01   +1.282399177776496e-01   +4.895321976290460e-02   -4.653953240995146e-01   +8.797196843459081e-02   +2.350056449084104e-01   -4.465670465181161e-01   +3.191285767169862e-01   +6.052850541476822e-01   +4.113408058617437e-01   -4.698439448912726e-01   +5.346568349187563e-01   -6.279503299178502e-01   +2.589808548791490e-02   -5.797917316183220e-01];
L2E_L1E_iAMPA_netcon = [-1.497810794533768e-01   +1.501034436362015e-01   +2.857293355712279e-01   -3.385909934776898e-02   -1.432425176492458e-02   -4.469563005618024e-01   +2.140383233462751e-01   +7.189126862133394e-01; +1.513117618147068e-01   -2.789843787715496e-01   -2.907115074853670e-01   +4.391412420639084e-01   -8.297643824450373e-03   -4.176879778329786e-01   -1.634411843015370e-02   -2.608715492545637e-01; +5.499491216853665e-01   +6.059908406119119e-01   -3.182325900554495e-01   +2.835131316035098e-01   +2.974430830252029e-01   -4.280095371808565e-01   +2.165682795260475e-01   +3.919192644046126e-01; -2.255383900616809e-01   -1.860633064917284e-01   +2.695866019980229e-02   -4.812948464677438e-03   -2.042769483085279e-01   -2.220934660482644e-01   -3.313560141317087e-01   -7.406483854602917e-01; +5.618022768791411e-02   +2.590246071814000e-01   +1.658939556336694e-01   +2.544870393990183e-02   -5.473185544479555e-01   -3.255056155210858e-01   -3.534558424313241e-01   +3.836801768538689e-01; +7.550460903925346e-01   +2.313823158016154e-01   -3.019254611281805e-01   +7.308243644362908e-02   +1.333601997972254e-01   -4.883340891568262e-01   +9.604216593780253e-02   -6.672062372168508e-02; -7.775423147169990e-01   -7.239188589816183e-02   -6.607076002148147e-01   -4.289534089792869e-01   +6.106340099044407e-01   +4.547257048241986e-01   -1.484440581884245e-01   -8.017749323565042e-01; +1.000000000000000e+00   +5.983173198765270e-01   +1.699602329151861e-01   +1.465829495279216e-01   +6.548498624795864e-01   -4.411726030740191e-01   -3.667850814175665e-01   +1.216159299925050e-01; +8.988472253155937e-01   +7.398298214320563e-04   -1.189705780305530e-02   +3.830082377241062e-01   +4.671387889946858e-01   +6.418960237940980e-01   +7.631436977870214e-02   -3.646469065260283e-02; +2.084467828857839e-02   -3.406666163342478e-01   -1.042079573247730e-01   +7.389382994666915e-01   +4.116922787078920e-01   -4.379196136586538e-01   -2.150083896925015e-02   -5.983111335891859e-01; +6.786488950187115e-02   +5.407928275905249e-01   +7.137360867693308e-03   +2.605414380967774e-01   -1.839653105692991e-02   -6.385025021046684e-01   +3.158239644127299e-01   -6.792239144969069e-01; +2.373290704673988e-01   -3.226958721935984e-01   +1.995817540735949e-01   +6.783380294828557e-02   -5.860688908746476e-01   -7.283434181021349e-01   +3.510414305483522e-01   -7.238552989055693e-01; +1.394979685299382e-01   +4.611341963256142e-01   +8.536881162167079e-01   +4.960179544467979e-02   -1.212488943493161e-01   +3.678710274993506e-01   +1.176650830323214e-01   -4.145433338181633e-02; -1.741462031106823e-01   -9.060514725882673e-02   +4.980341255612113e-01   -2.748066344702709e-01   -4.858154189145979e-01   +8.075347639630139e-02   -7.051013570149842e-02   -7.240751770768258e-02; -1.836042304263696e-01   -1.852172695164805e-01   -2.029494917780388e-01   -4.123041919204309e-01   -1.483560625797458e-01   -7.153348703850089e-01   -3.769847383567521e-01   +2.381188106600668e-01; +3.976202622561908e-01   +6.752112120912428e-01   -5.784018453929070e-01   -3.052312072186189e-01   -2.778450945995497e-01   -5.768561715779932e-01   +4.230421996066437e-01   -1.649715660503056e-02];
L1E_L2E_iAMPA_netcon = [-3.875373074729497e-01   +5.495519394148027e-01   +5.895962598654377e-01   -5.935858050245439e-01   +2.445458153381599e-01   +2.654214598057129e-01   -2.869044117525257e-01   +2.114035886966567e-01   +6.314582127237760e-01   +6.699701690990191e-01   -1.099519192193678e-01   +4.651451827587909e-01   -6.059763235732346e-01   -4.483504970995342e-01   +2.662665871793106e-01   +2.094664373826426e-01; +1.107523754866166e-01   +5.019929706271931e-01   +4.996086524396134e-01   -9.085040729005683e-01   +5.254841008825191e-01   +8.595408253618766e-01   -3.990038150917087e-01   -1.840956568767641e-01   -1.919082619140966e-02   +5.949355396377250e-02   -3.675681009942745e-01   +3.126472944333543e-01   +5.888410841604496e-02   -3.361446006922845e-01   -1.794808494722590e-02   -4.665278149631931e-01; +5.768252742659642e-01   -6.103049542686417e-01   -1.825988148456812e-01   -5.423733029661634e-01   +2.467777026452243e-01   +7.311145051555450e-02   -3.672468444059326e-01   +3.220958725969952e-01   -5.285829677836672e-01   -3.185098140750778e-01   +1.071973337674716e-01   +2.702730750441080e-01   -1.587406236422086e-01   +4.719079373487224e-01   -1.000000000000000e+00   +6.912412626525564e-01; +3.125190036468757e-01   -2.804488903894860e-03   +1.738833712728755e-01   -4.348252933774976e-01   +2.711289746261207e-01   -1.877413483746412e-01   -3.100059642646928e-01   +2.473949039872564e-01   +5.444570820345238e-01   +2.427657734739334e-01   -5.436373491918383e-01   -9.035741204130536e-01   -1.989961236814838e-01   +1.722243869649237e-01   -5.530479936874299e-01   +5.368210796933869e-01; +1.856245138547183e-01   +5.055020717954901e-01   -4.348714917094047e-03   +2.830651570988359e-01   +3.864843317024234e-02   +1.096409566668844e-01   +4.230561239324965e-01   -2.724908905437807e-01   -4.112784429644236e-01   -2.112628775484872e-01   +7.582173833548363e-01   +7.481767721210636e-02   -9.168843799384249e-02   +2.087399679784781e-01   +5.492122646177428e-02   +1.049004771922425e-01; -5.052142462381341e-02   +7.841716857441412e-01   +3.244166930118131e-01   -2.542927812315513e-02   +6.968377626462241e-01   +4.699813344460821e-01   +6.062169204310167e-01   +3.587181231631559e-02   +2.050379006037928e-01   -2.328892115417021e-01   -1.725941297520900e-01   -2.342820522229914e-01   +4.256449377110516e-01   +1.926847623035654e-01   -7.218132104223954e-02   +2.780219856184599e-01; -2.071852861717620e-01   +1.096543200915791e-01   -3.883583588126795e-03   -1.506381726245944e-01   +1.263032202265667e-01   -5.373794326461466e-01   -4.318479767474402e-01   -7.156954900947828e-01   +2.977500681202129e-01   -5.379145525246737e-01   +1.271732158820788e-01   -7.385468152746713e-02   -7.207438575436649e-01   -1.391562231626343e-01   -4.616719564614049e-01   +8.473072543559624e-03; +1.746828689993860e-01   +3.228032439684148e-01   +8.169756433425208e-02   -3.365958219022031e-01   -9.516605857015840e-02   +7.580220767206158e-01   +3.024839887482106e-01   -5.416806653934754e-01   -1.853628271348232e-01   -7.542071716258533e-01   -6.423668991070361e-02   -3.737854985085126e-01   +4.533828512816884e-01   +2.533508575664149e-01   +1.971267831408712e-02   +3.123787483077623e-01];
L2I_L2E_iAMPA_netcon = [-6.590433056430739e-01   -5.493735158869979e-01   +1.291445268976094e-01   -3.485732247940083e-01   -1.569328258128380e-01   +4.740700136303951e-01   +6.049986948212566e-01   -1.806594079361218e-01; -5.452832631786625e-01   -8.688976301276206e-02   +8.893376856241395e-01   -2.253826886401461e-01   -4.151231890552914e-01   -8.679010781694717e-02   -8.114149899884038e-01   -3.767214703939113e-01; -3.872756757551363e-02   +1.611325388723023e-01   -7.230558391773603e-01   +1.044716696580996e-01   -2.667951129248439e-03   +7.289243011486970e-01   -2.130370655416097e-01   +3.129214574031798e-01; +8.404688644412712e-01   +2.429733159467260e-01   -3.588847644833243e-01   -8.978097877425009e-01   -5.773383820147820e-02   +5.304276421359010e-01   +3.658103834569432e-01   +5.438305100900390e-01; +8.036697739276085e-01   +5.077774605520596e-01   +1.137672788777336e-01   -1.121053601089372e-01   +6.187113384812688e-01   -1.589777008997021e-01   +3.364410480143877e-01   -3.731716151351522e-01; +8.335979785987838e-02   -2.427975651024663e-01   -4.356998501875002e-01   -2.906624880800773e-03   +2.370104219975727e-01   -6.968144707228848e-01   +6.723035342410528e-01   -8.798123795997088e-02; +2.519765414615907e-01   -1.000000000000000e+00   +2.332578342895874e-01   -2.777265477073343e-01   +1.785616147585961e-01   -4.786267770760131e-01   -6.684238834295836e-01   +3.306921435142405e-01; -2.310249720733965e-01   +5.534641180843897e-01   -2.169292925270575e-01   -2.268716421122148e-01   -9.499493092578717e-01   +3.999102638597075e-02   +5.583742457188902e-01   +1.870998797220323e-01];
L2E_L2I_iGABA_netcon = [+2.353299673860187e-01   -9.156069354402436e-01   +3.915744618063748e-01   +8.256083399107476e-01   +3.495281620793349e-01   +2.144416822617971e-01   -6.500467824536554e-01   -4.812289707021108e-01; +3.080296958784387e-01   -1.741006365932917e-01   -5.244883600675614e-02   +6.743684369816567e-01   +2.383194182770432e-01   -2.976122612122753e-01   -2.161080547735736e-03   +1.172076143779022e-01; +6.245325208106187e-01   -6.379827663551995e-01   -3.125480995558146e-01   +6.266314854202014e-01   -6.789820863283862e-01   -7.281284259096532e-01   -2.160322051994420e-01   +1.320471182787739e-01; +5.706729121820463e-01   +1.488903286369418e-01   -1.571097770761851e-01   +2.121388061577529e-01   -1.701639562164418e-01   +3.143530839930005e-01   -2.181305430456676e-01   -1.740167835242280e-01; +7.047199577485873e-02   +2.325068587275584e-01   -1.233509663703030e-01   -1.187307879444899e-01   +5.607555652050448e-01   +7.781254322940252e-01   +6.436995967293311e-01   +7.014958083660773e-01; -1.166827320810862e-01   -3.236666917603085e-01   -9.605494799206134e-02   -1.000000000000000e+00   -8.347383936479471e-01   -4.622455788108604e-01   -2.466212024917617e-01   -3.680278853902317e-01; -7.236633601267899e-01   -7.092934693945793e-01   +2.439090600526901e-01   +9.509561604205204e-01   +3.228277612260046e-01   +3.223539932003928e-01   -7.299050563641464e-01   -2.992689662235280e-01; +1.829639090969452e-01   +5.583576698818328e-01   -5.449775714262523e-02   -2.568818570537236e-01   -2.036476398858399e-01   -7.591311823336963e-01   -1.879394156252452e-01   -1.337292867912726e-01];
L3E_L2E_iAMPA_netcon = [-3.237932420005176e-01   +1.000000000000000e+00   -7.466614722066503e-02   +1.134922528363702e-01   -1.696334628287202e-01   +5.780619175696654e-01   +7.425066443607395e-02   -4.948618199539235e-01   +7.501631219929176e-01   -5.128840228185013e-01   +4.097616950920076e-02   +2.746308281628803e-01; +1.579541193680790e-01   +7.337354564650209e-01   +3.920024785913173e-01   +4.159886615674268e-01   +6.576146996794062e-02   -3.670996997081014e-01   -3.034075639604253e-01   +7.416428099228876e-01   +2.651745601754314e-01   +2.669661975189077e-01   -9.314736763513334e-01   -4.427152226074555e-01; -1.351561062317713e-01   +1.078577122687453e-02   -3.807849854982634e-01   +1.547009927248263e-01   -3.547535353219364e-01   +8.204208682390416e-03   -1.846720106696186e-01   -6.847119005530325e-01   -4.307770440497587e-01   +1.305357624950694e-01   -7.999522344908716e-01   -5.533446331243029e-01; +3.483034959353688e-01   +2.688033230407203e-02   +2.747357316489369e-01   -6.771593217659992e-01   -2.921848716813295e-01   -4.171470480175626e-01   -6.400164974857522e-01   +3.550565252507912e-01   -5.042656763467649e-01   +4.058105235512789e-01   +4.960854026331267e-01   +1.296230841465355e-01; +2.284380066740629e-01   +6.189047896452891e-01   +3.100786228008005e-01   -1.013385701959474e-01   -2.807714732534454e-01   +1.940887374118067e-01   -1.590081462708566e-01   -1.683799111840950e-01   +7.128786685734013e-02   +5.268331260526811e-01   -4.021522358098218e-01   +6.309487726219839e-01; +2.285505161653059e-01   -2.706657170210954e-01   -4.216818741739315e-01   +2.259262034032935e-01   +4.494018027955586e-01   +6.891910770267115e-01   -2.153865311039880e-01   +3.784043106056854e-01   +1.641889162884753e-01   -6.204765526549954e-03   +6.693791518124541e-01   -6.198619807608411e-01; +7.065736715901968e-01   -3.590325200419303e-01   -1.688130196026999e-01   -8.433518443059675e-01   -3.281090294141195e-01   +1.039988285686438e-01   -6.912607534743674e-01   +3.109936526000648e-01   -3.721643008733314e-01   -4.913421720661635e-03   -7.743056555020360e-01   +2.951749988323906e-01; -4.785964201024008e-01   +5.954654053959834e-01   +7.034518781810139e-03   +1.319397982137955e-01   -2.985817389032683e-01   +5.939442693442797e-01   -5.139740990520821e-02   -5.237581959769316e-01   +6.067393893026660e-01   -7.238722866007961e-01   -8.098572797009645e-01   +2.316623954815220e-01];
L3I_L2I_iGABA_netcon = [+5.746081091231093e-01   -4.267771500466719e-01   +2.376872464995092e-01   -1.000000000000000e+00   +8.211047251845536e-01   -5.212796288644057e-01   +1.237697176476111e-01   +1.426035226049370e-01   +5.617301712370328e-01   -5.114941883250855e-01   -7.036064737453065e-01   +3.783033383439446e-01; -1.962559873595969e-01   -6.534335026338953e-01   -7.622664267133639e-01   -6.695421383316802e-01   +5.337834616143659e-01   -5.911700613515639e-01   -2.885360480417669e-01   -5.852776543049498e-01   +9.308654339306293e-04   +5.379615938325892e-01   +6.982864466963936e-01   -5.876903682274387e-01; -6.786679588139604e-01   -1.865962247114376e-01   +8.865008810893239e-01   +3.368802495756871e-01   -3.822741825296133e-01   -9.425583259922935e-01   +3.923982186840980e-01   -3.845081604204848e-01   +1.572284955029375e-01   +5.698079490738361e-01   +9.561190108921581e-02   +4.725256749806986e-01; +3.365823846288160e-01   -5.053709254572357e-01   -7.574012023085168e-02   +6.117880332737774e-01   +3.315016151759223e-01   +5.457997667554401e-01   -2.447553509686757e-01   +5.999528665726155e-01   +4.163157828594377e-01   -1.264157930118653e-01   +1.856161705805658e-01   -9.728411468516246e-01; -2.913998210663492e-01   -4.729365674302818e-01   +6.925347661760872e-01   +6.168568488981859e-01   -2.318373593020551e-01   -4.115600352057491e-01   +1.121260718527730e-01   -2.291967026636567e-01   -3.657125491621508e-01   +4.790097168306285e-01   +5.328879289583983e-01   -4.963523998278275e-01; +4.812949277055105e-01   +7.854555871082444e-01   +6.297012986324399e-02   -7.308994356220697e-01   -9.140644671017063e-01   +8.965014423561216e-01   -5.090457186486593e-01   -2.492977093090512e-01   -5.385722878963045e-01   +2.714150452519632e-01   -4.974374543936521e-01   +1.553672263118441e-02; +2.888513390154266e-01   +5.569045925478566e-01   -1.043854569355776e-01   -6.231048030980761e-01   +4.834135355856153e-01   +1.150786732413462e-01   -7.877886204791380e-01   -5.613602147191094e-01   -5.033176554625098e-01   +5.874018843288125e-03   -7.522847704562899e-01   +1.608396796937935e-02; -5.280821691697170e-01   -2.270455075377746e-01   -6.088471696241228e-02   +1.831854524781149e-01   +1.969643426985216e-01   -1.225462866920596e-01   +3.660214566683775e-01   +5.254059476630467e-01   +3.922006267397092e-01   -1.711292729077233e-01   +2.016633479060096e-01   +4.797733813061960e-01];
L2E_L3E_iAMPA_netcon = [+5.014610128819078e-01   +4.212077052694252e-01   +3.455751862319784e-01   +6.460644201052300e-01   -5.694935100007937e-01   -3.140546285226695e-01   -1.402395864391109e-01   -7.729488782118898e-02; -2.608406594033021e-01   -3.236636871678524e-01   -5.516539961673975e-01   +4.168612013965441e-01   -1.829101853663204e-01   +1.361176411902822e-02   -1.899174500114451e-01   -5.551189796425902e-01; +2.297342215853648e-01   +5.322379320360509e-01   +6.216141568927150e-01   +1.182590343063358e-01   -3.617407016543744e-01   -5.772746693364754e-01   -2.838492010398137e-01   -6.069811186383124e-01; -3.420895420941470e-01   -1.291531632203189e-01   +1.709756538946447e-01   -8.545483327807916e-03   -1.530409428955263e-01   -8.212292203907667e-01   -6.424537708769812e-01   -4.595582408445064e-01; +2.733442326230540e-01   +1.605865368902256e-01   +5.797898771047805e-01   +4.025069197636341e-02   +5.250146530207627e-02   -6.783722135315490e-02   -8.573301225571893e-01   -2.514760516613840e-01; +6.246766938983273e-01   +1.430177667770189e-01   -2.920860174107550e-01   +5.771521374235816e-02   -3.312908163131026e-01   +4.664040883032823e-01   -2.649887191352594e-01   +3.383072622186024e-01; -4.488295424095370e-01   +3.968945598405002e-01   +3.323473058167075e-01   +3.904289767771782e-01   +6.324256509566611e-02   -1.410531932616222e-01   -6.931583839200894e-02   -6.696260374137980e-01; +4.417102268383384e-01   -9.369065545575428e-02   -7.601354181754851e-01   -4.881172453243547e-02   +1.388645540167146e-01   -3.604435516265287e-01   +5.052216232640764e-01   +2.134653200597656e-04; -3.736836456176314e-01   +5.195949414567800e-01   -1.698484749731807e-01   -2.070367531550218e-01   -5.185805457867627e-01   -7.280841226329532e-01   -1.000000000000000e+00   +3.053653335564288e-01; +2.060707199754575e-01   -6.603024115811036e-03   +2.286594185750768e-01   -6.494802821073610e-01   -1.490213612547619e-01   +5.499066758814202e-01   +2.503804309390127e-01   -1.776623966589971e-01; -4.138239197043626e-02   +1.708620210545491e-01   +1.485069215531146e-01   +5.050221341537994e-01   -4.085162068301809e-01   -2.394486350644552e-01   +7.472773099479643e-01   +1.630239153568112e-01; -9.298169342544972e-01   -1.443771524190907e-01   -8.136890952995310e-02   +9.834254651505279e-02   +7.879399898062840e-01   +2.120577139572936e-01   -1.979202890835674e-01   -6.383034438894802e-01];
L2I_L3I_iGABA_netcon = [+1.788810493016375e-01   -8.466544837521308e-01   -3.232080719768311e-01   +2.804153201293880e-01   -8.794257613003488e-01   -3.388080380976082e-01   -5.772139028820643e-01   -3.288955902272457e-01; +5.441623139358279e-01   +4.752159234752054e-01   +5.603942877213035e-01   +1.000000000000000e+00   +1.685914305683458e-01   +1.154381994441138e-01   -4.899325334251758e-01   +5.770026447911578e-01; +5.549365849195016e-01   -7.115627974624135e-02   -3.413385989194057e-01   -1.196164924707001e-01   +3.013357026760605e-01   -1.012437798811956e-01   +4.234993369288122e-01   -3.367296982336653e-01; +3.108867752912632e-01   -4.416863486962103e-02   -3.796424436063187e-01   -1.356618897843807e-01   -1.627408760543679e-02   -7.360885942007273e-02   +4.878371958250517e-01   +6.630527653834076e-02; -2.465517526525399e-01   -3.171822556351109e-01   +1.992436880509826e-01   -3.053298117917992e-01   -5.868927971865512e-01   -1.121157169977567e-01   +3.909511745153471e-01   -1.280807183987330e-01; +2.495591748237371e-01   +9.836631078139593e-02   -9.465699744013303e-02   +4.276835125197371e-01   +6.341770727746614e-01   -5.634794496467391e-01   -4.080540258823264e-01   +9.607071990296610e-02; +2.201824474715943e-01   +3.680112160144490e-01   +2.165308974563051e-01   -2.009700675626989e-01   -1.594979486813050e-01   +2.896308780464451e-01   -1.351996165029372e-01   +9.643894010895903e-01; -8.407652875957097e-02   -6.111483622835696e-01   +6.373623157491562e-01   -4.254738529061426e-01   +6.511337861406211e-01   +5.540040665161428e-02   +4.136667307502188e-01   +6.502648209677294e-01; +5.865269410152764e-01   +8.246080034813810e-01   -4.470449010501401e-02   +2.461559751536718e-01   +6.414754753055208e-01   -1.492672219596085e-01   -3.789945491418125e-01   -2.546587596412370e-01; -4.502337125704302e-01   -1.379286931604533e-03   -6.697316279451870e-02   -3.226831527228418e-01   -2.852684163137429e-01   +7.375371433016241e-01   -1.681124127504254e-01   +1.387719261787727e-02; +2.430406914180510e-01   +2.958451529518878e-01   +5.910337371485158e-01   +6.227454680390923e-01   +2.431338204773522e-01   +2.254317326451330e-01   -7.681920057977353e-01   -4.509240388648499e-01; +5.076889981923497e-01   +4.413583017461776e-01   +1.832331574569485e-01   +3.085308869342076e-02   +1.246919561135354e-01   -3.655088353733720e-01   +5.905864429171014e-01   -3.162597406325759e-01];
L3I_L3E_iAMPA_netcon = [-4.396105613692701e-01   +6.871901679691017e-01   -4.142689807369950e-01   -3.938330671370281e-02   -6.081855889771707e-01   -5.251695651974236e-01   +6.935685082362103e-01   -1.940136216797626e-01   -1.598207238169637e-01   +4.385622315473799e-01   +9.966953284140323e-02   +1.498057800940465e-01; +1.926492674888157e-01   -2.291861045523215e-01   -2.631222456400918e-01   -9.154548991753554e-03   -1.400203157413990e-01   +1.758035117322357e-01   -2.247676845620238e-01   -2.643809005841876e-03   +3.385714800004270e-01   +1.346825244964986e-01   -4.767566879465368e-01   +4.919555892126886e-01; +3.067325518792701e-01   -2.962658610915197e-01   +2.024726280444206e-01   -1.861321889239971e-01   +1.612942867488278e-01   +5.716521616280300e-01   +4.460686680840908e-01   +1.218820051522607e-01   -2.527607240151994e-01   -6.738766199148581e-01   -7.659248410667785e-02   -1.352389649466469e-01; +8.934795069799002e-02   -1.843224830853440e-01   +1.000000000000000e+00   +5.592079300723473e-01   -4.829461672583430e-01   +6.554605759377015e-01   +7.623129863726108e-01   -8.164469951859685e-02   +4.856881385562065e-01   +5.708379611647632e-01   -4.711789732023096e-01   +8.226149961663781e-01; -1.106242399024672e-01   +4.146881402595497e-01   +2.586858943614276e-01   +6.238118168987717e-01   +3.218142547455213e-01   +1.431678839113361e-01   -2.424599137603735e-01   +9.222033129300587e-01   +3.510309330285995e-01   +2.882310277273203e-01   +1.335762564438839e-01   +5.015764191699203e-02; +5.301650085928408e-02   +4.911271693394695e-01   +2.768255530613960e-01   -1.072441693481957e-01   +6.543188286789948e-01   -4.310468299872425e-01   +1.286475305505821e-01   -6.295006880558969e-01   -5.112229390377328e-02   +5.786123410706911e-02   +6.144333373569028e-01   +2.227630728127497e-01; -1.384246654287403e-01   +2.835362339027278e-01   -3.981376037749128e-01   +8.621346745633168e-01   -4.350157032570665e-01   +4.045649174574796e-01   +1.640424716997917e-01   -4.421457823994963e-01   -3.533973275344981e-01   +6.654028750514082e-01   -2.864027222694685e-01   -3.840221358658370e-02; -6.841688805774649e-01   +4.628233047430121e-01   -5.080014931081450e-01   +1.952300751883052e-01   +5.544097736476309e-01   -7.010966735287150e-01   +4.979710000129702e-01   -4.428012841362651e-01   -5.091852769742832e-01   +3.085162701475659e-01   +7.028340884757236e-01   +4.787291780818790e-01; +1.564505387254313e-01   +3.077867757841156e-01   +5.294837481522359e-01   -3.861061192703199e-01   -1.860973098033243e-01   -2.302425562777910e-03   -5.783126720603605e-01   +2.098438167284088e-01   +3.443983940838199e-01   +2.087981270234947e-01   +3.730840028417354e-01   -3.833662691663653e-01; +1.973546401525965e-01   +1.887852289992927e-01   -5.273239735442070e-01   +3.258441622929484e-01   -6.955409168217542e-01   -4.786354197436516e-01   -1.808699243507407e-01   -5.152289015934318e-02   +2.426798199424107e-01   -3.554891348819785e-01   -4.751090602594785e-01   -4.983919639697365e-01; -3.864614768581059e-01   -3.667090024660089e-01   -4.617633998954710e-01   +6.029256312675761e-01   +1.499870913330452e-02   -5.731552763104935e-01   +2.816287097100667e-01   +8.730726395878239e-01   -3.200063136051727e-01   -2.602823407297966e-03   -3.641953724610376e-01   +3.211851045779971e-01; +6.262072101211340e-01   +2.617716634225664e-01   +5.655524670955503e-03   +2.144413798453019e-01   +2.818478890146106e-01   +8.373596572689208e-01   +5.010463472968769e-02   -2.631403052206721e-01   -4.291420974307805e-01   -4.233488241634943e-02   +5.799785354024259e-01   -6.612055710926380e-01];
L3E_L3I_iGABA_netcon = [+2.251880764947694e-01   -7.406197825574736e-01   -6.000707858475998e-01   -5.390134060874727e-01   +3.024096693471067e-01   -5.605421710616392e-01   -1.739606171860966e-01   +2.867082393993614e-01   +4.593558256893160e-01   +1.848059608861227e-01   -5.796477613882739e-01   +7.554345123795583e-02; +4.814677724792542e-01   -7.893484145255644e-01   -1.204131511991510e-02   +5.120839440259870e-01   -6.717394995560448e-01   +5.655145723267347e-01   +5.511076075416376e-01   -4.829528517547936e-01   +2.377804210181290e-01   -6.030523099884033e-01   -6.097251569705101e-01   +7.209287803359219e-01; -4.069257667693247e-01   -4.446840019403050e-01   -1.125853181741611e-01   +1.450611307257364e-01   -1.443188958530960e-01   +5.479782112435827e-01   +4.257995837386675e-01   -2.456769024617561e-01   -4.537336877805183e-01   -1.162538107956498e-05   +1.626050706679970e-01   +1.073453640592706e-01; +2.146725533936265e-02   +1.549903442188416e-01   -4.055467913833011e-01   -1.677619473706796e-01   -4.482555553409451e-01   -4.553917307194116e-01   -2.401998721324046e-02   -6.629828760993370e-01   -4.324113623298192e-01   -5.300512797157968e-02   +2.704925671049570e-02   -7.086791309822624e-02; -1.571176056589051e-02   +5.232015447869586e-01   -3.242199966154457e-01   -1.444303746952743e-01   -4.413274967791293e-01   -1.462052837805918e-01   -5.581714346386137e-01   -5.050781134064057e-01   -5.661395412313001e-01   +8.341334294237216e-01   -1.794552588344506e-01   -2.879070980761771e-01; -2.157685842039853e-01   -1.583198247926692e-01   -6.566012828902161e-01   -8.699949496036853e-01   -4.937404953879589e-01   +4.119769339651521e-01   +8.586211608225697e-01   +6.858762903434388e-01   -4.019906321976279e-01   -6.008541784815949e-01   -3.545438820317944e-01   -1.571846448478408e-01; +5.972747601608422e-01   -4.457474988945160e-01   -2.393710362836107e-01   +3.914487536124934e-01   +8.599651890060095e-02   -4.994878674445135e-01   -6.580886970719582e-01   +7.810298086701319e-02   +3.812496338223857e-01   -1.298487224993797e-01   -5.432880313009670e-01   -5.054558905742748e-01; -2.196157576726795e-01   +3.981790661138770e-01   -2.047232233609065e-01   -7.292307306465912e-01   +2.616779058051196e-01   -2.946071926041191e-01   +9.543930237745195e-01   -1.823269533409468e-01   -8.038809929584112e-01   +3.103777494272175e-01   -4.764434791483512e-01   -7.995342323366497e-01; -1.867398345916821e-01   +4.918921679576682e-02   -4.315420484116166e-01   +4.675384941106460e-01   -4.964082974490805e-02   +2.047449116022414e-01   -4.144295531241405e-01   -6.209970516564817e-01   +6.028053773562314e-01   +9.969819069951738e-03   -2.558649683058621e-01   +3.449562573406033e-01; -1.646311390347059e-01   -5.683724062173666e-01   +4.153312931300639e-01   +8.919999724770670e-01   +3.691967970806128e-01   -5.886916241348035e-01   +4.850902407191517e-01   -3.419118918190876e-01   -3.635239283017607e-01   +4.364623528548670e-02   +1.261373547898383e-01   -3.805966342284721e-01; +5.043222096931234e-01   +3.128489826311881e-01   -6.183703630999812e-01   +9.501586397987386e-01   -2.074975083596890e-01   -5.714554149305784e-02   -1.000000000000000e+00   +8.571597851045780e-01   +3.932631694905042e-01   -8.061207719190954e-01   +1.811778728767285e-01   -4.799844026063222e-01; -1.050107648853941e-01   -5.942402912772065e-01   -2.611166614621402e-01   -4.921896830335837e-01   +3.558947427159369e-02   -5.845860644501898e-01   +7.431461244950835e-02   +3.561876952808845e-01   +7.625697566610509e-01   +5.855431970906998e-01   -8.302268912417625e-01   +6.092170794828534e-01];
L2E_Input1_iAMPA_netcon = [+1.864897896987628e-01   -6.160814514211683e-01   -6.892101564086650e-01   +4.625065257678387e-01   -7.110551888056240e-01   +4.190754763873713e-01   -2.412611618141504e-01   +1.000000000000000e+00];
L2I_Input2_iAMPA_netcon = [-4.819502347733817e-01   -2.648381801472601e-01   +1.191668763475161e-01   +3.898646865267041e-01   -8.494619818579933e-01   +4.333484235917733e-01   -1.758239025397102e-01   +1.000000000000000e+00];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.4*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 1.0*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 1.0*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.4*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 1.0*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 1.0*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
