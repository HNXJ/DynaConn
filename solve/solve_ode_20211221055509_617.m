function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+2.791202668517071e-01   -3.436931019619657e-01   +9.587293947061086e-01   -1.329374423018590e-01   +1.261676899438910e-01   -1.135276852190091e-01   +3.144452188565260e-02   +6.912389389678913e-01   +5.722817330503822e-01   -1.254529674399763e-01   +8.229091806164020e-02   -9.904625263928619e-02   -3.313151335056325e-01   +1.260871839708649e-01   -4.841390023220574e-01   +5.064729716015584e-03; -2.726729960979724e-02   -4.107581984673533e-01   -6.672086725141423e-01   -1.339521115646699e-01   +2.139878234174590e-02   -3.737492636852745e-01   +3.956368198389097e-01   +1.483447884626192e-01   +3.231623058067240e-01   -1.466942152516473e-01   -1.073627003971646e-01   +9.954643744335416e-01   -3.910561894890476e-01   -6.839550324208966e-01   -4.099595778517052e-02   -5.215185951254225e-01; +2.086805466169036e-01   -7.980572429844836e-01   -3.528625479632931e-01   +8.513946498652691e-01   +2.646766091672746e-01   +2.922234374888148e-01   +5.192503697439367e-01   -7.735445204029365e-02   -4.860659681439808e-01   -3.923662421462095e-01   +5.346433710593328e-01   -5.320723686000265e-01   -5.669434506427963e-01   +3.448494773692393e-01   +3.880772848493628e-02   -2.501402063870547e-01; -2.595644030894803e-01   -3.326212606676330e-02   -4.091047243004852e-01   -1.268041434409914e-01   -2.908017073637122e-01   -5.519833931666208e-01   +6.005908252666523e-01   -2.603239011889640e-01   +8.327759758745109e-01   +1.722814855375205e-01   -1.311912959328418e-01   -2.651925601797809e-03   -2.108033157796374e-01   -1.808947320855836e-01   +3.017040796596834e-01   -5.263421631536921e-01; +4.025763234920742e-01   +2.795354523218804e-01   +7.382292579074444e-01   +1.000000000000000e+00   -3.046861360887395e-01   -4.627952395512264e-01   -5.704994515118893e-01   -1.453808183134723e-01   -1.925346212276698e-01   +4.721044817453869e-01   -1.846916517318013e-01   +9.681198167549750e-02   -2.576743728059354e-01   -5.507337676174837e-01   +4.732658715779360e-01   +7.853015895928467e-01; -3.634818988977732e-01   -5.790691211485909e-01   -1.041057946169779e-01   -3.510733659914152e-01   +8.516374421938073e-01   +4.287934335372696e-01   -3.327510380236833e-01   -5.526725651475237e-01   -3.083132550511479e-02   -4.156593417614404e-01   +4.480630946002138e-01   -2.725140860299455e-01   -3.209575929277117e-01   +1.746313782149949e-01   +3.401610144486868e-01   +3.637439938561772e-01; +3.661203957356994e-01   +1.270283987792968e-01   +2.172794418808569e-01   +3.875333834426333e-01   -1.269984830217869e-01   -5.739032883827841e-01   +4.005904044731725e-01   +6.411942213773439e-01   +1.963183192694696e-01   -4.602058942342547e-01   +8.384764595103764e-01   +1.382087326553848e-02   +4.927568067454643e-01   -6.128104570027725e-01   -4.622992358947001e-01   -4.109523884680683e-01; -5.172962356054417e-01   -9.507306992988040e-02   +5.536013491346076e-01   -2.632689878776974e-01   -9.865897178021343e-02   -8.413902043943801e-02   +2.777325402990971e-01   -8.620640260404536e-02   -1.918250330851811e-02   +2.059059930874297e-01   -4.659418149792652e-01   +2.585236589349034e-01   +1.536919174177025e-01   -1.426458314644401e-01   -2.000806285801826e-01   +4.681374302758783e-01; -2.216120000450681e-01   -1.440184509687717e-01   +1.051165581485833e-03   +1.992934043313445e-01   +8.686138918304352e-02   +5.044070594494343e-01   +8.536881629145503e-01   +6.629253152978123e-01   +2.459749031191053e-01   +5.025882167608993e-01   -1.601520629095941e-01   +3.557592464648689e-01   -1.190862931680959e-01   -6.351001205495415e-01   -2.781352393822124e-01   -1.323620669679089e-01; -1.343629821964984e-01   +4.212239153478174e-01   -3.160199571320385e-01   +4.932860763597989e-01   +2.725376129793703e-01   +4.600532805777164e-02   +9.253047204819384e-02   -1.617579897841580e-01   -2.686249930888467e-01   +3.416244553847694e-01   +2.564678114838557e-01   +3.665197762202082e-01   -6.752562799331675e-02   -5.915716427056925e-01   -3.104945088589836e-01   +7.035039290451216e-01; +5.196781073483469e-01   +3.178059455924579e-01   +7.107060931319249e-01   -3.885493843061141e-01   +3.627829607087898e-01   -3.067965790600102e-01   +8.062154567929529e-02   -7.310547257513863e-01   +2.677725260947574e-01   +1.023352641701766e-01   -2.758328909018500e-01   -6.257220115393912e-02   -1.909301705154265e-01   -1.627668141314355e-01   +1.849594244969327e-02   +5.135442648954922e-01; +3.774610069974983e-01   -7.897749348434768e-01   +2.918075301527887e-01   +1.828743834925343e-01   -2.478594834636958e-01   -4.176144635049995e-01   +3.546760541428728e-01   -3.080288772542420e-01   +1.223494383705931e-01   -6.632048726496087e-02   -4.360703387442253e-01   +4.892538094562870e-01   +7.721333537700692e-01   +2.600726755394361e-01   -1.570492986432184e-01   +3.078532661043128e-02; +1.292728628670842e-01   +4.957094849294030e-01   -2.715241087698719e-01   +2.279848931813246e-01   +4.112715794181235e-01   -3.792198110939997e-02   +9.722410170863065e-02   +4.953408028367053e-01   +4.146713876744234e-01   -1.624828783982468e-01   +2.449318657326082e-01   +9.376172461355987e-01   +4.036780390695917e-01   -6.296917604236185e-01   +4.793358058090923e-01   +3.653236117123899e-02; +3.377480022878399e-02   +5.113431443264633e-01   -2.659706048957429e-01   -4.468841985172763e-01   -4.152158850971557e-01   +2.662794426341509e-01   -6.695866905190362e-01   +3.557961991998118e-01   -7.599846220179600e-02   +9.446382060515452e-01   -1.048666450029957e-01   -5.856394786892645e-01   -2.082973669429677e-01   +4.106452864066589e-01   +3.644813132670916e-01   -5.617297696775367e-02; +7.438638830768271e-02   +1.444138218571903e-01   +8.794185163945542e-02   -5.863366292851347e-01   +1.728867021777857e-01   +1.748757043784427e-01   -2.687898497192154e-01   +4.705598504861733e-01   +6.585275216755803e-01   +1.671100275917669e-01   +5.717525186342131e-01   -7.230126800892887e-02   +9.521805086137498e-01   +4.316693464393883e-01   -2.794215720091844e-01   -5.034739519327081e-01; -2.513604969349208e-01   +5.939195775656636e-01   +1.362966511271221e-01   -1.788239060266719e-01   -5.964474001312132e-01   -4.535532162478024e-01   -4.042455001991191e-01   +2.755911407344827e-01   +2.307734714540126e-01   +3.868123237516484e-01   -1.589017249231831e-01   -5.399396938801639e-01   -2.239784279013785e-01   -2.709150464830860e-01   -2.654915042377765e-01   -1.300279958878006e-01];
L1E_L1I_iGABA_netcon = [+1.406040692907456e-01   +7.209114240773405e-01   +5.189248834187979e-01   +2.468764396984449e-01   +2.006783481592370e-02   +2.592986389933921e-01   -8.053689672002644e-02   +1.000000000000000e+00   +2.221199080807284e-01   +2.235669566443597e-01   -1.703822713895715e-01   -6.763796247795412e-03   -9.746122492744863e-02   -1.819345917901502e-01   +5.717931740571506e-01   -9.009663292729414e-02; +1.652280832127675e-01   -6.597287563317277e-01   -4.223453060760114e-01   -1.953236113290796e-02   +3.707239736167764e-01   -3.437036371913237e-01   -4.785509994003505e-01   +3.718797016150487e-01   +4.137006889785651e-01   +3.693887051071217e-02   +5.471402618244765e-02   +7.058736867415539e-01   +5.545538392935786e-01   +3.950134068522714e-01   +8.081709423305424e-01   +2.940897610373101e-01; +3.180343260823111e-01   -9.466580433666151e-02   -2.837720646752301e-01   -9.329357729010317e-01   +6.904441020520748e-02   -1.425180112460760e-01   +6.828573115406165e-01   +7.036919381815941e-02   +3.584388029598115e-01   -5.749412716618035e-01   +2.622964115808131e-01   +3.278696160561108e-02   +3.443373595159919e-01   +3.360057954296754e-01   +8.335670738924175e-02   -1.004252483003864e-03; +9.395778813742309e-02   +8.389958935916364e-01   +8.952247119068394e-01   +2.978548193217978e-01   +1.003003585147539e-01   +1.158491184646237e-01   -1.028500372966481e-01   +5.833131401637393e-01   +1.501716152183039e-01   +9.854452818462749e-02   -6.468950357068448e-02   +2.753836679488521e-01   +5.338118630784225e-01   -5.861794567787419e-02   +4.510192608693627e-01   -4.131395835870164e-01; +5.191179268915728e-01   +4.833955411919669e-01   -6.892718658890028e-01   -2.444102521958283e-01   +2.792331957355556e-01   -3.996393071433711e-01   +5.191232517194554e-01   -1.430442629390288e-01   -3.439393243726667e-01   -3.457180289165605e-01   -4.695182026397713e-01   +1.124027053444897e-01   +5.994074040982933e-01   -2.062198503831764e-01   -2.968890853576297e-02   +1.701701308378451e-01; -2.454391919215187e-01   +7.070623945042186e-01   +2.746860181571865e-01   -1.926053198865106e-01   -1.815746024999832e-01   +1.346928237471808e-01   +6.858722079831600e-01   -5.234926176133003e-01   +1.440225312207671e-01   +1.733963599721615e-01   -3.605602355370133e-01   +2.036484871810254e-01   +2.101587449197307e-01   -5.227975659594747e-01   -4.209043740857576e-01   +4.524218570779976e-01; -4.296032278742966e-01   -1.588889153609935e-02   +3.490434538296024e-01   -6.610107452448587e-01   +4.350743440492680e-01   -2.707342575734070e-01   +2.562575759590937e-01   +3.836239234397337e-01   +4.618056639066405e-02   +5.396800104357239e-01   -5.702522197007950e-01   +3.275366028289426e-01   +4.561282200994536e-01   -2.496852749641350e-01   +8.033416439618603e-02   +9.148487587458309e-01; -8.149960233895838e-01   +3.677449696342420e-01   -9.496270606728272e-02   +1.167207501783273e-01   +4.162142294402408e-01   +7.170017486730988e-01   +2.878740998146775e-02   -1.142378058958757e-02   -7.459102256776851e-02   +4.402114891212056e-01   -1.251812435702557e-02   -4.307968319446119e-01   -4.461063782281190e-01   -3.208214130815091e-01   +3.484119384932790e-02   +5.822791045687735e-01; -8.125770401576017e-02   -6.002301285119622e-01   -5.459242381918357e-01   -3.908665674898996e-01   -4.673094170557428e-01   -4.418817607550750e-01   +4.887618457138502e-01   +2.271767670519353e-01   +1.703964093711234e-01   +1.726813514469441e-01   +4.322407585682291e-01   -1.718211078805801e-01   +4.268355233130214e-01   +5.781778142603545e-01   -5.325773636364146e-01   -4.090997098922747e-01; +1.432406274221325e-01   +2.662282022476556e-01   +2.599085568307357e-01   -5.784592232132345e-01   +4.457884893805238e-01   -3.518650853950505e-01   +7.312721816394475e-01   +4.426260037546790e-01   +1.064596107132660e-01   -2.541410115106018e-01   +2.528414904601274e-01   +2.859253319263333e-01   -2.248994938771157e-01   -1.180662868297573e-01   +3.925636376035163e-01   -3.879348266702421e-01; +6.882093172562176e-01   +5.969679475477506e-01   -4.094801915639538e-02   -5.316464499686006e-01   -4.972428685232145e-01   +6.077700954409695e-01   +2.787113967506482e-01   -3.155407643262376e-01   +4.410750668667349e-01   -5.554032424858718e-01   -4.397389380677811e-01   -3.654700284410963e-01   -3.540357839255810e-01   -1.709129117673822e-02   -1.794261651736430e-01   -5.570679214571091e-01; -3.697551942289865e-02   +1.380339574378672e-01   -2.675601319837513e-01   +7.609555228172544e-01   +4.893398379178017e-01   -7.514742309780491e-01   -9.869359271306516e-02   +3.289282105348303e-01   -1.000942875313825e-01   -5.380025569127209e-01   -3.866913899965840e-01   +7.289479027692605e-03   -5.061699181608761e-01   +4.573864173401876e-01   -2.897857621386231e-01   -7.229019577933453e-02; +8.859954765481207e-02   +5.348276964285317e-01   +3.717003516213357e-01   -4.948706853201268e-01   -3.504674471593574e-02   -6.696962844354102e-01   +2.683437800578464e-01   -3.576824890256322e-01   -2.268950897964429e-01   -4.389148583035814e-01   +5.014944463307306e-01   +6.023081922594091e-01   +5.980746034096050e-02   +2.372661800425641e-01   +9.220507758923190e-02   -1.478557275032692e-01; -3.371113176792368e-01   -8.607697139532701e-01   -1.557433053365150e-01   +4.898157649944905e-01   +6.012619547731100e-01   +1.988537218237997e-02   -4.956142371700314e-01   +1.139899653917445e-01   +1.748785056119873e-01   +3.752201568694838e-01   -6.310872123193022e-01   -1.905570660603162e-01   -2.449563686496301e-01   -3.989926491570009e-01   -5.726420881568314e-01   +1.918341868945637e-01; -4.580376277105065e-01   +5.726786600654334e-01   +8.265504008477208e-01   +2.746219282360730e-01   -1.470203926443328e-01   +1.395172590516854e-01   -2.409282887490952e-03   -3.422678811914844e-01   +6.476465298097892e-01   +9.123320964469996e-02   -6.746087893592659e-01   -5.497915258724725e-01   +5.409306898231131e-01   +3.938228852324214e-01   -5.178897304294136e-01   -7.995013157092262e-01; +2.429450362379081e-01   -2.770906244762502e-01   -5.327470037259804e-01   -5.549466914460311e-01   -1.664716223370016e-01   +3.293080272749606e-01   -6.737603226847203e-01   -5.942211115132709e-01   +2.901421347668689e-01   -5.026407063925219e-01   -2.809787132613488e-01   +1.805006727937109e-01   +2.282692671045851e-01   +4.042399683309896e-01   -2.784058471847128e-02   +4.054092916337815e-01];
L2I_L1I_iGABA_netcon = [-4.814891930688303e-02   +4.284770806660375e-01   +2.506570460544798e-01   -3.070527685219872e-01   +4.155853959222917e-01   +1.690234937451767e-01   -2.710022587960725e-01   +7.197578458477033e-01; +4.728170632343210e-01   -1.229979459954114e-01   +1.488177719576227e-01   -4.387631175492758e-01   +7.763162494152493e-01   +3.060448180785758e-01   +2.427862325090115e-01   -2.592481361028235e-01; +5.592140237579425e-01   -1.645829389827293e-01   +3.505907859127912e-01   +5.624425173128064e-01   -4.086727204583671e-01   +3.845216275184308e-01   -4.161698502420569e-01   -4.275168709021007e-01; -8.628409885787254e-01   -5.762633169612302e-01   +7.819238906813086e-02   -8.736144357602864e-02   -6.010972735740296e-01   -2.954022804354460e-01   +3.445369681543504e-02   -3.216980858402346e-01; -5.423563332066019e-01   -1.247796081684470e-01   +6.646899618744498e-02   +5.103375727004399e-01   -2.174233997904426e-01   -2.897764464071017e-01   -1.477143771960617e-01   -7.323127059919876e-01; +2.750269608638478e-01   +5.404198030109350e-01   -2.815663527581025e-01   -3.588432718178048e-01   -3.073210572126076e-01   +6.305802260491531e-01   +4.621914976215078e-01   +3.571361667125024e-01; +9.730385660577372e-02   -3.521312703014384e-01   -6.158295309578330e-01   -1.656829353729105e-01   +4.206762908184193e-01   -4.783747640708840e-01   -1.238964246027898e-02   -1.772344258972927e-01; +4.565724473539201e-01   -9.918081355678107e-01   -1.962703429019628e-01   +4.683831043127257e-01   +5.807153750350788e-01   +8.495770936215051e-01   +6.311661649170413e-01   +2.181600889894479e-01; +4.453760856989775e-01   +7.047815971567783e-01   -1.919881904704283e-01   -5.667899039726869e-01   +4.587282509932961e-01   +3.464927226421298e-02   +6.850192688576070e-01   -3.261914126128809e-01; +1.000000000000000e+00   -1.508223505639454e-01   +6.685649360025219e-01   -2.854953732087591e-02   -1.811348827126374e-01   +9.795905796536847e-02   +8.730900043050577e-02   -5.789720004515863e-01; +5.288090844920356e-01   -1.126659768053301e-01   -6.790440618817804e-02   -3.237350958141308e-01   +2.625930543288430e-01   -3.914735912573469e-01   +3.170657525127226e-01   -6.813860710211104e-01; -8.911949227635356e-02   +1.445559138986257e-01   +3.314339782813022e-01   +3.494409494279550e-01   +3.466622033366481e-01   +8.480442693371569e-01   -2.631324643734740e-01   +6.712592928054945e-01; -4.340523343063261e-01   +2.650231191667968e-01   +2.541536355043186e-01   -1.119249980168109e-01   -8.155117783433395e-02   -8.210983083528662e-01   -8.313824113196168e-01   +1.812201078051883e-01; -2.586895707149182e-01   +6.734430540755271e-02   +4.250096772305688e-01   +2.575143430467099e-01   +1.028094060965124e-02   +3.996381993089622e-01   +2.819156143687655e-02   +4.777610433955697e-01; -3.778716483149587e-01   -4.436072224033299e-01   +2.429584113395200e-01   +1.548162653517894e-01   +4.214787122890588e-01   -7.105862950906247e-02   +4.615931058999954e-01   -5.108142915326938e-01; -3.644583552118521e-01   +7.883642286590148e-01   +3.178027652839575e-02   -1.211262032934198e-01   +2.262046306714025e-01   +5.260858114219432e-01   +1.354482623040030e-01   +3.750870704974995e-01];
L1I_L2I_iGABA_netcon = [-2.321814701279513e-02   +1.482240453389811e-01   +2.696520822598945e-01   +5.221087129583637e-01   +5.884353158931260e-02   -2.939793698495958e-01   +7.834651224934170e-01   +4.977916284048474e-01   +3.247376893822854e-01   -7.274364051600683e-02   -3.900458929560610e-01   +4.163918607220880e-01   -1.872194287592323e-01   -4.972812628010934e-01   +1.495611358252661e-01   +6.409438968283566e-01; -5.487633695536719e-02   +2.970144928489251e-01   -6.134448725137670e-01   -1.177984875145073e-01   -6.216932847390786e-01   -2.294189408599801e-01   +1.128480816097581e-01   -3.273140433166686e-01   -7.143007029484769e-02   +8.216595686161178e-02   +6.369320253298015e-01   +4.747139546073688e-01   -7.426744800718979e-02   +1.125799512442518e-01   +2.411015355834561e-02   +3.842867576685648e-02; +8.844285275341142e-02   +4.847506692014886e-01   +6.638840416895391e-01   +7.692152368510865e-01   +6.060646565555816e-01   -8.722681372365339e-02   +2.848159890706003e-01   +8.455127954420519e-01   -2.798122521543150e-01   +3.468144253763403e-01   -5.406297183720210e-01   -9.003686070912434e-02   -4.878244959726159e-02   +3.669974717503420e-01   -6.128905317349059e-01   +2.249407611993185e-01; +4.963456884646741e-01   +4.909980591391171e-02   +1.637513375237415e-01   +1.739108307353816e-02   +1.828014751262917e-01   +3.437785945534191e-01   +4.731093950369419e-01   +3.864046695774359e-01   +5.408802581280244e-01   +1.742386302055151e-01   -2.048241867205663e-01   -2.745402543348580e-01   +4.788355658657505e-02   -2.768449091270965e-01   +2.176895662758481e-01   -9.319815793093099e-01; -1.425258326152028e-01   +1.202112595814956e-01   -6.684563156962822e-01   -1.534745767283566e-01   +9.913264562308885e-02   +6.405996548481745e-01   -3.638489438681339e-01   +4.731063445886415e-02   -4.474919867183620e-01   -2.639333758804739e-01   +4.223757255232176e-01   +1.000000000000000e+00   -4.485660866793763e-01   +2.195179164330879e-01   -2.932855507010936e-01   -3.911280932959371e-01; +5.834105712847741e-01   -4.417626414591554e-01   +1.611393886687612e-01   +3.336576510868471e-01   -2.094575669495691e-01   +2.351828744404965e-01   +3.046789915352160e-01   -2.094558146681182e-01   +2.937176416300189e-01   -6.429846381184966e-01   -3.288222018673124e-01   +4.704325086391913e-01   -5.837699367949798e-01   -2.388796842167070e-01   +4.245916587417308e-01   +2.246542071401436e-01; -1.511611021860060e-02   -2.737198652825791e-01   -3.277782835021555e-01   +5.196893524456884e-01   -1.032462701168926e-01   +6.587553112299711e-01   -3.409512045260195e-01   -9.780728982402329e-01   +6.546415696191769e-01   -2.521099811154272e-01   -4.086407687615482e-01   -5.632378095940282e-01   +1.102911326598591e-01   +3.054559720250517e-01   +4.437995760375893e-01   -2.225137699665961e-01; +3.789449458329114e-01   +3.809501782614750e-01   -8.797866299861969e-02   -3.314507209227551e-01   +2.403025599389602e-01   +2.005124420080382e-01   +5.212984397442261e-01   +7.447497549057019e-01   +2.088941512653124e-01   +6.495956149918878e-01   -1.280567863175237e-01   +4.968428509078041e-01   -4.386792623186233e-01   -3.998344498305857e-01   +6.256705135754651e-01   +2.661487001393216e-01];
L2E_L1E_iAMPA_netcon = [-5.629608000428127e-01   +7.548924653483786e-02   +1.257650010413386e-01   -8.093977368477021e-02   -8.446910368348980e-02   +1.174689794885851e-01   +4.441285926419769e-01   -1.986374606949289e-02; +3.773514019404327e-01   -3.444121070137457e-05   +7.747187384616615e-02   -7.523960226420781e-01   -1.074148743101882e-01   +6.947884445427632e-01   +3.179531946501228e-01   +5.328138156936469e-01; +3.479309875353031e-01   -7.056919957636884e-01   -4.536367902480903e-01   -6.419950203595651e-01   -7.351342402752574e-01   +1.425665430212427e-02   -6.849027275697558e-01   -3.718056790179011e-01; +3.494387410335708e-01   -2.129897233540853e-01   +4.978466202248455e-01   -2.421237701826021e-02   -6.326797150127758e-01   -2.360112859899364e-01   +3.664583413930865e-01   +4.090527306113788e-01; -5.576786548494317e-01   +7.969716964004264e-01   +6.237702798354020e-01   +7.214126713710685e-01   -7.055038300776928e-01   -7.780139147864398e-01   -2.726689692349958e-01   +3.265004512813861e-02; -6.108583414512559e-01   -3.129962395618165e-01   -3.654733388461130e-01   +6.874386257807912e-02   -2.385228326366703e-01   -6.845726534677471e-01   +2.343273819829911e-01   -6.812578384367848e-01; +7.719110290367434e-01   -2.581463864911325e-02   -7.493055841438744e-01   +1.324069604282339e-01   +1.978373461807467e-01   +6.771748681030221e-01   -3.688043418990372e-01   +3.478025557898222e-03; +6.685224434611083e-01   -1.540294191619297e-01   -2.456028585969929e-01   -1.294139280146350e-01   -5.478008915989088e-01   -1.336157222530695e-01   +4.504007882875627e-01   -1.100394261194020e-01; +4.159186845084318e-01   -1.598106194002348e-02   -4.484591588569765e-01   -5.785130247500152e-01   +3.142203792035383e-01   -1.588043770260542e-01   +2.430293136249843e-01   +4.952394462382564e-01; +4.034355292212223e-01   +4.893000423273682e-01   +8.948781199306723e-02   -1.479422463655919e-02   -3.225224602699745e-01   -7.349345248850506e-02   -4.576185243377726e-01   -8.395622127473698e-02; +2.882884734919889e-01   -6.167148533725211e-01   -2.074099032687478e-01   -5.104676789608237e-02   -3.117173298383575e-01   +3.139364754970771e-01   +9.706710397129556e-02   -4.501682828192687e-01; +3.110124486675804e-01   -5.495113443008658e-01   +2.804208727164554e-01   -3.094741373882332e-01   -2.001337575334850e-01   -4.399411642669517e-01   +3.302232413676641e-01   -6.654850472199115e-01; -3.173684668184849e-01   +1.562507218143777e-02   +3.968266934101055e-01   +2.044187052033172e-01   +2.492973577212040e-01   -4.041951876285362e-01   +3.448800212535092e-02   +2.709375388426988e-01; +5.176356916792184e-01   -2.913175415479943e-01   -2.383085441315510e-01   +5.982682965448385e-01   -6.175028297964553e-02   -8.287806010874064e-01   +4.387219034094909e-01   +2.359209929606451e-01; -9.655425671978052e-01   +2.272846933375598e-01   +3.723331508589937e-01   +4.071260331908496e-01   -9.085807313357898e-01   -4.706811600922988e-02   -3.827351421253612e-01   +3.190593428011274e-01; -4.715503566226752e-01   +1.952680252805109e-01   -1.000000000000000e+00   -9.534327445466743e-02   -2.624624796729911e-01   -2.232808959202789e-01   +5.726029037120151e-01   -5.200189123432019e-01];
L1E_L2E_iAMPA_netcon = [+2.793689088649660e-01   +8.177763367145734e-01   +8.268180373329693e-01   -4.738251656736497e-01   -2.784245009011052e-01   +1.549965202224628e-01   -7.543405125303464e-01   +3.320203122476998e-01   -3.896721675052089e-01   -4.048639171322770e-02   +5.256971425324849e-01   +2.454222379948246e-01   +6.927254414617466e-01   -1.663294556250937e-01   -3.716412947675689e-01   -1.750389511982361e-01; +1.862158601750057e-01   +3.011129240849509e-01   +1.156546020593713e-01   +5.959462947534437e-01   +2.305531198769631e-01   -5.260268195831889e-01   -4.483320893688568e-01   +2.389189922047311e-01   +4.096708135776499e-01   -7.469102440064123e-03   -5.752705632463203e-01   -1.609366955768600e-01   +5.827389928058567e-01   -7.612394127463391e-03   +2.549325083325314e-01   +5.614791910924993e-01; -6.658600163014727e-01   +2.259103766225410e-01   +4.721644818633382e-01   +4.731009720203646e-01   -1.685748660047294e-01   -2.015742952243965e-01   -1.607674490797488e-01   +1.449142853234553e-02   -1.000000000000000e+00   +1.489575981034678e-01   +2.961335784233236e-01   -4.724334236132540e-02   -4.923669812474863e-02   +5.982590639627582e-01   -9.610418367945303e-04   -3.643514117590749e-01; -4.224769819466831e-01   -1.160511419857958e-02   +1.160582624415586e-02   -3.364512628930882e-02   -3.661937646640980e-01   -1.345963984870831e-01   -3.156765919119118e-01   +1.098850892317717e-01   +5.525922449181049e-01   +2.368954955549294e-01   +5.240158751571390e-01   -4.600037421558675e-02   -1.308308745083818e-01   -7.535320861302021e-01   +2.175226602150258e-01   +6.739926479754810e-01; +2.130190836921951e-01   +4.663650793915401e-01   -4.540196066117451e-01   +3.500294654655773e-01   +7.197618283767346e-01   +5.638647332047839e-01   +6.343844434867271e-02   +3.155421357441230e-01   -2.685545278778081e-01   +7.282491063922073e-01   +2.582740773831826e-01   -1.191286954204727e-01   +2.813252415024100e-01   +3.110107862827029e-02   +4.573470168706246e-01   +4.156547326366224e-02; +3.382266780036792e-01   -4.763346141164453e-02   -4.239494901226564e-01   -1.026730012069195e-01   +3.314016025701127e-01   +2.650752252424905e-01   +7.657238135417616e-01   -1.763264121742470e-01   +3.762923368929467e-02   +7.323190433086781e-02   -1.143442087452594e-01   -6.908819300250435e-02   -3.288010287961653e-01   +2.939529205177522e-01   -3.342397260629806e-02   -4.691061219374784e-01; +1.115527923651120e-01   -5.278233225670473e-01   -6.374479253820264e-01   +6.506345293269055e-01   -4.765580750080486e-01   -3.182335189154788e-01   +4.502861992410295e-01   +6.104701737107530e-01   +3.499182926747128e-02   +5.760104897033256e-03   +7.798292167132388e-02   -3.889041187517522e-01   +7.823880922977673e-01   +3.682906265468506e-01   +1.222450250320340e-01   -3.519406134999232e-02; +3.137292675734595e-01   -1.097542743940820e-01   +9.497895355356924e-02   -1.914213547177942e-01   -1.889422037432726e-01   +2.327221335717722e-01   -3.838915854427397e-01   -5.521005469116763e-01   -2.098389123954486e-01   -1.381388988602260e-01   -3.967038092832083e-01   +3.160524324260770e-01   -2.268262786940817e-01   +1.897939438958775e-01   +3.621981523442465e-01   +1.155751525270718e-01];
L2I_L2E_iAMPA_netcon = [-6.087102861883038e-01   +4.538145113525033e-01   +3.600492148021401e-01   -4.528859494258907e-01   +6.373413863835276e-01   +5.527430332240511e-01   +4.994107309668991e-01   -3.296390738814961e-02; -4.058924388338174e-01   -5.120516804902910e-02   +6.085240372826801e-01   +4.855748974935394e-01   -1.817893425565264e-01   +8.442908817742676e-01   -2.084691867832323e-01   +7.176246978075363e-01; -6.379240853120908e-01   -1.995338900770451e-01   +5.274291927103892e-01   +3.235885356958048e-01   +1.266176757832556e-01   -3.398450723096897e-01   -1.186096604532385e-01   +3.041595901933402e-01; +8.278007651019997e-01   +8.062659869137121e-01   +9.313762255407910e-01   +3.666916681900955e-02   +4.373325100539564e-01   -2.506541626116164e-01   +3.633274242710562e-01   -1.348839781368853e-01; +1.263148457443831e-01   +5.550275047801644e-01   +6.661009298944450e-01   +3.284678227973675e-01   -5.752558993809812e-02   -7.080109197986502e-01   -3.394514376943992e-01   +1.000000000000000e+00; +3.252044323092225e-01   -2.265306555789965e-01   -5.667074043053405e-01   -4.068083318976815e-01   -3.221955039205391e-01   -6.928925195017187e-02   +5.724178851148504e-01   +4.925460159114951e-02; +7.663578922353538e-01   +6.917062956892537e-01   -7.700473166315448e-01   -4.168862966933853e-01   +1.184536530396881e-01   +1.348934411062603e-01   +2.982934185395132e-01   -3.737204231617696e-01; -2.217703991167863e-01   +9.166282584383172e-01   +8.824154620226142e-01   -3.922933602696659e-02   -8.415777053630407e-01   +5.307463865559952e-01   -1.990719024189040e-01   -2.490380178347419e-01];
L2E_L2I_iGABA_netcon = [+2.527826964480255e-01   +1.443364235086024e-02   +2.442134516745305e-01   +7.368866831398818e-01   -6.244900750815980e-01   -5.611325366517372e-01   +8.346651417004698e-01   +4.365974637246390e-01; +5.423182249453908e-02   +2.181249255667236e-01   -4.279325368558529e-02   +1.753645863878672e-01   +5.436179776497529e-01   +3.738928604186763e-01   +1.201466182066126e-01   +1.000000000000000e+00; +1.281894149488426e-01   +7.210278949546271e-02   +5.744351370074738e-01   +1.115031271790723e-01   +6.139899418455528e-01   +6.917355267400329e-01   -1.318804610735319e-01   +7.660363828126651e-01; +3.285859822495818e-01   -4.303288543536813e-01   -6.231028067653395e-01   -4.041652938843156e-01   -5.297989664149492e-01   +6.380036239617967e-02   -5.601433858130876e-02   +4.203747778374270e-01; +4.719335656491681e-02   -5.816237286848619e-01   +4.008514945975148e-01   +2.859102698779444e-01   -2.270388470522712e-01   -4.325527710189376e-01   +1.246147436169967e-01   -6.324869779398869e-03; +5.010656826716396e-01   -6.913151261756010e-01   -1.914395520433139e-01   -6.955860132015280e-01   +8.811246757505220e-01   +1.674681312230378e-01   +6.630060251801639e-01   +2.397821777735212e-01; +2.268786386913353e-01   -4.671926031030679e-01   -2.759671105950219e-01   -3.985681610003817e-01   -1.729323888300757e-01   +5.271693456638961e-01   -7.560379432258242e-01   +3.410872279574269e-01; -2.958929366306166e-01   +4.516301672237396e-01   +6.300587415882721e-01   -4.735739635691195e-01   -4.357333746012471e-01   -2.181911546003353e-01   +1.183190338920946e-01   -5.641640592282799e-01];
L3E_L2E_iAMPA_netcon = [+6.391947255260705e-01   +1.407272804117747e-01   -6.118043008621166e-01   +2.608847614914606e-01   +6.728148624048047e-01   -6.978856951335531e-01   +8.073005880237084e-02   +5.273620256699563e-01   +1.128181573850658e-01   -4.691811432771497e-01   +4.673028268230711e-01   +4.029793261255046e-02; +2.969850198234711e-01   -1.690942596057065e-01   +4.196917770335281e-01   +9.511665149363676e-01   +2.005310071975305e-01   -4.045145223869018e-02   -9.261408863196425e-01   +8.220705268676415e-02   +4.030903598845069e-01   -2.016240920810594e-01   -6.444231630330362e-01   +2.018628368455557e-01; -2.737736844753165e-01   +3.150924165467484e-01   -7.789771482970733e-01   +5.903090501141981e-01   +3.234297367456672e-01   -7.940102898004006e-01   +1.800050587665332e-01   -2.963399262817182e-01   +6.475895050672402e-02   +7.975453428034349e-02   +1.285494029403056e-01   +3.727265334541356e-01; -4.117192668310229e-02   +8.451058755225491e-01   -3.552344983541573e-01   -2.672177377680237e-01   -3.994627492547688e-01   +1.563682215686393e-01   -8.794893407265302e-01   +8.684571799359687e-01   +6.050302899281881e-01   -3.422103630323085e-01   -1.284115423853508e-01   -6.019328374888169e-01; -4.740550063993995e-01   +5.785746460936646e-01   -5.759117086444773e-01   +8.312275544953793e-01   +1.569139088188779e-01   -3.264626606325337e-01   -2.906554886019578e-01   +9.920408699111757e-02   -1.315156038518690e-01   -3.689675699799873e-01   +5.631619733018299e-03   +6.891939044156728e-02; +6.304927991444749e-01   +4.202460821479299e-01   +9.067866371302163e-01   +5.139271394007628e-01   +2.932520362977126e-01   +8.495160140215656e-01   -6.325700995321658e-01   -7.256330951470354e-01   -8.029714723906146e-01   -4.600719794191409e-01   +1.090746792171940e-01   -7.871185302001934e-01; +5.842296638399445e-02   +8.037872163166067e-01   -9.782260287753682e-02   -7.143908314480839e-03   +2.005840805190184e-01   +4.106710405638256e-01   +4.965437484722453e-01   -5.015951220487921e-01   -5.017417455577645e-01   -6.154315540359498e-01   +4.493779903316847e-01   +3.490395251536586e-01; +2.792846932454925e-01   -2.507109673746099e-01   +6.301550067710890e-01   -5.875647280214994e-01   -1.503938717214761e-01   +1.491933664680552e-02   +4.055856173881238e-03   -4.405752202535941e-02   -1.373101934612793e-01   +4.652608532168674e-01   -1.000000000000000e+00   -3.173704894511407e-01];
L3I_L2I_iGABA_netcon = [-1.603598496757645e-01   -3.562731125934392e-01   -9.144503200755945e-02   +7.114731790970875e-01   -6.763406529227518e-01   -2.133603896409607e-01   +3.257100327559984e-01   +1.715288135488286e-01   -3.554752363444500e-01   -6.404726174505455e-02   +4.538682821986083e-01   +3.258095422406155e-01; +1.579146563585354e-02   +3.357203178779164e-01   -4.183968157647701e-01   +1.120597879336401e-01   -3.059049449057574e-01   +1.080549602302133e-01   +7.556231707841019e-01   -2.645217322107614e-01   -8.242512964953922e-01   -4.200712739262800e-01   +3.847825507036573e-01   +3.704023081734596e-01; -3.948646865715271e-01   -5.227930115404704e-02   +6.959952303690998e-01   -1.430348026375746e-01   -2.038619023151237e-01   -5.778465589501395e-01   -1.034551946224451e-02   +7.196969607441096e-02   +1.000000000000000e+00   -5.148009706968877e-01   +6.106001823343488e-01   +6.074526939003835e-02; -1.685215877042596e-01   +3.773318864475721e-01   -6.048868268930221e-01   +3.278912295990508e-01   -7.099738908722948e-02   +2.895766872426528e-01   -3.994619743542189e-01   -1.444010394176100e-01   -7.038423964287419e-01   -6.916316375620407e-02   -2.226052031365877e-01   +6.937844741151399e-02; +1.581952078271664e-01   -1.917930031980480e-01   +1.398014444032759e-01   +6.242817532360898e-01   -4.490769812477498e-01   -1.072342410835124e-01   -6.926070350863400e-01   -1.733885944169255e-01   -3.047159294890086e-01   +6.992828240917048e-01   -2.191389813647725e-01   -1.033265277541775e-01; -1.743905085118209e-01   -4.725728195247096e-01   -9.333843863248938e-02   +6.347040281275790e-01   +7.730733022860877e-01   +7.584145660617078e-01   -8.247947214299407e-01   -7.819110077543305e-02   +3.698574616220439e-01   -1.848829139135959e-01   -1.119560762742329e-01   -4.288401810621902e-01; +5.096148518466761e-01   +7.745778196503343e-02   -1.308676681184594e-01   +3.124521161804076e-01   -6.584732330816691e-01   +1.063201149575040e-01   +4.649326764609557e-01   +7.733192118956084e-01   -7.795774049510391e-01   -7.826722114017066e-01   +2.752283966640427e-01   +1.351660720524466e-01; -4.879626589052984e-01   -5.904240902235149e-01   -4.099954357780163e-01   +7.770111302780455e-01   -2.613327907142353e-02   +1.244294536411906e-01   +8.410298221839374e-01   -3.334684775294253e-01   +4.508478749262080e-01   -1.544739602665307e-01   +3.664808696084240e-01   -8.875926994740244e-01];
L2E_L3E_iAMPA_netcon = [+1.475365914484222e-02   -5.993870390094327e-01   +7.038433854079647e-01   +4.735051093219357e-01   -2.498945784815184e-01   +6.296351156328979e-01   +6.411888112329789e-02   -3.011825685453206e-01; +5.222033176381162e-01   +9.893862871375877e-03   -7.310090261741500e-01   +1.164790580656636e-01   +3.466853741800348e-01   -3.043203307553073e-01   +4.664640818742765e-01   -6.517252856028648e-01; +2.916917392357812e-01   -1.787357002605248e-01   -3.388067384128008e-01   +9.382750222498272e-01   +8.836089269427789e-01   +5.579737024783298e-01   -6.501607716560742e-01   -3.363224041140701e-01; -1.321629384087477e-01   -3.363717453132932e-01   -6.831851921082885e-01   -3.483734216488577e-02   +3.973935964931181e-01   +4.260697323743290e-01   +2.391397806518839e-01   -7.301147220191982e-02; -6.013160998317288e-01   +9.691970822897970e-02   +5.130360557168030e-01   +2.113132052778648e-01   -6.345920240350343e-01   -4.512494064190475e-02   +1.993815189707713e-01   -5.804370193374631e-01; +5.887607531742313e-01   -8.954866660942259e-02   +4.272767957102296e-01   +2.366376558405950e-01   +3.452509802019714e-01   +3.975917902168729e-01   -8.420627196444139e-01   -5.321976277593121e-01; +7.952007367710847e-01   -1.000000000000000e+00   +5.951412643997899e-01   +2.932193365861139e-01   -8.871597108935673e-02   -4.823837847367700e-02   +2.199747141248785e-01   -3.431552198959359e-01; +2.046481968438686e-01   +5.781378891989766e-01   +5.328564513741130e-01   -6.398736299717089e-01   +7.797635024689690e-01   -6.523103444554968e-01   +2.446563296894264e-01   -9.536216983447962e-03; -2.021561347921110e-01   -2.489624798820258e-01   +7.616387919871687e-01   -1.900988887729099e-01   +1.440776770276993e-01   +3.896621911517836e-01   +3.213229338177924e-01   -1.759901089500747e-01; -3.056373213786860e-01   -4.030449468767413e-01   +1.824022933753103e-01   +3.341714166466080e-01   -2.590107826294977e-01   +1.055212785015533e-01   -2.412092174907081e-01   -5.884022475832200e-01; +3.657988678719392e-01   +6.377818517281232e-01   -3.615167155475473e-01   +2.265738964457223e-01   -3.153979337937064e-01   -1.842867167580020e-01   +1.089687088396162e-01   -7.000094417613851e-01; -1.641675840711486e-01   -3.989035450118806e-01   +1.548071018312188e-01   -1.824640231408314e-01   +2.889264627312575e-01   -1.267068149012613e-01   -2.769338496474228e-01   -4.317645988397280e-01];
L2I_L3I_iGABA_netcon = [-5.306444172168651e-01   -3.911250520147673e-01   -7.284698254644352e-01   -3.686209997580743e-01   +7.561979497835664e-01   +6.171710761108820e-01   +5.059502316911708e-01   -7.946110178218141e-03; +5.001531016027339e-01   -3.156884698587720e-01   +1.176801525178526e-01   +3.112583667682264e-01   -2.376907192982737e-01   +4.285913700157558e-01   +9.443770096600046e-01   +2.497932732942255e-01; -5.236402543469879e-01   -5.678155971251726e-01   -2.072082805658657e-01   -3.421280501450063e-01   +5.131927708615805e-01   -2.216749630228282e-01   -2.133220325556868e-01   -8.077437513038054e-01; -5.697756633846085e-01   +9.707739513479401e-01   +2.693386907158852e-01   -4.534714012931026e-01   -5.759521951186262e-01   -2.957738425623123e-01   +4.051978345645291e-02   +4.083997773610907e-01; -5.880035825103826e-01   -2.602854100734052e-01   +5.662519050738803e-01   -2.330960620007640e-02   +7.010119164959416e-01   +4.649681613159483e-01   +3.451206050700884e-01   +9.167233279665397e-01; -5.359993008474535e-01   -4.202132414220061e-01   -1.123076617812536e-01   -3.226151095801080e-01   +4.604131594486429e-01   +7.618412822153114e-01   -3.420694748201389e-01   +1.846232302113231e-01; +7.655867941991209e-01   +3.919377539179908e-01   +3.066016131017368e-01   +2.595111076738774e-01   -2.438666592010078e-01   +3.889415115887955e-02   -1.237544873999222e-01   +1.000000000000000e+00; +3.143363338076264e-01   -2.092708850156637e-01   -4.751190080156265e-01   -7.149219032715735e-01   +1.465579207433164e-02   +7.712817123444377e-01   +4.076556115752997e-01   -6.274470111239513e-01; -2.724065648383731e-01   +2.225482336645696e-01   -2.851818562252532e-02   -8.765566322279666e-01   +5.736031541366103e-01   +6.439121978017447e-01   -5.372184130589617e-03   -1.667698876828336e-01; -4.276485319562360e-01   +2.686962281348959e-01   +3.933363000145154e-01   +4.838702165156416e-01   -2.321279854977663e-01   +9.118341167088975e-01   -2.568424419368825e-01   +7.944757799343380e-01; +8.528714293385345e-02   -2.598457998679131e-01   +3.464849412210034e-01   +8.220358932344937e-01   -1.182561327587130e-01   -4.226571474185555e-02   +5.219608235230804e-01   +8.392470589376065e-01; -8.655387169251383e-01   +4.293138851152315e-01   +6.536377840135038e-01   +8.281239030011676e-02   -5.494803304091384e-01   +2.006779692141450e-01   -7.706477105317990e-01   +2.132055155035585e-01];
L3I_L3E_iAMPA_netcon = [+2.540505689456408e-01   -2.235863224451946e-01   -6.045039925381581e-02   -4.201879491165558e-01   +2.448304932519392e-01   +8.759719527641473e-02   +4.731869156810644e-01   +6.908071721783630e-01   +2.186721860468557e-01   +5.796070765485959e-01   +5.372603672099289e-01   +6.783569629006893e-02; +2.761510619766563e-01   +1.552750510452275e-01   +1.830422765026116e-01   -5.027578720165495e-01   +1.586089296052406e-01   -1.168883649608757e-02   +4.230244144752347e-02   -6.022189441045949e-01   -6.251811776994715e-02   -4.631943195505091e-01   +1.600612553567921e-01   -1.489644632213599e-01; -2.481769715014644e-01   -2.540467825539066e-01   -5.745538104123452e-01   +7.202636254922169e-01   +2.962295516013347e-02   -6.165710543247873e-01   +3.968456057171355e-01   +5.566949330804434e-01   -3.470953515482492e-01   -8.515525205152635e-01   +4.398509744294205e-01   +8.737513730749642e-01; +2.884446776016346e-01   -1.541713919243419e-01   -7.069103498667701e-01   -1.013228044933722e-01   +1.913864723604908e-01   +5.639698572593114e-01   -2.105208661111123e-01   +6.111036501554369e-01   +6.050424978542395e-01   -1.368676494225987e-01   -3.569186922273815e-01   -2.235177388690081e-01; -1.951058916833528e-01   +7.790353409097384e-02   +4.551907479892314e-01   -7.844295159702903e-02   +4.399932359053454e-01   +1.979731662087121e-01   -6.001354537808793e-01   -7.638810825407699e-01   -1.952790061913731e-01   -4.748376488759964e-02   +4.807454669715198e-01   -5.755001002993774e-01; -2.627840594108599e-01   -9.775429364533031e-02   -5.680118822424095e-02   +3.553835799200338e-01   +2.339836892127505e-01   -3.550829432085745e-01   -1.507429688490355e-01   +1.369748508398470e-01   +3.201984204283864e-01   -4.541132747216191e-01   +4.729557032545716e-01   +4.006762226932380e-01; +3.331589475928767e-01   +2.449084494838956e-01   -7.261856152947003e-01   -3.938814741182139e-01   +1.834150543508382e-01   -5.224953412374411e-01   +6.134748180525817e-01   +4.451343153074505e-01   -3.053695052967671e-01   +3.453510864899190e-01   +2.451002600356277e-02   +3.375571514574797e-01; -4.994715102368004e-01   +5.694545504610821e-01   +4.184498900026478e-01   -4.910087120888211e-01   -3.436068075985856e-01   +3.676194436103118e-01   +7.168000151980112e-01   -5.376251389286367e-01   +3.389227997143649e-01   +6.479470535874596e-01   -1.241504529566261e-01   +1.645258310529752e-02; -6.902333016725765e-01   -2.046594923416910e-01   -2.841401136117617e-01   -3.825847450794760e-01   +2.059797843361077e-01   -1.613308413201492e-01   -5.204047120943547e-01   -1.270382462621476e-02   +5.861946416773096e-01   -1.288471504340191e-01   +5.906463807446850e-01   -6.438486899441592e-01; -1.138365346833522e-01   +2.868516553415380e-01   -4.981767495898753e-01   +1.000000000000000e+00   -1.873932845607906e-02   -1.019434359668842e-01   +4.516893725054466e-01   +6.357004142343330e-02   -7.121385884208148e-01   -2.412123313711374e-02   -6.722360789883581e-01   +4.224743912939900e-01; -4.825719673445069e-01   -6.992793741486641e-02   +7.873372056421397e-01   +2.842118476385793e-01   -4.684840617127899e-01   +2.555004264851164e-01   +2.312133906432969e-01   -8.415598544304781e-02   +9.834862549866109e-02   +3.432769747753764e-01   -1.841918980178249e-01   +3.004721357841688e-01; +3.101580865684622e-01   -1.683789079661907e-01   +1.716351217466927e-01   -6.011951954153982e-01   +9.425053306527074e-01   -4.663813652327268e-01   +8.762650745178572e-03   +7.300909811296002e-01   +2.901554270218337e-01   -2.142770396084069e-02   +2.798967950410213e-01   +3.230970310281793e-01];
L3E_L3I_iGABA_netcon = [+6.435140750129820e-02   -1.931126630931412e-01   -8.644277147746651e-01   -2.939608654132194e-01   +2.743108551532836e-01   -1.918244521864251e-01   -3.433786579202093e-01   -4.364080908826651e-02   -7.815994353207196e-01   +8.076130966833334e-01   +5.379212791404132e-01   -1.376783505832751e-01; +2.742945286355804e-02   +5.958071093303566e-01   -1.002838558449656e-01   -2.546188974371428e-01   -5.654055112908568e-01   +1.765814918771064e-01   -3.078330569723005e-01   -6.590172300976074e-01   -9.635078046083779e-01   -2.989985947471029e-01   +8.041636017870384e-02   +6.349643511498403e-01; +4.069161357804951e-02   +5.518849737374828e-01   +3.071233323103643e-01   +1.506592294282198e-01   +5.637166749643232e-01   +1.009669634003497e-01   -4.347016360757184e-01   +6.236392691939647e-01   -1.802523955020116e-01   +3.039963807865443e-02   -4.356937346694770e-01   +1.806422919941188e-01; -1.566190908522848e-01   -6.643849182921191e-01   +2.129126322941136e-01   +4.567461346385354e-01   -3.790997332546093e-01   +3.326082230886151e-01   -5.607447988454863e-01   +4.005769334721730e-01   -3.375839742771873e-03   -4.850826996432143e-01   +3.938227374003173e-02   +8.256180994244590e-02; +5.438547861784743e-01   +2.032394339167349e-01   +4.934664972178530e-01   +4.540346155380764e-01   -9.657092391524455e-02   -3.466461456021615e-01   -5.663858101125940e-01   +1.794631973002808e-01   +3.928701085575195e-01   -5.152670738129639e-01   +2.502280792707402e-01   -3.719848979512172e-01; +1.332557089929840e-03   +1.216611769583459e-01   +8.366198095450486e-01   -1.000000000000000e+00   +2.511000076627629e-01   +1.970587104543253e-01   +3.026221262471192e-02   +7.207192336250183e-01   +1.868070705922408e-01   -5.592680864513087e-01   -1.917010583458901e-01   +4.487102110910222e-01; +3.815677156027530e-01   -1.806064629752254e-01   +2.373749223294616e-02   -3.861832239452860e-01   -9.240393608531905e-02   -7.750993380721174e-02   -6.772630680205706e-02   -4.655975963376212e-01   -4.393440733202076e-01   +7.425508307164094e-01   +6.039406557488922e-01   -3.188696286956513e-01; -4.568188781493571e-01   +1.096479459081178e-01   +8.342557575690950e-01   -6.100988471891438e-02   -5.147622281441464e-02   +6.515423905488977e-01   +9.440358745445254e-02   -5.584589747070757e-01   +6.286363615485960e-01   -2.908988560714864e-01   -4.521627037853158e-01   +3.938928475311441e-01; +4.462951674448832e-01   +6.130167309785678e-01   -1.904717363979005e-01   -1.834187348575659e-01   -3.541587248829416e-01   -4.918172852056478e-02   +8.982726168912543e-02   +3.645922085720971e-01   -7.155513758382608e-01   -1.701757113806066e-01   +5.120973245119163e-01   -4.160823249214223e-01; +3.219373305326959e-01   -4.731009076191546e-01   +1.958418251135690e-01   +3.417207792691427e-02   +1.102913596071361e-01   -2.053971174472375e-01   -4.683885199517890e-01   +6.942315425489332e-01   +3.319554194126498e-01   -6.989240084367393e-02   +9.081891755200756e-01   +7.733519109542618e-02; +4.935269028386265e-01   +4.605875984598014e-01   -1.884651772380338e-01   -2.057954052752019e-01   -4.231691037340142e-01   +4.481371207552097e-01   -2.209681945259261e-01   +4.049634355094792e-01   +2.539325373217709e-01   +5.347878836738180e-02   -4.468465443529439e-01   +5.817998132466545e-01; +6.962559639454936e-02   -4.416428413183725e-02   +2.564744423930061e-01   +2.355109253861397e-01   -1.361360133324070e-01   +4.254910393402899e-01   +4.022054722652913e-01   +4.294718171004342e-01   -6.542010830646369e-01   -1.631146429024670e-01   +5.926252745675107e-01   -5.462384232117038e-01];
L2E_Input1_iAMPA_netcon = [+5.815757291029737e-01   +5.841180854148514e-01   -4.037804836355253e-01   +5.185550113958568e-01   +8.665064299734523e-01   +1.764601169791546e-01   +6.285456720802030e-01   -9.241966321648936e-01];
L2I_Input2_iAMPA_netcon = [+4.527553774585140e-01   -2.108211966963736e-02   -2.639021790667778e-01   +5.225519167931409e-02   +1.000000000000000e+00   -9.552376755354663e-02   +4.848704727880063e-01   +3.485638119270235e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.4*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 1.0*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 1.0*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.4*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 1.0*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 1.0*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 100*(sin(2*t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 100*(sin(2*t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
