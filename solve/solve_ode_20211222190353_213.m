function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-1.463270873809600e-01   +2.003388105921652e-01   +7.038461990571260e-01   +6.917712036057038e-01   -1.372479616318884e-01   -2.855465946195521e-01   +6.738008488589715e-01   -2.061660578861224e-01   -5.116906291021565e-01   -7.073525307964844e-01   +1.144879347033519e-01   +5.154512150336329e-01   +4.056409756301967e-01   -3.977022430764932e-01   +6.608930220914462e-01   -8.017307930409370e-01; +7.871436017819036e-01   -1.590927964180635e-01   +3.048918237777538e-01   -2.098580005462821e-01   +4.676057517090795e-01   -1.102287464002938e-01   +9.255256960832553e-02   -1.113984691079811e-01   -1.605000597187341e-01   +4.801829743928911e-01   -5.011916490960412e-01   -5.155101862453446e-02   -2.527481183295677e-01   +3.026618600677038e-01   -5.798158529460787e-02   +4.678167132308130e-01; +3.565168087583513e-01   -8.312372694770599e-03   -3.478836446100921e-01   -4.719643249966916e-01   -6.376140739904149e-02   -3.182375530911279e-01   -2.321573766855094e-01   +3.736557156628651e-01   -4.772239156652174e-01   -5.544483551234831e-01   +4.294337391619367e-01   -4.089831774314127e-01   +1.802978513710366e-01   +8.394352335009939e-02   +3.308559650649686e-01   -4.933898916514247e-01; -5.540268094255546e-01   -6.518147485348771e-01   +8.346467134205146e-01   -2.649025511693448e-01   +4.495513521923047e-01   +3.443396724871873e-01   +4.662163042008852e-01   +1.901835415250374e-01   +3.460849531937283e-01   -1.701954630947961e-01   -3.712919985414490e-01   -4.220842309116070e-01   -1.857427951083484e-01   -5.414160472069084e-01   +2.671161327953551e-01   +8.456427146015253e-01; -7.039043373452587e-02   +3.468383158270113e-01   +1.401481137509099e-01   +6.688930251975457e-01   +6.517938815899808e-01   -3.000268062568949e-01   +6.570521278769583e-01   +7.743116186951768e-02   -4.249752811138912e-01   -5.968876446657199e-01   -1.779988727998723e-01   -1.116910497524880e-02   +4.011883126529262e-02   -1.027799335905892e-01   +9.148082517134122e-01   +9.408697502742416e-02; -1.303638118111102e-01   +4.253625269088585e-02   +2.108992207377442e-01   -4.010373745813122e-01   -4.928874508845025e-01   +1.769660265211928e-01   +2.714238848788967e-01   -5.107828333196479e-01   -2.683098683002302e-01   +6.465901929827648e-01   +5.603122983658426e-01   -5.993668422719052e-01   -3.321852259903697e-01   +1.101009347618520e-01   +9.061792042149145e-01   +1.051157819377639e-01; +6.442787840167600e-01   +6.901389631765299e-01   -6.123938153344313e-01   -7.124385347005027e-02   +1.933440535441451e-01   -5.954904580648919e-02   -4.473242131254258e-01   -2.486944421590485e-01   +5.799397122092598e-01   -7.809533458905361e-01   -2.111417794799497e-01   +3.898950161606943e-01   -7.612062318299554e-01   -1.259298520156304e-01   -1.749093736410323e-01   +1.833976657540310e-01; +4.754842749026463e-01   +4.610635033428738e-01   -4.226037132394925e-01   +9.226899906366649e-02   -7.343268393202146e-02   -4.677287740594000e-01   +9.279305367368582e-01   +4.283077027461833e-01   -3.247862536035612e-01   -2.394552214707654e-01   +5.673933459205868e-01   +4.691260800574296e-01   -1.637699205627109e-01   +6.841826332864993e-01   -4.412005921246383e-02   -6.427806172168828e-02; +3.011522536524759e-01   -7.222487136559871e-01   -8.128775410937935e-01   +4.738265234410881e-01   -3.348753604650341e-01   +7.002404994918848e-01   +3.531388740600880e-01   +4.695673285865589e-01   +3.243254978583401e-01   +3.406792522711237e-01   +4.043704060109320e-01   -1.352919912962939e-01   +8.731960125640065e-01   +2.994703357512842e-01   -6.108663915838657e-01   -5.220749540306656e-01; -5.502724179549243e-01   +4.901032498281449e-01   +1.672415290238719e-01   +9.770411400401620e-01   -7.232846473470785e-01   +7.387556831409628e-01   +2.092096315379567e-01   -5.877027679908816e-02   +4.353389032224114e-01   -3.112914797941271e-01   -3.544387192226140e-02   -1.446868241150020e-01   +2.195058090067133e-01   +7.176747571559327e-01   +9.996460214066512e-02   -3.416665794345362e-02; +2.520822081722492e-01   -7.311573020772996e-01   -1.506744723559488e-01   +8.138161171607512e-02   -1.936693689851035e-01   +4.623149264597271e-01   +3.204371538002692e-01   -6.156456147192308e-01   -1.779935671926282e-01   +9.623712952198004e-01   +8.766043134352701e-01   +7.697090680413516e-01   +8.026031881394211e-01   -9.075811842158560e-01   -7.072820743585166e-01   -9.329195326262250e-02; -2.929744483971218e-01   +5.497688344667538e-01   +3.949902324630330e-01   +9.616219502914204e-01   +4.327275175752375e-02   -3.754291265596680e-01   +3.619080326449587e-01   -5.555210808573943e-01   +6.674707238245290e-01   -5.890238148710650e-01   -2.161144655795712e-01   -5.771770754809838e-01   +6.998724430444417e-01   +1.118155038497967e-01   -1.373192241491909e-02   +2.301847627430437e-01; -2.381275068548103e-01   -3.481811647653861e-01   +6.182366133600563e-02   +3.533058112855765e-01   +2.262401348018750e-01   +1.844502218701831e-01   -3.684894832296307e-01   +9.477227675394252e-01   -5.094980050092446e-02   +2.822095322610711e-01   +2.585151284913106e-03   -4.336436597349344e-01   +8.459115548618585e-01   +1.147701260252302e-01   -4.298442577217219e-01   -1.475405238525904e-01; +3.574075865662878e-01   -2.826198029967799e-01   +3.972779017505866e-01   +5.879051496882681e-01   -1.280348933266563e-01   -5.116570620909708e-01   +1.991973447645715e-01   +1.623052669170255e-01   -9.895394033341222e-02   -3.207697799192935e-01   -6.914537711370559e-02   +1.355514498954191e-01   +3.705086478342484e-01   -3.846150735675944e-01   -6.197723362257015e-01   -7.654798965455960e-01; -6.263287628898497e-03   +7.127023600431999e-02   +3.445306416932907e-01   +8.276428381966643e-01   +3.120580829117200e-01   -4.145830683038425e-02   -8.127014605866336e-01   +1.352072353306060e-01   -2.825404203307456e-02   -6.958392196472475e-01   +8.173723324245730e-01   +3.321510116725502e-01   -8.237186716899118e-01   -2.861993592570466e-01   +1.224217384812520e-01   -1.000000000000000e+00; -4.806745933925769e-01   +3.310553944988557e-01   -4.750873325444744e-02   -1.481143474515569e-01   +2.355979790901736e-01   +9.887981450948150e-02   +3.031743948865147e-01   -3.871401004774547e-01   +6.221837803511657e-02   +1.347852241498497e-01   +2.443458604801731e-01   +5.009836162496127e-02   +1.547499497892803e-01   +2.659600511431570e-01   +8.441027230106538e-01   -3.786662591161557e-02];
L1E_L1I_iGABA_netcon = [-3.722297454979166e-02   +5.026059389391371e-01   +3.407771315443026e-02   -6.503501946854681e-02   -1.166425473345543e-01   -2.025644531814267e-01   +3.631821443963953e-01   -3.643819236894215e-01   +2.778484619286941e-01   +1.093360654245326e-01   +4.911909097200332e-01   +9.896892066515876e-02   -5.671658826399035e-01   +1.836445212707327e-01   -4.346535973073701e-01   +1.337159617710896e-01; +3.858117028879556e-01   -8.360844006122502e-02   +8.520325699206877e-02   +6.964229721107348e-02   +5.632005881312779e-02   +4.219055202613142e-01   +1.790854657311564e-01   -5.429172224178619e-01   -2.072884354631771e-01   +3.260423707658250e-01   +4.352306990442513e-01   +5.820855449017422e-02   +2.732835453281841e-01   +1.780659348398165e-01   -2.389858507225144e-01   +2.509452358113506e-01; -7.913560906157855e-03   -1.727471550196239e-01   +2.581286404101002e-01   +2.937727078912661e-01   +8.978837160087953e-02   -5.118217875901964e-03   -2.560818529230657e-01   +7.351597068105740e-01   -2.730264622497798e-02   +6.408741636849736e-01   +7.031576058353451e-01   -3.118933157149454e-01   +8.416962942435761e-03   +2.223088647302962e-01   -4.888935831179470e-01   +6.552976126390233e-01; +4.172018557301870e-01   +1.012584766729697e-01   -2.067997845329478e-01   -1.014970007907831e-01   +6.801122565363915e-02   +2.205631479077863e-02   +2.160374442984688e-01   +3.906956513850383e-01   -4.749400357284289e-01   +1.934476538312123e-01   +2.880717166796436e-01   -3.268839995988461e-01   +3.790165629119053e-01   +4.137236474632546e-01   -3.374716878025794e-01   +1.416257082673313e-01; -1.760969743664603e-01   -5.890016925854222e-01   +3.147115663384962e-01   -9.164320584095587e-02   -5.007081806500142e-01   -2.463070075686310e-01   +4.261509571312100e-01   -2.271880473946371e-01   +1.626060774567531e-01   +4.479404367956890e-01   -6.514248958004117e-02   -4.575238851645733e-01   +9.238984769527114e-02   +3.880578176966928e-01   -8.772782422794873e-02   -4.814916745285724e-01; +3.856306632494686e-01   +1.004816214298337e-01   -2.218061358832562e-01   -3.059201860832924e-01   +2.063405047996473e-01   -6.132413611641977e-01   -2.180567412167537e-01   -2.874222869896597e-01   +5.102663542414372e-01   +4.715235817876405e-01   +3.735680468669002e-02   +6.098908087674062e-01   +5.486889355423767e-01   -2.650354755480981e-01   +3.140090912372099e-01   +3.800348529430468e-01; -2.639765983738848e-01   -4.945583769028258e-01   +4.285233344380284e-01   +4.449970568972147e-01   +1.099129160976033e-01   -4.155408269453306e-01   +2.458992882617426e-01   -5.957273212779514e-01   -1.628024275962371e-01   +4.904364498287452e-01   -2.034410468098601e-01   +6.811951707789602e-05   +2.716866375605004e-01   +3.188398906251213e-01   -1.531439449531331e-01   +3.882879464625453e-01; -2.402544062255045e-01   +8.329341095470152e-01   +1.334228704472887e-01   -1.300496185718432e-01   -6.169878151386813e-02   +5.696580158322785e-01   +3.322972416740611e-02   -2.217105171506460e-01   -6.263745214220530e-02   -9.010004928967710e-03   +3.484050778518017e-01   +2.596226669653058e-01   +3.071149129003861e-01   -4.735059477010452e-02   -3.594437611918895e-01   +8.587285087558234e-02; -4.099147143525386e-01   +2.636063040368719e-01   +1.378332189128351e-01   -1.993249369667633e-01   -4.382260812101576e-01   -2.730468754669483e-01   -1.868061642899441e-01   -2.861210977112411e-01   +1.752750631694208e-01   -1.504707157450407e-01   +2.743776081017396e-01   -4.026274850942664e-01   -1.524870429474435e-01   -3.149649805328660e-01   -1.883711862975598e-01   +2.424695722159122e-01; +3.912569909314311e-01   +6.009897646081686e-01   -2.556746310655650e-01   +7.114625633533521e-02   -3.413146949532612e-01   +1.739117717087116e-01   +3.286572498254764e-01   -9.659457852197678e-02   -2.729083430035218e-01   -8.625560110136635e-02   -3.210829317608267e-01   +7.133612510539155e-01   -2.981388138787539e-01   -1.797793624899553e-01   -2.228677938763382e-01   +1.616675102828182e-01; -7.309028810291525e-01   -4.208405985299822e-01   +2.271008989336837e-01   -5.466022183601021e-01   -2.842943883739896e-01   -7.143773078460728e-01   +2.154490028071086e-01   +2.303816048830956e-01   +3.828113696591964e-01   +5.430689976287102e-01   +2.163055893955087e-01   -4.958331902456382e-02   +5.014651818572118e-01   -3.694137100753180e-01   +2.787157169527157e-01   -2.095577949143562e-01; +4.352060753803696e-02   -3.117558075052063e-01   -4.570057848002171e-01   -2.053013052248031e-01   +1.284082830490125e-01   -5.103796180035740e-01   +5.959362961982627e-01   +3.549872535072077e-01   -8.505980059987457e-01   +2.265579474686361e-01   -2.153608352529235e-01   +7.079328254685681e-01   -6.580876441238002e-02   -2.188584364230421e-01   -3.847211129461696e-01   -6.329952348625981e-01; -7.082990630634047e-01   +2.599288536632403e-01   +2.738131367690839e-01   +3.275597564130650e-01   +2.656400660369933e-02   +5.682339832985172e-01   -3.470033849930427e-01   +4.196951614691088e-01   +1.851836092881206e-01   -9.962094539486338e-02   -4.675122799895554e-01   -4.824834327221075e-01   +4.801480003319061e-01   +7.671752959735038e-01   -2.531334612169657e-01   +2.110419176859200e-01; -3.354577183138715e-01   -6.111103434140142e-02   -1.188416935031585e-01   +3.089798953228861e-01   +8.276574874718543e-01   +3.077445140961383e-01   -1.127389171570867e-01   -4.672930504824884e-01   +7.878501109431302e-01   -5.458745608034146e-01   +3.049941001788992e-01   -3.281475216321807e-01   +4.713297220363054e-01   +1.104167174679202e-01   +6.002089335076537e-01   -3.270744710350095e-02; +3.484936778669696e-01   -1.496337596446778e-01   +2.173432597580762e-01   -1.481253312877684e-01   +5.826881475864818e-01   -1.432698032137234e-02   +1.112244954845387e-01   -2.848919684687123e-01   +9.879722844661573e-01   +2.974390407306516e-01   +3.478259157635946e-01   -1.789176209591800e-01   -2.498332102665879e-01   -1.365086228625374e-01   +2.673994268786809e-01   +5.040942160884574e-01; +3.875220277160372e-01   +2.331014128128867e-01   -5.211167986636921e-01   +5.452859910434762e-01   +5.413335407924765e-01   -5.949723494252767e-01   -1.369560804710659e-01   -3.599593604450432e-01   +3.521171971024563e-02   +5.370336121040702e-01   -5.516955255257130e-02   +1.000000000000000e+00   +2.621117502045495e-01   +4.092999681180794e-01   +3.323405455703603e-01   +4.808504815388227e-01];
L2I_L1I_iGABA_netcon = [+7.353551791915183e-01   +1.198946831451864e-01   +8.904163659078620e-01   +2.359507505801990e-01   -1.551805088105851e-01   -8.674947682328264e-02   -1.377215286204762e-01   +3.895768472320030e-01; +2.000272129466923e-01   -7.042363247863869e-01   +4.785680761871864e-02   -6.399707543867793e-01   -5.521181201980951e-01   +5.992892905479299e-01   +1.477474681676697e-01   -2.863420084561019e-01; -3.927037244151181e-01   -6.396743149309859e-01   +1.352415011145618e-01   +5.883872179370918e-01   -7.179497145831005e-01   +4.018959071409716e-02   -2.284910423273086e-01   -2.718110630715744e-01; +9.147667624081954e-02   +6.968257186711655e-01   -2.647465600195585e-01   +5.063561023323385e-01   +1.086791173755140e-01   +8.457452941875644e-01   +3.036960499065796e-01   -2.602698183016925e-01; -6.201875362068392e-01   +7.128629087888315e-02   -7.225551695056507e-01   +2.280207161061294e-01   +3.241226166031792e-02   -8.325174070355039e-01   -4.239309340413097e-01   +1.819215883803925e-01; +9.908254363112906e-02   +4.792528647565387e-01   +5.358794261551984e-02   -6.144558992437724e-01   -2.690675564320196e-01   -1.035225000897748e-01   +5.920669759278440e-01   +7.295802768255196e-01; -5.821218157323133e-03   +4.912964004264831e-01   +5.274222006951306e-01   -1.026489620320001e-01   -5.156383655433860e-01   +5.353569425041612e-01   -2.628029840907387e-01   -1.171452209304428e-01; +5.188284113942425e-01   +1.567983305319800e-02   -3.498361901941932e-01   +5.469670389497434e-01   +2.691241200143666e-01   -6.890456663702408e-01   +1.000000000000000e+00   -9.530182952208019e-01; -4.528374199589031e-01   +6.532618001917989e-01   +3.382048574981732e-02   +6.520780103920165e-02   +6.923320156923277e-02   +3.514621989105216e-01   -4.148436319476567e-01   -5.755074796281311e-03; +3.662023706974652e-01   -4.923700028500602e-01   +8.282443073480387e-01   +5.833962219133851e-01   -8.865134583973495e-02   +3.838143061505725e-01   +4.164432466229166e-01   +8.180977717224538e-01; +6.572343568693854e-01   -1.573624353626279e-01   -4.275596324815217e-01   +8.988268878406106e-01   -3.019758581058795e-01   +4.518497802049878e-01   +5.636610993281009e-01   +1.016686085434661e-01; +2.331151653370892e-01   -2.547726539819518e-01   -6.282952758932895e-01   +6.761922561402091e-01   -5.593398769385924e-01   +6.178786243201637e-01   +3.841419728349968e-01   +7.037989348838362e-01; -2.962470679671469e-01   +5.837443068857180e-01   -1.073419446014339e-01   -6.916241888439368e-03   +3.259513686188457e-01   -3.996735588015793e-01   +3.963653789354584e-01   +9.829917309812045e-02; +3.171186615501607e-01   +7.236435223723928e-01   -1.695400644035714e-01   +2.012049811336347e-01   -1.230340534331155e-01   -1.804636898571399e-02   -1.183255973513223e-01   +7.656979007865088e-01; +4.141470373875099e-01   +1.561550371891217e-01   +5.168299016028325e-01   -3.712585484429060e-02   -5.018439335687733e-01   +1.629298507580051e-01   +3.708878020518140e-01   -3.178288425306230e-01; +9.105727827744121e-01   +1.878643349913071e-01   -1.900237027140577e-01   +5.222192538508821e-01   +1.619281906676329e-01   -3.456478531133209e-01   +1.642402636031493e-03   +4.916417147107953e-01];
L1I_L2I_iGABA_netcon = [+5.963562667984901e-01   +1.049896354643949e-01   +3.379249248685916e-02   -3.200468981807911e-01   +1.527900156137952e-01   -1.481180127112786e-01   -1.051647106395072e-01   -9.022717600710247e-01   +5.143242305569885e-02   -6.615537048131155e-01   +4.812471205061145e-01   +5.703825623279134e-01   +2.423362627872219e-01   +8.926807484890601e-01   +4.542994860999024e-01   +4.239426501038807e-02; -1.282336914561563e-01   +7.136068458439372e-02   -3.224582080724907e-01   +2.788990601498561e-01   +3.421944289178193e-01   +3.576594114214021e-01   +1.000000000000000e+00   -3.159851457767308e-01   +8.238323887462158e-01   -2.743432011063528e-01   +3.668507369028121e-01   -6.003414727604472e-01   +7.460670873853518e-01   +8.778561366331042e-02   +6.654679767187686e-01   -4.272464864206302e-01; +7.705187709164527e-02   +7.373392599276291e-01   +3.877388198319697e-01   -3.285699116235273e-01   -2.053188353519935e-01   -1.589371410307070e-03   -1.393835421216300e-01   +5.852418968497086e-01   +3.231642044610518e-01   +1.469555368552236e-01   -4.942588956350947e-01   +2.804470489303750e-01   +6.650573794311624e-01   +5.183723526882549e-01   +9.947519214719273e-02   -4.152713272880011e-01; -5.460885393856931e-01   -5.371402468484520e-01   -8.388262621686506e-01   -2.947516641313506e-01   +2.413265348397733e-01   -3.269759623266998e-01   -3.346265450154493e-01   +4.488158247635096e-01   +1.755057933721640e-01   +3.004637290035675e-01   -3.862070678065764e-01   +7.681815011146312e-03   +5.138082309739614e-01   -2.790421532910779e-01   -2.885683032100303e-01   +3.231012898174924e-01; -9.587796138476073e-02   -3.263282179950800e-02   +2.419293463585188e-01   +5.290475233286930e-01   +4.543979667950946e-01   +1.260024649737479e-01   +1.456710346065827e-01   +3.335544335145902e-01   +6.735112622501118e-01   +4.053950333083369e-01   -2.515454577058021e-01   +5.917248640057751e-01   +3.644643983542344e-01   +4.937930670480245e-01   +3.463064940715834e-01   +9.171402829897872e-02; -6.880284274681391e-01   +4.288932910462154e-01   +3.687556727406945e-01   -3.589775954949320e-02   -5.474159060021403e-01   -6.180376656862833e-01   -8.649682243022935e-02   +4.367142217383025e-01   -5.651494880482195e-02   -7.443952134630806e-01   -5.737296610075796e-02   +4.297158035413231e-01   -3.317937590953597e-01   -6.648621793145072e-01   +6.456262299974992e-02   +6.122614032997351e-01; +8.661707482671988e-01   +2.711908188179666e-01   +6.929332411206075e-02   -2.279486283950648e-02   +5.863838563069819e-01   -3.640557940500630e-01   +9.999626897524320e-02   +9.279286536293394e-02   +3.822138469591647e-01   +2.114910979536164e-02   -1.505469149354678e-01   -1.814888950831097e-01   +6.167077104228875e-01   -5.111437250895202e-01   -2.430790424123682e-01   -5.686844230414280e-01; -4.272183779821237e-01   +3.159880385986570e-01   -1.568788765901609e-01   -6.997554971763839e-01   +5.852143350317587e-02   -6.395498117665858e-01   -3.413322147855636e-01   -1.576807121057017e-01   +3.547846760429660e-01   -3.250092447944571e-01   +2.194169746329243e-01   -2.231938282482068e-01   +1.881432909574792e-02   +3.101965258476147e-02   -5.681756345518793e-02   +4.411822983905697e-01];
L2E_L1E_iAMPA_netcon = [-5.502618023780036e-02   +1.780557709114803e-01   +4.048864644601370e-01   +2.194839323574815e-01   +2.312677972523456e-02   +5.073750021977121e-01   +4.209918879952003e-01   -1.163673780576337e-02; +3.424240925626871e-01   -6.550477099695333e-02   -4.041248502334212e-01   +4.086104263123209e-02   +5.611709155355527e-01   +4.865824110697679e-01   -3.165248950210267e-01   +6.069936685319425e-01; -2.254912301262143e-02   -3.755766508543945e-01   +8.259965361180562e-02   +9.162243447301517e-02   +2.582716834311258e-02   -2.858857539527194e-02   -3.460859096515613e-02   -3.474741849586422e-01; +3.871603955522779e-01   +1.935191410265658e-01   +3.923635196107335e-01   -1.740546916456514e-01   +5.195073626838901e-01   +4.000114421896678e-01   -3.755461736781101e-01   +6.576092050091130e-01; -2.693785098181753e-01   +2.407974848876393e-01   -2.325565107818441e-01   +2.930786289372764e-01   -2.400901924360420e-01   +7.565451000102100e-01   +4.349345506948305e-01   -2.443479767146033e-01; -2.953045853499376e-01   +4.981952329811913e-01   +3.168241605695775e-01   +1.369216477394712e-01   +2.475205395811896e-01   +3.507011497361155e-01   +8.887378376426211e-02   +4.523344164883417e-01; +1.562554437544135e-01   +1.925489934187096e-01   +1.123342949967052e-01   -1.846774399817760e-01   -4.289581745280868e-01   +4.793959953070074e-01   +2.125294822883724e-01   +2.587722617293479e-01; +6.277257378178491e-01   -8.727891127853363e-02   -5.629540121223561e-01   +5.573280085027007e-01   -2.067543443582688e-01   +3.041309370261769e-01   +2.728311769474212e-01   +3.465403538328363e-01; -1.585590641725003e-01   +2.865670282292372e-01   -3.577942187548913e-01   +1.222875036503878e-01   -2.228071723239327e-01   -3.102646583631994e-01   -3.941528832660948e-01   +1.343242184022027e-01; +1.469908993587578e-01   +2.966207157829361e-01   +3.295091641987198e-01   -2.866925870409003e-01   +3.566939787842130e-01   +4.220939012852339e-02   +6.073272647355666e-01   -5.628385239357921e-02; -3.633385061979593e-01   -4.569724701113004e-01   +3.985520546050052e-01   +2.007740435334928e-01   +6.651869380583947e-02   -4.143691073931950e-01   +3.955195316674559e-01   -4.598277992805847e-02; +1.677226176833743e-01   -5.409724598411572e-01   +7.767364415706630e-01   -3.866390749364527e-02   +6.191418224805580e-01   +2.504653792803072e-02   +6.736332478396671e-02   -4.966384810862338e-02; -4.339652853478442e-01   +2.971149821837271e-01   -1.650174479000451e-01   -1.891324679838867e-01   -5.131928550369680e-01   -4.130909712985544e-02   +1.000000000000000e+00   +5.902473535191672e-01; -3.452460974370622e-01   +1.684795338052101e-01   +1.901432986550060e-01   -3.630940966006006e-01   +1.715346751126245e-01   -7.992967529696801e-02   +3.524823866955870e-01   -3.368848465447143e-02; -5.298102368903644e-01   +7.977387011767666e-01   -1.677002457801056e-01   -6.138137952947530e-02   +2.897896538672818e-01   +5.525045437184779e-01   +6.243705933838607e-01   +1.767364871652323e-01; +2.813770879233415e-01   +5.258357565207379e-01   +5.355866626792652e-01   +5.457793551230777e-01   -6.525963855110462e-02   +2.716387173599919e-01   +1.575682626771685e-01   +4.758368058860942e-01];
L1E_L2E_iAMPA_netcon = [-4.420949084483346e-01   +4.306083130292391e-01   +1.142072555515322e-01   -4.965181888284080e-01   +5.777813474412007e-01   -3.938685429928215e-01   +5.048281839170566e-01   -4.260895037157185e-01   +2.397841396434827e-01   +1.719458389635342e-01   +3.474010878808212e-01   -1.608078134241379e-01   +6.338631639317871e-02   +3.231391254169240e-01   +7.250518013238362e-01   -2.168279131309152e-01; +2.274881925832911e-01   -1.429171756838447e-01   -5.837740137133132e-01   -6.691190405695938e-01   -4.864492162897602e-02   -6.826849349121018e-01   -2.294589608207652e-02   -2.818858958216691e-01   -1.532253732168512e-01   +7.658250750552593e-01   -2.612378104716845e-01   -6.559825273582731e-01   +4.358858668553580e-01   +4.313407402451507e-01   +5.814728469046420e-01   -2.474966855077429e-01; +9.472684311631989e-02   -3.572129803576043e-01   -7.665918040899018e-02   -2.740180951606445e-01   +4.897915753406281e-01   -2.318874223695081e-02   +6.626373348574733e-01   +6.814814438506879e-01   +5.394681696494134e-01   +5.256931724712134e-01   +3.514594744614032e-01   +7.149179760663967e-01   +7.766303358676019e-02   -6.165942986953774e-01   +3.802765390055381e-02   +4.517110003780188e-01; +4.034149151985066e-01   +2.967472360181830e-02   -3.478652541546592e-02   +7.630948913650099e-01   +2.355791659615877e-01   -1.657363575490853e-01   -1.092178443235372e-02   -4.522012095004465e-01   +4.036261802842959e-02   -1.028484980956338e-01   -2.756007561678936e-01   +3.548652376021100e-01   -6.872076508092370e-02   -3.963291098115501e-01   +3.686483182852885e-01   +1.550260252563153e-01; +1.745043308756163e-02   +1.281995104186239e-01   +6.198999749321309e-01   +5.850548075692460e-01   +3.491909593452849e-01   +4.215233985221518e-01   +7.030936473939409e-01   +7.209328906868406e-01   +7.835893855884328e-02   -2.294024670734924e-01   -4.716973740242195e-01   +2.982380053787531e-01   -5.597945906654008e-01   -2.638853771112264e-01   +7.794860131964811e-02   -3.789432079548499e-01; +3.291995800428117e-01   -3.704766577470965e-01   -4.198687987103470e-02   -1.561264069819870e-01   -8.290275620079869e-02   -4.888696662664888e-01   -2.005761292500641e-01   +2.514242357024934e-02   +1.389538041770393e-01   +2.315112899718312e-01   +3.595734370082754e-01   +6.841002641680137e-01   +3.155634802587365e-01   +6.696793073493071e-02   -3.689451449187169e-01   -9.048495548789017e-01; +7.393416845576941e-01   +6.277814879396700e-01   +3.110497036405024e-01   -2.013235187002130e-01   -3.960525678719995e-01   -2.179853376933425e-01   -2.636731555603479e-01   -5.933020642109677e-02   +2.529421045286266e-01   +3.453870663831535e-01   +6.576644348483177e-01   +4.543712265543855e-01   +4.191196128218669e-01   +3.472781968093877e-01   +7.155019580818742e-01   +3.613236986610662e-01; -1.875611840216593e-02   +1.000000000000000e+00   +1.607643131257395e-01   -1.137095909839906e-01   -2.293295951992570e-01   +3.830268190351021e-01   -2.022813340763896e-01   +7.025928008093102e-01   +4.000969091663114e-01   -5.526998863954561e-01   +7.968902526348601e-02   +2.241256106124569e-01   -2.305593020795906e-01   -9.041560393918535e-02   +5.618024405343974e-01   +6.329550625614729e-01];
L2I_L2E_iAMPA_netcon = [+1.318385759448418e-01   -4.163811117841696e-01   +8.776896003816143e-02   -6.878039590209832e-01   +2.303088549812747e-01   +2.700232649749242e-01   -9.564799255691001e-02   +7.363823200775204e-01; +7.238254706126487e-01   -6.178950957624438e-01   +2.930832595357691e-01   +8.379019095323214e-01   +5.446845374862298e-01   +1.314291585394980e-01   +2.810722782641369e-01   -2.391541931406865e-01; +2.381165771661679e-01   -2.566656207379951e-01   +1.055877703098655e-01   +2.695899000204635e-01   -3.714991602469414e-01   +5.140450409131505e-01   +4.330267147856580e-01   +4.191229652048301e-01; -2.883580345898833e-01   +3.333564362287664e-01   +5.001173083653565e-01   -5.524528216050241e-01   -1.992437304100210e-01   +2.272308268950509e-01   -1.287441471024784e-01   +3.787901332701411e-01; +1.449056861290699e-01   +2.935153933617409e-01   -2.502640905502728e-01   -3.390394904467415e-01   +7.280401242001464e-01   -2.460387067760848e-01   +5.009630384133700e-01   +3.230086393481516e-01; -1.225959598843697e-01   +5.601911621869150e-01   -2.738024869154564e-01   +6.003385292373755e-01   +2.477661346050619e-01   -9.121304722217735e-02   -1.051357658554737e-01   +6.453247543530960e-02; +1.862848608396619e-01   -2.855765951259172e-01   +7.155492340135067e-01   -6.882832478546075e-02   +2.700329589527256e-01   +1.000000000000000e+00   +5.581466674375488e-01   -1.864541609644122e-01; -5.805140150580004e-01   +3.122962843422643e-01   +1.120262249404730e-01   -1.669803460907240e-01   +6.367941589633423e-01   -1.535320456361038e-01   +5.343972361000446e-01   +3.316566754658267e-01];
L2E_L2I_iGABA_netcon = [+5.222987216917603e-01   -6.701241670216003e-01   +2.666651732125991e-01   -2.174849447970910e-01   -2.305825559264168e-01   -4.994376358258701e-01   +9.589022195676499e-01   -2.525035109624247e-01; +5.663065416455649e-01   +1.968086594594897e-02   +1.897278501925955e-01   +2.801366889170575e-01   -5.058744909400843e-01   -6.375588370016705e-01   +4.354292592761805e-01   +4.169102485955880e-02; +7.138884345643712e-01   -4.008236757390606e-01   -3.560538540969292e-01   -2.921402481176099e-02   -1.992709550596732e-01   -3.264705446143508e-01   +8.665914981515208e-01   +3.506818705674693e-01; +3.406580119860527e-01   +1.335639561791427e-01   +4.682534802051354e-01   -3.493295765294863e-01   -2.077003638768868e-01   -1.664790890234432e-01   +4.901582005666368e-01   +5.880796778146350e-01; +4.226448971553058e-01   -5.713062624448429e-01   -7.818958912391660e-01   -2.334485938501852e-01   +1.582521054330317e-01   -4.854718813337122e-01   -4.406930797757933e-01   +9.289194588107025e-01; +9.433018535607934e-01   +3.843509549133912e-01   +6.005184748806975e-01   -4.274419935826169e-01   +1.134436428597413e-01   +1.377063623728020e-01   -5.159716012023745e-01   -2.975905766898079e-01; +2.630599435876492e-01   -5.416678025370011e-01   -3.620062975360304e-01   -4.052363652555538e-01   +2.597970720218601e-01   -2.344602217646224e-01   +4.359993165370970e-01   +2.356653581943974e-01; +4.618104583807376e-01   +9.772884162015542e-02   +2.908165360601956e-01   +4.569603686612957e-01   +7.114515034135954e-01   +1.115140466540442e-01   -1.570090579955778e-01   +1.000000000000000e+00];
L3E_L2E_iAMPA_netcon = [-6.762401307261591e-01   +1.074797724132003e-01   -2.757682534380254e-01   -2.137911442676317e-01   +3.463544813577183e-01   -1.858796118801767e-01   -5.282334366559074e-01   -8.139163542127142e-02   -4.272922608540340e-01   +3.124888644353578e-01   +1.299667608148816e-01   -3.058840347706056e-01; -5.095178200811045e-01   +6.146755473249436e-02   +5.526934218950479e-01   +6.046657151485585e-01   +6.891864804046732e-01   +5.613424300677054e-02   -3.276141888199390e-01   -2.270099368191120e-01   +2.651993715375114e-01   +3.510512401107679e-01   +2.641134491460759e-01   -1.769968437626676e-01; -4.130708505753320e-01   -1.965101703066603e-01   +1.790604912659110e-01   +4.438399754046248e-01   +2.413679612252987e-01   -2.119472812323339e-01   -2.720563481746635e-02   +1.706664122534382e-01   +2.603871922273850e-01   +4.240138006264954e-01   -1.878034456958280e-01   -4.493946644090663e-01; +1.000000000000000e+00   -2.235096198597182e-01   +2.289025916125495e-01   +5.620491349033531e-01   -1.443155924742372e-01   -2.199812471520424e-01   +7.607049279201879e-02   +5.359171121054973e-01   -3.252722851725410e-01   +6.696779627632981e-01   -1.401701549503956e-01   -1.483787371438766e-01; +3.490586649419566e-01   +1.780810683356395e-01   +3.336783369648754e-01   +7.112824831850473e-01   -2.146376280319124e-01   -7.226838166456132e-01   +5.330209834815410e-01   +4.427801657397793e-01   -1.782008980830840e-01   +7.968128905520441e-02   -1.257991924074301e-01   +3.260924498518998e-01; +1.281526106633071e-01   -1.502333189859216e-01   -3.657093899630443e-01   +4.647251206008018e-01   +5.973425170190558e-02   +9.913588011474607e-02   +2.465531973624465e-01   +1.594044786393783e-02   -2.355217288582493e-01   +3.373327608816243e-01   -5.031887979672930e-01   +5.429929173347543e-01; -4.103157482383286e-01   +2.834683381488303e-01   -2.539596142185966e-01   -4.445961866494108e-01   +1.093362053694794e-01   +4.123219336165281e-01   +8.500277879726373e-02   +6.181738229990891e-01   -2.292528508251344e-01   -4.437133307883192e-01   +7.082476212901456e-01   -3.471632048958425e-01; -3.527495981209993e-01   +5.214107337748325e-01   +7.760702504129433e-01   +7.604960547855376e-02   +8.714024990906690e-01   +6.135781984066613e-01   +6.301201209382014e-01   -1.731687053026618e-01   +6.982591355520447e-01   +5.365825099353375e-01   +2.204666960993854e-01   +2.867484294729319e-01];
L3I_L2I_iGABA_netcon = [-4.645086182011890e-01   +6.692398256040996e-02   +6.339361577310325e-01   -5.208757688692885e-01   -6.287455861299246e-01   +4.391262732222468e-01   -8.660424168076118e-01   -1.249890536726931e-02   -1.938260179280250e-01   +3.518521738718245e-01   -4.622569360861073e-01   +5.550011355777086e-01; -4.970534940294597e-01   +7.866641628090579e-01   -1.928362563955792e-01   -3.582970871898419e-01   -1.809997155592281e-01   +6.857932579356736e-01   +8.421073303120030e-01   -4.486603045624998e-01   -2.667070465491433e-01   +1.770249048777580e-01   +2.431853649462516e-01   -2.362129894693683e-01; -6.134760761885973e-02   +4.208305336918763e-01   -3.837000346402826e-01   -5.090249623664086e-01   +1.455660335012292e-03   +8.320506272348211e-01   +6.819634708699166e-01   -2.929748873038816e-02   +5.680408635197838e-01   +6.661130318926033e-01   -2.910834317975205e-01   -6.827503699007739e-01; +2.218236245895681e-01   -3.085422467987982e-01   +6.670701878877899e-01   -4.609720553139688e-01   +9.509128031984917e-01   +5.336762671706948e-02   -1.454037764544138e-03   -7.943317806904099e-01   +5.509607852669056e-01   +5.674197107126818e-01   -1.123177337636243e-01   +4.636877333161598e-01; -1.702784740006165e-02   +1.463868406881438e-01   +8.198005905900169e-01   +6.559293402515889e-01   +3.601223402906300e-01   -6.281002880746434e-01   -7.513853851874849e-01   +3.840706794934228e-01   -2.472795499952397e-02   -2.713324215286244e-01   -4.202501966287762e-01   +3.283316790650381e-01; -2.587638708365146e-01   -1.000000000000000e+00   -7.166781994625110e-01   -5.697548348994708e-01   -2.641299165994533e-01   +3.340204524938440e-01   -5.477373047680125e-01   +7.889113024804054e-01   -4.743730783354572e-01   -6.040846445292479e-01   -4.964614144068814e-01   +4.493737738212241e-01; +4.092049732862373e-01   +3.030825578186547e-01   -4.582151777245771e-01   +3.985443179757913e-01   -1.136361954524712e-01   -4.759154306840254e-02   +9.382573339320958e-01   +8.525758569960707e-01   +6.202021678092895e-01   +7.241536663479723e-01   -1.238757927901241e-01   -6.957856743331210e-01; -3.009504054702706e-01   +5.973562357939507e-02   +5.482070256168208e-01   +5.660304487602831e-03   -6.620098950025526e-01   +9.177978952821358e-01   -4.502049109444947e-01   -6.112013366191945e-02   +4.350467762115075e-01   +4.196876265135915e-01   -1.474050199868315e-01   +5.783402697048823e-01];
L2E_L3E_iAMPA_netcon = [-9.266728317035287e-02   +5.991720469180174e-01   -6.772471096191224e-01   +9.925421766360067e-01   +2.463065313509749e-01   +1.892091486509414e-01   +4.097543664180250e-01   +5.155012138988840e-01; -9.011215148413947e-02   +5.738418432530303e-01   +8.451436066797627e-01   +3.590679312934089e-01   +7.818474128464405e-02   +5.823060938768239e-01   -2.119876339748574e-01   +4.306815238581643e-01; -2.809202368901572e-01   +5.269679541514444e-01   +5.180983249904120e-01   +2.224412921260200e-01   +4.923919838117970e-01   -2.619556291701569e-01   -8.155303682428899e-01   +4.496454429375501e-01; +5.100256198948215e-01   -3.632425142390760e-01   +8.288831039140299e-01   -5.855186434680125e-01   -5.845708998654412e-01   +1.401137701483464e-01   +1.028733028561991e-01   -2.601448913928192e-01; -1.142772293015360e-01   -4.577585163673306e-01   +3.972480020397411e-01   +6.070111050721749e-01   -5.514655177054748e-01   -3.526452525889118e-01   -3.008757966920464e-01   +4.670827066391622e-01; -8.181183456318922e-01   -2.516810337458678e-01   +3.410681962576479e-01   -4.461738826886612e-02   +8.661486534425045e-01   +5.959315298262439e-01   +2.784522415039618e-01   +8.044254361615751e-01; +8.427260377630262e-01   -6.482075342467986e-01   +6.673808969320978e-01   +1.000000000000000e+00   -9.627741470401981e-01   +4.094146705084599e-01   +1.648060872890832e-01   +6.528910272602823e-01; +1.115515136895554e-02   +6.717993660384636e-01   +8.188313624730541e-02   +4.001040999165395e-01   +7.223060620128782e-01   -3.430005651655715e-02   -1.790638646860687e-01   -1.313511054479598e-01; +2.449240327668467e-01   +6.082208577370227e-01   +3.006268210953895e-01   +1.755407069317177e-01   -1.096218969434407e-01   -4.981145213040934e-01   -2.975262999715124e-01   +3.820025058426941e-01; +6.909436626926641e-01   +6.395790161713963e-02   -3.359179591393254e-01   -9.519571224400175e-01   +6.177198475445915e-01   +7.425632311809935e-01   +3.134139270332311e-01   +1.652551424582557e-01; -5.802903040908437e-01   +2.042897224405472e-02   -2.772565297422723e-01   +3.481582101180303e-01   +5.008898635761462e-02   -3.047476596005819e-01   +6.320545701730462e-03   +5.041803082595652e-01; -5.264570203266434e-01   +3.729537640717378e-01   +2.712714709112983e-01   -6.878792362899602e-02   -1.764112261433672e-01   -4.655959745922164e-01   -4.642826198254328e-01   -3.379925967594845e-01];
L2I_L3I_iGABA_netcon = [-4.060307674821302e-02   +3.584535837740510e-01   +1.612150998716056e-01   +3.194959700445054e-01   -5.324207488719027e-01   -9.884788662067373e-02   +1.946536711762209e-02   +1.894043858054965e-01; -3.632156493788607e-01   +4.065740105367188e-01   +5.871140084543154e-01   +7.447571181023752e-01   +1.465998560876129e-01   -5.627377506661563e-01   -1.836886162535750e-01   -3.181163799492374e-01; +2.120870299198124e-01   +6.283687732027804e-01   +1.974207341567699e-01   +6.985552199162126e-01   +2.270475570449481e-02   +2.962835362544402e-01   -3.859313451591246e-01   -6.012395680799027e-02; -5.836682905524160e-02   -2.704019644895491e-01   +5.851685217232040e-01   +1.756942766303077e-01   +5.337828188745201e-01   +5.365600499975007e-01   -3.539976803655352e-01   +4.023381255021891e-01; +4.808378416988325e-01   +2.151683186075502e-01   -2.446206427780787e-01   +4.078844923499219e-01   +3.641860649698385e-01   +5.256753658112606e-02   +5.126431392860110e-01   +8.738445827701981e-01; +5.912949163614772e-01   +2.119540188147336e-01   +7.567026319772194e-02   -2.442345130959210e-01   -3.585506570975383e-01   +2.774902707994650e-01   -8.708008103405133e-02   -8.134451855900095e-02; -1.209355516978507e-01   -3.907349162372027e-01   +5.835163030380568e-02   -4.228665222619488e-01   +6.591323775667605e-01   +3.686355382231787e-02   -4.947939902302198e-01   -4.169938486880655e-01; -2.312100126156175e-01   -5.112557576597331e-01   +3.333497442523994e-01   -2.774205348140582e-01   -4.025316646712146e-01   +4.544282894353857e-01   -2.364964367819641e-01   +2.009649103130334e-01; -2.653046438568341e-02   +2.162911800041825e-01   -4.834812591591787e-01   +2.548743262304574e-01   +4.011036852950287e-01   +4.154933600144558e-01   +1.628280523610205e-01   +2.057442668459188e-01; -4.236152794776682e-01   +2.313587949107984e-01   +1.000000000000000e+00   -7.745412298599759e-01   +4.173190474996458e-01   +2.199741027692253e-01   +1.275015186686153e-01   +3.860279099548539e-01; +1.894945453182438e-01   -2.303944348379838e-01   +1.620031847504972e-01   -4.509407549908825e-01   +2.645173671753190e-01   +3.786674406656291e-01   +5.075162968438401e-02   -3.074799822128478e-01; -3.700809592608967e-01   -7.180722880240729e-01   -4.928113318186083e-01   +3.836357148156556e-01   +5.345792078972452e-01   -2.531598365690469e-01   +8.373025310193094e-02   +1.276882587643225e-01];
L3I_L3E_iAMPA_netcon = [-9.461797555623258e-02   -2.719681864258467e-01   +1.694291901499034e-01   -4.307081432011646e-01   -4.285579817193789e-02   -2.614172804238504e-01   +9.798451061709784e-02   -8.246739462495818e-02   -3.191777391892770e-01   -1.846511364235375e-01   +2.130656734019315e-01   +1.838405849701876e-01; -1.284539754763968e-01   -2.221265992146938e-01   +8.608429656620475e-01   +5.443785694988166e-02   +7.633363920664321e-01   -6.065238969157692e-01   -4.897929306401911e-01   -3.224366355510054e-01   +8.072071128423809e-01   -1.489260751177326e-01   +2.498692242162541e-01   -2.484385339961087e-01; -1.997633662115001e-01   +5.889859890367548e-01   +2.604344554086216e-02   -1.524153923111141e-01   +9.413841259685681e-01   -5.155975261911470e-01   -7.824991590019158e-01   -7.130823440746425e-02   +6.420007488553796e-01   +3.334470487792635e-01   -4.134582141302459e-01   -4.375959518971027e-01; -6.230745306755495e-01   +3.374004573459501e-01   +3.804308895899430e-01   +3.335441892811543e-01   +3.742933210884437e-01   -4.842807917442140e-02   +7.754385610532195e-01   +4.888031963340904e-01   -5.836968269321282e-01   +1.171365791557669e-01   -7.072377821296847e-01   +1.000000000000000e+00; -3.550017726242759e-01   +2.381179487184458e-01   +2.406579478980848e-01   -1.951270148344673e-01   -2.702416931291507e-01   -3.559290597819003e-01   +1.543972890090636e-02   -6.889925513043885e-02   +6.300936744066292e-01   +6.359723528778422e-02   +1.824906893884438e-01   +1.098199513667712e-01; +1.900075959716229e-01   -3.394406267922029e-01   -1.688685774519354e-01   +6.118048055859779e-01   -5.748569910600083e-01   -5.467478359074552e-01   +5.695062753441735e-01   -1.573974173266268e-01   +3.612617685674431e-01   -7.271789683841580e-02   -2.098763376272994e-01   -7.248747696031894e-01; +7.427761607931582e-01   +8.487176599025796e-01   +3.372237556770619e-01   +6.126546088693938e-01   +6.898632268218345e-01   +1.637631816728565e-01   -1.125527478530805e-01   +9.437823377504435e-02   +7.669302927943006e-01   -2.880265384287207e-01   +3.702437498032331e-02   -1.604774242489149e-01; -2.796576117023098e-01   -7.046748648292842e-01   +6.092448598243332e-02   +3.704470370839537e-01   +4.749665427715725e-01   -2.131179271317303e-01   +2.882283732585880e-01   -3.796146349662248e-01   -5.875750011334261e-01   +2.392753381296530e-01   +6.651027001405789e-01   -2.375357566434489e-01; -4.898068822200977e-01   +1.950686863611652e-02   +6.192919148701849e-01   -1.749581154998482e-01   -2.826998415525026e-01   -1.184560285124384e-01   -5.625058339174455e-01   +2.263666763236028e-01   +7.765311576170165e-01   +5.894768644928682e-01   -5.892060983713480e-02   -6.307401969460033e-01; +5.911118631289204e-01   +7.160807422265638e-01   -3.604721034652382e-01   -1.675434665852769e-01   +1.002577655556268e-01   -3.529664976085101e-01   +6.434946098069945e-01   +5.694952739868971e-01   +1.823211633166814e-01   -1.909675516507556e-02   -5.264421590996450e-01   -3.677981949744469e-01; +6.052926035308469e-01   +8.443476280118078e-01   -4.967243375688613e-01   +3.563016944403709e-01   -6.067682695513190e-01   -2.715825479768392e-01   +9.780532781769086e-01   +6.393007425690292e-02   -2.586710432781592e-01   +2.610710920841029e-02   +5.412470399612648e-01   -2.698505049793949e-01; +8.644403731850438e-02   -3.233020838914604e-01   +8.494432859275790e-01   +5.722000362206326e-01   +7.288294380525332e-01   +5.084407841546625e-01   +3.763905058536867e-01   -5.087256193869173e-01   +3.934172487302019e-01   +2.397260579895010e-02   +1.885151556553263e-01   -1.604091569741897e-01];
L3E_L3I_iGABA_netcon = [-4.381603178718559e-01   -4.195527441476167e-01   +5.282171108741939e-01   -3.456996894802470e-01   +9.782082933263127e-02   +6.019946511213500e-01   +1.453267592165763e-01   +5.619304683236017e-01   -1.612477106927322e-01   +4.444354748933311e-01   -4.608509900882254e-01   -5.202949261867674e-02; +2.063059915500734e-01   +5.747382256065538e-02   +4.646354503343260e-01   -4.108922727520784e-01   +3.960513179603326e-01   -1.215734144572970e-01   -3.753719436338581e-01   -1.246998748586807e-01   -2.392544084897541e-01   -5.845016520328069e-01   +5.379947964849542e-01   -1.205614071223824e-01; -2.098545819493219e-02   -3.570406796955193e-02   +4.801797995081055e-02   +4.059567769269629e-01   +4.987351047186819e-01   +4.252542128980602e-01   +2.028333243442168e-01   +3.034085486501906e-02   +1.740085396702048e-01   -2.426383277073907e-01   +4.341825623877932e-01   +4.462776989662649e-01; -1.837274959807207e-01   +2.709551880085859e-01   +1.813933593237358e-01   +1.138562090154509e-01   +5.715714041781681e-01   -2.773264023089536e-01   +1.075749784277326e-01   +9.619184054069192e-01   +7.623432787843517e-01   +7.213663186044235e-01   +3.663400606309754e-01   +6.064264526168691e-01; +4.670984136237057e-01   +2.270559998136920e-01   +6.620758291997933e-02   -7.842737092911485e-02   -2.114279079845575e-01   +7.657077884095468e-01   -2.587584261929092e-01   -4.405401286948107e-01   -3.782342444585468e-01   -4.248764082308816e-02   +1.241005707437467e-01   +7.435356409867211e-01; +4.070341543229254e-01   +1.235228611246966e-01   -1.388545481591455e-01   +2.588644315627404e-01   -6.705787038836123e-01   +3.810138934032644e-01   +3.766721504342779e-01   +4.880662650982612e-01   +7.669111110404800e-02   -3.812021014146351e-01   +4.798587843856485e-02   -8.738913282625899e-02; -7.300124630605374e-01   +8.779399326821902e-04   +4.982420656823251e-01   -3.033656461162826e-01   +3.079854653962545e-01   -3.844898503588151e-01   -3.929992617745943e-01   +1.000000000000000e+00   +3.965072841024904e-02   +6.778888751234280e-01   +2.972902486030654e-01   +4.676652560515429e-01; -1.961560195610840e-02   +4.238995857688993e-02   +1.129843014749024e-01   +8.385719175708943e-02   -1.860872662399002e-01   +2.996792298074766e-01   -7.325219841003576e-03   -1.074506847165497e-01   -1.833959533019576e-01   -1.219480482181592e-01   +4.582019680242161e-01   -1.386938757261412e-01; +2.642903537883049e-01   -3.672309784155303e-01   +4.824967467818293e-01   +6.053160533066344e-01   +5.952563234780583e-02   -4.808104036920044e-01   -1.782448525941604e-01   +1.771219682637163e-01   -7.014715829461103e-02   +1.696584326309646e-01   +6.372859264611118e-01   -3.838327080639515e-01; -6.780925093465771e-02   -3.542453191215205e-01   -3.520444759906273e-02   +3.890759319636595e-01   -6.856969467260937e-01   -2.966042738225656e-01   +2.875118178519282e-01   -2.682488391137464e-01   -6.023887657451500e-01   +2.551000121296206e-01   -5.521934863268525e-01   -7.253123585445752e-02; +2.943716507069346e-01   -5.502410268916537e-01   -4.158684527895972e-01   -3.158937867918227e-01   +1.075043617985017e-01   -2.716647584586138e-01   +3.842610920032726e-01   +1.395967296622299e-01   -5.562828116143258e-01   +5.245323287798882e-01   -4.236959762850020e-01   -1.678122771755344e-01; +3.409202324226024e-01   +1.398052626461445e-01   +2.339730212029338e-01   +2.455752839012123e-01   +6.698610612795777e-01   +2.511337809369650e-01   +4.865431609333957e-02   +5.062241469493083e-01   +4.710061922372306e-01   -2.406216295607740e-01   -2.360270993267279e-01   +6.408036492514672e-01];
L2E_Input1_iAMPA_netcon = [+8.737786822265561e-02   +6.589519901806521e-01   -1.867081864409312e-01   +3.919377016586447e-01   +5.719813482833958e-01   +9.319885826207464e-03   +6.563464361966502e-01   +1.000000000000000e+00];
L2I_Input2_iAMPA_netcon = [-5.934738744861745e-01   -5.721130948736082e-01   -4.037548984269491e-02   +5.714242593820448e-02   -3.412014288913820e-01   -9.953722353311106e-02   +5.913258564651652e-01   +4.036865121580652e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.04*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.4*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.1*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.4*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.1*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.4*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.04*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.4*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.1*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.4*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.1*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.4*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
