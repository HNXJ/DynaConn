function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+7.130495609787294e-01   +9.510424094318561e-01   +6.968394393373515e-01   +1.672457697700488e-01   +9.164874735090689e-01   +2.160879696658835e-01   +7.414044226065372e-01   +3.092702940129463e-01   +5.414346482150774e-01   +8.430312066667096e-01   +9.753465858370535e-01   +9.712127497889368e-01   +6.983158941423282e-01   +3.656694054692997e-01   +2.972312614565042e-01   +3.846470658181807e-01; +3.470412347241927e-01   +9.595484194400213e-03   +1.397983598772422e-01   +1.708595609114581e-01   +7.508699260216693e-02   +8.135253612931275e-01   +7.958244129124056e-01   +7.578697107109964e-01   +7.924670052595124e-01   +1.929418288379127e-01   +4.708365393341700e-01   +6.654751067333116e-01   +3.683944336571406e-01   +2.755970713570597e-01   +6.910046578476936e-01   +9.676198353179630e-01; +2.046899473864752e-01   +4.767665240660217e-01   +8.643981829970926e-02   +7.049912903767760e-01   +3.189037671147346e-01   +3.814844763803987e-01   +6.570295805871297e-01   +9.570888216632808e-01   +5.231295282033366e-02   +9.257468391698738e-01   +8.692804670738533e-01   +2.025888674229852e-01   +5.490100052858672e-01   +7.484271042997874e-02   +7.845156096837831e-01   +8.106648657697884e-01; +2.610038592083536e-02   +4.878996669098239e-01   +4.263347914970435e-01   +8.370603763952941e-01   +6.369622471646700e-01   +8.583685008488620e-01   +4.391017225144887e-01   +5.037287448462581e-03   +4.641159197771460e-01   +4.225514810604672e-01   +9.439927859623735e-01   +9.017855279359513e-01   +5.124506516258341e-01   +1.590673185267335e-01   +7.133399739808690e-01   +8.923240077220518e-01; +7.699387964737858e-01   +5.145403845178671e-01   +9.014722695405939e-01   +8.497417239021647e-02   +9.043455043579801e-01   +3.219850697076427e-01   +5.808825111043300e-01   +3.987069348629727e-01   +9.372335957553419e-01   +3.035521795235882e-01   +2.446952758025265e-01   +4.802095219243528e-01   +7.702497418285651e-01   +3.617015498780510e-01   +2.715455911065174e-01   +6.741292185093656e-02; +5.698006560563631e-01   +2.921637333043604e-01   +7.156098889307897e-01   +8.359902744865378e-01   +8.002123835574725e-01   +3.785835294932657e-01   +5.131122516413722e-01   +1.577219008274602e-01   +4.824123782692523e-01   +3.543452328458282e-01   +9.237132368991605e-01   +6.714763090826703e-01   +7.597742242761792e-02   +7.159245386998762e-01   +1.774426318481170e-02   +9.013422441004316e-01; +5.797152938672380e-01   +5.578962458892255e-01   +6.869695592664442e-01   +5.527551437834798e-01   +6.475737363957214e-01   +6.434530801442118e-01   +7.297862570059727e-01   +8.294348575594226e-01   +7.822669090517124e-01   +9.784475080919980e-01   +6.361572057839906e-01   +5.317667554570299e-01   +4.496152245331475e-03   +5.416959200396225e-01   +1.379822627466515e-02   +6.751899206094696e-01; +3.897155581991419e-01   +5.221965595189544e-01   +2.037903722376510e-01   +9.654339788949365e-01   +4.475684490873618e-01   +3.940994226428624e-01   +2.228551932679667e-01   +2.854047616546779e-01   +1.120184371521111e-01   +5.367010383499458e-01   +2.872043237413330e-01   +7.073394371720243e-01   +4.004123746292622e-01   +2.322940337863027e-01   +9.281452723722425e-01   +3.461151014588135e-01; +5.511191008271460e-01   +6.734379430824551e-01   +5.252531217639445e-01   +6.710931542210625e-01   +7.483544286766078e-01   +7.268314381794241e-02   +9.986270761047671e-01   +9.837225845690515e-01   +5.233672805917423e-01   +7.991135615460008e-01   +8.508791452807041e-01   +7.157153066995202e-01   +6.638550652523979e-01   +4.656797558185101e-01   +9.349638596680265e-01   +8.410909159952784e-01; +1.862053098359625e-01   +6.195275278048515e-01   +8.204163376900143e-01   +3.408988714310933e-01   +8.288622448222084e-01   +1.435467435676364e-02   +6.213810602963461e-01   +6.266431019406392e-01   +6.392712561598178e-01   +8.023411810344108e-01   +1.643929096573346e-01   +3.007097998980551e-01   +3.742700049059706e-01   +7.211044506824283e-01   +3.695163008970538e-01   +1.963347724062501e-01; +1.158454561188614e-01   +5.672887408857210e-01   +1.835676882936671e-01   +2.117803356335688e-01   +3.481999058500257e-01   +8.762699464191833e-01   +9.956407649384640e-01   +7.425547583153305e-01   +5.802050672133509e-01   +1.382313681832517e-01   +8.262104281905801e-01   +1.071237000760848e-01   +3.986682261681165e-01   +5.192600230342515e-01   +1.029146651552790e-01   +8.469166665717056e-01; +5.560532872737887e-02   +5.073451023063561e-01   +5.153307681355142e-01   +5.684421689966271e-01   +1.540777443622637e-01   +1.621134598451744e-01   +4.940615205550066e-01   +8.837926421618676e-01   +8.390805449531181e-01   +4.535270927140385e-01   +2.179435657554506e-01   +3.339731272186875e-01   +1.405498446692159e-01   +5.108206701503363e-01   +7.201927437951005e-01   +4.266298313638194e-01; +9.362908772783265e-01   +6.689949180438648e-01   +3.542850498206321e-01   +1.901700949779865e-03   +5.031370181409247e-01   +9.205426903641801e-01   +5.323501145762817e-01   +3.346201933548791e-01   +1.137540721936134e-01   +4.550785733400867e-01   +2.762032600765636e-01   +4.607853989531058e-01   +3.413887216767692e-01   +3.986500393209877e-01   +4.556623983749822e-01   +5.576344539317606e-01; +7.449773412614277e-01   +6.347126555566532e-01   +6.537621847042696e-01   +5.922168720698745e-01   +4.089262598573005e-01   +5.643839853437643e-01   +8.619814455052115e-01   +9.490967108790985e-02   +5.454116907421350e-02   +9.633427009802745e-01   +9.200008045100841e-02   +7.196534646264394e-01   +1.233885006256919e-01   +4.780169650536422e-01   +1.133600627691939e-02   +4.458337798252727e-01; +2.373709405466220e-01   +1.468782265831557e-01   +2.846513283390575e-01   +8.980295150853258e-01   +1.736819267570264e-01   +9.257021896345188e-01   +2.531387745203391e-01   +4.454526188694576e-01   +5.189855023809324e-01   +5.054207902377594e-02   +9.192391435031966e-01   +4.025803718169713e-01   +3.713934862696040e-01   +7.466506760944400e-01   +1.189048581410798e-01   +7.631544318410942e-01; +2.031356976265362e-01   +1.838153211481253e-01   +4.356248293675150e-01   +2.575669337529236e-01   +4.965084973601060e-01   +5.978549199321522e-01   +5.772441916495070e-01   +2.398280139937972e-01   +7.031462925942018e-01   +3.720402313381106e-02   +7.299605665175004e-01   +2.448543765419293e-01   +2.459069247497902e-01   +7.043417964827595e-01   +6.641671835200629e-01   +9.682302144503799e-02];
L1E_L1I_iGABA_netcon = [+8.464773712618450e-01   +7.543014964405929e-01   +8.719301209877794e-01   +4.369146806460325e-01   +9.219247125370554e-01   +7.734995100409694e-01   +3.250988695713906e-01   +6.421468612080403e-01   +9.346865942627285e-02   +2.814388640862621e-02   +1.285820686861452e-01   +5.193564052806898e-01   +8.819721843176560e-01   +5.738073879206406e-01   +1.722032366018695e-01   +6.435572808717669e-01; +6.198558911336396e-01   +9.976022767547369e-01   +3.138610447071989e-01   +1.415198278975364e-01   +8.971330093187971e-01   +2.796987845355799e-01   +9.687632311270843e-01   +4.440254357966298e-01   +2.961783118732569e-01   +5.106828016221938e-01   +4.381887146652336e-01   +2.053477901975874e-01   +8.065403108182685e-01   +2.942794899659543e-01   +5.224081349885165e-02   +3.393079950755351e-01; +6.686218725807898e-01   +3.711411702996203e-01   +4.297793704618315e-01   +6.567648879702509e-01   +5.876499537922810e-01   +5.214812902858702e-01   +3.556344263168764e-01   +4.843671800473205e-01   +3.326570611930370e-01   +8.701068916401410e-01   +4.825799769618521e-01   +7.777138007104708e-01   +6.501037932953115e-01   +1.450266627927530e-01   +2.252050336995788e-01   +1.523289523196562e-01; +7.854996363042541e-01   +5.096288744215000e-01   +3.801172282111078e-01   +7.332636743866259e-01   +8.378509743917540e-01   +4.158923172382860e-01   +3.208563670953943e-01   +9.784943383287675e-02   +4.796141948441889e-01   +5.805238010403522e-01   +6.811067466874059e-01   +3.881836234605305e-01   +7.370208954304459e-01   +4.728930861532540e-02   +2.009386657994560e-01   +4.018407465828470e-01; +3.156573353872008e-01   +7.607236944774692e-01   +6.576435094687964e-01   +1.721029409003932e-01   +7.861636044669930e-01   +7.856251523834792e-01   +9.170343151754716e-01   +8.080834450454664e-01   +2.418381101274782e-01   +4.235988742829611e-01   +3.507338081860268e-01   +6.628230138382911e-02   +6.684602221955070e-01   +6.209940313935082e-01   +2.096982570505407e-01   +9.200614948069101e-01; +3.248456407532667e-01   +1.365367732499286e-01   +2.464206329499700e-01   +3.400369431122290e-01   +7.942397275857924e-01   +2.678976202023031e-02   +8.851408137874819e-01   +6.316097755546678e-02   +4.597108366751849e-01   +7.262618475717729e-01   +4.763034981786719e-02   +7.525098939466179e-01   +8.883583046650212e-01   +6.079338525735578e-01   +5.856103051093662e-01   +1.570898146307096e-01; +6.270839423898283e-01   +5.187279919261852e-01   +6.894987867936802e-01   +1.013682484026086e-01   +6.989993993620968e-01   +4.065359633240069e-01   +3.630994789829317e-01   +9.559583331638815e-01   +7.572198665913037e-01   +2.271651359422701e-01   +2.928747239542518e-01   +4.604174766846495e-01   +8.551138519160236e-01   +3.736739074866673e-01   +3.383016418510978e-02   +4.645083527145848e-01; +9.045467096936286e-01   +9.114830040506752e-01   +3.293213459056824e-01   +4.394450680657778e-02   +1.429449330613260e-02   +8.327292535022662e-01   +7.421732049739956e-01   +7.773888380128786e-01   +7.170791598836972e-01   +5.822474972123549e-02   +8.094036866975060e-01   +3.103678207172687e-01   +4.088890367769494e-01   +8.367096528413435e-01   +7.980832562065829e-01   +8.122698581423668e-02; +3.713747408780873e-01   +9.877457267912151e-02   +8.813260907909476e-01   +4.783538663479125e-01   +3.305269424854309e-01   +5.921084612544196e-01   +1.209139673450926e-01   +4.493870328645587e-01   +2.357397529933778e-01   +9.777636306796861e-01   +6.530639172227194e-01   +2.710081021868272e-01   +1.137720257512826e-01   +5.183700921788279e-01   +1.430167156537213e-01   +3.392059305331181e-01; +8.892842691009708e-01   +1.871921149434981e-01   +9.998420761601154e-01   +4.774154477539532e-01   +9.555219398395899e-01   +2.117327950758309e-01   +5.976551402892348e-01   +1.686815381809095e-01   +6.997315419406247e-01   +9.774737816879008e-01   +7.150616209413743e-01   +5.770838855021442e-01   +4.109968741586672e-01   +8.181065053953046e-01   +5.792965301372093e-01   +4.917788620157799e-01; +1.139997110875217e-01   +1.743542333169855e-01   +6.893876896998903e-01   +5.542752201541098e-01   +4.075458128382948e-01   +2.944115129243420e-01   +4.353050792184313e-01   +8.001861845838842e-02   +3.040620665826932e-01   +1.270444961805086e-01   +7.584598836507718e-01   +9.147679928064745e-01   +3.343395140169585e-01   +5.845011931410664e-01   +8.388746919329393e-02   +5.039434127755300e-01; +9.116272734156557e-02   +5.374005059735938e-01   +3.519695289815135e-01   +6.451061322442260e-01   +6.292704004542118e-01   +2.706074360013002e-01   +9.684687416943731e-01   +7.459117508083312e-01   +4.729878892473346e-01   +4.964881444093397e-03   +3.926632621220838e-01   +4.509607346358193e-01   +1.077951592860086e-01   +7.135524524603725e-01   +2.268334557734541e-01   +1.296070728159314e-01; +5.434232664287189e-01   +9.771939133536007e-01   +5.613615585439791e-01   +3.514765196642032e-01   +8.534451880097563e-01   +9.417941506386153e-01   +9.810692462230659e-01   +5.348580944941325e-01   +4.343451612546105e-01   +9.362962822983684e-01   +3.648400818451582e-01   +9.817094124373910e-01   +8.638743080412057e-01   +7.340173712526034e-01   +4.395579451560602e-01   +7.626256102794873e-02; +6.024087781008485e-01   +8.435460996995204e-01   +8.964618177317247e-01   +2.554436152955745e-01   +3.720549172836538e-01   +5.585519205099493e-01   +2.503004774640957e-01   +4.890851773294056e-01   +7.327263596136241e-01   +7.420351771415630e-01   +8.123478258582594e-01   +1.048648696810648e-01   +9.039418341286652e-01   +4.474253561332941e-01   +1.768005323448553e-01   +6.716312334175402e-01; +7.286554007491881e-01   +6.698827068646562e-01   +6.524312580425394e-01   +1.837859446298628e-01   +2.058405999872306e-01   +4.378839484218576e-01   +7.813467776975772e-01   +8.905122327039793e-01   +8.771654448228327e-01   +4.287499228774374e-01   +3.902229154580399e-01   +4.208405880124107e-01   +6.956757326255547e-01   +2.801913831198727e-01   +4.169205043445031e-01   +1.170850644079754e-01; +9.936845021384341e-01   +1.443344027429079e-02   +3.847739408141122e-01   +4.801128757764830e-01   +9.113471834904910e-01   +3.239657516210664e-01   +7.129042664052421e-01   +5.899172403992955e-01   +9.127591586759143e-01   +9.486710380879940e-01   +8.748525631827810e-01   +3.942701948678087e-01   +7.500878132122871e-01   +1.585211153770583e-01   +9.708922128229123e-01   +9.858722301113055e-01];
L2I_L1I_iGABA_netcon = [+5.728971932986705e-01   +5.672226716842146e-01   +1.037702586041941e-01   +4.542003555934218e-01   +8.002824382720707e-01   +9.690292397131020e-01   +2.243164054468131e-01   +7.548788376341677e-01; +5.568708330931214e-01   +9.493378122813210e-01   +1.387401037807252e-01   +5.693030667268620e-01   +5.434174125787884e-01   +4.238881648713209e-01   +6.300907450752199e-02   +5.000962805469246e-01; +6.047842122725300e-01   +1.593890079708355e-02   +4.362487084925102e-01   +8.180505750732756e-01   +2.589021654361584e-01   +3.910241439672311e-01   +8.330388794999414e-01   +8.239366429435462e-01; +4.680308107726325e-01   +1.214109470055181e-01   +9.305129030887110e-01   +3.615950136947367e-01   +7.777466988635768e-01   +4.569739102223158e-01   +3.948585660261634e-02   +9.137878612115909e-01; +4.367672815016318e-01   +8.565811573850102e-01   +1.367432821835957e-01   +2.409456839574010e-01   +7.814548930602353e-01   +1.303657986131369e-01   +9.103456597858332e-01   +7.061051490215349e-01; +7.143107199173822e-02   +2.198530400217933e-01   +8.192972035817220e-01   +7.666324799577963e-01   +1.511486124713419e-01   +4.664671065411630e-01   +4.545957783325800e-01   +8.056908913410868e-01; +6.363359609515526e-01   +7.002792696143539e-01   +9.333499092530723e-01   +2.191007978212145e-03   +8.283730873082246e-01   +2.680487748737378e-01   +2.830018657529078e-01   +9.643357595700396e-01; +4.279954712664759e-01   +7.771836740800998e-01   +5.759103752128978e-01   +2.771023699708349e-01   +6.225413568653141e-01   +1.024895489497759e-01   +7.556025265396291e-01   +9.476120801514758e-01; +7.522344706141257e-01   +4.265331221522857e-01   +4.957043698081070e-01   +3.253220776642023e-02   +4.632428376565136e-01   +6.577385255756016e-01   +9.290311606773909e-01   +2.950141522308710e-01; +3.064911258035780e-01   +7.316373864285636e-01   +9.271679252447090e-01   +6.677061500814594e-01   +4.905963105309910e-01   +9.344193798483511e-01   +1.402798544464558e-01   +3.587314105374544e-01; +5.991886652284064e-01   +4.504196306315102e-01   +8.608055930613607e-01   +9.765936823610291e-01   +2.203461728626977e-01   +7.712938059751159e-01   +9.477618626277238e-01   +5.450126645486543e-01; +3.299657664762887e-01   +8.042604451032006e-01   +2.479819602567246e-01   +9.456704526157322e-01   +8.560776655599959e-01   +3.998518708746431e-02   +3.145984143058871e-01   +2.115436797563835e-01; +6.469445660906132e-01   +4.326629962307048e-01   +4.553734157874531e-01   +5.174037140878213e-02   +8.810470759465822e-01   +2.595909979429880e-01   +2.033684244196265e-01   +7.747574397189479e-02; +3.803994967677500e-03   +1.502259917189295e-01   +7.353026533469561e-01   +2.895955402150792e-01   +8.368266139006292e-01   +6.456722145547329e-01   +4.656746706570872e-01   +5.068588093595563e-01; +1.468146554757821e-01   +8.018379774453758e-01   +7.501687687111378e-01   +4.780509023854704e-01   +4.414074130874153e-01   +8.721085779890755e-02   +5.978372992534086e-01   +1.928433205277480e-01; +2.520841768875221e-01   +3.748832014451403e-01   +2.369097454005743e-01   +8.860103131862604e-01   +5.441710413669135e-01   +7.428014510359253e-02   +5.464442771351955e-01   +1.395007068634255e-01];
L1I_L2I_iGABA_netcon = [+7.135152762886209e-01   +8.741035974843899e-01   +6.154904001088309e-01   +5.146370746935386e-02   +1.508245243031369e-01   +2.358548423751440e-01   +8.474672701750099e-01   +3.729685686967253e-01   +7.165065308340309e-01   +3.909467111167268e-01   +2.458046906888834e-01   +6.819314464302129e-01   +1.651462978851446e-01   +5.746922516350551e-01   +5.034392306750035e-02   +4.829664372074136e-02; +6.111781638130402e-01   +8.016961359905502e-01   +6.203402488051267e-01   +5.337417843602983e-02   +7.498195340681008e-01   +5.561275907440847e-01   +1.981930424571051e-01   +5.702133746345048e-01   +1.954496171910676e-01   +7.295166663113791e-01   +5.095775060288095e-01   +3.401474067445915e-01   +1.151774260721035e-01   +8.157213463871859e-01   +4.350751810133962e-01   +9.274636537891063e-01; +1.610488010727108e-01   +6.232426741985682e-01   +3.134347137557234e-01   +6.041243846863922e-01   +9.532327423021768e-01   +1.158768110315726e-01   +6.140141616524442e-01   +8.398043005670492e-01   +2.375641280008548e-01   +6.365135540313754e-01   +7.381830607003881e-01   +5.515947075763330e-01   +7.486610620814804e-01   +6.778554298478406e-01   +9.260047354614432e-01   +1.778121650825498e-01; +4.857916745912994e-01   +4.813335911818934e-01   +1.326105441780177e-01   +6.641181092397231e-01   +2.638402297529720e-01   +8.260343062059547e-01   +1.586654078089424e-01   +7.182232387513091e-01   +9.958787818303296e-01   +9.648090063815830e-02   +7.846742949610305e-01   +5.375019634013426e-01   +2.165804790662720e-01   +4.436907705523122e-01   +8.858252265470109e-01   +7.497927094679162e-01; +2.863725262013113e-01   +2.081167485745570e-02   +6.060535042331064e-01   +4.890272692107254e-01   +9.177597821764599e-02   +6.561272148914258e-01   +5.840488759089966e-01   +1.127575652871265e-01   +9.086937356315441e-01   +5.029083138513935e-01   +6.824991599866338e-01   +9.063790141812280e-01   +4.879057986763212e-01   +8.982517295730040e-01   +9.466729821280011e-02   +4.713368688304463e-01; +3.994462349098474e-01   +1.279735404166697e-01   +8.986087880143618e-01   +9.853592173934917e-01   +2.327593823153675e-01   +2.298969446592867e-01   +5.446645003548279e-01   +7.456429114286118e-01   +1.175430371432707e-02   +5.594274229302507e-01   +8.171713379183418e-01   +2.853181462752487e-01   +4.383498470912554e-02   +7.890556149480766e-01   +6.880972568653783e-01   +2.489887071560258e-01; +4.927309083009654e-01   +7.246532436654392e-01   +5.712328701816594e-01   +8.673931688607032e-01   +8.987243556322234e-01   +3.041362413445222e-01   +6.933625840423145e-01   +9.248156852019978e-01   +8.391947539125427e-01   +5.373431399581376e-02   +4.278916963306785e-01   +1.365664085150728e-01   +5.819474194366723e-01   +5.901741113975412e-01   +1.445021764649491e-02   +6.638552931186393e-01; +8.643177477342591e-01   +6.719574810310729e-01   +6.402769688572039e-01   +9.610319527788149e-01   +2.001125994017960e-01   +3.270972001661294e-01   +7.018772412936005e-01   +9.314606142541181e-01   +2.541552353575257e-01   +8.391286760813253e-02   +4.928049866935750e-01   +9.590018598281510e-01   +4.978923249799591e-01   +6.255771662962430e-01   +1.258470613462742e-01   +6.188602591040041e-01];
L2E_L1E_iAMPA_netcon = [+3.705603058479527e-01   +5.650540545222094e-01   +1.990557506119285e-01   +5.198677601697341e-01   +2.933716592222034e-01   +7.016548476059768e-02   +2.829042459565957e-01   +2.628877406069280e-01; +4.370413778400923e-01   +1.880511068057637e-01   +1.457641509244433e-01   +6.844119516272762e-01   +6.130588802060579e-01   +5.900748831081614e-01   +9.322625359548514e-01   +8.990404309362490e-01; +7.255353231975611e-01   +6.027222716960827e-01   +7.445202595416189e-02   +2.143411947068337e-01   +8.656971051278196e-01   +7.878108397126220e-02   +7.571862662399246e-01   +1.583044293352286e-01; +1.986551757388141e-01   +7.301605959186908e-01   +9.415243898165773e-02   +9.699775082765351e-01   +8.141834958153581e-01   +3.938357611894155e-01   +2.591577955417544e-01   +5.500432324761330e-01; +4.669460555698087e-02   +8.355999412005184e-01   +5.503668862681856e-01   +3.438487994465485e-01   +2.091960738788695e-01   +5.344969425929319e-02   +2.431712928272941e-01   +4.254877319012023e-01; +3.114084077986177e-01   +2.770381669606546e-01   +7.310714103461212e-01   +1.847491934038631e-01   +7.542143102935005e-01   +1.285177735463607e-01   +1.634570049106484e-01   +5.453598767870598e-01; +7.926374453447537e-01   +6.085193090443179e-01   +5.494859575492058e-01   +2.438946078513737e-01   +2.036354577577999e-01   +2.354325284008480e-01   +2.939037756355899e-01   +7.497364691386098e-01; +4.220466733223412e-02   +5.480976406577616e-01   +4.461882943097299e-02   +2.617597751763276e-01   +5.825182084840635e-01   +9.437509145297457e-01   +5.688596778996070e-01   +1.562417700144645e-02; +2.134862381057135e-01   +2.804486036483088e-01   +6.388734026470150e-01   +2.175172121488698e-01   +8.739073846822438e-01   +2.077899301696415e-01   +3.977265718167256e-01   -3.349482324777053e-04; +2.677165587025905e-01   +3.397460132228101e-01   +9.873769593253535e-01   +3.659271406836044e-02   +7.169788875223826e-01   +3.278603243269786e-01   +9.828301045388795e-01   +2.063205274073662e-02; +7.913701280245580e-01   +5.725931082472480e-01   +9.141328287354851e-01   +3.511833355425031e-01   +6.954810218671623e-01   +8.674443800521648e-01   +5.476886479370729e-01   +3.463962121045721e-01; +9.787595155154025e-01   +7.488077661607636e-01   +7.765615747140475e-01   +8.989711162716300e-01   +4.609161938837098e-01   +9.265571152510591e-01   +9.327580601157460e-01   +4.259725228982620e-01; +9.149952832842938e-02   +7.666061307064000e-01   +1.922818127647288e-01   +1.394808808373162e-01   +5.019216753558572e-01   +1.961190418337141e-02   +9.885657952100930e-01   +5.412731977592246e-01; +1.960784353205416e-01   +4.005851071673121e-01   +3.119573957694675e-02   +9.500455525237972e-01   +7.972592904066313e-01   +3.658844311420574e-01   +8.306272591322578e-01   +4.817286734366280e-01; +1.181264315024939e-01   +1.564031264176273e-01   +3.812525589814916e-01   +9.040303618925529e-01   +9.398682998913759e-01   +5.356362608953013e-01   +1.781706998222748e-01   +9.121838994184632e-01; +6.444765992589373e-01   +2.057445198788307e-01   +5.756522453651304e-01   +4.116933698798113e-01   +7.934441238179593e-01   +4.104855387145794e-01   +3.140142014914923e-01   +4.188761396115692e-01];
L1E_L2E_iAMPA_netcon = [+4.974420981699846e-01   +4.602046897167714e-01   +6.156686571672448e-01   +4.938638231109408e-01   +2.367172029310363e-01   +7.173470607816158e-01   +6.840013588068722e-01   +6.357681149044154e-01   +5.206552651155449e-01   +2.416555250103779e-01   +8.735424985000270e-01   +1.739029140365617e-01   +1.367819811223891e-01   +2.433018778773363e-01   +1.859905073106023e-01   +3.262591758367869e-02; +8.405885027789527e-01   +3.669996679006292e-01   +1.017443464416607e-01   +6.611515016395753e-01   +8.367257437236215e-01   +3.761984627184930e-01   +9.756550713268077e-01   +6.227085252847314e-01   +6.726954178530220e-01   +7.292818272949656e-01   +6.628044994673100e-01   +3.001834984407807e-01   +2.891503058094054e-01   +7.435572095581691e-01   +1.549345198065211e-01   +2.496519888438142e-01; +1.825408129588010e-01   +2.949493292416039e-01   +7.582227801727155e-01   +1.746667599485422e-01   +7.306684180122752e-01   +3.801498315231850e-01   +7.556194226574086e-01   +4.091567122404750e-01   +7.750535678664426e-01   +1.250916552157954e-01   +5.451305377218176e-01   +1.031963817047539e-01   +4.394359949655962e-03   +9.328887897577172e-01   +1.345749975292282e-01   +9.899817061585703e-01; +3.426051111227967e-01   +2.382106308166993e-01   +5.397238017335826e-01   +4.769994508852457e-01   +4.892364898968296e-01   +7.132021352637886e-01   +5.510976343915507e-01   +4.335299538776763e-01   +4.614075352202605e-01   +3.644594888783547e-02   +2.430595660303664e-01   +4.577400510490342e-01   +3.094557459438760e-01   +3.695897679997041e-02   +1.625974500936263e-01   +6.350404106920092e-01; +6.937875573197151e-01   +1.362945200120726e-01   +4.444963131787998e-01   +5.041798381371724e-01   +8.489362612111160e-01   +8.306357578676062e-01   +2.444870025639835e-02   +5.116204086142505e-01   +9.087990703357934e-01   +6.474436684495865e-01   +1.111620566513352e-01   +5.865445314568269e-01   +9.078887022308110e-01   +4.280568063058620e-01   +9.227469335355144e-01   +3.527974198994545e-01; +6.869646595980854e-01   +1.015883572045166e-01   +7.422516345006902e-01   +5.997439051785185e-01   +7.183975227262420e-01   +6.676897435475766e-01   +1.927735139174022e-01   +2.617417720546464e-01   +2.434031989979097e-02   +1.972474271770773e-01   +9.699780267976346e-01   +2.158834528285271e-01   +2.951776352212406e-01   +8.219593672727895e-01   +2.633233204460229e-01   +9.905975194059161e-02; +3.690063376156379e-01   +2.377149238126567e-01   +3.875084213852973e-01   +2.440879258381412e-01   +5.174527110582905e-01   +6.482400105595300e-01   +9.423863356300862e-01   +4.223612301700834e-01   +4.875579381884331e-01   +9.765270492250867e-01   +5.873651244331244e-01   +1.064445924654354e-01   +8.249455519714578e-01   +9.969858697088164e-01   +2.033444487923415e-01   +4.140437267260442e-01; +3.153495216167283e-02   +3.501174496719734e-01   +5.321178531514704e-01   +5.221964146320800e-01   +9.388609387039268e-01   +5.602005833782594e-01   +3.925976511259051e-01   +5.147103685423994e-01   +2.705934573525229e-01   +8.285311093663933e-01   +8.166035501428339e-01   +5.612479289179292e-01   +7.340178259344691e-01   +9.205563403881966e-01   +6.205051474820580e-01   +9.292276723497511e-01];
L2I_L2E_iAMPA_netcon = [+6.795310209713162e-01   +6.174452615051833e-01   +3.930522475519669e-02   +7.998717251032796e-01   +5.177977355323680e-01   +8.239172990536896e-01   +6.490673016960792e-01   +3.870334417234595e-01; +2.041551567813380e-02   +9.440978135556752e-01   +5.601841021905703e-02   +9.384890467415953e-01   +6.445506300361646e-02   +1.091402482154574e-01   +3.178408402259202e-02   +1.703223155799636e-01; +7.291464612905554e-01   +9.618010080851388e-01   +4.074779998718593e-01   +9.419201059377579e-01   +2.917861078425223e-01   +2.350447109610405e-02   +5.634905636122657e-01   +4.451893960665533e-01; +2.166536660324085e-01   +3.681889451171024e-01   +9.789421899940738e-01   +1.431039827199138e-01   +7.141872200571885e-01   +7.294873526390168e-03   +3.103067531832689e-01   +8.751021336439935e-01; +8.522786274468246e-01   +7.937314285402097e-01   +7.110927153207072e-01   +3.260019549565067e-01   +8.853863378504624e-01   +3.374988542748338e-01   +2.610771447572019e-01   +4.042293021802364e-01; +1.571998690339411e-01   +7.212949930527991e-01   +9.961791438160796e-01   +4.232726454020361e-01   +3.697433266095120e-01   +6.641899808554721e-01   +7.188754842271461e-01   +1.697206967068947e-01; +6.681805670506008e-01   +9.490090291603945e-01   +6.517124792923622e-01   +7.069315060184647e-01   +5.592268238095474e-01   +5.923871958688489e-01   +3.065944191428474e-01   +6.639137868668232e-01; +9.310908574384773e-01   +1.373731801954850e-02   +5.032539743820421e-01   +6.188540274250371e-01   +8.780131665107928e-01   +8.151172636143363e-02   +9.007653686877168e-01   +9.278987460580421e-01];
L2E_L2I_iGABA_netcon = [+6.578655268324436e-02   +5.229592773144075e-01   +3.409390072683659e-01   +2.585593339857660e-01   +4.247755784694162e-02   +9.043090222984483e-01   +3.425956991565667e-01   +4.555903919106024e-01; +3.580046402033100e-01   +6.313142338871465e-02   +5.548863898908443e-01   +9.808814578493691e-01   +3.628471653917368e-01   +5.566587188732183e-01   +9.389102772679674e-01   +6.686681675663101e-01; +9.278512887106306e-01   +1.788560520438071e-01   +6.838938691700096e-01   +3.489798713095285e-01   +4.110643963501522e-02   +7.096781427753567e-01   +9.090982002187995e-01   +7.689910629077834e-01; +2.392291598275171e-01   +3.162990207428315e-01   +2.439621564709947e-03   +3.934103426577981e-01   +4.883801571608510e-01   +7.151961636189521e-01   +7.303980948792299e-01   +9.285923332394529e-01; +1.135229001212367e-01   +2.438165608343547e-01   +4.867019889856103e-02   +7.510758841150750e-01   +7.301311458081333e-01   +1.759549322717194e-01   +4.455555009964692e-01   +6.497537661973041e-01; +7.114017374236390e-01   +3.205518311283695e-01   +3.068331278723955e-01   +1.077944649505782e-01   +1.415487800130579e-02   +3.509128017946835e-01   +1.471636443098764e-01   +5.019765862515815e-01; +2.851924253423020e-03   +8.722981269998439e-01   +8.740772901168929e-01   +5.974078946292556e-01   +5.068316807228100e-01   +3.690748518936582e-01   +8.298904423575452e-01   +3.418559402241272e-01; +1.772280836800181e-01   +3.005585432740886e-01   +6.276703829812315e-01   +1.246937814751789e-01   +2.528700074777581e-01   +7.601835139899943e-01   +2.511562955880454e-01   +9.424405857742935e-01];
L3E_L2E_iAMPA_netcon = [+7.523006527459750e-02   +1.648527536927649e-02   +3.705582633872627e-01   +4.938517001712661e-01   +1.768443019507174e-02   +9.644270470091750e-01   +3.616390100700391e-01   +1.836625671707570e-02   +2.036505253466521e-01   +6.740420511682507e-02   +2.431695226541401e-01   +9.983810720535122e-01; +9.527116479703841e-01   +9.823468500121927e-01   +1.243220586722459e-01   +6.397373577427730e-02   +8.090146735239921e-01   +3.839512760654395e-01   +2.321533092048335e-01   +1.261139967602851e-01   +3.550572915612318e-01   +7.515767662439903e-01   +5.390179487159972e-01   +3.403254738653338e-01; +6.655828169252448e-01   +7.254290005707730e-01   +5.068368678968864e-01   +8.729669897605711e-01   +7.955949835876193e-01   +6.622759026610274e-01   +7.226900704765526e-01   +6.677625727058349e-01   +8.962388618904689e-01   +9.989634925243117e-01   +3.347205674706183e-01   +8.323430330583107e-01; +1.698411607995768e-01   +8.790866742912133e-01   +7.288861910416912e-03   +9.970482024460363e-01   +4.138478194539829e-01   +5.843953244441329e-01   +7.761330933606898e-01   +5.094686693318246e-01   +8.199288392827631e-01   +7.715197685241563e-01   +6.693517447863525e-01   +1.134482325080417e-01; +2.023317178458271e-01   +8.124390934480981e-01   +8.699234899616891e-01   +1.235382486351946e-01   +6.397317060617501e-01   +4.791966748543690e-02   +3.348662662961811e-01   +7.702316775602193e-02   +3.145497135504260e-01   +8.911859904069157e-01   +8.771271198258375e-01   +7.812741231149509e-01; +9.893351331760316e-01   +3.818885960208387e-02   +9.100922188698717e-01   +1.035826082891279e-01   +5.651616072396582e-01   +7.616504010873523e-02   +5.692798225290508e-01   +5.358920719358815e-01   +5.982208405574919e-01   +4.070610531883041e-02   +9.754266171249300e-01   +1.566535035736378e-01; +9.370999431326681e-01   +9.614654925602394e-02   +1.115901377453431e-01   +1.465394060520921e-01   +9.125830388828653e-01   +2.312337341864619e-01   +6.363092526772820e-01   +6.868312442681357e-01   +7.021969484859798e-01   +7.957811410977236e-01   +1.324304151465951e-01   +7.301308338644460e-01; +9.830259290588741e-01   +9.557412004845943e-02   +4.142856589302256e-02   +1.310266668916094e-01   +7.517074406607590e-01   +4.150606363634259e-01   +3.634737247062509e-01   +5.872567939447567e-01   +1.770861027289860e-01   +7.152219462474838e-01   +8.848833962978260e-01   +1.183998930230311e-01];
L3I_L2I_iGABA_netcon = [+7.680777051000188e-01   +5.391997547539138e-01   +5.988788720159717e-01   +3.092308242926464e-01   +9.613471517709635e-01   +1.126725529861261e-01   +2.937635617504226e-01   +7.929328892918600e-01   +9.163292080967236e-01   +9.932732272620418e-01   +3.095337109421624e-01   +9.970356150507044e-01; +6.386633380687711e-01   +4.529591660593380e-01   +5.631429985207420e-01   +7.612535486345434e-01   +5.475651688778906e-01   +6.598313045915041e-02   +1.648696167053517e-01   +5.037779998282664e-02   +3.870470508179710e-01   +2.921918146495923e-01   +4.428479896998794e-01   +9.206679633755614e-01; +8.021190389640572e-01   +1.154458864644753e-01   +7.178847424201631e-02   +6.523863760235790e-01   +9.780362874439706e-01   +4.568892419821800e-02   +7.249256738870993e-01   +1.873321210086915e-01   +7.509077895248060e-01   +5.228818774114516e-01   +2.035074694576288e-01   +6.925455481173961e-01; +9.649930626446217e-01   +7.187520860753345e-01   +7.631446350648400e-01   +3.312722691274989e-01   +1.225495950700150e-01   +1.262091812087781e-01   +2.979765136500015e-01   +2.470631839490939e-01   +8.756342866982020e-01   +3.645163901281702e-01   +9.405254438850520e-01   +2.194290831436599e-01; +7.129185809881353e-01   +1.868080260282022e-01   +8.685427619506322e-01   +9.785984025311637e-01   +1.580425567493929e-01   +4.924498145355855e-01   +6.743035142301325e-01   +2.571367290171563e-01   +4.009956983614698e-01   +5.227957398024801e-01   +2.875089701203855e-01   +3.112593053339124e-01; +6.466017151056490e-01   +3.238669360618787e-01   +6.985099690726206e-01   +5.317336496490659e-01   +3.354471663670876e-01   +4.686851816692074e-01   +7.549507930195890e-01   +6.503207845297204e-01   +1.698541002004186e-01   +4.974275502951354e-01   +1.139011089151428e-01   +2.272887306872793e-01; +5.186148326280681e-01   +9.706528056697957e-01   +1.145098398177407e-01   +7.543338739020757e-01   +5.281209204596085e-01   +1.570381916010037e-01   +7.453854825014623e-01   +1.018258593464263e-01   +4.435651512316455e-01   +1.846297438319218e-01   +6.548388752057421e-02   +7.018095597766989e-01; +9.527642307417827e-01   +6.945105397337199e-01   +6.604518844075447e-01   +2.614351655720032e-01   +6.903935779667264e-01   +1.309817635736510e-01   +7.782464554007157e-01   +4.718204116950208e-01   +8.543577598770185e-01   +4.894232565690622e-01   +7.273029285369871e-01   +3.737453932611932e-01];
L2E_L3E_iAMPA_netcon = [+6.517555412830073e-01   +3.801057818988156e-01   +2.343221153583167e-01   +4.673452591054013e-01   +9.125621598582673e-01   +9.505362079531339e-01   +7.628155252783221e-01   +3.546848926390400e-01; +3.758471992700300e-01   +2.911489448208362e-02   +9.108674517373145e-01   +2.891213824132869e-01   +6.830454223176275e-01   +2.032793481195369e-02   +8.919943462489671e-01   +6.619443561208618e-01; +3.038758869733863e-01   +3.281098797921033e-01   +4.892532278743952e-01   +2.725260663915283e-01   +8.427155000660457e-01   +5.041424143832123e-01   +7.891892358327280e-01   +5.942871214277261e-01; +1.574655723685478e-01   +4.978876521682222e-01   +5.892384552653680e-01   +1.449885823908867e-01   +9.157822431324812e-02   +3.350506619102552e-01   +9.419801886328547e-01   +5.378044556939542e-02; +7.791145292402548e-01   +2.703587383902888e-01   +9.542760301559023e-01   +1.421812910803162e-01   +7.341095246673290e-01   +6.663073538153388e-01   +5.353014644584952e-01   +2.099375708406359e-01; +7.140589866054489e-01   +5.325058916152842e-01   +8.427969850055798e-02   +2.642712263709189e-01   +5.534178253491810e-01   +1.593336091128960e-01   +1.572084222331045e-01   +5.950491665915071e-01; +1.787832186129957e-01   +4.184166075030812e-01   +2.210943937285563e-01   +6.054155862884707e-01   +2.493488565867896e-01   +2.214150690243295e-01   +1.318603328618902e-01   +2.654306627097688e-01; +4.480038668463010e-01   +7.317177690836312e-03   +1.580602282084353e-01   +1.029646775268825e-01   +7.229510191959239e-01   +1.126127969296840e-01   +2.647077632595771e-02   +1.173970567966326e-01; +8.403563526619804e-01   +8.967419458058536e-01   +3.868228780373730e-01   +4.912771727594065e-01   +3.639227660093450e-01   +9.921856750780497e-01   +6.852573070808351e-01   +2.124755833102017e-01; +7.007106484719842e-01   +2.397663050115152e-01   +1.856448482324190e-01   +8.965237793616022e-01   +8.475261985590286e-01   +1.453744357897267e-01   +5.804715761994055e-01   +8.762695116138094e-01; +7.629806676598260e-01   +8.044109671825217e-01   +7.630742422510528e-01   +1.843036821026103e-01   +8.267242639498679e-01   +7.662089938490938e-01   +2.950540417739500e-01   +4.631230247194354e-01; +9.786216491830061e-01   +5.808829942605428e-01   +2.331009585917693e-01   +5.461617809601220e-02   +6.197601828955095e-01   +6.287926968998353e-01   +7.264270990043446e-02   +7.326926412186304e-01];
L2I_L3I_iGABA_netcon = [+5.884109935446986e-01   +1.447875754990142e-01   +3.448601168563619e-01   +3.724692666160863e-01   +5.984993066640834e-01   +5.132008133143801e-01   +7.736688036116693e-01   +2.607196226247509e-01; +8.402476247410666e-01   +9.903588881276392e-01   +4.548391462959012e-02   +5.374809682303194e-01   +4.770742479768722e-01   +2.414869967157828e-01   +1.814796616329615e-01   +5.947958637767413e-01; +6.045021338980526e-01   +4.819205633570610e-01   +9.497229327776376e-01   +9.737588221465324e-01   +3.771258527479799e-01   +2.650770764127643e-01   +4.526162128505279e-01   +6.824565636329305e-01; +7.468215217050168e-01   +4.182057184060456e-02   +8.596141275337014e-01   +9.980237816061094e-01   +9.803771885228667e-01   +4.118973237338667e-01   +3.049499184514487e-01   +4.187994983642259e-01; +8.543666309124512e-01   +2.727745957328338e-01   +1.399781165483914e-01   +4.073900185324500e-01   +1.361745461863806e-01   +2.664148088341983e-01   +3.808311184353328e-01   +5.190281037807709e-01; +1.449912164834150e-01   +6.712655663623485e-01   +5.797790698517074e-01   +4.506881576582848e-01   +2.707506708832378e-01   +8.555353599704506e-01   +7.957079361589487e-01   +8.162627601763788e-01; +7.343897137770268e-01   +1.398506691358804e-01   +6.167424541597422e-02   +2.416341316285662e-01   +2.250405390721030e-01   +4.854107938155041e-01   +7.829340741756806e-01   +5.431593738548403e-01; +1.554722368285022e-02   +7.743610698649346e-01   +9.505114137077171e-01   +5.951092786808437e-01   +7.925751000986824e-01   +3.322736197524730e-01   +6.440177959236056e-01   +5.932813428759751e-01; +2.353306636416950e-01   +2.668987147883197e-01   +4.994441141191794e-01   +7.627387390118889e-02   +8.193809777406125e-01   +6.328971928035685e-01   +2.394345267173635e-01   +5.389076284015646e-01; +5.380942986592324e-01   +8.804797897163875e-01   +2.763113497378035e-02   +9.088522106376313e-01   +8.033551291808864e-01   +4.185616410714734e-01   +6.016982126617545e-01   +5.480599269832365e-01; +7.077859053871749e-01   +3.633974415148340e-01   +5.202512901183411e-02   +4.712896531699156e-01   +1.191183292571196e-01   +5.427605153578503e-01   +4.182356542342154e-01   +1.536210614413281e-01; +4.343781269131282e-01   +1.596411634962560e-02   +3.111009430506935e-01   +5.010524445795154e-01   +6.424510359643841e-01   +3.389263835338061e-01   +3.022356661620386e-01   +7.017223281216166e-01];
L3I_L3E_iAMPA_netcon = [+6.184429540037754e-02   +7.789351619551815e-01   +5.595660734358204e-01   +5.659605109814264e-01   +9.170322542513111e-01   +8.332345195575499e-01   +8.518570811788559e-01   +8.699053216291304e-01   +5.316190147994552e-01   +9.905859985796819e-01   +4.806819117305133e-01   +3.501387877348251e-01; +9.209756892682811e-01   +8.314950644548947e-01   +8.514770330744106e-01   +9.376083314272665e-01   +5.911075947038233e-01   +3.999262637060494e-01   +6.301219112618277e-01   +8.591485202605949e-01   +5.730251961403608e-01   +7.022085764880431e-01   +7.396233552087240e-01   +3.958346564620312e-01; +1.832786559174558e-01   +5.959131486034166e-01   +9.738759189306175e-01   +7.746580526599275e-01   +5.795657715850004e-01   +6.731367255572454e-02   +4.410201622780036e-01   +9.461464475328135e-01   +9.792048474548046e-01   +8.393317072693907e-01   +5.910167987299557e-01   +9.969689625224860e-01; +5.360383142825323e-01   +7.603291816742347e-01   +4.693885354233722e-01   +6.031008104086135e-01   +6.530076859819983e-01   +3.789120451451131e-01   +2.305976797946379e-01   +6.955268383427913e-01   +9.595419585338338e-01   +7.288469121638734e-01   +2.534953115785143e-01   +2.873242270218663e-01; +3.953414073539004e-01   +6.611891324022076e-01   +7.748846071670120e-01   +6.428859839867730e-02   +4.328976403945872e-01   +8.606364438608867e-01   +4.901441236841245e-02   +3.649570932517296e-01   +5.616070450941395e-01   +9.968151119648074e-01   +6.148484590635691e-01   +2.330474453904253e-01; +7.099986677645211e-03   +5.888135249242590e-01   +2.304484654318709e-02   +5.335094746058872e-01   +9.411613757632985e-01   +2.670322948514563e-02   +7.040198606155074e-01   +3.832573155384587e-01   +5.228289040061482e-01   +5.071294062320330e-01   +2.262533977913126e-01   +3.350847249670171e-01; +1.082116117222743e-01   +2.217519924858190e-02   +6.749544799289483e-01   +8.594050056626853e-01   +1.025374631068945e-01   +4.265094881272006e-01   +8.526013516363226e-01   +8.535644804837076e-01   +4.745120660754497e-01   +1.977479911849551e-01   +1.906548368818646e-01   +1.650760682146991e-01; +8.558774439983999e-01   +6.905113201923587e-01   +8.371355820842311e-01   +3.426153607314464e-01   +4.122798814476689e-01   +2.469253165459660e-01   +3.987882584961124e-01   +3.830724472735892e-01   +8.987249683251382e-01   +9.545911220992346e-01   +5.098054650618842e-03   +3.864077605043039e-01; +3.336521480977513e-01   +3.268454249505363e-01   +6.925220831880354e-01   +1.833368201790459e-01   +8.950715116874545e-01   +6.894801555709361e-02   +2.937206593698724e-01   +7.701738202959114e-01   +4.824496396407106e-01   +4.508844708828781e-01   +6.504974314301546e-01   +5.289292570004909e-01; +1.424203881707466e-01   +9.033159158766978e-02   +8.996272134834526e-01   +8.846532602361906e-01   +7.366302110742389e-01   +9.198445368963906e-01   +2.522412657304122e-01   +7.824001167079984e-01   +4.941736683806278e-01   +5.997458856693807e-01   +4.014903800008157e-01   +5.936217130904898e-01; +7.970685454679614e-01   +7.467039285435493e-01   +9.226691646291148e-02   +8.442940991922081e-01   +9.624361048606865e-01   +2.667512410447639e-01   +5.089864666921886e-01   +4.255035201917041e-01   +3.101468767183434e-01   +6.450622518846619e-01   +2.666690437292053e-01   +1.698980752506297e-01; +6.552278899240600e-01   +9.733994096148983e-01   +7.723966611538396e-02   +8.268322537518771e-01   +9.754193439996313e-01   +1.062367981875466e-01   +1.143679095889518e-01   +4.907586451947928e-01   +8.560341512296835e-01   +7.524729953780530e-01   +6.530893027089361e-03   +6.160239708420717e-02];
L3E_L3I_iGABA_netcon = [+4.425561242752198e-01   +6.245854664149451e-02   +5.865235199325981e-03   +5.023949773279397e-01   +5.391372632108745e-01   +2.503324680085421e-01   +7.217632461642313e-01   +7.583929345973975e-01   +3.811440373411561e-01   +4.459171934376642e-01   +2.034413524504197e-01   +6.547044325606241e-01; +5.545826322089325e-02   +8.051756180113199e-01   +1.299257011874985e-01   +1.911479380018302e-01   +2.201293066826653e-01   +3.349672007283033e-01   +2.207995214148248e-01   +8.851222162930352e-01   +6.083510179181231e-01   +3.911787529846539e-01   +8.290793046851701e-01   +8.996658361365332e-01; +6.292853704902532e-01   +9.143191712048653e-01   +3.061067488170653e-01   +6.456735458411417e-01   +2.656747977749009e-01   +5.975749938911611e-01   +4.924831355766960e-01   +7.297987101227645e-01   +1.593178215366350e-01   +6.789088066569298e-01   +4.428216495385814e-01   +8.362473757878054e-01; +8.069443607274613e-01   +4.205082217476060e-01   +2.341983570000402e-01   +2.532913103062963e-01   +1.344277867006949e-01   +4.772523133814210e-01   +4.737656504107056e-01   +6.860340127662976e-01   +1.016533673739898e-01   +3.336582504225452e-02   +4.451355351565043e-02   +1.646636880822926e-01; +4.007565601077863e-01   +1.902154777602723e-01   +6.557838008499176e-01   +9.426763109561830e-01   +1.111495436219217e-02   +9.027863388772425e-01   +4.356038104054551e-01   +6.538023398180645e-01   +6.174115998925214e-01   +7.826410860984088e-01   +7.633729058066953e-01   +1.597680446663402e-01; +8.879880610022706e-01   +1.827353955096691e-01   +8.052813373511460e-01   +2.950948726074580e-01   +1.588086390512983e-02   +2.863033399141288e-01   +5.581294015489977e-01   +6.229007467494490e-01   +9.610457699928306e-01   +3.722333101539772e-01   +9.472928316559229e-02   +1.336256480250565e-01; +7.171183785092409e-01   +6.701289842991862e-01   +7.383146168833487e-01   +1.453990022221900e-01   +9.872641302654911e-01   +8.058764269204348e-02   +2.071961240776403e-01   +7.608122149767158e-02   +6.699793907206391e-01   +6.377928986460211e-01   +6.584093128363665e-01   +1.527829723396343e-01; +2.045869963950164e-01   +5.195186276375988e-01   +1.188891148508420e-01   +8.660421057846639e-01   +6.511232128522170e-01   +3.839551264262673e-01   +2.780558985232718e-01   +5.486232438222512e-01   +4.756157510646455e-01   +4.949649427166534e-01   +2.620149651550263e-01   +3.984189269288700e-01; +3.743284841604267e-01   +7.822452514697356e-01   +1.711145068405706e-01   +8.827516052017547e-01   +8.081720821962864e-01   +1.870506914761350e-01   +8.043787562590005e-01   +8.774862761608178e-01   +3.340078592534024e-01   +2.295934324523551e-01   +4.440203985022507e-01   +6.621675156211290e-01; +2.103992852421032e-01   +3.002331170574762e-01   +2.642331079329399e-01   +6.593696085619816e-01   +2.786295967516744e-01   +7.285645684686548e-01   +1.017648602354484e-01   +9.816599064881079e-01   +5.875001498279722e-01   +2.141533190839559e-01   +8.472291191314800e-01   +2.207132228992613e-01; +2.584871839065014e-01   +4.684366218776715e-01   +8.181256907320128e-01   +9.975605612854223e-01   +1.823467659008526e-02   +4.289717982423318e-01   +3.596545480324562e-02   +6.505466604465739e-02   +5.469885275626064e-01   +4.521378848688676e-01   +9.050201109622629e-01   +6.400738952352937e-01; +9.924573152884594e-01   +7.096682129035303e-01   +5.865847839659886e-01   +2.564293300407272e-01   +1.020592241608839e-01   +2.631541507954606e-01   +7.396361442217635e-02   +3.025490056226632e-02   +3.881137833929887e-02   +6.292197093550211e-01   +2.824383652504026e-01   +6.105030600282397e-01];
L2E_Input1_iAMPA_netcon = [+9.991174396378409e-01   +9.990565019740000e-01   +9.977467910284563e-01   +9.988629798454209e-01   +9.958001345061381e-01   +1.000000000000000e+00   +9.965150071394180e-01   +9.962630727106291e-01];
L2I_Input2_iAMPA_netcon = [+9.961505833985594e-01   +9.975083511660986e-01   +9.975166332016194e-01   +9.960940169245813e-01   +9.963074961515194e-01   +9.976428717763516e-01   +1.000000000000000e+00   +9.961034612045504e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last =  11.21 * ones(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))*0.4 + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.5*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.5*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))*0.9 + 0.5*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))*0.4 + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.5*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.5*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))*0.9 + 0.5*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
