function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+3.805347276001604e-01   +3.201112648003989e-01   +1.678588143809066e-01   +3.642869292495000e-01   +2.827433158161714e-01   +2.424136472344034e-01   +4.577879112859863e-01   +5.297098292174535e-01   +3.496118778766981e-01   +1.896391418342231e-01   +6.865224486051374e-02   +4.699337886736477e-01   +2.577375816791377e-01   -2.113496732645934e-01   -4.197169186557351e-02   +4.195968953325371e-01; +7.026779933502543e-01   +2.538143848060176e-01   +4.617168771858036e-01   +2.708117827799674e-01   +3.592521162618315e-01   -1.188739662215413e-01   +1.285018816382497e-01   +9.815728105357402e-02   +6.017567637052916e-01   +4.101987759945618e-01   +3.212085670167501e-02   +6.482568084431396e-01   +4.202338146083158e-01   +5.211806579850689e-01   +4.880445103396279e-01   -1.011714081791341e-01; +1.242715804049357e-01   +1.434489714160798e-01   +6.453475488092618e-02   +2.562285531799179e-01   +5.487892731803986e-01   +3.760594976018040e-02   +2.418983665256478e-01   +2.246499965057613e-01   +1.651731920746571e-01   +6.593923064994242e-01   +7.168101595246920e-01   +5.855883346319712e-01   +8.487166131775361e-01   +4.322824445290818e-01   +2.560651104772272e-01   +1.350951683971822e-01; +3.020486681487035e-01   -1.111319100072864e-01   +2.011099845413520e-01   +7.193807703837888e-01   +4.585303530577942e-01   +8.006203822544730e-01   +2.083631561413360e-01   +4.683057533686694e-01   +1.526923321512147e-01   +1.118930691200092e-01   +5.874721589632523e-01   +1.324892152493526e-01   -3.227109763887420e-01   +5.650650075654869e-01   +2.735942957746436e-01   -2.433397018080331e-02; +2.911603010172693e-01   +3.765516901988670e-01   +2.538934167255861e-01   +4.036400436238896e-01   +3.057847171465787e-01   +6.463840093871591e-01   -2.107147923884425e-01   +8.691574207850264e-02   +5.905928146918022e-01   +7.660639521251981e-01   +4.208569534185495e-01   +7.354487099524455e-02   +4.578951498944809e-01   +6.991394398558128e-02   +4.643425737087301e-01   -6.294071399961178e-02; +4.335219495929199e-01   +3.381984023010195e-01   +7.009263309833207e-01   +3.379980419510357e-01   +4.231089641994263e-01   +2.211562458156917e-01   +3.835869943780834e-01   +2.017191835502447e-01   +3.118109138834397e-01   -5.009433256074063e-02   +4.192061825110951e-01   +5.450878256708130e-01   +4.256596324674709e-01   +4.315344609910978e-01   +6.939646047216864e-01   +4.828297983136673e-01; +2.885598766523683e-01   +4.831876177285754e-01   +7.187770008901714e-02   +3.772597289432535e-01   +4.581523059390639e-02   +5.294142381061147e-01   +2.656501297375721e-01   +3.396241910594622e-01   +4.404822932730168e-01   +4.236362677740623e-01   +4.234851731437659e-01   +4.338660108943301e-01   +3.964913705187068e-02   +9.514320745499796e-02   +3.655174790642781e-01   +3.060169780997229e-01; +1.369561650676012e-01   +2.629883991574504e-01   -9.661983053161986e-02   +5.816737864641588e-01   +5.270050421312051e-01   +1.288771797760805e-01   -5.272798131303718e-02   +1.099645381679282e-01   +5.228938267923409e-01   +3.378475847514102e-01   +6.398321301295330e-01   +2.896872974155449e-01   +3.090354771375695e-01   +3.721481404816968e-01   +3.686287152953996e-01   -4.926047014020594e-02; +1.291588792722438e-01   +1.255202976319072e-01   -1.593541815960606e-01   -9.844845708805153e-02   -2.576928969020174e-01   +2.694992845197987e-01   +4.185002355112253e-01   -8.415658388981877e-02   +8.893884168359432e-02   +1.975893340085887e-01   +4.671391741250953e-01   +3.988889087572188e-01   +6.187132749807074e-01   +3.909502054044791e-01   +1.190164076554578e-01   +2.742874260881880e-01; +2.930330333849729e-01   +1.969872949473374e-01   +7.142163467245350e-01   +8.421805854338044e-01   +9.264656224264640e-02   +4.400356825668952e-01   -3.225234046817557e-04   +8.323550746868129e-01   +4.171034424004255e-01   +6.244889561014918e-01   -9.662178674212904e-02   +5.305077627738159e-01   +5.124256075540514e-01   +2.617112249157066e-01   +2.472143008785925e-01   +1.736477083378143e-01; +2.825655987889290e-01   +6.572919649135966e-01   +7.172040577804417e-01   -4.159012142092809e-02   +8.541714795079008e-01   +8.047858532792015e-01   +3.230228327986525e-01   +1.113767147945437e-01   +1.252776544227038e-01   +7.670068891731483e-01   -1.087190811713435e-01   +7.004035392982833e-01   +5.016410096127899e-01   +2.947701220715749e-01   +3.182583646554727e-01   -6.304193854142219e-02; +5.700568865482042e-02   +9.646433519392901e-02   +5.662133944142098e-01   +1.000000000000000e+00   +3.049431620566664e-01   +6.579872402333791e-01   +4.891823467869427e-02   +9.528473791447095e-02   +4.385010057255685e-01   -7.951889913675265e-02   +9.287015406464546e-01   +1.266011810550250e-01   +6.977361230766507e-02   +2.054977342170034e-01   +1.837645521175327e-01   +5.773532436482192e-01; +4.830627182325659e-01   +4.276683057897551e-01   +4.195546793269938e-01   +7.190320091774118e-01   +3.977208090705452e-02   +4.895064920716521e-01   +4.800181385066147e-01   +1.157622611783485e-01   +2.405725499475663e-01   +1.742420810199974e-01   +3.735865564321734e-01   +2.788584478508955e-01   +5.756435919271208e-02   +2.879037097003082e-01   +4.201427371908147e-01   +4.668846671235650e-01; +3.107253271085875e-01   +6.351745366922219e-01   +3.360575073033897e-01   +2.524694812546986e-01   +5.582595866156064e-01   +4.872476547549481e-02   +5.176903088298059e-01   +7.132364833379189e-02   +3.496606036366073e-01   +6.665261794530835e-01   +1.681268006055176e-03   -3.588992683142070e-01   +1.634772661976718e-01   +3.205055605062969e-01   +8.852399474604135e-02   +3.358661739803804e-01; +3.204791633232911e-01   +1.333723895461994e-01   +5.411818693495157e-01   -5.109407030106857e-02   +2.208185529430488e-01   +3.247018184824468e-01   +4.170091324101662e-01   +8.475667502009214e-02   -8.449914301162743e-03   +2.620857178945298e-01   +5.268909865173458e-01   +8.541638520397717e-02   +5.004548399101065e-01   +3.746820292353961e-01   +6.804005739132246e-01   +5.051892134104591e-01; +2.481870835143524e-02   -1.190457106705113e-01   +2.238817697403460e-01   +5.157983992330085e-01   +5.714432319634958e-01   +3.494520554901250e-01   +5.408183824430193e-01   +6.225003375501766e-01   -3.167897957204329e-02   +5.362188823418652e-02   +1.685342811863812e-01   +6.092668666915212e-01   +7.007391369735042e-01   +6.481495116710484e-01   +2.948791063508666e-01   -1.599177270623701e-02];
L1E_L1I_iGABA_netcon = [+3.669700449629184e-01   +6.079375828560613e-01   +4.026098933168986e-01   +2.050142056598138e-01   +4.112802136335982e-01   -5.910808976724725e-02   +2.407396963649437e-02   +2.809375581096574e-01   +2.950142215827564e-01   +1.935346691229573e-01   +2.791869867291712e-01   +7.063004899142868e-01   +2.085111244901712e-01   +2.355821699498828e-01   -1.498543577701123e-01   +6.408282253843982e-01; +3.160613846395853e-02   +2.659910006506604e-01   +2.142579901400812e-01   -3.202333378066606e-03   +4.343193352183969e-01   +5.312388512401964e-01   +7.712328728277524e-01   +6.508324417597190e-01   +4.155749568405597e-01   +5.221253485347180e-01   +3.554548810097502e-01   +4.992500019279055e-01   -1.787145401159602e-02   +4.448379557739097e-01   +4.298929753093165e-01   +3.909214879701240e-01; -1.537985838048035e-01   +1.861334817489708e-01   +3.286974101549727e-01   +3.177339598623485e-01   +5.860731242269206e-02   +4.999988042720478e-01   +4.987534450616170e-01   +4.094650208858200e-01   +5.237277112246871e-01   -1.112679055836836e-02   +3.628872357766044e-01   +3.907319442054211e-02   +6.921831026874677e-01   +2.639459442933947e-01   +4.723837470199177e-01   +6.245816756044650e-01; -2.731723725374877e-02   +3.532813024297971e-01   +8.219138498395836e-01   +3.001582460134640e-01   +1.678273502638610e-01   +4.020119148338239e-01   +3.430705595318136e-02   +3.229174561898381e-01   +3.542096361574208e-01   +9.272896166854069e-02   +4.197693283463221e-01   +4.509168790966365e-01   -1.349516356928351e-01   +1.893509436815580e-01   -1.209116639977448e-01   +2.855730012776497e-01; +4.660952697856284e-01   +1.764571705814332e-01   +3.618863816278770e-01   +7.261674561350427e-01   +5.085722825838789e-01   +3.609883204009627e-01   +1.155698020579259e-01   +1.384296072095926e-01   +3.597528851892650e-01   +3.806593329735128e-01   +5.860550665904849e-01   -1.220020146450824e-01   +5.843655618711595e-01   +7.954697976677976e-01   +3.943157702257803e-01   +7.298236106157235e-01; -2.023301854539257e-03   +4.928512852209121e-02   +6.046504438305811e-01   +3.280239984626165e-01   -2.068975227889741e-01   +2.797038346173618e-01   +3.816675276237622e-01   +2.133310585111433e-01   +5.302999346566790e-01   +6.187770432046210e-01   +3.383126256782480e-01   +2.734989350866619e-01   +2.316651080287609e-01   -1.162723800039612e-01   +3.418816653367626e-02   +7.588958242577405e-01; +1.056178077148864e-01   +6.382995232115039e-02   +4.664060498169843e-02   +4.485987431969168e-01   +3.960686737610645e-01   +1.400287874377170e-01   +3.041330953525213e-01   +6.156998254157126e-03   +6.239285329965096e-01   +2.205433807377438e-02   +3.871118943682810e-02   +3.497966914553556e-01   +5.184081098388229e-01   +5.003704201019373e-01   +5.100330330570341e-01   -2.064753346070712e-01; +4.742134260438997e-01   +4.179030433737089e-01   +3.205079157024742e-01   +7.817151940361353e-02   -5.262996167238169e-02   +1.588116474583222e-01   +4.268522296098793e-01   +3.113171415116858e-01   +2.335451723821999e-01   +4.144836735466348e-01   +5.065501328351668e-01   +2.853396484723535e-01   +2.536520215064242e-01   -3.791576297729454e-01   +4.118232489195844e-01   +7.676481978790439e-01; +2.538409667644938e-01   +8.101468227380544e-01   +5.482282960832146e-01   +8.754024418101244e-02   +1.021388834491190e-01   +4.797498300455991e-01   +2.575557377965707e-01   +1.469509964628743e-01   +5.975491844595376e-01   +1.404820972386294e-01   +2.090771725386665e-01   -2.008613483198290e-02   +6.796997616205137e-01   +4.101669227823064e-01   -1.225357855700027e-01   +3.683711920260994e-01; +7.167537276783628e-01   +6.685815429503313e-02   +5.757097166087193e-01   +1.948110294149179e-01   +4.622762913666471e-01   +2.968839466681314e-01   +4.098929889733389e-01   +3.152985971918063e-01   +3.339925028043654e-01   -2.426211724078114e-01   +1.228977962456583e-01   +5.115871466235861e-01   +4.084555840749283e-01   +2.019433215662443e-01   +4.245103218799477e-02   -9.397863266731529e-03; -4.963431923714569e-02   +1.303963644200342e-02   +6.435842567230952e-01   -3.730693597438164e-02   +4.143215115936679e-01   +1.616134651744987e-01   +8.403041318860049e-02   -9.061741756696885e-02   -4.366543673525321e-02   -2.347874696452044e-01   +4.307236079416788e-01   +3.425047964176021e-01   +4.243887908666820e-01   +5.611356401488121e-01   +1.037050309257850e-01   +6.821367883784532e-01; -1.253499538019452e-01   +1.000000000000000e+00   +5.831019468548365e-01   +5.748398579641799e-01   +7.550784988141628e-01   -2.118694000656602e-01   -9.791881447651714e-02   +8.592274089570653e-02   +5.736525540113475e-01   +8.124328773500167e-01   +4.109318453244175e-01   +8.047609805006811e-01   -1.405932295490787e-01   +5.257122241944763e-01   +2.772606131528290e-02   +1.221625305223868e-01; +4.115619250355347e-01   +5.531866507435723e-01   +6.607990032706578e-01   -9.035855518244239e-02   +7.973459898929245e-01   +1.382779395975380e-01   +6.839183503689135e-01   +5.732311222040324e-01   -3.821532067333154e-01   +2.282767083837488e-01   +1.338252732875761e-01   +3.183183228421397e-01   +2.163523674279166e-01   +3.353840651377607e-01   +3.802967262190030e-01   -1.437303959279566e-01; +3.141644908428750e-01   -3.575823387212497e-02   +4.368146339794173e-01   +3.801296096052577e-01   +4.044602992394586e-01   +3.913841794741577e-01   +3.666638032926100e-01   +6.078478929866469e-01   +1.224863710001664e-01   +7.160057720241880e-01   +4.642787621692250e-01   +2.295859613826372e-01   +5.428427273679679e-01   +3.521914547470556e-01   +4.576971522650699e-01   +7.017813126211501e-01; +3.362623086911958e-01   +6.127300537270591e-01   +7.733782360625769e-01   +7.317108130265471e-01   +3.180837051798101e-01   +6.140323377873235e-01   +1.629529191902441e-01   +3.718565306902474e-01   +3.724473968559375e-01   +1.517784980445397e-01   +8.672719582124881e-01   +3.771777032434662e-01   +4.972728689008405e-01   +3.898155751980541e-01   +7.727320728544862e-02   +5.975578377871879e-01; +7.739772064457503e-01   +4.022922321647129e-01   +5.422580866858140e-01   -1.245791356507021e-01   +3.626820939819033e-01   +5.874258985826429e-01   +2.692289142569411e-01   +1.112331004471674e-01   +3.643630556693203e-01   +7.270682709452405e-01   +5.899145444193233e-01   +4.041721178712198e-01   +2.380681491848965e-01   +4.379953599024787e-01   +6.240795491577551e-01   +1.697430461821477e-01];
L2I_L1I_iGABA_netcon = [+5.397841750051429e-01   +2.881591735911771e-01   +6.283810474059190e-01   +7.593177753011213e-01   -2.399034613065597e-01   +3.420593941312623e-01   -3.005061559330686e-02   +2.258129121217461e-01; -3.281071349386208e-01   +3.114411655620142e-01   +5.434333153638241e-01   +4.499057160662420e-01   +3.150309318491258e-01   -3.258301439769209e-02   +1.489502843700244e-01   +2.654269101026042e-01; +4.217674308312584e-01   +1.384590446523791e-01   +4.865963818990445e-01   +6.275115035756640e-01   +2.467431923900683e-01   +2.405773078718997e-01   +1.413819239008227e-01   +8.022652379717321e-01; -3.238647928902039e-01   +3.515410118412819e-01   +3.853916496097470e-01   +2.365909227784292e-01   +5.866233188807457e-01   +7.322243618681240e-02   -9.136119335706180e-02   +4.219251636042280e-01; +5.613564980816516e-01   +4.314436938105393e-01   +6.000763686778278e-01   +5.848662830592699e-01   +9.928875200592134e-02   +4.189378690935693e-01   -4.904396789804364e-01   +5.412066615933617e-01; +2.525367458360434e-01   +3.982829207262794e-01   +4.659791965791299e-01   +8.194891670477539e-01   +6.483790472338230e-01   +5.043665154977398e-01   +4.824681436760944e-01   +2.532840043314077e-01; +2.245018752395204e-03   +1.920913531153314e-01   +4.513108624844401e-01   +1.000000000000000e+00   +3.897939220399887e-01   +5.774592131982935e-01   +3.293493917965317e-01   -5.637880181730006e-03; +6.213198282554930e-01   +2.161807131202493e-01   +4.269863240413811e-01   +2.161834645438300e-01   +3.992907693420510e-01   -3.264710584159791e-02   +4.346522516343857e-01   +5.649100283017269e-01; +7.457043920433407e-02   +3.804861561022824e-01   +4.318712617032463e-01   +1.960979659949677e-01   +8.164746975034136e-01   +2.524246631037899e-01   +3.012793156130336e-01   +4.231717487386258e-01; -2.905609690827363e-01   +5.870430414343626e-01   +5.192178800276246e-01   +1.001329657799898e-01   +4.659214031770249e-01   +4.416089248354849e-01   +7.479289118735142e-01   +2.954912523080550e-01; +2.781610270413656e-01   +2.744926604302784e-01   +4.929885581895319e-02   +1.528529520049450e-01   +8.740417155946829e-01   +3.674953699765371e-02   -1.426214559473938e-01   +3.847170451097446e-01; +4.172077444137690e-01   +4.935430600973466e-01   +5.920431112491251e-01   +2.179275561742369e-01   +4.732502192646166e-01   +4.202231578116320e-01   +1.979945488016975e-01   +6.148522651476833e-01; +7.748196004974375e-02   +2.132648107866117e-02   +1.440395122600908e-01   +7.978818688898114e-01   +2.837369449877850e-01   +4.363445187775649e-01   -2.198461160000865e-01   +3.450261073041063e-01; +4.396594476077798e-02   +5.243911480012260e-01   +2.892935045786252e-01   +3.131097442509972e-01   +4.316162439991323e-01   +7.198380893072276e-02   +2.807763159561240e-01   +1.033426849429415e-01; +3.818511380639450e-01   +3.654734312219688e-01   +6.224365947521252e-01   +2.385052149930991e-01   +1.173915697617107e-01   +7.042839070811787e-01   +3.018968682321385e-01   +2.543995377636940e-01; +2.065185577153593e-02   -3.483239459152321e-02   +4.630921567176881e-01   +6.713339733004010e-01   +8.330391898151321e-02   -6.948024988688251e-02   +1.083384664891132e-01   +2.734951052386335e-01];
L1I_L2I_iGABA_netcon = [-2.214910280813021e-01   +4.071312667785919e-01   +6.446489629971940e-01   +2.662156682140811e-01   +4.054314150441127e-01   +5.504983861805930e-01   +7.242612531376741e-01   +5.059493751056767e-01   +6.265104229056415e-02   +1.383374441442948e-01   +6.392649654823954e-01   +2.531451697070246e-01   +8.707289305306194e-01   +1.776332633868936e-01   +2.677874283566548e-01   +6.541722652569892e-01; +2.449139375396300e-01   +5.134218001911204e-01   +3.848622252869831e-01   +9.287324973457219e-01   -2.757602382015219e-03   +1.180986613315119e-01   +2.408546337434605e-01   +4.671180759311737e-01   +2.295304235421417e-01   +3.484858703500786e-01   +4.595149688753487e-01   +2.157799622953740e-01   +6.903290356995881e-01   +8.256343847220937e-01   +4.729441471297808e-01   +4.463402566765579e-01; +1.036924963175205e-01   +4.798124377127672e-01   +4.065791637666193e-01   +4.572958172172079e-01   +6.064905858451174e-01   +2.588173092681603e-01   +2.561707697299024e-01   +1.787793380853988e-01   +3.154478048111106e-01   +6.089376089875065e-01   +5.074945189307710e-01   +2.383816997511824e-01   +5.211924627807080e-01   +7.109194508944972e-01   +2.251240979444146e-01   +1.093250026412224e-01; +2.652239503685971e-01   +7.990319272135643e-01   +5.586065272267250e-01   +3.987952247055674e-01   +2.100677816015714e-01   -8.650812603231590e-02   +1.509235412886236e-01   +3.261288316885482e-02   +4.242556136329153e-01   +4.588473034407375e-01   +4.148557079427346e-01   +8.949497287205113e-01   -9.000747391765655e-03   +8.575335250252083e-01   +6.900058586322648e-01   +8.693202288443986e-01; +4.691638181671428e-01   +5.606991343181679e-01   +1.000000000000000e+00   +1.370438569467272e-01   +4.855606863134328e-01   +2.372414749820752e-01   +2.004381635244432e-01   +1.830617895988342e-01   +1.219737700945959e-01   +8.268741721992771e-01   -9.571964942637387e-02   +4.938880006885126e-01   +5.039615264193214e-02   -1.561500408661543e-01   +9.886031473694604e-02   +5.499542591578072e-01; +1.307466059082392e-01   +2.210593996222869e-01   +1.379649858914981e-01   +1.945639961463324e-01   +7.404788156506174e-01   +2.779282073307560e-01   +1.954498521253570e-01   +1.218716158674163e-01   +7.179785861166649e-02   +8.545593869868691e-01   +1.313392800818849e-01   +5.279755942108854e-01   +5.236735414396839e-01   +1.359012927065985e-01   +1.893191639702361e-01   +6.282032572771556e-01; +4.336456264521317e-01   +7.584561441932044e-01   +5.240184567048921e-01   +7.463292496130676e-01   +6.873964215050959e-02   +6.935762145644984e-01   -1.691249589993651e-02   +3.765043166734588e-01   +9.382931538130163e-02   +2.228787733265698e-02   +7.743513756222000e-01   +5.353534089198335e-01   +2.106370312867765e-01   +3.781831731796996e-01   +6.493627371744867e-01   +2.276768614889445e-01; +2.730787055363576e-02   +4.666749108909524e-01   +4.119342004179584e-01   +4.506829743858240e-01   -7.917176263642019e-02   +3.108674453359232e-01   +5.402845889599874e-01   +2.447019957624703e-01   +5.343279557205717e-01   +8.697593616954773e-02   +1.535074729239335e-01   +2.254939817873075e-01   +2.286365897708477e-01   +5.631504960756122e-01   +2.664051201407068e-01   +4.639234235213782e-01];
L2E_L1E_iAMPA_netcon = [+7.160145423682350e-01   -1.564326534570376e-01   +2.260717692963177e-01   +4.048628031155989e-01   +4.452893049751015e-01   +3.512378892776300e-01   +1.447956519246189e-03   +6.405580529654985e-01; +1.629661233710961e-01   +4.981089121344965e-01   +4.880092325749077e-01   +6.317585186399771e-01   +2.919102731587010e-01   -9.433566879220180e-02   +3.836003501786771e-01   +9.709186357708599e-02; +2.883054541038954e-01   +6.242447096194327e-02   +4.743106406125071e-01   +3.840174370016229e-01   -6.555546439981651e-02   -4.322739877707080e-02   +3.875242694321393e-02   +3.423916854446556e-01; -1.034364410634072e-01   +2.551200874158072e-01   +3.252434179700598e-01   -1.798921195609645e-01   +4.576657507584822e-01   +4.056172931904024e-01   -1.427466396091144e-01   +3.018140275387198e-01; +1.259309773104112e-01   +1.186152040980338e-01   -7.924405605862414e-02   +7.384034740830188e-01   +2.523157705461643e-01   +6.781349144333005e-01   +2.254891395684237e-01   +3.179601379090718e-01; +5.791914901108286e-01   +6.118718992401670e-01   -1.782610344513879e-01   +4.282235916826229e-01   +6.220223243171828e-02   +1.278798327950701e-01   +4.993863179718189e-02   +1.811150665273534e-01; +8.734410323963135e-01   +7.315372179799359e-02   -5.915055908875140e-02   +2.944983695765123e-01   +4.184066592900139e-01   +1.687430732680097e-01   +4.188624489779137e-02   +2.476918201120772e-01; -2.733296652528243e-02   +8.272635615113971e-02   +1.294638472941673e-01   +1.389424810443499e-01   -6.375215285994268e-02   -1.271886261152047e-01   -1.389830859634016e-01   +8.882404278557574e-02; +3.790280865445473e-01   +4.684000316129635e-01   +1.504396579010500e-01   +2.744185093890175e-01   +4.014133517706755e-01   +4.327192681399338e-01   -1.261264542537339e-01   +3.797754892123748e-01; -2.652916973227707e-02   +5.029980923816462e-01   +3.903831123975605e-01   +1.003268595253292e-01   +3.939938203630526e-01   +2.401666074305409e-01   +5.586176182578745e-01   +2.021336556811771e-01; +6.765845589405129e-03   +4.548279152445233e-01   +9.816935599489656e-01   +8.330085079762949e-02   +3.383767654873971e-01   +8.029294506865679e-03   +6.802635079287757e-01   +4.456188257050230e-01; +8.077348115601634e-01   +3.830084978427918e-01   +3.817765227218557e-01   +3.960738897484292e-01   +2.629958659493116e-01   +4.095989150002791e-01   +6.128340160795029e-02   +5.965234022216244e-01; +4.729220617992962e-01   +2.050662114389115e-01   +1.496756797067007e-01   +7.290868539791799e-01   +3.433456973404669e-01   -1.523614751941479e-01   +1.793804725457995e-01   +2.890271034826506e-01; -2.803796651880071e-02   +1.446001224294726e-01   +3.388319897795896e-01   +2.589938150982424e-01   -1.450219724772558e-02   +4.621442442658742e-01   +1.000000000000000e+00   +4.614353382518771e-01; +3.873335576896219e-01   +2.215525036729695e-01   +3.127421500103505e-01   +8.592316798250982e-01   +4.423887602125574e-02   +2.716588239287036e-01   +1.833297461051548e-01   +6.508948387372318e-01; +1.937396218708044e-02   +3.049765264121512e-01   -4.947614480208003e-02   +2.188748527427885e-01   +1.388921293171895e-01   +7.122231579440792e-02   +1.167108058226338e-01   +5.953187287215637e-02];
L1E_L2E_iAMPA_netcon = [+5.477834241863751e-02   -1.130901891316987e-01   +6.591424294886630e-01   +3.812027756301093e-01   +5.414745410769355e-01   +3.767457423462070e-01   +4.618002886148190e-01   +1.598105952887113e-01   +5.312774064388337e-01   +4.700668222957511e-01   +7.778096562172047e-02   +3.887568438942023e-01   +7.260207722638213e-01   +3.396482001326481e-01   +4.005165678613649e-01   +2.466891362493449e-01; +3.885995349523564e-01   +3.644698715324686e-01   +2.554758485369886e-01   +2.696529897917753e-01   +2.806232595024897e-01   +5.176386594400202e-01   -2.618941809620385e-02   +2.538836344004609e-01   +1.610814825356870e-01   +5.896518362712208e-01   +4.206858119356590e-01   +8.773581119767063e-02   +6.013841816489286e-01   +3.611424033825492e-03   +6.695379737757819e-01   -3.450953974037927e-02; +6.059779732776734e-01   +1.577195265018693e-01   +6.765607800074949e-01   -1.578974497717583e-01   +3.841993752956236e-02   +1.297212857325103e-01   +3.743651332380859e-01   +5.535088153668518e-01   +1.519532891043661e-01   +2.032990573101461e-01   +5.304384498059507e-01   +9.342388267220462e-01   +7.324783193668940e-01   +3.544168022228395e-01   +4.000630818351290e-01   +8.677974828493209e-01; +1.583966938313905e-01   +7.429559920401041e-01   -2.311084727779266e-01   +1.510126557054184e-01   +4.328398395877592e-01   +4.773082664352696e-01   +5.597558290045471e-01   +7.655659874917992e-02   +1.000000000000000e+00   +1.259147483046446e-01   +4.230630287115857e-01   -5.467069627997829e-02   +4.180506023425567e-01   +6.273366979005062e-01   +7.534759909929678e-02   -2.527091048778464e-01; +5.140622106264632e-01   +3.254227310395907e-01   +3.622698046190399e-02   +2.219527914536874e-01   +8.048099298699467e-02   -1.410238413973748e-02   +4.089032509426117e-01   +6.137015536899038e-01   -2.366868653269422e-01   +2.619420833604602e-01   +8.533965409938640e-02   -1.555199197769994e-01   -2.006451378097320e-01   +3.189361040553016e-01   +2.653793909702157e-01   +2.157405173256122e-01; +2.397959377302177e-01   +6.054191340891054e-01   +5.007972452905854e-01   +9.628621587063071e-01   -1.766944976302654e-01   +4.739829462853369e-01   +1.903843913728355e-01   +4.375191288390300e-01   +2.152879604725986e-01   -8.494284555676353e-02   +9.796957677916363e-02   +1.018663449864791e-01   +6.226070477579471e-01   +1.563633289066759e-01   +5.850808637267640e-02   +5.721962614634386e-01; +1.710544975484958e-01   +2.827005138596007e-01   -8.829506612544559e-03   +6.108767728259213e-02   +3.104569101346764e-01   +2.137276707511019e-01   +2.128599316060268e-01   +5.314867813344412e-01   +2.073989862211507e-01   +2.796736772480579e-01   +1.814030006825489e-01   -1.177856896724636e-01   -9.667929776040732e-02   +2.142252332846819e-01   +3.830778056694968e-02   +3.291295381638295e-02; +3.463201470795619e-01   +1.249473503590576e-01   +5.651319378421793e-01   -1.993933697990787e-02   +2.606549245703644e-01   +6.495453535683244e-01   +4.577352450947303e-01   -1.887033958328195e-01   +4.757182627307305e-01   +2.121078873661962e-01   +3.019630547855752e-01   +7.176789102511662e-02   -1.094986824122611e-01   +5.294065069422551e-01   +8.213310167522431e-01   +4.922855129242504e-01];
L2I_L2E_iAMPA_netcon = [-9.917303125635500e-02   +2.694989274229362e-01   +5.425084332986626e-01   +2.565191038414887e-01   +1.000000000000000e+00   +4.404581299933626e-01   +3.873005930546454e-01   +5.161219769505950e-01; +4.825568099878644e-01   +2.799898193249371e-01   -2.332331084030123e-02   +1.378647815416346e-01   +3.253800264585464e-01   +5.326969390747104e-01   +1.538549684972655e-02   +4.459004286589789e-01; +5.614944571302269e-02   +4.206911745030401e-01   -1.146031917617546e-01   -9.937990379963209e-02   +7.948332075400792e-01   -3.808831978274520e-01   -3.396966289641991e-01   +3.070065579988976e-01; +4.832490464750416e-01   +8.505085049404941e-01   +4.237661547616285e-01   +7.213063841278836e-01   +5.203524825146345e-01   +2.984196643541441e-01   -9.269872764257107e-02   -1.114094144095780e-01; -2.227816136908101e-01   +3.707361402371308e-01   +1.016076395095405e-01   +7.052397103041903e-01   +8.782161560845108e-01   +4.320926186153499e-01   +6.197733521694645e-01   +9.246402179477756e-02; +7.456130909356884e-01   +2.964154023877258e-02   +3.929261321215856e-01   -5.065238588392455e-02   +6.908832404148098e-02   +8.479728003500462e-01   -1.328478746084234e-01   -1.860019591330885e-02; +1.895674539554885e-01   +8.186305835358633e-01   +7.382030248427667e-01   +6.547043241833822e-01   +6.716710866610580e-01   -2.952297302634864e-01   +4.294942189034694e-02   -7.467762284965271e-02; +8.722046351948760e-01   +7.240828278533873e-01   -2.408359748762934e-01   -7.725734383165643e-02   +3.598006082230137e-01   +3.998785647986237e-01   +6.459805632672528e-01   +5.391239001598119e-01];
L2E_L2I_iGABA_netcon = [+1.410355217168654e-01   +3.454008370295589e-01   -6.495517372326258e-03   -1.392286896656463e-01   +5.619072255453343e-01   +6.462572835778120e-01   +3.694799464744954e-01   +6.781339120587717e-01; +7.100249322120671e-01   +5.625947117411753e-01   +2.139474966763865e-01   +1.883091236036959e-01   -3.256133795858693e-02   +8.085929948874918e-01   +4.989654453169159e-01   +2.147573879357030e-01; +9.725970057578551e-01   +9.878187323145488e-02   +6.725263332119581e-01   +4.314689926482739e-01   +4.929909144589263e-01   +9.502851070406009e-01   +1.000000000000000e+00   +2.506646757563085e-01; +3.086571097321891e-02   +2.382870711608589e-01   +8.937953994973709e-01   +4.809766628790982e-01   +6.364949073097735e-01   +5.309327210617779e-01   -2.453757341061660e-01   +3.940600154796758e-01; +1.321644945454458e-01   +6.620078283507296e-01   +6.939873088458844e-01   +8.002590049896215e-02   +2.448076781421747e-01   +4.044409668289385e-01   +7.015106034570840e-01   +3.773905934351374e-01; +9.603799038344159e-02   +4.325483367912588e-01   +3.652386482327998e-01   +4.186073815154508e-01   +3.147820355018136e-01   +6.488876867041148e-01   -1.656622239983391e-01   +6.620953703833737e-02; +1.865116044844515e-01   +4.034491302633277e-01   +1.286179603503302e-01   +7.984754826215767e-01   +1.177411542935971e-01   +6.912472572988093e-01   +5.628364420065413e-01   +3.644165633720831e-01; +2.335706752249574e-01   -8.053059462624503e-02   +5.842758783356005e-01   +3.374148586981280e-01   +6.394470605743099e-01   +1.786033164718157e-01   +6.949854361759783e-01   +5.309538234583734e-01];
L3E_L2E_iAMPA_netcon = [+9.567664133705171e-02   +7.065613507994364e-01   +1.761074203106472e-01   +3.454241977777601e-02   +5.978231710485814e-01   +4.936933833636515e-01   -2.768815033902586e-01   +5.134926280201116e-01   +4.345299366139538e-01   -3.635165335397327e-02   +3.195117353574846e-01   +6.573923239372049e-01; +5.293022436973810e-01   +2.047564531569759e-01   +1.963006327261247e-01   +8.748008452485007e-02   +3.770623528093784e-01   +3.172491194503438e-01   +1.420814967758274e-01   +4.396581475961592e-01   +4.956976508864594e-01   +5.431643883838503e-01   -2.507797948360140e-01   +7.747420330643867e-01; +2.180973353202367e-01   +3.306334864753421e-01   +4.673387870341321e-01   +4.833797374506884e-01   +7.677433579353170e-01   +3.959224952902367e-01   +4.657319470622013e-01   -1.218457886618930e-01   +5.147508645408315e-01   +1.948286354814578e-01   +4.076328520204049e-01   +5.979183805525110e-02; +6.476958893233612e-01   -7.664765944529196e-02   +6.041136694581610e-01   +1.629402241709373e-01   +4.360769507044713e-01   +4.258691692645247e-01   -1.031009646556705e-01   +4.181713942294421e-01   +1.990808811271553e-01   +2.163676280730759e-01   +3.739937609806872e-01   +7.574947535212012e-01; +3.044558074817920e-01   +3.843820893219778e-01   +3.001386744936766e-01   +5.637667218289145e-01   +2.117839919478411e-01   +5.623891792387691e-01   +1.607383963002674e-01   +4.442246046106109e-01   -8.458718717236509e-02   +5.386595457277257e-01   +1.791973683612750e-01   +4.163954731759827e-01; +1.154642737184094e-01   +4.457573790689752e-01   -4.950449776083686e-02   +8.304006183964172e-02   -3.376872817908977e-01   +1.282561971684216e-01   -1.610370327893544e-02   +7.342880816570728e-01   +2.312307449034639e-01   +4.155688286525353e-01   +5.963367764421768e-02   +4.130602626357227e-01; +1.814936910182607e-01   +6.299358741915408e-01   +2.806327659827020e-01   +1.000000000000000e+00   +4.758824860885746e-01   +4.581743309780621e-01   +4.998497727983844e-01   -1.709177803879066e-01   +2.969332031129254e-01   +6.265931184118634e-01   -3.626938065962410e-01   +1.522326294591280e-01; +2.095364780502415e-01   +3.158458954417098e-01   +8.275515134675472e-02   +4.794719281968650e-01   +1.761801673995643e-01   -1.782383746768860e-02   +3.987566143394107e-01   +5.711268009191851e-02   -1.503042445608558e-03   +7.410454824747322e-01   +3.736750655577107e-01   -1.384550243466334e-01];
L3I_L2I_iGABA_netcon = [+4.655864078993699e-01   +3.424377433231768e-01   +5.718290647312543e-01   +4.938030361809480e-01   +3.822066494197012e-01   +1.000000000000000e+00   +3.527802484911325e-01   +1.553805239642201e-01   +6.763564268060691e-01   -1.955915706696865e-01   +6.048508329118920e-01   +7.633488564854827e-01; +4.821128874360375e-01   +4.279804339318941e-01   +1.058222381471716e-01   +6.020081972853221e-01   +3.746345293380646e-01   -3.467916511256722e-01   -1.494600535088383e-01   +2.606393106800572e-01   +3.636981878173224e-01   -4.174550240007165e-02   -2.325192811305163e-01   +2.526835725493281e-01; +5.641188113820421e-02   +3.842197244105076e-01   +5.048333826906126e-02   +1.457952800505724e-01   +2.397035595548975e-01   -4.041782219398967e-02   +4.480520699556875e-01   +5.702003897130867e-01   +4.025001930934655e-01   +1.446352607946898e-01   +3.796797260170326e-01   +3.600356170595536e-01; +4.862607056416937e-01   +2.002327025897000e-01   +3.500031384295755e-01   +4.311916873286148e-01   -4.358418631045847e-03   +7.547986799231611e-01   +5.519607655044628e-01   +8.339003477047169e-01   +3.055566587489901e-01   +4.179729201821026e-01   +4.349624653547883e-01   +8.065523298141469e-01; -1.546476535039706e-01   +4.368773906304105e-01   +5.848414299363244e-02   +2.565692392270206e-01   +1.291939727889899e-01   +3.285234812323819e-01   -3.484325128068224e-02   +3.575263973863905e-01   +2.985035312021675e-01   +2.887840498460223e-01   +2.994594897240612e-01   -1.515230487209697e-01; +2.130454584715002e-01   -1.936544302558581e-01   +2.621196139386246e-01   +6.704965276410713e-01   +8.662637075379077e-01   +7.150105238928695e-01   +6.565344869009661e-01   -2.327063747643595e-01   +2.174445621177735e-01   +6.833055631325984e-01   +2.335502165637302e-01   +3.785996464871457e-01; +3.400851119431897e-01   +1.961524072161045e-01   +2.378559081611943e-01   +1.082944842434946e-01   +4.747483710244215e-01   +3.844661869621495e-01   +3.313654735462209e-01   +2.606187642750388e-01   +8.650729507352698e-01   -3.660353579201637e-02   +5.818775484510674e-01   +5.019642398796230e-01; +3.330917904200245e-01   +4.812828105910941e-01   +2.775497801388875e-01   +4.547977927901324e-01   +6.783467870945659e-01   +2.717295417338452e-01   +3.431093715691436e-01   +3.451788270310805e-01   +7.134673840670115e-01   +6.689938903518347e-02   +4.049136804248563e-01   -2.698056564081132e-01];
L2E_L3E_iAMPA_netcon = [+8.034588654718409e-01   -5.226730204995842e-01   +8.027389365399173e-02   -3.960761310441110e-02   +4.474730880827760e-01   +5.932616995859643e-01   +6.076716597814573e-01   +3.469699196927163e-01; +5.291432868553045e-01   +8.074837650725721e-01   -2.215435548038584e-01   +4.921588799702427e-01   +5.808441281615244e-01   +9.493551643302714e-02   +6.503518145449999e-02   +3.359636393563363e-01; +4.681754807434250e-01   +8.568362237109395e-01   +3.163012363718974e-01   +8.033689124677600e-01   +6.162352981039063e-01   +8.635099940275992e-01   +5.293726050956292e-01   +2.596717277580070e-01; +6.816409062689712e-01   +4.158491809210415e-01   +9.655683587550306e-01   +6.294065868228206e-01   +5.738395724610691e-01   -2.880246525460796e-01   +5.013280287401174e-01   +4.828086854958289e-01; +8.638437989861208e-01   +9.437941125195221e-01   +4.647655843621917e-01   -1.497781030899112e-01   +1.144484491792337e-01   +5.809432040289528e-01   +4.578002260347303e-02   +4.992955456409917e-01; +8.440404745608521e-01   +1.384936964379624e-01   +6.876557200541900e-01   +2.815783532876919e-01   +6.686835736498874e-01   +4.076892506769789e-01   -1.278361572090337e-01   +9.970768303332708e-01; +4.791155859390169e-01   +2.497482068600659e-02   +2.248677196865236e-01   +4.612980455471843e-01   +7.086465257945737e-01   +4.802725944321219e-01   +3.940676609289554e-01   +4.045325790803638e-01; +2.177192401989212e-01   +3.661334738863058e-01   +8.765702449134199e-02   -8.646971452273755e-02   +5.331554772658262e-01   -4.493985051722599e-01   +1.069717948065402e-01   +8.518180206988346e-01; +4.322320757189205e-01   +2.586161163189439e-01   +4.388999562250375e-01   +4.498649857410977e-01   -1.073311453603143e-01   +6.955298399659133e-01   +3.552365274957714e-01   +7.684759905815433e-02; +2.729887824017279e-01   -1.189666404072827e-01   +5.835322210855158e-01   +5.006344659515816e-01   +4.338202452986696e-01   +9.172913214233813e-01   +8.775311156104540e-01   +3.336863057227970e-01; +6.372859122421834e-01   -2.117160821025805e-01   +4.752574708051255e-01   +4.106233133575592e-01   +1.970465123416836e-01   +4.600714175578860e-02   -5.739653612589932e-02   +6.899783299721137e-01; +1.653743029600865e-01   -6.005838238286729e-02   +4.650151064383625e-01   -4.755506536299919e-02   +6.911076497728503e-01   +3.606378551283610e-01   +8.914111206878419e-01   +5.608637183684342e-01];
L2I_L3I_iGABA_netcon = [+2.524042540647999e-01   +9.887635977686655e-02   +5.996252132684023e-01   +5.249458924110170e-01   +1.832306964417298e-01   -1.624716363673465e-01   +2.927431315602926e-01   +3.698037869451442e-01; +1.166286321835534e-02   +5.070204000210515e-01   +3.778336420361902e-01   +6.523781603088797e-01   +3.279672266435216e-01   +6.209628800994287e-01   -1.343696842077013e-01   +4.268192339699075e-01; +1.276966366976712e-01   +6.884586817347271e-01   +2.386867083262053e-01   +4.201644858211320e-01   -1.942857626944250e-01   +2.618916281024958e-01   +4.505746835133893e-01   +5.932556101496881e-02; +2.492343392626777e-01   -1.008868719021036e-01   +4.466919189027700e-01   +9.006685044270740e-02   +2.072208904444766e-02   +2.150254474572811e-03   +5.476298776229347e-01   +4.001992229567991e-01; +1.487353602063493e-01   +4.453428936748256e-01   +3.241767523374252e-01   +1.336391050541358e-01   +2.752584506941422e-01   +6.146498823878201e-01   -3.137390524254146e-02   +1.205609927532862e-01; -8.988782594983299e-02   +1.389595041168926e-01   +1.531781282252546e-01   +8.147839524391111e-02   +2.721947048884411e-01   +7.314426620081160e-01   +5.984931884867388e-01   +2.766904523864684e-01; +9.829773930663430e-01   +3.722797026161829e-01   +2.965929619223655e-01   +3.583847221469093e-01   +1.491196844691114e-01   +2.223403053994855e-01   +7.350740383709418e-01   -1.569441962656958e-01; +4.213243905435372e-01   +3.395946124186965e-01   +6.276457401518515e-01   +5.365580286856515e-01   +4.948376960424936e-01   +5.177076234800591e-01   +2.513467396310043e-01   +1.400801515583847e-01; +4.187069583152609e-01   +4.949392381045754e-01   +3.108106134204666e-01   +2.497067595658508e-01   +6.606983444379100e-01   +4.479669832227513e-01   +1.000000000000000e+00   +3.260276275172264e-01; +9.367801239978902e-01   +4.119050269999281e-01   +6.467809690835319e-01   +2.632181307387659e-01   +3.076967992429503e-01   +4.290238259150502e-01   +2.583990485012336e-02   +2.751809459338955e-01; +4.026689791730276e-01   +5.938966834508823e-01   -3.091706701696087e-02   +2.093643979791472e-01   +3.984462744155880e-01   +2.222012989933093e-01   -3.786691710401455e-01   -1.651476792833994e-02; -4.243968627898417e-02   +2.292460619466887e-01   +1.508240613298571e-01   +1.171756485096396e-01   +2.707086164408917e-01   -3.721584263916598e-02   +1.562086778763183e-01   +6.621080817264933e-01];
L3I_L3E_iAMPA_netcon = [+4.808056755449825e-01   +8.161101339467824e-02   -9.624119246129501e-02   -2.404423518486537e-01   -2.967271415297513e-02   +3.664896358106758e-01   +3.904507269851318e-01   +2.044822721486431e-01   +7.577251362451004e-02   +6.671932683433934e-01   +7.425477278219905e-01   +6.133835978653951e-01; +7.428447260519296e-01   +5.270211064797797e-02   +8.523501004086247e-01   -2.269579612293548e-01   +6.107530041773219e-01   +2.884266959246128e-01   +6.190270698400436e-01   +1.379992798721164e-01   -1.828184702968055e-01   +3.561062887490876e-01   +3.052281482027401e-01   +4.926946994029500e-01; +4.263314158782469e-01   +1.064436221112069e-01   +4.123581123111573e-01   +6.152444410682292e-01   +1.753408732890492e-01   +2.510763201435839e-01   +9.014557820589600e-01   +1.842199701299110e-01   +6.845263321358863e-02   +3.072655718051516e-01   +2.391217242105426e-01   +1.661257468007274e-01; +7.169138645880154e-01   +1.545982815631039e-01   +8.861085304663161e-01   +4.611409753176658e-01   +2.770999804197814e-01   +7.841384589279532e-01   -4.367246002513308e-02   +4.217166772941927e-01   +3.597376378968588e-01   +1.620245190392443e-01   +9.722968143862234e-01   +1.914297582682106e-01; +2.597034603247894e-01   +3.785112792402374e-01   +1.202130546935708e-01   +3.363091653376337e-01   +7.116047058881702e-01   -2.791075418507705e-01   +9.523375599779962e-02   -1.697546417947088e-01   +5.135183259821172e-01   +4.105468327801257e-01   +3.081024643091226e-01   +2.642108452001946e-01; +1.467565601380480e-01   +2.068263715285365e-01   +4.287194311682878e-02   +5.239433353732897e-01   +3.652141997744370e-01   +1.172101948585109e-01   -3.553503217159182e-02   +8.195836554325915e-01   +5.126266772669484e-01   +5.237498963564557e-02   +7.116365746736577e-01   -7.869609215966486e-02; +4.208059645656383e-01   +9.176148332297049e-01   +5.289934954108477e-01   +3.284277414685752e-01   +4.760333439830877e-01   +3.700378665220855e-03   -5.441652559697144e-02   +1.893097581684972e-01   +3.928621958566125e-01   +6.799341851607441e-01   +5.154193046600475e-01   +5.803233581671028e-01; +1.751005843049039e-01   +4.006610770317999e-01   +4.873702525910373e-01   +9.183702034411032e-01   +4.339171361125699e-01   +3.620379363063648e-01   -1.196705099731982e-01   +2.549919634346568e-01   +5.059347547701415e-01   +7.261810094822353e-01   +1.516672089960989e-01   +4.632152375650079e-01; +2.725621130608585e-01   +6.151701385914294e-01   +8.001161589024740e-01   +2.814259646038724e-01   +1.579856360981094e-01   +5.340239198486586e-01   +5.203226789872777e-01   +8.056886507140215e-01   -2.051494147672621e-02   +4.515051618995946e-01   +3.963080151009750e-01   +6.481338101483739e-01; -1.775117535824371e-01   +5.565117405424946e-01   +5.454630208260730e-01   +4.512466191052809e-01   +6.543944825435635e-01   +2.994448725383407e-01   +6.148764237267891e-01   +3.324478678753432e-01   +5.205136974630004e-02   +4.988660077932163e-01   +5.373553336569720e-01   +5.169750677329402e-01; +7.481511493418775e-01   +4.205993930186457e-02   +4.949232369186763e-01   +9.047688662143989e-01   +4.615068009362269e-01   +1.145771312834640e-01   +1.791953559220260e-01   +9.231372298240078e-01   +8.750388491931848e-01   -3.705993526113296e-03   +8.323753380512164e-01   +7.297347999783129e-01; +2.320267209289655e-01   +3.820598815506164e-01   +4.194284422224054e-01   +7.412428501102655e-02   +9.326817969253995e-02   +5.505575941491888e-01   +7.370150854164252e-01   +9.017346355283115e-02   +1.338544260661605e-01   +3.703766161011512e-01   +1.029661645219633e-01   -3.210459155118480e-01];
L3E_L3I_iGABA_netcon = [+9.265066165828992e-02   +1.144458588960177e-01   +8.516882918881358e-01   +7.452841482609644e-02   -1.284502892046616e-01   +3.242712248220173e-01   +2.630027454247810e-01   +5.326743527032556e-01   +2.128993432276222e-01   +2.516464271671626e-01   +2.295551064686283e-01   +2.813427244570212e-01; +5.086613515486147e-01   +1.671119264214468e-01   +1.656464689563327e-01   +8.289940710644278e-01   +6.677453371224602e-01   +7.828502251465846e-02   -1.176850539933019e-01   +4.389609926238738e-01   +3.564062444524728e-01   +4.456123571827153e-01   +1.000000000000000e+00   +2.213074641228471e-01; +1.039863397331133e-01   +9.354822911560402e-02   +4.871835658960038e-01   +3.328711950107485e-01   +6.983213045998592e-01   +6.479685360700862e-01   +3.854367890276342e-01   +3.951945580582035e-01   +8.746921173756862e-02   +5.229037381866783e-01   +6.773088170370500e-01   +8.611482459710033e-01; +2.906712056050965e-01   +4.085212521585112e-01   +9.804116095026214e-01   +3.069700730403703e-01   +9.070921021331481e-02   +5.938062210991966e-01   +6.127633864383729e-01   +3.327766586325439e-01   -2.269544084196593e-02   +4.695233331936742e-01   +6.494507258341043e-01   +3.975118339936524e-01; +2.352970573996338e-01   +4.144767677147265e-01   +5.053195459078913e-01   +4.539922973594996e-01   +5.073611398676374e-01   +2.615550988070490e-01   +3.271086750898584e-01   +5.542753301938677e-01   +1.227318409046716e-01   +3.466273248740754e-01   -7.970813886319300e-02   +7.149183980793217e-01; +4.627712901363756e-01   +8.333976202450569e-02   -1.454392645472686e-01   +4.469550974217517e-01   +8.835686835761423e-01   -8.309132369291151e-02   +1.058979074229794e-01   -5.262781487620398e-02   +3.175916021899706e-01   +4.847928536196010e-01   +1.780669134044347e-01   +4.180147908031167e-01; +4.466985776734663e-01   -6.839235006603532e-02   +1.270631807172541e-01   +4.328933121299546e-01   +9.282957445789404e-02   -1.267447281868533e-01   +2.842442568691013e-01   +6.486990369061818e-01   +5.350506057012779e-01   +1.137188376915417e-01   +4.430104663566846e-01   +3.027358537138592e-01; +4.008884067311656e-01   +4.806434783035857e-02   +1.026498848093193e-01   +1.730396187744719e-02   +4.868167714148102e-01   +2.241210010523370e-01   +3.255031089258227e-01   +3.816365295608735e-01   +4.598394852886699e-01   -1.987963588758676e-01   +2.874890155849033e-01   +6.006690837248201e-01; +3.655767459944450e-01   +1.414583980372344e-01   +5.563233808586707e-02   +6.274184872975098e-01   +2.086304716981666e-01   +4.530301770985845e-01   +7.711409257700372e-01   +6.676953793885484e-02   +1.904452532495534e-01   +4.584143719411559e-01   +7.610120290593851e-01   -5.037750606357264e-02; -1.758172160529693e-01   +1.585656927028788e-01   +3.409222837975999e-01   +2.434923879677927e-01   +4.753346565682880e-01   +4.065054138335873e-01   -8.022618221321222e-03   +6.155973050058881e-01   +1.569950784358036e-01   +3.239613296670770e-01   +2.616289453997436e-01   +5.246280919845255e-01; +4.801989367717749e-01   +5.124056497925880e-01   +7.439151066164702e-01   -4.719786475109818e-02   +1.742025220192332e-01   +1.902676097021219e-01   +8.703660237888020e-02   +3.721586071943727e-01   +3.465247894873173e-01   +3.820405562340572e-01   +7.166682194031121e-01   +1.085835740179722e-01; +3.017694816809687e-01   +4.920057002778561e-01   +4.543645537138498e-01   +1.968847478799487e-01   +1.701936144143459e-01   +2.443590839230022e-01   +7.045520893608113e-01   +5.777714970677006e-01   +9.498532012981390e-01   +6.380072299196583e-01   +2.510160427353614e-01   +2.313027191322638e-01];
L2E_Input1_iAMPA_netcon = [+6.431947497683095e-01   +6.542630376494827e-01   +4.239826946876393e-01   +7.351761049049310e-01   +4.728153110408725e-01   +1.000000000000000e+00   +5.901991401649558e-01   +5.952065015599673e-01];
L2I_Input2_iAMPA_netcon = [+1.000000000000000e+00   +6.188340682987241e-01   +9.893722418856963e-01   +3.347515155949844e-01   +3.803148463288728e-01   +7.646900190407019e-01   +3.397474651718571e-01   +5.693619573660409e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last =  11.21 * ones(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))*0.4 + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.5*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.5*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))*0.9 + 0.5*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))*0.4 + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.5*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.5*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))*0.9 + 0.5*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
