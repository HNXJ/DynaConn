function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+5.325850152624705e-01   +4.632575691204358e-01   +8.500424296504669e-01   +5.809998009379771e-01   +2.910615831053339e-01   +7.127589683861469e-01   +7.190347849483696e-02   +5.448395066248711e-01   +4.570556868448020e-01   +9.652009158879482e-01   +1.046903712613454e-01   +1.615898419091249e-01   +3.465706083764736e-01   +4.298910018143330e-01   +1.750298749396269e-01   +1.283626069861199e-01; +7.219189275559657e-01   +8.698907349328625e-01   +9.239311475163407e-02   +8.257155154238025e-01   +5.523858177890953e-01   +6.142548424984783e-01   +5.073846649808237e-01   +3.538126120242703e-01   +7.577073921695420e-01   +7.486763821591997e-01   +4.562553486388272e-01   +6.392174549322638e-01   +4.694512859084279e-01   +9.096873731168325e-01   +4.068675999762252e-01   +1.126281764659292e-01; +8.576069493665007e-01   +1.576264435595832e-01   +1.022766547478656e-02   +2.485329009807422e-01   +4.633752814709024e-01   +8.756523016664375e-02   +7.274524812790861e-01   +5.138942116919285e-01   +7.590115226572425e-01   +6.633492572428416e-01   +3.064944733048096e-01   +5.904413449867538e-02   +4.737022512229052e-01   +1.054330555445017e-02   +3.591236729146286e-01   +2.445340666194540e-01; +9.005218988294132e-01   +1.279397728984972e-02   +8.105067556933292e-02   +8.997919805632303e-01   +5.644895639749545e-01   +5.869074584992613e-01   +5.906226193568427e-01   +8.389529640075184e-01   +6.194785601087266e-01   +3.971085554530016e-01   +5.861624830777029e-01   +8.262033137375108e-01   +3.358967790278672e-01   +8.663735377111088e-01   +3.233457755725428e-01   +2.774992225655463e-01; +6.733145967157511e-01   +2.592211388937408e-01   +9.158079076024243e-01   +8.154071973937653e-01   +4.700122018867273e-02   +1.225213491237192e-01   +3.047605621512574e-01   +8.838736658870074e-01   +5.890244066701226e-01   +4.523836412737058e-01   +6.050862077895461e-01   +1.224593666538912e-01   +3.809628455720094e-01   +1.627563383307518e-01   +5.848824068407297e-01   +4.513931446381233e-01; +2.291765961307005e-01   +6.584036752917219e-01   +5.965835799504258e-01   +8.850362384089269e-02   +8.524211716851350e-01   +2.788756358489455e-01   +8.488685351546423e-01   +3.486164780277570e-01   +3.441239526891535e-01   +9.557739545242085e-02   +1.662901929665475e-01   +4.754934715336916e-01   +9.203261184053664e-01   +1.479247730980676e-01   +3.047744643103319e-01   +3.118799675208646e-02; +7.048716647884246e-01   +7.750709688128078e-01   +5.689785316478967e-01   +3.848772520442415e-01   +2.332797784335766e-02   +3.485584172705602e-01   +1.242411548715002e-01   +3.015340150661724e-02   +8.034213821458815e-01   +5.525718950845063e-01   +3.163684080149815e-01   +7.873670707084017e-01   +3.165472386219047e-01   +3.169264841116513e-01   +8.158554046352533e-01   +4.712252527045253e-01; +4.115231975645316e-01   +5.368457724621492e-01   +8.565690059810060e-02   +7.237424605725140e-01   -4.928095077101408e-02   +1.309629705704696e-01   +5.169577660014125e-01   +5.905152771608402e-01   +4.661087845490039e-01   +6.144091742251192e-01   +3.003912205310261e-01   +6.384671335993624e-01   +7.715094924962477e-01   +6.130639431484939e-01   +8.779905463790444e-01   +4.658394971938553e-01; +3.618040615154733e-01   +8.201216265266943e-01   +3.335353192587278e-01   +6.386463446967487e-01   +2.704831450968561e-01   +7.808241047956452e-01   +9.084682003060343e-01   +1.858626421575526e-01   +1.893131771229739e-01   +7.298018262752322e-01   +7.900920541155508e-01   +5.444214401845886e-02   +7.538781079267144e-01   +6.462574958210925e-01   +9.894237278514072e-02   +1.202002543802729e-01; -2.367040857189565e-03   +5.391364402102510e-01   +9.136773409480213e-01   +8.990254218760332e-01   +6.268456378814972e-01   +1.319621049635450e-01   +9.652764985427126e-01   +6.969875020573068e-01   +1.003117830050220e-02   +3.669562330315194e-01   +5.655992059417505e-02   +7.422902333043773e-01   +8.566453275551151e-01   -4.986207501850496e-02   +5.868555843290435e-01   +7.684705113269662e-01; +2.461961518238396e-01   +7.163611666106208e-01   +1.000000000000000e+00   +5.776667515444489e-01   +8.259312545616178e-01   +7.618366845444468e-01   +4.483245403702272e-01   +4.698168947677183e-01   +4.333920172639937e-01   +5.128928838029321e-01   +5.564123035625510e-01   +5.974824604110275e-01   +7.960665014521354e-02   +7.688514958388071e-01   +4.764099971118805e-01   +7.743578436860928e-01; +8.172451556354483e-01   +8.518542147401796e-02   +5.438177598614332e-01   +1.591255002061901e-01   +5.112173287342766e-01   +4.983541459683514e-01   +6.005488919310030e-01   +4.181080469662183e-01   +9.051109896847163e-01   -3.654923037650561e-02   +3.898330086015152e-01   +7.759084673265108e-01   +1.547373001933308e-01   -4.283962499011148e-02   +1.829821939680066e-01   +6.732139126993057e-01; -1.054461733002581e-01   +6.907930344171876e-01   +6.096242541184042e-01   +6.688189069731233e-01   +7.281160700931741e-01   +6.603578938590495e-01   +5.282668602300901e-01   +6.067342058790262e-01   +9.054925489841444e-01   +6.153472669981898e-01   +1.608762563833424e-01   +3.275099017604596e-01   +1.281432174739600e-01   +4.867409558430962e-02   +6.601474474807247e-01   +3.922243289225006e-01; +3.869768106722771e-01   +7.770237230763483e-01   +4.294798191628884e-01   +1.319988128583622e-01   +5.045796873709990e-01   +6.964880723025031e-01   +6.583240847053695e-01   +8.395644438504644e-01   +9.102349781131328e-02   +3.287829345567820e-01   +4.832798420581113e-01   +4.562489338665183e-01   +8.807060287139044e-01   +3.467643224470794e-01   +8.097513074008883e-01   +5.083522163866746e-01; +6.311841393107243e-01   +1.194217205761658e-01   +2.792794142628029e-01   +9.542490716348984e-01   +5.601230449630422e-01   +4.283062828667134e-01   +4.420011715477618e-01   +2.853661885671084e-02   +2.569091477851835e-02   +4.984244578703170e-01   +4.527132492650007e-01   +8.256384317626644e-01   +8.621181006948309e-01   +6.564868180206829e-01   +6.583626751240049e-01   +4.646584809041332e-01; -1.207288571195358e-01   +3.442117290008636e-01   +7.755277577301768e-01   +2.660709039667686e-01   +7.764521995387114e-01   +8.126460691243992e-01   +4.859079373905521e-02   +9.409982908370502e-01   +5.194274168263649e-03   +8.088889080423933e-01   +3.949820544341792e-01   +2.351111187657174e-01   +6.372934203186166e-02   +6.299154861322943e-01   +7.439595577695983e-01   +3.648161924566126e-01];
L1E_L1I_iGABA_netcon = [+8.762133112921197e-01   +4.663161736984827e-01   +7.043426309151030e-01   +4.715917427656832e-01   +3.402688470811237e-01   +4.201958129466831e-01   +6.932106077455482e-01   +4.653380472270090e-01   +2.597675492109057e-02   +2.099954825281236e-01   +4.136531767125510e-01   +3.367852963904332e-01   +7.515762887569131e-01   +1.280157905781923e-01   +2.101514511406317e-01   +8.887065875354985e-01; +5.269356283168668e-01   +3.185977299590522e-02   +7.807141584333872e-01   +1.874341689450868e-01   +4.170752256567404e-01   +7.844252053917465e-01   +4.352645560453719e-01   +7.901508697626495e-01   +4.336626310601080e-01   +5.781843604936733e-01   +5.755075341481068e-01   +1.686193212978153e-01   +9.087913265359775e-01   +3.835315798411953e-01   -2.464259223972383e-02   +3.554067983969340e-02; +3.167890865827215e-01   +8.440288752378079e-01   +8.179326017333862e-01   +2.170241055374531e-01   +7.852891238051457e-01   +6.783914487053639e-01   +5.107781082733504e-01   +9.348157246676807e-02   +2.580375541297524e-01   +8.742693687031973e-01   +5.714692807385009e-01   +6.957316425310316e-01   +3.594311642795143e-01   +5.201402046945672e-02   +3.079817071504781e-04   +8.122736862979877e-01; +7.736418706185904e-01   +9.886811196059121e-02   +2.737883772315501e-01   +6.767267231289582e-01   +1.312037602058525e-01   +1.780079573836376e-01   +4.624914427538477e-01   +9.092268366737971e-02   +4.348650664358316e-01   +2.271916918589837e-01   +3.572035163886111e-01   +8.588328788993965e-01   +1.610137221080336e-01   +8.540035048237710e-01   +4.504091919478320e-01   +5.866044511158663e-02; +5.396260772695676e-01   +5.023113137311790e-01   +3.927855674420679e-01   +2.382052228908614e-01   +6.665660996819296e-01   +2.462063346911699e-01   +8.390526284697480e-01   +2.286873704925752e-01   +5.648720768666502e-01   +2.215496974545590e-01   +2.618495815384843e-01   +7.964481555000782e-01   +6.121515901913424e-01   +1.743441120640236e-01   +2.832056896786508e-01   +5.516553225921497e-01; +3.612499123361385e-01   +7.654642192407729e-01   +7.355639083584491e-01   +1.122611044463350e-02   +6.933691196395315e-01   +6.008473364909235e-03   +3.407964424634180e-01   +4.635885754702993e-02   +3.741283880413988e-01   -4.692974670619001e-02   +6.608906699432446e-01   +8.876391509795117e-01   +6.598452315766115e-01   +4.612193147489391e-02   +5.926532537203510e-01   +3.214084423298779e-01; +5.272459225884283e-01   +3.053158646050466e-01   +3.402042449497336e-01   +4.322151168700174e-01   +1.642727764583286e-01   +4.814818600281108e-01   +6.365964693364675e-01   +8.530852123428398e-02   +2.878699873600920e-01   +3.199146504898554e-01   +3.348428887392137e-01   +5.201448309748263e-01   +8.738075254440323e-01   +5.738756243869212e-01   +5.920193306994013e-01   +4.794714698856020e-01; +8.779867419280587e-01   +7.002387640643468e-01   +4.386625533382332e-02   +4.893794800370973e-01   +6.771712256733525e-01   +1.763811432757134e-01   +4.830963275788610e-01   +4.126548631602252e-03   +1.000000000000000e+00   +1.257857270565827e-01   +7.577078750286634e-01   +2.445820117339133e-01   +3.447851646608626e-01   +3.576157015723491e-01   +4.942954154176298e-02   +4.578593727474471e-01; +6.088878868395533e-01   +2.592945744534628e-01   +4.075343170646796e-01   +1.476694083359451e-01   +6.816381306628596e-01   +9.599409752626973e-01   +4.399622875591407e-01   +5.889264105463450e-01   +4.784324709418118e-01   +4.297863495152980e-01   +5.178379181440059e-01   +7.304565630389540e-01   +3.596305776836797e-01   +4.995529672545206e-01   +3.178640564898182e-01   +2.644257940352292e-01; +2.837839609437519e-02   +7.136700148768972e-01   +8.477323188161376e-02   +7.629970017135943e-01   +2.799250652811351e-01   +8.253772502338992e-01   +4.331941378618651e-01   +3.675924793472669e-01   +7.924091579110271e-01   -9.904156921171985e-03   +6.142907574703383e-02   +4.749073965120665e-01   +6.122017920344336e-01   +6.256693932689210e-01   +3.899367244955013e-01   +7.870584729333681e-01; +7.833730147538934e-01   +2.346575014047423e-01   +4.751257903177560e-01   +4.650325791149372e-01   +1.772608854589116e-01   +2.407775417474447e-01   +6.441244668896950e-01   +3.114279389239351e-01   +8.500372163148302e-01   +5.528206013715774e-02   +4.128012255979318e-01   +7.797617882606407e-01   +7.155352884253779e-01   +2.242676720566009e-01   +4.553687263150094e-01   +2.408241979586510e-01; +5.808728482763945e-01   +3.512291224808534e-01   +2.549517038315346e-01   +5.187816078728608e-02   +1.848053391226526e-01   +1.455416718022389e-01   -2.207549688301397e-02   +8.551121667659022e-01   +1.224055487833745e-01   +8.667724078956928e-01   +5.403233970405720e-01   +9.971029742197941e-01   +3.965660912216999e-01   +2.043124831106887e-01   +5.187116903694100e-01   +7.834316352364358e-01; +7.527533941210811e-01   +2.952746220620414e-01   +1.730371804960082e-01   +9.227309819990538e-01   -1.564043323916575e-02   +3.775686794284469e-01   +6.322107090358829e-01   +3.366911340168194e-01   +8.675715184030564e-02   +9.826978050352915e-02   +9.317771671013368e-01   +3.661133007725721e-01   +1.835784444244201e-01   +2.942954267983756e-01   +8.191339353249419e-01   +4.586999135297708e-01; +2.049660775740488e-01   +4.538633883996734e-01   +2.571633307745564e-01   +7.405320835774789e-01   +5.464953218910001e-02   +6.238749334197655e-01   +5.681807250310918e-01   +4.413120227218791e-01   +7.708854178880287e-01   +7.027755993285190e-02   +4.217534123648345e-01   +7.328247054613951e-02   +4.947617205678790e-01   +1.660964468262427e-01   +1.401887895908436e-01   +9.151445123971225e-02; +7.754198729327619e-01   +7.212141335437950e-01   +2.250533798331765e-01   +1.482130868606179e-01   -1.475900404853622e-02   +3.791642242547718e-01   +4.546264547655680e-01   +7.641071421604941e-01   +3.329080720098607e-01   +4.133185716940733e-01   +7.326797737285723e-01   +3.141397113672821e-01   -2.857944229661860e-02   +1.624585714735761e-01   +4.074156810212344e-01   +8.384421443760096e-01; +7.518447549127020e-01   +3.840494793744351e-01   +8.007620128785589e-01   +3.985758372489931e-01   +6.210224357031233e-01   +5.213064883272034e-01   +4.193852540091064e-01   +2.483983166148943e-01   -7.246568617843752e-02   +2.919344992804500e-01   -1.157574924631272e-02   +6.811787455566354e-01   +4.485013022716382e-01   +5.423511021559096e-01   +1.876907778559190e-01   +3.139631964574352e-01];
L2I_L1I_iGABA_netcon = [+5.435140387170145e-01   +1.553079197272953e-01   +1.134182945550181e-01   +9.160793875850143e-01   +3.324142911591560e-01   +3.957869837497446e-01   +1.286638115244875e-01   +5.128137607824008e-01; +6.129497029453195e-01   +6.986448379967060e-01   +3.571075145417631e-01   +2.814085707455750e-01   +5.723862141805820e-01   +3.644547314470181e-01   +5.601527407946120e-01   -1.860010286154353e-02; +4.188435358779102e-01   +6.588711315254493e-01   +6.460856363927187e-01   +2.197680818054192e-01   +6.041797125892174e-01   +9.440598692442922e-02   +3.243442632108479e-01   +3.008768346762277e-01; +5.840917187606114e-01   +2.409005320475819e-01   +1.070068933463071e-01   -1.361886631383037e-01   +7.507145015026703e-01   +5.293329246230318e-01   +6.331631917234980e-01   +6.191448852159422e-01; +1.786985747271935e-01   +9.119436763466718e-01   +2.802548149609261e-01   +7.872777090614231e-01   +1.409212594655236e-01   +3.598654364542114e-01   +3.988825972705404e-01   +3.545584100529501e-01; +6.884110041620208e-01   -8.674297735280563e-02   +2.544691626124413e-01   +4.258353171859168e-01   +5.553162989485535e-02   +4.573137769702947e-01   +6.315728623933811e-01   +8.706979052938972e-01; +5.794402270709578e-01   +1.000000000000000e+00   +8.620613341806949e-01   -2.346070202285534e-02   +4.539510703208089e-01   +2.352726411697006e-01   +8.076712412474477e-01   +3.546357945407921e-01; +4.665627912036635e-01   +5.598101776168379e-01   +1.764799110874571e-01   +1.862918807695027e-01   +5.798603485997609e-01   +3.409436643800372e-01   +4.181205612186170e-01   +1.538532806449878e-01; +6.859071932386996e-01   +8.950943776143684e-01   +1.234218899444670e-01   +5.728061766027966e-01   +1.069369883201271e-01   +8.082601026048919e-02   +1.310196109132754e-01   +3.744805152464088e-01; +1.648363019118073e-01   +1.597912326727654e-01   +2.570244925407379e-01   +9.084258244251556e-01   +7.429692202827669e-01   +4.632156562228345e-01   +1.291119625520755e-01   +7.926995667904421e-01; +1.422394449760927e-01   +8.084222329524640e-01   +1.849788846870995e-01   +7.264005411394799e-01   +5.174253358334245e-01   +5.406168304008818e-01   +5.196595263525426e-01   +5.861660233398022e-02; +5.243747421721389e-01   +4.972958748899996e-02   +7.408577398853434e-01   +4.101627295349099e-02   -3.363257863338073e-03   +7.193227675400720e-01   +5.521474056797978e-01   +4.527924763195376e-01; +2.818338543369490e-01   +7.043058375186576e-01   +9.751070620509187e-01   +9.487552187910715e-02   +8.313010379863463e-02   +2.467621997722565e-01   +5.560477754073748e-02   -1.167152276510778e-02; +1.519159626472789e-01   +3.137831275888271e-01   +9.599447256215932e-02   -1.109087002740578e-02   +3.634905095992259e-01   +1.963531798368519e-01   +3.519252300140429e-01   +4.477129978350816e-01; +7.727057133821338e-01   +7.938778714031952e-01   +9.535739886522777e-01   +9.090298215318939e-01   +7.751239865579501e-01   +8.381272457053893e-01   +8.463489263295308e-01   +7.884436189254369e-01; +3.408460851137443e-01   +3.322131039789695e-01   +7.934638466724342e-01   +4.195277582599228e-01   +3.164237264896241e-01   +3.842157085569117e-01   +7.594208238979859e-01   +9.378852223929216e-01];
L1I_L2I_iGABA_netcon = [+6.149795528286813e-01   +4.006262080870636e-01   +4.468769102661417e-01   +6.564547892317094e-01   +5.069880748015988e-01   +3.457505584160807e-01   +6.555992283880429e-01   +7.175544926304663e-01   -1.687964779286405e-02   +6.516845837412677e-01   +5.440629588408628e-01   +3.811327279910727e-01   +8.444678078160214e-01   +4.107167658713665e-01   +2.682110408301432e-01   +3.562407100535648e-01; +3.079543235231425e-01   +8.529001254279261e-01   -2.100538310543491e-02   +1.297432117285905e-01   +4.132071528377774e-01   +6.527493473628007e-01   +8.098973489142004e-01   +1.767616141436550e-01   +9.568500794400883e-01   +7.720954997379907e-01   +5.825701696368277e-01   +4.020028164983641e-01   +3.314356302702662e-01   -3.426948741855027e-02   +2.044513943267013e-01   +7.397588260578103e-01; +1.816565366194428e-01   +3.413698775332767e-01   +4.248058413108632e-01   +5.633453041549182e-01   +7.632614564386307e-01   +8.103488511051198e-01   +6.610091242615599e-01   +7.768176917584011e-01   +9.326672600911384e-02   +9.270928194273129e-02   +3.799772619639428e-02   +6.723733056431439e-01   +6.900427959195707e-01   +8.334012051766306e-01   +4.822121462152807e-01   -6.544108505445541e-02; +7.837307503137447e-01   +5.060307496018162e-01   +3.816392671693714e-01   +4.265719612408290e-01   +8.351848318612699e-01   +3.236813520728349e-01   +6.782271268017257e-01   +6.585818947007257e-01   +2.866853928065743e-01   +2.312277814794336e-01   +1.887562192932866e-01   +3.830462491875973e-01   +6.845826652594981e-01   +3.658156037841099e-01   +5.399586509630111e-01   +1.104075605709759e-01; +6.998372701235765e-01   +3.806131124770620e-01   +6.880272020841967e-01   +8.603744970754843e-01   +1.509632988832403e-01   +8.576583377012700e-01   +7.850821158677213e-01   +5.418936153831552e-01   +5.987121567158351e-01   +3.036287833625509e-01   +1.337777749083765e-01   +6.855560038185884e-01   +3.919195920629261e-02   +4.759166832094914e-01   +5.958578509954722e-01   +3.748609645991935e-01; +3.482377056287370e-01   +6.210442794280648e-01   +1.776778691715077e-01   +6.752448370754472e-01   +1.088483322957259e-01   +5.310696628270385e-01   +6.558206118601045e-01   +2.404325335723380e-01   +3.539801791781948e-01   +2.853882058012057e-01   +5.064838945936923e-01   +1.010040364968373e-01   +5.096306723049597e-01   +4.652549200608226e-01   +3.026574937722637e-01   +3.311486997140820e-01; +5.898785806868553e-01   +6.821267332731271e-01   +2.658972217130014e-01   +3.129384837221277e-01   +9.529906419749579e-01   +1.191580912161223e-01   +4.683302779291814e-01   +2.292856982751026e-01   +3.760202170743244e-01   +7.474246704962022e-01   +1.840360114485659e-01   +5.024426038579253e-01   +4.540248277847423e-01   +1.202850390889401e-01   +2.588344797683713e-01   +6.009581461396634e-01; +4.479997000032776e-01   +4.993509743950633e-01   +6.899046008074988e-02   +5.622182717495026e-01   +8.164616831539413e-01   +5.638633125548113e-01   +4.231457013192693e-01   +5.127675034848975e-01   +8.544995457366900e-02   +2.642470546731334e-01   +1.000000000000000e+00   +3.896232516469089e-01   +8.666550203140694e-01   +1.846794859922759e-01   +8.146580856849978e-01   +2.389681209544137e-01];
L2E_L1E_iAMPA_netcon = [+5.975308146737734e-01   +5.112644785112426e-01   +1.325279968230961e-01   +3.977690762512798e-01   +8.789117107931921e-01   +7.564599945855757e-01   +4.217759617262136e-01   +7.526307727149948e-01; +2.290093670840584e-01   +5.173279183803681e-01   +6.490585729448222e-03   +3.522716262602740e-01   +5.735505461693926e-01   +3.590852716375710e-01   +3.507825644967586e-01   +5.436599172688514e-01; +1.308599746889519e-01   +9.337559252291368e-01   +3.457633622899736e-01   +3.941288768557878e-01   +5.604665013480815e-02   +6.951573738294736e-01   +5.636472355463981e-01   +9.188634911643335e-01; +6.640730928226563e-01   +2.750457776070137e-01   +2.447521878784488e-01   +6.741763516621393e-01   +3.260895975615881e-01   +4.614698433638924e-01   +4.392682251882445e-01   +4.488872917783348e-01; +2.093466822231288e-01   +4.617175277375541e-01   +6.081625359403329e-02   +6.001805910424821e-01   +7.331773972241434e-01   +4.657873173910443e-01   +9.730042352959921e-01   +1.000000000000000e+00; +7.730199841192086e-01   +1.159615284914115e-01   +8.303610656332373e-01   +4.117910370572980e-02   +3.955245397037025e-01   +8.022738108041546e-01   +9.181914368473173e-01   +1.040682777269800e-01; +2.048372174466012e-01   +6.517312079180244e-01   +2.818366396573633e-01   +1.289447873585646e-01   +4.302845205480062e-02   +3.403872072345464e-01   +7.149991052439200e-01   +2.094781682304925e-01; +5.929296073309100e-01   +6.248723080521417e-01   +8.437407517526204e-01   +2.324601717766726e-01   +1.958630514998539e-01   +4.283799931786680e-01   +7.749312075267636e-01   +1.774907357016474e-01; +8.726102287464028e-01   +5.839954605173524e-01   +2.884479876816769e-03   +7.402568159373419e-01   +4.049875000329402e-01   +5.510310981896362e-01   +2.313315415853300e-01   +1.859565458043317e-01; +3.255476429838921e-01   +6.841611544530103e-01   +8.383949852182512e-01   +3.605966539152753e-01   +3.199449359309746e-01   +3.508696221486560e-01   +5.693716170957623e-01   +8.817617195973491e-01; +1.147521007203571e-01   +3.686814376658479e-01   +4.064991896990020e-01   +5.831074042710256e-01   +4.252152186184224e-01   +4.936962925728988e-01   +3.725417603515109e-01   +6.881353393868845e-01; +2.265043410755760e-01   +4.652295933819351e-01   +5.370275402705257e-01   +2.754734521159604e-02   +3.806580460515605e-01   +4.684816163216635e-01   +2.180639556323083e-02   +3.720072088597188e-01; +2.292871022785311e-01   +4.786602106373697e-01   +1.523395147838059e-01   +5.258017344646886e-01   +7.313377554413218e-01   +2.995420289649881e-01   +2.966874626705540e-01   +4.867873676354770e-02; +2.956306571121481e-01   +6.128534979006428e-01   +5.315642243469828e-01   +8.439288465797373e-01   +6.392553699655055e-01   +6.239080374543190e-02   +4.247180247509881e-01   +5.662584992662217e-01; +2.238355546646462e-01   +1.850831436257380e-01   +7.361935976003757e-01   +4.392182980219196e-01   +3.777827584045725e-01   +8.571642022653139e-01   +1.865575926720755e-01   +8.148581288898322e-01; +3.751707284709845e-01   +1.464911928967615e-01   +2.942081481006952e-01   +5.901800054165920e-02   +8.007155755791312e-01   +6.165889568918729e-01   +4.722292614312698e-01   +7.064514518904563e-01];
L1E_L2E_iAMPA_netcon = [+1.847868800450368e-01   +1.554894143715395e-01   +5.962981420238501e-02   +6.772725205102472e-01   +4.176670820462440e-01   +4.143938921976207e-01   +4.909184643026206e-01   +4.803508956639393e-01   +8.134945809782539e-01   +7.784844506616189e-01   +4.506682888218290e-01   +8.359760001666160e-01   +4.764543449155437e-01   +3.077179763553958e-01   +3.908095720746512e-02   +4.879234060752023e-01; +5.483406087796301e-01   +1.920087494371004e-01   +1.193921408585997e-01   +6.582080953587137e-01   +6.290770354366709e-01   +1.017224355552673e-02   +1.396745509277973e-01   +7.073275682253117e-01   +6.425998157489481e-01   +1.199915650318610e-01   +6.279663392486977e-01   +8.175260711036756e-01   +2.878927652161777e-01   +1.783254853881050e-01   +8.376658122929362e-02   +4.715564297271740e-01; +9.442669084825150e-01   +8.109014074515227e-01   +6.052399273310018e-02   +1.046650613546473e-01   +7.216449068141427e-01   +7.105272216830744e-01   +3.860930205853121e-01   +9.619901981002492e-01   +4.314426701733724e-01   +3.735555416276333e-01   +1.292636393984153e-01   +2.026893467644167e-01   +2.281782700448196e-01   +6.250815670177317e-01   +8.312223411980832e-01   +1.933363690683590e-01; +5.017506360253806e-01   +5.918399538036099e-01   +7.271549374561578e-01   -9.098052182364469e-02   +4.710617678793364e-01   +5.551410279897052e-01   +8.054126865448177e-01   +5.138577808588061e-01   +4.067911569417532e-01   +4.111175168611814e-01   +7.939474087717685e-01   +3.484523960372825e-01   +6.643232363022535e-01   +5.064637421106980e-01   +9.809250395632222e-01   -2.179970571454781e-02; +2.236092596582592e-01   +3.377383203670275e-01   +8.911484862202076e-01   +3.383720164574224e-01   +1.584206508440193e-01   +8.805441418014227e-01   +3.020418669739754e-01   +4.911785853835610e-01   +9.721814441077095e-01   +3.388915407347676e-01   +5.450531033963871e-01   +3.336230565836385e-01   +5.891415835481483e-01   +9.108537158926749e-01   +8.323080838111897e-01   +4.854081770811346e-01; -4.201745018189512e-02   +7.675152081940729e-01   +2.490915413442376e-01   +6.141223730997603e-01   +3.260061093802578e-01   +1.322278664958081e-02   +8.079552983689019e-01   +4.801447670580898e-01   +9.069857785568665e-01   +4.015794399458102e-01   +8.447451113294548e-01   +2.239292815518036e-01   +4.946682081255397e-01   +8.325992375203681e-02   +1.675174712422364e-01   +2.192256983493548e-01; +2.528887810821929e-01   +2.164126346024169e-01   +6.902753455188806e-01   +8.435247557192962e-01   +2.128714780986490e-01   -9.590422278360956e-02   +8.057280898182761e-01   +8.095324246438376e-01   +1.213523482607289e-01   -6.618519167438529e-02   +4.319812261962013e-01   +2.830871160167858e-01   +5.365518816857678e-02   +8.651368259116438e-02   +4.429555941056358e-01   +1.148448278975508e-01; +9.673189861870071e-02   +3.831495407233663e-01   +9.048017253777851e-01   +5.271787015739138e-01   +8.526559336651709e-01   +1.000000000000000e+00   +9.449199147292600e-01   +1.666684522375072e-01   +1.824928371549376e-01   +6.005129443729358e-01   +8.882539189640355e-01   +5.201602913557838e-01   +4.475032972262549e-01   +4.381553368835211e-01   +2.378646626980802e-01   +3.674449064479055e-01];
L2I_L2E_iAMPA_netcon = [+6.959114530641788e-01   +9.145989531029484e-01   +6.463744343830599e-01   +2.233294508305292e-01   +1.174026962165059e-01   +8.667793102429363e-01   +5.495257288899463e-01   +4.846927268785585e-01; +8.760357671515705e-01   +1.568894656598238e-01   +9.260643163968508e-01   +7.814506545339720e-01   +9.450800032608142e-01   +1.137670426329081e-01   +4.398397314501543e-01   +5.367935343288248e-01; +1.000000000000000e+00   +3.527679155175686e-01   +3.063201060893612e-01   +1.225706109293146e-01   +5.792824770547801e-01   +6.628741856306852e-01   +4.587579262934058e-01   +4.425303796249342e-01; +3.268232293217023e-01   +7.219343511772540e-01   +4.436705941761091e-01   +9.387399042657085e-01   +4.600540574870959e-01   +4.282913298594515e-01   +2.738913530799679e-01   +7.214574289025150e-01; +7.101609977407777e-01   +5.014833195702056e-01   +5.466517126152947e-01   +6.911997250121382e-01   +6.596528688978043e-01   +7.751731376617019e-01   +8.149973078204223e-01   +1.044608595527935e-01; +3.259458293479024e-01   +8.069294589160101e-01   +1.547682806870573e-01   +7.050498172924280e-01   +3.136056945361662e-01   +1.304216478108933e-01   +6.440667378952519e-01   +2.739114039827136e-01; +5.699103235026443e-01   +2.610402966055024e-01   +4.144755900559917e-01   +7.758352497764758e-01   +7.548889417726898e-01   +6.294860621521714e-01   +8.520434952005274e-01   +4.459637007293191e-01; +7.577841349078182e-01   +6.084119083401096e-01   +1.292340401068716e-01   +4.376450104327285e-01   +7.112559696116812e-02   +7.697179435441223e-01   -1.166205289206638e-01   +6.990280961519399e-01];
L2E_L2I_iGABA_netcon = [+1.409220659371222e-01   +4.380119717355684e-01   +5.061913563995081e-01   +2.492088750557805e-01   +2.669109427658407e-01   +3.512834141189262e-01   +4.776286817304038e-01   +8.808763156600232e-01; +5.879379445679711e-01   +8.458597896699592e-01   +6.745563943942956e-01   +4.914928499078208e-01   +7.436269016620498e-01   +7.208837918137445e-01   +1.669980755712213e-01   +1.986448767006818e-01; +3.031796743333375e-01   +9.720630993519713e-01   +1.096386450063438e-02   -5.529499597416026e-02   +4.587799162490875e-01   +8.296609722405216e-01   +3.579731494817202e-02   +4.907865268142833e-01; +1.389014527598179e-01   +9.287576885770381e-01   +5.478063666814145e-01   +8.347966770547165e-01   +9.873107306981348e-01   +7.983284835037141e-01   +9.072414049766085e-02   +3.597815413107132e-01; +5.574129464539095e-02   -5.732514913887117e-02   +2.933678566627791e-01   +8.366945470954151e-01   +8.336970655673265e-01   +6.573807807339251e-01   +5.056828248834857e-02   +4.072485074400210e-02; +3.136120259684237e-01   +2.415716137968305e-01   +3.595823588137304e-01   +3.362954080890902e-01   +8.751575398473465e-01   +2.907389665968951e-02   +5.383016168980107e-01   +9.044394204465109e-02; +8.483480046693830e-01   +1.401013353613884e-01   -1.010559068743737e-01   +2.668210108201657e-01   +2.162170739285391e-02   +1.037469498553314e-02   +5.187850287656319e-01   +1.000000000000000e+00; +1.490913154654199e-01   +8.136798030750388e-01   +6.173294822932195e-01   +8.883651364079976e-03   +8.696112799585854e-01   +8.634885701173394e-01   +6.278331212130583e-01   +7.691368269373051e-01];
L3E_L2E_iAMPA_netcon = [+2.174047500303305e-01   +1.093639731869351e-01   +5.072128678445411e-01   +6.452517370000951e-01   +3.308025677326894e-01   +2.025606310596901e-01   +4.828412792156680e-01   +8.010246637284894e-01   +6.726925325156953e-01   +4.171651441437382e-01   +1.087828004621967e-01   +6.598200788672338e-01; +4.822385309692380e-01   +9.524596340346295e-01   +4.121144571232090e-03   +2.251208286713191e-01   +3.052809411738578e-01   +1.254696087988519e-01   +2.813032897021450e-01   +3.462157069677229e-01   +9.140946885186892e-01   +2.503348261948259e-01   +6.266598619351438e-01   +3.792457247201036e-01; +2.389029900407608e-01   +6.369803775137668e-01   +6.412775366009789e-01   +5.816256569168594e-01   +9.397865096096930e-01   +7.347996231685379e-01   +8.391115534311882e-01   +6.576409043615680e-01   +6.629197622511339e-01   +1.305815526455272e-01   +1.032816815023327e-01   +6.985225930409096e-01; +3.195438938083043e-01   +2.812841626838281e-01   +7.849588677925267e-01   +3.074364946653269e-01   +6.996342943757782e-01   +4.262302750890453e-01   +2.193975634463230e-01   +4.316689820799068e-01   +5.740689539799593e-01   +8.376561842212947e-01   +8.572645548154306e-02   +2.525450997803626e-01; +6.234281684837788e-01   +3.036658230427083e-01   +1.807427191361444e-01   +1.885283032117755e-01   +8.113691084031688e-01   +3.791569395301310e-01   +2.029008775693766e-01   +1.231450556499169e-01   +9.579250240222141e-01   +6.841547187905715e-01   +7.592745076168530e-01   +7.054891628850812e-01; +6.462853869617109e-01   +7.576846013391628e-01   +7.371959833836464e-01   +7.943886056888803e-02   +7.412943278799208e-01   +9.760684468544443e-01   +1.848377503004916e-01   +3.412032105808476e-02   +2.669101794246441e-01   +8.708902819509565e-01   +5.529451151438929e-02   +5.693105552236060e-01; +5.232837522492186e-02   +4.942514822668471e-01   +7.344351494017335e-01   +2.364815472908185e-01   +8.654687985136517e-02   +7.774462649234205e-01   +7.296032298021470e-01   +8.566248678367326e-01   +3.819073516767469e-01   +5.412595263315541e-01   +9.128988377838108e-02   +3.655844713968389e-01; +6.781780037850361e-02   +6.903643195864282e-01   +6.142322842278316e-02   -5.370646768552608e-02   +4.402213538593315e-01   +6.778636342013912e-02   +4.909111210588882e-01   +5.938111596044602e-02   +1.000000000000000e+00   +7.889591437492000e-01   +2.040373180447148e-01   +4.206965121400635e-01];
L3I_L2I_iGABA_netcon = [+6.453714423857374e-01   +5.499115848985724e-01   +4.829014814476592e-01   +8.245924484165654e-01   +3.052618740264983e-01   +1.658525981954818e-01   +7.925019751044642e-01   +3.484083862612890e-01   +8.320638530352534e-01   +5.332592663872777e-02   +7.701824293188094e-01   +7.206406327799013e-01; +5.829045783692490e-01   +9.377384127495657e-02   +4.007113491864475e-01   +3.721474404633587e-01   +8.640001269390633e-01   +2.704250838595438e-01   +6.804892948801893e-01   +2.624810540175437e-01   +4.054965552271962e-01   +2.081704029190974e-01   +6.426235029309242e-01   -8.965773134146167e-02; +6.455831897711948e-01   +6.372121578581647e-01   +7.217131473733517e-01   +2.652928309622708e-01   -8.999052367124678e-04   +5.370535353840846e-02   +4.493546626621645e-01   +9.458041975621073e-01   +1.206460148055038e-01   +2.579018490093675e-01   +1.552521297943499e-01   +5.004719254409744e-01; +2.836277992213481e-01   +7.047172358495433e-01   +6.769600658389416e-01   -4.031655977300889e-02   +1.108227412613634e-01   +7.169437553076342e-01   +1.041134687030825e-01   +4.187199066347114e-01   +5.055875317550323e-01   +1.849443150439034e-01   +7.020114622240552e-01   +3.927598360640167e-01; +2.704685438271681e-01   +6.624053661871774e-03   +2.594991472914897e-01   +6.284055630026698e-01   +6.932962534681152e-01   +7.662098537042065e-01   +2.473635756858096e-01   +6.586931374617907e-01   +7.465734140745783e-01   +4.210989308774822e-01   +3.589824230326929e-01   +1.000000000000000e+00; +1.526312285630502e-01   +8.231288501648044e-01   +2.683588891055744e-01   +6.485730813348649e-01   +7.691606025937059e-01   +5.474611958652253e-02   +1.005148304443472e-01   +5.188497561703835e-01   +2.914362635726183e-01   +3.249894441129035e-01   +1.627459110622375e-01   +8.153996737166044e-01; +7.821346612587086e-01   +5.593603718272757e-01   +5.240785934023960e-01   +3.816584958588759e-01   +2.537936846935155e-01   +4.052536929710470e-01   +9.543296270601823e-01   +5.269101917065459e-02   +1.686356440082946e-01   +6.102458795951057e-01   +5.336003747241098e-01   +2.512183319047805e-01; +5.182868778444515e-02   +3.999750108966426e-01   +7.964375524855306e-01   +9.059563827673950e-01   -7.577376826590631e-04   +5.423797662768574e-01   +4.972413406075387e-01   +3.897874209341460e-01   +5.852412925147505e-01   +4.870258502197106e-01   +2.747569314760249e-01   +8.153094888633342e-01];
L2E_L3E_iAMPA_netcon = [+3.564516905831857e-01   +1.177628018486627e-01   +1.512141562141595e-01   +3.785300053596108e-01   +2.034846126455581e-01   +1.036860355678945e-01   +3.141279774343408e-01   -6.958408959133630e-02; +5.517620218577138e-01   +8.631542352603154e-01   +4.574735497582259e-01   +2.153860156790194e-01   +8.192503890788055e-01   +7.170706126224956e-01   +1.553787805774712e-01   +1.312014325888683e-03; +2.702609632207436e-01   +3.608163130379485e-01   +7.893149206567946e-01   +8.952390708719485e-01   +3.221719930240980e-01   +2.650841423260343e-01   -4.814886562849324e-02   +5.117779459729674e-01; +2.023640969486731e-02   +7.106253775545129e-01   +7.050391716951763e-01   +5.508168562027055e-01   +7.083047641324792e-01   +4.388905057421473e-01   +1.936557339380524e-02   -1.023525742600961e-01; +9.846948256723162e-02   +5.379483149950908e-01   +6.411534740135542e-01   +8.718003987530114e-01   +6.398760732370601e-01   +2.046572439068248e-01   +9.552317726270036e-02   +5.808175298217519e-01; +7.007565499523706e-01   +6.326171472350843e-01   +8.689293634766106e-01   +5.618924761368618e-01   +1.315605613855030e-01   +5.930488148741494e-01   +9.075848716840850e-01   +4.981822929814600e-01; +4.992275054580181e-02   +5.532082921082814e-01   +8.731825814964036e-01   +7.996272262024550e-01   +4.943337032897352e-01   +6.158683237279968e-01   +2.875605164449743e-01   +4.688590601629776e-01; +6.980592701341924e-01   +4.871207058229151e-01   +4.172313005203587e-01   +2.891435596237516e-01   +7.069647414293924e-01   +6.739991117160185e-01   +6.237881877118432e-01   +6.841856325663017e-01; +7.584399621382574e-01   +3.507386933844264e-01   +7.786493556407493e-01   +3.665271072325121e-01   +3.642241360709622e-01   +3.445430448673611e-01   +6.364625661269656e-01   +5.185901221071063e-01; +2.349064105173896e-01   +3.849845190870295e-01   +1.910005629561434e-01   +8.741602360272024e-01   +1.184458587578587e-01   +3.634740105516188e-01   +8.824854542873427e-01   +3.428588942049758e-01; +5.353516394758795e-01   +1.586286796681402e-01   +1.949308873002099e-01   +7.218778178073270e-01   +8.586804678454603e-01   +9.276526652870184e-01   +2.644979908795752e-01   +8.786495852679886e-01; +4.413443058149883e-02   +6.122940439753086e-01   +9.733099302792213e-01   +4.518024505314689e-01   +7.385368325421994e-02   +2.360411505421613e-01   +1.201217217816803e-01   +7.230849642908339e-01];
L2I_L3I_iGABA_netcon = [+4.480479622484109e-01   +2.177748402718403e-01   +8.241807483067587e-01   +1.000000000000000e+00   +1.484786902707994e-02   +1.069132690066306e-01   +1.577860252411133e-01   +1.072911261944770e-01; +3.076547240929510e-02   +5.005449295729885e-01   +1.040541493078945e-01   +1.271884359469582e-02   +2.515681313316090e-01   +7.616684882930633e-02   +7.453942776668357e-01   +4.027898314121987e-01; +4.441392636462247e-01   +3.859267979719691e-01   +3.754088093363070e-01   +1.957611575014673e-01   +7.192609763608497e-01   +9.313958199459721e-01   +5.114893871445076e-01   +3.557334957615213e-01; +4.113434119713709e-01   +3.653135181537549e-01   +6.095626681187714e-01   -3.585111802071647e-02   +7.308294671458412e-01   +3.974389037284994e-01   +2.966153979844513e-01   +4.030950664926186e-01; +7.802467850284815e-01   +8.595935234602080e-01   +6.740658667426723e-01   +1.664526000459627e-01   +3.811856476041962e-01   +9.731846076001842e-01   +4.512703473410914e-01   -4.213380713544340e-02; +4.279869928526491e-01   +5.723548007879237e-01   +7.460520986402267e-01   -2.069507772823348e-02   +1.083819078291751e-01   +5.911106898456571e-01   +5.081566681165552e-01   +1.222800525691155e-01; +7.865012831109337e-01   +5.860598744440987e-01   +2.060189466740820e-01   +8.375230154037586e-01   +3.031968326524654e-01   +7.396216073968568e-01   +7.909836660573483e-01   +2.328183897624336e-01; +8.632123858802018e-02   +5.716760231834521e-01   +1.601731568125748e-01   +4.192771049834575e-01   +5.180753777324583e-01   -5.770459324606965e-03   +1.675275167685563e-01   +3.740097773652858e-01; +6.625905942373464e-02   +4.231857441918135e-01   +4.476861702249875e-01   +1.863114054026977e-01   +4.324131065961846e-02   +7.361396981893559e-01   +8.771262535413143e-01   +4.917417885095258e-01; +4.849685103366109e-01   -8.460109494148743e-02   +1.596067089517182e-01   +6.684230925819311e-01   +3.280512764467247e-01   +6.991912000926279e-01   +4.484359056842803e-01   +4.530621718891900e-01; +3.806906108591897e-01   +2.319750979447339e-01   +4.009447708720701e-01   -8.241058732383159e-02   +7.359717729466811e-01   +1.618897473681097e-01   +3.704871289765202e-01   +8.985781526337132e-01; +1.654171632402795e-01   +8.017308066150545e-01   -3.723942677507715e-02   +5.724816062755846e-01   +9.964987290041958e-01   +3.273088178732094e-01   +3.296991964087094e-01   +3.098441437923413e-01];
L3I_L3E_iAMPA_netcon = [+8.606149361451562e-01   +9.253765398666220e-01   -1.051406138283153e-01   +8.020188739502288e-01   +9.405627454455835e-02   +4.720960185757116e-01   +4.295497633042875e-01   +1.437965505412476e-01   +4.589878436056450e-01   +6.520259745353904e-01   +3.877975677283724e-01   +3.692697116048155e-01; +6.878917663643901e-01   +5.521722810071530e-01   +6.552589163975889e-01   +4.380747922651818e-01   +7.108010306682858e-01   +3.410047820561897e-01   +2.415047807959516e-01   +4.428126080655937e-01   +1.000000000000000e+00   +4.351368991026557e-02   +1.548227699713209e-01   +2.273461228220852e-01; +3.803472834096020e-01   +9.561020538612574e-01   +9.987366917468899e-01   +2.289082746381391e-01   +5.272081287712530e-01   +8.784207065507383e-01   +7.542496237806724e-01   +3.105373166523362e-02   +2.670341562582462e-01   +5.438492512219301e-01   +2.302151691879229e-01   +8.158162812342056e-01; +8.185668489417105e-01   +7.110834430008941e-01   +3.835998811430995e-01   +5.343206365149465e-01   +9.307584818790491e-01   +7.162387596038546e-01   -2.906694854249415e-02   +4.147705175078372e-01   +2.702411647625612e-02   +2.671987898681635e-01   +4.891114119320023e-01   +7.536836600052326e-01; +6.056971801307276e-01   +3.714446761297393e-01   +8.679776675426034e-01   -4.318674113507198e-02   +8.225172173351314e-01   +4.456668930124336e-01   +1.213938362857488e-01   +5.653215878712829e-01   +7.715981722075509e-01   +7.006402492899405e-01   +8.703205002056917e-01   -1.210014847038372e-01; +2.477468771533358e-01   +7.383569183619566e-01   +5.575903011176874e-01   +1.046107295223372e-01   +1.227395563572542e-01   +2.354054771720852e-01   +2.507439788987067e-01   +6.226288048476442e-02   +6.746334693223435e-01   +2.272987424540911e-01   +3.206246563089381e-01   +8.409678569268621e-02; +9.911701869012346e-02   +1.799268901452856e-01   +1.112056872930560e-01   +4.210269120474285e-02   +5.222681165306554e-01   -6.555036755346155e-04   +4.046025267297980e-01   +5.298371867013194e-01   -7.394946864069734e-03   +3.560796560719600e-02   +7.215920548627361e-01   +2.398867011931370e-01; +8.804734953784795e-01   +7.329043809398776e-01   +3.590962030332750e-01   +7.357004317201379e-01   +5.873718459879198e-02   +2.106347836530682e-01   +1.311485593003994e-01   +7.297093452821813e-01   +2.289426470547978e-01   -1.975336279970056e-02   +2.663716472086456e-01   +6.161862206979429e-01; +1.683009276223532e-01   +7.845583728162399e-01   +3.132489814196006e-01   +7.834724355825484e-01   +6.682572528367504e-01   +3.721914860655883e-01   +2.290082416630154e-02   +6.628791088611449e-01   +5.069116194804660e-01   +8.369452921179026e-01   +3.916735167841127e-01   +8.508776361126358e-01; +8.789201939555396e-01   +1.029503937209847e-01   +6.873812760442827e-01   +2.382981494989591e-03   +8.140326843839375e-01   +2.555652926309097e-01   +5.979259442344023e-01   +3.916220924329956e-01   +5.586021021822786e-01   +5.527559348611877e-01   +8.589292814423147e-01   +3.711486125216817e-01; +1.506542489192491e-01   +5.431886083675533e-01   +4.082102914487482e-01   +3.030096074743411e-01   +9.487721362746684e-01   +3.394589960990260e-01   +5.907384158207549e-01   +7.438998696029081e-01   +7.576880761411086e-01   +3.474826068711642e-01   +8.361865866269679e-01   +8.437030600161545e-01; +6.522468603773232e-01   +7.361888259870837e-01   +1.320737315082655e-01   +6.235731753259830e-01   +2.970697828983516e-01   +2.816546584303240e-01   +3.502579791279272e-01   +3.772822086024292e-01   +8.797493105947204e-01   -5.619692962171013e-02   +6.696728681335679e-01   +5.905121482651369e-01];
L3E_L3I_iGABA_netcon = [+4.164856285182333e-02   +9.673945595873065e-01   +8.628468414045466e-01   +2.441380257636424e-01   +1.881552319761930e-01   +1.677365214586870e-01   +1.780358241738985e-01   +5.763353091732757e-01   +4.495445365171265e-02   +6.449524083859147e-01   +1.920480928314126e-01   +3.368922253659539e-01; +7.850114056386200e-01   +7.487426470373089e-01   +7.307804482498670e-02   +3.027827484687550e-01   +7.426420609652330e-01   +5.210162501076437e-01   +5.837629780959686e-01   +7.904454542678016e-01   +3.910833137856588e-01   +1.433106513142769e-01   +2.506576268309222e-01   +3.940276505983652e-01; +4.864690308466468e-01   +1.294946755333493e-01   +1.718395474236020e-02   +5.344997824862864e-01   +7.735994105709073e-01   +4.762852098920290e-01   +4.559463017225069e-01   +3.612407069670395e-01   +3.135972078838487e-01   +4.125934329226628e-01   +3.145945569445147e-02   +5.299578219866183e-02; +3.346012004839060e-01   +7.336620190802711e-01   +2.271870453532308e-01   +8.185609207300114e-01   +7.906746518494220e-01   +2.390166606927144e-01   +1.506477675495298e-02   +4.160777618909241e-01   +4.472629073393076e-01   +2.143814288728982e-01   +5.958725069605240e-01   +8.790138524898111e-01; +8.740798534383826e-01   +6.998850558242231e-01   +6.697678031278081e-01   +8.851120349731523e-01   +4.453910032447869e-01   +7.321056417089757e-01   +1.027451052036634e-01   +8.742668265297190e-01   +6.351068312521212e-01   +7.137220430166102e-01   +7.492219201456011e-01   +3.433767741058374e-02; +2.718708682733320e-01   +3.961656453154515e-01   +6.860723647706220e-02   +3.667112652626516e-01   +4.652008493972825e-01   +8.250874573251149e-01   +2.166026720797044e-01   +5.154030527674160e-01   +7.821356340797119e-01   +6.477377898535193e-01   +5.099964869175725e-01   +6.757738966206857e-01; +3.782112826220193e-01   +5.299711714165862e-02   +6.249527665804222e-01   +7.499641910922614e-01   +8.486633464336512e-01   +3.472595527234049e-01   +7.063372053098752e-01   +8.017306450325644e-01   +5.590724001003212e-01   +7.215081162323911e-01   +9.253406306726623e-01   +2.905268578238882e-02; +5.085098019062708e-01   +1.457007848568191e-01   +8.160846266513692e-01   +7.992210551919098e-01   +9.454838340718451e-01   +1.418478328788043e-01   +2.811498447844676e-01   +7.844616313059863e-02   +2.829314382855480e-01   +6.386061832581204e-01   +7.093732648969344e-01   +3.018424732810158e-02; +4.034861316429126e-01   +7.236622039789482e-01   +7.442295951119648e-01   +2.020194401450512e-01   +5.388433652719045e-01   +5.024486023272192e-01   +2.473155558315578e-01   +5.702557856079415e-01   +6.381325768116369e-01   +6.150962908913747e-01   +9.057385078244238e-01   +6.706154517915046e-01; +3.868897515632561e-01   -8.562368928346224e-02   +8.254865042381010e-01   +5.033001249362101e-01   +2.324165044987899e-01   +6.012687020302374e-01   +5.998278460201313e-01   +6.347733116856317e-01   +4.837378815477499e-01   +2.328716775914912e-01   +2.867510777615607e-01   +8.434429816505710e-01; +7.255726920329701e-01   +3.031298983650097e-01   +2.142779940548500e-01   +2.446481227174266e-01   +2.787648192654852e-01   +4.409118094160211e-01   +9.297419821026771e-02   +8.270903767529916e-01   +1.435366941449236e-01   +6.021846352399554e-01   -3.346283301936904e-02   +3.208031569762129e-01; +4.537080817810233e-01   +4.118877870736760e-01   +3.082506158119240e-01   +1.000000000000000e+00   +8.341471290969472e-01   +7.028260696394756e-01   +6.787423121528332e-01   +2.591592441790746e-01   +2.121607064723392e-01   +2.471540588304658e-01   +3.503892983820703e-01   +2.343874291841621e-01];
L2E_Input1_iAMPA_netcon = [+9.320935334258222e-01   +9.673513773083465e-01   +8.533770641712238e-01   +9.596799757826162e-01   +8.360100704448086e-01   +1.000000000000000e+00   +9.637718767414168e-01   +8.900487035763793e-01];
L2I_Input2_iAMPA_netcon = [+8.457537878785136e-01   +8.630289479171511e-01   +8.959782473145305e-01   +8.023363443755351e-01   +7.750537191423456e-01   +9.288686438863276e-01   +9.215372209266509e-01   +1.000000000000000e+00];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last =  11.21 * ones(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.2*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.2*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.2*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.2*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.2*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.2*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.2*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.2*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
