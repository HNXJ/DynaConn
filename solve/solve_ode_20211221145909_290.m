function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-1.000000000000000e+00   +5.597828298098780e-01   -5.810723565538214e-01   -5.765619078256575e-01   -3.818343903386510e-01   -6.589333076571341e-01   -1.216196732360167e-01   +2.451780360838126e-01   +2.171361164085057e-01   -3.381225889561374e-01   +1.159079767060680e-01   +4.748958060602550e-01   -9.192266366457619e-02   +2.936780076940169e-01   -3.953610311964146e-01   +3.242522997752729e-01; -7.682428387877061e-01   -4.405922940143481e-01   +1.422176670135405e-01   +2.260348370813698e-01   +1.734737497862237e-01   -2.655822983080944e-01   -5.637701732148019e-01   -4.692120997608095e-01   -1.535054872582843e-01   +5.478615851872995e-01   +5.079962685846034e-02   +2.230749378899712e-01   -5.848193560307867e-01   -1.340211467964359e-01   -4.147175832417999e-01   -4.049159095835582e-01; +2.990686016274579e-01   +1.405898499313152e-01   +1.877103395300565e-01   -3.593306148344378e-01   -8.234395263250343e-01   -5.059735480610306e-01   -4.059348345492405e-02   +4.915553173821586e-01   +7.602687002386828e-04   +1.977859849273059e-01   -7.188679705297827e-01   +4.122955785309483e-01   +8.894145077991640e-02   -5.988586692130236e-01   -5.164498077037589e-01   -8.811307681062692e-01; +4.932309595524735e-01   -3.882819930522021e-01   -1.235977379637250e-01   -4.223318586336299e-01   +6.027418480526329e-01   -1.962660432331435e-02   -1.743156820506706e-01   -6.036994965546690e-01   +7.428083685577598e-01   -7.163566983139193e-02   -2.508059192280350e-01   -2.024656339509115e-01   -5.091981713114089e-01   -2.993232395202106e-01   -4.976967984706285e-02   -7.526757729116517e-03; +5.115932705504893e-01   -5.806410689426492e-01   -2.131404426823675e-01   +3.923209482296764e-01   -6.148828483972881e-01   -2.838586643505167e-02   +1.322917681416454e-01   +9.636799997491605e-02   +1.918653653827090e-01   -6.347126189734634e-01   -7.661500806031195e-01   +3.781689125467791e-01   +1.513074953353731e-01   -3.903016380825656e-01   +3.473670007439300e-01   +1.648783856428472e-01; -7.585778683757889e-01   +2.807899554130283e-01   -8.971056373467097e-01   +1.813214735764766e-01   +6.735378430059183e-01   -2.876428319585408e-01   -5.544494853611502e-01   +4.252304932088575e-01   -6.386718907069240e-01   -2.453064285317250e-01   +6.048613914825068e-02   +7.477307973802208e-02   -5.708780090430197e-01   +1.945054736102702e-01   -3.437085476534921e-02   +1.403673742352650e-01; -2.098487362550801e-01   -2.711119855265035e-01   -1.859635154778096e-01   -2.328864326737345e-02   -3.252923138522810e-01   +2.376071842748163e-01   +1.218241303042641e-02   +4.827736101722439e-01   -5.614501069639173e-01   +2.336479715896622e-01   +2.949341447939356e-01   +3.664112882251966e-01   -2.221276208914266e-01   -1.830069072202142e-01   -2.507433669332817e-01   +7.946234420901090e-01; +1.678181896902232e-01   +2.119506349331391e-02   -6.299509132802880e-02   +7.479859767337614e-01   -6.939492453081446e-01   +2.433926018260446e-01   +3.515316656877130e-01   -2.994727638738386e-01   -7.064248481785913e-01   +4.848073095809196e-01   -2.648834087947905e-01   -1.419704119666494e-01   +4.911017819838048e-01   -5.824828672128924e-01   -1.636618670094226e-01   +4.113602578727305e-01; +7.259911717239874e-01   -5.583300025735384e-01   -1.575147093895204e-01   +7.327238651666289e-01   -1.816804797316902e-01   -7.187034200481383e-01   +6.444956329663066e-01   -4.990589434144591e-01   +1.817941448707498e-01   +4.070772874424632e-01   +4.602569930030043e-01   +6.241597339658558e-01   -4.105657224224795e-01   -4.263568640648049e-02   -2.252513109581041e-01   +8.049420259671942e-01; -3.146077209918408e-01   +3.377238725663422e-01   +2.829584571672943e-01   +3.947419936744973e-01   +4.997187775147869e-01   +4.761631602731247e-01   -6.352895723995166e-01   -7.430249891221391e-02   +3.080220475798407e-01   -1.991652694552548e-01   +4.913317680247350e-01   +5.032292849749306e-01   +5.289301456223080e-01   +4.887600717347023e-01   -1.093770236434588e-01   -3.921065977699415e-01; -8.246257032594591e-01   -3.460684477436042e-01   +5.461233901314229e-01   -4.389457070290680e-01   -1.556734717213169e-01   -4.142443388822384e-01   -1.717565959456820e-01   -1.722757179852836e-02   -4.659151893070477e-01   +8.955080448056271e-02   +1.085033579791645e-01   -5.413075665641426e-01   -2.520506481280403e-01   +7.844989625701859e-02   -4.884459960639635e-02   +7.306534281114511e-02; -2.118315057417966e-02   -3.707640291436257e-01   +5.575887980780809e-01   +2.844016919197614e-01   +5.219552258454174e-02   +1.167530761224918e-01   +1.306989692853382e-01   -1.547313479996703e-01   -2.775750119877397e-01   +9.434280197849108e-01   -6.551572893519941e-02   -7.753932414637335e-01   +4.745157312699938e-01   +3.906363772541548e-01   -6.346351752363236e-01   -7.619764665581411e-01; -1.494418043850960e-01   -2.954843173215985e-01   -2.322142021373745e-01   +2.534096826507980e-01   -2.140496102044783e-01   -1.132663959823499e-01   +6.605797271302147e-01   +4.703696337563271e-01   +9.694548373020034e-02   +4.959201397201793e-01   +2.141003627589333e-02   +4.611351128505718e-01   +6.493585670592205e-01   +2.696728088028799e-01   -6.383856264790722e-01   +5.260336122970044e-01; -2.665178748485598e-01   +1.410472473402618e-01   -5.213937665071814e-01   -4.180991271406753e-01   +1.769320154583698e-01   -9.645756401290063e-01   +3.461890698404635e-01   -4.976837075402257e-01   -6.024388338837006e-01   -3.079859372699963e-01   +1.981373131167442e-01   -7.241055797388291e-01   -1.421958696497125e-01   +7.328433932230278e-01   -4.313339682104676e-01   -3.155836592529372e-01; +1.000615893539780e-01   -5.380858974222288e-01   +3.278230154279492e-01   -3.080125892254791e-01   -1.202566829561027e-02   +6.123526015015879e-02   +2.469738682089329e-01   +5.715005676295573e-01   +2.572557531766858e-01   -8.852823601496856e-02   +4.205791118101478e-01   -1.477405156619879e-01   -2.335997989672670e-01   -3.993282502240750e-01   -6.959695407594219e-01   -5.607046777769673e-01; -8.022378867343533e-02   -3.846707967883203e-01   -4.354075760857808e-01   +5.744277905874771e-01   -1.949586380019340e-01   +5.296427332503040e-01   +7.213778947131462e-02   -4.229122902811676e-01   -5.670917343376890e-01   -4.369907884616248e-03   -3.860333716437758e-01   +1.906650201859207e-02   +8.052650907025871e-01   +4.236207050980438e-01   +3.028145988040651e-03   -2.233013882000850e-01];
L1E_L1I_iGABA_netcon = [+3.477004527688843e-01   -3.120368063426802e-01   +3.262100336642449e-01   +3.354833877098277e-01   -7.072538060644251e-01   -4.260680481578850e-02   +4.906764442179535e-01   -3.786687617999371e-01   -3.359951537045826e-01   -1.894414002741860e-01   +2.652341695796234e-03   +3.296152312487187e-01   -1.722193211376664e-01   +6.421127267280827e-01   -1.688686111652329e-01   +6.999930652406844e-02; +4.440550228941559e-01   +3.353049331368620e-01   +5.552132826809837e-02   +4.980108402344690e-01   -5.489125578750395e-01   +2.142191788933741e-01   +4.569522051472920e-01   -4.773846405803422e-01   +3.967410093960492e-01   -4.029465276786820e-01   -4.392321003088323e-03   -2.853760479320726e-01   +1.059098510240539e-01   +4.754457302603927e-02   +3.049255367818139e-01   +8.691129991597213e-02; -6.835157972670554e-01   +3.161471304144847e-01   -5.032358602590130e-01   -6.423511401805396e-01   +4.867990877880856e-01   -3.764706966780246e-01   +2.373144777741781e-01   -7.322193025976010e-01   -1.316409017996789e-01   -6.747734175341960e-01   +5.382268961668195e-01   -7.710437788643779e-02   -1.625785486477037e-01   -4.179292494133489e-01   +6.014012684265877e-02   +1.011163630633906e-02; +6.257185490636274e-01   +3.173773993811863e-01   -2.042473462889430e-01   -2.074487610966192e-01   -1.000000000000000e+00   +4.712491789960492e-01   +2.351890571849380e-01   -1.085068229155679e-01   +1.436180785278308e-01   +5.719847331634428e-01   +3.303013592781325e-01   -4.204788030243417e-01   -3.574507018579573e-03   -8.025521401268113e-01   +3.221195766523395e-01   -1.139822923261760e-01; -2.889368130147976e-01   +1.852876452397200e-02   +7.599018896279093e-01   -4.889087844072174e-02   +4.065107624775616e-01   +3.157119618998671e-01   -3.087625000064050e-01   +2.401219886392579e-01   -2.514097922210251e-01   -2.809226801732037e-01   +6.280752527764009e-01   -1.433009243624918e-01   +7.616386969356466e-01   -4.384249246051646e-01   -5.575252010133376e-02   -5.348405144406182e-01; +4.366675769030771e-03   -1.381165270248591e-01   +7.361348820631695e-01   -4.860903645352240e-01   -3.888097799359814e-01   +6.896571583635523e-02   +4.440742005696697e-01   +8.550313105220746e-02   -5.487615981458399e-01   -5.741376182157616e-01   -2.671894065959226e-01   +4.082835885323883e-01   -1.423621625079748e-02   +6.041858271237076e-01   +4.326001196325389e-01   -2.332162953034258e-01; +4.977904906464452e-02   +1.021076186704418e-01   -1.663454524832789e-01   +2.761883445498349e-01   +2.953568583552679e-01   -8.427092213188941e-01   -5.252551820828694e-01   +4.652247960649441e-01   -4.793235327112417e-01   +2.330285134654076e-01   +4.024488321049882e-01   -4.734304054241735e-01   +7.809172083560245e-01   -2.697655225724874e-01   -4.612335630614523e-01   +3.552307091587806e-01; -4.275751814766545e-01   -1.086426073210464e-01   +8.072833501667664e-02   -4.941463045832539e-02   -2.927735168661103e-01   -2.207643758276241e-01   -1.292358170892402e-01   -6.815081795683541e-01   +7.019720146959496e-01   -3.659917631680116e-01   -4.843347727231427e-01   +8.907010268713780e-02   +2.472754202445796e-01   +2.321536147193711e-01   +2.514805007653705e-01   -6.666640967817950e-03; -3.067115572697471e-01   +1.008072904920786e-01   +5.026281089557486e-02   +9.652633744557303e-02   +1.954581452089106e-01   +3.350362399042044e-01   -2.604700174624714e-01   -4.281956448922864e-01   -5.778796984118559e-01   -1.692830983923477e-01   +4.470542449108709e-01   -5.634776226061815e-02   +9.241745855929559e-02   -6.768175157927739e-01   +5.254745640984259e-01   +7.228822750139203e-01; +3.093998512612317e-01   -2.504730069097423e-01   +1.495497150161205e-01   -6.079510055523737e-01   +7.536643277713315e-01   -5.335484874681058e-02   +3.313617371708341e-01   +1.473156738791051e-01   +2.100049867185347e-01   -2.731707433685763e-01   -2.827177312321620e-01   +1.198952479979680e-01   -6.624462619964384e-01   -4.672422014403509e-01   -3.561139522326190e-01   +3.688336438695667e-01; +4.560814018956315e-01   +3.557119801424743e-01   -8.671237516033890e-02   -5.601648702116112e-01   -5.589083690394446e-01   -7.067534922449979e-01   -2.994129172044561e-01   -1.998737638295182e-01   +5.674979730952765e-01   -4.257636062088807e-02   -3.279780155896261e-01   -1.306164098296176e-01   +1.820474120762016e-01   -4.241158998708905e-01   +4.611918227474934e-01   +1.873986390032316e-02; +3.966755841847073e-02   -6.786434527531912e-01   -4.431837574478569e-01   +2.501873508370376e-02   -6.386433548212359e-02   -6.512366587472933e-01   -5.632726784177789e-01   -3.170844257205210e-01   +1.817191959103657e-01   -3.605148365331530e-01   +2.047334867671715e-01   +3.608550038579221e-01   +7.575179877507857e-02   -3.888724354495559e-01   -1.927951145757723e-01   +1.815089365663324e-01; -4.393972424881554e-01   -3.267431623975117e-01   +4.033104852697038e-01   +1.751576895907219e-01   -1.508935581980263e-01   +4.789837613228887e-01   +2.134057194444048e-01   +4.583473008005609e-01   -5.268321308718426e-01   -1.560363186761772e-01   +1.406728942936483e-01   +3.709269923716929e-01   +4.654263633540675e-01   +2.342605724094630e-01   +6.092289913855095e-01   -5.527242759295906e-01; -2.791760246419309e-01   +2.038907993578068e-01   -3.753127152285762e-01   -5.239702274246377e-01   +6.155816350968472e-01   -2.243317891167985e-01   +6.779176389096986e-02   +4.879687485098516e-01   +9.900103941904238e-02   +6.728799062471563e-02   +1.744782200007227e-01   +1.955174662723114e-02   -5.593592448384013e-01   -3.227531013933200e-01   +6.541558516142423e-02   +3.302651665011365e-01; +7.104310876219340e-01   +6.018981239270593e-01   -2.890490050131519e-01   +4.627192535236497e-01   -1.093092776825386e-01   -1.788595644364764e-01   +7.242296431973867e-02   -5.459069360715777e-01   +4.537557298149469e-01   -2.972917393403156e-01   -7.037734376152178e-01   +6.292509390479665e-01   +2.519622208365287e-01   -2.856753452109016e-02   +4.136646996959321e-01   +1.211154864819174e-01; -3.755648799102637e-01   -2.166490696574949e-01   +5.741075812380441e-01   -7.354276563693639e-01   +1.409049525490481e-01   -4.690872436205244e-01   -5.936160247408401e-02   +4.601633634103094e-01   +2.328427938820812e-01   -7.224966801037749e-01   +6.191991497754292e-01   -2.290773811242435e-01   +9.510501344402851e-01   -6.744959318407001e-01   +5.579901849916143e-01   +5.094834264550798e-01];
L2I_L1I_iGABA_netcon = [+9.943949281418873e-02   -1.242791186423938e-01   +3.136774754839668e-01   -6.092079457867087e-01   +1.000000000000000e+00   -3.223132468613164e-01   +3.013789341937334e-01   +6.204403995639167e-01; -5.926266306018597e-01   -3.387303281377916e-01   +3.461930351142821e-01   -1.125632735872545e-02   +2.585554822020640e-01   -2.568896981760872e-01   -6.520677165040110e-01   +2.524719562778853e-01; +3.588166858235475e-01   +7.035900784743767e-01   -7.806556573324055e-01   -3.305307440987561e-01   -4.467174639021403e-01   -4.694013244568804e-01   +8.691614373848680e-02   -2.794551693359787e-01; -4.754032025511862e-01   -1.603495464896492e-02   +4.714254057545956e-01   +5.231227651106500e-01   -1.711847344052411e-01   +5.143363441489252e-01   +1.914322481818889e-01   -2.167121204388095e-01; -6.723993794044238e-01   +4.567125276041570e-01   +8.648498003889067e-01   +7.203491600939927e-01   +1.086310761547752e-01   +1.561504154082127e-01   -3.053568499998395e-01   +2.798356220134006e-01; -3.418737529094547e-01   +1.997231516161656e-01   -2.965077249002808e-01   -5.621831964942091e-04   +3.333418597771404e-01   +6.369081266401522e-01   +4.065076986663073e-01   +2.106776495579829e-01; +1.559862223097552e-02   -6.641800550737673e-01   -4.741106901326260e-01   -3.964080674686949e-01   -4.451521762865752e-01   +5.502531702984006e-01   -5.901476036258045e-01   +1.771086192135849e-01; +3.872237574812969e-02   -9.308072691841737e-01   +1.682348543777985e-02   +2.143694008921915e-01   +2.388577666613229e-01   -4.841543780646531e-01   +6.946303022875382e-02   -2.868053162642037e-01; +7.705958894559696e-02   +4.460095238581799e-02   +2.931483192211374e-01   +1.761233934254921e-01   -3.365003567772806e-01   -3.739094213910984e-01   -5.840594934163072e-02   -9.331468535753373e-02; -3.006867417024419e-01   +3.951644805277786e-01   +5.442343357578731e-01   -2.602583625642423e-01   +6.663681108607269e-01   +4.824809893951954e-01   -9.892558381706403e-02   +6.067816304031990e-01; -8.929711097500131e-02   +6.299482022165733e-03   -4.608604428125934e-01   -1.255638534308293e-01   +4.624677321320323e-01   +3.843913481471382e-01   -2.549550617209549e-01   -2.373364138405933e-01; -5.412580302328832e-01   +8.645161593638917e-02   +4.941718626085560e-02   -3.206536258812487e-01   +5.261140634964429e-02   +4.587017732606206e-02   +4.228822901098559e-01   -5.421764837696651e-02; +2.095651127670941e-02   +3.463469689049073e-01   +4.329409704903593e-01   -3.275991904950795e-01   +8.507610766755255e-02   -2.705025329430217e-01   +6.449297431189460e-01   +2.028994562236056e-01; +3.967209018803441e-01   -4.052572515509993e-01   +3.626549261713297e-01   +2.693754301884998e-01   -1.644061816619652e-01   +7.461522392919079e-01   -4.388216188720385e-01   +2.581022019214044e-02; +5.313342656199279e-01   +1.864712152722655e-01   -1.588435809898484e-01   -7.783808014034879e-01   +6.734658415155336e-01   -5.753902910802133e-02   +1.811109318364162e-01   -6.845664360805320e-01; -5.096473772241678e-01   +8.124937623555396e-01   -2.639863566220130e-01   +7.125947088669762e-01   -1.700376268463915e-01   +3.907310093586512e-01   -4.698002949752407e-01   +1.806208574985659e-01];
L1I_L2I_iGABA_netcon = [-8.096122988355937e-01   +1.343997051973571e-01   -5.387321023791192e-01   +1.246707453891355e-01   -1.495478581560735e-01   +1.014705936276062e-01   -5.700261315784428e-02   +3.137242300614302e-01   -6.119353897465757e-02   -1.751747165270593e-01   +3.821239900604596e-01   +3.800586033265356e-01   -3.545902507533785e-01   +1.025888036148526e-01   +4.295466350317724e-01   +8.621638466569850e-02; +4.648625014755183e-01   -1.000000000000000e+00   -4.120808041919238e-01   +5.300830223068690e-01   +7.687966284990535e-01   +1.354301147965206e-01   +5.464023576846878e-01   -2.907515914951699e-01   +2.319014215481121e-01   +3.702241478938672e-01   -2.958800605610479e-01   +5.025942999924734e-01   -5.599767078087485e-01   +1.616610002349522e-01   -6.426471846613936e-01   +3.608040185722345e-01; -3.353349991180951e-01   +2.145570651103799e-01   -3.452712260942032e-01   -5.568818397695706e-01   -1.011980412148752e-01   -2.557710505452974e-01   +4.343636358475429e-01   +1.303850836839359e-01   +2.145883416569334e-01   -1.509761824964416e-01   -5.320659030265273e-02   -9.135103631368000e-01   +2.004391109930935e-01   -5.278115089661732e-01   -7.745247783269076e-02   +2.026279686590515e-01; +1.965742911474556e-01   +9.079897041888468e-03   +4.426423328006649e-02   -2.123944955629258e-02   -6.954444507732339e-01   -6.183436736258687e-01   -4.611655073641257e-01   -3.033310980154876e-01   -6.632250140074719e-01   +6.994025237184391e-01   -1.279846969998334e-01   -5.095228815260986e-01   -6.518462804637597e-01   -4.404021217793752e-01   -7.101826411710828e-01   -4.692419246932546e-01; +5.049892888569939e-01   +5.944411014495132e-01   -2.058958623329845e-01   +9.805040373556199e-01   +6.626271917572075e-01   -5.615636940278513e-01   -3.322057818364775e-01   +7.462418022184489e-02   -6.632277149090301e-03   -3.616876865774825e-01   +4.070321035729049e-01   -4.481038029392055e-01   -1.066616743891950e-01   +1.053915837292237e-02   +1.145367780000280e-01   +3.274319243876828e-02; -6.412357048509990e-01   -5.603315160180743e-01   +7.942058818977830e-01   -4.354309967509173e-02   +3.321374608765105e-01   -8.839810556590307e-02   +5.049615370733880e-01   +6.753977406899808e-01   +6.785476485151656e-01   +2.663623270958314e-01   -4.842990031312529e-02   -3.602623869624271e-01   -3.780362066107829e-01   -3.529735908059289e-01   +8.490559976977731e-03   +2.135300560026173e-01; -2.027651008655071e-01   -1.657793394459499e-01   -2.307864170238450e-02   +5.886914286070988e-02   +1.555887961044648e-01   -7.195394926009328e-01   +1.191828534777348e-01   +8.791891022102409e-01   -9.768345916247390e-01   +1.355779141319864e-01   +2.788240011396951e-01   +1.503887501503786e-01   +6.544037553827123e-01   -4.684373777287524e-01   -4.275842641875446e-01   -4.683330501836601e-01; +3.840938792725357e-02   -2.393287342178449e-01   +2.066181344781013e-01   -4.874875870685274e-01   -2.291491880856687e-01   -3.587762545930363e-02   -3.482659751356518e-01   -1.081783145611582e-01   +6.849618712571137e-01   -1.499901382730191e-01   +3.344895579142190e-02   -5.955834231457442e-01   +2.529495108302323e-01   -2.533763023947561e-01   -1.004036727592076e-01   -1.847538422372432e-01];
L2E_L1E_iAMPA_netcon = [-1.212571400571245e-01   -4.534853189040826e-01   +2.716934775311488e-01   +1.379092226538100e-01   +2.700443790296337e-01   +3.752921758781686e-03   +5.668199269175359e-02   -1.723481629288022e-04; +3.028964991963786e-01   -1.798932108940750e-01   +4.080673650654659e-01   -3.050814182994658e-02   +3.779738084769726e-01   +1.343055259438828e-01   -4.287855948381049e-01   +5.558275965707343e-02; -5.659340485503525e-01   +3.150557808205625e-01   +2.431741748296038e-01   -4.479847590110130e-01   +4.226543842596767e-01   +1.071824541610869e-01   +6.594526203662993e-02   -6.293071511814054e-02; +1.892936194506765e-01   +7.183683808896639e-01   +9.511159777964882e-02   +6.899279951132273e-01   -3.762689584191367e-02   +3.339779610467479e-01   -1.173461489963960e-01   -3.901370988270795e-01; +2.731011569091319e-01   +1.266044061951222e-01   +9.731143740804730e-01   +2.531054894561514e-01   -4.135430052458534e-01   +9.593670599119117e-02   -4.693945347961751e-01   +2.001641191038979e-01; -3.697063432783700e-01   +2.761582647927974e-01   +5.214743657157326e-01   +5.151187368286462e-01   +2.069323252591646e-01   +1.876104247463464e-01   +6.016370493079626e-01   -6.633653784276775e-01; -3.321710041058783e-01   +4.346321113516280e-01   +7.783724890699843e-02   +1.455323877577170e-01   +4.115663974870122e-01   +4.922173152920043e-01   -1.720191034261994e-01   +7.135564092268096e-01; +7.015511943906785e-01   +2.016756349916222e-01   -3.950694405844591e-01   +9.001871669536398e-01   -2.990294718316349e-01   +8.596649686745583e-01   +2.845642305353390e-01   -2.493446803081827e-01; -6.662869392335230e-01   -5.993009947074143e-02   +4.732080501980870e-01   -7.409623482444819e-02   -7.998800976599442e-01   -1.668330071665991e-01   +3.354805585344592e-01   -3.506312387929325e-01; -3.297647374210216e-01   -5.438691183706446e-01   -6.471401341731250e-01   -2.285300728522166e-01   -2.513942714617029e-01   +6.657030017911856e-01   +3.281404874006877e-01   +2.219669257235546e-01; -4.471721412857034e-01   +6.897883541372692e-01   -9.984514286328165e-02   +6.436012024909427e-03   -4.938357346428459e-02   -2.638104937203218e-01   +9.607265890455365e-01   +5.002883178299709e-01; +1.414002781075375e-01   -3.939935777380499e-01   -4.985183707108009e-01   -1.585358981898563e-01   +1.945978315099736e-01   +5.050332011187161e-01   -3.079438799564079e-01   -2.592804635288273e-01; -7.321348660368913e-01   +6.816220582231307e-01   +2.532084698879067e-01   -5.014066914789734e-01   -7.652331326481129e-01   +1.000000000000000e+00   +9.710704617256202e-01   +4.638093245376352e-01; -7.024480954010653e-02   -1.126298632676746e-01   +1.384972091952482e-01   +7.567581564437272e-02   -1.375028933309318e-01   -5.427075596448260e-01   +1.889441122221979e-01   +1.039996977146737e-02; -6.038154453328750e-01   +8.576775122257319e-02   +6.501230936481138e-01   -7.722810533069112e-01   -5.038182450533480e-01   -1.839016114139416e-01   +4.857247757922757e-01   +1.966613493264288e-01; +6.472642037854909e-01   +2.017311518303438e-01   +9.263303922506294e-01   -7.435687160831309e-01   -5.916304214590346e-01   -1.060747941982025e-01   -2.609641850924430e-01   +2.099759325674719e-01];
L1E_L2E_iAMPA_netcon = [+2.856183591155602e-01   +6.927772651324758e-02   +7.620624758913992e-01   -6.186972793530467e-01   -3.306870216805224e-02   +5.089437423633406e-01   +2.401131907365829e-01   -4.143877380319532e-01   -1.052808073545498e-01   -1.537635023260693e-01   -6.348413591702177e-01   +2.916441777620298e-01   +2.609010319218754e-01   -4.033480071474187e-01   +4.972844290275631e-01   -7.571673767346966e-01; -4.824601286372598e-01   +2.881349630485125e-01   +3.598663743437851e-01   -4.156132890215502e-01   -1.680849346656523e-01   +1.998514537636817e-01   +2.552536372976147e-01   +1.828122922578239e-01   +3.399142386242293e-01   +6.978474179416867e-02   -2.863477983704062e-01   +2.776930060007395e-01   -3.802398887597094e-01   +6.766572846943331e-02   +4.900604382808132e-02   -1.890901404570183e-01; +4.445003646750940e-01   -2.890454359861812e-02   +2.610983648351762e-02   -4.721515554116012e-02   +6.092661438883702e-01   -6.815739986493190e-01   +4.629136939374160e-01   -5.497442187174132e-01   +4.996972836462912e-01   -9.781954564430632e-01   -2.229891024188943e-01   +3.831999302751580e-01   -2.086572949393276e-01   +1.473201789175044e-01   -1.758658550680417e-01   +2.362425635996002e-01; -3.429548899437642e-01   -3.575647400088592e-01   +3.806114789641072e-01   +4.097106391703403e-01   -2.416458741337079e-01   +6.125983847020265e-01   -1.638693825157405e-01   +2.656303100747709e-01   -3.030947238493102e-01   -1.491221300017914e-02   +9.728116759702775e-02   +2.949015125759037e-01   +7.676452240563306e-01   +6.006693220187611e-01   +1.000000000000000e+00   +3.494931527732147e-01; -1.354059963799025e-01   -1.037754582986114e-01   -2.711480825084877e-01   +1.665325756432844e-01   +7.176316196677981e-02   +2.263637285793687e-01   -4.496231493764391e-01   +3.368667021175424e-01   -1.072275178891880e-02   +6.347826438174032e-01   +4.417103596898641e-01   -5.922212271328843e-01   -4.987305493018663e-01   +1.516959442465327e-01   -1.317035031691775e-01   -1.480715128971163e-01; -4.700390085238180e-01   +4.305626197559866e-01   +4.979100144624211e-03   -2.858092790177403e-01   -3.759816093181287e-01   +1.343848464872883e-02   +6.317716817814075e-01   -2.817625961075835e-01   -2.777522741813985e-03   -1.672340485882229e-01   -3.945705795956760e-01   -3.603831312889997e-01   -4.965080313435019e-02   +3.167713454684927e-01   +3.539202991966110e-01   +2.117786181944621e-01; -3.791063338665839e-01   -4.045973148153886e-01   -9.807588795326608e-02   -3.325389077542180e-01   +5.014367362087613e-01   -9.544947593137515e-02   -5.438146580675187e-01   -1.060169016631011e-01   +3.174530803361693e-01   +1.055915065020053e-01   -4.377787798839479e-01   -1.895816629238906e-01   +7.599933015793592e-02   -6.375913614065345e-01   -3.822864897085294e-01   -3.915261335434038e-01; -1.168505813739940e-01   +8.535029715833659e-01   +3.117060907108741e-02   -4.760235114076884e-01   +1.823680576634948e-01   +2.410792167425187e-02   +8.675505713769444e-01   -4.779422098486230e-01   -3.339398387942833e-01   -3.683301718201595e-01   +6.727288824086393e-01   +2.047593345591327e-01   -1.161702500428969e-03   -5.390806958154921e-01   +5.458460415469644e-01   +5.461227427199666e-01];
L2I_L2E_iAMPA_netcon = [+8.436856037658333e-02   +7.269839125089372e-02   +2.541936243513668e-01   +3.213820276645498e-01   +5.725904246599187e-01   -4.959900105635227e-01   -6.727903974800753e-01   +3.527259602446958e-01; +6.794069048442547e-02   +3.291404294612505e-01   +4.584248782382897e-01   -1.658668335320553e-01   -2.882306128375075e-01   -8.281159940065391e-01   -3.675184734296227e-02   -6.848612330813763e-01; -5.747412296955151e-01   -2.103869865272257e-01   -7.229944280672830e-01   -9.019939766415811e-01   -4.636713165202687e-02   +1.830920576742681e-01   -1.982552065648277e-01   -5.941188851852296e-01; +4.773104734139660e-03   -4.681168121346035e-01   +3.567276416290264e-01   -9.105229998171771e-01   +2.801333983053848e-01   -3.126425254688672e-01   -6.130984361293098e-01   -4.073187235727648e-01; +1.000000000000000e+00   +3.466898366351229e-01   -5.130630722807739e-01   +6.507982018969151e-01   -5.348202640400904e-02   -4.564592110094372e-02   -2.240347290303803e-01   -5.081340863423144e-01; +5.829934369264804e-01   +3.695920385753470e-02   -2.315877636857003e-01   +3.106561081748231e-01   -3.601628080996051e-01   +7.092946057695569e-01   -3.204824633195864e-01   +4.114264227673577e-01; +2.308855001431393e-01   -8.241754523079786e-02   -8.313544421562324e-01   +5.491233815866551e-01   +1.939353029272662e-01   +2.545264408426418e-01   -4.865430426572726e-01   +5.963376579182903e-02; +9.886212747174039e-02   -7.603539641322928e-01   -6.134662791125112e-01   +2.386496576214169e-01   -2.823954805409321e-01   +7.180833699951561e-01   +3.821025781328356e-02   +2.244211290020657e-01];
L2E_L2I_iGABA_netcon = [-3.931594530079930e-01   +5.356645936279306e-01   +2.090765607431610e-01   -3.279627590013881e-01   +5.904550907549898e-01   +3.747860846686115e-01   +3.222185694865012e-01   -9.445781717118292e-01; +7.186030810763518e-01   -4.949565470539904e-02   +4.890778997589352e-01   +5.411228751692898e-01   -1.038374251347872e-01   +3.294833998853742e-01   -5.750184634892160e-01   -1.834299566939189e-01; +3.902021876135860e-01   +1.195067013615007e-01   -7.725201659134685e-02   -1.000000000000000e+00   +7.331251329134598e-01   +5.587170860337876e-01   -8.481376729072606e-01   +1.855213045024033e-01; +5.365473406728075e-01   -2.316074389424411e-01   +4.269312295962512e-01   -7.503898211877955e-01   +5.311977872678214e-01   -7.852156732077101e-02   +3.232768028491722e-01   -1.331950961637355e-01; +6.774061062234829e-02   -5.684183949405370e-01   +2.508349875490239e-01   +2.275611088497198e-01   -6.626272944717070e-01   +3.381308346495047e-01   -6.094566802666818e-01   -3.005373781351496e-01; +1.320981827322352e-01   +3.032662798351286e-01   +1.980690537099138e-01   +2.939127377040246e-02   -2.664972594874742e-01   +5.439866658994350e-01   +3.307561084589680e-01   -4.042799016566969e-01; -1.423593574045025e-02   -8.288859780218018e-01   +2.701099088272653e-01   +4.455092068191185e-02   -3.547881737004349e-01   +1.976533664992956e-01   +3.729489488117070e-01   +4.003375325277986e-01; +3.961090091721386e-01   +4.193029794374997e-01   -4.765024065256130e-01   -1.349687476009963e-01   +6.190436705770270e-01   -7.685763283778919e-01   -7.588859433228226e-01   -8.763250455580900e-01];
L3E_L2E_iAMPA_netcon = [+7.677211050060350e-01   +2.937020846904639e-01   -2.100348127629832e-01   +6.548173305956946e-01   +5.233398677175231e-01   +5.124070418246955e-01   -1.978806975331590e-01   -1.111760761981971e-01   -5.613841396489694e-01   +5.665973020533015e-01   -3.333960751881378e-01   -1.410037148707359e-01; +2.992872087162975e-01   -4.657105557102487e-01   -4.894570732221695e-01   +5.412797758157415e-01   -9.260206328395524e-01   -1.827303923941227e-01   +4.755063580433516e-02   -9.386198873939355e-01   +4.015361269835975e-01   -9.775156948615228e-01   +3.468457062842186e-01   +1.981391710531098e-01; -2.058699505632337e-01   +3.992798645237124e-01   -6.773036836826204e-01   -7.137891780899777e-01   +3.619645276236819e-01   +8.743484716751489e-02   +3.484608305861679e-01   +3.393431616280935e-01   -7.338338294562282e-01   -6.427836013239646e-01   +8.434005971411913e-01   +1.969083005482762e-01; +5.698433057046123e-01   +1.413470065335002e-01   +1.170781982295856e-01   +4.192090428200856e-01   +3.456786438964951e-01   -4.712393788330174e-01   -3.619613091716825e-01   -2.522176106190819e-01   -3.093352116266621e-01   +1.596019224963889e-01   -7.384488203346965e-01   +9.731864455480085e-01; +4.155322729147142e-01   -2.620214948825589e-01   +3.464625117793120e-01   +6.280545247081799e-01   -1.212333255179711e-02   +6.405070316942492e-01   +7.545542949818580e-01   +1.305210230719470e-01   -2.580827895756100e-01   -5.065535405198207e-02   +2.732381310733500e-01   +5.652490332854188e-02; +1.879734244174108e-01   +5.433241914614918e-01   +2.419281267952651e-02   -2.762924622414516e-01   +1.205086593285789e-01   -5.124089388476236e-01   +7.614430882540211e-01   -1.073165575817152e-02   -7.043470347460721e-01   +4.626393022082149e-01   +1.980203434189037e-01   -2.109592968085596e-01; +1.349643528350040e-01   +4.732748939544107e-01   +3.011204031560146e-01   -6.612602152004156e-01   +2.757821217992577e-02   +3.616208521931573e-01   -5.406585425590549e-01   -6.724183045881642e-02   -1.000000000000000e+00   +8.482235150888681e-01   -4.897569736238701e-01   -5.902352562010645e-01; +1.792006209107278e-01   +5.419489863861565e-02   -5.314586885957125e-02   +1.895842420423224e-01   +4.507529712426764e-01   +4.684433284329265e-01   +5.063080892212615e-01   +2.509069515209385e-01   +5.814988846149294e-01   +4.656358195583953e-01   +8.915313607173746e-02   -3.960495331040573e-01];
L3I_L2I_iGABA_netcon = [-3.184509485133842e-01   -3.802199802088397e-01   -2.279212366139391e-01   -1.868922318518953e-01   -3.932926063995154e-01   +1.931179861758580e-01   -7.700126170133097e-01   -7.496497443808526e-01   -1.372777183339932e-01   -4.058121315385710e-01   +1.797140265653304e-01   +3.559655792702278e-01; -2.651022538819557e-01   +3.742254561396574e-01   -1.457448965361373e-01   +4.229372184310775e-01   -3.563158506471489e-01   -6.307620486279202e-02   +4.787839768862054e-03   -4.250519473444190e-01   +2.175810559900105e-01   -8.906468501217917e-01   -3.882964209970121e-01   +4.922111061512287e-03; -3.982596632147304e-01   -5.559516314463839e-01   +5.782384616357630e-01   -2.508080921346414e-01   -6.103444510320509e-01   -3.792165910384067e-01   +6.298828917929696e-01   -8.195964714458651e-01   -2.658099840934377e-03   -2.728234578039201e-01   -6.419695288084759e-01   -8.280458426697921e-01; +8.016925476401938e-02   +2.786752370396122e-01   -9.162409348757465e-01   +8.616204748711622e-01   -3.311346261166684e-01   +1.409934068171087e-01   +4.162169506999410e-01   +4.164508799280155e-02   +2.977843800277948e-01   +3.969426105929064e-01   +1.387312759543958e-01   -8.155688339610714e-01; +2.539193689066608e-01   +6.353543678601425e-02   -2.544100515038605e-01   -1.883797692038400e-01   -8.218042824968588e-01   +6.516864708597786e-01   -5.602496371998998e-01   +7.159993151380408e-01   +1.485425918927772e-01   -3.966942879368912e-01   -9.357249334985297e-02   +5.643000502708564e-01; +2.037201126570828e-01   +4.449707092137034e-01   +4.228012262085469e-01   +1.000000000000000e+00   -5.299237864385403e-01   -1.903917830634492e-01   -1.532156850834345e-01   -6.197081395418566e-01   -4.096083618652639e-01   -4.798093279960379e-01   +5.967104988822688e-01   -2.785274392585279e-01; +7.931593362880467e-01   +7.714136304458020e-01   +1.541524290925183e-01   +5.425315623133456e-01   -3.121189729951820e-01   +2.396445280122610e-01   -1.518936610338641e-03   +7.858580283537879e-02   +4.467761179400233e-01   +2.151788306661482e-01   +3.478962308307801e-01   +4.109004464709025e-01; -1.044433523482027e-02   +2.196184463809240e-01   -1.971712538931532e-01   +6.439809804298056e-01   -3.846434123711838e-01   -2.384696492553562e-01   +9.724567956815149e-02   -2.144095801994002e-01   -5.623854173447527e-01   -4.573885572878153e-03   -2.688753153349688e-01   -5.559348881228497e-01];
L2E_L3E_iAMPA_netcon = [-4.497541426409013e-01   +4.836180395838406e-01   +9.217174312157508e-02   +5.345908739335887e-01   +6.705222756345542e-01   +3.529737377237104e-02   -5.334557244101921e-01   +1.396749036948276e-01; +2.099908651047479e-02   +5.634444787818164e-01   -1.827363499083381e-04   -3.548477553634212e-01   -5.446946026423137e-01   -3.329538404105311e-02   -7.024327597083366e-02   +5.057449542115353e-01; +4.261918170512540e-01   -1.000000000000000e+00   -5.922019525827813e-01   -1.344508277818165e-01   +1.565212022853107e-01   +5.034168817594081e-01   -2.712595823775892e-02   +2.255854112454790e-01; +1.541367779551473e-01   +1.969507733734337e-01   -4.511236890055592e-01   +3.472641657420377e-01   -3.260189801656548e-01   -3.395564307689906e-01   +8.094366170535976e-01   +6.321019916131837e-02; +6.119601592598802e-01   +1.887269915384381e-01   -5.161978475033434e-01   -2.991459945240314e-01   -5.913086967500939e-01   -8.622790667133408e-03   +5.740526959391299e-01   -6.726059620615734e-01; -2.885757772331943e-01   +2.909440676047421e-02   +2.489769607422739e-01   +6.045870077401048e-01   -6.096110095815397e-01   -1.388901236548341e-01   +4.631110299832490e-01   +1.894743304464734e-02; -3.982372590947441e-01   -3.925099870529273e-01   +3.663310602282212e-01   -4.930102271385157e-01   +5.999278648798815e-01   +1.240087342442184e-01   +3.053375801219533e-01   -3.022103090726876e-01; -3.088448358543259e-01   -2.537485285188419e-01   -4.182346640141927e-02   -2.426486306711907e-01   -2.960277619290091e-02   -5.750029172847151e-01   +2.627205427320633e-01   -2.369594742439408e-01; +6.521948843980514e-01   +5.139577972883206e-01   +5.748918226304853e-01   +3.168376931286027e-01   -1.864429642105529e-01   -6.517008059766178e-01   -4.001073907734519e-01   +4.611955207073258e-01; +4.126571225333925e-02   -4.049911617177843e-01   +8.231764456645772e-02   +5.153886706853364e-01   -4.925370949570421e-01   +4.494195258189898e-01   +5.093345585412039e-02   +8.091992488272512e-02; -2.006718706004316e-01   -1.364615331813707e-01   -7.623960338542540e-02   +4.042153824393583e-01   +2.868650064040177e-01   +9.708337571223441e-02   +2.512243378404483e-01   +1.063431144976806e-01; +8.202392662472684e-02   +3.139739633765857e-01   -2.300790843766444e-01   -9.347968258363352e-02   -1.851187582938836e-01   +5.504040792636080e-01   +2.535304988573510e-01   +3.944421583061455e-01];
L2I_L3I_iGABA_netcon = [-1.693469889366263e-01   -2.443367195951414e-01   -4.663092357249122e-01   -7.063537168346803e-01   -4.820146055664656e-01   +3.900573829022198e-01   -5.988812447041416e-01   +2.154659313180356e-01; +4.826021126867573e-01   -2.374698257086719e-01   -1.108830534322602e-01   +3.948186040791125e-01   +7.990133075532888e-01   +4.833797629537942e-02   -6.349500900659142e-01   -4.060050762801560e-01; +4.254602395563920e-01   -2.649645304263376e-01   -2.794191469981815e-02   -9.588498221578531e-02   +5.429181724747749e-01   +4.710120325185163e-01   -2.540540295730381e-02   -3.983618571978219e-02; -2.077540220640053e-01   -1.899324550026694e-01   +5.456040587408573e-01   -6.796296410979695e-01   +1.169350426594270e-01   -3.312994839830523e-01   +7.181868998082146e-01   +2.620912713959936e-01; -6.922817891414772e-01   +2.402002463917072e-02   -1.262613815990566e-01   -2.207174807776849e-01   +3.965932353841230e-02   -2.492012891147532e-01   +4.397004013029645e-01   -4.596381311490287e-01; -2.697698651488128e-01   +6.513291630328148e-02   +7.145937515312855e-01   -3.579675325872830e-01   -2.461594146470719e-01   +2.995926728918668e-01   -3.851909475844978e-01   -1.906071692557088e-01; -4.698682774651774e-01   +6.599174453612188e-01   -7.109865274494880e-01   -5.657753785714109e-01   -1.041269709999249e-01   -8.936800380143159e-01   -2.435349476955329e-01   -7.642442724609355e-02; -6.286574109650321e-01   +1.930477405630823e-01   -8.674527160944713e-01   +3.450509293537916e-01   -2.592423575857692e-02   +3.295194905649864e-01   +6.819404240405594e-02   +7.283919902359095e-01; -3.143946015933802e-01   -1.035100994234286e-01   +4.434059872521379e-02   -1.301732322528996e-01   -5.022746001013089e-02   +6.623440913356625e-01   +6.776450327455339e-01   -6.134340539748939e-01; +1.570714445423777e-01   -6.862335444520434e-01   -7.618544198639955e-01   -2.849332393205546e-01   -4.328859468960854e-01   +2.686978879857154e-01   +5.539982371174249e-01   +2.841130273302634e-01; +3.914487500838833e-02   -5.163034873909752e-01   +4.237691309064258e-01   +6.224011441241266e-01   +3.639994919600700e-01   +1.402529677993042e-01   +5.316914669704838e-01   -5.066861944841703e-01; -1.000000000000000e+00   -4.581613434114067e-01   +5.459124148049156e-01   +2.277628174420188e-01   +5.958370251907436e-02   -8.361055818422013e-01   +4.119235978243546e-01   -4.500612427502830e-01];
L3I_L3E_iAMPA_netcon = [+1.132345839670431e-01   -3.486330948648602e-01   +3.969378646950017e-01   +4.497777838307989e-01   -4.314207468166705e-01   +3.536436105214567e-02   -3.168562890126714e-01   +1.000000000000000e+00   +8.546228800290935e-02   +1.415231927442128e-01   -5.187590063924866e-01   +8.231748393002623e-01; -8.322290232023671e-01   -1.705466286366184e-01   +3.143065893380225e-01   +3.459348481262219e-01   -2.115389082645095e-02   +7.389387571392863e-01   +6.526221730827741e-01   +5.154358762390507e-02   -5.601934530444490e-01   -4.709625992905584e-01   -8.829763325349573e-01   +4.196212444148315e-01; +4.285927006311318e-01   -2.429656626101030e-01   +4.738762377092301e-01   -4.493526018704943e-01   -7.346343121823139e-01   +2.738050098125013e-01   +2.066253270382047e-01   +8.438322933442656e-01   +3.330237353101015e-01   -5.771104433950447e-01   +7.309099303074662e-03   +3.761511259217823e-01; -2.283928658954082e-02   -3.003980108212629e-01   +3.635320853143923e-01   +1.317310573045707e-01   +2.007831699984289e-01   +7.847225209602974e-01   +4.186002351615726e-01   -5.273531396633870e-01   -5.069106518846332e-01   -4.431970536065116e-01   +1.332181501402259e-01   +6.857009801546635e-01; +3.109816325633867e-01   -1.335695362217670e-01   -5.332480812962117e-01   +2.228865122081193e-01   -1.500509090813479e-01   -4.695838980099080e-01   -7.250845876360114e-01   +3.585812558450214e-01   +1.700494264266010e-01   -3.937494320579565e-01   -2.576469221856649e-01   -1.958653463558536e-01; -1.229765212272949e-01   -6.775785058800566e-01   -7.368734169008233e-02   -4.814127720216382e-01   +2.368337505885787e-01   +8.630681165634400e-02   +4.547291438098404e-01   -3.161705359886450e-01   -9.027263323338992e-01   +1.065169592831296e-01   -9.352665576998822e-01   +1.773151209435790e-01; -4.015132152125704e-01   -5.485153593648427e-01   +2.406766930524584e-01   +2.028730048984723e-01   +2.377745486147552e-01   +2.114441244504333e-01   -9.062212668356031e-01   +1.198113763629464e-01   -3.853180145581731e-01   +1.085750920486472e-01   -3.576135143135522e-02   -5.108869433402222e-01; +6.268906479081501e-02   +1.208266960846711e-01   -1.367160228380485e-01   -2.993192061488045e-01   -3.502680085085835e-01   +3.578278667740735e-01   -4.947931440029434e-01   -5.049772751438943e-01   +1.044467147307106e-01   -2.278840459570977e-01   -2.322820414617888e-01   -5.481581115476770e-01; -3.869235985207774e-01   -5.076027850202839e-01   -2.379893396442382e-01   -4.565958357831714e-01   +8.727333532701949e-02   -4.354243615089316e-01   -5.528641351972227e-03   -1.487286406658015e-01   +3.251492107001810e-01   -4.957233141210056e-01   -9.532503759813114e-02   +5.905658657001179e-01; -7.049444590503855e-02   -3.053800489450091e-01   +3.548770081118043e-01   -3.001562048862377e-01   +5.812949499933552e-01   +2.091114503736583e-01   -6.011931123423738e-01   -4.388580775061058e-02   -7.024631654759145e-02   -6.109365830899893e-01   -2.584193628969308e-01   +1.518921133072712e-01; +3.137645974376372e-01   -6.331284749979595e-02   -2.405093979234922e-01   +2.620215830513011e-01   -3.221846023695072e-01   -6.391766423116293e-03   -7.345272825780642e-01   +3.092076674955845e-01   +9.896086473615902e-01   +4.257909615074821e-01   +2.719082520626874e-01   +1.813518544550269e-01; -5.273534505505041e-01   -7.256975691841866e-01   +5.296247100634714e-02   +1.325399078131236e-01   +4.709591386779990e-01   -1.319285378635704e-01   +6.422527451704695e-01   -9.866518480111904e-02   -4.982508355579653e-01   +5.865210615410252e-01   +2.081463067373294e-01   +5.343399316429835e-01];
L3E_L3I_iGABA_netcon = [-3.660664294800936e-01   -7.487369872896055e-01   -3.883585999317933e-01   +5.479644199976796e-01   +9.147370269714185e-01   +1.763012543442544e-01   +5.764376855143012e-01   -9.852009480713196e-02   +8.599756515248925e-01   +2.295809503288218e-01   +1.062802464990797e-01   -2.385349668489371e-01; +4.758871554086639e-01   -7.445101776583742e-01   -7.400596772077349e-02   -5.716157602279593e-01   -1.036815514854725e-01   -1.458998195175830e-01   +4.912930480898189e-01   -4.902025364639382e-01   +5.455805195419253e-02   +3.800735936090499e-01   -4.841735272780708e-02   +2.617150546744028e-01; +3.583728471398631e-02   +4.966486014872654e-01   -5.150342286946074e-01   +2.709636012542394e-01   +3.597652077486330e-01   +3.564003681502639e-02   +3.096975194271493e-01   -3.283893344161308e-01   +2.494073234200133e-01   -4.497189751047501e-01   +9.957214261958834e-02   -3.847406674461837e-01; -9.727073951966484e-01   -4.345400284588108e-01   -6.137827454843185e-01   -2.794056507224149e-02   +2.648039434181386e-01   +1.906209781375829e-01   +1.518080321872482e-01   +2.169300512792553e-01   +7.150887800337465e-02   -2.596399638088081e-01   +1.309094032066134e-01   +4.890412838670437e-01; +5.700135137900150e-01   -6.571643220685576e-01   -3.619846339432781e-01   -4.644178574897403e-01   -3.512656448892797e-01   -1.000000000000000e+00   -3.068639910350596e-01   -1.652722849676249e-01   -4.633619603887910e-01   +1.892933051737659e-01   -3.957080748104538e-01   +4.047566039399202e-01; -1.431367740856988e-01   -3.714586786899040e-01   -5.095814742078383e-02   -2.293478393609846e-01   -3.307512356678385e-01   +4.066685455976773e-01   -1.623570053011083e-01   -8.470471945461543e-01   +6.860679888554401e-01   -2.967155120496240e-01   +4.244162810698299e-01   +4.865876403512830e-01; -6.769844475200666e-01   -3.861214568562868e-01   +6.407071081417778e-01   +4.213334183297839e-01   +1.786636466929117e-01   +8.038715387279314e-01   -4.807740676089499e-01   +1.652420743170219e-01   +2.479239833547460e-01   +4.406548327133424e-01   +5.125898248868540e-01   -4.479646532535128e-01; +7.106531341801061e-01   -2.532309852899359e-01   +3.400650012231062e-01   -9.259222582905265e-01   -1.185982616634162e-01   +2.568271489650611e-01   -2.873291656764186e-01   +6.881140980721345e-02   +2.403396323725590e-01   +4.359166393683755e-01   -2.356592123286559e-01   -5.990882132454231e-01; -1.842415052355645e-01   +9.407201302716044e-01   -3.657460995014839e-01   -5.145169023925029e-01   -2.148376733078730e-01   +6.130018405453680e-01   -4.393593558695735e-01   +3.728604986172638e-01   -1.220652885357511e-01   -6.011068524511575e-01   -1.848834235873626e-01   +4.277847326436270e-01; -2.356537603612923e-01   -3.010155404984197e-01   -4.994706720592166e-01   +5.323056140164651e-01   +5.964222895252170e-01   +4.033671399690322e-01   -6.738635919078907e-01   -7.006559979412842e-01   +2.774534535870405e-01   -2.553696872434850e-01   -6.659373960717551e-01   -3.572869140312267e-01; -6.541525158067637e-01   -3.216560350536570e-01   -4.937925839559791e-01   +7.911501654050369e-01   -2.031493235496178e-01   -4.686533227664278e-01   -5.781717009950608e-01   +2.079060376503265e-01   -6.493822811844503e-01   +6.297491104375629e-01   -3.561653023860749e-03   +4.475180054507586e-01; -7.266070890518874e-01   +6.533724258399245e-01   -7.766326988822283e-01   -3.246857044542958e-01   +7.071584348982880e-02   -2.704105852966341e-01   +9.888663909737203e-02   -7.059016044340319e-01   -3.905831618621735e-01   +3.822043853899197e-01   +4.810799712475747e-01   +7.081781287570302e-01];
L2E_Input1_iAMPA_netcon = [-2.874685427659356e-01   +2.054981192931957e-01   -6.728595956183879e-01   +1.000000000000000e+00   -2.825241458000056e-01   +7.798729637318125e-01   -2.781543269370045e-01   +7.977026824144223e-01];
L2I_Input2_iAMPA_netcon = [+4.825866461782876e-01   +8.345512813707658e-02   +2.258452335165887e-01   -2.664097641916255e-01   +2.048653478048954e-01   +1.000000000000000e+00   +2.022370058034734e-01   -7.380854857961964e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.4*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 1.0*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 1.0*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.4*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 1.0*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 1.0*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
