function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+1.006834833862722e-01   -9.494664053570757e-03   +1.537608986778086e-01   +6.013278481300156e-02   +1.339455518579347e-01   +1.605056071699521e-02   +1.269440396608831e-01   +2.286882568682861e-01   +1.252617437605771e-01   -9.012143163604826e-02   +9.324887377865777e-02   -9.825087519438030e-02   +8.248504242546341e-02   +1.417341754238583e-01   +1.125148621397081e-01   +5.617214553093882e-02; +6.616896477939219e-02   +1.601002303047850e-01   +8.295629578089825e-02   -2.368637664219593e-02   +8.232161890118067e-02   -2.329773263754840e-02   +1.299710634272003e-01   +1.449669242330636e-02   +1.412988155524819e-01   +1.083893836822012e-01   -4.731374503054586e-02   +7.975324659363042e-03   -1.091197762453555e-02   +1.260795587004335e-01   +2.558349760012541e-02   +2.532466824894817e-01; +2.634424099291600e-01   -7.437639448656973e-02   +2.519789508224769e-02   +1.639894892552959e-01   +1.839500241512794e-01   +2.467030175885977e-01   +3.150326739022796e-01   +1.817530797305144e-01   +3.255498332927945e-02   +9.500488804556820e-03   +1.383029931905826e-01   +7.649993757361026e-02   +1.474037132279292e-01   -7.396713948776439e-02   +4.842346823702534e-03   +3.165077595899434e-01; +4.611675047467552e-02   +9.252564034408470e-02   +4.473595920983794e-02   +1.312332021828426e-01   +4.915663027252597e-02   -7.515485669667617e-02   +1.384656588233130e-01   +2.650536158392526e-02   +2.861056509441257e-01   +8.930481663059063e-03   +1.915673057033793e-01   +1.443893703598180e-01   -1.593255246476848e-01   +1.326394472332700e-01   +5.097696858995288e-02   +6.018551894122666e-02; +2.074671697137056e-01   +1.399745287206924e-01   -2.717677371344120e-02   +3.802476330905995e-01   -8.973743173849238e-02   +3.590206810775858e-03   -1.061822577245330e-01   +4.797366014395466e-02   +8.547666374779564e-03   +2.357065434852206e-01   +1.601429585427296e-01   +1.999337118451787e-01   +2.822646309399037e-01   +1.377342729912853e-01   +2.741802477178590e-01   +1.813958229985957e-01; +6.865558234656205e-02   -3.789498386796310e-02   +1.157929325482825e-01   +1.825065015410051e-01   +1.237141737363342e-01   +1.331724711212431e-01   +5.059396441885109e-02   +2.695728014110088e-02   +1.395346954016586e-01   +1.652414164376101e-04   +8.467799354145809e-02   -2.404679194219395e-01   +5.437549848076767e-02   +4.217622697345495e-02   +2.820882116670986e-01   +1.189253510559612e-01; +1.984764102735161e-01   -1.648905459339360e-01   -4.922423547523750e-02   +1.459440950184190e-01   -6.359289941033475e-02   +4.674305864241735e-02   +1.374983452946247e-01   +2.043857040791432e-01   -9.297928358148799e-03   +3.007430282733945e-02   -7.056492945085653e-03   +2.673895469783636e-01   +1.293015828605350e-01   +6.121499871919818e-02   -5.570280747417401e-02   +6.220586389800251e-04; +1.641992510306061e-01   +2.426726393785407e-01   +5.943093490781043e-02   +1.851342991201301e-01   +2.295802428847624e-01   +5.129730032574985e-02   +6.780007257065326e-02   +3.454719942216028e-02   -3.748012467513903e-02   +2.706795801773375e-01   +3.015986280102095e-01   +1.823166132230959e-02   +2.977860578365288e-01   +8.510544739768203e-02   +2.438864776891673e-01   +2.542228352921611e-01; +1.082505542465914e-01   +2.929457922817276e-01   +9.292032393086064e-02   +5.273801652154089e-02   -1.221758834597980e-02   +2.822115017711362e-01   +1.606572924606510e-01   +3.075561032444202e-01   -5.924045697448450e-03   +1.486246751823624e-01   +2.228725736034733e-01   +1.146778009073590e-01   -8.995493191163204e-03   +7.791640146649675e-02   +1.068963446894375e-01   -1.699281966889589e-02; +7.150974917656436e-02   +6.543179237157219e-02   -1.301706628142452e-01   -8.722601740170209e-02   +9.610782678158111e-02   +9.065417591165628e-02   +5.548205199288080e-02   +2.393788423739751e-02   +3.261558639915119e-01   +2.058105541178024e-01   +2.610102831633093e-02   +2.280209382775394e-01   +2.165984059339760e-01   +9.157371800555905e-02   +1.125774663778537e-01   +1.033292467047251e-01; +1.945037765562646e-01   -4.031100862963750e-02   +1.913125280607948e-01   +1.772392341725827e-01   +1.263999092247983e-01   +1.185955476171777e-01   -1.025827599024674e-01   +1.573212890253828e-01   +1.054923982339023e-01   +7.971402049192057e-02   +1.650618592510273e-01   -1.472580057544269e-01   +4.786270026643085e-02   -1.237221964950867e-01   -1.544047722391177e-02   +1.205574476334431e-01; -9.733035937082507e-02   -4.873084190962196e-02   -7.381114429577579e-02   +1.118068010247615e-02   +1.682741118680181e-01   +6.792484650631993e-02   -1.422563671703480e-01   +9.567688019720813e-02   +1.069310962031765e-01   +1.053872628202437e-01   +1.198381755959436e-01   +2.049911935822835e-01   +3.469381757815010e-01   -2.870734794039811e-02   -1.200638156808402e-01   -7.329634506672567e-04; +1.344920813034713e-01   +6.990053447746282e-02   +7.703534482953892e-02   -3.830491117882049e-02   -1.325419889847828e-01   +8.018519885393076e-02   +8.339022278387502e-03   +2.841456084687641e-01   +2.565573760533105e-01   +7.209030255171926e-02   -2.055656970362774e-02   -1.317308298861281e-01   +2.707440320222225e-02   +1.502348306773464e-01   -4.466744785809090e-02   +8.312729864781440e-02; +2.759096883330383e-02   +3.833171449671471e-01   +2.697610449808437e-02   +1.469068824411644e-01   +4.242515664158458e-02   +6.204121280133414e-02   +1.721645370935811e-01   +8.101569817172968e-02   +8.118219094262331e-02   +5.908274975692479e-02   +1.065285914897067e-01   +2.126719284843539e-01   +2.296088878275522e-01   -1.429736322665665e-01   -4.408148341316230e-02   -2.847950722622631e-02; +1.838380464637574e-01   +1.312651819592634e-01   -9.091673701268846e-02   +2.201403234220936e-01   +3.035616111561234e-01   +4.261877163563563e-02   +3.407418315256304e-02   -5.698302496073267e-02   +9.212710534149321e-03   +2.380577944059769e-01   +3.452943384891005e-02   +1.890052977886314e-02   -1.266455231354717e-01   +8.229580186573346e-02   -7.269486181192589e-02   +1.865621081387127e-01; -4.991056583850378e-03   +1.170464107412953e-01   +9.116365289531064e-02   -1.893015809069854e-01   +1.662061394637045e-01   +2.384133281170430e-01   +1.203131115025445e-01   +1.475233842830313e-01   -1.008013800981387e-01   +3.087711775627615e-01   +1.534304211251515e-01   +8.730694184717495e-02   +7.116761219674871e-02   +8.237861400432535e-02   -7.160952518069935e-02   +2.005845149824629e-01];
L1E_L1I_iGABA_netcon = [+4.136076585392620e-02   +5.141894065275393e-02   +9.753671300566501e-02   +1.543200634833130e-01   +5.697971662804686e-02   +1.048640792600750e-01   +2.292018501348997e-01   -1.207836818074763e-01   +1.692162403250302e-01   +1.187957801692015e-01   -6.680077993479651e-02   -1.589547742383901e-01   +1.319062406219304e-02   +1.806309522282618e-01   +7.129188044521699e-02   +1.196648270050481e-01; +5.720032015921657e-02   +3.107744510040557e-02   -6.465205190925710e-02   +1.377259619758718e-01   -3.943349246824180e-02   +3.064174610441070e-02   +1.056258826729765e-03   +8.619008160550454e-02   +1.225143913887315e-01   +8.823163525392713e-02   +2.783384662457368e-01   +1.601459201719803e-01   +4.443662317038868e-03   +8.680478647252857e-02   +7.159689958738188e-02   +8.543070025163674e-02; +1.503227933503740e-01   +1.305465887935338e-01   +6.727797204008180e-02   -1.729153826167156e-01   -8.077615388147769e-02   +1.762055189753189e-02   +1.155246520407771e-01   +1.261594746251597e-01   -5.934263671514105e-02   -5.653932167466782e-02   +1.982683388092129e-01   -1.551078405072688e-01   +2.404224997615970e-01   -1.323681107843320e-01   +6.913389279385358e-02   +5.965488032315523e-02; +2.655794007928289e-01   +3.070016368272371e-01   +2.072243283117584e-01   +2.379671112576748e-01   +7.217304255762221e-02   +9.777079105161382e-02   +2.275256090295755e-01   -2.929913664995477e-02   +1.663796594219354e-01   -8.993063078327690e-02   -2.981062157542157e-02   +8.543828779975107e-02   -3.341455679082689e-02   -1.051361640368532e-02   +1.089910650732073e-01   -1.556321063707404e-02; -2.541268811431692e-01   +3.317629119990300e-01   +1.093741400990870e-01   +7.241598433049262e-02   +5.127122703059601e-02   +2.423149746256408e-01   +2.739432059337049e-01   +2.296892931314255e-01   -3.604960447311259e-02   +1.506245048979272e-01   +1.433748813636889e-01   +8.651477754469711e-02   -1.285132980617826e-02   +7.582722749091446e-02   -1.009517123666160e-02   -1.038192502020507e-01; +1.440395341411993e-03   +2.373109519066013e-01   +9.156174238226233e-02   -9.426763016849035e-02   +1.028002203252041e-02   +1.606928796783032e-01   -3.069136501637900e-02   -2.891599468512712e-02   +1.973928188546993e-01   +1.263783970693747e-01   -1.942601435298273e-01   +8.995461872290295e-02   +4.126273357449449e-02   +2.006775861311469e-01   +1.117410180992175e-01   +1.734483807422683e-01; +9.183453026164459e-02   +4.638569604298236e-02   +1.814006425329343e-01   -1.410359297223986e-02   +2.896726181914373e-01   +1.398038870885863e-01   -1.508023407801875e-02   +3.373037316262785e-02   -1.047626329546571e-01   -3.818125577824300e-02   +8.609522577190484e-02   +4.490405819178762e-02   +8.676106571980513e-02   +1.453149226671766e-01   +9.826033879309114e-02   +2.109804742284895e-01; +1.386439826726390e-01   +9.171621004921247e-02   +1.235924852351036e-01   +2.076360763715387e-01   +3.366233435725482e-01   +1.593727786974329e-01   +1.878320376344766e-01   +2.494037569783368e-01   +6.595802934565757e-02   +2.478111580433798e-02   +4.634298299304630e-02   +7.791541573125327e-02   -2.081092801953371e-04   -1.104434732093246e-01   -1.340132733428408e-01   +3.702353839486913e-01; +2.974114668916482e-01   +1.773444279355340e-01   +1.476893816613259e-01   +4.282606317166441e-02   -1.698164998105149e-02   -4.069677574188259e-02   +3.229711421822820e-01   +1.913809947012656e-01   +1.606381555318372e-01   +1.133227919456357e-01   -2.896344981024274e-02   -9.747235283969510e-02   +8.397652635195929e-02   +1.673545432246798e-02   -5.892295156236106e-03   +4.581795839779004e-02; -5.664016059358278e-02   +1.116470302584733e-01   +2.713680159672321e-01   +1.574276067165016e-01   +6.322999118771108e-02   +1.659129223724783e-01   +1.764730658046043e-01   +3.856699728407338e-02   +1.199456656256350e-01   +3.464347435577892e-02   +1.656238028053151e-01   -8.826512098179008e-04   +1.877968388219748e-01   +1.084473335093034e-01   +2.551200272613318e-02   +9.233465697603613e-02; +1.873835327611145e-01   +1.646904516440034e-01   -2.561230789211451e-03   +1.011813404732499e-01   +7.508288743971342e-02   +2.461440328694355e-01   -7.516367147204628e-02   +2.657722589841007e-02   +1.004595183682321e-01   +7.188721604876919e-02   +1.494315381677803e-01   -4.820521986929380e-03   +1.195131189321405e-01   -7.458019449413734e-02   +2.493198041608475e-01   -4.301897815012518e-02; +4.879554809420136e-02   +1.946655911495551e-01   +1.804975527808090e-01   +2.186486637501534e-01   +1.848601283023384e-01   -1.684004632565971e-02   -1.019937455658225e-01   +3.669798544986859e-02   +6.930761439664647e-02   -1.699742486673902e-01   +1.673045240304445e-01   -2.233349510272264e-03   -7.406063968224035e-02   +2.051182182707382e-01   +2.116070152705758e-02   +2.758310694529820e-02; -2.484586492107172e-02   +1.540102075770288e-01   +1.423155566620261e-01   +1.416820757277516e-01   +7.658628964452230e-02   +1.479835158158410e-01   +6.992436176642479e-02   +1.576443287734276e-01   +5.494910444798035e-02   +1.480831304514131e-01   +1.773377463168677e-01   +2.199282761123159e-01   +1.478158453742963e-02   +1.850982326914325e-01   +2.561672608852818e-01   -3.845317283476708e-02; +1.054086064484583e-01   +2.409287653960326e-01   +2.867703896091581e-01   +7.771786806291872e-02   +1.583679335172445e-01   -3.062445078436422e-02   -1.440909334680533e-01   -1.584168179429444e-01   -8.489940782910058e-02   +7.928743464875670e-02   +3.060630418667672e-02   +3.618861249008470e-02   -8.573055633372989e-02   -1.079514313381007e-02   +2.033503199106096e-01   +1.866329934334029e-01; +1.636987708668398e-01   +8.020005979705429e-02   +1.553352402952452e-01   +8.277013861747709e-02   +1.928568753546875e-01   +3.360887314744121e-02   +3.722352003610313e-02   -6.439311155448729e-02   +3.324124698504877e-02   +5.203685162985004e-02   +8.028992869647589e-02   -3.247734489267975e-02   +6.699220610245422e-02   +5.601982432694697e-02   +6.695886432153625e-03   -2.013707688069510e-02; +2.762217006404281e-02   +2.105826586961023e-01   +6.397111773494304e-03   -4.678924052662992e-02   +2.000147213545093e-02   +2.284345851140593e-02   -2.596555098485390e-02   +8.860488813709461e-02   +4.392984386777929e-02   +4.197240310722437e-02   -2.426731377544843e-02   +4.713312566132660e-02   +8.202200596962807e-02   +2.313413487693923e-01   -7.322920976236784e-02   +2.551595842754547e-01];
L2I_L1I_iGABA_netcon = [+3.927648856466117e-01   +8.710197689863571e-02   -1.140449435503793e-01   +1.775772787404123e-01   +1.486425455976588e-01   +9.919061980527924e-02   +5.509200787879110e-03   +2.668770679063764e-01; +2.272243681694084e-01   +6.521896369879707e-02   +2.281416818697926e-01   +3.090678246526823e-01   -2.413117915188165e-02   +1.199784282563612e-01   +5.296451930299220e-03   +8.239766813530072e-02; -4.971793612135800e-02   +2.666804536709382e-01   -7.750084976913733e-02   +2.507371460218124e-01   -8.018733322131722e-03   -8.185439300333046e-02   +7.926416377823728e-02   +8.185676964855591e-02; +1.193602036659481e-01   +1.255930489440101e-01   +8.704531904211175e-02   +2.302789548773313e-02   +1.683680118449570e-01   +1.548905170779107e-01   +1.575315935454636e-01   +2.107719968306192e-02; +1.814803382182408e-01   +1.476082051351970e-01   -8.931203194187201e-02   +1.819847681676682e-01   +1.835019048086589e-01   +2.206928990764292e-01   -5.349855429666699e-03   +1.247573828336948e-01; +2.189328102347435e-01   +6.030216129441113e-02   +2.310265061270197e-01   -1.270874227091046e-01   -8.665298556105323e-02   +2.892555834133098e-02   +8.563206195467077e-02   +5.757474940510041e-02; +3.468410195067571e-02   -9.174477573085205e-02   +9.510005274305902e-02   +4.580834218913538e-02   +1.103535710308302e-01   +9.224158510788751e-02   +1.166237827497744e-01   +9.455095459825315e-02; +7.050353266709240e-03   +4.787665234713202e-02   +1.809663920815076e-01   +1.346424286160583e-01   +8.265488731460782e-02   +2.252471586354814e-02   -1.341137627087953e-02   +5.566581209528798e-02; +1.347228215389331e-01   +1.500706656463970e-01   +7.399479496646626e-02   +2.850247941811716e-02   +3.887611365071812e-02   +1.748813919015981e-01   -8.377856421491259e-02   +3.045512332326340e-02; +9.178315972152157e-02   +1.587410191520029e-01   +1.838232637425984e-01   +1.662426276795269e-01   +2.388977090412004e-02   +3.855330735456019e-01   +2.867090315924473e-01   +2.385019926709662e-01; -3.143026598600611e-02   +8.479920719851933e-02   +9.823020208077361e-02   +2.675251489510070e-01   -6.793314329907274e-02   +1.517162536090306e-01   +1.926195285941047e-01   -3.699495301352326e-02; +1.820685054261558e-01   +1.223190709745293e-01   +8.987123518041897e-02   +6.828131894397194e-02   +1.831178664774176e-01   +2.566757950520189e-01   +5.775782756620613e-02   +5.196390633035634e-02; +2.160748544725009e-01   -1.785712203347865e-02   +2.170111666391064e-01   +2.916586540733361e-01   +5.253840117549137e-02   +9.665348088644375e-02   -2.555608021105757e-02   +3.300073168647157e-02; -7.164993007613248e-03   +6.954184699951955e-02   +2.100846657940948e-01   -8.802671317557004e-02   -1.118712942757211e-01   +1.039782119217404e-01   +1.539700119099855e-01   +2.083133869978945e-01; +2.547478579419786e-01   +2.268335265887103e-01   -4.693002835042451e-02   +7.228709340168010e-02   -1.759510499328343e-01   -5.677052854558982e-02   +2.534596172324473e-01   +8.927526964526707e-03; +1.292094395019797e-01   +1.214649674210272e-01   +1.532923595006611e-01   -1.154584732331718e-01   +1.393964815320386e-01   +1.350863131945873e-01   +7.910965143835227e-03   +2.363325627718308e-01];
L1I_L2I_iGABA_netcon = [+1.187416988840903e-01   -2.802319594669827e-02   +4.320468380964074e-02   +2.214335238077305e-01   +1.477277888382013e-01   +8.749248177581422e-02   +1.359523947500272e-01   +7.011531651660526e-03   +1.420516886525867e-02   -4.270729822233883e-02   +1.297463579337660e-01   +1.728804794761062e-01   +2.852621660976554e-01   +1.901711784915602e-01   +1.135001741308735e-01   +2.818482638987191e-01; +2.023801716165247e-01   -3.016799921329631e-02   +4.249678635955771e-02   +2.590012899594210e-01   +2.144536703626820e-01   -1.621163449244203e-02   -1.978534709542705e-01   +7.981640859745662e-02   +1.538744433524382e-01   +1.516669400761665e-01   +7.459715468404013e-02   +9.379364878692135e-02   +9.260488745682451e-02   +9.228055524914526e-02   +5.181726850572460e-02   +1.603056347528280e-01; +4.923368823549630e-02   -6.093260068371895e-02   +1.380802640651094e-01   -1.198041344820011e-01   +1.885768668938314e-01   +2.600439887051734e-01   +3.619775493279432e-01   -3.091736461308458e-02   +9.664927049859826e-02   +1.049413651876928e-01   -2.146760250421912e-01   +3.063452473514832e-01   +1.306997801293925e-01   -3.911918835491652e-02   +1.682059278429233e-01   +7.063105067671391e-02; +4.771765244060625e-02   +1.880532369814100e-01   -2.240442149785388e-02   -3.350909967094751e-03   +7.340199289496278e-02   +2.672625439040279e-01   +1.507570408519637e-01   +8.029614373665499e-02   -6.878723351850002e-02   +1.237038528234318e-01   +1.405336146853312e-02   -2.527256219171806e-02   +4.760644569214909e-03   -1.770696143131220e-01   +9.775905692279713e-02   -6.115582736543139e-02; +1.445339188042651e-01   +1.196975778123522e-01   -1.881219027548525e-02   -1.173524754068019e-01   -3.471020932502145e-02   +2.303200831064144e-01   +1.079338014692046e-01   +7.260435555946007e-03   +4.138779765920434e-02   +1.129464168829124e-01   +1.387494695579018e-01   +1.035819178858478e-01   +1.864407590444873e-02   +1.309768124693178e-01   +9.067654340179962e-02   +1.198095943227483e-02; +8.856401456939536e-02   +1.280686853410489e-01   +1.990594457348791e-01   +8.197760959736683e-02   +1.823326129290370e-01   -3.436824729951374e-02   -1.203103648505424e-01   -5.461246150391312e-02   +2.394159640851843e-01   +2.641192497371804e-01   +1.960876932932518e-01   -3.246243346273180e-02   -9.434205042511243e-02   +1.534962918246384e-01   +1.148080404788199e-01   +4.340412840204383e-02; +7.817651224373108e-02   +5.704127962151762e-02   +1.083817422004981e-02   +2.505406947299030e-01   +3.842107892069901e-02   -2.318708888486724e-03   +2.185303810585599e-01   +1.060477935403932e-01   +1.302603309875148e-01   +1.838291112910769e-01   +2.497290030665925e-01   +4.685564077722007e-02   -2.906689328124487e-02   +2.200067938480921e-02   +2.387204289017374e-01   -4.882562018713938e-02; -1.001326381912733e-01   -4.224156872710108e-02   +2.351192237128527e-02   +7.827653928065308e-02   +1.690211203979286e-01   +1.199001538257941e-01   +9.128746601979351e-02   -3.666208195351953e-02   +7.401799691908305e-02   -1.915845877712001e-02   +1.293035267753404e-01   -1.512431640128061e-01   +1.566298787702876e-02   +8.476563054386234e-02   +2.204305114958157e-01   +3.412912098043606e-02];
L2E_L1E_iAMPA_netcon = [+1.223520925924100e-01   +1.711626445033048e-01   +1.467151346452224e-01   +1.138110730108666e-01   +8.492827837082864e-02   +5.502434542910607e-02   +8.518494286308517e-02   +1.018855876258179e-01; +7.692664232309206e-02   +2.917318401089045e-01   -3.745321791223280e-02   -7.945090935613545e-02   +2.344183628641742e-01   +2.377137893972636e-01   +1.583593007355606e-01   +9.178100329756675e-02; +8.273791767234241e-02   +2.758737997671416e-01   +2.029251363499177e-02   +1.521024106271873e-01   -3.499500461265685e-03   -7.418278316854814e-02   +9.442122471591881e-02   +1.967764716885652e-01; +1.871734044343724e-01   +1.678134158233491e-01   +2.945941430726389e-01   +5.902070694221519e-02   +1.716715027638548e-01   -1.147447782040043e-01   +7.636132624056785e-02   +5.975289548423788e-02; +7.098590504503473e-02   -1.521912374234626e-01   -6.268473142558571e-02   +1.459703536799787e-01   +5.264040466845263e-02   +1.661988861605782e-01   -1.419867910986295e-01   +2.995498887845263e-01; +4.218252772468672e-02   -8.264167767797086e-02   +9.894796581016845e-02   +9.176956728232974e-02   +2.055086876715245e-01   +2.955682076816958e-01   -2.027609066840309e-02   -4.810986099782261e-02; +1.237605993634341e-01   +1.189050131952011e-01   +4.497278006115678e-02   +2.606545241239121e-02   +1.682875239970996e-01   +2.834804348920188e-02   +1.456113416158202e-01   -6.713325644390618e-02; -1.535011478068490e-01   +2.216101824358572e-01   +2.981166886745992e-02   +2.186405382761408e-01   +1.617667255304716e-01   +2.410867959876917e-01   +1.515651896752973e-01   +2.904803232247388e-01; -8.029464877582920e-02   +1.083456417278064e-01   -1.727008239228152e-01   +6.223283583867049e-02   +2.127715999238909e-02   -4.172475876844117e-02   +2.861627502292857e-01   -8.319536397124364e-03; +9.419979791116201e-02   +1.331221562240037e-01   +2.539897702379018e-01   +1.680412061064626e-01   +2.029352208257723e-01   +2.257282584831746e-01   +5.541718001910105e-02   -1.570800171430987e-01; +4.592989342796641e-02   +1.589281994099106e-01   +1.726988208178012e-01   -4.755073670442221e-02   +2.084788970973478e-01   -4.969965091378950e-02   +2.592808747909847e-01   -3.727963912665067e-02; +1.466058675718783e-01   +8.556620336281641e-02   -7.026321828724005e-02   +7.147661919545995e-02   +7.501434919648448e-02   +1.746330021532145e-01   +3.173681045479136e-03   +8.506438874185359e-03; -4.432449186102078e-02   +8.797855837397729e-02   -8.004963838194375e-02   +1.142274136643552e-01   +1.159452199271966e-01   +1.298522604108208e-01   +8.786647746322489e-02   -1.001552068306416e-01; +2.449266280014161e-01   +1.181973954816671e-01   +6.352264886365372e-02   +5.665280390082232e-02   -1.219171232588385e-01   +2.170502120371852e-01   +1.042804260671151e-01   +1.639919836888253e-01; +1.050460243415583e-01   +1.581907053930476e-01   -1.322873800249238e-01   +1.812012819390943e-01   -8.049191877449961e-03   +9.938059483546167e-03   +8.898273561337816e-02   +6.732258934564386e-02; -3.645550379124163e-02   +6.787360699404697e-02   -4.944207889861871e-02   -4.470883508719968e-02   -1.011788312684278e-01   +1.824366555760198e-02   +4.509687323436425e-02   +1.971552344587997e-01];
L1E_L2E_iAMPA_netcon = [-2.402047850026384e-01   +6.497218251663935e-02   +9.399553122954248e-02   +8.159767164403993e-02   +6.723708038366147e-02   +1.768531262208163e-01   +2.678771663321638e-02   +2.462019072304458e-01   +8.277502489500629e-02   +8.803022632841979e-02   +1.796626710343291e-01   +2.156960419876385e-01   +2.367626345680525e-01   +4.437209036796864e-02   +1.039312541099405e-01   +1.089019196887221e-01; +3.346270607195220e-01   +8.204635731284178e-02   +6.748264117182898e-02   +3.372865790419381e-02   +1.787179294099674e-01   +7.043252941575168e-02   +3.297911675446724e-01   +2.880080824843426e-03   +1.753415814194784e-02   +6.837131782578632e-02   -1.472303775119085e-01   +1.100211443968303e-01   +2.567700959463613e-01   +3.309188557569194e-01   +2.669671880028406e-01   +1.922435594476091e-02; +3.861471789424151e-02   +1.637484036784223e-02   +2.206802513247249e-01   +1.342473697158804e-01   +1.810849004135067e-01   -9.696497288527797e-02   +1.780156310634846e-02   +3.486883993027747e-02   +7.627847770939998e-02   +1.686246782777547e-01   +9.261604937413889e-02   -5.982223412349208e-02   +1.544805725953660e-02   -1.020407624622188e-01   +8.788732388573270e-02   +2.083189986096142e-01; +4.999284128813845e-02   +7.037411791167625e-02   +8.232985448615203e-02   +1.057674459055355e-01   +1.289030947097227e-01   -7.122761471469648e-02   +2.370826402324974e-01   +1.616797060491180e-01   -4.011226060480769e-02   -5.405139682844350e-02   +1.816577695616709e-01   +7.937844827803510e-02   -1.098603908859829e-02   -1.904251718649975e-02   +1.754646228807208e-01   +3.211649744991645e-01; +8.534117232825854e-02   +4.533773523669634e-01   -1.280939143530742e-01   -8.174524127558819e-02   +6.417512751860741e-03   -7.816181565033391e-02   +6.784473423434795e-02   +3.128681560498545e-01   +7.943469147899695e-02   +1.391109582067709e-01   +5.818732826912113e-02   -4.724186662298835e-02   +1.922022910920297e-01   +5.572400737082545e-02   +1.482485816847192e-01   +3.091343500686808e-01; +1.594951976430583e-01   +2.021768759245550e-01   +1.961442014797541e-01   +3.152516748431838e-02   -6.208151603904578e-02   -5.820085903437979e-02   +3.867391274594945e-01   +3.298267121877720e-01   +6.693716850219128e-02   -4.413358084476751e-02   -1.454279081211301e-02   -1.528328106250779e-02   -6.071646070729350e-02   -9.917615583345833e-02   +1.128886158370014e-01   -1.313138987112135e-01; +2.738672531361154e-01   +5.000219371451528e-02   +1.476308409172526e-01   +9.428226918773422e-02   +2.197963314584548e-01   +1.112007833577279e-01   +2.069572206076628e-01   -2.932078104563136e-02   +3.588972566425259e-02   +3.101084289777543e-02   +4.684339595050213e-03   -2.013377487086223e-02   +3.262788344090656e-01   +1.039114423390269e-02   +2.135945188266353e-01   -1.254602005092443e-01; +3.124649573933804e-01   -7.434807187462816e-02   +1.885417652947833e-02   -1.109697838601076e-01   +3.644686149577622e-02   -3.807538266607978e-03   +1.229525206872770e-01   +1.122919877972512e-01   +1.010395192212069e-01   -9.392542332310412e-02   +2.771844325278786e-02   -1.514346518610241e-02   +1.507512413959046e-01   +3.440683211804037e-02   -1.570561378794088e-02   +1.484162372136296e-01];
L2I_L2E_iAMPA_netcon = [+2.870169246696352e-01   +6.814518801326053e-04   +7.368940530449784e-02   +7.966692213844417e-02   +1.042223172223351e-01   +1.753907221703418e-01   -2.216660207183759e-03   +1.554179402989676e-01; -1.168109453971196e-01   +1.837623396474379e-01   +1.239030905787762e-01   -7.379178641786693e-03   -4.650944658840570e-02   +8.228750786812317e-03   +1.246119710996330e-01   +4.743131498619572e-02; +1.531008462205140e-01   +8.171850515796403e-02   +2.501519948424076e-02   -2.822040250350492e-02   +1.412041358106320e-02   +1.139320553488265e-01   +8.590676889254532e-02   +2.803721693741012e-02; +3.138222732940375e-02   +7.161149060504865e-02   +9.055615390559474e-02   +4.930047099441255e-02   +7.156378968082555e-02   +3.889538866218020e-02   +5.809187031085943e-02   +1.352613202037919e-01; +1.080076940153096e-01   +4.664063550392741e-02   +9.441105709927725e-02   +8.312711768239074e-02   -1.554430221078009e-03   +6.951335617301170e-02   +2.000775990182465e-01   -5.070411904033913e-02; +2.631870890928286e-01   -6.830682349307390e-02   +2.210995623736928e-01   +9.126366160534458e-04   +1.325599380234680e-01   +2.457546334786118e-02   +1.742154446678211e-01   +2.271604310408271e-01; +3.929174863743740e-02   -3.836442806736541e-02   +2.316273949170997e-01   +5.812822501577170e-02   +8.753399627563997e-02   -4.574197582728541e-03   +8.767190419044883e-02   +6.741928020661721e-02; +1.780328096516242e-01   +2.416988448273255e-01   -4.615842000600529e-03   +2.171236655550772e-01   +2.397004615782656e-01   +1.059184599761871e-01   +1.410044356725228e-01   +8.905545225306354e-02];
L2E_L2I_iGABA_netcon = [+1.217799227099203e-01   +2.563188563242461e-02   +1.221767177665668e-01   -4.468477188720984e-02   +1.169800236446918e-01   -6.438439681741848e-02   +9.604734993895102e-02   +1.629843662841972e-01; -1.195382166972261e-01   +9.599780691991822e-02   +1.543153633997452e-01   +1.257650660906388e-01   +2.310291283677703e-02   -1.350839417688406e-01   +1.671919913605592e-02   +3.426069271616499e-01; +2.114299758120510e-01   -5.102187073029125e-02   -6.358097179814398e-02   +1.953890543820256e-01   +2.307558464671544e-01   +1.191508658616705e-01   -2.198824861483863e-02   +1.268833320709308e-01; -2.037271680164691e-02   +1.453642397310186e-02   +3.225853795199703e-01   -2.051386786965802e-02   +1.212014035612999e-01   +1.391416516324611e-01   -1.060458070910828e-01   +1.466648163401168e-01; -4.188785475412349e-03   +1.205324505010512e-01   +3.384018638250597e-01   +8.881220862146179e-02   +1.610591281564981e-01   -1.326703787610652e-01   +9.380499163995647e-02   +5.644279970234115e-02; +1.140264614155592e-01   -4.457325905534443e-02   +1.955774164540767e-01   +1.883451169662788e-01   -1.338549291099291e-01   +5.832123806179193e-02   -1.073756144157837e-02   +1.883230236395734e-01; +8.367165357153364e-02   +9.630689260792254e-02   +2.774240738364260e-01   +6.800242510523297e-02   +8.963494124884436e-02   -5.041835828986870e-02   +1.270779545744684e-01   +1.446312477051780e-01; +2.554778203909906e-01   -3.625279641417598e-02   +1.698395926936186e-02   +1.013599839091672e-01   +6.881323629816144e-02   +1.354245952863525e-01   -1.188521245827937e-01   +7.687247866166906e-02];
L3E_L2E_iAMPA_netcon = [+1.771948876918920e-01   +1.398357519169180e-01   +1.742727961927577e-01   +1.371609922754300e-01   +1.067158642006244e-01   +2.047861075821465e-04   -7.022753542651683e-02   +1.422564685077548e-01   +1.278642653445566e-01   +1.188967087491613e-01   +4.342944100000481e-02   -9.345907215522689e-02; +1.159216318384285e-01   +6.208994873603775e-02   +2.638767404143997e-01   -4.331722911405726e-02   -1.229092586605557e-02   +2.267213591486759e-02   +1.649411350325897e-01   +1.273867046363034e-01   +1.888064028283903e-01   +9.206578541187514e-02   +1.269125837959074e-01   +1.915384211372467e-01; -1.798126082766920e-02   +6.014338670974492e-02   -1.718592154321492e-02   +3.320337470325189e-02   +4.809815267953174e-02   -3.343985618084727e-02   +6.769842573669077e-02   +1.683914030663379e-01   +1.178288323636335e-01   +1.278886491165923e-01   +3.108659910363851e-01   -1.395883711695803e-01; +1.011525454801818e-01   +2.173429537122778e-01   -8.641366283253844e-02   -5.776874894258984e-03   +1.394053946877912e-01   +2.840684106740125e-01   +7.014228269362036e-02   -5.459271074424812e-02   -2.109903808414929e-02   +8.093935520295423e-02   +7.588035325486034e-03   +1.280664901426934e-01; +1.514645431114602e-01   +7.920364065290456e-02   +9.234766839968173e-02   +1.514611104687210e-01   +2.137039371344129e-01   -9.375363192378944e-02   +8.751029414377934e-02   -5.620326605402289e-02   +1.204063934521188e-01   +2.400074659756498e-01   -6.546979527078242e-02   -9.193602255643131e-02; +2.248376119310062e-01   +3.564604818776598e-02   +8.397845743657453e-02   +5.494245358946392e-02   +6.406302174417884e-02   +2.462860683015119e-01   +9.799796891224752e-02   +2.795125997638932e-02   +2.107155291757297e-01   +3.747682719496660e-02   +2.056283218814660e-03   +5.198969629195820e-02; +1.921635546840509e-01   +1.363715154104455e-01   -3.996875772705284e-02   +2.165703861814695e-01   +3.157808494917869e-01   +1.476368626273576e-01   +5.465856530627945e-02   +4.655297085952420e-02   +1.720604266748736e-01   +4.445355402249256e-02   +1.889588395855175e-01   -2.637311851179144e-02; +1.735701348960074e-01   +1.321169083472514e-01   +3.626576123122835e-01   -4.781605318831678e-02   -1.149357362430272e-01   +2.328043846529324e-01   -1.408864164222127e-01   +8.044563384570021e-02   +1.473482781103017e-01   +2.415524387728556e-02   +9.231830094220170e-03   +1.189997607078674e-01];
L3I_L2I_iGABA_netcon = [-1.354542634872529e-01   +1.599777770824743e-01   +1.806440034668578e-01   +7.761399391950893e-02   +2.936822600977246e-02   -2.589474797893556e-02   -9.330014822682789e-02   +2.437927458696408e-01   +2.742660839523560e-01   -1.338703966392853e-01   -1.206095371791641e-02   +2.022249378674340e-02; +4.199475539972604e-02   +2.329323136297654e-01   +2.161143578484412e-01   +1.285664139205591e-01   -5.255607800519728e-02   +3.489484448668039e-01   -8.792026693261662e-02   -2.565191729273682e-02   +1.577945980304114e-01   +1.179255809742162e-01   -2.639787707721733e-02   +1.647226867104928e-01; -5.430457995436230e-02   +6.537642698713374e-02   +3.030378099534645e-01   +2.909317339599851e-01   +5.137744034490696e-02   +2.342925029372208e-01   +2.080295075326330e-01   +2.188386390529530e-01   +1.149136174669241e-01   -7.055526580212799e-02   +2.799687598032030e-01   -3.081249472317778e-02; +4.389386407954410e-02   +9.514597473300980e-02   +5.665580132825088e-02   -2.638299464626043e-01   +1.173368837899799e-01   +2.618708185029202e-01   +2.905430035976676e-01   +2.316922215255667e-01   -8.365645804941071e-02   +1.046843124081045e-01   +2.047740616357591e-01   +1.543992482797978e-01; -4.981335659925842e-02   +3.299879066928342e-02   +3.537168020703818e-02   +1.044768191663113e-01   +2.522827980138614e-02   +3.209227677760264e-02   +1.163622117364153e-01   +2.004114794194676e-01   +1.249786807328597e-02   +4.780568819472887e-02   +2.300445417304736e-01   -3.990445013336783e-02; +4.444275878582102e-02   -1.212123985858489e-01   +1.515650723303242e-01   -4.988384158427785e-02   +8.722649403780244e-02   +2.285273619248031e-01   +5.567240331502270e-02   +2.043262942238511e-01   -2.787030646122968e-02   +1.988480679712020e-01   +3.829108046818906e-02   +5.384100982694785e-02; +3.312199779222945e-01   +4.521574290057979e-02   -2.970248788871195e-02   +3.626527040905482e-01   -1.456544194449077e-01   +1.983696542491378e-01   -1.288617052664403e-01   -8.321630757211299e-02   +6.967607470826132e-02   +4.975209606237116e-02   +5.669710705786633e-02   +1.997554819923024e-01; +6.765015242560425e-02   +4.410517208007740e-02   +3.864604866010949e-02   +1.547175038838618e-02   -7.422436688917271e-02   +7.424044099890502e-02   +1.483360131415791e-02   -4.058809468112717e-02   -5.450640032521410e-02   +2.639155406167175e-01   +1.015023008986550e-01   +8.851540416646340e-02];
L2E_L3E_iAMPA_netcon = [+1.337416712170493e-01   +2.378532898399662e-01   +9.557370804663991e-02   +3.076924420820522e-01   -8.175826682915865e-02   +1.709259650536409e-01   +2.796391007388339e-02   -7.289492466291472e-02; -8.956252942022860e-02   +4.123653072686928e-02   +1.644447693217053e-01   +2.044253779790565e-01   +1.245088811633753e-01   +1.462699987308898e-01   -7.931095396814218e-02   +8.475664630381317e-02; +1.612964832361594e-02   -4.468706982988718e-02   +2.434731754751474e-01   +3.316279961995929e-02   +1.336423624492239e-01   -1.669132925657922e-02   +2.501020445062802e-01   +7.444645192034634e-02; +9.162595438885535e-02   +5.221440505611959e-02   +6.098906761738246e-02   -2.451150924936109e-02   +3.374871969248236e-02   +1.636213840996639e-01   +2.230069043520330e-01   +1.595627181799869e-01; +1.565382861455826e-01   +1.879312762390064e-01   -2.153516123486522e-02   +1.256797381183889e-01   +8.547998278987251e-02   +1.749446811409349e-01   +6.650376752060848e-02   -3.741750852539327e-02; -3.943458681385913e-04   +2.376406931816302e-01   -6.671994455507207e-02   -8.410784966923784e-02   +6.166552221495975e-02   +1.567215315562855e-01   -5.850968464501792e-02   +9.456258241880922e-02; +4.776390660508559e-02   +1.398146564427110e-01   +1.747936653011030e-01   -1.422877788114105e-02   +1.024559013361311e-01   +5.810475355052990e-02   +1.520920781170321e-01   +1.556536053617364e-01; +1.369495184765918e-01   -1.398852609737276e-01   +4.136766075794309e-02   +2.556951067266986e-02   -1.139362736018201e-01   +1.594634642595824e-01   +1.752627105571561e-01   +3.851513290150599e-02; +1.089698755458506e-01   +1.101753767998666e-01   +1.920274723204513e-01   +1.651956159736974e-01   +1.300989601435587e-01   +2.880814142775046e-02   +1.626668261372703e-02   +5.932151437962845e-02; +1.598518061962673e-01   +1.305000324311102e-01   +9.840641289077282e-02   +3.690008302445866e-01   +4.419199175403084e-02   +6.910137108580658e-02   +2.851717318810607e-01   +2.967584324881806e-01; +1.566928808225912e-01   +7.486722478741724e-02   +1.341208342985050e-01   +1.543845077491221e-01   +1.356720358553863e-01   -1.235539724264914e-01   +6.488344132342529e-02   +3.279865317254274e-02; +1.470190881543152e-01   +8.439701623763937e-03   +1.858025276845999e-01   -1.707690491856252e-01   -1.686402468279877e-01   +2.335481734955854e-02   +2.487287526260228e-01   +1.991568311374977e-02];
L2I_L3I_iGABA_netcon = [+1.338466308835953e-01   +2.211858228333573e-01   +2.205508873030583e-01   +2.000668611688285e-01   +1.826513989250347e-01   -1.727709632030141e-01   +5.424882596871333e-02   +1.693062565134942e-01; +1.553476024340731e-01   +3.272835332840410e-01   +2.231986716161009e-02   +4.827399068939539e-02   +2.388582797712896e-01   +1.313379956407131e-01   -4.515714095670845e-02   +1.897792062284575e-01; +4.483208351516283e-02   +6.130343036502402e-02   +8.375039384104707e-03   +1.498570655890872e-01   +1.701357952393922e-01   +2.619037618148590e-01   -6.469861890398715e-02   +1.011940235109284e-01; -1.495204255639054e-01   +1.213517508222206e-01   -8.438539909106599e-02   +2.020121868135412e-01   +2.228748698718786e-01   +2.248334392009725e-01   +2.329505480749821e-01   +2.940392317996735e-01; -2.535853510450642e-02   +9.327769702246602e-02   +2.566389379547092e-01   +3.349778941313179e-02   -4.607502932443354e-02   +9.542182547285596e-02   +1.130613898391778e-01   +2.117752274335706e-01; -5.592258479890502e-02   -1.196027666131098e-01   -9.777415969502054e-02   -2.268214188895553e-02   +2.071734281695014e-01   +1.006030268423109e-01   +6.771607683719144e-02   +9.469385900834258e-02; -8.735850656113682e-02   -1.604920016186602e-01   +3.132048777886289e-01   +1.552136775543604e-01   -1.436698867780966e-01   +1.020945419802785e-01   +2.240105936976904e-01   +9.670401929098976e-02; +4.708577566462617e-02   +2.270041237549245e-01   +2.617178313680860e-01   -5.173021913008655e-03   -4.370654423516085e-02   +2.247428029194109e-01   +5.374220461852653e-02   +2.002350270923152e-01; +1.908170978796025e-01   +1.798206063183435e-01   -4.902419136754994e-02   -9.789857884509444e-02   +5.204615659211852e-02   -3.624468308970906e-02   +1.224685384440027e-01   +2.260827065443732e-01; +2.337932968381998e-02   +8.376816658848059e-02   +6.065478248523939e-02   +9.469981602722211e-02   -1.236138455253615e-02   +3.199754544151256e-02   +4.681928647317007e-02   +3.765347726661644e-01; +2.378823324033114e-01   +3.937984561218466e-03   +1.320532065327263e-01   -7.574608507648734e-02   +1.453569510252871e-01   +8.845311241571123e-02   -6.044121162527349e-02   +6.941763712239767e-02; +1.195623703604506e-01   -5.015458121008197e-02   +9.875972635258597e-02   +2.148787931655831e-01   +1.364483679543710e-01   +1.712948999073040e-01   +7.665651685385595e-02   +1.729380936728404e-01];
L3I_L3E_iAMPA_netcon = [+2.237931690222516e-01   +8.089378681722742e-03   +1.624718729637944e-01   +2.439953777457425e-02   +8.777779021318720e-02   +8.372510467746266e-02   +3.599727310686661e-02   +2.950406071544031e-02   +2.209859806385004e-01   -1.084209908459609e-01   -7.826769582096627e-02   +1.255752619971011e-03; +4.159324080439288e-02   -1.101640757066603e-01   +9.775173764740276e-02   +1.495584007424589e-01   -1.298186235326925e-01   -1.301324198399446e-01   +5.297986215765269e-02   +1.416930976975900e-01   +1.863028470784707e-01   +3.221097634142214e-02   +6.103253825409782e-02   -7.744476651986973e-02; +2.054266871442944e-01   +2.735092675095045e-01   +7.869254069929767e-02   -3.314494265096837e-02   +1.738877018404906e-02   +1.110086090498830e-01   +3.335689219847443e-01   +4.446204855276877e-02   +2.439163017606157e-02   +4.026035341254039e-02   +2.353489117526186e-01   +1.186396868732996e-01; +2.688223756134557e-01   -1.854769864585155e-02   +3.571075200418061e-02   +8.935455062778580e-02   +2.320375906761073e-02   +1.578178695395875e-01   -2.916806053103526e-02   +1.244792731002790e-01   +3.982352134124715e-01   -2.042857555698347e-02   +1.703584554828011e-01   +1.050974260116689e-01; +2.634999664510517e-01   -3.915089881008443e-02   +5.317609939002324e-02   +7.364925555091416e-02   +6.084208562366257e-02   -2.777304945366615e-02   +2.312889221439386e-01   +3.633116215340279e-02   +2.006841839308564e-01   -6.119601094140616e-02   -9.511384432600856e-03   +2.205803731960693e-01; -1.697394224788109e-01   +1.128760633093718e-01   +9.019513818597610e-02   +2.569206455998523e-01   +1.636080302287633e-02   -7.041251594734696e-02   +1.293829058823706e-02   +1.310879583342913e-01   +1.777163655282988e-02   +1.212777854220556e-02   +1.303606858351493e-01   +6.976549734127641e-02; +2.031242609798766e-01   +2.816495931040140e-01   +1.617730164828406e-01   +1.703350906052624e-01   +8.145818450711922e-02   +2.160779952934182e-02   +8.106021602123410e-02   +2.838852870259697e-02   +1.314429253624993e-01   +7.162791665494952e-02   +5.238676467682343e-02   -5.202511213407957e-02; +2.041213549314567e-01   +9.560357154125158e-02   +9.510021228125018e-02   -6.186835127475508e-02   +8.872750341061109e-02   +2.971880313661180e-01   +5.361795767445173e-02   +1.111918523645548e-01   +7.779728827927819e-02   -4.274628824580089e-02   +7.751858783816441e-02   +1.926166668883504e-01; +1.272021357287164e-01   +1.939694389722380e-02   +2.503800654460345e-01   +2.176114033205861e-03   +7.380978762099037e-02   -7.711096541025550e-02   +4.176512372156799e-01   +2.335908572434754e-01   -1.107606990805450e-01   +1.493052229717137e-01   +1.001903023710080e-01   +2.039462749057643e-01; +8.613465766470317e-03   +9.148369754202202e-03   +1.668618122441900e-01   -1.429434754351161e-02   +1.510322498779236e-01   -1.249157768839964e-01   +2.958598761973146e-01   +1.978381601641008e-01   +3.120511859838498e-03   -1.374233449063131e-01   +1.090309389416388e-02   -8.216106780749248e-02; -4.487870889846240e-02   +2.042068202155026e-01   -1.191811700725533e-01   +8.756916278329016e-03   +5.034973623199131e-02   -2.612592134359651e-01   +1.215166692709325e-01   +9.390719937818988e-03   -8.633025992577471e-02   -2.380285776096879e-02   +1.705989879352682e-02   +2.861035951022898e-01; +1.385610332185911e-01   -2.082623890436254e-02   +4.548262044902621e-02   +1.275143902408744e-02   +1.840676450544904e-01   +7.058903298184391e-02   +1.840979701824000e-02   -3.294043643565323e-03   +3.646080556508836e-02   +4.396771140095510e-02   -7.945284137907868e-02   +1.691029253450585e-01];
L3E_L3I_iGABA_netcon = [+1.096319370161657e-01   -1.317085379017720e-01   -7.644325706125754e-02   +1.945135842439293e-01   -5.256296751967664e-02   +1.197060798400576e-01   +3.016279729738025e-01   -1.785781980335315e-01   -1.722602509178078e-01   +7.906039076323743e-02   +7.584431458351977e-02   -1.068717201634743e-01; +2.498272242247732e-01   +1.811285607485971e-01   -1.790925507075131e-02   +1.867448142415818e-01   +1.705746034803402e-01   +4.264400432419203e-02   +1.683790668225870e-01   -1.165715891739474e-02   +1.726357096158383e-01   +7.313778880959207e-02   +1.078609568179985e-01   +9.041042740571328e-02; +1.803427436027025e-01   +1.864586409172934e-01   +2.525971453804030e-01   -9.760004693762590e-03   -6.502162968463088e-02   -3.123057040995005e-02   +1.674637690153757e-01   +2.495097242794518e-01   +1.120666019401295e-01   +7.170005161467088e-02   +1.398498575504092e-01   +1.416336118762677e-01; +2.030910873182264e-01   +9.968405258053074e-02   +1.366269504403551e-02   -9.738223420285887e-02   -1.041941283427479e-01   +1.552046069990659e-01   -2.131547256115628e-02   +4.979605947911568e-02   +2.200594008551605e-01   +1.048210370542104e-01   -3.415859527166089e-03   -4.485151654460189e-02; +1.424778959645653e-01   +2.729871561644653e-01   +1.258195756901076e-02   +1.287820363714337e-01   +1.515954752103483e-02   +1.942349323226985e-01   +8.348322484261943e-02   +1.380352107241190e-01   +9.853744351471555e-02   +1.394184092630399e-01   -5.506115015799944e-02   -1.026956118981421e-01; +2.906807792936042e-02   -2.954641862018176e-02   -1.943040635072325e-02   +1.153253129823619e-01   -1.342343617203968e-01   +2.366904414524206e-01   +2.147418343121664e-01   +2.182828449182755e-01   +2.379920366956333e-01   +2.002789301345989e-01   +1.975575167943109e-01   +7.116780436667122e-02; +8.365850705546247e-02   -2.647458741306137e-02   +2.086686253164682e-02   -4.493052908427534e-02   -4.258308102419919e-02   +1.011329294381804e-01   +2.069977676502641e-01   -3.616924210938963e-02   +1.937977948410995e-01   +1.788202777583084e-03   +1.846317640044275e-01   +1.523679082073663e-01; +8.011692372347695e-02   +1.962598417938303e-01   +1.875039057806205e-01   +9.200994242188593e-02   +5.298009212621254e-02   +2.171158177887962e-01   +7.620507640986905e-02   +2.557662865912994e-01   +2.540227395325112e-01   +3.054155440539403e-02   +1.642437224865477e-01   +1.627669243456638e-02; +9.056236448523300e-02   +5.493263330617262e-02   +4.216683467071909e-02   +2.288904895006900e-01   -2.624292920882332e-02   +1.208388749087499e-01   -3.492113701722641e-02   -1.582329851912042e-01   +1.632862546119442e-01   +2.989164656128186e-01   -1.592575355994943e-01   +5.771064581580034e-02; -4.128727483685785e-02   +9.589045701887028e-02   +1.492565152859149e-01   +3.477642784390916e-04   -5.217852620117344e-02   -4.828110633389684e-02   +1.268517113022111e-01   -4.762500478153933e-02   -1.575018096075594e-01   +1.402733830695073e-01   -4.440265475487728e-03   -4.887802096039229e-03; +5.798083448947969e-02   +9.665344450859403e-02   -2.001922353125236e-02   +1.598880672850636e-01   +2.581916722664569e-01   +2.928018224805760e-02   +2.169689271013410e-01   +5.750733897431930e-02   +3.716448341203085e-02   +2.158067926950401e-01   +1.319488715178831e-02   +6.384498454005424e-02; +1.126686112879332e-01   +2.186372133990540e-01   +7.953108775588473e-02   +1.401253457473827e-01   -4.985974992247177e-03   -1.667381402686905e-01   +3.545015741671681e-03   -1.004809637675882e-01   +1.945932368863166e-01   +4.562906385109704e-02   -1.483436011501996e-01   +3.852409065246570e-02];
L2E_Input1_iAMPA_netcon = [+1.628715120662878e-01   +2.116688624172552e-02   +1.058168110915094e-01   -2.787607507629947e-02   +7.134731494409408e-02   +2.553887046460319e-01   +1.076184111232891e-01   +1.636056656673541e-02];
L2I_Input2_iAMPA_netcon = [-1.142867318693158e-02   +1.536552133196197e-01   -5.517493438988604e-02   -1.324530738860707e-02   +5.779099131040814e-02   +3.558754309098117e-01   -3.248700060576709e-02   -8.197346167757244e-02];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.3*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))*0.9 + 0.9*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.3*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))*1.0 + 0.9*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.3*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))*1.0 + 0.9*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.3*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))*0.9 + 0.9*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.3*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))*1.0 + 0.9*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.3*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))*1.0 + 0.9*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
