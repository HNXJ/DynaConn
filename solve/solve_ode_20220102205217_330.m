function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-2.429924004738813e-01   -3.170856505536830e-01   +2.944859471193300e-01   +2.884043672410355e-01   +3.928637630736959e-02   +1.483042447398249e-01   -6.846517427175070e-01   +3.393047910087371e-01   +6.147742157453080e-01   +5.211891428649632e-01   +2.538803503444619e-01   +1.811853188181909e-01   +2.784320637058437e-01   -2.078781463575593e-01   -2.477393426525180e-01   +2.571856628543208e-01; +7.809938838151428e-01   +1.484635857597758e-01   +5.900620687772618e-02   +4.152390627197521e-02   -1.797512462583185e-01   +6.851967804043749e-01   -6.916672392235869e-01   +5.083941165236590e-03   +4.446382696555339e-01   -1.043260516482372e-01   +5.994799938913700e-01   +4.030860946824507e-01   +4.314538340427034e-01   +4.771749288271001e-03   +1.804960948859946e-01   -6.396292194532047e-02; +5.150168263779260e-01   +1.720673777747013e-01   -9.391429886109573e-02   +2.950227551341977e-01   -2.475748199535634e-02   +3.110269782317676e-01   +3.746908226611858e-01   -9.271324113077045e-02   +3.629371304788902e-01   +4.159447287098936e-01   +3.766322116953178e-01   +3.422252575575183e-01   +1.693114238696602e-01   -3.121637035827689e-01   -2.927961970069456e-01   -7.428202555785637e-02; +1.545312845015107e-02   -8.009786584474504e-02   -1.284095239992762e-01   +7.248301147404088e-01   +1.320691622898684e-01   +5.790690796656842e-01   +6.271972236119252e-01   +7.490877215024681e-01   +5.010174224894961e-01   -1.027023709224388e-01   +5.709161909204445e-01   +3.924957257211064e-01   +3.106450337395826e-01   +6.137384845283600e-01   +5.836455286181493e-02   +7.766306992753647e-01; +1.969061528811629e-01   +2.552284849039023e-01   +5.513612496305899e-01   +4.708290894592329e-01   -1.354608881391070e-01   +3.114660193712767e-01   -2.993731348475404e-03   +2.475043478981626e-02   -7.020029193767718e-02   +4.632176797287092e-01   +6.698530018552924e-01   -1.857681708452987e-01   +5.991135168501949e-01   +1.387310779978074e-01   +3.205471888715598e-01   +1.851209137742568e-01; +8.801833529656510e-02   +6.507666988556249e-01   +2.833911923376657e-01   -1.378939153006019e-01   +4.619913033687031e-01   +3.116081314049446e-01   +4.993767947707284e-01   -2.001653943752484e-01   +4.946549849676303e-01   +2.301017576434668e-01   +4.356922468374377e-01   -4.061502691510524e-01   +1.772012235902516e-01   +3.505587404406024e-01   -9.249938345729571e-02   -5.588450381265011e-01; +3.044607873328883e-01   +3.301773578830133e-01   +5.722587266890450e-01   +3.397158261084137e-01   -7.948929392480152e-02   +4.008866821926547e-01   +2.376545487324165e-01   +1.045771609311195e-01   -7.234232938286709e-01   +1.851226156931988e-01   -1.070394972320665e-01   +2.625987383032081e-01   +3.794850590325392e-01   -2.697995139013952e-01   +3.902953347116319e-01   +6.998953763630655e-01; +6.335856623815384e-01   +3.549736236275523e-01   -1.162738764028702e-01   +2.466914258795607e-01   +2.049644081564326e-01   -2.187663023477458e-01   +2.131589328566780e-01   +5.188640382984676e-01   +3.902474023067592e-01   +1.395366966019257e-01   +5.437842178400176e-01   +8.136401491861553e-02   -2.850642734722058e-03   +2.618823718813841e-01   -1.231091148360413e-01   +3.466844286582123e-01; +3.894574648574944e-02   +5.467976168787857e-01   -2.131920273662972e-01   +1.632096675548514e-01   +2.694711994274289e-01   +5.835007478294637e-01   -1.152191795728387e-01   -3.412125769948056e-01   +3.498113908776934e-01   +1.770600836736075e-01   +6.878739543649410e-01   -8.738395481266006e-02   +3.261169684599591e-01   +4.083366775765521e-01   +1.883416626178489e-01   -2.401536497923621e-01; +3.178017393113312e-01   +6.480415786264956e-01   +4.213623313146134e-01   +2.523580156861889e-01   +1.935471108558378e-01   +2.497550400006844e-01   +5.482038944439014e-01   -1.323132926873735e-01   +2.094983463740434e-01   +2.612961388173793e-01   +8.072581635214674e-01   +4.480341186281723e-02   +5.604976516516444e-01   -2.692370153876856e-02   +1.520472883605452e-01   +3.566863648453176e-01; +1.534095807237514e-01   +7.538173996946822e-01   -1.306159082814089e-01   +2.559970118865059e-01   +7.969650788353022e-01   +1.271752290829828e-01   +1.689284774572632e-01   +5.343654461214722e-02   -5.731183654983251e-02   +5.651381965817939e-01   -4.478855956509150e-01   +1.245763292013851e-01   -5.776945916629002e-01   +1.898791774772668e-01   +4.197809984561842e-01   +2.499241213896119e-01; +2.906280626238320e-01   +2.677002219680561e-01   +2.429429446631392e-01   -1.830870733127773e-02   -5.120674755656310e-02   +2.055078917659835e-01   +4.257185890674845e-01   +3.348490795519314e-01   +5.540305034131735e-01   -1.301833681690188e-01   +4.524761559181255e-01   +7.527377807662070e-01   +7.586996670425643e-01   -1.423273889216378e-02   -1.987766840657173e-01   +1.994905648008624e-04; +8.718807366841246e-02   +2.344464563408221e-01   +4.075607850086931e-01   +6.652709600436878e-02   +9.104315806721405e-01   +4.990305066264636e-01   +1.598044986252150e-01   +1.306823001622023e-01   +6.044656821104852e-01   +2.577624117678028e-01   +4.392102202819806e-01   +5.724065520097477e-01   -3.192911504832517e-01   -3.165310822303573e-03   +3.215311429592270e-01   -2.120545148346293e-01; +1.306731548761317e-02   +2.725130640692132e-01   +2.583037742197949e-01   -5.683655275941175e-01   +2.380608082599040e-01   +4.697993493025781e-01   +1.174531938336130e-01   +4.890449608437724e-01   -1.575870090448823e-01   +1.703964240461535e-03   +5.276858853729911e-01   -2.033217533689536e-01   +4.666558052326259e-02   +7.482648685787322e-01   -2.249487837644493e-01   -2.590151361686148e-01; +6.534998842556247e-01   -2.303410079433561e-01   +5.908013818144952e-01   +4.705088179670160e-01   -2.947818834978159e-01   -3.574032247212997e-02   +4.006626659168654e-01   -1.667522347039994e-01   +1.311879736049027e-01   -1.799747218058672e-01   -1.960062668640869e-01   +1.327083536002520e-01   +5.669179376770901e-01   +1.494570925313603e-01   +2.391558653184392e-01   -3.279357602925264e-01; -7.213780309887668e-01   +3.855770837291732e-01   -1.119460293949188e-01   +4.315889399998553e-01   +7.196833074746878e-01   +6.339506074533351e-01   +3.425033757629227e-02   +8.316222868485816e-01   -2.888135106112919e-02   +5.665011473775339e-01   +5.623999174488356e-01   +3.927373808655922e-01   +2.514203989852654e-01   +4.076008233967812e-01   +6.412870731636172e-01   +1.302729021224610e-02];
L1E_L1I_iGABA_netcon = [+1.885892095981055e-02   +3.366366159511788e-01   -5.274029010459953e-01   -4.427918095750599e-02   +7.512876147693127e-01   -2.018112620651386e-01   +5.189426882594617e-01   +3.187166548385088e-01   +7.982028763671681e-02   -2.129831792922452e-01   +1.953977799631152e-01   +1.231922411913245e-01   +8.000810432103261e-01   -3.899275527315868e-01   +3.050967051139375e-01   +9.344117319271434e-01; -4.036204055237540e-01   -1.958850810312849e-01   +5.421656769528589e-01   -3.922417810558958e-01   +2.787335090713128e-01   -3.821206863726252e-01   +2.724622047451626e-01   +4.992227314955628e-01   +3.484331127285373e-01   -7.024163363436584e-02   +4.446687826949456e-01   -2.411214747927184e-02   +6.305355460289198e-01   +2.088596829201580e-01   +3.860991187381595e-01   -9.352867575973900e-02; -1.628699100045731e-01   +3.724466973161284e-01   -3.480536224704224e-01   +3.951891015236634e-01   -3.013814579041251e-01   -8.748851000237338e-02   -1.901370241303392e-02   +3.856012821312474e-02   -5.913758363967052e-02   +2.163584167855177e-01   +1.479132883039883e-01   +1.971410915605077e-01   +1.221964356670561e-01   -1.645231938002399e-01   +6.080314608037258e-01   +9.769550148063999e-02; +5.393062597431396e-01   -3.911083619876937e-01   -1.616798856039193e-01   +1.206053287101101e-01   +1.041873802461956e-02   +4.052447388419210e-01   -8.343936297825875e-02   -1.406988910154002e-02   +1.087056412663375e-01   +1.366127810125566e-01   +2.517859073079611e-01   +2.834888603817323e-01   -2.531955027456818e-01   +3.397927338369227e-01   -1.698175170753734e-02   -2.071884995399979e-01; -1.562444025901966e-01   -8.348903776385924e-02   +6.368869535910733e-02   +3.259970078819093e-01   +4.579914000132798e-01   -1.788326769200740e-01   +2.524655363070367e-01   -5.045187749712977e-01   +2.339503525044402e-02   +1.794657007134023e-01   -3.477220264546139e-01   +5.184559954262185e-01   +3.509084817668565e-01   +4.608316533398321e-01   +2.192145659665382e-02   +2.101135013172456e-01; +5.066617342994484e-02   +2.017747343357028e-01   +1.603445455501460e-01   -3.916121951611510e-01   -3.410114980669681e-01   +6.031008343657898e-01   +3.744267982790573e-02   -2.585177577794531e-01   -1.658034865120752e-01   +4.966054455839330e-02   -3.836733012324519e-01   +6.503103332038825e-01   -8.565704926936174e-02   -2.840664802916235e-01   +2.758432511390354e-01   +9.609775053116304e-02; -2.510593982023293e-01   -2.322544923787897e-02   -3.682431920674797e-01   -2.841108143348713e-01   +4.635932863655663e-01   +4.925338809198258e-02   +3.055183851363989e-01   -2.678533616024524e-01   +6.118680057015156e-02   +3.172350621662879e-01   +6.749797657480551e-01   +1.191420115421160e-01   +2.038326980093428e-01   +5.425114293839858e-02   +7.630142680868479e-01   -2.602012521378399e-01; +1.169493279700440e-01   +3.054813148324462e-01   -1.180328391102275e-01   +1.919045818402728e-02   +2.711319200388392e-02   -2.442215683890718e-01   +7.771123909461259e-01   +1.288935989102718e-01   +4.766916521912177e-01   +2.072792340756489e-01   +1.908349445533637e-01   -9.066948288101141e-02   +5.613377698725048e-01   +4.320549602840654e-01   +3.132725714055662e-01   +5.132267430567844e-01; +6.335486637138024e-01   +6.182476492628595e-01   +1.071507957244053e-01   -1.516818873339969e-01   -3.614416763608742e-01   +3.925734478755717e-01   -1.942392426388100e-01   +1.406457586860342e-02   +6.978527810733718e-03   -8.878124604678211e-02   +1.775226608952601e-01   -2.311675820862879e-01   -1.031577283932480e-01   -4.113544611543916e-02   +5.175200863996189e-01   -3.230514893027937e-01; +1.715716614760709e-01   +5.323778930057587e-01   +4.348407211732416e-02   -1.513273896520057e-01   -3.011010224699361e-01   +5.691043438097573e-02   -6.092087366360006e-02   -7.973293680534799e-02   +4.978971891879539e-01   +2.376955492798351e-01   -5.158571723465982e-01   -1.671448881380231e-01   +3.184213341513284e-01   +4.580388684374638e-01   +1.958743711159794e-01   +3.440113807941241e-01; +3.003767391092949e-01   +4.357661690772159e-02   +1.072618762244898e-01   +5.967366739714406e-01   +3.235254423709948e-01   -4.391373182625416e-02   +1.609644358004814e-01   -1.085120763679086e-01   +4.574937946553284e-01   +3.700194364832009e-01   +1.366730063025801e-01   +4.792490448901263e-01   +8.193749298527740e-01   +2.117976248367912e-01   +3.334570227274399e-01   -4.754053227887462e-01; +2.150403305232026e-01   +2.528054386376491e-01   +6.470446213461606e-02   -5.912780272741524e-01   -1.592073441563893e-01   +2.300613743657912e-01   -6.779837056542934e-02   +1.695085359896424e-01   -9.153730213179026e-02   -2.198830095042469e-01   +3.190157658721302e-01   +2.584449333641580e-01   -1.236834430484036e-01   -5.772858884319478e-03   +3.517356902201387e-01   +3.262438337135453e-01; +4.864140030532137e-01   +5.467421674363423e-01   +1.725730616769615e-01   +2.828144749858466e-01   -8.390041663391698e-02   +2.111830354947491e-01   -7.212791625154964e-02   +3.491477205086925e-01   +6.344680853643654e-01   -9.254741340189084e-02   +3.323289527470793e-03   +2.608825306594395e-01   +2.244264784795185e-01   +2.978054501965218e-02   +3.859513890148702e-01   +4.513139732915538e-01; +6.377038608137625e-01   -5.125826358991875e-02   -1.293297951938361e-01   +9.641164746734486e-02   -7.383080175196066e-03   -1.534676035755757e-01   +2.716987181819556e-01   +3.152043094249790e-01   +3.970364758754464e-01   -4.249219132068021e-01   +2.458297185713884e-01   +1.023038214879712e-01   +6.910732707139464e-02   -8.546810526939452e-02   -1.097474911582483e-01   -2.070245130648953e-01; +5.083874148296186e-01   +2.174376397943210e-01   +7.980001264201453e-02   -3.258741959223364e-02   -1.073898115793980e-01   +8.688671023746200e-02   +3.840207947563438e-01   +6.975122839425853e-02   +4.617883987416899e-01   -1.120336696325934e-01   +2.306301441157616e-01   -5.814592584175249e-02   +4.288749737559633e-02   -4.914908042939111e-01   +7.945047432314208e-01   +2.070401449650738e-01; -1.760646114853007e-01   +2.534295306895297e-01   -2.153980239106484e-02   +1.059610300476552e-01   -2.215856121047152e-02   +9.568215998846091e-02   +5.613854649339519e-02   +3.422965247988569e-02   -3.497347353361356e-02   +3.607195581296871e-01   +1.630987961936476e-01   +1.323783422023123e-01   +3.076551778973292e-01   +2.676214102766448e-01   +4.987548220437819e-02   +5.316211130618692e-01];
L2I_L1I_iGABA_netcon = [-1.735296369323107e-01   -1.805758233495073e-01   +1.080029180169395e-01   +2.858137441173076e-01   -1.788177264658832e-01   +2.644167268692571e-01   +3.059734416260647e-01   -2.578879345284433e-01; +3.673999022318583e-01   +6.617006708362699e-01   -1.137872156672586e-01   +1.975682974640731e-01   +6.327593952776345e-01   +5.029757892955825e-01   +1.929603397070933e-01   -2.258010555541808e-02; +7.235149708782650e-01   +2.219339584022239e-01   +2.669209327558903e-01   +1.933492485578811e-01   +4.133123800731073e-01   +8.775556715296286e-02   +3.717525739050452e-02   -3.151483089895015e-03; +4.715877256838322e-01   +1.267377309672456e-01   +8.809475299628458e-01   +2.385283528045180e-01   +4.386389583516971e-01   +4.044569964235023e-01   +4.010216434720767e-01   -3.557459199888548e-02; +1.076513462328244e-01   -1.318338189200725e-01   +4.888714803446726e-01   +3.838447010802113e-01   +3.969199675587620e-01   +1.450517681291227e-02   +1.066219980647662e-01   -1.340410406197775e-01; +7.223992082202087e-02   -3.109904050439136e-01   +1.792280462264052e-01   +2.138347379563546e-01   +1.649947973119581e-02   +3.694697683257909e-01   +3.173609673480345e-01   +6.617174952087587e-01; +5.226571301683055e-01   -6.391764044809971e-02   +3.852655703673630e-01   -3.318250598546576e-02   +2.292850574045704e-01   +6.961206967021331e-01   +5.143139031338556e-01   +3.526666834862336e-01; -9.896359213418178e-02   +5.041019269969659e-01   +1.703287757909106e-01   +2.237217743865512e-01   +2.472371208256888e-01   -3.990299268248707e-02   +5.467042439935468e-02   -6.530201138671881e-03; +2.579340217347617e-01   +9.482805652518729e-01   -7.124260615480108e-01   +3.724126435482082e-01   -1.759374179520218e-02   +3.510412169516890e-01   +2.117992446003647e-01   -2.261593491053160e-02; -7.179842148274966e-02   -6.741624867793126e-03   +1.219288301929618e-01   +2.432690694603699e-01   +7.359314384704517e-01   -1.342029949590081e-01   -3.494170297753954e-02   +5.108660596456600e-01; +9.314534642084005e-02   +1.089443157799867e-01   +3.625035251499845e-01   +1.587873729800874e-01   +1.639012693233344e-01   -8.079353223282627e-02   +1.714213208100326e-01   +1.310363922136530e-01; +4.995301080806258e-01   +3.804342211787274e-01   +2.646027343138135e-01   +1.873497144376926e-01   -1.595194584117349e-01   +2.292681451936439e-01   +5.030063359180337e-01   +6.074942390269120e-01; +4.669375860854218e-01   +3.275639210033178e-01   +4.644431482625010e-01   +6.383176699015106e-02   +3.186866953561144e-01   +6.764275849051032e-02   -7.865723026270498e-02   +2.854340980291746e-01; +2.107340635542505e-01   -1.608372461025815e-01   +8.318985827022918e-02   -3.519973260475332e-01   +3.465957417766555e-01   -1.160837067777860e-01   +4.412705820424067e-01   +1.917701237412966e-01; +3.325283711697706e-01   +4.235156068425025e-02   +3.086025308508228e-01   -3.906309727250875e-02   -1.540727538915964e-01   +1.000000000000000e+00   +4.448529466331489e-01   +6.338410802753891e-01; +2.901730423725778e-02   +1.243006598031492e-01   +1.918732711433160e-01   +4.170831930396223e-01   +2.800550590509504e-01   +1.397009800338459e-01   +1.634064530734526e-01   -1.075692312292021e-01];
L1I_L2I_iGABA_netcon = [+3.614036886364729e-01   -1.692915824166077e-01   -3.683820206104162e-02   +4.089993067949133e-01   +1.254334545795203e-01   +3.060148971267655e-02   -5.538337789692079e-02   +2.176076446117158e-01   -1.311068885993490e-01   +4.882568805795053e-01   -2.345651620992973e-01   +1.618629621735485e-01   +1.221436253901773e-01   +5.178287553006027e-02   -1.335915958464176e-01   +2.223397576188760e-01; +3.638728648034385e-01   -9.886108320911091e-02   +1.464156385540752e-01   -4.308155397336200e-01   +7.551810491676051e-03   +1.315304942599057e-01   +3.021586024032241e-01   +1.501381616271806e-01   +3.188791990968208e-01   +6.728447780416739e-01   +1.998335574702880e-01   -1.937562872010598e-01   -1.624452302044800e-01   -4.362413716586337e-01   +3.986150801202373e-01   +2.906291907084636e-01; +1.566571811159384e-01   -2.703607099678674e-01   +3.663624182660881e-01   -1.011353057939475e-01   +1.649988351577043e-01   -2.055399734896620e-01   +5.828464108270039e-01   +2.640798632934351e-01   -9.120351790687567e-02   -5.518725381805153e-02   -1.785109048415388e-01   +2.221117661879951e-01   +2.377697374694598e-01   +6.375939034511059e-01   +9.113483669761835e-01   +2.045341936680342e-01; +3.858666224748657e-01   +6.617879442174931e-01   +5.489399798141755e-01   +3.373046655964707e-01   +3.679034553741840e-01   +6.734666862321759e-01   +4.737988371919925e-01   +3.035875559548548e-01   -1.038982669191865e-02   +8.589447872321818e-01   +5.762768782720911e-01   +3.373331023548121e-01   +3.687445289106057e-01   +1.027179415332121e-01   +2.992000149883238e-01   +1.278140051916373e-01; -3.852959076370681e-01   +1.718058748964468e-01   -8.203659286306707e-02   +4.658956815042954e-01   -1.054585421244321e-01   +6.576531062033889e-01   +5.850556302486933e-01   +5.088153963844528e-01   +4.485959399902840e-01   +3.568487844283534e-01   -3.058278071945825e-01   +4.612734107170468e-02   -4.857332782733835e-01   +7.146312395925399e-02   +3.125586533739722e-01   +3.832781190312103e-01; +3.504742738868386e-01   +3.566095824801879e-01   -1.553542855027866e-01   +5.084964771524638e-01   +4.397518108362933e-03   +1.656629940700190e-01   +2.934439599661986e-01   -1.357383107121820e-01   +2.874982300793185e-02   -2.715701558543764e-02   +1.172040580478948e-01   -1.250299663406128e-01   +4.981774428812186e-01   +8.760625224479857e-01   +2.090526508343666e-01   +9.123849231408093e-02; +2.235098493666585e-01   +3.112049115968408e-01   -4.443259648899600e-01   +2.688557310308597e-01   +4.012009865174637e-01   -3.781375754373897e-01   +1.871448096328455e-01   -1.765879351480714e-01   -1.947809108645367e-01   -3.827626001741561e-02   +2.729843154041972e-01   +3.009066932808514e-01   +2.741998314479674e-02   +3.418229298943010e-02   +8.485288818154663e-02   +2.801567548061148e-01; +3.468558425736362e-01   +4.401220248961548e-02   -1.812944967379221e-01   +1.699519617910439e-01   +2.495404881440194e-01   +4.949951409645074e-01   +7.371163861900738e-02   +7.679164488133058e-02   -7.882560974089965e-02   +2.596962159408558e-01   +2.872611928648731e-01   +6.561334190814224e-01   +1.217089869510797e-01   -5.485296619355545e-02   +3.863543667701395e-01   +4.320184420851686e-01];
L2E_L1E_iAMPA_netcon = [+4.756913429643988e-01   -1.456138875316813e-01   +1.252651050704608e-01   +3.154501198636518e-01   +8.988775936774726e-01   +5.493736721483641e-01   +4.763569976435650e-01   +3.705140164344556e-01; -8.667299924961780e-02   +2.129837968360164e-01   +1.876110555158466e-02   -1.013621434012237e-01   +3.957947862286187e-01   +3.867793647007066e-01   +3.990661435780486e-01   +2.573559337942042e-01; +3.375519911609033e-01   +4.127237863341823e-01   +1.950264627289056e-01   +8.916910884381608e-02   -5.914809240046402e-02   -2.463129383874040e-01   +2.034291337090472e-02   +3.883751011178106e-01; +5.235154152327574e-01   -2.417853735448687e-02   -2.965876641744987e-01   +3.887082558166334e-01   +2.304000549804157e-02   +3.545968536242035e-01   -3.449540337832506e-01   -5.688511315535506e-02; +3.769523667140760e-02   -2.285603355924841e-02   +4.971569975099119e-01   -2.317504759830299e-01   -2.313458614334476e-01   +2.581754420060174e-02   +5.873173774879000e-02   +1.953663101540898e-01; +3.716147853840291e-01   -2.469583310172033e-01   +1.038359419447073e-01   +1.060215247327444e-01   +1.366924674321695e-01   +6.562590652453351e-01   +3.070642485693595e-01   +4.277490005548714e-01; -2.669992311710821e-02   +5.064297291712967e-01   +1.689869934114069e-01   -1.221005361130789e-01   -1.295229405426091e-01   +3.771842652512578e-01   +6.826205611170056e-01   -3.477738758387736e-01; +2.096354481028481e-01   +4.899517417146521e-01   +1.000000000000000e+00   +3.089834755506326e-01   -1.741103861010886e-01   +3.984553284623680e-01   +3.863793316624772e-01   +2.747856781721013e-01; +3.919405484374698e-01   -1.056228397577636e-01   +3.894284781466815e-01   +6.131345143007298e-01   -3.261910056351135e-01   +6.214932134464846e-01   +5.503649948585391e-01   -1.810112817466080e-01; -8.998796824857874e-02   +2.973860592568528e-01   +3.273093544011909e-01   +8.050938834883867e-02   +1.311881910532209e-01   -1.299383066061601e-01   -7.516649647043300e-02   +2.199186166639872e-01; -8.128097350712413e-02   +6.184050810398820e-01   +7.399219576333590e-01   -1.154358905752139e-01   -8.380939872949793e-02   -1.860527602547556e-01   +1.156857366446997e-01   +2.126526704315187e-01; +1.009322442880531e-02   +2.605422780734569e-03   +5.147220720963719e-01   +9.737111183461218e-02   -3.259047004457898e-01   +2.434973338211175e-01   -1.791568202181210e-01   -9.428559892324402e-02; -4.179718606554326e-02   +3.849697981665864e-01   +1.820664607604231e-01   -3.016767897381374e-01   +7.145194436638167e-01   -3.017669798135980e-01   +4.862344515364446e-01   -2.127054924936378e-01; -4.782501188662070e-02   +6.913253387818780e-01   -2.910811734119116e-01   +1.258122628760192e-01   +3.177271434291375e-01   +3.975694166394336e-01   -2.607771952290993e-01   +9.795745741700650e-02; +7.922697305344155e-02   -1.644921486903496e-02   -3.282007072505684e-02   +2.958709303188265e-01   +1.829592437612381e-01   -2.057387826962560e-01   -2.404215288497773e-01   +4.776779976815688e-02; +2.017717971595648e-01   -1.118299285606525e-01   -4.909226512858649e-01   -1.538821270795115e-02   +2.757980669824565e-01   +3.915767175045962e-01   +5.128438445111464e-01   +1.039281960436878e-01];
L1E_L2E_iAMPA_netcon = [+3.080391661820281e-01   +3.037774221251697e-01   +1.660748512525614e-01   -1.932883059868690e-01   +3.160710320114172e-01   +1.894416473349372e-01   +1.280034157797045e-01   +8.985628966927722e-02   -1.003965467228284e-01   -9.795377027161026e-02   +4.017160979519515e-01   +1.559705815941836e-02   +2.141877716689160e-01   -8.023749179052415e-02   -3.783510393687390e-01   -4.883602645892571e-02; +2.507207128042941e-01   -3.207932363919834e-01   +6.482413496760254e-01   -1.212151439702163e-02   +1.160060684632250e-01   +2.120566008484853e-01   +5.452454248581029e-01   +1.044372932483748e-01   -2.136398323823881e-01   +1.193344313722849e-01   +2.763384253235937e-01   +6.112866786495711e-01   +4.842907439296381e-01   +2.219926645083287e-01   +1.140992455541211e-01   -1.832363329813972e-01; +7.443876789557909e-01   +1.271061828766742e-01   +9.655623749635187e-02   -9.719116088690929e-04   +1.998402602110079e-01   +4.051514948621808e-01   +8.746756058785680e-02   +3.181178212384211e-01   -4.187088572040657e-02   -4.122849458619983e-01   +7.104789025600904e-02   +5.752388786504880e-01   -1.018352125274384e-01   +4.220040393737889e-01   -1.428029230561755e-01   -1.277387856650575e-03; +1.442684419252637e-01   +8.277242346691883e-02   +3.652728534895685e-02   +9.009681741059672e-02   -3.663105541220006e-03   +6.758869446682028e-01   +9.878808505864044e-01   -1.194253979823002e-01   -1.176800576792968e-01   +4.879841165355597e-01   +2.901124728967560e-01   -3.540533767766125e-01   -3.033723606816157e-01   +7.581182923445642e-01   +2.450858784232040e-01   -2.159511674084550e-01; -1.327756356397019e-01   -3.800396105668492e-01   +2.293865441332599e-01   +7.789921708640096e-02   +2.151618814582586e-01   +1.657378903298629e-01   +2.505259556433581e-01   +2.435011767133529e-01   +3.151777839106050e-01   -5.629161096122373e-02   +7.482951316925447e-02   -4.164627287514553e-01   +2.409857229526824e-01   +1.102768275758938e-01   +3.873150871875056e-01   -1.377777367894848e-01; +1.831504805971498e-01   +5.190343561925523e-01   +1.777174636806307e-01   +5.215638451695410e-01   -1.454779589314099e-02   -1.923992337258279e-02   +8.365767012537908e-01   -6.526279619820825e-02   +2.235844538702009e-01   -1.610301652723831e-01   +3.715075498877751e-01   -1.036374864285123e-01   -2.045864246709135e-01   -1.177129031430384e-01   -1.509204029095948e-01   +4.689143607697797e-01; +1.397631016675981e-01   +3.576323432004078e-01   -1.764002766737583e-02   +3.193846405721116e-01   +3.777115162087409e-01   +2.119858568211815e-01   +2.959871388176722e-01   -3.491236724011683e-01   -2.555472915432898e-01   +1.995307773612088e-01   -5.960650166862307e-02   +5.111667631872760e-03   -2.742561681938223e-01   +5.345891297386381e-01   +6.222885830257715e-01   +2.735025411193402e-01; +3.256448560418078e-01   +4.408799612750320e-01   +4.293668183958645e-01   +4.984884347129699e-01   +1.778669610827801e-01   +4.977060142593649e-01   +4.489713830620505e-01   +1.669156668832300e-01   +4.852542445615597e-01   -5.528519889822421e-02   -1.519246639333653e-01   -1.403703041394722e-01   -5.651808531834581e-01   +2.288578955130087e-01   +2.674502294324389e-01   +3.814862764185605e-01];
L2I_L2E_iAMPA_netcon = [+7.811473776016065e-02   +5.202839013901992e-01   +2.796314547361799e-01   +1.173014062379632e-02   -3.569282024561671e-02   +4.985087789727158e-01   +1.929605088423432e-01   +5.755103499701064e-01; +6.184721845235512e-01   +8.295305825261841e-02   +5.780273937719682e-01   +5.966511108515883e-01   +3.016057828470219e-01   +8.509014646461946e-02   +9.886404919292507e-02   +1.497501382884642e-01; -1.268814697842282e-01   +3.060344005606798e-01   -2.257911499045774e-01   +1.971405652721103e-01   +4.630562870285655e-02   -4.930237599987320e-02   +2.534883895763264e-01   +1.899016878272967e-01; +2.923410290753681e-01   +1.042105870229737e-01   -3.505885620927940e-01   +2.583368812289977e-01   +5.677066184089070e-01   -1.771043045090290e-01   +4.266670872775769e-01   +1.525924874459450e-01; +3.712419963972553e-01   -8.782856830736928e-02   +2.162348815697581e-01   +5.661694736591817e-01   +6.041343740702393e-01   -1.817386379720909e-01   +3.819714681276819e-01   -7.056152715372438e-03; +5.789429712553407e-01   +1.800361437454930e-01   -1.476511122847804e-01   +5.525152168144249e-01   -6.992323778511550e-02   +1.935506066157012e-01   +3.111437770812966e-01   -4.426474391020552e-02; +4.311448546552453e-01   -5.268192883683335e-01   +3.097113467027185e-01   +4.998227482044904e-01   +1.775528743931840e-01   -2.767143252767084e-01   +7.673582532297160e-01   -2.800800408569539e-01; +2.742171506378838e-01   -9.253764400027251e-02   -5.617981751826181e-01   +2.919881775495359e-01   +7.966438855054103e-02   -1.968297448362547e-01   -1.048504444444545e-01   +7.166184298262279e-01];
L2E_L2I_iGABA_netcon = [+8.342515803366279e-02   +3.193236577443434e-01   +2.335281834847252e-01   -5.133911971125303e-01   -2.727296512586812e-01   +6.195741621801889e-05   -2.849995484156689e-01   +6.009533564638746e-01; +1.739858125551559e-01   +2.808051260167195e-01   +1.130948368380060e-01   +8.792856942080739e-01   +6.916083015526061e-01   +1.851870367260489e-01   -5.384282278071958e-01   +2.858404214032579e-01; +2.995037807944214e-01   +7.765900282912872e-01   -4.328491251726310e-01   -3.737045845355379e-01   +1.560854293758804e-01   +7.402603383783644e-01   +2.815650848603692e-01   +1.326348963161118e-01; +1.270815133201909e-01   +6.308690971746883e-01   -2.233653357090482e-02   +6.245714188199060e-01   +8.550968361439448e-01   -3.944633556625826e-01   -2.706796737084217e-01   -5.790417715764709e-02; -1.323856587444604e-01   -2.659181407999513e-01   -1.809019461640587e-01   +2.947525047672895e-01   +7.609991527834136e-01   +5.091761589464922e-01   +1.273186337706233e-01   +1.314841690139458e-01; +7.898731385807352e-01   +5.698137423522078e-01   +3.477269567242063e-01   +6.187823918136970e-01   +5.560635549574297e-01   -4.857801641294561e-01   +4.333017634162273e-01   -3.132228687426932e-01; +2.859896744816339e-01   +1.592479057665076e-02   -3.424260337980599e-01   +3.130819190484552e-03   +2.430201813665134e-01   -4.707118961790758e-01   +4.686516505494306e-02   +7.842873698744265e-01; +9.404812879204560e-02   +4.963176310566304e-01   +5.091328017830888e-01   +2.085445557142803e-01   +2.731613644371238e-01   +5.156084208089112e-01   +4.366354291357926e-01   +7.353633962264265e-01];
L3E_L2E_iAMPA_netcon = [+5.121420753520777e-01   -1.921490067947188e-01   -2.066795481177088e-01   +2.473504849595021e-01   +4.288341717550971e-01   +5.427660438222124e-01   -1.681869788788463e-01   +5.580944934683941e-01   +3.499674673672246e-01   +1.941154616281457e-01   +1.655320638847896e-01   -5.750618779227877e-01; +4.595865957282998e-02   +2.996367661077575e-01   +2.168730261190921e-01   -1.404117726756825e-01   -3.730310222126791e-02   -1.077890220038294e-01   -3.524544257277079e-01   +6.836541822224941e-02   +2.181186956888985e-01   +2.161671442687588e-01   -2.479985624272273e-01   +5.688430155706531e-01; -4.981903222553876e-01   -4.483638803154117e-01   +4.420780462251014e-01   +4.171499730181016e-01   +2.444195909215369e-01   +1.011330066873372e-02   +1.063907473697581e-01   +3.061230690512365e-01   +6.388395856402881e-01   -4.585324554409949e-01   +1.000000000000000e+00   +3.417314271705760e-01; +3.477420004540169e-01   +2.091789803715610e-01   +2.134276317996161e-01   +1.067136728491223e-01   +3.427825312239738e-01   +1.178211049055357e-01   -1.993455908570764e-02   +6.285259160934666e-01   +1.959452894223516e-01   -1.930581910844359e-01   -2.141401447054895e-01   +5.277541888312284e-01; +1.184527279088211e-01   +3.734820112400540e-01   +2.851536265784648e-01   +5.571746002839910e-01   +5.388635571739772e-01   +5.800225455065605e-01   -2.242562315615551e-02   +1.052806798999449e-01   -1.221852231307169e-01   +4.531274281656561e-01   +3.727409108773063e-01   +4.400604682068812e-01; +4.564157327489396e-01   -2.268101028816095e-01   +5.984028851840680e-02   -2.240529244089016e-02   +3.980115997824302e-01   +5.778332095512652e-01   -4.339622393654655e-01   -2.397684833326965e-01   +1.432966265065256e-01   +2.964560244539192e-01   -1.158561990531627e-01   -3.811255838272706e-01; +1.899370355423378e-01   +2.036864253930911e-01   +2.584973020274055e-01   -8.709792827291406e-02   +2.402351704203377e-01   +2.595453293124534e-01   +1.107166743870940e-01   +3.549202342420910e-01   +5.540370910535553e-02   +4.329944222726128e-01   -1.652783786551156e-01   +4.361862853850162e-01; -9.301210659817306e-03   +5.857102374747315e-01   +1.359007279198724e-01   -6.532007332039252e-01   +5.342090276488968e-01   -2.225797231667442e-01   -4.602904837101561e-01   -2.357740366928163e-01   +2.597800803799790e-01   +1.842598523089091e-01   +6.296218512971603e-02   -5.849544773843809e-02];
L3I_L2I_iGABA_netcon = [+9.323131162595556e-01   +6.170961467357085e-01   -4.117789154167200e-02   +4.218045810305021e-01   -3.938920600809108e-01   -6.600689973120209e-02   +9.597858076376701e-01   +6.474728530271195e-01   +4.898424398549712e-01   +4.970709018919198e-02   +1.202855940334946e-01   -2.114214175313663e-03; +4.006200262058654e-02   +1.247229401681617e-01   +1.540636782989727e-01   -3.521514812286342e-01   +5.527977020361524e-01   +4.180731422618647e-02   +7.098344392619295e-02   +1.103151914143945e-01   +4.710153437845407e-02   -1.036818018874482e-01   +4.860286020700395e-02   +4.191160217951209e-02; +1.796591764954214e-02   +1.955551518071489e-01   +1.160015801775124e-01   -2.008075255741850e-01   -4.108050442194748e-02   +3.613875037712626e-01   +2.218657321264457e-01   +1.724702495160681e-01   +2.225582757283338e-01   -3.770334452922149e-02   +5.061488320440382e-03   +8.612942095036046e-01; +4.313219283269475e-01   +1.090985628574098e-01   +7.291775786414041e-01   +2.770926101145109e-02   +2.602439864928726e-01   -1.860574286913421e-01   +2.083335960222216e-01   -7.353423472956976e-02   +3.136028505775353e-01   +5.795083411404016e-01   +5.602845252089952e-01   -1.327022259668292e-01; +5.007379111653856e-01   +3.316489645614143e-01   +1.389099553208246e-01   -2.839480030429110e-02   +4.623547826738017e-01   +6.121022229162228e-01   +2.478922117888268e-02   +6.298963918289164e-01   +5.770621974888916e-01   +1.722164905353687e-01   +3.223676102424644e-01   +9.169732336425160e-02; -3.324518673199823e-02   +4.561995857637197e-01   +6.281620264456745e-01   -1.056411126465397e-01   +2.350285491570579e-01   +2.642799381070760e-01   +7.661392676101672e-02   -2.442959407470099e-01   +4.122304147835611e-01   +3.934606430685160e-01   -3.837251991782314e-01   -1.768780884241097e-02; +4.622722365948617e-01   +1.255650622588167e-02   +4.310276402249855e-01   +1.984548231079285e-01   +5.684627885471020e-01   +7.316681624046001e-01   +4.102982474822859e-01   +1.604702958760386e-01   -5.968195477898406e-01   +4.339111645277584e-01   +1.456265998356694e-01   -2.865847796522948e-01; +3.882944264943233e-03   -5.966401482338974e-03   +5.231013549480124e-01   +1.490366908981946e-01   -5.351006023601749e-02   +4.203336078542092e-01   +5.969444231651752e-01   +5.408045233289820e-01   +4.711408338991542e-01   +2.035131867595283e-01   +6.433657429133174e-02   +2.439467071081449e-01];
L2E_L3E_iAMPA_netcon = [+5.258542304951362e-01   +1.410034223201697e-01   +5.880342867533362e-01   -6.496658610987154e-01   +1.165249875608855e-01   +6.035340851362939e-01   +6.734786563035572e-01   +6.728123949784259e-01; +1.516894656814770e-01   -5.758276916212882e-02   +4.982066864996124e-02   +4.724365190319544e-01   +4.835914047483828e-01   -2.805199848207076e-01   -4.730494472894125e-01   -5.195281320336814e-01; -1.502605366990395e-01   +3.197961843008357e-02   +1.219877955523535e-01   +1.798166081728367e-01   +2.856853324008337e-01   +1.001491813846859e-01   +2.537845215130704e-01   -2.826912448941055e-02; +2.713983753600876e-01   +3.788548249792091e-01   +8.675163454414918e-01   +8.612385495376798e-01   +1.017093650524780e-01   +5.695039979964661e-01   -1.921953859173712e-01   -5.168302819213926e-01; +2.537328280569392e-02   +2.726345328111638e-01   +1.949858264278924e-01   +6.435047985521405e-01   -1.920279206587439e-02   +9.300051112423352e-02   +1.351804583554504e-02   -2.946391873619985e-01; +2.234025419140330e-01   +3.684102097803429e-01   +5.159569661036585e-01   +6.004122091161233e-01   +2.522442692796569e-01   +1.582153779509822e-01   -1.338216129067325e-01   +2.524195338462097e-01; +2.839151638727947e-01   +8.759095493363300e-01   +4.841375701877045e-01   -2.656343404358801e-01   +3.185360718749630e-01   +7.026000844526215e-02   +2.137822776414652e-01   -3.598204771038569e-02; +3.321819313550907e-01   +3.026753107385964e-01   +1.116240948675920e-01   +3.279390364046718e-01   -2.809899448659590e-01   +5.696984751296159e-02   +4.165359895428926e-02   +5.007926778426168e-01; +9.246593774391904e-02   +4.893734866089082e-01   +5.642419754960478e-01   +6.546711548221014e-01   +2.465709109432742e-02   -4.349263101410354e-02   +7.574392059289138e-01   -3.594404319478360e-01; -1.267701832540538e-01   -4.774166461326074e-03   +2.543296781115018e-01   +8.719747244856696e-02   +1.242094940924849e-01   -3.776973936093897e-01   +3.080466436216698e-01   -9.369563583039826e-02; +3.923447944527145e-01   +3.521625080329411e-01   -1.427832355854705e-01   +7.846967953617540e-01   +1.116955217495242e-01   +6.879267841103459e-01   -4.209354805586101e-01   +2.074280750067158e-01; -2.504127098090516e-01   +5.988267798073421e-01   +4.312282262808474e-01   +2.675721750760137e-01   +5.258765605311943e-02   +3.935886731426805e-02   +1.504164601143421e-02   +1.797077924197347e-01];
L2I_L3I_iGABA_netcon = [-2.017693619770449e-01   +8.120406294202205e-02   +2.943437884729680e-01   +1.968123545254867e-01   +3.767109896391538e-01   +7.385096685182141e-01   +4.665605979629824e-01   +3.105367590136521e-03; -3.703464966776414e-01   +1.934297053377762e-01   +5.793208129705466e-02   -6.370351562440517e-03   -5.082006467933767e-02   -4.176021296071548e-01   +5.013443049187433e-01   +6.343931897663785e-02; +2.727142113156775e-01   +9.525503762455102e-01   -5.741632319534757e-02   +3.866846512248640e-01   +1.527735746706479e-01   +6.816053201608485e-01   -1.201398121761602e-01   +1.024250693835668e-01; -1.396351105794788e-01   -1.596953506999153e-02   +8.958469933310154e-01   -2.066737262742215e-01   +9.461469081416313e-02   +5.321447774390478e-01   +4.090994734199793e-01   +1.537733709017156e-01; +1.773958173274359e-01   +3.475224561740733e-01   +4.278147547567016e-01   +3.799291864438526e-01   +2.035644807786050e-01   +2.780006077035168e-01   +3.094682805237040e-01   +8.012573299403589e-03; +2.075533681300172e-01   +4.623595054460041e-01   +4.162864109905359e-01   +1.192227943018247e-01   +3.895894839291006e-01   +6.063457017239984e-01   -2.855425932531802e-01   -1.145253357266910e-02; +9.792793540896219e-02   +5.732014084696354e-01   +2.696516251766971e-01   +2.600174324613843e-01   -8.850632737989340e-02   +1.634545843454882e-01   +9.619549641851318e-01   +4.552707066077201e-01; -2.922337386314582e-01   +4.065121977629683e-01   +3.246490881088056e-01   -8.022380487349608e-02   +2.081577445150567e-02   +4.897091565078451e-01   +2.595251019519446e-01   +4.500462175743026e-01; -2.518213332706038e-01   +5.951624453775345e-01   +7.197914456133543e-01   -6.052064564408501e-03   +1.849560576550867e-01   +6.227191150882844e-02   +3.760041447124698e-01   +2.700867352280668e-01; -7.831674331363056e-02   -1.330245538776592e-01   +1.520766134308059e-01   -1.486829111386902e-01   +2.470814075697267e-01   +5.306194681168130e-01   +2.586640324576754e-01   +2.220374888557407e-02; +5.290071812944909e-01   +2.504522571552061e-01   -3.472143449852507e-01   +2.623509322539964e-01   +1.221702773851635e-01   -3.018236160677074e-01   +1.936682756446761e-01   +4.927740331210266e-01; -4.202929980169423e-01   +4.224012343280386e-01   -1.528381086812356e-01   +5.129003680663992e-01   +3.409081003642731e-01   +3.579622604807420e-01   +7.156477760296885e-02   -3.988447282052373e-01];
L3I_L3E_iAMPA_netcon = [-5.388176388018003e-02   -2.383304213661701e-01   +4.819711025547418e-01   +2.781427167780481e-01   -6.846959307568169e-02   -4.218545112954395e-02   +1.355428670966337e-01   +5.317733081348164e-01   +3.981950306855215e-01   +6.482383838471946e-01   +7.867313149534046e-03   +4.535740479995516e-01; +3.130721221349111e-01   -4.052855380281576e-02   +4.390416062569406e-01   +6.975753585787856e-01   +4.634095592983697e-01   -1.232392686270829e-01   +3.712356750213412e-01   +6.276728863608010e-01   +4.865664670337386e-01   +4.909447690068192e-01   -2.568086131048273e-01   -2.335312882780927e-01; +2.250227044373561e-01   +6.927934654883874e-01   +1.243925775262854e-01   +6.115746856153251e-05   +9.269409163752212e-01   +4.664383263627700e-01   +4.325828611790414e-01   -1.223808719889036e-01   +2.808208569637921e-01   +2.305582772535164e-01   -8.813403433049732e-02   +1.339864640963298e-01; +1.629699400992457e-01   +2.476084769439841e-01   +3.995220449519445e-01   -1.639636083554281e-01   -1.700936350351037e-02   +3.304464334627226e-01   +4.080624476850409e-02   +2.321890543860035e-01   -2.263800435398639e-02   +1.867611523880339e-01   -9.796663581899803e-02   +1.171651922486255e-01; +8.770536942618559e-02   +2.707479006581771e-01   +8.518968542463539e-01   +5.275228266947831e-01   -1.547286477125836e-01   -5.428656121912667e-02   -1.884603456628577e-02   +4.753515383624037e-01   +2.710777539468545e-01   +2.324943141927092e-01   +3.211358004083204e-01   +6.544437288531083e-02; +1.812687590715515e-01   -1.090282033655024e-01   -6.097036365053835e-02   +1.319017688532691e-01   +2.262265043010841e-02   -1.725185025511820e-01   +3.913945593923560e-01   -2.158433175655267e-02   +4.027752614301706e-01   +2.124738359115239e-01   +3.618533552350603e-02   +7.821543325710661e-01; +1.596657168883477e-01   -9.565713180963989e-02   -4.448347856132304e-01   -9.103526780017207e-02   +1.534133392318406e-01   +1.112970966126253e-01   +4.862289203920932e-01   +3.678609524254937e-02   +2.603983437093340e-01   -1.102240015003940e-01   +3.639909119381086e-01   -2.012657445857559e-02; -1.710623065915651e-02   +1.179562629996046e-01   -2.868371332505519e-01   +2.311339650282141e-02   +5.050463645347588e-01   +4.120640591716183e-01   -2.595138425749878e-01   +1.281365700532701e-02   -4.258084557075287e-01   -3.542618155883971e-01   -3.345605221619032e-02   +2.946836299949564e-01; -4.306051165746653e-01   +6.569553629108569e-01   +5.853632215622602e-02   +4.635453756843353e-01   +2.369578662677410e-01   +3.654096145046289e-01   +4.191470256704778e-01   +4.567489435644552e-01   +1.527929879121273e-01   +1.224621421211315e-01   +7.466600597676698e-02   +6.864111774978419e-01; +8.219058835768923e-01   -4.471717136907506e-01   +7.464342878203499e-01   +1.343726332419958e-01   -1.447087458891306e-01   -1.241333473048091e-01   +2.013440983083491e-01   +2.773387537397892e-01   -1.220060295266085e-01   -6.578581087238772e-03   +7.023510630138022e-01   -2.430886963901557e-01; -3.534458016838478e-01   +4.587264941847055e-01   +5.921336730276446e-01   +2.873729850170288e-01   +1.879927329886859e-01   +1.549703300734807e-02   +3.025454449694419e-01   +1.674715115662725e-01   +5.570453347518188e-01   +6.474825823084852e-02   -1.731964602137551e-01   +4.791775402143632e-01; +1.876969377810532e-01   +1.403225663379657e-01   +1.973257407968635e-01   +5.335727344974375e-01   -2.910644898398036e-01   -3.085630225972630e-01   -3.341060895960646e-01   +3.494283905492532e-01   +1.187650325961268e-01   -2.174247666803107e-01   +2.758896813669330e-01   -6.040645025226162e-02];
L3E_L3I_iGABA_netcon = [-2.201258131024289e-02   +1.474012986532499e-01   -3.389326521885505e-03   +3.113679207308793e-01   +9.737445164590343e-02   -1.566138069404434e-01   -1.729055470632500e-01   +4.602535828562565e-02   -6.928097891678425e-02   +6.389026115458941e-01   +2.361596309731560e-01   +9.570682426011638e-02; +2.099436987026945e-01   +2.519709231952388e-01   +3.737335881888835e-01   +2.793679724055294e-01   +7.090487705065747e-01   +1.164526311636435e-01   +2.094437030285895e-01   +9.014673200875079e-02   -5.919475602956218e-01   +8.578533623209728e-02   -6.497317106316237e-01   -2.011386999354899e-02; -1.972944789498331e-01   -3.776739156559895e-02   -3.008832105199548e-01   +1.100402565424343e-01   +9.502440257980493e-02   +1.011011907183991e-01   +3.159274641176564e-01   +2.663396209979733e-02   -1.015704446972273e-01   +2.076658392646619e-01   -5.721208439072437e-02   +1.854998242261589e-01; +2.467830822121486e-01   +2.800770552259346e-02   -5.535561974672869e-01   +7.522327333071974e-01   +7.739309481413955e-01   -1.262331763117354e-01   -2.904412174231541e-02   +3.394314902122500e-02   +6.995125652276530e-01   +5.448718128338309e-01   +2.618301444132614e-01   -3.574177822928105e-01; +2.364955751208892e-01   +1.783209519833223e-01   -1.732783069131644e-01   +1.504129210800671e-01   +1.710321144270403e-03   -5.620635757436496e-02   +2.500284188948750e-01   +4.837197273772271e-01   -2.953113447099742e-01   +5.033980911295293e-01   +4.312801371949841e-01   -6.424533772776232e-02; +2.462114250162087e-01   -4.687569267583692e-01   -7.097279998775088e-03   -2.690425039451232e-02   +1.592055072428289e-01   +7.126442033139883e-02   +1.905398098793760e-01   -7.872105608902367e-03   +3.689232091872877e-01   +2.966182411728277e-01   -1.859518633544705e-01   -6.527815140858811e-02; -1.899912439936404e-02   +1.987595283869183e-01   +1.358895382460189e-01   +7.804972854120165e-01   +1.177492692229941e-01   +2.090219098144185e-01   +4.187585254342100e-01   +5.387153349590166e-01   -1.776684470088972e-03   +2.795581089999072e-01   +3.149507893484680e-01   +2.565496868400174e-01; +1.117109456412607e-02   +4.238469691843885e-01   +3.558588902163102e-01   +2.834877352384620e-01   +7.446808076997316e-02   -3.123682721774831e-01   -4.692988952566685e-01   +4.834426679798112e-01   -1.238303045328986e-01   -1.850219236891687e-01   +3.521332341804525e-01   +4.453048925222020e-01; +5.729997467609964e-01   +4.057423783942621e-02   +3.012433937489521e-01   -9.878172674011321e-02   +3.055205553734191e-01   -5.552099437573735e-02   -6.265163542060379e-01   -1.785673571015713e-01   +4.844879471848866e-01   +3.170580616903042e-01   +2.270341507379351e-01   +3.385555967874197e-01; +1.836165896107060e-01   +1.155819078972658e-01   +3.295293344053500e-01   -5.937740921972592e-02   -5.622331028391012e-01   -7.486160018802827e-02   -2.988588942428314e-01   +1.989663513082232e-01   -1.885552984109169e-01   +9.253329590447346e-02   +1.537807376454055e-01   +2.579730931043253e-01; +1.383046863699836e-01   -2.584144292102301e-02   +2.195714844367173e-01   -1.627746437979251e-01   +9.467476055647399e-02   -1.234519059113892e-02   +3.474001668466639e-01   -1.612950955056505e-01   -2.965717331507666e-01   -3.269750022311086e-02   -1.352765605956040e-02   +2.758721341921666e-01; -4.312144305368636e-02   +3.639579964437178e-02   -5.224930429324599e-01   -1.732984789871271e-01   +9.178169601916024e-01   +3.450291387364951e-01   +3.638002689440375e-01   +3.026893229433080e-01   -2.031084573729445e-02   -4.490222758263173e-01   +2.711528322220328e-01   -3.548488633941316e-01];
L2E_Input1_iAMPA_netcon = [+8.974593463921708e-01   +9.723981727167280e-01   +5.598092826782372e-01   +5.558480117020383e-01   +5.746062146684257e-01   +3.982900694513976e-01   +8.283469569411848e-01   +6.483167819984829e-01];
L2I_Input2_iAMPA_netcon = [+5.221302625659933e-01   +6.000265561868862e-01   +6.526759499009347e-01   +2.528274640103833e-01   +7.678046858578180e-02   +9.799218203347336e-01   -8.080958163376975e-02   +1.699196344383822e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last =  11.21 * ones(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.2*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.2*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.2*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.2*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.2*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.2*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.2*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.2*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
