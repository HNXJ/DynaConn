function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+9.741446627814473e-03   -2.645089983951552e-01   +4.196995435548405e-01   +1.083990226692362e-01   -6.889174617587345e-01   -4.125152239374005e-01   -8.788437249658421e-02   +8.734783485278371e-01   +1.541935231760644e-01   -5.404679559871755e-01   -3.644801348008972e-01   +9.816039233311633e-02   -4.703509543230939e-01   +6.403410365908934e-01   +1.952556769619660e-01   +4.013211870499698e-02; +1.000000000000000e+00   +1.199863446492254e-01   +5.712219906862920e-01   +6.395267843561727e-01   +8.199168658633632e-01   -2.115997527358755e-01   +4.640268838075075e-01   -1.679614462960804e-01   -1.391212619982070e-01   +2.655893423979772e-01   +3.265569530492737e-01   -4.269572547587245e-01   +4.518432316632158e-01   -2.352070762479410e-01   -6.319758501170381e-01   -8.557577635304611e-01; -3.603976940270448e-01   +6.391002762219423e-01   -2.226391360355833e-01   +5.208325665614562e-01   -2.230915326609547e-01   -1.100720031692688e-03   -4.075380980044223e-01   +1.427967700484791e-01   -4.231606477427919e-01   -3.429289860115290e-03   +8.316469091115386e-02   +5.353547580657994e-01   +3.852004905604282e-01   -4.871884232137665e-01   -4.272162366801698e-01   -5.079081642597089e-01; +6.855381679786904e-01   -8.816918621848384e-01   -2.536301722411733e-01   -7.635931557984547e-01   -2.275813781099622e-01   +1.680527970919621e-01   +6.217004502877258e-03   +6.332381873305507e-01   -3.999999268714420e-01   -5.631414884599800e-01   -2.541586197542614e-01   -8.560723222931150e-01   +8.158584511481438e-01   +3.833323309500338e-01   -5.298230373831535e-01   -2.007470945108808e-01; -7.810005108414461e-01   +4.977234091235410e-01   -7.738365056541195e-01   +6.684148348165048e-01   -2.440802879682221e-01   -8.274643001223204e-01   -6.636938356132371e-01   -4.445626166043316e-01   -1.517239058243925e-01   -7.917245337406571e-01   -6.789720592112628e-01   -2.952194019543377e-01   +7.142202658452096e-02   -2.214689287249623e-01   +6.476719115588809e-01   -1.138643102349828e-01; +7.742993597665613e-01   -2.155982565780715e-01   -8.748537686257880e-01   +4.574143894681958e-01   +3.879054357633676e-01   -4.751138303608787e-01   +3.110998169526072e-01   +5.959767793403051e-01   -3.116909574219454e-01   -5.440745675615850e-01   -2.071513533182848e-01   +6.227175982199531e-01   +6.201049744230818e-01   +4.023019438626960e-01   +8.783224356678976e-01   +4.549864523472723e-02; -9.898981262967010e-01   +2.395368064925408e-01   -5.046466338569557e-01   +5.787166169150865e-01   +5.403738859931969e-01   -3.714484212613330e-01   +1.042151415431470e-01   -2.377922995313750e-01   -7.110678028087285e-01   +3.331821135251383e-01   -2.491446718635017e-01   -5.421813566373241e-01   +1.717981010367785e-02   +2.659195967841450e-01   +1.236160512765785e-01   +5.130866627518447e-01; +6.804786637458352e-01   +5.567068969673457e-01   -1.113610279860587e-01   -8.158968514027176e-01   -2.477340702037970e-02   -8.782068119895057e-01   +5.860094963696607e-01   +3.347019437795837e-01   +1.141480551913295e-01   +4.189536857230316e-01   -4.781929940419456e-01   +7.294410066319482e-01   -1.773446898737829e-01   -5.542081299777357e-01   -5.321330340033013e-02   +6.983637949609999e-01; +2.030666351521107e-01   +2.207492275703076e-01   -5.643176091173348e-01   -3.003199018675801e-01   -5.722607784366373e-02   -4.165932617962777e-01   -6.696492779793812e-01   -9.662087952173479e-01   -2.519966355744074e-01   -1.146637409891471e-01   -2.541643748614635e-01   -5.911776350576864e-02   -5.176833149146657e-02   -2.746965806687246e-02   -1.090323742058025e-01   -6.642015600619575e-01; -9.541063076107492e-02   -6.531247999816353e-01   -5.823870996780083e-01   -2.422478261301883e-01   -5.447934517007873e-02   +4.735203718885319e-01   -2.047731318338970e-01   +5.204868503780548e-01   +4.321298630821272e-01   +7.311559205577299e-01   +4.233670023964988e-01   +5.030782085389248e-01   -3.742313664460499e-03   -6.204540315238166e-01   +8.895668153762590e-03   -8.487249719910877e-01; -6.329075323222112e-01   -4.549705442130584e-01   -7.225772293085073e-01   -5.525414992123949e-01   +3.452975332957818e-02   +8.893393964181090e-01   -3.220911624174171e-01   +8.187232214698256e-01   -7.561114122977384e-01   -2.066474498988396e-01   -8.316132264114332e-01   -7.229964886433310e-02   +3.008544675539463e-01   -2.710783223311800e-01   -3.267110692420926e-01   -6.587992824190380e-01; +8.082883338356975e-01   -2.257666187379014e-01   +1.320983719130165e-01   -1.597561708663199e-01   +3.227121267003610e-01   -1.512520349865928e-01   -7.468317329739992e-01   +2.602016036176774e-01   +6.754866778884989e-01   +1.979967102582280e-01   -5.174114131648624e-01   -2.110608459542000e-01   +3.651600077163058e-01   +1.969844926132425e-01   +6.981232404215143e-01   +8.694288873121335e-01; +7.496210065620591e-01   +5.823737494363478e-01   +3.613813614167442e-01   -7.189405823359910e-01   +1.730388398786259e-01   -6.703476515402600e-01   -3.838668218367586e-02   +6.702126384905399e-01   -4.516830087632928e-01   +5.340358372283031e-01   -6.699394462638382e-01   +7.593573093390721e-01   -9.299807902819823e-01   -3.687393470326890e-01   -2.214193891181613e-01   +6.711662869306104e-01; +5.698683727196485e-01   -7.172177167183303e-01   +2.015057925617621e-01   -4.005212824287747e-01   +1.999383219321585e-01   -6.886698971867984e-01   -1.292031339596193e-01   +1.487651599132236e-01   -2.689388030020545e-01   +3.239622425136557e-01   +4.760511686221393e-01   +4.503170928484448e-01   +2.698265248994218e-01   +2.808247270900951e-01   +8.135368933921050e-01   -8.457659044410774e-01; +1.376908744096841e-01   -4.219693196165824e-01   +4.951037331822124e-01   +2.287599972089901e-01   +7.860709844249685e-01   -3.008517872382520e-01   +5.450382978718296e-01   -7.045955865203544e-01   -6.676491926446795e-01   -3.351124487984409e-01   +5.762314647529431e-01   -5.101885749854616e-01   +4.047066473461966e-01   +3.639591448030160e-01   +3.045046879474552e-01   +6.373667675284095e-01; +6.715814904544940e-01   +3.332119719081101e-01   +6.134937951640702e-01   -1.796626464456325e-01   -3.371931136745095e-01   -8.965919719079311e-02   +7.540013472073684e-02   -5.275945802375454e-02   +2.268234046133345e-01   +6.252650456827388e-01   +6.878730128370271e-01   +2.948574299564776e-01   -4.098709016435130e-01   +1.729590143291750e-01   -8.293883290752315e-01   +2.994845649472446e-01];
L1E_L1I_iGABA_netcon = [+6.690567409274314e-01   +3.823492872193870e-01   +4.625738621949466e-01   +7.885825757446994e-01   -4.199045159145699e-01   -2.367266978059963e-01   +5.458483149929443e-02   -6.115766286009450e-03   -7.711709832988933e-01   -5.404368551273683e-01   -7.569601207754585e-01   -1.000000000000000e+00   +4.748154614889024e-01   -2.491227061252552e-01   +3.088136594962300e-02   -7.348161493741897e-01; +8.846206161600810e-01   +8.415863936570044e-02   +7.070936234289185e-01   -2.633553976268523e-01   -3.020255412257652e-01   -4.005331653005253e-01   +7.481166869920699e-01   -7.701033560837107e-02   -3.983820068569247e-01   -4.795002533069485e-01   +5.476137486736771e-01   -5.980354271482543e-01   +7.628815445488067e-01   +9.778499896270262e-01   +4.648857447958681e-01   +1.687490213545617e-01; +4.264736678055023e-01   -5.135908752077912e-01   +9.224679416766436e-02   +1.621839584447777e-01   -3.065081782481067e-01   -7.131718112280742e-02   -3.722554115106562e-01   +4.167676363488489e-01   +7.940699994175875e-01   -5.943793636362148e-02   -7.110741297959320e-01   -4.200345529485327e-01   -1.818814682849149e-01   +1.250937705418460e-01   -1.793318063381505e-01   +7.566298050326955e-01; +1.678342787954504e-01   -6.658923973460440e-01   +4.668787705295904e-01   -5.836394345578246e-01   +5.749705869125252e-01   -1.577698041347148e-01   +6.946117144128272e-01   +6.422715563028243e-01   -5.487633249726843e-01   -6.273706484933350e-01   +4.496702628336655e-01   +2.816746485501798e-01   +2.259008432497890e-01   +5.631194872462073e-01   -6.287065699825287e-01   +8.693431873231199e-01; -4.322579430513800e-01   +3.185049007487706e-01   -7.606326379063064e-02   +5.777215788859521e-02   +4.855855474180751e-01   -5.176108690903317e-01   -2.385802381560214e-01   +1.514270278048871e-01   +5.681637934656854e-01   -1.460469275414649e-01   +4.954998644327164e-01   -6.273557520258218e-01   +6.090613892679059e-01   -5.487353785222864e-01   +3.746052842768501e-01   -8.442355461584216e-01; -1.698090066382108e-01   -1.717030978995309e-01   -4.738282378875159e-02   -5.086358028684437e-01   -4.497939553812540e-01   +4.550447083487730e-01   +4.959771979490296e-01   -9.094451771070320e-01   +7.708365132583356e-02   -7.729686451857165e-01   -1.563940454175106e-01   +2.495664388984408e-01   +4.422077826814278e-01   +3.221479334506930e-01   +3.752338722999141e-01   +7.157410768602697e-01; +7.137943442993194e-01   +3.168154053358798e-02   -1.705615915389263e-02   -1.372062319976574e-01   -6.628536689971405e-01   -9.868357928252258e-03   +1.972521668089577e-01   +3.323293895405749e-01   -9.592811069102510e-01   -2.085543198844163e-01   -2.910844217392466e-01   -2.275670482723945e-01   -6.096444050406665e-01   +5.305111336643462e-01   -4.190205436726753e-01   +6.385742984912632e-01; +1.695247212092596e-02   -1.978413334322841e-01   +6.027612776025409e-01   -5.157096058297002e-02   -2.238439437839306e-01   +5.633870677046674e-01   +4.343836135303652e-01   +9.210669888747284e-01   +3.600852897851453e-01   -2.557693482899441e-01   -5.555527608085618e-02   -7.330727501416822e-01   -5.362011385598286e-01   +1.413570309808279e-01   +5.697771033181239e-01   +6.542291709426275e-02; -3.146866798966665e-01   +7.772143776027153e-01   -3.786651488934108e-02   +4.762367473498673e-01   +7.109083417520246e-02   -3.956228689930053e-01   -2.584538259710308e-01   -6.789190278672697e-01   +2.363002412659409e-01   -3.265347694586768e-01   +5.331872828596318e-01   +2.996213570117489e-01   +1.158812514835847e-02   +1.435175430377300e-01   -4.481090165330893e-01   -2.607682097377780e-01; -2.877313440078392e-02   -9.707067555317613e-01   -5.204294784354225e-01   -4.276465013911351e-01   +2.169178826020277e-01   +6.744092629102706e-02   +4.944424424016622e-01   -9.736679469471733e-02   +1.441667482616963e-01   -5.343282348524484e-01   +5.668207806917629e-01   +1.704502195318519e-01   -7.938665231505995e-01   -2.930085305643294e-01   +6.491814355187601e-01   -1.503723482855549e-01; -6.905239320400088e-01   -7.225944352997622e-01   +1.592488778016500e-01   -5.075468155732151e-01   -6.594726311198555e-01   +1.020187841229972e-01   -1.383303473358485e-01   +7.112290133660849e-01   +4.091699317397892e-01   -2.967985195404976e-02   -4.521545564990503e-01   +4.591572807925228e-01   +4.252841177416493e-01   -4.501423445511258e-01   +2.731394897382661e-01   -2.624790503548863e-01; -4.646081140390425e-01   +4.206980155749666e-01   -6.456944530885438e-02   +1.228861286697168e-01   -3.924708243564989e-01   -4.227053793743347e-01   -5.907240097700677e-01   -1.893765055580717e-01   -5.473550542003328e-02   -4.172333487052002e-01   +3.241674507008321e-01   +5.358904175876813e-01   -3.505465269477098e-01   -5.380968412595807e-01   +4.074266393751514e-03   +6.010364155137697e-03; -1.898537606429036e-01   -5.069217912261855e-01   +7.232612979886575e-01   -6.527130739220874e-01   +3.440252767029608e-01   -2.265182346035304e-02   +3.648232533918374e-01   -9.011125697364679e-01   +3.517953943859716e-01   +2.424644895704933e-01   +5.283288584826873e-01   +4.463333299167001e-01   -2.329419946196835e-01   -4.587562906323203e-01   +7.362863851385167e-01   +7.296956912627042e-01; +1.848764966858682e-01   +6.870838874288979e-01   -3.757716737319681e-01   -5.166946805138187e-01   -4.214766222897235e-01   -3.469241781788868e-01   -1.297253373248859e-01   -6.715111666105551e-01   -5.717674317318232e-01   +9.548611321368333e-02   +1.528639190696252e-01   -4.967389844257066e-01   -3.078913467595506e-01   +2.430845563008011e-01   +4.980987384136697e-01   -5.973114037723862e-02; +3.697793252646261e-01   +6.039498956278135e-01   -5.429735185699711e-01   -6.573694557475241e-01   +1.239111742944272e-01   -5.578780449091054e-01   +3.839973068721267e-01   +3.456940794512271e-01   +5.259185408415452e-01   +9.012858106417579e-02   -4.096912703465000e-01   -2.140860783424214e-01   +6.973370352694402e-01   +5.236117450403650e-01   -4.129337987032893e-01   -3.902766771556019e-01; +1.059034205892089e-01   -7.644165492858636e-02   -7.556022166143887e-02   +1.862449417248691e-02   -4.893954292400753e-01   -4.353245134575857e-01   -1.466978494149936e-01   -2.797565112899729e-01   +5.974202503350832e-01   +7.469252506289971e-01   -1.014555040121241e-01   +1.910039069207778e-01   +5.834335735715631e-01   -7.509986769028176e-02   -4.980820181719684e-01   +2.973196728615289e-01];
L2I_L1I_iGABA_netcon = [+2.122936948009981e-01   -7.698623114037135e-01   +3.404468044814647e-01   +7.052592551457739e-01   -1.949968799899329e-01   +8.185672667419534e-02   -7.995325490142220e-06   +4.965702963214226e-01; +4.099318374232642e-01   -2.589821756911859e-01   +5.222814618778139e-01   -2.096025433392531e-01   +2.986741198102442e-01   +2.878577974124340e-01   +1.247617022790999e-01   +2.136387683290161e-01; -7.448010470903014e-01   -7.505789017979361e-01   -1.796117660205222e-01   -4.830670015675241e-01   -1.638206306325667e-01   +1.864816435619782e-01   +4.246247363644617e-01   +7.969621106641438e-01; +3.484727926817430e-01   +9.464148730557080e-01   +6.366772252590798e-01   +4.367433490300740e-01   -6.064736344577334e-01   +6.411227426254688e-01   +5.651432812425574e-01   +2.747598461049499e-01; -8.196313098149006e-01   +5.879864921780596e-01   +5.073482059503399e-02   -1.641360462966555e-01   +3.036947638193252e-01   -8.391719933251472e-01   +1.289928615276462e-03   +5.834129767915935e-01; -2.287921428380047e-01   -1.125798930220589e-01   -2.300288095598761e-01   +4.194023060999730e-01   -7.033144808754805e-01   +7.469302070826146e-01   -7.091742049636963e-01   -4.076145895781667e-01; -7.327019634862060e-02   -8.801290150043816e-01   +9.096913715224215e-01   -8.043986773017156e-02   -4.153146807540322e-01   +7.072208712980962e-02   +4.749189168256674e-01   +6.751882306973065e-01; +8.294932623998781e-01   -1.430451023057360e-01   -5.608255920733352e-01   +6.023915599484072e-01   -1.961052904915776e-02   +1.722021474135204e-01   -6.257426505193178e-01   +1.277797491704219e-01; -5.970483790758112e-01   +1.568492991028482e-01   -8.009029412513490e-01   +1.275943693005080e-02   +1.279801452550525e-01   -3.991976968850701e-01   +7.206981921943320e-01   +5.259479229277405e-02; +9.249309314250633e-01   +1.454700467430008e-01   +2.233775859421443e-01   -2.480300020301727e-01   -4.230445281844589e-01   -4.393904555014480e-01   -5.652459785007283e-01   +1.363605595165349e-01; +2.064268950523115e-01   -7.734239576060592e-01   +5.973244595558157e-01   -2.141073104289694e-01   +2.450225237676579e-01   +3.034456464456510e-01   -1.699114264503767e-01   +4.189248215462045e-01; -1.493455429791641e-01   -4.301033033997262e-01   -3.035155765221463e-01   +5.493018448920468e-01   +4.095252506428478e-01   +6.665197276035163e-01   -2.430658998257651e-01   +4.633251127374130e-01; +5.420253057902740e-01   +3.776149347798005e-01   +5.355382713768860e-01   +8.696657702202731e-01   -6.697934020703861e-01   -4.829103757259601e-01   +1.000000000000000e+00   -5.556533620407993e-01; -4.424959484275995e-01   +6.233558615628927e-01   -7.283858803458376e-02   -9.386129674649989e-02   -2.199045298473294e-01   -1.176494928290514e-01   -1.159283641559657e-01   +6.553224366923391e-01; -3.513447941203131e-01   -7.123671146819861e-01   -7.232194457734109e-02   -2.018342824788830e-01   +3.845906089156163e-01   +2.901386272782314e-01   +3.510890263283238e-01   +6.080065966129641e-02; -4.344838867354950e-02   +1.225734383056053e-01   -6.571370931075665e-01   +2.945080735485909e-01   +2.290454181232402e-01   +5.738860110969609e-01   -6.605279159674119e-01   -1.816514683088121e-01];
L1I_L2I_iGABA_netcon = [-4.200160534396125e-01   +1.712630591619348e-01   -4.337230141102636e-01   +2.039957462931679e-01   -6.269079571175347e-02   -3.171681976903091e-01   -4.014366865541572e-01   +1.558124742877696e-01   +5.117846108772874e-01   -6.961506876952839e-01   -9.649027492679750e-01   +7.399375260490317e-01   -1.384447034721426e-01   -2.726528964174467e-01   +7.992193948319619e-01   +6.225135114939567e-01; -6.037666080046581e-01   +4.258099365380027e-01   +6.850095989305940e-01   -1.996928671985302e-01   +3.551158828311494e-01   -2.752235322031619e-01   -6.803785656016685e-01   +8.026674059114570e-02   +1.966813219046667e-01   +3.504440591097327e-02   -6.781946796842260e-01   +8.335496472430175e-02   +8.331275001479567e-01   +3.499367883043893e-01   +1.825532166592927e-01   +6.583075582799143e-01; +6.529864940788837e-01   -1.647411549440604e-01   +8.246548126941051e-02   +7.065162892533683e-01   -1.571962293303042e-01   +4.764045539805045e-01   -5.191416183797066e-01   +2.715258862709273e-02   +4.414407640604308e-01   +2.118801106425196e-01   +3.123964989719119e-02   +5.383004825781227e-01   -6.402110531953000e-01   +8.257513323847459e-01   +9.005700459403257e-02   +6.038224460466031e-01; -7.400847586795213e-01   +1.605469652340895e-01   -5.989073980785147e-01   -6.742848984968436e-01   -1.000000000000000e+00   +2.865002783504234e-01   +1.212566972355275e-01   -2.867922014513500e-01   -5.416583387734623e-01   -9.295632593465282e-01   -8.549831188673392e-02   -3.190502675140756e-01   -2.910860447443782e-01   +4.397842392581818e-01   +7.180389846430324e-01   -6.933836976565221e-01; +6.564783775526416e-01   +1.888375351211876e-01   +3.807421278404484e-01   +4.962093601216761e-02   -7.039689351441430e-01   +4.652878632640789e-01   +8.313707063475352e-01   +7.145869760985500e-01   -3.483506057523036e-01   -3.406359748830092e-01   -7.752785363724420e-01   +2.725094782234853e-01   -7.642355766939254e-01   -4.146847627200027e-01   +5.990013194988258e-01   -8.685396281470680e-01; -6.765384980729517e-01   -5.320301225470964e-01   -2.801158880140392e-01   +5.079096998712090e-01   -7.523881083200072e-01   +7.868546043660948e-01   -7.657316398790118e-01   -1.110773700721455e-02   +4.892033866565166e-01   -8.025960814482963e-01   -8.894556606279629e-01   +2.468801286445788e-01   -3.583595043464735e-01   +3.790151799383267e-01   -7.102201487522355e-02   -2.610835113555681e-01; -8.851437291114672e-01   -4.533635710272802e-01   -7.237135299580046e-01   +1.639745793514305e-01   +4.744347201878287e-01   +3.834169347244388e-01   -1.668223147485417e-01   +4.422394947976812e-02   +6.956946665819201e-01   +5.717379204247310e-01   -5.328128683934685e-01   -6.703172424188139e-01   -2.528351899171455e-01   +6.405448316429657e-01   -2.487294212142807e-01   -4.501275860958129e-01; -9.869032674090169e-01   -3.521709762546253e-01   +2.553545248370015e-01   -6.570696371089488e-01   +3.040275419032150e-01   +5.835395515538874e-01   +1.229969389457860e-01   +9.634555867995040e-01   +8.736991735952228e-01   +8.649342727437266e-01   -6.032667736381579e-01   -1.687065166871166e-01   -7.355738893358944e-02   -7.176787229814094e-01   +4.100292552653236e-01   +5.720344691965344e-01];
L2E_L1E_iAMPA_netcon = [+1.754098811163464e-01   -4.340316286455910e-01   +3.428664702514466e-01   +2.872141043818811e-01   +6.864119422339794e-01   -4.804988326875455e-01   +2.546060876673837e-01   +7.535078631859163e-01; -6.501845542320429e-01   +7.407350352732472e-02   -3.682566024957003e-01   +2.504759765643236e-02   +2.651368984330313e-01   -8.464606992314359e-01   +1.220380041210009e-01   +2.445189244299857e-01; -3.563037763409292e-01   +2.046075119237746e-01   +9.651818260468799e-02   -1.855216904347811e-01   -3.048245134858694e-02   +9.107906369440988e-01   +3.370661157133180e-01   -9.246515035713784e-01; +9.219430619009917e-01   -1.749899112969644e-01   -6.219124826910771e-01   -6.958560272050387e-01   +2.344137222466413e-01   +5.531822085817849e-01   -3.500360131735755e-01   -2.141269296293045e-01; -1.230039373174863e-01   +5.542937437571317e-01   -3.478336017124329e-01   +1.601461574173642e-01   +5.845667049377022e-01   +1.050195398234569e-02   +6.999670312392031e-01   -7.141255283099713e-01; +6.394190624756098e-01   -2.679455180867757e-01   +8.864723095561119e-02   +6.936473003865015e-02   -7.747889788385190e-01   +7.084748872441626e-01   +3.659825697893442e-01   -5.467785799299268e-01; +6.560795233669148e-01   -5.104418258375192e-01   +2.453665540770742e-01   -5.179152811757512e-02   -7.258475041068979e-01   +5.684084434848384e-01   +6.956507034819277e-01   -7.082237710737606e-01; -5.679988938399175e-01   +2.175196194099800e-01   -4.324537964384024e-01   -1.311283905699842e-01   +6.623026227844314e-01   +5.452007517669527e-01   -1.000000000000000e+00   -4.906921964401572e-01; +5.146779059824039e-01   -2.688301327778801e-01   +5.482161824163094e-01   -1.512013988134625e-01   -2.962809253921613e-01   +7.357206987718177e-01   +6.543939108884603e-01   -8.405947597471634e-01; +1.814775925404408e-01   -4.661984845901957e-01   -7.730714882701176e-02   +3.423683676011666e-01   +3.236302047780056e-01   -4.197249818717872e-01   -5.459079076635064e-01   +3.846117448144541e-01; -1.990916095991778e-01   -6.299302744962194e-01   +4.676436290999221e-01   +4.089143128429659e-02   +8.092007984905224e-01   -9.037823550645723e-01   -6.895519613653985e-01   +6.279850982997781e-02; +2.277232083711580e-01   -7.610618004532872e-01   +3.682391996728207e-01   -6.207871107470366e-01   +8.219460640976266e-01   -1.213073398197226e-01   +1.356203537525986e-01   -8.265450945749517e-04; -2.833414795257114e-01   +6.804486814980156e-01   -3.130335392413939e-01   -4.989485224316687e-01   -5.034509907667442e-01   +8.741262953677914e-02   +6.083425248862894e-01   +7.187363459239041e-01; +1.334947339052859e-01   -2.201884363012956e-01   -6.032462844764538e-01   -9.024807561948782e-01   +5.238958673160292e-02   -4.003297673218464e-01   +6.296725827474690e-01   +6.361615966720661e-01; +3.324478385331157e-01   +1.349103896266367e-01   +8.106417455493589e-01   +5.179016249082727e-01   -5.459465633650761e-01   -5.709776726384957e-01   +2.454538171990135e-01   -1.569444631452923e-01; -9.616349033652372e-01   +5.829001704951666e-01   +7.234164050760254e-01   +4.684940436898018e-01   -1.016606548678013e-01   +3.275039105362967e-01   +3.629568932649027e-01   +1.095295883019680e-01];
L1E_L2E_iAMPA_netcon = [-2.335466101251092e-01   +5.712620451004636e-01   +1.840844220719517e-01   +7.543304891879187e-01   -1.120895784598222e-01   -9.165610160562023e-01   +9.831309623683026e-01   -4.493166895877855e-01   +4.188445918247269e-01   +1.774711748324404e-01   -5.281828871852627e-01   +6.465283564069252e-01   -5.273912502079185e-01   -7.335302349684062e-01   +1.876778903491261e-01   +3.094741791383488e-01; -9.975075713823468e-02   +1.794855578078301e-02   -7.748814383115565e-01   -8.809696657474065e-01   -8.082070663927773e-01   -4.312207651525329e-01   +1.715543823734490e-01   -7.780742433714236e-01   -6.062852022673481e-01   +8.904610558709694e-01   +6.945338202270650e-01   -2.601971021943947e-03   +6.363715707155441e-01   +5.424198478729735e-01   +2.449959887849618e-01   -8.500791935908625e-01; -7.533347650086959e-01   +7.287092678029183e-02   -8.778791479960819e-01   +2.538187233720363e-02   -8.291411663744074e-01   +2.646755617594049e-01   -7.316781629682098e-01   -1.685450850348903e-01   -9.411025478925751e-01   +4.449421599623231e-01   -6.401335461331368e-01   +8.726695576020214e-01   +1.000000000000000e+00   -6.092561396153023e-02   +3.600511269165621e-01   -1.017378133298949e-01; +4.425027710991280e-01   +5.115251615659948e-01   -1.555899681555444e-01   -1.826915428374872e-01   +4.437019099947438e-01   +4.415045317705875e-01   +2.727499237260496e-01   +5.286598430091247e-01   -1.263055794510110e-01   -8.618905150720726e-01   -7.808121264302482e-02   -2.912266686423441e-02   +4.773520047400956e-01   -5.657445456684075e-01   -8.687002453671774e-01   -6.846811886584784e-01; -3.397679946986622e-01   -4.460984788930601e-02   +2.346376826463353e-01   -4.355308903690163e-01   +4.700569852829718e-01   +5.076158752144456e-01   +5.047568831785442e-01   +3.649863478342138e-01   -3.537295074167292e-01   +9.150416178346287e-01   -3.721161738330815e-01   -4.448214647080453e-02   -8.963803768694983e-01   -5.318089914037999e-01   +1.312489005867940e-01   +7.977333209019015e-02; +6.469393476158208e-02   +4.854664129422467e-01   -2.250925530548319e-01   -4.457043604598691e-01   +1.034721396318811e-01   -2.461362317238299e-01   -6.509891856725322e-01   -2.395674498189612e-01   -4.137054455351307e-01   +5.542587379716341e-01   -3.381888027729837e-05   +9.988148153927023e-02   +3.392643904543507e-01   +6.342163046286310e-01   +5.822093058564237e-01   -1.870860352939868e-01; +7.715521629812671e-01   +2.532788686706816e-01   -5.681414673361076e-01   +6.855697065695769e-01   +2.904852104353894e-01   +8.252336944548889e-01   +4.746857802717506e-01   -2.244503528772896e-01   -1.964431301198639e-01   -1.179841762778797e-01   +6.845589675454299e-01   -2.673652521938211e-01   +6.876763213978231e-01   +4.554786146511835e-02   -5.842767310578729e-01   -3.341180393854294e-01; -1.682895275568647e-02   +7.058898635604753e-02   -5.890377032553360e-01   -2.705423543928895e-01   +8.423568513846408e-01   -1.696992273865155e-01   +2.750564297821355e-01   -3.174754413715456e-01   +6.552546880948261e-01   +5.932887662529236e-01   -1.421916779912135e-01   +2.010860722552954e-02   +2.120139544871828e-01   -3.971743375318137e-01   -3.061507716005831e-01   -4.941893697400396e-01];
L2I_L2E_iAMPA_netcon = [-6.986688425986536e-01   +7.768007717301103e-01   -5.007877277287189e-01   +4.507297705502138e-02   +3.450047165483984e-01   -2.382090172209552e-01   +8.534844608841047e-01   -5.476724570641208e-02; +3.884892803074050e-01   -5.872679463669503e-01   +3.542822008524922e-01   -7.109293023378117e-01   +8.052127964316262e-01   -7.251958220716233e-01   -1.403395996965293e-01   +7.077192519422861e-01; -1.329374845831190e-01   +4.695775330519584e-01   +2.417453496985183e-01   -2.414001891280205e-01   +2.700823279292238e-01   -2.279033988604704e-01   -3.101607627289598e-01   -1.507096848633326e-02; +6.202270161452085e-02   -4.397792015443074e-01   -7.484798536312859e-01   -5.505753543384274e-01   -2.306519542027278e-01   +5.005010685678419e-01   -3.757410688859091e-01   +5.879779154002180e-01; +1.195868200942344e-01   +4.816178859977615e-02   -4.558995309513662e-01   -1.154497648938748e-01   +5.934441075316905e-01   +7.643474799018662e-01   -5.628862789236141e-01   +2.472957030576591e-01; +7.934155668648939e-01   -1.000000000000000e+00   -4.786494330792060e-01   +2.962433864295065e-01   -3.651066240734803e-01   -6.172871265317832e-01   +7.157177702079219e-01   -6.474289358020286e-01; -5.742369182902598e-01   -1.395700389612610e-01   -3.323978324898508e-01   +7.937522859903887e-01   +4.407101514356704e-01   +7.491803911873282e-01   +5.806107559339996e-01   +8.694703551491842e-01; -9.661325251016106e-01   -1.551423179386210e-01   +7.613755262625658e-01   -3.333632126276412e-01   +4.070101327970309e-01   -7.781662502501487e-01   +1.632585058192788e-01   +5.978275998007023e-01];
L2E_L2I_iGABA_netcon = [-6.817794858636254e-01   -6.729476661872064e-01   -7.236078912422331e-01   +5.478566311532599e-01   -6.679014925284840e-01   -4.348943499693790e-01   -6.533007700079541e-01   -2.557403741164546e-01; +2.317426979516125e-01   -6.813323050785749e-01   +7.822258885930153e-02   -1.315072581168708e-01   +2.467882139712657e-01   -1.284641969678847e-01   +8.619776379866292e-01   -7.590032003644965e-01; -3.746777304471700e-01   +8.024128721814394e-01   +4.144469266645990e-01   +2.065663194371271e-01   +2.363084603959915e-01   -9.088623229898570e-01   +9.172672931726220e-01   -2.508650418062148e-01; +5.086682253924595e-02   +2.420000045977158e-01   +2.895602672789700e-01   -3.495953894115695e-01   +8.696902764134040e-01   -5.744312450893732e-01   -5.453276031933891e-01   -4.332554910335758e-02; +5.505273260881126e-01   +5.028471208363094e-01   -1.936733233876085e-01   +9.803314657262124e-01   +6.911822026002846e-01   +6.099172743618135e-01   +9.354684733416303e-02   -5.636661879877857e-01; +2.436693023120690e-01   +4.709380045913169e-01   +1.506470220236684e-01   -9.973754634673235e-02   -5.520074715125839e-02   +1.133905507431324e-02   -3.609200523827475e-01   +1.122856020127642e-01; +3.770090467287580e-01   +1.333957842872782e-01   +6.039541408635364e-01   +5.209643543440537e-01   -6.631267858746250e-01   +8.189912840833657e-01   +5.919755241741381e-01   -5.276850975299785e-01; -9.066845366491164e-01   +5.771873322025061e-02   +3.246175959277526e-01   -2.434817709592221e-01   +1.077222901019016e-01   -3.592573526566706e-01   +2.546186671250812e-01   +1.000000000000000e+00];
L3E_L2E_iAMPA_netcon = [-3.360063919343599e-01   -6.221657134002400e-01   +1.317444767453103e-01   -6.824713771048029e-01   -1.594006048390082e-01   -1.866913270539026e-01   -2.623516395047604e-01   +6.541286793695601e-01   +5.670516245844208e-01   +5.856647476068418e-01   +8.794853740552158e-02   -1.560236029339959e-01; -6.396850175674591e-01   -1.324011174360227e-01   -3.326746590340809e-01   -5.487618782512468e-01   +3.665328931269620e-01   +4.213860514081213e-01   +3.761667903637594e-01   -1.060469218029400e-01   +3.400986482902553e-01   +3.252573589512477e-01   +1.332692278566715e-01   -4.975145132846210e-01; +6.487025120815918e-01   +6.605253709100133e-01   -8.411218865137654e-01   -3.809935745320147e-02   +3.404109861806341e-01   +3.564706565048670e-01   -1.926264281777867e-01   +3.488511361607035e-01   -6.046343536596657e-01   +6.240327425810249e-01   -5.321176401262341e-01   -5.257581356558230e-01; +4.388551998421265e-01   +1.423292831107259e-01   -6.048541473619188e-01   -5.865802691338841e-01   +5.686820145235453e-01   +1.258891061966783e-01   +1.106931992131061e-02   -5.503031971648383e-01   +2.340479975151038e-01   +4.230758427424107e-01   +8.647701991158460e-01   +1.293425451136364e-01; -2.292851924775004e-01   -4.293668629574031e-01   +3.692504129201831e-01   -1.832336828782577e-01   -1.092527875019945e-01   +1.809009466114722e-01   -5.401347834727737e-01   -1.536233839623599e-01   -4.490994918706968e-01   -7.423416438376134e-01   +3.670582505806078e-03   -6.869734481315343e-01; -5.910698614751390e-01   +5.463629053305451e-01   +4.774623613464763e-01   -7.831067081428579e-01   -8.047353202264464e-01   -6.083178698850966e-01   -2.795932816472374e-01   +1.844215311396113e-01   -8.331783435173766e-02   -1.464923916355104e-01   -7.473845215648199e-01   +3.985463526172895e-02; +2.459819268990369e-01   +3.467075195291684e-01   -6.446308691916647e-01   -4.535991806955451e-01   +6.174211568239704e-01   -1.973390768211764e-01   +6.229919239562463e-01   -4.780861107766254e-01   +1.812281288533504e-01   +4.353303543453367e-01   +4.856763587401314e-01   +6.615134511184076e-01; -3.060749420992206e-01   +3.980451404785433e-01   +6.480980887154891e-01   -1.000000000000000e+00   -3.146270161704554e-01   -6.249409165467994e-01   +8.861886176127662e-01   +6.852642404828884e-01   -4.776790666314256e-01   -1.522751104205228e-01   -5.726433526012135e-01   +9.704621618896577e-01];
L3I_L2I_iGABA_netcon = [-6.993974108941026e-01   +7.845254174721888e-01   -6.175283611136684e-01   -3.827484175584377e-01   -6.426251850661435e-01   -2.872546550182277e-01   +6.498180233180988e-01   -3.855711348695187e-01   -8.667100181097500e-01   -5.399338743620336e-01   -3.258778694188649e-01   +5.433317433777942e-01; +1.722960422987301e-01   -2.815680723379570e-02   +2.316685751954711e-01   +7.724089265392182e-02   +4.146168429326436e-01   +6.087223632640604e-01   +5.277291492386531e-01   +5.864395004789677e-02   +6.251590526178026e-01   +1.482780821130486e-01   +6.418586031455868e-01   -8.451043537860766e-01; +2.234028688120461e-01   +1.000000000000000e+00   +4.176597820437739e-01   -2.952443877386835e-01   +3.007762221839484e-01   -6.067872448941252e-01   -4.622470110998981e-01   +2.654361733726515e-01   +7.560746745960784e-01   +2.347569444815611e-01   +4.197302894331548e-02   +1.746980586394729e-01; -6.771264096382149e-01   -2.690431701623743e-02   +5.516057108932149e-01   -4.560748611992513e-02   -5.658354277941745e-01   +2.361962148829954e-01   +2.735884863614730e-01   +5.984895753464627e-01   -4.071168202886371e-01   -8.584587590085688e-01   -2.019098952991392e-02   -6.391014204846667e-01; +3.699263951332908e-01   -4.380033701978043e-01   +4.605973919683246e-03   -2.604504223845520e-01   +4.893164093226322e-02   -3.791127823704331e-01   -1.889494234187444e-01   +2.435076457841995e-01   -1.961910947518403e-01   +1.243240735812377e-01   +3.232943192525238e-01   +3.569371043515326e-01; +8.212430922481350e-01   -6.270507182115477e-01   -2.107211064457161e-01   -8.278806980910347e-01   -5.718451580512273e-01   +8.993667346275247e-02   -5.003078455352044e-02   +7.918647547727008e-01   -8.760521960031101e-02   -7.837522060220062e-02   -9.310801382449904e-01   +1.334028447186256e-02; -7.640223807050867e-01   +1.836890455202618e-01   -1.659694237035446e-01   -1.620387005402719e-01   -3.160851977683798e-02   -3.936553840551203e-01   -6.021600411684173e-01   +8.923856381526297e-01   +7.231690245560867e-01   -3.059488425108767e-01   +1.776851658921250e-01   -4.021907598784355e-01; +4.189396883874240e-01   +2.371014077646867e-01   +9.790281854428980e-01   +4.351163850714232e-01   +2.552816649506890e-01   +6.670318752512001e-01   -6.554880552277155e-01   -6.143861837226998e-03   +2.014011839340818e-01   -8.999904208790116e-01   +2.928241487441137e-01   +4.739953353433808e-01];
L2E_L3E_iAMPA_netcon = [+1.000000000000000e+00   +2.038039048476030e-01   -7.264638480938272e-01   -2.158565011301193e-02   +7.184512124600552e-02   -6.743510143339955e-01   -3.959264722447393e-01   -7.282831624491526e-01; +5.172874736308927e-01   +1.165648050712013e-01   -2.557026136737983e-01   -3.941190930947424e-01   -2.918789705176070e-01   +2.346159998505963e-01   +5.354465334996605e-01   +1.974082493805949e-01; +5.693591967204567e-01   +8.421926763569730e-02   +3.949316447659945e-01   +3.845719369543841e-01   -1.531934268257432e-01   +1.712675569443943e-02   -6.239661541914078e-01   +2.302331705857347e-01; -5.732518279331286e-01   -3.983821134945214e-01   -2.107244145749902e-01   -3.399156764425275e-01   +7.335690705468761e-01   -3.337548442852467e-01   -2.342438580118225e-01   -2.459464299252078e-01; +2.432925446186283e-01   -6.621212729675557e-01   -5.444107892784524e-01   +3.028337021019987e-01   +7.123605862589181e-01   -4.699423321118678e-01   +3.195496698309394e-02   -7.205443821573480e-02; -5.266723672013989e-01   +1.101029305787476e-01   +5.744581419271135e-01   -9.099672599047917e-02   +5.627565149816411e-01   -3.295368722590609e-01   +3.716977029832025e-01   -6.203050469441892e-01; +1.976717738614369e-01   -3.432962081061016e-02   -1.217516180103779e-01   +2.798074066933383e-01   -3.139944997832061e-01   -2.550521513836412e-01   -2.184344870921209e-01   +3.176431745080626e-01; +5.331837344375728e-01   +5.182302879434717e-01   -8.567518520378884e-01   +2.310011253004260e-01   -2.946565432163247e-01   -3.266535085597756e-02   -1.139836032320485e-01   +7.112861531395162e-01; -2.654782091720247e-01   -6.032997033327887e-01   -9.912832677553973e-02   -3.955579294720945e-01   -6.515244715346905e-02   -4.140980026073665e-01   -1.650953528352433e-01   -6.475846118960689e-02; -8.236876772948472e-02   +2.574064221461547e-02   -3.828480586575526e-02   -1.659169280432267e-01   -5.558228273493297e-02   +6.536279282355223e-01   -1.426126936758200e-01   -3.832834592466412e-01; -6.769860745580853e-01   -2.206201717217529e-01   -7.990472037441114e-02   -7.028900621404513e-02   -5.261971527950736e-01   +2.852479478206910e-01   +3.547244212234757e-01   -8.828378343301821e-01; +8.311606976008612e-01   -8.604763706139360e-01   -9.847846835978886e-01   +2.932420000108369e-01   -6.689572186907307e-01   -2.734065644490566e-01   -6.245410144777225e-01   -1.171649885528483e-01];
L2I_L3I_iGABA_netcon = [+6.163018213321981e-01   +8.886536063683934e-02   -2.854277703801407e-01   -4.842075508256388e-01   +6.828023628570670e-01   -4.653040951754135e-01   -7.451018323353793e-01   +6.273472005665515e-01; -9.075474160341458e-02   +6.745097692143065e-01   -7.474303405795764e-02   -3.915924077469418e-01   -6.603055345959481e-01   +4.744157622236666e-01   -8.407817291920479e-01   +2.687147063385890e-01; -4.225487120119368e-01   +3.897287914015873e-01   -1.050252601993649e-01   -2.166506451495192e-01   +1.936209581202479e-01   +2.114587632753274e-02   +9.981120491133407e-01   +6.526709463240328e-01; -3.806622573496924e-01   +4.382652913556199e-01   -3.430162877985852e-01   +3.249055879333971e-01   -5.092238954645778e-01   -5.494190954426054e-01   +2.712988302739385e-01   -8.599893031266976e-01; +4.012168122864873e-01   -5.721619432191606e-01   -4.546853804462076e-01   -3.482929040783773e-01   -9.869477931209195e-05   -5.240601311726972e-01   +3.806575511050468e-01   +9.588627158226200e-02; +6.950724423083062e-01   -2.233998998569476e-01   +5.017151502026164e-01   +1.423918554861643e-01   -1.563894984404649e-01   +3.797718190732471e-01   -3.762936007946703e-01   -2.414992970139356e-01; -5.057581851867904e-01   -5.208594793190834e-02   +2.695471749972352e-01   +1.279154443301712e-01   +4.265333965838332e-01   -1.378647110885691e-01   -3.956847866367504e-02   -1.331300021929382e-01; -9.701188795358772e-01   +3.472709289505754e-01   -6.544878640434497e-02   -1.113865748284383e-01   +4.789523000081499e-01   -1.000000000000000e+00   -7.268803302657856e-01   +1.928254567295881e-01; -6.432367265956866e-01   +5.427823223526111e-01   -4.511999642060189e-01   +4.311769491080501e-01   -2.542649039226339e-01   -1.030892301965593e-01   -2.318310675387975e-01   -5.684180923008636e-01; -2.420536840338418e-01   +8.034564913161069e-02   +3.011278988076027e-01   -5.308972756384856e-02   +2.142169685304657e-01   -4.977715771214113e-01   -5.582511342856736e-01   +5.537517502804760e-01; +4.282152228661847e-01   -7.166499308820642e-02   +3.708167056811950e-01   +1.206031592297067e-01   +8.221335865233333e-02   +1.296546250454889e-01   -6.514910284964510e-01   -6.365826519239112e-01; -2.915464097118415e-01   -4.652403116061885e-01   -5.548767516579552e-01   +4.578914822809255e-01   -8.805324424104753e-01   +1.561679246987474e-01   -4.220395097818991e-01   -1.878184332302664e-01];
L3I_L3E_iAMPA_netcon = [-3.374860091634916e-01   +2.340100178595399e-01   +4.816156588288974e-01   +1.108621928785982e-01   -1.155938108046010e-01   +6.165652221772752e-01   -1.378718917499483e-01   -1.039325331342864e-01   +3.251389428040712e-01   +6.296527374189921e-01   -1.554090912888562e-01   +1.075794455926947e-01; +6.237349892066660e-01   +2.493469965286480e-01   -5.289683483054980e-01   -6.904402983775133e-01   -8.821384643912294e-02   -6.201541582369623e-01   +7.098079889364491e-01   -7.044202671032036e-01   -6.305880175129696e-01   +5.387141780744968e-01   +2.935699678977134e-01   -8.455384688889648e-01; -1.212749140531625e-01   -5.971505352007284e-01   +5.417868217283076e-01   +4.517435441687566e-01   +1.816969319718763e-01   -8.289658458191608e-01   +6.130133203098554e-01   -9.513781853940027e-01   -1.817961429868126e-01   -2.850385331335081e-01   -2.313902629291504e-01   +7.066432918951454e-02; +5.108196823353984e-01   +6.137219783123403e-01   -5.986806810201504e-01   -5.385331952491932e-01   -6.367674099430978e-01   -4.658606411889537e-01   +5.131962915761304e-01   +5.121109702006158e-01   -1.580127372314365e-01   +2.334836418867513e-01   -2.854738023192587e-01   +5.290902362552876e-01; -9.884796663211123e-02   -4.018603299957071e-01   +1.996279585586783e-01   +2.233090392378171e-01   -3.426924615719558e-01   +2.259981189863718e-01   -3.613891974539509e-01   -2.558812385400414e-01   +1.012599540414603e-01   +5.646679692786443e-01   +3.716549350456880e-01   -2.882200899334635e-01; -1.624281343341111e-01   -4.954757910200365e-01   -4.336281339433223e-02   +5.105516959802334e-01   -1.087481206649211e-01   -3.780599765013035e-03   +3.727288822937515e-01   -1.782812143252578e-01   +6.901726110277993e-01   -8.910181633590045e-02   -7.641771392495041e-01   +5.523083106975261e-01; +3.697476929367548e-01   +8.343419473070278e-01   -1.000000000000000e+00   +7.090410602469513e-01   -1.649333974264730e-01   +5.973837552635476e-01   +4.138449324424703e-01   +1.784916971616609e-01   -3.218307531573114e-01   -2.997196116985850e-01   +6.659935368026212e-01   +5.505173651121750e-01; +7.747123946296136e-01   -4.922186957901718e-01   -5.002549359692463e-01   +1.021130525516452e-01   +1.092748007744097e-01   -4.579235791901996e-01   +6.085438338498707e-01   +6.086226159371696e-01   -2.709852842045945e-01   +2.288996872754235e-01   +7.828523053965953e-01   -8.424076548370178e-01; -4.372237622612115e-01   -4.606898457055492e-02   -7.634727997722790e-01   -4.592158036254189e-01   +5.681467753237694e-01   +5.052523367816402e-01   -1.476838666571166e-01   -8.137147386594046e-01   -5.920463437185125e-01   -1.221275389752278e-02   -5.889831409910898e-01   +2.791415106780522e-02; -5.770438767265854e-01   -5.809474085522944e-01   +7.404399096001898e-01   -3.194943597424064e-01   +3.393485229931355e-01   -6.232305851421588e-01   -4.252411639274470e-01   +6.119820091318291e-01   +2.774589288831609e-01   +4.444879512508979e-01   +2.731369841375881e-01   +3.803164501844989e-01; -2.270826945049836e-02   +8.541261056849841e-02   -2.118173331173555e-01   +4.649791412224217e-01   +1.722048157641610e-01   -3.342575346891960e-01   +2.897479293010732e-01   +2.586104556384885e-01   -6.320524158986250e-01   +3.316532377003968e-02   -1.174028829829293e-01   +6.706773253755903e-01; +3.675940989115341e-01   +7.669761132745982e-01   +8.468924483722286e-02   +5.997316909306920e-02   +7.083769189554178e-01   +2.496532100163056e-01   +3.750341104512336e-02   -7.316776518426805e-01   -7.904531031370439e-01   +6.596189327006804e-01   +1.644687725260472e-01   +8.841823480083546e-01];
L3E_L3I_iGABA_netcon = [+5.992710789975135e-01   +9.042066695963081e-01   +8.482561770740600e-02   -2.428487922872219e-02   -4.315813515925074e-01   +6.660779628202896e-01   +3.251003565548839e-01   +9.751079260712699e-01   -8.874408860442483e-01   +2.874410942697395e-01   +8.808789047344640e-01   -5.942312079624734e-01; -1.155232355286363e-02   +5.216779632198167e-01   +3.058986028502375e-01   +2.584300550491805e-01   +5.233468903513746e-02   +2.784404082614916e-01   +8.236486403854426e-01   +3.958471512101195e-01   +4.506028761188256e-01   +5.869134148660158e-01   -2.393626201381845e-01   +2.584531402739396e-01; -1.239061582779295e-01   +2.414805184415911e-02   +1.405063305464252e-01   -3.790107543344555e-01   -6.725764428294079e-01   +7.480968454914797e-01   -2.442162749306882e-01   +6.622711928909488e-01   +7.074193462839745e-01   +4.262547319521857e-01   -9.442559462704233e-01   -3.332160317960269e-01; -9.041156031525048e-01   +6.257572106414294e-01   +7.149388112171833e-01   +2.934509161830496e-01   +8.017462240001197e-02   +3.941402421930116e-01   -4.690542985866854e-01   +2.537786813906416e-01   +4.802735334371838e-01   -3.728992435329241e-01   +1.704011462235068e-01   -4.687515068043219e-01; +5.811602048359910e-01   +1.002838026432096e-01   -9.520010954520247e-02   +6.360057556323869e-01   +4.466270680703281e-01   +5.119539290886387e-01   -5.869062100433727e-01   +9.794568608404952e-02   +3.021283960537532e-01   +4.522705205323885e-01   +9.363546751622153e-01   -5.252676785458831e-01; +7.857715475129978e-01   +3.335505589358192e-01   -8.227170941089571e-01   +2.021817951695156e-01   -7.433583487943599e-01   +4.607027076374659e-01   +6.351398768021831e-01   -4.489361375567687e-01   +9.300374809501812e-01   -5.969570668815686e-01   -2.918204170748199e-01   -6.036451970360402e-01; +9.826347451496099e-01   +4.051682283745129e-01   +6.665717233529309e-01   -3.808312366662472e-01   +4.684812054226224e-01   -2.183592900228856e-01   +4.293995391570472e-02   +8.025123582980344e-01   +5.270722493640753e-01   +3.481125886434768e-01   +5.487079781823991e-01   -7.504585852951441e-02; -2.730328151856948e-01   -2.304734150656252e-02   +2.289232596639478e-01   +6.775539597933714e-02   +7.986048764656458e-01   +7.235504856733117e-01   +1.532727483038271e-01   +1.634985937602455e-03   -2.890234127646583e-01   +8.685801507428115e-01   -4.338686075799152e-01   +3.936100145394438e-01; -7.383250285849309e-01   -2.679465534676561e-01   +9.157257843957310e-01   +8.517911345964828e-01   +3.892383888971939e-01   +5.133259217057147e-01   -1.778566303184214e-01   +3.768112923693964e-02   -3.962447404143661e-01   +7.814603048843617e-01   +5.410071737198126e-01   -4.183043811195810e-01; +6.749918288552448e-01   +5.228200092630466e-01   +8.496345514785898e-01   +5.855175507012675e-01   +2.275271202818286e-01   -3.021549065501692e-01   -5.156239411673850e-01   +3.254870079054312e-01   +3.911221740079711e-01   +1.707948167651662e-01   -4.339771978583270e-01   -3.475028681042628e-01; +7.614890632145457e-01   +2.348703550056112e-01   +3.406171123144183e-01   +4.987311188731002e-01   -2.138633129050740e-01   -3.935747984960476e-01   -8.935115408425014e-02   +2.213321401946637e-01   +3.864101719623746e-01   +3.434272368309022e-01   -3.748885636566142e-01   -4.612172208215877e-01; -6.145722265642388e-01   -1.237437960561269e-02   -1.036745312997714e-01   -1.000000000000000e+00   -4.098755823298927e-01   +4.347438642550764e-02   +3.937180315903155e-01   -3.967430663035171e-01   +7.175216693559480e-01   +6.045841067717886e-01   -1.698173654000813e-01   -1.063455559919413e-02];
L2E_Input1_iAMPA_netcon = [-1.075691231363815e-01   +7.743625651586018e-01   -1.517040828654699e-01   +4.289556916361655e-01   -1.000000000000000e+00   -1.841358915365965e-01   -7.613015178647927e-01   +2.001580880543089e-01];
L2I_Input2_iAMPA_netcon = [+1.000000000000000e+00   +3.913920788504200e-01   +9.094722084811608e-01   -6.075791855493827e-01   +5.018954770201350e-01   +7.864176721706595e-02   -7.211869988918902e-01   -3.061399366763621e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last =  11.21 * ones(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))*0.4 + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.5*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.5*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))*0.9 + 0.5*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))*0.4 + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.5*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.5*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))*0.9 + 0.5*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
