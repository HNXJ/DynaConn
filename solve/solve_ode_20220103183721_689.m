function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+7.149726233193828e-01   +9.494089302253383e-01   +7.027602709268349e-01   +1.585240888487289e-01   +9.259459293767074e-01   +2.176409219729948e-01   +7.432735167419680e-01   +3.073277024963534e-01   +5.349290882118323e-01   +8.328470784067364e-01   +9.713768132775156e-01   +9.689404810873410e-01   +6.986652168011550e-01   +3.698372803404948e-01   +2.986046506802434e-01   +3.798873672154340e-01; +3.493112480714788e-01   +1.384992488751228e-02   +1.406178232004120e-01   +1.748664051102204e-01   +7.647721124997363e-02   +8.132196026600036e-01   +7.959618882807417e-01   +7.575570405905206e-01   +7.897536193088646e-01   +1.867187480665715e-01   +4.713864841956896e-01   +6.612006998070649e-01   +3.726680971114762e-01   +2.774784550910415e-01   +6.864148394490912e-01   +9.566337283803688e-01; +2.052246578872517e-01   +4.739863736828171e-01   +8.290179206767380e-02   +7.089366971085982e-01   +3.108299535852646e-01   +3.853728108127896e-01   +6.632865645089874e-01   +9.556854914931890e-01   +4.816920425139861e-02   +9.264368636610596e-01   +8.707772069319224e-01   +2.056292302537767e-01   +5.434696764190816e-01   +7.596229318621402e-02   +7.769146122307098e-01   +8.136630581326688e-01; +2.386667372585028e-02   +4.901704380819614e-01   +4.326385140840156e-01   +8.367135259345748e-01   +6.339635346575739e-01   +8.635728587274860e-01   +4.393566213938775e-01   +8.715703244712042e-03   +4.614837825215148e-01   +4.255251866061907e-01   +9.463961897600459e-01   +8.969393197960922e-01   +5.145357626199992e-01   +1.514923318440952e-01   +7.224054295470236e-01   +8.944751533136327e-01; +7.653283501571062e-01   +5.177673425274631e-01   +9.002655215931995e-01   +8.193780549855376e-02   +9.094339876827134e-01   +3.217925202701046e-01   +5.781764978582979e-01   +4.044902426300948e-01   +9.439435218779314e-01   +2.982337868090880e-01   +2.356292170995448e-01   +4.862977858751142e-01   +7.683085302872474e-01   +3.682715327508079e-01   +2.776353554944985e-01   +7.206107180211720e-02; +5.736125833476317e-01   +2.872630372632129e-01   +7.299016631925956e-01   +8.406764560436673e-01   +7.976337887175087e-01   +3.796883974387748e-01   +5.206742636603948e-01   +1.540129368449742e-01   +4.731442983829345e-01   +3.522994662572462e-01   +9.220692166464560e-01   +6.652328393084840e-01   +7.935435507508778e-02   +7.140076478880002e-01   +1.657326292193888e-02   +9.039753087348513e-01; +5.798091687152213e-01   +5.642731982185092e-01   +6.816986416223857e-01   +5.455147037034723e-01   +6.444114124677982e-01   +6.402877506275736e-01   +7.247430294178229e-01   +8.244035064438248e-01   +7.810543331275783e-01   +9.750517417744133e-01   +6.321465318990861e-01   +5.273942841504587e-01   +1.033423928260544e-03   +5.368305671332680e-01   +1.599687242108696e-02   +6.678887667564616e-01; +3.877608961698226e-01   +5.105346766267306e-01   +2.017247069735925e-01   +9.697839974223622e-01   +4.452124403670258e-01   +3.894973289992806e-01   +2.225539880250414e-01   +2.893877728936005e-01   +1.100735130058915e-01   +5.371896542536021e-01   +2.880197479926750e-01   +7.073363553972002e-01   +4.058861169731829e-01   +2.315112254575751e-01   +9.352816054091483e-01   +3.471664445408714e-01; +5.540322600181593e-01   +6.747939059991847e-01   +5.298880506445498e-01   +6.773885952526919e-01   +7.494546415666231e-01   +7.307841507536002e-02   +9.987665828859909e-01   +9.780204897872399e-01   +5.205003593542681e-01   +7.897874334655456e-01   +8.521465107268167e-01   +7.222494787816782e-01   +6.629666007858747e-01   +4.738631169980421e-01   +9.360765044036297e-01   +8.381448380773143e-01; +1.864197118377199e-01   +6.174763251294590e-01   +8.289251112365025e-01   +3.349608749007486e-01   +8.294125867965616e-01   +1.846814303389332e-02   +6.242730876983655e-01   +6.246236368503427e-01   +6.372001444358425e-01   +7.994588367013979e-01   +1.653118224589926e-01   +2.941084026807725e-01   +3.727017314487904e-01   +7.173945988079242e-01   +3.782316812527515e-01   +1.935564743706785e-01; +1.194049641924368e-01   +5.639872353356570e-01   +1.747068656328435e-01   +2.180033679795869e-01   +3.427890921644314e-01   +8.792781746542033e-01   +9.840204173129915e-01   +7.482025502010966e-01   +5.770494649608335e-01   +1.423663677531486e-01   +8.283630479832477e-01   +1.143627670420506e-01   +3.956648167591074e-01   +5.198169655015640e-01   +1.086336985661366e-01   +8.432938117892238e-01; +6.077970264094848e-02   +5.044232513196721e-01   +5.177030428287721e-01   +5.707350130408830e-01   +1.422126379854356e-01   +1.562046907038840e-01   +4.996341406051078e-01   +8.791407619870615e-01   +8.385147880240732e-01   +4.525746882005147e-01   +2.153523388354357e-01   +3.271477298879837e-01   +1.344980813525247e-01   +5.182516124124141e-01   +7.249871772196391e-01   +4.270561666778298e-01; +9.373896627782131e-01   +6.654020790864946e-01   +3.582572695989658e-01   +2.571489289314630e-03   +5.030196810633480e-01   +9.208594979148379e-01   +5.235792612803563e-01   +3.292225338573473e-01   +1.145118561855951e-01   +4.577598379698473e-01   +2.667065714785684e-01   +4.601826990101707e-01   +3.422531317104506e-01   +3.890765503743282e-01   +4.543853814800102e-01   +5.595505201315019e-01; +7.439887762389953e-01   +6.381681040400523e-01   +6.503299998571259e-01   +5.916808967432597e-01   +4.134940189314863e-01   +5.625062067175441e-01   +8.558771971133456e-01   +9.768317361631988e-02   +5.029596375531543e-02   +9.590464045176940e-01   +8.967539619174288e-02   +7.151606596116767e-01   +1.187090812541359e-01   +4.827898218171774e-01   +1.441439534590344e-02   +4.489675613419007e-01; +2.407194275163297e-01   +1.424575921827320e-01   +2.830291727959768e-01   +8.957640454960979e-01   +1.749082990054912e-01   +9.255429339821838e-01   +2.518830712718090e-01   +4.504253253776747e-01   +5.215578939963861e-01   +5.396382010121380e-02   +9.174189653187270e-01   +4.049118690369589e-01   +3.717881264613012e-01   +7.447867859124976e-01   +1.212354393948869e-01   +7.589261502842609e-01; +2.037491457169476e-01   +1.768991949322860e-01   +4.324773404643377e-01   +2.566710031190531e-01   +4.939728473207227e-01   +5.972396888882512e-01   +5.803123434587599e-01   +2.386587083085021e-01   +6.996072331206132e-01   +3.438001943900628e-02   +7.301924212645970e-01   +2.406486319926746e-01   +2.497311516251401e-01   +7.056190205301540e-01   +6.606530265480064e-01   +9.622335105828481e-02];
L1E_L1I_iGABA_netcon = [+8.409130061048653e-01   +7.491693948127133e-01   +8.737184934771440e-01   +4.376622636569453e-01   +9.218176961061758e-01   +7.737532998611536e-01   +3.202901598553807e-01   +6.395721585938515e-01   +9.606619025298703e-02   +2.567790480283523e-02   +1.327800681106092e-01   +5.231921795073049e-01   +8.690805441414263e-01   +5.745879125564403e-01   +1.682338681740313e-01   +6.285584075565621e-01; +6.185509486683787e-01   +9.930026862841380e-01   +3.112900569229963e-01   +1.521325336633513e-01   +8.830914591934114e-01   +2.754717309696620e-01   +9.654591540041307e-01   +4.326127244077261e-01   +2.932365808101891e-01   +5.120085228635413e-01   +4.272017270557460e-01   +2.034258828594975e-01   +8.075844487013281e-01   +2.902522372206568e-01   +5.721912928894075e-02   +3.369815489392441e-01; +6.674788300494726e-01   +3.708869288153863e-01   +4.336119109818464e-01   +6.514825390210339e-01   +5.861869450145621e-01   +5.253899820151142e-01   +3.541497556523759e-01   +4.831758184221602e-01   +3.265673899907210e-01   +8.635444408941746e-01   +4.820047892748061e-01   +7.730033724989344e-01   +6.407731758327236e-01   +1.376879441814791e-01   +2.140510334369982e-01   +1.538087665900143e-01; +7.807965746483803e-01   +5.029737469188670e-01   +3.794293013205877e-01   +7.244265314193639e-01   +8.390872156449575e-01   +4.069378386509331e-01   +3.192980058951798e-01   +1.001939676476426e-01   +4.812465548256851e-01   +5.838883625375645e-01   +6.718185747596090e-01   +3.888417241317371e-01   +7.331780611307274e-01   +4.540764328854446e-02   +2.046877540479040e-01   +3.977495446931104e-01; +3.125414575185390e-01   +7.558309438640696e-01   +6.567374757605492e-01   +1.654662249236640e-01   +7.782407779982976e-01   +7.796847189494926e-01   +9.110544816038477e-01   +8.088109394531179e-01   +2.416609250475797e-01   +4.219640872329257e-01   +3.553419217814343e-01   +6.641464326074502e-02   +6.690853451590310e-01   +6.208366057713891e-01   +2.185785340660309e-01   +9.100152478114174e-01; +3.285626151112998e-01   +1.321189769374820e-01   +2.423744730260928e-01   +3.386839807603420e-01   +7.885742076345982e-01   +2.749538434705351e-02   +8.825026323169175e-01   +6.104081434138892e-02   +4.556198655002789e-01   +7.184187249646309e-01   +5.048409823098633e-02   +7.562492969597414e-01   +8.832258052481669e-01   +6.066171371016154e-01   +5.825906980781557e-01   +1.516195672451987e-01; +6.339844126066332e-01   +5.147011682579333e-01   +6.871863029219379e-01   +1.045135809912426e-01   +6.966963993414206e-01   +4.087468887008488e-01   +3.535733234005760e-01   +9.547546742446262e-01   +7.549479177082462e-01   +2.285629632770134e-01   +2.918874615927513e-01   +4.557382177060248e-01   +8.556370352453725e-01   +3.696730518671771e-01   +3.612282221873720e-02   +4.658751406072752e-01; +8.985955324211709e-01   +9.073822401698477e-01   +3.305324737890240e-01   +3.997125389966591e-02   +2.119124799562582e-02   +8.260088007103364e-01   +7.458500230902960e-01   +7.732974334644603e-01   +7.188953626167317e-01   +5.750666015218529e-02   +7.979843723802549e-01   +3.193268085889290e-01   +4.083061478664831e-01   +8.340881383756747e-01   +7.937223971890682e-01   +7.504578093445426e-02; +3.730787973979942e-01   +1.009286159188236e-01   +8.795315468085242e-01   +4.795181440076893e-01   +3.242327143697875e-01   +5.916849055200355e-01   +1.244836245188074e-01   +4.407029121896494e-01   +2.320954029096012e-01   +9.777543791582561e-01   +6.538582701508131e-01   +2.749155149092591e-01   +1.089403496745326e-01   +5.199635876886879e-01   +1.339181645207796e-01   +3.413133730671816e-01; +8.846269863892074e-01   +1.791318093522600e-01   +1.000000000000000e+00   +4.784000879139147e-01   +9.431301899800806e-01   +2.126249049273837e-01   +5.948484153846795e-01   +1.632736404013398e-01   +6.985894331527337e-01   +9.724515323705893e-01   +7.069817735046807e-01   +5.798166269883777e-01   +4.058458430691471e-01   +8.040556429518011e-01   +5.837327654169970e-01   +4.941307627795517e-01; +1.231486063641418e-01   +1.768820485693839e-01   +6.836278624215584e-01   +5.492673902066318e-01   +4.045114324270313e-01   +2.958657990025120e-01   +4.389552538205100e-01   +8.273396688197174e-02   +3.065968621408588e-01   +1.337181140387045e-01   +7.636221542476557e-01   +9.079473874223895e-01   +3.413085724189894e-01   +5.725665919647670e-01   +8.555498304934377e-02   +4.934116180097229e-01; +9.049315228418760e-02   +5.348187207158704e-01   +3.464944263436198e-01   +6.536872333550480e-01   +6.311193843276958e-01   +2.665177302898369e-01   +9.616055943909286e-01   +7.406639578601305e-01   +4.640875861293906e-01   -2.640140585493792e-03   +3.853042438505211e-01   +4.506851801932322e-01   +1.147367656144269e-01   +7.167951193495403e-01   +2.248906462935598e-01   +1.307494944128697e-01; +5.489357002315114e-01   +9.759868091505264e-01   +5.612331167530564e-01   +3.483299939771103e-01   +8.537906354536900e-01   +9.275677593222060e-01   +9.684462756586802e-01   +5.393448779194929e-01   +4.407330949635899e-01   +9.332600272190266e-01   +3.623631879635217e-01   +9.781856521566259e-01   +8.544593847992786e-01   +7.354093139194816e-01   +4.511028965399077e-01   +7.939865779327213e-02; +6.075543577068024e-01   +8.463825295819534e-01   +8.918527188770529e-01   +2.531540946620061e-01   +3.723715242381639e-01   +5.511813079933836e-01   +2.434518675011282e-01   +4.851275217155749e-01   +7.341650306961195e-01   +7.355343266643946e-01   +8.099292677892115e-01   +1.073010963919454e-01   +8.897539683861005e-01   +4.493173063498922e-01   +1.776624545387616e-01   +6.728249002969445e-01; +7.259353983741844e-01   +6.727328230994215e-01   +6.472524584496666e-01   +1.786382795804259e-01   +2.016714540247681e-01   +4.340938902465121e-01   +7.716062501906896e-01   +8.895989957676539e-01   +8.770348437207702e-01   +4.306121020801975e-01   +3.904445052557775e-01   +4.175681653208449e-01   +6.880426590023063e-01   +2.808605359076317e-01   +4.127049326350019e-01   +1.202984168459261e-01; +9.949260520928811e-01   +1.065577519414164e-02   +3.738210626425555e-01   +4.760079557765037e-01   +9.094058718279028e-01   +3.252670138518345e-01   +7.089880787983561e-01   +5.834992996099174e-01   +9.113099751802551e-01   +9.457283661021978e-01   +8.759077101952684e-01   +3.879416276411196e-01   +7.449204213771690e-01   +1.538458944214097e-01   +9.677509389253213e-01   +9.915932427895412e-01];
L2I_L1I_iGABA_netcon = [+5.723835801545069e-01   +5.633310060107161e-01   +1.059902411468492e-01   +4.559769642734331e-01   +7.970613504047438e-01   +9.787754754491591e-01   +2.252014021151240e-01   +7.621718468658015e-01; +5.590767771225501e-01   +9.504127524569889e-01   +1.207385956231506e-01   +5.645795990805229e-01   +5.453153135775737e-01   +4.242370559762945e-01   +6.486312833584720e-02   +5.018630549575968e-01; +6.116250906360896e-01   +1.117189204453340e-02   +4.353995393227814e-01   +8.188373911747153e-01   +2.608467030862658e-01   +3.906102185729329e-01   +8.329769214391219e-01   +8.297519005832579e-01; +4.679488727571651e-01   +1.278319304948846e-01   +9.317758504226218e-01   +3.565953617410735e-01   +7.852068996789473e-01   +4.626652178479324e-01   +4.447715289442946e-02   +9.219179797824065e-01; +4.341453102712948e-01   +8.555412298439157e-01   +1.372573589140080e-01   +2.486049883595082e-01   +7.788194830954599e-01   +1.222960513320834e-01   +9.087961821628554e-01   +7.100435085769666e-01; +6.472964121156947e-02   +2.171350527031669e-01   +8.262902894195920e-01   +7.670369507816013e-01   +1.438048675646854e-01   +4.599159964172826e-01   +4.553671395254635e-01   +8.002168436175241e-01; +6.436625206810377e-01   +7.068069880924476e-01   +9.299314456000174e-01   +3.387552411664146e-03   +8.246930274053839e-01   +2.625518810524041e-01   +2.822709012449008e-01   +9.588047341506344e-01; +4.223080805641737e-01   +7.762072726428187e-01   +5.741334025534716e-01   +2.732000003029803e-01   +6.236706360997079e-01   +9.715505986114181e-02   +7.589086860288086e-01   +9.517844570175434e-01; +7.546142923338413e-01   +4.231446156147274e-01   +5.011285781330294e-01   +2.815701353933157e-02   +4.562552807016743e-01   +6.606645194834541e-01   +9.244137863184780e-01   +2.991163474606930e-01; +3.086153176029362e-01   +7.289943585456070e-01   +9.331496449391716e-01   +6.662386804942459e-01   +4.831908483580226e-01   +9.442340370922089e-01   +1.384957109046945e-01   +3.512833940823810e-01; +5.981029636259850e-01   +4.587088841632615e-01   +8.595517767169339e-01   +9.695839810793961e-01   +2.206821184451452e-01   +7.599501724727242e-01   +9.512416071230498e-01   +5.444673916956337e-01; +3.335721870870786e-01   +8.079989328129198e-01   +2.528807523980767e-01   +9.454826984578485e-01   +8.585169020431723e-01   +4.007992355731053e-02   +3.073105358797150e-01   +2.126352509280619e-01; +6.443164453685933e-01   +4.327989785751550e-01   +4.586100562176740e-01   +4.701107266731794e-02   +8.786509502054040e-01   +2.641056033931726e-01   +2.086124108034456e-01   +8.406500981036426e-02; +3.533514200309728e-03   +1.498819374722496e-01   +7.400549569261761e-01   +2.910238614526691e-01   +8.412297505017081e-01   +6.389137387243968e-01   +4.647146405289959e-01   +5.071903635551396e-01; +1.458375444734065e-01   +8.033260142934752e-01   +7.528077171276706e-01   +4.873836165356444e-01   +4.398178050433045e-01   +9.275467857097240e-02   +5.946596739370836e-01   +1.975212884314609e-01; +2.488818213394077e-01   +3.813846597395779e-01   +2.354811826610833e-01   +8.854079935349511e-01   +5.422681045348350e-01   +7.840581834829322e-02   +5.533114113841687e-01   +1.461812935038215e-01];
L1I_L2I_iGABA_netcon = [+7.009758695596336e-01   +8.684569397830755e-01   +6.123978510818801e-01   +5.211481163320659e-02   +1.444596168384600e-01   +2.341807606777400e-01   +8.403650937092914e-01   +3.691131463067913e-01   +7.109710663361443e-01   +3.828383279828774e-01   +2.402845112908595e-01   +6.664529729324641e-01   +1.659106377048214e-01   +5.723252001404404e-01   +4.096960055566883e-02   +4.516621443612649e-02; +6.023081844425130e-01   +8.000600091526003e-01   +6.133191902358239e-01   +5.681345171975373e-02   +7.445532256334837e-01   +5.561970840717393e-01   +1.994673012109616e-01   +5.599331597336711e-01   +1.846134353065812e-01   +7.230322676076375e-01   +5.084446895388881e-01   +3.333692052062616e-01   +1.096799191680828e-01   +8.095084039779640e-01   +4.371632110351578e-01   +9.226298889340191e-01; +1.652940094629643e-01   +6.224125088733728e-01   +3.103912100531621e-01   +5.967021140159640e-01   +9.523680691963226e-01   +1.109953752453778e-01   +6.185736557696504e-01   +8.277879569490214e-01   +2.322049957076884e-01   +6.375412396502873e-01   +7.325829820000923e-01   +5.478115008526617e-01   +7.397470249213877e-01   +6.767766957308884e-01   +9.207937274899076e-01   +1.733182596807455e-01; +4.849814743621170e-01   +4.739394012252638e-01   +1.379722608484920e-01   +6.612935794337274e-01   +2.614350278061377e-01   +8.178800798863951e-01   +1.552644766740143e-01   +7.121133817330106e-01   +1.000000000000000e+00   +1.012648616716312e-01   +7.743920314469137e-01   +5.364147295861483e-01   +2.144678337406263e-01   +4.385926371559584e-01   +8.817261814213339e-01   +7.429435568572335e-01; +2.878330494625522e-01   +2.069055949504226e-02   +5.984828793825033e-01   +4.818684138745339e-01   +9.185838381555358e-02   +6.546684130006534e-01   +5.791752778708587e-01   +1.175672482038799e-01   +9.059541106417708e-01   +4.921002181300443e-01   +6.782544055073536e-01   +8.992755589029985e-01   +4.834560225674528e-01   +8.930506394856341e-01   +9.404391811735420e-02   +4.738151029910126e-01; +4.031532227300774e-01   +1.201602257915508e-01   +8.921806296688294e-01   +9.770274396076944e-01   +2.329253923603552e-01   +2.373974511863751e-01   +5.406463038248522e-01   +7.383794606317342e-01   +1.073268741209248e-02   +5.599892118476251e-01   +8.172715107094538e-01   +2.834319177086709e-01   +5.486114994492951e-02   +7.842691777033226e-01   +6.754318012914826e-01   +2.505523069730842e-01; +4.950550437340526e-01   +7.165760882961988e-01   +5.598136857230118e-01   +8.638596992283195e-01   +8.921460431431125e-01   +3.033448847031741e-01   +6.840170037188784e-01   +9.214503701071531e-01   +8.310147597514522e-01   +5.360938094673662e-02   +4.168542563897153e-01   +1.383753331323481e-01   +5.744575535414496e-01   +5.847650286368945e-01   +9.896519290392159e-03   +6.675815586074901e-01; +8.613423560679574e-01   +6.762961558355942e-01   +6.333017604929242e-01   +9.515757127435841e-01   +1.944126208642877e-01   +3.300575188764429e-01   +6.955051433784620e-01   +9.214383613655703e-01   +2.518914749410215e-01   +8.726370646911211e-02   +4.943487599020995e-01   +9.563832495594089e-01   +4.942923682284999e-01   +6.189720120885880e-01   +1.208358948654120e-01   +6.093189996574698e-01];
L2E_L1E_iAMPA_netcon = [+3.682523216249908e-01   +5.608549763606344e-01   +2.034062014004538e-01   +5.126302043714753e-01   +2.900309915224378e-01   +7.271214695799771e-02   +2.770540906874049e-01   +2.646937878420438e-01; +4.336210450202853e-01   +1.895214809179364e-01   +1.342879052451612e-01   +6.844152229793932e-01   +6.212030582745421e-01   +5.913358242105786e-01   +9.287126787334604e-01   +9.005607136016149e-01; +7.158209593193468e-01   +6.081000074729704e-01   +8.209350380137162e-02   +2.050926350033704e-01   +8.686491668387724e-01   +8.130208143226898e-02   +7.651386972014280e-01   +1.552610102078143e-01; +1.941237628578862e-01   +7.368576270153373e-01   +9.390610042531723e-02   +9.738733964755041e-01   +8.189835035748397e-01   +3.989397245683610e-01   +2.627385828077082e-01   +5.519096856179933e-01; +4.163590253065725e-02   +8.329680987350285e-01   +5.516681373875677e-01   +3.512406908556978e-01   +2.076610078151307e-01   +5.717794310899411e-02   +2.428546683292209e-01   +4.198221224729576e-01; +3.163421351931260e-01   +2.763547367716816e-01   +7.304715138612278e-01   +1.830693303130490e-01   +7.521736356487774e-01   +1.252245049901401e-01   +1.645898826619868e-01   +5.492424922603789e-01; +7.874215176483076e-01   +6.099513034837910e-01   +5.454827796374857e-01   +2.410268915320422e-01   +1.986399319791563e-01   +2.460009234269866e-01   +2.895097586114024e-01   +7.504317821135076e-01; +4.597465898464805e-02   +5.486732350012532e-01   +5.316041043502820e-02   +2.566790677797082e-01   +5.776689830377089e-01   +9.478645739198954e-01   +5.642874984199820e-01   +1.136685611078687e-02; +2.158270129172644e-01   +2.778706918946614e-01   +6.339269974910960e-01   +2.235394868607445e-01   +8.758646996376751e-01   +2.025785406068499e-01   +4.009296585530620e-01   -3.068525896174261e-03; +2.716775777120647e-01   +3.409197006714186e-01   +9.924643822385801e-01   +3.691355501970552e-02   +7.151440168680905e-01   +3.271794064988732e-01   +9.872546860758310e-01   +2.379659819092218e-02; +7.902083414563730e-01   +5.684565701862236e-01   +9.131437831520109e-01   +3.555892540883822e-01   +7.019041435444872e-01   +8.625978507839350e-01   +5.455633391045919e-01   +3.576277292032023e-01; +9.868171492294777e-01   +7.411107400908727e-01   +7.714560378219559e-01   +9.001824480308067e-01   +4.654594737296797e-01   +9.225253455033060e-01   +9.323236702525495e-01   +4.289753558654236e-01; +9.698545386373054e-02   +7.667928379019512e-01   +1.934338752804735e-01   +1.404138092853019e-01   +5.030403613585748e-01   +2.171125429803648e-02   +9.919556442094077e-01   +5.463186774725353e-01; +1.982078890351660e-01   +4.002388771791734e-01   +3.378405458210486e-02   +9.562199144706495e-01   +7.987674866366633e-01   +3.637086373585794e-01   +8.318602311285848e-01   +4.880462007709558e-01; +1.191595205052549e-01   +1.496331736476628e-01   +3.758066681371796e-01   +9.041617711104394e-01   +9.355393387864992e-01   +5.308259497054006e-01   +1.811551190127405e-01   +9.192235422018880e-01; +6.438375631942682e-01   +2.066521702823018e-01   +5.753141092257819e-01   +4.115642326282866e-01   +7.854555835382222e-01   +4.059875331823403e-01   +3.090700617338107e-01   +4.174521652036873e-01];
L1E_L2E_iAMPA_netcon = [+4.993137695064258e-01   +4.499700708256200e-01   +6.153334994186688e-01   +4.893239171103277e-01   +2.325001350485420e-01   +7.186225256178705e-01   +6.905990348688205e-01   +6.365453701866306e-01   +5.222824638676942e-01   +2.434414646250323e-01   +8.778046139690009e-01   +1.759096406749859e-01   +1.367602716808505e-01   +2.453340172510347e-01   +1.873282652137228e-01   +2.219409810881241e-02; +8.364700177128974e-01   +3.643609160088009e-01   +1.059114281830298e-01   +6.619517222787021e-01   +8.369680402091347e-01   +3.833053560479178e-01   +9.757904309238941e-01   +6.209659054508015e-01   +6.726634584958298e-01   +7.281494578564821e-01   +6.571556332252293e-01   +3.023537102619445e-01   +2.857510204864864e-01   +7.495867751141562e-01   +1.491766316345090e-01   +2.456098514651179e-01; +1.860938760028472e-01   +3.028641354141282e-01   +7.540924590502595e-01   +1.769101546630225e-01   +7.337933708114789e-01   +3.827815834183539e-01   +7.545440233910424e-01   +4.083564801741125e-01   +7.730916541094226e-01   +1.321906923003564e-01   +5.380133443061931e-01   +1.091445470561777e-01   +4.769296792594660e-03   +9.335521744096121e-01   +1.330170576109601e-01   +9.872662273128899e-01; +3.379116766837056e-01   +2.363627107353635e-01   +5.402264881611059e-01   +4.767890996132439e-01   +4.898448860370518e-01   +7.143379042401947e-01   +5.541938128652840e-01   +4.284938081903669e-01   +4.617048948320017e-01   +4.074906464240485e-02   +2.512126350758868e-01   +4.485907490103726e-01   +3.060979839265103e-01   +2.720008298058958e-02   +1.686888969761352e-01   +6.326404224301172e-01; +6.952325197368049e-01   +1.363470894192001e-01   +4.425009433804674e-01   +5.013742879471966e-01   +8.497053213301476e-01   +8.363188205383715e-01   +2.838168044621018e-02   +5.069628719779259e-01   +9.046721844373334e-01   +6.497648041595206e-01   +1.052444154639599e-01   +5.859797110494369e-01   +9.035298461266404e-01   +4.371598243373597e-01   +9.216780971362352e-01   +3.569236061798656e-01; +6.974968507072067e-01   +1.037984806114105e-01   +7.407130861280089e-01   +6.022242075239999e-01   +7.155126762892496e-01   +6.684286640132360e-01   +1.938857493766206e-01   +2.610184458286679e-01   +2.654892455087327e-02   +2.007427220441850e-01   +9.742030223477454e-01   +2.259513515429392e-01   +2.935736076583634e-01   +8.301471955460842e-01   +2.632450555455606e-01   +9.526917160599238e-02; +3.657602434785633e-01   +2.310047969605103e-01   +3.888712878568951e-01   +2.438419263809470e-01   +5.225409301501081e-01   +6.488066764216686e-01   +9.396145395485389e-01   +4.215510823714693e-01   +4.819774618416731e-01   +9.758767846928795e-01   +5.938153167934270e-01   +1.089308162199940e-01   +8.274547722904150e-01   +9.958408800587856e-01   +2.072851929888597e-01   +4.074961283242656e-01; +3.027633270243063e-02   +3.444231358528083e-01   +5.276072905924553e-01   +5.142868226665168e-01   +9.403226465520946e-01   +5.613082642089051e-01   +3.957700263747996e-01   +5.250191479127471e-01   +2.748916163694824e-01   +8.202434484756427e-01   +8.189449228480421e-01   +5.579908544612252e-01   +7.465136275436864e-01   +9.188896170185714e-01   +6.140885597513027e-01   +9.319631070126414e-01];
L2I_L2E_iAMPA_netcon = [+6.763313240524645e-01   +6.122834890675386e-01   +4.034339022502650e-02   +7.958360936141594e-01   +5.221735159857261e-01   +8.236204266948260e-01   +6.460291186316959e-01   +3.874726200788597e-01; +2.448849723524573e-02   +9.442241148409816e-01   +5.584282517424716e-02   +9.327038954224199e-01   +5.966073699444522e-02   +1.116718787049864e-01   +3.882395526131217e-02   +1.690572206549076e-01; +7.406199226926495e-01   +9.632798956326173e-01   +4.044568521646736e-01   +9.406280037210636e-01   +2.834667788968310e-01   +2.245298248528703e-02   +5.644453928119680e-01   +4.445894987735445e-01; +2.131679935122021e-01   +3.709483518071627e-01   +9.812368568125632e-01   +1.412231305742278e-01   +7.110162425950356e-01   +9.315946520712121e-03   +3.064180691632688e-01   +8.763887718735809e-01; +8.580493232089808e-01   +7.995541960843857e-01   +7.133757214281455e-01   +3.228674871934739e-01   +8.820630923995120e-01   +3.332878456189689e-01   +2.641673497531737e-01   +4.080058211365026e-01; +1.586834170245371e-01   +7.300784332799605e-01   +9.868013155617351e-01   +4.308085399587460e-01   +3.630312537374566e-01   +6.678299716186687e-01   +7.202668859791401e-01   +1.655825826584646e-01; +6.708718579644236e-01   +9.553196138714481e-01   +6.467610307666519e-01   +7.073795699207573e-01   +5.618146912486194e-01   +5.977828068858497e-01   +3.082726491625969e-01   +6.637363287262146e-01; +9.331482275169877e-01   +1.243246530800041e-02   +5.008919115701486e-01   +6.180243700748581e-01   +8.818811968895298e-01   +7.852962713529273e-02   +8.989359347646750e-01   +9.281157981796667e-01];
L2E_L2I_iGABA_netcon = [+6.360660088055575e-02   +5.213505057454341e-01   +3.520900696128164e-01   +2.554978498800828e-01   +4.391497632842326e-02   +8.948574756231947e-01   +3.440357669017578e-01   +4.542977373925911e-01; +3.544004839003602e-01   +6.709126175010148e-02   +5.581083255455598e-01   +9.836946452019281e-01   +3.608654400286125e-01   +5.440884955328360e-01   +9.316309217290584e-01   +6.757891370005330e-01; +9.321041545193041e-01   +1.818360427036946e-01   +6.929566191994161e-01   +3.519557574445007e-01   +3.856067576092758e-02   +7.167807719164554e-01   +9.126892090318341e-01   +7.701622839458286e-01; +2.392262418422102e-01   +3.120644609006417e-01   -1.328647052669270e-03   +3.983324607761884e-01   +4.847644520813100e-01   +7.139884778821194e-01   +7.250377346726059e-01   +9.268133972659048e-01; +1.046161717508239e-01   +2.460469693583821e-01   +4.431764000743218e-02   +7.529709098062662e-01   +7.258239922474531e-01   +1.708162752309769e-01   +4.436695874854364e-01   +6.551068637816182e-01; +7.157437723169533e-01   +3.264658789743287e-01   +3.041848142241473e-01   +1.050087823382680e-01   +1.448968870989632e-02   +3.540853793987073e-01   +1.539281322496597e-01   +4.991987198871574e-01; +5.643136429600328e-03   +8.760744881650206e-01   +8.712940762029193e-01   +5.926055506789695e-01   +5.136619237684094e-01   +3.810181427649605e-01   +8.320347719954310e-01   +3.415196293687274e-01; +1.806140659024685e-01   +3.025983008415723e-01   +6.276975370903251e-01   +1.231124849119598e-01   +2.385586921047590e-01   +7.562610817935331e-01   +2.542385761499255e-01   +9.465355294851924e-01];
L3E_L2E_iAMPA_netcon = [+7.790569928420672e-02   +1.734815469188920e-02   +3.706492751060128e-01   +4.960040848934317e-01   +1.947224269519639e-02   +9.593299986102202e-01   +3.589667537566187e-01   +1.727940823780441e-02   +2.053297461253086e-01   +6.367893168946784e-02   +2.456876374985853e-01   +9.970968847392405e-01; +9.533184863912152e-01   +9.773328635721034e-01   +1.184348635899074e-01   +6.707073768826181e-02   +8.087718579679980e-01   +3.881369558689322e-01   +2.275885342434195e-01   +1.231432559039817e-01   +3.591121641327268e-01   +7.417407993755478e-01   +5.341704605516444e-01   +3.451942488224777e-01; +6.642416019892677e-01   +7.220747665005061e-01   +5.127398418677277e-01   +8.630820356244182e-01   +7.942732915032790e-01   +6.628602786621416e-01   +7.266488724227812e-01   +6.664885299697897e-01   +8.910971194943726e-01   +9.898377431101655e-01   +3.332114089291159e-01   +8.237493127173465e-01; +1.678258690507982e-01   +8.736236276196595e-01   +5.635436227031398e-03   +9.969449065308492e-01   +4.201756499739677e-01   +5.855652536040369e-01   +7.725603338611313e-01   +5.078641388793216e-01   +8.167225716113291e-01   +7.684085938011189e-01   +6.716628009492479e-01   +1.083337032426669e-01; +1.964521547810280e-01   +8.203869205585872e-01   +8.705284714261465e-01   +1.225309867361044e-01   +6.310067116609167e-01   +5.657983165462425e-02   +3.405609327146478e-01   +7.494208721362158e-02   +3.180503794735701e-01   +8.839327223138922e-01   +8.751743294214021e-01   +7.771741859424607e-01; +9.945657147217180e-01   +3.527528334397897e-02   +9.081151345213333e-01   +1.020148069855478e-01   +5.703000077139947e-01   +7.320838870521813e-02   +5.742392039522014e-01   +5.366515554884329e-01   +5.970082497545783e-01   +3.912174125395428e-02   +9.861363645092005e-01   +1.519772958669806e-01; +9.255749912482414e-01   +9.343414857929788e-02   +1.108046544867480e-01   +1.486043213315075e-01   +9.012743282960409e-01   +2.294291927223469e-01   +6.430088993171180e-01   +6.817787209242271e-01   +6.998382927761406e-01   +7.920354977469908e-01   +1.421602348818180e-01   +7.323314542346687e-01; +9.811633036852944e-01   +8.932293104057124e-02   +4.331273441708170e-02   +1.261313853994472e-01   +7.470319980254919e-01   +4.190639982924012e-01   +3.672628989558774e-01   +5.871226094500257e-01   +1.769484784404469e-01   +7.097118358158450e-01   +8.760397108647165e-01   +1.136259295588278e-01];
L3I_L2I_iGABA_netcon = [+7.693430297395255e-01   +5.351391795785536e-01   +5.966193164764656e-01   +3.065880651047749e-01   +9.669348085927271e-01   +1.170196328784942e-01   +2.967167572120767e-01   +7.958085771095573e-01   +9.192353062434295e-01   +9.929447674766880e-01   +3.127342621152475e-01   +9.933900988871326e-01; +6.392826084103745e-01   +4.499451946684445e-01   +5.610018140318171e-01   +7.599302934198899e-01   +5.467547234093029e-01   +6.505758351464443e-02   +1.693770593857857e-01   +5.047414832213535e-02   +3.871413469116569e-01   +2.900393590453449e-01   +4.461865101914976e-01   +9.160074217072544e-01; +7.976325382262366e-01   +1.144527803197381e-01   +7.183471875710730e-02   +6.499018734577077e-01   +9.819787672781569e-01   +4.982137789102006e-02   +7.235991069258004e-01   +1.792204257581381e-01   +7.482784951204294e-01   +5.193155844930664e-01   +2.067436684399491e-01   +6.891143170734533e-01; +9.604087122451905e-01   +7.197026830523666e-01   +7.694626803283703e-01   +3.318789421839344e-01   +1.277042898168155e-01   +1.309435729071206e-01   +2.982393329822021e-01   +2.427901023266449e-01   +8.809408767443534e-01   +3.562424718693412e-01   +9.424727142815768e-01   +2.175001267394341e-01; +7.132682470151619e-01   +1.832648311923274e-01   +8.671102429134032e-01   +9.750552672112306e-01   +1.680109205281375e-01   +4.927858925289421e-01   +6.770172594127850e-01   +2.600091517627480e-01   +3.921867753338756e-01   +5.222201648257082e-01   +2.920103460010580e-01   +3.131124374117261e-01; +6.433204774100104e-01   +3.212216847179392e-01   +7.054157518962678e-01   +5.312683095568710e-01   +3.365153124785097e-01   +4.669395038860773e-01   +7.475867972813917e-01   +6.513692590081447e-01   +1.704111062685506e-01   +4.983360457653016e-01   +1.226033125201622e-01   +2.325478602420564e-01; +5.141230212360858e-01   +9.687815818657769e-01   +1.057215578946974e-01   +7.507074228113920e-01   +5.347467306278635e-01   +1.564259961391128e-01   +7.472912681479902e-01   +9.844092872333986e-02   +4.353381076307694e-01   +1.874392486596829e-01   +7.205920014838582e-02   +7.068175656001613e-01; +9.493933555847660e-01   +7.020916428537045e-01   +6.643359458937185e-01   +2.655151732815212e-01   +6.951957778504305e-01   +1.343467157277025e-01   +7.821257663344930e-01   +4.712629896154147e-01   +8.564152197546947e-01   +4.814115603010655e-01   +7.264827693322148e-01   +3.746292682892003e-01];
L2E_L3E_iAMPA_netcon = [+6.566476586101593e-01   +3.878093192584861e-01   +2.340861362289100e-01   +4.655833269526274e-01   +9.041383601944515e-01   +9.544530181161014e-01   +7.659010424865590e-01   +3.558285279703830e-01; +3.805668148066334e-01   +2.421709207858465e-02   +9.074138561050752e-01   +2.883106985148734e-01   +6.808242741610905e-01   +2.332243365277722e-02   +8.997224099509097e-01   +6.645223274538296e-01; +3.084496917019183e-01   +3.316622493064216e-01   +4.880425812336530e-01   +2.793857192680693e-01   +8.430430908419254e-01   +4.996186015378070e-01   +7.939637785301168e-01   +5.897200431698478e-01; +1.542090354809100e-01   +4.858164812526686e-01   +5.954940915511993e-01   +1.417486887322964e-01   +9.710255288858598e-02   +3.371201542239532e-01   +9.546847941998582e-01   +5.353989748141767e-02; +7.764056441044037e-01   +2.645231172644641e-01   +9.536117237695175e-01   +1.444844117223759e-01   +7.374694141083964e-01   +6.696307765437198e-01   +5.357691084105941e-01   +2.133685055407270e-01; +7.106132024484033e-01   +5.274670705420231e-01   +8.127955857477637e-02   +2.623725487563763e-01   +5.451257849520249e-01   +1.656515694083592e-01   +1.637578753161892e-01   +6.030211268671641e-01; +1.721896624279395e-01   +4.135023469395318e-01   +2.249894424395469e-01   +6.090817076388262e-01   +2.535503862396297e-01   +2.256052070909772e-01   +1.357985305945745e-01   +2.717237261180959e-01; +4.506967419785348e-01   -1.233820523024771e-04   +1.562511973751856e-01   +1.036690568365484e-01   +7.121333814185448e-01   +1.163412832826051e-01   +2.872395176948873e-02   +1.127053708547639e-01; +8.427294857922967e-01   +8.915649029346218e-01   +3.920634010097345e-01   +4.870458320635768e-01   +3.588526313719173e-01   +9.904878659679999e-01   +6.856978717860616e-01   +2.138402439548294e-01; +6.993301036278784e-01   +2.375219265522577e-01   +1.842377308224293e-01   +8.958832488087592e-01   +8.494355471375519e-01   +1.417773114279566e-01   +5.851352932681563e-01   +8.779333056630120e-01; +7.660542814940751e-01   +7.948532841717070e-01   +7.665743020294575e-01   +1.914413143077576e-01   +8.200788619123149e-01   +7.684753705535362e-01   +2.950406519647417e-01   +4.625331417992221e-01; +9.775251324894050e-01   +5.781045178031131e-01   +2.318217400225297e-01   +5.078958898075822e-02   +6.141790046970650e-01   +6.301597487901653e-01   +7.634804343514824e-02   +7.302689404739028e-01];
L2I_L3I_iGABA_netcon = [+5.932527062677596e-01   +1.454447507851259e-01   +3.439485407807622e-01   +3.680823815499097e-01   +5.960380343767505e-01   +5.071742729942722e-01   +7.710139725216392e-01   +2.671010254708712e-01; +8.413292450558294e-01   +9.904282012189500e-01   +4.543408028787394e-02   +5.368060397236976e-01   +4.757405124584830e-01   +2.402483915508366e-01   +1.792938174091616e-01   +5.892335505489881e-01; +6.039412480032305e-01   +4.818019334532235e-01   +9.452862195433799e-01   +9.750201743242106e-01   +3.814066786026343e-01   +2.700243495907553e-01   +4.533856459354726e-01   +6.811894853423071e-01; +7.441901431412782e-01   +3.865974058655291e-02   +8.662165148551976e-01   +9.967087040337417e-01   +9.794269338553707e-01   +4.075425582181264e-01   +3.015365203773376e-01   +4.162910876053575e-01; +8.504632545214348e-01   +2.694187700027284e-01   +1.343321817511395e-01   +4.122904184405798e-01   +1.371195453294339e-01   +2.599508955419490e-01   +3.836730969395615e-01   +5.110313179017512e-01; +1.468146821460258e-01   +6.727350860433967e-01   +5.917418622689542e-01   +4.451152449722715e-01   +2.738847567175506e-01   +8.533129148112231e-01   +8.006535504754890e-01   +8.140152453785197e-01; +7.430224209414034e-01   +1.448400247864424e-01   +6.708175080727641e-02   +2.497999110968226e-01   +2.225212598057159e-01   +4.804454451052111e-01   +7.796897478841466e-01   +5.394435162033195e-01; +1.440157447250751e-02   +7.702735732382431e-01   +9.504851762215977e-01   +5.964586712426888e-01   +7.969370814580384e-01   +3.390008892207929e-01   +6.447072939041785e-01   +5.901379442853022e-01; +2.247155929340701e-01   +2.711224136284099e-01   +4.962314894955805e-01   +7.222618735193495e-02   +8.197597498784006e-01   +6.385672699295010e-01   +2.430353643865382e-01   +5.337996720769672e-01; +5.340862219717870e-01   +8.808005175113901e-01   +2.797814522955631e-02   +9.104385484241816e-01   +7.953708200720615e-01   +4.135275387091912e-01   +6.076820344929975e-01   +5.400079834492152e-01; +7.191961464027691e-01   +3.681480077153541e-01   +5.507029029921353e-02   +4.784369543621295e-01   +1.111042279427540e-01   +5.481272766472346e-01   +4.182656353197804e-01   +1.501765646957469e-01; +4.327875363670542e-01   +1.026445197065163e-02   +3.018903172136997e-01   +5.058034358644469e-01   +6.331299966067883e-01   +3.395124364201439e-01   +2.965314047964455e-01   +7.010772786600857e-01];
L3I_L3E_iAMPA_netcon = [+6.104709446315516e-02   +7.724796686484833e-01   +5.523819157981504e-01   +5.712083093200444e-01   +9.176886661659274e-01   +8.338439081898885e-01   +8.476056577318443e-01   +8.580013742649132e-01   +5.308612328132730e-01   +9.902641485695132e-01   +4.800422967627876e-01   +3.525715733240535e-01; +9.197938351231244e-01   +8.422697314133435e-01   +8.463847490745620e-01   +9.349709094806222e-01   +5.939525174030718e-01   +3.978321410691638e-01   +6.296987039975984e-01   +8.560073050304040e-01   +5.649347320338096e-01   +6.977255213947363e-01   +7.418086977586341e-01   +3.993516133657923e-01; +1.842080752206432e-01   +5.940976956487283e-01   +9.704728910692288e-01   +7.778320669105867e-01   +5.747613738200159e-01   +7.000097725878789e-02   +4.419796644779130e-01   +9.486375672594189e-01   +9.828460074457004e-01   +8.424904030413423e-01   +5.943961681729042e-01   +9.882061694419497e-01; +5.434548396650425e-01   +7.639704053846751e-01   +4.623509121451536e-01   +5.956038157773799e-01   +6.549280120525293e-01   +3.760137705544715e-01   +2.333539700425611e-01   +6.953079087116172e-01   +9.636937999390094e-01   +7.365960615459906e-01   +2.584246746490053e-01   +2.970060703594196e-01; +3.994738319035816e-01   +6.612595994495146e-01   +7.731980415193683e-01   +5.659295877648310e-02   +4.316683565973219e-01   +8.522638236235562e-01   +4.831052083401854e-02   +3.623390270526787e-01   +5.609459425071831e-01   +9.968861422889111e-01   +6.072107225368291e-01   +2.292309848707440e-01; +8.820559906560544e-03   +5.853842480556392e-01   +2.641885783289867e-02   +5.415775991960017e-01   +9.370269468568222e-01   +2.473724364977801e-02   +7.073139630506431e-01   +3.757527400043700e-01   +5.275650802381493e-01   +5.053686727402334e-01   +2.297686996543435e-01   +3.291575465959446e-01; +1.034094190184526e-01   +2.219110656779854e-02   +6.750917415249910e-01   +8.640356536941657e-01   +1.013963345512201e-01   +4.225380790903013e-01   +8.492571838198734e-01   +8.427508238387363e-01   +4.788693463558652e-01   +1.916942345980247e-01   +1.922371868408503e-01   +1.663623388510133e-01; +8.572942297078885e-01   +6.882168424991795e-01   +8.354979537465683e-01   +3.378643818487200e-01   +4.041982440259028e-01   +2.517372434883021e-01   +4.066604055213689e-01   +3.842211665440046e-01   +9.007848454872507e-01   +9.563847713074147e-01   +3.490236320840370e-03   +3.812193100027471e-01; +3.388886351721566e-01   +3.247643948715104e-01   +6.860981314168939e-01   +1.795180976819185e-01   +8.958620413149710e-01   +7.109620908676087e-02   +2.894217421642517e-01   +7.723998719620334e-01   +4.836141719460536e-01   +4.531057794360107e-01   +6.504211181007648e-01   +5.280662178602414e-01; +1.493970849586957e-01   +7.951970860672716e-02   +8.979050329965816e-01   +8.815755860742516e-01   +7.345961638708065e-01   +9.184116256220085e-01   +2.586140165376786e-01   +7.762100770435391e-01   +4.871376422350904e-01   +6.062825585710270e-01   +3.975764899004184e-01   +5.946583001469617e-01; +8.031793067515861e-01   +7.435147954170485e-01   +9.501192216443445e-02   +8.404273278236767e-01   +9.585966101094543e-01   +2.672364137958810e-01   +5.098435137889420e-01   +4.348565953411898e-01   +3.127357684789932e-01   +6.433717235305398e-01   +2.699712106221405e-01   +1.696569936735352e-01; +6.523463293490319e-01   +9.697499048748492e-01   +7.597149580489286e-02   +8.300250945555252e-01   +9.729680546112026e-01   +1.044378310545137e-01   +1.177871421615399e-01   +4.859539847076139e-01   +8.542231293139029e-01   +7.616101513948523e-01   +3.165503299906020e-04   +6.888262384360594e-02];
L3E_L3I_iGABA_netcon = [+4.433402188211439e-01   +6.890073095582859e-02   +7.900922204956466e-03   +4.937204899142144e-01   +5.475307294674520e-01   +2.535978979494907e-01   +7.152156819020751e-01   +7.614313489823039e-01   +3.807502048326039e-01   +4.511254241636601e-01   +2.004081322552488e-01   +6.539276963986643e-01; +6.169183190359010e-02   +8.062867900076228e-01   +1.301555953673626e-01   +1.909775218680407e-01   +2.161124892464045e-01   +3.332778724194865e-01   +2.244965573945708e-01   +8.924691683903587e-01   +6.111610745519782e-01   +3.934884386079178e-01   +8.275474817844175e-01   +9.017305504229727e-01; +6.258136283040354e-01   +9.128919415814052e-01   +3.089101685114756e-01   +6.443360388636069e-01   +2.714021562938561e-01   +5.946080449087388e-01   +5.008313353681906e-01   +7.350164429147706e-01   +1.673270832251177e-01   +6.741746118025740e-01   +4.442342643863371e-01   +8.338364807801244e-01; +8.025884808979546e-01   +4.258637272987035e-01   +2.375479536800028e-01   +2.527253769732992e-01   +1.329436520308403e-01   +4.841510228741143e-01   +4.768678937869820e-01   +6.934390149662755e-01   +1.010080738656308e-01   +2.953908986017425e-02   +4.275443887200434e-02   +1.725965296280333e-01; +4.011492266338277e-01   +1.896068466388706e-01   +6.507170848819398e-01   +9.466015351833013e-01   +1.715239682443931e-02   +8.966099739019818e-01   +4.305143938905329e-01   +6.427778823403928e-01   +6.211287167675481e-01   +7.877244969601941e-01   +7.657569149697097e-01   +1.602121880528336e-01; +8.840532065096428e-01   +1.826473098239240e-01   +8.080236377035324e-01   +2.896238215426450e-01   +1.095222804459527e-02   +2.939336411788782e-01   +5.525702073523819e-01   +6.170572886766429e-01   +9.578397645682478e-01   +3.786303083446537e-01   +9.638466437968796e-02   +1.335047726891800e-01; +7.205291324631358e-01   +6.684111014597645e-01   +7.440653196606569e-01   +1.460596312037132e-01   +9.836463675117799e-01   +7.851145149961902e-02   +2.099993387200099e-01   +7.764048800616846e-02   +6.698854307441735e-01   +6.464738008240963e-01   +6.531940773055014e-01   +1.606097592931418e-01; +1.947913423586804e-01   +5.238313156958431e-01   +1.212665956894122e-01   +8.692965574272701e-01   +6.452156246549064e-01   +3.909296758031050e-01   +2.752484177100040e-01   +5.506828864336272e-01   +4.721587556514183e-01   +4.973096053629223e-01   +2.715139616013412e-01   +3.948444082285786e-01; +3.760445165826574e-01   +7.748224285411039e-01   +1.695308077711562e-01   +8.855868305618532e-01   +8.132902289800226e-01   +1.949436638001583e-01   +8.134267548448488e-01   +8.809365538058280e-01   +3.383267094287644e-01   +2.155122893785773e-01   +4.393108745887347e-01   +6.626890502852250e-01; +2.115047829316274e-01   +2.998707765979824e-01   +2.698473212502014e-01   +6.663738149548604e-01   +2.762245812520298e-01   +7.269543200741947e-01   +9.945396455508876e-02   +9.865538296703145e-01   +5.906257416658810e-01   +2.133847388129958e-01   +8.487138449128044e-01   +2.224747398558082e-01; +2.645605521418746e-01   +4.748252960880144e-01   +8.130009155076569e-01   +9.992075178458922e-01   +1.296944010124203e-02   +4.214655386742339e-01   +3.366744960292579e-02   +7.026001327748622e-02   +5.477465221104653e-01   +4.505813020517058e-01   +9.041012098710242e-01   +6.438303458099356e-01; +9.942191489755002e-01   +7.107531824697215e-01   +5.935489671483266e-01   +2.671487528258054e-01   +1.028651986682543e-01   +2.658373467145370e-01   +6.843531132404503e-02   +3.372927002172260e-02   +4.148990184002260e-02   +6.333248805697038e-01   +2.844137756519271e-01   +6.091540118941789e-01];
L2E_Input1_iAMPA_netcon = [+9.974039651545299e-01   +9.899064879825746e-01   +9.995231702004579e-01   +9.878662149758729e-01   +9.890592201239975e-01   +9.973694409410911e-01   +9.841959360303035e-01   +9.934397612102573e-01];
L2I_Input2_iAMPA_netcon = [+9.947508036291622e-01   +9.990066666258202e-01   +9.897260517275198e-01   +9.900376984264521e-01   +9.883802535120605e-01   +9.884675935063048e-01   +9.950629152987290e-01   +9.940960372476396e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last =  11.21 * ones(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))*0.4 + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.5*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.5*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))*0.9 + 0.5*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))*0.4 + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.5*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.5*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))*0.9 + 0.5*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
