function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+5.151343380651613e-01   +7.444713548313760e-02   +5.770075393553226e-01   +7.301654121747306e-02   +1.983827053150561e-01   +6.548646793823860e-01   +1.642990536327717e-01   +2.421358431101309e-01   +3.296607526794308e-01   +7.360772602763365e-01   +1.439594055020464e-01   +2.429775853031770e-01   +1.683006682820697e-01   +4.392697750618985e-01   +5.142698212233454e-01   +2.072048915247904e-02; +6.136221863071718e-01   +2.839513557042620e-01   -1.707076275275591e-01   +2.299182045762339e-02   +5.650131819319458e-01   +4.487186910329755e-01   +5.264784895287051e-02   +3.494770104980522e-01   +3.717355008231289e-01   +1.529699852557236e-01   +3.766848070495840e-01   +4.755737039453834e-01   +3.504720863968844e-01   +7.575110106754029e-01   -6.096531795021095e-03   +3.003831044840746e-01; +4.363008203820265e-01   +3.253138186969578e-01   +3.946324396990533e-03   +3.161029466227936e-01   +4.837867048108837e-01   +1.577485976175212e-01   +2.475386590708581e-01   +1.820826471814898e-01   +2.617314216392469e-01   +3.807534434480522e-01   +9.635524652254571e-02   +1.741947243634185e-01   +4.139329299977321e-01   +5.802015558711889e-01   +1.467703468133773e-02   +3.384659661138530e-01; +4.542114713159652e-01   +3.814158935487343e-01   +7.940272737674168e-01   +1.000000000000000e+00   +6.907557033447084e-01   +3.593139931098577e-01   +6.979766670145400e-01   +8.658999769771888e-01   +8.721089436625042e-01   +4.781190528507356e-01   +3.306214512106003e-01   +2.098140606557890e-01   +4.120311494912392e-01   +5.421346488800004e-01   +1.858818935459522e-01   +3.687432967112034e-01; +4.376113705985252e-01   +5.966341495517594e-01   +4.747550389816780e-01   +9.710305988578001e-01   +1.542318488308728e-01   -1.591178973125620e-01   +7.096907474148373e-02   +8.335593804566054e-01   +5.083585863817789e-01   +6.300777697315839e-01   +8.588956456493950e-01   +3.464585985583408e-01   +6.460212118668707e-01   -1.221648752370125e-01   +7.955086138652501e-03   +4.241249199637233e-01; +2.144736062696632e-01   +2.000850520466510e-01   +5.189771025520157e-01   -6.658364237802482e-02   +1.339320709585483e-01   +8.043164485588765e-01   +3.382991776343223e-01   +4.930145770747369e-01   +2.336405350290622e-01   +4.095668457743519e-01   +6.855782979285205e-02   +7.374832951179222e-01   +9.950621885112763e-02   +3.832332152821556e-01   +4.026814037339682e-01   +5.988180333466551e-01; +5.148239546565734e-01   +5.650704082578977e-01   +5.297689341001594e-02   +4.459941609369611e-02   +4.423873175168435e-01   +4.802362587382437e-01   +5.456394776927824e-01   -1.026719000781772e-01   +2.688551542582497e-01   +2.989561018361901e-01   +5.906131373933938e-01   +4.645264830319853e-01   +5.681850862844355e-01   +7.349075485701094e-02   -1.278281361786989e-01   +1.909987951036437e-01; +8.426284891444932e-01   +8.419210996259591e-01   +4.116524826116161e-01   -1.282340251308981e-02   +4.614843442881606e-01   -1.793572621320160e-01   +4.078899999408324e-01   +1.787213606615707e-01   +4.527859827892738e-01   +7.116675262142749e-01   +3.061164275622457e-01   +1.708024213126718e-01   +2.931948870473750e-01   +1.733716753448299e-01   +4.859160004825144e-02   +6.732335142533490e-01; +1.181999415989495e-01   +5.094323271012403e-01   +1.736107702547406e-01   +3.747313142153844e-01   +6.607878629515308e-01   -7.688063989401064e-03   +4.070428891394077e-01   +4.924692819462249e-01   +1.814968140272639e-01   +2.201263800643518e-01   +5.606351098557585e-01   -2.777627532932978e-01   +2.269631060087584e-01   +2.404534519858676e-01   +1.603938549803736e-01   +5.618466173941039e-02; +2.884734868356954e-01   +4.356155053051552e-01   +2.478617010439265e-01   +3.387986801570353e-01   +6.290148440702642e-01   +4.555110534521823e-01   +4.996606290126983e-01   +4.142685638836358e-01   +8.199963699647225e-02   +6.853741169714972e-02   +2.170100775659899e-01   +5.386861306657890e-01   +5.673588722094542e-01   +6.021990724733387e-01   +2.312418303148612e-01   +6.833497199596158e-01; +4.040483921225597e-01   +4.043238099682820e-01   +2.124177975694319e-01   +5.508454000343507e-01   +6.675977858061815e-01   +1.555806683698199e-01   +3.498378223542057e-01   +6.546923374145995e-01   +4.192490873165742e-01   -3.141756471339914e-02   +1.722007306026191e-02   +6.199705339681397e-01   +4.200901984288903e-01   +3.370245273095616e-01   +2.474327076650296e-01   -1.260723841271359e-01; +2.854879523118128e-01   +6.206887760462942e-02   +3.591397835347034e-01   +5.917129258763776e-01   +4.350501622242497e-01   +5.021605753833370e-02   +3.476291065088960e-01   -4.831669190541145e-02   -2.157995340155799e-01   +5.739801624486975e-01   +1.334616924443233e-01   -1.574303249736597e-01   +6.261336148081085e-01   +6.665333531149257e-01   +1.334662963157373e-01   +3.578687514068773e-01; +2.105650210468222e-01   +2.500023320379240e-01   +9.558646964215115e-01   +7.750854016255532e-01   +5.930726295305100e-01   +7.275312697935695e-01   +2.644130043045616e-01   +2.076024050784487e-01   +1.626912381700037e-01   +2.665175049903022e-01   +3.439317774386818e-01   +4.985931077703350e-01   +3.791387856970080e-01   +4.467306050759673e-01   +5.061155457173163e-01   +4.032760294590191e-01; +4.882514325875030e-01   +7.186138425471802e-01   +6.260044482461256e-01   +5.387018348286641e-01   +7.390416053554340e-01   +3.854166983763272e-01   +2.665585746219976e-01   +2.401885270252196e-01   +4.170219973942513e-01   -6.869064959379301e-02   +3.777674264479404e-01   +1.894061022293907e-01   +1.881418486088798e-01   -7.567816980045647e-02   +1.932068387598049e-02   +1.797230899491561e-01; +3.958330611081688e-02   +4.306177315910848e-01   +2.752423180837605e-01   +3.997065877335544e-01   +5.757095339643805e-01   +7.818136894974413e-01   -4.151003247525686e-02   +8.420611327299381e-02   -1.384691104063545e-01   +4.849325283154158e-01   +5.932819845257122e-01   +6.989118731625630e-01   +5.878288691000653e-01   +7.128350786055719e-01   +4.303469112770717e-01   +1.709210356839234e-01; +6.185210490422535e-01   +2.174552084283816e-01   -1.586161337338774e-01   +1.806598851051882e-01   +6.218592839535128e-01   +3.678810267936445e-01   -1.357729250152931e-01   +1.654236214549277e-01   +3.875866875152809e-01   +4.230564300332583e-01   +5.460677989693070e-01   +2.407425834012583e-01   +6.429624334347201e-01   -2.748544330137515e-01   +5.037172501021563e-01   +3.865481656510865e-01];
L1E_L1I_iGABA_netcon = [+4.492267681523248e-01   +6.082949869600081e-01   +6.235562784648667e-01   +2.636560083602513e-02   -3.005461608761185e-02   -7.475912542631039e-02   +4.752009015728943e-01   +1.573636619250276e-01   +5.258666452926317e-01   +4.913705050065759e-01   +4.693668011154728e-01   +3.124335898503304e-01   +7.247114200551485e-01   +2.322875524927173e-01   +5.073544486344226e-01   +2.188805649925109e-01; -1.768327004202581e-02   +2.487877639937173e-01   +9.627021913169806e-02   +2.527440349124138e-01   +2.909015927675627e-01   +1.777655798153098e-01   +3.317310344496389e-01   -2.082788325196889e-01   +8.679738955743573e-01   +3.760819535498445e-01   +4.883898108982903e-01   +2.866555957686176e-04   +2.100311406338250e-01   +2.320316524088967e-01   +3.802231957758117e-01   +4.153265207595290e-01; +6.347723819770612e-01   +4.535921032221935e-01   +3.738990514320322e-01   +1.278610004281269e-01   +5.711350592486499e-01   +8.053645344364394e-01   +2.409092288431721e-01   +2.144584343418885e-01   +4.753122539784077e-01   +9.358073057637717e-02   +7.822198481791723e-01   +6.369631875681651e-01   +7.411086019023986e-01   +1.689062662971862e-01   +4.537297315974360e-01   +5.450055911822465e-01; +6.008000843854909e-02   -1.223840909513099e-01   +1.336421264561189e-01   +4.976452679728326e-01   +6.233554647498312e-01   +4.179461538401295e-01   +7.847156870180179e-01   +3.653238941644224e-01   +4.074554601261496e-01   +8.000653397604204e-01   +1.865741899235396e-01   +2.265380674507960e-01   +5.900326387713780e-01   -3.863591281137187e-02   +6.190071682035784e-01   +5.530403257378842e-01; +1.652503040439379e-02   +2.513327351606754e-01   -9.958318564917061e-02   +2.221135576459859e-01   +2.174499120145234e-01   +3.961550305317924e-01   +6.572479859229871e-01   +7.032651574238946e-01   +2.564222657750024e-01   +3.967895615269629e-01   +3.972591909810770e-01   +5.910383042187669e-01   +1.494334215328007e-01   +4.404223788316083e-01   +5.021881279601579e-01   +3.412904080111083e-01; +6.611985542363029e-01   +3.682354684367936e-01   +2.345294332232853e-01   +7.752663626495246e-02   +2.651006769597159e-01   +8.840787453853463e-02   +3.120048890676394e-01   +3.975500233646496e-01   -4.910564933448705e-02   +5.966883577275249e-01   +3.707397007181193e-01   +1.835629957429609e-01   +1.015515564513878e-01   +4.504092821944043e-01   +3.499220751941026e-01   +6.137490972917596e-01; +1.021659644961672e-01   +6.238645124279338e-01   +1.698560683819669e-01   +2.933594954158753e-01   +9.252462128426177e-02   -4.195213283316994e-01   +7.357141578579137e-01   +4.481028478006734e-01   +1.864966351095501e-01   -1.445286403935185e-01   +1.910069422671908e-01   -5.072886768989453e-02   +2.343291716766947e-01   +5.172669293652663e-01   +5.673147651747247e-01   +3.623030022755473e-01; +3.447910815477793e-01   +8.362720340547150e-01   +6.529844582751957e-01   +1.764277372395647e-01   +3.486144144248931e-01   +6.609832762893819e-01   -4.474760340416470e-02   -4.329990974126822e-02   +3.100686916526307e-01   +5.194863230111810e-01   +6.562420612206746e-01   +1.107017927195198e-01   +4.394424126137622e-01   +7.695630394674152e-01   +5.484547737267342e-01   +8.537578394155720e-02; +5.591698389839028e-02   +1.002099499258262e-01   +4.477291083729099e-01   +4.270517785234323e-01   +7.367895860525767e-01   +3.239555424283349e-01   +7.432489545369431e-01   +4.428612050537202e-02   +4.160695207867173e-01   +1.488628386998893e-01   -1.499410804458272e-01   +3.104471152075742e-01   +4.069346504036545e-01   +5.719700926207333e-01   +3.846646723020372e-01   +1.850357645319332e-01; +1.962866530382802e-01   +6.906817475381481e-01   +4.147925295883462e-01   +3.294627644871221e-03   +3.609231292655656e-01   +6.200883525164997e-01   +3.211105901896443e-01   +2.819323853248520e-02   +2.138378555129679e-01   +4.707183318955052e-01   +3.741299197670985e-01   +7.512347683707983e-01   +4.470401935663240e-01   +1.882327361412244e-01   +4.929897608657218e-01   +1.709776743026055e-01; -7.015910155054027e-04   +5.095611524978341e-01   +7.506310435412835e-01   +7.446714183505913e-01   +6.049555087452754e-01   +3.773992185735837e-02   +1.677524576326153e-01   +5.237158313632569e-01   +6.333661360220865e-01   +3.856319169780448e-01   +5.846626641239488e-01   +3.756357804668332e-01   +9.991287637900217e-02   +6.408686825256893e-01   +1.237457401310051e-01   +5.429638574548243e-01; +6.911746506734184e-01   -4.653315323049716e-02   +3.912493950929008e-02   +5.895996522735656e-01   +5.927958611381962e-01   +1.635901369743593e-01   +3.760889228378834e-01   +3.721068065271766e-01   -2.237456687313169e-02   +2.882931569353739e-01   +5.620067691853277e-01   +3.839826283577614e-01   +4.878476126975565e-02   +1.132330873668927e-01   +2.002304148750383e-01   +6.707863171529972e-01; +4.778011925669081e-01   +6.521354760044631e-01   +6.977824862163181e-01   +1.056954567117676e-01   +2.747685932618549e-01   +1.000000000000000e+00   +2.780505416524242e-01   +6.499810642287311e-01   +4.077659776161001e-01   +4.683651037117511e-01   +7.824046451371045e-01   +2.447420996068631e-02   +7.316901802736855e-01   +2.890007513443609e-01   +1.615497451079944e-01   +4.722188440964889e-01; +4.414769735631204e-01   +4.184693031374766e-01   +3.238354275872961e-01   +7.996695168461834e-01   +9.148091542935812e-01   +6.818277560225539e-01   +7.068802248951342e-01   -3.632271957044534e-02   +6.696683572394195e-02   +3.318249690691210e-01   +1.182252798561453e-01   +6.226829111601018e-01   +4.925629274433939e-01   +4.355874414458321e-01   +4.959946394216048e-01   +3.823935430842688e-01; +8.284871440796872e-01   +8.603321531266496e-01   +1.595450073690127e-01   -1.168469463544312e-02   +5.147779470471481e-01   +1.845474343773165e-01   +3.971179993755244e-01   +1.037815294954630e-01   +6.927561321560143e-01   -1.111369560390010e-01   +5.977747537508514e-01   +4.948826041828518e-01   +7.519560634550715e-01   -2.022012274291675e-01   +1.390073830091821e-01   -2.863000462760028e-01; -3.228300456800434e-02   +2.251021120401547e-01   +7.674339093359323e-01   +5.403074130900885e-02   +2.133970255727199e-01   +4.938184913542837e-01   +1.462271501194709e-01   +7.964784578083861e-01   +6.170771347565788e-01   +5.169879893657965e-02   +1.841564644301528e-01   +7.558529626068118e-01   -3.965280335742100e-02   +3.145670755648204e-02   +1.378138931478067e-01   +2.176590726940249e-01];
L2I_L1I_iGABA_netcon = [+4.437689139618649e-01   +1.755350923725266e-01   +8.067123765749012e-01   +2.412921893994652e-02   +8.166513426574376e-01   +6.006288143036749e-01   +7.352872837965158e-01   +9.525022078590535e-01; +1.810338827276612e-01   +2.975381220953078e-01   +3.638827748127581e-01   +3.268841884386913e-01   +5.690554167301455e-01   +2.597224719221354e-02   +2.620438599455861e-01   +1.497530409396549e-01; +6.079986233476314e-01   +4.518028482170969e-01   -1.178914653483251e-01   +2.269152309377510e-01   +5.051752916651822e-01   +2.202077404800445e-01   +5.451305197245273e-01   +4.508792570519159e-01; +5.630556069528129e-01   +5.162310736416440e-01   +2.431478215925053e-01   +5.423506180659530e-01   +4.034195053178581e-01   +1.440611025615412e-01   +2.392249058333104e-02   +1.452249738923076e-01; +3.591888755970873e-01   +4.779518455544999e-01   -4.637029615258987e-02   +9.359317284773683e-02   +6.999410496721005e-01   +2.011449538014305e-01   +5.950538174893736e-01   +6.304894997884937e-01; +6.348818888007198e-01   +6.436092949929745e-01   +4.458824974647454e-01   +5.748127098572484e-01   +4.758205624962507e-01   +1.121709239746986e-01   +6.219247035541499e-01   +1.064045412659973e-01; +3.412011015295185e-01   +5.175932395082103e-01   +5.604358934097623e-01   +7.418986911575931e-01   +1.193824720661165e-01   +8.883694261415113e-02   +2.843407031956107e-01   +4.010246100867084e-01; +5.559339750205289e-01   +2.840151307918984e-01   -1.240739642478563e-01   +2.573920643690968e-01   +1.153222370222280e-01   +4.792964117840952e-01   +2.008865653052077e-01   +3.500441226139165e-01; +2.325398960336265e-01   +3.305624790308709e-01   +7.687978905673289e-01   +3.229158510166063e-01   +3.497752748468412e-01   +9.180527848945331e-01   +3.780297126120670e-01   +8.220518652278483e-01; +6.531840160079188e-01   +2.584005109207467e-01   +8.458263345508785e-02   +2.907126312737457e-03   +5.962171865929600e-01   -1.402166759100995e-01   +2.869787431222494e-01   +3.038502772188004e-01; +4.112767921270400e-01   +4.406135614122336e-01   +3.677533448612008e-01   +9.710723839060855e-01   +1.206339531689730e-01   +4.328523487975775e-01   +9.682415706554484e-01   +6.646266896814488e-01; +5.820115566759412e-01   +8.979451048943567e-01   -1.825990180848502e-01   +1.292701476822046e-01   +3.020747007501298e-01   +5.736678959101446e-01   +5.062436124094166e-01   +2.365980799983536e-01; +1.000000000000000e+00   +2.104952745952691e-01   +6.763265443594687e-01   +1.083288656826841e-01   +5.328266432756721e-01   +5.929270369481125e-02   +6.647280070129462e-01   +1.233696858675617e-01; +6.200239031790815e-01   +3.325996467728824e-01   +4.595511381771324e-01   +3.822206100399259e-02   +2.976554201168145e-01   +5.513485294334967e-01   +6.915137115845647e-02   +1.692187085973979e-01; -1.397743785806797e-01   +7.133949977784356e-01   +6.422303387459856e-01   +3.063217454658722e-01   +2.377703493518173e-01   +6.438412881895450e-01   +1.196711241359022e-01   +3.956618652442724e-01; +2.045472966543451e-01   +6.570533269918771e-01   +3.832387043503149e-01   +5.356547033789234e-01   +1.506211357367271e-01   +3.336279071731825e-01   +3.222466857282078e-01   +1.324483642768932e-01];
L1I_L2I_iGABA_netcon = [+2.514165101864441e-01   +4.969962849330452e-01   +3.455170263120781e-01   +3.161376760525187e-01   +7.439245999190066e-01   -7.631562631514247e-02   +5.819145970052968e-01   +6.654890261124904e-02   +2.997744705014049e-01   +5.772890018067105e-01   +3.532477274316227e-01   +4.101354424538954e-01   +5.605471793504870e-01   +3.686325046002092e-01   +7.981654787056773e-02   +5.037799692970820e-01; +7.509854791877064e-01   +5.082339790260366e-01   +5.555772988651074e-01   +4.315941140123538e-01   +5.817232590102137e-01   +9.377616020191206e-01   +5.646066993541442e-01   +1.784388044595394e-01   +5.557379087623542e-01   -4.464798874384288e-02   +6.088721520016400e-02   +7.509300749663707e-01   +5.059357543569715e-01   +1.504257731316391e-01   +6.065471622098484e-01   +8.364285034114447e-01; +2.797887404935195e-01   +1.962260987435030e-03   +4.396134156163750e-01   +4.687675827475752e-01   +4.030533376559998e-01   +6.670214991835998e-01   +4.130043319990114e-01   +4.978654588691106e-01   +4.476384477163567e-01   +3.487075865649271e-01   -4.254277324242620e-02   +3.344712887075114e-01   +5.352624709761795e-02   +8.507709174941124e-01   +4.755937258045709e-01   +2.450105273363154e-01; -1.276543390979618e-01   +6.432357418739222e-01   +5.439532735848395e-01   -8.645684523823544e-02   +4.756594338453395e-01   +4.811444743158366e-01   +8.847675326675004e-01   +3.415148588936273e-01   +7.580998309557513e-01   -3.267071141739593e-02   +2.760433177050841e-01   +8.440190657147408e-01   +2.912498034968876e-01   +5.513636086736845e-01   +7.892391572420420e-01   +6.057996388500393e-01; +4.752271603166059e-01   +6.282097626369449e-01   +4.884134404851784e-01   +3.460011266360090e-01   -4.004953759057157e-02   +2.315368773596922e-01   +6.036740665926550e-01   +1.634382157840811e-02   -1.316281020793325e-01   +4.745344017565102e-01   +5.323394449379000e-01   +4.889128433939510e-01   +1.132434167752978e-01   +1.102689452113204e-01   +5.010903382403332e-01   +6.428029932527285e-01; +7.257447865989853e-01   +5.287636402812856e-01   +3.615564186836074e-01   -2.817889549706171e-01   +3.052637004875877e-01   +1.901871179190756e-01   +7.209907339641115e-01   +2.486887841282745e-01   +2.162689453825632e-01   +8.582352624186770e-01   +9.739081104748923e-01   -3.188599593452215e-02   +1.973161599234781e-01   +5.151526255179681e-01   +3.357049245602694e-01   +4.548350116235037e-01; +8.161767679205209e-02   +6.326453623704594e-01   +5.699328138574418e-01   +3.659408311875883e-01   +4.410746058952878e-01   +9.063948410293825e-01   +5.705851287751469e-01   +9.383298939688287e-02   +1.198558026141818e-01   -2.297181967820366e-02   +4.310246073213316e-01   +1.177508837489853e-01   +6.598160156273462e-01   +7.415507456190055e-01   +1.177833545395183e-01   +5.523772292867583e-01; +3.267395465777837e-01   +5.831980132107288e-01   +5.188316521555121e-01   +7.447325589390701e-01   +5.861386539088393e-01   +4.154788527941951e-01   +4.523392328919374e-01   -7.035224458695463e-02   -5.934977949833282e-02   +1.805248347737732e-01   +7.279442903652707e-02   +3.783510067746196e-01   +6.466988533897698e-02   +7.283360770461034e-01   +4.840362124967090e-01   +5.530983410126784e-01];
L2E_L1E_iAMPA_netcon = [+3.144180893583556e-02   +2.796927120887299e-01   +7.817627372440903e-01   +5.172076796512221e-01   +6.053537998794265e-01   +3.595788608311780e-01   +6.305988153354370e-01   +9.342528027657261e-01; +6.743784509857333e-01   +1.797601647765211e-01   +3.130713012743181e-01   +4.751156009624983e-01   +3.624751304332298e-01   +3.411569213871594e-01   +2.187275169731168e-01   +4.909947590837250e-01; +2.626676682894582e-01   +2.904414895529145e-01   +4.636833580314361e-01   +1.000000000000000e+00   +2.031769578173153e-01   +4.408218334084817e-01   -1.748863335262171e-01   +7.205925978531043e-01; +2.662463890956721e-01   +1.438208705084766e-01   +4.832155588860550e-01   +6.917095061061014e-01   +6.179183886131163e-01   +3.467170899609331e-01   +6.668444266082839e-01   +4.820417799351711e-01; +9.586013968421926e-01   +6.342121301545572e-01   +3.729454605374240e-01   +1.139189180420991e-01   +3.934135691622450e-01   +3.922324338600979e-01   +3.369954684091461e-01   +3.942508243392807e-01; +7.154446219487252e-01   +1.879616331428756e-01   +8.200017895184053e-01   +8.254639282639401e-01   +8.304749412539166e-01   +6.261287729237478e-01   +6.139445399426998e-01   +8.503367893697699e-01; +5.831352341571142e-01   +2.431397648695974e-01   +2.256395834954172e-01   +7.986898636075409e-03   +7.227818068831647e-01   +5.311430373662752e-01   +1.474391849556538e-01   +8.593394280782581e-01; +7.049346794634842e-01   +5.677030811994243e-01   +3.849676377840483e-01   +3.969102256493520e-01   +9.235395154014100e-03   -9.067637682178895e-02   +4.495101523085175e-01   +8.250696618006570e-01; +5.139239462744555e-02   +1.219324536516641e-01   +3.669811962848251e-01   +2.772489117959859e-01   +6.987450375497720e-01   +7.494011291799008e-01   +2.727930485729441e-01   -1.078820374346443e-01; +4.263704078173453e-01   +3.585770963764617e-01   +5.009660718389876e-01   +7.758664305793386e-01   +5.471153726735652e-01   -1.573678003295284e-01   +9.033404079328834e-01   -1.676702369190315e-02; -1.112558207493585e-01   +9.200087498642968e-02   +4.157165319917427e-01   +6.799181914350493e-01   +2.928056510411924e-01   +4.792881823200548e-01   +8.244989313597620e-01   +3.305058916163872e-01; +7.725336911450794e-01   +2.331307845796544e-01   +6.594763828651490e-02   +7.981871352738178e-01   +5.668239702528266e-01   +1.410365243203298e-01   +3.646610596016081e-01   +5.916482755503552e-01; +1.338901688418264e-01   +5.966655041238320e-01   +4.765627862857696e-01   +3.691227254129781e-01   +4.731584567506572e-01   +3.555933974204492e-01   +4.144258496164321e-02   +4.273020710236763e-01; -5.255739172652467e-02   +6.460730507817591e-01   +6.773838603029030e-01   +6.222295745628658e-01   +3.782729986174702e-01   +4.887105291590165e-01   +2.771877221090929e-01   +7.727094201443366e-01; +4.443391906953404e-01   +2.488436628211745e-01   +4.184409820804793e-01   +7.361144218440707e-01   +7.414070656474541e-01   +4.801255819528185e-01   +5.682228119106467e-01   +7.278753984374797e-01; +3.969837605793435e-01   +2.715477574000235e-01   +2.238730653771198e-01   +2.777908368534809e-01   +7.370380657035462e-01   +1.882347053597407e-01   +4.443757212807816e-02   +1.571132554496021e-01];
L1E_L2E_iAMPA_netcon = [+4.043407457427374e-01   +5.277717722590898e-01   +2.863845936482858e-01   +5.002515632263566e-01   -2.785999065711363e-02   +4.044221746984036e-01   +2.010367580492159e-01   +6.217520298127458e-01   +8.110047160153294e-01   +2.338248967542261e-01   +3.986842366100109e-01   +7.510843156580207e-01   +6.429188110130617e-01   +2.222159469634407e-01   +1.677220975485311e-02   +6.890463046020735e-01; +4.906738346334488e-01   +5.354761239038577e-01   +7.671683067632108e-01   +5.933457555550066e-01   +4.844022617733701e-01   +6.423165587146525e-01   +4.437590275016519e-01   -2.719096607169762e-01   +2.201196884973685e-01   +5.443085435023023e-01   +1.845718867402728e-01   -1.452556281904330e-01   +4.636894240424935e-01   +1.596941537597264e-01   +1.975464320067548e-01   +1.770387053251809e-01; +1.786726794719459e-01   +3.297678697574447e-01   +7.244905014781686e-01   +7.448790299881545e-01   -1.605085452000654e-01   +1.911442059329967e-01   +1.079602895237085e-01   +4.186885117053685e-02   +4.019498544115090e-01   +2.057798845291096e-01   +8.673261355499543e-01   +4.435252809889083e-01   +3.814523390928109e-01   +6.322639002586848e-01   +5.535343736570666e-01   +3.928169320437316e-01; +5.869589293350708e-02   +7.174200814438976e-01   +3.652477820777090e-01   +6.147638163824521e-01   -4.754236561231140e-02   +4.872287224202414e-01   +1.476845589482536e-01   +8.277169307563642e-02   +2.180830452673296e-01   +4.702590206339022e-01   +5.097282101430151e-01   +3.255705100803273e-01   +3.906269450211540e-01   +4.249720328971704e-01   +2.889197797526104e-01   +9.885129989351163e-02; +1.932995830142635e-01   +7.184617649179424e-01   +6.321850109876679e-01   +9.897548095302705e-02   +3.871890510627777e-01   +6.063255979469764e-01   +4.154662941808399e-01   +1.691674234378857e-01   +5.572679543999839e-01   +6.029087960322075e-01   +9.214197945368195e-01   -1.975783686354825e-02   +7.739375860463765e-01   +7.213578187985654e-01   +2.045802593868463e-01   +1.428448274414428e-01; +3.885270921785032e-01   +1.183565027165423e-01   +3.588505653181189e-01   +4.914402139593586e-01   +3.821022637594036e-01   +4.721322285687062e-01   +7.710726221569755e-01   +1.425003014287106e-01   +1.690596963266949e-01   +6.428802557398999e-01   +1.789009044105909e-01   +4.163842900085182e-01   +4.163060181941960e-01   +2.893661492749460e-01   +5.465782986699015e-01   +5.535725046174983e-01; +4.841997706390706e-01   +3.618106796370975e-01   +4.079488890811637e-01   +5.695526328960240e-01   +2.884114031972345e-01   +1.545842127095414e-01   +8.682580886371550e-01   +7.375936452030434e-01   +3.203751738956619e-01   +4.201559454637606e-01   +5.975761185533802e-01   +6.258964554370586e-01   +4.001814394161697e-02   +3.583621691270638e-01   +3.314925631866275e-01   +1.992381441184473e-01; +4.802575783551845e-01   +5.386121070306774e-01   +4.013245874894415e-01   -5.466164522221370e-02   +7.664895025471017e-01   +3.780972567846469e-01   +4.448967983629424e-01   +5.312188869230723e-01   +3.700319998131038e-01   +2.052119432878895e-01   +4.686332629293799e-01   +2.626750650865926e-01   -5.834037939367877e-02   -1.844146069630537e-01   +3.586716403148514e-01   +4.230279492440573e-01];
L2I_L2E_iAMPA_netcon = [+2.294841728456208e-01   +7.943420654073419e-01   +6.577081715561787e-01   +5.564443661869440e-01   +4.167627694014705e-01   +6.526726173958125e-02   +8.359344633283383e-01   +7.307218297376118e-01; +6.314117133046870e-01   +8.617835464736061e-01   +2.863020166085424e-01   -8.850650486162896e-02   +5.912846653770969e-01   -1.057148538958457e-01   +2.023457755975881e-01   +4.080334287356780e-01; +6.953149831885841e-01   +4.899573415296900e-01   +6.653204213439704e-01   +2.274357558571623e-01   +3.903359672331417e-01   +7.391215399655414e-01   +4.866832533042843e-02   +2.363864743336299e-01; +4.099090422500510e-01   +6.784253759365392e-01   +2.855402997369204e-01   +1.232065438842800e-01   +6.520501384276017e-01   +7.791079063803572e-01   +6.887867934529180e-01   +6.183370485014351e-01; +8.620938566166563e-01   +2.682410118473906e-01   +4.915346643479607e-01   +1.550586213363830e-01   +2.784558862816600e-01   +7.314904684106750e-01   +5.894376983317851e-01   +3.991327596915829e-01; -4.832048766920709e-02   +2.894780653727140e-01   +5.474480035117399e-02   +3.659293550272145e-01   +2.522123797513792e-02   +7.133520252073039e-01   +8.130033346297237e-01   +2.279391993771956e-01; +8.960534214564093e-01   +2.034366260227467e-01   +4.887435336266022e-01   +9.919686464899685e-04   +1.827843760445496e-01   +1.567532783782335e-01   +6.014143353795132e-01   +4.640307680557254e-01; +4.346208222354098e-02   +2.603724440599818e-01   +4.006886824456978e-01   -3.141854718963083e-04   +7.809660054578323e-01   +5.994946912636716e-01   +8.257981161496880e-02   +1.804077158511574e-02];
L2E_L2I_iGABA_netcon = [+8.294253007367024e-01   +7.732328686384122e-01   +7.546849151867587e-01   +6.909401749808332e-01   +3.734333599702510e-01   +1.373561975859741e-01   +3.236978749672113e-01   +3.316951978228161e-01; +4.789579687302397e-01   +1.000000000000000e+00   +7.932759801508994e-01   +8.800329151996341e-01   +1.551287830643689e-01   +3.732924321725134e-01   -5.126577150288173e-02   +8.564964527490840e-01; +1.392230482523170e-01   +8.015452935081189e-01   +7.670891739890773e-01   +7.595983406089519e-01   +5.669349636798240e-01   -3.156692963884980e-02   +7.082049240572568e-01   +1.712030222580843e-01; +4.844495021567727e-01   +3.032109628174040e-01   +7.504806084099586e-01   +2.279241139798088e-01   +5.993749668904673e-01   +4.698786568949099e-01   +3.919681540071197e-01   -2.126947299518696e-01; +4.330800601833240e-01   +9.156244344932130e-01   +6.488839078902517e-01   +5.961218640453204e-01   +5.966104040158937e-01   +3.994104714633401e-01   +7.473239501443537e-01   +1.023400212561616e-01; -3.528452638955180e-02   +1.378708965528809e-01   -2.070636629960370e-01   +2.484200564685249e-01   +6.875913732519502e-01   +4.326016057491786e-01   +5.580998870232100e-01   +2.404276020229227e-01; +4.451654908445120e-01   +8.192095472751565e-01   +1.520220521370966e-01   +3.748776927073695e-01   +4.385323346330963e-01   +9.566657522126371e-01   +6.142288971472341e-01   +7.748153042943968e-01; +3.616400473917076e-01   +3.975867566986828e-01   +3.627197247881327e-01   +8.121358214837412e-01   +2.968373687615015e-01   +4.361860670850881e-01   +1.928445729291522e-01   +1.397038640807294e-01];
L3E_L2E_iAMPA_netcon = [+2.182109781885256e-01   +2.169880496961924e-01   +5.797263768624584e-01   +3.668378766399232e-01   +6.444823873367964e-01   +4.565936614114681e-01   +5.179614967792369e-01   +5.772526582562754e-01   +1.669655118469900e-01   +6.858817145403256e-01   +1.000000000000000e+00   +6.634426268206588e-01; +3.166923293091608e-01   +3.413768750442893e-01   +7.262443769324084e-01   +2.645282351288688e-01   +3.263157604849992e-01   +2.884954435862521e-01   +2.765354419735142e-01   +9.214354600676713e-01   +1.392282138528355e-01   +4.531002925524543e-01   +4.161654427700687e-01   -1.263928465899491e-03; +1.445845319447281e-01   +4.485378409171091e-02   -7.562716652553758e-02   +5.579175225414326e-01   -1.295330163959189e-02   +4.044629280164789e-01   +2.068047818033125e-01   +2.573158426224508e-01   +1.907567300386386e-02   +1.173036505282709e-01   +1.942675673618235e-01   +4.121805765184380e-01; +4.559613903838854e-01   +3.581880256519670e-01   +1.378620537388020e-01   +4.801186425701610e-01   +5.431321133381126e-01   +6.295739578330938e-02   +3.540032801683208e-01   +1.220663452124807e-01   +6.044281446019805e-01   +4.941820926123451e-02   +3.297656213015181e-01   +6.367319591162756e-01; +6.128500651485963e-01   -5.825060563123603e-02   +6.801797667572765e-01   +5.797588176269055e-01   +5.075173197164916e-01   +8.243031206558074e-01   +4.289147825744815e-01   +5.590388489251750e-01   +1.989486836754306e-02   +7.819480743034203e-01   +4.945458842676470e-01   +1.989773746132386e-01; +5.691209170496727e-01   +5.475673594018877e-01   -2.904724574158546e-02   +4.925351362063333e-01   +3.567326471612532e-01   +6.871481967811840e-01   +5.910154033765723e-01   -1.474205780314302e-01   +1.502098880400193e-01   +5.819231013891720e-01   +2.267924722724304e-01   +5.481025454269223e-01; +6.876274598037181e-02   +4.614603694120013e-01   +3.811057312569819e-01   -1.525264198660247e-01   +9.898899760308060e-01   +6.531531453090174e-02   +5.183388517901115e-01   +7.058485018550416e-01   +1.834036948401095e-01   +3.672890066027626e-01   +3.507440714953602e-02   +6.404691280791421e-01; +1.428521977621155e-01   +1.450481096361993e-01   +2.804455478850212e-02   +1.444713240407556e-01   +6.262917827934821e-01   -1.981299663700608e-03   +5.966537679388558e-01   +1.726725700397302e-01   +1.988402252834706e-01   +4.289245208649778e-01   +5.207612796844796e-01   +9.546793943934003e-04];
L3I_L2I_iGABA_netcon = [+7.474903747957765e-01   +4.511441071466659e-01   +6.116591617104610e-01   +1.321462816499175e-01   +2.268824086334507e-01   +5.039547849177477e-01   +4.785805543531738e-01   +2.635344902982962e-01   +4.144316458358623e-01   +3.375927448694633e-01   +5.087316286658750e-01   +7.668624624644721e-01; +4.385749500288036e-01   -3.036232287581689e-01   -1.793310309406427e-01   +6.239060210200649e-01   +2.849779381351956e-01   +5.417576749717573e-01   +3.650144595668212e-01   +3.156921951342748e-01   +7.774637733084399e-01   +8.676312642495350e-04   +6.290119454941667e-01   +2.647983569663422e-01; +2.390418598028403e-01   +4.300819610889765e-01   +7.378654779121373e-01   +7.723183666644715e-01   +3.112665410697257e-02   +3.958182197692864e-01   +1.467382888274008e-01   +6.579781868777466e-01   +5.894222733342770e-01   +4.107422157983435e-01   +7.516492966629698e-01   +8.941270798485028e-01; -1.013115802478648e-01   +3.922960280099203e-01   +9.396144784144086e-01   +3.523618200803691e-01   +4.290723966666850e-01   +6.522585961486713e-01   +6.804691231406360e-02   +4.317549161878263e-01   +1.500933890952728e-01   +1.879835886075208e-01   -1.531783187082213e-02   +1.527714276588609e-01; +2.393725851378321e-01   +5.360014602302898e-01   +1.515685158828116e-01   +1.588469007158002e-02   +3.635000503111904e-01   +2.430975468826279e-01   +2.177464014382326e-01   +2.417575415070368e-01   +3.983948475545033e-01   +7.698065115274617e-01   +8.408669170342786e-01   +6.736393585765414e-01; -1.563298004145582e-01   +7.590269164096298e-01   +1.242050392885529e-01   +6.228061515538644e-01   +2.083005463280063e-01   +1.389780009840308e-02   -1.147644652375218e-01   +2.819760171359502e-01   +2.540892104962924e-01   +6.212757826387754e-01   +7.646268136322163e-01   +6.996419275580269e-01; +6.674915853896700e-01   +4.584449520649470e-01   +6.965600070887218e-01   +3.658178174720014e-01   +5.133043184353173e-01   +3.776450050408673e-01   +3.198798369290104e-01   +4.299231638783435e-01   +1.948355405099672e-01   +7.417413512183234e-01   +3.044437283363732e-01   +5.490591164012840e-01; +4.526597591590042e-01   +8.859220222395647e-01   +2.779460707104645e-01   +7.060783793437940e-02   +3.133005567528043e-01   -2.606406930977210e-01   +1.000000000000000e+00   +6.266038693284431e-01   +6.789012484644648e-01   +7.095026507688548e-01   +4.145741487266424e-01   +7.275197358742672e-01];
L2E_L3E_iAMPA_netcon = [+4.208574288795021e-02   +2.801719664901190e-01   +3.511866111246237e-01   +5.352630310661497e-01   +6.131452029914916e-01   +3.850174756852927e-01   +2.708957710145459e-01   +1.551317532675075e-01; +6.471730288232131e-01   +8.367412502626002e-01   +1.355841036396707e-01   +5.735142477455050e-01   +1.864172454909678e-01   +6.168384898143113e-01   +8.221131228789737e-02   +6.982218929368988e-01; +8.136514078176303e-01   +4.457448978337713e-01   +1.948671700229015e-01   -3.163759399909619e-02   +8.662302282745359e-01   +7.551197190414320e-02   +3.154398209388743e-01   +2.524580802459413e-01; +4.730308418273130e-01   +8.043407177475480e-01   +5.068667090914091e-01   +4.453098285812984e-01   +7.289263343531774e-01   +4.106314587189484e-01   +3.548778150632095e-01   +6.281290601263959e-01; +2.200009448200044e-01   -4.572864296954685e-02   +6.648843507851758e-01   +4.602377253571652e-01   +4.946861229899487e-01   +2.210260393269675e-01   +7.373771434094418e-01   +2.865986921550715e-01; +4.329214829021245e-01   +5.340701652278035e-01   +1.755310358841733e-01   +9.642897663308143e-01   +1.782858947071621e-01   +7.890098349093353e-01   +3.335075151720877e-01   +6.051923768993319e-01; -4.044244028172232e-01   +3.974177892223536e-01   +4.579264965863755e-01   +3.124546603407234e-01   +2.170611317601865e-01   +9.330887536031110e-02   +9.322750162996938e-01   +6.173929449193958e-01; +2.510648014284490e-01   +8.876749238153286e-01   +3.637189980873765e-01   +9.287968916406886e-02   +3.545983468614993e-01   +4.849283954609658e-01   +7.359379620671347e-01   -2.208621462217284e-02; +6.477042199338632e-01   +9.408312306492036e-01   +7.075763975522845e-01   +8.395338894262094e-01   +1.940649293000435e-01   +5.885725254552309e-01   +5.735257859019599e-01   +9.794371514136812e-01; +4.343749092368855e-01   +8.128047377588854e-02   +3.202004588504870e-01   +6.666168992516378e-01   +4.052941547824931e-01   +2.088305942641157e-01   +8.019570102923028e-01   -2.700777588929815e-01; +2.368494537896128e-01   +5.255561413325349e-01   -3.138768953397963e-02   -1.489127606884157e-01   +3.917669133680477e-01   +1.790848020459550e-02   +3.594028935283637e-01   +8.606659837507704e-01; +6.058104730832909e-01   +4.405205904078608e-01   +4.644221014337338e-01   +7.658380166429990e-01   +9.447013216772917e-01   +2.360668736910052e-01   -6.480631432099457e-02   +4.689966223462125e-01];
L2I_L3I_iGABA_netcon = [+3.181964300612983e-01   +2.323775533516755e-01   -1.101421157631643e-01   +1.000000000000000e+00   +3.092968799539101e-01   +1.459081420420484e-02   +6.189192596322407e-01   +2.175727911310469e-01; +3.080459293864766e-01   +2.724928132598172e-01   +1.758246807892285e-01   +7.625870976709197e-02   +2.249425217831857e-01   +5.818067610826011e-01   +8.144675862004193e-01   +3.001531720087945e-01; +2.068833361715596e-01   +4.765498734729190e-01   -1.366886743003699e-01   +6.060665687367376e-01   +2.304753854402751e-01   -9.105240618921843e-02   +3.566266873407440e-01   +3.041173562679608e-01; +1.260069027364146e-01   -3.289866842894836e-01   +5.243825169694102e-01   +5.797480193324834e-01   +7.047370553267296e-01   +1.266188944487624e-01   +4.980225893915452e-01   +1.722845169376865e-01; +2.791675199250397e-01   +3.903602342493674e-01   +2.988761950459912e-01   +4.372869014593533e-02   +1.867463677919293e-01   +3.064295419667103e-01   +4.221274010404188e-01   +5.834678804329259e-01; +5.581465061468401e-02   +3.961585112207671e-01   -3.796488633944273e-02   +3.722862182856596e-01   +3.228080217095323e-01   +6.753483457899898e-01   +1.463926112905210e-01   +3.713600242083488e-01; +4.946171149696829e-01   +2.575573867178185e-01   +2.511674363903172e-01   +5.801290450785057e-01   +2.344340531783264e-01   -2.648405690705597e-02   +1.952493004605847e-01   +3.620304156469255e-01; +4.238470956852363e-01   +6.715344870486676e-01   +4.213807273391590e-01   +2.725544043542873e-01   +1.521547171979722e-01   +5.449800110870200e-01   +2.619463799517023e-01   -1.161026048152891e-01; -8.669237784642833e-02   +2.100581615446901e-01   +3.415815207915907e-01   +3.318208076083548e-01   +6.289252039101384e-01   +5.077656334156273e-01   +4.789823365138736e-01   +1.873393643617674e-01; +6.068018502415317e-01   +2.057519162096470e-01   +4.346928255863666e-01   +2.017809310687523e-01   +4.733824720041725e-01   -1.375793921294797e-01   +2.158184959156526e-02   +1.699777398107325e-01; +2.516290117884757e-01   +6.925633443618595e-01   +2.198446472574363e-01   +7.457379419181406e-01   -1.065490855306083e-02   +1.784133560371276e-01   +1.683844856520696e-01   +2.341074926836822e-02; +2.847347007763837e-02   +2.623560261706360e-01   -3.367405971882168e-02   +3.314308508711864e-01   +6.101174480084119e-01   +7.250791068646775e-01   +7.483655589476493e-01   +1.525625437443157e-01];
L3I_L3E_iAMPA_netcon = [+3.686067333762900e-01   +7.489635455233856e-01   -9.969622006260080e-02   +3.211510123989068e-01   +8.444330183659028e-01   +2.498589000233508e-01   +6.225806656932396e-01   +5.654419524117852e-01   -1.087330925664444e-02   +1.359902382904089e-01   +7.052780666373916e-02   +5.263925590059352e-01; +8.340701395773248e-01   +8.185955366961476e-01   +5.530726961613508e-01   +2.826746945074434e-01   -7.507263568977361e-02   +7.343524882780973e-01   +7.181871870082097e-01   +9.169714085708222e-01   -8.930003905324956e-02   +8.748309946463365e-01   +4.434803554418016e-01   +5.296951764416444e-01; +5.088864673416034e-01   +6.733842995515752e-01   +3.181018724938852e-01   -2.619457827202458e-01   +6.604981170219597e-01   +6.998351071060194e-01   +3.822559276289570e-01   +7.343764175327451e-01   +7.026188882379883e-02   +6.234065919950714e-01   +9.365932195033796e-01   +4.798508396057390e-01; +7.662010596337165e-01   +4.713583363379482e-01   +3.835893027418060e-01   +7.658217244356859e-01   +8.210434141775893e-01   +8.455039752087989e-01   +8.224703200231767e-01   +8.258234387232821e-01   +1.466994821356259e-01   +8.685964231083191e-01   +5.176047473892077e-01   +7.511394892486160e-01; +3.425868731123771e-02   +1.045534951212950e-02   +1.620395536761483e-01   -8.576704622993640e-03   +6.067937876251256e-01   +9.438563204176492e-01   +1.011186420528714e-01   +7.076510725018450e-01   +6.979301124709492e-01   +2.877358366493285e-01   +8.482230613608582e-01   -4.649173080993146e-02; +4.022802210265135e-01   +8.734626461562965e-01   +1.879994234812084e-01   +7.148729284947460e-01   +4.873354248589003e-01   +1.425899160026115e-01   +4.622337736914608e-01   -1.763626479952164e-01   +4.632330551864958e-01   +4.123813656194892e-01   +3.593255929804267e-01   +2.086229111411242e-01; +4.513804467783415e-02   +3.059448431267967e-01   +1.733091151158486e-01   +2.523839289361444e-02   +1.000000000000000e+00   +3.758398620072194e-01   +4.177846924146640e-01   +5.121664680523181e-01   +2.157177399686112e-01   +4.640299138127021e-01   +3.875339089045421e-01   +3.883913723449973e-01; +3.167599891393978e-01   +2.900936401832886e-02   +3.576490172578313e-01   +1.667472863913405e-01   +2.910260355886035e-01   +5.317843419020546e-03   +2.511753694004636e-01   +3.007865389184056e-01   -4.715146951562321e-02   +8.183033028477061e-01   +3.396313075777546e-01   +2.683847983541575e-01; +1.564677676634755e-01   +2.479074719943715e-01   +5.605013633803784e-01   +3.782043322640422e-01   +4.164480471692970e-01   +5.863401967715814e-02   +2.183170159195758e-01   +3.574572659408409e-01   +8.156587522340346e-01   -8.958128317912953e-02   +2.519506915172193e-01   +4.284441400606324e-01; +4.765224432902938e-01   +7.052563671799640e-01   +3.807318937870896e-01   +5.277152162769384e-01   -2.148212481539163e-01   +3.102055951606456e-01   +7.774843976293364e-01   +5.901506738182422e-01   +7.981012947707892e-01   -9.549340411378708e-02   +5.342237776143154e-01   +3.889219890645121e-01; +4.438865790080808e-02   +3.721269810084317e-02   +4.806559458929680e-01   +3.764879831470642e-01   +1.340758537521394e-01   +3.755453837634248e-01   +1.169263219813366e-01   +6.584766091337054e-01   +8.451835904311582e-01   +8.523461151774672e-01   +1.741317295448737e-01   +5.973393260195367e-01; -9.758602419198656e-02   +5.414128493925788e-01   +1.997368267618812e-01   +6.122224377932568e-01   +8.993121483515284e-01   +1.860540263728939e-01   +1.664843641597282e-01   +5.024368078848074e-01   +6.553397983943977e-01   +3.702603095058258e-01   +3.643339790264803e-01   +3.704622165467467e-01];
L3E_L3I_iGABA_netcon = [+4.973566763444701e-01   +1.377773528654391e-01   +9.786274664945814e-02   +6.147218059793571e-01   +4.210651248836734e-01   +7.519316557174782e-01   +6.240189870822431e-01   +8.729793184580940e-01   +7.454986358661552e-01   +2.926469924491976e-01   +2.435561369874838e-01   +4.903638518215206e-01; +4.200106719093413e-01   +2.082185921468221e-01   +8.957619625761734e-01   +3.329868127063124e-01   +4.056613761304277e-01   +7.252487547089788e-01   +1.000000000000000e+00   +2.708113987101524e-01   +3.663556211635641e-01   +2.039119216455811e-01   +1.444998512632121e-01   +4.471821785544302e-01; +6.276078385598323e-02   +1.776029945280145e-02   -6.917095411455557e-02   +3.696293207246100e-01   +2.450823916017049e-01   +4.114349067191180e-01   +6.518790412409935e-01   +5.698168556976010e-01   +4.762378857463825e-01   +5.526188470875032e-01   +4.842412661742385e-01   +3.712563414523751e-01; +4.775409588183940e-01   +8.061042310542722e-01   +5.371838272366979e-01   +1.257554396013387e-01   +7.603684801962814e-01   -1.815796996184439e-02   +4.858997472799297e-01   +3.607013906452988e-01   +3.145034247805061e-01   -1.326463172371760e-01   +6.138338251124401e-01   +3.931082099880133e-01; +3.559480551110956e-02   -4.088267630367178e-02   +4.146383896917168e-01   +3.871132350006675e-01   +3.795130398400041e-01   +9.963842332568644e-02   +5.078124490179358e-01   +3.302665861777759e-01   +4.006763625715016e-01   +1.889235475389516e-01   +4.806341345782044e-01   +1.636098002475888e-03; +1.580890820329790e-01   +4.468689777347417e-02   +6.437584500404263e-01   +6.101625419526515e-01   +4.048263999145978e-01   -9.309725806686805e-03   +4.152594029522944e-02   +1.771059774496269e-01   +3.358059772914170e-01   +6.206019961487924e-01   +6.602116453687149e-01   -2.003983954444864e-01; +4.868038159976602e-01   +4.384707072033091e-01   +7.374563411591583e-01   +1.920956850433075e-01   +5.784768873748420e-01   +5.504712193952280e-01   -4.256039727182756e-03   +6.393851356772777e-01   +6.120334582072753e-01   +3.312513791969106e-01   +4.702400264425699e-01   +2.504096108707502e-01; +1.790926209026489e-01   +1.373120718499584e-01   +5.618377826345752e-02   +8.397885452418883e-01   +5.286406482998851e-01   +3.471223848316464e-01   +5.200017146580703e-01   +1.152231472345736e-01   +2.402896081955079e-01   +3.656273340911867e-01   +4.154834328444146e-01   +8.254977225466674e-01; +3.850841705522280e-01   +2.437257314370603e-01   +5.812850398308317e-01   +7.687072718542384e-01   +5.493927372097516e-01   -2.267000711200167e-02   +5.326907247571581e-01   +5.231508820071195e-01   +2.163515895313567e-01   +1.573876463577991e-01   +5.050351569668550e-01   +8.217476726505705e-01; +3.433195965710866e-01   +7.569095889285823e-01   +9.971879145226977e-01   +8.170309592635353e-01   +1.818762709801149e-01   +3.191014022914585e-01   +7.016983630708715e-01   -1.990565015695483e-01   +8.863459592062003e-01   +5.479564215772614e-01   +1.544310174999145e-01   +2.304752936450232e-01; +3.863593178992894e-03   +3.505847297633904e-01   +3.344725817827013e-01   +6.135642801823779e-01   +7.596397856550446e-01   +2.408586225421007e-01   +7.369068228594842e-01   +7.375800443344094e-01   +6.864208354015192e-01   +3.951520589242549e-01   +1.024110157151558e-01   +8.464065821580913e-01; +6.551462152487437e-01   +1.571099420410238e-01   +4.322852408466899e-01   +6.936585374910997e-01   +4.999863882051695e-01   +4.568893000429886e-01   +3.534733752523315e-01   +2.634736663637202e-01   +3.020215685661595e-01   +3.418782440455717e-01   -1.177149825354066e-01   +2.426208383636780e-01];
L2E_Input1_iAMPA_netcon = [+5.651112597827631e-01   +7.520705533526092e-01   +7.746365046476614e-01   +7.738614658899411e-01   +8.812881317389128e-01   +5.991708504760307e-01   +1.000000000000000e+00   +5.322702062659798e-01];
L2I_Input2_iAMPA_netcon = [+7.768264091375857e-01   +7.188367698153741e-01   +5.350937201010687e-01   +7.391818416790066e-01   +5.549243558660716e-01   +8.779035883741461e-01   +4.553897359600027e-01   +7.078790370053666e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last =  11.21 * ones(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.5*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.4*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.5*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.4*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.5*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.4*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.5*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.4*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
