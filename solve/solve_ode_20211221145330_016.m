function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-7.842747382751147e-01   -1.292561154476855e-01   -1.735028523403887e-01   -9.399442802084956e-01   -4.763683933822956e-01   -2.350872216419359e-01   +3.184728994498177e-01   +4.481449704433293e-01   -7.298941523217359e-02   +2.250359554262635e-01   -2.167362254305159e-01   -1.447523337377354e-01   -4.518534767326614e-02   +5.660364769906081e-01   +7.231526841562386e-01   -5.808915888711335e-01; +1.358083777673357e-01   -2.457084289826168e-01   -1.393821576092504e-01   +5.732022457817060e-01   +8.504562140559385e-02   -7.497850494720401e-01   -2.657896007337238e-02   +6.166247243275223e-02   -2.673535736539294e-01   -4.389153108518304e-01   -2.454693650125155e-01   -3.764299298479407e-01   -3.634442619012647e-01   +7.796921486104176e-01   -3.371278777203484e-01   +2.923870927497000e-01; +6.271278976809911e-01   +1.421230555149225e-01   +3.629656967286373e-01   +2.458151419171322e-01   -1.462711688908107e-01   -4.155464740841353e-01   +1.085191258933526e-01   -4.770755741560751e-01   -2.815982251144486e-01   +4.915008366003397e-03   -3.123505802425493e-01   -4.139698689381084e-01   -3.181675553865696e-01   -2.932198564480361e-01   -4.936320709458245e-01   -7.031593185118895e-01; +2.232637705783376e-01   -3.078681521643097e-02   +3.247877816179845e-01   +5.018964391737811e-02   +3.017483099590414e-01   -9.053167436799950e-02   +1.078705241538916e-01   -2.046928441926216e-01   +5.426194740263501e-01   +9.476496083281651e-01   +1.129075153891820e-01   -5.526234225413683e-01   -2.225604230868554e-01   -3.680115715869278e-01   +7.099719462109375e-01   -7.718958056225168e-01; +6.101521347833542e-01   +1.085372082222293e-02   +5.489871861382157e-01   +5.244689337629715e-01   -5.992049956660208e-01   -5.060362363640968e-02   +7.703836904919591e-01   -4.484875939763455e-02   -1.676785388178036e-01   -3.404089239989693e-01   -5.731461729830523e-01   +8.237158085117545e-02   -6.089381307469823e-01   +3.986787877579864e-01   -1.303136295656778e-01   +1.563792913594474e-02; -2.208041947508731e-01   +8.424082857663510e-02   -2.999388090607543e-01   +1.456730161142538e-01   +4.529913874986575e-01   -3.480061581363419e-01   -2.959480230045576e-01   +4.257378986120609e-02   -8.028695685519947e-01   -1.363008377426507e-01   -4.868536169051438e-01   +5.408271614722838e-02   -5.047169412696718e-01   +5.469925493605741e-01   +1.904379308003015e-01   +2.581343564390814e-01; +3.309703117365558e-01   -1.646031449538727e-01   -5.554514797823637e-02   +1.036992373388246e-01   -1.601613295475691e-01   -6.376269879705682e-01   -1.857488801542939e-01   +3.853810780388168e-01   -4.191996245853664e-02   +3.593839357856500e-01   +1.919135445760830e-01   +3.162965746264334e-01   +1.431613606807859e-01   +2.809124219646089e-01   +3.880827627726299e-02   +5.240719367101959e-01; +2.185174528147529e-02   -5.379751047087609e-01   +4.688846359468337e-01   +2.090087889638379e-01   -1.000000000000000e+00   +1.077844571701673e-01   -2.128785963214145e-01   -3.561427601320039e-01   -5.613970356597007e-01   -2.119659883909229e-01   -2.966271951169266e-01   -3.705937253449637e-01   +3.031421036238828e-01   -5.485080524769220e-01   -4.744368306879025e-01   +3.915089213523534e-01; -1.728967325673863e-01   -2.790184191389160e-01   +6.062541267012544e-01   +1.591612526558761e-01   +3.461048626018170e-01   -4.303140727125419e-01   +1.276028652958655e-01   +1.215410971522419e-01   +5.240042543201540e-01   +2.791443129065321e-01   +4.751005480961683e-02   +2.041215152615936e-03   +5.369420289477429e-01   +2.622486953534992e-01   -2.389260318294850e-01   +3.255534661853052e-01; -2.276077231195539e-01   +4.740143646679588e-01   +3.226286976419972e-01   +8.921027151816979e-02   -2.598377343735220e-01   +7.640338284848375e-01   -3.472209881039792e-01   +3.071283223703234e-01   +4.150030600857236e-01   -9.729217491044657e-02   -1.430849344727318e-01   +2.901590352470886e-01   +1.121970900325903e-02   +4.665601274715981e-01   -1.858500480143221e-01   +3.633502257820052e-02; -3.184017830216062e-01   -6.090206397354668e-01   +2.308419531184616e-01   -8.178145624805822e-01   +2.463306820982196e-01   -3.529507611144005e-02   +7.354004373415558e-01   -5.045021782515571e-01   -3.922480481516441e-01   -5.082322038829822e-01   +5.585259482596340e-01   -6.947000335230819e-02   +2.026343639934664e-01   -1.865015610505602e-01   -4.634469454826090e-01   -3.185239419194927e-01; +1.929842603900577e-01   -3.454213103313872e-02   -2.413650171420035e-01   +2.024174112512027e-01   -4.627608173783143e-01   +5.346141264842471e-01   +4.342080655454919e-01   -3.767988974616814e-01   -2.299740195890355e-01   +6.138212633770497e-01   +4.734482116822180e-01   -6.127560652765481e-01   -2.210875289845640e-01   +2.675251795237641e-01   -1.545680831779424e-03   -3.541249061554481e-01; +8.424273555027538e-01   +7.937443907437058e-01   -6.228417909652849e-01   -6.042870657613740e-01   -7.694602205704140e-01   -3.761658211025567e-01   +4.024159445465039e-01   -2.570038894748535e-01   -8.557438523907548e-02   +4.046086329417326e-01   -7.949865311213549e-01   -2.864348502908387e-02   +3.237306895307827e-01   +3.613119558491924e-01   +4.064060584545308e-01   -4.197105088231263e-01; +4.556367883975759e-01   -5.806670353421204e-01   -4.853298580504368e-01   -5.650242577982229e-01   +1.553888069970602e-02   -5.046948248950911e-01   -5.543573174506246e-01   +2.764608885790113e-01   -2.114249823176514e-01   -4.054586382552956e-01   -6.615434752111401e-01   -7.172213551177381e-02   -1.535940079988971e-01   +6.905337534991032e-01   -1.279194089336229e-01   -1.841707098738436e-01; +3.236413957830257e-01   -2.311011880488343e-04   +6.114742970908242e-01   +8.380856057531301e-01   -3.085570518452111e-01   -4.660632908771842e-01   -3.477499132326964e-01   -2.285734957217215e-02   +9.216580415054909e-02   -2.706152713371576e-01   +6.151955112913124e-01   -3.951044773092809e-01   -4.472870213853666e-02   +3.321417856716998e-01   -2.481146213810679e-01   +4.428429406490069e-01; -4.093344313350723e-01   +2.609903644940280e-01   -2.144504723901459e-01   +2.631895551623007e-02   +6.890853620986092e-01   +5.708941483462719e-01   -4.981961037601485e-01   -2.576290435873220e-01   +3.048065005823369e-01   -2.323165080435253e-01   +5.323448723429244e-01   +1.353834131257798e-01   +7.554414279710586e-01   -5.830267451943774e-02   +2.590883361698600e-01   -2.423333818407873e-01];
L1E_L1I_iGABA_netcon = [+5.349269136978028e-02   -2.560199239812689e-01   -9.991150529332317e-02   -2.953075779989635e-01   -1.079021884810137e-01   +1.704569768503382e-01   +2.300592126899656e-01   -2.264515897629861e-01   -5.753775619386419e-01   -2.196881954238977e-01   +7.926166805449797e-01   +7.214675396424075e-01   +4.945410406992136e-01   +7.296560199712229e-02   -5.273550964886661e-01   +2.992566595689428e-01; +2.375058948757204e-01   -2.622308519066570e-01   -3.647468961584753e-01   +3.602920729520068e-02   -6.840285026894000e-01   -3.920358286372684e-01   -4.275344924693785e-01   +3.267574280374308e-01   -6.210169063881393e-01   -5.797853730786200e-01   +7.934342723703047e-01   +5.180704435717750e-01   +7.575433878217608e-01   +4.421246269603246e-01   +5.436817813985922e-01   +2.454278345330504e-02; -7.818112212264615e-02   +3.669230563960450e-02   -5.561025065512983e-01   -4.842855094413140e-01   +2.503743747012967e-01   -2.928121909425130e-02   +6.120932381212896e-01   +1.630642400283509e-01   +5.328933288828350e-01   +1.578572016469678e-01   -1.636159465096375e-01   +3.650279992660942e-01   +5.351873068253445e-02   -4.927934371761141e-01   +6.123622154324925e-01   -4.446239978924547e-01; +2.668574129007756e-01   -2.713459151372849e-01   -5.160088872970595e-01   -7.620954566254867e-01   -6.964278801849585e-01   +4.402317768586571e-01   -7.813038964123818e-01   +3.422543038634784e-01   +6.046496861338870e-01   +4.333740237605067e-02   +4.425414285601451e-01   -2.596022300655182e-01   +3.808189056454895e-01   -7.481262511521307e-01   -1.786758554644991e-01   -6.419160760142594e-01; -2.653502801547933e-01   -5.792633862738080e-01   +2.583615439113432e-01   +1.849590443291199e-01   -8.121015025216047e-01   +2.687060379324840e-01   +5.978982221980896e-01   +1.584534558499091e-01   +5.462629982133928e-02   +2.085717378446080e-01   +2.692304620917169e-01   +3.763605980624815e-03   +5.375553608898349e-01   -2.846600512848015e-01   -5.889205415674119e-01   +5.313361105295092e-01; +1.766818548538583e-01   +2.136270897372073e-01   +3.410270012910389e-01   -1.324938890744952e-01   -2.178683504926778e-02   +1.670622675700778e-01   -1.415311501405181e-01   -5.053545639278731e-01   -4.915138431095224e-01   -3.247868854528956e-01   -2.244190861210158e-01   +2.902907981729801e-01   +7.072023994769568e-01   +1.319561152873076e-01   +6.976439544451263e-02   +3.918324093411176e-01; -5.331014060066146e-01   -6.522495263634205e-02   -5.084037247736110e-01   -9.359347420172245e-01   -2.951978936915003e-01   -5.015213143453382e-01   +1.164711590200326e-01   +5.420722347920008e-01   +4.672975910904845e-01   +8.611632463029135e-02   +3.490764475934169e-01   -2.559973157645733e-01   +8.571969548592389e-01   +8.269048115124833e-01   -3.407304628973043e-01   -5.800819982852782e-01; -2.574453908279700e-01   +1.521695644909659e-01   +5.532628462837710e-01   -6.594401147530977e-01   -3.169220948013136e-01   +1.635502387421061e-02   -7.182975788565547e-01   -1.909138482993122e-01   +1.000000000000000e+00   +2.127764537081469e-02   -3.398846165669425e-01   -1.082834160229730e-01   +3.880005499725806e-01   -2.370414987391083e-01   -3.266770806858149e-01   +3.463120319507108e-01; +5.389572895462095e-01   +2.554287313800556e-01   -5.993814146266196e-01   -3.466968727957344e-01   -3.899320684753538e-01   +4.595207519242032e-01   -3.913013217122527e-01   +6.123041110205159e-01   +3.595925460013796e-01   -1.104462720789581e-01   -4.049389180187991e-01   +7.674315332704922e-01   -5.363628228685032e-01   -4.932463275875574e-01   +9.961512838830358e-02   +2.175901780564180e-01; +4.256718596534940e-01   +4.104201656338469e-01   +7.921852845952599e-01   -2.786310483395724e-01   +3.720616717848503e-01   +3.502380900705523e-01   +1.738735051695889e-01   +6.189938596935713e-01   -3.982749176273458e-01   +3.011831564703014e-01   -8.962202744536005e-02   +6.543913945331117e-01   -2.471042169309293e-01   +9.689150603361474e-02   -1.579854129035652e-01   +7.095932477355060e-01; -8.112810009934270e-02   +3.935199798322546e-01   +3.150609101707069e-01   +5.210916594250538e-01   -2.628658083623524e-01   -2.035212638322173e-01   -1.366558789830135e-01   -1.548917157590302e-01   +3.886303148646577e-01   +3.152771534506243e-01   +8.572497635456208e-02   +5.817135199080790e-02   +3.551344254024911e-01   +1.645209121530536e-01   +4.491743167734797e-01   -3.068608647973273e-01; +1.423208758748575e-01   -5.928707367850761e-01   -9.480441164812281e-01   +7.610247495863580e-02   +6.992794595729869e-02   -2.337173345839048e-01   -1.204076723042731e-01   +4.426768216969796e-01   -7.010945137363077e-01   -2.193699809129489e-01   -7.803264323479464e-01   -2.422058422336903e-01   -3.887015979375827e-02   +8.044222008636633e-02   -7.175660566413081e-02   -7.682457401307728e-01; -6.728948603532072e-01   +6.574006146787128e-01   +1.716793119005222e-01   -5.204084349942451e-01   +1.255191137547632e-01   -3.469852806897809e-02   -4.983633952929195e-01   +2.300751165184393e-01   -5.037375859404839e-01   +3.271375374027246e-01   +4.946465317631170e-01   +5.723571233769995e-01   -3.579868995944515e-01   -1.674400010810438e-01   +7.416108121808185e-02   +1.480489064309965e-01; -3.837710271132628e-02   -7.425857500280551e-02   -1.792845811623087e-01   +2.731233477525096e-01   +2.967166630158640e-01   +2.765754628513798e-01   +1.136670243127427e-01   -4.269218279614512e-02   -1.084395888200065e-01   -6.928618996170806e-01   +8.784860891075786e-01   -1.528118970902558e-01   -1.203391848759298e-01   +5.741732821481789e-01   +4.658510143112986e-02   +6.608978509844630e-02; +4.607967416545742e-01   +1.040883738889729e-01   -7.957298402682554e-02   -3.788164023222464e-01   -2.412700308686136e-01   -7.983187488118666e-02   -3.928375255600096e-01   +8.322278029668770e-02   -1.598118071397258e-02   +3.494268760228871e-02   -9.042810136080940e-01   +4.683033610313938e-01   +3.707187011136347e-01   -2.505704561395152e-01   +3.971582186839113e-02   -1.347922857697967e-01; +4.704331232208905e-01   -4.188005612016153e-01   -8.181877601507151e-02   -4.181887139572831e-01   -1.431645720533240e-01   +3.298486958033214e-02   -3.018599233500142e-01   -5.458662145796801e-01   -3.310777942016256e-01   -6.991615383970551e-01   +3.720527239796519e-01   +4.775633110087754e-01   +5.081910600065648e-01   -2.977569994839838e-01   +2.647187533037842e-01   +2.121435964683565e-01];
L2I_L1I_iGABA_netcon = [+1.944109148509689e-01   -6.039481996267050e-01   -1.538217587347848e-01   -7.254810170218049e-01   +5.565636017827250e-01   +3.926989341632589e-01   -1.193411942625588e-01   +6.658962579439480e-02; -2.402019847710030e-01   +3.231183391227862e-01   -2.432776019621660e-01   +3.846083770222602e-01   +3.208136337988647e-01   +3.181277494556853e-01   +8.300387398923054e-02   +5.188205413407995e-01; +8.722074819726582e-02   +3.887055166156908e-02   -9.785166053349628e-01   -2.494511563946970e-03   -5.392047612418945e-02   -8.125670717566568e-01   -3.578534862544283e-01   +5.617093594024787e-01; -1.000000000000000e+00   +9.106910309404833e-01   -9.803106909001935e-02   +8.761066408539468e-02   +1.064631580699459e-02   -1.695715138015186e-01   +9.724238756768576e-02   +3.210488090903901e-01; +8.401760132604899e-02   +5.346829425370776e-01   +5.700981710263214e-01   +8.950254649472619e-02   -3.736725669730365e-01   +4.375196872961987e-01   -5.577074826198621e-01   -3.578356902617849e-01; +5.821345437915643e-01   +2.117252441897174e-02   +1.268623407052695e-02   -3.578625317643528e-01   -4.341842394688595e-01   +4.384745360135719e-01   -2.911355322477468e-01   +2.010704397020614e-01; -1.705384525724640e-01   -4.076391314151760e-02   -4.808272048729529e-01   -8.657220904866425e-01   -1.547494425284853e-01   -3.807672898128331e-01   -4.033109791022563e-01   -5.974377683573567e-01; +7.135914643343524e-01   -7.989109760393377e-01   +5.012869977032095e-01   +9.867165651420737e-01   -7.260389022432302e-01   +4.036354310585208e-01   +6.823193899565998e-01   +6.037546605978747e-01; -5.660700614154190e-02   +8.317068688786154e-02   +1.452243627149369e-01   -4.479331809498618e-02   +2.664204374346029e-01   +4.912738405180297e-01   -2.844799381521316e-01   +1.716929681981925e-01; -5.158610804620787e-01   -1.009171215118794e-01   +3.000349486677282e-02   -4.685205247598949e-01   +7.626739716158913e-02   +1.568139397241284e-01   -6.032316721832685e-01   +6.622546127533628e-01; +6.350828575765793e-01   -6.916906671931258e-02   -3.098037470300878e-01   -9.185452390916772e-02   +1.084776697926766e-01   +4.845889032336735e-01   +3.491430762115918e-01   +6.918631915410743e-01; +9.146985029530469e-02   +5.287878813466960e-01   +3.415216854464148e-02   -1.471910824611290e-01   -3.021355692324482e-01   -2.088795033894147e-01   -4.912538522678010e-01   -4.635025142581350e-01; -4.582257180477618e-01   +5.304212423749187e-01   +2.946329925701993e-01   +3.931455877240975e-01   +3.139192941797372e-01   -2.633580820526814e-01   -1.705939790643902e-01   -7.326173555398166e-01; +2.794829458452606e-02   -5.161673560654273e-01   +4.501043207550977e-01   -2.671258867488552e-01   -1.804840402542274e-01   +5.696174961418112e-02   -4.570455302707195e-01   +7.044249051031999e-02; +1.691185176023905e-02   -1.941906830223863e-01   -5.589166944571903e-01   -1.527372542097060e-01   +9.121694740905358e-01   -7.907666787448941e-02   +4.401369289568140e-01   -7.176774903205866e-01; -2.556031409746042e-01   -1.656037989101218e-01   +5.396064196353659e-01   +4.785837840595465e-01   -1.183083127829892e-01   +1.282737716843874e-01   -2.649169063127058e-01   +5.054383545896423e-01];
L1I_L2I_iGABA_netcon = [-3.098021984773427e-01   -7.130412025882888e-01   -2.742500045559085e-01   -9.561277645352997e-03   -2.870682156082207e-01   -5.000752574498568e-01   -3.410767142869861e-01   +4.193682399764596e-01   -1.174883318502700e-01   -2.187172524611085e-01   +4.744968584188679e-01   -1.401901662787695e-01   -3.402325859276975e-02   -1.184664763269900e-01   -9.961236465736362e-02   -4.235195834757727e-01; -4.256519170940421e-02   -3.726405437092601e-01   +3.294899391745085e-01   -2.033545292882042e-01   +4.003341047565657e-01   +1.124784272876612e-01   +4.633293045712064e-01   -3.166173737125930e-01   +4.946217308685923e-01   +5.658418164097421e-01   -1.352077286833893e-01   +2.694582847679547e-01   +2.591058066880579e-01   -3.351682152514338e-01   -2.013625713230535e-01   +1.518101251408916e-01; -1.820911400882673e-01   -3.700356006278959e-01   -5.169694556812295e-01   +3.384545580138673e-02   -3.105050910471889e-01   -4.580824394175081e-02   +6.067590246186001e-02   -2.508438771855148e-01   -3.749408813029779e-01   +6.510196615772429e-01   +1.384090296468547e-01   -4.981882927734624e-01   -3.327807983902619e-01   +1.546683781965437e-01   -7.165458023818052e-01   -4.834647898395977e-01; +5.415243708880186e-01   -2.218547663799245e-01   +2.995286316744626e-01   -6.538965665773503e-01   +2.725075620095228e-01   +4.113560492292506e-04   +5.769908654808875e-02   +4.178380764831044e-01   +1.473603446425082e-01   +4.831255320571720e-01   +7.360264872686938e-01   -1.166958314827901e-01   -3.045158520408197e-01   -8.635339739992567e-01   -6.884015549434181e-01   -9.191560928215899e-01; +3.368068674730484e-01   +5.098413769287954e-01   -1.806815183631264e-01   +7.419817216552171e-01   +5.431747548900375e-01   -3.319226423139622e-01   +5.919881821361516e-01   +1.249687917319113e-01   -1.000000000000000e+00   -8.179627139587773e-01   -3.170902460918177e-01   +2.011674571060011e-01   -4.146321131467865e-02   -7.177748522523830e-01   -3.831356538556993e-01   +4.145873671467681e-01; +3.244212884502301e-01   +4.092120882201381e-01   +8.433628939106798e-03   -3.613879992834320e-01   -2.942790185994621e-01   -5.557816072469950e-02   +5.597844887835079e-01   +4.352597205754478e-01   -1.476733839717458e-01   +9.398724183142414e-01   -4.720859549223860e-02   -6.100036727510681e-01   -9.509317659461568e-01   +7.299145532580126e-01   +4.372766160493002e-02   +2.021690678426299e-01; -7.515820181533094e-01   +3.779130031704032e-01   -3.794593777233572e-01   -3.958287851242208e-02   -6.735100532340733e-01   +3.420072388760156e-02   -5.526789255508872e-02   +6.575339548777590e-01   -6.727222905231246e-01   +9.442427341067462e-01   +1.518110586024193e-01   +1.857373850894321e-01   +5.825355867140128e-01   -1.775771129903111e-01   +6.984474112448625e-01   -4.513211145506474e-01; -6.802269553421365e-01   +4.510776232586018e-01   -4.083148600782594e-02   -3.208803973814372e-01   +1.540847357637826e-01   +5.284577816489335e-01   +4.239187242715423e-01   +7.584125143143386e-01   -1.237108473758499e-01   +2.923337949997953e-01   +5.158536798212039e-02   -1.083756895080660e-02   -4.045894867666676e-01   +6.004221065855876e-01   -4.601463091714249e-01   +1.033468491936383e-01];
L2E_L1E_iAMPA_netcon = [-2.494520364495222e-01   -5.588589253699414e-01   +6.536439135284003e-01   -1.473673305669460e-01   +4.381898486281977e-01   -5.267155544779651e-01   +1.918375163008746e-01   -3.529802441335841e-01; -2.194223410936717e-01   -1.234528397868565e-01   +4.020243556712419e-01   -8.095539435908241e-01   -4.113269534862816e-01   +2.673732235397974e-03   -5.525680617966293e-01   +4.255531026468935e-01; -5.423144968120240e-02   +4.292344393600557e-01   -1.910681300250620e-01   +4.394615938882054e-01   +5.935218656719336e-02   +4.061636002911255e-01   -1.618774985120074e-01   +3.674836847023314e-01; -4.117643259842142e-01   +4.293750889703730e-01   -1.669641690167659e-01   +4.503337509956320e-01   +4.117549946742800e-02   -5.978073833473008e-02   +5.983726302259497e-01   -1.783312601821856e-02; -9.730905738115132e-02   +3.315864429301560e-01   +8.435090753136203e-01   +7.419195702613982e-01   -4.976745981186410e-01   -3.270595590821538e-01   -3.799062009476157e-01   -5.436504034200138e-01; +5.659416598372733e-01   -6.596767459349998e-01   -6.603020715797731e-02   +7.934738450678580e-01   +3.726650289872550e-01   -4.807424965910823e-01   +7.448036127352723e-01   -7.072951797316777e-01; -7.746217880742623e-01   +8.249552952976483e-01   -2.753051246660667e-01   -6.920095924235173e-01   -6.472537112544066e-01   +3.751295341126448e-01   +8.028493611038710e-02   +3.487595168132731e-01; -1.856495463915175e-01   +4.666487391820818e-01   -2.043953024063366e-01   +3.543012004996918e-01   +3.654839708250287e-01   +5.774470463530149e-01   +2.194812815926666e-01   +4.635808735962110e-01; -7.036495564303140e-01   +9.367352097063117e-02   -1.890876010635188e-01   -8.128438468190416e-01   -2.240877417746969e-01   -3.376684047386267e-01   +2.645218583509643e-01   -1.372519408893823e-01; -8.258914703309600e-01   -1.687474482266515e-01   -9.012083291128253e-01   -5.149271040908101e-01   +5.063109483450028e-01   +1.135837649684170e-01   +1.298482003909996e-01   +2.373238814410787e-01; +1.418125356723308e-01   +3.392962570947918e-01   -4.774476315898507e-01   +5.649815570532545e-01   -2.430720072803111e-02   +5.547470593647697e-02   +5.138538576616590e-01   +3.798601090461735e-01; -1.315778498866720e-01   -7.617981282121419e-02   -1.689484675101393e-01   +6.604893998242075e-01   +4.086149335990046e-01   +4.660696953462651e-01   -6.555574621833204e-01   -3.247213596126248e-01; -1.000000000000000e+00   -1.558060614699559e-01   -3.803820163653258e-01   -5.485285520228667e-01   -7.582785467819082e-01   +7.636327831767217e-01   +7.092900711265026e-01   -5.180574560025690e-02; -5.882406769959126e-01   -2.337462370299569e-01   -9.435502717241995e-02   -5.984121594934835e-01   -7.255746414205617e-01   -3.297965378774786e-01   +6.528247952901342e-02   -2.271179244068892e-02; -5.234431223538748e-01   +5.084183622306363e-01   +4.850892993758946e-02   -3.087604397797537e-01   -1.698960563494811e-01   +8.655558349636058e-01   +9.624795381266361e-01   -4.398337950682912e-01; +3.498130503772331e-01   +2.652832820793433e-01   +8.035693529167069e-01   -8.631422572458729e-01   -6.769116394553319e-01   -1.512313356217128e-01   -4.343456630073212e-01   -6.787729109838337e-01];
L1E_L2E_iAMPA_netcon = [+1.432116246653197e-01   +5.006877018403505e-01   -1.202143111072648e-01   -6.193423970862264e-01   -9.724497394268500e-03   -4.552679851831181e-01   +1.010694267414525e-01   +1.762639113598218e-01   -4.539416140951795e-01   -5.568422365131011e-01   -2.059606016253836e-01   -2.772779629152246e-01   -3.444299160767975e-01   -1.332818489747804e-01   +4.123345126525057e-01   -4.268465497305640e-01; -8.717495735892587e-02   +7.105770051812509e-01   +6.003471604161582e-01   -2.323749565715438e-01   +1.170661513686653e-01   +6.598601117712344e-01   -6.580015899381674e-01   +1.373668514788486e-01   +1.672671299810168e-02   -3.264293388064090e-01   +4.699801928336597e-01   +4.943764823783166e-01   -5.380466495802433e-01   -1.716330549454819e-02   +4.190828056026733e-02   +2.434619978860723e-02; -3.777124174745509e-01   +2.168112342611126e-01   +7.449820630641295e-02   -2.692930314333764e-01   -1.129504810585188e-01   -3.693812837165067e-01   +3.560065608191115e-01   -6.064118488941416e-01   -3.239883202816010e-01   -6.600948057351116e-01   +4.835683803680447e-01   +1.237630097337342e-01   +4.894498584417356e-01   -3.175658682048986e-01   +5.226953125931032e-01   +4.634508349478792e-02; +2.233104278765611e-01   +1.842145014994858e-01   +3.751006297785587e-01   +5.766212778953409e-01   +6.363757519053796e-01   +3.140449967444279e-01   -5.876170360617156e-02   +2.666182503638578e-01   -6.273815405384836e-01   +4.853995902121322e-01   +6.790833458979780e-01   -2.152056881082317e-01   +3.304268809164117e-01   +3.135879527328653e-01   +7.238934231055348e-01   -9.445206682289267e-02; +2.231551782245553e-01   -5.407955076789844e-01   +4.601478803897771e-01   +2.425184891070099e-01   -8.609539288288501e-02   +1.718002306095188e-02   -6.144915414402893e-01   +6.059855741361727e-01   +2.314473829716444e-01   +4.564803042946931e-01   +4.354288550824521e-02   +2.521648735023162e-01   -7.429008463589561e-01   -6.755786885335536e-01   -5.972390907318601e-01   -3.236235726489242e-01; +2.414584802147852e-01   +1.414979469763122e-01   +3.119681733434139e-01   -3.013055473688753e-02   -2.440896538158063e-01   +6.983745607318558e-01   +4.008474091272731e-01   -6.793737116687053e-01   -8.948264000571289e-02   -4.540276542077876e-02   -1.059733557421596e-01   -4.033255571425746e-01   -2.881390892715692e-01   +6.000607583720746e-01   +7.169800282512162e-01   +6.973152856103408e-01; -3.921457459768709e-01   +1.516690766489385e-01   -3.461128182983764e-02   +4.892162742203373e-02   +2.570922044692514e-01   +2.229581612523660e-01   -6.490568431359607e-01   +2.804188903876272e-01   -8.785121185318338e-02   +1.560381545597012e-01   -4.289693503598788e-02   -5.764731784430158e-02   -8.977592583539151e-02   -3.655421791317623e-01   +2.745637134747298e-01   -5.444521586823514e-01; -3.217639915094458e-02   +9.552243952147177e-01   +4.872822557468897e-01   +1.175231035279977e-01   -3.457435348036139e-01   +1.000000000000000e+00   +6.931397674182285e-01   +1.023662853813610e-01   -2.308404702856451e-01   +5.687015604492623e-01   +6.142810019122891e-01   -1.268673605433125e-01   -1.623884456630232e-01   -4.936890224616727e-01   +4.157869349851806e-01   +5.150076254164208e-01];
L2I_L2E_iAMPA_netcon = [+9.068156838343752e-01   -7.331219247312303e-02   +9.866729403708603e-02   -3.816770874856076e-01   -3.202833931307216e-01   -8.615094712352830e-01   -1.000000000000000e+00   +6.694080498883788e-01; +7.360046774564523e-01   -2.986673482773333e-01   -6.158197425671923e-01   +6.720290161740307e-01   +5.779561470621544e-01   -2.354098678843796e-01   -1.072469131051387e-01   -3.134213792855460e-01; -9.891857756924978e-02   +2.667699880578829e-01   -2.499818253256874e-01   -9.631547380664942e-01   +1.581821843640640e-01   -3.284144826039172e-01   +4.978856662398486e-01   -3.124503493652944e-01; -6.131408539994861e-01   +4.795376583011716e-01   -2.896078105523654e-01   -5.122148328118147e-01   -1.078623498180403e-01   -4.858318049149536e-01   -4.900479753653150e-01   +7.112535369019006e-01; +8.800113616806333e-01   +2.408059054347750e-01   +9.305103523140544e-02   +7.934380857501975e-01   +6.656754094006584e-02   +6.194162547351999e-01   +4.589613693884786e-01   +6.553009511135369e-01; +3.800638136021307e-01   +4.723607765340113e-01   +6.811076514412071e-01   +5.026388564793020e-01   +3.481128685597096e-01   -2.309987530411904e-01   -1.018586270231852e-01   -4.809735108804334e-01; +1.738623243581122e-01   -6.750182419840625e-02   -5.482548537716575e-01   -3.513749035292560e-02   +3.023657183209019e-01   +3.213799943785614e-01   +9.015698967732744e-02   -2.311988468243508e-01; -5.282502432102588e-02   -8.370426915974173e-01   -5.251636186196228e-01   -7.406294143052455e-01   +2.807649924021798e-01   +5.901494897510305e-01   +1.417543765148345e-01   -9.420555184169536e-01];
L2E_L2I_iGABA_netcon = [+3.746598785027139e-01   +7.788662236265936e-02   +9.089764086270187e-01   -4.201357556003402e-01   +2.337994435209750e-01   -2.661037962723715e-01   +2.803448227872355e-01   -4.648788386119960e-01; +2.680247043853886e-01   +4.119422576212114e-01   -2.796361224988549e-01   +3.066695348454164e-01   -6.078002913387851e-01   -2.695107376530140e-01   -1.282513870577697e-01   -4.002802007958505e-01; +3.372373721988517e-01   -2.047161699287270e-01   +1.000000000000000e+00   -6.105854643157964e-01   +5.809583132132320e-02   +8.806724878059712e-02   -5.814069286877330e-01   +4.971517580382454e-01; +1.061927262077321e-01   -4.452946027931474e-02   -5.388475517303540e-01   -2.179647048615450e-01   +5.016376650582186e-01   +2.016212207003507e-01   -3.783943545787585e-02   +5.363150900836726e-01; +7.138140622898610e-01   +1.702957143735764e-01   +8.317989315743565e-02   +5.249892576406652e-01   +4.875112674317529e-02   -4.429847306222980e-01   -5.374489071827812e-01   -4.834439763974298e-01; -3.384202591703997e-01   +3.410504115351120e-01   +2.124490291011171e-01   -8.671999507443780e-02   +1.746152892029914e-01   -1.425726509886194e-01   -6.580210024638939e-01   -4.927430022897065e-01; -5.655351304764434e-01   -1.990387691784825e-01   -2.017145336265241e-01   +3.884816125199890e-03   -1.137691843711950e-01   -6.607387534546059e-01   -9.287763580901888e-02   -2.457634752708575e-01; -2.480858342030114e-01   -6.310231166456711e-01   -2.722571191633920e-01   -1.767186794218618e-01   +4.978790918135465e-01   -3.128992129098053e-02   -6.833287029152629e-01   -2.044003871368410e-01];
L3E_L2E_iAMPA_netcon = [+7.361649383931419e-01   +1.107481046632758e-01   +7.712477514623017e-01   +2.075863766185515e-01   +1.537898857076746e-01   -1.448160743811457e-01   -6.496684048764276e-02   -3.908557963254303e-01   -1.631560288057790e-01   +1.832986689658914e-01   -4.283487408097318e-01   -9.117794667100679e-02; +7.000325845384070e-01   -3.855417974320564e-01   -4.742700537261811e-01   -3.346187475225313e-01   -2.584914310327500e-01   +6.311040004374271e-01   -4.272841508742354e-01   -5.209451567341361e-01   +8.115303073448074e-01   -3.439964964538024e-01   -8.761180969194436e-01   -3.019601483541314e-01; +7.218020672369381e-01   +5.411294006282698e-02   -5.363670536665802e-01   +2.639114898795433e-01   +1.000000000000000e+00   +4.489160731144782e-01   -7.282135847667665e-02   +9.952018539829056e-01   -5.361139829369136e-01   -4.353687665210165e-01   +1.605288055636510e-01   -1.030515197779263e-01; +2.525966125676170e-01   -9.012708480449209e-01   -6.368996546848144e-01   +6.842589799968177e-01   +2.740239247177299e-01   +2.263723623146654e-01   +4.869984486844935e-01   +8.229145175628216e-01   -1.701857155282968e-01   +7.274813497249989e-01   -2.166234517350738e-01   +3.939274656220860e-01; +3.761694187946905e-01   +2.538211954397419e-01   +5.378328373292933e-01   +3.500847509509444e-01   +3.323831062764077e-01   +3.060368513957072e-01   -4.323807018052567e-01   -2.453511097814742e-01   -5.944081514770259e-01   -4.381201530070742e-01   +2.538822551822108e-01   -2.503261502400102e-01; -4.224769812590801e-01   +3.245456596528895e-01   +9.336988501806212e-02   -3.183343801459483e-01   +2.257117418460566e-01   +1.285716600507473e-01   +2.873345569252090e-01   +6.050808253559522e-01   -6.364290163139419e-01   -6.745081447227894e-03   +4.433642136466657e-02   -9.134148816238428e-01; +4.472320748455854e-01   +6.761201462348645e-01   -1.025867592543453e-01   -1.113131622161544e-01   -7.774998224916092e-01   +3.711047832084551e-01   -5.615040799412450e-01   -6.688681933902010e-02   -3.458704155643755e-01   +4.846514560518486e-01   -4.031605592308440e-01   +1.388226160857442e-01; -1.523598567976608e-01   +8.052701785241855e-01   -2.923082331587527e-01   -9.348492304583078e-01   +1.465180999811838e-01   +6.541219423486879e-01   -2.763796778407197e-01   +6.039187386624877e-01   +2.571384683195952e-01   +6.922094795439439e-01   -6.458770075368908e-01   -2.317808772467214e-01];
L3I_L2I_iGABA_netcon = [+2.418451859542714e-01   +6.873092700527684e-01   +3.780436223166818e-01   -1.883455658916041e-01   +5.052862188003879e-01   -2.726655820977492e-03   -5.133091449608999e-01   -5.281622958002498e-01   -1.269177369929714e-01   -5.633102655927535e-01   -5.014096858943565e-01   -9.166449264479032e-02; +4.647727773979541e-01   +5.065122700779987e-02   -7.502884431544543e-01   -4.598918262748755e-01   -2.368214087456368e-01   +5.806566910808949e-01   -1.576878821025840e-01   +1.126501500277113e-01   -3.107952690752407e-01   -2.524129657078213e-01   -6.168123312303816e-01   -5.635331162648611e-01; +2.579818468027076e-01   +2.264128844494609e-01   +5.558851663896600e-01   -2.473320035258922e-01   -5.405925870552348e-01   +3.327631274697287e-01   -3.540447257110342e-02   -5.290666544427201e-01   -2.395710976238122e-01   +3.780705316169771e-01   -3.292151828324674e-01   -2.219634421934101e-01; +2.798976540911010e-01   +4.552316130175624e-01   -6.965417861879099e-01   +5.719068880059869e-01   +3.972284408423841e-01   -3.206683522101365e-01   +7.752637897127988e-02   -6.305006912309764e-01   +2.752137652876830e-01   -2.388410614789580e-01   -6.714986700005201e-01   -5.370074716806248e-01; -1.293507570764146e-01   +5.564402667451022e-01   +1.564239655090240e-01   -5.856876184151029e-01   -3.033347774317808e-01   +8.760094381261017e-01   -3.952387991326503e-01   +4.312427663065513e-01   +1.896398279243554e-01   -8.311567453594711e-02   +7.567695966582262e-01   +3.349382499984707e-01; +4.264002269976779e-01   +1.000000000000000e+00   -6.720372363388691e-01   +9.051725936707775e-01   -4.963142645514600e-01   +1.852651919398491e-01   +2.129776061251328e-01   -4.199180423204247e-01   -4.271772016162496e-01   +2.302551712628099e-01   +4.113225828771272e-01   -1.348087501522039e-01; +3.227926971955850e-01   +2.202869183070472e-01   +1.761693847583688e-01   +7.620323923066977e-02   -2.078520571542389e-01   -2.176662060717399e-01   +4.624648444674475e-01   -2.925535002776666e-01   -8.440146626802046e-02   -2.473448777844758e-01   +5.046611668271951e-01   +1.865002158389742e-01; -8.163246860506399e-01   +1.131648357232474e-01   +4.958314482447081e-02   +4.105418086879671e-01   -1.761969677862679e-01   +3.752158438964031e-01   +1.132451643915542e-01   +5.642584993533074e-02   -6.059132363130015e-01   +7.544025958342351e-01   +4.604355017345190e-01   -9.102858330778668e-02];
L2E_L3E_iAMPA_netcon = [-5.863678248707486e-02   -8.810423107667703e-02   -8.702358721905121e-01   +4.340577668950134e-01   -6.316698582514438e-02   +3.143774789621229e-01   -5.825004495169355e-01   -1.749566404004033e-01; +2.643736653338311e-01   -3.694875760184488e-01   -1.955354446289433e-01   -6.836468006574088e-01   -5.369100566002167e-01   -1.172481037805531e-02   +4.566003895894939e-01   +4.628072451341382e-01; -2.035746929400022e-01   -5.966413913681312e-01   -6.388764339048109e-01   +6.461181562150337e-03   -2.347944582487999e-01   -1.323232833376804e-01   -1.074087926091767e-01   +4.451045959308946e-01; +6.172595817675375e-01   +4.561474395093655e-01   -2.621744853745086e-02   +6.914160436330139e-01   -4.390397700283107e-01   -2.043172236054186e-02   +5.056895356820644e-01   +7.580453581051980e-01; +5.942896093294260e-01   +3.089147875429558e-01   -9.650373016448396e-02   +1.546001280705833e-01   -1.885701795133778e-01   -1.911561562607800e-01   +3.674771749343679e-01   -7.782044396487426e-01; -5.174853048305756e-01   -8.815766831362983e-02   -1.966147412275669e-01   -9.815936422533930e-02   +4.871937800547007e-02   -8.421850917343050e-02   +6.814348169417870e-01   -3.082841487080163e-01; +5.060097283821635e-01   +1.000000000000000e+00   -2.905104018350253e-01   -8.311165819441748e-01   +9.339297353129707e-01   +3.568845460773633e-01   -4.989298707829872e-01   +8.455182948457489e-02; -1.037021311955822e-02   -4.474458433160413e-01   -5.534578420765870e-01   -7.577344803813753e-01   +4.689884289993841e-01   +3.722346093299296e-01   -2.055733379758343e-01   +7.216951488524100e-01; -3.235468775634924e-01   +3.285546035825314e-01   -1.682603211094946e-01   +3.185941452514320e-01   +5.563414168837080e-02   -8.115133922202800e-01   -1.390875074993811e-01   -2.603477047448832e-01; +5.779431496629386e-01   -8.555374560132873e-01   +1.295121744876824e-01   +1.586519474143511e-01   +2.472455095690186e-01   +4.246637723463873e-01   +3.517346735362093e-01   -2.633270825639605e-01; -1.970572939273102e-01   +4.687790197842141e-02   +1.746188923783787e-01   +6.397985216712000e-01   -2.312932262687289e-01   -4.000794858617037e-01   -3.325233868872934e-01   +3.335305860779595e-01; +6.074421060834703e-01   +9.670063777304843e-01   -2.066407773047255e-01   +2.140525213470329e-01   +3.119529062712903e-01   -4.501863070467380e-02   -3.641670449738563e-01   -5.558675937653043e-01];
L2I_L3I_iGABA_netcon = [-6.398480823219013e-01   +3.996929723627320e-01   -5.812773153854315e-01   -7.177088017000284e-02   +6.567094572671228e-01   -4.871484139386793e-01   -5.569001527197165e-01   -1.530095672803704e-01; -5.804039251742848e-02   -1.362912885017892e-01   +1.489004115452885e-01   -3.442007263875337e-01   +6.893637444178318e-01   +6.209465519632755e-03   -1.129089637614004e-01   +1.121200563499144e-01; +1.184433464486137e-01   +1.604164128139794e-01   -5.196017678668874e-01   -5.910289832101244e-01   +1.645901508336815e-01   -4.041478553306210e-01   -5.515667809106244e-01   +1.000000000000000e+00; +8.151029294669720e-02   -9.524183755226780e-02   +1.323321903498652e-01   -5.148062721043997e-01   -7.671251479256291e-01   -2.413452016568017e-01   +2.049482749550035e-01   +4.835568074529404e-01; -7.599309818272187e-01   -1.560263446950235e-01   +4.507280148369116e-01   +4.909941026897234e-01   -9.962637499362907e-01   +5.088905400775399e-01   -4.138574443043938e-02   +1.876229544193529e-01; -3.898048685348407e-01   -6.202007827907942e-01   +6.916522188417205e-01   -9.199267215228193e-03   -3.077971771329593e-01   -1.321221574590339e-01   -3.762644280146106e-01   -1.923733053581601e-01; -4.523345173435948e-01   +3.082891851851826e-01   -7.944169123987583e-01   -4.432369185775046e-01   +9.950228525859592e-01   -8.919355617234811e-01   -6.449026044628251e-01   +9.837366541553461e-01; +2.111110602557444e-01   -1.107853552558643e-02   -9.118431501722242e-01   +9.702290555330872e-01   -4.048680636136182e-02   +9.374238542065012e-02   -2.090294785794669e-01   +6.648347678032432e-01; -5.988744428580119e-01   +2.482440757203286e-01   -7.418051878035550e-02   +3.592497407844197e-02   -9.827933541903979e-01   +6.659723564441677e-01   -2.798911696294274e-02   -3.093561265738804e-01; -6.828915468014259e-01   -5.006102871571823e-01   +1.611779081424365e-01   +6.075711435869809e-01   -6.479973779839600e-01   +5.165668397585977e-01   +2.091625104690760e-02   +8.026892840653604e-01; +2.197771532094851e-01   -1.169844534489975e-01   -1.240326911763019e-02   +4.769616833010511e-02   +8.320694937911048e-01   +2.903095587454069e-01   +6.753871486202009e-01   +4.776410006151496e-01; -8.144249218723464e-01   -2.044090343410427e-01   +6.619805089359351e-02   +3.661351901071760e-01   +5.840061495617578e-01   -8.359317330031329e-01   -5.535253922648316e-01   -9.879161041227440e-01];
L3I_L3E_iAMPA_netcon = [-2.915402282098072e-01   +5.338059480782819e-01   +4.542906115389848e-01   +1.661604784570651e-01   +1.144064922491936e-02   -1.929459924533430e-01   +5.409200660950402e-01   +4.768053904795507e-01   -2.506388268964161e-01   -6.403401577028728e-01   +1.862760020699158e-01   +6.272034331787691e-01; -8.138438591022241e-01   +4.757310986784940e-01   -3.749681775050032e-01   -2.634769474555682e-01   -5.444472785659791e-01   +2.992065605983934e-01   +6.836623403370555e-01   +9.975998753495628e-02   -7.558318228025828e-01   +1.186643602165005e-01   -6.696736754990078e-01   +1.789229455445946e-01; -1.244936406194903e-01   -1.308470203389485e-01   +8.442946358607277e-01   -2.983466883172216e-01   -8.041195255310407e-01   +2.206102569809305e-01   -3.519257127137299e-01   +7.274828105142779e-01   +5.385416031078668e-01   -3.322621010909516e-01   -4.382797521385102e-01   -1.664720348890970e-01; +1.000000000000000e+00   +3.746974244060119e-01   +7.393436223220123e-01   -1.613063325815053e-01   -4.858011692110610e-01   +5.996874809959130e-01   -4.565599055179006e-01   -4.558986345907535e-01   +9.130739946494102e-03   -4.000703244031585e-01   -8.451213599170627e-02   +3.976369082088839e-01; +1.161585361412327e-01   -5.739124524196640e-01   -1.689589250468345e-01   +2.251295144461098e-02   -3.049745998962125e-01   +2.898934543458601e-01   -7.418573611999052e-01   +1.708232637957100e-01   +7.444057272440745e-01   +1.612012896076370e-01   -5.818000112316924e-01   -6.411207100734569e-01; -3.958637402130629e-01   -6.731323480309361e-01   -9.335446205643708e-02   -1.361336672775826e-01   -5.309460200691806e-02   -1.503348853921974e-01   +1.654872694861161e-01   -5.567264958935089e-01   -4.309238839426752e-01   -2.934329821334248e-01   -5.176665418482502e-01   +7.016288607651061e-01; +5.025180161851875e-01   -3.946676556494687e-02   +8.860755492994998e-01   -2.785073024160285e-02   -7.169519167707376e-02   +3.916084747555277e-01   -4.379834048351826e-01   +4.567092831209822e-01   -2.465212196662726e-01   +7.427405721088790e-01   -8.277484180203151e-02   -5.235466985584453e-01; +7.752796563326859e-02   +5.865818906080524e-01   +6.452241479892168e-01   +4.137602734085665e-01   -1.943754671095563e-01   -1.367489958736047e-01   -3.675136475575050e-01   -2.772289946320721e-01   +8.125982275461785e-02   +5.486353830394519e-01   +3.430007526398243e-01   +1.278166475004918e-01; -4.004334452610437e-01   -4.189943450307336e-01   -4.755568153092142e-01   +5.925798719083746e-02   -2.753644864221431e-01   -8.148412430096335e-01   +5.181731705243593e-01   +7.107660418134532e-01   +1.765041121680341e-01   +8.662490690622136e-02   -5.624041728826161e-01   -4.316170104216943e-01; -6.794258745565180e-01   -2.346617115793866e-01   +2.851986523456689e-01   -2.122645262416685e-01   +4.603627834566753e-01   +2.957217586495444e-01   -7.008764596364853e-01   -3.519094823259943e-01   +9.803729467109737e-01   -6.399152611010417e-01   +5.369888731227647e-01   -2.900656235151846e-01; -2.846569984696461e-01   -3.922142535644054e-01   -2.162732062794576e-01   -5.388522085190381e-01   -6.825897766030808e-02   +5.674119999575036e-01   -2.863345921952445e-01   -4.081795035921436e-01   +6.507337960178147e-01   -1.654132282385614e-02   +1.290645844170891e-01   +1.138988567023893e-01; +3.373918315142767e-01   -6.482396953090102e-01   +3.486527676139630e-01   +7.584730150286632e-02   +4.818205656505518e-01   -1.725777900739857e-01   +3.256523076182547e-01   -7.702094198041729e-01   -3.635191857064926e-01   +8.089043491011916e-01   +4.149969599836901e-01   +3.635488772241250e-01];
L3E_L3I_iGABA_netcon = [-1.000000000000000e+00   +5.884670029332942e-02   -1.748495224166630e-01   +1.957177379529148e-01   +9.949576409520778e-01   +3.961525795038806e-02   +5.347450006954125e-01   -1.144717917102081e-01   -6.338983400338693e-03   -1.006231039922479e-01   -1.146764244724105e-01   +2.103010567948120e-01; +5.868205275620955e-01   +4.478182933595916e-01   +1.762646266758562e-01   +1.046105342554486e-01   +1.280100361426123e-01   -6.328446093783722e-01   +2.027812759609691e-01   -1.743789658375492e-01   +3.126021160641482e-01   -2.363525523527425e-02   -8.552235676931363e-02   +8.311553483586884e-01; +5.337770664027442e-01   -1.572568043333088e-01   +4.795198922107111e-01   +9.852622777972679e-02   -3.541438754115472e-01   -8.372868916892924e-02   +3.260780230877270e-01   -1.846313344866177e-01   -3.572668152684968e-01   -9.445997993459219e-02   -6.157063521781029e-01   -7.982805475786908e-01; -6.171972590969315e-01   -3.258412791795399e-01   +5.132813389200750e-02   +1.626592788814532e-01   +3.544706352439648e-01   -2.614538188725712e-01   -2.177118646089394e-01   +2.959819878556894e-01   -7.427156770772332e-02   -3.623097551580338e-01   +3.592917721290719e-01   -1.474241005114047e-01; +3.028165886725914e-01   -3.083983641754228e-01   -4.725758754845291e-01   +4.958782981955158e-01   +7.985231915971569e-01   -3.706763857746088e-01   -2.327642639990877e-01   -5.129532970032498e-01   -3.920026081102673e-01   +4.490620372664770e-01   -3.853692773982492e-01   -2.415750572918787e-01; +7.646154134877027e-02   -5.692917126912561e-01   +4.585338679349873e-01   +1.245554053235167e-01   -8.442698739839034e-01   +2.082959203357298e-01   -3.627222082557051e-01   -6.052246219666390e-01   +4.763575465614790e-02   +7.548842707122574e-01   +2.275251264806749e-01   -1.735328722549655e-01; -2.954286270336378e-01   +1.241999276335202e-01   +3.867697250360091e-01   +2.266356737620327e-01   +7.607746498632821e-01   +4.394886606148541e-01   -1.549397022350211e-01   +8.234169399776329e-01   +1.522053999506962e-01   +4.071830197456067e-01   -4.485849528507063e-01   -2.013723548742759e-01; +3.695770092308470e-01   -1.330884316307538e-01   +6.629925831713960e-01   -5.662168790012193e-01   -3.247088767523998e-01   -6.625881805984712e-01   +4.642073125466997e-01   +4.061119213901115e-01   -3.872418504020360e-01   -4.592099311236798e-01   +3.772037267262215e-01   -3.996684362983529e-01; +5.280585637446523e-02   +5.844908258869084e-01   +4.100874697045022e-01   -1.233140966228477e-01   +2.151732186532099e-02   +7.617387631329907e-01   +5.343666320238409e-01   +5.970321766366139e-01   +2.570911368945043e-01   -3.768508720538772e-01   -3.154267954586378e-01   -5.434302754859263e-02; +3.677545295554387e-01   +3.449674710373836e-01   +4.012794614475115e-01   +6.995096023055255e-01   +2.664778431861284e-01   +2.879123355895983e-01   -1.363682167374888e-01   +9.185523852520934e-02   +3.274087001707455e-01   +5.626726322502933e-01   -1.369985083212859e-01   -5.345180432367354e-01; +2.591157451743123e-01   -3.987639293075046e-01   -4.824357738722622e-01   +5.843964813107916e-02   +3.205728795310740e-01   +2.808119717452052e-01   -2.177663707260311e-01   +8.300885213503489e-01   -1.733955079355633e-01   +3.590036203292293e-02   -5.749800752874193e-01   +2.645015473483997e-01; -2.814196018674596e-01   -1.430922045581537e-01   -2.705420080870154e-01   -3.888676777516501e-01   +3.741374247276930e-01   +3.794678661694647e-01   -3.911030112512017e-01   -5.196052775899064e-01   +3.337499490060774e-01   +7.783409734688988e-02   +1.638209191982404e-01   -3.287014390626853e-01];
L2E_Input1_iAMPA_netcon = [+1.000000000000000e+00   +1.993871842649975e-01   +1.936263781595218e-01   -1.048910487837628e-01   +2.803655233361765e-01   +7.149449298450923e-01   +3.659670136741496e-01   -3.275866275600127e-01];
L2I_Input2_iAMPA_netcon = [+4.989636480589139e-01   +8.485785971472606e-01   +8.715581975604535e-01   +6.162883175854850e-01   -4.852266536449414e-01   +9.761956856544647e-01   -2.436445790427142e-01   -5.492637780861870e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.4*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 1.0*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 1.0*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.4*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 1.0*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 1.0*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
