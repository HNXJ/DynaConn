function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+3.799445386675545e-01   +3.466818499364870e-01   +2.315815622891915e-01   +1.319993238979335e-01   +4.089676133003841e-01   +4.491925930535124e-01   +1.538509525292157e-01   +3.248576344700888e-02   +4.928439996323012e-01   +2.511106792334016e-01   +2.623044817348886e-01   +1.696838809961949e-01   +4.322298991317875e-02   +3.422126623813029e-02   +4.783540711331130e-01   +3.644505613136002e-01; +7.274766159559573e-02   +4.943527354113221e-01   -4.122498051346886e-03   +7.261515509153775e-02   +3.709044115142928e-01   +3.026113959686882e-01   +9.708777680699834e-02   +4.944191137840774e-01   +4.192636425580858e-01   +3.325723708559468e-01   +2.337102690266741e-01   +5.089260390673874e-01   +3.273565627833452e-02   +2.528943577822041e-01   +1.981979747733263e-01   +9.799832953016063e-02; +5.081346912120478e-01   +4.554251505361258e-01   +3.161361467572070e-01   +1.454995214774044e-01   +2.860092022581148e-01   +1.531556736350991e-01   +1.133788292690044e-01   +1.725341338625349e-01   +3.533798648511109e-01   +1.681172517988697e-01   +4.998808117597472e-01   +3.022490067172875e-01   +2.338549280281288e-01   +4.235208596948465e-01   +3.654817649172576e-01   +4.625179413171112e-01; +2.423598856154577e-01   +7.098863455832966e-02   +1.399777726081970e-01   +9.555578408417695e-02   +5.960443746772239e-03   +2.369252992544204e-01   +1.589477078676963e-01   +1.309145290059902e-01   +1.436037613494759e-01   +3.757730981434354e-01   +4.996318871233062e-01   +9.396104950913947e-02   +1.498418834218362e-01   +3.305110581577839e-01   +2.004615674778578e-01   +9.065809827641894e-02; +4.833538570013586e-01   +1.578597663407078e-01   +3.379278107663387e-01   +1.712843186518162e-01   +4.599032057875047e-01   +4.451515460872690e-01   +1.004159773364416e-01   +3.886114446638668e-01   +1.450134891676854e-01   +3.390653814976825e-01   +1.016799340722986e-01   +3.451164494338336e-01   +4.183446331770692e-01   +4.474453496423028e-01   +4.257688200976374e-01   +4.191938505990768e-01; +5.038848678620520e-01   +2.242943985205413e-01   +5.009882752578116e-01   +2.125385228804972e-01   +1.680914484329666e-01   +3.977721899712277e-02   +2.093690617917217e-01   +1.971173616136054e-01   +1.039046013707000e-01   +3.092670202820741e-01   +1.155578375634382e-01   +1.828486831274170e-01   +3.304965787408635e-01   +3.947948917948288e-02   +2.109393199324066e-01   +4.584966557668622e-01; +1.321290763961946e-01   +4.527889380188139e-01   +4.252572710661212e-03   +3.856833043565353e-01   +1.379300833854390e-01   +2.680472665784046e-01   +5.041087171490407e-01   +3.266729131727973e-01   +3.684289469098564e-01   +3.345006132366292e-01   +3.193958877717048e-01   +5.123339402557027e-01   +2.844576021041561e-01   +3.887460479647687e-01   +2.833535922209496e-01   +3.217768701370771e-01; +3.305848273379491e-01   +4.767547104569644e-01   +1.236925631361381e-01   +2.079175317029738e-02   +3.758389542570469e-01   +2.550334033579942e-01   +1.849152030434327e-02   +3.127037662748246e-01   +2.277457965709332e-01   +4.291575499767454e-01   +3.852191169772192e-01   +1.164478099002487e-01   +1.397108336938497e-01   +3.267229301769138e-01   +2.043995651738847e-02   +3.264394218875167e-01; +3.008611683266093e-01   +8.536735505986518e-03   +2.482797153096472e-01   +4.681207636464825e-02   +1.896067601967669e-01   +4.289364993492438e-01   +1.941764711394537e-01   +4.587394602627578e-01   +2.831831999732634e-01   +3.108961102718584e-01   +1.234961553682746e-01   +2.080785370425029e-01   +2.751187931712044e-01   +1.279630310550704e-01   +2.798437055008040e-02   +1.215593188778270e-01; +4.103641253518889e-01   +8.614286236414456e-02   +4.217259630951418e-01   +4.347507149546176e-01   +1.477131741806463e-01   +2.038548201301239e-01   +2.564917282732805e-01   +1.358154969134475e-01   +3.023243400409085e-01   +1.874680572633307e-01   +1.307000428240686e-01   +3.852735948312914e-01   +2.840892429755540e-01   +2.269131521443301e-01   +2.405712777245265e-01   +1.403558909075237e-01; +2.874368627287904e-01   +4.775492498642604e-01   +2.248939588421112e-01   +2.221832907910363e-01   +1.674103854426902e-01   +9.164569174449994e-02   +3.560564852226212e-01   +8.475686267116693e-02   +3.902312238496041e-01   +2.807925425222912e-01   +4.773917954319016e-01   +4.324886101611702e-01   +2.510745164039166e-01   +2.766897194551787e-01   +8.546622614021158e-02   +4.861146320588223e-01; +2.990183964538881e-01   +4.319738082630838e-02   +1.900000897889464e-01   +4.927609517927614e-01   +2.322948344651499e-01   +4.115665815871309e-01   +2.766775311028944e-01   +3.435664430921820e-01   +1.252111631392125e-01   +3.726899413193688e-01   +2.732701879245797e-01   +4.516801132366350e-01   +4.169518933871852e-01   +4.157841281923643e-01   +2.508012079029305e-03   +4.001914898061021e-01; +4.621839757489246e-01   +1.281815969142821e-01   +1.308284003078450e-01   +5.166083970197943e-01   +1.073370110266834e-01   +3.565213010929907e-01   +3.003411836363968e-01   +4.899957778523771e-01   +6.221050284429108e-02   +2.735722832443029e-01   +2.596424036974128e-01   +3.194871016852695e-01   +4.036537150552995e-01   +3.133338061689763e-01   +6.827156071194315e-03   +5.014019860639943e-01; +3.257892899961126e-01   +1.712539149275474e-02   +5.096655612396385e-01   +4.855501577334955e-01   +4.439278511935272e-01   +1.659868379099672e-01   +5.789936253063939e-02   +3.869371290222654e-01   +3.640213147214389e-01   +1.217616584953037e-01   +2.188576303305339e-01   +2.738714455406142e-01   +3.461947175185262e-01   +1.728685976892362e-01   +4.781849030596875e-01   +1.334961934332028e-01; +2.080839140108969e-01   +4.783880246444621e-01   +2.800437500079485e-01   +4.739091477642677e-01   +3.477221295047159e-01   +2.431973110975856e-01   +2.191276528326782e-01   +4.937072048192859e-02   +1.032750220531929e-01   +5.131371693628094e-01   +1.112618223191387e-01   +1.343897980977180e-01   +4.681453228106124e-01   +2.134307785545786e-01   +7.853657042718709e-02   +3.518701794972624e-01; +5.044487622834958e-01   +1.191888976587485e-01   +1.766768084387454e-01   +2.294710013389760e-01   +1.018323932624209e-01   +2.680903464868098e-01   +4.504346297464675e-01   +7.718867150810316e-02   +3.784175205090927e-01   +2.978318018871896e-01   +2.737459176374393e-01   +2.342489859427911e-01   +8.723619085694248e-02   +3.943166407298742e-01   +1.264771071972489e-01   +2.147451683753693e-01];
L1E_L1I_iGABA_netcon = [+4.351847303483284e-01   +4.824055497358280e-01   +9.571850365438735e-02   +1.194489292901624e-01   +1.202219212558587e-02   +4.347677330505805e-01   +2.990676220299732e-01   +4.712844212264937e-01   +8.177248406607289e-02   +3.726101168632335e-03   +1.036872141907482e-01   +2.925783548468902e-01   +4.028399787215814e-02   +1.160008430025358e-01   +1.180967235176947e-01   +2.054398124899608e-01; +3.477271841717191e-01   +3.001201776793551e-01   +5.023466904263604e-02   +3.467790312943833e-01   +3.509392437870720e-01   +3.956804129644844e-01   +1.522357172226507e-01   +4.247167909850636e-02   +5.036933934274167e-01   +5.198777250287068e-02   +4.537920447371739e-01   +1.924168937878400e-01   +2.382608059571422e-02   +4.513654279724749e-01   +4.425824715871542e-01   +2.275775899488993e-01; +5.056524142670804e-01   +3.569342511748732e-01   +4.643783668647117e-01   +4.744355072215377e-01   +4.682866508371688e-01   +1.255912959336266e-01   +1.952949940599557e-01   +1.226932360414442e-01   +3.747196876087424e-01   +4.220991406904608e-01   +7.465727249987787e-02   +3.490097506790732e-02   +4.511063604201234e-01   +3.745517038603832e-01   +8.203380324587688e-03   +2.627867148880706e-01; +3.291696010539380e-01   +2.840889173021566e-01   +3.619608750385508e-02   +3.273594262416650e-01   +1.986163087120126e-01   +4.157742333671058e-01   +2.405649071553098e-03   +2.297610627495507e-01   +2.872138672913381e-01   +2.037760817908339e-01   +2.831838020498115e-02   +4.473568098186233e-01   +8.419688572709429e-02   +3.271767371568877e-01   +3.468757193801725e-01   +3.338780811819539e-01; +2.651713469518791e-01   +3.470510700139186e-01   +4.393371321828133e-01   +3.830968159141326e-01   +6.533384933442511e-02   +2.165708509338924e-02   +5.706632410578735e-02   +4.541409828140655e-01   +4.649959814265840e-01   +4.779912117666130e-01   +3.192072770142960e-01   +2.253908899958434e-01   +3.146203784226957e-01   +2.871989215889670e-01   +2.662782396841173e-01   +2.937253638427106e-01; +2.802576308077011e-01   +2.707860846634818e-01   +6.941429924566155e-02   +1.246092707879625e-02   +3.729644553949753e-01   +3.183995171850374e-01   +1.698960116619927e-01   +5.180940500566025e-01   +5.053776992787423e-01   +3.101019781180966e-01   +8.236423471954525e-02   +1.548531053491349e-01   +4.759282756500878e-01   +4.234571095546251e-01   +2.218703691253333e-02   +2.145741879845951e-01; +4.869789928471420e-01   +4.428102353291608e-01   +1.863076233347428e-01   +3.988179926930572e-01   +3.250794373578298e-01   +6.759532632165105e-02   +2.728074882585253e-02   +4.547143024469967e-01   +3.996907051721174e-01   +5.712873550401094e-02   +4.406575833799947e-01   +1.130753360334285e-01   +8.732378189456728e-02   +1.686758672108949e-01   +4.014829648925559e-01   +4.980668009962453e-01; +2.005085751784509e-01   +4.894629223157292e-01   +2.719042976372779e-01   +3.484722120634537e-01   +4.839561608821650e-01   +1.634594456502089e-01   +2.221966275227063e-01   +2.081254697720141e-01   +3.678509629045177e-01   +9.384170417468946e-02   +1.224931995432911e-01   +5.042993404785002e-01   +2.505989439801299e-03   +4.327217676966334e-01   +3.746438900492521e-03   +1.934169881772322e-01; +4.204932326390036e-01   +2.167090012378103e-02   +4.811959196337874e-01   +1.077313178929988e-01   +4.908623626677994e-02   +7.522196334020401e-02   +4.912560466043356e-01   +3.271292724857292e-01   +4.746229099986209e-01   +4.937489171244191e-01   +1.964288278171542e-01   +4.424995880637274e-01   +3.079608092566367e-01   +1.921369247351070e-01   +3.664208381236552e-01   +1.717186299814944e-01; +8.300838337405922e-02   +3.173891904216895e-02   +2.661246767465582e-01   +4.506368868412760e-01   +3.616631731516222e-01   +4.901578836988331e-01   +3.420428983222167e-01   +4.148115083094360e-01   +1.797066693206456e-01   +4.955257735535487e-01   +2.054962509910338e-02   +1.989030736522448e-01   +9.380173340031171e-02   +2.232036707011398e-01   +4.396230511821557e-01   +3.079254155831800e-01; +1.110952110808726e-01   +9.291526340053284e-02   +5.053830948357889e-01   +4.712530242008116e-01   +1.315171300653742e-01   +3.488102600783679e-01   +3.517476947919136e-01   +4.541328712227647e-01   +1.736763658337226e-01   +1.295049091627380e-01   +4.798110123197077e-01   +2.024249471597315e-01   +4.236904820203097e-01   +4.062653212512269e-01   +1.766979270713683e-01   +5.108888462744653e-01; +4.303236017110431e-01   +7.593023706698243e-02   +4.744319704854629e-01   +1.382329178563747e-01   +1.767204249360713e-01   +4.519341108288980e-01   +4.337839332305257e-01   +1.358864774454634e-01   +3.366177787597553e-01   +5.096984499923853e-01   +2.122438933487800e-01   +3.084049994542333e-01   +3.780836733683834e-01   +2.623006771184427e-01   +1.806649866707654e-01   +6.833551010179600e-02; +1.679399030038544e-01   +3.392075519139883e-02   +1.931650405047483e-01   -8.954314129771242e-04   +4.968642881154350e-02   +3.220483262404621e-01   +2.167603330974632e-01   +1.104022791180099e-01   +3.078863414090852e-01   +3.489018205130007e-01   +5.622954978198861e-02   +4.411553075472234e-01   +1.367572446267501e-01   +1.601199552603354e-01   +1.653531817786535e-01   +2.856184282919617e-01; +4.083692138384055e-01   +3.151162463915424e-01   +4.789869149458189e-01   +2.283978971183288e-01   +5.018057389480599e-01   +2.941102449603133e-01   +2.188057892282747e-02   +2.680711904024151e-01   +2.188095470370948e-01   +5.098126868620174e-01   +1.384808439216448e-01   +1.243103198695025e-01   +1.037939683827264e-01   +1.767252063114468e-01   +1.255784712773532e-01   +3.711091248898982e-01; +4.038675386479130e-01   +1.444341072087928e-01   +2.720164576878351e-01   +1.695581879040060e-01   +2.773734244852418e-01   +9.123052302874129e-02   +4.410103921849308e-01   +2.601381345645312e-01   +1.368802535934704e-01   +5.649390170566041e-02   +3.070314248994816e-02   +4.358551270099095e-01   +9.985251885013098e-02   +4.637054801598788e-01   +3.077680606021947e-01   +5.036597767207930e-01; +7.670537400917261e-02   +1.270523284938377e-02   +3.369671210417164e-01   +1.257308930465363e-01   +1.575053844135196e-02   +3.083727035800339e-01   +1.438820527442364e-02   +1.049647405527575e-01   +2.259273526664995e-01   +3.114240659338248e-01   +2.220735194365070e-01   +6.973351888650493e-02   +2.538043091045684e-01   +3.773316955027978e-01   +3.310548529002693e-01   +2.991543996243526e-01];
L2I_L1I_iGABA_netcon = [+2.425851192992179e-01   +3.317173680419595e-01   +3.183922402568342e-01   +1.579037938475167e-01   +1.076497867202261e-01   +4.757696272976773e-01   +2.782335845968317e-02   +4.757819556137022e-01; +4.449337228189882e-01   +2.482327492555363e-01   +2.183965870307850e-01   +4.188521309765434e-01   +1.555539209046774e-01   +1.114576603237898e-01   +1.758823056949839e-01   +3.654254288999297e-01; +4.826736355573001e-01   +3.226721700708846e-02   +5.436871405860788e-02   +5.021042189954485e-02   +3.042685488894894e-02   +4.871947305482943e-01   +3.156777627924471e-01   +1.698252325983936e-01; +2.341406074597961e-01   +4.351652971291804e-01   +2.150060645643326e-01   +4.131698710866944e-01   +2.772786591148604e-01   +3.764647395034288e-01   +2.716727705320287e-01   +1.480698611179538e-01; +4.666588494480903e-02   +4.657772296072188e-01   +2.331664248943165e-01   +1.417280216996850e-01   +1.103221251729101e-01   +8.014322834174485e-02   +3.024851376305627e-01   +2.333336730854711e-01; +1.042743294205917e-01   +8.562890984963680e-03   +4.113153244545187e-01   +3.020136355192823e-01   +3.835958555514258e-01   +3.208024558862059e-02   +4.669738692822857e-01   +4.170067400788109e-01; +1.429472914957974e-01   +2.356276338160169e-01   +3.821374272314177e-01   +4.254906970613151e-01   +2.289436346082306e-01   +2.893745804154425e-02   +4.301943602966333e-01   +1.176085965462760e-02; +3.172085546970988e-01   +4.531696586471641e-01   +1.530628000651677e-01   +6.538870965798319e-02   +5.337291695626742e-02   +1.164955185993481e-02   +4.244253871857307e-01   +4.069592603991475e-02; +2.647455432734004e-01   +4.491434900338317e-01   +3.219643225743626e-01   +4.428132254444703e-01   +9.929689683007650e-02   +2.812837701790153e-01   +2.716865544370119e-02   +4.344611515904246e-01; +4.206683288565051e-01   +6.840846736782616e-02   +2.937837822208001e-01   +1.088524549383502e-01   +3.938968641744031e-01   +3.564260723094810e-01   +6.951801449396604e-02   +3.077696017513333e-01; +1.666294258823929e-01   +3.183981494727974e-01   +3.207861698731234e-01   +2.457275404391286e-01   +1.283500000299605e-01   +2.251496326838815e-01   +2.482309812199577e-01   +1.615089518339756e-01; +2.503580795364604e-01   +2.418989597713778e-01   +4.422704908254489e-01   +5.347098815479748e-02   +3.317720478449586e-01   +3.069838181600388e-01   +3.115976809426199e-01   +1.504772774166769e-01; +2.421311592221354e-01   +4.591856550934454e-01   +1.232147140969855e-01   +1.447852188475551e-01   +3.194739735796370e-01   +1.735278037521108e-01   +4.132237629782116e-01   +1.308243165385992e-01; +3.980893430121495e-01   +2.825654000399992e-01   +2.808568156484039e-01   +3.131842118299560e-01   +6.959328767038231e-03   +2.606273196476083e-01   +3.586404184457019e-01   +4.747418431346856e-01; +1.430974683090800e-01   +4.902703675904569e-02   +4.019505790168106e-01   +6.575586117287295e-02   +1.820519985689598e-01   +1.207699499218582e-01   +1.928029390232247e-01   +7.571106837424148e-02; +5.068429369853099e-01   +2.046083748568416e-01   +6.119263132595643e-02   +3.550797292568511e-01   +2.877898195550739e-01   +2.270544043329434e-02   +4.995498335077048e-01   +4.887639276870122e-01];
L1I_L2I_iGABA_netcon = [+3.790378525634683e-01   +7.133773477142628e-03   +3.112155034570563e-01   +4.842224230676456e-02   +3.905489946832685e-01   +4.129585918170844e-01   +2.273640065679447e-01   +1.049307111483752e-01   +6.361080838870810e-02   +2.469504843438688e-01   +3.398267508256972e-01   +4.225085645873314e-01   +3.150955827563904e-01   +2.631625933524119e-01   +4.345261676963709e-01   +1.947974219137114e-01; +1.995221205719441e-01   +1.886912709747225e-01   +2.992644442552830e-01   +4.941479538157062e-01   +2.307537343290061e-01   +5.004630472060861e-01   +9.155143928253706e-02   +6.666458846147529e-02   +4.950891593689151e-01   +5.103808714516734e-01   +4.514294938328307e-01   +3.380176834558413e-01   +3.625887674563281e-01   +2.935989248725063e-01   +4.659502552790471e-01   +4.749889865908185e-01; +3.858553606907300e-01   +2.248497871090725e-01   +4.178048348252280e-01   +3.060368160440112e-01   +4.641763678784755e-01   +3.985315921962821e-01   +4.863459282238827e-01   +2.992894332706578e-01   +4.335278861920194e-01   +1.327613417820002e-02   +4.801536410504569e-01   +2.232094575938775e-02   +1.220607617980817e-01   +2.577791322384336e-01   +2.191295622209920e-01   +4.797778740968483e-01; +1.784065853335581e-01   +2.352786273883651e-01   +1.928387205458824e-02   +5.502504996619375e-02   +5.024620946285505e-01   +2.982310767011218e-01   +3.093097376428757e-01   +2.974941933745650e-01   +1.545686104984325e-01   +1.637897945709428e-02   +7.469593684438197e-02   +7.824252581706453e-02   +1.192645166698196e-01   +4.620070583780319e-01   +7.566438280151788e-02   +2.369227413888178e-01; +4.374137568926684e-01   +7.678091376787591e-02   +5.760295823152312e-02   +1.042812360422563e-01   +3.674326528251651e-01   +6.098589124660245e-02   +4.210182546254525e-01   +1.390650525336004e-01   +1.576927636561936e-01   +2.004927556195811e-01   +2.543997938375416e-01   +2.862793980126400e-01   +2.204042529166444e-01   +4.131980913046957e-01   +3.061394443774799e-01   +4.609725502374565e-01; +2.887989801549705e-01   +2.131667596515996e-01   +3.523022718181816e-01   +4.154006147243983e-02   +3.506176475138020e-01   +1.894444083881029e-01   +3.775374335192518e-01   +7.360805041950652e-02   +2.451608826965558e-01   +3.817430432398934e-01   +7.454918444989650e-02   +2.494411603201207e-01   +6.560898913767671e-02   +4.472401997251818e-01   +1.668365336625941e-01   +1.684914778619291e-01; +3.763698542025255e-01   +1.142871964263871e-02   +2.700399475824153e-01   +1.847513564687637e-01   +1.648034171144230e-01   +6.147448541053778e-03   +2.997395886595223e-01   +3.740568055548286e-02   +1.991312301008113e-01   +3.545386727071774e-01   +2.931008396604313e-01   +3.268854424630169e-01   +1.155428761598719e-01   +1.489375447800595e-01   +2.490321133753848e-01   +4.643900809456267e-01; +3.846080026929850e-01   +3.626609761760937e-01   +1.023818727181554e-01   +2.602812714299987e-01   +5.293929948745400e-02   +4.642299346617628e-02   +1.365155518108621e-02   +4.278139790487922e-01   +3.831778530452637e-01   +4.720210465835951e-01   +2.792683509426492e-02   +3.864210130130215e-01   +1.085037533302253e-01   +3.771649634744106e-01   +3.031258173372807e-01   +1.298639563806284e-01];
L2E_L1E_iAMPA_netcon = [+4.000522778228496e-02   +1.054616605763614e-01   +4.220941288251053e-01   +1.098126995763967e-02   +1.217436062066608e-01   +9.748003369686899e-02   +3.608986512294672e-01   +4.885004863731896e-01; +5.038211779379289e-01   +1.718056712287331e-01   +2.659833984598434e-01   +2.459353471371219e-01   +3.565489719765499e-01   +4.560788252101567e-01   +2.369339715944271e-01   +1.840024294003033e-01; +6.666934960151021e-02   +2.146400063263288e-01   +1.058757831048994e-02   +4.460169465559437e-01   +2.950736588358616e-01   +8.223936354723439e-02   +3.440411125267584e-01   +4.239832453713243e-01; +4.373145017204639e-01   +2.501884333042437e-01   +4.723194303373533e-02   +2.899306293786758e-01   +2.980832044059000e-01   +3.028499397825445e-01   +2.234033471566484e-01   +1.995562178395333e-01; +2.348018380586678e-01   +2.988548325025626e-01   +2.756756651384138e-01   +2.034931956449969e-02   +3.155697552251451e-01   +3.608924682916873e-01   +4.864086849845335e-01   +4.403440656637486e-01; +3.670790688190160e-01   +3.969315654708903e-01   +2.723923263847088e-01   +3.096784619690063e-01   +1.640147411622844e-02   +4.082073812446972e-01   +2.582443266201956e-01   +4.341295790207743e-02; +4.612101629932229e-01   +8.481189070669597e-02   +3.066912529545874e-01   +1.259889118235198e-01   +1.804388228223320e-01   +1.969910643265143e-01   +2.918850403030487e-02   +9.923264463733858e-02; +2.256446530890214e-01   +6.731715743017402e-02   +1.371981125744140e-01   +4.139629112197310e-01   +2.177248589034681e-01   +1.674996891875355e-01   +3.154823566229075e-01   +6.335623856516033e-03; +2.540806174925309e-02   +1.466608284438800e-02   +2.489966199464852e-01   +1.537617476925801e-01   +3.450735724286638e-01   +2.479276176346291e-01   +1.888014905298728e-01   +1.102057090443926e-01; +1.220095810654573e-02   +1.670058448217057e-01   +9.468630821324409e-02   +2.438269231520623e-01   +3.627004143962215e-01   +2.154673388333358e-01   +2.119270113229992e-01   +4.445227081563868e-01; +2.963170279007117e-01   +2.333150084132068e-01   +3.791660042672123e-01   +3.301122238029399e-01   +2.421982246883977e-01   +1.555441520252504e-01   +1.398104041614024e-01   +8.235090320959035e-02; +2.889829432194615e-01   +3.084262410856651e-02   +6.936921214803127e-02   +1.330732678064885e-01   +2.224572470573127e-01   +1.549117630897655e-01   +1.929633534039306e-01   +1.826370106331219e-01; +2.103931438936766e-01   +3.125594350050842e-01   +4.941723138465133e-01   +4.890020079678954e-01   +3.527476520950601e-01   +8.847306010939891e-02   +3.706204756585648e-01   +2.714534223886160e-01; +1.193158073513735e-01   +2.623193339958820e-01   +1.777549082437430e-01   +1.944381882362493e-01   +1.800733160448173e-01   +1.720543639012987e-01   +4.456785017532493e-01   +1.886228973418411e-01; +2.925374861473462e-01   +4.379591236645182e-01   +1.175972167286447e-01   +4.914898488217177e-01   +2.524129056887167e-01   +3.241181881489757e-01   +9.084487940386703e-02   +4.173566027901062e-01; +6.710669521434708e-02   +5.028544799305008e-01   +2.914680444146873e-02   +4.583277419908802e-01   +3.801609932137897e-01   +2.091539375197381e-01   +1.406307911345647e-01   +2.810003627855129e-01];
L1E_L2E_iAMPA_netcon = [+9.872384815172294e-02   +3.330065493862629e-02   +1.317368048787782e-01   +3.611885670679301e-01   +8.774175384934679e-02   +4.959489515022750e-01   +4.274629165105590e-01   +1.252316600978605e-01   +4.310060365055028e-01   +3.332582711951919e-01   +5.949404861782334e-03   +4.093895272706823e-01   +5.525821391188820e-02   +4.671543552490268e-01   +1.516223907441387e-01   +4.879213165820055e-01; +2.114407674738445e-01   +1.130460113070915e-01   +7.328448415572728e-02   +3.911854989331150e-02   +8.573988394593296e-02   +3.683006008885386e-01   +2.883865847703994e-01   +2.059337705999718e-01   +3.917692419261858e-01   +1.754073776708838e-01   +1.036768978740166e-02   +3.427898160897985e-01   +3.037106369367128e-02   +2.057352455214560e-01   +2.161337408648694e-01   +2.125423762627935e-01; +3.211560077803124e-01   +3.101040229852375e-01   +2.340786889709508e-01   +2.113736556605317e-01   +2.779961450348079e-01   +2.018457286921694e-01   +3.727274469888349e-01   +5.045099369632886e-01   +1.285476066961647e-02   +3.476391281430972e-02   +2.212214802225921e-01   +4.151910655571225e-01   +9.484680779282807e-02   +1.377365660002676e-02   +3.280364148766884e-01   +2.127107607581177e-01; +1.343108171133433e-01   +2.421152111073326e-01   +4.497556878104196e-01   +2.797266747112868e-01   +2.433988371175130e-01   +3.335740501983129e-01   +4.828137526501963e-01   +1.117111918355186e-01   +1.875769074995009e-01   +9.130239665380699e-03   +4.084542982707591e-01   +2.078478953434268e-01   +1.516006936531005e-02   +2.706222778573619e-01   +5.050518759049593e-01   +5.099636659982583e-01; +2.878192981532874e-01   +4.640438141009243e-01   +2.556639475106101e-01   +1.172829351727118e-01   +2.202367200279767e-01   +4.270478443377158e-01   +2.273292324225242e-01   +2.809585701879197e-02   +4.233956772945633e-01   +2.158147263136477e-01   +1.194089607537250e-01   +4.651252807128272e-02   +4.774176532399846e-01   +3.547006892215778e-01   +3.953656020797910e-01   +2.430862662872976e-01; +2.616129923249479e-01   +3.710527850857597e-01   +1.720385281564500e-01   +3.426398172051732e-01   +3.567688489973150e-01   +8.440064556526632e-02   +1.259107088250352e-01   +1.432286314481679e-01   +1.759429611665715e-01   +4.618973512114797e-01   +2.390573857779034e-02   +3.773090462990450e-01   +4.105515270174870e-01   +1.950865074623179e-01   +3.843987530764078e-01   +2.101053416085776e-01; +2.471027812433243e-01   +2.411638414159462e-01   +3.237924960259981e-01   +1.963598425538669e-01   +2.723476421015253e-01   +2.110065816559385e-03   +3.180494104434545e-01   +4.215672201941102e-02   +1.435076687913114e-02   +2.298980545020543e-01   +4.176596650286329e-01   +1.960622724502691e-01   +2.957102916249261e-01   +6.894239661910122e-02   +1.064900762772272e-01   +4.357502811109124e-01; +3.202928873765417e-01   +1.075375271029681e-01   +3.654103918292161e-01   +3.031055729816315e-01   +2.070178123729508e-01   +1.858597439290200e-01   +4.058480178499846e-01   +4.036782807569551e-01   +1.250412626942648e-01   +4.675607068694973e-02   +3.931973648263365e-01   +1.305448580802325e-01   +3.955713204641517e-01   +3.916971202549754e-01   +4.485441672892994e-01   +1.172326597098704e-01];
L2I_L2E_iAMPA_netcon = [+3.177616958718770e-01   +6.928748839037534e-02   +4.092761508485791e-01   +3.173304920812940e-01   +3.661308869628331e-01   +4.705386619947465e-01   +2.305088124777840e-02   +7.198331653584164e-02; +3.825984576283556e-01   +1.620465384742852e-01   +5.044155109120914e-01   +4.628572805590225e-01   +2.251682761800450e-01   +1.709979289495361e-01   +1.485360681668002e-01   +3.108600200144288e-01; +4.980101214179974e-01   +4.766228737336303e-01   +1.877024245431590e-01   +6.841370464562792e-02   +3.429509911132753e-01   +3.922189841381146e-01   +4.251423975920904e-01   +4.435019645930410e-01; +9.172283085398496e-02   +9.012804812350901e-02   +2.336681951361058e-01   +2.291633634985508e-01   +2.476814207192590e-01   +2.669152143749264e-01   +4.796279641732952e-01   +2.284433268422283e-01; +5.489471221427264e-02   +3.275183644287057e-01   +2.327558439901867e-01   +2.036972703955161e-01   +4.386956725011641e-01   +4.902518823430450e-01   +3.667439755685543e-01   +3.654955666003198e-02; +2.912747759563123e-01   +3.621125119946822e-01   +1.171269190109075e-01   +4.527727511439632e-01   +2.026288437226955e-01   +2.712219946358264e-01   +3.372961364277334e-01   +4.453373647482920e-02; +4.920436148200674e-01   +9.974742462079106e-03   +3.892343374170116e-01   +6.114584581995167e-02   +2.054086031130024e-01   +3.158657557253058e-01   +7.429095675257323e-02   +4.573313009686920e-01; +6.916747310956620e-02   +3.352048819328258e-01   +1.049216998079701e-02   +1.315890780774108e-01   +3.580604779137242e-01   +4.347953527967476e-01   +2.460582549968721e-01   +2.495511671493794e-02];
L2E_L2I_iGABA_netcon = [+5.001632861138681e-01   +3.135294548012467e-01   +2.980305611951423e-01   +3.519655225930090e-01   +4.329333227639235e-02   +4.842445735301355e-01   +8.471512362302497e-02   +3.602431997958267e-01; +3.639881021431133e-01   +1.936829381505106e-01   +2.903071321791099e-01   +1.459314370313313e-01   +2.079233722578501e-01   +3.135351771431824e-01   +2.720030068927863e-01   +5.053717937016811e-01; +3.437134712191733e-01   +5.997341666141859e-02   +3.297298991680335e-01   +5.622532271068423e-02   +2.394099535302555e-01   +5.925903065961437e-02   +5.085969950588360e-01   +3.397253606275263e-02; +4.608383075262648e-01   +1.000751717174790e-01   +2.919179805142773e-01   +4.864596675596322e-01   +2.754747793484389e-03   +4.873990819509662e-01   +3.613995001346714e-02   +1.886982821079486e-01; +4.810516947370404e-01   +3.731831727958629e-01   +2.836573698696064e-01   +2.209787678782164e-01   +3.198549565625858e-01   +4.700536524926862e-01   +2.136595770660645e-01   +1.822805363268276e-01; +2.065634187792323e-01   +3.046813598055976e-01   +2.964938036281223e-01   +3.993565642755306e-01   +2.442033514326163e-02   +4.708757044732368e-01   +9.297500125294039e-02   +4.256742813524646e-01; +4.678918039117705e-01   +3.580937143026914e-01   +2.975296598346552e-01   +2.410388839622926e-01   +3.711897691144516e-01   +3.670126004564608e-01   +1.814410672215102e-01   +1.287103506979560e-01; +4.198369692890405e-01   +1.306012706976157e-02   +4.610417992993708e-01   +1.536596444774159e-01   +4.251157954098280e-01   +3.112959224094736e-01   +4.563720909506578e-01   +1.453895607214539e-01];
L3E_L2E_iAMPA_netcon = [+1.653397313997869e-01   +2.804339676167457e-01   +3.007051955575453e-01   +4.397075366575247e-01   +6.673930310212489e-02   +4.067383804815509e-01   +3.352866612479536e-01   +4.068542292898722e-02   +4.534491882519304e-01   +3.643409610465803e-01   +2.289949872557422e-01   +2.863926961279635e-01; +2.384270046286533e-01   +2.212487851937520e-01   +1.491591766862101e-01   +2.423879521957759e-01   +1.024905644572789e-01   +2.647888519735595e-01   +3.808331872022360e-01   +6.772711153296176e-02   +4.653172422742243e-01   +3.027749851509147e-01   +4.468368612957523e-01   +4.184573460257956e-01; +3.636042138653873e-01   +4.764158796908035e-01   +3.882671032905931e-01   +4.364846056042540e-01   +9.895961182688795e-02   +1.145437593092279e-01   +2.062783891381608e-01   +4.986783491957811e-01   +3.321688315657691e-01   +1.714846000021375e-01   +1.740264014832498e-01   +3.345740210562604e-01; +1.457794263597982e-02   +4.213675943293325e-02   +3.129230402101869e-01   +1.446839857610159e-01   +1.565634511494185e-01   +4.553398812657820e-01   +2.856098161343273e-01   +2.996079543620048e-01   +1.577178719162997e-01   +4.407895464810411e-01   +5.088445327881304e-01   +1.035247802858250e-01; +5.008960491515478e-01   +1.070585652971976e-01   +1.555357530056752e-01   +3.118363675222037e-01   +2.365788366234366e-01   +6.560900193185583e-02   +1.474114411762573e-01   +4.158831351226619e-01   +2.657280465839364e-01   +4.767084342112740e-01   +4.145314118454801e-01   +9.379797457859788e-02; +3.203643307148770e-01   +2.362934672226040e-01   +9.379552961196380e-02   +4.790472944455484e-01   +4.206143598682606e-01   +8.990920126583155e-02   +4.895742951876784e-01   +1.126723604930737e-01   +3.362449880634401e-01   +2.412231439029180e-01   +2.805339173898881e-01   +4.345464196913053e-01; +3.178633280847767e-01   +3.803882996020030e-01   +3.041451273305970e-01   +3.230952367579945e-01   +4.445139000584261e-01   +1.985358339768796e-02   +1.806198105619258e-02   +7.697745269626030e-02   +4.035988845568266e-01   +5.640206705834518e-02   +4.556100994503691e-01   +2.980998244165399e-01; +2.471961626714370e-02   +1.392378990607537e-01   +2.662073850908303e-01   +2.203838021396128e-02   +4.626032158853491e-01   +1.904450566182231e-01   +3.816067842665166e-01   +5.012664466474921e-01   +6.761811871342427e-02   +2.767736431921960e-01   +2.691606382401884e-01   +4.519415024003263e-01];
L3I_L2I_iGABA_netcon = [+3.844925099051572e-01   +3.064752785606766e-02   +2.813852357463720e-03   +2.689983216372464e-01   +2.079137516505443e-01   +9.885531571422602e-02   +3.662770075626816e-01   +3.973815052653684e-01   +4.413338865666093e-01   +3.826054436846907e-01   +3.177190737154262e-01   +1.181438226744287e-01; +2.366871540608013e-01   +4.971064646118526e-02   +3.172967281577201e-01   +1.997523590683175e-01   +2.074236488561624e-01   +1.459290613822658e-01   +2.519378191061647e-01   +3.139482047611934e-01   +2.699347901116466e-01   +4.596985299613960e-01   +1.241778825716627e-01   +4.059809860646486e-01; +4.965726260243551e-01   +1.060700771167749e-01   +2.884793084549708e-01   +4.042536545657890e-02   +2.944547811912051e-01   +2.727274175216222e-01   +2.620958307800575e-01   +6.346134764905209e-02   +2.489607962623886e-01   +7.527326401111230e-02   +3.246097601062795e-01   +1.292241163408119e-01; +1.091474910002939e-01   +1.924232790468237e-01   +2.331594737308769e-01   +5.550079628600241e-02   +1.473960893851714e-01   +3.931930182479356e-01   +2.143465294577440e-01   +3.799142754666195e-01   +3.766502467731903e-01   +2.869653942687992e-01   +1.832797964697633e-01   +2.971166581371490e-01; +5.017727835955380e-01   +5.032336654825829e-01   +3.970183244334912e-01   +8.601581635307602e-02   +2.611190341444092e-01   +3.762789357456565e-01   +2.759171486894040e-01   +3.992950389522148e-01   +5.016785352527263e-01   +1.462801321442835e-01   +1.267046847783946e-01   +7.470476307929538e-02; +4.579179989023357e-01   +5.026470574320392e-01   +9.791332259422122e-02   +3.107397502405000e-01   +1.105471304868244e-01   +1.970671190148682e-01   +3.950650039401669e-01   +3.508113655657795e-01   +1.743620585017933e-02   +1.339576488363438e-01   +7.657918756215182e-02   +2.149612629532418e-01; +4.185928364009350e-01   +1.709142892971045e-02   +4.079818680208364e-02   +5.964937412217142e-02   +6.690123880660516e-02   +7.912182755698874e-02   +3.946649398389054e-01   +4.129259865986861e-01   +3.846717491987432e-02   +3.823428683145617e-01   +1.631716653582809e-01   +3.736800722339844e-01; +1.737423601753435e-01   +4.168964896557448e-01   +3.300003011025274e-01   +3.523585828248230e-01   +2.938885727757857e-01   +1.469697573969121e-01   +4.991487900031564e-02   +4.537578860035485e-01   +4.863220594112592e-01   +3.394064685201087e-01   +1.034304064169899e-01   +1.228038317734687e-02];
L2E_L3E_iAMPA_netcon = [+7.307619641923759e-02   +2.138004660739113e-01   +2.191530172281022e-01   +3.842785914808255e-01   +3.018807974913710e-01   +1.159443824523906e-01   +1.921941480435801e-01   +3.090785071996508e-01; +4.846192556575173e-01   +4.699666870189736e-01   +4.316602351337025e-01   +1.050777768612354e-01   +3.233504759632670e-01   +1.302520334971014e-01   +3.074149048901761e-02   +7.981093774843577e-02; +3.558757197501959e-01   +3.142712311108157e-01   +2.119310929841028e-01   +3.109158091877251e-02   +3.030495053471120e-01   +3.542440540350176e-01   -2.788591957853552e-03   +7.842679648925904e-02; +3.333371256298912e-01   +4.613045679458500e-01   +4.758513311506007e-01   +3.273801686925477e-01   +1.259725151141085e-01   +3.497781758887940e-01   +2.523337485330380e-01   +2.797524958532280e-02; +1.903184879966236e-01   +1.416582074013957e-01   +3.886951595150003e-01   +4.840223265597759e-01   +4.422621437796915e-01   +2.093627378245233e-01   +2.990458150748376e-01   +4.488062727680506e-01; +3.786191163692035e-01   +4.126057612927140e-01   +9.568398282103522e-03   +3.004463917280860e-01   +2.655882338124316e-02   +2.120233113153463e-01   +9.038565869143972e-02   +2.969490600104963e-01; +3.599434074557872e-01   +3.916389852481795e-02   +1.355112296306987e-01   +3.970832710071306e-01   -1.336140149709663e-03   +3.271360831906935e-01   +3.602734561476456e-01   +2.046643037072856e-01; +3.188301075577567e-01   +1.954816939618504e-01   +2.328264147360433e-01   +4.596386233307074e-01   +3.929382413928918e-02   +1.494627240238972e-01   +1.890036326680180e-01   +3.703406854408833e-01; +1.213339299593017e-02   +9.760474437952450e-02   +2.806445572404613e-01   +4.348776221968922e-01   +1.922242508774331e-01   +3.255493364940971e-01   +1.414006481120530e-01   +2.136402043940639e-01; +1.084836091356109e-01   +7.459263118869226e-02   +4.522198122252338e-01   +2.296071423318674e-01   +4.353598622423059e-01   +7.487642182921582e-02   +4.595524405529899e-01   +9.506561191287993e-02; +5.940298903507756e-02   +2.394886098316523e-01   +2.262005221248586e-01   +2.799620334609338e-01   +2.464521584599412e-02   +3.263222652559853e-01   +3.250112088864020e-02   +3.985818634952449e-01; +4.213692370547987e-01   +7.459410029018054e-02   +3.907836658477167e-02   +5.429957590622782e-02   +2.714822976196037e-01   +8.835837813717992e-02   +4.123883690880979e-01   +2.376527639740634e-01];
L2I_L3I_iGABA_netcon = [+1.261757310694226e-01   +1.574234945387245e-01   +1.612570180640874e-01   +1.105229379007287e-01   +4.574441077446819e-01   +3.447506106825564e-01   +4.079311411697972e-02   +1.735734839602310e-01; +3.512768218093197e-01   +2.836207029880671e-02   +1.103454704169672e-01   +2.692552806926493e-01   +4.845677429811379e-01   +3.218763359822580e-01   +2.572919756166004e-01   +4.363092923728115e-01; +3.998564982272697e-02   +3.346860467607814e-01   +4.907854984632105e-01   +2.435207790368273e-01   +4.954832745171266e-01   +1.046869899422590e-01   +9.533553416204787e-02   +2.829640796042311e-01; +3.763252451413486e-01   +3.048439729189706e-01   +2.198833069972269e-01   +1.449953083532916e-01   +4.970707061236381e-01   +4.153521750722520e-01   +2.009581931436009e-01   +3.580774568334056e-01; +3.061688018867808e-01   +3.755010712779062e-01   +3.156107790047929e-01   +7.690978585693690e-02   +3.052918424800903e-01   +3.547067698586719e-01   +4.232079160247751e-01   +3.709609929238975e-01; +1.547098361125829e-01   +1.193513326741287e-01   +1.940950191551827e-02   +3.724912817106832e-01   +1.137136031041990e-01   +4.987461750222236e-01   +3.699566592577633e-01   +5.082774664775019e-01; +3.398663613196592e-02   +1.100153301067250e-01   +1.087595747095873e-01   +3.824172207912221e-01   +5.139730005478658e-02   +1.631434771312984e-01   +1.948129376074048e-01   +5.705193814572831e-02; +2.599768627978566e-01   +1.828841171328688e-01   +4.470329352058178e-01   +2.305465409342896e-01   +2.401836037364017e-01   +9.653660003223391e-02   +4.492843622365605e-01   +4.571622213678873e-01; +4.434617267108657e-01   +4.431933099163365e-01   +4.395450294969156e-01   +3.421613424670464e-01   +3.230545919071268e-02   +4.399219182588280e-01   +2.024139148360527e-01   +2.564175289354699e-01; +4.266775900548317e-01   +2.470827052699264e-01   +8.197598105184905e-03   +1.884011880366186e-01   +4.209604149890737e-01   +4.559825602542674e-01   +2.567737951236239e-01   +4.762002497122808e-01; +3.197376818916234e-01   +5.049872185787239e-01   +4.139565865272962e-01   +3.810233337884634e-01   +8.795942596284229e-02   +4.518728224277710e-01   +2.291743955318785e-01   +4.771228173926846e-01; +2.953704023347132e-01   +4.079808036502627e-01   +1.740108943950762e-01   +3.965683441183629e-01   +4.628147527131887e-01   +8.807125839953774e-02   +1.727376223362139e-01   +7.092350678355111e-02];
L3I_L3E_iAMPA_netcon = [+4.180153656775317e-01   +5.165132686936040e-01   +3.208013360015059e-01   +2.733480989635460e-01   +1.221946753626701e-01   +3.847272288394238e-01   +2.198087133219146e-01   +1.657585431751942e-02   +1.112208875276952e-01   +1.318350553833135e-01   +4.820593614262770e-01   +3.601490086526997e-01; +1.495556082767976e-01   +3.470745188163062e-02   +4.803551030040067e-01   +2.761526996828736e-01   +3.507098541644893e-01   +2.672963243024188e-01   +4.742487538888938e-02   +4.695713325007226e-01   +6.446956953445600e-02   +1.111508331483510e-01   +2.542068218597236e-01   +1.595977539444474e-01; +4.765565750041741e-01   +1.975120004961330e-01   +4.829262787646231e-01   +1.665151140502901e-01   +7.982887272242187e-02   +3.429329031425983e-01   +2.982112455698488e-01   +2.218020212740583e-01   +1.355922159356672e-01   +3.303130578805272e-01   +2.752705830804448e-02   +3.844662383877475e-01; +3.245592153275633e-01   +3.756405945730161e-01   +2.523094439262472e-01   +4.533969788713312e-01   +4.786798890024931e-01   +9.267811769274828e-02   +3.586668257409473e-01   +3.765790078586175e-01   +4.835552514490069e-01   +2.927315214536337e-01   +2.535499304563779e-02   +3.231887740081127e-01; +3.575274417383860e-01   +1.098278264448403e-01   +3.759524196076529e-01   +5.007768831473334e-01   +4.315684463866633e-01   +9.703426162829080e-02   +3.980004294972365e-01   +1.659806853974949e-01   +2.554318361602442e-01   +3.996372960936312e-01   +2.088391108264931e-01   +3.083632309136514e-03; +4.193839071097423e-01   +2.900380562652450e-01   +5.050714446903285e-01   +7.728478992840146e-02   +9.421820664771852e-02   +1.712888921793656e-03   +3.789369626991546e-02   +1.801075825044255e-02   +4.376699413992074e-01   +5.104299310104025e-01   +3.707393765491999e-01   +3.588547043767107e-01; +3.681612125293097e-01   +2.424601438880633e-01   +3.924941518393951e-01   +4.736190531748591e-01   +2.036813460089705e-01   +3.219503136311447e-01   +2.618788940711085e-01   +2.696786055210502e-01   +3.411237595293276e-01   +2.823230765130718e-01   +4.818623070481288e-01   +1.988458292549418e-01; +3.625890572357454e-01   +3.523348965819805e-01   +1.434529511468826e-01   +4.381872713060094e-01   +1.792610281896181e-01   +4.525704113938576e-01   +2.769789643516019e-01   +3.883539415794929e-01   +4.397112864459445e-01   +5.113921553311779e-01   +9.750918795192368e-02   +1.295285388991087e-01; +6.264054302801461e-02   +3.405417396853146e-01   +2.567526652908521e-01   +4.747950590492135e-01   +2.050123965622289e-01   +1.765608954477004e-01   +3.204534251662722e-01   +3.723782920648207e-01   +2.746192487214263e-01   +7.806355194748735e-03   +4.271546630958069e-01   +4.356939112241346e-01; +3.846676050160763e-01   +1.439122206954961e-01   +1.116798430224967e-01   +1.862562486867668e-01   +3.434518284326134e-01   +9.446971131485876e-02   +8.049759990460259e-02   +1.371135630182369e-01   +1.231541339324994e-01   +8.320930826172826e-02   +7.040609506916186e-02   +3.189737848926701e-01; +2.241606396339576e-01   +3.173219158625158e-01   +5.113530912336847e-01   +2.729198383008999e-02   +3.025561678211472e-01   +1.484658196610174e-01   +4.513481755275064e-01   +8.604340414047691e-02   +4.948569113043601e-01   +1.775725109269236e-01   +1.639104056502818e-01   +4.671644679738688e-01; +4.696298884233466e-01   +2.433879594241266e-01   +3.120862790431485e-02   +2.482021101991967e-01   +2.885833506666792e-03   +2.743207944157927e-01   +5.029713134979898e-01   +3.266089100302889e-01   +2.501824625236949e-01   +3.886776945293518e-01   +4.660227433443016e-01   +3.203207113589088e-01];
L3E_L3I_iGABA_netcon = [+2.264438884700941e-01   +2.061758994266071e-01   +4.058243685173760e-01   +1.210399899164400e-01   +7.458756825127704e-03   +3.824461448591305e-01   +4.894881347270149e-01   +4.634256364307315e-01   +4.513448140867304e-01   +2.844898844876247e-01   +2.284891692535032e-01   +3.675765690223360e-01; +3.998169961779112e-02   +1.048441672089123e-01   +1.097536215173701e-01   +2.050521199260532e-01   +3.304282991978385e-01   +3.622329812407864e-01   +4.450163753889261e-01   +4.241766455203839e-01   +9.900230155723398e-02   +4.422809141870062e-01   +5.153165818912352e-02   +4.727196816300879e-01; +6.491365659561216e-03   +1.907702738102317e-01   +3.548100733769309e-01   +3.486576870171947e-01   +2.857121486820229e-01   +1.963922579480887e-01   +4.705328024771917e-02   +7.462635573814200e-02   +1.546257645992164e-02   +5.099143889504455e-02   +8.642149321264064e-02   +1.608246260147889e-01; +4.746045413463014e-01   +2.744844494592754e-01   +4.168742516346423e-01   +5.013418010859712e-01   +6.892650564707880e-03   +2.736995859848965e-01   +1.813595437072417e-01   +4.960801574506506e-01   +9.037101780962149e-02   +4.041664898908953e-02   +4.290880321315508e-01   +4.554259409547117e-01; +1.248160388948277e-01   +5.165487564817509e-02   +8.131079112462734e-02   +6.065665111542012e-02   +2.515904238360862e-01   +8.160294956933932e-02   +3.578597217099088e-01   +2.094158231269382e-01   +4.477522171659088e-01   +4.875113481999670e-01   +5.723602568600815e-02   +1.785428311907776e-01; +3.531436021169175e-02   +3.741363539616239e-01   +3.388805758330701e-01   +4.313764539810050e-01   +3.290852190111240e-01   +4.939691243540278e-01   +4.294940195342324e-01   +1.121436855598993e-01   +4.240623369466809e-01   +9.267504041038561e-02   +1.658976807106880e-02   +3.521477472297193e-01; +1.492178031028056e-01   +1.951579481924224e-01   +3.939474877286309e-01   +2.009799847744262e-01   +4.420163862420728e-01   +3.064342549774109e-01   +3.246773724936037e-01   +3.668001240803905e-01   +4.066312635642902e-01   +1.536464552765291e-01   +3.955600779366555e-01   +1.940749496484629e-01; +4.278298422263361e-01   +1.608137575755113e-01   +2.184431652305639e-01   +1.362705885699232e-01   +7.728600052906953e-03   +4.840046529873231e-01   +3.169317234319470e-01   +3.079004050027097e-01   +3.710591310723088e-01   +1.312352031531778e-01   +4.870430262546228e-01   +1.912462563213236e-01; +1.011379653465409e-01   +1.008024224854531e-01   +4.651294324833466e-01   +1.357598863835795e-02   +3.352900495776935e-01   +3.657577836407023e-01   +2.038255868825109e-01   +3.802685547668142e-01   +4.843526822480476e-01   +4.949830513509849e-02   +3.342324581283762e-01   +2.409184775378268e-01; +3.449974693074631e-01   +1.172918127014886e-01   +3.837508160616719e-01   +3.431903329880185e-01   +2.081438751938847e-01   +1.984292054623849e-01   +3.692014559077328e-01   +3.079551475847609e-02   +4.970011243799669e-02   +2.781083387406817e-01   +3.598294506865107e-01   +3.846519160541144e-01; +1.460546125910929e-01   +2.999716568103254e-01   +4.510922388905643e-01   +2.119827647848067e-01   +4.916679380066847e-01   +4.564604282646060e-01   +2.919832445784591e-01   +4.306359519427860e-01   +2.465991449235637e-01   +5.635561774070508e-02   +4.113984768714813e-01   +2.942177611390353e-01; +4.408654496811143e-01   +3.069646891636659e-01   +2.223047654481008e-01   +8.159648589147092e-02   +3.604707251436706e-01   +9.570234101662732e-02   +4.901354000247460e-01   +8.597376386965531e-02   +3.729093452839360e-01   +2.318444547191484e-01   +7.800335347199651e-02   +3.829788683652030e-01];
L2E_Input1_iAMPA_netcon = [+2.879566076487331e-01   +3.166464659621022e-01   +4.367456263039297e-01   +3.161248551705100e-01   +1.815262891303033e-01   +4.461241512584136e-01   +3.873145992199318e-01   +2.916810034140098e-01];
L2I_Input2_iAMPA_netcon = [+1.855228624251975e-01   +1.738349662138074e-01   +1.703856850016489e-01   +2.427046323048253e-01   +3.980066336485906e-01   +6.318446330837184e-02   +2.684027378417261e-01   +1.491977207674203e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 20*((exp(-10*((t)-( 50))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 20*((exp(-10*((t)-( 50))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
