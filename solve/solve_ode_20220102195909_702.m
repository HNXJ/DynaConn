function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+1.244565129467789e-01   -3.212338549066783e-01   +5.590200408172175e-01   +5.341998044727213e-01   +5.168581593512787e-02   +3.747259855878477e-01   -2.539427226951450e-01   +1.537431094195182e-01   +2.661945226334921e-01   +5.954756251863579e-01   +2.377752478721862e-01   +4.641685958569001e-01   -2.473345805939568e-02   -1.173755202288750e-01   -3.097593266444390e-01   +8.185105957419987e-03; +1.738297586017737e-01   +4.192804325064893e-02   -1.018477244832967e-01   +5.286525590050094e-01   -6.569285662192478e-02   +4.107763908016584e-01   -3.954287310810166e-01   +3.785096018697303e-01   +5.243218460766680e-01   +9.328640703636103e-02   +6.372345720742980e-01   +4.862367358353865e-01   +2.154223528049766e-01   +3.333488636975292e-02   -1.316872613245659e-01   +3.076172437168152e-02; +6.687762445846094e-01   +3.887584356155507e-01   +2.717670489889088e-02   +1.251230849458064e-01   +2.304471326588604e-01   +9.281617882998361e-02   +3.930587029436081e-01   +1.828220863684836e-01   +2.860929497285072e-01   +2.998202443116711e-01   +3.404844389185002e-01   +9.661469108319348e-02   +8.729376920860756e-02   -3.007425628898223e-01   +1.725643283568488e-01   -5.665573713968727e-03; +1.353763146471666e-01   -1.897509208129194e-01   +5.857678003305392e-02   +5.033022169161956e-01   -2.070092179274935e-01   -1.854232448641895e-02   +4.050181731884095e-01   +8.004132760864610e-01   +5.831695393691192e-01   +7.113377141315613e-02   +3.294606349615117e-01   +5.898970775980087e-01   +1.422693480574177e-01   +5.694687949831712e-01   -2.875836067273808e-02   +6.957698935975380e-01; +6.458061884292914e-01   +1.234906920600558e-01   +3.287278562943999e-01   +6.899675259742735e-01   +2.258339836386823e-01   +5.140602313963156e-01   -1.210417050063944e-02   +4.824323595864576e-01   -1.035872958332256e-01   +2.400473215273411e-01   +5.202930775701060e-01   -2.956614153640615e-01   +8.160358660706520e-02   +3.745804505649909e-01   +3.969508823439772e-01   +1.462562676514409e-01; +9.355875077651030e-02   +5.593281647391737e-01   -2.733825483349190e-02   +1.633355520696497e-01   +8.248147224829555e-01   +2.830562679372060e-01   +7.600928704973990e-01   +1.678107833471265e-01   +2.349945677755031e-01   +3.292561129927707e-01   +2.874417613911571e-01   -1.096410130189405e-01   +1.297162077734064e-01   +2.235826731975062e-01   -2.856423827793399e-02   -5.028261109422465e-02; +4.569923886611781e-01   +6.175253936522537e-01   +2.361524337041465e-01   +1.163592596639678e-01   -9.628830762820277e-02   +3.917312125461779e-01   +3.502065760408711e-01   +3.022162838536525e-01   +3.127937104273253e-01   +3.460836131372412e-01   -1.206807220233180e-01   +5.944090183339303e-01   +3.366708028516032e-01   +1.368601126074951e-01   +4.616076638967418e-01   +3.976016886072777e-01; +2.583213055556337e-01   +3.695782834957501e-01   -8.463607279509799e-03   +5.512861308876529e-01   +1.213917166279014e-01   +1.256561627049646e-01   +1.883081166131959e-01   +6.221644061004065e-01   +6.937505381108349e-01   +4.184578552643237e-01   +1.280602103800887e-01   +3.723753593634763e-01   -7.019034833081197e-03   +6.892822398166899e-02   -1.546091750362396e-02   +3.355806238397328e-01; -3.245999769777282e-02   +5.456284374162602e-01   -2.899402130450494e-01   +2.349978603671541e-01   +2.962752570716776e-01   +4.024490641829584e-01   +1.894419986637847e-01   -1.784001307942762e-01   +4.048904844329982e-01   +1.814622027390501e-01   +6.198237460793825e-01   -4.851089902111087e-02   +3.865622415709715e-01   +4.278374663128047e-01   +2.579221100354455e-01   +3.571860836928937e-02; +2.101202620428348e-01   +3.515817216050023e-01   +3.387264131826693e-01   +3.545853783400144e-01   +3.400857496871508e-01   +1.081917826667363e-01   +4.355585491072658e-01   +2.659046902924740e-03   +5.720691510703241e-02   -7.183504681733192e-02   +9.359375068250735e-02   +9.321406069659209e-02   +7.852543932933223e-01   -2.336110095379265e-01   +2.172114585711488e-01   +5.030809062621723e-01; -2.618788784073667e-02   +5.973272315031577e-01   +4.360349566931877e-02   +1.662186145463667e-01   +4.803697114565604e-01   +4.101933660878443e-01   +6.445397838857702e-01   +4.122843927399381e-02   -1.728105889724322e-02   +4.581837265489874e-01   -9.751725188814740e-02   +5.432215088972600e-01   -3.658258117481203e-01   +4.011907007965587e-01   +5.789291727315378e-01   +2.194703719420140e-01; +5.695897611748310e-01   +9.147647289333313e-02   +7.495686828065254e-02   -1.089582492774807e-01   +3.624506684815014e-01   +4.595274795300542e-01   +8.027255752302066e-02   +3.469943351049064e-01   +5.404406545538596e-01   -1.034226856588547e-01   +1.661262973702586e-01   +4.065402574129439e-01   +4.874890879086565e-01   +4.077281972528496e-01   -1.123028260895904e-01   +2.779366276606094e-01; -4.109765509265527e-02   +3.911939226170468e-01   +7.217315869794275e-01   +2.578144774176181e-01   +5.363427908475219e-01   +4.423211441992757e-01   +2.436182216054100e-01   +7.469844618397615e-01   +6.746145110963944e-01   +2.127423141099962e-01   +1.299593479400640e-01   +2.453741507209841e-01   -2.913055801079414e-01   +3.093148575477216e-01   +2.327222260886688e-01   -6.214562512410911e-02; -1.877457367190579e-02   +3.039246560052599e-01   +3.692379349154213e-01   -4.902742582838021e-01   +4.473852009508493e-02   +8.021065880352291e-01   +3.801837993520199e-02   +2.872043400411308e-01   -4.180080956573524e-02   +1.418548834979443e-02   +6.365015635646889e-01   +2.920904625103675e-01   +3.660179450367940e-01   +5.650951516604777e-01   +1.878103498883208e-01   +2.513692067761749e-01; +1.770122196650860e-01   +4.359627579259232e-02   +3.608365681508195e-01   +6.680763513436058e-01   -2.877038234429054e-01   -8.887079853101032e-02   +6.802807348986315e-01   -1.402308665626283e-01   -2.668288163908641e-01   +2.661272664179680e-01   +9.269623309228668e-02   +2.121825433732004e-01   +1.428278617796782e-01   +1.405570451708967e-01   +2.319427399902388e-01   -2.736729599462439e-01; -2.859006180508409e-01   +4.281752907354983e-01   -4.152330956263740e-02   +4.443158086392461e-01   +9.813793626765858e-01   +6.542107039585262e-01   -7.507535608767127e-02   +7.506412711851767e-01   -1.327816793605965e-01   +5.283663283081433e-01   +6.141982471067797e-01   +3.972500855344401e-01   +1.288265868195614e-01   +4.340031884618454e-01   +6.373475811047643e-01   +2.548427962563157e-01];
L1E_L1I_iGABA_netcon = [+2.529662990326342e-01   +4.222031404157409e-01   +2.541371248619280e-01   -7.899761400793859e-02   +3.543696669193420e-01   -3.075685924241940e-01   +5.926085329263635e-02   +5.638700447052251e-02   -1.982582287103046e-02   -1.648771799539310e-04   +3.574882979269837e-01   +4.298814530503202e-01   +7.148402595929957e-01   -2.935060032164608e-01   -8.153254451131046e-02   +8.815389755107821e-01; -1.853910535189290e-01   +2.387875953643168e-02   +4.029614458001438e-01   -2.257593796222796e-01   +1.421683041000084e-01   -2.496338595428912e-01   +6.264668987681948e-01   +2.335729989748627e-01   +4.016316394547380e-01   +2.303064199552907e-01   +5.599539117209249e-01   +2.802805544555856e-01   +6.002050102987783e-01   -2.803196721843252e-02   -2.559947371645918e-02   -2.273322854794955e-02; +3.009656381415574e-01   +5.296821372371925e-02   +1.806495532332249e-01   +5.363114236916826e-01   +4.562211683066220e-01   -1.095209724125018e-01   +3.369777627354701e-01   +2.253096979454199e-01   +3.482963319285303e-02   +9.826814818000039e-01   -4.702515773134949e-02   +2.178081827779359e-01   +1.028544098592122e-03   -2.002926390493046e-02   +4.552776047089384e-01   +5.334136230170122e-01; +5.581588298587232e-01   +1.798603610560313e-02   -4.261246695059789e-02   +1.066880833221015e-01   -4.923207731933657e-03   +2.084785588274799e-01   -6.429170635826986e-02   -2.269966341345940e-01   +2.584452663017936e-01   +1.117954084633641e-01   +1.526914908855297e-01   +4.140314457742660e-01   +2.884074960682984e-01   +2.079146695814173e-01   +1.073373971648728e-01   -5.506585355767420e-02; +2.628901008016952e-01   -7.402986407791322e-02   -6.825691308143614e-02   +2.372399336520615e-01   +6.016695397101803e-01   -2.054778405128611e-01   +2.970708600580073e-01   -1.384440185668676e-01   +2.318053582207297e-01   +2.076057712413829e-01   -2.543931771719620e-01   +5.904459577149520e-01   +8.602587823441797e-02   +2.149431009003893e-02   -8.323531775609662e-02   +4.212217225659692e-01; -3.588334718634992e-02   +2.662194566790787e-01   +2.581102656215197e-01   +4.520720160599986e-02   +4.851825774697016e-04   +3.606417143007508e-01   +2.042871045607929e-01   -5.267730199438946e-02   -9.604263856199037e-02   +3.143151786801832e-01   +1.751137686112077e-03   +3.563262079283298e-01   -1.262849585214150e-02   -2.027171117393776e-01   +3.666390114109899e-01   +3.646778232584407e-01; -6.948750873807913e-02   +2.846817046640672e-01   -5.614547145109768e-02   -1.226356996088184e-01   +2.569905603303159e-01   +2.133425235536833e-01   +7.015102394203819e-03   -2.495214428524628e-01   +2.164513748393016e-01   +1.904155679695623e-01   +5.731112128486686e-01   +2.398246966888711e-01   +2.675156608835829e-01   -9.080167379880072e-02   +8.925069196116391e-01   -2.095198381892506e-01; +1.622343816799643e-01   +3.595402040653454e-01   +5.324882978452442e-02   +2.955857809642943e-01   -3.494110391979104e-03   -2.250836330053926e-01   +7.030762540920759e-01   -2.437974480360257e-01   +5.779342395437194e-01   -7.005181329737796e-02   +2.846074829584375e-01   -1.028286426293459e-01   +3.303413413836315e-01   +2.553142600237269e-01   +1.740558957065888e-01   +2.593253378660728e-01; +3.626128245869490e-01   +6.988266292404428e-01   +4.891403101762282e-01   -1.816530095205599e-01   +4.967886012130654e-02   +8.090074030475154e-02   +3.581709337530100e-01   -1.629323706087130e-01   +2.357589363018221e-01   -1.290717034376508e-01   +1.761767077674039e-01   -2.504195401267990e-02   +1.317265184988514e-01   -8.441062978692362e-02   +6.898683789466540e-01   +1.587430279985496e-01; +9.243192620494325e-02   +5.796511676864636e-01   -4.319898446133555e-02   +3.782853076450724e-01   -1.720102717418239e-01   +3.648959574509711e-01   +9.484677530583177e-02   +2.225445412759254e-01   +4.502700284371861e-01   +6.448860894814659e-02   -3.549711760480550e-01   +9.151224763421877e-03   +3.306352204940111e-01   +5.075749902125154e-01   +1.832237142552940e-01   +1.322000459276984e-01; +2.517164128236708e-01   +3.363188077753397e-01   +6.882107843431577e-01   +2.404904830441057e-01   +3.006166490117178e-01   +1.421345245688826e-01   +7.054220778483120e-02   -1.292452937331341e-01   +3.733952795299890e-01   +5.326442271535433e-02   +2.537417622644439e-01   +6.715642476462652e-01   +6.695502029471111e-01   -2.849585397164955e-02   +3.397870721730940e-02   -1.949397005563561e-02; +3.860686714676630e-01   +1.991445244215526e-01   +1.841578323244203e-01   -2.827357771750831e-01   +2.102870524445948e-01   +4.053921026668459e-01   -4.053492194071645e-02   +2.282703674947538e-01   -2.436821335716128e-01   +1.251955535732043e-01   +4.355270057360404e-01   +5.276282684538406e-01   +4.782346276586920e-02   +1.564130777239729e-02   +2.103203270154071e-01   +1.376140351301350e-01; +2.215848391441078e-01   +3.144836962751912e-01   +7.461886779467768e-02   +9.735233959363425e-01   -5.693919703849591e-02   +1.611815244996367e-01   -4.633302947284885e-02   +3.139813655561879e-01   +2.681848972007284e-01   -2.486952949186013e-01   +3.628352685707547e-01   +2.773071775781347e-01   +3.050075453353410e-01   +2.451544981428063e-01   +5.687736074869577e-01   +1.669910181370037e-01; +3.117296480632277e-01   +1.348937984402369e-01   +1.751635307537202e-01   +2.242664567496010e-01   +1.838623694289210e-01   -7.178617451451147e-02   +1.750887377501118e-01   +1.498144359280689e-01   +2.060094881785571e-01   +3.603313756889822e-02   +3.079043494293117e-01   -2.376535524768992e-01   +1.873320543089645e-01   -1.826080584386677e-02   +4.087760217549063e-01   -2.453520768027584e-01; +3.933801417133199e-01   +5.248891599051449e-02   +7.807078830698450e-02   -1.783730213636688e-01   +1.229747416401874e-01   +2.318520981846398e-01   +9.171018078035462e-02   -3.471934601271888e-02   +4.618250114562824e-01   +2.402796132507099e-01   +3.221430303058097e-01   +3.214717956288854e-01   +1.145974711649590e-01   -6.850505273401773e-02   +4.534742958825891e-01   +2.848847379468192e-01; -1.303461440529698e-01   +3.119977957040148e-01   +3.239834969331468e-01   -1.406427394552679e-01   +2.578226845107265e-01   +3.444814638785917e-01   +4.568728219567442e-02   +2.768684265146950e-01   -1.332917720566957e-01   +2.236274708403101e-01   +3.001278723337771e-01   +2.470467884634779e-01   +2.591537488208535e-01   +4.069618171662275e-01   +1.649145885688915e-02   +3.320258560374886e-01];
L2I_L1I_iGABA_netcon = [+3.290572516206591e-01   -2.098566087323191e-01   +1.311045872284399e-01   +5.734658774863182e-01   -1.211437910781127e-01   -2.108091434014286e-01   +6.600820330894974e-02   -4.710880867893617e-02; +4.436364205372134e-01   +7.071537641524944e-01   +2.754293485791896e-02   +3.008064730458128e-01   +1.849564859268941e-01   +2.740017354732645e-01   +3.696217245764042e-01   -2.178967187001652e-01; +4.332127803512349e-01   +2.709164032555462e-01   +3.025012155218363e-01   +6.493006558169223e-02   +3.729128497319553e-01   +1.460851358116070e-01   +1.684450505488660e-01   -4.560877199598665e-01; +6.568704984432835e-01   +2.687698588334517e-01   +4.367398254997544e-01   +1.209835266313134e-01   +8.735535905206425e-01   +4.493765063356724e-01   +5.885809378479333e-01   +3.510878001710308e-01; +2.999545907216933e-01   +2.438632007745271e-01   +2.231913834772533e-01   +3.037014088466953e-01   +2.681793709034517e-01   +2.625978275900397e-01   +1.822804504798366e-01   -5.420863802003730e-02; -6.129857961218544e-02   +1.087427377884594e-02   +2.619639568564237e-01   +5.001529537474892e-01   +4.763288541716393e-02   +4.923954210175896e-01   -1.065003762320600e-01   +6.101743756171334e-01; +4.667289035335881e-01   +2.064751011739684e-01   +2.045687816439318e-01   -1.332968488117941e-01   +4.409704656380609e-01   +2.376058599626462e-01   +5.150798742078784e-01   +1.802859824366528e-01; +1.380766847690272e-01   +3.492114099203170e-01   +4.910566970749708e-01   +1.782563597417232e-01   +3.231178956115869e-01   +3.614196125879737e-01   +4.944751560723086e-02   +2.727939144278335e-01; +4.197184875727522e-01   +9.466433589913513e-01   -3.062469762940954e-01   +3.813662563202857e-01   -1.859222959939867e-01   +1.743427397284875e-01   +3.590636565246573e-03   +5.591315916468189e-01; +9.475404343629741e-02   -2.804478766629327e-01   +2.745424350225846e-01   +3.697109408195615e-01   +4.948082931871406e-01   -1.707112387420900e-01   -9.631387435297063e-02   +4.374448584441851e-01; +8.478919092207085e-02   +1.044526802521846e-01   +5.360228438809731e-01   +1.640083854734731e-01   -1.125121191380118e-01   -1.087418647492586e-01   +2.298043426776157e-01   +2.442735421009556e-01; +1.249256960081918e-01   +5.793198983523146e-01   +4.999938361260044e-01   +2.510981635556637e-01   +1.759236155727322e-01   +4.993594257198137e-02   +2.826098760008934e-01   +5.196403679645644e-01; +3.185131741265251e-01   +6.014524182223093e-01   +6.072791856315167e-01   -2.461800052036425e-01   +1.581714664893052e-02   +1.051673608126468e-01   -2.408892021147315e-01   +3.740382080473191e-01; +2.649508122886183e-01   +5.120026837438128e-02   +1.910736673873037e-01   -8.047239247590478e-02   +5.731021854038677e-01   +1.301054472075312e-01   +1.432772668683690e-01   -9.444992647586932e-02; +2.880985062112194e-01   +3.646599175055514e-01   +3.414187489064308e-01   +4.405015692451916e-01   +1.772931386469444e-01   +9.926090731782624e-01   +1.828871738129168e-01   +4.510343032757701e-01; -1.151512413812533e-01   -8.361168303858854e-02   +2.678097491964403e-01   +1.987283717572330e-01   +4.391172954802280e-01   +7.504684142868315e-02   +1.555584351298437e-01   +2.158657502400201e-01];
L1I_L2I_iGABA_netcon = [+3.891888055240483e-01   +1.935692495788273e-01   -5.520954115576727e-02   +5.674792131320530e-01   -1.203293272133009e-01   +3.556541922720013e-02   +1.772781507636564e-02   +4.186822406865126e-01   -4.171052707422494e-01   +6.293128764752826e-01   -1.590555004684354e-01   +6.819979722003308e-02   +5.004482130380536e-01   +4.051464249336850e-01   +4.139851733428597e-01   +3.854306846591607e-01; +4.720965314174300e-01   +2.278388446984514e-01   -3.577241505253297e-01   +4.457206356534887e-02   -1.145236554108309e-01   +1.338262495253932e-01   +5.624563424246838e-01   +3.578242530838212e-01   +5.751101730132694e-01   +7.622101259534645e-01   +3.232345347699246e-01   -3.345766480143881e-01   -7.268579809273670e-02   -4.969337521069550e-01   +3.004543551727745e-01   +5.717599549632710e-01; -6.010262015186860e-02   +5.351013170057895e-02   +5.188308177952268e-01   +2.012577517428802e-01   +7.976872064351419e-03   -8.614705985636602e-02   +5.938293936229497e-01   +4.739405633066010e-01   -4.276829799051158e-01   +4.937263388192501e-01   -4.096929160276201e-01   +4.158842139508181e-01   +6.544626173833974e-01   +4.331432206012856e-01   +6.603087150960172e-01   -8.209581204203351e-02; +6.672597361246252e-01   +3.183465802919715e-01   +2.240259531891672e-01   +1.403275297188779e-01   +7.684546481780704e-01   +1.844016337596841e-01   +7.997460166576607e-01   +6.675934816671154e-01   -3.656617299136141e-01   +6.637604375245142e-01   +6.940756380659887e-01   +4.716972317494075e-01   +4.365481511299124e-01   +2.077775414113272e-01   +1.821668505502669e-01   +2.498845306695867e-01; +1.246739556258897e-01   -1.552421896933006e-02   +3.689344622004797e-02   +1.768147003364961e-01   -4.043331702002656e-02   +8.880786631260209e-01   +6.980720024199276e-01   +2.560947214255725e-01   +5.246185853293643e-01   +4.946660920884209e-01   -2.422964621923908e-01   +4.803679311175719e-01   -3.340015854707891e-01   +4.160623641510350e-01   +9.309813146473223e-02   +7.884304408752930e-01; -2.210955805841903e-02   +3.844097817497127e-01   +1.555023268031079e-02   +5.822798271961090e-01   -2.764229676990431e-01   +3.836925153714520e-01   +3.341663231513186e-01   +2.768388640517199e-01   +1.152466443663995e-01   -3.800839421078032e-01   +4.175660768146290e-01   -3.172258985666678e-01   +7.125240250815273e-01   +8.504013254705546e-01   +5.244319673730100e-01   +3.997273074409208e-01; +3.999782727881274e-01   +6.098769829576949e-01   +1.943965280212224e-02   +3.453271900171202e-01   +1.998622242917691e-01   -2.309491989605672e-01   +4.389937922049037e-01   -1.606171754695584e-01   -1.645666066379562e-01   +5.153784700499562e-01   +6.289824506557644e-01   +2.671818551438079e-01   +1.622073128185302e-01   -1.622735629239288e-01   +3.390532865592532e-01   +6.808570750059556e-01; +4.399737333959870e-01   +1.182486214763876e-01   +2.110421404305339e-01   +2.395154007303280e-01   +9.791231540330966e-02   +6.732200868202353e-01   +4.717043001915625e-01   +2.551720402577227e-01   -1.023450325355687e-01   +2.215200783996151e-01   +9.579352911910513e-01   +4.775956303330268e-01   +3.505438417326471e-01   +2.311766500104302e-02   +2.668253074676272e-01   +2.913984696604620e-01];
L2E_L1E_iAMPA_netcon = [+5.357448125931272e-01   +3.485960266269655e-02   +8.720821139702581e-02   +3.693950403524136e-01   +9.727094853789390e-01   +3.713259856778247e-01   +3.431240718733787e-01   +1.251151829120268e-01; -2.808940257876702e-01   +4.553882900260155e-01   -2.292714989425269e-01   +5.104434552774326e-02   +4.729926285848531e-01   +1.326009030271829e-01   +5.172990292803390e-01   +4.770901730607214e-01; -4.112635643297065e-02   +5.500572129685132e-01   +5.946922495921843e-01   +2.906800870020367e-01   +3.250695801600678e-02   -7.150018942452357e-02   +5.678847421988745e-01   +2.782274362476858e-01; +4.471737246168607e-01   +3.265786489524858e-01   -2.320730862265197e-01   +5.799495164870285e-01   +4.240850568324315e-01   +2.251509789821488e-01   +3.955618947800241e-01   -3.400878570554854e-01; -2.581096058389173e-01   +6.560529791074496e-01   +4.652571488432949e-01   -1.333594079094133e-01   +2.666994791407225e-01   +9.857306307753248e-02   +5.632162537967953e-01   +6.410394793504776e-01; +4.600048425481301e-01   -1.499354836771229e-01   +3.686640812990938e-01   -2.093873828753184e-01   +6.316641260708102e-01   +8.111412344045206e-01   +2.857652661269103e-01   +1.800998939615504e-01; +1.377441484063221e-01   +4.284284333379711e-01   +3.083929840040432e-01   +1.488569884604236e-01   -3.660390297961886e-01   +5.191966121018058e-01   +9.838790370679358e-01   -1.584979114042443e-01; -7.923033612309020e-02   +4.036745640122239e-01   +6.766529038834843e-01   -4.238841167254712e-02   +3.029199123468498e-01   +4.929478416318975e-02   +3.114773910955392e-01   +3.922845663352204e-01; +5.614897639225067e-01   +2.024160768969004e-01   +4.346576577741402e-01   +8.107446435653364e-01   +4.411200130377912e-02   +4.302286742875970e-01   +2.321969409687682e-01   +7.710043822985424e-03; +1.173551464517362e-01   +1.754713650941845e-01   +2.113053207722620e-01   +6.119638443804626e-01   +1.624543298537836e-01   +2.093426389393737e-02   -5.805138299897295e-02   +3.883734986303601e-01; -2.397799518862002e-01   +4.387405874703917e-01   +4.201767135686810e-01   -4.007909766821902e-02   +5.534988876674089e-02   -2.877800317109362e-02   +2.530069295823815e-01   +1.513832067729952e-01; +3.652047207400797e-01   +5.101857259021847e-01   +8.258564249142559e-01   +8.374441169690945e-02   +6.276511667369168e-02   +2.943639729859028e-01   -3.781026683632412e-01   +1.539757180820422e-01; -1.382304676312342e-01   +4.940991284987109e-01   +3.290303940879237e-01   +2.048213277692978e-02   +8.699388938455682e-02   +6.902705359599909e-02   +3.296281577589895e-01   -2.308140421629139e-02; +8.874232762511620e-02   +4.039083729391445e-01   -2.902255019864020e-01   +1.067167663085928e-02   +3.823757922495030e-01   +1.403570150634662e-01   +5.171521119682830e-03   +2.918725530243003e-01; -5.412825260829980e-02   -7.676211557811769e-03   +2.952702282550391e-01   +6.047753187583259e-01   +1.142105803713689e-01   +2.075937332721022e-01   -2.799551679876013e-02   -3.759311761239380e-02; +2.494901165459677e-01   +2.268821360480869e-01   +1.432215394922779e-01   -1.243291011141553e-02   +4.346710299608826e-01   +2.066160654893321e-01   +4.424300107531119e-01   +5.562822046972901e-01];
L1E_L2E_iAMPA_netcon = [+1.376507953770680e-01   +3.067745655458400e-01   +1.219858094379483e-01   +2.041626575387404e-01   +2.282065617464133e-01   +4.264948179656590e-01   +2.431163158397197e-01   +2.486921223287503e-01   +3.315381810833362e-01   +2.278010923463623e-01   +4.449624120629526e-01   +4.141737657198754e-01   +4.791600352931985e-01   -2.010284231344278e-01   -2.781001864888574e-01   -6.865308717604329e-02; +2.834305478669393e-01   -3.076239010524846e-01   +7.688566640490238e-01   +2.820411979826040e-01   +2.637415978144788e-01   +1.260072609482265e-01   +3.998012188303994e-01   +3.250120615035859e-01   +5.679106933973843e-02   +4.610373449823562e-01   +4.288734811377315e-01   +2.152271113304600e-01   +4.325930779278134e-01   +2.457679848852014e-01   +3.620644882347137e-01   +6.014685864857818e-02; +5.304000496094904e-01   +6.854232035281992e-02   +2.809057678127834e-01   +2.744607172748321e-01   +2.638699065523050e-01   +5.036401407940542e-01   +2.014016473643628e-01   +3.479949988718952e-01   +1.257098231306883e-01   +1.079991242730992e-02   +3.113154544259427e-01   +5.423253065913769e-01   -3.686644548954615e-02   +5.182218477725546e-01   -3.964822464861381e-02   -3.920161944523005e-01; +2.281546754816338e-01   -1.559192440547597e-02   +3.233866437345407e-01   -9.865949429087081e-03   +2.432603856115330e-01   +5.188239966224949e-01   +9.520695329140219e-01   -1.208400121078850e-01   +7.211236705294995e-02   +1.318451006657361e-01   +4.625929304767449e-01   -2.315059322680882e-01   +1.079428442040490e-01   +6.308383483473986e-01   +3.584046712484096e-01   -8.238714880107257e-03; -7.014542413135167e-04   -3.308141425506005e-01   +4.587208005507326e-01   +1.151329794215721e-01   +6.668626836361103e-01   +2.059999808476376e-02   +4.454163727690985e-01   +2.253987891331868e-01   +2.031418936622089e-01   +1.918352548823468e-01   -7.652849171010970e-02   -3.093623684245207e-01   +4.034455195874685e-01   -8.250193601114056e-02   +8.284158561555649e-01   +1.348380914124495e-01; -2.569563768154043e-02   +6.289765561677684e-01   +3.578662043618089e-01   +5.513494901147582e-01   +4.414373120959729e-01   +6.774867438710560e-03   +5.280858124083053e-01   +3.516891655539424e-01   +6.583377940541572e-01   +1.124584368626921e-01   +4.794932923720033e-01   -9.950999221309530e-02   -1.387698074212763e-01   -2.697966345428459e-01   -3.998357841578983e-01   +4.771681802907214e-01; +6.244453346561447e-02   +5.882805511548707e-02   -2.686569824846932e-02   +6.362691353092538e-01   +1.905099902398802e-01   +1.658548469060228e-01   +7.426519575985361e-01   +5.955817051475351e-02   -8.677477795991130e-02   +1.184248245653270e-01   -1.008209537842612e-02   -2.292876231263406e-02   -1.495565701483240e-01   -4.425615518656232e-02   +5.865686433824249e-01   +2.625108684503258e-01; +2.377021956774659e-01   +2.431358118989154e-01   +1.249111167532376e-01   +5.345407821533433e-01   +3.648538787990687e-01   +8.207035136102582e-01   +5.032278492200776e-01   +4.153510860479788e-01   +3.799456546385672e-01   +2.620346120915306e-01   +1.222093923392959e-01   +3.138955781278565e-01   -2.590714938681127e-01   -2.482111151221957e-01   +4.992574002629402e-01   -2.159976300694212e-01];
L2I_L2E_iAMPA_netcon = [+3.071883726797082e-01   +5.554831820023794e-01   +6.546353018417531e-01   -3.378813821347148e-03   +6.873667220416592e-02   +7.192167286378526e-01   +2.216345557509693e-01   +5.263720629739784e-01; +3.790442918338887e-01   +3.719598313428930e-01   +7.729056362738406e-01   +5.587092976669166e-01   +4.255975673782290e-01   +6.501204321564856e-02   -8.189408926727865e-02   -3.275721722337054e-02; +1.039703646776398e-01   +3.714736414712416e-01   +1.550123748054607e-01   -8.033132429425643e-02   -3.646865884813073e-01   +7.412371353185608e-02   +4.860869405048713e-01   +7.606776788817285e-02; +7.347366598294858e-02   +1.739465637849207e-01   -3.489657971166131e-02   +5.424383247415967e-01   +2.692112447033050e-01   -1.898785536886843e-01   +1.988460189637286e-01   +5.200339954467435e-02; +4.867598728296764e-01   +5.537077897276244e-02   -8.868955037782442e-03   +4.600971375248694e-01   +1.609855937462388e-01   +2.066604566219840e-01   +6.673948513099411e-01   +1.686644190876462e-01; +3.333818943540611e-01   +3.056055599413894e-01   +1.117140476952707e-01   +3.761268100146444e-01   -1.225136564716822e-01   +2.785700336590033e-01   +1.101482469696297e-01   +8.601031493982622e-03; +5.264960082127407e-01   +9.720588716545908e-02   +2.233320914183173e-01   +5.954076940238431e-01   +3.220245977345240e-01   -1.282891105092387e-01   +9.663369367351430e-01   +1.955298744840507e-01; +3.898667099474988e-01   -2.832267986956201e-02   -2.288267424649956e-01   +2.280010949417611e-01   -7.456731376240497e-03   +7.188597204736002e-02   -1.008594036707249e-01   +4.000160852353732e-01];
L2E_L2I_iGABA_netcon = [-1.108504392635360e-01   +2.357640519520486e-01   +5.327582945211650e-01   -1.394350695291362e-01   -1.653589705009174e-01   +1.708179255684135e-01   -1.077458955301256e-01   +4.244512584522387e-01; +9.584188236980494e-02   +3.036958815076124e-01   +1.659178437735952e-01   +4.133356168611637e-01   +6.190228518636841e-01   +2.125506270400654e-01   -6.040391617962363e-01   +2.158165613143191e-01; +4.694683911486527e-02   +7.699627636292125e-01   -1.719151782347317e-01   -1.942050064250120e-01   +2.637152513040968e-01   +5.001825294146948e-01   +2.036286379728076e-01   +7.969870185165214e-01; -1.138499603600054e-01   +3.475281429011600e-01   -1.086598466116959e-01   +7.121331934624745e-01   +6.590420981367682e-01   -9.078100264926847e-02   -3.232000768333231e-01   -1.694926771996585e-01; +5.652488818572973e-02   -2.200516611725973e-01   -7.481661737812413e-02   +2.330204535417032e-01   +8.370498401998830e-01   +3.288512227082710e-01   +1.415881624563520e-01   +1.293657157909352e-01; +5.092864549602703e-01   +3.082453079227912e-01   +1.883702515242770e-01   +3.850081752746928e-01   +2.700502714578923e-01   -2.574275547734473e-01   +2.581106028528570e-01   -1.965804444017552e-01; +1.066429029103527e-01   +5.039434729588120e-01   -2.050567735894371e-01   -2.289804582448750e-02   -7.481433892124781e-03   +1.462780119746865e-02   +8.010241937598050e-02   +6.759338226867763e-01; -7.381903768172032e-03   +4.561168718204717e-01   +5.961307759555037e-01   -1.379868490269506e-01   +4.749519577370768e-01   +2.255024983558217e-01   +3.192231156816295e-01   +6.429974918627184e-01];
L3E_L2E_iAMPA_netcon = [+4.833037536168842e-01   -3.920685779989725e-01   +1.640837770037069e-01   +3.023693893240926e-01   +5.932057803909524e-01   +2.142137267067955e-01   +2.311941104866907e-01   +6.076931643297790e-01   +5.853716904824544e-02   -8.272100546400628e-02   +2.210027124360390e-01   -1.611004254353957e-03; +4.266664767546591e-01   +8.591394542758048e-01   +8.805635598653241e-02   +4.832972265714522e-01   -4.418844220804786e-02   -5.131681365734287e-01   +9.801477286659260e-02   +1.783376532834757e-01   -2.684930390146580e-01   +5.648065170221178e-02   -5.369066922549605e-02   +4.273974417478048e-01; -3.148819838174901e-01   -1.715716431342037e-01   +1.723982473089376e-01   +2.648316325073518e-01   +9.294514707499683e-01   +5.209091391429514e-01   +4.123269682376224e-01   +2.937402532513795e-01   +7.076704601542041e-01   -1.912241174658691e-01   +3.812236836528554e-01   +6.132557350320794e-01; +2.758034934539943e-01   +2.196877607104165e-01   +2.440843175388185e-01   +1.721460288718202e-01   +5.920288497052447e-01   +1.972872315863624e-01   +2.463711681633742e-01   +1.608434013991167e-01   +4.686664078260976e-02   +4.299367887784408e-01   +2.393918957286494e-02   +2.807729570448229e-01; +3.343690515354186e-01   +9.753089660363030e-02   +1.315146010379852e-01   +2.606036257974020e-01   +7.827694804766890e-01   +1.202816843940309e-01   -4.708067585069670e-03   -7.175655503662855e-02   +3.713364298467828e-01   +6.472913615514739e-01   +7.563768598517755e-01   +7.987234532438783e-01; +5.904086335963105e-01   +6.644118982923072e-01   +2.220789484586088e-01   -2.185736439343491e-01   +1.729727105525113e-01   +4.964616300395039e-01   +1.317994911067868e-01   -1.902216303127868e-01   +1.606182400283837e-01   +5.178695836769176e-01   -1.812212873528508e-01   +2.404973222157954e-01; +3.321026223792078e-01   +1.440154803494381e-01   +7.651408329105341e-01   +5.137932704363134e-02   +2.497297994524053e-01   +4.063328662692399e-01   +5.484768039417045e-02   +1.838679426145805e-01   +4.939540564561571e-01   +4.998243864299073e-01   +4.494261722960043e-02   +2.734431104271608e-01; -1.442580995354888e-01   +8.826696368745047e-01   +4.816974418605384e-01   -3.707621339606080e-01   +8.381431366143518e-01   -1.502412967173231e-02   -4.503119986387207e-02   +9.393118852429745e-02   +4.852046056195214e-01   +5.038688195524378e-01   +1.299784988508989e-01   -5.408424605606979e-02];
L3I_L2I_iGABA_netcon = [+6.140289363515002e-01   +6.069200726611756e-01   +1.917932032375556e-01   +2.161657650274860e-01   -1.552797935200208e-01   +2.240664259472019e-01   +7.420035987162705e-01   +5.914165668052342e-01   +7.888995704065900e-01   +2.213499165664125e-01   +1.639441755466463e-01   +3.928440123517886e-01; +3.318739577352778e-01   +1.259540009536867e-01   +6.692719236809343e-02   +1.833592976315771e-02   +4.923905424641906e-01   +4.319662610641606e-01   +5.859913793429650e-01   -1.224415812531560e-01   +2.835361793192527e-01   +1.404280407775365e-01   +3.455434922788376e-01   -1.471033315443702e-01; +6.820780141852799e-02   +3.879358626718850e-01   +2.801306993441973e-01   -2.419906519040154e-01   -2.004243979932827e-01   +1.880510607030242e-01   +4.488892277499120e-01   +3.524034966467018e-01   +3.152939653433722e-01   +7.489091563046320e-02   -1.745552319467887e-01   +8.011020490034381e-01; +3.693822059377791e-01   +3.070882816753039e-01   +5.272028257721805e-01   -6.029717973209540e-02   +8.854616136936326e-03   +6.373692297134520e-02   +2.926329415781861e-01   -1.198220276424755e-01   +4.658402056221146e-01   +2.278316732118538e-01   +6.889104455663737e-01   +2.158575676848992e-01; +3.856937139684301e-01   +2.814116828550500e-01   +1.265740528663780e-01   +2.772515418700000e-01   +4.889838180474130e-01   +5.218972842189564e-01   -6.344134314465064e-02   +9.757424537137012e-01   +6.978588940112657e-01   -1.285923233807207e-02   +2.484117922030778e-01   +4.030125856271253e-01; -9.673230955396388e-02   +3.301430840044816e-01   +2.073954944278718e-01   +2.870263510616762e-01   +6.856044295765070e-01   +3.370132877676823e-01   +2.471991945220365e-01   -1.061772346848259e-01   +1.611849958981314e-01   +2.824728678257656e-01   +1.190326277828766e-01   +4.882607194039277e-01; +5.187426710457791e-01   -2.818652654682199e-02   +2.721182731311654e-01   +2.464176272820826e-01   +1.421933264115277e-01   +4.528294254203013e-01   +4.556188268634520e-01   -4.063431662136846e-02   -3.390281731913922e-01   +6.091530045214589e-01   +4.380193339885788e-01   +3.865962637800137e-02; -1.666131508041458e-01   +3.005976566349448e-01   +3.933561116817752e-01   +5.727793030039702e-01   -1.301243784648148e-01   +5.092404528816955e-01   +6.060516362324613e-01   +4.097002049842083e-01   +4.313196318448625e-01   +2.865866366205505e-01   +4.711528614312925e-01   +4.809606658841377e-01];
L2E_L3E_iAMPA_netcon = [+4.973690032374199e-01   +3.286198367329159e-01   +4.062820712000378e-01   -3.258627895833001e-01   +1.133514321599827e-01   +1.600539648775134e-01   +4.197552946830690e-01   +2.383461526958338e-01; -8.586874459651396e-03   +9.969256940429617e-02   +3.262253636499916e-01   +4.245718954334259e-01   +5.154697543213050e-01   -2.915006055992157e-01   -6.670105240333540e-02   -4.016768750739146e-01; +3.671739294606691e-01   -6.205962354300256e-02   +2.370645950350104e-01   +5.589392541113254e-01   +3.499135313948303e-02   -7.589656135680971e-02   +2.581799066959200e-01   +1.249180529250363e-01; +1.177453352249856e-01   +2.645361685768033e-01   +6.881361038583194e-01   +9.088114936877398e-01   +4.559167375846392e-01   +5.606191915323492e-01   +1.078767072285925e-01   -9.641893235703242e-02; +2.641531282040791e-01   +1.348098550731803e-01   +8.565647969348676e-02   +8.115239032732512e-01   +4.974967688329122e-01   -4.525883776717948e-02   -1.069049575031453e-01   +1.222460740702083e-01; +3.705233996436064e-01   +8.645482166342453e-01   +6.215564616239742e-01   +5.667866405194739e-01   +5.371436223668197e-01   +1.370892595874851e-01   +4.932098172045483e-01   +6.735163200633823e-02; +1.660168641758707e-01   +2.992055579519423e-01   +4.379589652414362e-01   -1.789073252459260e-01   -1.093916526612762e-01   +1.231951933281877e-01   +4.168972419294940e-03   +4.350945532940808e-01; +4.299535344638025e-01   +2.359091859065164e-01   +2.494382881170535e-01   +1.857906268335404e-01   +4.626538396320474e-01   +4.178887146028694e-01   +3.400585549262234e-01   +7.212196555917835e-01; +5.143710607042703e-01   +4.384411531030723e-01   +4.247897781929766e-01   +1.246984490986034e-01   +1.285051608145159e-01   -4.437534323863435e-02   +8.123019875274219e-01   -3.027612655840234e-01; +3.774412605606087e-02   +2.726588047187867e-01   +3.180773676833900e-01   +1.206722145167796e-01   +1.457810556915630e-01   -4.665388237948460e-02   +4.558027983627086e-01   +8.716229480063117e-02; +4.947722822232305e-01   -5.667817634258968e-02   -2.033555705309413e-01   +9.886748357409064e-01   +2.721133781976668e-01   +3.127026866806358e-01   +2.293129106681905e-01   +4.030448021075391e-01; +9.809746306719873e-02   +8.785350111621311e-01   +5.795701087762981e-01   +6.244674746132760e-01   +2.303082919536110e-01   -4.803094734280391e-02   +1.848302606154609e-01   +4.851999854931993e-01];
L2I_L3I_iGABA_netcon = [-2.283358902053719e-01   +1.841506644378845e-01   +3.552422347228411e-01   +4.333607417473276e-01   +5.013706485831674e-02   +7.040543775570174e-01   +1.789376126405303e-01   -3.021960739569083e-01; +2.303646983795637e-01   +1.296733082628409e-01   -1.799731891467180e-01   -5.037244417098289e-02   +2.264970017838830e-01   -6.918654048449699e-02   +3.627015610766976e-01   +2.719992303805501e-01; +7.927542077337666e-01   +8.206381430809541e-01   +1.030977187542241e-01   +5.628507019100734e-01   -1.833121776478201e-03   +7.291296704551691e-01   +2.876453799422444e-01   +1.311095951677358e-02; +3.868753162957532e-02   +3.575734852143796e-01   +6.860727008610236e-01   -3.494260941171941e-01   +6.531818337309298e-02   +5.103789269179273e-01   +6.891535818703437e-02   +4.083158837995408e-01; +6.322226393731131e-01   +2.162275861741668e-01   +1.290145233830395e-01   +3.574594794381593e-01   -1.924086988236659e-01   +2.801053962659405e-01   +5.618156917695666e-02   +9.456300363326413e-02; -3.593461869617205e-01   +2.380369072745378e-01   +8.112099458048930e-01   -2.696838217169558e-01   +4.199331673967978e-01   +9.486017444611735e-01   -2.680291137823176e-01   +1.757196002547005e-01; +5.472614199851524e-01   +8.976438996406477e-02   +3.080145300421163e-01   +2.152347411169999e-01   +2.605045401959069e-01   +6.242458166018806e-01   +8.198297717802795e-01   +5.326251376091620e-01; -3.329611813880158e-01   +7.062493185212643e-01   +2.704871101585249e-01   -1.971564387420579e-01   +1.528723488010779e-01   +4.006727398443182e-01   -2.288322230621301e-01   +8.392662359770012e-01; -8.398964758481992e-01   +8.214804959235464e-01   +6.480389590537067e-01   -1.040895889891139e-01   +1.473553542265439e-01   +5.292653777016521e-01   +4.577692123269446e-01   +3.041111848737282e-01; +2.902133907405396e-01   -3.675562942937295e-01   +1.486733051427896e-01   +2.048540678516006e-01   +4.686232160087575e-01   +5.183019250704114e-01   +1.525626607518412e-01   +5.636814220760819e-01; +8.457613589866213e-01   +3.379787094677208e-01   -4.513106380798456e-01   +1.426059638630929e-01   +4.777861925518105e-01   +1.963944633786933e-01   +5.524767732668799e-01   +9.254057558900106e-01; -3.190450418765020e-01   +7.497053237009539e-01   -2.669813869232431e-01   +6.955136560250806e-01   +6.436678284837658e-01   +3.372381346310721e-01   +1.389772384616672e-01   +1.325311307450393e-01];
L3I_L3E_iAMPA_netcon = [+4.752583417817554e-01   -1.578653829237716e-01   +2.424763417363848e-01   +4.434648118072108e-01   +1.771871429609161e-01   -2.909572664015337e-02   +1.651076609506017e-01   +1.291667047915883e-01   -2.885249112885016e-01   +3.915953472779902e-01   +5.633116018946070e-02   +4.101844852095270e-01; +1.916803580363462e-01   +6.835403752279263e-03   +9.072069546419463e-02   +5.064393493099109e-01   +3.233413233975719e-01   -7.133443713449696e-02   +1.967395330740271e-01   +3.434443012627678e-01   +5.208789895931836e-01   +3.773399642149070e-02   +1.162130306958960e-02   +1.790867180482837e-01; +3.529628988375147e-01   +5.227025243210907e-01   +4.945846498664299e-01   +2.176932876393639e-01   +6.606310996692564e-01   +2.506257586752522e-01   +5.734258461226934e-01   -1.241494510937269e-01   +3.834164369171807e-01   +5.129088995794024e-01   +9.900615810019439e-02   +3.624875293429882e-01; +3.982549349891839e-01   +3.161762377272578e-01   +4.785867833435679e-01   +5.402508908409509e-02   -3.869605529755310e-02   +7.525315833868068e-01   -1.581201870415712e-01   +3.830304453074151e-01   +3.617763776788569e-01   +4.073272278042948e-01   +1.522672520819969e-02   +2.771698222339582e-01; -2.122118664779571e-01   -1.052996190906108e-01   +8.423395601374295e-01   +3.741370575384216e-01   +4.590548911785202e-01   +3.972156719874294e-01   -2.994214479663985e-01   +3.144058887344393e-01   +5.354395451993615e-01   +6.289929898863560e-01   +3.224460592684238e-01   +4.268999940206019e-01; -1.271883308708026e-01   -1.064534579647999e-01   +1.500802846461487e-01   +4.314173489812399e-02   -2.061727257607127e-01   +2.608706720721831e-02   +2.799967956336344e-01   +3.392975313457131e-01   +2.805680917789533e-01   -1.748064873413576e-02   +2.311243844071720e-01   +4.571155641689789e-01; -1.010393799465006e-01   +1.122689694739538e-01   -1.774618130141412e-01   +3.246251722304287e-02   +4.478790601547878e-01   +1.415863641491096e-02   +6.534463160981223e-01   +4.868792304492477e-01   -6.866949443526854e-02   +3.599319450036487e-01   +5.008664278026437e-01   +3.573552287918867e-01; +2.851719902412679e-02   +3.290051088988297e-01   +1.585285149041340e-01   +1.016272954848462e-01   +4.530994886664975e-02   +1.153242641481299e-01   -1.263921711803529e-01   +3.786287404426620e-01   +4.413935401540423e-01   -3.345728664244085e-01   +3.802929196347211e-02   +4.821779973450558e-01; -1.801812600855604e-02   +6.254010689756379e-01   +1.021375567292572e-02   +4.746899367295565e-02   +1.957808042489144e-01   +8.379707961433963e-01   +2.412832449433139e-01   +5.807702117152750e-01   +1.347204102475524e-01   +2.009077014507492e-01   +5.239104551479238e-01   +1.000000000000000e+00; +6.870511130821941e-01   -6.037350901564390e-01   +8.229997540749696e-01   +1.728590872042644e-01   +2.631715097386031e-01   -3.457018303899683e-01   +5.119428008589552e-01   +1.371791427498430e-01   -6.530147031071078e-03   -1.139615644598128e-01   +9.668114540342720e-01   -2.597798523393488e-02; -4.659130016384018e-01   +3.968702638024256e-01   +7.818410308200476e-01   +4.796188918354002e-01   +2.302683150804219e-01   +1.567712960244166e-01   +2.706544956110957e-01   +1.981599420084671e-01   +6.397127963696225e-01   -2.520159497362430e-01   +1.359692637667285e-01   +3.044937090228858e-01; -2.043169808738765e-01   +1.531119094296787e-01   +1.602434435563103e-01   +2.911912860702359e-01   -2.600173308444672e-01   -2.777618900958063e-01   -3.275575902185017e-01   +1.881067008323622e-01   +6.360318219384681e-01   -2.162369541126006e-01   +1.868259774920889e-01   +1.648058102366823e-01];
L3E_L3I_iGABA_netcon = [+2.390498452146046e-02   +2.403035731688494e-01   -1.726589944671888e-01   +2.815130035654320e-01   +7.504890108720656e-02   +5.503458765089540e-02   -7.733004113067354e-03   +2.105517879195663e-01   +9.712308791447585e-02   +2.671907879514034e-01   +3.509718507754726e-01   -1.006915546459717e-01; +3.389808006812154e-01   +3.016567381304949e-01   +1.250803684225130e-01   -1.252205448614376e-01   +2.832137098636536e-01   +1.301166920273385e-01   +1.494677170601689e-01   +2.789300793896304e-01   -3.887595121289844e-01   +6.557291361733217e-02   -2.311709321802965e-01   +2.334688312102577e-01; -5.946252134182961e-03   -6.783959147258473e-02   -2.262476855243168e-01   +3.371761966473687e-01   +2.085077637771820e-01   +7.059433884480412e-02   +8.134171678019818e-02   +2.565112508010477e-01   -3.620084603703185e-02   +4.325963646985252e-01   -8.080434259812871e-02   -1.057811099142746e-01; +1.214598866978015e-01   +4.216220876176518e-01   -1.736700090804462e-01   +2.794331489355352e-01   +6.450394515665939e-01   +1.059723352588257e-01   -1.219663898211510e-01   -4.770124148371987e-02   +6.759289987952326e-01   +4.408416825810267e-01   +2.417324453406193e-01   +1.538513346491181e-01; +2.313346368563850e-01   +1.064639805199613e-01   +1.295751788909141e-01   +2.036375542250439e-01   +8.683470436995727e-02   +1.817133491611775e-01   -3.207385905317885e-01   +6.557150881472446e-01   -3.320545374466105e-02   +3.783637332326343e-01   +4.495192977792959e-01   +4.547491676373897e-01; +5.997129792685533e-01   +1.525973097434316e-02   -1.172864379388192e-01   +1.197232095331610e-02   +5.748194182524451e-02   +1.636998596798912e-01   +8.255733660547264e-02   +2.707874152632183e-01   +4.158595486747690e-01   +3.765015192517252e-01   +1.592742648924381e-01   -3.557468775703932e-01; -2.157186929394601e-03   +3.517722486133040e-01   +4.640336883708730e-01   +9.965120791203239e-01   +2.358967853267974e-01   +3.245743148052234e-01   +6.068437061830634e-01   +2.696189291623644e-01   -1.163156576656836e-01   +4.271100969672902e-01   +4.956567110411869e-01   +4.445365152055768e-02; +1.934679028034324e-01   +3.006704512294948e-02   +5.869303685709574e-01   +5.468653201858072e-02   +2.729001811390671e-01   -1.648390611693399e-01   +1.042780566886263e-01   +4.935950475609314e-01   -4.281039819467418e-02   +6.513093813378634e-02   +2.079704902857374e-01   +4.193217160039433e-01; +2.388063651512520e-01   +8.204147807736041e-02   +3.905330087450271e-01   -7.117005800266481e-02   +1.416540780950041e-01   +4.849701924438032e-02   -2.466589673636055e-01   -1.402737284959677e-01   +3.479058052175180e-01   +5.766744773992558e-01   +3.868155825357011e-01   +5.073912283949256e-01; +1.120242276600179e-01   -4.174885139781045e-02   +4.123294802165199e-01   +1.153067849375906e-01   -2.834959130184231e-01   +3.059433235734059e-01   +2.561935504733179e-01   -1.180571072803334e-01   +2.734220654572727e-01   +3.673527731656963e-02   +1.446757817957205e-01   +3.544271450471682e-01; +1.346310959419924e-01   +1.429190221953053e-01   +4.597500175007281e-01   -5.050206940737376e-02   +2.126196553359004e-01   -7.864109574080029e-02   +2.912988122589111e-01   +9.853300109083846e-02   -8.926023140969387e-02   +1.537935662640151e-01   +2.665260549597079e-01   +2.795469337773807e-01; -2.674053002363057e-02   +3.620301988064153e-01   -7.301560430763682e-02   -3.628811905525006e-02   +8.032847569086843e-01   +3.305589361628892e-01   +6.280276592112567e-01   +3.718613745000216e-02   -3.073124544115694e-03   -2.490552511066538e-01   +3.110078794811433e-01   -1.896302160600844e-01];
L2E_Input1_iAMPA_netcon = [+6.009977842425355e-01   +7.512825835109063e-01   +9.234371548237418e-01   +8.828467546746163e-01   +8.549950415183259e-01   +8.045642032584887e-01   +7.322183783581386e-01   +8.202420944006182e-01];
L2I_Input2_iAMPA_netcon = [+6.225239315433975e-01   +7.414441050697943e-01   +7.456074226314372e-01   +9.782528267799993e-01   +2.123854628384977e-01   +8.979146051865757e-01   +1.492693484400800e-01   +2.710126817275599e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last =  11.21 * ones(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.2*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.2*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.2*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.2*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.2*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.2*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.2*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.2*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
