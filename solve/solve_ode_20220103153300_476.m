function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+4.179243696252213e-01   +2.777581778809664e-01   +5.401112459398582e-01   +9.104864897714361e-02   +2.465688570567124e-01   +6.957644588250492e-01   +5.357550063089137e-01   -6.461066312612164e-02   -8.164831477108996e-02   +1.397499813182123e-01   +4.652114024450482e-01   +3.615618409478107e-01   +4.825517908726663e-01   +3.695106792423993e-01   +5.502688429357887e-01   +3.818101173321410e-01; +3.538633548268657e-01   +6.458106282375066e-02   +2.649907239940592e-01   +3.833358274444499e-01   +4.912569801903358e-01   +2.235892225185624e-01   +2.392098175646651e-01   +3.328693495653290e-01   -1.067770533832016e-01   +5.729412588187441e-01   +4.508983650211546e-01   +4.924907210225488e-01   +6.472219591860061e-01   +1.850405429123325e-01   +5.136185229069429e-01   +4.123899186637813e-01; +1.279102481774352e-01   +2.549985274122150e-01   +5.101862559806715e-01   +8.357830241066769e-01   +6.113997337340340e-01   +2.882865364920942e-01   +2.208206821660733e-01   +3.542844543206163e-01   -1.178725359593879e-02   -1.750329250985698e-02   +3.766175104838930e-01   +7.075843467959748e-01   -2.042773083038087e-01   +1.726995348639019e-01   +4.915062801099755e-01   +2.627995651961109e-01; +3.292884131424496e-01   +5.684353118295712e-01   +6.194634120829489e-01   +7.163912477960446e-01   +1.786241364786968e-01   +5.442107044501048e-01   +7.233137030810626e-01   +4.036713753354375e-01   +6.098758678732339e-01   +3.843208875814928e-01   -7.210418007422782e-02   +2.912175086817189e-01   +5.422015173173853e-01   +3.825051867024724e-01   -8.321791534308255e-02   +1.813396496949129e-01; +1.417658483770181e-01   +4.971685948402184e-01   +1.442428989684054e-01   +3.399854774454506e-01   +2.292774670974938e-01   +1.703924478686325e-01   +3.911727166375243e-01   +4.618126389795925e-01   +7.948333995471715e-01   +1.527334257126155e-01   +5.850299228217986e-01   +4.034286195455715e-01   -5.449643997915872e-02   +5.635537086558037e-01   +3.091461423860803e-01   +1.695814174517279e-01; +7.587540656970088e-01   +7.081765129105309e-01   +5.322343884140815e-01   +1.859466343715843e-01   +1.917546442149258e-02   +6.328512176011222e-01   +5.299877761164312e-01   +2.222725230652862e-01   +1.093426938624905e-01   +5.198670854364077e-01   +2.900810032945170e-01   +5.919835292568850e-01   +5.769870032029080e-01   +4.673710608933269e-01   +8.004962067718467e-01   +7.197584099426503e-02; +6.522915363199977e-01   +5.416114201944608e-01   +4.803751408379699e-01   +2.831735125732541e-01   +3.632136272427677e-01   +2.935331308117934e-01   +4.260415803627085e-01   +1.670060467320626e-01   +2.099210431097234e-01   +5.617490535134512e-02   +2.298330179302170e-01   +5.327913991486949e-01   +4.945009892919888e-01   +3.175760699331857e-01   +4.980090580619658e-01   +6.438617368107029e-02; +3.253021642459681e-01   +4.400172524823022e-01   +4.489022681393158e-02   +4.208178268135340e-02   +4.594879146578221e-01   +1.824424518725359e-01   +4.633858999287586e-01   +4.350113960349789e-01   +1.843927269585256e-01   +3.008337534811705e-01   +2.733458265784021e-01   +1.184624810655150e-01   -1.272849625093307e-02   +4.616959288794573e-01   +8.928446571757019e-02   +1.800655090793495e-02; +5.805470839270543e-01   +1.998146760420808e-01   +7.100226618458010e-01   +1.117747634587739e-01   +6.300014614822153e-01   +4.413707948504810e-01   +7.139281004065000e-02   +4.946171001269894e-02   +3.864382482105831e-01   +2.602789678646758e-01   +4.449143366277913e-01   +4.371259235239523e-01   +5.152580920677139e-01   +5.456485666745404e-01   +1.929423171041403e-01   +3.771422499019699e-01; +6.341350968813179e-02   +6.316894889649382e-01   +3.170104840575491e-01   +3.159737601768406e-01   +3.332755793218787e-01   +7.883893541366368e-01   +6.089931031237950e-01   +4.103252304067174e-01   +3.898019986533786e-01   +5.864326339539168e-02   +2.484865329931729e-01   +4.948188159001169e-01   +2.369884743385415e-01   +7.427576183900510e-02   +2.230413164998301e-01   +2.246235235354332e-01; +7.302749278171108e-02   +1.321165628073763e-02   +4.877613785588203e-01   +5.910595637872520e-01   +3.370801917446836e-01   +4.626566000368151e-01   +7.447799096999536e-01   +1.975136131230506e-01   +1.000000000000000e+00   +2.031679872542085e-01   +4.668211282948959e-01   +3.075181904273873e-01   +1.472662978001121e-01   -3.983282187985526e-02   +5.754141322537817e-01   +1.846292049045716e-01; +2.210385515333080e-01   -1.539290919000310e-01   +2.072317210690198e-01   +3.469731250529020e-01   +1.047889941273492e-01   +5.072344445410943e-01   +2.091656871390131e-01   +6.990390318126867e-01   +5.966335640732637e-01   +5.428669362117245e-01   +2.261194985337799e-01   +4.685512336418711e-01   +3.468389106972193e-01   +1.452321634502614e-01   +5.669677687557519e-01   +7.785131705096368e-01; +6.713044953629971e-02   +8.025563837083931e-02   +3.927846853933951e-01   +2.325757651781213e-01   -1.009308014098968e-02   +4.600219644896802e-01   +4.670930550715516e-01   +3.984301708697923e-01   +7.309639472885502e-01   +7.688422928972539e-01   +3.003154221151070e-01   +6.032973129216193e-01   +5.531533165846337e-01   +5.426893374852965e-01   +9.968759209510748e-01   +3.318432170151502e-01; -1.994734765382919e-02   +7.808135145458048e-01   +5.300159944406800e-01   +6.656747046256115e-02   +1.122822305827341e-01   +5.402006471101007e-01   +4.795171810475747e-01   +5.588496351994678e-01   +2.885584783687143e-01   +5.858116365607696e-01   +5.575073835223635e-01   +4.084681108315137e-01   +6.663131402731443e-01   +3.671476996776775e-01   +5.885646646126273e-02   +4.845840118788042e-01; +3.626002081390201e-02   +3.523211173881466e-01   +6.582141443370153e-01   +5.598780985275623e-02   +1.267555101064468e-01   +1.243811709579628e-01   +6.265611350511254e-01   +5.699305285820109e-01   +9.398901329163982e-02   +5.914964180439527e-01   +1.325818791760709e-01   +1.615670531790670e-01   +2.961081284465832e-01   -4.392452762653960e-02   +4.319005897575933e-01   +2.466678577222307e-01; +2.881102488198523e-01   +3.718971026654617e-01   +5.810765543911414e-01   +5.329711897479672e-01   +5.363488821041111e-01   +3.660871024335602e-01   +1.897334890126836e-01   +4.781154146953824e-01   +3.578699880082313e-01   +5.540039427240560e-01   -2.073394363560321e-02   +2.886359283075507e-01   +4.655861202991354e-01   +5.444121024156461e-01   +6.533500263739145e-01   +7.038912546209837e-01];
L1E_L1I_iGABA_netcon = [+4.857763447798717e-01   +1.837788780416496e-01   +2.439710743941172e-01   +5.432956590941721e-01   +3.992927696136052e-01   +3.423107301657040e-01   +7.896036703087935e-03   +4.262750919632038e-01   +5.410281979439470e-01   +1.691729081268217e-01   +7.234151437127687e-01   +4.356832464070376e-01   +8.719274073957718e-02   +6.239754888307363e-01   +4.698944208729986e-01   +2.517047432805217e-01; +4.390641956926456e-01   +2.101999585282855e-01   +8.014776438914712e-01   +5.778143318531851e-01   +3.254083829859498e-01   +1.256051705314410e-01   +4.959207853194543e-01   +3.209206628878845e-01   +1.502821480683998e-01   +2.314592803548525e-01   +1.328284352326846e-01   +4.359148908920257e-01   +6.146509330652078e-02   +4.332536454805066e-02   +5.684636660117247e-01   +1.580264661331951e-01; +5.485877773820590e-01   +8.288928078444727e-02   +3.009723069050041e-01   +5.585786093350174e-01   +3.967652079252278e-01   +3.632816306179344e-01   +4.138785196858146e-01   +4.983007299954739e-01   +2.634864293115905e-01   +3.047949029112812e-01   +2.334165655213058e-01   +4.422730127536589e-01   +7.424997239424818e-01   +4.911308036893933e-01   -1.105591896960521e-01   +6.573677612999376e-01; -1.743293565078863e-01   +5.774160799944187e-01   +5.768833634021922e-01   +2.162279037605413e-01   +4.805841807947546e-01   +5.968723467397397e-01   +8.276367276426490e-02   +4.354041902055705e-01   +1.364725425730740e-01   +1.406011085337502e-01   +1.704373400149273e-01   +2.164293910935038e-01   -1.424400753012746e-01   +4.748509644856341e-01   +1.986459017329263e-01   +4.333193337092578e-01; +1.662840310661630e-01   -1.026925045386944e-03   +1.910040693170736e-01   +4.060882953144546e-01   +1.622377253600843e-01   +4.835739957755514e-01   -7.074412477586477e-02   -1.559365152402585e-01   +1.787796298821624e-01   +2.687509386947492e-01   +2.088394626135543e-01   +7.006732360490809e-01   +2.613458842796718e-01   -5.725548810694109e-02   +5.770104786444441e-01   +1.000000000000000e+00; +5.000031591439542e-01   +5.673300327490503e-02   +1.525737987162404e-01   +3.739524916458785e-01   +5.094355977709612e-02   +4.003271702089484e-01   +1.760033080624764e-01   +8.189403495444003e-01   +4.139005323475389e-01   +7.465712831603475e-01   +6.719195673293833e-01   +6.029745960020469e-01   +4.335127843783201e-01   +2.991319308244564e-01   +1.598439813740929e-01   +3.338307026106645e-01; +4.848314882060083e-01   +1.437240887830798e-01   -3.201496651521531e-02   -2.095766739265148e-02   +6.576715605288860e-01   +5.035902353844989e-01   +6.880862908813410e-01   +8.952460853313252e-02   +4.438513139644735e-01   +7.781827654680762e-01   -6.388025800469277e-02   +6.691220669391528e-01   +1.759917929981732e-01   +4.360621732875166e-01   +1.559917701252589e-01   +6.402924592993428e-02; +4.563215768767136e-01   +7.223073175915769e-02   +6.906532482802554e-01   +8.793558078323004e-01   +6.069266162083615e-02   +4.702028715933058e-01   +1.223809982313264e-01   +7.134519308185182e-01   +2.833139125992508e-01   +9.551461703567755e-02   +7.786850377124375e-02   +6.706558239992371e-01   +5.602628345703305e-01   +7.194422900569876e-02   -2.624162928287760e-01   +4.590390712196512e-01; -3.196573165656950e-02   +6.084173220896890e-01   +2.444902200963262e-01   -1.830426879612893e-02   +7.332516668563303e-01   +3.815968088032157e-01   +3.614278683122206e-01   +2.891012890417134e-01   +1.142475822595763e-01   +5.710026238029065e-01   +1.133205640038259e-02   +5.645346168922537e-01   +9.080860267810277e-02   +3.483155566708185e-01   -7.783936230319281e-02   +3.181318955569850e-01; +3.778541270842108e-01   +3.512038247872186e-01   -9.602962570248523e-02   +5.229461357603198e-02   +6.152186711168994e-01   -3.022082316841766e-01   +4.010167317931362e-01   +8.523069473178543e-01   +8.726068960207896e-02   +4.837338101514471e-01   +1.905435605427736e-01   +5.261007222568234e-01   +2.541780462191310e-01   +2.559284575597297e-01   +5.165370287250713e-01   +6.371134669943116e-01; +7.760904322603951e-01   +4.367235413021596e-01   +5.675624887451000e-01   +6.452177963535292e-01   +4.735111781683429e-01   +2.459728659435788e-01   -2.690844960872016e-02   +2.298305435094553e-02   +5.818923369115070e-01   -1.999754806778947e-02   +4.602122720578474e-01   +6.002282282201621e-01   -1.115219331107119e-01   +7.710173625680126e-01   +2.627468348466491e-02   +3.575756028935598e-01; +5.817341337763272e-02   +3.999501072851597e-01   +1.074420926195982e-01   +8.546056618197121e-01   -2.140613380153445e-01   +2.199348827839789e-01   +1.382059288291630e-01   +3.581460203237203e-01   +8.793928929578469e-01   +3.630617458223516e-01   +6.552327336145215e-01   +8.058545971072765e-01   +2.009393882866044e-01   +5.431504693954020e-01   +3.496838438063121e-01   +1.808585680768112e-01; -7.460633407619591e-03   +6.284069183322891e-01   +3.622381216908139e-03   +6.564531707402682e-01   +7.578021072525011e-02   +4.738261115546548e-01   +3.953532111959018e-01   +5.371399794078304e-01   +3.277344278200292e-01   +6.643489510763084e-01   +2.120075837208818e-01   +2.114039212921184e-02   +2.530900204100327e-01   +2.017517401019166e-01   +1.297040833795431e-01   +5.083050296555818e-01; +7.650856416165067e-01   +6.892940794299336e-02   +5.663687148059372e-01   +5.647481570954369e-01   +3.798561808973657e-01   -4.948699659464912e-02   +4.075584349539614e-01   +8.936274332379487e-02   +7.140994699153974e-01   +8.628839916961123e-03   +4.036220307148153e-01   +7.039465988020466e-01   +4.310676955004645e-01   +5.576497579013185e-01   -1.293825125456773e-01   +3.941790290158526e-01; +1.434195432418889e-01   +2.621757538820936e-01   +9.950335822078497e-02   +9.396125639571007e-02   +3.983648022793088e-01   +3.551410938254663e-01   +6.515134231950858e-01   +7.004010553157430e-01   +7.221935545187956e-01   +4.653877461456404e-01   +5.709732626907753e-01   +4.947382715192760e-01   +1.926598969030043e-01   -8.303174666993186e-02   +2.794182930839008e-01   +2.093860388455469e-01; +4.852346728709953e-01   +5.554277039919459e-02   +6.813731225779132e-01   -2.261982346039718e-02   +3.564511058573688e-01   +5.891812375771230e-01   +3.788923096081245e-01   +2.791054927550009e-01   +5.849663133707054e-01   +6.654178850727510e-01   +6.686865874579914e-01   +2.909334283459449e-01   +4.092433968844932e-01   +1.162849299616094e-01   +6.073783311085556e-02   +1.007810666045343e-01];
L2I_L1I_iGABA_netcon = [+1.423728400242021e-01   +5.502238538504969e-01   +7.326282058996707e-01   +4.455530307854235e-02   +6.108002385742172e-01   +2.235181624778027e-01   +3.526637529310883e-01   +5.805065656398668e-01; +2.498481688924175e-01   +3.467400510699649e-01   +3.570412342403464e-01   +1.986564177404067e-01   +6.615067528046978e-01   +8.884580720615097e-02   +4.476334014159709e-01   +7.689388056003050e-01; +3.602039414587014e-01   +5.081938685459462e-01   +5.199080961884696e-01   +7.108488617702999e-01   +4.007621915334042e-01   +4.292535116666681e-01   +2.382999115691317e-01   +9.794954296304931e-02; +4.155529178248235e-01   +2.834249446825109e-01   +5.997714042646455e-01   +7.735973901925197e-01   +2.210600642962750e-01   +7.670253608830312e-02   +3.925706671473161e-01   +2.599794982310742e-03; +8.730752114607468e-01   +1.751398007038982e-01   +1.949594604152485e-01   -1.380336588448766e-01   +5.649921685687708e-01   +1.460090292776401e-01   +9.336604338724444e-01   +7.625694824055368e-03; +4.772303016797995e-01   +5.558980684453305e-01   +7.435430437917603e-01   +7.809462193278912e-01   +7.017332528971003e-01   +5.989853927623965e-01   +5.143700211802639e-01   +5.675169441566367e-01; +8.376973228251937e-01   +3.871987682520218e-01   +3.433424229872922e-01   +1.097371146992138e-01   +8.940979382165887e-01   +3.360587526754226e-01   -1.608594863492243e-01   +4.931044545681038e-01; +6.086786719270065e-01   +4.462747985797785e-01   -1.395095322115348e-02   +6.654576354343232e-01   +5.506766230335162e-01   +7.550775934222808e-01   +5.678221843052781e-01   +1.281572325314290e-01; -2.629342536628443e-03   +5.519954046232636e-01   +1.650611699522448e-01   +3.476783863257148e-01   +4.080695159995920e-01   +7.649593084443037e-01   +3.590839901232811e-01   +2.558266346830924e-01; +7.098257115007337e-01   +9.037873955522630e-01   +4.711976543672354e-01   +4.928107783359630e-01   +3.985415515602090e-01   +1.764556028618016e-01   +4.465960025261447e-01   +1.523575749989796e-01; +3.823771940927495e-01   -9.290355773626857e-03   +6.932801969910573e-01   +5.509027266117270e-01   -1.120618175670533e-01   +3.388351927848310e-01   +4.438359927921491e-01   +6.065509446473059e-02; +3.603015400679887e-01   +1.104995155498654e-01   +2.992024391096276e-01   +6.215122141456304e-01   +8.825382363306231e-02   +5.063921402188554e-01   +3.399195502384576e-02   -2.227040409882717e-02; +6.758710795676182e-01   +9.522923017518810e-01   +2.861164109593318e-01   +4.445317493780965e-01   +3.025321550722019e-01   +1.947936866342902e-02   +6.012218580575140e-02   +6.144713250998434e-01; +2.848341251579185e-01   +7.193427946672070e-01   +1.092698518308424e-01   +5.692621162012472e-02   +6.090437846869300e-01   +6.417976989932885e-01   +6.183324178925630e-01   +5.300968571382204e-01; +2.712163680936647e-01   +5.061741778410992e-01   +3.439627093422131e-01   +1.990503045717890e-01   +5.592956874603722e-01   +1.776960595487947e-01   -1.223011136817014e-01   +6.457994513314116e-01; -8.192526396934308e-02   +2.139011804587983e-01   -2.530705098104463e-03   +5.513194295931168e-02   +3.173505997600110e-01   +7.326955795924073e-01   +2.414481645821711e-01   +3.766365758499929e-01];
L1I_L2I_iGABA_netcon = [+1.203112719183983e-01   +7.444037800809539e-01   +3.585859690298847e-01   +2.342366216715779e-01   +8.422876029094033e-01   +9.113359151322827e-01   -1.925763345026196e-01   -2.473864273524196e-04   +2.865505293321337e-01   +5.145307053838585e-01   +6.070013726395770e-01   +4.497955230158218e-01   -1.567779429262874e-01   +5.113629820242019e-01   +2.598874487043555e-01   +6.754766622464685e-01; +5.834633736562037e-01   +6.380223228201820e-01   +4.756468333270987e-01   -3.804200973610075e-02   +5.612233783401073e-02   +2.248335293287919e-01   +3.862905137047880e-01   +1.581277551225002e-02   +1.432325764596569e-01   +1.285140740767475e-02   +2.857421429999728e-01   +2.488554608856873e-01   +7.344025641716868e-01   +4.763480763948244e-01   +9.752240041738668e-01   +7.445936244072499e-02; +3.633416959258705e-01   +4.849503664100722e-01   +7.972720329897254e-01   +1.552919797832663e-01   +1.140512267376685e-01   +1.142844565698929e-01   +7.714780917999023e-01   +3.804179740945302e-01   -1.951756790841419e-01   +8.374997033182453e-01   +1.676413188380048e-01   +4.354814248255872e-01   +4.725465702923934e-01   +5.730606008606801e-01   +2.470483404982850e-01   +2.245049307977998e-01; +6.642494868791942e-01   +4.506076383027689e-01   +4.542567939419201e-01   +3.525458639595082e-01   +7.376203807065904e-01   +3.514406415859775e-01   +2.604288175513829e-01   +1.704729795358921e-01   +4.935976345668329e-01   +3.893047297735128e-01   +2.299366232076602e-01   +2.633527954731828e-01   +3.308147364084654e-01   -2.190327340281444e-01   -1.111792737878018e-01   +3.756064243148591e-01; +5.886173378436598e-01   +6.388552661289759e-01   -2.203096254463076e-01   +7.635974147943014e-01   +4.158691982867685e-01   +2.985677142362212e-01   +3.198899591567471e-01   +5.053079994113861e-02   +8.060138369037601e-01   +6.767306187618813e-01   +8.045446698977065e-01   +8.136611809566829e-01   +7.060618892413433e-01   -1.228441918056220e-01   +5.660636354343287e-01   +6.201108925836502e-01; +4.116981758321052e-01   +1.877847238576717e-01   +5.754188753749387e-01   +8.104201573923506e-02   -3.560009615661090e-02   +4.090216742451138e-01   +5.522418193507723e-01   +5.987143556655335e-01   +5.874043417742291e-01   +5.279636839631354e-01   +6.768665499925571e-01   +4.919181025342413e-01   +5.295610080028161e-01   +3.798139697828842e-02   +4.592883567796299e-01   +4.966576465221300e-01; +3.054605838202338e-01   +1.101414173844802e-01   +4.102444680281954e-01   +4.686768189528273e-01   +6.493667259130291e-01   +4.283681486010772e-01   +2.077844889757827e-01   +2.209600572700914e-01   +1.893134853957423e-01   +2.792193076898472e-01   +2.801226113168670e-01   +3.133210422014454e-02   +3.118829624487278e-01   +2.929919822394996e-01   +5.884933176870721e-01   +1.089679560806322e-01; +3.751409529925081e-01   +7.693873496224726e-01   +4.713621366141407e-01   +1.723927939838319e-01   +5.527553041504035e-01   +1.922777980905401e-01   -3.874315626828030e-03   +3.016631661813978e-01   +4.273273975851451e-01   +2.337425255435832e-01   +3.226941635143100e-01   +8.822495237825267e-01   +5.781913868693906e-01   +5.110902472027061e-01   +2.867788405860091e-01   +5.446448062152270e-01];
L2E_L1E_iAMPA_netcon = [+3.101391679777670e-01   +3.210592975257210e-01   +5.155110427310508e-01   +2.474243297554164e-01   +4.793494938101552e-01   +7.536086839843212e-01   +3.640381697799819e-01   -1.697405909991122e-01; +2.073765877937536e-01   +1.686671694340706e-01   +2.362693993641888e-01   -4.985916924504294e-03   +2.699146977633946e-01   +2.155814428229363e-01   +5.468203415489146e-01   +1.461459469881249e-01; +8.547670871336790e-02   +4.672950067037881e-02   +8.387009445221649e-01   +4.848233253147453e-01   +2.469540999778352e-01   +4.847997958966004e-01   -1.106138341562114e-02   +5.953775352879234e-01; -1.074751704251992e-01   +3.541844182244905e-01   +7.318290791655446e-01   +1.765997023211348e-01   +3.249816545979400e-01   +5.426560806433633e-01   +6.200099281738078e-02   +1.622383512316403e-02; +6.820371124571329e-01   +2.737065429031975e-01   +3.553511856057654e-01   +7.128070971932600e-01   +6.605083149736762e-02   +6.383921592138356e-01   +6.356768967767378e-01   +8.237342855151057e-01; +8.338147601101694e-01   +1.490718126069048e-01   +4.947421007159272e-01   +6.468777303249100e-01   +4.746809172627469e-01   +8.113030930074530e-01   +6.899854929155874e-01   +6.518025307192258e-01; +5.560365341384895e-01   +5.856045241828035e-01   +7.490388434048196e-01   +1.572639946174279e-01   +3.436638927192689e-02   -1.943232410611795e-01   +3.858791294840507e-01   +8.776111985910713e-01; +5.700061952527498e-01   +8.943652648430775e-01   +5.845877006978130e-01   +4.398775473597308e-01   +4.838096873959172e-01   +7.495016559822070e-01   +6.216001242576407e-01   +6.119577455288631e-01; +1.531482390337575e-01   +4.162162089119829e-01   +4.909977440578498e-01   +4.699361383062061e-01   -1.209423869081433e-01   +5.025498931117800e-01   +5.973808480963501e-01   +7.208964200887654e-01; +1.286903525569761e-01   +8.313488759105866e-02   +3.566398718132517e-01   +2.152685964855414e-01   +4.431806756258306e-01   +4.406326935963459e-01   +3.090345774405423e-01   +4.147680599694058e-01; +3.233809781590130e-01   +9.178297591074361e-01   +3.813247984364108e-01   +3.388733477792391e-02   +4.781576889163466e-01   +6.905461334674037e-01   -1.196134992586479e-01   -3.003809980944061e-02; +1.058318484601095e-02   +4.339211633164501e-01   +7.339191508089002e-01   +1.066650224948182e-01   +1.488214098380636e-01   -7.881234207847468e-02   +5.230205425736431e-01   +2.852451383920671e-01; +1.931600490002434e-01   +4.985710511599110e-01   +9.376671792614311e-01   -2.210419246064136e-01   +4.288005314656883e-01   +2.042569908314672e-01   -1.332958850543876e-01   +6.676305405583346e-01; -1.392824296053445e-02   -2.233851948121801e-01   +1.910457281263378e-01   +3.407461016724891e-01   +5.698267621066090e-01   +7.854972154756776e-01   +4.455593247633004e-02   +1.723809819848694e-02; +3.849087166132211e-01   +5.685336773446402e-01   +1.921709588534393e-01   +3.990373232302500e-01   +3.752116019995032e-01   +3.194064525403535e-01   +4.084488736842517e-01   +5.445840404210236e-01; +4.162404253913612e-01   +5.270136308622977e-01   +1.921493555925763e-01   +2.507330229918168e-01   +1.185382507392043e-01   +4.165421686124886e-01   +2.701704745429303e-01   +3.298911103508714e-01];
L1E_L2E_iAMPA_netcon = [+5.686310183660153e-01   +3.822054195299408e-01   +2.605043241922008e-01   +7.693068642227389e-01   +8.941243172598572e-01   -2.395549335408484e-02   +2.608652070675235e-01   +7.606491612936832e-01   +2.558705548548245e-01   +2.858658321548096e-01   +4.875622862205770e-01   +9.132378723647780e-01   -1.093671350416878e-02   +4.871201750647502e-02   +8.225434890413147e-01   +1.601054043825826e-01; +8.829004991477196e-02   +2.433448523921896e-02   +5.727997012251995e-01   +5.333348998492700e-01   +2.900173264910274e-01   +7.916897283866466e-02   +2.438227546726380e-01   +1.507519450136414e-01   +5.550837337525014e-01   +9.777733519895803e-01   +6.337963929538185e-01   +2.135610725112022e-01   +9.402428052724940e-01   +8.234485350495295e-01   +3.075783485001266e-01   +4.466703252921127e-01; +3.538584086289055e-01   +8.075703376244373e-01   +3.005630720526135e-01   +7.507348201697603e-02   +6.281088850365399e-01   -3.765623812837222e-02   +7.901463566498077e-01   +6.637148767455734e-01   +6.524906235410483e-01   +3.020271530864355e-01   +7.187280181155371e-01   +2.800843349286208e-01   +4.927744118333272e-01   +3.721876314978008e-01   +5.724151820609589e-02   +4.189437304745264e-01; +8.932139396273350e-01   +1.906870150840949e-01   +3.061717948492383e-01   +1.825271399765805e-01   +1.956500325955363e-01   +3.123981065645537e-01   -3.764913699546636e-02   -4.179481633050416e-02   +9.548478713464745e-01   +4.219763616651520e-01   +4.236124495824704e-01   +1.973761731793889e-01   +3.537829552063289e-01   +6.667409817316459e-01   +6.522481144908048e-01   +4.306938722053869e-01; +5.392362712313900e-01   +1.467263760739079e-01   +3.044785927373184e-01   +3.419380145810852e-01   +3.183728465382090e-01   +6.625649408882180e-01   +1.518859307677430e-01   +4.324876360345945e-01   +3.882324165607484e-01   +2.545715845082703e-01   +2.659921304127061e-01   +2.696488092786403e-02   +4.579306697355888e-02   +6.950279493879615e-01   -2.979989441676630e-01   +6.849674699300361e-01; +9.473200007589071e-01   +2.755891407352698e-02   +3.248459508755122e-01   +6.044740320029086e-01   +1.736880719341614e-02   +1.087762384779477e-01   +5.192985511583948e-01   +2.846315623821153e-01   +5.925355038168846e-01   +2.103613424498670e-01   +2.544293376187060e-01   +6.615304500229768e-01   -8.100616382093792e-02   +1.294379569881232e-01   +2.508016448712861e-01   +6.911639667433261e-01; +3.095247979501270e-01   +8.134632886785281e-02   +4.860526909590612e-01   +2.891784403855203e-01   +9.851972097048957e-01   +4.468185247822049e-01   +6.004127274463446e-02   +6.038249159049709e-01   +4.519037316455734e-01   +7.850515154117133e-01   +5.161526764553024e-01   +2.077058275457833e-01   +6.571768606557715e-02   +1.835013600141560e-01   +6.205006470821185e-01   +2.327544431708317e-01; +3.421756610500789e-01   +2.998477375242165e-01   +8.624778601394122e-01   +5.549198731275067e-03   +9.253782005238358e-01   +1.736182531514056e-01   +2.823494922054516e-01   +2.036466669786635e-01   +1.651125803205907e-01   +7.439874409217836e-01   +3.698052687224329e-01   +1.482592786971953e-01   +8.676235456010891e-01   +6.439086390631659e-01   +3.101107468511290e-01   +3.483861658407938e-01];
L2I_L2E_iAMPA_netcon = [+4.266739750945408e-01   +9.131099583492694e-01   +3.441844082481143e-01   +6.056661921288581e-01   +7.863864704885152e-01   +7.488049508182948e-01   +6.430033199976222e-01   +3.376083656739612e-01; +9.576878843784776e-01   +3.259449419500841e-02   +2.861262106725679e-01   +1.366503651616276e-01   +6.310482835235129e-01   +2.520637699567427e-01   +2.388172133022322e-01   +6.749760248256791e-01; +8.967754672094905e-01   +3.450246561225022e-01   +6.544825114418160e-01   +4.999574445299458e-01   +4.029175388476206e-01   +5.669709935786703e-01   +1.410620302132091e-01   +6.989997990492426e-01; +3.796491295397828e-01   +7.351131064766168e-01   +3.469507761926213e-01   +2.159766676059713e-01   +4.032448819085369e-01   +1.004208492334113e-01   +2.658077543548443e-02   +4.850665990445630e-01; +3.866942744031496e-01   +3.792262767293856e-01   +7.064515115533651e-01   -1.127957857757541e-01   +7.597294273462376e-01   -9.309852412850253e-02   +7.206212330581907e-02   +4.507126286016280e-01; +1.536284248310195e-01   +1.106176049610211e-01   +5.553275780707394e-01   -2.325086275898498e-02   +5.234908754392094e-01   +4.750305510282186e-01   -1.998182327093734e-02   +2.896361283153786e-01; +3.546832306051265e-01   +1.866817591938401e-01   +5.035337229410477e-01   +6.225252061108666e-01   +2.235194146047862e-02   -1.188625428215815e-01   +3.699864065392449e-01   +6.512435855283407e-01; +5.470004322864874e-01   +5.044970366211176e-01   +4.571914038133814e-02   +6.801776120331724e-01   +1.080048745584506e-01   +8.096248085142949e-01   +3.591644370763827e-01   +7.171332849292346e-01];
L2E_L2I_iGABA_netcon = [+1.463429475400603e-01   +3.225538807069454e-01   -3.491800694671237e-01   +9.266144964791315e-01   +3.516701450097528e-01   +8.135749870192497e-01   +5.738945651705910e-01   +1.956003267221138e-01; +4.404456435788009e-01   +7.172780071956542e-01   +2.429728499440401e-01   +3.254526225732071e-01   +5.306109389717060e-01   +4.956413551686663e-01   +3.071984482881270e-02   +6.991037830069652e-01; +3.968649228791471e-01   -9.647584661100982e-02   +4.086658356015508e-01   +4.171576972031631e-01   +2.557523475748493e-01   +2.737808897665996e-01   +1.665682488180264e-01   +4.695399269733532e-01; -3.721094682895761e-02   +6.613639159325997e-01   -4.434036907090704e-02   +8.216649798263993e-01   +2.821380509725896e-01   +4.970798085080497e-01   +8.137518221601233e-01   +8.476225230700694e-01; +3.546045804701959e-01   +4.338416814163918e-01   +2.676816397067358e-01   +2.921230381711194e-01   -9.619623035581741e-02   +3.221808037214990e-01   +2.124764463330061e-01   -1.365353489373874e-01; +6.010912690871252e-01   +7.974043312277341e-01   +1.000000000000000e+00   +9.953507892902179e-01   +6.544834916579387e-01   +4.581880853344364e-01   +2.190153899881053e-01   +5.311500931724196e-01; +1.657449662234226e-01   +3.002489448427457e-01   +1.715848842959906e-01   -7.311820071390916e-02   +3.486201843148758e-01   -8.720394418520049e-02   +1.755184496396003e-01   +5.795155524448485e-01; -3.610544991522441e-02   +7.596489761915086e-01   +2.976667691545797e-01   +1.540340699253221e-01   +5.326139900077662e-01   +2.756505845717397e-01   +5.179397031987847e-01   +7.472846935702305e-01];
L3E_L2E_iAMPA_netcon = [+3.956117127989714e-01   +3.192619770217766e-01   +5.474649070318799e-01   +1.060222311203261e-01   +4.003754802950704e-02   +7.763467277507445e-01   +6.947557813190598e-01   +5.865491535619211e-01   +3.900399515236168e-01   +2.385506829153581e-02   +3.272071967555806e-01   +6.014639408613921e-02; -1.180661428817916e-01   +6.320470562585856e-01   -1.188516128625232e-01   +1.193267520237427e-01   +3.097745936054855e-01   -1.294018070817492e-01   +4.789648563185156e-01   +2.433873033041249e-01   +2.764097910652941e-01   +2.366755901347044e-01   -9.359959945331955e-02   +2.298401977547233e-01; +2.638170632682565e-01   +1.798603282892732e-01   +8.287296751766184e-02   +4.467992284563502e-01   +3.475703101559059e-01   +5.679219861208650e-01   +5.792025474498848e-01   +6.349056161606530e-01   -7.319173432466726e-02   +5.921442329299865e-01   +4.203205842018162e-01   +8.057510352014141e-01; +6.629133099284454e-01   +5.776520442729505e-01   +6.866673849988328e-01   +3.868872967635836e-01   +4.239618368128781e-01   +9.127576596646653e-01   +2.642515692381797e-01   +1.816169098940675e-01   +5.003246478696257e-01   -3.664735825131357e-01   +3.000477197842692e-01   +7.578498028036854e-01; +4.653593888573153e-01   +3.989844038328557e-01   +3.030696834004964e-01   +2.549239480029607e-01   +1.064750317548959e-01   +4.053881090972556e-01   +2.613123305502198e-01   +6.501971321856828e-01   +8.351503628143930e-01   +4.006087295750123e-01   +6.498906606612322e-01   +1.520198447395548e-01; +2.545794948151342e-01   +8.112269732220620e-02   +4.855476548152531e-01   -1.792366591155346e-01   -8.174737566934197e-03   +4.430815502182641e-01   +3.728152751196475e-01   +5.690355472881382e-01   +3.868165574173152e-01   +4.995081594166081e-01   +2.494489366154015e-01   -1.361531496100538e-01; -4.165474426353601e-02   +1.930685376457942e-01   +1.836624498337839e-01   +3.880484201085596e-01   +1.000000000000000e+00   +7.048869590600003e-01   +6.315956043292956e-01   +5.136644652642119e-01   +5.734052827217374e-01   +2.189900386547525e-01   +2.033121149963198e-01   +4.940180680543671e-01; +3.216556294388875e-01   -4.306707051809198e-02   +4.381669522146362e-01   +6.661575529157459e-01   +3.091369065554494e-01   +4.859881957549677e-01   +6.300958108139696e-01   +1.799089125894902e-01   +6.005172043374823e-01   +3.535080690566044e-01   +5.022073385238403e-02   +1.248932125297211e-01];
L3I_L2I_iGABA_netcon = [+6.064566962120015e-01   +2.671312282739004e-02   +2.793153530262933e-01   +5.575125338645963e-01   +2.677117223503536e-01   -6.545517211175794e-02   +1.827698158874228e-01   +3.949759817682061e-01   +2.761985187944304e-01   -2.439760598234957e-02   +6.875908117036397e-02   +8.057473559269228e-01; +7.927185212870509e-01   -2.462573699716799e-01   +7.200579380806496e-02   +4.154710211873407e-01   +8.355011592127561e-01   +3.174939885235114e-01   +4.816131838397082e-01   +5.584361392722205e-01   +2.017231494644623e-01   +3.595753424898711e-01   +1.549910883794905e-01   +3.841644371798985e-01; +5.989927110994684e-01   +4.646032242188017e-02   +5.798001912826503e-01   -1.489780938879297e-01   +5.413429532177036e-01   +1.882502397178170e-01   +4.655850310768671e-01   +1.393527775629575e-01   +2.667430673351315e-01   +4.584386209964449e-01   +2.385945644396960e-01   +8.897069518641217e-01; +3.209615546651222e-01   +2.836378895625180e-01   +7.275873002948121e-01   +9.086642473035330e-01   +3.064150154538741e-01   +8.541532940617408e-03   +6.123590864793995e-01   +1.456988689761450e-01   +7.599799389100151e-01   +1.792256227645566e-01   +1.683993636449848e-01   +5.145633968142732e-01; +3.125336638271957e-01   +3.683621057630125e-01   +4.666086184132631e-01   +1.441728097241476e-01   +5.185543062992383e-01   +5.378627724390740e-01   +4.436368391572932e-01   +2.263932566433840e-01   +2.428801377560568e-01   +2.295674069382661e-01   +8.436555532000735e-01   +8.983583208994797e-02; +5.186433218531911e-01   +9.134174500919293e-02   +7.139337174344546e-01   +7.331380843942519e-01   +6.861468225355303e-01   +2.343530870712662e-02   +1.847351256609795e-01   -7.460206754527431e-02   +2.348680457045202e-01   +8.501552079154902e-02   +2.105162991469708e-01   +3.405315925881242e-01; +3.093817846408279e-01   +5.826939199900782e-01   +7.816860506112137e-01   +1.439709218226642e-01   +1.918466590404235e-01   +4.768417728000103e-01   +3.449886268250951e-01   +6.034118349105934e-01   +2.240276870610051e-01   +8.667504330394743e-01   +4.037435319384781e-01   +6.741866444488533e-01; +1.254436596024769e-01   +1.094136026320185e-01   +4.726471670112613e-01   +3.776732597169482e-01   -8.923994393167169e-02   +7.509668102214258e-02   +1.580976942249031e-01   -9.222015720148460e-02   +4.672082521841153e-01   +3.661356098288986e-01   +2.447357992045576e-01   +2.652348360829121e-01];
L2E_L3E_iAMPA_netcon = [+1.403320061846543e-01   +9.034140439289777e-01   +4.202620801045039e-01   +7.655911053208320e-01   +3.216996675223357e-01   +6.670587067030127e-03   -1.665273696360006e-02   +3.665537331279800e-01; +3.134833218785322e-01   +5.766344726102348e-01   +4.272368129861461e-01   +2.520623593475330e-01   +1.330316668938282e-02   +3.707253905407633e-02   +5.074538908358236e-01   +3.706453973388867e-01; +3.612501357773765e-02   +8.120741261840940e-02   +8.367467483928784e-01   +8.320945043451121e-01   +5.317975229887208e-01   +3.868084574162389e-01   +2.851877878062091e-01   +5.163196348830185e-01; +2.581395180589121e-01   +3.352510907714265e-01   +8.257095658138877e-02   +6.717787657126673e-01   +4.687118028937495e-01   +6.116352466408943e-01   +4.268345918791482e-01   +2.944623901393847e-01; +4.183588297557516e-01   +7.446965418256772e-01   +6.808604211377097e-01   +1.000000000000000e+00   +6.244960147136425e-01   +1.184492559732105e-01   +1.461915575663948e-01   +9.548177064404771e-01; +9.169496956117849e-01   +6.990249081135328e-01   +1.536295637674452e-01   +9.441562355989415e-02   +4.085515328031673e-01   +5.476851116808883e-01   +4.710502011956026e-01   +7.218540895343505e-01; -1.445559899784988e-01   +4.340205809757535e-01   +7.845769769047303e-02   -1.043280520877354e-01   +2.744143915666876e-02   +3.352149144885688e-01   +2.607688545929974e-01   +1.632775900215151e-01; +6.199879915578018e-01   +8.219081753020969e-02   +8.345822709030177e-01   +1.393683419568109e-01   +1.102618172193566e-01   +1.986629093887966e-01   +4.244592881552608e-01   -1.518408563735980e-01; +2.757976372211703e-01   +6.178172287520258e-01   +4.702016390499867e-01   -2.905094580737519e-03   +4.003041810622773e-01   +1.303316516105385e-01   +4.232352278389511e-01   +7.638178590893059e-01; +3.523259296435725e-01   +4.481917078312343e-01   +2.632278279336583e-01   +3.671283105554175e-01   +4.443961577766500e-01   +4.320598708318023e-01   +8.160955974974868e-01   +4.017787366985845e-01; +3.957962534581356e-01   +4.251458156189558e-01   +5.980252784652698e-01   +2.702906627923461e-01   -2.654669077134297e-02   +6.940324067210760e-02   +6.146828683686087e-01   +2.890066445682692e-01; +6.333142289835069e-01   +4.012775170757223e-01   +5.998605361036590e-01   +5.526700896216854e-01   +2.825207030734404e-01   +6.043185102980030e-01   +3.865999397347366e-01   +5.303945500461804e-01];
L2I_L3I_iGABA_netcon = [+4.576816407404143e-01   +1.505215287496252e-01   +6.792739853140876e-01   +3.508254184138873e-01   +3.179034332974870e-01   +5.209253893814445e-01   +6.369844008572728e-02   +5.136094248771816e-01; +1.267765307925055e-01   -5.853549734510644e-02   +7.222426757385911e-01   +5.410056258482429e-01   +6.008952168410806e-01   +4.785928059766387e-01   +8.756288068893443e-01   +5.374448292413091e-01; +2.413967313105858e-01   +6.613203327838159e-01   +7.920822895865307e-02   +2.699541457092929e-01   -4.324173680467618e-02   +7.226599510045689e-01   +2.914110912241975e-01   +5.187469074134134e-01; +3.893246653979524e-01   +4.593792474415229e-01   -1.496558611187771e-01   +3.234562237972807e-01   +5.777485301840634e-01   +9.675065483638962e-02   +2.670795145543982e-01   +3.096713090398387e-01; +5.494240138434188e-01   +1.586839214078513e-01   +3.819200968186005e-01   +6.690135462305820e-01   +2.931503164767175e-01   +4.716410387017468e-01   -1.666921786259148e-01   +2.210878299287005e-01; -3.615127485571512e-01   +1.427644895033195e-01   +3.762357014499420e-01   +5.584540658271632e-01   +6.598234036437466e-01   +6.124432007136318e-01   +5.266473653680666e-01   +1.324255680217743e-01; +2.029430425427015e-01   +3.285340340324747e-01   +2.068091035094777e-01   +4.979589761591081e-01   +1.227068147360358e-01   +7.187811542066276e-01   +7.518982450332213e-01   +9.803375102316834e-01; +3.718898425621706e-01   +4.297555266097478e-01   +1.633262298619332e-01   +2.323704279362822e-01   -2.331587858956187e-01   +2.552878696810844e-01   +2.508593729825517e-01   +9.504426040010489e-02; +4.020741940556281e-01   +1.339735470871124e-01   -8.716330262829239e-02   -1.371600379498656e-01   +4.321138612019958e-01   +2.728818336274804e-01   +1.859660471085729e-01   +2.747270101725720e-01; +5.713378391209627e-02   -2.323050302643651e-01   +5.848819850436161e-01   +4.708658560117755e-01   +7.313775739873627e-01   +7.247804438193227e-01   +5.024472622770993e-01   +2.423169921481302e-01; +3.315545004519996e-01   +3.384193590394779e-01   +7.840213975785961e-01   -2.426586349587177e-02   +5.727540312350320e-01   +3.837239994181074e-01   +4.661852069360035e-01   +1.950545879357445e-01; +5.776789771174552e-01   +1.238386800759961e-01   +2.085867548072361e-01   -5.214308711311168e-02   +4.262321601632114e-01   +8.871689183322455e-01   +2.097535622784188e-01   +4.218230037203521e-02];
L3I_L3E_iAMPA_netcon = [+2.485866980308024e-01   +9.249810317674931e-02   +3.505193385042499e-01   +6.794227654667356e-01   +6.640219310053876e-01   +1.880360448435820e-01   +3.024882479696537e-01   +7.246299917604315e-03   -2.065704417618844e-01   -4.798468108597898e-02   +4.275755953727983e-01   -1.838069995648145e-01; +2.510919054516184e-01   +4.680337232529729e-01   +4.130093416450533e-01   +3.722132687266323e-01   +1.634013371900708e-01   +2.163185962232033e-01   +3.464049088622729e-01   +5.335209435939447e-02   +2.764463670968251e-01   +2.682380570318937e-01   +3.402237569356936e-01   +7.497600628000448e-01; -6.630794532957754e-03   +7.199693755360077e-01   +5.560089919954415e-01   +2.171519565843386e-01   +3.316392175381725e-01   +2.665729484501281e-01   +2.766611970424597e-01   +2.223010630352542e-01   +2.232594634139935e-01   -2.595717246003341e-01   +7.295375838389770e-01   +2.677163320161319e-01; +4.110660224520359e-01   +1.292574231599742e-02   +4.507873274423621e-01   +1.703844212506469e-01   +6.903448417802895e-01   +7.882709903235806e-02   +2.771318612309832e-02   +2.770157149061267e-01   +5.000146931486181e-01   +3.392299790953176e-01   +4.265282591153103e-01   +1.919032748767225e-01; -1.170621847495686e-01   +8.163594768836303e-01   +3.746012488747021e-02   +2.446391438235820e-01   +5.870829302283175e-01   +2.709385970963293e-01   +1.945135265669975e-01   +1.968559300620638e-01   +6.524322326826125e-01   +5.868746877601212e-02   +4.200977229453917e-01   -3.299683314686658e-02; +8.752721861547244e-02   +2.906814522779753e-01   +6.905729376962926e-01   +4.222720579909096e-02   +2.755504167927924e-01   +4.079592330474051e-01   +2.080732921973614e-01   -2.446242349568183e-02   +6.164145303947590e-01   -1.310016778568208e-01   +1.859671349617791e-01   +8.406810735239705e-01; -7.339796244983364e-02   +8.450268340242952e-01   -2.161861107631049e-02   +4.626850878786777e-01   +3.923516307738747e-01   +4.344834207654428e-01   +3.850259561248793e-01   +9.346644302161250e-02   +7.429069876825491e-01   +7.292575252448533e-01   +1.993411929334584e-01   +6.754041306857864e-01; +9.870065155422893e-02   +5.707283982937096e-01   +5.118221413294745e-01   +4.938928084034563e-01   +9.189373346751361e-01   -5.330088305046884e-02   +9.097407543090092e-01   +1.095468696338653e-01   +8.001749514134017e-01   +5.945814190006958e-01   +5.798772444736975e-01   +4.288201740199802e-01; +5.943315112702252e-01   -1.289834663272826e-01   +8.948482797133216e-02   +6.013547952490937e-01   +7.218486030866685e-01   -8.971143530505186e-02   -2.492281376015806e-02   +4.792744115544650e-01   +5.130945334988450e-01   +1.000000000000000e+00   +4.973382422824530e-01   +2.547122020244823e-01; +5.574553538232916e-01   +5.440312486991770e-01   +3.781213145238402e-01   +4.979204201899520e-01   +1.995831436045347e-01   +1.325270117998860e-01   +6.919617889395040e-01   +5.842253645873120e-01   +3.197980308974765e-01   +8.283997586779773e-02   +6.676906617791235e-02   +3.814874387123994e-01; +2.354135829504159e-01   +5.905457498346010e-01   +9.344478295801890e-02   +4.961622588739920e-01   +6.748507152811465e-01   +7.513759204412225e-02   +4.883067152969557e-01   +7.702182536137671e-01   +1.278952854974729e-01   +3.934509892165807e-01   -2.156970859828778e-02   +8.461651981872759e-01; +4.115295143945946e-01   -6.472909027648101e-02   +4.678835094104733e-01   +7.609237414041677e-01   +6.871725691583817e-01   +3.836818487058986e-01   +2.096934753810012e-01   +2.923214783510527e-01   +7.522561178074680e-01   +4.853887230416632e-01   +2.593406745477963e-01   +3.010513552515934e-01];
L3E_L3I_iGABA_netcon = [+9.275593480321316e-02   +5.146657636509856e-01   +4.458608762127362e-01   +5.140980927174403e-01   +7.152996060061245e-01   +4.292728208106372e-01   +5.711770732668602e-01   +8.690297682214242e-01   +8.741237624877864e-01   +2.624556469135271e-01   +5.059255621284107e-02   +3.706806559319941e-01; +7.656851939225959e-01   +7.186387641408373e-01   +5.834944970629588e-01   +5.911407684509750e-01   +3.010386136467506e-01   +2.173948368193601e-01   +7.503893701398263e-01   +5.448219515467552e-01   +5.878802442387465e-01   +5.620368017825018e-01   +2.445282848926720e-01   +5.555028023268520e-01; +3.019950867667879e-01   +9.425319522971950e-01   +1.975683588943842e-01   +6.230440945776861e-01   +2.440479063352984e-01   +3.434978730792710e-01   -5.985377394683965e-02   +3.391438764937962e-01   +1.706556398235540e-01   +1.689700423516205e-01   +3.887805207265196e-02   +9.666506426925001e-03; +1.962652468155157e-01   +6.348415570368268e-02   +6.572392402836222e-01   +4.304023932581306e-02   +5.239630342972074e-02   -1.315614571748789e-02   +6.347421766190954e-01   +2.863507223955188e-01   +5.052619820715333e-01   +3.441738436263721e-01   +2.006814478749629e-01   +1.339708913959054e-01; +7.185373658485191e-01   +5.639895758739814e-01   +7.941436380141329e-01   +2.911526226500974e-01   +5.489379356189713e-01   +6.107077700736295e-01   +6.166291689641062e-01   +8.704934295940174e-01   +2.203732919457163e-01   +7.161426172719332e-01   +5.957500503753208e-01   +3.299423304214895e-01; +8.019757517256035e-01   +6.507060553310139e-01   +3.269346130330692e-01   +5.380902274674791e-01   +3.382658362137227e-01   +7.103116720963332e-01   +3.013189638244723e-01   +9.409617045874572e-01   +3.957577594580898e-01   +6.490073898987276e-01   -6.346176162281107e-02   +1.019634946424140e-01; +5.779124252564275e-01   +5.687628189025121e-01   +2.066101994003686e-01   +9.622854626370683e-01   +2.011522225016481e-01   +3.704554112647473e-01   +4.165811777271763e-01   +2.154781088629356e-01   +1.424017623233729e-01   +2.953078390340160e-01   +9.271482321172480e-01   +3.713090838277879e-01; +7.919982334245926e-01   +1.186696715270610e-01   +3.118144159773686e-01   +3.798503722036899e-01   +7.464100561209287e-01   +2.031392442530044e-01   +1.191843088607444e-01   +4.358352293722905e-01   +5.331611871092746e-01   +8.378292124256624e-01   -5.354224220411546e-03   +2.570479021925847e-01; +5.059040510667598e-01   +3.257865828572162e-01   +6.848566896429742e-01   +4.819954797525287e-01   +1.597974101784816e-01   +4.801280347649581e-01   -7.195212603413770e-02   +5.957530796645012e-01   +1.341896552485885e-01   +2.790660661153270e-02   +9.845641102175373e-01   -1.126788976888730e-01; +9.603789446879619e-02   +4.543294053499228e-01   +4.431797534842393e-01   +4.212002106799009e-01   -6.857442403449023e-02   +5.004861739688113e-01   -1.509028757412786e-01   +6.412259628745092e-01   +1.541496762736767e-01   +3.690443109325067e-01   -1.688541428379460e-01   +1.083866571256933e-01; +7.127316970837358e-01   +2.964581451818745e-01   +7.895585331957453e-01   +1.657076336876004e-01   -1.172519948815155e-02   +4.201669281921040e-01   +5.401070965685911e-01   +1.788658964866876e-01   +2.149878739546030e-01   +1.695584454038079e-01   +3.746731833983453e-01   +4.630026465411673e-01; -1.650629451992804e-01   +1.606289178060896e-01   +5.599783883496110e-01   +3.818297708542687e-02   +1.873894640986988e-01   +5.234998810680274e-01   +7.596652743515394e-01   +7.191672229383790e-01   +6.848745476844691e-02   +1.127530300472538e-01   +2.165973525954439e-01   +3.295388733459636e-01];
L2E_Input1_iAMPA_netcon = [+1.000000000000000e+00   +5.662322504905350e-01   +6.963924923732123e-01   +8.994956429455189e-01   +8.486106116598210e-01   +8.562893405574022e-01   +7.699979413213047e-01   +6.973908615551397e-01];
L2I_Input2_iAMPA_netcon = [+9.360805403151183e-01   +7.697558816101626e-01   +8.284829953590175e-01   +7.273677160692653e-01   +7.753211979988947e-01   +5.557373577836547e-01   +8.946736644966763e-01   +9.340511491606289e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last =  11.21 * ones(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))*0.4 + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.5*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.5*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))*0.9 + 0.5*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))*0.4 + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.5*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.5*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))*0.9 + 0.5*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
