function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+6.123851747275724e-01   +4.073218126404000e-01   +1.364938199445007e-01   +8.054385636841324e-02   +2.683550611604699e-01   -1.074610819801765e-01   -8.101436228990755e-02   +3.457271511155501e-01   +1.842128366326179e-02   -3.641063941014049e-01   -1.172729782188600e-01   -4.863967811711322e-01   -1.019351333600478e-01   -7.518003967357553e-02   -1.175949018062837e-01   -7.859086292660106e-02; +2.413249044698125e-01   -5.903480711520816e-02   +1.225863005706449e-01   +4.134675480820271e-02   +5.429310926050228e-02   -2.449093793753748e-01   +2.607525682630400e-01   -7.932195538547807e-02   +1.312452586743589e-01   -2.213004724307256e-01   -1.576146929183482e-01   +5.193521484425022e-02   -6.137344770924197e-02   -1.230240714071763e-01   +7.729331563229008e-02   -1.108768818381767e-02; +1.522912866288696e-01   -3.399422348316506e-01   -1.902153345454337e-02   +1.363783877904208e-01   +1.371472144199194e-01   -2.220715174501108e-01   +2.227743118961883e-01   +1.123048944593538e-01   +3.671778288624084e-01   -2.427911324132593e-02   -1.620762956925740e-01   +1.202785743410501e-01   +4.046994563259077e-01   +1.176002738279558e-02   +1.918940495835710e-01   +5.553957186907740e-01; +3.282167360639171e-01   +2.764654327305033e-01   +1.034736186971407e-01   -1.774138446795984e-01   +1.109871921562156e-01   -1.769583383739347e-01   +1.227652590176511e-01   +5.017715551381367e-02   +2.775541919307020e-01   +2.230789546077827e-01   -1.951345946449963e-01   +1.749001641275827e-02   +6.169026816161046e-02   -2.362435649788164e-01   +2.248587409930493e-01   +6.555626119738862e-02; +6.609750499868276e-02   -2.517482069919527e-02   -3.661395294981922e-01   +3.988374360211692e-01   +1.818733279715734e-01   +1.526692421328631e-01   -3.689796830993993e-01   -2.062256823552787e-01   -1.110994591968758e-01   +5.658603721978057e-02   +8.406614403433338e-02   +2.464993460179564e-01   -1.076163385195931e-02   -1.131729799636114e-01   +5.206406944023000e-01   -1.444041841040275e-01; +2.752254753297193e-01   -3.446602643289662e-01   +4.190060444071668e-01   -4.723934065913948e-02   -2.869944277417829e-01   -4.700698200765042e-02   +2.180117645753971e-01   +2.916226147255610e-01   +4.283133818766987e-01   -1.312464675238948e-01   +4.140172867525426e-01   -3.446938212445308e-01   +2.039280490309358e-01   -3.369817767321085e-02   +1.867902738899164e-01   -4.328953549590442e-02; -1.088827348463497e-02   +4.857932465877809e-01   +6.668669638807034e-02   -2.525883168015892e-01   -1.678784202784662e-01   +3.050014188678095e-01   -3.455402989445508e-03   -2.553032056942941e-01   -9.206395137154223e-02   +1.666262962085810e-01   -1.933063542791008e-01   -2.528005261482250e-01   +1.957807842959868e-01   +3.372641595068693e-02   -8.934113582591302e-03   +2.355258111437511e-01; -3.175598580229989e-01   +1.643972622705029e-01   -1.623715954949106e-01   -3.666271292131314e-02   +4.178999255732831e-01   +3.047759773461687e-01   -3.973110749313291e-01   +3.031852205881991e-01   +4.652544019046051e-01   -2.189379616348502e-01   +1.272563647956562e-01   -3.590931865364776e-01   -6.270381985870259e-03   +2.881140222904848e-01   -1.232093249499147e-02   +1.688343616040153e-01; +7.146066238913212e-02   +5.426635714317989e-01   +1.365511220805563e-02   +3.594781063154062e-01   +2.654686978105787e-01   +4.474602937216970e-01   -1.141100338836687e-03   +2.584958391918897e-01   -1.632218416767825e-01   +6.726105454933448e-02   +6.192549370059615e-02   +4.645333315578241e-02   +2.127191512008073e-01   +1.703489873727979e-01   +1.287434421879996e-01   +3.188324672817474e-01; -2.215696842423104e-01   +1.025023928102669e-01   -2.716030072545762e-01   +4.242248273668986e-01   +1.087822215650193e-01   +5.910610914140600e-02   +3.528411433312305e-01   -4.359115254150592e-02   +1.210296610115367e-01   +5.615824105138682e-02   +2.367500573536988e-01   +1.260777959306273e-01   +3.759380988225753e-01   +2.891298456580056e-01   -6.606255853804976e-02   -2.297045902001936e-01; +2.055667615626730e-01   -5.715993917428474e-03   +2.184584735972673e-01   +1.082043922810417e-01   +2.422675225723847e-01   -8.736652343570468e-02   +1.204193925224912e-01   -2.653338202911298e-01   +2.057070927017153e-01   +2.287862743965128e-01   +2.466386683151321e-01   -3.297297432442052e-01   +9.051940213361327e-02   +1.143123260682760e-01   -1.469328368230388e-01   +2.455804498916823e-01; +9.493111986202282e-02   +2.997667727947841e-01   -1.476542741498820e-01   +4.331589705639709e-01   +8.414049261861986e-02   -8.572212731876165e-02   +2.098128461498504e-01   +5.188034375585436e-02   +6.422536751464110e-02   -1.742082233558762e-01   +4.412085537842017e-03   +3.034315119147454e-02   -9.238059668138676e-02   -1.992860762462395e-01   +1.240151397869309e-01   +4.533194066160882e-01; +1.147487316334829e-01   -1.162003697508593e-01   -4.367208631045147e-01   -9.190552459958279e-02   +1.181132105653564e-01   +2.380297739446159e-01   +1.081146881076810e-02   -1.843772556558921e-01   -2.638693474078076e-01   -7.164397739344835e-02   +4.824640949953434e-01   -2.062016288204843e-01   +2.885051126043488e-02   -1.950247363284942e-01   +1.815757601576379e-01   -1.550070127426975e-01; +3.054504395716869e-01   +1.726243786022976e-01   +8.544497545610813e-02   +7.901828250687427e-02   +4.003776277531685e-01   -1.361288442929976e-01   +4.051035568166316e-01   +9.779990217657575e-02   +2.372820166401308e-02   +3.243385172882416e-01   +1.049497722019556e-01   -1.246274579740251e-01   +3.460603402196961e-01   -1.023901993501767e-01   +4.806623120863054e-01   -2.923598054946367e-01; +3.693438522046735e-01   -3.124666796664003e-01   -1.014848275827927e-01   -2.044314823598725e-02   -3.973642356050294e-02   +1.577816596269742e-01   +2.573940560517805e-01   +4.653781625391658e-01   +1.224436638932481e-01   +1.560162587451386e-01   -1.468937160580358e-01   -7.731621966318987e-02   +4.111302452146604e-01   +1.822324523970575e-01   -4.708846281006454e-02   -6.060660493614169e-02; -6.058252179874642e-02   +1.044971309952711e-01   +2.042457017152661e-01   +9.537207291651609e-02   -7.148890931324002e-02   -3.554802637639697e-01   +4.212538044556556e-01   -5.406151277099194e-02   +3.391397086051423e-01   +1.412800115854538e-01   +7.553961091137840e-02   +9.656499213769042e-02   +8.803510662424824e-02   -2.348749234011911e-01   +2.113492947262647e-01   +8.081718288731846e-02];
L1E_L1I_iGABA_netcon = [-6.345038105631376e-03   +5.101128474808497e-02   +1.782601070560047e-01   +1.262595247396733e-01   +3.762235002605414e-01   +1.599827750293930e-02   +6.136099273974253e-02   +2.542015442893315e-02   +6.918567576717087e-02   +1.527046211805426e-01   +5.455958859432102e-02   +1.744920291455601e-01   -4.042390068185447e-01   +1.387655682998626e-01   +3.196358362455352e-01   +2.951640108594576e-01; -2.673555293104042e-01   +2.408910551308652e-01   +7.387296918817915e-02   -1.246937372622002e-01   +1.309279053611036e-01   +3.985101694173639e-01   +5.541171806551679e-02   -4.324590080927163e-01   +3.776893458165036e-01   -8.293051226989355e-02   -1.365107060396924e-02   -1.698272140890652e-01   +1.296836940562140e-01   -2.972725461214076e-01   -1.864800406779686e-01   -2.342250699749293e-01; +4.523756052745710e-01   +1.597795654167296e-01   +4.571149091888810e-02   -1.903261883985520e-02   +3.963204336410994e-01   -1.313420033408184e-01   -2.891975821461748e-01   +3.682369240422499e-01   -6.907256066404149e-02   -4.466190774419309e-01   +2.907882885275345e-01   -1.190019977831782e-01   +1.770113558562933e-02   +3.577358742821654e-01   +6.708081696804016e-02   -8.452991977355130e-02; +2.058713994018489e-01   -1.587161115403293e-01   +1.415557668649043e-01   +4.853000364629415e-01   -4.069385800477877e-02   +1.913710561860129e-01   -2.005895975445783e-01   -5.423101601196980e-02   -4.775918015748291e-01   +3.612503197751602e-01   +3.475149722974983e-01   +6.988980004324999e-02   +2.857185393778214e-01   -1.938935144455486e-01   -8.378043660757992e-02   +5.167273438123982e-03; -1.104936741534130e-01   -1.100801501391087e-01   +1.532363542199836e-03   +6.782011723659914e-02   -5.304800465231532e-03   +4.333801311898971e-02   -8.084293808947149e-02   +4.063305014612958e-01   -2.435888261299994e-01   -2.336028059138463e-01   +2.423829789910439e-01   +4.394282227366086e-01   +3.996730823520746e-01   +3.215753969907371e-01   -3.654097990157724e-01   +3.652598416654461e-01; +1.302240782995970e-01   +2.612769746919837e-01   +2.365575235967387e-01   +8.475942294659544e-02   +2.727968816561734e-01   -2.342332694437722e-01   +2.666972510435866e-01   -2.762604404116208e-01   +2.632960812038185e-01   -4.583756743529576e-01   -5.077148373782857e-02   +2.328999030932501e-01   -3.377364887037383e-01   -2.790376240637693e-02   +2.758311138939196e-01   -2.962275149416815e-01; +2.539616829999732e-01   +4.145220493246326e-02   -7.613604624497650e-02   +4.216301251472013e-02   -1.533310779507153e-01   -3.643668568654646e-01   +3.026969356269826e-01   -3.788662682443874e-01   +2.983577313698664e-02   -1.598688762523517e-03   -7.861233043290509e-02   +8.529509855559446e-02   +4.545508541367592e-02   +1.353126275831308e-01   -5.053898634015764e-02   +1.291644546611720e-01; +2.395280464049094e-01   +1.705131335036023e-01   +8.128578013846911e-02   +2.840533490947278e-01   -2.588442889747169e-01   -1.157790615293026e-01   +3.235321718957170e-01   +1.437274985108101e-01   +4.836335293202153e-01   +1.888618324548925e-01   +7.591480571015125e-02   -1.586786142438460e-01   -8.991649583781655e-02   -3.389000522318836e-02   +1.019006499912644e-01   +2.190280343744856e-02; +1.145922413710501e-01   -3.268423779133219e-02   -1.550051633393002e-01   +4.113423376958513e-01   +4.183867776324531e-01   +2.424782793080127e-01   -1.117383966615927e-01   +3.873661850925557e-01   +3.980495544648594e-01   -1.696436373535343e-01   -2.581751455756451e-01   +8.313498574832778e-02   +3.487987493910569e-01   -4.516370944405415e-02   +3.121129311464024e-02   -1.295911799129240e-01; +1.456388253370075e-01   +3.880555439597494e-01   -5.077284280182620e-01   +3.076739249850614e-01   +1.929846286071273e-01   +2.602904916988211e-01   -3.446362957823692e-02   +2.070977109397760e-01   -2.088155547681020e-02   +4.146572615175210e-01   -2.326481868655222e-02   +4.624647333017508e-01   -9.862846344546452e-03   -2.178576259715551e-01   +1.138182207908795e-01   -3.555818283032505e-01; +1.299639138555768e-01   +1.613674692932788e-01   +1.240899181990345e-01   -5.108083292053053e-01   +3.894077208417763e-01   -3.164519185371216e-01   +5.506637228250910e-01   +2.533411994093790e-01   -2.835084876363277e-01   +4.120791602886908e-01   -7.105591960835794e-02   +2.338514618097252e-01   +1.872536552950464e-01   -1.844512145059419e-01   -1.717095117595963e-01   -9.117017580592490e-02; +1.734600513127701e-01   +1.422392966655218e-01   -2.474754637966019e-01   +1.699559828895910e-01   -1.011247459229238e-01   +3.939098137425873e-01   -2.852110364181179e-01   -1.276188891670660e-02   +4.102530663011486e-01   -1.803030205010209e-01   -3.467963818063834e-01   +1.303516601335476e-01   +2.740293934697321e-01   -2.197931345536674e-01   +2.858441389457253e-02   +2.723075542269215e-01; +8.360508943590253e-02   -1.012922398328301e-01   +1.251592483009637e-01   +3.032083350535270e-02   +8.055218138005579e-02   +4.668306826534077e-01   +3.160816889197167e-01   +2.694264013690074e-01   +3.228880877599880e-01   +3.477409974240311e-01   +4.748897694462583e-01   +3.587145910746588e-01   +2.701767494328326e-01   -1.354274236971624e-01   -6.380889431704072e-02   -3.384819300308804e-01; +4.259690911708109e-01   +5.964003699400659e-02   -1.108138927027793e-01   -2.352448942883709e-01   +1.763551642600389e-01   -2.186974059336236e-01   +2.448060714885878e-02   +1.524646154847135e-01   +3.058255443056017e-01   +2.282117023638847e-01   -2.805526416717705e-01   +1.746402754789901e-01   +1.514526026298112e-01   +2.141534551745547e-01   +8.985032858029844e-02   +2.169529320270628e-01; -2.820680125953565e-01   -1.131524725787045e-01   +1.738317015393873e-01   -1.743107951865881e-02   +2.664773758832844e-01   -1.148665004787474e-01   -2.072678782172237e-01   +1.005924264153229e-01   +1.747802608353650e-01   +1.811649907472387e-01   +3.757564787184009e-02   -3.211429456318086e-02   -6.294341817520610e-02   -3.745052601986579e-02   +3.115709995928176e-01   +2.057224927209946e-01; -8.825719152720647e-02   -1.235480135822420e-01   +4.367163674717956e-02   +2.033391617572856e-01   +3.569718369633340e-01   -2.633434191080176e-01   -1.059900360807219e-01   +2.961918596383254e-01   +7.831047033183700e-02   +1.967431810623563e-02   -3.359827546819782e-01   +1.973042057641507e-02   +1.968053594448424e-01   -1.398874967432929e-01   -4.823680648498795e-02   -1.248981932986509e-01];
L2I_L1I_iGABA_netcon = [+2.834585809515252e-01   +2.485485893386004e-01   +7.724391102156419e-02   +4.532832515646535e-01   -1.732899603517200e-02   +3.665603665752530e-02   +3.517982211877942e-02   +2.056283356394089e-01; -2.487026304930123e-01   +2.248793571464094e-01   +8.652138415417679e-02   -6.774694282567656e-02   -4.261470067378822e-02   +1.837445122115619e-01   +1.558854251512325e-01   +1.901571744000490e-01; +2.994594667861549e-01   +9.180955288204226e-02   +3.668979036986020e-02   +9.232859509984530e-02   +4.610313725939594e-01   -2.284375441766172e-01   -1.550926947807538e-01   +4.283567962026414e-01; +9.875301959713553e-02   +8.362008850894845e-02   +3.774471995507508e-01   +1.035292538489035e-01   +3.197070326588345e-01   -1.198391658093380e-01   +1.251986280685962e-01   -1.698366720948963e-01; -4.497064505162034e-01   +2.555415033531854e-01   +1.693018630314931e-01   -5.097757669315862e-02   +2.008604663370780e-01   +8.667057153180897e-02   -2.614718530863905e-01   +3.336205905290504e-01; +2.551217698139074e-01   +2.677553276551894e-02   -8.671831232781188e-03   -5.016254552567376e-01   -4.716031377924845e-02   +2.979895204349661e-02   +2.912290877933935e-01   -5.505525865240192e-02; +2.975744031050228e-01   +1.912654689799534e-01   +7.581080962085610e-02   -1.358086703121870e-02   +1.719617876101561e-01   +2.081392683305779e-02   +2.630847745112952e-01   +4.635866921993149e-01; -5.877058081085213e-02   +2.143688766418989e-01   +2.338560984835651e-02   +2.176906168558201e-03   -9.628842251998278e-02   +2.026208277981199e-02   +2.423481579202840e-01   +1.446785148080797e-01; +9.074611494026392e-02   +3.781520013787489e-01   -1.692545992844331e-01   -1.170558190654390e-01   +2.199268542931593e-02   -1.116791598135112e-01   -3.848256805817029e-01   -3.017727726419667e-02; +2.343608424833576e-01   +3.499040598602134e-01   +3.242585483015473e-01   -6.643162714942121e-01   +2.178968045546558e-01   -1.130817081833190e-01   +9.072787667042798e-03   -2.950470729414970e-02; +1.759881283142489e-01   +4.756800477570439e-02   +1.460106512464845e-01   -3.315793378372837e-02   -4.314528949381692e-01   -2.118956850020008e-01   +1.348244561852344e-01   +4.710008083258985e-01; +9.536368577935611e-03   -8.651426075301517e-02   -1.370446041572579e-01   +2.473640821215896e-01   +8.228232590379114e-02   -1.393221150105246e-02   -4.141452849020764e-01   -1.052179991577032e-01; +4.799021233160945e-02   -1.903366990515663e-01   +2.921670305364872e-01   +2.376728419902659e-01   -4.172439748680304e-01   +1.261694272038708e-01   -1.518636925826687e-01   +2.763968789614946e-01; +1.028313070256834e-01   -2.988748379272307e-03   -1.165525276040209e-01   +1.420344042127600e-01   -3.329745383993542e-01   -3.316890301780790e-02   -3.118768386589289e-01   -8.194330955004903e-02; -5.805979204171687e-02   +4.481012621561956e-02   +4.741060188111626e-01   -6.010649788092792e-02   +2.860931140237409e-01   +2.305020856150017e-01   +2.186584000305990e-01   -6.712008379933875e-03; +1.543963179264784e-01   +5.021354927670307e-01   -7.569381758898644e-02   -5.508462503316898e-02   -1.112180403705610e-01   +2.501604691285052e-01   +4.223407537859831e-01   +2.177605447915800e-02];
L1I_L2I_iGABA_netcon = [+6.768889606996538e-02   -9.899605901596814e-02   +2.553751950539755e-01   +1.657583062037217e-01   -3.279423244107319e-01   +4.978011579863122e-01   +1.697083398005581e-01   -1.364238720353519e-01   -5.198841279959055e-02   +5.138487689764492e-01   -2.422514362478631e-01   +1.378377975223760e-01   -1.160434735882061e-01   -1.309663785684848e-02   +1.098551887274461e-01   +3.483826726677535e-01; +3.223267742590402e-01   +6.171833731013140e-02   +2.932854965246586e-01   -8.882313305897274e-02   -4.579560296085928e-01   +1.087882513172969e-01   -1.016124404824357e-01   +7.456500889861799e-02   -1.657515463994541e-01   -5.273582007031874e-03   +2.786605543146261e-01   +8.651284992043748e-03   +3.481787742841511e-01   -1.615051994423619e-01   -1.094546361827202e-02   +4.054941711959185e-03; +3.246392191601608e-01   +3.831277451693612e-02   +3.267953926451954e-01   +1.047133302666985e-01   -6.130065521952735e-02   -3.126504393314085e-01   +3.587142268207467e-01   -4.378230765030273e-01   +1.693220619864933e-02   +2.293587969131717e-01   -1.154669937382790e-01   +2.952585902384007e-01   -2.881009798735215e-02   -4.001054016957012e-02   -2.286234460821961e-01   -4.543767325765349e-02; +4.396512053339302e-01   +1.700263416245885e-01   -9.008924492308756e-02   -2.263882717971538e-01   -3.233537366203125e-03   +5.639270222306612e-01   -2.887080000143691e-01   +2.867227419168508e-01   -3.346889340829394e-01   -1.036307095626061e-01   +5.184858480610630e-01   +1.695686643445525e-01   +8.290738892227958e-02   +2.413531953845037e-01   +1.837693135365543e-01   -9.656774030837184e-02; +6.568097703178076e-01   +6.223772463114671e-02   +3.426604764213330e-01   +4.235571478426717e-01   -5.320973454249366e-02   +1.879852428660959e-01   -2.025964500901916e-01   -2.809262519763142e-01   +1.967030055256393e-01   -1.755888149733077e-01   +4.984856053570290e-01   -2.449292931608209e-01   +4.596499530637797e-02   -2.128000079574878e-01   +5.353472846375687e-02   +3.836602771667949e-01; -1.021347342538558e-01   -6.876956692052337e-02   -1.656320182369188e-02   -1.845164263976861e-01   +6.501930687574570e-02   +2.605617922253789e-01   -1.258156639781247e-01   -8.701879378051834e-02   +1.438389427465732e-01   -1.701025978390042e-02   +2.467129639001149e-01   +4.935700312076393e-01   +3.288014359855867e-01   +3.645935502104033e-01   -1.107621832741454e-01   -2.325987097697203e-01; +1.199480787782165e-01   +2.312830483935651e-01   +6.958338315100471e-02   +2.927229494766944e-01   +4.125082017261379e-01   +3.060581191022093e-02   +3.118312230156993e-01   -1.905554651932443e-01   -2.120590974846634e-02   +9.499099923075360e-02   +2.228565606330783e-01   -5.768620342920476e-01   -1.201448448541255e-01   +4.971048511013204e-02   +3.419370972391331e-01   +3.919750885178733e-02; -1.181701518280515e-01   +1.086222131804808e-01   -3.601612023999737e-01   +1.102632466200323e-02   +8.379707286861390e-02   -3.554383662476043e-01   +4.379619759074496e-02   -2.323654666231140e-02   +2.030218810047679e-01   +3.673432018157398e-01   +6.031222131523493e-02   +3.053276908182425e-01   -9.088728166277077e-02   +1.001049252421957e-01   +1.150634409881424e-01   +8.172031787160214e-02];
L2E_L1E_iAMPA_netcon = [+4.987182707537897e-01   -6.599801708183013e-02   +9.731431191181372e-02   -1.654889620101450e-01   -1.774690312557480e-01   -1.958959688780235e-02   -2.438905646211034e-02   -3.392684135687900e-02; +2.905691882460800e-01   +1.531083385978211e-01   -2.428608889486457e-01   -1.787889046492228e-01   +2.193724451576958e-01   -1.940513657231778e-02   +4.374855069153177e-02   -2.316572535771331e-02; -1.890076170947436e-02   +3.865267119327916e-01   -1.007363428261784e-01   -1.402245486325550e-01   -2.301652223794684e-01   +3.767967147204551e-01   +3.324973831678699e-02   +3.599649866154856e-02; -2.940960230319635e-02   -1.371718338025070e-01   +2.289475373566070e-01   +1.199955048771785e-01   +4.945192543052764e-01   -3.850190796813993e-03   -4.037001076106322e-01   -7.629700586966866e-02; +3.159798562232548e-01   +4.191659126276142e-01   +5.157981751838225e-01   -1.637043281808629e-01   +1.028590237037694e-01   +1.180325704068924e-04   +2.176084170987525e-01   +5.562401510880826e-02; +1.109950762015918e-01   +1.307546765641457e-01   +6.204457953931543e-01   -9.609893195829505e-02   +2.376449043820423e-01   +5.838701261869025e-02   +7.186877935492531e-02   +5.669721831658409e-01; +4.341389198587993e-02   -3.435918563032633e-01   +1.626105190738451e-01   -2.231705770075487e-01   +3.346803386169783e-01   -3.614943495043353e-01   -1.804159004740027e-02   -7.377018414597178e-02; -4.500904590871425e-02   +3.303167492781686e-01   -6.579676625009141e-02   -2.147071440149752e-01   +4.226512158146148e-01   +1.397864560444595e-01   +2.260367844234963e-01   -1.772382958870286e-01; +4.477240620667172e-03   +4.789928199650584e-02   +1.576504010495191e-01   -2.250184291242409e-01   +3.887639844374487e-02   -1.347103396605799e-01   +1.091936701031332e-01   +3.408472611265359e-01; +1.911534684297301e-01   -2.315047607014074e-01   +1.481986976719057e-03   +4.314957857516101e-03   +1.281406202360141e-01   +1.252058733105038e-01   -7.009149024010676e-02   +2.435344637813676e-01; +3.200470243232209e-01   +3.208833610581686e-01   +1.402201400223524e-01   -2.633743616250193e-01   -1.214818231618192e-01   +9.986196435110614e-02   +1.966382386649865e-01   +2.224512643012406e-01; +4.033858313543043e-02   -2.806210735433905e-01   -3.495945437753882e-01   +5.208115043816959e-01   +1.871999025274395e-01   -8.133205913609626e-02   +2.363430719891267e-01   -1.862343711925825e-01; +3.111220790872932e-02   +5.050220495726755e-01   +7.762220287872194e-02   +5.725743279305292e-01   -3.340309728819948e-03   -1.707549691759241e-02   +1.383238878227552e-01   -2.129301278454859e-01; +3.286622286608060e-01   +6.261087237342786e-02   +2.488235894047629e-02   +1.743621836677828e-01   -3.823800329623832e-01   +4.059738389250583e-04   +4.461055115138105e-01   +3.233890239688237e-01; -5.260736172905695e-01   +1.065214210314019e-02   -1.394394795548776e-01   +2.996966448998997e-01   +9.325879565666723e-02   -2.754597080459451e-01   +9.820343115783127e-02   -3.356285388362933e-01; +1.354995278421355e-01   +7.515723631249915e-03   +1.946028766230404e-01   -1.900581560201199e-01   +3.082238211692817e-01   -8.238926399493958e-02   +1.563191505299708e-01   -2.174761705815612e-01];
L1E_L2E_iAMPA_netcon = [+5.726817106311635e-01   +3.308339520014360e-01   +1.369067161233346e-01   -4.886026481637253e-01   -1.321819056067473e-01   +2.398813185414155e-01   -2.370623768504142e-02   -4.338791856443304e-02   -1.992218142017063e-01   -1.035267898692181e-02   -1.081523742263210e-01   +5.597611901383226e-02   +3.584132684114215e-02   -7.270926249127008e-03   +7.712753237158923e-02   -3.192015379168441e-01; -4.440208758939665e-02   +5.602975312824870e-01   -1.643924899423173e-02   -9.266150288869056e-02   +2.286564689829674e-01   -1.737010796156353e-01   +8.694011447633704e-02   +3.320809720619819e-02   +4.539532171989325e-01   +3.366439659100199e-01   +2.274193058602201e-01   +6.513824816188742e-01   +6.333283228436316e-02   -6.674768356778508e-02   +9.648028579529309e-02   +8.488721871047945e-02; -2.449411940104477e-01   +2.148298665722008e-01   +1.783515881842729e-01   -6.919777804946968e-02   +5.331244587897532e-02   +4.264274922554491e-02   -3.109407097171288e-01   +2.956519041696180e-01   +2.239265947037694e-02   -2.405072308353449e-01   -2.733903790445539e-01   +2.816541734621081e-01   -1.285274018732435e-01   -6.238941671476284e-02   +9.062851061237436e-02   -1.070622138709192e-01; +2.183006524497632e-01   +3.436678629618931e-01   +3.100713576549194e-01   -4.014356356748767e-02   +2.156322637383320e-02   -8.922089421794882e-02   +4.056313855269499e-02   +2.278681620395519e-02   +7.938551222429313e-03   +3.450611139915578e-01   +2.184711532356506e-01   -1.650537103580210e-01   +2.075042341419563e-02   +3.714752345953526e-01   -5.757753339087802e-02   -1.174539692461774e-01; -3.736556151658764e-01   -1.579835462442002e-01   +4.970725552623997e-01   -2.102889141606489e-01   -1.221809072041742e-01   -2.134004645768430e-01   -1.251239599810815e-01   -1.348202929638901e-01   +1.912845154422204e-01   +6.435155175566114e-02   +3.521303450920814e-01   -9.473880582396138e-02   -4.111822204144258e-01   -4.438571507807273e-01   +1.026758980078712e-01   -2.246658518581414e-01; -1.305290296701468e-02   +7.469906774207806e-02   +5.359163338112475e-01   -6.172325979650309e-02   +1.206375909859664e-01   +1.072333978786988e-01   -9.118470330029146e-02   -2.224190230150055e-02   +1.118222818850107e-01   +9.473572097401806e-02   -2.775586471029164e-01   -2.967106717205535e-01   +1.019246212575926e-01   +1.442042034998654e-02   +4.327787570009788e-01   -8.937431306414972e-02; -2.659652259727290e-01   +1.927360659896518e-01   -2.540721993792343e-01   +5.886483157403436e-01   -4.419547565198222e-01   -3.945386827510962e-01   +5.832121251885185e-02   +4.068056831169361e-01   +5.977842581964143e-01   +2.877285225109933e-01   +1.512997172824854e-01   +1.796452707650241e-01   +1.904268906396946e-02   +1.805548618583154e-01   -2.947307741834732e-01   +7.705191499541694e-02; -1.583636129680081e-01   +3.245141960361086e-01   +2.300248945960039e-02   -3.166950712827080e-01   -3.673125920531393e-01   +4.212883548349641e-01   +4.418166857262847e-01   +1.780687911968042e-01   -1.541063021297108e-01   +2.966533070983337e-01   +1.523592679070691e-01   +2.123338327784468e-01   -2.028753599961964e-01   -2.416498330570702e-01   -1.319585224613285e-01   -2.184228299201275e-01];
L2I_L2E_iAMPA_netcon = [+3.195521531981261e-02   -3.366882717148206e-01   +6.767048476616340e-02   -2.984382542128137e-01   -2.534184013929659e-01   +2.677287105654483e-01   -2.822641739552533e-02   -8.949632021559210e-02; -1.458171122537913e-01   +1.881329189544152e-01   +6.834045217420452e-02   -1.773079282534354e-03   -1.775599978542617e-01   +1.089993009635902e-01   -5.900817885028695e-02   +5.926067966333203e-02; -4.932257459648640e-02   -2.018124533276034e-01   +3.223757870843049e-01   -2.784171051002927e-02   +4.399679163433681e-02   +1.348335058330389e-01   -2.511173173008669e-01   +5.321412933312093e-01; +2.863209977426715e-01   +1.111626923666984e-01   +2.412452937416533e-01   +5.105493042960088e-02   +2.618717435415157e-01   +1.528172851312193e-01   +2.162080402376302e-01   -9.720213389084408e-02; -2.628530465139809e-01   -6.992137243006720e-02   -3.662961861441806e-01   +3.820600824574466e-01   -1.401845535021300e-01   -4.832243307925280e-02   -1.449392017648607e-01   +1.184890341853988e-01; -5.640328385682288e-01   -1.398471343299297e-01   +7.059367933992845e-02   +5.956840266352258e-02   -9.997804794956902e-02   +2.625702584499672e-01   +2.274332304467657e-01   +1.278642439345257e-01; +1.369001614755927e-01   +3.670824921765223e-01   -6.665946102767192e-02   -2.191306726068538e-01   +1.365541177764782e-01   -2.257461913653865e-01   -2.672717016132324e-01   +2.885981431518263e-01; -9.022425664336094e-02   -1.519864505271679e-01   +1.059284430803431e-01   +1.243681009468580e-01   -6.112622999629301e-02   +3.815540609764846e-01   +5.708978859423894e-02   -1.137262776194600e-01];
L2E_L2I_iGABA_netcon = [-1.539857603364049e-01   -1.332791267117053e-01   +2.100551506391256e-02   -8.275770874662704e-02   +1.027350230345994e-01   +8.265109418128891e-02   +1.143910637079653e-01   +1.699067471246327e-01; +2.271368821743095e-01   -4.383911925241516e-01   +4.237328656444615e-02   +3.992440029492327e-01   -7.701844682325133e-02   +1.317344702740000e-01   +2.023561976400994e-01   -1.765546414261430e-02; +4.773851615980410e-01   -1.178331287568805e-01   +9.004990539979645e-02   -3.857061430328375e-02   -1.173667944951712e-01   +3.394161152798705e-01   +8.978249761993626e-02   +1.208068494215908e-01; +2.123099177136215e-02   +2.265813300674156e-01   +4.691381566952759e-01   +2.301143110419612e-01   +3.397427106589427e-01   +2.091290171689941e-01   -1.229862243332881e-01   +1.451189116293600e-01; -1.357591043939003e-01   +2.412235989760379e-01   -6.409109371147519e-02   -3.215610979760344e-01   +6.456707011910388e-02   +2.237608447542437e-02   -3.268944777114403e-01   -9.508778461998005e-02; +2.634375689076926e-02   -2.227948997936451e-01   +3.422077963938333e-01   -2.305368815182803e-01   -2.351476849421890e-01   -1.122387662772758e-01   +2.513579719654500e-01   -1.565102323215183e-02; +4.464434744511223e-01   +1.738927345547442e-02   -9.134795445887200e-02   +3.472481464683024e-01   +2.036229990400109e-01   +1.246478413035906e-03   -2.665434773423752e-01   -4.276314493095823e-01; +2.596458217047309e-01   +3.520614806035319e-01   +3.948946176892985e-01   -4.055486152924022e-02   +3.627465149717006e-02   +2.393165996395773e-01   +1.617086468378975e-01   +7.435280540588540e-02];
L3E_L2E_iAMPA_netcon = [+1.891754514636602e-01   +1.284043929400601e-01   -8.001969640856313e-02   -1.282634143053650e-02   +1.179195019356992e-01   +4.634613537919291e-01   +2.932548378081305e-01   +2.102533424694469e-01   +2.083460522038297e-01   -1.355535093645499e-02   +2.469916592396093e-01   +1.871810510695766e-01; +1.216114014728554e-01   -3.627728757880792e-02   +1.956349498569283e-01   +3.220362176459392e-01   +2.841078263430207e-01   +5.278519959552200e-02   +2.641606752751080e-01   +2.743264451826383e-02   -4.843273827402610e-02   +3.840646774103700e-01   +1.501882738843593e-01   +2.058992352603901e-01; -1.875073576487227e-01   +3.814749927155547e-01   +1.869602247571316e-01   +2.009422394550245e-02   +3.001659439809999e-01   -1.983131280793544e-02   -3.684446102013639e-01   +4.117999684911286e-01   -2.184123086675323e-01   +3.362375265743512e-01   +3.973193374545420e-02   -1.974289012785703e-02; -1.641086306854554e-01   -1.214258524213546e-01   +1.080995036618030e-01   -1.268379756387961e-02   +2.736436991432641e-01   +1.212325760094374e-01   +2.090302237686726e-01   -2.301791125018103e-01   +5.456375101550724e-01   -1.211280146873534e-01   +3.296966900503708e-01   +8.194969934128415e-02; -1.375984313621763e-01   +5.798510519409686e-01   -1.424653134411867e-02   +4.337644891513404e-02   -1.982657524303643e-01   +7.233049697310436e-02   -3.002380542957755e-02   -2.330997430160496e-01   +4.874384137397035e-01   +2.542940967501852e-01   +1.696501305852029e-01   +4.254902483197008e-01; +3.054618604613886e-01   +6.413818111751846e-02   -3.081570888402970e-01   +2.914109991227420e-01   -1.433953495111288e-02   -2.339031495399038e-01   +1.693277264724033e-01   -2.360338897012934e-01   +1.001065350722800e-01   +3.975252813618820e-01   -1.459805200697163e-01   +2.551730194685892e-01; +1.618209299755959e-01   -2.406103832907115e-02   -2.642885874300712e-01   +1.269097471356464e-01   -1.332056417734828e-01   -2.239296004443103e-01   +1.367508037045781e-02   -3.293900484666372e-01   +1.210070457838276e-01   -2.539891133573736e-01   -4.000757620779016e-02   -6.034980189757314e-02; +5.756587763891158e-02   +1.494316735675313e-01   +1.135608220837250e-01   +3.646746070664513e-01   +5.173616564939160e-01   +1.252261497905126e-01   -4.493005280207504e-02   +7.791791010810449e-03   +1.667460074541451e-01   +1.947387299643469e-01   +2.747959114490889e-01   -3.351213396725390e-01];
L3I_L2I_iGABA_netcon = [+1.278353365548914e-01   -7.402199326269131e-03   -1.684005149636768e-01   +4.773542705650627e-01   -2.558279989575674e-01   +2.608965006242485e-01   +3.796210058938909e-02   -1.088192177427777e-01   +3.679137062925597e-02   +1.292518280229525e-01   +2.855814401769626e-01   -1.068671135458038e-01; +1.605654921604316e-01   +9.518244836729749e-02   +1.500921845861648e-01   +2.172930092167098e-01   +2.761294029482579e-02   +2.589914101231106e-03   -8.502643695789036e-02   +1.660471274622946e-01   -1.102273809223167e-01   -1.177772640941937e-01   -4.521295293365042e-02   +1.978793048028851e-01; +5.057455425160046e-01   +5.095973681480578e-02   -4.713665875663337e-01   +2.588557360400131e-01   +1.072308043997815e-01   -3.391327336583338e-01   -1.845095150219384e-01   +1.775700161846248e-02   +1.655372104139458e-01   -1.204241203393971e-01   +4.020875735696623e-01   +2.918122165227778e-01; -5.460743976691326e-02   +1.168745609449862e-01   +4.148539291706032e-02   +3.662747326989603e-02   +1.489813572026351e-01   +9.327113359795376e-02   +2.997346938101894e-02   -2.051239408109545e-01   +4.283878456676612e-02   -2.415499813163037e-01   +1.261700569555086e-01   +3.230545575518096e-01; +1.596867118979032e-01   +7.252586411567881e-02   +4.607071276013440e-02   -9.665551465152428e-02   +3.158802857788836e-01   -5.309173322903679e-02   +1.176303728677331e-01   -1.151248135949952e-01   +2.667230236177114e-01   +3.764231781477104e-02   +1.743565963442960e-01   +4.621583171029442e-01; +2.543678991060941e-01   +2.548955155341471e-01   +3.592180090636733e-01   -1.626930817718452e-01   +2.653310541947522e-01   +3.350386744939406e-01   +4.165271092301283e-01   -1.470579030464079e-01   +3.333637278778276e-01   +1.522908865973718e-01   -9.442187192311513e-02   -7.747855725966640e-02; +4.658784148946726e-01   +2.851549002848596e-01   -1.312208522788476e-01   -4.790968609857871e-02   +8.245655319173972e-02   -3.323828821254053e-01   +4.075208149422062e-01   +1.487261855142296e-01   +2.411138579381799e-01   -9.183657027156047e-02   +3.757963072016622e-01   +1.270227685274127e-01; +7.864520570935155e-02   -3.388802259445435e-01   +2.080674293803254e-01   +6.558407840070060e-02   +4.228976182716489e-02   +1.106774383484087e-01   -2.181113280870926e-01   -2.155820315948110e-01   +5.171088945457127e-01   +2.129890719302685e-01   -2.488498496778619e-01   +3.716389769631974e-02];
L2E_L3E_iAMPA_netcon = [+1.825960189940205e-01   +3.713214667213017e-01   +5.503446465990873e-03   -2.086217816649457e-01   +4.950689283349809e-02   -1.136605051392533e-01   +1.761479517937306e-01   +3.661889577957502e-01; +1.601909294111067e-01   +3.351307280714144e-01   +4.291485791652300e-01   +2.607252029158482e-01   +4.510497456401395e-01   +1.314538403151987e-01   -1.418704359861344e-01   -4.795608036162726e-01; -5.988462831765334e-02   +4.088339841269559e-01   +5.819642043815590e-03   -6.316483158454019e-01   -2.076285873505342e-01   +1.988000953187827e-01   -6.363099952264009e-02   +3.257299430276969e-01; +3.185403841233608e-01   -2.058879088979932e-01   -2.438152769106700e-01   +2.866264525290299e-02   -9.975038567171854e-02   +4.313736832420911e-01   -2.692263539361114e-01   +2.702369092351858e-01; +2.593780412708606e-01   +9.297819140309932e-02   +3.720003956103710e-02   +1.282983023648301e-01   +4.290578759540368e-01   -2.725766553891444e-01   +2.452931622333698e-01   +2.037510397721183e-01; -1.458715909306612e-01   -1.173415333726183e-01   +2.934173020358286e-01   +4.170811921155249e-01   -1.015057813602279e-02   +1.303617135924576e-02   -8.589837300401451e-02   +3.293751762705098e-01; +6.785950008370092e-02   -2.366605321958102e-01   +3.954798614987627e-02   -1.312790952615884e-01   +2.611290945709282e-01   +7.611311244440258e-02   -1.219338931672612e-02   +1.786505101242044e-01; +1.016094430692018e-01   +1.139542129150189e-01   +1.401289032273601e-01   +3.520493769762731e-01   -2.197696977129517e-01   -4.683444707731466e-03   +5.430585452200829e-01   -1.115973042651000e-02; +2.638090811452770e-01   +7.360775285237224e-02   -1.250980698023444e-01   +2.033046278893193e-01   -8.060423216422437e-02   -4.426083306541834e-02   -1.926275197690698e-01   +1.491033776425624e-02; +1.016445395655559e-02   +6.285923762062599e-01   -2.728943748021413e-01   +4.296956466891969e-02   -2.552681424995654e-01   -1.676988187587457e-01   +9.628260613697316e-02   -1.475060252602172e-01; -5.626766889194997e-02   -4.693577405420204e-01   -1.455102480562029e-01   +4.895475748890557e-03   -1.339937978758756e-01   +2.337629704464868e-01   +3.516541919867823e-01   +5.144378126456243e-01; +1.248256729838276e-01   +4.959897086057338e-01   +3.518143260712722e-01   -2.663775654561217e-01   -1.244352457690506e-01   -1.524901533064979e-01   -9.056405183274578e-02   +4.049517640475384e-01];
L2I_L3I_iGABA_netcon = [+1.895182604359924e-01   +5.570934123328568e-01   +9.128252997522271e-02   -4.254239140806672e-01   +1.024096349210146e-01   +1.602893675286873e-02   -4.281455274427159e-02   +1.954387526796799e-01; -3.505171492303920e-01   +2.684961686171196e-02   +2.449842057555611e-01   +6.735908981017355e-02   +1.147325484096915e-01   +2.784009656859494e-01   +3.841035213014962e-02   +3.528503335403692e-01; -5.230264851440167e-02   -1.623065010296524e-01   -1.069086799774400e-01   -2.421228528693357e-01   +3.451364556727962e-02   -2.450767149946261e-01   -5.903862988742475e-02   +3.541459134558775e-01; -1.842513995858817e-01   -4.941703968515892e-02   -1.446752226717007e-02   +1.436866396588348e-01   +2.639857077228474e-01   +4.749940549299462e-02   -3.628775739770065e-03   -2.264080034603978e-02; +8.813749616234277e-02   +1.936133379188589e-01   +1.413027935078364e-01   +1.224983747911936e-01   +3.705467835554349e-01   +2.126214540165588e-01   +3.618350976979691e-01   -3.400434382994218e-01; +1.173778183750083e-01   +3.007714582297797e-01   -4.352896529788194e-02   -1.721937399304806e-01   -2.382450371574149e-02   +2.232614276581485e-01   -2.252142271733227e-01   +2.045239515704917e-01; -1.994561641595602e-01   -9.394277227717009e-02   -3.642308143230838e-01   -7.874130858212929e-02   -1.823559920761676e-02   -8.768843240089567e-02   +2.022140983580120e-01   -2.268122400570888e-02; +3.496927964796849e-01   -1.644802272793495e-01   +5.707307428033997e-02   -4.057209244754986e-01   +1.906100342388670e-01   +6.131559062271308e-01   +3.964335112117729e-01   -2.962158072934478e-01; +2.156422629627330e-02   -1.512425790195047e-01   +1.108824636684378e-01   -1.938261985840309e-01   +3.362626267550435e-01   +5.444786446185008e-01   +3.615748328579786e-01   +3.743854543322271e-01; +6.829349319111248e-02   -4.504300382269485e-02   +6.720619416706360e-02   +3.616940125949433e-01   +2.177524980159815e-01   +3.747260799559986e-01   -1.440530147450901e-01   +3.306214507774895e-01; +4.184942481669069e-01   +1.098153802496009e-02   +2.340170532134585e-02   -1.199581406527764e-01   -2.495412638370859e-01   -2.066174034381854e-01   -5.738935409533253e-02   +6.122680667602879e-01; +5.196074794268642e-01   +6.108464198906708e-03   -1.101386896950560e-01   +5.155633877616874e-02   +6.577189086649289e-02   -3.518975359623053e-01   -4.496902737545834e-02   +1.889706072263279e-01];
L3I_L3E_iAMPA_netcon = [+1.451247388257487e-01   +4.692451899454338e-01   -9.401030959468611e-02   -1.223732482813946e-01   +2.479520879295354e-01   -1.142334484019641e-01   -7.084279112386530e-03   -2.602900846543160e-01   +3.491257913768269e-03   +1.491722656140879e-01   +6.164925411697679e-02   -2.669684491868900e-03; +1.169017745572751e-01   +9.718879034854051e-02   +3.664823975643592e-01   +3.304236180010039e-01   -2.371172069890600e-01   +4.235931762317128e-01   -5.954648501438298e-02   +1.500891826015444e-01   +5.139122187196330e-02   +1.177650698302071e-01   +2.226738392861055e-01   +1.372370797711096e-01; +2.154014574877703e-01   +9.827653913394602e-03   -3.534707861900976e-02   +1.371274268669723e-01   -2.429080613115763e-01   -7.784019390288423e-02   -1.544881171366121e-01   -1.339474372858107e-01   +3.071071553831636e-02   -7.429026516433733e-02   -8.845963415616012e-02   +4.233018889285425e-02; +3.589499095718127e-01   +2.789045604571892e-01   -2.651192105970366e-01   +2.080535937352839e-01   +5.210566878547265e-01   -1.565092733714145e-01   +1.138840206565261e-01   +3.801103119546015e-01   +3.570835182283679e-01   -1.040042760691819e-01   +1.561991633044632e-01   -4.562751939925591e-02; -1.970587550988366e-01   +4.442220528153084e-01   -6.579584019301046e-02   +5.041560699282030e-02   -5.400625211101145e-02   +4.599272735277372e-01   +2.067370963931045e-01   -1.424892132729305e-01   +8.739659236023442e-02   +3.080296317530760e-01   -1.851724559681893e-01   +1.418636852957714e-01; +4.653119087805071e-02   +2.806950705887407e-01   -1.986070721681530e-01   +3.053793806565767e-01   -2.785418523099943e-02   -2.816511067552760e-02   +4.393422345790429e-01   +6.284965291845179e-02   -1.925125591431645e-01   +6.328514001256881e-02   +2.896027683452813e-01   -7.390616546052325e-02; +1.348086598029035e-01   +6.325610275889121e-02   +5.022183150551585e-01   +3.463459664550392e-01   +4.704072402169446e-01   +3.227475619078031e-01   -8.346038408026341e-02   -8.609460566531321e-02   +4.210357119691772e-01   +3.119990351719438e-01   -3.324466456094688e-03   -2.414605052401671e-02; +1.007864843764646e-01   -1.666177974932575e-01   +4.024928133495404e-02   -7.038855220146645e-02   +1.492090264114974e-01   +1.442925630618833e-01   -3.687403741801855e-02   -1.050174851292924e-01   +2.041811613844641e-01   +4.903861931219496e-02   +3.229154952519014e-01   +1.948261622377163e-01; +2.900284552669586e-01   +9.065814044623138e-02   +4.443283462350187e-01   -1.524194696327832e-01   +6.615505152873669e-02   -7.713650848087276e-02   +2.624790027787838e-01   -1.312114719746444e-01   +1.505656513857467e-01   +1.645614231503642e-01   +3.403564381523082e-01   -9.477672340329274e-02; +3.291946595313662e-02   -8.827208199217225e-02   +2.396933087665756e-01   -3.203205717995681e-01   +1.145050883064898e-01   -3.138347425573815e-01   -1.977207040487129e-01   +1.239218765845043e-01   +2.506908031762026e-03   +1.772032428582487e-01   +2.528910704586190e-01   +2.291341012945388e-01; -1.393110106192725e-01   +3.244465932247943e-02   -1.362986590553123e-01   +4.402511672006005e-01   +4.997635821307072e-01   +3.157748428267647e-02   +1.439951965829258e-01   +2.560392202974442e-01   -4.222488694491395e-01   +4.031965035561834e-01   +3.707545783687381e-01   -2.667546972195097e-01; +5.464694654699445e-02   +2.470937207191740e-01   -1.988371737400536e-01   -1.230855098050731e-01   +3.572386065364865e-01   +1.492985468105194e-01   -1.575643488471701e-01   +3.762090620610863e-01   +3.354705547229214e-01   +3.409058113450071e-01   +3.114863404146318e-01   +6.856760651831835e-01];
L3E_L3I_iGABA_netcon = [+1.914977653147718e-01   +2.035988699898579e-01   +9.630108889002921e-02   -1.383255326027386e-01   +2.524240321794483e-02   +3.462461944992989e-02   -2.736387755244832e-03   +1.928749069727455e-02   +7.788513024984854e-02   +2.301125864283771e-01   -3.948688137071737e-01   -5.133218413374677e-02; +1.564978676288854e-01   -1.289550953768766e-03   +3.613656035116761e-01   +2.246240391538660e-01   -5.238669910323512e-03   +1.570037158017837e-01   +3.651006094938487e-01   -1.178109616617608e-01   +1.950022412990010e-01   +3.783976697208348e-01   +3.078135840255763e-03   +5.480714777905792e-02; -1.895045259172853e-01   +7.619511314192463e-02   +2.190169566632386e-01   -1.089359192800464e-01   -1.273093193186962e-01   -3.784279136941963e-02   -7.696354073232547e-03   -2.043202204858593e-01   +3.283585516232203e-02   +1.386086822382649e-01   +6.561107402693936e-02   +1.289649709280962e-01; +2.011211905523940e-01   -1.541033343244461e-01   -1.758273277191903e-01   -1.797317032339737e-01   -5.206405890349414e-02   +7.203518617290994e-02   -3.842746978367457e-01   +4.227817834681870e-02   +1.322993185568865e-01   -3.721750943257755e-02   -1.284899716115814e-01   -3.193250917590109e-01; -3.308811298568503e-01   +9.340731175609669e-02   +8.961292866939560e-02   -8.295175591719348e-02   +2.444270997549129e-01   +2.401632261551400e-01   +8.295361362005439e-02   +3.953814050552066e-02   -1.265723714604699e-01   -6.222556336316379e-02   -9.815295060015633e-03   +3.946955782297029e-01; +3.352732164324540e-01   -7.156697941252028e-02   -3.090732118239259e-01   -1.812777140846385e-02   +4.614608347763186e-02   -2.001114528738850e-01   +9.360461752417557e-02   -1.005260670989408e-01   +2.189708313402856e-01   -3.045105023372351e-01   +3.281751838233408e-01   +1.869238186044192e-01; -1.504642549692542e-03   -1.494872394971645e-01   +4.452212659962196e-02   +4.719775010584777e-01   +2.030090871227728e-01   -2.406761215280837e-02   -1.388073192434766e-01   -1.914319430159580e-01   +1.007197031701697e-01   +1.075755522237352e-01   -1.196538608217491e-01   -1.706101723435578e-01; +1.361240148472610e-01   -1.058820874981042e-01   +6.091523345981423e-02   +8.556639098850163e-02   +2.508672123046246e-01   +2.545521588011199e-01   +2.967195780562725e-01   +5.158678712112587e-02   -5.619482806527846e-01   -3.140720562994382e-02   -1.145775653777154e-01   +1.946278905739104e-01; -1.604493399972535e-01   +4.453906234100468e-01   +2.962437094903401e-01   +7.363971651594919e-02   +3.485728479677062e-01   +1.026840069276218e-02   +8.889259291812542e-02   +9.313614133193056e-02   +7.550954188515899e-02   +2.160101852281258e-01   +3.326332518499943e-01   -2.843374293138951e-01; +2.289327959324979e-01   +6.393960816303873e-02   +4.321459352747694e-01   +1.143902559977069e-01   +1.640076085691614e-01   +1.175582705172524e-01   +1.492029303498449e-01   +4.814136301206426e-02   -1.436923991175567e-01   -9.518046214299072e-02   +2.737371588696809e-01   +1.629366952780991e-01; -3.229124516274570e-02   +2.751075718650106e-01   +1.777250970615334e-01   +6.368071198805966e-02   -1.359600582333950e-01   -1.295666652621423e-01   +1.771514518675875e-01   -3.926977829284293e-01   -1.757416684257804e-01   -1.308263672920923e-02   -1.877167024962741e-02   -2.004324989964253e-01; +2.107058957554506e-02   -3.691497248082712e-02   -2.682767369956188e-02   -9.021559304383600e-03   +6.250508032219440e-02   +4.066439853598630e-01   -9.664326522021670e-03   -2.078231738060730e-01   -5.224540099628235e-02   -2.944832913945019e-01   +2.388476349357952e-01   -2.949017286077685e-01];
L2E_Input1_iAMPA_netcon = [-2.882108815079251e-02   +1.730073454348541e-01   +2.446480337604648e-01   +9.719678198569846e-02   +1.924004793162853e-01   +2.291335318469906e-02   +1.669651642324148e-01   +2.729487227441684e-01];
L2I_Input2_iAMPA_netcon = [-2.194051133523156e-01   -6.262152687522490e-04   -2.947527235446474e-01   +1.676772172956594e-01   +6.872478267354720e-02   -3.285236182338819e-01   +3.648698530001624e-01   +4.783026003694543e-02];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.04*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.5*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.1*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.5*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.1*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.5*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.04*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.5*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.1*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.5*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.1*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.5*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
