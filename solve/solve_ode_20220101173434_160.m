function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+2.582851784224752e-01   +3.212858252607546e-01   +2.601414277517873e-01   +6.408756767459611e-01   +8.031097448067777e-01   +9.086098833352716e-01   +8.256024525041746e-01   +6.937211832965932e-01   +9.293485145937381e-01   +6.570940035956155e-01   +6.854857029679347e-01   +8.678987117379923e-01   +4.915786192942775e-01   +5.443900530746096e-01   +7.117635916417157e-01   +7.580853677239409e-01; +1.446598886257382e-01   +4.914886781002161e-01   +5.869693493710815e-01   +8.238413874650659e-01   +4.529640482382483e-01   +2.941442022237254e-01   +4.858360426184941e-01   +4.700395067783303e-03   +5.700168981618847e-03   +4.143873244163614e-01   +2.424974082885415e-01   +4.327624997782755e-01   +8.685881483237942e-01   +4.979691799772609e-01   +4.011083719654340e-01   +9.656462151173859e-01; +9.245608592613829e-01   +1.184640814624494e-02   +3.960418884552838e-01   +6.376397339019206e-01   +7.670028619577554e-01   +1.484699117717093e-01   +7.311500447040178e-01   +2.000908293921460e-01   +2.663107396266011e-01   +8.713172850346934e-01   +4.340697028393000e-01   +6.943325529370429e-01   +8.735344520670574e-01   +4.413333987974941e-01   +4.858732771987515e-01   +5.054201067013688e-01; +6.812730800104827e-01   +6.060226606431951e-01   +8.353613067246835e-02   +2.941030540420456e-01   +2.147108544724075e-02   +6.501113035402493e-01   +4.420053002498926e-01   +7.023130521412890e-02   +5.235007070052300e-01   +4.583440118810482e-01   +7.689681656277874e-01   +2.277685895733811e-01   +6.638190492528107e-01   +2.008525995547069e-01   +7.285215129563591e-01   +4.142605730619865e-01; +4.150448856574135e-01   +6.210565428665356e-01   +4.024901886432500e-01   +6.865798350115908e-01   +9.817904149133362e-01   +5.974472250668618e-01   +1.350860566890077e-01   +3.847043129683899e-01   +9.291405372639892e-01   +3.268070448596672e-01   +3.422570837378025e-01   +8.304611757946111e-01   +6.621647051417634e-01   +4.216407690484287e-01   +3.806402804855534e-01   +1.394264073470299e-01; +3.627130764822619e-01   +7.357785267998677e-01   +3.476494735166148e-01   +6.258422071820036e-01   +8.094513783618075e-01   +8.005981059400614e-01   +5.786331906620041e-01   +5.679725175665632e-01   +5.394387815207108e-01   +2.647583384284335e-02   +6.263850216136269e-01   +7.793764571899218e-01   +9.105959357366760e-01   +7.185478374793304e-01   +7.143806718387269e-01   +8.201604764002312e-01; +9.701003461474657e-01   +6.816428146547326e-01   +9.110555869855629e-01   +2.645583445839516e-01   +4.602496589362272e-01   +6.076842933015286e-01   +7.905630929884330e-01   +2.594128320277153e-01   +6.729130477686573e-02   +4.118098196291666e-01   +6.412064307145761e-01   +1.447913357471585e-01   +4.663427652152935e-01   +9.813270466083314e-01   +6.826090825781493e-01   +8.265122829055487e-01; +4.608523139770135e-01   +9.253563169750780e-01   +8.047565308312232e-01   +9.251183109808281e-01   +9.910091707238873e-01   +3.572716670626348e-01   +3.699915548580094e-01   +7.916797080059529e-01   +4.080073141857529e-01   +8.360664242882084e-01   +8.611044441834810e-01   +8.042627227620032e-01   +2.210012204518308e-02   +4.960577665554871e-01   +8.035411133391445e-01   +8.199209474407791e-01; +6.492136970423745e-01   +9.935314014257216e-01   +5.308058373968001e-01   +5.909284532136810e-01   +7.039016813646984e-01   +1.101058649707707e-01   +5.824483272383385e-01   +3.838157486925498e-02   +9.607782856839592e-01   +8.912764020185285e-01   +8.516515672852493e-01   +6.939872654835243e-01   +3.157444965999235e-01   +6.941571679556289e-01   +3.146580738940137e-01   +4.732226988995221e-01; +5.833846123859932e-01   +9.103597424540384e-01   +2.581886636519566e-01   +7.101258478352779e-01   +8.273462965341527e-01   +3.514433468366113e-01   +8.221477413697458e-01   +9.480565466422025e-01   +7.580200776449244e-01   +1.445795077687174e-01   +9.141632768968222e-02   +4.164482152045390e-01   +1.465808606775710e-01   +9.783618800894360e-01   +4.084230242279685e-02   +1.111332631043308e-01; +7.874097720049911e-01   +1.283021538650807e-01   +3.692679970158533e-01   +6.656641519979624e-01   +4.613902463736270e-01   +4.751091713700660e-01   +4.478168466601710e-01   +5.441614282336190e-01   +3.994077288096642e-02   +8.169640112078557e-01   +2.667495535422760e-01   +5.205964164352925e-01   +7.212009345506875e-01   +4.092021148696193e-01   +1.829735362234717e-01   +1.538580392289446e-01; +9.075073828645658e-01   +3.625565174322229e-01   +6.189585501027799e-01   +2.352115384665979e-01   +4.298886930784005e-01   +6.969120553993317e-01   +9.703743457727709e-01   +9.194573806514544e-01   +6.240457783091145e-01   +5.921237971874794e-01   +8.255771528064859e-02   +5.617847089263402e-01   +7.840875497517654e-01   +6.607306880034112e-01   +7.815481064164939e-01   +2.205706613080649e-02; +7.105160856752335e-02   +9.782042289183468e-02   +8.300482447645822e-01   +8.227623060920214e-01   +3.126405645956836e-01   +8.730493850213946e-01   +3.609302187517730e-01   +5.286304259748817e-01   +3.327418442514440e-01   +8.666960853171756e-01   +6.855395717520505e-01   +3.825739251130933e-01   +7.137377584354638e-01   +8.010418878944860e-01   +8.911021063307808e-01   +8.529070338603055e-01; +7.674686426142636e-01   +2.988171332509384e-01   +4.370534551275206e-01   +8.314778520491770e-01   +5.703091536333261e-01   +7.386554208652816e-01   +7.796689435649226e-01   +2.576352263848170e-01   +1.218200276555778e-01   +2.642248320675334e-01   +5.519459585713818e-01   +9.651457091814102e-01   +7.056345662355256e-01   +9.262820110789883e-01   +5.286602250396609e-01   +2.450676395338208e-01; +2.389078026735858e-01   +8.983535623895147e-01   +6.416106186189297e-01   +7.847618409930869e-01   +8.761013911321806e-01   +5.107884455493744e-01   +3.680177509805558e-01   +6.817967876884182e-01   +8.096973964568989e-01   +6.078269266165237e-02   +8.488211951229788e-01   +3.570845940878280e-01   +2.018018411587568e-01   +7.303275610506096e-01   +6.652896090723310e-01   +5.904165928743107e-01; +5.165485492881952e-01   +2.649953694239507e-01   +8.837740068629076e-01   +1.127750972424316e-01   +6.637639868743229e-01   +7.334935863115257e-01   +1.741846801733945e-01   +8.423333769168408e-01   +8.654492609341994e-01   +8.154957273109165e-02   +8.113185601705069e-01   +4.396984801205527e-01   +4.390839890987968e-01   +8.764505043855849e-01   +5.458432381967996e-01   +3.049503438193024e-01];
L1E_L1I_iGABA_netcon = [+8.041225382909178e-02   +8.935887119292075e-01   +5.653001922346560e-01   +9.490388213332328e-01   +1.675300482555397e-01   +2.735746985728579e-01   +4.521929188591748e-01   +4.648782025975764e-01   +5.035390528955367e-01   +1.090961467115548e-02   +2.115136343256130e-02   +8.937868572082688e-01   +5.914087061833657e-01   +5.160783329002973e-01   +1.561160454808621e-01   +8.419679059302431e-01; +6.486234373122619e-01   +5.991046443112084e-01   +8.947583076447361e-01   +5.590276218248823e-01   +5.332040666777725e-01   +4.057611124779770e-02   +9.283639384979839e-01   +1.823551598276727e-01   +1.206298069338252e-01   +4.710846817045420e-01   +3.706110184250069e-01   +6.342865646524074e-01   +7.260282594912716e-01   +4.472702213106378e-01   +1.339356623266287e-01   +1.637748868478632e-01; +4.480239091095426e-01   +8.795083699139525e-01   +6.954203426132094e-01   +4.684023248518516e-01   +3.609728317614312e-01   +7.448676589919242e-01   +2.260967808096617e-01   +8.223127095435786e-01   +8.292506689672772e-01   +9.826535983644045e-01   +1.912003852737760e-01   +5.780160195907104e-01   +3.456891523170654e-01   +7.855685013245595e-01   +2.578656366089229e-01   +8.905958816264159e-02; +9.554085441208034e-01   +5.823986740364451e-02   +6.844763498998717e-01   +5.552936366310801e-02   +5.970289300049405e-01   +7.849055592628860e-01   +5.853935944380430e-01   +6.316847885409765e-01   +1.341357301540730e-01   +9.588137723761430e-01   +1.613159585296567e-01   +8.389509464835524e-01   +4.149655030325660e-01   +4.288794108138688e-01   +6.147469192728520e-01   +1.468802021979304e-01; +6.822529362860764e-01   +9.884409115261776e-01   +5.185375218547544e-01   +4.819370733311735e-01   +4.181836093513136e-02   +6.903978309227152e-01   +7.377452347689243e-01   +5.175051457391210e-01   +8.227470350418092e-01   +9.093259929564357e-02   +7.731805521628191e-01   +7.242152115231504e-02   +4.663495819842045e-01   +3.959554266239304e-01   +8.368782370591102e-01   +4.158796194836423e-02; +2.385850394312844e-01   +6.735288900635412e-01   +5.532271708017442e-01   +4.395628568046920e-01   +3.298497470692705e-01   +5.030150506029599e-01   +2.201721291297651e-01   +2.694993130911676e-01   +1.033131996793755e-01   +8.117493276866631e-01   +8.458163173744165e-01   +5.141133678543495e-01   +8.536451859464048e-01   +8.401470159411544e-01   +8.145397770253144e-01   +5.326673721617449e-01; +3.631806807756667e-01   +5.021747379285529e-01   +2.206167031775497e-02   +6.965206806142982e-01   +9.660085975522209e-01   +2.647255138036564e-01   +4.577847892749997e-01   +8.832675341808272e-02   +7.041149788480942e-01   +3.517246754708452e-01   +3.280828441382955e-01   +8.991851944479562e-01   +7.501946924470185e-01   +8.144929819882007e-02   +9.346926535502620e-03   +2.961223038345548e-01; +7.307884368373757e-01   +5.294548109908139e-01   +4.112801504019871e-01   +2.515339990107247e-01   +1.377938769373307e-01   +4.544383396298557e-01   +1.258759404337918e-01   +5.788917741558868e-01   +2.149611936157533e-01   +8.408116396076047e-01   +8.141878777155447e-01   +7.203780300030617e-01   +4.882348474527931e-01   +2.630506953943379e-02   +4.131761660998701e-01   +4.034254261671660e-01; +4.749407323989618e-02   +2.470515888067818e-01   +2.809355528602711e-01   +3.702199729800778e-01   +6.377326996797292e-01   +1.697360845498574e-01   +5.990861652055416e-01   +7.020268765104272e-01   +9.691035594200681e-01   +9.273620175771278e-01   +8.676754980267362e-01   +2.954297836743648e-01   +4.198353037680780e-02   +2.997777186906995e-01   +7.271948626904645e-02   +3.115841018399221e-01; +2.269264834357523e-01   +1.263414479754440e-01   +2.694772431618614e-01   +4.693446438881221e-02   +1.283896544110730e-01   +3.829184739432293e-01   +1.970756269053756e-01   +8.577413266752847e-01   +7.409991090299936e-01   +4.534433411370217e-01   +2.313600513490800e-01   +5.014997800839727e-02   +3.443709726765325e-01   +1.689842435054281e-01   +8.809226743558626e-01   +2.110761404195880e-01; +9.126811124592814e-01   +4.827424756442698e-01   +7.328805388803641e-01   +4.455490685964736e-01   +9.834805162981283e-01   +5.196522710425222e-02   +2.715398860733432e-01   +2.504448785028498e-01   +7.176359215012585e-01   +5.307916128754031e-02   +9.977351699841183e-01   +5.260409089455230e-01   +4.515349579580200e-01   +2.829165771945413e-01   +3.779786666316738e-01   +7.051010407722652e-01; +5.788034808014545e-01   +4.760039769336133e-02   +1.770533072846470e-03   +5.720254854761764e-02   +1.250243319768071e-01   +4.437537583424793e-01   +7.388603155861367e-01   +6.654678998889549e-01   +2.934813603048384e-01   +4.289811857426046e-01   +4.399312812152993e-01   +8.720232091694240e-01   +6.775652242823121e-01   +8.712774070210543e-01   +6.404220990009724e-02   +5.412150650382870e-01; +4.838458268632990e-01   +6.370372358057408e-01   +5.788748060310789e-02   +2.342375661274575e-01   +9.364477989989196e-01   +4.080283806370033e-02   +7.703207035170112e-01   +7.032380540608986e-01   +5.688145093270696e-01   +3.734867389690700e-01   +1.206338038100587e-01   +8.038095877415996e-02   +3.994666539645993e-01   +3.503464235575982e-01   +7.629284442361136e-01   +1.305561399978912e-01; +8.070427049472829e-01   +1.136688919380355e-01   +5.078873747867864e-01   +5.384814230092716e-02   +1.403409056526449e-01   +3.810620959238671e-01   +9.980653202650417e-01   +1.300472010035667e-01   +6.450803065194077e-03   +5.796176975030799e-01   +5.686925695131584e-01   +8.424844913331321e-01   +4.167197403442959e-01   +2.519220795012191e-01   +1.893710307170756e-01   +2.066118893293545e-01; +5.955820829945458e-01   +1.739958384732936e-01   +3.527978717361742e-01   +5.145531524675557e-01   +9.058861512078586e-01   +4.023401245239727e-01   +2.909843736213794e-01   +2.559859723701639e-01   +1.942793648920370e-01   +9.883552115645282e-01   +9.985092066436279e-01   +1.025348627051506e-01   +8.269899557585717e-01   +5.240159712189483e-01   +4.226623223725101e-02   +2.912973786181337e-01; +1.240749986764320e-01   +8.221362403222066e-02   +2.723912589370207e-01   +4.276680071308723e-01   +4.540450345544857e-01   +2.117221983175706e-01   +6.136404588018389e-01   +6.537820743143236e-01   +1.279248735824186e-01   +5.145031444456649e-02   +2.213930154722294e-01   +2.490900695580124e-01   +2.049584242808078e-02   +1.406068384060419e-01   +8.155441647190589e-01   +1.820944394137637e-01];
L2I_L1I_iGABA_netcon = [+1.452348041081033e-01   +2.167473047083869e-01   +7.047429515587871e-01   +5.980726691226064e-01   +6.813241079440678e-01   +1.803025642094989e-01   +8.131012142714982e-01   +2.354672689625136e-01; +7.031689149367637e-02   +8.035444819328784e-01   +1.848004732930878e-01   +3.209975636133153e-01   +2.049026297993612e-01   +7.395860877927040e-01   +3.673172363520749e-02   +1.357587514821850e-01; +2.775541939396288e-01   +7.192128238104865e-01   +1.257311654646788e-01   +7.590556876157661e-01   +8.774981354450286e-01   +4.354369359843707e-01   +4.960814663354313e-01   +1.993233801597194e-01; +5.264228064456427e-01   +6.641486125173061e-01   +2.665419351419488e-01   +9.851041068132339e-01   +1.997040616747918e-01   +1.648500599656609e-01   +9.794507987277277e-01   +8.821528054316469e-01; +1.619263185291673e-01   +9.081242047458842e-01   +2.810215262049790e-01   +1.129690687385977e-01   +3.421478112883466e-01   +8.977069114577672e-01   +1.518259301800939e-02   +8.747056985100987e-02; +7.632882378581300e-01   +9.894229827262914e-01   +8.968739064591342e-01   +6.915501515628506e-01   +1.287667069183349e-01   +5.883410332790794e-01   +1.658558530338137e-01   +4.837268629035636e-01; +4.333374561305086e-01   +8.274402125379452e-01   +5.817596171064411e-01   +4.593098035061353e-01   +3.878842986690019e-01   +6.070459916686288e-02   +6.172903794768985e-01   +6.682205492351918e-01; +3.352996397724733e-01   +3.307436988243604e-01   +9.984671733693162e-01   +1.174901758733935e-01   +5.758789967513296e-01   +1.020960566142648e-02   +8.377970112875400e-01   +1.894292144874021e-01; +9.677911245032113e-01   +1.992342727894715e-01   +6.142513931599859e-01   +7.044550857740539e-01   +6.527418251321564e-01   +4.150894057577803e-01   +2.612903589447363e-01   +7.257418308486622e-01; +2.917685120237983e-01   +4.100061674118464e-01   +3.444334164016528e-01   +5.385794087070411e-01   +7.011894297044277e-01   +1.386568566567468e-01   +5.578405972106696e-01   +8.727726326602070e-02; +4.195067289999771e-01   +6.804446170280787e-01   +2.556503688699991e-01   +5.086098384119264e-01   +6.812676320418387e-01   +6.081121300531656e-02   +3.587675220963117e-01   +5.875961030314305e-01; +1.140979786397144e-01   +9.685510762349893e-01   +2.265481050412657e-01   +3.462208654117848e-01   +8.740031579952239e-01   +3.127686740947644e-02   +6.776585798098433e-02   +3.869971430474302e-01; +6.718412801343919e-01   +1.721979353964698e-02   +8.812064349440929e-02   +7.672044777613841e-01   +6.069175223832235e-02   +2.768949127306612e-01   +4.381537184451932e-01   +2.566398173444970e-01; +8.984393497314135e-01   +6.774963016666224e-02   +9.603331935935056e-01   +5.359656572049198e-01   +1.894912594024253e-01   +6.400285209072469e-01   +9.368842487119500e-01   +2.060357632453141e-01; +4.796318414839175e-01   +9.215541751774262e-01   +4.457588987633111e-01   +1.558584472775110e-01   +7.240898614821769e-01   +9.743349769510410e-01   +5.023432484151903e-01   +2.397349751184497e-01; +8.292613541980229e-01   +2.753800395395276e-01   +6.669864002885109e-01   +7.056328541308021e-01   +3.354735779820875e-01   +7.972670060416747e-01   +3.516822849700751e-01   +3.413188133378677e-01];
L1I_L2I_iGABA_netcon = [+7.806946018842590e-01   +7.763890300391157e-01   +5.480064282339221e-01   +4.932658500048642e-01   +6.423038710961063e-01   +1.146489331698164e-01   +3.661752797650689e-01   +7.477406135464681e-01   +7.728542399993074e-01   +5.604575139877980e-01   +8.947185210712103e-01   +9.974614338557186e-01   +6.672993429531865e-01   +7.683942316068827e-01   +6.743033187252201e-02   +8.473960670278001e-01; +4.288283775217596e-01   +4.454686479056278e-01   +8.773094114314933e-01   +5.572299758972720e-01   +8.589836753581462e-01   +5.530975206342381e-02   +8.197021986794151e-01   +6.210298768187277e-01   +8.076384813843327e-01   +2.026173117629381e-01   +5.948059049035707e-01   +5.865063458320792e-01   +3.614002098838635e-01   +8.106199386101967e-01   +2.384835556868846e-01   +2.414214074460173e-01; +5.243011842241729e-02   +6.633896356205566e-01   +3.148687531436922e-02   +8.481467472954264e-01   +6.637221344898188e-01   +9.865169535398219e-01   +5.593036636130923e-01   +4.320896634442645e-01   +4.231023173006799e-01   +2.902837692328930e-01   +5.915957442538303e-01   +8.788268764422491e-02   +2.210704351324155e-01   +5.787487556377301e-01   +6.723478593771658e-01   +6.189825207203754e-01; +2.884529836460750e-01   +5.895703187553356e-01   +6.496783204264689e-01   +7.177118105020263e-01   +9.476225921571305e-01   +3.785871862631915e-01   +9.300505712776931e-01   +4.892486161939478e-01   +5.832749844455055e-01   +5.711797641168936e-01   +6.965985052168554e-01   +1.907935596580391e-01   +2.514221977144352e-01   +4.782550010509090e-02   +5.738138546126114e-01   +1.435807866833331e-01; +1.643632680406347e-01   +9.320416904290487e-01   +8.719540775396196e-01   +2.251744965791264e-01   +6.837958176867369e-01   +1.867115846296905e-01   +2.124652850159079e-01   +2.412476976658503e-01   +5.220612259506926e-01   +5.961058567064970e-02   +7.365189097732318e-01   +5.744094119688874e-01   +7.865839304479224e-01   +7.411912049746098e-01   +7.779943392783810e-01   +7.080416099104868e-01; +7.278705070578072e-01   +7.105109540029378e-01   +7.268787354506575e-01   +6.296414653064657e-01   +9.679984034513586e-01   +3.121732429043645e-01   +4.136470972864018e-01   +6.387334682542379e-01   +7.835545893965221e-01   +6.890918208161007e-01   +3.995105760542436e-01   +6.747552757105156e-01   +1.741545023679465e-01   +3.093533846938680e-01   +5.894359681831167e-01   +9.513819562324431e-01; +7.178216793297154e-02   +1.803270924568323e-01   +9.649365876822538e-01   +3.837794868063233e-01   +7.643695130879846e-02   +1.905003397985793e-01   +6.606334942892856e-01   +4.382271909663650e-01   +1.821576871554991e-01   +4.418662252043737e-02   +8.256677411711389e-01   +4.024260593703906e-01   +8.025794073508796e-01   +8.185754792727757e-01   +7.135419072069781e-01   +9.150836545710794e-01; +8.741447728305662e-01   +1.578008605830631e-01   +8.872510991575849e-01   +3.394662709952336e-01   +6.004189690130285e-01   +3.691227959844404e-01   +8.451961033067692e-01   +8.984203261709502e-01   +2.182609621331532e-01   +1.585441333453890e-01   +6.611742857304369e-01   +1.928109941909116e-01   +5.913918935102894e-01   +6.084583328745903e-01   +2.344415146203561e-01   +8.231451308592521e-01];
L2E_L1E_iAMPA_netcon = [+2.583048737461556e-01   +3.095562613554659e-01   +3.550544372711079e-01   +8.031081468735948e-01   +5.040637522526454e-01   +1.297905223986995e-02   +5.522162773013209e-01   +4.737722180799402e-01; +8.329130017653407e-01   +9.039335043618477e-01   +3.895674160954207e-01   +8.125575986451352e-01   +4.050246676692142e-01   +5.418182869120086e-01   +3.190323686471452e-01   +2.336513256825378e-01; +1.261110612040794e-01   +2.559657034311552e-01   +7.648380062437343e-02   +1.133858052609436e-01   +7.941761925101858e-01   +1.225217155242155e-01   +4.801497343691994e-01   +9.987860479960590e-01; +1.581346798150817e-01   +6.613850568341938e-01   +6.831629822092298e-01   +8.719334397115396e-01   +5.776147311630531e-01   +6.437616668873861e-01   +1.341223506329792e-02   +3.844302659933757e-01; +9.977820956417793e-02   +1.754494216299947e-01   +6.380323993853824e-01   +1.331944879720395e-01   +3.418955326551841e-01   +7.887854991421483e-01   +6.728645706702163e-01   +6.274973999997538e-01; +8.432558141428295e-01   +6.784894080945049e-01   +2.208799749394504e-01   +3.517274034862861e-02   +5.716215683140097e-01   +2.127122874861037e-01   +5.779565689752426e-01   +7.737754439346534e-01; +2.275590058859295e-01   +1.418669386029554e-01   +4.707643124818058e-01   +6.397963364496771e-01   +4.064267653847984e-01   +5.389441965579422e-02   +8.249038064565690e-01   +6.106894599281582e-01; +9.679304779132554e-01   +6.995255671345539e-01   +8.049330978964010e-01   +7.237387810619375e-01   +5.970852621098766e-02   +2.992437018395223e-01   +4.776948717011420e-01   +7.646688102953342e-01; +3.528468756516666e-01   +8.050613106005877e-01   +7.263593241587544e-01   +7.184717621663107e-01   +6.852688938834069e-01   +4.381505716276205e-01   +6.554091561027897e-02   +4.879709161423637e-01; +6.615267277963750e-01   +7.486232660941865e-01   +2.191560242835879e-01   +4.750122974754195e-01   +1.494539369081559e-01   +9.447906756164938e-01   +5.329654763693970e-02   +3.832887454075993e-01; +5.304609263179539e-01   +7.386347124597448e-02   +9.958961894704588e-02   +7.142870906803072e-01   +5.251158961929899e-01   +6.037048120045895e-01   +6.704949601601605e-01   +3.615734985300030e-01; +9.930062204147625e-01   +8.424308339077813e-01   +4.172956831101456e-01   +5.652860660562609e-02   +4.572203388544651e-01   +1.062866689553476e-01   +7.879664068262870e-02   +9.311068431173732e-01; +6.069815884219296e-01   +3.682402424077044e-01   +8.521888651695703e-01   +9.489477942696638e-01   +7.569130263304299e-01   +2.016039177627239e-01   +2.907083382615611e-01   +3.087724090367773e-01; +4.361491728147271e-02   +6.931774822575608e-01   +1.526812343440083e-01   +8.076539640776990e-01   +4.692852020470721e-01   +6.925658405646040e-02   +9.285053613687743e-01   +6.213176860359411e-01; +6.102560017035611e-01   +9.726748391562806e-01   +8.318052843990972e-01   +5.196961716085394e-01   +1.736273368031162e-01   +9.742243556819209e-01   +6.363569469268044e-01   +2.684985650791731e-01; +7.761622508649317e-01   +6.195906051284200e-01   +3.887470343674437e-02   +8.779745824345988e-01   +1.206062778129537e-01   +4.107904150429874e-01   +4.804283539615944e-01   +7.439001469944204e-01];
L1E_L2E_iAMPA_netcon = [+8.633820147859921e-01   +1.012690312083953e-02   +2.455767410744958e-02   +1.803945693433499e-01   +6.697733129130319e-01   +3.011911498733968e-01   +6.441121861342066e-01   +8.615368809638135e-01   +4.364569917199106e-01   +1.916697904904332e-01   +5.616980556299244e-01   +6.970807339059892e-01   +5.992342238923664e-01   +5.926343416752595e-01   +9.585498120109004e-03   +1.207246532991086e-01; +7.211641125573540e-01   +5.168139750912562e-01   +1.032128973382650e-01   +9.623993697175816e-01   +3.821510440625773e-01   +2.196243874203527e-01   +2.733870653181116e-01   +5.482395158853579e-01   +4.939683907411974e-02   +1.243177953601338e-01   +1.808667466046119e-01   +3.499253032566492e-01   +2.552986224121185e-01   +4.553462208786364e-01   +8.940765883834190e-03   +2.493414227959623e-01; +4.085372075865346e-01   +4.924362834061192e-01   +7.605871644816871e-01   +7.535598986605369e-01   +6.352506544472279e-01   +5.649332015689347e-01   +8.165601038022503e-01   +8.129892116022223e-01   +3.071691172317765e-01   +3.954348596347838e-01   +8.880726314308331e-01   +1.398842329559156e-01   +2.115722914767392e-01   +1.788733800148197e-01   +7.244129441148134e-01   +7.344455845477961e-01; +6.356820944347655e-01   +7.432469238978162e-01   +9.576590587843149e-01   +6.487774822260708e-01   +1.229153144552297e-01   +2.197934662746112e-01   +8.195599697501015e-01   +2.403117730706145e-01   +5.977596240208165e-01   +1.037523736743697e-01   +9.205785390216861e-01   +8.835580385571814e-01   +2.341816405690775e-01   +4.162131741675312e-01   +3.450415973444112e-01   +9.395268649911428e-01; +6.667519031221819e-01   +9.047148745387513e-01   +8.091753885437010e-01   +4.010637563516881e-01   +2.057970451375273e-01   +8.186287080856824e-01   +3.013618415579395e-01   +2.010563893592654e-01   +1.715472416773802e-01   +1.964259249095264e-01   +7.730219117650861e-02   +2.716217565861331e-01   +8.924555047311193e-01   +6.020579934699136e-01   +4.606615215333593e-01   +3.368734195022676e-01; +9.651429021311516e-01   +6.093523703814006e-01   +9.317085741182510e-01   +4.576089856409400e-01   +9.769730666366128e-02   +1.650045158235618e-01   +9.518552827785395e-01   +3.210062105786440e-01   +6.741929640205182e-01   +8.319177649538494e-01   +8.452978260140946e-01   +2.638315973763112e-01   +6.830070574980456e-01   +5.070044188661096e-01   +5.415265381170250e-01   +7.300339600227800e-01; +4.732063107966239e-01   +5.280588903960218e-01   +1.806984144070776e-01   +6.110925403329391e-01   +2.597216465989655e-01   +9.552716111667573e-01   +1.504576351330233e-01   +9.706298105281883e-01   +7.240832157600398e-01   +3.166742750952514e-01   +5.047251568178375e-01   +3.508081814950492e-02   +3.814776001906036e-01   +9.431571733187377e-01   +5.897013183247301e-01   +3.019868425909196e-01; +7.772018803958891e-02   +3.632922858649272e-01   +2.779125018973458e-01   +7.411960627274771e-01   +8.613265207465526e-01   +4.962803176483110e-02   +2.473636537035285e-01   +9.645961147658803e-01   +6.011420899802409e-01   +8.802279504732632e-01   +6.369175396464919e-01   +8.196965522176533e-01   +7.259634141901188e-01   +9.060984319044892e-01   +2.860813078452340e-01   +5.314784680389841e-01];
L2I_L2E_iAMPA_netcon = [+5.748190119115733e-01   +9.373828487913135e-01   +2.290592020359243e-01   +4.187622482577790e-01   +6.185008041598039e-01   +7.680621772915420e-01   +6.948083180455389e-02   +9.560179275889030e-01; +4.714969243943803e-01   +6.017005173185842e-01   +6.629068663198048e-01   +9.818931738913783e-02   +7.702473197610464e-01   +9.490782288256421e-01   +3.376367924962888e-01   +5.080420787827444e-01; +7.925699302915435e-01   +2.959295827205882e-01   +8.652541201585542e-01   +4.282152099017159e-01   +7.545501357323943e-01   +8.068128232311929e-01   +4.124614605323730e-01   +7.819508598965993e-01; +3.387121348404727e-01   +3.376450662527180e-01   +2.283292785747445e-01   +6.929430566130584e-01   +4.797433633796012e-01   +5.405347340403477e-01   +7.652606372285711e-01   +2.592579185103951e-01; +6.386137374804588e-01   +2.118546342665717e-02   +5.303400768841318e-01   +1.024299440225725e-01   +1.161211875364425e-01   +2.302408560862983e-01   +2.617715283752093e-01   +1.363628391496799e-01; +3.181890137168585e-01   +6.897613059126418e-01   +9.258991107900779e-01   +5.825212851876639e-01   +9.250017167694946e-02   +8.839846183479240e-01   +8.981530625242304e-01   +1.711377289654458e-01; +8.692627285088063e-01   +8.886753728961740e-01   +7.923075898169265e-01   +4.356947229246011e-01   +7.761180307854635e-01   +5.957836005719249e-01   +4.558885142079838e-01   +6.374315305907731e-01; +9.554723139937060e-02   +9.604430976605098e-01   +7.073146593465474e-01   +9.078014184761068e-01   +5.532045072371514e-01   +4.020120254797956e-01   +8.662814122389215e-01   +8.734801741417719e-02];
L2E_L2I_iGABA_netcon = [+6.323732114292914e-01   +5.104273021548998e-01   +2.989169036821107e-01   +5.759036630465789e-01   +3.748680781994880e-01   +4.015269525410202e-01   +9.359786054676882e-01   +9.133213708478688e-01; +5.503395947875412e-01   +2.499633114312951e-01   +5.580177825543556e-01   +7.503605743997595e-01   +4.102820459545875e-01   +3.431419551844672e-03   +6.736330615584667e-01   +1.949416320362228e-01; +6.585187212451287e-01   +7.708067550624522e-01   +5.259548175994451e-01   +5.471966268113631e-01   +5.891169565466891e-01   +8.232962334887577e-01   +9.783232595897851e-02   +5.944827686452010e-01; +1.986074446935737e-01   +3.224005843661406e-01   +5.910499850363693e-02   +1.156606404490312e-02   +4.992441203640485e-02   +4.172628609026147e-01   +2.099100113819096e-01   +6.544432163490131e-01; +5.379348266853001e-01   +4.072986647280868e-01   +1.998476756273810e-01   +2.707332694952047e-02   +4.851716965187256e-01   +9.332026144076432e-01   +5.135755138154769e-01   +9.700672192541286e-01; +8.979228951358879e-01   +2.127572505989073e-01   +8.567330620429466e-01   +1.775214296806160e-02   +4.730162922986614e-01   +5.147234062272680e-01   +9.024544877390562e-01   +1.220735647060451e-01; +7.715670246711711e-01   +6.936237419723751e-01   +5.876661496510144e-01   +7.526158497848496e-01   +2.588550296111195e-01   +9.645697040570529e-01   +4.566016306685059e-01   +5.248341260576224e-01; +6.413927139737404e-01   +5.915171579836147e-01   +9.702128450780029e-01   +4.903821676254282e-01   +6.648433399479805e-01   +8.484059264527364e-01   +2.273253612679756e-01   +4.526060890636211e-01];
L3E_L2E_iAMPA_netcon = [+2.065966528683160e-01   +9.857996971574043e-01   +7.486812512631540e-01   +4.670149699230433e-01   +8.457688858139789e-02   +3.830265527294833e-01   +3.728780357386117e-01   +1.310438661796985e-01   +1.041685881380768e-01   +1.283905925671909e-01   +4.406458047358125e-01   +1.209960785724318e-02; +8.488290099814795e-01   +2.368032532034314e-01   +1.469074035321470e-01   +7.120149040613956e-01   +7.701642292149302e-01   +5.980200932763599e-01   +5.760502616652119e-02   +8.296739817129098e-01   +2.881271144903902e-01   +2.460829663516676e-01   +4.178165600854239e-01   +7.132250542738136e-01; +7.344658349302440e-01   +5.077336403791528e-01   +6.785555865332934e-01   +8.344091596437815e-01   +5.322684390420351e-02   +2.094332016561726e-01   +4.247910884091431e-01   +3.239648624347545e-01   +4.381924221032196e-02   +7.769594673730579e-01   +2.489720625762836e-01   +6.096760899924765e-01; +4.132211284711143e-01   +2.302817529510037e-02   +2.671658423354443e-01   +5.179137453322241e-01   +9.150263986118686e-01   +7.805992890528989e-01   +3.496115474145514e-01   +9.418285300061319e-01   +3.627070225604645e-01   +6.842474056091681e-01   +8.286104965931622e-01   +3.064223269276464e-01; +2.605614343233253e-02   +5.250294800846489e-02   +3.539390789529513e-01   +5.692086767701394e-01   +4.808711600287120e-01   +6.349667111460727e-01   +1.082367290220324e-01   +1.114919168373243e-01   +3.033788803735417e-01   +5.329786916688729e-01   +6.656322912613509e-01   +3.462088239065479e-01; +3.154219491844881e-01   +5.219734566857903e-01   +1.876397472862800e-01   +1.981258564615961e-01   +3.259183854231834e-01   +3.975441548664249e-01   +6.586628188953575e-01   +2.004829409665456e-01   +9.048452067499991e-01   +1.180113511637926e-01   +8.258975912040795e-01   +7.945263222126038e-01; +3.957030105511296e-01   +3.757847091902718e-01   +1.030424135879361e-01   +6.648648951960638e-01   +1.927964111090350e-01   +6.422080425599461e-01   +3.731808492038208e-01   +3.438954064387199e-01   +4.454541283815203e-01   +7.980335004146520e-01   +3.718890961925277e-01   +2.793202468040172e-01; +7.023696825385484e-02   +4.641043877859563e-01   +9.521232020685231e-01   +1.981840084028900e-01   +4.829099203066034e-02   +5.415894291401925e-01   +7.112078994432049e-01   +9.909468550615818e-01   +7.859634554301731e-01   +4.892731915017611e-01   +6.752277776942248e-01   +5.176701094216034e-01];
L3I_L2I_iGABA_netcon = [+6.087616321843743e-01   +5.150271312183332e-01   +5.709507219814666e-01   +1.420937724088455e-01   +5.577812648759189e-01   +1.834599180863641e-01   +7.820053330540834e-01   +6.633448291613168e-01   +9.485146024088018e-01   +6.715087521362206e-01   +1.923613062167872e-01   +3.081629946920810e-01; +9.684456176855578e-01   +5.921964599340331e-01   +5.890951592603187e-01   +2.423246611034955e-01   +1.555909509108071e-01   +7.454398459437767e-01   +6.383884591151597e-01   +3.060436008995171e-01   +3.237828505573942e-01   +9.646792045152074e-01   +2.809051208333901e-01   +4.078328741188579e-01; +6.230279109811483e-01   +8.624533215706770e-01   +1.356276162027603e-01   +1.511759660179961e-01   +1.654320899033180e-01   +1.327555909837308e-01   +8.240306900591785e-01   +1.858819135230646e-01   +6.633595751332600e-01   +3.054272920631342e-01   +1.403613495968266e-01   +5.098798470093255e-01; +1.880024516956859e-01   +4.433970620480353e-01   +9.314592145413008e-01   +6.996069382454155e-01   +4.577018184814564e-01   +9.154040634790905e-01   +7.399043452331234e-01   +9.640595205695512e-01   +1.483966894174532e-01   +4.127768405980666e-01   +7.266312057128623e-01   +2.815767560268871e-01; +3.536248053978133e-01   +8.371160743960504e-01   +9.597983983248626e-03   +1.072870380143657e-01   +2.157321268071090e-01   +8.350235174345575e-01   +7.636798492893115e-03   +2.238824397655677e-01   +5.491932045929743e-01   +2.476549168060612e-01   +4.057683898537153e-01   +2.337011877564096e-01; +8.699294507273897e-01   +9.533383528092707e-01   +1.947119490567570e-01   +9.605013462541279e-03   +2.233508625523555e-01   +4.670086969111313e-01   +6.340091704525771e-01   +2.598330407324311e-01   +7.014615948679025e-01   +7.859569450809758e-01   +4.051546537626544e-01   +6.732771485320397e-01; +2.653024821440525e-01   +1.570939659380310e-01   +3.936226908572772e-01   +4.509418929663016e-01   +8.439383751427132e-02   +2.844205493910622e-01   +5.200739959682928e-01   +1.848680339236475e-02   +4.854323964252750e-01   +3.431919414018507e-01   +1.416423798518971e-01   +8.127071056404576e-01; +1.828552566081543e-02   +8.718332367035272e-01   +3.787977080390348e-02   +3.931253722973547e-01   +8.773308308523573e-01   +5.272435907487104e-01   +8.015657137206759e-01   +8.964881408217387e-01   +3.822863814753393e-01   +7.108406113344810e-01   +8.126847693565729e-01   +4.077351587600807e-01];
L2E_L3E_iAMPA_netcon = [+6.437396230412802e-01   +5.485173704827708e-01   +1.814704214846350e-01   +9.393124591132066e-01   +5.245430248758375e-01   +6.838434024798944e-01   +9.971640718243989e-01   +6.942502024402452e-01; +3.819994539626456e-01   +6.257824280014485e-01   +8.857895525772980e-01   +9.837316598113433e-01   +1.378481626364008e-01   +1.505777868951308e-02   +7.541891894548494e-01   +7.917392695713367e-01; +8.281450680836662e-01   +5.584194578010671e-02   +3.840251431256811e-01   +3.189931316728499e-01   +6.177832579843994e-01   +8.382392272272350e-01   +8.518996881397052e-01   +6.679006772468765e-02; +9.270030426302056e-02   +1.340097170558927e-01   +8.902438915036903e-01   +7.067009196495162e-01   +6.264121352535817e-01   +2.243462250624899e-01   +7.932984655082904e-01   +6.938076914715701e-01; +5.462343078119070e-01   +2.072632925116087e-01   +1.456009005623363e-01   +4.255804009217016e-01   +1.937995518891139e-01   +9.562641384719417e-02   +3.576073607786810e-01   +5.722560191919975e-01; +2.103961172888303e-01   +3.285551379065139e-01   +8.780672773683318e-01   +4.198378993443770e-01   +7.044306811869230e-01   +2.195375503257829e-01   +2.839427420176239e-01   +3.057086740293931e-01; +2.744325161023703e-01   +4.553158552512405e-01   +5.476448904374482e-01   +7.758828589891694e-01   +6.704412297120768e-01   +8.735045190812565e-01   +8.526198400001546e-01   +4.076536782160373e-01; +9.966711219878843e-02   +7.928681877936284e-01   +9.965135198884286e-01   +8.869712011014168e-01   +6.885013624867955e-01   +1.026361767738196e-01   +1.377745729537641e-01   +7.626806625071103e-02; +5.113321980935684e-01   +5.948064088125976e-01   +2.116350666628786e-02   +6.041598606902877e-01   +9.136221097841173e-01   +9.713879740484467e-01   +6.449682502834093e-01   +6.110207323925599e-01; +1.004716339688791e-01   +7.330145233676496e-01   +3.926332630226982e-01   +8.331981824423887e-01   +7.345747958675460e-01   +6.271932043440062e-01   +1.698495459088198e-01   +7.489230495270552e-01; +2.712536290939030e-01   +1.010844945555497e-01   +3.096755461775352e-01   +9.947990575150067e-02   +3.918904653504862e-03   +3.283925549535845e-01   +2.579348944653612e-01   +1.990685390135071e-01; +2.986790857690147e-02   +7.800760995701617e-02   +9.741832262986883e-02   +4.758379883882948e-01   +5.044049936932931e-01   +8.080828380828298e-02   +5.032666569323017e-01   +1.292480802983260e-01];
L2I_L3I_iGABA_netcon = [+4.643544333676569e-01   +1.132364150491895e-01   +6.602083983002698e-01   +2.050693667826539e-01   +6.538616590635464e-01   +4.710815643636086e-01   +9.315243397030714e-01   +3.492580274259441e-01; +2.504535597897135e-01   +4.274391668949173e-02   +5.355465102160707e-01   +9.353606092487160e-01   +8.924133016902752e-01   +6.499261595924064e-01   +7.063686101529487e-02   +7.868832097854598e-01; +6.618339727973793e-01   +7.070493574708360e-01   +8.797105708203100e-01   +1.033308101027873e-01   +9.286504682402043e-01   +8.917409851875734e-01   +3.675264651845783e-01   +5.883258236982688e-01; +6.653655269740733e-02   +9.090928503952271e-01   +2.458452320812482e-01   +7.672941194001226e-01   +3.295762774225670e-01   +5.194985800130663e-01   +3.733002084343675e-01   +4.986238481851383e-01; +9.733136446057500e-02   +1.429681732149909e-01   +8.495087974425626e-01   +5.134787466189832e-01   +8.326963763476813e-01   +1.161016268436654e-01   +7.721902086122239e-01   +4.924365690641608e-02; +3.244789654542920e-01   +1.556444436928733e-01   +2.137055606437704e-01   +3.854758590581371e-01   +2.777909681305202e-03   +9.120305893326787e-01   +4.460868861897453e-01   +8.600283876335073e-01; +8.819786221656323e-02   +7.965944195046537e-01   +1.873840628587605e-01   +6.102679337140509e-01   +3.148784672386319e-01   +7.537104996218016e-01   +9.727896806213732e-01   +5.907466948678103e-01; +5.516198096066408e-01   +8.848053985199255e-01   +3.163693831416294e-01   +3.064100442589205e-01   +7.495191435191899e-01   +3.398597662869353e-01   +6.663849664049163e-01   +4.093721360794641e-01; +2.006204660411038e-01   +6.237285704336759e-02   +8.855998611358259e-01   +5.948184086828051e-01   +7.678395331696255e-01   +8.144521579934348e-01   +1.822159114679980e-01   +8.198513111154441e-01; +9.785890452276602e-01   +1.784327921241162e-01   +8.237538927486827e-01   +5.173164350715822e-01   +9.201086245443122e-01   +2.254142843888118e-02   +2.987164870734849e-02   +1.141634052100151e-01; +2.289946555962320e-01   +6.828592983939885e-02   +3.104197381775653e-02   +1.168296108969408e-01   +2.584669106698227e-01   +2.159795125036518e-01   +5.923035919169800e-01   +8.113624275052631e-01; +7.972349498729683e-01   +3.743844441696327e-01   +1.762215665544465e-01   +5.497273803789046e-01   +4.192525549755139e-01   +5.012036441986217e-01   +9.598778782101837e-01   +8.901657460677003e-01];
L3I_L3E_iAMPA_netcon = [+1.840622511476478e-01   +9.018936887458393e-01   +3.414904381190567e-01   +4.127016549817555e-01   +9.116259442499697e-01   +9.120241352487342e-01   +5.595342020519145e-01   +6.961331843902629e-01   +2.373880994428659e-01   +6.471126282100926e-01   +3.643585389130102e-01   +1.833763867722128e-01; +3.348263548397560e-01   +3.925908522482826e-01   +4.105528168092152e-01   +5.918798145242932e-02   +8.371604352986161e-01   +5.483052443193691e-01   +3.358850307130173e-01   +1.539665212425162e-01   +6.994338433713310e-01   +8.193377565282686e-01   +4.956431717386303e-01   +2.334516624876548e-01; +7.290822898080116e-01   +2.309069442178638e-01   +5.362244178115599e-01   +8.766141424102256e-01   +6.192122521097410e-02   +4.776196086059561e-01   +4.884353058106961e-02   +8.317171782043055e-01   +9.809847420859272e-01   +3.370021338786734e-01   +5.022938019891386e-01   +2.980536901803960e-01; +2.413364787152663e-01   +9.404630606297922e-01   +1.931494047042108e-01   +5.742976804563497e-01   +1.846476386719303e-01   +6.174527781769854e-01   +8.114046640852153e-01   +4.321655156638193e-01   +8.954121753171959e-01   +4.982439672901841e-01   +1.177886627854171e-01   +1.308846134091486e-01; +1.265174628874455e-02   +9.481736905766233e-01   +6.523698075626299e-01   +8.806911200901736e-01   +8.698838770533355e-01   +8.531838554619681e-01   +6.276322886535480e-01   +3.481272192698831e-01   +7.289568289752293e-01   +2.655970357269543e-01   +9.363644678609860e-01   +4.362400618170169e-01; +5.532514137938995e-01   +9.950776103922819e-01   +6.716086285034391e-01   +6.801581788095965e-01   +7.011161024311754e-01   +7.226767529430261e-01   +6.229336383040776e-01   +5.481897716692515e-01   +6.762657487699619e-01   +1.192525522271801e-01   +9.937828529237804e-01   +5.414563214834922e-01; +1.782421788740960e-01   +8.018566651325727e-01   +5.729452278664902e-01   +8.947600375425740e-01   +4.886066334181508e-01   +9.554604835927207e-01   +7.364231430540531e-01   +2.246394065728997e-01   +7.232437533794461e-01   +7.549955422711351e-01   +7.508359468418063e-01   +2.024445885901437e-01; +9.647583928535127e-01   +5.925053230376240e-01   +7.290668035974296e-01   +5.479493368250633e-01   +9.749702682665926e-01   +4.260520695380676e-01   +1.827517864537733e-01   +6.638169310672294e-01   +5.731474321139115e-01   +1.171573450583836e-01   +9.735208352445673e-01   +7.512679870924392e-01; +8.365033069967834e-01   +6.349486522711646e-01   +3.735299210655644e-01   +1.993601452028064e-01   +5.480210814178330e-01   +2.443964441481254e-01   +4.152961849075049e-01   +2.983736611038488e-01   +5.620428832872201e-01   +5.127609190265867e-01   +6.302944777050471e-01   +2.331147438905583e-01; +4.924067540411635e-01   +5.634854900413270e-01   +5.631262637453577e-01   +9.670221424292957e-01   +9.111222774926350e-01   +4.392401507157820e-01   +9.433598861415760e-02   +7.329880641128252e-01   +8.955923893694867e-01   +9.354428906579983e-01   +9.451832835549649e-01   +1.536677382714399e-01; +6.844667787945745e-01   +9.272566149083705e-02   +4.047340676699364e-01   +8.918633013797631e-01   +3.806635558247353e-01   +8.373125719254676e-01   +2.414261205460496e-01   +4.408577510833320e-01   +8.851518858959473e-01   +6.642666320744293e-01   +7.520473828854547e-01   +6.942670022628723e-01; +9.414519406952165e-01   +8.779817550941471e-01   +9.399544047664727e-01   +3.077670834245416e-02   +3.405947686929951e-01   +4.087625967600961e-02   +6.502766596999228e-01   +8.281567162985951e-01   +5.794094851161437e-01   +3.675697862344205e-01   +5.494690795826411e-01   +7.042305172463198e-01];
L3E_L3I_iGABA_netcon = [+1.334875816495823e-01   +4.087492677595416e-01   +7.700900950541923e-01   +3.370605838169372e-01   +1.911223283129231e-01   +4.167230509472470e-01   +2.411028011200322e-01   +2.017883784582172e-01   +8.602015625715465e-02   +5.088234667055506e-01   +2.667619272609234e-01   +2.128730034441570e-01; +9.629846153602790e-01   +3.249780441189395e-01   +6.397159909801873e-01   +1.674343417173433e-01   +7.302525545789676e-01   +1.770541568084626e-01   +9.563736457358051e-01   +3.935730292474628e-01   +4.274610908887974e-01   +4.044784940659885e-01   +4.329271703093481e-01   +3.119061709342152e-02; +3.516186429324869e-01   +8.346490711796838e-01   +5.104308160888007e-01   +6.317551630481755e-02   +8.816899481844375e-01   +5.908133110503957e-01   +7.136011973111483e-01   +2.436033069008638e-01   +4.057445680995379e-01   +8.592178877558437e-01   +1.624517240917346e-01   +8.619734741645172e-01; +6.469141147321976e-01   +6.963522004615664e-01   +3.991220890790605e-01   +7.205662741571496e-01   +6.241829935692832e-01   +3.903802411731803e-01   +4.448156982496841e-01   +2.371810573095772e-01   +6.758155566284875e-01   +9.801064126378680e-01   +2.900759583785879e-01   +6.253124293978459e-01; +4.795968210093797e-01   +7.414292003435762e-01   +9.786801618786048e-01   +1.373508594017607e-01   +4.561047576143751e-01   +4.955333883108495e-01   +3.522923358620125e-01   +1.669566314020984e-01   +3.842773935913205e-01   +6.299628900439466e-01   +8.662913280244356e-01   +5.126716027461601e-01; +2.271579797903115e-01   +7.749435628739632e-02   +6.623262111025899e-01   +3.803965121117692e-03   +6.642861619807308e-01   +5.654385542951723e-03   +3.078698346550388e-01   +8.127777116639592e-01   +3.326288821729744e-01   +7.121870826661922e-01   +6.760232011312004e-01   +7.132244703380708e-01; +8.272986250342851e-02   +7.452951492047235e-01   +7.032167669988689e-01   +9.878360005728616e-01   +9.072316192992199e-01   +3.620680437744003e-01   +9.219623319734216e-01   +2.854296080303651e-01   +9.794217818715822e-01   +7.176575025210619e-01   +1.111836519135688e-01   +5.949884608365522e-01; +1.352782125257765e-01   +8.319614949496054e-01   +8.109221962800269e-01   +3.685907824573176e-01   +9.150543073402414e-01   +8.606044186033665e-01   +8.323188830848938e-01   +3.009910227423147e-01   +3.881125296127679e-01   +6.013889691550488e-01   +1.899640625140299e-01   +2.123237282821633e-02; +4.499315424961716e-01   +3.933474743630705e-01   +4.395900156923265e-01   +9.306470164080320e-01   +4.609945904610534e-01   +3.836560924668047e-01   +8.483084331805943e-01   +2.446949753527260e-01   +6.725775143805388e-01   +5.687904694639947e-01   +4.606194031408217e-01   +5.131202264175047e-01; +6.229089448588465e-03   +3.645329515009011e-01   +2.249052267747229e-01   +2.162356242176992e-01   +5.955165308609661e-01   +9.542571611060023e-01   +9.601821411281186e-02   +8.991509411835739e-01   +8.295221715097023e-01   +4.051564281384664e-01   +3.899358831555116e-01   +6.920605211325455e-01; +5.035024999155076e-01   +8.601150998968079e-01   +2.509332484334698e-01   +6.290548525288133e-01   +1.388581191247920e-01   +5.599482669563247e-01   +2.314747929706220e-01   +6.879082406859661e-01   +8.823834970504913e-01   +1.425053892698532e-01   +7.083033383446954e-01   +4.383905485928926e-01; +9.014039499195861e-01   +6.895470656667855e-01   +9.943905786752493e-01   +6.889725387026409e-01   +7.525208316727351e-01   +7.279828427686225e-01   +4.819656518022197e-02   +6.181754053847871e-01   +5.592447225150576e-02   +2.174165431479320e-01   +7.976276059185199e-01   +9.455545966202250e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last =  5.6 * ones(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last =  5.6 * ones(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 10*((exp(-10*((t)-( 50))^2)));
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = -10*((exp(-10*((t)-( 50))^2)));
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 10*((exp(-10*((t)-( 50))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = -10*((exp(-10*((t)-( 50))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
