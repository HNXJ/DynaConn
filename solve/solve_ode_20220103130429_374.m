function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+3.600219666222443e-01   +7.665080533489030e-01   +9.031962810876143e-01   +1.890425791501451e-01   +2.346951505785083e-01   +7.128378695453521e-01   -8.415137287647856e-02   +4.059067177110807e-01   +2.531563563198518e-01   +2.390539910411297e-01   +4.015264235175277e-01   +1.574521077141237e-01   +4.908398210055489e-01   +2.736102137225336e-01   +2.533808669703993e-01   +4.277955955075821e-02; +6.633762412064236e-02   +9.364143008022139e-01   +8.345467083167741e-01   +7.646992975412081e-01   +3.292169887287882e-01   +7.319336156865496e-01   +7.074486066531229e-01   +1.389963420169310e-01   +1.465634954816764e-01   +7.605876861973532e-01   +5.671534970043061e-01   +6.217837438894978e-01   +4.534168148116279e-01   +2.384225203011551e-01   +6.686698249594011e-01   +2.235000545065717e-01; +2.486677450681316e-01   +3.286799796001329e-01   +3.775809156999982e-01   +5.520483332330238e-01   +5.957620353011864e-01   +4.113131929520107e-01   -1.402275252006984e-02   +6.705232171095599e-01   +3.026722319641043e-01   +5.155506802054802e-01   +8.060524405775277e-01   +2.365219323794909e-01   +4.405062951372917e-01   +2.774501188165025e-03   +3.512529396758587e-01   +9.544800236493181e-01; +1.966469541311477e-01   +6.340202195116719e-01   +1.077432151980818e-01   +2.627410880913871e-01   +8.524026564500594e-01   +7.839092338629011e-01   +1.734828179656077e-01   +5.818382677542498e-01   +7.562335520221050e-01   +4.083670881567938e-02   +2.086971219333024e-01   +8.552953431474621e-01   +5.210161781192363e-01   +1.838919399618742e-01   +5.910400598501050e-01   +4.815959551377511e-01; +9.286444404327684e-02   +7.299165509748647e-01   +8.130094916213279e-01   +7.691863742418241e-01   +4.997372085394021e-01   +3.370544840499521e-01   +4.710003888047244e-01   +2.876796732109068e-01   +2.921548553750816e-01   +4.782446955330591e-01   +1.970397843636686e-01   +6.587867300284733e-01   +3.838295680511057e-01   +7.820273870333984e-01   +2.124753867939786e-01   +8.792820116539254e-01; +1.064221638304816e-01   +2.065614385327401e-01   +7.023172067785399e-01   +7.507136203890596e-01   +5.620585011742890e-01   +8.662281794454392e-01   +3.107791742932603e-01   +4.176116986628378e-01   +8.635359920216175e-01   +8.859943625345945e-01   +8.474884393781436e-01   +2.193486984855665e-01   +4.023512833687320e-01   +1.465743109307921e-01   +8.491122969580699e-01   +3.799874891717021e-01; +2.969985446573389e-01   +7.335650826796075e-01   +5.284004249427267e-02   +3.876896737880745e-01   +7.967040867451592e-01   +5.111860256396605e-01   +4.558934021459224e-01   +5.902387677520032e-01   +8.869144613410612e-01   +9.105620637732279e-01   +6.616000969865863e-01   +9.156477229005312e-02   +3.374769230824585e-01   +3.855637966280054e-01   +6.728487650789089e-01   +8.690207573733978e-01; +7.029591535997957e-01   +7.041459318689083e-01   +7.555522518361889e-01   +3.188761281941366e-01   +6.420364670917780e-01   +5.015282301813337e-01   +8.489756922686065e-02   +4.162808857282419e-01   +1.000000000000000e+00   +8.635402041664684e-01   -8.440954486475787e-04   +7.351889023186967e-01   +7.899326915589872e-01   +5.640521511344384e-01   +2.764586161225063e-01   +8.194682127147991e-01; +4.723808542721285e-01   +7.077593969121136e-02   +2.565412463091239e-01   +2.360521186261002e-02   +4.620147204709252e-01   +1.538721203390182e-01   +4.870519544562645e-02   +5.572489154373617e-01   +4.702708766922211e-01   +7.394994520042945e-01   +7.690903305786747e-01   +5.311315191583575e-01   +2.665028875747059e-01   +1.431437093460327e-01   +9.704309229462786e-01   +7.577321644973088e-01; +6.658174297546063e-01   +5.290523213506106e-01   +5.489389430378161e-01   +2.540506210676652e-01   +4.384054163776181e-01   +3.504267740994264e-01   +4.731243492030632e-02   +2.397767133722773e-01   +8.502854718954626e-02   +7.908388104446636e-01   +3.218788652896504e-02   +7.564278339128712e-02   +3.127711711090433e-01   +7.379840972842289e-01   +3.136160227127749e-01   +7.819009670788307e-01; +4.136169239586309e-01   +5.979265408567477e-02   -1.983034079702735e-02   +1.579798051780880e-01   +9.267569817710819e-01   +5.965834322732966e-01   +2.597637426284036e-01   +2.222991912764714e-01   +2.117300250293798e-01   +8.339233079748060e-01   +1.057655290575934e-01   +7.391376563874135e-01   +5.056885669797307e-01   +8.167555062425029e-01   +3.149170322368930e-02   +1.022864374168703e-01; +1.622454315925531e-01   +1.897086546954570e-02   +9.368175642231952e-01   +4.716899632192271e-01   +6.704066670497166e-01   +5.298056018246017e-01   +7.005948762483341e-01   +3.779616546894699e-01   +6.472110722272696e-01   +1.049034989799794e-01   +3.119894288310401e-01   +7.512758993433450e-01   +7.499430232782643e-02   +4.969707826521856e-01   +3.942770041609487e-01   +8.478013504520114e-02; +4.524530207843121e-01   +3.251693202163879e-01   +6.134643108265393e-01   +2.385368205844692e-01   +7.373022112385340e-02   +4.891320301133656e-01   +4.515281877592740e-01   +7.076384781554198e-01   +2.890891194015875e-01   +8.923316828633350e-01   +1.571557570676142e-01   +4.090915578234923e-01   +1.983492027616097e-01   +2.299294997409799e-01   +3.026928140303996e-01   +2.427640162497360e-01; +1.338813642042497e-01   +8.778517074524450e-01   +7.333084039694103e-01   +7.112236075545166e-01   +7.541389032283741e-01   +5.403644957983582e-01   +2.836968118190873e-01   +7.649368674966214e-01   +3.568334472208081e-01   +4.485110377208411e-01   +9.013452591223485e-01   +6.202371312982891e-01   +5.559971419981338e-01   +5.240734401316122e-01   +1.467663075763577e-01   +3.774703172967503e-01; +1.231813465354525e-01   +2.005995222518068e-01   +8.246246466728870e-02   +3.803505083451931e-01   +3.742278530482192e-01   +7.050987304152334e-02   +6.363725868643160e-01   +2.960641219786915e-01   +8.150426647593194e-01   +5.065690726300081e-01   +1.145534523173293e-01   +8.190193126217352e-01   +6.501593716661256e-01   +1.690732099982071e-01   +7.082929064199531e-01   +1.365109845609737e-01; +5.437093420222437e-01   +2.407460951510413e-01   +2.929211389222873e-01   +6.078662381062641e-01   +5.198417391705048e-01   +5.755550155907564e-01   +2.502114214200440e-01   +9.551123482512580e-02   +5.581420082365819e-01   +4.865575669821354e-01   -3.972707375053272e-02   +3.812158393752640e-01   +2.113343802996170e-01   +8.820943273696212e-01   +9.116453884069280e-01   +5.823957679517580e-03];
L1E_L1I_iGABA_netcon = [-6.364253522714657e-02   +2.655637949655638e-01   +9.119976683601321e-01   +2.217746872244082e-01   +4.322947804008828e-01   +1.159337209717970e-01   +2.938073595706147e-01   +3.849286511105679e-02   +2.253608317531048e-01   +4.003035660514891e-02   +4.042457328097611e-01   +9.569125687088191e-01   +1.769043843763643e-01   +8.042103695341184e-01   +8.873483547118412e-02   +4.104244554332580e-01; +7.760036562750863e-01   +7.685625382154602e-01   +5.113859408815500e-01   +8.449129531489519e-01   +6.993478658898198e-01   +8.419114941438939e-01   +6.084204644538536e-01   +8.389731579181348e-01   +9.179048703292901e-01   +9.303892886337198e-01   +1.381904243027031e-01   +1.190377306292410e-01   +5.799636725977054e-01   +9.414019916112588e-01   +9.953284910021521e-01   +2.605088910153340e-01; +3.070469646258272e-01   +8.129751248959387e-01   +1.035576748989744e-01   +1.330045009661668e-01   +1.128861658327580e-01   +2.463695562368610e-01   +5.830066719681597e-01   +8.194344872644400e-03   +1.973240499467414e-02   +1.152169739664429e-01   +4.867632047395278e-01   +4.166803159291105e-01   +8.061115305636065e-01   +8.264573020241084e-01   +8.227810692606007e-01   +7.678399964802142e-01; +3.676440219017489e-01   +5.268907525137532e-01   +5.861842542689149e-01   +7.663957978229042e-01   +6.587209381428965e-01   +5.998505478151310e-01   +5.454206345869835e-01   +8.874247065365443e-01   +7.119123452030415e-02   +2.964181517423574e-01   +5.405664637917876e-01   +2.655424828381006e-01   +8.049023960674738e-01   +3.922805136324750e-01   +9.114361495477089e-01   +5.200942690960371e-01; +7.051124666946058e-01   +5.878384448076799e-01   +8.712869889360018e-01   +4.059397356235648e-01   +9.537193777760763e-01   +5.144060115675276e-01   +3.564590674492381e-01   +4.383446649861331e-01   +3.203087891119050e-01   +4.529390557519952e-02   +2.072594081641597e-02   +5.973991006938242e-01   +9.276912620434258e-01   +8.014089224190147e-01   +1.306926090960840e-02   +1.470792233400779e-01; +2.329572265520022e-01   -2.491175996570753e-02   +3.251487246101520e-01   +2.079120576154841e-01   +2.230233168076992e-02   +5.039450159890956e-01   +8.837131749293003e-01   +3.031810028636188e-01   +5.240153216710408e-01   +4.266990952443543e-01   +8.885063535636289e-01   +1.961627744281876e-01   +2.412666711903733e-01   +2.018829782097046e-01   +7.166998643024710e-01   +3.907672109067555e-01; +7.144157764995904e-01   +5.336985772009104e-01   +3.310466189823054e-01   +8.082776166876638e-01   +2.901981739121903e-01   +8.423589271312982e-01   +6.203355702227739e-01   +5.173223853958479e-01   +8.251214747748554e-01   +6.232722179263683e-01   +8.579441525117021e-01   +2.733097379960026e-01   +8.235687103075430e-01   +5.980446286560243e-01   +9.431825699426505e-01   +7.517333444329112e-01; +9.258691742822894e-01   +1.379083217171159e-01   +5.976535746297910e-01   +4.816743043061619e-01   +6.532704027542081e-01   +1.917966989384238e-01   +3.651415589394927e-01   +5.710775157877059e-01   +2.002114982908809e-01   +8.382037913711201e-01   +7.464185921794541e-01   +8.882530735207949e-01   +2.703379493514198e-01   +7.341860443838770e-01   +4.975112561733406e-01   +6.173365164103153e-01; +5.472425212179292e-01   +9.234043726489748e-01   +4.051261156930568e-01   +9.683136749505740e-01   +2.725184133584380e-01   +6.837564111478270e-01   +5.610211531937318e-01   +9.516534788270233e-01   +8.490351956296260e-01   +8.765170986512844e-02   +1.747881341447486e-01   +2.228491396967712e-01   +8.394913914037248e-01   +4.835284700682753e-02   +8.323866128923117e-02   +4.704664485284033e-01; +2.538483170438630e-01   +3.633697984009823e-01   +5.518964034599071e-01   +2.673235796360757e-01   +8.383270027739472e-01   +4.298992615902500e-01   +2.657601193345967e-01   +8.830542956704185e-01   +9.232513165334377e-01   +8.645678313798463e-01   +7.955980597474100e-01   +9.604741114514517e-01   +5.105076095796331e-01   +3.900314811942910e-01   +3.145168702118200e-01   +7.770809542826550e-01; +1.564934484678219e-01   +2.382705566797864e-01   +7.743172010010938e-01   +8.638325507532751e-01   +1.941728581582856e-01   +6.155509245437542e-01   +7.682541179567413e-02   +4.949633617237245e-01   +4.183596039427357e-01   +6.285450328449022e-01   +3.308588497044319e-01   +9.029216194297064e-01   +9.808539413552816e-02   +4.875406293200436e-01   +4.090909444115521e-01   +4.794740124038885e-01; +1.619237827038593e-01   +9.226877255309008e-01   +7.481120979975414e-01   +4.619020315570116e-01   +4.812683944639043e-01   +2.863574970961708e-02   +2.100202083282800e-01   +3.777789730859993e-01   +1.517260309014028e-01   +5.198303094418362e-01   +2.332402934844248e-01   +4.301309516867792e-01   +3.762403742852958e-01   +9.237567307040598e-01   +2.085618523236642e-02   +4.801600197769800e-01; +9.310884342978349e-01   +1.508937239694017e-01   +4.618236670713075e-01   +5.420063309046863e-01   +6.363494355151248e-01   +6.084095613066519e-01   +2.352476869124365e-01   +5.126168730019903e-01   +4.458231807844105e-01   +3.479196964349380e-01   +9.576165259024030e-01   +9.676320689225784e-01   +8.375732498187599e-01   +5.742170026544211e-01   +2.534983110306621e-01   +7.886787568646981e-01; +4.241127872713973e-01   +8.606567826633259e-01   +2.971837557872753e-01   +4.024696292202546e-01   +7.354523968764776e-01   +1.896536247834454e-01   +3.425333524269482e-01   +5.979660631820609e-01   +3.453741197620577e-01   +4.333587664346606e-01   +2.096379774516175e-01   +1.834954460780056e-01   +2.662344447991066e-01   +2.580905823218106e-01   +6.003398718532462e-01   +9.163309985684819e-01; +6.169374122342504e-01   +6.055817269925691e-01   +6.888869509307625e-01   +7.191678685602940e-01   +7.551799361116125e-01   +7.710418670325865e-02   +8.325780565763807e-01   +2.883125050928643e-01   +8.440109860086803e-01   +4.855412072383911e-01   +7.001545902299660e-01   +5.256183829898596e-01   +2.625132769283054e-01   +4.700348413981088e-01   +8.676407009122863e-01   +4.858604132252597e-01; +3.650180998503288e-01   +5.891668911743215e-01   +6.439102483709300e-01   +2.383248207850221e-01   +4.667889818677409e-01   +3.237107690456383e-01   +5.425756859457475e-01   +2.415264422876841e-01   +8.255538044992261e-01   +3.092294790392546e-01   +2.628917540632245e-01   +1.298297302246927e-01   +7.756224351229513e-02   +4.673747445388924e-01   +9.312312981699897e-01   +9.297690430768546e-01];
L2I_L1I_iGABA_netcon = [+6.449932278929836e-01   +4.433459276324578e-01   +7.440610151333037e-01   +5.541168177298891e-01   +9.269732367087209e-01   +6.536783927003963e-01   +9.027824308183694e-01   +6.096950308537336e-02; +5.023206844564477e-01   +9.806064457596377e-02   +2.167113396305056e-01   +9.296981889053340e-01   +1.821083867545546e-01   +9.178758172593593e-02   +8.380502633107690e-01   +6.987507707232329e-01; +9.894800703979140e-01   +5.193394077570953e-01   +6.379535750072814e-01   +6.490720861215451e-01   +7.913124841687171e-01   +6.928364942352561e-01   +3.126760872206752e-01   +2.094420767705586e-01; +3.380039169673776e-01   +1.563475004482276e-01   +8.934928371912508e-01   +4.142188015803011e-01   +7.630050378432297e-01   +3.204192827354216e-01   +8.907670880410374e-01   +2.054478209569381e-01; +7.056514557399151e-01   +4.598178274156667e-01   +6.544163044150201e-01   +2.610726538225286e-01   +9.186951542074419e-01   +3.579791730335718e-01   +5.359673569424976e-01   +2.340214131789177e-01; +5.593849219475052e-01   +5.877566635573893e-01   +7.559907915800511e-01   +1.830683640681914e-01   +1.986162637475366e-01   +8.218159138942677e-01   +8.944199179301403e-01   +5.785358522361038e-01; +8.771401568381951e-01   +4.690594996811124e-01   +2.133530869021394e-01   +2.692735542972634e-01   +7.372264151145174e-01   +1.610189081832277e-01   +6.313712005426098e-01   +3.335643348529048e-01; +9.562191694994528e-01   +4.150978089493316e-01   +6.197553758092931e-01   +8.888774325324538e-01   +9.934627481497481e-02   +4.017244155826293e-01   +4.542423684014184e-01   +2.378660427087892e-01; +7.037291112068915e-01   +1.711227724838469e-01   +4.517167089612701e-01   +4.326859308136896e-02   +7.495414418933712e-01   +3.915008448567144e-01   +7.503576750660609e-01   +7.278357962058913e-01; +4.646169216860626e-01   +8.404441219122697e-01   +6.691530698256886e-01   +8.152916444129624e-01   +3.836011688221477e-01   +8.352869032315079e-01   +8.596341795955945e-01   +2.443918231739637e-01; +5.163659720357944e-01   +5.857744387961931e-01   +4.712571659249616e-01   +3.949457861477866e-01   +5.876963791884213e-02   +8.746686926719698e-01   +6.350509776821656e-01   +4.323639920097703e-01; +1.207385487826003e-02   +3.924287965303821e-01   +3.632279067159589e-01   +4.385079900384650e-01   +3.396615531581910e-01   +5.134557883995191e-01   +2.801963462871968e-01   +5.312170766484239e-01; +3.834381089941380e-01   +1.889704652976420e-01   +6.432142591336720e-01   +7.387382089305815e-01   +2.123982025058096e-01   +6.613804395154447e-01   +3.679352892528929e-01   +7.194368914292343e-01; +4.784636538379852e-01   +4.473588570720740e-01   +6.767789388098855e-01   +3.597613552055628e-01   +8.126292919588670e-01   +4.192297951050347e-01   +3.703950302103314e-01   +3.215885494977694e-01; +5.673700345507909e-01   +1.675298657693886e-01   +2.500324877148121e-01   +2.595703728181154e-01   +5.870593705218602e-01   +5.659498388856219e-01   +2.883540018147723e-01   +7.041973723477758e-01; +7.571649211246271e-01   +6.926331492158962e-02   +6.940064585576816e-01   +2.909974012707613e-01   +3.548382582353652e-01   +6.007538426014678e-01   +1.113077174306188e-01   +2.776472306136740e-01];
L1I_L2I_iGABA_netcon = [+4.928867800720337e-01   +2.042068953735408e-01   +7.648720272490247e-01   +3.152964573069850e-01   +5.531687701234134e-01   +2.875386010273674e-01   +8.560126460370238e-01   +2.161385828152957e-01   +5.719787808737741e-01   +8.653187850894436e-01   +3.639814673842160e-01   +4.028469231731130e-01   -2.548740717871488e-02   +7.198906656460916e-01   +6.165922207372346e-01   +4.951955989688972e-01; +3.647727942353913e-02   +1.251194956592092e-02   +3.061282945685653e-01   +2.505971158382097e-01   +8.768271513536060e-01   +3.404149520611668e-01   +3.477526919307396e-01   +1.109040220796456e-01   +4.651486952641289e-01   +2.509745831004831e-01   +2.975157053784941e-01   +2.700550156415431e-01   +9.467967433857033e-01   +1.885666362865109e-01   +8.091025874058365e-01   +2.406640786334796e-01; +3.953448260986047e-01   +6.350431014164382e-01   +3.376759879617256e-01   +7.051755987278130e-01   +2.352627631690474e-01   +5.382495765663897e-01   +7.540460282463440e-01   +8.439286751052927e-02   +7.567281668674640e-01   +4.732931855364824e-01   +5.882631270806452e-01   +8.425502537970385e-01   +9.380788552375631e-01   +6.698432124508593e-01   +3.346023325437929e-01   +1.725283141097508e-01; +8.481360345990416e-01   +9.533284205260205e-02   +6.452175068962157e-01   +9.075008804066920e-01   +4.863813025934092e-01   +9.151826793663598e-01   +6.462635989170238e-01   +3.815872477184087e-02   +5.211792035484419e-02   +3.329182806245771e-01   +4.270826863736515e-01   +4.668274637607278e-01   +3.479026647904235e-01   +5.104770902910959e-01   +1.750439020102994e-01   +6.911178787606673e-02; +9.377057221054712e-01   +7.611455899409326e-01   +7.367481763539385e-01   +6.594516073825830e-01   +2.905694730137741e-01   +6.603565700194574e-01   +6.595754880834729e-01   +6.066019358085087e-01   +8.125275887631925e-02   +6.825078550961386e-01   +1.922161158055384e-01   +4.543266371333097e-01   +5.966651542159893e-02   +1.950736665203891e-01   +7.010638655751792e-01   +9.388533787053625e-01; +5.477444079573539e-01   +4.116045303585398e-01   +1.312586342159686e-01   +3.388376592711356e-01   +9.160650087231043e-01   +1.342745101742567e-01   +7.231687447793450e-01   +6.159023243016929e-01   +5.205055109742690e-01   +7.195543383325099e-01   +3.333349201092448e-01   +5.382630040361307e-01   +9.031096600188041e-01   +7.403070573173676e-02   +2.008337049833334e-01   +6.780407400717507e-02; +8.396994976405149e-01   +1.327263190273132e-01   +3.697669925812803e-01   +3.229696873052751e-01   +5.531517986074844e-01   +8.540222312875474e-01   +6.430012082342251e-02   +2.227329594079810e-01   +6.954832025595187e-01   +8.924854449262629e-01   +8.974496055329438e-01   +8.355894546669207e-01   +1.373686413168688e-01   +2.702967481305709e-01   +3.661950254293012e-03   +5.935377726496477e-01; +8.976442429786662e-01   +3.933668080673543e-01   +3.507308657503969e-02   +9.006829018579665e-01   +1.677953565193907e-01   +9.750918169710211e-01   +7.647133665243511e-01   +1.321575797279100e-02   +7.935845203871376e-01   +5.151445441755428e-02   +8.796831451150058e-01   -3.993960610079510e-02   +8.106065975818328e-01   +6.991293567829378e-02   +1.000000000000000e+00   +6.746788713490462e-01];
L2E_L1E_iAMPA_netcon = [+3.135452668339543e-01   +9.382094058678542e-01   +6.420568829710848e-01   +6.435289780025391e-02   +3.141568859534997e-01   +3.687858258504317e-01   +1.012527377112266e-01   +6.221541749612998e-01; +2.172020049994752e-01   +1.566583575948116e-01   +7.512880134629890e-01   +8.559580522462885e-01   +3.156960710088536e-01   +5.115257311421872e-01   +2.423217915938452e-01   +1.093862403183088e-01; +4.683206150702599e-01   +8.947032409260068e-01   +7.889438061148953e-01   +3.684277227561985e-02   +6.788994032618115e-01   -2.093990884939084e-02   +4.390586142041044e-01   +8.222760576940835e-01; +4.812426151905815e-01   +6.487360276425383e-01   +6.914571957631649e-02   +5.943652845813034e-01   +3.022303449125121e-01   +5.467464827389840e-01   +1.894041001207058e-01   +4.878083283218558e-01; +8.877123060437414e-01   +6.883746612610447e-01   +7.566528364685841e-01   +5.021826028626705e-01   +7.503475273711684e-01   +3.730500297567652e-01   +4.419691030317530e-01   +4.823730210221081e-01; +4.789321988920162e-01   +6.832139753896931e-01   +4.484491089008170e-02   +6.070005751627924e-01   +6.613519958633525e-01   +8.490194956164623e-01   +3.004148675966713e-01   +5.625528939803034e-02; +4.336986614308518e-01   +3.086347809745899e-01   +2.037403315916584e-01   +4.336586529329555e-01   +4.255979880055210e-01   +2.411837452240979e-01   +5.973463973281010e-01   +2.927815292285301e-01; +7.063763137419555e-01   +1.578642374076591e-01   -6.305778608556417e-02   +9.753372845981335e-01   +5.297108402514525e-01   +3.611315209154776e-01   +5.976248774480336e-01   +6.143484165971708e-01; +7.778271954847620e-01   +6.030921284036811e-01   +6.788553414497259e-01   +1.464160383195133e-01   +4.226764630476438e-01   +2.504786380988429e-01   +5.864546708590622e-02   +1.000000000000000e+00; -4.271437448320219e-03   +1.316682273920323e-01   +1.829780209396378e-01   +1.739095881073219e-01   +1.671436779911779e-01   +5.513144486140937e-01   +8.526854852768845e-01   +8.298251403869519e-01; -7.854498531347089e-03   +2.145043175151714e-01   +5.502968229006177e-01   +4.816132397082622e-01   +1.046372114715799e-01   +4.187523378657198e-01   +1.608639316540338e-01   +7.300350862527020e-01; +3.404050694936832e-01   +5.581728150026228e-01   +6.198550268504610e-01   +5.003427736572416e-01   +7.097892283343302e-01   +2.929136844622438e-01   +6.793297577271198e-01   +4.226572968923487e-01; +7.015957559686729e-01   +7.164426301867917e-01   +6.026218626368652e-01   +2.475474592594685e-01   +1.954790558255985e-01   +1.007395251643774e-01   +3.618620452150079e-02   +5.198969763903539e-01; +7.161889626594282e-01   +8.029972433725190e-01   +3.619837348125830e-02   +9.141932087757004e-01   +4.814794285201363e-01   +7.920388891704963e-01   +2.179666180519764e-02   +1.952024323977705e-01; +9.424534093114602e-01   +2.257304767967551e-01   +4.603739890996391e-01   +5.572847999226724e-01   +3.420007164021516e-01   +2.348811390079086e-01   +6.005088123806577e-01   +3.936802516678997e-01; +8.363274655764940e-01   +6.372552037598371e-01   +7.149480737349139e-01   +3.898333574228546e-01   +5.089299446355797e-01   +8.440698895752140e-01   +7.530372442314145e-01   +1.250688978201597e-01];
L1E_L2E_iAMPA_netcon = [+8.584550148385286e-01   +4.705027316652359e-01   +6.010560505018031e-01   +1.386953284828873e-01   +9.571099091128784e-01   +3.013206352605580e-01   +5.290749409600524e-01   +5.013592178708429e-01   +8.819870826453334e-01   +5.160815936387335e-01   +6.527711896558919e-01   +4.416221137102410e-01   +5.179864281939623e-01   +3.552750511518051e-01   +5.909528151828572e-01   +2.710469152298781e-01; +7.664517059476643e-01   +1.513272900211043e-01   +9.009368542184312e-02   +5.468433199015956e-01   +8.049188200427441e-01   +5.948212499436533e-01   +8.932764747213170e-01   +2.453098363759537e-01   +3.840459900441278e-01   +3.032115640731876e-01   +6.755570871344849e-01   +6.367628708844655e-01   +6.962204674493336e-01   +8.789004692530279e-01   +3.773568988775184e-01   +5.429915485232791e-01; +7.442893211325912e-01   +1.281886488848546e-01   +1.844518913061429e-01   +9.982895005682391e-01   +1.771387758631298e-01   +4.003619100236364e-01   +8.660529703647001e-01   +3.054503897600341e-01   +1.854558086692099e-01   +6.026109282064167e-01   +7.511895256283176e-01   +4.876435427837723e-01   +8.199374512080554e-01   +9.503457550756058e-01   +8.255242051931843e-01   +6.180469707593739e-01; +6.780380449212541e-01   +5.304286741399700e-02   +5.523073003000526e-01   +3.281911202774212e-01   +4.353336728701972e-01   +8.062083426493144e-01   +1.940758083006444e-01   +1.578427283036768e-01   +5.884930711472156e-01   +4.481579502334935e-01   +3.786504036651791e-01   +9.172776766949142e-01   +7.147747015374873e-01   +3.094688037692338e-02   +7.551398693976752e-01   +7.924619223401940e-01; +2.567838011580157e-02   +2.027578873726097e-01   +1.417542059760686e-01   +7.413012905487686e-01   +1.835492304126005e-01   +4.532752784968301e-01   +9.621657821950365e-01   +3.228661721135438e-01   +8.442027227259993e-02   +7.295582185320018e-01   +8.658656454772724e-02   +5.064579229996461e-01   +6.002054422590684e-02   +6.254441031612986e-01   +4.173469699847033e-01   +1.322026995632963e-01; +6.279618474988933e-01   +4.551071637829687e-01   +4.067168967390454e-01   -1.225724602858197e-01   +8.686000182771945e-01   +1.275425753964006e-01   +4.679181516634316e-01   +1.797368246575984e-01   +7.254175301978989e-01   -2.545448730072469e-02   +7.334238465785257e-01   -3.907235877438191e-03   +7.133397733666332e-01   +5.119708457221350e-01   +7.040168331757747e-01   +3.296839052901374e-01; +2.583858900892929e-01   +6.676044232066817e-01   +3.267027410931500e-01   +3.973408878841623e-01   +3.240466171822096e-01   +8.896862220077005e-01   +8.980671617906699e-01   +4.283997067753617e-01   +6.694204282528703e-01   +7.668176562180157e-01   +7.073519247534361e-02   +1.266674322546670e-01   +1.135847054167855e-01   +3.783262533728795e-01   +2.982913409358562e-01   +7.557475647060934e-01; +1.629840765705170e-01   +4.398846887912858e-01   +2.786292204193633e-01   +4.720006721085755e-01   +9.390878628821265e-01   +4.777097281075769e-01   +9.355030662401003e-01   +8.473682829057544e-01   +3.790247942699466e-01   +3.238194545008176e-02   +4.081979747675148e-01   +3.951406628177836e-01   +3.476666254864288e-01   +6.804669364093550e-01   +8.139106368076245e-02   +5.127851070400075e-01];
L2I_L2E_iAMPA_netcon = [+3.192218907352961e-01   +2.768167839003624e-01   +3.198279689063355e-01   +5.724546924092018e-01   +1.816991094128091e-01   +8.122830750823283e-01   +6.873977958453906e-01   +2.416762837251458e-01; +4.768212644498447e-01   +1.527264541468559e-01   +6.897771210827941e-01   +2.681910086689082e-01   +6.916031830908731e-01   +7.999509528280913e-01   +8.170247139302195e-02   +4.912908116625678e-01; +6.478814327256494e-01   -8.502669507826511e-05   +6.924749234762776e-01   +6.031310323303977e-01   +1.223090571291092e-01   +6.109276877762334e-01   +7.462270866142605e-01   +7.863326554140657e-02; +5.224380688092566e-01   +2.666966303577098e-01   +5.420669221142281e-02   +9.270661921776240e-01   +3.670735166647153e-01   +6.440129530781842e-01   +9.962779278555970e-01   +1.734603784410328e-01; +1.462860096733312e-01   +4.597321558623592e-01   +4.553319508486095e-01   +8.317151101219287e-01   +8.530476710579386e-01   +5.477253116698291e-01   +7.322333044306558e-01   +2.425577710070176e-01; +9.068963036728835e-01   +5.303079472314698e-01   +8.898650254787781e-01   +9.077817685221119e-01   +6.758017952611263e-01   +8.492552487968920e-01   +8.379084803012335e-01   +5.084549619427600e-01; +1.171592483460100e-01   +5.484202309099122e-01   +9.046906479515535e-01   +8.705063741477828e-01   +1.065295219877349e-01   +7.487829195120334e-01   +2.607526966705477e-01   +1.412764194073490e-01; +5.829028208093715e-01   +3.732555179560703e-01   +1.481084247450938e-01   +2.685651547831709e-01   +7.273346289321089e-01   +4.045319101643700e-01   +9.628992743067118e-01   +6.193328844008504e-01];
L2E_L2I_iGABA_netcon = [+4.160976095546752e-01   +6.067361571240696e-01   +5.778660181807341e-01   +6.517406304707701e-02   +4.279832487526727e-01   +4.918149480680092e-01   +3.071911915208342e-01   +7.348755048798830e-01; +4.349969517995697e-01   +3.564010880354523e-01   +9.510591448885636e-03   +4.921381796768478e-01   +4.408037998589991e-01   +6.229669699286778e-01   +5.087432492107350e-01   +4.371873119633620e-01; +5.531564810055467e-01   +5.389213047281004e-01   +3.933320615686814e-01   +5.865951389816456e-01   +2.971833235948896e-01   +2.769806276987114e-01   +1.846686691608168e-01   +9.788519001227444e-01; +7.556239886665425e-01   +5.636837744017394e-01   +3.692371060926828e-01   +8.936670464069398e-01   +2.276324931709246e-01   +3.520923153663567e-02   +1.477602497994576e-01   +3.604686144024009e-01; +5.208139816186725e-01   +7.834808380415592e-01   +4.766189529765392e-01   +7.734512885574096e-01   +3.751154961658567e-01   +6.796284317042155e-01   +6.237351156088634e-01   +3.883926178248835e-01; +3.873881378184479e-01   +2.613046198489860e-01   +4.299546378812953e-01   +4.006987688680541e-01   +7.772782736740579e-01   +8.144060887909781e-01   +1.407388371930437e-02   +4.582859935605250e-01; +4.293929920452373e-02   +4.838888944817789e-01   +8.075099872705718e-01   +6.061865612499309e-01   +4.968142862345055e-01   +3.898355126182149e-01   +8.887834278462312e-01   -4.717319773768591e-02; +8.958506307827970e-01   +5.446372533716125e-01   +8.757107361436162e-01   +4.777983607286551e-01   +8.869758317692878e-01   +5.382356028188623e-01   +3.281535383530297e-01   +3.346725889650895e-01];
L3E_L2E_iAMPA_netcon = [+2.877907273047380e-01   +9.137569296211070e-01   +4.784246469693788e-01   +7.845763933132994e-01   +1.779902312972157e-01   +4.071726007472926e-01   +3.543571321680266e-01   +1.049087473395369e-01   +1.665197419046117e-01   +5.496914816357155e-01   +1.365399422381011e-01   +4.990857801522274e-01; +3.038683135739037e-01   +4.864261002666884e-01   +1.637369902580827e-01   +1.980588540834008e-01   +5.932269692628275e-01   +9.263627512045267e-01   +6.786469315877739e-01   +5.712394038637836e-01   +2.321871748995375e-01   +5.846491922899895e-02   -7.636854665976261e-03   +7.486356152038236e-02; +7.861510797635094e-01   +3.653024067380457e-01   +5.441706532620109e-01   +1.547691751277169e-01   +8.530126602707434e-01   +8.971723568282307e-01   +5.496697866147241e-01   +5.925698477951487e-01   +7.363530693872746e-01   +3.660644063991680e-01   +3.946978288204109e-01   +8.909820136073632e-01; +1.734208605366098e-01   +4.800700128269416e-01   +1.622064966592650e-01   +7.876001704045200e-01   +4.913681309344474e-01   +5.681255951740785e-01   +8.689706585083889e-01   +2.862381901003627e-01   +8.506304547876189e-01   +8.332397800788194e-01   +4.524177994805879e-01   +1.690404452559354e-01; +2.348629160729409e-01   +7.692028301900337e-01   +4.129349455511228e-01   +2.499642370354065e-02   +2.150702051980733e-01   +9.806739021816643e-01   -1.672688250101247e-02   +6.649976785361266e-01   +8.053223323203854e-02   +8.684527560839023e-01   +2.854605361327914e-01   +2.434073773095359e-01; +3.376994883328658e-01   +4.127265425621274e-01   +8.440124942014621e-01   +1.000000000000000e+00   +3.824628520312334e-01   +9.272202035947132e-01   +1.056940892733730e-01   +3.769636932363918e-01   +4.925029520670984e-01   +8.361398357498724e-01   +5.763194480133530e-01   +8.631001788373132e-01; +1.971635514587763e-01   +4.831866235112974e-01   +5.709148112205199e-01   +8.776321366281073e-02   +6.298099346137226e-01   +4.944816494915518e-01   +7.808379338480870e-01   +1.197273164029678e-01   +4.403102057795704e-01   +4.304026749962279e-01   +9.933781912097134e-01   +7.358040523757688e-01; +6.036913133870431e-01   +6.679985647762221e-03   +4.127764497727113e-01   +1.414766455837246e-01   +2.914954271461456e-02   +8.737098708658860e-01   +4.140593468320403e-01   +4.517832305490924e-01   +8.569322060984711e-01   +9.997648553642510e-01   +9.496037680040608e-01   +2.854951376486038e-01];
L3I_L2I_iGABA_netcon = [-8.299467408269558e-03   +5.018989408356949e-02   +1.372281087952258e-01   +6.783370665866044e-01   +2.519897203763360e-02   +5.053957216477211e-01   +8.396309745037472e-01   +3.943723964773769e-01   +4.385637687232288e-01   +9.514304514230502e-01   +8.502407919468805e-01   +6.259949123319817e-01; +3.937059846987889e-01   +4.132684390351788e-01   +2.865955486461955e-01   -4.041028533312428e-02   +4.443430922136317e-01   +6.129801410567132e-01   +4.617184308214507e-01   +9.169353164491615e-01   +1.615894613620676e-01   +9.110666513046773e-01   +2.585824935414756e-01   +6.473395336493172e-01; +3.661218844066714e-01   +6.609906823543221e-01   +2.870940258522698e-01   +7.709037637343192e-01   +3.267605879788260e-01   +8.737740358483269e-01   +9.952803861173384e-01   +9.684601279001127e-03   +6.708450224455007e-01   +4.508718497534840e-01   +1.170937098745260e-01   +5.820318413250879e-01; +6.415093842082047e-01   +9.913356736048878e-01   +3.111248840973233e-01   +2.686161045908380e-01   +1.532970559834838e-01   +5.810919247382286e-01   +1.627823983792681e-01   +2.290288284709111e-01   +6.541389629885047e-02   +3.446550810881296e-01   +5.019788545049834e-01   +8.049916245758516e-01; +9.682471455316948e-01   +1.202302753914406e-01   +4.624015723435692e-01   +8.582878406388527e-01   +4.975451823157154e-01   +8.955296129669612e-01   +9.344297757631254e-02   +5.187835321136591e-01   +5.818764036938803e-01   +8.030574292604669e-01   +7.402021071351651e-01   +5.427993046911724e-01; +9.553813110935709e-01   +1.972729648375043e-01   +1.627371860044625e-01   +7.674109309881967e-01   +9.454739507910515e-01   +7.909732145967614e-01   +9.480304525881867e-01   +5.678952275932430e-01   +9.824605467123634e-02   +8.352020257401175e-01   +3.080035928149981e-01   +5.794586604743466e-01; +1.040024568266846e-01   +5.300528888575882e-01   +9.409404941360585e-01   +5.590914495036207e-01   +9.923136053530967e-01   +7.788735487282030e-01   +8.530697040082886e-01   +8.066858647299098e-01   +6.102604723529398e-01   +4.057114450211625e-01   +3.243411022902962e-01   +5.707703295847727e-01; +3.575945760896320e-01   +2.729948205371336e-02   +7.943040186945560e-01   +1.789311343042554e-01   +4.526553926465066e-01   +1.116270489721669e-03   -2.174121471013452e-02   +9.502978813442180e-01   +4.952996431141735e-01   +9.159112717209897e-02   +7.168687531286858e-01   +7.537448252009075e-02];
L2E_L3E_iAMPA_netcon = [+9.285181049077218e-01   +2.386609655799640e-01   +5.613078908577251e-01   +6.948547275123491e-01   -2.553291529793213e-02   +7.116427003650467e-01   +8.042514153264149e-01   +1.224513611028350e-01; +3.154837471332060e-01   +5.571085792313001e-01   +6.699840695309393e-01   +7.100020342821526e-01   +2.718534771310649e-01   +2.101345389173917e-01   +8.119632616506816e-01   +1.009018631171769e-01; +6.227996898907209e-01   +5.221632879723765e-01   +8.598508659056953e-01   +6.157559140520277e-01   +9.104922011795201e-01   +4.586154155715363e-01   +9.981659004291482e-01   +4.320216229789835e-01; +2.231290280283788e-01   +9.136527323025629e-01   +8.634424649119655e-01   +4.124123188123333e-01   +4.246913443910591e-01   +9.702024923121850e-01   +2.473786691699851e-01   +4.827560624036709e-01; +8.479177276862269e-02   +1.828262280475963e-01   +7.377640204478876e-01   -1.570765907875753e-02   +1.978664774879855e-01   +5.197400029611734e-01   +4.446995909006921e-01   +6.299691685421298e-01; +4.261562495348813e-01   +8.060781825447317e-01   +1.599320373335588e-01   +7.592872850005317e-01   +9.513197892774666e-02   -6.795394056752949e-02   +4.969489877824244e-01   +2.718610788826725e-01; +4.719623035303767e-01   +7.710970422584608e-01   +7.796241054221809e-01   +2.668297041428513e-01   +8.358809568235712e-01   +2.010441809357716e-01   +7.371373197722212e-01   +9.242630578512142e-01; -1.124161893717821e-02   +5.193458154741090e-01   +8.984491114192965e-01   +4.688875430154564e-01   +9.071234699478350e-02   +7.469091011040874e-01   +8.604345376092778e-02   +3.148989686355887e-01; +9.693760052072528e-01   +9.183057063010459e-01   +9.517619379492753e-02   +1.691637155116273e-01   +8.557720345200334e-02   +8.879451704538913e-01   +2.593637112336031e-01   +9.101149638942971e-01; +1.367900407914146e-01   +4.074624438663975e-01   +8.042557247201048e-01   +3.123809973109954e-01   +4.348070704449932e-01   +8.852761603907366e-01   +3.060443507576692e-02   +9.288582037948736e-01; +6.783290377922058e-01   +3.653058318760756e-01   +2.792019472094996e-01   +2.543280582445116e-01   +1.950842070994432e-01   +3.137574099044034e-01   +2.046449320090139e-01   +1.137767009302732e-01; +1.306444133396462e-01   +6.240227034069046e-01   +8.395368441963780e-01   +4.351328712432485e-01   +2.209528340009583e-02   +7.372303424152349e-01   +7.768284263459316e-01   +7.981901841065100e-01];
L2I_L3I_iGABA_netcon = [+3.430389526851582e-01   +6.581271592196606e-01   +2.787948770418421e-01   +6.497883764271566e-01   +5.030317533269077e-01   +4.075312900412514e-01   +4.032091426083971e-01   +4.761766632742001e-01; +3.481635640915847e-01   +9.754205441721578e-02   +3.793056972035284e-02   +8.384544268970323e-01   +6.942563383739696e-01   +4.760630940188330e-02   +9.032970539836468e-02   +6.243242365951788e-01; +3.081412105241321e-01   +6.279630989278371e-01   +3.987910546170906e-01   +8.575437568296600e-02   +8.456195921503709e-01   +6.310610353425742e-01   +1.857764468191978e-01   +1.220026948766340e-01; +6.115423345499520e-01   +8.276521556765294e-01   +5.495904127404639e-01   +4.379482645993279e-01   +5.310711627157064e-01   +6.491101489246197e-01   +3.717616822875439e-01   +6.407754812649352e-01; +1.115245166591249e-02   -4.648342999389125e-02   +8.009539196268678e-02   +6.923186834981218e-01   +2.074462678910521e-01   +6.315348849803925e-01   +4.352410491112995e-01   +2.589012238079012e-01; +5.356549577261667e-01   +3.746569570525630e-01   +4.207041517613992e-01   +6.838523589604604e-01   +2.223332675546099e-01   +8.233845832466128e-01   +4.002393355328774e-01   +9.467404559729535e-02; +1.960266357539526e-01   +3.106157851850900e-02   +3.969392362391187e-01   +9.955280555610253e-01   +6.690959274605724e-01   +6.275172113129862e-02   +2.561650434288501e-01   +8.701349896306392e-01; +2.039412071955716e-01   +9.086198969837334e-01   +9.031739432784945e-01   +9.072702786708930e-01   +4.779033742909169e-01   +1.166579711910086e-01   +7.191736927461952e-01   +1.378888894396667e-01; +3.359734575326557e-01   +5.344925478197211e-01   +2.572917592540381e-01   +2.005426651689793e-01   +3.967808789568775e-01   +2.495715326253847e-01   +5.689123696069222e-01   +4.516300831084353e-01; +3.706961692047415e-01   +1.865520351783086e-01   +1.972975381269982e-01   +4.104757997537004e-01   +9.413514337129576e-01   +4.883631207879552e-01   +4.581884404159033e-01   +9.290126771040539e-01; +5.910461964317064e-01   +1.087433878906035e-01   +3.334264450230688e-01   +5.368585858204621e-01   +5.070666520500091e-01   +6.638117973381833e-01   +8.962402302533894e-01   +6.118026394246977e-01; +3.703977140945955e-01   +1.702274760104193e-01   +5.983379831264338e-01   +3.260328507783434e-01   +1.336974356762199e-01   +3.281508684823307e-02   +3.096509538444813e-01   +6.700792765998409e-01];
L3I_L3E_iAMPA_netcon = [+1.282697096276496e-01   +6.726827370517515e-01   +6.782518649245514e-02   +1.635034981929966e-01   +2.824121873944568e-01   +6.234625348202143e-01   +7.961523618060762e-02   +3.518509439131749e-01   +5.135854193271443e-01   +3.581731678561784e-01   +6.317685753606438e-01   +9.023800133278357e-01; +3.930804239349674e-01   +8.260880909388274e-01   +2.764347927424753e-01   +3.476101196202451e-01   +7.188939990532146e-01   +4.509574642150806e-01   +4.304159207061709e-01   +3.723936435078055e-01   +6.529915797002313e-01   +2.863321917498224e-01   +6.710003611345773e-01   +1.656473617260073e-01; +4.771961623967096e-01   +3.454470428704576e-01   +7.619785597898189e-01   +8.841612699641905e-01   +5.522528651551877e-01   +6.226297778863393e-01   +1.000000000000000e+00   +4.487149825129635e-01   +2.216406149859528e-01   +3.166329394124816e-01   +9.374718493748511e-01   +8.544225286213575e-01; +4.961540763219213e-01   +1.350811651941937e-01   +5.485552894729554e-01   +7.168835134401663e-01   +4.415126149916549e-01   +6.165653967754757e-01   +5.587730212828073e-01   +7.087019363709340e-01   +4.930721739237489e-01   +2.279228968575264e-01   +4.246888633118591e-01   +5.048005525633757e-01; +9.225424269982840e-01   +8.155837503143289e-01   +5.896246092923255e-01   +5.288503908657849e-01   +2.733310012098343e-01   +3.038176346127548e-01   +4.709310343199267e-02   +2.457505591982567e-01   -1.309566518342891e-02   +2.744073242993724e-01   -9.627778173041807e-03   +5.332849858026929e-01; +3.855389805769131e-01   +1.955002918377847e-01   +6.669689939522463e-01   +4.435629153304033e-01   +9.691326170667404e-01   +6.235444968270931e-01   +3.010001328082184e-01   +9.492399448787783e-02   +1.855821964276737e-01   +5.815032947850999e-01   +3.412488051193147e-01   +1.208140732225741e-01; +4.818720942866801e-01   +2.460046764662741e-01   +8.376501822195532e-01   +8.753803927941158e-01   +1.356445456318398e-01   +2.794970547103236e-01   +4.226941329797913e-01   +1.379656834595429e-01   +8.990237796828631e-01   +7.176597940111363e-01   +3.073094681846554e-01   +5.383440767271195e-02; +3.837956828801585e-01   +4.220071990378554e-01   +2.953275937012187e-01   +6.009273118426360e-01   +8.541605691752227e-01   +2.550205883543094e-01   +4.025853041406133e-01   +3.062369520920383e-01   +3.041757176448928e-01   +2.639848250689799e-01   +6.867233102557572e-01   +5.713893556990735e-01; +2.982364224297190e-01   +5.016158750336202e-01   +4.100120246174738e-01   +5.891963080265316e-01   +5.654566113216175e-01   -7.367089774443294e-02   +7.596476749591968e-02   +3.404056342378504e-02   +3.034989389353764e-01   +1.938258443383578e-01   +8.513719482763855e-01   +9.012732353803214e-01; +7.175589586072544e-01   +5.728962812557125e-01   +6.219748091401850e-01   +4.395758523785437e-01   +4.756386888416458e-01   +4.153558517895171e-01   -4.413597700906944e-02   +6.737363319265424e-01   +5.978206185812251e-02   +8.953112627559839e-01   +4.506324405799827e-01   +1.281176633161593e-01; +3.557530662304239e-02   +2.755465732245341e-01   +6.168664014654981e-01   +2.692004198149088e-01   +2.548174481707643e-02   +5.265441010686202e-01   +1.053837618280310e-01   +7.656669798691934e-01   +6.988580902894680e-01   +1.331823018341502e-01   +6.640276469866081e-01   +3.228204843953980e-01; +6.280931060830008e-01   +6.802040555911970e-01   +4.178837559313632e-01   +6.237473138497694e-01   +6.530389052780006e-01   +3.665756369597705e-01   +2.874852722703692e-01   +8.201410979310180e-01   +5.878078140195389e-01   +4.099216607749551e-01   +5.324501740595792e-01   +4.084577670786249e-01];
L3E_L3I_iGABA_netcon = [+3.228279169837232e-01   +7.097224254140239e-01   +6.079150567847402e-01   +8.754858617648645e-01   +4.752690041518187e-01   +7.807490507181536e-02   +2.262642650585962e-01   +6.939022614849860e-01   +7.223728028439881e-01   +2.721602852786290e-01   +4.816008830060144e-01   +3.043540149520323e-01; +8.230080739693669e-01   +3.717797222037960e-01   +5.991513079298080e-01   +1.102936381340385e-01   +8.390399184303602e-01   +4.146524410862928e-01   +7.912781930952483e-01   +6.420295220223760e-01   +5.953809197748040e-01   +7.097004673738138e-01   +2.340603838081056e-01   +4.364860170242510e-01; +7.921938448876238e-01   +3.590619185818062e-01   +4.087593677964953e-01   +4.878102707186113e-01   +5.728774353705384e-01   +5.414566110084202e-01   +2.237045253942201e-01   +8.265704231020152e-01   +5.243238888824241e-01   +1.509208765454199e-01   +7.541408846062323e-01   +8.793020108061612e-01; +1.576177723730387e-01   +6.457012710589243e-01   +3.089386707870143e-01   +2.827614157031345e-01   +1.172423620025280e-01   +6.576194181195799e-01   +2.919750450368259e-01   +3.339799251787358e-02   +3.075054233225455e-01   +4.816907832199650e-01   +7.167961231298059e-01   +5.773238266380342e-01; +2.402712423446692e-01   +6.477197652119446e-01   +5.647491377266829e-01   +2.652628719090916e-01   +1.307251258939724e-01   +6.110081629641718e-01   +8.997673893598188e-01   +2.814941938607224e-01   +2.686730679464044e-01   +8.648447900173271e-01   +6.012288021700609e-01   +2.165868760462462e-01; +4.560261747772575e-01   +8.119963443154002e-01   +7.109854915466246e-01   +5.130760387091948e-01   +7.149310603509872e-01   +9.450787226659332e-02   +3.574176957116790e-01   +2.628595516629031e-01   +8.959969083417005e-01   +8.580421776651680e-01   +8.010017212650163e-01   +2.495532935474359e-01; +5.660040313482166e-01   +7.656838452189076e-01   +2.180817566082679e-01   +2.527538229121116e-02   +4.235865843637293e-01   +5.703216218003893e-01   +5.872095900050195e-01   +1.770164324565552e-01   +9.586212713687238e-01   +5.661614763115679e-01   -4.061926836557070e-02   +3.239090858094790e-01; +4.576241249367351e-01   +4.214362065635088e-01   +8.537547755357605e-01   +3.866719745057173e-01   +9.466186741706308e-02   +1.071157004688243e-01   +6.016273372301822e-01   +3.987719383359366e-02   +6.078340108672262e-01   +7.629071673405537e-01   +2.050914642317003e-01   +9.949952969100584e-01; +3.216305191674582e-01   +5.246051673501180e-01   +2.894674619414540e-01   +7.320561783069425e-01   +8.192740555831094e-01   +7.562402532338530e-02   +3.660850931372376e-01   +5.968875817426351e-01   +6.036176519647928e-01   +8.404291742639707e-01   +6.641299736328382e-01   +6.161053458650266e-01; +7.328860753695318e-02   +2.407076588912041e-02   +2.969466360295102e-01   +5.753859902188011e-01   +7.521213119713377e-01   +1.601524667241378e-01   +4.231880036987805e-02   +3.241843716430861e-01   +6.815305385369194e-01   +2.800680940080884e-01   +5.862394133418610e-01   +1.141389886570107e-02; +8.246466052218823e-01   +1.828710696118170e-02   +7.236624884482146e-01   +4.858048406899814e-01   +3.622329726374484e-01   +8.480417879077710e-01   +1.413232928287434e-01   +7.834446870036829e-01   +3.024929105485053e-01   +9.171398245157951e-01   +4.917448203236990e-01   +7.102511824374365e-01; +6.345762685794107e-01   +8.399640527749032e-01   +4.746102007782436e-01   +8.676578126977006e-01   +7.901401282650814e-01   +5.004387528065409e-01   +9.145340847900894e-01   +8.627123877838399e-01   +4.586415616681243e-01   +8.649115997605600e-01   +4.872396355037889e-01   +8.325776005469893e-01];
L2E_Input1_iAMPA_netcon = [+9.655459051152953e-01   +9.460304669922556e-01   +8.815866094344966e-01   +9.710136159972605e-01   +9.165114176869062e-01   +9.948382550225855e-01   +9.243881515403470e-01   +9.281544482728021e-01];
L2I_Input2_iAMPA_netcon = [+9.142448447676124e-01   +9.436019306229111e-01   +9.739058201431255e-01   +8.663385409920048e-01   +8.993829329656046e-01   +9.046420903768444e-01   +9.058153461522217e-01   +9.320650025248713e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last =  11.21 * ones(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))*0.4 + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.5*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.5*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))*0.9 + 0.5*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))*0.4 + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.5*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.5*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))*0.9 + 0.5*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
