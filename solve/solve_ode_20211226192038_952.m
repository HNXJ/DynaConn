function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-1.828629929477457e-01   +1.744017363237205e-01   -2.787485890037836e-01   +1.227483657036035e-02   +2.516857776700706e-01   -1.083182909263823e-01   +5.293826329636217e-02   -9.766862216115198e-02   -8.033940940044493e-02   -2.809338744213374e-01   -5.204980524293767e-02   +1.153036881455439e-01   -2.501250047506745e-01   +1.201720551070383e-02   -7.571340935999704e-03   +7.857048170696596e-02; -9.743303069756357e-02   -1.999964233196147e-01   +2.395411573165457e-01   +1.749040514446798e-02   -4.792589032679699e-03   -8.222424133949267e-02   -9.488413754137467e-02   +2.021292125014118e-01   +3.310369375962954e-02   +2.538345260111841e-01   -1.116480881438150e-01   +1.976475680675744e-01   -1.220799058454972e-01   -9.215210781132668e-02   +1.857547784201221e-01   -1.311079588162191e-01; +5.697691096794896e-02   -7.726084870740627e-02   -8.497994367369643e-02   -3.229150413768640e-02   -3.627931736882888e-02   +6.602889468049379e-02   -3.642959933583263e-02   +2.540003658335604e-02   +1.971650724856769e-01   +7.260386409546460e-02   -3.120378842081382e-01   -9.797752927804915e-02   +9.339330017883352e-02   +1.803787357736997e-01   +7.985203839976282e-02   -3.673045918570377e-01; -4.072647019066455e-01   -3.850036138082389e-01   -3.096127806307833e-01   -1.803961306529138e-01   +1.661340032734278e-01   -1.578148692757508e-01   -1.247974271915349e-01   -2.942000590220001e-01   +1.272865015070368e-01   -7.971840933575697e-02   -6.574248707695615e-02   -1.856758174945999e-01   -9.309766049791030e-03   +6.044724699307996e-02   -4.713040802281054e-02   +2.527378511893998e-01; -3.054556534850685e-01   -1.526909695411892e-01   -5.962411147899797e-02   +1.863038091776713e-01   +1.092071121131863e-01   +1.489751779693085e-01   -1.218657304843754e-01   +1.071953324018248e-02   -4.963540826466328e-02   -2.748681840121329e-01   +6.928768639827383e-02   -4.714554473033052e-02   -2.857803149991877e-01   +2.189030710046341e-01   +3.415798397515439e-01   +1.732340911083685e-01; +1.907776631308253e-01   -1.441143159169355e-01   -7.900806988262142e-03   +3.740113116982684e-01   -1.043773542250953e-02   -1.222666685560065e-01   +3.535417182384439e-01   -2.798636272285527e-01   +2.272041108113713e-01   -1.336574868186900e-01   -2.340304581849461e-01   +1.854718747213975e-01   +2.217856657347400e-01   +2.356561444621791e-01   +6.398488455931584e-02   +2.866325356857169e-01; +2.424793022038474e-01   +1.611298072630468e-01   -4.045347781619322e-02   +3.057436621284512e-02   -3.318203900282213e-01   -1.303785635172094e-01   -5.117934596167689e-02   +5.649346789275672e-03   +2.090563086025710e-01   -2.441151945033270e-01   +9.872083894741306e-02   +1.047232965390063e-01   -1.456523187487553e-01   -1.540470159447629e-02   +4.117799125802395e-01   +3.082516690221280e-02; -1.106983457300832e-01   -1.258012455996636e-01   -1.479135689898646e-01   -8.932928872847035e-02   +2.861723861096438e-02   -1.530342060915683e-01   +7.367967489701066e-02   -1.096975242107928e-01   -2.657569682278531e-01   +1.421277310827354e-01   +1.681006039966553e-01   +2.840094214744404e-02   -2.876613895461115e-01   -7.148065579431426e-02   -3.139200646345835e-01   -8.912472199195834e-02; +7.823741197844589e-02   +2.521497803233913e-01   +2.902633570959823e-01   -2.193718548201634e-01   -1.461229358160567e-01   -2.847987417391801e-01   +8.834784723859020e-02   -2.044639432289351e-02   -2.906738793716132e-02   +1.734568514250684e-01   -2.480602998585533e-01   +3.558962942529544e-01   +3.157094334841416e-01   -8.183752676549447e-02   -3.528209878442952e-01   +4.943843427672666e-02; -1.865673997083118e-01   +2.451835751758951e-01   -2.590232310149495e-02   -3.364267363187601e-01   -4.453476913039822e-02   -1.204164703980557e-01   +6.575279434134096e-02   -1.869800172342762e-01   +2.420857353886350e-01   +1.678552604944899e-01   -1.768931702853321e-01   +9.242782607244912e-02   -1.892212391728907e-01   -9.565008390050830e-02   -2.551556608474143e-01   -3.025985052206933e-01; -4.825144044453353e-02   +8.930428878493475e-02   -4.506693180946469e-01   +5.817888188243087e-02   +1.181579415510001e-01   -5.309692978610966e-02   +4.018441505767143e-01   -2.489215526483038e-01   -1.294135605220085e-01   +1.816477856858859e-01   -3.352580708368916e-02   +2.377956659165734e-01   +5.515638683662358e-02   -1.168930797660986e-01   -9.319581221773138e-02   -6.098626979467299e-02; +2.333453670931440e-01   -9.490248112863003e-02   -5.013849727204855e-02   -5.155278912495489e-01   -7.388407103049577e-02   +1.164112219479974e-02   +2.113102804582214e-01   -3.477218667438080e-02   -6.987807873818572e-02   -5.739132373871975e-02   +3.025279970694397e-01   -4.664875850728968e-01   -2.516050515826408e-01   +3.943343414958436e-01   -2.571895576578934e-01   +7.477952885028977e-03; +1.792674005170499e-01   +7.793621043592963e-03   +2.837318245954548e-01   -1.873345304299396e-01   +9.531932457872982e-04   +2.416599816533507e-01   -1.740236918307968e-01   +9.268393830873897e-03   +5.286171825855970e-02   -2.249419673249408e-01   +8.753298651532129e-02   +1.152807885840116e-01   +2.437635473499654e-01   +1.812541325409370e-01   -1.826470234588687e-01   -4.474247221943559e-02; +1.214126565498068e-01   +7.695402454600113e-02   -2.116239052096739e-01   +2.274299891672804e-01   +3.650444847239512e-02   +3.188746165670960e-01   +3.247018151741898e-01   +4.684460013683389e-03   +2.167908387137290e-01   +2.161350731425943e-01   -4.434310116084984e-01   +3.021963819305293e-03   -7.545847133550576e-02   -9.989629643349214e-03   +1.897965785583092e-02   -3.658827809989321e-01; +1.218027973385134e-01   -3.044646437913150e-01   +2.449892827277801e-01   -1.500879419137554e-01   +3.270992752191709e-02   -2.276028772313441e-02   -3.858361841959390e-02   +8.011131200312581e-02   -2.876705036477419e-02   -7.723980450030843e-02   +1.058364758787494e-02   +2.395174701854663e-01   +1.747115604162599e-01   -7.928098998302380e-03   -1.725011589192588e-01   -2.524180390991829e-01; +3.607538472347224e-02   +1.318832880014680e-02   +1.678771912869037e-01   +2.062041227307881e-01   -1.386967135635458e-01   +1.103705475478343e-01   +1.984959720843675e-01   -1.695164384742487e-01   -2.616247860284537e-02   -3.215198503107451e-01   -1.199371854545987e-01   +2.334971211506087e-01   -1.646285134618963e-01   -2.656895041233152e-02   +7.439114361362244e-02   +2.657050614426089e-01];
L1E_L1I_iGABA_netcon = [-1.656705666509270e-01   +1.816086256570483e-01   +1.163589648919137e-02   +3.325183310250456e-01   -1.549846904246785e-01   +1.162490716689431e-01   -2.101025178971895e-01   -5.371869223775358e-02   +1.774332983973980e-01   -2.772460146593314e-01   -8.819263172619400e-02   +3.155951540703429e-02   -2.908651480335958e-02   +1.389647086409233e-01   -7.099564665985009e-02   -2.821338155697059e-04; +7.627523884270365e-02   +1.379044738704586e-01   -2.958376276117094e-02   -9.867930166004513e-03   -2.651499699295283e-01   +2.091862577972776e-01   +1.301266932803877e-01   -6.269616052517735e-02   +2.830140405125556e-01   -7.231954833596163e-03   +1.585618767448851e-01   +6.426648196235919e-02   -1.901648374574442e-01   -2.937964262417567e-01   -6.949225465767785e-02   -1.580488422784032e-01; -1.920585765630311e-01   +2.678319482201811e-01   -1.409861869062720e-01   -3.509766082080716e-02   +1.135152159365363e-01   -2.524448814626873e-01   -7.317044003379439e-02   -5.639875311789724e-02   +4.597452542621311e-02   -8.588092352262786e-02   -2.655762892455812e-01   -1.020434966986767e-01   -1.007271821750172e-01   -2.290228335652078e-01   -3.633559426907579e-01   +3.007334397163122e-01; +3.066329219922407e-01   -2.457933038813482e-01   -6.155726489299996e-02   -8.836117583644885e-02   +2.678176090389024e-01   +2.833796156327290e-01   -8.168041042391322e-02   +1.930756635058149e-01   +7.331641149897278e-02   +1.791673693246339e-01   -2.121686313844232e-01   -4.348231545943868e-02   +1.174036405061774e-02   +6.957882623655078e-02   +3.461557061687626e-01   -4.630186076824989e-03; -2.123888387436099e-01   +2.009309599105362e-01   -7.312308497672806e-02   -1.312599704158564e-01   +1.023937969709307e-01   +9.817369867556008e-02   +8.740644746386372e-03   -6.435960089841128e-02   +8.627610252310572e-02   +5.810175373044378e-02   -2.233741346026236e-02   +8.326459621107668e-02   -1.493302714541004e-01   -7.612933527810022e-02   -1.203359227223208e-01   -2.957722708070875e-01; +3.040575531509652e-01   -2.203768210893832e-01   +7.411093626226295e-02   -1.830402064547988e-01   -3.018910095205617e-01   -3.492064438653104e-01   +1.092536841903093e-01   -1.069575026352977e-01   +1.024744070451190e-01   +5.908363311973475e-03   -8.453678249255184e-02   -9.989527650379676e-02   +8.582875060196947e-02   +2.738310666831018e-01   +1.145606611640786e-01   -2.082148335055615e-01; -2.115530206824086e-01   -2.931263184497086e-01   +1.628216663481757e-01   +2.489642197760786e-02   -1.831811976028949e-01   +1.076283520074213e-02   -2.520528665759831e-01   +1.559863353687260e-02   -2.384756845508547e-01   +1.354484045674388e-01   -2.695922146933364e-01   -1.355556826586939e-01   +8.867139459021628e-02   +5.644403835293491e-02   +9.751774553302286e-02   -2.095205269362339e-01; +4.743540558508248e-02   -2.570185749259622e-01   -2.378656746777480e-03   -1.683709082914020e-02   -7.350506686043848e-02   +1.892563507648448e-01   +2.329591293962015e-01   +2.499186426672757e-01   +2.847814393644968e-02   +7.410099024891648e-03   +1.413107244152360e-01   +2.641477959856260e-01   -3.865278986664067e-01   -1.199573389622325e-01   +2.532773998159124e-02   -1.369360527073408e-01; -1.559924698080651e-01   +3.318288037776593e-01   -1.779866298337207e-01   +2.714917915889874e-01   +8.793217778635767e-02   -7.025411999665115e-02   +1.682426815353311e-01   +1.531106485286361e-02   -1.162669843528491e-01   +3.476081725180536e-01   -3.851348155998749e-02   +2.319084635870286e-01   -8.207818250739064e-02   +1.381716493834687e-01   +1.903965229950408e-01   +7.691399908140081e-02; -1.939127158821272e-01   -1.982067223764268e-01   -4.175168201460654e-01   +1.381217389185510e-02   +7.218577510990268e-02   +2.307449508507605e-01   -3.270739298470342e-01   -6.900367098039045e-02   -1.624779667976804e-01   -2.455826125100882e-01   -4.315056671225463e-01   -6.465617022897760e-02   -1.247331654361043e-01   +6.849761451883138e-03   +1.145481583430377e-01   +2.852451548416665e-01; +1.754212446471960e-01   +1.096618055886145e-01   +2.002903649102419e-01   +1.680617146458079e-01   +3.524719267441777e-01   -2.249922973219592e-01   -4.127693463762405e-01   +2.217290484070031e-01   -5.070243594451165e-02   -9.876419388487157e-02   -5.247052620016953e-02   +2.468641817695865e-01   -4.527504358212071e-01   +1.550306155969322e-01   -9.547272979120386e-02   -1.279057456402249e-01; -1.122867198540149e-01   -1.400693804737906e-01   -1.984830219552721e-01   +2.531420165737291e-01   -2.704573712031897e-01   -1.323335054375861e-01   -1.238851347527743e-01   +1.443981550763970e-01   +2.892264672685925e-01   +1.451112386527625e-01   -1.139136356908993e-01   -3.465142210979969e-01   -3.276882324210599e-02   -5.070791522216664e-02   +4.181050422034588e-01   -1.972501029624444e-01; -1.169141777667133e-01   +8.982074041394172e-02   +1.800551609829192e-01   +2.058055095764366e-01   +1.939942003413110e-01   +2.103265852936556e-02   -1.516846405147700e-01   +5.434453099174913e-02   +1.597983266755934e-03   -2.336225693204916e-01   +2.992583305922393e-01   +2.627841193525359e-01   -9.227087135720723e-02   +1.191464394829576e-01   +1.967896016823624e-01   -1.630270414558464e-01; +3.794617836702530e-01   -1.167467809288551e-01   -6.403000336877111e-02   +3.339347700534793e-01   -3.021376713466578e-01   +1.113581062056886e-01   -2.560148335650465e-01   +8.730077086438232e-02   -1.952515144497511e-01   -8.464219269447495e-02   +3.006728496798077e-01   +1.785704631427185e-01   +2.935076664154744e-02   +4.891590212350324e-01   +3.439625253657079e-01   +8.079770809895373e-02; +1.297940437104707e-01   +2.108739064651874e-01   -1.516055340468954e-02   -4.523219485197251e-02   +7.979352857910731e-02   -2.165532029422743e-02   -1.622577705455311e-01   +1.486088087543945e-01   +3.015094021518785e-01   -1.560020172480190e-01   +1.632592908790742e-01   -2.248009502831105e-01   -2.138355472708678e-02   +1.097196535500002e-01   +7.977709699579516e-02   +1.264220486387165e-01; +1.716978751308493e-01   -1.806835714402220e-01   -2.201755431726346e-01   -1.051301794424116e-01   +2.994204133897679e-01   -3.232869599935899e-02   +1.294850082988163e-01   +1.005006590084288e-01   +2.346176292211924e-01   -2.422554185531510e-01   -2.425761368918199e-01   +1.510409176403991e-01   +1.630222765776042e-01   +3.895922482954539e-02   +3.687493031836473e-02   +1.985497042712362e-01];
L2I_L1I_iGABA_netcon = [+9.627732200866325e-02   +9.193027559071967e-02   +1.538767559488277e-01   +2.745046857219081e-01   -3.137781499572496e-01   +1.018632097641073e-01   -1.651066329595375e-01   -1.109737239852904e-01; -3.050901555294353e-01   +7.000886364540876e-02   +1.098727681653660e-01   +2.514299973695877e-01   -2.553425309937599e-01   -1.562791188330043e-01   -1.162995251788051e-01   -2.233424121368018e-01; -9.681371980150995e-02   +1.952537844657211e-01   +1.114174100643230e-02   +3.736299249338373e-02   +3.482793091888366e-01   +8.149357854701636e-02   +2.701097404883507e-02   -2.555468318949153e-01; -4.160665207143999e-01   +1.343551886661229e-01   -7.299652125355680e-02   -1.930054864776977e-01   +2.900551855937038e-01   -1.375643435740639e-01   +1.466009086040059e-01   -2.964224901210519e-01; +7.898076704820078e-02   -6.232579954850555e-02   -3.012762366625665e-01   +2.654547494784616e-01   -5.274727399084888e-02   +1.944541273092657e-01   +1.649020642619078e-01   +2.369446098773540e-01; -1.290980893512615e-01   -1.797856315525175e-01   +1.035459884415398e-01   -5.669011732870610e-02   +1.558259215529661e-01   +1.761670798603290e-02   -4.204973011115343e-01   -7.383016728423743e-02; +2.169874540249621e-01   +9.649749959780898e-02   -2.044857142777906e-01   -1.633852877552320e-01   -1.032685143200629e-02   +4.578972710976466e-02   +2.416742560477039e-01   +1.133625372701164e-01; +3.510649302085928e-01   -5.535768606385591e-03   +1.426949452821423e-01   -1.569769935218978e-01   -2.578623575340445e-01   +4.690675133452205e-01   +1.561111691987521e-01   +1.757143978242200e-01; -8.382308033028078e-02   +3.091519680010381e-01   +6.135180540966441e-02   +2.199093197397095e-01   +4.341079912886280e-01   +1.351152831501647e-01   -2.288483020471711e-01   -1.587801927008149e-01; +2.185619802309493e-01   -4.072135363368340e-03   -3.922944818384970e-01   -2.034589269467052e-01   +3.583671333285570e-01   -1.577778676263571e-02   -3.475605479209582e-01   -1.487336554148996e-01; -1.905957693642944e-01   -1.446391778262836e-01   +1.008599331500867e-02   +2.124533775423953e-01   +2.559305742216500e-01   -1.360270874635718e-01   -3.214875175931464e-01   -1.528982531741471e-01; +5.769268436381150e-02   +2.450896420775541e-01   +9.311967800256200e-02   +1.170111526359555e-01   +3.855300865339064e-01   -7.067304171669089e-02   -9.314637966137501e-02   +8.949135208403093e-02; -1.799082225420626e-01   +5.326068437899245e-02   -1.477138673712542e-01   +2.888175957579607e-01   -1.433686936720082e-01   -2.624520823843542e-01   -1.461592538720509e-01   -6.912625858728971e-02; +7.078518329964284e-02   +1.057041134015904e-01   -1.201750996931585e-02   +1.986600783135818e-02   +1.156818879619716e-01   +3.841329591165756e-02   -2.489605303903693e-02   -1.069416517439112e-01; -3.625245834005891e-01   -1.819151177744862e-01   -4.683017497762346e-01   +7.608731948685832e-02   -6.591538143910536e-02   -6.763924161883342e-02   -2.132447748407093e-01   +1.487555346703250e-01; -2.785238617577153e-01   +1.781833848968756e-02   +1.728874098274191e-01   -1.486411110089859e-01   +9.248141508329810e-04   +1.661800143529675e-01   +1.695150109456944e-01   -1.561265059576208e-01];
L1I_L2I_iGABA_netcon = [-2.121712915325339e-01   -7.159116412342213e-02   +1.181480352555275e-01   -3.370986995128534e-01   -1.761190764503501e-01   +2.508221376046204e-01   -4.689053013977330e-01   +1.395858232931226e-01   +2.002952519482513e-01   -5.217006701047269e-01   -2.047407248646669e-01   -8.139151173225612e-02   +8.998736033036189e-02   +1.831502311285847e-01   +1.386184925572381e-01   -1.153687345747638e-01; +6.639346754820086e-02   -2.329692269052333e-01   +2.161701851747922e-01   -4.940198273350997e-01   -3.595570536683178e-01   -1.803344118032471e-01   -3.743627585515236e-01   +4.927077084521136e-01   +2.303363993806301e-01   +7.837019022831829e-02   -9.053693728677550e-02   -1.203409648580825e-01   -3.043425293036090e-01   +2.650713217031143e-01   -3.671198370940212e-01   -6.641583302479859e-02; -2.089493241684403e-01   -3.647241158896493e-01   +2.758677790708588e-01   -1.449894977616930e-01   -7.511939529972987e-02   -1.339295117102707e-01   -1.857885900646010e-01   +3.432013187331907e-01   -1.480675270682836e-01   +9.766045667517999e-02   -6.103859571991287e-02   -4.760786031486285e-02   +2.005007622964698e-01   +1.553415967812520e-01   +1.295913145226333e-01   +3.661293583334227e-02; +8.918854725398251e-02   +1.151518997702319e-01   +2.166092200767809e-01   -7.345336519100980e-02   -2.927473153347813e-01   -6.002244531757711e-02   -2.870927338618215e-02   +2.188861045444526e-02   +1.975723959379029e-01   -2.340628831402520e-01   +5.388099486945512e-02   -2.301093851538112e-01   +3.634432067645502e-02   +6.679623920408211e-02   +2.888010997441450e-02   -3.998220729323308e-02; +1.695315236457974e-01   -2.302271297973707e-02   +1.898726727364002e-01   +5.890295805983931e-02   +1.615784022690438e-02   -3.514412011583848e-01   +2.638776535137758e-01   -1.634109743451820e-01   -4.674593756681125e-01   -2.021446129116284e-01   -2.975831431039521e-01   -2.509255593074725e-02   -1.312743054737887e-01   -8.080750068588032e-02   +4.073809366284892e-02   -3.998821706123347e-02; -4.898206150855061e-02   +4.003119370574204e-01   -3.124071353743096e-01   -3.115840600904968e-01   +7.266501901498941e-02   +1.565508089207624e-01   +1.750810362992221e-01   -7.428953711936399e-02   -2.934065837867447e-01   +2.266978986597804e-01   -2.275920501891721e-01   -3.728022933202263e-03   -1.120194874160114e-01   -2.602276969890748e-01   -3.145779187018287e-01   -1.700639316343894e-01; +6.606919265888658e-02   -1.096697210442033e-01   -9.751332915141267e-02   +4.224382474264463e-01   -7.173513832226633e-02   -2.395203322973712e-02   +6.994997965415711e-02   +2.603885362852864e-01   -2.424710385791619e-01   +1.243856607691524e-01   -3.060982019228280e-02   -6.716955131370372e-02   +1.207614690434346e-01   +2.824023693834597e-01   -7.933457793290299e-02   -1.440988506044975e-01; -3.097008053951673e-01   -1.403083902763620e-01   -6.377566278526670e-02   +1.569276328819571e-01   +1.029627290088341e-01   -2.578542150821559e-01   +2.551590273934955e-01   -5.920322421010031e-02   -2.611613488222120e-02   +8.965073869853238e-02   -1.288882381483766e-03   +1.831973199985376e-04   +5.762565563908314e-02   -3.146608357926484e-01   +2.011241425174929e-02   +1.917818677626480e-02];
L2E_L1E_iAMPA_netcon = [+1.313486394978512e-01   +4.012207103528889e-01   +9.064780547997926e-02   -2.585348073756667e-01   -7.834297592639994e-02   +7.658910934142493e-02   -4.990605425659635e-02   -1.598139273445713e-01; -2.884861008834252e-01   +1.129052546885201e-01   +1.153646846337806e-01   +1.113034109585282e-01   -2.054384414010684e-01   -2.169974190728372e-01   -1.572873229611515e-01   -2.584500183136649e-01; +2.710419687845741e-01   -1.773479923439160e-01   -4.611423525814722e-01   -3.296950620046898e-02   -1.702589035945112e-01   -2.739007949007738e-01   +2.451205510043435e-01   +2.589238792193886e-01; -1.527997962220521e-01   -1.905781902632005e-02   +4.159917708031926e-01   +2.818364032094320e-01   +6.274323191608569e-02   -4.877340037714010e-01   +3.630183063299469e-02   +2.571310651482726e-01; +3.213293834892544e-01   +1.644699432723845e-01   -1.676472830962896e-01   +2.162850360606066e-01   -4.442613689963909e-02   -1.956673489920158e-01   -1.149752133408810e-01   -6.937133522571237e-02; -1.357520675285944e-01   +8.796205463615757e-02   +2.949831702297750e-01   +2.382726871081599e-01   -2.756713455942812e-01   +1.849580433539717e-02   -4.233049719502950e-02   -1.294642692111678e-01; -2.592667780084991e-01   -7.485321287185577e-02   +1.809032218371272e-01   +2.758599448158441e-01   +3.985287802335534e-01   +7.721848306406359e-02   -5.042888697200092e-03   -1.981360102836255e-01; -3.263542794749236e-02   +6.798863960988742e-02   -1.805767909116225e-01   -3.349185552850210e-01   +2.323794322855286e-01   -8.253361901797587e-02   -2.796705712718699e-01   -2.186055801876383e-02; -8.879492179628429e-02   +2.145896455741973e-01   +5.604884057130055e-03   -2.124351795979352e-01   -4.972028376691140e-02   +1.533064703689638e-02   +2.163814254281351e-01   -4.199314538198691e-01; +3.528798231721533e-02   +1.731735380586623e-01   -7.807528573984940e-02   +1.058733502584159e-01   +3.478904668060664e-01   -1.301198575327035e-01   -4.044068275876033e-01   +1.414185337410993e-01; -7.242090209469787e-02   -7.872909524206194e-02   +2.956623083419371e-01   +2.335912177946160e-01   +2.819217340196358e-01   +5.031450818182615e-02   +6.378513464007715e-02   +1.527942688656892e-01; -1.355294542935337e-01   -2.103243625600958e-01   +1.085464690663610e-01   -8.021100689877547e-03   +1.473886908959773e-01   -2.465041407486253e-01   -4.182236654930236e-01   +1.340152595211280e-01; -6.475035753730612e-02   +3.157357189387444e-01   +1.373977675271426e-02   +2.551470846704665e-01   +1.425696818209105e-01   -1.412245517973593e-01   +2.287849777778670e-01   +5.976291875767241e-02; +1.894162133572294e-01   -1.905706427044742e-01   +3.033387357223587e-01   +3.049312779423718e-03   -2.774365604330007e-01   -2.289073417809327e-01   -5.756353037504324e-02   -3.469318649742184e-01; +7.377965419715889e-02   +1.973025216836561e-01   -7.178890133383131e-02   -1.695746777225975e-01   -9.882210662592270e-02   -7.224645108328354e-02   +1.488884611496411e-01   -3.236933529786281e-01; +8.589546478251556e-02   -4.070941950688423e-01   -8.081148244191150e-04   -3.610075813966502e-01   -2.379717226984594e-01   -2.950653981944092e-01   +1.007146523667159e-01   +2.223637429780870e-01];
L1E_L2E_iAMPA_netcon = [+1.231877885987720e-01   -3.810087747286972e-02   +8.364245316601349e-05   +3.175293753918753e-01   -8.761629428715198e-02   +3.599022205891659e-01   -2.696826275987483e-01   +2.405400479368188e-01   +8.369419889652913e-02   +3.337253862962833e-01   +1.726743660421510e-01   -1.122991242467173e-01   -2.185260235692060e-01   +6.583676429396430e-02   +8.525222692527562e-02   -1.341810279958438e-01; -2.547529923464636e-02   -4.400944785916028e-01   -1.608110737747863e-01   +3.057520649975898e-01   -2.193801819174560e-01   +3.702214438944779e-01   -1.015172940150695e-01   -1.227366751855557e-01   +1.239622911268899e-01   +1.735613368876515e-01   -3.043457917468735e-02   -2.061603231198590e-01   +7.258121208094559e-02   -4.399921418961047e-02   +5.854179155129006e-02   -5.089410587073859e-02; -3.582310115502922e-01   +2.373730160267725e-01   +1.865340206338759e-01   -5.014497413825073e-01   -4.442006706959712e-02   +1.679512374271582e-01   +2.148429601249482e-01   +5.620362612752751e-02   -4.394201679886314e-02   -2.936358859976118e-02   -2.364469841483255e-01   -1.543936541576735e-01   -1.621408388929037e-01   -1.448218557080457e-01   -9.512893153588890e-02   +1.501263078221022e-01; -2.075797528391723e-01   -1.715761714316379e-01   +1.500806251586287e-01   +1.794946064586778e-01   +3.830821482824350e-01   -1.275595056746298e-01   -2.370375056361373e-01   -3.296889998942604e-02   -1.104600691755415e-01   -1.002467380775204e-01   -2.963811217579695e-01   -4.412505228489208e-02   +1.487122388848966e-01   +1.619893314855093e-01   -9.621649699140974e-02   -2.534280736760205e-01; -3.100853139594891e-01   -2.718574854801780e-01   +9.644596602125605e-03   -1.818382926089065e-02   +4.472628920942008e-02   +3.647221779785826e-01   -2.861975402263131e-01   +9.086825225708178e-02   +1.909760531227249e-01   +1.018140833399398e-01   -1.859229624044777e-01   +2.913083235678689e-02   +1.248048562068350e-01   -8.019284128507539e-02   -1.677745114836392e-02   +1.327687140725720e-01; +8.240151310284376e-02   -2.575825717457603e-01   +4.852363715769484e-02   +3.044185792023399e-01   -2.310636379554554e-01   +2.612018069734069e-01   -1.978024630740792e-01   -1.419961953456958e-02   -8.021268570901963e-02   +1.689857445427499e-01   -2.098334249900510e-01   +2.258080288367596e-01   +3.440417104309974e-01   +1.395737858544047e-01   +1.663315754148262e-01   +9.600977841713629e-02; -1.663461869903603e-01   -1.093302958990304e-01   -7.483981564547246e-02   -2.367851886126889e-01   +2.348208854695033e-01   -1.275371634387563e-01   +4.237181365780852e-02   +1.133016085106344e-01   +3.699200220764850e-01   -3.684223636954531e-01   +1.040472343901801e-02   -9.979844738180424e-02   -2.040107308347286e-01   -5.203381542671390e-01   +4.296971742781613e-02   -1.479761772447563e-02; +2.065034026908734e-01   -1.796728964294073e-01   -1.551337472616512e-01   +7.387813720683231e-02   +1.822839687406541e-02   -1.416752343099522e-01   -3.866802206954844e-01   +9.900160005425523e-02   -7.889151226819474e-02   -2.173174112280249e-02   +2.147428982619705e-01   +2.622419866572642e-01   -7.985696119547908e-02   -2.708577734196177e-02   +4.497047257204088e-02   +8.920348558781091e-02];
L2I_L2E_iAMPA_netcon = [-2.881193811972733e-02   -2.039813808725530e-01   +1.707161680058926e-02   +1.245934109137099e-01   +1.507194964124269e-01   +1.765325023757019e-02   -1.698825170323750e-01   +2.860126163673610e-01; -2.635132308529728e-03   +2.545017510439994e-01   +2.715029512902501e-01   -7.681104015308277e-02   +1.396136428069930e-01   +2.325319708499980e-01   -2.382232607987282e-02   +2.132056267898680e-01; +2.033314956421663e-01   +1.312247355116013e-01   -5.556604855689442e-01   -1.721177486317258e-01   +8.678003459261975e-02   +7.950193489828376e-02   -2.297584796914663e-01   -1.361016772165693e-01; -1.907306441315837e-02   +1.196201697765906e-01   -1.265452430574064e-01   -2.327173412146954e-01   +7.583712870604167e-02   +1.209120875589807e-01   -4.207477159907016e-02   -8.076875994737653e-02; -1.697259864785345e-01   +9.393252607907246e-02   -2.092961668322436e-01   -3.147264686427994e-01   +9.559033215582115e-02   +1.637094349533683e-01   -2.982523943878695e-01   -6.788444732697761e-02; +1.332012992733115e-01   +1.467292057843722e-02   +1.195751382753611e-02   -1.568748701895576e-01   -4.410284485433222e-02   +2.787166134595509e-01   -7.021718405683558e-02   -2.966162960719820e-01; +1.331826671959857e-01   +6.795694952305822e-03   +3.314930202481650e-01   +1.358051463916970e-01   -1.094287767272569e-01   -2.286923478945201e-01   -3.389498410310462e-01   +3.559274918891181e-01; -3.053021478750821e-01   +3.138468547214788e-02   -4.578033584260964e-01   +4.989737955666314e-01   +1.811857136669568e-01   +1.541442828131254e-01   +1.932562125530194e-01   +3.625604483575560e-01];
L2E_L2I_iGABA_netcon = [+5.856762560712436e-03   +1.576412658180846e-01   -2.531686132677954e-01   +9.578262878277077e-02   +2.449536400688864e-01   -9.345008129281665e-02   -1.559538618947381e-01   -3.993702939412105e-03; +2.997612542758433e-01   -6.202859931298924e-02   -4.845203774589661e-02   -1.066324832358420e-01   -7.004893893840775e-02   +1.298162312132002e-01   +1.424371241168809e-01   -1.763267067434143e-02; -1.847174119961724e-01   +1.844478699533525e-01   -1.719632566768555e-01   +1.786770545596571e-01   +1.898051407175960e-01   +8.636546078707999e-02   +1.461032783605283e-01   +2.311250403917267e-01; +1.752970119850827e-01   -2.855680364957684e-02   -1.794621924090553e-01   +1.795442134293768e-01   +2.069818379124622e-02   -1.313064782297599e-01   +3.233135355587569e-01   +1.512926658128474e-01; +1.258426405150823e-01   +1.408495332004127e-01   -2.755959674467023e-02   +3.237115125719399e-01   -9.218916035465205e-02   +1.047608496403905e-01   +1.866248379049502e-01   +2.121060890306554e-01; +4.504177872484011e-02   -3.345457115522718e-02   -1.119110177511944e-01   -5.285327869683876e-02   -3.360231741143743e-01   -1.079983448155790e-01   +1.885996918493443e-01   -1.522632640098542e-01; -9.558229059174532e-02   -4.119367194638618e-01   -8.411048954540651e-02   +1.414219670595971e-01   -2.478836740003967e-02   -9.731838872704174e-02   -9.023594500727899e-04   +1.998921990876550e-01; +1.328627605684131e-01   +2.534415465428566e-02   +4.459694029145880e-03   +1.873746819063769e-01   +2.636761578747809e-01   +2.070960394205646e-01   +2.177681211444598e-01   +1.678617441210880e-01];
L3E_L2E_iAMPA_netcon = [+3.146331888872239e-01   -1.588282086702728e-01   -3.012595798633962e-01   -1.342641611605445e-01   +1.116743093475052e-01   +2.243155410244183e-01   +1.185410482801316e-01   -4.534242736106280e-02   +2.163490310739955e-01   +1.265797430618049e-01   -1.366954270038212e-01   +3.252700430239142e-01; +1.216047160532593e-01   -2.324023715813702e-01   -1.354591774048864e-01   -1.404047102358291e-01   +1.622373811564241e-01   -2.371146220605740e-01   -2.630211807974905e-01   +2.203652646062692e-01   -1.303028706434566e-01   -8.815169915303205e-02   -1.405136803479381e-01   +4.595398781260444e-01; +3.594002819593302e-01   -1.949632282750157e-01   +2.280272420055987e-01   -1.234033001215224e-01   +1.479954679974422e-01   +5.304602414376414e-03   -6.295427983980775e-02   +2.804974511420038e-01   +1.983359144100725e-01   +2.195568890748785e-01   -2.331525349515582e-01   +2.738567575954209e-01; +3.122143269596508e-01   +5.792132596059846e-02   -1.027281300184638e-01   -8.482566851150958e-02   -3.278245769960216e-01   -1.910297830542046e-01   +2.285422513232566e-02   -2.542988959815050e-01   +1.378132340748752e-01   -1.171581428167380e-01   -4.668648753791442e-02   -1.636909070099811e-01; +2.375130942868025e-01   +1.985979429197853e-01   +2.887106714779464e-01   +2.143564366382009e-01   +3.747078927090438e-01   -2.890556070699342e-01   +5.173135369119682e-02   +1.008142500011078e-01   +1.858574784894918e-01   +1.686369981571606e-01   -1.946834920830059e-01   +2.829796045329878e-02; +5.680021742939183e-02   +1.728247899362539e-02   +1.533292024121122e-02   -9.415449879648641e-02   -6.689057881914408e-02   +2.450529021680775e-01   +2.778981316113420e-02   -9.182231205497327e-03   +1.449207466139244e-01   +1.832506518349601e-01   -5.731434876063485e-02   +2.144026386776229e-01; -8.052026944072196e-02   +1.625703408330723e-02   -3.537407409821047e-02   +1.708465127698073e-01   +1.660771801463974e-01   -3.776990332925608e-01   -2.983320208177909e-01   -1.563843700787771e-01   +3.892609690747805e-01   -3.492982456135073e-01   +1.163250061094385e-01   +1.191128316715035e-01; -3.354734145637147e-01   -2.178679947079941e-01   +3.831232876414348e-03   -2.374708796979649e-02   -4.607404295887844e-02   -1.104446179272250e-01   -1.169711022176086e-01   +8.060480364685489e-02   +2.215465848903439e-02   -1.731479485379968e-01   -2.510757304848263e-03   +1.927870147385645e-01];
L3I_L2I_iGABA_netcon = [-9.028096077322535e-02   -2.176015281814484e-01   +1.378480774246344e-01   -3.154357242972767e-01   +1.700941483262202e-01   +4.106398044020043e-01   -3.269543862516473e-02   +1.364265811423662e-01   -4.677607078555233e-02   +1.028428078544466e-01   +2.250486792681756e-01   -1.265402090820271e-01; -3.084966430749541e-01   +2.586633398594454e-01   -2.146253541602479e-01   -5.101505860647201e-02   +2.727273481930477e-01   +1.453839458835127e-02   -2.634356715631181e-01   -1.472150113012233e-02   +2.766366831662564e-01   +2.427110579696339e-01   -7.304261745639144e-02   -2.819596908409876e-01; +2.833976456364954e-01   -1.208746881543638e-01   +3.032640599590228e-01   -1.682359806587480e-01   -1.575069704735840e-01   +3.424768787005320e-02   +3.778940705771411e-01   +4.523315703589396e-02   +2.976053421014127e-01   -1.762887907089569e-01   -8.219407921815790e-02   -3.688312488204629e-03; +1.425263649232932e-01   +3.755296697669917e-01   +2.746761267625045e-01   +1.064033949319418e-01   +2.345388962962066e-01   -4.265364893211946e-02   -1.029039159857641e-01   +1.350200147389518e-01   +3.535182556971640e-02   +2.706667807138146e-01   -2.803287618044082e-01   +2.042642447706370e-01; -3.174670631911097e-03   +1.559040471023319e-01   -1.886392166258687e-01   +1.122828976871432e-01   -6.406204844001756e-02   -8.217209504427297e-02   +3.154331389737552e-01   +1.117624287166929e-01   -1.433140929089610e-03   +1.039571843195160e-01   -1.209182534569562e-01   +2.935116352655901e-01; -1.025057344332167e-01   +1.959204965998120e-01   +5.835256516762621e-02   -1.042223073962119e-01   +2.270653697564054e-01   -2.547442418129221e-01   -2.131978642787784e-01   +1.014123450255390e-01   +2.766361095917084e-01   -1.018032035208136e-01   +3.110798736221727e-02   -1.268986472795240e-01; -2.300430272309569e-01   -5.979424516350471e-02   +1.091187835661822e-01   -5.764946704715475e-02   +8.795728504426607e-03   +5.225389960637992e-02   -3.574340281374202e-01   +1.011032576453358e-01   -3.486141952257188e-01   +2.085482170444971e-01   -3.664936069015335e-01   +9.622204166048283e-02; -1.675467046692673e-01   +2.271941636320346e-02   +2.775741301554222e-02   -2.986318699878993e-01   +5.373893352126307e-02   -9.264820329230455e-02   -2.812747900948023e-01   -1.342017316239189e-01   +1.289873644160040e-01   -2.235406715450551e-01   +6.541285676454815e-02   -2.130060644081734e-01];
L2E_L3E_iAMPA_netcon = [-2.096014913255672e-01   +1.187565436488245e-01   +3.208155905051359e-01   -4.159030030812646e-01   +6.548960148509661e-02   +5.876659741151280e-02   +4.135141707131906e-01   +2.249812006285415e-02; -1.511093517032093e-01   -2.340857078750948e-01   -3.103411487853926e-02   -6.541187726359786e-02   +1.134231984491640e-01   -2.026592143638202e-01   +1.175762376446664e-01   +3.288062937112704e-01; +1.357161162487565e-01   -8.827620387799304e-02   +2.111530273208332e-01   -1.823798910580104e-01   +4.834111800606117e-02   +1.490349346504667e-01   -4.862301929642820e-02   +1.505568228357511e-01; +5.737279023537379e-02   -1.097695815739795e-01   -2.960786024056403e-02   +1.258293074014944e-01   -1.514475088282480e-01   -1.180974068437522e-01   +2.013242293976269e-01   +4.504626219358626e-05; +1.453560666905445e-01   -2.376752650605984e-01   -6.071923914699250e-02   +2.021165271333998e-01   +1.329441918970450e-01   -6.668847828325210e-02   +9.415456268830097e-02   -1.839151298818481e-03; -5.408646331788465e-02   +9.671430753084348e-02   +2.414084751075186e-02   -2.247161110866631e-03   -3.094242344350789e-02   +2.905819785216206e-02   +1.141640252432796e-01   -5.966396823965714e-03; +2.914061855117792e-01   +1.447588580418956e-01   +1.356266349061884e-01   +8.608346365832623e-02   -9.566643178161513e-02   -1.891941377249846e-01   -5.495993039832636e-02   +2.942811334236747e-01; +1.663811484309825e-01   +1.222784480694801e-01   +2.340922693556529e-01   -5.142674638332214e-01   -1.177828398072313e-01   -7.946699897276191e-02   +9.176212629470991e-02   +3.499862807449626e-02; +1.574616537502099e-01   -4.157366237944924e-01   +1.603720712729550e-01   +2.250195137553058e-01   +1.929069737851571e-01   +2.537541526676595e-02   -1.823320697311757e-02   +1.481878877467201e-01; +5.677527411503707e-02   +2.679227158554144e-01   +2.872901331963383e-01   -2.824484159418814e-01   +1.814516311694904e-01   -1.036550131901057e-01   +3.156102753565078e-01   +4.575237942018338e-02; -5.300145292762299e-02   -2.464547400812220e-01   -4.277776148426804e-01   +4.304717687015958e-01   +4.335469060110675e-02   +3.531311788206187e-01   +1.210289533408897e-01   +1.082780574440041e-01; -7.598623716375907e-02   +8.600309029368478e-02   -1.950661961188926e-01   -1.530604385984746e-01   -2.370458167001299e-01   -3.970069115698948e-01   -3.451128161741711e-01   -2.579613097914465e-01];
L2I_L3I_iGABA_netcon = [-4.207088761965746e-01   -7.420572983286225e-02   +5.087929313266541e-02   +1.527332772353663e-01   +3.184467823616677e-01   -1.065901985432915e-01   +2.679377472355249e-02   -2.874002364422270e-02; -1.291585579753371e-01   -6.424909371268094e-02   -2.296653677779523e-01   +1.464817754453286e-01   -1.948189913715764e-01   +4.054956261635377e-01   -3.155423285747219e-01   +2.177631431186736e-02; +3.719488711080614e-01   +1.382879383142074e-01   +1.027330459621645e-01   +1.463330241915706e-01   +3.721297242778180e-01   +2.721932578273719e-01   +7.884514964015669e-02   +1.272640133534036e-01; -2.536284893478640e-01   -6.088111458320796e-02   -6.695159437657028e-03   -1.468668201282410e-01   -3.106633769954014e-01   -1.403426514651938e-01   +2.125139283299989e-01   -7.897747478499959e-02; +1.471446148960642e-01   +5.697365437030111e-02   +3.491130433685765e-01   -4.183273111942807e-02   -9.263914534518897e-02   -1.120248334653021e-01   +2.898746855130889e-01   -8.725465724882164e-02; +1.039644853133047e-01   -5.229623128845082e-01   +2.376085806523771e-04   +9.317494609578250e-02   -4.298349536084135e-01   -6.932280347910758e-02   +1.600692752294869e-01   +1.116266768288313e-01; +3.729092944396512e-01   +2.480023345566060e-01   +1.414313423205448e-01   +1.014300848209627e-01   +2.073822404416215e-01   +2.335735608535286e-02   +3.958120583060256e-01   +1.633728550042626e-01; +1.373789112702670e-01   -1.528166282752133e-01   -2.663356589922120e-01   +2.353786899401072e-01   -3.780615900523800e-01   -1.347609340197117e-01   +4.608519390858949e-01   -6.151444299598734e-02; -1.419772228398898e-01   -3.339579188763853e-01   +1.475182887113183e-01   -2.272986443254779e-02   -2.260567163143012e-01   -5.950639177768583e-02   -4.977729514629618e-02   -2.621948248177316e-01; +4.147798759408223e-01   +9.068497910697812e-02   -2.019912126674546e-02   -2.208722911980118e-01   +9.539947833698012e-02   +1.850216903261160e-01   +4.249270538587455e-02   +2.111737646099899e-01; -1.669236956198850e-02   -1.692315912469910e-01   +3.100078551706704e-02   -1.481263169353887e-01   -2.691479435330134e-01   -3.542877909381216e-01   +2.074140235632920e-01   +3.821410051666870e-01; +1.340235295387432e-01   -7.803245336709358e-02   -2.356578989904465e-02   -6.654065925191939e-02   -8.001321500354713e-02   +4.506461472384406e-02   +6.853033379930357e-02   +5.494158041503505e-02];
L3I_L3E_iAMPA_netcon = [-4.591601688147984e-02   +2.217685043292955e-02   +1.268565591466559e-01   +5.379472432134254e-02   -1.412458269553133e-01   -2.164214188994155e-01   -2.811191052852284e-01   +3.039385173490928e-01   -4.108477871569157e-01   -1.396913449006263e-01   +1.114062608865116e-01   +1.556921077625969e-01; +1.588151078875655e-01   +8.147507425976547e-02   +1.000918440791429e-01   -2.954209229100712e-02   +1.243418113061255e-01   +2.109710033197844e-01   +2.371295419172664e-01   -4.209577245383644e-02   -8.362914758056793e-02   +3.394012232922029e-01   -2.260240573612996e-02   -2.361005689468660e-01; -8.325804369130399e-02   +3.216788982859284e-01   -6.191782688364374e-02   -5.886499962270304e-02   -2.466996689336627e-01   -9.499955104450436e-02   +2.767040337422254e-01   -5.372124831109364e-02   +3.258113656417934e-03   +1.017078443835288e-01   -2.918016895636857e-01   -2.620938773036436e-01; -1.710341612989242e-01   +2.937397750107575e-01   -7.929535249645575e-02   +2.269002443673089e-01   +6.084300195020692e-02   -2.402393182792631e-02   +2.449988827137423e-02   -1.053811239855495e-01   +2.470819869037153e-01   -4.202877700560648e-01   -1.313915319981133e-01   -3.758553132386030e-01; -3.392652586314476e-02   +2.639523722266743e-01   -3.971282087177490e-01   +4.457583395059441e-01   +1.609336458462777e-01   -3.335894388705279e-01   +4.960493540099455e-01   +9.433292379842780e-02   +2.858410292055809e-01   -1.463287593038652e-01   +4.746901011473689e-02   +3.970858570067258e-01; +1.234210018477900e-01   +3.558560654845350e-01   -9.067060471901972e-02   +2.672070099880172e-01   +1.081691816774964e-01   -3.922931699379795e-02   +3.735674923779075e-01   -1.560107104831888e-01   -1.940425411937805e-01   +2.129472744935165e-02   +1.070191931768090e-01   +1.237768806108820e-01; +2.004762008554062e-02   +4.262348790326352e-03   +3.391198879230185e-01   -8.025430200731176e-02   +1.970234639676449e-01   -4.255550190063769e-01   -3.082649987346652e-01   -6.142511527632965e-02   +1.421971284357174e-01   +2.775119273300534e-01   +9.324970597970390e-02   -3.333137809084062e-01; -5.726815605697552e-02   -1.339662598095517e-01   -1.101028937613769e-01   +1.678558481045370e-01   -3.592876721040644e-02   +8.692637099681219e-02   +1.866057826817050e-01   +9.546482016672987e-02   -2.437651127057756e-01   -1.567900672052496e-01   -5.011083999937910e-02   -2.427656325552838e-01; +2.815062450255797e-01   -1.380015937452393e-02   +8.734209557836851e-02   +3.250383715308250e-02   -2.525841331743948e-01   +1.704124053289744e-01   +7.863081057601889e-03   -1.584844230137553e-01   -2.369732438358425e-01   -4.371997899088811e-02   -2.244970388180011e-01   +7.309897742516509e-02; +7.813993814663549e-02   +2.986358397149318e-01   -1.460097749853821e-01   -1.880260619919974e-01   -2.081591222268192e-01   -2.329817582666419e-01   -1.703874796804164e-01   +1.763024035963438e-02   -2.651481751483691e-01   -2.882913896547769e-01   -1.995183690163477e-01   +1.740759765087718e-01; -2.014644969306400e-01   +4.593768812434615e-02   -4.244879710632429e-02   +8.827568310575015e-02   -1.348253020630481e-01   -1.462314138553140e-01   +1.115345789700965e-01   +1.361184186706206e-01   +1.699749054238192e-01   -5.196650453623667e-01   -3.219614612444613e-01   -3.099835622319471e-02; +5.188424707663487e-02   +2.055343843929777e-02   +2.013181142950043e-02   +2.611767851422151e-01   +1.401896744085442e-01   -1.612669192648332e-01   +1.122352081851279e-01   +2.744264553050914e-01   -3.877655312653935e-01   -6.736134568917396e-02   +6.380260831897644e-02   -2.262661287001273e-01];
L3E_L3I_iGABA_netcon = [-3.866983449500117e-02   -3.637877944435504e-01   +2.084574768587258e-01   +5.944581257868999e-02   -2.689694523144991e-01   +2.392594775210280e-01   -1.064751581275256e-02   +1.166655902385401e-01   +9.468927356067042e-02   +1.007829534837358e-01   +3.100804262694117e-01   +2.186503897440418e-01; -1.624154361779415e-02   -9.854836928266186e-02   -6.995590425043519e-02   -2.562138990019140e-01   -1.115096591735353e-02   -6.539780325625688e-03   +6.002511872210516e-02   +1.509576712505654e-01   -2.739234126925156e-01   +9.086490920064577e-02   -7.142840283591360e-02   -5.459780081780832e-02; -2.202988206397741e-02   +3.259311737851473e-01   -2.253453087846274e-01   +5.362102116240450e-02   +2.234380618927893e-01   +4.686710637554162e-02   +1.750550129314954e-01   +8.383724722654584e-03   +6.769482071495284e-02   -2.706186300348759e-01   -2.574335623881340e-01   -9.067552010940287e-02; -1.524678468705105e-01   -3.581485412535264e-01   +8.994970202908112e-02   -7.412202493010528e-04   -2.048122730986244e-01   -6.327553322662192e-02   -4.395771838572874e-01   +1.226277294877463e-01   +1.998758823469910e-01   +4.524814009712435e-01   +1.106205776891237e-01   +1.905391916895110e-01; +1.446151745322796e-01   +1.288079040233114e-01   +2.303026730868926e-01   +8.505323491641745e-02   +3.197240038626880e-01   +1.916204922491175e-02   +2.023592967933742e-01   +3.362212709247094e-01   +1.108448851701695e-01   -1.613579243561074e-01   -3.712112251873386e-01   +7.307204012926652e-02; +8.443517174606494e-03   +2.841411616870246e-01   +1.579918689684875e-01   -1.204968295529809e-01   +2.210447922445550e-01   +2.187561830162108e-01   -4.461728166108522e-01   +1.314690154140389e-01   +2.817889195307090e-01   +4.908337114183290e-02   +2.318312085626647e-01   -2.086794568010037e-01; -4.740518775497646e-01   -6.504691161825696e-02   +3.649559981837813e-01   +9.935146843853024e-02   +5.630877362610229e-02   -3.410433345039654e-03   -1.844701598096630e-02   +2.247081258528575e-01   +2.389407661206547e-01   +1.956610076298773e-01   -1.130430598958676e-03   -2.185007915600696e-01; +9.366926986240010e-02   +1.295197577373577e-02   -7.768190934052824e-02   +6.463327904650799e-02   -2.716832589489894e-02   -3.047714039139706e-01   -3.366089085940815e-02   -1.464791123411538e-01   -3.630201397737092e-01   -4.342050071667661e-02   +1.270793706718421e-01   +2.655770492168749e-01; -3.233768796855283e-01   -3.058639999789015e-01   +2.543360570542722e-01   -1.958152201814145e-02   -5.119690526506959e-02   +3.406264434595347e-02   +4.787985898998270e-02   +3.851235933080119e-01   +3.925974493238938e-01   +1.309288506420193e-01   +2.647270784978690e-01   +7.326326087548896e-02; +1.767126288411340e-01   -2.062831137703786e-01   -9.381734625678817e-03   -2.471428699420711e-01   +6.833268002809001e-02   -4.434466571884191e-01   +2.982832155183675e-01   +5.848172551471659e-02   +3.502718476961125e-01   -8.801000116632252e-02   -1.243522753583362e-01   +5.414842764141325e-01; -1.021554936452562e-01   -2.450163874080011e-01   -1.872260968709105e-02   +1.396557199769835e-01   -1.531506426769786e-01   +2.820788063543814e-02   +4.219903230008389e-02   +6.825566061756883e-02   +4.426883275410909e-03   -4.547271373606699e-01   -4.598932093455756e-01   +9.746507335778060e-03; -3.237959819713199e-02   -9.294137073737974e-02   +2.374880463668197e-01   -2.331622258012974e-01   -2.052894740717848e-01   +6.759810817386071e-02   +1.247415915582608e-01   -3.200314721020769e-01   +1.750073961355468e-01   +1.059823035932716e-01   -1.297907078390740e-01   +1.938773309607164e-03];
L2E_Input1_iAMPA_netcon = [-9.951190818028063e-02   +2.675513856895883e-01   -3.940927844183073e-02   -1.833904857448324e-01   +2.854823855818449e-01   +1.780330444644737e-01   -2.189289696007871e-01   -9.670756161132105e-02];
L2I_Input2_iAMPA_netcon = [-1.676569706467898e-01   +4.705126333969742e-02   +1.065006961710547e-01   -1.760843332581319e-01   +5.795384072413398e-02   +1.876574753835643e-02   +2.412648985764681e-01   +1.940527317406457e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.04*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.9*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.1*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.9*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.1*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.9*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.04*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.9*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.1*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.9*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.1*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.9*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
