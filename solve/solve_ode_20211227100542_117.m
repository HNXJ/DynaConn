function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-2.582819183177346e-01   -1.824841400833777e-01   +3.168905397915104e-01   -2.032872068519122e-01   +1.504759110675973e-02   -4.578841371815515e-01   +9.897532841995435e-02   +1.244897676084729e-01   -7.554976696312851e-02   -1.152096412116594e-01   +2.552688148555947e-02   +3.873438181636542e-01   -2.183928809735880e-02   +2.273068636390918e-02   +2.864394789187498e-01   -4.339110969200478e-01; +1.960350898374184e-01   -3.576732330278157e-01   +1.309810543380243e-01   +1.129810187697981e-02   -4.488758649183285e-01   -4.382115070147430e-01   -3.969623803498857e-01   -3.221986115172250e-01   +2.445746390737674e-01   +1.679597498332604e-01   -5.830435586851417e-02   +1.309334775123725e-01   -3.584207638064190e-01   +3.357553496016460e-01   -2.368057779471017e-02   -5.123912364500229e-01; -1.651264366478355e-01   +2.720603457645889e-01   -1.576387930010487e-01   +2.872272713653033e-02   +1.576240381996354e-01   +1.153671780964853e-01   -1.932335681151470e-01   +1.291574138941337e-01   -3.718844654993994e-01   +7.122323439475696e-02   -3.821984051589028e-02   -3.164507080252265e-01   -5.961095577641254e-02   -2.105797517233728e-01   +1.947814791572001e-01   +1.563578074822492e-01; -4.896748521015198e-01   +1.383351997755304e-01   -1.363520391544970e-01   +1.165775084951294e-01   +1.466216056323739e-01   +7.091330789499760e-02   -5.557631609007976e-02   -3.354839449098575e-02   -1.077607407341338e-02   +6.494386130101144e-01   -2.938376501656528e-01   -1.897435777560670e-01   +3.028747859332931e-01   +1.699600360600011e-01   -1.977620899496717e-01   -2.606621031841352e-01; -2.002861869773450e-01   +9.132630288249466e-02   -8.663131774485686e-02   -3.360664022210829e-01   +2.160011110442692e-01   -1.325044705135210e-01   +1.749137959623825e-02   +4.402780078253820e-01   +1.552952990608704e-01   +3.511744741725592e-01   -2.457900045912043e-01   +2.722084852725598e-01   +1.943235798397114e-02   -2.043198769980273e-01   +4.100088343816310e-02   +1.149082880499861e-01; -4.813891066806797e-03   +3.536331707029384e-01   -3.886439195489090e-01   +2.470689138794242e-01   -3.566868551649949e-02   +2.758536711225216e-01   +8.007003157895573e-02   -4.539602781339140e-02   +1.310985171401285e-01   -2.584303763337314e-01   +3.960175631077878e-02   +1.613172001062884e-01   -6.947435209337074e-02   -1.571700154723169e-01   +1.837732854600367e-01   -1.673823298800842e-01; -3.421911921983714e-01   +1.085069258296584e-01   +1.464654915952698e-01   -4.901263657918203e-02   +4.718941857013823e-01   +2.152199533272594e-01   +4.100829410952659e-01   -1.587267116601714e-01   -4.508235795149910e-01   -7.674246786683669e-02   -3.640059246766076e-01   -2.567647519851220e-01   +2.537671522108165e-01   -2.600505035619473e-01   -2.225838712468629e-02   +3.988812016342637e-01; -4.633392197853812e-01   -3.104618386416946e-01   +1.161529528880461e-01   -1.175001780491874e-02   -2.051394819388219e-01   -5.426745161897034e-02   -1.732135751707573e-02   +1.504371619074676e-01   -3.407526918403308e-01   +2.431756591284428e-01   -4.781974215462484e-02   +1.374767564016969e-01   +3.800535016073235e-01   +2.529834333383003e-01   -4.193267541071757e-02   -3.345929921208224e-01; -1.803214911364768e-01   -1.557112715410080e-02   +4.216754089547942e-02   +2.532336924002366e-01   -2.429984519471312e-01   -2.729703379172477e-01   +1.436866872862027e-01   -8.328735065380972e-02   -1.872320837049548e-01   +4.538002785881270e-02   +4.052201607486742e-01   -3.982987339442692e-01   -4.813381264027926e-01   -1.428927083111221e-01   +2.229267580593248e-01   -4.100012495757235e-01; +1.396971806484585e-01   -8.284115095399994e-02   +1.996983460749912e-01   -1.501224471241587e-01   -6.190091149321231e-03   +4.015096017682222e-02   -6.926668732248249e-02   -5.895680421802069e-02   +5.752396876554218e-02   +1.418093130711341e-01   +1.774085282785277e-01   -2.031984106553530e-01   +3.323469814351058e-01   +3.865607398874810e-01   +3.093537646993877e-02   +2.010754291913762e-02; +4.795893505871350e-02   +1.432725861376505e-01   +9.041850006049165e-02   -4.295533915621826e-01   -2.199038363051989e-01   -9.786366370205194e-03   +1.423302832493931e-01   +1.259217317435524e-01   -1.311885025436396e-01   -3.751269821680154e-01   -2.121810243058344e-01   -1.515967032184441e-01   -2.794610340369134e-01   -1.228168217127113e-01   -1.596037967049036e-01   -1.390920480051243e-01; +9.125401921191098e-02   +3.524493836632580e-01   +1.659194367800153e-02   +2.923992618649615e-01   -4.522300104114524e-02   +3.075646798541553e-01   -6.068637304600563e-02   -2.716233209267412e-01   -2.932303552527203e-01   +8.308691306024360e-02   -2.507770688664350e-01   +1.280465381062248e-01   -6.796647680191049e-02   -3.791991307458510e-01   +9.866471270356295e-02   +4.725986790024930e-01; +1.089892807128293e-01   -1.680414743166645e-01   +1.113105719403645e-01   -5.361435698530789e-02   +2.155622039780475e-01   +3.412573832286044e-01   +3.601029713752930e-02   +1.108945385090929e-01   +8.132924490884069e-03   -2.486799927529199e-01   -5.436580090990162e-02   +2.610976943782862e-01   +3.847722511189679e-02   +3.927836963148726e-02   -2.590118703574864e-01   +4.025579572961085e-01; -9.286396708008737e-03   -1.393938191233122e-01   -2.993027739227289e-01   +4.034758436980976e-01   +4.090313123992388e-01   -2.404886411461303e-01   +2.237135404504271e-01   +4.588999449341831e-01   -1.745219821165626e-01   -6.437775865936972e-02   -6.170153248394306e-02   +4.832606902559773e-02   +6.284116885894689e-02   -1.174206194070998e-02   -4.252452005874469e-01   -2.689480491233411e-01; -3.913072508486801e-01   +1.322103872129452e-01   +1.889056462769995e-02   +3.590709350597619e-02   +4.037715938738285e-01   -2.070262474811311e-01   +4.533542558236706e-02   +2.133528374586846e-01   +2.323476648637254e-01   -1.972339848934588e-01   +3.262453753111674e-01   +2.631935362497362e-02   -5.315368767223252e-02   -9.412899654540535e-03   -2.994797925822916e-01   -1.428826387538306e-01; +1.378691674345153e-01   +3.066517398411581e-02   -4.491844858129743e-01   -3.211081169615551e-01   +1.053566764239702e-01   -3.659022524285756e-01   -1.473683300655964e-01   +1.374189625612693e-01   +2.094843458693264e-01   -2.637713861271834e-01   +2.680680812357342e-02   +2.177103001430750e-01   -2.298599397399524e-01   -1.906155597967774e-01   -2.978629578962552e-01   -3.193757854630863e-01];
L1E_L1I_iGABA_netcon = [-5.203526728209427e-01   +8.716700411616651e-02   -4.163759925460405e-01   +2.065809880645440e-01   -2.110468692355629e-01   -4.680288842999899e-02   -4.274352718144177e-02   +2.176260178239770e-01   +2.959195618736343e-02   -1.241898719468092e-01   -1.629711288400603e-01   -4.429398379189532e-01   -2.198192819694356e-01   -4.237202884148336e-01   +1.033770597885201e-01   +1.099209305215254e-01; -1.569187865965623e-01   +1.281767499975077e-01   -3.816749478079067e-01   -1.298670097903108e-01   +1.924397355301389e-01   -3.216106070175218e-01   +1.306695748487319e-02   -2.664654662791582e-01   -8.077982202002154e-02   -3.925346427436305e-01   +1.365688202446902e-02   -2.880405663271755e-01   -9.824626354053266e-02   -2.752782404467956e-01   +3.525490276241745e-01   +9.668589810413773e-02; -3.510710755560967e-01   +1.021299860243196e-01   -1.699003171468042e-01   +2.726784191932086e-01   -3.483872024403369e-01   +1.928085131598616e-01   -1.575251637245568e-01   -3.153043429601660e-01   +1.855316028453289e-01   -1.628455866759093e-01   -2.757657891072041e-01   +1.398543744325782e-01   -1.175452384330425e-01   +3.417153309242798e-01   -2.989580175095522e-01   -5.906814147925159e-02; -1.830183612205360e-01   -3.110429931996680e-01   +1.595730507508110e-01   -2.236323049618972e-01   +2.807803428418845e-01   -1.376425764076711e-01   -6.189157047014073e-01   -1.043961033063604e-01   -7.866185405415460e-02   +1.168436214165627e-01   -2.211629908753507e-01   -1.970647118624206e-01   +1.943838745475913e-01   -2.795555996896804e-01   -1.839566413583540e-01   +4.733175753966068e-02; +2.209496526424096e-01   +1.185592550608338e-01   -2.425138998640485e-01   -1.018416740223427e-01   +1.036902876311949e-01   +3.368145373773112e-01   +2.634327230837532e-01   -2.375834412862118e-01   -2.299004965571727e-01   +3.910371378890211e-01   +3.577872238385723e-01   +1.160347235292328e-02   -1.998881805435535e-01   -9.595546716521046e-02   +1.185430754023631e-01   -1.196267100797907e-01; +2.086946001880817e-01   +9.316995637749312e-02   +1.448729913672384e-01   +5.860507427175166e-02   +3.199517748744922e-01   -2.772417851616419e-01   -1.283119620261050e-01   -4.133327022321527e-01   +3.150134789324380e-01   +1.784961785120945e-01   +4.063318945630084e-01   -1.409344607082146e-01   +2.722758418496348e-01   +2.172787050310239e-01   +5.526387468343407e-01   +3.087419120368417e-01; +2.969297962445338e-01   +2.057396775600705e-01   +1.688070948231411e-01   -5.782329469604376e-01   -8.065374382813793e-02   +3.251669918632735e-01   -1.093164638083716e-01   +1.429275254666712e-03   -9.626498959612335e-02   -3.638636101610400e-01   +4.104843917396179e-01   -1.237053955647734e-01   +2.527501379187367e-01   -2.824580657036665e-02   -3.595060769258391e-01   +4.805412949258431e-01; +2.296391501081897e-01   -2.059230257532330e-01   +8.742364679961112e-02   +9.197601446234610e-02   +1.975965947571494e-01   +5.399728955457272e-01   -2.867794795864181e-01   -5.673791496651302e-02   -1.098391849111514e-01   -1.761605264748047e-01   -1.297269426204129e-01   -1.619517021297285e-01   -1.170585198865648e-02   -3.316609379240928e-01   +4.381443713777661e-03   +2.480820199881871e-01; +3.573468369722314e-01   +8.313763766244336e-02   -9.585803073670598e-02   +5.151975158486806e-02   -1.897939005428023e-01   -1.309579182343771e-01   +1.339192404501671e-02   +1.439990854879664e-01   +2.778698784374726e-01   -2.084859357302683e-01   +7.273621995300147e-02   +4.358562295269501e-01   +9.496935770333209e-02   -1.948703144427166e-01   -6.360287544167004e-02   +2.872547883846632e-01; -6.608198013794860e-02   -1.790767831149322e-01   -3.145208631002112e-01   +1.300865068184541e-01   -3.342288026430019e-01   +7.441418987281234e-04   -2.541217767017377e-01   -4.686323910666182e-01   +2.828611114909528e-01   -2.649909092955705e-02   -9.287719236750508e-02   +2.508055492977278e-01   -8.246650291569152e-03   +4.024306171623297e-03   +2.010633809202751e-01   -2.755394040075478e-01; -1.117346474531973e-01   -1.187778334673373e-01   +3.314933194526585e-01   -3.952840947217172e-01   -1.796968388432365e-01   -1.942308796706785e-01   +2.235772821425481e-01   -9.965137233983096e-03   +2.118414020534487e-01   +6.874216519323850e-02   -2.828429941810102e-01   +4.008908124915107e-02   +3.519681816684874e-01   +8.239700311292636e-02   +1.105517456795485e-01   +2.120156348901323e-01; +2.298902905043046e-01   -2.094840993991654e-01   -2.796247253813321e-01   +1.794897075305446e-01   -3.803678787922162e-01   -3.281430445412043e-01   +4.737059882641988e-02   +2.080180202637387e-01   -5.370808404708044e-02   +1.000001150867900e-01   -6.643920839128666e-02   +1.208623929040115e-01   +1.426914826953534e-01   -7.551304641477688e-02   -1.630630414447126e-01   +1.239503170955097e-01; +2.129280977079434e-01   -2.632766830421099e-01   -2.046766247678054e-01   -1.791018348032075e-01   +3.705315525880465e-02   +4.942369549723175e-02   +2.891804413689454e-01   +9.464373313829710e-02   +6.154255757214410e-02   -4.458254278396902e-02   +5.045201624849858e-02   -3.439839660650529e-01   -9.918563654476253e-02   -8.727599217080501e-02   -2.217626252412812e-01   +2.760830713142574e-01; -1.651213799538589e-01   +2.708659134291361e-01   -3.184397618044802e-01   +1.812311308073530e-01   +5.713599113211693e-02   -4.120967918210044e-01   -1.903144882658681e-01   -3.243791510705154e-01   +3.264882779966350e-01   -4.136996673563477e-01   +7.280542505816523e-02   +7.669692786745314e-02   +2.440082376599688e-01   +7.576530334488486e-02   +3.159709941934588e-01   -1.714498446643808e-02; -1.630187805493334e-01   -2.461521199652803e-01   +2.199292444259699e-01   -1.160771311578728e-01   +2.270052733636227e-01   +9.975529166314924e-03   +2.552116672774852e-01   +3.155411169206122e-02   +1.312507555172426e-01   +1.892087715839531e-01   -1.722769372599018e-01   -2.184508250095657e-01   -3.139075458012187e-01   -2.260541475271323e-01   +3.924311270221562e-02   +2.020271995995971e-01; -3.717791299292386e-02   -1.839660929660499e-01   -2.274123493732023e-03   -8.843431731616558e-02   -6.637178302740493e-02   -4.422473834582947e-01   +2.002078324208435e-01   +2.534163777494883e-01   +1.738369978034590e-01   -4.177514894229780e-01   -2.927160928975444e-01   +1.258136875956226e-01   +5.491323934064707e-01   +1.680114985887828e-01   +3.012919323622056e-01   +9.858603643255309e-02];
L2I_L1I_iGABA_netcon = [-3.628635011091011e-01   -2.960425008843313e-01   +4.025213822143029e-01   +2.722582391949078e-01   +2.192897754328071e-02   +4.120182762026313e-01   -2.324119490805067e-01   -1.668941348991950e-01; -3.509834727143841e-02   +1.231063381001434e-01   +2.830845074353274e-01   -4.546063787864642e-01   +1.200158507296536e-01   +5.472410355250850e-03   +2.273089659849735e-02   -3.790904445431441e-01; -1.087672161473144e-01   -1.815525148895693e-01   -2.203270912156145e-01   -9.316300184091383e-02   +7.918377026058189e-02   +1.433688052814395e-01   +2.679455739144858e-01   -1.765695164760477e-01; +2.011417771683650e-01   -2.531355994776581e-02   +5.918467189749400e-02   +2.329691842071294e-01   +2.311994453201926e-01   -2.278284606615542e-01   -1.187972795413567e-01   +4.782614816361108e-02; +9.776227843204979e-02   -2.721279437450423e-01   +4.849662551751896e-02   -3.042810698297895e-01   +3.577155091840692e-01   -3.833063913484199e-01   -1.387284597132575e-01   +1.340388573940317e-01; -3.986004821763579e-01   +3.853732448544929e-01   -7.926121441400383e-02   -3.228809954203339e-01   +2.106782913421926e-01   -1.521038165592817e-01   -1.874835611939607e-01   -9.820775827064546e-02; -1.900171076258145e-01   -1.286384128635610e-01   +1.491747185619393e-01   -1.759783172575528e-02   -2.152599908245349e-01   +2.796977915013886e-01   -1.251335885763739e-01   -8.022326428630525e-02; -3.262309049890345e-01   +3.789483624339455e-01   -1.964511316731606e-01   +8.005901488522317e-02   +1.628949514315981e-01   +5.490443678421213e-01   -1.762663508504850e-02   +1.027116289956616e-01; -6.695946352771680e-02   -1.587284663705725e-01   +2.195480655353094e-01   -3.224082442055457e-01   +6.661228141194972e-02   -1.014021684549271e-01   +9.296467334777256e-02   +1.177523172428196e-03; -1.566788042425001e-01   +4.405576769565757e-01   +8.233931425508964e-02   +2.793008451868340e-01   -3.382178268281813e-03   -4.193449881246706e-01   -4.098100349065437e-01   -1.155148672109124e-01; -2.329545471620124e-01   -5.806508014252179e-01   -1.382048349120658e-01   +5.085345049518490e-01   +2.445466520508848e-01   +2.466991351340154e-01   +1.759491653744937e-01   +1.794553535541339e-01; -1.823990886178730e-01   -7.282897992572675e-02   +5.933784534684362e-02   +3.832531444305083e-01   +4.950108915554637e-01   -3.996293897583549e-02   -2.426341478058134e-01   +1.282834982726188e-01; +2.253769413000715e-01   +2.820620411403015e-01   +3.651337118049797e-04   +2.455645031740300e-01   +3.001255209043623e-01   +2.261766210504330e-01   -3.111854666018269e-01   -7.705825941111082e-02; -1.250682824352441e-01   +2.424801746980047e-01   +1.976803255243079e-01   -2.745558723159396e-02   -7.114705948265765e-02   +3.679420470154561e-01   +1.187571957474136e-01   +3.813850072220477e-01; +2.499139299801026e-01   +1.263251811977471e-01   +1.422255570370387e-01   -3.303149859901591e-01   +1.648522607403263e-01   -2.678521980927354e-01   +1.684139744788341e-01   +1.801951003012450e-01; +4.267071512608028e-01   +1.366540830535291e-01   +3.127001856021269e-01   -2.959093732783813e-01   -5.029522705790842e-01   +2.679121262237897e-01   -8.872826360230007e-02   +2.190774671587961e-01];
L1I_L2I_iGABA_netcon = [+1.922996115247977e-01   -8.013861829091128e-02   +2.580258733010880e-02   -2.382697653781776e-02   -2.909777295535939e-01   +7.294281372890472e-02   +3.031150511623905e-01   +5.275843923536908e-02   +4.278419712045049e-01   -1.251968873644443e-01   -1.556110994485350e-02   +9.968959459886323e-03   +2.723926701723118e-01   +1.565242286824106e-02   +1.721476691101962e-01   -3.611265293582188e-01; -3.333122697061542e-01   +3.360542664742551e-01   +9.871385086527021e-02   -1.796520665335905e-01   -7.247874334822940e-02   -2.634359932499013e-01   -3.484212991322366e-01   -2.321668976948869e-01   +2.466479585464335e-01   -4.699777065070015e-02   -4.200510388490921e-01   +4.117438621316586e-01   -2.503645445114364e-01   +4.754941856006795e-01   -2.001580172068577e-01   +3.854921311945931e-01; -3.813895599529307e-01   -1.080983659585362e-01   +1.986861185978993e-01   +4.928912039848002e-02   -3.967331207119575e-01   -2.362302995432109e-01   +4.651197076673731e-01   -3.105551072788639e-01   -1.690307228095204e-01   +1.601157978182182e-01   -1.507633693678043e-01   +1.418826310735316e-01   -1.292144175513977e-01   +2.306765958596580e-01   +3.188840003501018e-01   +3.580486905429216e-01; +1.516962419606149e-01   +2.120801348816134e-01   +1.207106713499525e-01   +2.362288697669358e-01   -1.599198220835509e-01   -4.669846743835788e-01   +2.120199436639676e-01   -7.128401042324804e-02   -2.429615200616493e-01   +2.692861385396347e-01   -3.500709246271054e-01   +1.960447780377143e-01   +2.262765811272691e-01   +2.663455984325506e-01   +9.304059313489238e-03   +3.024824287440168e-01; +2.496434146280960e-01   +5.355387923611094e-04   +1.045568833152329e-01   -3.524263706567067e-01   +2.995199871559669e-01   +1.903774206495941e-01   +2.984661346812585e-01   +1.481972235382723e-01   -2.212948620454991e-01   +2.788892972264398e-01   -2.770447370037273e-01   +8.179979129327959e-02   -1.931613998215626e-02   +2.783471241000376e-01   +1.937304268609058e-01   -2.665833480735521e-01; -1.185549472880049e-01   +2.115600196861270e-01   +4.786752633346039e-02   -3.163201047791346e-01   -7.342597718959051e-03   +2.694569632841575e-01   +1.544810336558654e-01   -4.117715531878592e-02   -1.131085710338181e-01   +6.161221853017064e-02   +2.696854529276610e-02   -1.671413614543380e-01   +3.103768112575838e-01   +1.489334881419805e-01   +2.838714979403819e-01   -2.112419891987630e-01; -1.914067093526254e-01   +2.483206281760106e-01   +2.095641559233052e-01   +1.094997358391675e-01   -2.119698098685982e-01   +1.129854363014576e-01   -8.741001188612679e-03   +1.099191528308518e-01   +2.322531470150414e-01   +2.094569926449282e-02   +1.111493546059851e-01   +2.613130530368544e-01   -2.523582002372871e-01   -2.413542689397975e-01   +2.291597376827259e-02   +5.344062655416247e-01; -4.289957651956576e-01   -4.585941174296063e-01   -6.460436259126331e-02   -2.225617649399062e-01   -2.703040863322272e-01   -4.767978865471953e-01   -1.334243493919707e-01   +2.860341896472948e-01   +5.577174712212769e-03   -1.015377151668534e-01   -3.183622326477658e-01   +5.006330939911736e-01   -1.118752420147211e-01   +1.615959236708953e-02   -2.816854524859372e-02   -1.683590318571093e-02];
L2E_L1E_iAMPA_netcon = [+1.017694774161640e-02   +3.865150831704945e-01   +2.095717505495901e-01   -2.422948480930646e-01   +7.809488027718919e-02   -2.145845024637402e-01   +8.629970222704120e-03   +6.979648884816861e-02; -1.970664531831926e-01   -1.531317212089108e-01   -6.506615832589774e-01   -1.492051775388916e-01   +1.305418099912599e-01   +2.214805306758696e-01   +2.731471792763941e-02   -3.685075351115703e-01; -3.519321103510271e-01   +3.736738260232356e-02   +5.195741133090288e-01   +4.063537489269140e-01   +2.556807397673622e-01   +3.671768187656009e-02   -1.777173939588977e-01   +1.635178377642790e-02; -1.844743889135784e-01   -4.562567328669411e-01   -3.446966188146638e-01   -1.281515558910507e-01   +2.894535453624505e-01   -2.979403118011010e-01   -1.357017932614198e-01   +3.335055211584579e-01; -1.868797459408779e-01   +3.473336233632157e-02   +1.941124726551208e-01   -2.482212643852119e-01   -5.906298300362839e-02   +1.729501370722500e-02   +4.063094673971494e-02   -3.001074388755845e-02; +2.237884360460677e-01   +4.067490031760783e-01   +2.183850212887449e-01   +3.171579234875728e-01   -9.917100378672133e-02   -1.325874687280033e-01   -5.260050092681716e-02   +3.573503280618406e-01; +2.417446890943181e-01   +3.238602485318126e-03   -2.968767949235215e-01   +3.358875250685118e-01   -2.808154254145522e-02   +1.708999889379306e-01   -2.751919073606506e-01   +2.579857887837737e-02; +2.174520577550598e-02   +2.632023409295044e-01   +6.878007444973806e-03   +2.110484917096979e-01   +4.823229011030981e-01   -6.036580703856507e-02   -1.540684930005879e-01   +3.548258087070402e-01; +3.895185859521066e-01   -2.105451508472196e-02   +3.047122967191505e-01   +9.480472410889235e-02   +1.901453164714328e-01   +2.581338174234165e-02   +1.523209719887576e-01   -4.716096448787771e-01; +2.767540674545600e-01   -6.682825861131492e-02   +9.207717903605185e-02   -2.203829708140135e-01   -1.584407373813682e-01   +6.643053456016672e-02   +4.369204217773381e-01   -7.535188821100192e-02; +2.518444684878130e-01   -3.206283484403470e-02   +2.824824577939082e-01   -7.558886071451465e-02   -2.825028234591961e-01   +2.972534668179345e-01   +2.967093464539546e-01   -9.115779027978101e-02; +1.773563125230425e-01   -1.778862153935213e-01   -2.291124309209486e-01   -1.165999733654951e-01   -3.684812825608196e-01   -2.082936891058054e-01   -1.377207252313842e-01   -1.333697088130048e-01; +5.342362581983288e-02   -3.455662889650192e-01   +6.211751616870156e-02   -6.904362568251748e-03   +1.029479460020744e-01   -4.088032532354818e-02   -4.622405598422278e-01   -1.916848412071163e-01; +6.614298452142825e-02   +7.054504309448412e-02   -3.102975418824521e-01   -2.000444197845517e-01   -1.622077244295165e-01   -2.316613887756621e-01   -1.800187917083890e-01   +1.611894377266561e-01; +3.490130696608473e-03   +8.294477363271872e-02   +1.706171962314962e-01   -1.232332016663319e-02   +3.099943319192753e-01   -1.094069580483710e-01   +4.121145171964837e-01   -2.310853473936661e-02; -1.890221288740234e-01   -1.480749906224433e-01   +9.938881417763555e-02   -3.986490940203732e-01   -3.761406243672453e-01   +3.660631581371939e-01   +4.068578126129467e-01   -1.704549934332441e-01];
L1E_L2E_iAMPA_netcon = [+5.746696278932334e-02   -9.693117048723071e-02   +5.323739709496414e-03   -4.262543349983969e-01   +1.192359196977575e-01   -5.642966239331723e-02   -1.651114396081561e-01   -1.966419027529572e-01   -2.349294876128732e-01   -1.391167351726029e-01   -1.014737068590038e-03   +8.925208169632365e-02   -3.507244203416834e-02   +1.289056807941033e-02   -7.781965416221220e-02   +5.584254728339435e-01; -9.607815358578645e-03   +4.463599395431533e-03   -1.375479062189947e-02   +1.254172282029499e-01   +1.949430084927881e-01   +3.660652813303608e-02   +2.399328221685083e-01   +3.135756847447411e-01   -3.469492081299322e-01   +2.507798333522132e-01   -1.531467757426363e-01   -2.784139776168244e-01   -2.145627884076007e-01   -3.167709202012983e-01   -1.679422188619152e-01   +1.834083288169689e-01; -1.572490661529574e-01   -1.236986193295727e-01   +1.300726494912893e-01   -1.281863597748351e-01   +1.113289728710285e-01   +2.564702668626416e-01   -1.439592625053628e-01   -2.005985534298124e-02   +3.441292629102209e-01   +1.496388883411986e-01   -2.521314234571223e-01   +1.955505473858111e-01   -4.036775771786256e-01   +2.221180282106819e-01   +2.328177299400045e-01   -7.268800716897920e-02; -9.789128783642886e-02   +2.275521238415006e-01   -1.244271883727296e-01   +9.967049802843207e-02   -3.402655806222501e-01   +2.185999840899815e-01   -3.664892442713529e-01   +4.145221073664586e-01   +5.039173111770282e-02   +7.221895468762962e-02   +1.763589571550819e-01   -2.688004787266882e-01   -1.405534209746725e-01   -3.262147457094924e-01   -1.838719215504552e-01   +4.472314227069913e-01; -3.894840388359687e-01   -1.970541982787933e-01   +3.065660362323008e-01   +2.514383775111038e-01   -1.830751755014934e-01   -2.242045965027653e-01   -2.226634403198432e-01   -2.241525455616709e-01   +1.969445808038317e-01   -5.021770226122482e-02   -1.693435452841305e-01   -2.202309939321114e-01   +3.892003956360158e-01   -1.785188106382346e-02   +2.479728464334145e-01   +3.874754396834494e-01; -2.981472465153968e-01   +2.025077585988425e-01   +2.061146007385726e-01   -4.258266847045771e-01   +3.088877275645522e-01   -1.809170584949908e-01   -2.238375432233963e-01   -1.427066183857618e-01   +1.543615891162760e-02   +1.883447669222867e-01   -7.050905402082230e-02   -6.988160188817796e-02   +2.072697189970371e-02   +3.645897082606049e-02   +1.524718896112002e-01   +2.137956565485236e-01; -1.224353990396993e-01   -1.065348837260070e-01   +6.695056095141971e-02   -2.050851579528283e-01   -1.368554628590233e-01   +2.053617692676351e-01   -4.019908795991529e-01   +4.880832416417673e-01   -5.470436640287560e-02   +9.652837038354407e-02   +4.243511135361394e-01   +3.573163387605831e-01   +6.677476113442432e-02   +3.141385747194658e-02   +1.368397482879470e-01   -9.851527996431145e-02; -1.449021430532728e-01   -1.551377880015037e-01   +1.838936982805055e-02   +3.759608392652365e-01   +1.137166629152058e-01   +4.570245660565230e-01   -1.400761290082908e-02   +2.712096177141691e-01   +1.823238792986078e-01   +3.857268343085730e-02   -1.091361309966981e-01   -6.960889396934893e-03   -2.807757570735590e-01   -5.554586774556752e-03   +1.195197857560620e-01   +1.701197811038879e-01];
L2I_L2E_iAMPA_netcon = [+2.992964977888090e-01   +2.982880974448299e-01   +3.758566833367418e-01   +2.307181598826236e-01   -2.488089830553534e-01   -7.904418203312788e-02   +1.110942289248870e-01   -3.398229171097099e-01; +2.400879596461857e-01   +5.054619458427626e-03   -1.641487575887547e-01   -9.471749831435018e-02   +1.366718633200398e-01   +1.765248045109245e-01   +3.159301289606297e-01   -1.772432498976165e-01; -6.314494298596607e-02   +2.050976754258381e-01   -2.319133578635417e-01   +2.972218614439898e-01   -3.962085046292416e-01   +4.671986189450654e-01   +3.496452340476071e-01   +2.527040089397958e-01; -9.384980884613506e-02   +2.214077833326501e-01   +1.252317725179267e-01   -1.434554671398715e-01   -1.278152886990861e-01   +2.098681949549916e-01   +4.635561795605340e-01   +8.141469211847904e-02; +7.328702202951377e-02   +3.098351578781866e-01   -1.133297300392708e-01   +5.590566544012937e-02   -1.461150596369379e-02   -3.154459890780617e-01   +1.319416619585343e-01   -1.290309097128743e-01; -6.100433634147102e-02   +2.987799798913622e-01   -7.324393412937483e-02   +5.115687646897951e-02   -2.002312751237819e-01   +1.065089629978867e-01   +1.672373552865439e-01   -1.639921333144805e-01; -2.218463939302224e-01   +4.596964687559960e-01   +2.659954687598725e-01   -7.027243432564165e-02   +2.568938816938309e-01   +3.299193127154076e-02   -1.345659765399868e-01   -9.082390534542192e-02; +3.250274072808256e-01   +3.213372545358593e-01   +1.391423886114039e-02   -5.993596865312207e-01   -2.801896103046040e-01   +2.320665364473568e-01   -6.411344751411721e-02   +1.963539033491729e-02];
L2E_L2I_iGABA_netcon = [+4.321321692945320e-01   -1.415391194565568e-01   -2.557975799359954e-01   +1.139565803865001e-01   +3.092503812089303e-01   +5.678788870804403e-02   -2.333239210934473e-01   -3.107796505965159e-01; -5.847946257121928e-01   +3.223210342896703e-01   -3.295419361946976e-01   +1.835151550497391e-01   -9.000921775924850e-02   +1.382153118056378e-02   -3.420696726327650e-01   +2.471354046179818e-01; +3.034740282392249e-01   +1.730685891293547e-02   -2.099040867316628e-01   +1.257916466932874e-01   +2.776613107095846e-01   -3.347575430045657e-01   +2.243802813097628e-01   +1.337832734418524e-01; +5.200322862379333e-02   -4.715909595046690e-02   +1.163656846657913e-01   -3.923886090095345e-01   -1.701159728276862e-01   +1.866909006951986e-02   +2.225444376254782e-01   -1.730986113405380e-02; -2.567675233759414e-01   +1.919145026834235e-01   -1.961529008950123e-02   -1.028331227294056e-01   -1.400611442195788e-01   +8.339560185320427e-02   +1.720230481368403e-01   +3.846522423042604e-01; -1.881768819188342e-01   +8.619452897286703e-02   +2.270258496179393e-01   -1.461501345111043e-01   -1.765661819525074e-01   +3.563140512948998e-01   +9.863218505372612e-03   +3.760857419448953e-02; -5.171359066335945e-02   +8.441664736466120e-02   -1.543117822722503e-01   +2.331757458962281e-01   -9.812883454314025e-04   +2.239711488049927e-01   -1.737029715109476e-01   +3.474786953460485e-01; -4.161315921427458e-02   +3.374924814244052e-01   +1.838651203601573e-01   -3.029602680341265e-02   +2.530696722408645e-01   +4.521364088501643e-03   -2.462269520555322e-01   +4.434337920379772e-01];
L3E_L2E_iAMPA_netcon = [-3.008990964651632e-01   -5.563460942428294e-01   -1.328237406128065e-01   -3.535362900042502e-01   +1.574711643817006e-01   -9.455565905974073e-02   +9.047003508743684e-03   -4.729667774184170e-01   -1.669916356173010e-01   +4.245702272417065e-02   +4.571186806242940e-02   -1.798525810693501e-01; -2.229366517947963e-01   -2.893181272194741e-01   -2.622459340763107e-01   +5.147302599117179e-03   -1.156717871329908e-02   -2.677486033646992e-02   -1.670868596533699e-02   -5.515472758254289e-02   +2.334056529960078e-01   +2.993520254541480e-01   +7.354265162949922e-02   -1.914773662246265e-01; +1.928464579049577e-01   +1.225978388779274e-01   -1.674185752936309e-01   +3.540707846878600e-01   -3.418840227112745e-01   -5.422743865748847e-02   -9.174315460173386e-02   -2.137360600592044e-02   +1.494253641374161e-01   -3.912348833847264e-01   +9.812552364630689e-03   -7.785029164195734e-02; +3.055950086732871e-01   +3.683123642742743e-01   -1.120587290913440e-01   +3.472089722169321e-02   +3.794135436743706e-01   -2.098371014332016e-01   +2.062208999104596e-01   +2.265770879825793e-01   -3.082309434765841e-01   -3.212603277539881e-01   +4.188722368815297e-03   +2.366122880441617e-01; +1.056746406877588e-01   +2.129774175645407e-01   -9.942264431787048e-02   +2.838108224117575e-01   +4.217990069954890e-01   +7.873375463936440e-03   +2.638335234594883e-01   +1.870672279879838e-01   +1.227978448980830e-01   +2.650902068188615e-01   -2.160948746406612e-01   +7.916905612822850e-03; -1.515746752949969e-01   +1.530373188863094e-01   -1.929983573072980e-01   +3.143243902901587e-01   -1.110311504212464e-01   +1.490039383174847e-01   +3.385289192999064e-01   +2.174560067902145e-01   +6.721835253795007e-02   +1.542466561375189e-01   -2.431401376666629e-01   +1.032412221446201e-01; -1.623809799794138e-03   +2.281290926856671e-02   +1.582529585477409e-01   -7.098588795861983e-02   +9.795639399173009e-02   -2.505687855953115e-01   -1.712770453865768e-01   -2.797685601837725e-01   +8.963116452221846e-02   -2.764159065578982e-02   -5.221976293204222e-01   -2.870379281100696e-01; -5.136614827536609e-01   -8.044280865889325e-02   -4.471812704591744e-01   -2.999813403292005e-01   +1.681523691423639e-01   -9.123600041870705e-02   +2.198230675617667e-01   +1.376700428203047e-01   -3.512248100115457e-01   -5.961732707556200e-01   +3.561917100634851e-02   +2.099344989599558e-03];
L3I_L2I_iGABA_netcon = [-3.160234898963815e-02   -1.810042679888661e-01   -1.835861003390320e-01   -1.814846637645171e-01   +3.113459089819971e-01   -7.805680856765997e-02   +4.406305213526578e-01   -4.083825607877881e-01   -2.310655010039125e-02   -1.555571376647279e-01   +2.558133204464043e-01   +3.148007655232431e-01; +2.069054606654978e-01   -1.636607308820039e-01   +3.494215041233151e-04   -3.752716228912804e-01   +2.257440949927518e-01   +3.922938264459926e-01   +5.969146621385013e-02   +5.202992829652350e-03   +3.103418250942775e-01   +2.487902896055083e-01   +1.601750674498746e-01   -1.943295303713877e-02; -9.884002256760518e-02   -8.315431979658079e-02   +4.146263900590759e-01   -7.018152492436669e-02   +2.038913031225096e-01   -3.003613178285283e-01   +2.642880839248167e-01   -2.056829274725471e-01   -6.996398888983305e-02   +4.382912549987600e-02   -1.240133598653731e-01   +2.003327030507820e-02; +2.811693006245894e-01   -1.077721512207084e-01   +3.695182700127776e-01   -2.287953972569570e-01   +8.776727917564688e-02   +9.886678792757118e-02   -1.448584005112773e-01   -6.742782621343553e-02   +6.413987377760949e-02   +1.059707700082179e-01   +3.327834273304259e-01   -3.547029237208490e-01; +1.581150017528640e-02   -3.967201507869806e-01   +1.221024887564215e-02   +1.197945116010959e-02   +2.002228425406004e-01   +9.502611622854754e-02   +3.453235474142459e-01   +7.757972780773645e-02   +2.156938688153116e-01   +1.442947838508279e-01   -4.391416291123575e-01   +1.622020628067488e-01; -1.113096331869770e-01   -1.553666059856474e-01   -8.575107522343828e-02   +2.150388291678694e-01   +1.572524454286347e-01   +4.199395174869841e-02   +1.943941391067938e-01   -1.487283751041777e-01   +6.143814444274082e-02   +8.963179050448641e-02   -1.123658624143135e-01   -4.394914107742486e-01; -5.865690920441452e-04   +2.007157029563010e-01   +6.111687272194617e-03   +2.763456235181586e-01   -5.225515920330770e-01   -2.479103402750429e-01   -1.699039343944049e-01   +4.661822326148927e-01   +1.948726417928015e-01   -6.000376402323725e-03   +6.129674122188639e-02   +2.177631989094350e-01; +3.434945516971663e-01   +7.506566606308246e-02   +2.018778888799581e-01   -1.488424532629806e-01   +8.148637443025705e-03   -3.514228846297156e-01   -3.533693261722681e-01   +4.110523421981755e-01   -2.300449830673331e-01   -1.272161572922429e-01   -2.081324597159583e-01   -1.568211650616943e-01];
L2E_L3E_iAMPA_netcon = [+1.648303940325480e-01   -9.322247603985037e-02   -2.961772943461686e-01   -4.122933298021104e-01   +2.858961905545464e-01   +4.034811393778773e-01   -2.347426100193390e-01   +1.043147085006061e-01; -1.759609215670351e-02   +8.832036120472730e-03   +1.517537973259401e-01   +5.328496231345254e-01   +3.141582445524641e-01   -3.842945155695174e-01   -2.241262994285533e-01   +3.461605298160078e-01; +7.957758360292982e-02   -2.184974491040715e-01   +3.840380315313267e-01   +6.868931139469642e-02   -1.248891462724058e-01   +5.346247625698038e-02   -1.139459009882572e-01   -3.626316676730321e-01; -1.827663599677606e-01   -2.329125601250329e-01   -1.334463232901695e-01   +7.009334693722781e-02   +3.704416297674015e-02   -1.350744064799701e-01   +1.432409142081400e-01   -2.491958814778894e-01; +9.452535872064469e-02   +2.945181273957739e-01   +1.467183526707789e-01   -3.933930428466264e-01   -9.420560934112426e-02   +1.495710627639991e-01   +3.451217385715730e-01   +4.190624963901063e-02; +2.480094250458761e-01   -1.961032545631400e-01   +3.219615290083814e-01   -3.816933336322862e-01   -3.716877714835299e-01   +2.729201677047529e-01   +1.824239503124761e-01   -3.193541767842994e-01; -1.348716248470907e-01   +3.946896975980922e-01   -4.474870618024195e-01   +2.728446764281512e-01   +3.138056781162032e-02   +2.160198400479151e-01   -1.838407950460401e-01   +5.092254655360181e-01; +2.484894187907186e-01   -3.769280191839468e-02   -1.749586307639431e-01   +2.898280881167793e-01   +2.320251134005862e-01   +2.511590924930882e-01   -1.947241415038011e-01   +2.635023943022402e-02; -1.131379461894884e-01   +4.443915852991083e-01   +3.548156653007913e-01   -1.788781791540545e-01   -1.087906868086475e-01   +3.161610904639516e-01   -2.254074601637776e-02   -1.436907897269381e-01; +2.666948760472734e-01   -1.628608461350907e-01   +1.314064653480446e-01   -1.745795641468015e-02   -2.769233183769783e-01   +4.252304675553143e-02   +1.372460111457431e-01   +1.718418154539019e-01; +2.862803348102801e-01   -3.231384624246767e-01   -4.416197122839962e-02   +9.007499017747719e-02   +4.364068414470645e-02   +1.285638699441232e-01   +3.658431890567113e-01   -1.519971899082439e-01; -5.402896582746373e-02   -3.252167008804692e-01   +2.704818596664875e-01   -2.578043903587767e-01   +3.891093899583433e-01   +6.328111688359440e-02   -1.347931080586483e-01   -3.724780670478811e-01];
L2I_L3I_iGABA_netcon = [-2.538198399938068e-01   -1.608289445241489e-01   -1.376833595051859e-01   +2.486029291014915e-01   -3.531646040041949e-01   -8.367518822162731e-03   +2.069258545378885e-01   -1.560390147671245e-01; -2.268366076803798e-01   +1.422101784542359e-01   -3.173391526833380e-02   -4.250047633376114e-01   +2.728439796705535e-01   +5.612745202655184e-02   +9.600474944930235e-02   +5.175082924588036e-03; +2.100248694826214e-01   -2.873741485967560e-01   +6.455856340199428e-02   +2.923325813170506e-01   -2.951181986426089e-01   -1.029207972936877e-01   -3.745427700597938e-01   +1.698884837786515e-01; +1.888389728921936e-01   +2.107418093558497e-01   -2.084904501878565e-01   -2.590960721302430e-01   +2.658189503331173e-01   -2.497994412440233e-01   +1.376772071367526e-01   +1.719646137510056e-02; +2.686177902280292e-01   +1.528185191488809e-01   -2.926888805930105e-01   +1.945948603611503e-01   +1.701624353764768e-01   -2.340466611949873e-02   +3.628910192782720e-01   -2.710117098486408e-01; -2.268548097984693e-01   -1.338466185037266e-01   +1.514615412807831e-01   +1.429069125660936e-01   +2.141736032161001e-01   +2.199862046116951e-01   -4.550663985494283e-02   +1.512090445400074e-01; +1.688458411590663e-01   -1.364257505675230e-01   -4.582672423470580e-02   -1.296917211570978e-01   -1.689520016886517e-01   -3.309402677430152e-01   +9.192331765941042e-02   -4.666296427968997e-02; -3.868573714867013e-03   -4.320572512766169e-01   +9.752986419478929e-02   -1.503029223237788e-01   +1.247200166507654e-01   +4.264230880389350e-01   +2.084286364298260e-01   -8.194869951455272e-02; -1.101174898831314e-01   +5.098884853929888e-01   +4.314428843479525e-01   +3.849962110423011e-01   +8.558348983904565e-02   +1.734689708205328e-01   +1.408776096381577e-01   -2.368152161100864e-03; -2.942309067465988e-01   +3.329514374827260e-02   -7.781801570922353e-02   +2.491862619808783e-01   -2.410446966325495e-01   -2.735539323735089e-02   +2.861446448922185e-01   -4.394646214514419e-02; -2.621438310692357e-01   +3.355304715821832e-01   +1.483652701398799e-01   -9.389416872788711e-02   +7.065022966574344e-02   -4.737139786766911e-02   +3.311677819771954e-01   -1.630220749749002e-01; -2.296341601997327e-01   +1.083709529673390e-01   -1.496587685852522e-01   -3.374632228442125e-02   -1.733467115152937e-01   -2.666960153251185e-02   -3.894006273112247e-01   +2.536342623461034e-01];
L3I_L3E_iAMPA_netcon = [-1.004350071658390e-01   +1.353930785829289e-02   +4.065851921645561e-01   -4.045878090964602e-01   +2.016209714666462e-01   -1.807072056906010e-01   -1.783217517576085e-01   +4.773243594959720e-02   -2.358676763594540e-01   +2.398938129444325e-01   -1.963051383696039e-01   -3.328568565959764e-01; -3.458018516617042e-02   -2.833946784146085e-01   -7.257450666177387e-02   -1.375256177825821e-01   -4.540841186975285e-02   -1.701190884943001e-01   -2.125736920880288e-01   +2.675876282856813e-01   +5.133388894155191e-02   -1.304230814541567e-01   -3.277605982044527e-01   +3.608426450363004e-01; -3.541129426428036e-01   +6.120296820923737e-02   -2.949873343450194e-01   +1.042467168796511e-02   +1.190478375188730e-01   -2.962689198631118e-01   -4.505783527278256e-02   -3.898029717913756e-01   +3.847054307312525e-03   -1.332897643070695e-02   -1.732454841992895e-01   +6.183200578998288e-02; -1.356338880044363e-01   -1.915342198643458e-01   -1.524873548968571e-01   +4.409534198572536e-01   +1.471762303603452e-02   -2.935298933893208e-01   -1.714391117314985e-01   -7.218995963823592e-02   +1.143283879823952e-01   +4.475593004766214e-02   -1.174833245496821e-01   -2.677823181362136e-01; -1.658747008428957e-01   -3.054782749285417e-01   -3.903185374458352e-01   +2.897757275622419e-01   -2.928114349387237e-01   -2.680825861465320e-01   +2.989649588011996e-02   -1.961809801448981e-01   +2.224270206533123e-01   -3.219184494559125e-01   -3.133225971106313e-01   +4.170236520390084e-01; +5.152476098732811e-01   +3.410457977958992e-01   -3.993883500560785e-02   -1.622627136661191e-01   +2.199931014397448e-01   -2.097909698498821e-01   +2.689610714119051e-03   +3.688454892786139e-01   -9.901195393150705e-02   -6.075787049196758e-02   -2.624088037347170e-01   +3.720248458720541e-01; -2.461303465457381e-02   -1.861616955797548e-01   -2.897201590885713e-01   +1.887118531825162e-01   +5.326229747290583e-02   -1.124383711994847e-01   -3.739085956681297e-01   -1.824903594570769e-01   +3.450270726592076e-01   -2.444792890374474e-01   +4.866250252721306e-02   -1.653097286394767e-02; -2.657783710324685e-01   -1.792820295800869e-02   -4.119449107723947e-01   -6.865856789028921e-02   -5.064577460810522e-01   -1.945750684489265e-01   -1.976187137795626e-01   -1.840738226270726e-01   +2.009374903295014e-02   +5.033549037711227e-02   -1.383498997388616e-01   -2.137112700392744e-01; -2.524263533307117e-01   +7.343270883362921e-02   +4.282791081822021e-02   -4.041009745816057e-01   +1.621869561356882e-01   +2.360679205123873e-01   +9.465867537501133e-02   -1.636150804482387e-01   -2.541200812316670e-02   +1.696573754549828e-01   -3.365320130812537e-02   -2.672868978067247e-02; -3.407314098746520e-01   +4.927611464205042e-01   -1.892373446493321e-01   -3.200525644240425e-01   +2.574874707431216e-01   +4.361828479470076e-01   +1.494184974733825e-01   +2.526419424184028e-01   -3.378464256575514e-01   +1.566146661777290e-01   -3.063694959059230e-02   -5.543644067854171e-02; +1.455146254236243e-01   -1.356377159403677e-01   -1.238363625356484e-01   -4.503797092275127e-02   -3.579872293817107e-01   +7.892504404457601e-02   -3.487224579056591e-01   -1.731194383613242e-01   +6.676060267332347e-02   +2.829178707348954e-01   -1.708624627373224e-01   -2.330729344231396e-01; -2.993763722090906e-01   +4.083298383754189e-01   -2.108148155557059e-01   -1.944196720833545e-01   +4.693925968114230e-01   -4.365521904748585e-01   +8.007487956728537e-02   +8.488861234924319e-02   +1.007427466865532e-01   +8.433881894778775e-02   +6.413988664812119e-02   +3.785775305051702e-01];
L3E_L3I_iGABA_netcon = [+2.644694643967925e-01   -3.222271502926444e-01   +6.924885287812316e-02   +4.093410717798313e-03   +3.379734515781917e-01   +1.768638315708409e-01   +2.710207020216260e-01   +2.758720952228164e-01   -3.979537058355384e-01   -4.192269585772726e-02   -1.732106718882989e-01   -1.845729506750797e-02; -1.505626022330710e-01   +3.667268557238788e-01   +9.274301520631523e-03   -5.429979429919846e-02   +6.649791068259064e-02   +1.436874408520759e-02   +1.115555815304018e-01   +1.384569204886931e-01   +3.812258974326525e-02   -1.696281557641242e-01   -1.214289914120400e-01   -3.199940472063263e-01; +2.487837972688889e-01   -1.370513612838460e-01   -3.466398557535395e-01   +1.387576160416766e-01   +2.523324075347120e-01   +2.537288291624073e-01   +1.437648634057834e-01   +1.062479484631609e-01   -4.011989859122213e-01   -3.147463464832218e-02   +2.638304442472353e-02   +3.058962636018307e-01; +3.100622578465633e-01   -2.164473428353791e-02   +2.717678753620015e-01   -2.255399154262826e-01   -1.369395493671125e-01   +3.964675306113331e-01   +1.679022617428809e-01   -2.791322559117670e-01   -2.855349868759266e-01   -4.973966554918128e-01   -2.529148545510517e-01   +2.201861703404744e-01; +9.221323524237218e-02   +2.789120723971886e-01   -1.786735209625252e-01   -2.393577315369227e-01   -3.679018040877581e-01   -2.443814168594284e-01   +2.628706337741646e-01   -1.046241729035513e-01   -2.421996209731646e-01   -5.223849188677568e-02   -5.346257549514024e-01   -3.112875957517722e-01; +2.690724232495446e-01   -1.164653194367732e-01   +3.398158301853519e-01   +3.241915249863498e-02   -1.217063962127038e-01   +4.464234106280451e-02   -1.053338078627122e-02   +8.968842578416270e-02   -3.008896053302538e-01   -4.333273576856255e-01   -1.074496697737981e-02   +8.876935645334406e-03; -2.621887131527558e-01   +3.158376892510175e-01   -2.536932875637901e-01   +5.098874665635222e-01   +1.141236631057734e-02   -3.114415340965417e-01   -2.609682208285568e-01   +1.440805824720445e-01   +5.651522694253657e-01   +1.567619323522310e-01   +2.885743810799457e-01   -2.207253810896646e-01; -3.374607764880150e-01   -2.624748535198547e-01   +5.452951996803930e-01   +3.413974004594479e-01   -3.361206707967795e-01   -8.390237683617005e-03   +1.030966353797692e-01   +4.595723410398106e-01   -3.462840747724662e-02   -1.132456601470714e-01   -6.242161598231269e-02   +4.263629579083720e-01; -3.660494104837458e-03   +1.019793178991664e-01   -2.562830206438193e-01   -3.486694987535595e-01   +2.782313773403210e-01   +9.747158949815751e-02   +5.876260662886509e-02   +4.140537593405419e-01   -1.497328331396670e-02   +2.724213303084041e-01   -1.066628694950178e-01   +8.230471406487713e-02; +4.482286179755533e-02   +3.560626259445680e-01   +5.470598701558684e-02   +2.131810135894285e-01   +3.386655699884119e-02   +3.818626100410337e-01   +2.999406478993028e-01   +1.743191943087209e-01   -9.471961459175335e-02   -1.537169129574485e-01   +3.283669215062723e-01   -1.500727137725081e-01; +7.788846639974670e-02   -4.199160054080794e-02   -1.788882013797943e-01   -1.984441700456130e-01   -2.681428123208368e-01   -3.766818942241915e-02   -2.865309783827140e-01   +4.028405607179490e-01   +2.038626284914480e-01   -4.296809893418415e-01   +2.659755894048516e-01   -3.301358030599377e-02; -1.836159534901713e-01   -2.998935725589121e-01   -1.010627843429041e-01   -2.186932345508596e-03   +4.825686046994265e-02   +3.524457216878228e-01   +1.383324716892578e-01   -5.544978546267848e-02   -2.367183203965167e-01   -3.604708002870914e-01   +2.715506748627461e-02   +2.122340136205252e-01];
L2E_Input1_iAMPA_netcon = [-3.266337743122844e-01   -2.446054393595353e-01   +9.531318227003711e-02   +9.152387101864780e-02   +5.216432027089950e-02   -2.058665913236094e-01   +3.858436539324507e-01   +2.689309969116724e-01];
L2I_Input2_iAMPA_netcon = [-3.464479445694653e-01   -2.766754336610997e-01   +4.927057734474122e-01   -7.118461404953108e-02   +2.428540829077641e-01   -1.258755209137234e-01   -1.247838315882642e-01   +6.558659455318130e-02];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.03*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.15*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.15*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.03*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.15*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.15*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
