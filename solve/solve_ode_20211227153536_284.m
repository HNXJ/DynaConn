function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+6.825962443305683e-02   +7.596647725456485e-02   +1.034267717266339e-01   +3.930218317208197e-02   +1.753679408284958e-01   +5.626371730461056e-02   +9.403626878448955e-02   +7.356758708628966e-02   +1.258315502720989e-02   +1.000960899328659e-01   +2.687470519004165e-01   +2.181371181094495e-01   +8.750277525697434e-02   +1.041031554114689e-01   +1.753375827072190e-01   -2.824763408385926e-02; +8.624925462569492e-02   +3.138131734495040e-02   +5.771194612300520e-02   +1.724360035629204e-01   +7.219059967753051e-02   +2.036063268063761e-01   +1.044821193299024e-01   +6.424945915979267e-02   +1.041396778353321e-01   +9.117418204458407e-02   +7.313697638730636e-02   +1.173243451682160e-02   +1.884908872678117e-01   +9.830886440167562e-02   +1.502515744703722e-01   +1.306856334090691e-01; +1.903844707668447e-01   +8.812601005817162e-02   +5.629233519043778e-02   +4.226275909986057e-02   +7.580453195744681e-02   +3.908401257785364e-02   +1.098017612894867e-01   +7.224762646053656e-02   +7.251053619274841e-02   +2.393571377964826e-01   -2.235457278711175e-03   +1.151831711248739e-01   +6.600888496716263e-03   +1.267426418535780e-01   +7.196781159717847e-02   +1.376066903235489e-01; +1.546258416935887e-01   +1.616634318826275e-01   +1.818487962999563e-01   +1.797855278931721e-01   +1.414395944835048e-01   +7.362892366244925e-02   +1.100123705578892e-01   +1.861686986172202e-01   +3.156338559374422e-02   +1.024364809540465e-01   -9.631688383899495e-03   -3.810538511633445e-02   +1.255254437234113e-01   +5.988497105286796e-05   +1.849649944540723e-01   +2.161684355211308e-02; +5.748945350320970e-02   +1.346527414873671e-01   +1.956818087774100e-01   +1.139420260981312e-01   -3.544878626679437e-02   +2.953007049475769e-02   +1.784046655508238e-01   +7.967974036156784e-02   +9.751044844097066e-02   +3.466221423715256e-03   +6.089184765016559e-02   +3.555773723443045e-02   +1.318577811172206e-01   +9.087206808734660e-02   +1.602023290300391e-01   +2.154857987608136e-01; +9.536639857869689e-02   +1.303857712034033e-01   +4.354391474097118e-02   +2.133210613832766e-01   +2.079448061416194e-03   -2.047182552006752e-02   +8.391905227772650e-02   +8.721318586927096e-02   +1.308342047134926e-01   +6.621043239496656e-02   +1.795829235573457e-01   +2.044199484808537e-01   +5.549782493791470e-02   +1.461346485918855e-01   +8.447563370585839e-02   +9.677612259598149e-02; +1.511468689465747e-02   +5.764133893319764e-02   +8.709119377999408e-02   +2.007733409504151e-01   +9.052949169754150e-02   +1.920477723049541e-02   +1.290829784335446e-01   +2.542246486288514e-02   +2.078539720138373e-01   +8.332874216361005e-02   +1.333559231982348e-02   +1.550614338322313e-01   +6.094397027162689e-02   +1.405279119825354e-01   +1.460281899787373e-01   +1.165183657564035e-01; +1.622422510266944e-01   +4.394780223394305e-02   +4.900623360063452e-02   +3.011734594286335e-02   +3.965710119825328e-02   +2.208644144453252e-01   +8.539416977452567e-02   +7.259538212490457e-02   +5.847266978105718e-03   +6.093077960740353e-02   +1.119168240484920e-01   +8.680660508944789e-02   +9.534468994833403e-02   +1.660409239563261e-01   +1.774380633085483e-02   +2.271594004391696e-02; +1.492043286819419e-01   +3.821111572265050e-02   +1.043124063332852e-01   +1.332074616413813e-01   +1.421374998081885e-01   +1.041970163859753e-02   +5.111615169326730e-02   +1.971636072914995e-02   +1.256193986373988e-01   +2.028709864498177e-02   +1.597159248774535e-01   +2.249289870485944e-02   +7.229963945535348e-02   +7.317370348106757e-02   +1.077827632309410e-01   +7.811751087469897e-02; +1.006037730516614e-01   +1.251552173636831e-01   +1.449879590826487e-01   +1.095049826147347e-01   +1.885503563765344e-01   +1.750359061923946e-01   +5.137626628946160e-02   -8.433835480509622e-03   +5.571226839818735e-02   +2.070805926730623e-01   +1.167334326967098e-01   +1.037545431212080e-01   +2.267222667546034e-01   +1.689487950303969e-01   +1.380237819376039e-01   +3.401872393570727e-02; +2.389520474537122e-02   +8.965822064744181e-04   +1.915835329491436e-01   +8.394735061687224e-02   +8.035024903229253e-02   +2.555153610018983e-01   +1.149409729796203e-01   +6.706512951448723e-02   +2.784918110162000e-02   +6.755391311731110e-02   -2.142636287171139e-02   +1.006912059392590e-01   +4.125317434533934e-02   +5.713995049675887e-02   +1.660169014839678e-01   +8.177997011368235e-02; +6.086986067119640e-02   +4.995099255079875e-02   +3.012917028445253e-02   +1.213993162510418e-01   +1.191339556057133e-01   -9.364519297422548e-03   +2.246037014532357e-01   +1.583359774008363e-01   +1.159325644373676e-01   +8.977100730006030e-02   +1.209662943884310e-01   +1.471072372603061e-01   +1.219892826819021e-01   +1.393898321309051e-01   +1.705247671515335e-01   +1.954090717332742e-01; +2.355153321942105e-01   +1.722000519441131e-01   +1.051604075855679e-01   -1.587284135499864e-03   +9.285335148767228e-02   +7.693334671992524e-02   +1.172347956644365e-01   +5.317545031694064e-03   +1.636798447263570e-01   +1.871028854251778e-01   +1.759885032505223e-01   +3.015280540071311e-02   +8.704186665360679e-02   +1.236828663124614e-01   +1.614956003023830e-01   +7.958758189235207e-02; +1.688328051844178e-01   +5.569393169302141e-02   +9.362789746262218e-02   +1.636285495277257e-01   +1.765019567887726e-01   +6.650892973542655e-02   +7.672998973957373e-02   +6.747621259907917e-02   +1.457348786461827e-01   +1.152705540621874e-01   +1.867179389030333e-01   +2.007244449146868e-01   +1.569430702604811e-01   +2.078950029003541e-01   +2.150784496894548e-01   +7.872527290529184e-02; +1.713922147649609e-01   +5.751732180390591e-02   +1.775850074547816e-01   +1.883457010609107e-01   +1.595569063302462e-01   +1.129369000728589e-02   +1.589324070886544e-01   +6.398045980323773e-02   +1.025036470399305e-01   +1.426172125376451e-01   +6.253843448511646e-02   -3.436919600021203e-02   +1.697996902475885e-01   +8.704025265301712e-04   +1.079170576981536e-01   +1.614541490054177e-01; +2.034111151529948e-01   +1.568367700981901e-01   +1.734248358020039e-01   +1.836968119800912e-02   +1.351109440612722e-01   +1.404081646368940e-01   +1.152132940357445e-01   +1.108458288052628e-01   +1.180046359600410e-01   +6.712158706999527e-02   +2.642897383026136e-02   +2.617990513123975e-02   +6.650391970956751e-02   +3.212182743178665e-02   +1.757285085115613e-01   +1.674677110940317e-01];
L1E_L1I_iGABA_netcon = [+2.133226415954043e-02   +2.316250377023876e-01   +2.337689270535230e-01   +1.732300932384197e-01   +1.649950504360778e-01   +1.199923366659636e-01   +1.821296901824555e-01   +3.472242706912304e-02   +1.944232089870603e-01   +3.734955561221456e-02   +1.650076802725516e-01   +4.934199163058300e-02   +7.107215326343412e-02   +1.680160702648358e-01   +1.068831004705778e-01   +1.736482866865418e-01; +1.812098580533853e-01   +1.033259058752485e-01   +1.226857894821873e-01   +2.967637038732359e-02   -3.469130911662569e-02   +1.115301770249004e-01   +7.219776804390544e-02   +1.323664626945515e-01   -3.111643677279775e-02   +7.182221569051015e-03   +2.128942362346754e-01   +7.959851924108499e-02   +1.250471572812729e-01   +8.450639659039272e-02   +5.049066184215134e-02   +1.061734958821924e-01; -7.001199600370649e-03   +1.468209703061960e-01   +7.861148614588756e-02   +7.590326632246082e-02   -2.872876639828413e-03   +3.424374597084306e-02   +7.965651431677215e-02   +1.556326397053546e-01   +3.120448177425081e-02   +4.925810585560170e-02   +1.127574098162502e-01   +1.033915017525412e-01   +9.723557799791795e-02   -2.553784698328607e-02   +1.185998306981031e-01   +1.475295778024647e-01; +7.420497573479952e-02   +9.845701293718910e-02   +1.532140398556849e-01   +9.670564460849625e-02   +1.039103529683262e-01   +2.118258639328947e-01   +1.177968642216718e-01   -2.374063329493049e-02   +1.016583947858558e-01   +2.054812437770530e-01   +1.293883918464554e-01   +2.002430122397675e-01   +6.738961594389031e-02   +1.336273208365637e-01   +7.128201862315484e-03   +6.236443683699583e-02; +9.466297989652686e-02   +1.807477360179979e-01   +2.156562131934494e-01   +1.943126454588994e-01   +7.993643752100332e-02   +8.150143237376843e-02   +1.035430934312129e-01   +1.586613603609288e-01   +2.061541195753613e-01   +1.373730486915415e-01   +2.041895977849887e-01   +1.236178311096311e-01   +4.713270945072551e-02   -2.828613568764200e-02   +5.130963912301554e-02   +2.028949728605142e-01; +1.795036039893006e-01   +1.177623304546512e-01   +1.090660698560824e-01   +1.523989810001315e-01   +1.153161026505869e-01   +6.098617040679283e-03   +3.464909948678643e-02   +3.891551940375017e-02   +1.866506334561314e-01   +1.175366293349905e-01   +1.574187840078358e-01   -5.389926318890218e-02   +1.087344450727169e-01   +1.241112453957733e-02   +7.313656349503202e-02   +9.033149084554919e-02; +8.865517202975858e-03   +1.918881595873132e-01   +2.074784608346222e-01   +4.036043260944244e-02   +8.945879181674089e-02   +2.116177381759196e-03   +2.129868494555467e-01   +1.798726204733413e-01   -4.144914246443908e-02   +1.439409455707337e-01   +1.889384020564847e-02   +1.229468443479600e-01   +1.197718118522144e-01   +1.173002642036992e-01   +2.780869721218733e-02   +8.817456284183300e-03; -3.336958787572362e-03   +1.293565594780201e-01   +7.917588434397349e-02   +8.362392796879711e-02   +1.050421409846582e-01   +1.832124030138042e-02   +8.131351751979662e-02   +2.866682168205735e-03   +1.521875308493945e-01   +1.033466709068149e-01   +3.055010733863251e-02   +7.198266506822214e-02   +5.619609910070061e-02   +7.182578246433871e-02   +7.494481458313246e-03   +2.292705940534733e-01; +1.189474364223284e-01   +2.011180596887086e-01   +1.795706682385343e-01   +9.257159822989321e-02   +4.188039151100349e-02   +1.262097004397224e-02   +5.361171443812247e-03   +2.541731000700384e-02   +1.349027912814242e-01   -1.528618926131640e-02   +1.099011967437151e-02   +1.433211156567644e-01   +1.303494051722863e-01   +1.302529361839477e-01   +2.110333748592163e-01   +1.183477170961711e-01; +8.534179243527838e-02   +1.630177597745023e-01   +2.222672581145032e-02   +6.646678363746517e-02   +3.881407743871444e-02   +9.943701874533134e-02   +1.273641067057696e-01   +6.374569079087489e-02   +1.516055535098218e-01   +6.524474030302048e-02   +1.084826994850203e-01   +6.743781675182743e-02   +1.664520743485630e-01   +2.014789713271993e-01   +1.416959357744951e-01   +1.169952128364832e-01; +1.372374085179950e-01   +6.445094898146435e-02   +6.105844413229387e-02   +5.705968999366198e-02   +1.704611670830017e-01   +2.032592616095190e-01   +1.729822739680970e-01   +1.426976272378939e-01   +7.914180720667884e-02   +7.301280565248530e-02   +4.135871848039238e-02   +1.514173923554767e-01   +7.474944748635122e-02   +4.962012815971192e-02   +9.954712203920237e-02   +1.069387699897772e-01; +1.655606150717558e-01   +2.801440393485905e-02   +7.495500994634202e-02   +1.140240575734384e-01   +1.587862874963429e-01   +1.826487667449344e-03   +1.297815760612044e-01   +1.373863875882090e-01   +1.362979254151183e-02   +6.056719760397986e-02   +1.318818821363643e-01   +4.132139257449112e-02   +3.076456341354616e-04   +1.288464274044026e-01   +2.060479545931996e-01   +1.584680941805055e-01; +4.130598788933484e-02   +9.211165675984982e-02   +1.530067045932340e-01   +1.353102573935832e-01   +9.303603947890333e-02   +3.372863485972672e-02   +1.131995807682456e-01   +1.221110665855345e-01   +1.356361888550140e-01   +2.058991824769081e-01   +3.945585074153173e-02   +8.929013980385359e-02   +2.277531763847674e-02   +1.014448156576255e-01   +6.574000456589892e-02   +1.012712601882128e-01; +3.629719471458029e-02   +5.604735883711929e-02   +4.927852360214689e-02   +1.042685718682701e-01   +1.815131236219996e-01   +3.158670495896946e-02   +1.421423054176010e-01   +5.075782810291199e-02   +1.114970040614392e-01   +1.038214359735346e-01   +1.171603185686016e-01   +7.863539995737040e-02   +1.897872343656004e-01   +1.843424938843570e-01   +4.165303669703308e-02   +1.133374918912932e-02; +6.359176348394210e-02   +4.902135421251751e-02   +9.397779100877968e-03   +1.447763906303072e-01   +8.803624437394232e-02   +8.080606263420612e-02   +1.024144952659196e-01   +9.398875438844953e-02   +1.131737072451134e-01   +1.446170012244770e-01   +9.994424075079880e-02   +9.161652695717304e-02   +9.906581650679785e-03   +9.813533131807323e-02   +1.357650447562328e-01   +2.094198229219777e-01; +9.400359108529045e-02   +7.841991900788409e-02   +8.147430748039361e-02   +4.711552529168384e-02   +1.094773380337279e-01   +2.046102819760672e-01   -2.885475175912484e-02   +1.547144536004648e-01   +1.116686612980676e-01   +1.723078667101164e-01   +1.317096676786435e-01   +8.755137350319063e-02   +1.034742895368501e-01   +2.447228124128147e-01   +1.843030057955478e-02   +1.064656402088032e-01];
L2I_L1I_iGABA_netcon = [+1.355232175594189e-01   +1.875780493551691e-01   +8.273466460730713e-02   +1.291745186340802e-01   +5.828138142355736e-02   +1.382408831350650e-01   +8.738097216069021e-02   +1.626802536341561e-01; +4.149387706433758e-02   +1.513193505081509e-01   +9.404650854784248e-02   +9.937039807873393e-02   +1.133025993899465e-01   +1.556944686406776e-01   +1.493223350358078e-01   +6.582553368297647e-02; +4.739588792428212e-02   +1.110392329357321e-01   +2.024809966769820e-01   +5.894018886930013e-02   +1.159762776510120e-01   +4.512630393573625e-03   +1.584724756639694e-01   +1.706176873456279e-01; +9.608879901311163e-02   +1.524910419434549e-01   +7.345345569867154e-02   +1.039642818708843e-01   +5.585294144370364e-02   +1.693211807864269e-01   +9.175791892527964e-02   +1.811264362220248e-01; +1.657731473334988e-01   +7.953853561809801e-02   +1.193947006583543e-01   +2.549192558845707e-02   +2.118518059129425e-01   +1.956846171603988e-01   +8.922567848902682e-02   +1.266480534177596e-01; +1.155136757554470e-01   +1.737791471782326e-01   +1.894179692093652e-01   +1.008799439015899e-01   +1.023981820679525e-01   +1.174831602535449e-01   +8.705816643828103e-02   +1.217443824889339e-01; +1.731302082910673e-01   +1.743253854365424e-02   -2.515158458216459e-02   +1.524168967221623e-01   +1.794474935885439e-03   +5.244831303773689e-02   +1.037787384163210e-01   +7.503351446522039e-02; +9.995209893055583e-02   +9.283118497329951e-02   +6.116823281876853e-02   +2.399341348863906e-01   +6.563420245962344e-02   +1.622881195458144e-01   +3.820477618473936e-02   +3.349422108828236e-02; +1.341245452019571e-01   +8.495633061254530e-02   +2.959085993288929e-02   +1.520073306184158e-01   +1.493824517011170e-01   +2.020202759859711e-01   +2.641426468451801e-01   +2.602185004887327e-02; +6.870010494135928e-02   +1.683084091413021e-01   +9.723522381723529e-02   +1.891964234082656e-01   +1.677001269124186e-01   -1.170852017247441e-02   -9.443197635163917e-03   -2.643288680987110e-02; +1.736169258467066e-01   +5.786062767426844e-02   +1.851696795421523e-01   +8.484633980353667e-02   +7.195641852991466e-02   +2.054176535756154e-02   +1.796939706287306e-01   -6.323822684947975e-02; +7.015940247977469e-02   +1.661707175255740e-01   +6.265346681805395e-02   +1.329985200839389e-01   +2.023854922368842e-01   +9.883503748378565e-02   +7.517337330773090e-02   +3.377302846147723e-02; +7.892753364099014e-02   +2.279461665092353e-02   +5.229724080819025e-03   +2.039879268434214e-01   +1.007057689043286e-02   +1.536648927079580e-01   +1.199134255467934e-01   +9.518238132197307e-02; -6.895864125788895e-02   +1.686967486180732e-01   +3.758169468798545e-02   +3.285493332530393e-03   +1.225792750168489e-01   +1.306815909950295e-01   +1.934797774285888e-01   +1.054823590371463e-01; +4.092610181929372e-02   -1.488113360048105e-02   +1.063679178389281e-01   +1.067780778241847e-01   +8.801757188705042e-02   +1.143828138657939e-01   +1.657152465418437e-01   +9.257838073846784e-02; +3.829235965495168e-02   +1.746870198481496e-01   +4.426224488477298e-02   +1.433524646627420e-01   +7.230389769794009e-02   +7.701680044440451e-02   +8.826546291155325e-02   +6.056920353303387e-02];
L1I_L2I_iGABA_netcon = [+1.897830680184300e-02   +1.011900729062866e-01   +3.455498593234364e-02   +1.516319220141083e-02   +1.921219805711029e-01   +4.047609359324854e-02   +7.119649441854782e-02   +1.140109322896050e-01   +9.431946607999234e-02   +5.514007831509614e-02   +4.310498540674992e-02   +1.498732191019507e-01   +5.231456974372731e-02   +2.449130914394594e-01   +3.193568427727776e-02   +1.005163733157781e-01; +1.599266903375428e-01   +1.595661188701700e-02   +5.822041804189797e-02   +1.814893650063997e-01   +6.957987096771565e-02   +1.527877202981468e-01   +1.839032018966980e-01   +7.901477732700246e-02   +1.727355191081536e-01   +1.661468605901118e-01   +7.460440885180683e-03   +3.344702080751272e-02   +1.548004800703214e-01   +7.093752844726350e-02   +4.116051042558887e-02   +1.013977040242446e-01; +1.398951248782107e-01   +1.573279267797310e-01   +1.462912590552491e-01   +4.086751006266206e-04   +1.197666475744966e-01   +5.609791460815666e-03   +6.160874902565699e-02   +7.211807491869945e-02   +8.067447453493931e-02   +2.284004881396651e-01   +1.728459200549546e-01   +1.036389185837521e-01   +1.497618765967193e-01   +6.981635012832735e-02   +5.632676757390832e-02   +8.605127836829495e-02; +1.347361918492806e-01   +6.416468242440652e-02   +1.726505085182271e-01   -1.917820130733255e-03   +1.185165212578703e-01   +9.154016110803542e-02   +8.242591661899340e-02   +9.176003237560504e-02   +1.556250053254977e-01   +1.744459283184398e-01   +1.762014094171159e-01   +1.171048753751153e-01   +1.902384969817688e-01   +1.294856857479916e-03   +3.094239714631189e-02   +2.097694201674797e-01; +7.040953688628182e-02   +1.269769258126357e-01   +1.632176675809883e-01   +1.085837638150559e-01   +1.697832627787178e-01   +2.504042682246312e-01   +9.274689367431978e-02   +1.057412126181803e-01   +7.318127138994721e-02   +1.086252447982735e-01   +1.058735616608897e-01   +1.379342656650538e-01   +1.894797479471530e-01   +1.586131798361355e-02   +1.602390928110924e-01   +1.919541608108432e-01; +3.323278501055491e-02   +1.200825794247190e-01   +4.712182421779176e-02   +1.286108068257021e-01   +2.059641913191413e-01   -4.251410166768261e-03   -4.195604172693860e-02   +1.355273685801960e-01   +9.592078841467117e-02   +1.971298215789220e-01   +1.502380578926942e-01   +7.922301658784556e-02   +9.939694232419688e-02   +9.262157110725282e-02   +1.370067472201765e-01   +1.998220412162885e-01; +1.567531610909894e-01   +4.747729576102786e-02   +2.198058642224240e-01   +1.682833738986758e-01   +5.276711164019002e-03   +1.597663048463301e-01   +1.205030876163904e-01   +1.677120606626799e-02   +2.902526846025821e-02   +2.123969450816051e-01   +1.614301795342103e-01   +1.737695598202429e-01   +9.293206444300067e-02   -1.298960079747117e-02   +8.600311494019093e-02   +1.342979608213791e-01; +7.882890412923083e-02   +6.436319317754724e-02   +1.318327545229170e-01   +6.504647120376575e-02   +3.056589293106233e-02   +1.561241812808375e-01   +1.272865817377792e-01   +2.351311095545187e-02   +1.858285691284876e-01   +9.745442037094254e-02   +1.605805032984476e-01   +2.031428767985509e-01   +1.279866946584864e-01   +1.176703041793011e-01   +1.144934616912691e-01   +2.877132218873873e-02];
L2E_L1E_iAMPA_netcon = [+1.056574854195177e-01   +1.793760334755432e-01   +2.408898868406020e-01   +7.028695572226767e-02   +2.061400931106985e-02   +8.345956600574017e-02   +6.174386937582656e-02   +9.173353501882769e-02; +8.112795763616816e-02   +9.020567953538856e-03   +1.642029054602981e-01   +1.101491824840242e-01   +1.075656500839357e-01   -8.814957737023035e-03   +9.592616924551092e-02   -2.494681565206731e-02; +5.215401393892819e-02   +6.159212390592408e-02   +6.027037230208398e-02   +1.430145894506880e-01   +1.450522019480077e-01   +2.362937007295206e-01   +1.957253760096992e-01   -1.015357233745346e-02; +1.337152578381920e-01   +9.233265380655793e-02   +2.404244234994370e-02   +8.816468908060954e-04   +4.357752746070227e-02   +2.175992518816226e-01   +1.111222486273142e-01   +1.940516352509638e-02; +1.297144496070224e-01   +1.881923978359079e-01   +1.574515025233651e-01   +1.062152836635908e-01   +6.743401622982219e-02   +8.849235280794192e-02   +5.008771720454750e-02   +2.721840964279575e-02; +2.080672410335624e-01   +1.826548026613778e-01   -2.952506022945732e-02   +1.721328905625205e-01   -4.187772032885818e-02   +1.503013756310938e-01   +7.727957539104260e-02   +1.033161963926756e-01; -2.563211660518289e-02   +1.566184958841985e-01   +6.388350591453762e-02   +4.364959161517936e-02   +7.072367145726431e-02   +1.790236770957012e-01   +1.000817023136817e-01   +2.153578730163965e-01; +1.216906737007406e-01   +2.198874095625210e-01   +1.509860449832914e-01   +1.696538195021202e-01   +1.471506879630572e-01   +1.090315922121814e-01   +1.423943413970981e-01   +1.183587031412882e-01; +6.157033045673117e-02   +2.823724548089783e-02   +7.072532921878749e-02   +9.326118630183612e-02   +2.450567084265311e-01   +1.496784756136539e-01   +3.056582573039968e-02   +1.316675004211977e-01; +2.637434123305598e-02   +2.206751047861544e-01   +1.483323105146415e-01   +1.781998293211454e-01   +2.127374460968919e-01   +7.503197754706811e-02   +1.321755211379486e-01   +2.481185390960245e-02; +1.554692453407192e-01   +1.668153898882363e-01   -3.772979786495842e-03   +3.782586888178680e-02   +9.282949860372218e-02   +1.818635945641160e-01   +1.293332592145578e-01   -4.240144799006237e-02; +2.525727032612168e-01   +8.632623324463948e-02   +2.877630511666817e-02   +1.343170368605586e-01   +1.662718559405963e-01   +2.646562878010040e-01   +1.090046023231046e-01   +1.608393225230494e-01; +9.849363563770243e-02   +1.872333672633155e-01   +2.663716208578822e-01   +3.952182734352461e-02   +1.170322009206824e-01   -6.321244265840607e-02   +1.459423181700841e-01   +1.831251801938996e-01; +1.297379962873591e-01   +5.675772398546391e-02   +1.275856176742024e-01   +8.008611315401473e-02   +2.026373637099679e-02   +1.481159244680079e-01   +1.248724022851147e-01   +1.165094378895608e-01; +1.336712168666875e-01   +1.790880403264477e-01   +1.049243004647701e-02   +2.425134253051930e-02   +1.480268679543560e-01   +1.500799958876324e-01   +1.024710949771740e-01   +1.697447917568992e-02; +1.377698757165613e-01   +6.775602573407118e-02   +1.262460858482114e-01   +2.674907791585281e-02   +8.482471429051390e-02   +1.562235795202968e-02   +1.614539147525614e-01   +1.513766591790856e-02];
L1E_L2E_iAMPA_netcon = [+9.741462563440585e-02   +7.543851221009881e-02   +1.702011189155743e-01   +1.002468394846123e-01   +1.745109647202643e-01   +5.212329926190078e-02   +1.291464925726548e-01   +1.963723359559676e-01   +9.560808361162014e-02   +1.106776992413618e-01   +1.811899542130783e-01   +2.712751639884577e-02   +8.622802674465491e-02   +1.113514472466665e-01   +1.594424118262246e-01   +2.094421223296014e-01; +1.600765565478436e-01   +2.197728437489349e-01   +1.345636353041957e-01   +3.848769583810503e-02   +8.679329136455652e-02   +1.118283194651441e-01   +1.446487096010618e-01   +4.300796095255079e-02   -2.088877387733685e-04   -2.045212241225905e-02   -2.913155672547881e-03   +6.228486724373994e-02   +3.546246093667860e-02   -3.928286768344742e-02   +2.161373379873078e-02   +9.845182661632575e-02; +4.536902485936508e-02   +1.588313810233450e-01   +2.184957416141331e-01   +1.729477023105727e-01   +3.019752006221591e-02   +1.604756174419290e-01   -1.772309156306097e-02   +1.737966616994885e-01   +1.031581920397357e-01   +1.105539933743848e-01   +3.947768748201114e-02   +1.378060778568417e-01   +9.876692590528929e-03   +2.961754225235121e-02   +7.634594386490881e-02   +1.303784562518674e-01; +1.245490426112016e-01   +9.949617556028940e-02   +3.480329800091597e-02   +2.179131361014062e-01   +2.480640265914138e-02   -2.486802372955030e-02   +5.728788731700782e-02   +1.647958442593793e-01   +2.191750387676595e-01   +1.991352724333511e-01   +1.093685966637256e-01   -8.679599446539947e-03   +8.765514364204879e-02   +4.104564229976853e-02   +4.801701484095304e-02   +1.604495265476109e-01; +1.701143207292126e-01   +6.064243297868972e-02   +3.059858245587034e-02   -1.227695379718109e-02   +1.693278339021695e-01   +1.690095010947961e-01   +2.277785418412962e-01   +1.118961489417646e-01   +8.153778156373416e-02   +8.327511403127622e-02   +2.148385834234889e-01   +2.936165801727252e-03   +1.219203980325024e-01   +1.623643932291908e-01   +8.183431507561542e-02   +4.636689829672576e-02; -1.109561198021726e-02   +5.525714218187147e-02   +6.376234520857578e-02   -2.065236503689677e-02   +1.382894328131378e-01   +4.186898230070359e-02   +1.437773062919940e-01   +1.829793195119016e-01   +2.132724555740262e-01   +1.651630749405103e-01   +1.563588767721183e-02   +8.280813726450009e-02   +1.945111596799953e-01   +1.086338130445276e-01   +3.894958620064450e-02   +1.294400923811106e-01; +7.438720465959205e-02   +9.520396728226169e-02   +4.678688012426770e-02   +5.785395415623270e-02   +8.208309412380511e-02   +1.906712552655396e-02   -1.008473863673088e-02   +2.922563866830304e-02   +7.288656038884796e-02   +1.401382320903111e-01   +6.433967662928027e-02   +4.971510493938339e-02   +2.337703096739941e-01   +1.632580750028289e-01   +2.279264983713493e-01   +1.273773514566749e-01; +3.999719493380377e-02   +1.614468507122705e-03   +1.650532051530482e-01   +2.293662055989935e-01   +1.343009387592733e-01   +9.757232512584783e-02   +1.798205990620723e-01   +3.755507117428887e-02   +8.352256301853356e-02   +1.891066670974641e-01   +2.185629186465304e-01   +2.555203239641833e-02   +1.518771040964310e-01   +5.369793956190634e-02   +1.773708364982234e-01   +1.190338492715960e-01];
L2I_L2E_iAMPA_netcon = [+7.146655720773540e-02   +6.912807113907338e-02   +6.241667367941979e-02   +7.318196730861634e-02   +1.839286314007791e-01   +8.599835653011266e-02   +5.103073814188516e-02   +7.605702349624605e-02; +5.369358482403800e-02   +4.739160508831368e-02   +1.893159306537423e-01   +8.456306979993347e-03   +1.271770925278551e-01   +8.543432177189095e-02   +1.751174637590699e-02   +9.340170432082950e-02; -9.586289533295853e-03   +1.661829929140800e-01   +5.138963019106257e-02   +1.015187494313019e-01   +2.040274373600476e-01   +2.081918936795240e-01   +1.312765936143465e-01   +8.710649787686285e-02; +1.620664704479764e-01   +2.114910947255582e-01   +1.904600186481525e-01   +9.429537575945621e-02   +1.307860574836958e-01   +1.094787358718101e-01   +3.210492011971089e-02   +1.468408219089501e-01; +1.900251696137637e-01   +1.774497663940779e-01   +7.456822418525363e-02   -3.017802386494215e-02   +6.707253818326937e-02   +1.537372466256447e-01   +3.954410072607764e-02   +2.045312121016603e-01; +6.396340269509210e-02   +8.525589924839980e-02   +2.156528012570235e-01   +9.574567757395945e-02   +3.135808450607588e-02   +1.541752906731298e-02   +1.946204915296747e-02   +1.270728163656114e-01; +6.581105883007835e-02   +7.760719891993711e-02   +2.071646290281992e-01   +7.148123742054407e-03   -8.243432078582949e-02   +6.567876442257412e-02   +4.731402192672639e-02   +2.459897409242296e-01; -3.018499991845336e-03   +9.089115326342861e-02   +1.492471054026570e-01   +2.488930520973909e-01   +2.101309348780561e-01   +1.539969194740554e-01   +2.307479878029756e-01   +7.386580013776674e-02];
L2E_L2I_iGABA_netcon = [+2.022750670286999e-01   +7.314871850704349e-02   +1.459340671889688e-01   +2.746672648194450e-02   +2.026818863181480e-02   +1.857715004426362e-01   +1.489981253132707e-01   +1.740712979662957e-01; +2.394511787923293e-01   +1.816577083859420e-02   +8.252416901707779e-02   +2.244683503389488e-01   +1.104964649145252e-01   +7.488293334241645e-03   +6.592027601096392e-03   +1.335779546441579e-01; +5.563079194250459e-02   +1.090509915982991e-01   +1.326597975454820e-01   +7.966320694370954e-02   +9.466084193443415e-02   +1.883210440066087e-01   -2.360032151892813e-02   +9.884861046863798e-02; +1.765731153876020e-01   +5.868904592771129e-02   +7.684464168030969e-02   +2.035297643049013e-02   +1.476828280340132e-01   +1.734216043234929e-01   +1.041757597818017e-01   +1.070353837817673e-01; +1.026213723493133e-01   +1.784351216886246e-01   +1.644713975889243e-01   +1.086814788287375e-02   +1.005146462154451e-02   +4.669566296479601e-02   +1.701915722691025e-01   +4.870243059091395e-02; +1.530788277756970e-01   +7.298166162837885e-02   +5.718852982767734e-02   +1.031264526943453e-01   +9.059117075003725e-02   +1.508277716181371e-01   +1.536433591230821e-01   -1.954143987328744e-02; +1.730455112933492e-01   +1.147501227755517e-01   +1.380199060296918e-01   -5.284664935787656e-02   +5.873457427367570e-02   -9.840064433216106e-03   +1.579885656047719e-01   +4.563835553170444e-02; +2.538834062059130e-02   +8.804294118827886e-02   +9.638411239380276e-02   +5.328313568042097e-02   +1.648083160791383e-01   +1.268583026880047e-01   +2.266180237802052e-02   +3.038723545327535e-02];
L3E_L2E_iAMPA_netcon = [+6.314559197540612e-02   +1.066241835855304e-01   +4.996162014515685e-02   +1.568255208897713e-03   +1.236443215793556e-01   +1.657697815955554e-02   +1.651742102131799e-01   +1.211098125600038e-01   +1.587130163925053e-01   +1.112026909515313e-01   +9.207317989709454e-02   +1.391539757727207e-01; +5.550931726636000e-02   +1.953080529647565e-01   +1.977731989775583e-01   -8.336205506130205e-03   +1.591245820506079e-01   +1.623945539001042e-01   +1.243340294101032e-01   +1.173657263520612e-02   +1.749695878245381e-01   -5.405370764547224e-03   +1.411453545815463e-01   +1.648274266366392e-01; +1.472329493871715e-01   +7.526326407021114e-02   +1.938071891440738e-01   +1.590671248888837e-01   +2.306501014306861e-02   +9.066969832403204e-02   +1.433180793958458e-01   -4.122816237941072e-02   +8.984688674814875e-02   +1.804673841349031e-01   +9.421423626658254e-02   +2.508680633384772e-02; +1.451940292456792e-01   +1.245630989689965e-01   +4.411692129363066e-02   +3.650648609527445e-02   +1.815065653674420e-01   +7.715640193681300e-02   +2.634744634302490e-02   +8.662198147443965e-02   +3.399852194431673e-02   +1.155732990617527e-01   +1.448879176416465e-01   +5.146584168445815e-03; +1.322874125091182e-01   +2.384630589243583e-01   +2.083703355954220e-01   +2.207710940119873e-01   +1.906225145766944e-01   +2.126867229015469e-01   +1.009528953007496e-01   +5.731172955810404e-02   -1.561735280027641e-02   +6.612108375436780e-02   +1.408917835439994e-01   +1.000944235394508e-01; +8.848258630922977e-02   +1.119866206773244e-01   +2.296993637974342e-02   +5.829890151687805e-02   +1.169025474738388e-01   +1.017948170964882e-01   +2.613433249926058e-01   +2.156356994246826e-01   +2.163820546943663e-01   +7.489806799825206e-02   +2.148015264959885e-01   -1.079253047202645e-02; +1.963944768868195e-01   +7.753603516511698e-02   +4.511562404436591e-02   +6.824840403633617e-02   +4.053352388636514e-02   +6.269147673807487e-02   +9.776298873018256e-02   +4.076765421679374e-02   +6.359066619722312e-02   +5.741977580912819e-02   +1.907066638033602e-01   +1.631471224731547e-01; +2.032949005172805e-01   +1.491758316044416e-01   +1.050678613191229e-01   +1.752622226241135e-01   +1.687174016789372e-01   +8.497446571903794e-02   -2.444553486237671e-02   +8.205768903148317e-02   +3.570119895377394e-02   +1.019779732612240e-02   +8.783605517553965e-02   +8.766958401331422e-02];
L3I_L2I_iGABA_netcon = [+9.920808863611337e-02   +2.216864126347461e-01   +1.070055684195517e-02   +1.507825482635897e-01   +8.693942179319231e-02   +1.619770448837094e-01   +1.419297235689044e-01   +2.271967777992804e-02   +2.741709059618473e-02   +5.558499404638684e-02   +1.272212172642630e-01   +1.665913153918027e-02; +1.198356146060472e-01   +1.193542938291517e-01   +8.141496305540451e-02   +1.191094953126533e-01   +1.611920525643865e-01   +5.090714099617896e-02   +2.104110758415371e-01   +6.384007184830681e-02   +3.082226526330837e-02   +8.169825450488424e-02   +1.026932655844786e-01   +4.094976730368874e-02; +1.078665389392422e-01   +1.639482352106241e-01   +1.679866409352659e-01   +1.065665608827562e-01   +1.435848907092496e-01   +8.619683245127141e-02   +6.098041632488464e-02   +1.344342117324284e-01   +1.047536168933460e-01   -7.929954544443549e-03   +1.917850999245715e-01   +1.283566662999415e-01; +1.635018722604113e-01   +2.272458527538847e-01   +1.525339783970288e-01   +7.179813659360540e-02   +9.111441873231518e-02   +1.692484532997981e-01   +3.563357308256478e-02   +6.490516034115650e-04   +1.720684658247983e-01   +1.823424489121145e-01   +5.682986137363540e-02   +1.626253121356215e-01; +3.869032482298146e-02   +1.926996598707168e-01   +2.120374430471870e-01   +1.386523540171594e-01   +2.196267454712096e-01   +9.567968419949326e-02   +6.203622499577645e-02   +1.460720616533236e-01   +6.066113983908566e-02   +1.623944849182423e-02   +1.660548160634433e-02   +6.972683800907327e-02; +1.005361475752597e-01   +6.111195091271147e-02   +1.439209883289097e-01   +1.105688781674375e-01   +1.600426812613198e-01   +1.764835856274153e-01   +9.282314979466184e-02   +1.032013526252969e-01   +5.126634917452378e-02   +4.577936883041746e-02   +1.138975614415496e-01   +9.764949401054755e-02; +1.142488875366841e-01   +3.954136332955408e-02   +2.267143110520057e-01   +2.020079861888900e-01   +9.023236541353422e-02   +2.270223290364053e-01   +7.266559811191016e-02   +4.779041742017376e-02   +4.913997591744987e-03   +1.279889670470605e-01   +2.056679503233948e-01   +7.689469584849412e-02; +9.616519956703276e-02   +4.473398284143175e-02   +1.508434247656567e-01   +2.921290828785658e-02   +1.739792587341352e-01   +1.767304851173203e-01   +1.844680772585751e-01   +1.644778531053468e-01   +4.637333752105339e-02   +1.602102564188632e-01   +6.252732159332065e-03   +1.579276224647627e-01];
L2E_L3E_iAMPA_netcon = [+1.948157578059604e-01   +1.049192418231955e-01   +1.337965455054392e-01   +1.011089589595345e-01   +1.115894045809241e-01   +1.395255679128788e-01   +6.882360870446644e-02   +1.973635007759271e-02; +1.460772035275542e-01   +1.160891479119588e-01   +1.137838087771225e-01   +1.295960991493144e-01   +2.140734070949497e-01   +6.621656774236399e-02   +9.514657490432189e-02   +1.996358181807123e-01; +3.274192540979844e-02   +7.037048955695602e-02   +1.487049128988225e-01   +1.449185122856908e-01   +1.187546801826436e-01   +1.900743343335250e-01   +1.531125791559619e-01   -2.295224334705002e-04; +1.080912924059591e-01   +5.363319633411673e-02   +1.244283408663786e-01   +1.318479708028695e-01   +7.339258830382982e-02   +2.079312458570405e-01   +1.090982171362250e-01   +7.960453199736726e-02; +9.004774912355008e-02   +1.375458703120618e-01   +2.033789942488324e-01   +3.667434351882720e-02   +1.554591114976317e-01   +1.211478245758687e-01   +1.289938774509199e-01   +1.524911513660422e-02; +2.235904155512025e-02   +2.129809731498491e-01   +1.676094557991898e-01   +6.833667418897911e-02   +2.555759812103550e-01   +7.317261742897145e-02   +9.401844004081364e-02   +1.140547445373237e-01; +1.340649149131936e-01   +2.589342330069611e-02   +8.645922703225334e-02   +4.128539573898910e-02   +1.229935578602786e-01   +1.230688300783928e-01   +1.473888105977923e-01   +1.072350756176814e-01; +9.272014032159526e-02   +1.440872118249953e-02   +1.740084214724120e-02   -1.762150846078840e-02   +1.485451626920497e-01   +5.879076220451857e-02   +5.378686127497399e-02   +1.600834875299027e-01; +2.121380725527258e-01   +2.038363755873180e-01   +3.791795768976435e-02   +1.246384378966312e-01   -3.533294187180860e-02   +9.984710159039559e-02   +1.936197139353562e-01   +1.190307594105652e-01; +5.272101700661541e-02   +3.965560283266726e-02   +1.948946217597416e-01   +1.644170965718733e-02   +6.877368213691486e-02   +5.914895085035578e-02   +2.312227045252201e-01   +1.435898112970763e-01; +1.336531846391920e-01   +7.262048793986764e-02   +7.722776653835102e-02   +1.381523977410136e-01   +6.494218859157611e-02   -2.279769354139779e-03   +2.224020695295238e-02   +1.971085266890043e-01; +1.376964692970732e-01   +3.481017948668316e-02   +2.288232552817833e-01   +1.175405046859667e-01   +1.203847347396300e-01   +3.767708656915656e-02   +1.254623444465385e-01   +6.827603387030673e-02];
L2I_L3I_iGABA_netcon = [+1.109057767336091e-01   +7.757307518111221e-02   +4.919470291430081e-02   +1.304932563112478e-01   +1.244779689527496e-01   +9.382064872412074e-02   +3.954720356394372e-02   +9.057606649349821e-02; +9.547110564015267e-02   +1.672752447371172e-01   +6.298306796228158e-02   +2.130590522770326e-01   +8.933201571322673e-03   +1.336578124764668e-01   +3.954892610134036e-02   +9.469395046944712e-02; +1.394993978398189e-03   +1.636982681887236e-01   +1.623810621193519e-01   +1.794432788511038e-01   +9.602557879092480e-02   +1.046724223490176e-01   +1.814323517280407e-01   +1.988869978250039e-01; +1.839863832930972e-01   -1.872347110641303e-02   +1.542546108923373e-01   +9.989558595199624e-02   +1.216417394267556e-01   +1.638615659061977e-01   +1.908636499834403e-01   -2.855362435383494e-03; +7.236014531459838e-02   +2.476139360630714e-01   +1.418478032520943e-01   +1.384005555154759e-01   +5.035735160296720e-02   +1.366268278751928e-01   +1.696499751624161e-01   -1.709342274553552e-02; +1.155837938771899e-01   +1.207726013256533e-01   +5.722107550225030e-03   +2.307123079191058e-01   +3.605223475110365e-02   +3.714973206616948e-02   +9.883860572437174e-02   +1.154845132087926e-01; +6.234774279513104e-03   +1.780457228099206e-01   +5.320541933076510e-02   +2.330375649080426e-01   +2.205268557095674e-02   -4.228633350765944e-02   +1.522934762064176e-01   +1.370297711199296e-01; +1.118305210283177e-02   +6.911730704058314e-02   +1.021391136462430e-01   +8.788006942725451e-02   +1.779108434667291e-01   +1.294738792647360e-01   -3.169990205139911e-03   +3.177539091212177e-02; +7.284595745151190e-02   -5.572683642688940e-02   +2.274507086932410e-01   +2.717394105427099e-01   +1.360210808838504e-01   +1.472177404169409e-02   +5.589702811425923e-02   +1.781475116378159e-01; +3.065950103760229e-02   +2.005646067710894e-02   +3.896222798232987e-02   +1.241043424313630e-01   +1.695239160246357e-01   +4.412397395536111e-02   +1.785058984023391e-01   +1.030823506393452e-01; +1.342106637535998e-02   +1.501358020198729e-01   +1.782331937329900e-03   +7.939953778009663e-02   +1.649529411827243e-03   +1.550560433957764e-01   -8.828236819832146e-03   +5.504305860108060e-02; -4.353101624120108e-02   +6.222968542559212e-02   +3.949962707856615e-02   +3.790305243448343e-02   +1.439679776779417e-01   +1.771432251953924e-01   +7.584248514629172e-02   +6.584010601340885e-02];
L3I_L3E_iAMPA_netcon = [+8.633932179272007e-02   +1.074477553311632e-01   +9.397559308738505e-02   +1.697964062845017e-01   +3.384301121853655e-02   +1.865907182169665e-01   +7.956291204941113e-02   +2.363151793850730e-02   -2.070571469170199e-02   +6.547096654877816e-03   +1.539701147592374e-01   +7.239694809528233e-02; +1.895845325638769e-01   +6.474018227676796e-02   +7.293176788004958e-02   +2.108574201110258e-01   +1.485479311571792e-01   +1.450563239887405e-01   +1.742475824466610e-01   +2.253319230295209e-01   +1.103280084543553e-01   +7.779123269349547e-02   +1.232129383796461e-01   +2.013286674810973e-01; +7.304832955079620e-02   +1.589288473848088e-01   +4.390006800145015e-02   +6.113585436071113e-02   +1.851449793129994e-01   +1.712773728384346e-01   +1.329889379882402e-01   +1.113189635356374e-01   +2.422522066984344e-02   +1.786942314661626e-01   +4.137067886708954e-02   +1.785709438865871e-01; +2.013915279299413e-01   +5.472192023383300e-02   +8.856721971493309e-02   +1.581770290227804e-01   +8.307277344990519e-02   +4.694275705274661e-02   +1.194372608425620e-01   +1.930111814022853e-01   +1.122593687466790e-01   +1.779500988535559e-01   +7.283933813228219e-02   +1.154015364495997e-01; +5.861727649845078e-02   +2.023709404984557e-01   +6.753295051253416e-02   +2.548471422428956e-02   +5.529277126150705e-02   +4.180377325717723e-02   -2.843020861614787e-03   +9.258613724049079e-02   +9.569550505867939e-02   +6.804744246603744e-02   +1.810869432412118e-01   +1.575627952891484e-01; +1.038206697831913e-01   +1.645289450631341e-01   +9.614183345086171e-02   +2.137936398641002e-01   +2.819008955490873e-02   +1.502503803304219e-02   +5.806745911683759e-02   +4.826348664833359e-02   +5.318994716612758e-02   +1.865004547568572e-01   +1.574119142242767e-01   +8.124351757008913e-02; +1.220026352935671e-01   +7.873222171090632e-02   +1.147449697160595e-01   +1.689533942751854e-01   +1.415488701410136e-01   +6.922326551696238e-02   +7.361826778962723e-02   +2.348874253925045e-01   +1.605961236296985e-01   -2.871909941532056e-03   -6.457305183647531e-02   -2.110362378595173e-02; +2.316612701333501e-01   +1.488714982825617e-01   +1.021420080620023e-01   +1.222026562168225e-01   +4.397631296138525e-02   +2.502007738272673e-02   +9.533081730569361e-02   +2.139155182973140e-01   +1.047922535261575e-01   +1.494666765048780e-01   -7.637370378714212e-03   +4.128360616309547e-02; +3.340762292375115e-02   +5.109616452612481e-02   +7.975939037262225e-02   +1.598401350042294e-02   +4.895115633981161e-02   +7.448360991266357e-03   +1.424316767281464e-01   +5.531941147932085e-02   +8.966698825154515e-02   +1.922947491623106e-01   +1.090587345494554e-01   +2.004439967722349e-01; +1.836707824936264e-01   +3.493433164354049e-02   +1.670481767855123e-01   +7.841356920830117e-02   +4.176915809841977e-02   +9.309318122560581e-02   +1.071133063210458e-01   +2.385156191390793e-01   +1.416744813966164e-01   +1.062516463127548e-01   +4.803689938355116e-02   +1.782205404948653e-02; +1.938850642883181e-01   +1.195098092396202e-01   +2.124132154788179e-02   +5.522608198601116e-02   +3.643946177835675e-03   +1.482959569490120e-01   +1.237018553628904e-01   +1.570626782502066e-01   +1.684829490852099e-02   +5.146083294534092e-02   +1.022540312484498e-01   +1.938283626711877e-01; +1.015815045191155e-01   +3.660661339861058e-02   +2.728200659759476e-02   +2.107628524771671e-01   -2.076472386152415e-02   +5.682718276302075e-02   +1.503042950787231e-01   +1.075080344438382e-01   +3.805806479895159e-02   +8.521707307421824e-03   +8.930388176381227e-02   +2.237265313587758e-01];
L3E_L3I_iGABA_netcon = [-1.487920320241065e-02   +1.668346300371735e-01   +7.020524983055139e-02   +1.764242657906664e-01   +2.024893623981885e-01   +1.367769038907479e-01   -1.025694735878990e-02   +9.744264074702233e-02   +1.634799202711415e-01   +1.887277774556667e-01   +1.860299597651976e-01   +7.812506536001709e-02; +1.682289423914623e-02   -2.016693225613213e-02   +2.298433902730500e-01   +1.080471576562787e-01   +8.220847832415956e-02   +1.539948435394613e-01   +2.028813957281258e-01   +8.217092088169961e-02   -6.261501118104591e-04   +2.384115998934676e-01   +1.047600445490147e-01   +9.024422160841951e-02; +1.266500899420521e-01   +1.520320904615484e-01   +1.792607069925172e-01   +1.900788817467864e-01   +5.871107669053923e-02   +1.701488158617366e-01   +1.144347821904512e-01   +6.272656672397722e-02   +5.108244685412757e-02   +1.459325079075597e-01   +4.836906066482922e-03   +7.409703726602322e-03; +1.373945248361751e-01   +1.368187184568954e-01   -5.520661424369876e-03   -2.136649100257664e-02   +8.572941779810793e-02   +1.853067515151323e-01   +9.612507808945468e-02   +1.883331918695993e-01   -2.220845583030362e-02   +1.308014898479359e-02   +1.625852091823554e-01   +4.647757491934509e-03; +1.438441069906256e-01   +1.503965112431372e-01   +2.522913820011247e-01   +6.497547537352952e-02   +1.813196693242927e-01   -8.058610658161873e-03   +1.187005761735426e-01   +6.810838292019021e-02   +3.565781791959402e-02   +2.077504685993015e-01   +6.319179305801292e-02   +9.554361187969240e-02; +8.445396055482852e-02   +7.782927201493354e-03   +4.305930547817834e-02   +2.579232588153629e-02   +2.291525343566991e-02   +1.763272030835321e-01   +6.897688734332894e-02   +1.005057873561030e-01   +1.541047487282272e-01   +2.071558834947455e-01   +1.760751512499319e-01   +2.752088496130008e-02; +1.834673719145313e-01   +1.450468987299852e-01   +1.073195859144747e-01   +2.147310996164980e-02   +1.331186741835185e-01   +2.016378799348682e-01   +1.658430329112563e-01   +1.982350360157419e-01   +1.272236213829067e-01   +1.845108975975051e-01   +1.575174089480544e-01   +3.562406782078737e-02; +8.042132794092346e-02   +1.070917074361138e-01   +1.324355506331562e-01   +2.203508149234877e-01   +1.454966768820068e-01   +2.233150492296540e-02   +9.890763466913856e-02   +8.668952759684105e-02   +8.142719925092512e-02   +5.862917166336336e-02   +1.148341158099908e-01   +1.661482649914335e-01; +2.100470250089334e-01   +8.597056948444926e-02   +1.718492622259171e-01   +9.974615674136993e-02   +1.919210106000947e-01   +4.940235306119686e-02   +1.099223832602522e-01   +1.288917666560806e-01   +1.241158017131339e-01   +2.011826069424832e-01   +1.439513615905889e-01   +1.418688843920691e-01; +1.500666855592039e-01   +9.806635584378090e-02   +1.046091582442742e-01   -2.428040036463385e-02   -1.829569868470266e-02   +1.113410777534642e-01   +7.986421201425346e-02   +2.803890606484493e-02   +9.832573959960020e-02   +1.158617218491141e-01   +7.601551191642557e-02   +5.008427473831480e-02; +7.976110933430150e-02   +1.839369023066951e-01   +9.161382064652608e-02   +2.261791972918529e-01   +4.575207495403162e-02   +2.387444193155694e-02   +1.642087541935787e-02   +5.770270389470351e-02   -1.650079626908278e-02   -5.485222245889336e-02   +2.154590174776183e-01   +1.726582771736563e-01; +1.057054803536202e-01   +1.175914611938071e-01   +2.443808888879350e-02   +9.335345093348565e-02   +1.052961360000872e-01   +5.406744388481013e-02   +1.375291717175477e-01   +1.120314204887074e-01   +6.833146539031149e-02   +1.397934866502271e-02   -1.418074905191147e-02   +5.567523965981416e-02];
L2E_Input1_iAMPA_netcon = [+1.289616365329042e-01   +5.921551794272491e-02   +1.211452850323575e-01   +7.349497881621359e-02   +1.367126613000319e-01   +1.002009902950022e-01   +6.086135886408326e-02   +1.469810082828973e-01];
L2I_Input2_iAMPA_netcon = [+1.247367532051880e-01   +5.506018171398394e-02   +1.977459238873170e-01   +1.765784127869476e-01   +1.020598392550921e-01   +9.189611822536374e-02   +1.517940892362504e-01   +1.946099288741891e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.04*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.5*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.1*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.5*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.1*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.5*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.04*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.5*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.1*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.5*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.1*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.5*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
