function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+3.686331517395919e-01   +7.211471779443799e-01   +8.311395518834198e-01   +2.553016750931085e-01   +3.061919360689095e-01   +6.426867593370035e-01   -7.818244871981049e-02   +3.837590193345820e-01   +2.954845405275586e-01   +1.452404115124645e-01   +4.046397135155310e-01   +1.609352826004127e-01   +4.450091108943456e-01   +2.504867270190287e-01   +2.368372953263296e-01   +3.062725999905689e-02; +7.526277309620322e-02   +8.500207005511453e-01   +7.986408572394053e-01   +6.966075641086792e-01   +2.872783036940667e-01   +6.492349610844971e-01   +6.219004535739896e-01   +1.910755205677498e-01   +1.465854021903969e-01   +7.387293107978480e-01   +5.343848408746635e-01   +5.981063413294236e-01   +3.880813490648742e-01   +2.781402065557796e-01   +5.590737500808929e-01   +3.036035306561012e-01; +2.275556997747303e-01   +2.519401841237655e-01   +4.328477523892624e-01   +4.301543262275226e-01   +6.230322592360473e-01   +4.297977915736490e-01   -4.822511623357862e-02   +5.865107207620485e-01   +3.418953338473139e-01   +4.693189953501488e-01   +7.826904240540489e-01   +2.710896260625815e-01   +3.710985897289613e-01   -1.061036228651432e-01   +3.118683874913567e-01   +8.599383074740169e-01; +2.094412781631257e-01   +6.116961344841340e-01   +1.341644784608470e-01   +2.384348368225053e-01   +7.948917809553075e-01   +7.584181090848244e-01   +1.868955080366865e-01   +5.560464428977695e-01   +6.512099420316958e-01   +2.180381815634392e-02   +1.798168244360800e-01   +7.509621717084193e-01   +4.985419914724543e-01   +2.107437572983746e-01   +5.525104442869658e-01   +4.356756587646516e-01; +4.638433008836641e-02   +6.109904839346970e-01   +7.650752031517417e-01   +7.301211552234546e-01   +4.628246880586916e-01   +3.372917774878685e-01   +4.148553334039922e-01   +3.235713567176182e-01   +3.055807916404724e-01   +4.615560881153207e-01   +1.949113651360195e-01   +6.025787201552802e-01   +3.223653562045055e-01   +7.231542463025946e-01   +1.965766319922237e-01   +8.392616205684723e-01; +1.287467300813662e-01   +1.492467755784397e-01   +7.420625402091110e-01   +7.636893888119747e-01   +5.823653544728501e-01   +7.832035371909648e-01   +2.849435580731725e-01   +3.726108694212505e-01   +8.266119055597149e-01   +8.672876910098437e-01   +8.142924675362425e-01   +7.551960974589919e-02   +4.079104414389270e-01   +1.148994505273993e-01   +8.259125376253622e-01   +3.640538313834354e-01; +3.271047721771941e-01   +6.574888930881224e-01   +4.294418528416596e-02   +3.333822180893530e-01   +7.097815852710245e-01   +4.813625110859522e-01   +3.846700957793455e-01   +5.160756162202234e-01   +8.980287292614584e-01   +8.445514716992845e-01   +5.966585144266954e-01   +1.366689687951832e-01   +3.695412502847560e-01   +4.123204839600976e-01   +6.474658019053198e-01   +7.919686138724941e-01; +6.027577598050499e-01   +6.359388393663848e-01   +7.485767089280564e-01   +3.811350213188001e-01   +5.216473052313739e-01   +5.217986776566443e-01   +7.679330411026949e-02   +4.349190872223649e-01   +1.000000000000000e+00   +7.766836999997836e-01   +2.255318542397383e-04   +7.161844323573443e-01   +6.921728796615364e-01   +5.621298406925137e-01   +2.566667450665994e-01   +7.919868285801056e-01; +4.368040299920274e-01   +5.882787420753206e-02   +1.856194924527953e-01   +2.918067488282080e-02   +3.549179865484111e-01   +1.281916647553261e-01   +1.527960693481176e-03   +5.194638940949073e-01   +4.954977802939173e-01   +7.053274766103798e-01   +6.961473008633449e-01   +4.625296558809113e-01   +2.545527852304653e-01   +1.625423980186919e-01   +8.810394903796880e-01   +7.418734950161934e-01; +6.285827389407506e-01   +5.142794977243298e-01   +4.914536459949290e-01   +2.043395549554806e-01   +4.680782489296164e-01   +2.282927086086503e-01   -6.569727052263622e-04   +2.242145786745736e-01   +4.223990718338188e-02   +7.430070546920834e-01   -3.219303570665507e-03   +1.391132690631500e-01   +3.269522409565126e-01   +6.968179289032467e-01   +3.182286875907915e-01   +6.483182285915384e-01; +3.071450761714166e-01   +5.863433284101802e-02   +1.519732201979214e-02   +2.126788966891432e-01   +7.890176522996887e-01   +5.632545287728410e-01   +1.731055206145379e-01   +1.852400428990527e-01   +1.548575916712379e-01   +8.296266176214350e-01   +9.368172335106562e-02   +7.336565947047495e-01   +4.866820125644300e-01   +7.506886276613556e-01   -6.021692870864647e-03   +6.472873065913841e-02; +1.664979506552001e-01   +7.664003356580441e-02   +8.364173321121262e-01   +4.792793522499100e-01   +6.031914479420056e-01   +4.873548136527926e-01   +6.556371552842318e-01   +2.791573377386320e-01   +6.205821230876679e-01   +1.203078405465509e-01   +2.144927888638079e-01   +7.194282173367142e-01   +3.962661585670496e-02   +4.722933660507323e-01   +3.520312139808101e-01   +6.941091669162029e-02; +3.341756867157094e-01   +3.013269384872020e-01   +5.718561250925173e-01   +2.081074513285825e-01   +1.220249204049986e-01   +4.210517885864150e-01   +3.934219846341047e-01   +6.229890568911671e-01   +2.828938245138942e-01   +8.470478730264985e-01   +1.934321634072535e-01   +3.853042173843183e-01   +1.990962645778921e-01   +2.113245986598150e-01   +2.352848562677830e-01   +1.747367409731742e-01; +1.056259277067019e-01   +8.405546128933390e-01   +6.468152747135019e-01   +6.349616911111355e-01   +7.456915363322315e-01   +5.517154780435991e-01   +2.387779179719018e-01   +7.305499476389533e-01   +3.768299506129388e-01   +4.324841665127994e-01   +7.241716614534613e-01   +5.549516456936007e-01   +5.401846044363646e-01   +4.260651954729108e-01   +8.440999646999360e-02   +3.552134511300388e-01; +1.444386453769864e-01   +2.019877520091945e-01   +6.741903674117521e-02   +3.949179239504477e-01   +2.906790093540000e-01   +1.979417198697964e-02   +6.034023562329172e-01   +2.462065869232284e-01   +7.264396211115908e-01   +4.362208573103470e-01   +8.932988663212775e-02   +6.759717232687388e-01   +5.451178101721624e-01   +1.451820265646594e-01   +6.354405831271729e-01   +1.387960339975629e-01; +4.825480076896820e-01   +1.895967734062049e-01   +2.993715277635070e-01   +5.862254529075172e-01   +4.714179669190396e-01   +5.649506364724358e-01   +2.534910162574682e-01   +1.278235842894252e-01   +5.730837944433644e-01   +3.752521888091730e-01   -1.226726675536787e-02   +3.239538784503052e-01   +1.882398799576077e-01   +8.601352458171042e-01   +8.583587550779764e-01   -4.795354466724543e-02];
L1E_L1I_iGABA_netcon = [+1.303191952138295e-02   +2.531123175438831e-01   +8.735859268988132e-01   +1.802802538707948e-01   +4.281417764163565e-01   +1.243826959853977e-01   +2.617081034777795e-01   +3.017616222453387e-02   +1.869646452199992e-01   +1.278529532449490e-01   +4.215272004255439e-01   +9.061081224037757e-01   +1.570754340921410e-01   +7.023049674349561e-01   +9.508410902262607e-02   +3.743450506519247e-01; +7.440353730590936e-01   +7.217010567512538e-01   +5.346005111867183e-01   +8.045855573312354e-01   +6.220499107606998e-01   +7.649942679004107e-01   +5.754284161323593e-01   +7.307331953291825e-01   +8.264335536244521e-01   +8.794493017815327e-01   +1.514564821031507e-01   +9.483521430250123e-02   +5.319822146223675e-01   +8.353030219495219e-01   +9.636980395134964e-01   +1.771404815330659e-01; +2.230880495259678e-01   +8.257324520218471e-01   +1.063560150235478e-01   +5.082692665804647e-02   +1.040950344802285e-01   +2.108540619857908e-01   +5.539550783969204e-01   +7.805549226565199e-02   +7.080462500323206e-02   +1.296249779375959e-01   +5.054046145529307e-01   +4.151955584242784e-01   +7.662192438710931e-01   +7.382794347338653e-01   +7.813378553743126e-01   +7.246399039336837e-01; +3.252751605420492e-01   +5.613494403772317e-01   +5.873505390306534e-01   +7.403003663006655e-01   +6.512046593989520e-01   +5.937656900195416e-01   +6.228811533764923e-01   +8.131631371827169e-01   +1.027918964662469e-01   +2.540041345209452e-01   +4.604453297636954e-01   +3.213143183544393e-01   +7.574006265214930e-01   +4.498992634551195e-01   +8.600204244034071e-01   +4.840356048013097e-01; +7.171261730029371e-01   +5.816631078866782e-01   +8.631932260223608e-01   +3.960408418343966e-01   +8.608871162961519e-01   +4.964190304868693e-01   +3.190438030455979e-01   +4.422530332998424e-01   +2.474949774933851e-01   +4.137525248686078e-02   +4.566781241438004e-02   +5.876837547420755e-01   +8.493171969605396e-01   +8.031465475319745e-01   +3.931315984524027e-02   +1.293635828270887e-01; +1.798238269263523e-01   +2.143055207375777e-02   +3.276656697308483e-01   +1.994927214915224e-01   +8.815860733709781e-02   +4.385727810629293e-01   +8.042111362390187e-01   +3.082588536914809e-01   +5.460980240557511e-01   +4.526472509067523e-01   +8.908689861239852e-01   +1.137825649627062e-01   +2.005637425844610e-01   +1.897147736498027e-01   +6.718342262782450e-01   +3.169552279768280e-01; +6.681747010880275e-01   +5.011476275431926e-01   +2.949852948520846e-01   +7.045713277450629e-01   +2.881994795425010e-01   +7.974811318530145e-01   +5.900158413410884e-01   +5.515788178308410e-01   +7.810157482313469e-01   +5.873393390465871e-01   +7.655958675512529e-01   +2.327396261818655e-01   +7.477314989291326e-01   +5.275308589811875e-01   +9.057559711276970e-01   +7.801986109940010e-01; +9.224258027597183e-01   +1.044159680282092e-01   +5.795636703964221e-01   +4.441698776979637e-01   +6.284427759505251e-01   +2.147377500526988e-01   +2.924158689024347e-01   +5.339250186249404e-01   +1.669855844530018e-01   +8.293834947271737e-01   +6.788495614400115e-01   +7.593542325499779e-01   +2.414336947248902e-01   +6.427929470555982e-01   +4.652302580074261e-01   +5.737121138555346e-01; +5.400126364509230e-01   +1.000000000000000e+00   +4.020609753345885e-01   +9.075457063448600e-01   +1.787183229989695e-01   +6.352387692365015e-01   +5.366851553564137e-01   +8.645168855632402e-01   +8.592219532955786e-01   +6.331316369403350e-02   +1.825074556963427e-01   +2.073767455215733e-01   +8.839869444255333e-01   +3.488984262245234e-02   +9.401878311131127e-02   +4.442155108648942e-01; +2.243598234816076e-01   +3.662208146577000e-01   +5.430250229955569e-01   +2.029837936850134e-01   +8.694543796203165e-01   +3.639700145027600e-01   +3.050622068681086e-01   +9.092770569269999e-01   +8.659330239943417e-01   +8.704449800739286e-01   +8.188867026351917e-01   +9.424782174386219e-01   +4.612269153097620e-01   +3.682458267505406e-01   +3.096509897648628e-01   +7.474493776438214e-01; +1.681489157229177e-01   +1.957794154936050e-01   +7.004758275122882e-01   +7.734147263188248e-01   +2.412652223472788e-01   +6.013234869863414e-01   +6.385722318272948e-02   +4.235704852673954e-01   +3.948376516926225e-01   +5.859292742041020e-01   +3.386663858299235e-01   +8.435660369814356e-01   +9.049788394928782e-02   +4.394029994305633e-01   +4.340322356530082e-01   +3.700420450367624e-01; +1.788372325917966e-01   +9.303514442946903e-01   +7.027116607611334e-01   +5.304447909146249e-01   +4.341608697337412e-01   +9.226911104927789e-02   +1.404172515054929e-01   +3.787857245382684e-01   +1.515575426843952e-01   +4.798158655961962e-01   +1.925185896182423e-01   +3.819946159584586e-01   +3.601719369533753e-01   +8.564001546413337e-01   +6.181788324845274e-02   +4.674312595385759e-01; +8.963569047415390e-01   +1.730901854381629e-01   +4.850866854616446e-01   +4.866781994430287e-01   +5.493869770369679e-01   +5.683362538377214e-01   +1.483815152816228e-01   +4.529354023034437e-01   +4.205507844102220e-01   +3.414419274434987e-01   +8.802766305162039e-01   +8.849641465749035e-01   +7.686070017880196e-01   +5.578623578633490e-01   +2.541299696710383e-01   +6.755281469200970e-01; +4.448140232325855e-01   +8.252691454396995e-01   +3.362969899401358e-01   +3.474594219930565e-01   +7.004909199527755e-01   +2.095683907339096e-01   +2.522391013713832e-01   +5.546240440048430e-01   +3.215639163218064e-01   +4.494295288267725e-01   +1.847677644031152e-01   +1.387120346154699e-01   +2.662258411855224e-01   +2.641271830031854e-01   +5.112484173799389e-01   +8.522298260312974e-01; +5.301082788096649e-01   +6.075118852344567e-01   +6.553623945176936e-01   +5.799149629689027e-01   +6.589093486789047e-01   +1.445312348861527e-01   +8.510423302855854e-01   +2.349187327915289e-01   +8.003706489868267e-01   +5.063357535202437e-01   +6.903329780116659e-01   +4.759696517818426e-01   +2.769430659078738e-01   +4.507545324801712e-01   +7.869651134949324e-01   +4.264974467230346e-01; +3.313598510521483e-01   +5.616663397273308e-01   +5.643415491663398e-01   +2.590404736121072e-01   +3.997351728464874e-01   +2.638450058228847e-01   +4.944956547946236e-01   +2.339950183956638e-01   +8.321388543521210e-01   +2.683059523210503e-01   +2.736876896877636e-01   +1.702058029173686e-01   +3.383451604827570e-02   +4.073411711457309e-01   +9.816310740540674e-01   +9.297047933877129e-01];
L2I_L1I_iGABA_netcon = [+6.131501142779751e-01   +4.161140502451139e-01   +6.559885054605415e-01   +5.598600413003446e-01   +8.852353066084486e-01   +5.829561952367749e-01   +8.582384216642462e-01   +8.297294901579155e-02; +4.177734720162269e-01   +1.782016435334646e-01   +2.589781653647075e-01   +9.302971010188020e-01   +2.410994451014586e-01   +3.692902190788649e-02   +7.857351606316371e-01   +6.114881015412545e-01; +1.000000000000000e+00   +5.183446985867431e-01   +5.682782586142430e-01   +7.116076186051393e-01   +6.907116316610881e-01   +6.308116937040780e-01   +2.727776162064395e-01   +2.898993904998332e-01; +3.567673827959504e-01   +1.894545139322626e-01   +8.342193040663258e-01   +4.208510574159528e-01   +7.268215700417844e-01   +3.536034478714142e-01   +9.450969266141064e-01   +1.765630832350082e-01; +6.845353727604446e-01   +4.789612283393477e-01   +6.144938388749283e-01   +1.962139790873399e-01   +9.410068460601593e-01   +3.100899363701544e-01   +5.154267244094827e-01   +1.904824247567648e-01; +5.670119683087080e-01   +5.571941433349609e-01   +7.210035895046037e-01   +1.347737375138328e-01   +2.040774912821586e-01   +8.351809159865377e-01   +8.479611049404996e-01   +5.208542516978449e-01; +7.607295406722763e-01   +5.150524389555974e-01   +2.408834691911068e-01   +2.514028887163473e-01   +7.160251879165714e-01   +1.498632634733990e-01   +6.415207673352391e-01   +3.949781241134531e-01; +9.005694482364377e-01   +4.266336435246368e-01   +6.048673592307887e-01   +8.227131032047196e-01   +8.953761169222117e-02   +4.260749820419297e-01   +4.123191887265303e-01   +2.653463302804849e-01; +7.038498157111777e-01   +1.613663695945787e-01   +4.325888056760723e-01   -4.034772823316678e-02   +7.157603495117195e-01   +3.641535074058207e-01   +7.469611266994775e-01   +6.912962015545574e-01; +4.502458914907377e-01   +7.665836962110274e-01   +6.373193042271666e-01   +7.859573971458399e-01   +4.021310524965963e-01   +8.098110839400543e-01   +7.419499639956237e-01   +2.152478918441703e-01; +5.434547310037330e-01   +5.469343930127146e-01   +5.435116762877147e-01   +3.370398640751168e-01   +8.499687283473556e-02   +8.277872742042088e-01   +5.517173323058713e-01   +4.159323817271652e-01; +6.997964431225689e-02   +3.884314980150174e-01   +4.090128047635404e-01   +4.373730421496625e-01   +3.847058789476540e-01   +4.427779313967255e-01   +2.456148595882324e-01   +5.311701772964337e-01; +3.617520493964696e-01   +1.525884586025039e-01   +6.405068458712706e-01   +7.645003664209987e-01   +2.100667065057888e-01   +6.865889738608668e-01   +3.620713667989500e-01   +7.323874523099489e-01; +4.483255782551137e-01   +4.403232964735653e-01   +6.247139236746045e-01   +3.102680877447307e-01   +7.729893227407472e-01   +3.581487908558506e-01   +3.597400500142116e-01   +2.930343642941390e-01; +5.912073915301355e-01   +1.464330238619926e-01   +2.208420233900616e-01   +1.978999774462420e-01   +5.809197260986743e-01   +5.649143946872943e-01   +2.948448443258087e-01   +6.887094069378646e-01; +7.218534097682586e-01   +5.786515113689819e-02   +6.683279105032598e-01   +3.815803917643989e-01   +3.603774531320295e-01   +4.942578940623276e-01   +1.862784018862951e-01   +3.208939040819290e-01];
L1I_L2I_iGABA_netcon = [+4.744327294650625e-01   +1.874321304738285e-01   +8.018273420764254e-01   +2.643795134938562e-01   +4.878111952591538e-01   +2.368371017157284e-01   +8.500382713205190e-01   +2.550327719532332e-01   +4.829062672269545e-01   +8.154230186512753e-01   +3.794263915149030e-01   +3.826648454248530e-01   -3.928306656510894e-02   +6.732215925922731e-01   +5.990843818547259e-01   +4.265510816831848e-01; +3.492031479393226e-02   +1.145158984114728e-02   +2.981454520223124e-01   +2.498083975648813e-01   +8.927673678723675e-01   +3.612781615432811e-01   +2.724731560960883e-01   +1.905462804460996e-01   +4.880704053020745e-01   +2.185611295558289e-01   +3.234586923888971e-01   +2.801627784898658e-01   +9.689011117861459e-01   +2.200494049734083e-01   +7.403301210068115e-01   +2.285207600656642e-01; +3.375216594295039e-01   +6.135883099674801e-01   +2.905722304320039e-01   +6.878370639997303e-01   +2.685219704634356e-01   +5.790356097478003e-01   +7.703107168969844e-01   +9.416665004233429e-02   +7.443305779270892e-01   +4.877953384562577e-01   +5.311142310144676e-01   +8.434364253265064e-01   +9.368065945811050e-01   +6.468502323014288e-01   +3.570648637668556e-01   +2.077009992256574e-01; +9.000103051242515e-01   +8.898395585390939e-02   +6.505964994075893e-01   +9.243470372167240e-01   +4.357768313577094e-01   +8.652132053173346e-01   +6.332122918436052e-01   -9.720592827795973e-03   -3.011827985990768e-02   +2.728346068568944e-01   +3.979994638847998e-01   +4.442258345852127e-01   +3.051443792763092e-01   +4.592918908465226e-01   +1.854133015470544e-01   -2.312400194405229e-03; +8.762377743407047e-01   +8.448806958803964e-01   +7.857175813927814e-01   +5.848816221599502e-01   +3.001417745206995e-01   +6.692230354668983e-01   +6.748888290575913e-01   +6.131414069952009e-01   +1.289997975068486e-01   +6.815096725365459e-01   +2.581321650247161e-01   +5.143881353370686e-01   +7.671485894721070e-02   +2.058980024635119e-01   +7.260741705725772e-01   +9.681331036235006e-01; +5.478778339470646e-01   +5.333700003608082e-01   +1.139448815755698e-01   +3.080468148041419e-01   +9.121759181585061e-01   +1.329427198691216e-01   +7.195951616807018e-01   +6.380756988842812e-01   +4.695994543529530e-01   +7.330647254722975e-01   +3.319729615994634e-01   +4.795883800357104e-01   +9.027225943385618e-01   +1.357736226684685e-01   +2.441403945084230e-01   +9.490598603172046e-02; +8.956199386079032e-01   +1.035471517175453e-01   +4.162086343797233e-01   +3.251753055823060e-01   +5.244268257903913e-01   +8.606931586705160e-01   +1.037962498296387e-01   +2.342503247032509e-01   +7.652912281460220e-01   +9.097583003991450e-01   +9.055643950339312e-01   +7.987485434630331e-01   +1.412775043360789e-01   +2.175116844800927e-01   +2.611564077114459e-03   +5.337301436578676e-01; +8.909414797780991e-01   +4.007438522049466e-01   -2.251983001828656e-02   +8.370241169356704e-01   +1.493719221010544e-01   +9.255988786249888e-01   +7.687701456184313e-01   +6.604172902106019e-02   +8.299321787544437e-01   +2.030279958897765e-02   +8.947043337977842e-01   +6.873489661805581e-03   +8.169445866471643e-01   +9.395750639109066e-02   +9.422992894661268e-01   +6.728112608028933e-01];
L2E_L1E_iAMPA_netcon = [+3.182206778520614e-01   +9.098389845729801e-01   +5.961259214155515e-01   +5.608766007410215e-02   +3.548499230168384e-01   +3.285005478690345e-01   +4.886731481418528e-02   +5.735681452984471e-01; +1.695839661337470e-01   +1.501323511247174e-01   +7.047205430701902e-01   +8.482341225131186e-01   +3.890899569261833e-01   +5.428377764630372e-01   +1.926577522665142e-01   +7.571702872760147e-02; +5.049226358536196e-01   +8.542506667731796e-01   +7.077701214778906e-01   +1.847353836570011e-02   +6.125863832999207e-01   +3.253122643179788e-02   +4.087637469504802e-01   +8.347346718979191e-01; +4.036319525113298e-01   +6.314065179228764e-01   +3.664795739427478e-02   +5.578278690772500e-01   +2.288444579102014e-01   +6.009052094961976e-01   +1.670779424467045e-01   +4.835609359222917e-01; +8.655138562553246e-01   +6.083950390473795e-01   +7.372972190018687e-01   +4.764076542810270e-01   +6.996532204547842e-01   +3.766105120768382e-01   +4.093636598933542e-01   +5.124232390294452e-01; +4.460480535885374e-01   +5.963259417058457e-01   +2.218828937998728e-02   +6.139350671780519e-01   +6.310633936657852e-01   +8.438323112264569e-01   +2.819015442958100e-01   +6.729242634723098e-02; +4.146213088160094e-01   +3.180257781778089e-01   +2.519830771799210e-01   +3.948525467228029e-01   +4.029218951446346e-01   +2.512161210481142e-01   +5.625143871271651e-01   +2.401042673325872e-01; +7.271159142002908e-01   +1.794223336770309e-01   -8.672630340334372e-02   +1.000000000000000e+00   +5.764120032009266e-01   +3.638797359539028e-01   +5.778071778151463e-01   +6.045613108076002e-01; +7.979754161010336e-01   +5.962453145640434e-01   +6.633548055484237e-01   +1.016410677712012e-01   +3.476937337016461e-01   +2.017345079540692e-01   +1.009328578698991e-01   +9.385133950369109e-01; +4.161759987551902e-02   +1.835146875969129e-01   +1.616583529575700e-01   +2.123065513995656e-01   +1.046881295659085e-01   +5.496296857725322e-01   +8.750257618692636e-01   +8.748073458004292e-01; +4.313348592803098e-03   +1.900455528255835e-01   +5.399670181159046e-01   +4.068570062440772e-01   +1.742410840983349e-01   +4.007647207139067e-01   +2.083914941098601e-01   +6.684886146359209e-01; +3.288910093360326e-01   +5.877688280474013e-01   +5.742410175823239e-01   +4.247720514308618e-01   +6.650050245756490e-01   +3.198088869280779e-01   +6.341778810124663e-01   +4.839298896223251e-01; +6.821574797712497e-01   +7.197996996507305e-01   +5.323840390015054e-01   +1.825124538887471e-01   +1.926873694437671e-01   +1.372326021416914e-01   +7.293509259062339e-02   +5.389745881653444e-01; +6.804392610095592e-01   +8.049075795743272e-01   +9.204569829787486e-02   +8.945461387172297e-01   +5.172585084133591e-01   +7.476608000416768e-01   +4.549577064539820e-02   +1.487450074190201e-01; +8.843261727653222e-01   +2.005697281208192e-01   +5.329592225576190e-01   +5.978073210015340e-01   +3.300402388298250e-01   +1.992340237968225e-01   +6.288745438956651e-01   +4.770131558674410e-01; +7.801081700076242e-01   +5.871750062117845e-01   +7.308917733485786e-01   +3.412633573646990e-01   +4.802686690227502e-01   +8.131380901519429e-01   +6.819915951855131e-01   +1.779878854068028e-01];
L1E_L2E_iAMPA_netcon = [+7.733939644715683e-01   +4.009429685630463e-01   +5.597582488784245e-01   +1.700247902765549e-01   +8.965507431316889e-01   +1.790729015257462e-01   +5.084253464053045e-01   +4.407860261122988e-01   +9.926900550703904e-01   +4.970321681185217e-01   +5.308848320046043e-01   +4.469243370997956e-01   +5.347109544064544e-01   +3.089201546594645e-01   +5.713832618721874e-01   +3.115488891022528e-01; +7.474099889838232e-01   +1.821586479919202e-01   +1.637309386258690e-01   +5.467727468278012e-01   +8.117663490114605e-01   +5.618693802545700e-01   +9.126835501640204e-01   +2.352687912871582e-01   +3.117657703716952e-01   +2.901992528189765e-01   +6.093709494497329e-01   +6.111220585177725e-01   +5.734254846106090e-01   +8.567367305196546e-01   +3.717168874229039e-01   +5.207826351803703e-01; +7.269057941044650e-01   +8.668821040069455e-02   +1.654383205052175e-01   +9.311589410215609e-01   +2.256770674545241e-01   +3.547255156855890e-01   +8.516037703487714e-01   +3.487430697109773e-01   +2.404948646774061e-01   +6.080811190287968e-01   +7.515165522584722e-01   +4.447576796119882e-01   +7.634868503229014e-01   +8.470617036276918e-01   +7.477850440941406e-01   +5.760906627089291e-01; +6.084233598682468e-01   +4.608972432673213e-02   +5.105617868450959e-01   +3.101931984186586e-01   +3.856794874440954e-01   +7.777400595885984e-01   +2.339689442239970e-01   +1.471179559193776e-01   +5.456852282320452e-01   +5.230680951639081e-01   +4.065742032914554e-01   +9.391308286410968e-01   +6.609569163035564e-01   +3.333642019890144e-02   +7.526257551268272e-01   +7.789022733849242e-01; -3.993052198139471e-02   +2.372803408566771e-01   +1.631232069872249e-01   +6.622998197399559e-01   +1.123499685684919e-01   +4.060462583759462e-01   +9.432862177553276e-01   +3.410435555099263e-01   +1.186070459802737e-01   +7.377815442705798e-01   +7.822822884043132e-02   +5.091688853904331e-01   +2.807999421701362e-02   +6.031483779666676e-01   +4.524098396159941e-01   +2.011868495945627e-01; +6.048539247476619e-01   +3.703160849660313e-01   +4.207726272216705e-01   -1.599755757622349e-01   +8.128346884193561e-01   +7.754300428631868e-02   +4.474791309308080e-01   +2.160046845479706e-01   +7.330189208605437e-01   +1.328766299359724e-02   +6.770533718191097e-01   +1.410569642822052e-02   +6.606308611745485e-01   +5.084228166587420e-01   +7.108941549888848e-01   +2.997717946705066e-01; +2.554214451789380e-01   +7.255587030910652e-01   +3.408685819541965e-01   +3.643100748806835e-01   +2.378338537775793e-01   +8.006572742019458e-01   +9.502897265728473e-01   +3.798660043900772e-01   +6.454698760427011e-01   +7.161809200459147e-01   +1.621265704606682e-01   +1.293299901466651e-01   +8.622127994340822e-02   +2.960125307091899e-01   +2.815119478188546e-01   +7.671291679784835e-01; +1.400868609142634e-01   +3.467417905825644e-01   +2.633114243150468e-01   +4.532458876629364e-01   +9.999702885923709e-01   +4.480348033441908e-01   +8.864266539338105e-01   +7.991200800273635e-01   +3.817274546406994e-01   +4.379000392471459e-02   +3.534631324233680e-01   +4.083128786615502e-01   +3.016068760721617e-01   +6.370445356746218e-01   +2.223172427941143e-02   +4.827885721306940e-01];
L2I_L2E_iAMPA_netcon = [+3.171363988217485e-01   +2.631852607624739e-01   +3.172191079234076e-01   +5.689196717088200e-01   +1.721107663730932e-01   +7.855636142780462e-01   +6.654370257885408e-01   +2.182270289134106e-01; +4.771235139652069e-01   +1.814935400818768e-01   +6.809285167083720e-01   +2.754089373978381e-01   +6.352743782707396e-01   +8.526811107996745e-01   +6.796982620392643e-02   +4.630002254622836e-01; +6.209731006544112e-01   -2.258599496392562e-02   +6.791922440281090e-01   +5.459264794697809e-01   +1.666025482089254e-01   +5.974219954423238e-01   +7.613274348320553e-01   +1.811170691122935e-01; +5.185015158787369e-01   +2.305396678449488e-01   +1.563253429436266e-02   +9.588144549053886e-01   +3.251243102190935e-01   +6.400941778928868e-01   +9.261713331844786e-01   +1.745727839886673e-01; +7.182498253153330e-02   +3.742447062518159e-01   +4.883333364029214e-01   +8.499281868922148e-01   +8.604936665449578e-01   +5.248113579788610e-01   +7.124435383299300e-01   +1.737141277085546e-01; +8.266013477260173e-01   +4.537471061950900e-01   +9.000491033693477e-01   +8.901293031400311e-01   +6.509673585541562e-01   +7.838020609825620e-01   +8.334609094512582e-01   +5.297109692747356e-01; +7.737785746585008e-02   +5.508234245636543e-01   +8.508059010456275e-01   +8.284834886489150e-01   +7.516970762488395e-02   +7.227158572566954e-01   +1.890373819057829e-01   +1.305933460351759e-01; +5.848047683909627e-01   +4.200992023347391e-01   +1.778626515628527e-01   +3.355512774208551e-01   +6.662531453913044e-01   +4.294325649236075e-01   +9.872754320132909e-01   +6.902526628463586e-01];
L2E_L2I_iGABA_netcon = [+4.169693312784855e-01   +6.171885637538412e-01   +5.798649227924764e-01   +1.082667605101760e-02   +4.305003249379472e-01   +5.009304558629286e-01   +2.619708884758541e-01   +6.901549759623310e-01; +5.379775589918295e-01   +2.676258027441434e-01   +6.317952247614274e-02   +5.053996394974253e-01   +4.722020279523900e-01   +6.408666942863657e-01   +5.251042675713968e-01   +4.225011137742817e-01; +5.822792305391175e-01   +5.715300585438539e-01   +4.006234978835010e-01   +6.153411205373498e-01   +3.317973012336436e-01   +2.984798164236645e-01   +1.047859621521077e-01   +9.320755048761088e-01; +6.764064190095447e-01   +5.610337169316374e-01   +4.197669130142415e-01   +8.570563383433389e-01   +2.308805178167286e-01   +7.642576349457236e-02   +1.431569026834511e-01   +4.206876573891574e-01; +5.000143462834111e-01   +7.785186549544753e-01   +5.105887482119763e-01   +7.100435524975518e-01   +4.163016347729482e-01   +7.514756789334772e-01   +6.221566027414457e-01   +4.288382643515147e-01; +3.307046303587959e-01   +2.631902000279472e-01   +4.482081904995173e-01   +4.146295795478011e-01   +7.261307040797579e-01   +8.187348774444480e-01   +1.470764395660069e-02   +4.034556096079500e-01; +8.502213980490099e-02   +4.596531267134281e-01   +7.947480291441232e-01   +5.689759436338109e-01   +5.219279480789251e-01   +4.176386738559033e-01   +9.204334260459311e-01   -9.690965108933654e-02; +8.659965744340177e-01   +5.860230631607672e-01   +8.596611791631082e-01   +4.912416454008632e-01   +9.050617200622261e-01   +5.377617245948023e-01   +3.146571392512436e-01   +3.185109054217218e-01];
L3E_L2E_iAMPA_netcon = [+2.505190590096555e-01   +8.793382238824864e-01   +4.611165493283439e-01   +6.744481189732273e-01   +2.095938727868528e-01   +4.160722888186689e-01   +2.944817447941128e-01   +8.720175164525915e-02   +1.468168415050941e-01   +5.075855663471962e-01   +1.277487896779302e-01   +5.081907831525584e-01; +2.903454995023945e-01   +4.358110285667181e-01   +1.416225920907119e-01   +2.550703082812990e-01   +5.420052157923994e-01   +8.698845354846997e-01   +7.091226110113261e-01   +5.216064127673150e-01   +2.454658123038882e-01   +3.080784145238767e-02   +1.749059090297968e-03   +7.923367494624022e-02; +7.852477034798017e-01   +3.701320852949090e-01   +5.138906199079085e-01   +1.144553199588840e-01   +8.317199224582016e-01   +8.991408987594122e-01   +5.511693884850443e-01   +6.588931139385646e-01   +7.020329337455398e-01   +3.032847212668212e-01   +3.504399415130812e-01   +9.110539906908276e-01; +1.027936625211859e-01   +4.685667943241364e-01   +2.325822854943426e-01   +7.670936410553134e-01   +4.998306198324703e-01   +5.681669343721910e-01   +8.298984276327613e-01   +3.514464076973244e-01   +8.522887809276732e-01   +7.535858616186845e-01   +4.035469702855710e-01   +1.170564866932527e-01; +1.585859967679591e-01   +7.407924623623390e-01   +4.470885799106598e-01   +4.624017014027619e-02   +1.561782896845599e-01   +9.223957154502500e-01   -4.677521026626084e-02   +6.139832848849823e-01   +1.073500448345923e-01   +8.582568172731120e-01   +2.172730557026568e-01   +2.373891901283487e-01; +2.817794933890372e-01   +3.897068614802052e-01   +8.408516978746947e-01   +9.558875651529711e-01   +4.094199459547277e-01   +8.928151342036516e-01   +2.541457190970503e-02   +3.188016410764460e-01   +5.278091754143567e-01   +7.426413253666044e-01   +5.830033016881756e-01   +8.059828284762611e-01; +2.650974070350984e-01   +4.863445548024402e-01   +5.379900881404259e-01   +1.422773683278318e-01   +6.405213282407524e-01   +5.169454163945731e-01   +7.016645255031744e-01   +1.396951649725271e-01   +3.676382754118172e-01   +4.184954962502964e-01   +9.756122364351411e-01   +6.747417573651104e-01; +5.366387644316427e-01   -4.960398283428123e-02   +3.539667837798749e-01   +1.359816965861056e-01   -1.870923225209260e-02   +8.776153304434365e-01   +3.739905297306804e-01   +4.318342759595230e-01   +8.768222841528396e-01   +9.983084802880446e-01   +8.719489846309881e-01   +2.701405275302196e-01];
L3I_L2I_iGABA_netcon = [-1.620623551102750e-02   +4.594582193755946e-02   +9.982419896701587e-02   +6.065053567665433e-01   +7.325707106432489e-03   +5.264065773309310e-01   +7.682569899853667e-01   +4.110798480216413e-01   +3.584959114159811e-01   +8.661921906878233e-01   +7.961991635451784e-01   +6.519125343973521e-01; +4.131876966437423e-01   +3.731631098854404e-01   +2.738814906446090e-01   -6.498745208133161e-02   +4.843685560397250e-01   +6.370493939772633e-01   +4.743737276458536e-01   +9.095557822419110e-01   +1.737899666158183e-01   +9.231065120973883e-01   +2.291161504554359e-01   +5.808545220230582e-01; +3.092115048115076e-01   +6.013105464297328e-01   +2.751170935162566e-01   +7.152403504946729e-01   +2.913520028187875e-01   +8.362010829149477e-01   +8.836158202562724e-01   +9.573889381244140e-02   +6.306202401247193e-01   +4.420621529987358e-01   +1.453852432642289e-01   +5.482094958459913e-01; +5.574460923379906e-01   +9.888515160107116e-01   +2.628844408703987e-01   +1.654544199794590e-01   +1.536596253906544e-01   +5.838652520519320e-01   +1.828087436883823e-01   +1.990069015251582e-01   +6.190641272585023e-02   +3.741013916870686e-01   +5.381776601060896e-01   +7.567367588987666e-01; +9.186054481222964e-01   +1.124362565157388e-01   +4.410452550791112e-01   +8.882255785989731e-01   +4.304262747898482e-01   +8.394398604798763e-01   +1.280556786981070e-01   +4.821506778253132e-01   +5.378609067517266e-01   +7.157299408593082e-01   +6.911773667378487e-01   +4.023979262931862e-01; +8.603886569164568e-01   +2.317763339594524e-01   +1.634445415226528e-01   +7.207666662270520e-01   +8.624747070687595e-01   +7.500070962986782e-01   +9.023460594404004e-01   +6.033137037875606e-01   +1.050134107915322e-01   +7.867976071197132e-01   +3.336992039931366e-01   +5.981981136290078e-01; +7.923880334085577e-02   +4.626423017261916e-01   +8.888234442148575e-01   +5.972060872806867e-01   +9.416679168547175e-01   +7.028845498499054e-01   +7.960824212021924e-01   +7.058138867597880e-01   +5.524937162032109e-01   +3.661627952025446e-01   +3.261114564073405e-01   +4.776795586114277e-01; +4.193988305330508e-01   +6.204840937819166e-03   +7.589464831192065e-01   +2.397880888095832e-01   +4.140139617898125e-01   +3.349635093164781e-02   -2.712881797641903e-02   +8.340706668599264e-01   +4.120102851055832e-01   +6.324816958882562e-02   +7.549729170013074e-01   +1.538534189768222e-02];
L2E_L3E_iAMPA_netcon = [+9.437335739115936e-01   +2.025744959286015e-01   +4.506543945308795e-01   +7.464202016390226e-01   -5.328348589292192e-02   +6.290796686778390e-01   +7.834821584221842e-01   +1.710731471765052e-01; +3.730062130186633e-01   +5.061392466047773e-01   +7.016731795041163e-01   +5.876842434156441e-01   +2.661673446815471e-01   +1.438168652820859e-01   +8.184664212686629e-01   +5.967127205765473e-02; +5.755267861630418e-01   +4.973639289412197e-01   +8.500658791850292e-01   +5.182023627139056e-01   +9.119182033416671e-01   +4.776612801249449e-01   +9.665537679315563e-01   +4.261190752043828e-01; +2.170092145748961e-01   +9.122786294528162e-01   +8.577138411288163e-01   +3.370438515823612e-01   +3.034938210460699e-01   +9.711471967388039e-01   +2.584907148509448e-01   +4.920812232086184e-01; +8.422310143267274e-02   +2.331552043198642e-01   +7.050763688130254e-01   -5.719023812352339e-02   +2.341870210454637e-01   +5.111227154671598e-01   +4.536735014342018e-01   +5.672257602383620e-01; +3.369664201024332e-01   +8.305072380683491e-01   +1.853635790880702e-01   +7.771112222886657e-01   +5.453824708284430e-02   +5.664258314752378e-04   +4.442428482964175e-01   +1.714666729828132e-01; +4.328338281012578e-01   +7.374997706588092e-01   +6.906722167383251e-01   +2.275187657469436e-01   +7.266708315890177e-01   +1.930503310373851e-01   +6.910602578372478e-01   +8.787711365490373e-01; -4.090609677577711e-02   +5.017241124302961e-01   +8.947255170808769e-01   +4.101165132357422e-01   +1.208983115927797e-01   +7.379326336135544e-01   +9.232475885862250e-02   +3.361273878524726e-01; +9.850711388658165e-01   +9.165510778320923e-01   +9.541063499883956e-02   +1.139077572906339e-01   +7.165040384115200e-02   +8.662160849200409e-01   +2.431957399459082e-01   +8.692101071514237e-01; +1.637667012489727e-01   +3.649857992029183e-01   +7.940425075169545e-01   +3.377067438543975e-01   +3.933691422477357e-01   +8.319856736277357e-01   +8.830582825989969e-02   +8.265867578556031e-01; +6.808036706082453e-01   +3.482388647670710e-01   +3.108293715805753e-01   +2.949449078461647e-01   +9.816875597926175e-02   +3.203209152019923e-01   +1.685399191344907e-01   +1.522962586670558e-01; +8.708159571985549e-02   +5.857127450034390e-01   +8.260563343774215e-01   +4.612590921378580e-01   -5.620864507088872e-02   +6.722155530840496e-01   +7.974854861711786e-01   +7.280052600411896e-01];
L2I_L3I_iGABA_netcon = [+3.235114299779628e-01   +6.977853459382927e-01   +3.399206717750410e-01   +6.721552406196732e-01   +5.214791047551098e-01   +3.252855642459026e-01   +3.888280311815058e-01   +4.770357414267207e-01; +3.250760635494050e-01   +6.045951469955604e-02   +2.778002028294177e-02   +7.851523643743414e-01   +7.041655094329528e-01   -2.525638170673356e-02   +1.142384400465500e-01   +6.151592214463998e-01; +3.386694149523769e-01   +5.663543586815217e-01   +3.627270301286660e-01   +1.521115529457613e-02   +7.913374212361011e-01   +6.528686959667850e-01   +2.528360143450350e-01   +6.721563398456173e-02; +6.004261195260847e-01   +8.217110147975156e-01   +5.369406402519972e-01   +4.704290229280705e-01   +5.368548934054460e-01   +6.239755723655701e-01   +3.914287082937056e-01   +6.890501655487493e-01; +5.595161910029982e-02   -2.860594648242060e-02   -1.237619010477333e-02   +7.020058645832733e-01   +2.224314799968831e-01   +6.315736232352576e-01   +4.364338432091041e-01   +2.397077579705363e-01; +5.866189705999035e-01   +4.033200037181036e-01   +4.386124035774396e-01   +7.241270746050624e-01   +2.984477465370226e-01   +8.093665817757912e-01   +4.960159421023053e-01   +1.627562203403775e-01; +2.495342765799327e-01   -5.522402322871008e-02   +3.765103905815291e-01   +9.918472105452106e-01   +7.540499907142701e-01   +4.226109187698812e-02   +2.821980483513306e-01   +8.425843992742578e-01; +2.221597187821424e-01   +8.550443132580727e-01   +8.792513634152986e-01   +9.200750871379775e-01   +5.079661444184602e-01   +1.293574905578143e-01   +6.563653408073755e-01   +7.778061461570793e-02; +2.781605301423288e-01   +5.331047718729690e-01   +2.399289080149967e-01   +1.850095113765399e-01   +4.070304183706999e-01   +3.566417447520903e-01   +5.810447135941541e-01   +5.099709806602984e-01; +3.966615474774816e-01   +1.891517405193733e-01   +1.725625800571447e-01   +3.907881654982091e-01   +9.237744406855913e-01   +4.992621074554217e-01   +4.851340178238926e-01   +9.648878915377191e-01; +5.357537326430746e-01   +9.327155708241515e-02   +2.488453682274314e-01   +5.923875196238260e-01   +5.100530241716991e-01   +6.960743033792981e-01   +9.356959419810447e-01   +6.406848543150544e-01; +3.771608475500474e-01   +1.749120369026846e-01   +6.452028658653877e-01   +3.446947079539126e-01   +1.498062978053596e-01   +8.114101176324303e-03   +3.650145016608888e-01   +5.935842711724477e-01];
L3I_L3E_iAMPA_netcon = [+1.476425421125822e-01   +5.513224174805689e-01   +4.706024011368693e-02   +1.756489960959291e-01   +1.868959284725750e-01   +6.961578991022626e-01   +5.504754485481135e-02   +3.474089414141907e-01   +4.466060267015635e-01   +3.409437175115352e-01   +5.264901659107771e-01   +8.645279810753879e-01; +3.074742046842571e-01   +7.631386892160978e-01   +2.155528177678576e-01   +2.778507142861308e-01   +6.971025179717371e-01   +4.696242430828465e-01   +3.218904309794551e-01   +3.401570325316652e-01   +6.313158158801490e-01   +2.446691141456408e-01   +6.923791214872141e-01   +2.368292832862370e-01; +4.482831161879209e-01   +2.861916937844554e-01   +6.802693132484312e-01   +8.258014949712940e-01   +5.532903755854618e-01   +6.227539691878130e-01   +9.837064352442192e-01   +4.460117103206315e-01   +2.654344503064072e-01   +3.840303255827284e-01   +8.127639144876643e-01   +8.457133316555406e-01; +4.882549225670450e-01   +1.028968843412381e-01   +5.704619411084327e-01   +6.743786772220430e-01   +4.536918952703161e-01   +5.725251967118281e-01   +5.470592500773157e-01   +6.613052037901385e-01   +4.737060421739372e-01   +1.753401841221139e-01   +3.723769780415175e-01   +5.032699243813739e-01; +8.733649654736629e-01   +7.560573689543009e-01   +5.301830943797669e-01   +4.653455458604072e-01   +2.127951505863880e-01   +2.828451947279562e-01   -3.547057274516896e-02   +2.560993756035422e-01   -2.174113376180020e-02   +1.813885483505654e-01   +9.663087970674210e-03   +4.393354532569243e-01; +3.204935497193179e-01   +1.423593900742683e-01   +6.536633449099826e-01   +4.686408089374886e-01   +9.670812694241535e-01   +5.593834436805118e-01   +2.107531197870785e-01   +1.552611682812655e-01   +1.628770440127633e-01   +5.396178572873517e-01   +2.716282959266531e-01   +1.338100132688191e-01; +5.144504517346553e-01   +2.976176113551582e-01   +7.708664753856469e-01   +8.602902252807493e-01   +1.647770045447483e-01   +1.249021638864416e-01   +3.808920030989736e-01   +8.027460082174764e-02   +8.677288401621214e-01   +7.036604669657704e-01   +3.064226860067741e-01   -5.680094141434255e-03; +3.057904222186087e-01   +3.812214168824730e-01   +3.319660832609250e-01   +6.101812864918453e-01   +7.674507514110362e-01   +1.782907653350085e-01   +3.247831566169704e-01   +2.937925422763323e-01   +2.590579417273339e-01   +2.605053082720004e-01   +5.733815392926552e-01   +4.915018929731814e-01; +3.707372255147874e-01   +4.500066019294726e-01   +3.931041370343281e-01   +6.367586080304913e-01   +5.462261386780998e-01   -6.385245693780219e-02   +1.156360159378849e-01   +2.813627189600281e-02   +3.248783361644701e-01   +2.488899441435173e-01   +7.416488507500452e-01   +9.217968340093677e-01; +6.930588469829688e-01   +5.825891532224390e-01   +5.407912603713385e-01   +4.250719395195718e-01   +4.476344219394565e-01   +3.342195432607385e-01   -1.029788939390659e-03   +6.388168239216561e-01   +8.640011336850895e-02   +8.241173113089479e-01   +3.776757385742826e-01   +1.205188160455719e-01; +1.046805608911621e-01   +2.699661069141076e-01   +5.767239325487666e-01   +1.932491758640570e-01   +2.910830554984840e-02   +5.023360348359057e-01   +3.641701233009952e-02   +7.172355517558682e-01   +6.555674920207668e-01   +1.831316314067185e-01   +6.150641204628761e-01   +2.998750574281872e-01; +6.092826643064914e-01   +7.276098259601674e-01   +4.017754022710686e-01   +5.668470693601084e-01   +6.508990242143976e-01   +3.354854745586277e-01   +3.035930469020465e-01   +8.356358591995806e-01   +5.532274593148224e-01   +2.793556432726420e-01   +4.472665326446743e-01   +4.232678630588120e-01];
L3E_L3I_iGABA_netcon = [+3.320092413923836e-01   +7.709486860288269e-01   +6.548369172974835e-01   +9.373165981845158e-01   +4.920467306303975e-01   +1.020358671401198e-01   +2.688388479427189e-01   +6.650157957225429e-01   +6.588905285585602e-01   +3.541365353087069e-01   +4.497294123539390e-01   +2.795520201188131e-01; +8.938118393210142e-01   +3.525168736019894e-01   +5.785118332668513e-01   +9.712630509438376e-02   +8.451572907545750e-01   +3.640214116129033e-01   +8.612714129138951e-01   +6.134292443246760e-01   +5.581413806316330e-01   +7.769568897705202e-01   +2.655495993303293e-01   +4.620319351001276e-01; +7.123594230043836e-01   +3.979025904975072e-01   +4.340759839344511e-01   +5.393558130788879e-01   +5.512478637782801e-01   +4.931692979384693e-01   +2.646709073575786e-01   +8.756107382655168e-01   +5.045858838744777e-01   +2.369006877487492e-01   +8.047706630174274e-01   +8.663522687200499e-01; +2.139680635359248e-01   +6.090463245996591e-01   +2.996868157806033e-01   +3.369144264405678e-01   +1.115207664628496e-01   +6.167092498775425e-01   +2.872165503858245e-01   +8.109993869509528e-02   +2.495286948614691e-01   +5.247800270670213e-01   +7.694049944401784e-01   +6.295453740761356e-01; +3.222027569851145e-01   +6.196056098547915e-01   +5.637660682541787e-01   +2.868664007348877e-01   +1.466000601129638e-01   +6.944620418400241e-01   +8.001818199080002e-01   +2.845584824684728e-01   +1.971618713041432e-01   +7.551928143507457e-01   +5.826516216984917e-01   +2.581803378376765e-01; +4.372023483740207e-01   +7.710515683918236e-01   +6.893468581304498e-01   +4.908284995627551e-01   +7.046980268453892e-01   +4.793727941488329e-02   +3.037979716053736e-01   +1.990889493262955e-01   +9.117796350688486e-01   +8.964758544784045e-01   +8.044193454316928e-01   +2.517146309003212e-01; +6.242737154356428e-01   +7.672237516322621e-01   +2.050933606509804e-01   +6.306586979571667e-02   +4.160728089784856e-01   +5.858313660843284e-01   +6.260898443403901e-01   +1.798560410708650e-01   +9.450671069922211e-01   +6.049395894263156e-01   -3.490869688313213e-02   +2.852016438084789e-01; +5.350137249507348e-01   +3.708778640445698e-01   +8.969805402628169e-01   +4.565894084530950e-01   +1.421176628207972e-01   +2.589263742733185e-02   +5.703361781585421e-01   -4.994930162866142e-03   +6.234083610700769e-01   +7.899307276049833e-01   +2.751516573180461e-01   +9.802689786786842e-01; +2.932969826908226e-01   +5.324855495252765e-01   +3.017055556219683e-01   +7.785448393431473e-01   +7.812257938331765e-01   +1.142007977461023e-01   +3.405633959110592e-01   +6.245059058357911e-01   +6.067157215458419e-01   +7.605297320190161e-01   +6.925838338791830e-01   +6.393957202800897e-01; +2.478007467802235e-02   +1.189160807578715e-01   +2.990887594811141e-01   +5.415850431838746e-01   +6.793577254530229e-01   +2.230726997408122e-01   +3.509697223642511e-02   +3.286810785422137e-01   +7.043839827463823e-01   +2.166220573006964e-01   +5.848874191898614e-01   +7.043737000936287e-02; +8.943611428134537e-01   +8.836351770183212e-02   +7.088429725819267e-01   +5.151296109871268e-01   +3.738629291414562e-01   +8.504765708401991e-01   +1.556460753573363e-01   +8.274084576379128e-01   +2.664386163681773e-01   +8.779121958605737e-01   +5.403898163826329e-01   +7.207797330149255e-01; +6.488416540497550e-01   +8.038912855792641e-01   +5.014416287061495e-01   +8.459081330905076e-01   +8.111345261323375e-01   +5.245608808657523e-01   +9.005661768945472e-01   +8.972100303635062e-01   +5.292135809754880e-01   +7.782740536544757e-01   +4.593127826047990e-01   +9.095139444985326e-01];
L2E_Input1_iAMPA_netcon = [+9.252036903908115e-01   +9.812992298430511e-01   +8.743880955842590e-01   +9.135862984102299e-01   +8.798064944546445e-01   +9.695673137297971e-01   +9.078606879407425e-01   +9.126740137937921e-01];
L2I_Input2_iAMPA_netcon = [+9.135881735135146e-01   +9.113225543704656e-01   +9.953266134400824e-01   +8.934283744653782e-01   +8.426751908224880e-01   +8.861519200720970e-01   +9.048343989005159e-01   +9.484782694234336e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))*0.4 + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.5*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.5*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))*0.9 + 0.5*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))*0.4 + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.5*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.5*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))*0.9 + 0.5*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
